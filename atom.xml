<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å¸ƒå…°ç‰¹ | ä¸å¿˜åˆå¿ƒ</title>
  
  <subtitle>äººå¤„åœ¨ä¸€ç§é»˜é»˜å¥‹æ–—çš„çŠ¶æ€ï¼Œç²¾ç¥å°±ä¼šä»çç¢ç”Ÿæ´»ä¸­å¾—åˆ°å‡å</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="cpeixin.cn/"/>
  <updated>2020-05-28T15:08:18.891Z</updated>
  <id>cpeixin.cn/</id>
  
  <author>
    <name>Brent</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Linuxç›´æ¥ä¸‹è½½Google Driveæ–‡ä»¶</title>
    <link href="cpeixin.cn/2020/05/28/Linux%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BDGoogle-Drive%E6%96%87%E4%BB%B6/"/>
    <id>cpeixin.cn/2020/05/28/Linux%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BDGoogle-Drive%E6%96%87%E4%BB%B6/</id>
    <published>2020-05-27T17:03:54.000Z</published>
    <updated>2020-05-28T15:08:18.891Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><p>åœ¨Google Colabä¸­è®­ç»ƒå®Œæ¨¡å‹ï¼Œä¿å­˜åœ¨Google Driveä¸­ï¼Œæ•´ä¸ªé¡¹ç›®å¤§å°æœ‰3ã€4GBå¤§å°ï¼Œæ­¤æ—¶æƒ³å°†è¿™æ•´ä¸ªé¡¹ç›®æ”¾åˆ°æœåŠ¡å™¨ä¸­è¿›è¡Œéƒ¨ç½²æµ‹è¯•ã€‚<br><br><br>é¦–é€‰æ–¹æ¡ˆæ˜¯å°†æ•´ä¸ªé¡¹ç›®ä¸Šä¼ åˆ°GitHubä¸­ï¼Œéšååœ¨æœåŠ¡å™¨ä¸­ç›´æ¥wgetï¼Œä½†æ˜¯æ¨¡å‹æ–‡ä»¶è¿‡å¤§ï¼ŒGitHubå•ä¸ªæ–‡ä»¶çš„é™åˆ¶æ˜¯100MBã€‚<br><br><br>çªç„¶æƒ³åˆ°å¯ä¸å¯ä»¥ç›´æ¥ä»Google Driveä¸Šè¿›è¡Œä¸‹è½½æ¨¡å‹æ–‡ä»¶åˆ°æœåŠ¡å™¨ğŸ˜…<br><br><br><strong>ä¸‹è½½å°æ–‡ä»¶ï¼š</strong><br><br><br>é€‰æ‹©è¦ä¸‹è½½çš„æ–‡ä»¶å³é”®<br><br><br>ç‚¹å‡»â€œå…±äº«â€<br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1590598566164-b176f9b4-62bf-41d6-82bf-36e8837816f6.png#align=left&display=inline&height=1066&margin=%5Bobject%20Object%5D&name=%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202020-05-28%20%E4%B8%8A%E5%8D%8812.51.36.png&originHeight=1066&originWidth=1712&size=193930&status=done&style=none&width=1712" alt="å±å¹•å¿«ç…§ 2020-05-28 ä¸Šåˆ12.51.36.png"><br><br><br><br><br>ç‚¹å‡»â€œæ›´æ”¹â€ï¼Œè®¾ç½®åˆ†äº«æƒé™<br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1590598584015-3b9be292-6dd3-4edc-86ef-de50b58be55b.png#align=left&display=inline&height=1088&margin=%5Bobject%20Object%5D&name=%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202020-05-28%20%E4%B8%8A%E5%8D%8812.52.08.png&originHeight=1088&originWidth=2036&size=141068&status=done&style=none&width=2036" alt="å±å¹•å¿«ç…§ 2020-05-28 ä¸Šåˆ12.52.08.png"><br><br><br>è¿™æ˜¯å¤åˆ¶å›¾ä¸­é€‰ä¸­éƒ¨åˆ†çš„ID<br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1590598604200-c2f98348-2daf-423b-9792-df03ad395236.png#align=left&display=inline&height=1078&margin=%5Bobject%20Object%5D&name=%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202020-05-28%20%E4%B8%8A%E5%8D%8812.53.24.png&originHeight=1078&originWidth=1858&size=172147&status=done&style=none&width=1858" alt="å±å¹•å¿«ç…§ 2020-05-28 ä¸Šåˆ12.53.24.png"><br><br><br>æ‹¼æ¥ä¸‹è½½é“¾æ¥ï¼Œè¿›è¡Œä¸‹è½½<br><br><br>wget <a href="https://drive.google.com/uc?id=1sT6GvdtCG3AnV-62beWCP6LNdtFgmX-o" target="_blank" rel="external nofollow noopener noreferrer">https://drive.google.com/uc?id=</a>å¤åˆ¶ä¸‹æ¥çš„å…±äº«id -O your_file_name</p><p><strong>ä¸‹è½½å¤§æ–‡ä»¶ï¼š</strong></p><p>ä¸Šé¢çš„æ–¹æ³•ï¼Œé€‚åˆä¸‹è½½ä¸€äº›å°æ–‡ä»¶ï¼Œå¤§æ–‡ä»¶å°±ä¸å¯ä»¥äº†ã€‚æ›´æ¢ä¸‹é¢å‘½ä»¤çš„idé€‰é¡¹ï¼Œå¹¶ä¸”å‡†å¤‡å¥½cookies.txt<br><br><br>å…³äºcookies.txtï¼Œå¯ä»¥åœ¨Chromeæµè§ˆå™¨ä¸­ä¸‹è½½cookie.txtè¿™ä¸ªæ’ä»¶ï¼Œç‚¹å‡»ä¸‹è½½ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸­/tmpç›®å½•ä¸‹å³å¯<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1590678181832-6ba38a09-0ea7-4d48-a6a3-5cd116d19e1d.png#align=left&display=inline&height=1472&margin=%5Bobject%20Object%5D&name=%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202020-05-28%20%E4%B8%8B%E5%8D%8810.59.19.png&originHeight=1472&originWidth=3094&size=893365&status=done&style=none&width=3094" alt="å±å¹•å¿«ç…§ 2020-05-28 ä¸‹åˆ10.59.19.png"><br><br><br>å…³äºæ–‡ä»¶idï¼Œå’Œä¸Šé¢æ–¹æ³•è·å–ä¸€è‡´ï¼Œæ¥ä¸‹æ¥è¿è¡Œä¸‹é¢å‘½ä»¤å³å¯ã€‚<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --load-cookies /tmp/cookies.txt "https://docs.google.com/uc?export=download&amp;confirm=$(wget --quiet --save-cookies /tmp/cookies.txt --keep-session-cookies --no-check-certificate 'https://docs.google.com/uc?export=download&amp;id=15q9WdqjpZKiVXUo7FOII7O2WLxZag' -O- | sed -rn 's/.*confirm=([0-9A-Za-z_]+).*/\1\n/p')&amp;id=15q9WdqjpZKiVXUo7FOII7O2WLxZagARe" -O pytorch_model.bin</span><br></pre></td></tr></table></figure><br><br><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;åœ¨Google Colabä¸­è®­ç»ƒå®Œæ¨¡å‹ï¼Œä¿å­˜åœ¨Google Driveä¸­ï¼Œæ•´ä¸ªé¡¹ç›®å¤§å°æœ‰3ã€4GBå¤§å°ï¼Œæ­¤æ—¶æƒ³å°†è¿™æ•´ä¸ªé¡¹ç›®æ”¾åˆ°æœåŠ¡å™¨ä¸­è¿›è¡Œéƒ¨ç½²æµ‹
      
    
    </summary>
    
    
      <category term="Tools" scheme="cpeixin.cn/categories/Tools/"/>
    
    
  </entry>
  
  <entry>
    <title>def neverGrowUp()</title>
    <link href="cpeixin.cn/2020/04/06/def-neverGrowUp/"/>
    <id>cpeixin.cn/2020/04/06/def-neverGrowUp/</id>
    <published>2020-04-05T16:00:00.000Z</published>
    <updated>2020-04-05T15:10:24.541Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">neverGrowUp</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">while</span> <span class="title">true</span>:</span></span><br><span class="line">å¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒ</span><br><span class="line">å¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒ</span><br><span class="line">å¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒ</span><br><span class="line">å¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒ</span><br><span class="line">å¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒ</span><br><span class="line">å¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒ</span><br><span class="line">å¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒ</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span c
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>æŠ—ç–«è‹±é›„</title>
    <link href="cpeixin.cn/2020/04/04/%E6%8A%97%E7%96%AB%E8%8B%B1%E9%9B%84/"/>
    <id>cpeixin.cn/2020/04/04/%E6%8A%97%E7%96%AB%E8%8B%B1%E9%9B%84/</id>
    <published>2020-04-04T14:45:15.000Z</published>
    <updated>2020-04-05T14:46:33.308Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><p>è‡´æ•¬ç¼…æ€€æ¯ä¸€ä½æŠ—ç–«è‹±é›„<br><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/1072113/1586098032229-b4c6c795-bf87-4105-8f82-87a86e48a89a.jpeg#align=left&display=inline&height=1796&name=WechatIMG86.jpeg&originHeight=1796&originWidth=1072&size=175464&status=done&style=none&width=1072" alt="WechatIMG86.jpeg"></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;è‡´æ•¬ç¼…æ€€æ¯ä¸€ä½æŠ—ç–«è‹±é›„&lt;br&gt;&lt;img src=&quot;https://cdn.nlark.com/yuque/0/2020/jpeg/1072113
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>python Flask &amp; Ajax æ•°æ®ä¼ è¾“</title>
    <link href="cpeixin.cn/2020/03/11/python-Flask-Ajax-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93/"/>
    <id>cpeixin.cn/2020/03/11/python-Flask-Ajax-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93/</id>
    <published>2020-03-11T14:43:01.000Z</published>
    <updated>2020-04-04T17:13:00.080Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><p>å¸®æœ‹å‹å†™ä¸ªå°å·¥å…·ï¼Œæ²¡æƒ³åˆ°è¿˜è¦æå®šJSï¼Œå¤§å­¦æ¯•ä¸šåå°±æ²¡æœ‰å†™è¿‡JSï¼ŒçœŸçš„æ˜¯éš¾ä¸ºæˆ‘äº†ğŸ˜‚</p><p>å¿™æ´»ä¸‰ä¸ªå°æ—¶ï¼Œç»ˆäºæŠŠå‰ç«¯å’Œåç«¯æ‰“é€šäº†ï½ï½</p><p>å‰ç«¯demoï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å‘é€æ•°æ®ï¼Œè¡¨å•æ–¹å¼ ï¼ˆæ³¨æ„ï¼šåç«¯æ¥æ”¶æ•°æ®å¯¹åº”ä»£ç ä¸åŒï¼‰--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"&#123;&#123; url_for('send_message') &#125;&#125;"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span> =<span class="string">"domain"</span> <span class="attr">rows</span>=<span class="string">"30"</span> <span class="attr">cols</span>=<span class="string">"100"</span> <span class="attr">placeholder</span>=<span class="string">"è¯·è¾“å…¥éœ€è¦æŸ¥è¯¢çš„åŸŸå,å¦‚cq5999.com"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;input id="submit" type="submit" value="å‘é€"&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">id</span>=<span class="string">"btn-bq"</span> <span class="attr">data-toggle</span>=<span class="string">"modal"</span> <span class="attr">data-target</span>=<span class="string">"#myModal"</span>&gt;</span>æŸ¥è¯¢<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å‘é€æ•°æ®ï¼Œinputæ–¹å¼ ï¼ˆæ³¨æ„ï¼šåç«¯æ¥æ”¶æ•°æ®å¯¹åº”ä»£ç ä¸åŒï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"send_content"</span>&gt;</span>å‘åå°å‘é€æ¶ˆæ¯ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"send_content"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"send_content"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"send"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"å‘é€"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"recv_content"</span>&gt;</span>ä»åå°æ¥æ”¶æ¶ˆæ¯ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"recv_content"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"recv_content"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- inputæ–¹å¼ å¯¹åº”çš„jsä»£ç ï¼Œå¦‚ç”¨è¡¨å•æ–¹å¼è¯·æ³¨é‡Šæ‰ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å‘é€ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="string">"#send"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> message = $(<span class="string">"#send_content"</span>).val()</span></span><br><span class="line">        alert(message)</span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="actionscript">            url:<span class="string">"/send_message"</span>,</span></span><br><span class="line"><span class="actionscript">            type:<span class="string">"POST"</span>,</span></span><br><span class="line">            data:&#123;</span><br><span class="line">                message:message</span><br><span class="line">            &#125;,</span><br><span class="line"><span class="actionscript">            dataType: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="actionscript">            success:<span class="function"><span class="keyword">function</span> <span class="params">(data)</span> </span>&#123;</span></span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æ¥æ”¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="string">"#send"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $.getJSON(<span class="string">"/change_to_json"</span>,<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#recv_content"</span>).val(data.message) <span class="comment">//å°†åç«¯æ•°æ®æ˜¾ç¤ºåœ¨å‰ç«¯</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">"ä¼ åˆ°å‰ç«¯çš„æ•°æ®çš„ç±»å‹ï¼š"</span> + <span class="keyword">typeof</span> (data.message))</span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#send_content"</span>).val(<span class="string">""</span>)<span class="comment">//å‘é€çš„è¾“å…¥æ¡†æ¸…ç©º</span></span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åç«¯demo:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, jsonify</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"index_v6.html"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/send_message', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_message</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> message_get</span><br><span class="line">    message_get = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">    message_get = request.form[<span class="string">"domain"</span>].split(<span class="string">'\n'</span>)</span><br><span class="line">    <span class="comment"># message_get = request.form['message'] #inputæäº¤</span></span><br><span class="line">    print(<span class="string">"æ”¶åˆ°å‰ç«¯å‘è¿‡æ¥çš„ä¿¡æ¯ï¼š%s"</span> % message_get)</span><br><span class="line">    print(<span class="string">"æ”¶åˆ°æ•°æ®çš„ç±»å‹ä¸ºï¼š"</span> + str(type(message_get)))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"æ”¶åˆ°æ¶ˆæ¯"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/change_to_json', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_to_json</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">global</span> message_get</span><br><span class="line">    message_json = &#123;</span><br><span class="line">        <span class="string">"message"</span>: message_get</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonify(message_json)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">80</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;å¸®æœ‹å‹å†™ä¸ªå°å·¥å…·ï¼Œæ²¡æƒ³åˆ°è¿˜è¦æå®šJSï¼Œå¤§å­¦æ¯•ä¸šåå°±æ²¡æœ‰å†™è¿‡JSï¼ŒçœŸçš„æ˜¯éš¾ä¸ºæˆ‘äº†ğŸ˜‚&lt;/p&gt;&lt;p&gt;å¿™æ´»ä¸‰ä¸ªå°æ—¶ï¼Œç»ˆäºæŠŠå‰ç«¯å’Œåç«¯æ‰“é€šäº†ï½ï½&lt;/p&gt;
      
    
    </summary>
    
    
      <category term="python" scheme="cpeixin.cn/categories/python/"/>
    
    
      <category term="flask" scheme="cpeixin.cn/tags/flask/"/>
    
  </entry>
  
  <entry>
    <title>Python Flaskæ¥å£è®¾è®¡-ç¤ºä¾‹</title>
    <link href="cpeixin.cn/2020/03/10/Python-Flask%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-%E7%A4%BA%E4%BE%8B/"/>
    <id>cpeixin.cn/2020/03/10/Python-Flask%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-%E7%A4%BA%E4%BE%8B/</id>
    <published>2020-03-10T15:08:35.000Z</published>
    <updated>2020-04-04T17:12:52.356Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><p><a name="LHF1q"></a></p><h3 id="Get-è¯·æ±‚"><a href="#Get-è¯·æ±‚" class="headerlink" title="Get è¯·æ±‚"></a>Get è¯·æ±‚</h3><p><strong><strong>å¼€å‘ä¸€ä¸ªåªæ¥å—getæ–¹æ³•çš„æ¥å£ï¼Œæ¥å—å‚æ•°ä¸ºnameå’Œageï¼Œå¹¶è¿”å›ç›¸åº”å†…å®¹ã€‚</strong></strong><br><strong><br>**</strong>æ–¹æ³• 1:****</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> redirect</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> jsonify</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/test_1.0", methods=["GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="comment"># é»˜è®¤è¿”å›å†…å®¹</span></span><br><span class="line">  return_dict = &#123;<span class="string">'return_code'</span>: <span class="string">'200'</span>, <span class="string">'return_info'</span>: <span class="string">'å¤„ç†æˆåŠŸ'</span>, <span class="string">'result'</span>: <span class="literal">False</span>&#125;</span><br><span class="line">  <span class="comment"># åˆ¤æ–­å…¥å‚æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">  <span class="keyword">if</span> request.args <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    return_dict[<span class="string">'return_code'</span>] = <span class="string">'5004'</span></span><br><span class="line">    return_dict[<span class="string">'return_info'</span>] = <span class="string">'è¯·æ±‚å‚æ•°ä¸ºç©º'</span></span><br><span class="line">    <span class="keyword">return</span> json.dumps(return_dict, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">  <span class="comment"># è·å–ä¼ å…¥çš„paramså‚æ•°</span></span><br><span class="line">  get_data = request.args.to_dict()</span><br><span class="line">  name = get_data.get(<span class="string">'name'</span>)</span><br><span class="line">  age = get_data.get(<span class="string">'age'</span>)</span><br><span class="line">  <span class="comment"># å¯¹å‚æ•°è¿›è¡Œæ“ä½œ</span></span><br><span class="line">  return_dict[<span class="string">'result'</span>] = tt(name, age)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> json.dumps(return_dict, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠŸèƒ½å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tt</span><span class="params">(name, age)</span>:</span></span><br><span class="line">  result_str = <span class="string">"%sä»Šå¹´%så²"</span> % (name, age)</span><br><span class="line">  <span class="keyword">return</span> result_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>æ­¤ç§æ–¹å¼å¯¹åº”çš„requestè¯·æ±‚æ–¹å¼ï¼š</p><ol><li>æ‹¼æ¥è¯·æ±‚é“¾æ¥, ç›´æ¥è¯·æ±‚ï¼š<a href="http://0.0.0.0/test_1.0?name=ccc&age=18" target="_blank" rel="external nofollow noopener noreferrer">http://0.0.0.0/test_1.0?name=ccc&amp;age=18</a></li><li>request è¯·æ±‚ä¸­å¸¦æœ‰å‚æ•°ï¼Œå¦‚ä¸‹å›¾</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1583826674613-bc99538a-988e-4386-b8e6-9eb9fce1862f.png#align=left&display=inline&height=610&name=%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202020-03-10%20%E4%B8%8B%E5%8D%883.47.43.png&originHeight=610&originWidth=1424&size=98593&status=done&style=none&width=1424" alt="å±å¹•å¿«ç…§ 2020-03-10 ä¸‹åˆ3.47.43.png"></p><p>æ–¹æ³• 2:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/api/banWordSingle/&lt;string:word&gt;', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">banWordSingleStart</span><span class="params">(word)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> getWordStatus(word)</span><br></pre></td></tr></table></figure><p>æ­¤æ–¹æ³• ä¸ æ–¹æ³• 1 ä¸­çš„æ‹¼æ¥é“¾æ¥ç›¸ä¼¼ï¼Œä½†æ˜¯ä¸ç”¨è¾“å…¥å…³é”®å­—</p><p>è¯·æ±‚é“¾æ¥ï¼š<a href="http://0.0.0.0/test_1.0?name=ccc&age=18" target="_blank" rel="external nofollow noopener noreferrer">http://0.0.0.0</a>/api/banWordSingle/è¾“å…¥è¯</p><p><a name="vJdOc"></a></p><h3 id="Post-è¯·æ±‚"><a href="#Post-è¯·æ±‚" class="headerlink" title="Post è¯·æ±‚"></a>Post è¯·æ±‚</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> redirect</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> jsonify</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/test_1.0", methods=["POST"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="comment"># é»˜è®¤è¿”å›å†…å®¹</span></span><br><span class="line">  return_dict = &#123;<span class="string">'return_code'</span>: <span class="string">'200'</span>, <span class="string">'return_info'</span>: <span class="string">'å¤„ç†æˆåŠŸ'</span>, <span class="string">'result'</span>: <span class="literal">False</span>&#125;</span><br><span class="line">  <span class="comment"># åˆ¤æ–­å…¥å‚æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">  <span class="keyword">if</span> request.args <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    return_dict[<span class="string">'return_code'</span>] = <span class="string">'5004'</span></span><br><span class="line">    return_dict[<span class="string">'return_info'</span>] = <span class="string">'è¯·æ±‚å‚æ•°ä¸ºç©º'</span></span><br><span class="line">    <span class="keyword">return</span> json.dumps(return_dict, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">  <span class="comment"># è·å–ä¼ å…¥çš„paramså‚æ•°</span></span><br><span class="line">  get_data = request.args.to_dict()</span><br><span class="line">  name = get_data.get(<span class="string">'name'</span>)</span><br><span class="line">  age = get_data.get(<span class="string">'age'</span>)</span><br><span class="line">  <span class="comment"># å¯¹å‚æ•°è¿›è¡Œæ“ä½œ</span></span><br><span class="line">  return_dict[<span class="string">'result'</span>] = tt(name, age)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> json.dumps(return_dict, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠŸèƒ½å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tt</span><span class="params">(name, age)</span>:</span></span><br><span class="line">  result_str = <span class="string">"%sä»Šå¹´%så²"</span> % (name, age)</span><br><span class="line">  <span class="keyword">return</span> result_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure><p>è¯·æ±‚æ–¹å¼ï¼š</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1583831085097-3a858ae4-259d-408d-a162-6a4ed8c5e291.png#align=left&display=inline&height=692&name=%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202020-03-10%20%E4%B8%8B%E5%8D%885.00.28.png&originHeight=692&originWidth=1438&size=99272&status=done&style=none&width=1438" alt="å±å¹•å¿«ç…§ 2020-03-10 ä¸‹åˆ5.00.28.png"></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;&lt;a name=&quot;LHF1q&quot;&gt;&lt;/a&gt;&lt;/p&gt;&lt;h3 id=&quot;Get-è¯·æ±‚&quot;&gt;&lt;a href=&quot;#Get-è¯·æ±‚&quot; class=&quot;headerl
      
    
    </summary>
    
    
      <category term="python" scheme="cpeixin.cn/categories/python/"/>
    
    
      <category term="flask" scheme="cpeixin.cn/tags/flask/"/>
    
  </entry>
  
  <entry>
    <title>Flink 1.10ç‰ˆæœ¬å‘å¸ƒ</title>
    <link href="cpeixin.cn/2020/02/13/Flink-1-10%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/"/>
    <id>cpeixin.cn/2020/02/13/Flink-1-10%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/</id>
    <published>2020-02-12T17:22:22.000Z</published>
    <updated>2020-06-03T14:38:01.179Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><p><br>Apache Flinkç¤¾åŒºå¾ˆé«˜å…´èƒ½è¾¾åˆ°ä¸¤ä½æ•°å¹¶å®£å¸ƒå‘å¸ƒFlink 1.10.0ï¼ç”±äºè¿„ä»Šä¸ºæ­¢ç¤¾åŒºæœ€å¤§çš„åŠªåŠ›ï¼Œå·²å®æ–½äº†1.2kä¸ªé—®é¢˜ï¼Œè´¡çŒ®äº†200å¤šä¸ªè´¡çŒ®è€…ï¼Œæ­¤ç‰ˆæœ¬å¼•å…¥äº†å¯¹Flinkä½œä¸šçš„æ•´ä½“æ€§èƒ½å’Œç¨³å®šæ€§çš„é‡å¤§æ”¹è¿›ï¼ŒåŸç”ŸKubernetesé›†æˆçš„é¢„è§ˆä»¥åŠPythonæ”¯æŒçš„å·¨å¤§è¿›æ­¥ï¼ˆPyFlinkï¼‰ã€‚(Sparkå¯¹Pythonçš„æ”¯æŒä¹Ÿè¶Šæ¥è¶Šå¥½ğŸ˜‚)<br><br><br>Flink 1.10è¿˜æ ‡å¿—ç€<a href="https://flink.apache.org/news/2019/08/22/release-1.9.0.html#preview-of-the-new-blink-sql-query-processor" target="_blank" rel="external nofollow noopener noreferrer">Blinké›†æˆ</a>çš„å®Œæˆï¼Œå¼ºåŒ–äº†æµæ•°æ®SQLå¹¶é€šè¿‡å¯ç”¨äºç”Ÿäº§çš„Hiveé›†æˆå’ŒTPC-DSè¦†ç›–å°†æˆç†Ÿçš„æ‰¹å¤„ç†å¼•å…¥Flinkã€‚è¿™ç¯‡åšå®¢æ–‡ç« æè¿°äº†æ‰€æœ‰ä¸»è¦çš„æ–°åŠŸèƒ½å’Œæ”¹è¿›ï¼Œéœ€è¦æ³¨æ„çš„é‡è¦æ›´æ”¹ä»¥åŠé¢„æœŸçš„å‘å±•ã€‚<br><br><br>ç°åœ¨å¯ä»¥åœ¨Flinkç½‘ç«™çš„æ›´æ–°çš„â€œ <a href="https://flink.apache.org/downloads.html" target="_blank" rel="external nofollow noopener noreferrer">ä¸‹è½½â€é¡µé¢</a>ä¸Šæ‰¾åˆ°äºŒè¿›åˆ¶åˆ†å‘æ–‡ä»¶å’Œæºå·¥ä»¶ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹å®Œæ•´çš„<a href="https://issues.apache.org/jira/secure/ReleaseNote.jspa?projectId=12315522&version=12345845" target="_blank" rel="external nofollow noopener noreferrer">å‘è¡Œå˜æ›´æ—¥å¿—</a>å’Œ<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/" target="_blank" rel="external nofollow noopener noreferrer">æ›´æ–°çš„æ–‡æ¡£</a>ã€‚æˆ‘ä»¬é¼“åŠ±æ‚¨ä¸‹è½½å‘è¡Œç‰ˆï¼Œå¹¶é€šè¿‡<a href="https://flink.apache.org/community.html#mailing-lists" target="_blank" rel="external nofollow noopener noreferrer">Flinké‚®ä»¶åˆ—è¡¨</a>æˆ–<a href="https://issues.apache.org/jira/projects/FLINK/summary" target="_blank" rel="external nofollow noopener noreferrer">JIRA</a>ä¸ç¤¾åŒºåˆ†äº«æ‚¨çš„åé¦ˆã€‚</p><hr><p><a name="JxUa7"></a></p><h2 id="æ–°åŠŸèƒ½å’Œæ”¹è¿›"><a href="#æ–°åŠŸèƒ½å’Œæ”¹è¿›" class="headerlink" title="æ–°åŠŸèƒ½å’Œæ”¹è¿›"></a>æ–°åŠŸèƒ½å’Œæ”¹è¿›</h2><p><a name="improved-memory-management-and-configuration"></a></p><h3><a href="#" class="headerlink"></a></h3><p><a name="ze04S"></a></p><h3 id="æ”¹è¿›çš„å†…å­˜ç®¡ç†å’Œé…ç½®"><a href="#æ”¹è¿›çš„å†…å­˜ç®¡ç†å’Œé…ç½®" class="headerlink" title="æ”¹è¿›çš„å†…å­˜ç®¡ç†å’Œé…ç½®"></a>æ”¹è¿›çš„å†…å­˜ç®¡ç†å’Œé…ç½®</h3><p><br>ç›®å‰Flinkä¸­çš„TaskExecutorå†…å­˜é…ç½®å­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼Œè¿™äº›ç¼ºç‚¹ä½¿å¾—éš¾ä»¥æ¨ç†æˆ–ä¼˜åŒ–èµ„æºåˆ©ç”¨ç‡ï¼Œä¾‹å¦‚ï¼š</p><ul><li>æµå¤„ç†å’Œæ‰¹å¤„ç†æ‰§è¡Œä¸­ç”¨äºå†…å­˜å ç”¨çš„ä¸åŒé…ç½®æ¨¡å‹ï¼›<br></li><li>æµå¤„ç†æ‰§è¡Œä¸­å †å¤–çŠ¶æ€åç«¯ï¼ˆå³RocksDBï¼‰çš„å¤æ‚ä¸”ä¾èµ–ç”¨æˆ·çš„é…ç½®ã€‚<br></li></ul><p><br>ä¸ºäº†ä½¿å†…å­˜é€‰é¡¹å¯¹ç”¨æˆ·æ›´æ˜ç¡®å’Œç›´è§‚ï¼ŒFlink 1.10å¯¹TaskExecutorå†…å­˜æ¨¡å‹å’Œé…ç½®é€»è¾‘ï¼ˆ<a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-49%3A+Unified+Memory+Configuration+for+TaskExecutors" target="_blank" rel="external nofollow noopener noreferrer">FLIP-49</a>ï¼‰è¿›è¡Œäº†é‡å¤§æ›´æ”¹ã€‚è¿™äº›æ›´æ”¹ä½¿Flinkæ›´é€‚åˆäºå„ç§éƒ¨ç½²ç¯å¢ƒï¼ˆä¾‹å¦‚Kubernetesï¼ŒYarnï¼ŒMesosï¼‰ï¼Œä»è€Œä½¿ç”¨æˆ·å¯ä»¥ä¸¥æ ¼æ§åˆ¶å…¶å†…å­˜æ¶ˆè€—ã€‚<br><br><br><strong>æ‰˜ç®¡å†…å­˜æ‰©å±•</strong><br><br><br>æ‰˜ç®¡å†…å­˜å·²ç»æ‰©å±•æ‰©å±•ï¼Œå½“ç„¶è¿˜è€ƒè™‘äº†RocksDB StateBackendçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚è™½ç„¶æ‰¹å¤„ç†ä½œä¸šå¯ä»¥ä½¿ç”¨å †å†…ï¼ˆon-heapï¼‰æˆ–å †å¤–ï¼ˆoff-heapï¼‰å†…å­˜ï¼Œä½†å…·æœ‰è¿™äº›åŠŸèƒ½çš„æµä½œä¸šRocksDBStateBackendåªèƒ½ä½¿ç”¨å †å†…å†…å­˜ã€‚å› æ­¤ï¼Œä¸ºäº†å…è®¸ç”¨æˆ·åœ¨æµæ‰§è¡Œå’Œæ‰¹å¤„ç†æ‰§è¡Œä¹‹é—´åˆ‡æ¢è€Œä¸å¿…ä¿®æ”¹ç¾¤é›†é…ç½®ï¼Œæ‰˜ç®¡å†…å­˜ç°åœ¨å§‹ç»ˆå¤„äºå †å¤–çŠ¶æ€ã€‚<br><br><br><strong>ç®€åŒ–RocksDBé…ç½®</strong><br>**<br>æ›¾ç»é…ç½®åƒRocksDBè¿™æ ·çš„off-heap (å †å¤–)state backendæ¶‰åŠå¤§é‡çš„æ‰‹åŠ¨è°ƒæ•´ï¼Œä¾‹å¦‚å‡å°JVMå †å¤§å°æˆ–å°†Flinkè®¾ç½®ä¸ºä½¿ç”¨å †å¤–å†…å­˜ã€‚ç°åœ¨å¯ä»¥é€šè¿‡Flinkçš„ç°æˆé…ç½®æ¥å®ç°ï¼Œå¹¶ä¸”è°ƒæ•´RocksDBStateBackendå†…å­˜é¢„ç®—å°±åƒè°ƒæ•´å†…å­˜å¤§å°ä¸€æ ·ç®€å•ã€‚<br><br><br>å¦ä¸€ä¸ªé‡è¦çš„æ”¹è¿›æ˜¯å…è®¸Flinkç»‘å®šRocksDBæœ¬åœ°å†…å­˜ä½¿ç”¨æƒ…å†µï¼ˆ<a href="https://issues.apache.org/jira/browse/FLINK-7289" target="_blank" rel="external nofollow noopener noreferrer">FLINK-7289</a>ï¼‰ï¼Œä»è€Œé˜²æ­¢å…¶è¶…å‡ºæ€»å†…å­˜é¢„ç®—-è¿™åœ¨Kubernetesç­‰å®¹å™¨åŒ–ç¯å¢ƒä¸­å°¤å…¶é‡è¦ã€‚æœ‰å…³å¦‚ä½•å¯ç”¨å’Œè°ƒæ•´æ­¤åŠŸèƒ½çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/ops/state/large_state_tuning.html#tuning-rocksdb" target="_blank" rel="external nofollow noopener noreferrer">Tuning RocksDB</a>ã€‚<br>æ³¨æ„ FLIP-49æ›´æ”¹äº†ç¾¤é›†èµ„æºé…ç½®çš„è¿‡ç¨‹ï¼Œè¿™å¯èƒ½éœ€è¦è°ƒæ•´ç¾¤é›†ä»¥ä»ä»¥å‰çš„Flinkç‰ˆæœ¬è¿›è¡Œå‡çº§ã€‚æœ‰å…³æ‰€å¼•å…¥æ›´æ”¹å’Œè°ƒæ•´æŒ‡å—çš„å…¨é¢æ¦‚è¿°ï¼Œè¯·å‚é˜…<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/ops/memory/mem_setup.html" target="_blank" rel="external nofollow noopener noreferrer">æ­¤è®¾ç½®</a>ã€‚<br></p><p><a name="unified-logic-for-job-submission"></a></p><h3 id="æäº¤ä½œä¸šçš„ç»Ÿä¸€é€»è¾‘"><a href="#æäº¤ä½œä¸šçš„ç»Ÿä¸€é€»è¾‘" class="headerlink" title="æäº¤ä½œä¸šçš„ç»Ÿä¸€é€»è¾‘"></a>æäº¤ä½œä¸šçš„ç»Ÿä¸€é€»è¾‘</h3><p><br>åœ¨æ­¤ç‰ˆæœ¬ä¹‹å‰ï¼Œæäº¤ä½œä¸šæ˜¯æ‰§è¡Œç¯å¢ƒçš„ä¸€éƒ¨åˆ†èŒè´£ï¼Œå¹¶ä¸”ä¸ä¸åŒçš„éƒ¨ç½²ç›®æ ‡ï¼ˆä¾‹å¦‚ï¼ŒYarnï¼ŒKubernetesï¼ŒMesosï¼‰ç´§å¯†ç›¸å…³ã€‚è¿™å¯¼è‡´å…³æ³¨ç‚¹åˆ†ç¦»ä¸ä½³ï¼Œå¹¶ä¸”éšç€æ—¶é—´çš„æµé€ï¼Œç”¨æˆ·éœ€è¦å•ç‹¬é…ç½®å’Œç®¡ç†çš„å®šåˆ¶ç¯å¢ƒè¶Šæ¥è¶Šå¤šã€‚<br><br><br>åœ¨Flink 1.10ä¸­ï¼Œä½œä¸šæäº¤é€»è¾‘è¢«æŠ½è±¡åˆ°é€šç”¨Executoræ¥å£ï¼ˆ<a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-73%3A+Introducing+Executors+for+job+submission" target="_blank" rel="external nofollow noopener noreferrer">FLIP-73</a>ï¼‰ä¸­ã€‚å¦å¤–ExecutorCLIï¼ˆ<a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=133631524" target="_blank" rel="external nofollow noopener noreferrer">FLIP-81</a>ï¼‰å¼•å…¥äº†ä¸€ä¸ªç»Ÿä¸€çš„æ–¹å¼å»æŒ‡å®šé…ç½®å‚æ•°å¯¹äºä»»ä½• <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/ops/cli.html#deployment-targets" target="_blank" rel="external nofollow noopener noreferrer">æ‰§è¡Œå¯¹è±¡</a>ã€‚ä¸ºäº†å®Œå–„è¿™é¡¹å·¥ä½œï¼Œç»“æœæ£€ç´¢çš„è¿‡ç¨‹ä¹Ÿä¸ä½œä¸šæäº¤åˆ†ç¦»ï¼Œå¼•å…¥äº†JobClientï¼ˆ<a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-74%3A+Flink+JobClient+API" target="_blank" rel="external nofollow noopener noreferrer">FLINK-74</a>ï¼‰æ¥è´Ÿè´£è·å–JobExecutionResultã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1590943394674-2fd89b17-b61e-4180-986d-72062c95f4d4.png#align=left&display=inline&height=334&margin=%5Bobject%20Object%5D&originHeight=789&originWidth=1999&size=0&status=done&style=none&width=847" alt><br><br><br>ç‰¹åˆ«æ˜¯ï¼Œè¿™äº›æ›´æ”¹é€šè¿‡ä¸ºç”¨æˆ·æä¾›Flinkçš„ç»Ÿä¸€å…¥å£ç‚¹ï¼Œä½¿åœ¨ä¸‹æ¸¸æ¡†æ¶ï¼ˆä¾‹å¦‚Apache Beamæˆ–Zeppelinäº¤äº’å¼ç¬”è®°æœ¬ï¼‰ä¸­ä»¥ç¼–ç¨‹æ–¹å¼ä½¿ç”¨Flinkå˜å¾—æ›´åŠ å®¹æ˜“ã€‚å¯¹äºè·¨å¤šä¸ªç›®æ ‡ç¯å¢ƒä½¿ç”¨Flinkçš„ç”¨æˆ·ï¼Œå‘åŸºäºé…ç½®çš„æ‰§è¡Œè¿‡ç¨‹çš„è¿‡æ¸¡è¿˜å¯ä»¥æ˜¾ç€å‡å°‘æ ·æ¿ä»£ç å’Œå¯ç»´æŠ¤æ€§å¼€é”€ã€‚<br></p><p><a name="native-kubernetes-integration-beta"></a></p><h3 id="åŸç”ŸKubernetesé›†æˆï¼ˆæµ‹è¯•ç‰ˆï¼‰"><a href="#åŸç”ŸKubernetesé›†æˆï¼ˆæµ‹è¯•ç‰ˆï¼‰" class="headerlink" title="åŸç”ŸKubernetesé›†æˆï¼ˆæµ‹è¯•ç‰ˆï¼‰"></a>åŸç”ŸKubernetesé›†æˆï¼ˆæµ‹è¯•ç‰ˆï¼‰</h3><p><br>å¯¹äºå¸Œæœ›åœ¨å®¹å™¨åŒ–ç¯å¢ƒä¸Šå¼€å§‹ä½¿ç”¨Flinkçš„ç”¨æˆ·ï¼Œåœ¨Kubernetesä¹‹ä¸Šéƒ¨ç½²å’Œç®¡ç†ç‹¬ç«‹é›†ç¾¤éœ€è¦æœ‰å…³å®¹å™¨ï¼Œç®—å­å’Œç¯å¢ƒå·¥å…·kubectlçš„ä¸€äº›çŸ¥è¯†ã€‚<br><br><br>åœ¨Flink 1.10ä¸­ï¼Œæˆ‘ä»¬æ¨å‡ºäº†Active Kubernetesé›†æˆï¼ˆ<a href="https://jira.apache.org/jira/browse/FLINK-9953" target="_blank" rel="external nofollow noopener noreferrer">FLINK-9953</a>ï¼‰çš„ç¬¬ä¸€é˜¶æ®µï¼Œå…¶ä¸­ï¼Œâ€œä¸»åŠ¨â€æŒ‡ Flink ResourceManager (K8sResMngr) åŸç”Ÿåœ°ä¸ Kubernetes é€šä¿¡ï¼Œåƒ Flink åœ¨ Yarn å’Œ Mesos ä¸Šä¸€æ ·æŒ‰éœ€ç”³è¯· podã€‚ç”¨æˆ·å¯ä»¥åˆ©ç”¨ namespaceï¼Œåœ¨å¤šç§Ÿæˆ·ç¯å¢ƒä¸­ä»¥è¾ƒå°‘çš„èµ„æºå¼€é”€å¯åŠ¨ Flinkã€‚è¿™éœ€è¦ç”¨æˆ·æå‰é…ç½®å¥½ RBAC è§’è‰²å’Œæœ‰è¶³å¤Ÿæƒé™çš„æœåŠ¡è´¦å·ã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1590943394177-de66ac47-ba2d-4182-b5b4-585ff643cfc8.png#align=left&display=inline&height=322&margin=%5Bobject%20Object%5D&originHeight=870&originWidth=1714&size=0&status=done&style=none&width=635" alt><br><br><br>æ­£å¦‚åˆšåˆšè®²åˆ°çš„ï¼ŒFlink 1.10ä¸­çš„æ‰€æœ‰å‘½ä»¤è¡Œé€‰é¡¹éƒ½æ˜ å°„åˆ°ç»Ÿä¸€é…ç½®ã€‚å› æ­¤ï¼Œç”¨æˆ·å¯ä»¥ç®€å•åœ°å¼•ç”¨Kubernetesé…ç½®é€‰é¡¹ï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨CLIä¸­å°†ä½œä¸šæäº¤åˆ°Kubernetesä¸Šçš„ç°æœ‰Flinkä¼šè¯ï¼š<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;bin&#x2F;flink run -d -e kubernetes-session -Dkubernetes.cluster-id&#x3D;&lt;ClusterId&gt; examples&#x2F;streaming&#x2F;WindowJoin.jar</span><br></pre></td></tr></table></figure><p><br>å¦‚æœæ‚¨æƒ³å°è¯•ä½¿ç”¨æ­¤é¢„è§ˆåŠŸèƒ½ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨é€æ­¥å®Œæˆæœ¬<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/ops/deployment/native_kubernetes.html" target="_blank" rel="external nofollow noopener noreferrer">æœºKubernetesçš„å®‰è£…</a>ï¼Œè¯•ç”¨å¹¶ä¸ç¤¾åŒºåˆ†äº«åé¦ˆã€‚<br></p><p><a name="table-apisql-production-ready-hive-integration"></a></p><h3 id="Table-API-SQLï¼šç”Ÿäº§å°±ç»ªçš„Hiveé›†æˆ"><a href="#Table-API-SQLï¼šç”Ÿäº§å°±ç»ªçš„Hiveé›†æˆ" class="headerlink" title="Table API / SQLï¼šç”Ÿäº§å°±ç»ªçš„Hiveé›†æˆ"></a>Table API / SQLï¼šç”Ÿäº§å°±ç»ªçš„Hiveé›†æˆ</h3><p><br>Hiveé›†æˆåœ¨Flink 1.9ä¸­å®£å¸ƒä¸ºé¢„è§ˆåŠŸèƒ½ã€‚æ­¤é¢„è§ˆå…è®¸ç”¨æˆ·ä½¿ç”¨SQL DDLå°†Flink-specificå…ƒæ•°æ®ï¼ˆä¾‹å¦‚Kafkaè¡¨ï¼‰ä¿ç•™åœ¨Hive Metastoreä¸­ï¼Œè°ƒç”¨Hiveä¸­å®šä¹‰çš„UDFå¹¶ä½¿ç”¨Flinkè¯»å–å’Œå†™å…¥Hiveè¡¨ã€‚Flink 1.10é€šè¿‡è¿›ä¸€æ­¥çš„å¼€å‘ä½¿è¿™é¡¹å·¥ä½œæ›´åŠ åœ†æ»¡ï¼Œè¿™äº›å¼€å‘ä½¿å¯ç«‹å³æŠ•å…¥ç”Ÿäº§çš„Hiveé›†æˆåˆ°Flinkï¼Œå¹¶å…·æœ‰ä¸<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/table/hive/#supported-hive-versions" target="_blank" rel="external nofollow noopener noreferrer">å¤§å¤šæ•°Hiveç‰ˆæœ¬çš„</a>å®Œå…¨å…¼å®¹æ€§ã€‚<br><a name="native-partition-support-for-batch-sql"></a></p><h4 id="-1"><a href="#-1" class="headerlink"></a></h4><p><a name="IuODz"></a></p><h4 id="æ‰¹å¤„ç†SQLçš„æœ¬åœ°åˆ†åŒºæ”¯æŒ"><a href="#æ‰¹å¤„ç†SQLçš„æœ¬åœ°åˆ†åŒºæ”¯æŒ" class="headerlink" title="æ‰¹å¤„ç†SQLçš„æœ¬åœ°åˆ†åŒºæ”¯æŒ"></a>æ‰¹å¤„ç†SQLçš„æœ¬åœ°åˆ†åŒºæ”¯æŒ</h4><p><br>1.10ç‰ˆæœ¬ä»¥å‰ï¼Œä»…æ”¯æŒå¯¹æœªåˆ†åŒºçš„Hiveè¡¨è¿›è¡Œå†™å…¥ã€‚åœ¨Flink 1.10ä¸­ï¼ŒFlink SQLè¯­æ³•å·²é€šè¿‡<code>INSERT OVERWRITE</code>å’Œ<code>PARTITION</code>ï¼ˆ<a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-63%3A+Rework+table+partition+support" target="_blank" rel="external nofollow noopener noreferrer">FLIP-63</a>ï¼‰è¿›è¡Œäº†æ‰©å±•ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿåœ¨Hiveä¸­å†™å…¥é™æ€å’ŒåŠ¨æ€åˆ†åŒºã€‚<br><strong><br></strong>é™æ€åˆ†åŒºå†™å…¥**</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT &#123; INTO | OVERWRITE &#125; TABLE tablename1 [PARTITION (partcol1&#x3D;val1, partcol2&#x3D;val2 ...)] select_statement1 FROM from_statement;</span><br></pre></td></tr></table></figure><p><strong><br></strong>åŠ¨æ€åˆ†åŒºç¼–å†™**</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT &#123; INTO | OVERWRITE &#125; TABLE tablename1 select_statement1 FROM from_statement;</span><br></pre></td></tr></table></figure><p><br>Flinkå¯¹äºåˆ†åŒºè¡¨çš„å…¨é¢æ”¯æŒï¼Œå…è®¸ç”¨æˆ·åˆ©ç”¨è¯»å–æ—¶çš„åˆ†åŒºä¿®å‰ªåŠŸèƒ½ï¼Œé€šè¿‡å‡å°‘éœ€è¦æ‰«æçš„æ•°æ®é‡æ¥æ˜¾ç€æé«˜è¿™äº›æ“ä½œçš„æ€§èƒ½ã€‚<br></p><p><a name="further-optimizations"></a></p><h4 id="è¿›ä¸€æ­¥ä¼˜åŒ–"><a href="#è¿›ä¸€æ­¥ä¼˜åŒ–" class="headerlink" title="è¿›ä¸€æ­¥ä¼˜åŒ–"></a>è¿›ä¸€æ­¥ä¼˜åŒ–</h4><p>é™¤äº†åˆ†åŒºä¿®å‰ªå¤–ï¼ŒFlink 1.10è¿˜ä¸ºHiveé›†æˆå¼•å…¥äº†æ›´å¤š<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/table/hive/read_write_hive.html#optimizations" target="_blank" rel="external nofollow noopener noreferrer">è¯»å–ä¼˜åŒ–</a>ï¼Œä¾‹å¦‚ï¼š<br></p><ul><li><strong>æŠ•å½±ä¸‹æ¨ï¼š</strong> Flinké€šè¿‡çœç•¥è¡¨æ‰«æä¸­ä¸å¿…è¦çš„å­—æ®µï¼Œåˆ©ç”¨æŠ•å½±ä¸‹æ¨æ¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘Flinkå’ŒHiveè¡¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€‚è¿™å¯¹äºå…·æœ‰å¤§é‡åˆ—çš„è¡¨å°¤å…¶æœ‰åˆ©ã€‚</li></ul><ul><li><strong>LIMITä¸‹æ¨ï¼š</strong>å¯¹äºå¸¦æœ‰<code>LIMIT</code>å­å¥çš„æŸ¥è¯¢ï¼ŒFlinkå°†å°½å¯èƒ½é™åˆ¶è¾“å‡ºè®°å½•çš„æ•°é‡ï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘é€šè¿‡ç½‘ç»œä¼ è¾“çš„æ•°æ®é‡ã€‚</li></ul><ul><li><strong>è¯»å–æ—¶</strong>è¿›è¡Œ<strong>ORCçŸ¢é‡åŒ–ï¼š</strong>ä¸ºäº†æé«˜ORCæ–‡ä»¶çš„è¯»å–æ€§èƒ½ï¼ŒFlinkç°åœ¨é»˜è®¤å°†æœ¬æœºORCçŸ¢é‡åŒ–é˜…è¯»å™¨ç”¨äº2.0.0ä»¥ä¸Šçš„Hiveç‰ˆæœ¬ä»¥åŠå…·æœ‰éå¤æ‚æ•°æ®ç±»å‹çš„åˆ—ã€‚</li></ul><p><a name="pluggable-modules-as-flink-system-objects-beta"></a></p><h4 id="å¯æ’æ‹”æ¨¡å—ä½œä¸ºFlinkç³»ç»Ÿå¯¹è±¡ï¼ˆBetaï¼‰"><a href="#å¯æ’æ‹”æ¨¡å—ä½œä¸ºFlinkç³»ç»Ÿå¯¹è±¡ï¼ˆBetaï¼‰" class="headerlink" title="å¯æ’æ‹”æ¨¡å—ä½œä¸ºFlinkç³»ç»Ÿå¯¹è±¡ï¼ˆBetaï¼‰"></a>å¯æ’æ‹”æ¨¡å—ä½œä¸ºFlinkç³»ç»Ÿå¯¹è±¡ï¼ˆBetaï¼‰</h4><p>Flink 1.10å¼•å…¥äº†Flink Tableæ ¸å¿ƒä¸­å¯æ’æ‹”æ¨¡å—çš„é€šç”¨æœºåˆ¶ï¼Œé¦–å…ˆå…³æ³¨ç³»ç»ŸåŠŸèƒ½ï¼ˆ<a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-68%3A+Extend+Core+Table+System+with+Pluggable+Modules" target="_blank" rel="external nofollow noopener noreferrer">FLIP-68</a>ï¼‰ã€‚ä½¿ç”¨è¯¥æ¨¡å—ï¼Œç”¨æˆ·å¯ä»¥æ‰©å±•Flinkçš„ç³»ç»Ÿå¯¹è±¡ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨è¡Œä¸ºç±»ä¼¼äºFlinkç³»ç»ŸåŠŸèƒ½çš„Hiveå†…ç½®å‡½æ•°ã€‚è¯¥ç‰ˆæœ¬é™„å¸¦ä¸€ä¸ªé¢„å…ˆå®ç°çš„<code>HiveModule</code>ï¼Œæ”¯æŒå¤šä¸ªHiveç‰ˆæœ¬çš„ç‰ˆæœ¬ï¼Œä½†ç”¨æˆ·ä¹Ÿå¯ä»¥<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/table/modules.html" target="_blank" rel="external nofollow noopener noreferrer">ç¼–å†™è‡ªå·±çš„å¯æ’æ‹”æ¨¡å—</a>ã€‚<br><a name="other-improvements-to-the-table-apisql"></a></p><h3 id="-2"><a href="#-2" class="headerlink"></a></h3><p><a name="rCuCf"></a></p><h3 id="Table-API-SQLçš„å…¶ä»–æ”¹è¿›"><a href="#Table-API-SQLçš„å…¶ä»–æ”¹è¿›" class="headerlink" title="Table API / SQLçš„å…¶ä»–æ”¹è¿›"></a>Table API / SQLçš„å…¶ä»–æ”¹è¿›</h3><p><a name="watermarks-and-computed-columns-in-sql-ddl"></a></p><h4 id="-3"><a href="#-3" class="headerlink"></a></h4><p><a name="FlcDT"></a></p><h4 id="SQL-DDLä¸­çš„æ°´å°å’Œè®¡ç®—åˆ—"><a href="#SQL-DDLä¸­çš„æ°´å°å’Œè®¡ç®—åˆ—" class="headerlink" title="SQL DDLä¸­çš„æ°´å°å’Œè®¡ç®—åˆ—"></a>SQL DDLä¸­çš„æ°´å°å’Œè®¡ç®—åˆ—</h4><p>Flink 1.10æ”¯æŒç‰¹å®šäºæµçš„è¯­æ³•æ‰©å±•ï¼Œä»¥åœ¨Flink SQL DDLï¼ˆ<a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-66%3A+Support+Time+Attribute+in+SQL+DDL" target="_blank" rel="external nofollow noopener noreferrer">FLIP-66</a>ï¼‰ä¸­å®šä¹‰æ—¶é—´å±æ€§å’Œæ°´å°ç”Ÿæˆã€‚è¿™å…è®¸åŸºäºæ—¶é—´çš„æ“ä½œï¼ˆä¾‹å¦‚åŠ çª—ï¼‰ï¼Œä»¥åŠåœ¨ä½¿ç”¨DDLè¯­å¥åˆ›å»ºçš„è¡¨ä¸Šå®šä¹‰<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/table/sql/create.html#create-table" target="_blank" rel="external nofollow noopener noreferrer">æ°´å°ç­–ç•¥</a>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE table_name (</span><br><span class="line">  WATERMARK FOR columnName AS &lt;watermark_strategy_expression&gt;</span><br><span class="line">) WITH (</span><br><span class="line">  ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><br>æ­¤ç‰ˆæœ¬è¿˜å¼•å…¥äº†å¯¹è™šæ‹Ÿè®¡ç®—åˆ—ï¼ˆ<a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-70%3A+Flink+SQL+Computed+Column+Design" target="_blank" rel="external nofollow noopener noreferrer">FLIP-70</a>ï¼‰çš„æ”¯æŒï¼Œè¯¥åˆ—å¯åŸºäºåŒä¸€è¡¨ä¸­çš„å…¶ä»–åˆ—æˆ–ç¡®å®šæ€§è¡¨è¾¾å¼ï¼ˆå³ï¼Œæ–‡å­—å€¼ï¼ŒUDFå’Œå†…ç½®å‡½æ•°ï¼‰æ´¾ç”Ÿã€‚åœ¨Flinkä¸­ï¼Œè®¡ç®—åˆ—å¯ç”¨äº<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/table/sql/create.html#create-table" target="_blank" rel="external nofollow noopener noreferrer">åœ¨åˆ›å»ºè¡¨æ—¶</a>å®šä¹‰æ—¶é—´å±æ€§ã€‚<br><a name="additional-extensions-to-sql-ddl"></a></p><h4 id="-4"><a href="#-4" class="headerlink"></a></h4><p><a name="Exz4X"></a></p><h4 id="SQL-DDLçš„å…¶ä»–æ‰©å±•"><a href="#SQL-DDLçš„å…¶ä»–æ‰©å±•" class="headerlink" title="SQL DDLçš„å…¶ä»–æ‰©å±•"></a>SQL DDLçš„å…¶ä»–æ‰©å±•</h4><p><br>ç°åœ¨ï¼Œtemporary/persistent å’Œ system/catalogï¼ˆ<a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-57%3A+Rework+FunctionCatalog" target="_blank" rel="external nofollow noopener noreferrer">FLIP-57</a>ï¼‰ä¹‹é—´æœ‰æ˜æ˜¾çš„åŒºåˆ«ã€‚è¿™ä¸ä»…æ¶ˆé™¤äº†å‡½æ•°å¼•ç”¨ä¸­çš„æ­§ä¹‰ï¼Œè€Œä¸”å…è®¸ç¡®å®šæ€§çš„å‡½æ•°è§£æé¡ºåºï¼ˆå³ï¼Œåœ¨å‘½åå†²çªçš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå‡½æ•°å°†ä¼˜å…ˆäºç›®å½•å‡½æ•°ï¼Œè€Œä¸´æ—¶å‡½æ•°çš„ä¼˜å…ˆçº§é«˜äºä¸¤ä¸ªç»´åº¦çš„æŒä¹…æ€§å‡½æ•°ï¼‰ã€‚<br><br><br>éµå¾ªFLIP-57çš„åŸºç¡€çŸ¥è¯†ï¼Œæˆ‘ä»¬æ‰©å±•äº†SQL DDLè¯­æ³•ä»¥æ”¯æŒç›®å½•åŠŸèƒ½ï¼Œä¸´æ—¶åŠŸèƒ½å’Œä¸´æ—¶ç³»ç»ŸåŠŸèƒ½ï¼ˆ<a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-79+Flink+Function+DDL+Support" target="_blank" rel="external nofollow noopener noreferrer">FLIP-79</a>ï¼‰çš„åˆ›å»ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE [TEMPORARY|TEMPORARY SYSTEM] FUNCTION </span><br><span class="line">  [IF NOT EXISTS] [catalog_name.][db_name.]function_name </span><br><span class="line">AS identifier [LANGUAGE JAVA|SCALA]</span><br></pre></td></tr></table></figure><p><br>æœ‰å…³Flink SQLä¸­DDLæ”¯æŒçš„å½“å‰çŠ¶æ€çš„å®Œæ•´æ¦‚è¿°ï¼Œè¯·æŸ¥çœ‹<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/table/sql/" target="_blank" rel="external nofollow noopener noreferrer">æ›´æ–°çš„æ–‡æ¡£</a>ã€‚<br><strong><br></strong>æ³¨æ„**ä¸ºäº†å°†æ¥èƒ½æ­£ç¡®å¤„ç†å’Œä¿è¯å…ƒå¯¹è±¡ï¼ˆè¡¨ï¼Œè§†å›¾ï¼Œå‡½æ•°ï¼‰ä¹‹é—´çš„è¡Œä¸ºä¸€è‡´ï¼Œä¸å»ºè®®ä½¿ç”¨Table APIä¸­çš„æŸäº›å¯¹è±¡å£°æ˜æ–¹æ³•ï¼Œè€Œåº”ä½¿ç”¨æ›´æ¥è¿‘æ ‡å‡†SQL DDLçš„æ–¹æ³•ï¼ˆ<a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-64%3A+Support+for+Temporary+Objects+in+Table+module" target="_blank" rel="external nofollow noopener noreferrer">FLIP -64</a>ï¼‰ã€‚<br><a name="full-tpc-ds-coverage-for-batch"></a></p><h4 id="-5"><a href="#-5" class="headerlink"></a></h4><p><a name="eHBxG"></a></p><h4 id="TPC-DSçš„å®Œæ•´è¦†ç›–èŒƒå›´å¯æ‰¹é‡å¤„ç†"><a href="#TPC-DSçš„å®Œæ•´è¦†ç›–èŒƒå›´å¯æ‰¹é‡å¤„ç†" class="headerlink" title="TPC-DSçš„å®Œæ•´è¦†ç›–èŒƒå›´å¯æ‰¹é‡å¤„ç†"></a>TPC-DSçš„å®Œæ•´è¦†ç›–èŒƒå›´å¯æ‰¹é‡å¤„ç†</h4><p><br>TPC-DSæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„è¡Œä¸šæ ‡å‡†å†³ç­–æ”¯æŒåŸºå‡†ï¼Œç”¨äºè¯„ä¼°å’Œè¡¡é‡åŸºäºSQLçš„æ•°æ®å¤„ç†å¼•æ“çš„æ€§èƒ½ã€‚åœ¨Flink 1.10ä¸­ï¼Œç«¯åˆ°ç«¯ï¼ˆ<a href="https://issues.apache.org/jira/browse/FLINK-11491" target="_blank" rel="external nofollow noopener noreferrer">FLINK-11491</a>ï¼‰æ”¯æŒæ‰€æœ‰TPC-DSæŸ¥è¯¢ï¼Œè¿™åæ˜ äº†å®ƒçš„SQLå¼•æ“å·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥æ»¡è¶³ç±»ä¼¼ç°ä»£æ•°æ®ä»“åº“çš„å·¥ä½œè´Ÿè½½çš„éœ€æ±‚ã€‚<br><a name="pyflink-support-for-native-user-defined-functions-udfs"></a></p><h3 id="-6"><a href="#-6" class="headerlink"></a></h3><p><a name="TgP6u"></a></p><h3 id="PyFlinkï¼šæ”¯æŒæœ¬æœºç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼ˆUDFï¼‰"><a href="#PyFlinkï¼šæ”¯æŒæœ¬æœºç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼ˆUDFï¼‰" class="headerlink" title="PyFlinkï¼šæ”¯æŒæœ¬æœºç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼ˆUDFï¼‰"></a>PyFlinkï¼šæ”¯æŒæœ¬æœºç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼ˆUDFï¼‰</h3><p><br>åœ¨ä»¥å‰çš„å‘è¡Œç‰ˆä¸­å¼•å…¥äº†PyFlinkçš„é¢„è§ˆç‰ˆï¼Œæœç€å®ç°Flinkä¸­å®Œå…¨Pythonæ”¯æŒçš„ç›®æ ‡è¿ˆè¿›äº†ä¸€æ­¥ã€‚å¯¹äºæ­¤å‘è¡Œç‰ˆï¼Œé‡ç‚¹æ˜¯ä½¿ç”¨æˆ·èƒ½å¤Ÿåœ¨è¡¨API / SQLï¼ˆ<a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-58%3A+Flink+Python+User-Defined+Stateless+Function+for+Table" target="_blank" rel="external nofollow noopener noreferrer">FLIP-58</a>ï¼‰ä¸­æ³¨å†Œå’Œä½¿ç”¨Pythonç”¨æˆ·å®šä¹‰å‡½æ•°ï¼ˆUDFï¼Œå·²è®¡åˆ’UDTF / UDAF ï¼‰ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2020/gif/1072113/1590945929231-b78d0f66-a731-4359-8aa2-442b5f78bc77.gif#align=left&display=inline&height=405&margin=%5Bobject%20Object%5D&name=flink_1.10_pyflink.gif&originHeight=405&originWidth=779&size=2561122&status=done&style=none&width=779" alt="flink_1.10_pyflink.gif"><br><br><br>å¦‚æœæ‚¨å¯¹åŸºç¡€å®ç°æ„Ÿå…´è¶£ï¼ˆåˆ©ç”¨Apache Beamçš„<a href="https://beam.apache.org/roadmap/portability/" target="_blank" rel="external nofollow noopener noreferrer">å¯ç§»æ¤æ€§æ¡†æ¶ï¼‰</a>ï¼Œè¯·å‚è€ƒFLIP-58çš„â€œæ¶æ„â€éƒ¨åˆ†ï¼Œä¹Ÿè¯·å‚è€ƒ<a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-78%3A+Flink+Python+UDF+Environment+and+Dependency+Management" target="_blank" rel="external nofollow noopener noreferrer">FLIP-78</a>ã€‚è¿™äº›æ•°æ®ç»“æ„ä¸ºPandasæ”¯æŒå’ŒPyFlinkæœ€ç»ˆåˆ°è¾¾DataStream APIå¥ å®šäº†å¿…è¦çš„åŸºç¡€ã€‚<br><br><br>ä»Flink 1.10å¼€å§‹ï¼Œç”¨æˆ·è¿˜å¯ä»¥<code>pip</code>ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è½»æ¾å®‰è£…PyFlink ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install apache-flink</span><br></pre></td></tr></table></figure><p><br>æœ‰å…³PyFlinkè®¡åˆ’è¿›è¡Œçš„å…¶ä»–æ”¹è¿›çš„é¢„è§ˆï¼Œè¯·æŸ¥çœ‹<a href="https://issues.apache.org/jira/browse/FLINK-14500" target="_blank" rel="external nofollow noopener noreferrer">FLINK-14500</a>å¹¶å‚ä¸æœ‰å…³æ‰€éœ€ç”¨æˆ·åŠŸèƒ½çš„<a href="http://apache-flink.147419.n8.nabble.com/Re-DISCUSS-What-parts-of-the-Python-API-should-we-focus-on-next-td1285.html" target="_blank" rel="external nofollow noopener noreferrer">è®¨è®º</a>ã€‚<br><a name="important-changes"></a></p><h2 id="é‡è¦å˜åŒ–"><a href="#é‡è¦å˜åŒ–" class="headerlink" title="é‡è¦å˜åŒ–"></a>é‡è¦å˜åŒ–</h2><ul><li>[ <a href="https://issues.apache.org/jira/browse/FLINK-10725" target="_blank" rel="external nofollow noopener noreferrer">FLINK-10725</a> ] Flinkç°åœ¨å¯ä»¥ç¼–è¯‘å¹¶åœ¨Java 11ä¸Šè¿è¡Œã€‚<br></li><li>[ <a href="https://jira.apache.org/jira/browse/FLINK-15495" target="_blank" rel="external nofollow noopener noreferrer">FLINK-15495</a> ] Blinkè®¡åˆ’ç¨‹åºç°åœ¨æ˜¯SQL Clientä¸­çš„é»˜è®¤è®¾ç½®ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥ä»æ‰€æœ‰æœ€æ–°åŠŸèƒ½å’Œæ”¹è¿›ä¸­å—ç›Šã€‚åœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¸­ï¼Œè¿˜è®¡åˆ’ä»Table APIä¸­çš„æ—§è®¡åˆ’ç¨‹åºè¿›è¡Œåˆ‡æ¢ï¼Œå› æ­¤æˆ‘ä»¬å»ºè®®ç”¨æˆ·å¼€å§‹ç†Ÿæ‚‰Blinkè®¡åˆ’ç¨‹åºã€‚<br></li><li>[ <a href="https://issues.apache.org/jira/browse/FLINK-13025" target="_blank" rel="external nofollow noopener noreferrer">FLINK-13025</a> ]æœ‰ä¸€ä¸ª<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/connectors/elasticsearch.html#elasticsearch-connector" target="_blank" rel="external nofollow noopener noreferrer">æ–°çš„Elasticsearchæ¥æ”¶å™¨è¿æ¥å™¨</a>ï¼Œå®Œå…¨æ”¯æŒElasticsearch 7.xç‰ˆæœ¬ã€‚<br></li><li>[ <a href="https://issues.apache.org/jira/browse/FLINK-15115" target="_blank" rel="external nofollow noopener noreferrer">FLINK-15115</a> ] Kafka 0.8å’Œ0.9çš„è¿æ¥å™¨å·²æ ‡è®°ä¸ºä¸æ¨èä½¿ç”¨ï¼Œå°†ä¸å†å¾—åˆ°ç§¯ææ”¯æŒã€‚å¦‚æœæ‚¨ä»åœ¨ä½¿ç”¨è¿™äº›ç‰ˆæœ¬æˆ–æœ‰ä»»ä½•å…¶ä»–ç›¸å…³é—®é¢˜ï¼Œè¯·è”ç³»@devé‚®ä»¶åˆ—è¡¨ã€‚<br></li><li>[ <a href="https://issues.apache.org/jira/browse/FLINK-14516" target="_blank" rel="external nofollow noopener noreferrer">FLINK-14516</a> ]åˆ é™¤äº†éåŸºäºä¿¡ç”¨çš„ç½‘ç»œæµæ§åˆ¶ä»£ç ä»¥åŠé…ç½®é€‰é¡¹<code>taskmanager.network.credit.model</code>ã€‚å±•æœ›æœªæ¥ï¼ŒFlinkå°†å§‹ç»ˆä½¿ç”¨åŸºäºä¿¡ç”¨çš„æµé‡æ§åˆ¶ã€‚<br></li><li>[ <a href="https://issues.apache.org/jira/browse/FLINK-12122" target="_blank" rel="external nofollow noopener noreferrer">FLINK-12122</a> ] <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=65147077" target="_blank" rel="external nofollow noopener noreferrer">FLIP-6</a>åœ¨Flink 1.5.0ä¸­æ¨å‡ºï¼Œå¹¶å¼•å…¥äº†ä¸ä»ä¸­åˆ†é…æ’æ§½æ–¹å¼æœ‰å…³çš„ä»£ç å›å½’<code>TaskManagers</code>ã€‚è¦ä½¿ç”¨æ›´æ¥è¿‘FLIPä¹‹å‰è¡Œä¸ºçš„è°ƒåº¦ç­–ç•¥ï¼ˆFlinkå°è¯•å°†å·¥ä½œè´Ÿè½½åˆ†æ•£åˆ°æ‰€æœ‰å½“å‰å¯ç”¨çš„è¡Œä¸ºä¸­ï¼‰<code>TaskManagers</code>ï¼Œç”¨æˆ·å¯ä»¥<code>cluster.evenly-spread-out-slots: true</code>åœ¨ä¸­è®¾ç½®<code>flink-conf.yaml</code>ã€‚<br></li><li>[ <a href="https://issues.apache.org/jira/browse/FLINK-11956" target="_blank" rel="external nofollow noopener noreferrer">FLINK-11956</a> ] <code>s3-hadoop</code>å’Œ<code>s3-presto</code>æ–‡ä»¶ç³»ç»Ÿä¸å†ä½¿ç”¨ç±»é‡å®šä½ï¼Œè€Œåº”é€šè¿‡<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/ops/filesystems/#pluggable-file-systems" target="_blank" rel="external nofollow noopener noreferrer">æ’ä»¶</a>åŠ è½½ï¼Œä½†ç°åœ¨å¯ä»¥ä¸æ‰€æœ‰å‡­æ®æä¾›ç¨‹åºæ— ç¼é›†æˆã€‚å¼ºçƒˆå»ºè®®å°†å…¶ä»–æ–‡ä»¶ç³»ç»Ÿä»…ç”¨ä½œæ’ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬å°†ç»§ç»­åˆ é™¤é‡å®šä½ã€‚<br></li><li>Flink 1.9å¸¦æœ‰é‡æ„çš„Web UIï¼Œä¿ç•™äº†æ—§ç‰ˆçš„UIä½œä¸ºå¤‡ä»½ï¼Œä»¥é˜²ä¸‡ä¸€æŸäº›åŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå°šæœªæŠ¥å‘Šä»»ä½•é—®é¢˜ï¼Œå› æ­¤<a href="http://apache-flink-mailing-list-archive.1008284.n3.nabble.com/DISCUSS-Remove-old-WebUI-td35218.html" target="_blank" rel="external nofollow noopener noreferrer">ç¤¾åŒºæŠ•ç¥¨å†³å®š</a>åœ¨Flink 1.10ä¸­åˆ é™¤æ—§ç‰ˆWeb UIã€‚<br><br><a name="release-notes"></a><h2 id="å‘è¡Œè¯´æ˜"><a href="#å‘è¡Œè¯´æ˜" class="headerlink" title="å‘è¡Œè¯´æ˜"></a>å‘è¡Œè¯´æ˜</h2>å¦‚æœæ‚¨æ‰“ç®—å°†è®¾ç½®å‡çº§åˆ°Flink 1.10ï¼Œè¯·ä»”ç»†æŸ¥çœ‹<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/release-notes/flink-1.10.html" target="_blank" rel="external nofollow noopener noreferrer">å‘è¡Œè¯´æ˜</a>ï¼Œä»¥è·å–è¯¦ç»†çš„æ›´æ”¹å’Œæ–°åŠŸèƒ½åˆ—è¡¨ã€‚æ­¤ç‰ˆæœ¬ä¸ä»¥å‰çš„1.xç‰ˆæœ¬çš„APIå…¼å®¹ï¼Œè¿™äº›ç‰ˆæœ¬çš„APIä½¿ç”¨@Publicæ³¨é‡Šè¿›è¡Œäº†æ³¨é‡Šã€‚</li></ul><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;&lt;br&gt;Apache Flinkç¤¾åŒºå¾ˆé«˜å…´èƒ½è¾¾åˆ°ä¸¤ä½æ•°å¹¶å®£å¸ƒå‘å¸ƒFlink 1.10.0ï¼ç”±äºè¿„ä»Šä¸ºæ­¢ç¤¾åŒºæœ€å¤§çš„åŠªåŠ›ï¼Œå·²å®æ–½äº†1.2kä¸ªé—®é¢˜ï¼Œè´¡
      
    
    </summary>
    
    
      <category term="å¤§æ•°æ®" scheme="cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="Flink" scheme="cpeixin.cn/tags/Flink/"/>
    
  </entry>
  
  <entry>
    <title>IDEA install TabNine</title>
    <link href="cpeixin.cn/2020/01/22/IDEA-install-TabNine/"/>
    <id>cpeixin.cn/2020/01/22/IDEA-install-TabNine/</id>
    <published>2020-01-22T02:26:15.000Z</published>
    <updated>2020-04-04T11:06:48.223Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><p>TabNineæ˜¯æˆ‘ç›®å‰é‡åˆ°è¿‡æœ€å¥½çš„æ™ºèƒ½è¡¥å…¨å·¥å…·</p><p>TabNineåŸºäºGPT-2çš„æ’ä»¶</p><p>å®‰è£…<br>IDEAç¼–è¯‘å™¨ï¼Œæ‰¾åˆ°plugins</p><p>Windows pycharmï¼šFile&gt;settings&gt;plugins;<br>Mac pycharmï¼šperformence&gt;plugins&gt;marketplace or plugins&gt;Install JetBrains Plugins</p><p>æŸ¥æ‰¾ TabNine, ç‚¹å‡» install, éšå restart</p><p>é‡å¯åï¼šHelp&gt;Edit Custom Propertiesâ€¦&gt;Create;</p><p>åœ¨è·³å‡ºæ¥çš„idea.propertiesä¸­è¾“å…¥ï¼ˆæ³¨ï¼šè‹±æ–‡å­—ç¬¦ï¼‰ TabNine::config</p><p>éšå³ä¼šè‡ªåŠ¨å¼¹å‡ºTabNineæ¿€æ´»é¡µé¢ï¼›</p><p>æ¿€æ´»<br>ç‚¹å‡»Activation Keyä¸‹é¢çš„hereï¼›</p><p>è¾“å…¥ä½ çš„é‚®ç®±å·ï¼›</p><p>å¤åˆ¶ç²˜è´´é‚®ä»¶é‡Œé¢çš„API Keyåˆ°Activation Keyä¸‹é¢ï¼›ï¼ˆå¾—åˆ°çš„ key å¯ä»¥åœ¨å„ç§ç¼–è¯‘å™¨ä¸­å…±ç”¨ï¼‰</p><p>ç­‰å¾…è‡ªåŠ¨å®‰è£…ï¼Œè§‚å¯Ÿé¡µé¢ï¼ˆæœ€ä¸‹é¢æœ‰logå¯ä»¥çœ‹å½“å‰è¿›åº¦ï¼‰ï¼›</p><p>æ¿€æ´»å®ŒæˆåTabNine Cloudä¸ºEnabledçŠ¶æ€ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å®‰è£…è¿›åº¦å®Œæˆååˆ·æ–°é¡µé¢æ‰‹åŠ¨é€‰æ‹©Enabledï¼›</p><p>ç¡®è®¤æ¿€æ´»å®Œæˆï¼Œé‡å¯pycharmå³å¯ï¼›</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;TabNineæ˜¯æˆ‘ç›®å‰é‡åˆ°è¿‡æœ€å¥½çš„æ™ºèƒ½è¡¥å…¨å·¥å…·&lt;/p&gt;&lt;p&gt;TabNineåŸºäºGPT-2çš„æ’ä»¶&lt;/p&gt;&lt;p&gt;å®‰è£…&lt;br&gt;IDEAç¼–è¯‘å™¨ï¼Œæ‰¾åˆ°pl
      
    
    </summary>
    
    
      <category term="å¼€å‘å·¥å…·" scheme="cpeixin.cn/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="IDEA" scheme="cpeixin.cn/tags/IDEA/"/>
    
  </entry>
  
  <entry>
    <title>ã€è½¬è½½ã€‘å­—èŠ‚è·³åŠ¨ EB çº§ HDFS å®è·µ</title>
    <link href="cpeixin.cn/2020/01/02/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8-EB-%E7%BA%A7-HDFS-%E5%AE%9E%E8%B7%B5/"/>
    <id>cpeixin.cn/2020/01/02/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8-EB-%E7%BA%A7-HDFS-%E5%AE%9E%E8%B7%B5/</id>
    <published>2020-01-02T15:25:55.000Z</published>
    <updated>2020-05-31T15:28:54.936Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:12 GMT+0800 (GMT+08:00) --><p>è½¬è½½è‡ª<a href="https://juejin.im/post/5e0aac53e51d4575e82591e8" target="_blank" rel="external nofollow noopener noreferrer">å­—èŠ‚è·³åŠ¨ EB çº§ HDFS å®è·µ</a>ï¼Œå­¦ä¹ å­¦ä¹ å­—èŠ‚è·³åŠ¨åŸºç¡€æ¶æ„éƒ¨é—¨å¯¹ä¸Šä¸‡èŠ‚ç‚¹çš„HDFSé›†ç¾¤çš„ç®¡ç†æ–¹å¼<br><br><br>æ–‡ç« çš„æœ€åï¼Œæœ‰å†™ä¸Šè‡ªå·±çš„æ€»ç»“ï¼Œå·¥ä½œè¿™å‡ å¹´ï¼Œç¡®å®æ²¡æœ‰é‡åˆ°è¿‡è¿™ä¹ˆåºå¤§çš„æ•°æ®é‡å’Œé›†ç¾¤ï¼Œé‚£ä¹ˆå°±ä¸èƒ½å…ˆå®æˆ˜å†æ€»ç»“äº†ï¼Œç›®å‰æ˜¯ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šçœ‹çœ‹è¿œå¤„çš„é£æ™¯ï¼Œå½“æˆ‘åˆ°è¾¾çš„é‚£ä¸€å¤©ï¼Œå°±ä¼šæ›´ä»å®¹çš„èå…¥é£æ™¯äº†ã€‚</p><hr><p><a name="MorZX"></a></p><h1 id="HDFS-ç®€ä»‹"><a href="#HDFS-ç®€ä»‹" class="headerlink" title="HDFS ç®€ä»‹"></a>HDFS ç®€ä»‹</h1><p>å› ä¸º HDFS è¿™æ ·ä¸€ä¸ªç³»ç»Ÿå·²ç»å­˜åœ¨äº†éå¸¸é•¿çš„æ—¶é—´ï¼Œåº”ç”¨çš„åœºæ™¯å·²ç»éå¸¸æˆç†Ÿäº†ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†æˆ‘ä»¬ä¼šæ¯”è¾ƒç®€å•åœ°ä»‹ç»ã€‚<br>HDFS å…¨å Hadoop Distributed File Systemï¼Œæ˜¯ä¸šç•Œä½¿ç”¨æœ€å¹¿æ³›çš„å¼€æºåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚åŸç†å’Œæ¶æ„ä¸ Google çš„ GFS åŸºæœ¬ä¸€è‡´ã€‚å®ƒçš„ç‰¹ç‚¹ä¸»è¦æœ‰ä»¥ä¸‹å‡ é¡¹ï¼š</p><ul><li>å’Œæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸€æ ·çš„ç›®å½•æ ‘è§†å›¾</li><li>Append Only çš„å†™å…¥ï¼ˆä¸æ”¯æŒéšæœºå†™ï¼‰</li><li>é¡ºåºå’Œéšæœºè¯»</li><li>è¶…å¤§æ•°æ®è§„æ¨¡</li><li>æ˜“æ‰©å±•ï¼Œå®¹é”™ç‡é«˜<br><a name="AUWUZ"></a><h1><a href="#" class="headerlink"></a></h1><a name="fQiBn"></a><h1 id="å­—èŠ‚è·³åŠ¨ç‰¹è‰²çš„-HDFS"><a href="#å­—èŠ‚è·³åŠ¨ç‰¹è‰²çš„-HDFS" class="headerlink" title="å­—èŠ‚è·³åŠ¨ç‰¹è‰²çš„ HDFS"></a>å­—èŠ‚è·³åŠ¨ç‰¹è‰²çš„ HDFS</h1></li></ul><p><br>å­—èŠ‚è·³åŠ¨åº”ç”¨ HDFS å·²ç»éå¸¸é•¿çš„æ—¶é—´äº†ï¼Œç»å†äº† 7 å¹´çš„å‘å±•ï¼Œç›®å‰å·²ç›´æ¥æ”¯æŒäº†åå¤šç§æ•°æ®å¹³å°ï¼Œé—´æ¥æ”¯æŒäº†ä¸Šç™¾ç§ä¸šåŠ¡å‘å±•ã€‚ä»é›†ç¾¤è§„æ¨¡å’Œæ•°æ®é‡æ¥è¯´ï¼ŒHDFS å¹³å°åœ¨å…¬å¸å†…éƒ¨å·²ç»æˆé•¿ä¸ºæ€»æ•°å‡ ä¸‡å°æœåŠ¡å™¨çš„å¤§å¹³å°ï¼Œæ”¯æŒäº† EB çº§åˆ«çš„æ•°æ®é‡ã€‚<br><br><br>åœ¨æ·±å…¥ç›¸å…³çš„æŠ€æœ¯ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹å­—èŠ‚è·³åŠ¨çš„ HDFS æ¶æ„ã€‚<br><a name="PdpVx"></a></p><h2 id="-1"><a href="#-1" class="headerlink"></a></h2><p><a name="oK4fY"></a></p><h2 id="æ¶æ„ä»‹ç»"><a href="#æ¶æ„ä»‹ç»" class="headerlink" title="æ¶æ„ä»‹ç»"></a>æ¶æ„ä»‹ç»</h2><p><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1590931343675-83b09747-e37a-438c-a445-2fdafdba9c83.webp#align=left&display=inline&height=749&margin=%5Bobject%20Object%5D&originHeight=749&originWidth=962&size=0&status=done&style=none&width=962" alt><br><a name="jC8CW"></a></p><h3 id="-2"><a href="#-2" class="headerlink"></a></h3><p><a name="66HyQ"></a></p><h3 id="æ¥å…¥å±‚"><a href="#æ¥å…¥å±‚" class="headerlink" title="æ¥å…¥å±‚"></a>æ¥å…¥å±‚</h3><p><br>æ¥å…¥å±‚æ˜¯åŒºåˆ«äºç¤¾åŒºç‰ˆæœ¬æœ€å¤§çš„ä¸€å±‚ï¼Œç¤¾åŒºç‰ˆæœ¬ä¸­å¹¶æ— è¿™ä¸€å±‚å®šä¹‰ã€‚åœ¨å­—èŠ‚è·³åŠ¨çš„è½åœ°å®è·µä¸­ï¼Œç”±äºé›†ç¾¤çš„èŠ‚ç‚¹è¿‡äºåºå¤§ï¼Œæˆ‘ä»¬éœ€è¦éå¸¸å¤šçš„ NameNode å®ç°è”é‚¦æœºåˆ¶æ¥æ¥å…¥ä¸åŒä¸Šå±‚ä¸šåŠ¡çš„æ•°æ®æœåŠ¡ã€‚ä½†å½“ NameNode æ•°é‡ä¹Ÿå˜å¾—éå¸¸å¤šäº†ä»¥åï¼Œç”¨æˆ·è¯·æ±‚çš„ç»Ÿä¸€æ¥å…¥åŠç»Ÿä¸€è§†å›¾çš„ç®¡ç†ä¹Ÿä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³ç”¨æˆ·æ¥å…¥è¿‡äºåˆ†æ•£ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„æ¥å…¥å±‚æ¥æ”¯æŒç”¨æˆ·è¯·æ±‚çš„ç»Ÿä¸€æ¥å…¥ï¼Œè½¬å‘è·¯ç”±ï¼›åŒæ—¶ä¹Ÿèƒ½ç»“åˆä¸šåŠ¡æä¾›ç”¨æˆ·æƒé™å’Œæµé‡æ§åˆ¶èƒ½åŠ›ï¼›å¦å¤–ï¼Œè¯¥æ¥å…¥å±‚ä¹Ÿéœ€è¦æä¾›å¯¹å¤–çš„ç›®å½•æ ‘ç»Ÿä¸€è§†å›¾ã€‚<br><br><br>è¯¥æ¥å…¥å±‚ä»éƒ¨ç½²å½¢æ€ä¸Šæ¥è®²ï¼Œä¾èµ–äºä¸€äº›å¤–éƒ¨ç»„ä»¶å¦‚ Redisï¼ŒMySQL ç­‰ï¼Œä¼šæœ‰ä¸€æ‰¹æ— çŠ¶æ€çš„ NNProxy ç»„æˆï¼Œä»–ä»¬æä¾›äº†è¯·æ±‚è·¯ç”±ï¼ŒQuota é™åˆ¶ï¼ŒTracing èƒ½åŠ›åŠæµé‡é™é€Ÿç­‰èƒ½åŠ›ã€‚<br><a name="gFV5T"></a></p><h3 id="-3"><a href="#-3" class="headerlink"></a></h3><p><a name="DTx6L"></a></p><h3 id="å…ƒæ•°æ®å±‚"><a href="#å…ƒæ•°æ®å±‚" class="headerlink" title="å…ƒæ•°æ®å±‚"></a>å…ƒæ•°æ®å±‚</h3><p><br>è¿™ä¸€å±‚ä¸»è¦æ¨¡å—æœ‰ Name Nodeï¼ŒZKFCï¼Œå’Œ BookKeeperï¼ˆä¸åŒäº QJMï¼ŒBookKeeper åœ¨å¤§è§„æ¨¡å¤šèŠ‚ç‚¹æ•°æ®åŒæ­¥ä¸Šæ¥è®²ä¼šè¡¨ç°å¾—æ›´ç¨³å®šå¯é ï¼‰ã€‚<br><br><br>Name Node è´Ÿè´£å­˜å‚¨æ•´ä¸ª HDFS é›†ç¾¤çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œæ˜¯æ•´ä¸ªç³»ç»Ÿçš„å¤§è„‘ã€‚ä¸€æ—¦æ•…éšœï¼Œæ•´ä¸ªé›†ç¾¤éƒ½ä¼šé™·å…¥ä¸å¯ç”¨çŠ¶æ€ã€‚å› æ­¤ Name Node æœ‰ä¸€å¥—åŸºäº ZKFC çš„ä¸»ä»çƒ­å¤‡çš„é«˜å¯ç”¨æ–¹æ¡ˆã€‚<br><br><br>Name Node è¿˜é¢ä¸´ç€æ‰©å±•æ€§çš„é—®é¢˜ï¼Œå•æœºæ‰¿è½½èƒ½åŠ›å§‹ç»ˆå—é™ã€‚äºæ˜¯ HDFS å¼•å…¥äº†è”é‚¦ï¼ˆFederationï¼‰æœºåˆ¶ã€‚ä¸€ä¸ªé›†ç¾¤ä¸­å¯ä»¥éƒ¨ç½²å¤šç»„ Name Nodeï¼Œå®ƒä»¬ç‹¬ç«‹ç»´æŠ¤è‡ªå·±çš„å…ƒæ•°æ®ï¼Œå…±ç”¨ Data Node å­˜å‚¨èµ„æºã€‚è¿™æ ·ï¼Œä¸€ä¸ª HDFS é›†ç¾¤å°±å¯ä»¥æ— é™æ‰©å±•äº†ã€‚ä½†æ˜¯è¿™ç§ Federation æœºåˆ¶ä¸‹ï¼Œæ¯ä¸€ç»„ Name Node çš„ç›®å½•æ ‘éƒ½äº’ç›¸å‰²è£‚çš„ã€‚äºæ˜¯åˆå‡ºç°äº†ä¸€äº›è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿä½¿æ•´ä¸ª Federation é›†ç¾¤å¯¹å¤–æä¾›ä¸€ä¸ªå®Œæ•´ç›®å½•æ ‘çš„è§†å›¾ã€‚<br></p><p><a name="OVDWh"></a></p><h3 id="æ•°æ®å±‚"><a href="#æ•°æ®å±‚" class="headerlink" title="æ•°æ®å±‚"></a>æ•°æ®å±‚</h3><p><br>ç›¸æ¯”å…ƒæ•°æ®å±‚ï¼Œæ•°æ®å±‚ä¸»è¦èŠ‚ç‚¹æ˜¯ Data Nodeã€‚Data Node è´Ÿè´£å®é™…çš„æ•°æ®å­˜å‚¨å’Œè¯»å–ã€‚ç”¨æˆ·æ–‡ä»¶è¢«åˆ‡åˆ†æˆå—å¤åˆ¶æˆå¤šå‰¯æœ¬ï¼Œæ¯ä¸ªå‰¯æœ¬éƒ½å­˜åœ¨ä¸åŒçš„ Data Node ä¸Šï¼Œä»¥è¾¾åˆ°å®¹é”™å®¹ç¾çš„æ•ˆæœã€‚æ¯ä¸ªå‰¯æœ¬åœ¨ Data Node ä¸Šéƒ½ä»¥æ–‡ä»¶çš„å½¢å¼å­˜å‚¨ï¼Œå…ƒä¿¡æ¯åœ¨å¯åŠ¨æ—¶è¢«åŠ è½½åˆ°å†…å­˜ä¸­ã€‚<br><br><br>Data Node ä¼šå®šæ—¶å‘ Name Node åšå¿ƒè·³æ±‡æŠ¥ï¼Œå¹¶ä¸”å‘¨æœŸæ€§å°†è‡ªå·±æ‰€å­˜å‚¨çš„å‰¯æœ¬ä¿¡æ¯æ±‡æŠ¥ç»™ Name Nodeã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹ Federation ä¸­çš„æ¯ä¸ªé›†ç¾¤éƒ½æ˜¯ç‹¬ç«‹å®Œæˆçš„ã€‚åœ¨å¿ƒè·³æ±‡æŠ¥çš„è¿”å›ç»“æœä¸­ï¼Œä¼šæºå¸¦ Name Node å¯¹ Data Node ä¸‹å‘çš„æŒ‡ä»¤ï¼Œä¾‹å¦‚ï¼Œéœ€è¦å°†æŸä¸ªå‰¯æœ¬æ‹·è´åˆ°å¦å¤–ä¸€å° Data Node æˆ–è€…å°†æŸä¸ªå‰¯æœ¬åˆ é™¤ç­‰ã€‚<br></p><p><a name="NU3Ae"></a></p><h2 id="ä¸»è¦ä¸šåŠ¡"><a href="#ä¸»è¦ä¸šåŠ¡" class="headerlink" title="ä¸»è¦ä¸šåŠ¡"></a>ä¸»è¦ä¸šåŠ¡</h2><p>å…ˆæ¥çœ‹ä¸€ä¸‹å½“å‰åœ¨å­—èŠ‚è·³åŠ¨ HDFS æ‰¿è½½çš„ä¸»è¦ä¸šåŠ¡ï¼š</p><ul><li>Hiveï¼ŒHBaseï¼Œæ—¥å¿—æœåŠ¡ï¼ŒKafka æ•°æ®å­˜å‚¨</li><li>Yarnï¼ŒFlink çš„è®¡ç®—æ¡†æ¶å¹³å°æ•°æ®</li><li>Sparkï¼ŒMapReduce çš„è®¡ç®—ç›¸å…³æ•°æ®å­˜å‚¨<br><a name="GHk55"></a><h2 id="å‘å±•é˜¶æ®µ"><a href="#å‘å±•é˜¶æ®µ" class="headerlink" title="å‘å±•é˜¶æ®µ"></a>å‘å±•é˜¶æ®µ</h2>åœ¨å­—èŠ‚è·³åŠ¨ï¼Œéšç€ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•ï¼ŒHDFS çš„æ•°æ®é‡å’Œé›†ç¾¤è§„æ¨¡å¿«é€Ÿæ‰©å¤§ï¼ŒåŸæ¥çš„ HDFS çš„é›†ç¾¤ä»å‡ ç™¾å°ï¼Œè¿…é€Ÿçªç ´åƒå°å’Œä¸‡å°çš„è§„æ¨¡ã€‚è¿™ä¸­é—´ï¼Œè¸©äº†æ— æ•°çš„å‘ï¼Œå¤§çš„é˜¶æ®µå½’çº³èµ·æ¥ä¼šæœ‰è¿™æ ·å‡ ä¸ªé˜¶æ®µã€‚<br><a name="rzDSM"></a><h3 id="ç¬¬ä¸€é˜¶æ®µ"><a href="#ç¬¬ä¸€é˜¶æ®µ" class="headerlink" title="ç¬¬ä¸€é˜¶æ®µ"></a>ç¬¬ä¸€é˜¶æ®µ</h3>ä¸šåŠ¡å¢é•¿åˆæœŸï¼Œé›†ç¾¤è§„æ¨¡å¢é•¿è¶‹åŠ¿éå¸¸é™¡å³­ï¼Œå•é›†ç¾¤è§„æ¨¡å¾ˆå¿«åœ¨å…ƒæ•°æ®æœåŠ¡å™¨ Name Node ä¾§é‡åˆ°ç“¶é¢ˆã€‚å¼•å…¥è”é‚¦æœºåˆ¶ï¼ˆFederationï¼‰å®ç°é›†ç¾¤çš„æ¨ªå‘æ‰©å±•ã€‚<br><br><br>è”é‚¦åˆå¸¦æ¥ç»Ÿä¸€å‘½åç©ºé—´é—®é¢˜ï¼Œå› æ­¤ï¼Œéœ€è¦ç»Ÿä¸€è§†å›¾ç©ºé—´å¸®åŠ©ä¸šåŠ¡æ„å»ºç»Ÿä¸€æ¥å…¥ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº† Name Node Proxy ç»„ä»¶å®ç°ç»Ÿä¸€è§†å›¾å’Œå¤šç§Ÿæˆ·ç®¡ç†ç­‰åŠŸèƒ½ï¼Œè¿™éƒ¨åˆ†ä¼šåœ¨ä¸‹æ–‡çš„ NNProxy ç« èŠ‚ä¸­ä»‹ç»ã€‚<br><a name="r78Fs"></a><h3 id="ç¬¬äºŒé˜¶æ®µ"><a href="#ç¬¬äºŒé˜¶æ®µ" class="headerlink" title="ç¬¬äºŒé˜¶æ®µ"></a>ç¬¬äºŒé˜¶æ®µ</h3></li></ul><p><br>æ•°æ®é‡ç»§ç»­å¢å¤§ï¼ŒFederation æ–¹å¼ä¸‹çš„ç›®å½•æ ‘ç®¡ç†ä¹Ÿå­˜åœ¨ç“¶é¢ˆï¼Œä¸»è¦ä½“ç°åœ¨æ•°æ®é‡å¢å¤§åï¼ŒJava ç‰ˆæœ¬çš„ GC å˜å¾—æ›´åŠ é¢‘ç¹ï¼Œè·¨å­æ ‘è¿ç§»èŠ‚ç‚¹ä»£ä»·è¿‡å¤§ï¼ŒèŠ‚ç‚¹å¯åŠ¨æ—¶é—´å¤ªé•¿ç­‰é—®é¢˜ã€‚å› æ­¤æˆ‘ä»¬é€šè¿‡é‡æ„çš„æ–¹å¼ï¼Œè§£å†³äº† GCï¼Œé”ä¼˜åŒ–ï¼Œå¯åŠ¨åŠ é€Ÿç­‰é—®é¢˜ï¼Œå°†åŸ Name Node çš„æœåŠ¡èƒ½åŠ›è¿›ä¸€æ­¥æé«˜ã€‚å®¹çº³æ›´å¤šçš„å…ƒæ•°æ®ä¿¡æ¯ã€‚<br><br><br>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿå®ç°äº†å­—èŠ‚è·³åŠ¨ç‰¹è‰²çš„ DanceNN ç»„ä»¶ï¼Œå…¼å®¹äº†åŸæœ‰ Java ç‰ˆæœ¬ NameNode çš„å…¨éƒ¨åŠŸèƒ½åŸºç¡€ä¸Šï¼Œå¤§å¤§å¢å¼ºäº†ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚ç›¸å…³è¯¦ç»†ä»‹ç»ä¼šåœ¨ä¸‹é¢çš„ DanceNN ç« èŠ‚ä¸­ä»‹ç»ã€‚<br><a name="cKChL"></a></p><h3 id="-4"><a href="#-4" class="headerlink"></a></h3><p><a name="Ufy9s"></a></p><h3 id="ç¬¬ä¸‰é˜¶æ®µ"><a href="#ç¬¬ä¸‰é˜¶æ®µ" class="headerlink" title="ç¬¬ä¸‰é˜¶æ®µ"></a>ç¬¬ä¸‰é˜¶æ®µ</h3><p><br>å½“æ•°æ®é‡è·¨è¿‡ EBï¼Œé›†ç¾¤è§„æ¨¡æ‰©å¤§åˆ°å‡ ä¸‡å°çš„æ—¶å€™ï¼Œæ…¢èŠ‚ç‚¹é—®é¢˜ï¼Œæ›´ç»†ç²’åº¦æœåŠ¡åˆ†çº§é—®é¢˜ï¼Œæˆæœ¬é—®é¢˜å’Œå…ƒæ•°æ®ç“¶é¢ˆè¿›ä¸€æ­¥å‡¸æ˜¾ã€‚æˆ‘ä»¬åœ¨æ¶æ„ä¸Šè¿›ä¸€æ­¥åœ¨åŒ…æ‹¬å®Œå–„å¤šç§Ÿæˆ·ä½“ç³»æ„å»ºï¼Œé‡æ„æ•°æ®èŠ‚ç‚¹å’Œå…ƒæ•°æ®åˆ†å±‚ç­‰æ–¹å‘è¿›ä¸€æ­¥æ¼”è¿›ã€‚è¿™éƒ¨åˆ†ç›®å‰æ­£åœ¨è¿›è¡Œä¸­ï¼Œå› ä¸ºä¼˜åŒ–çš„ç‚¹ä¼šéå¸¸å¤šï¼Œæœ¬æ–‡ä¼šç»™å‡ºæ…¢èŠ‚ç‚¹ä¼˜åŒ–çš„è½åœ°å®è·µã€‚<br></p><p><a name="tEe39"></a></p><h2 id="å…³é”®æ”¹è¿›"><a href="#å…³é”®æ”¹è¿›" class="headerlink" title="å…³é”®æ”¹è¿›"></a>å…³é”®æ”¹è¿›</h2><p><br>åœ¨æ•´ä¸ªæ¶æ„æ¼”è¿›çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åšäº†éå¸¸å¤šçš„æ¢ç´¢å’Œå°è¯•ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œç»“åˆä¹‹å‰æåˆ°çš„å‡ ä¸ªå¤§çš„æŒ‘æˆ˜å’Œé—®é¢˜ï¼Œæˆ‘ä»¬å°±å…¶ä¸­å…³é”®çš„ Name Node Proxy å’Œ Dance Name Node è¿™ä¸¤ä¸ªé‡ç‚¹ç»„ä»¶åšä¸€ä¸‹ä»‹ç»ï¼ŒåŒæ—¶ï¼Œä¹Ÿä¼šä»‹ç»ä¸€ä¸‹æˆ‘ä»¬åœ¨æ…¢èŠ‚ç‚¹æ–¹é¢çš„ä¼˜åŒ–å’Œæ”¹è¿›ã€‚<br><a name="TD5kf"></a></p><h3 id="-5"><a href="#-5" class="headerlink"></a></h3><p><a name="4I1Fk"></a></p><h3 id="NNProxyï¼ˆName-Node-Proxyï¼‰"><a href="#NNProxyï¼ˆName-Node-Proxyï¼‰" class="headerlink" title="NNProxyï¼ˆName Node Proxyï¼‰"></a>NNProxyï¼ˆName Node Proxyï¼‰</h3><p>ä½œä¸ºç³»ç»Ÿçš„å…ƒæ•°æ®æ“ä½œæ¥å…¥ç«¯ï¼ŒNNProxy æä¾›äº†è”é‚¦æ¨¡å¼ä¸‹ç»Ÿä¸€å…ƒæ•°æ®è§†å›¾ï¼Œè§£å†³äº†ç”¨æˆ·è¯·æ±‚çš„ç»Ÿä¸€è½¬å‘ï¼Œä¸šåŠ¡æµé‡çš„ç»Ÿä¸€ç®¡æ§çš„é—®é¢˜ã€‚<br><br><br>å…ˆä»‹ç»ä¸€ä¸‹ NNProxy æ‰€å¤„çš„ç³»ç»Ÿä¸Šä¸‹æ¸¸ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1590933295275-e12431d8-0bab-419e-bc29-4c3e03a5c6ff.webp#align=left&display=inline&height=572&margin=%5Bobject%20Object%5D&originHeight=572&originWidth=864&size=0&status=done&style=none&width=864" alt><br><br><br>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ NNProxy éƒ½åšäº†ä»€ä¹ˆå·¥ä½œã€‚<br><a name="rk9VU"></a></p><h4 id="-6"><a href="#-6" class="headerlink"></a></h4><p><a name="AYfYO"></a></p><h4 id="è·¯ç”±ç®¡ç†"><a href="#è·¯ç”±ç®¡ç†" class="headerlink" title="è·¯ç”±ç®¡ç†"></a>è·¯ç”±ç®¡ç†</h4><p><br>åœ¨ä¸Šé¢ Federation çš„ä»‹ç»ä¸­æåˆ°ï¼Œæ¯ä¸ªé›†ç¾¤éƒ½ç»´æŠ¤è‡ªå·±ç‹¬ç«‹çš„ç›®å½•æ ‘ï¼Œæ— æ³•å¯¹å¤–æä¾›ä¸€ä¸ªå®Œæ•´çš„ç›®å½•æ ‘è§†å›¾ã€‚NNProxy ä¸­çš„è·¯ç”±ç®¡ç†å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚è·¯ç”±ç®¡ç†å­˜å‚¨äº†ä¸€å¼  mount tableï¼Œè¡¨ä¸­è®°å½•è‹¥å¹²æ¡è·¯å¾„åˆ°é›†ç¾¤çš„æ˜ å°„å…³ç³»ã€‚<br><br><br>ä¾‹å¦‚ <strong>/user -&gt; hdfs://namenodeB</strong>ï¼Œè¿™æ¡æ˜ å°„å…³ç³»çš„å«ä¹‰å°±æ˜¯ /user åŠå…¶å­ç›®å½•è¿™ä¸ªç›®å½•åœ¨ <strong>namenodeB</strong> è¿™ä¸ªé›†ç¾¤ä¸Šï¼Œæ‰€æœ‰å¯¹ /user åŠå…¶å­ç›®å½•çš„è®¿é—®éƒ½ä¼šç”± NNProxy è½¬å‘ç»™ <strong>namenodeB</strong>ï¼Œè·å–ç»“æœåå†è¿”å›ç»™ Clientã€‚<br><br><br>åŒ¹é…åŸåˆ™ä¸ºæœ€é•¿åŒ¹é…ï¼Œä¾‹å¦‚æˆ‘ä»¬è¿˜æœ‰å¦å¤–ä¸€æ¡æ˜ å°„ <strong>/user/tiger/dump -&gt; hdfs://namenodeC</strong>ï¼Œé‚£ä¹ˆ /user/tiger/dump åŠå…¶æ‰€æœ‰å­ç›®å½•éƒ½åœ¨ namenodeCï¼Œè€Œ /user ç›®å½•ä¸‹å…¶ä»–å­ç›®å½•éƒ½åœ¨ namenodeB ä¸Šã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1590933295845-bb064f91-f470-4129-80b9-c49e55ddae75.webp#align=left&display=inline&height=750&margin=%5Bobject%20Object%5D&originHeight=750&originWidth=864&size=0&status=done&style=none&width=864" alt><br><a name="kRRta"></a></p><h4 id="-7"><a href="#-7" class="headerlink"></a></h4><p><a name="DJKii"></a></p><h4 id="Quota-é™åˆ¶"><a href="#Quota-é™åˆ¶" class="headerlink" title="Quota é™åˆ¶"></a>Quota é™åˆ¶</h4><p>ä½¿ç”¨è¿‡ HDFS çš„åŒå­¦ä¼šçŸ¥é“ Quota è¿™ä¸ªæ¦‚å¿µã€‚æˆ‘ä»¬ç»™æ¯ä¸ªç›®å½•é›†åˆåˆ†é…äº†é¢å®šçš„ç©ºé—´èµ„æºï¼Œä¸€æ—¦ä½¿ç”¨è¶…è¿‡è¿™ä¸ªé˜ˆå€¼ï¼Œå°±ä¼šè¢«ç¦æ­¢å†™å…¥ã€‚è¿™ä¸ªå·¥ä½œå°±æ˜¯ç”± NNProxy å®Œæˆçš„ã€‚NNProxy ä¼šé€šè¿‡ Quota å®æ—¶ç›‘æ§ç³»ç»Ÿè·å–æœ€æ–° Quota ä½¿ç”¨æƒ…å†µï¼Œå½“ç”¨æˆ·è¿›è¡Œå…ƒæ•°æ®æ“ä½œçš„æ—¶å€™ï¼ŒNNProxy å°±ä¼šæ ¹æ®ç”¨æˆ·çš„ Quota æƒ…å†µä½œå‡ºåˆ¤æ–­ï¼Œå†³å®šé€šè¿‡æˆ–è€…æ‹’ç»ã€‚<br><a name="e2E2o"></a></p><h4 id="-8"><a href="#-8" class="headerlink"></a></h4><p><a name="JG3Xt"></a></p><h4 id="Trace-æ”¯æŒ"><a href="#Trace-æ”¯æŒ" class="headerlink" title="Trace æ”¯æŒ"></a>Trace æ”¯æŒ</h4><p>ByteTrace æ˜¯ä¸€ä¸ª Trace ç³»ç»Ÿï¼Œè®°å½•è¿½è¸ªç”¨æˆ·å’Œç³»ç»Ÿä»¥åŠç³»ç»Ÿä¹‹é—´çš„è°ƒç”¨è¡Œä¸ºï¼Œä»¥è¾¾åˆ°åˆ†æå’Œè¿ç»´çš„ç›®çš„ã€‚å…¶ä¸­çš„ Trace ä¿¡æ¯ä¼šé™„åœ¨å‘ NNProxy çš„è¯·æ±‚ RPC ä¸­ã€‚NNProxy æ‹¿åˆ° ByteTrace ä»¥åå°±å¯ä»¥çŸ¥é“å½“å‰è¯·æ±‚çš„ä¸Šæ¸¸æ¨¡å—ï¼ŒUSER åŠ Application ID ç­‰ä¿¡æ¯ã€‚NNProxy ä¸€æ–¹é¢å°†è¿™äº›ä¿¡æ¯å‘åˆ° Kafka åšä¸€äº›ç¦»çº¿åˆ†æï¼Œä¸€æ–¹é¢å®æ—¶èšåˆå¹¶æ‰“ç‚¹ï¼Œä»¥ä¾¿è¿½æº¯çº¿ä¸Šæµé‡ã€‚<br><a name="7lbZo"></a></p><h4 id="-9"><a href="#-9" class="headerlink"></a></h4><p><a name="9VGfn"></a></p><h4 id="æµé‡é™åˆ¶"><a href="#æµé‡é™åˆ¶" class="headerlink" title="æµé‡é™åˆ¶"></a>æµé‡é™åˆ¶</h4><p><br>è™½ç„¶ NNProxy éå¸¸è½»é‡ï¼Œå¯ä»¥æ‰¿å—å¾ˆé«˜çš„ QPSï¼Œä½†æ˜¯åç«¯çš„ Name Node æ‰¿è½½èƒ½åŠ›æ˜¯æœ‰é™çš„ã€‚å› æ­¤çªå‘çš„å¤§ä½œä¸šé€ æˆé«˜ QPS çš„è¯»å†™è¯·æ±‚è¢«å…¨é‡è½¬å‘åˆ° Name Node ä¸Šæ—¶ï¼Œä¼šé€ æˆ Name Node è¿‡è½½ï¼Œå»¶æ—¶å˜é«˜ï¼Œç”šè‡³å‡ºç° OOMï¼Œå½±å“é›†ç¾¤ä¸Šæ‰€æœ‰ç”¨æˆ·ã€‚<br><br><br>å› æ­¤ NNProxy å¦ä¸€ä¸ªéå¸¸é‡è¦çš„ä»»åŠ¡å°±æ˜¯é™æµï¼Œä»¥ä¿æŠ¤åç«¯ Name Nodeã€‚ç›®å‰é™æµåŸºäºè·¯å¾„+RPC ä»¥åŠ ç”¨æˆ·+RPC ç»´åº¦ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é™åˆ¶ /user/tiger/warhouse è·¯å¾„çš„ create è¯·æ±‚ä¸º 100 QPSï¼Œæˆ–è€…æŸä¸ªç”¨æˆ·çš„ delete è¯·æ±‚ä¸º 5 QPSã€‚ä¸€æ—¦è¯¥ç”¨æˆ·çš„è®¿é—®é‡è¶…è¿‡è¿™ä¸ªé˜ˆå€¼ï¼ŒNNProxy ä¼šè¿”å›ä¸€ä¸ªå¯é‡è¯•å¼‚å¸¸ï¼ŒClient æ”¶åˆ°è¿™ä¸ªå¼‚å¸¸åä¼šé‡è¯•ã€‚å› æ­¤è¢«é™æµçš„è·¯å¾„æˆ–ç”¨æˆ·ä¼šæ„Ÿè§‰åˆ°è®¿é—® HDFS å˜æ…¢ï¼Œä½†æ˜¯å¹¶ä¸ä¼šå¤±è´¥ã€‚<br><br><br></p><p><a name="a95em"></a></p><h3 id="Dance-NNï¼ˆDance-Name-Nodeï¼‰"><a href="#Dance-NNï¼ˆDance-Name-Nodeï¼‰" class="headerlink" title="Dance NNï¼ˆDance Name Nodeï¼‰"></a>Dance NNï¼ˆDance Name Nodeï¼‰</h3><p><a name="lhQQ9"></a></p><h4 id="è§£å†³çš„é—®é¢˜"><a href="#è§£å†³çš„é—®é¢˜" class="headerlink" title="è§£å†³çš„é—®é¢˜"></a>è§£å†³çš„é—®é¢˜</h4><p>å¦‚å‰æ‰€è¿°ï¼Œåœ¨æ•°æ®é‡ä¸Šåˆ° EB çº§åˆ«çš„åœºæ™¯åï¼ŒåŸæœ‰çš„ Java ç‰ˆæœ¬çš„ Name Node å­˜åœ¨äº†éå¸¸å¤šçš„çº¿ä¸Šé—®é¢˜éœ€è¦è§£å†³ã€‚ä»¥ä¸‹æ˜¯åœ¨å®è·µè¿‡ç¨‹ä¸­æˆ‘ä»¬é‡åˆ°çš„ä¸€äº›é—®é¢˜æ€»ç»“ï¼š<br></p><ul><li>Java ç‰ˆæœ¬ Name Node é‡‡ç”¨ Java è¯­è¨€å¼€å‘ï¼Œåœ¨ INode è§„æ¨¡ä¸Šäº¿æ—¶ï¼Œä¸å¯é¿å…çš„ä¼šå¸¦æ¥ä¸¥é‡çš„ GC é—®é¢˜ï¼›</li><li>Java ç‰ˆæœ¬ Name Node å°† INode meta ä¿¡æ¯å®Œå…¨æ”¾ç½®äºå†…å­˜ï¼Œ10 äº¿ INode å¤§çº¦å ç”¨ 800GB å†…å­˜ï¼ˆåŒ…å« JVM è‡ªèº«å ç”¨çš„éƒ¨åˆ† native memoryï¼‰ï¼Œæ›´è¿›ä¸€æ­¥åŠ é‡äº† GCï¼›</li><li>æˆ‘ä»¬ç›®å‰çš„é›†ç¾¤è§„æ¨¡ä¸‹ï¼ŒName Node ä»é‡å¯åˆ°æ¢å¤æœåŠ¡éœ€è¦ 6 ä¸ªå°æ—¶ï¼Œåœ¨ä¸»å¤‡åŒæ—¶å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹ï¼Œä¸¥é‡å½±å“ä¸Šå±‚ä¸šåŠ¡ï¼›</li><li>Java ç‰ˆæœ¬ Name Node å…¨å±€ä¸€æŠŠè¯»å†™é”ï¼Œä»»ä½•å¯¹ç›®å½•æ ‘çš„ä¿®æ”¹æ“ä½œéƒ½ä¼šé˜»å¡å…¶ä»–çš„è¯»å†™æ“ä½œï¼Œå¹¶å‘åº¦è¾ƒä½ï¼›</li></ul><p>ä»ä¸Šå¯ä»¥çœ‹å‡ºï¼Œåœ¨å¤§æ•°æ®é‡åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬äºŸéœ€ä¸€ä¸ªæ–°æ¶æ„ç‰ˆæœ¬çš„ Name Node æ¥æ‰¿è½½æˆ‘ä»¬çš„æµ·é‡å…ƒæ•°æ®ã€‚é™¤äº† C++è¯­è¨€é‡å†™æ¥è§„é¿ Java å¸¦æ¥çš„ GC é—®é¢˜ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜åœ¨ä¸€äº›åœºæ™¯ä¸‹åšäº†ç‰¹æ®Šçš„ä¼˜åŒ–ã€‚<br></p><p><a name="1ILjM"></a></p><h4 id="ç›®å½•æ ‘é”è®¾è®¡"><a href="#ç›®å½•æ ‘é”è®¾è®¡" class="headerlink" title="ç›®å½•æ ‘é”è®¾è®¡"></a>ç›®å½•æ ‘é”è®¾è®¡</h4><p><br>HDFS å¯¹å†…æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤ï¼Œå¯¹å¤–æä¾›çš„æ˜¯ä¸€ä¸ª unified çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å¯¹æ–‡ä»¶åŠç›®å½•çš„æ“ä½œéœ€è¦åƒæ“ä½œ Linux æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸€æ ·ã€‚è¿™å°±è¦æ±‚ HDFS æ»¡è¶³ç±»ä¼¼äºæ•°æ®åº“ç³»ç»Ÿä¸­ ACID ç‰¹æ€§ä¸€æ ·çš„åŸå­æ€§ï¼Œä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§ã€‚å› æ­¤ DanceNN åœ¨é¢å¯¹å¤šä¸ªç”¨æˆ·åŒæ—¶æ“ä½œåŒä¸€ä¸ªæ–‡ä»¶æˆ–è€…åŒä¸€ä¸ªç›®å½•æ—¶ï¼Œéœ€è¦ä¿è¯ä¸ä¼šç ´åæ‰ ACID å±æ€§ï¼Œéœ€è¦å¯¹æ“ä½œåšé”ä¿æŠ¤ã€‚<br><br><br>ä¸åŒäºä¼ ç»Ÿçš„ KV å­˜å‚¨å’Œæ•°æ®åº“è¡¨ç»“æ„ï¼ŒDanceNN ä¸Šç»´æŠ¤çš„æ˜¯ä¸€æ£µæ ‘çŠ¶çš„æ•°æ®ç»“æ„ï¼Œå› æ­¤å•çº¯çš„ key é”æˆ–è€…è¡Œé”åœ¨ DanceNN ä¸‹ä¸é€‚ç”¨ã€‚è€Œåƒæ•°æ®åº“çš„è¡¨é”æˆ–è€…åŸç”Ÿ NN çš„åšæ³•ï¼Œå¯¹æ•´æ£µç›®å½•æ ‘åŠ å•ç‹¬ä¸€æŠŠé”åˆä¼šä¸¥é‡çš„å½±å“æ•´ä½“ååå’Œå»¶è¿Ÿï¼Œå› æ­¤ DanceNN é‡æ–°è®¾è®¡äº†æ ‘çŠ¶é”ç»“æ„ï¼Œåšåˆ°ä¿è¯ ACID çš„æƒ…å†µä¸‹ï¼Œè¯»ååèƒ½å¤Ÿåˆ° 8wï¼Œå†™ååèƒ½å¤Ÿåˆ° 2wï¼Œæ˜¯åŸç”Ÿ NN æ€§èƒ½çš„ 10 å€ä»¥ä¸Šã€‚<br><br><br>è¿™é‡Œï¼Œæˆ‘ä»¬ä¼šé‡æ–°å¯¹ RPC åšåˆ†ç±»ï¼Œåƒ <code>createFile</code>ï¼Œ<code>getFileInfo</code>ï¼Œ<code>setXAttr</code> è¿™ç±» RPC ä¾ç„¶æ˜¯ç®€å•çš„å¯¹æŸä¸€ä¸ª INode è¿›è¡Œ CURD æ“ä½œï¼›åƒ <code>delete</code> RPCï¼Œæœ‰å¯èƒ½åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šåˆ é™¤ç›®å½•ï¼Œåè€…ä¼šå½±å“æ•´æ£µå­æ ‘ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼›åƒ <code>rename</code> RPCï¼Œåˆ™æ˜¯æ›´å¤æ‚çš„å¦å¤–ä¸€ç±»æ“ä½œï¼Œå¯èƒ½ä¼šæ¶‰åŠåˆ°å¤šä¸ª INodeï¼Œç”šè‡³æ˜¯å¤šæ£µå­æ ‘ä¸‹çš„æ‰€æœ‰ INodeã€‚<br></p><p><a name="FOHq3"></a></p><h4 id="DanceNN-å¯åŠ¨ä¼˜åŒ–"><a href="#DanceNN-å¯åŠ¨ä¼˜åŒ–" class="headerlink" title="DanceNN å¯åŠ¨ä¼˜åŒ–"></a>DanceNN å¯åŠ¨ä¼˜åŒ–</h4><p><br>ç”±äºæˆ‘ä»¬çš„ DanceNN åº•å±‚å…ƒæ•°æ®å®ç°äº†æœ¬åœ°ç›®å½•æ ‘ç®¡ç†ç»“æ„ï¼Œå› æ­¤æˆ‘ä»¬ DanceNN çš„å¯åŠ¨ä¼˜åŒ–éƒ½æ˜¯å›´ç»•ç€è¿™æ ·çš„è®¾è®¡æ¥åšçš„ã€‚<br><a name="cwcfb"></a></p><h5 id="-10"><a href="#-10" class="headerlink"></a></h5><p><a name="ygdYf"></a></p><h5 id="å¤šçº¿ç¨‹æ‰«æå’Œå¡«å……-BlockMap"><a href="#å¤šçº¿ç¨‹æ‰«æå’Œå¡«å……-BlockMap" class="headerlink" title="å¤šçº¿ç¨‹æ‰«æå’Œå¡«å…… BlockMap"></a>å¤šçº¿ç¨‹æ‰«æå’Œå¡«å…… BlockMap</h5><p>åœ¨ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯è¯»å–ç›®å½•æ ‘ä¸­ä¿å­˜çš„ä¿¡æ¯å¹¶ä¸”å¡«å…¥ BlockMap ä¸­ï¼Œç±»ä¼¼ Java ç‰ˆ NN è¯»å– FSImage çš„æ“ä½œã€‚åœ¨å…·ä½“å®ç°è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆèµ·å¤šä¸ªçº¿ç¨‹å¹¶è¡Œæ‰«æé™æ€ç›®å½•æ ‘ç»“æ„ã€‚å°†æ‰«æçš„ç»“æœæ”¾å…¥ä¸€ä¸ªåŠ é”çš„ Buffer ä¸­ã€‚å½“ Buffer ä¸­çš„å…ƒç´ ä¸ªæ•°è¾¾åˆ°è®¾å®šçš„æ•°é‡ä»¥åï¼Œé‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„ Buffer æ¥æ”¶è¯·æ±‚ï¼Œå¹¶åœ¨è€ Buffer ä¸Šèµ·ä¸€ä¸ªçº¿ç¨‹å°†æ•°æ®å¡«å…¥ BlockMapã€‚<br><a name="wPkVT"></a></p><h5 id="-11"><a href="#-11" class="headerlink"></a></h5><p><a name="GvGcm"></a></p><h5 id="æ¥æ”¶å—ä¸ŠæŠ¥ä¼˜åŒ–"><a href="#æ¥æ”¶å—ä¸ŠæŠ¥ä¼˜åŒ–" class="headerlink" title="æ¥æ”¶å—ä¸ŠæŠ¥ä¼˜åŒ–"></a>æ¥æ”¶å—ä¸ŠæŠ¥ä¼˜åŒ–</h5><p>DanceNN å¯åŠ¨ä»¥åä¼šé¦–å…ˆè¿›å…¥å®‰å…¨æ¨¡å¼ï¼Œæ¥æ”¶æ‰€æœ‰ Date Node çš„å—ä¸ŠæŠ¥ï¼Œå®Œå–„ BlockMap ä¸­ä¿å­˜çš„ä¿¡æ¯ã€‚å½“ä¸ŠæŠ¥çš„ Date Node è¾¾åˆ°ä¸€å®šæ¯”ä¾‹ä»¥åï¼Œæ‰ä¼šé€€å‡ºå®‰å…¨æ¨¡å¼ï¼Œè¿™æ—¶å€™æ‰èƒ½æ­£å¼æ¥æ”¶ client çš„è¯·æ±‚ã€‚æ‰€ä»¥æ¥æ”¶å—ä¸ŠæŠ¥çš„é€Ÿåº¦ä¹Ÿä¼šå½±å“ Date Node çš„å¯åŠ¨æ—¶é•¿ã€‚DanceNN è¿™é‡Œåšäº†ä¸€ä¸ªä¼˜åŒ–ï¼Œæ ¹æ® BlockID å°†ä¸åŒè¯·æ±‚åˆ†é…ç»™ä¸åŒçš„çº¿ç¨‹å¤„ç†ï¼Œæ¯ä¸ªçº¿ç¨‹è´Ÿè´£å›ºå®šçš„ Sliceï¼Œçº¿ç¨‹ä¹‹é—´æ— ç«äº‰ï¼Œè¿™æ ·å°±æå¤§çš„åŠ å¿«äº†æ¥æ”¶å—ä¸ŠæŠ¥çš„é€Ÿåº¦ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1590935398857-421715f0-1f68-40e2-a738-5d53fc518e03.webp#align=left&display=inline&height=412&margin=%5Bobject%20Object%5D&originHeight=412&originWidth=864&size=0&status=done&style=none&width=864" alt><br><br><br></p><p><a name="tCZ1r"></a></p><h3 id="æ…¢èŠ‚ç‚¹ä¼˜åŒ–"><a href="#æ…¢èŠ‚ç‚¹ä¼˜åŒ–" class="headerlink" title="æ…¢èŠ‚ç‚¹ä¼˜åŒ–"></a>æ…¢èŠ‚ç‚¹ä¼˜åŒ–</h3><p><br>æ…¢èŠ‚ç‚¹é—®é¢˜åœ¨å¾ˆå¤šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­éƒ½å­˜åœ¨ã€‚å…¶äº§ç”Ÿçš„åŸå› é€šå¸¸ä¸ºä¸Šå±‚ä¸šåŠ¡çš„çƒ­ç‚¹æˆ–è€…åº•å±‚èµ„æºæ•…éšœã€‚ä¸Šå±‚ä¸šåŠ¡çƒ­ç‚¹ï¼Œä¼šå¯¼è‡´ä¸€äº›æ•°æ®åœ¨è¾ƒçŸ­çš„æ—¶é—´æ®µå†…è¢«é›†ä¸­è®¿é—®ã€‚è€Œåº•å±‚èµ„æºæ•…éšœï¼Œå¦‚å‡ºç°æ…¢ç›˜æˆ–è€…ç›˜æŸåï¼Œæ›´å¤šçš„è¯·æ±‚å°±ä¼šé›†ä¸­åˆ°æŸä¸€ä¸ªå‰¯æœ¬èŠ‚ç‚¹ä¸Šä»è€Œå¯¼è‡´æ…¢èŠ‚ç‚¹ã€‚<br><br><br>é€šå¸¸æ¥è¯´ï¼Œæ…¢èŠ‚ç‚¹é—®é¢˜çš„ä¼˜åŒ–å’Œä¸Šå±‚ä¸šåŠ¡éœ€æ±‚åŠåº•å±‚èµ„æºé‡æœ‰å¾ˆå¤§çš„å…³ç³»ï¼Œæç«¯æƒ…å†µï¼Œä¸Šå±‚è¯·æ±‚å¾ˆå°ï¼Œä¸‹å±‚èµ„æºå……åˆ†å¯Œè£•çš„æƒ…å†µä¸‹ï¼Œæ…¢èŠ‚ç‚¹é—®é¢˜å°†ä¼šéå¸¸å°‘ï¼Œåä¹‹åˆ™ä¼šå˜å¾—éå¸¸ä¸¥é‡ã€‚åœ¨å­—èŠ‚è·³åŠ¨çš„ HDFS é›†ç¾¤ä¸­ï¼Œæ…¢èŠ‚ç‚¹é—®é¢˜ä¸€åº¦éå¸¸ä¸¥é‡ï¼Œå°¤å…¶æ˜¯ç£ç›˜å ç”¨ç™¾åˆ†æ¯”éå¸¸é«˜ä»¥åï¼Œå„ç§æ…¢èŠ‚ç‚¹é—®é¢˜å±‚å‡ºä¸ç©·ã€‚å…¶æ ¹æœ¬åŸå› å°±æ˜¯èµ„æºçš„å¹³è¡¡æ»åï¼Œè®¸å¤šæœºå™¨çš„ç£ç›˜å ç”¨å·²ç»è§¦åŠçº¢çº¿å¯¼è‡´å†™é™çº§ï¼›æ–°å¢çƒ­èµ„æºåˆ™ä¼šé›†ä¸­åˆ°å°‘é‡æœºå™¨ä¸Šï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå½“ä¸Šå±‚ä¸šåŠ¡çš„æ¯ç§’è¯·æ±‚æ•°å‡é«˜åï¼Œå¯¹äº P999 æ—¶å»¶è¦æ±‚æ¯”è¾ƒé«˜çš„ä¸€äº›å¤§æ•°æ®åˆ†ææŸ¥è¯¢ä¸šåŠ¡å°±å®¹æ˜“å‡ºç°ä¸€å¤§æ‰¹æ•°æ®è®¿é—®ï¼ˆ&gt;10000 è¯·æ±‚ï¼‰è¢«å¡åœ¨æŸä¸ªæ…¢è¯·æ±‚çš„å¤„ç†ä¸Šã€‚<br><br><br>æˆ‘ä»¬ä¼˜åŒ–çš„æ–¹å‘ä¼šåˆ†ä¸ºè¯»æ…¢èŠ‚ç‚¹å’Œå†™æ…¢èŠ‚ç‚¹ä¸¤ä¸ªæ–¹é¢ã€‚<br></p><p><a name="PwyJV"></a></p><h4 id="è¯»æ…¢èŠ‚ç‚¹ä¼˜åŒ–"><a href="#è¯»æ…¢èŠ‚ç‚¹ä¼˜åŒ–" class="headerlink" title="è¯»æ…¢èŠ‚ç‚¹ä¼˜åŒ–"></a>è¯»æ…¢èŠ‚ç‚¹ä¼˜åŒ–</h4><p>æˆ‘ä»¬ç»å†äº†å‡ ä¸ªé˜¶æ®µï¼š</p><ul><li>æœ€æ—©ï¼Œä½¿ç”¨ç¤¾åŒºç‰ˆæœ¬ï¼Œå…¶ Switch Read ä»¥è¯»å–ä¸€ä¸ª packet çš„æ—¶é•¿ä¸ºç»Ÿè®¡å•ä½ï¼Œå½“è¯»å–ä¸€ä¸ª packet çš„æ—¶é—´è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œè®¤ä¸ºè¯»å–å½“å‰ packet è¶…æ—¶ã€‚å¦‚æœä¸€å®šæ—¶é—´çª—å£å†…è¶…æ—¶ packet çš„æ•°é‡è¿‡å¤šï¼Œåˆ™è®¤ä¸ºå½“å‰èŠ‚ç‚¹æ˜¯æ…¢èŠ‚ç‚¹ã€‚ä½†è¿™ä¸ªé—®é¢˜åœ¨äºä»¥ packet ä½œä¸ºç»Ÿè®¡å•ä½ä½¿å¾—ç®—æ³•ä¸å¤Ÿæ•æ„Ÿï¼Œè¿™æ ·ä½¿å¾—æ¯æ¬¡è¯»æ…¢èŠ‚ç‚¹å‘ç”Ÿçš„æ—¶å€™ï¼Œå¯¹äºå° IO åœºæ™¯ï¼ˆå­—èŠ‚è·³åŠ¨çš„ä¸€äº›ä¸šåŠ¡æ˜¯ä»¥å¤§é‡éšæœºå° IO ä¸ºå…¸å‹ä½¿ç”¨åœºæ™¯çš„ï¼‰ï¼Œè¿™äº›ä¸ªç§¯æ”’çš„ Packet å·²ç»é€ æˆäº†é—®é¢˜ã€‚</li></ul><ul><li>åç»­ï¼Œæˆ‘ä»¬ç ”å‘äº† Hedged Read çš„è¯»ä¼˜åŒ–ã€‚Hedged Read å¯¹æ¯ä¸€æ¬¡è¯»å–è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ã€‚å¦‚æœè¯»å–è¶…æ—¶ï¼Œé‚£ä¹ˆä¼šå¦å¼€ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨æ–°çš„çº¿ç¨‹ä¸­å‘ç¬¬äºŒä¸ªå‰¯æœ¬å‘èµ·è¯»è¯·æ±‚ï¼Œæœ€åå–ç¬¬ä¸€ç¬¬äºŒä¸ªå‰¯æœ¬ä¸Šä¼˜å…ˆè¿”å›çš„ response ä½œä¸ºè¯»å–çš„ç»“æœã€‚ä½†è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨æ…¢èŠ‚ç‚¹é›†ä¸­å‘ç”Ÿçš„æ—¶å€™ï¼Œä¼šå¯¼è‡´è¯»æµé‡æ”¾å¤§ã€‚ä¸¥é‡çš„æ—¶å€™ç”šè‡³å¯¼è‡´å°èŒƒå›´å¸¦å®½çŸ­æ—¶é—´å†…ä¸å¯ç”¨ã€‚</li></ul><ul><li>åŸºäºä¹‹å‰çš„ç»éªŒï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå¼€å¯äº† Fast Switch Read çš„ä¼˜åŒ–ï¼Œè¯¥ä¼˜åŒ–æ–¹å¼ä½¿ç”¨ååé‡ä½œä¸ºåˆ¤æ–­æ…¢èŠ‚ç‚¹çš„æ ‡å‡†ï¼Œå½“ä¸€æ®µæ—¶é—´çª—å£å†…çš„ååé‡å°äºé˜ˆå€¼æ—¶ï¼Œè®¤ä¸ºå½“å‰èŠ‚ç‚¹æ˜¯æ…¢èŠ‚ç‚¹ã€‚å¹¶ä¸”æ ¹æ®å½“å‰çš„è¯»å–çŠ¶å†µåŠ¨æ€åœ°è°ƒæ•´é˜ˆå€¼ï¼ŒåŠ¨æ€æ”¹å˜æ—¶é—´çª—å£çš„é•¿åº¦ä»¥åŠååé‡é˜ˆå€¼çš„å¤§å°ã€‚<br>ä¸‹è¡¨æ˜¯å½“æ—¶çº¿ä¸ŠæŸä¸šåŠ¡æµ‹è¯•çš„å€¼ï¼š</li></ul><table><thead><tr><th>Host:X.X.X.X</th><th>3 å‰¯æœ¬ Switch Read</th><th>2 å‰¯æœ¬ Hedged Read</th><th>3 å‰¯æœ¬ Hedged Read</th><th>3 å‰¯æœ¬ Fast Switch Readï¼ˆä¼˜åŒ–åç®—æ³•ï¼‰</th></tr></thead><tbody><tr><td>è¯»å–æ—¶é•¿ p999</td><td>977 ms</td><td>549 ms</td><td>192 ms</td><td><strong>128 ms</strong></td></tr><tr><td>æœ€é•¿è¯»å–æ—¶é—´</td><td>300 s</td><td>125 s</td><td>60 s</td><td><strong>15.5 s</strong></td></tr><tr><td>é•¿å°¾å‡ºç°æ¬¡æ•°ï¼ˆå¤§äº 500msï¼‰</td><td>238 æ¬¡/å¤©</td><td>75 æ¬¡/å¤©</td><td>15 æ¬¡/å¤©</td><td><strong>3 æ¬¡/å¤©</strong></td></tr><tr><td>é•¿å°¾å‡ºç°æ¬¡æ•°ï¼ˆå¤§äº 1000msï¼‰</td><td>196 æ¬¡/å¤©</td><td>64 æ¬¡/å¤©</td><td>6 æ¬¡/å¤©</td><td><strong>3 æ¬¡/å¤©</strong></td></tr></tbody></table><p><br>è¿›ä¸€æ­¥çš„ç›¸å…³æµ‹è¯•æ•°æ®ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1590935682709-6dceebc5-46fb-459b-a559-c238e04d66be.webp#align=left&display=inline&height=211&margin=%5Bobject%20Object%5D&originHeight=211&originWidth=746&size=0&status=done&style=none&width=746" alt><br><a name="aI0wv"></a></p><h4 id="-12"><a href="#-12" class="headerlink"></a></h4><p><a name="hBmkC"></a></p><h4 id="å†™æ…¢èŠ‚ç‚¹ä¼˜åŒ–"><a href="#å†™æ…¢èŠ‚ç‚¹ä¼˜åŒ–" class="headerlink" title="å†™æ…¢èŠ‚ç‚¹ä¼˜åŒ–"></a>å†™æ…¢èŠ‚ç‚¹ä¼˜åŒ–</h4><p><br>å†™æ…¢èŠ‚ç‚¹ä¼˜åŒ–çš„é€‚ç”¨åœºæ™¯ä¼šç›¸å¯¹ç®€å•ä¸€äº›ã€‚ä¸»è¦è§£å†³çš„æ˜¯å†™è¿‡ç¨‹ä¸­ï¼ŒPipeline çš„ä¸­é—´èŠ‚ç‚¹å˜æ…¢çš„æƒ…å†µã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿå‘å±•äº† Fast Failover å’Œ Fast Failover+ä¸¤ç§ç®—æ³•ã€‚<br><a name="2ceD5"></a></p><h5 id="-13"><a href="#-13" class="headerlink"></a></h5><p><a name="yHKlv"></a></p><h5 id="Fast-Failover"><a href="#Fast-Failover" class="headerlink" title="Fast Failover"></a>Fast Failover</h5><p>Fast Failover ä¼šç»´æŠ¤ä¸€æ®µæ—¶é—´å†… ACK æ—¶é—´è¿‡é•¿çš„ packet æ•°ç›®ï¼Œå½“è¶…æ—¶ ACK çš„æ•°é‡è¶…è¿‡é˜ˆå€¼åï¼Œä¼šç»“æŸå½“å‰çš„ blockï¼Œå‘ namenode ç”³è¯·æ–°å—ç»§ç»­å†™å…¥ã€‚<br><br><br>Fast Failover çš„é—®é¢˜åœ¨äºï¼Œéšæ„ç»“æŸå½“å‰çš„ block ä¼šé€ æˆç³»ç»Ÿçš„å° block æ•°ç›®å¢åŠ ï¼Œç»™ä¹‹åçš„è¯»å–é€Ÿåº¦ä»¥åŠ namenode çš„å…ƒæ•°æ®ç»´æŠ¤éƒ½å¸¦æ¥è´Ÿé¢å½±å“ã€‚æ‰€ä»¥ Fast Failover ç»´æŠ¤äº†ä¸€ä¸ªåˆ‡æ¢é˜ˆå€¼ï¼Œå¦‚æœå·²å†™å…¥çš„æ•°æ®é‡ï¼ˆblock çš„å¤§å°ï¼‰å¤§äºè¿™ä¸ªé˜ˆå€¼ï¼Œæ‰ä¼šè¿›è¡Œ block åˆ‡æ¢ã€‚<br><br><br>ä½†æ˜¯å¾€å¾€ä¸ºäº†è¾¾åˆ°è¿™ä¸ªå†™å…¥æ•°æ®å¤§å°é˜ˆå€¼ï¼Œå°±ä¼šé€ æˆç”¨æˆ·éš¾ä»¥æ¥æ”¶çš„å»¶è¿Ÿï¼Œå› æ­¤å½“æ•°æ®é‡å°äºé˜ˆæ—¶éœ€è¦è¿›é¢å¤–çš„ä¼˜åŒ–ã€‚<br><a name="Ohd15"></a></p><h5 id="-14"><a href="#-14" class="headerlink"></a></h5><p><a name="Hq46w"></a></p><h5 id="Fast-Failover-1"><a href="#Fast-Failover-1" class="headerlink" title="Fast Failover+"></a>Fast Failover+</h5><p>ä¸ºäº†è§£å†³ä¸Šè¿°çš„é—®é¢˜ï¼Œå½“å·²å†™å…¥çš„æ•°æ®é‡ï¼ˆblock çš„å¤§å°ï¼‰å°äºé˜ˆå€¼æ—¶ï¼Œæˆ‘ä»¬å¼•å…¥äº†æ–°çš„ä¼˜åŒ–æ‰‹æ®µâ€”â€”Fast Failover+ã€‚è¯¥ç®—æ³•é¦–å…ˆä» pipeline ä¸­ç­›é€‰å‡ºé€Ÿåº¦è¾ƒæ…¢çš„ datanodeï¼Œå°†æ…¢èŠ‚ç‚¹ä»å½“å‰ pipeline ä¸­å‰”é™¤ï¼Œå¹¶è¿›å…¥ Pipeline Recovery é˜¶æ®µã€‚Pipeline Recovery ä¼šå‘ namenode ç”³è¯·ä¸€ä¸ªæ–°çš„ datanodeï¼Œä¸å‰©ä¸‹çš„ datanode ç»„æˆä¸€ä¸ªæ–°çš„ pipelineï¼Œå¹¶å°†å·²å†™å…¥çš„æ•°æ®åŒæ­¥åˆ°æ–°çš„ datanode ä¸Šï¼ˆè¯¥æ­¥éª¤ç§°ä¸º transfer blockï¼‰ã€‚ç”±äºå·²ç»å†™å…¥çš„æ•°æ®é‡è¾ƒå°ï¼Œtransfer block çš„è€—æ—¶å¹¶ä¸é«˜ã€‚ç»Ÿè®¡ p999 å¹³å‡è€—æ—¶åªæœ‰ 150msã€‚ç”± Pipeline Recovery æ‰€å¸¦æ¥çš„é¢å¤–æ¶ˆè€—æ˜¯å¯æ¥å—çš„ã€‚<br><br><br>ä¸‹è¡¨æ˜¯å½“æ—¶çº¿ä¸ŠæŸä¸šåŠ¡æµ‹è¯•çš„å€¼ï¼š</p><table><thead><tr><th>Host:X.X.X.X</th><th>Fast Failover p99</th><th>Fast Failover+ p99 <strong>(ä¼˜åŒ–åç®—æ³•)</strong></th><th>Fast Failover p95</th><th>Fast Failover+ p95 <strong>(ä¼˜åŒ–åç®—æ³•)</strong></th></tr></thead><tbody><tr><td>å¹³å‡ Flush æ—¶é•¿</td><td>1.49 s</td><td><strong>1.23 s</strong></td><td>182 ms</td><td><strong>147 ms</strong></td></tr><tr><td>æœ€é•¿ Flush æ—¶é—´</td><td>80 s</td><td><strong>66 s</strong></td><td>9.7 s</td><td><strong>6.5 s</strong></td></tr><tr><td>é•¿å°¾å‡ºç°æ¬¡æ•°ï¼ˆp99 å¤§äº 10s, p95 å¤§äº 1sï¼‰</td><td>63 æ¬¡/å¤©</td><td><strong>38 æ¬¡/å¤©</strong></td><td>94 æ¬¡/å¤©</td><td><strong>55 æ¬¡/å¤©</strong></td></tr><tr><td>é•¿å°¾å‡ºç°æ¬¡æ•°ï¼ˆp99 å¤§äº 5s, p95 å¤§äº 0.5sï¼‰</td><td>133 æ¬¡/å¤©</td><td><strong>101 æ¬¡/å¤©</strong></td><td>173 æ¬¡/å¤©</td><td><strong>156 æ¬¡/å¤©</strong></td></tr></tbody></table><p>ä¸€äº›è¿›ä¸€æ­¥çš„å®é™…æ•ˆæœå¯¹æ¯”ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1590935682666-c4712d74-258e-44be-b16d-a6a773f9fcbb.webp#align=left&display=inline&height=232&margin=%5Bobject%20Object%5D&originHeight=232&originWidth=734&size=0&status=done&style=none&width=734" alt><br><a name="d4UFq"></a></p><h1 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h1><p>HDFS åœ¨å­—èŠ‚è·³åŠ¨çš„å‘å±•å†ç¨‹å·²ç»éå¸¸é•¿äº†ã€‚ä»æœ€åˆçš„å‡ ç™¾å°çš„é›†ç¾¤è§„æ¨¡æ”¯æŒ PB çº§åˆ«çš„æ•°æ®é‡ï¼Œåˆ°ç°åœ¨å‡ ä¸‡å°çº§åˆ«å¤šé›†ç¾¤çš„å¹³å°æ”¯æŒ EB çº§åˆ«çš„æ•°æ®é‡ï¼Œæˆ‘ä»¬ç»å†äº† 7 å¹´çš„å‘å±•ã€‚ä¼´éšç€ä¸šåŠ¡çš„å¿«é€Ÿä¸Šé‡ï¼Œæˆ‘ä»¬å›¢é˜Ÿä¹Ÿç»å†äº†é‡è›®å¼çˆ†å‘ï¼Œè§„æ¨¡åŒ–å‘å±•ï¼Œå¹³å°åŒ–è¿è¥çš„é˜¶æ®µã€‚è¿™è¿‡ç¨‹ä¸­æˆ‘ä»¬è¸©äº†ä¸å°‘å‘ï¼Œä¹Ÿç§¯ç´¯äº†ç›¸å½“ä¸°å¯Œçš„ç»éªŒã€‚å½“ç„¶ï¼Œæœ€é‡è¦çš„ï¼Œå…¬å¸è¿˜åœ¨æŒç»­é«˜é€Ÿå‘å±•ï¼Œè€Œæˆ‘ä»¬ä»æ—§ä¸å¿˜åˆå¿ƒï¼ŒåšæŒâ€œDAY ONEâ€ï¼Œç»§ç»­åœ¨è·¯ä¸Šã€‚<br><br><br></p><p><a name="mZaR7"></a></p><h1 id="å­¦ä¹ æ€»ç»“"><a href="#å­¦ä¹ æ€»ç»“" class="headerlink" title="å­¦ä¹ æ€»ç»“"></a>å­¦ä¹ æ€»ç»“</h1><p><br>æ¥å…¥å±‚ï¼šæ¥å…¥å±‚æ˜¯å­—èŠ‚è®¾è®¡å‡å¦‚çš„ä¸€å±‚ï¼Œåœ¨ä¸Šä¸‡èŠ‚ç‚¹çš„HDFSé›†ç¾¤ä¸­ï¼Œå¿…ç„¶è¦ä½¿ç”¨å¤šNameNodeæ¨¡å¼ï¼Œé‚£ä¹ˆå¯¹äºç”¨æˆ·å¤§é‡çš„è¯·æ±‚ç»Ÿä¸€ç®¡ç†ï¼Œå­—èŠ‚å¼•å…¥äº†æ¥å…¥å±‚ï¼Œå…·ä½“å®ç°å€Ÿç”¨Redisï¼ŒMysqlä»¥åŠNNProxyè½¬å‘è·¯ç”±ç­‰å¤–ç•Œç»„ä»¶å®ç°ã€‚<br><br><br>å…ƒæ•°æ®å±‚ï¼šè¿™é‡Œé¢æœ‰ä¸€ç‚¹ï¼Œåœ¨å­—èŠ‚çš„HDFSé›†ç¾¤ä¸­ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ç¤¾åŒºç‰ˆçš„QJM HAé«˜å¯ç”¨æ–¹æ¡ˆï¼Œè€Œæ˜¯ä½¿ç”¨äº†BookKeeperã€‚Apache bookkeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ï¼Œå¯æ‰©å±•ï¼Œå®¹é”™ï¼ˆå¤šå‰¯æœ¬ï¼‰ï¼Œä½å»¶è¿Ÿçš„å­˜å‚¨ç³»ç»Ÿï¼Œå…¶æä¾›äº†é«˜æ€§èƒ½ï¼Œé«˜ååçš„å­˜å‚¨èƒ½åŠ›ã€‚è€ŒQJM/Qurom Journal Manageræ˜¯Cloueraæå‡ºçš„ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºPaxosç®—æ³•å®ç°çš„HDFS HAæ–¹æ¡ˆ<br><br><br>æ•°æ®å±‚å€’æ˜¯æ²¡ä»€ä¹ˆç‰¹åˆ«çš„æ”¹å–„<br><br><br>å¯ä»¥çœ‹å‡ºï¼Œå­—èŠ‚çš„æ•°æ®æš´æ¶¨é˜¶æ®µï¼Œé¦–å…ˆé‡åˆ°çš„é—®é¢˜æ˜¯Name Nodeçš„ç“¶é¢ˆï¼Œè€Œæ­¤æ—¶å­—èŠ‚çš„é›†ç¾¤ç¯å¢ƒä¸ºå•é›†ç¾¤ï¼Œæ­¤æ—¶çš„è§£å†³æ–¹æ¡ˆæ˜¯é‡‡ç”¨Federationã€‚</p><p>æ•°æ®æŒç»­é«˜é€Ÿå¢é•¿ï¼ŒFederation æ–¹å¼ä¸‹çš„ç›®å½•æ ‘ç®¡ç†ä¹Ÿå­˜åœ¨ç“¶é¢ˆï¼Œä¸»è¦åŸå› æ˜¯Javaé¢‘ç¹GCï¼Œé‚£ä¹ˆå­—èŠ‚çš„è§£å†³æ–¹æ¡ˆå°±æ˜¾å¾—æœ‰äº›ç¡¬æ ¸äº†ï¼Œé‡å†™äº†NameNodeï¼Œåœ¨å­—èŠ‚ä¸­å«åšDanceNN ğŸ‚ğŸºã€‚</p><p>åœ¨æ•°æ®è¶…è¿‡EBçº§åˆ«ä¹‹åï¼Œé‡åˆ°çš„é—®é¢˜å°±æ›´å¤šäº†ã€‚ä¸åŒç²’åº¦æœåŠ¡åˆ†çº§ï¼Œå…ƒæ•°æ®å­˜å‚¨ç“¶é¢ˆï¼Œæ…¢èŠ‚ç‚¹ç­‰é—®é¢˜ã€‚é‚£ä¹ˆå­—èŠ‚çš„è§£å†³æ–¹æ¡ˆåˆ™æ˜¯è€ƒè™‘åˆ°ä¸€æ–¹é¢ä»å­˜å‚¨æ–¹é¢çš„æ•°æ®èŠ‚ç‚¹è¿›è¡Œé‡æ„ï¼Œå¦ä¸€æ–¹é¢å¯¹äºå¤§å—çš„å…ƒæ•°æ®è¿›è¡Œåˆ†çº§ã€‚</p><p>è¿™é‡Œè¦è¯´ä¸€ä¸‹ä¸Šé¢æåˆ°çš„NNProxyï¼Œå¥½ç”¨ï¼ï¼ä¸»è¦æœ‰ä¸¤ä¸ªåŠŸèƒ½å¾ˆå¸å¼•æˆ‘ï¼Œåœ¨Hadoopé›†ç¾¤åŸæœ‰çš„åŸºç¡€ä¸Šï¼Œå­—èŠ‚æ·»åŠ äº†NNProxyï¼Œä¸€ä¸ªæ˜¯æ ¹æ®ç”¨æˆ·è¯·æ±‚çš„è·¯å¾„è½¬å‘åˆ°ä¸åŒçš„HDFSç©ºé—´ï¼ŒäºŒå‘¢ï¼Œå¯¹å¤šç§Ÿæˆ·çš„åœºæ™¯ä¸‹ï¼Œå¯¹æ¯ä¸ªç”¨æˆ·çš„è¯·æ±‚åšåˆ¤æ–­ï¼Œå¦‚æœæŸä¸ªè¯·æ±‚é‡è¿‡å¤§ï¼Œåˆ™ä¼šå¯¹å…¶é™æµã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä¹Ÿé¢†ç•¥åˆ°äº†ä¸€ä¸ªåœºæ™¯ï¼Œé‚£å°±æ˜¯åœ¨å­—èŠ‚EBçº§åˆ«çš„é›†ç¾¤è§„æ¨¡ä¸‹ï¼Œé›†ç¾¤é‡å¯åˆ°å…¨éƒ¨æœåŠ¡æ¢å¤ï¼Œéœ€è¦6ä¸ªå°æ—¶å·¦å³ã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:12 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;è½¬è½½è‡ª&lt;a href=&quot;https://juejin.im/post/5e0aac53e51d4575e82591e8&quot; target=&quot;_bl
      
    
    </summary>
    
    
      <category term="å¤§æ•°æ®" scheme="cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="hdfs" scheme="cpeixin.cn/tags/hdfs/"/>
    
  </entry>
  
  <entry>
    <title>GPT-2 Chinese è‡ªåŠ¨ç”Ÿæˆæ–‡ç«  - ç¯å¢ƒå‡†å¤‡</title>
    <link href="cpeixin.cn/2020/01/01/GPT-2-Chinese-%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E6%96%87%E7%AB%A0-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/"/>
    <id>cpeixin.cn/2020/01/01/GPT-2-Chinese-%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E6%96%87%E7%AB%A0-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/</id>
    <published>2020-01-01T14:28:43.000Z</published>
    <updated>2020-04-13T09:28:23.224Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><p><a name="R14AA"></a></p><h2 id="Google-Colab"><a href="#Google-Colab" class="headerlink" title="Google Colab"></a>Google Colab</h2><p><br>Colaboratory æ˜¯ä¸€ä¸ª Google ç ”ç©¶é¡¹ç›®ï¼Œæ—¨åœ¨å¸®åŠ©ä¼ æ’­æœºå™¨å­¦ä¹ åŸ¹è®­å’Œç ”ç©¶æˆæœã€‚å®ƒæ˜¯ä¸€ä¸ª Jupyter ç¬”è®°æœ¬ç¯å¢ƒï¼Œä¸éœ€è¦è¿›è¡Œä»»ä½•è®¾ç½®å°±å¯ä»¥ä½¿ç”¨ï¼Œå¹¶ä¸”å®Œå…¨åœ¨äº‘ç«¯è¿è¡Œã€‚<br><br><br>Colaboratory ç¬”è®°æœ¬å­˜å‚¨åœ¨ Google äº‘ç«¯ç¡¬ç›˜ä¸­ï¼Œå¹¶ä¸”å¯ä»¥å…±äº«ï¼Œå°±å¦‚åŒæ‚¨ä½¿ç”¨ Google æ–‡æ¡£æˆ–è¡¨æ ¼ä¸€æ ·ã€‚Colaboratory å¯å…è´¹ä½¿ç”¨ã€‚åˆ©ç”¨Colaboratory ï¼Œå¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨Keras,TensorFlow,PyTorchç­‰æ¡†æ¶è¿›è¡Œæ·±åº¦å­¦ä¹ åº”ç”¨çš„å¼€å‘ã€‚<br><br><br>ç¼ºç‚¹æ˜¯æœ€å¤šåªèƒ½è¿è¡Œ12å°æ—¶ï¼Œæ—¶é—´ä¸€åˆ°å°±ä¼šæ¸…ç©ºVMä¸Šæ‰€æœ‰æ•°æ®ã€‚è¿™åŒ…æ‹¬æˆ‘ä»¬å®‰è£…çš„è½¯ä»¶ï¼ŒåŒ…æ‹¬æˆ‘ä»¬ä¸‹è½½çš„æ•°æ®ï¼Œå­˜æ”¾çš„è®¡ç®—ç»“æœï¼Œ æ‰€ä»¥æœ€å¥½ä¸è¦ç›´æ¥åœ¨colabä¸Šè¿›è¡Œæ–‡ä»¶çš„ä¿®æ”¹ï¼Œä»¥é˜²ä¿å­˜ä¸åŠæ—¶è€Œé€ æˆä¸¢å¤±ï¼Œè€Œä¸”Google Driveåªæœ‰å…è´¹çš„15Gç©ºé—´ï¼Œå¦‚æœè®­ç»ƒæ–‡ä»¶å¾ˆå¤§çš„è¯ï¼Œéœ€è¦æ‰©å®¹ã€‚<br><br><br><strong>ä¼˜ç‚¹ å…è´¹ï¼ å…è´¹ï¼å…è´¹ï¼</strong><br>**<br><a name="dpofS"></a></p><h3 id="è°·æ­Œäº‘ç›˜"><a href="#è°·æ­Œäº‘ç›˜" class="headerlink" title="è°·æ­Œäº‘ç›˜"></a>è°·æ­Œäº‘ç›˜</h3><p><br>å½“ç™»å½•è´¦å·è¿›å…¥<a href="https://drive.google.com/drive/my-drive" target="_blank" rel="external nofollow noopener noreferrer">è°·æ­Œäº‘ç›˜</a>æ—¶ï¼Œç³»ç»Ÿä¼šç»™äºˆ15Gå…è´¹ç©ºé—´å¤§å°ã€‚ç”±äºColabéœ€è¦ä¾é è°·æ­Œäº‘ç›˜ï¼Œæ•…éœ€è¦åœ¨äº‘ç›˜ä¸Šæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ¥å­˜æ”¾ä½ çš„ä»£ç æˆ–è€…æ•°æ®ã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1583723531238-28bbbd81-69e8-472d-b048-1ac67166a201.png#align=left&display=inline&height=612&name=image.png&originHeight=612&originWidth=1268&size=104029&status=done&style=none&width=1268" alt="image.png"><br>å¯ä»¥çœ‹åˆ°ä¸Šå›¾ï¼Œæˆ‘çš„å­˜å‚¨ç©ºé—´å‡ ä¹å¿«æ»¡äº†ï¼Œåœ¨é€‰æ‹©è¿›è¡Œæ‰©å®¹çš„æ—¶å€™å‘¢ï¼Œåˆ™éœ€è¦å›½å¤–é“¶è¡Œå¡å’Œå›½å¤–æ”¯ä»˜æ–¹å¼ï¼Œè¿™ä¸€ç‚¹å°±æœ‰ç‚¹å¤´ç—›ï¼Œä½†æ˜¯ä¸è¦å¿˜è®°ä¸‡èƒ½çš„æ·˜å®ï¼Œæœ€åé€šè¿‡æ·˜å®çš„ï¼ŒèŠ±è´¹20å…ƒå·¦å³ï¼Œå°±å‡çº§åˆ°äº†æ— é™ç©ºé—´ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œå‡çº§å­˜å‚¨ç©ºé—´çš„æ–¹å¼æ˜¯æ·»åŠ ä¸€å—å…±äº«äº‘ç›˜ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><a name="EHdj9"></a></p><h3 id="å¼•å…¥Colab"><a href="#å¼•å…¥Colab" class="headerlink" title="å¼•å…¥Colab"></a>å¼•å…¥Colab</h3><p><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1583723706098-527d9fff-e46e-4dd1-b92a-0640b0d61555.png#align=left&display=inline&height=674&name=image.png&originHeight=674&originWidth=1125&size=104056&status=done&style=none&width=1125" alt="image.png"><br><br><br><br><br></p><p><a name="kykCO"></a></p><h3 id="è®¾ç½®GPUç¯å¢ƒ"><a href="#è®¾ç½®GPUç¯å¢ƒ" class="headerlink" title="è®¾ç½®GPUç¯å¢ƒ"></a>è®¾ç½®GPUç¯å¢ƒ</h3><p><br>æ‰“å¼€colabåï¼Œæˆ‘ä»¬è¦è®¾ç½®è¿è¡Œç¯å¢ƒã€‚â€ä¿®æ”¹â€â€”&gt;â€ç¬”è®°æœ¬è®¾ç½®â€<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1583723911273-f07371f9-e982-44b2-af34-b3781f294879.png#align=left&display=inline&height=739&name=image.png&originHeight=739&originWidth=1191&size=94677&status=done&style=none&width=1191" alt="image.png"><br><br><br></p><p><a name="f4U2h"></a></p><h3 id="æŒ‚è½½å’Œåˆ‡æ¢å·¥ä½œç›®å½•"><a href="#æŒ‚è½½å’Œåˆ‡æ¢å·¥ä½œç›®å½•" class="headerlink" title="æŒ‚è½½å’Œåˆ‡æ¢å·¥ä½œç›®å½•"></a>æŒ‚è½½å’Œåˆ‡æ¢å·¥ä½œç›®å½•</h3><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> google.colab <span class="keyword">import</span> drive</span><br><span class="line">drive.mount(<span class="string">'/content/drive'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># os.chdir('/content/drive/My Drive/code/GPT2-Chinese') # åŸæœ¬Google driveçš„ç›®å½•</span></span><br><span class="line"></span><br><span class="line">os.chdir(<span class="string">'/content/drive/Shared drives/brentfromchina/code_warehouse/GPT2-Chinese'</span>) <span class="comment">## å…±äº«äº‘ç›˜çš„ç›®å½•</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š My Drive ä»£è¡¨ä½ çš„googleç½‘ç›˜æ ¹ç›®å½•</p><pre><code>code/GPT2-Chinese æˆ–è€… code_warehouse/GPT2-Chinese ä»£è¡¨ç½‘ç›˜ä¸­ä½ çš„ç¨‹åºæ–‡ä»¶ç›®å½•</code></pre><p><a name="MyewB"></a></p><h3 id="åœ¨Colabä¸­è¿è¡Œä»»åŠ¡"><a href="#åœ¨Colabä¸­è¿è¡Œä»»åŠ¡" class="headerlink" title="åœ¨Colabä¸­è¿è¡Œä»»åŠ¡"></a>åœ¨Colabä¸­è¿è¡Œä»»åŠ¡</h3><p>ä¸‹å›¾æ˜¯æˆ‘google driveä¸­çš„æ–‡ä»¶ç»“æ„ï¼Œ åœ¨é¡¹ç›®æ–‡ä»¶ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª.ipynbæ–‡ä»¶ï¼Œæ¥æ‰§è¡Œä½ çš„æ‰€æœ‰æ“ä½œã€‚</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1586769633567-4e4118a0-5c52-4517-9233-71d897e7fd68.png#align=left&display=inline&height=1748&name=%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202020-04-13%20%E4%B8%8B%E5%8D%885.15.46.png&originHeight=1748&originWidth=3096&size=378104&status=done&style=none&width=3096" alt="å±å¹•å¿«ç…§ 2020-04-13 ä¸‹åˆ5.15.46.png"></p><p><a name="GZDbL"></a></p><h3 id="ipynbæ–‡ä»¶å†…å®¹"><a href="#ipynbæ–‡ä»¶å†…å®¹" class="headerlink" title=".ipynbæ–‡ä»¶å†…å®¹"></a>.ipynbæ–‡ä»¶å†…å®¹</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1586769997876-4536842e-6bb3-4d6f-8df9-e220a66026a0.png#align=left&display=inline&height=1702&name=%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202020-04-13%20%E4%B8%8B%E5%8D%885.23.22.png&originHeight=1702&originWidth=3154&size=396138&status=done&style=none&width=3154" alt="å±å¹•å¿«ç…§ 2020-04-13 ä¸‹åˆ5.23.22.png"><br><br><br></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;&lt;a name=&quot;R14AA&quot;&gt;&lt;/a&gt;&lt;/p&gt;&lt;h2 id=&quot;Google-Colab&quot;&gt;&lt;a href=&quot;#Google-Colab&quot; cl
      
    
    </summary>
    
    
      <category term="NLP" scheme="cpeixin.cn/categories/NLP/"/>
    
    
      <category term="GPT-2" scheme="cpeixin.cn/tags/GPT-2/"/>
    
  </entry>
  
  <entry>
    <title>æ¶æ„æ€æƒ³</title>
    <link href="cpeixin.cn/2019/12/20/%E6%9E%B6%E6%9E%84%E6%80%9D%E6%83%B3/"/>
    <id>cpeixin.cn/2019/12/20/%E6%9E%B6%E6%9E%84%E6%80%9D%E6%83%B3/</id>
    <published>2019-12-20T02:26:15.000Z</published>
    <updated>2020-04-04T11:23:45.206Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><p><a name="-2"></a></p><h2><a href="#" class="headerlink"></a></h2><p>å…³äºä»€ä¹ˆæ˜¯æ¶æ„ï¼Œä¸€ç§æ¯”è¾ƒé€šä¿—çš„è¯´æ³•æ˜¯ â€œæœ€é«˜å±‚æ¬¡çš„è§„åˆ’ï¼Œéš¾ä»¥æ”¹å˜çš„å†³å®šâ€ï¼Œè¿™äº›è§„åˆ’å’Œå†³å®šå¥ å®šäº†äº‹ç‰©æœªæ¥å‘å±•çš„æ–¹å‘å’Œæœ€ç»ˆçš„è“å›¾ã€‚<br><br><br>ä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼Œäººç”Ÿè§„åˆ’ä¹Ÿæ˜¯ä¸€ç§æ¶æ„ã€‚é€‰ä»€ä¹ˆå­¦æ ¡ã€å­¦ä»€ä¹ˆä¸“ä¸šã€è¿›ä»€ä¹ˆå…¬å¸ã€æ‰¾ä»€ä¹ˆå¯¹è±¡ï¼Œè¿‡ä»€ä¹ˆæ ·çš„ç”Ÿæ´»ï¼Œéƒ½æ˜¯è‡ªå·±äººç”Ÿçš„æ¶æ„ã€‚<br><br><br>å…·ä½“åˆ°è½¯ä»¶æ¶æ„ï¼Œç»´åŸºç™¾ç§‘æ˜¯è¿™æ ·å®šä¹‰çš„ï¼šâ€œæœ‰å…³è½¯ä»¶æ•´ä½“ç»“æ„ä¸ç»„ä»¶çš„æŠ½è±¡æè¿°ï¼Œç”¨äºæŒ‡å¯¼å¤§å‹è½¯ä»¶ç³»ç»Ÿå„ä¸ªæ–¹é¢çš„è®¾è®¡â€ã€‚ç³»ç»Ÿçš„å„ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†åŠå…¶å…³ç³»æ„æˆäº†ç³»ç»Ÿçš„æ¶æ„ï¼Œè¿™äº›ç»„æˆéƒ¨åˆ†å¯ä»¥æ˜¯å…·ä½“çš„åŠŸèƒ½æ¨¡å—ï¼Œä¹Ÿå¯ä»¥æ˜¯éåŠŸèƒ½çš„è®¾è®¡ä¸å†³ç­–ï¼Œä»–ä»¬ç›¸äº’å…³ç³»ç»„æˆä¸€ä¸ªæ•´ä½“ï¼Œå…±åŒæ„æˆäº†è½¯ä»¶ç³»ç»Ÿçš„æ¶æ„ã€‚<br><br><br>æ¶æ„å…¶å®å°±æ˜¯æŠŠå¤æ‚çš„é—®é¢˜æŠ½è±¡åŒ–ã€ç®€å•åŒ–ï¼Œå¯èƒ½ä½ ä¼šè§‰å¾—â€œè¯´èµ·æ¥å®¹æ˜“ä½†åšèµ·æ¥éš¾â€ï¼Œå¦‚ä½•èƒ½å¿«é€Ÿä¸Šæ‰‹ã€‚å¯ä»¥å¤šè§‚å¯Ÿï¼Œæ ¹æ®ç‰©è´¨å†³å®šæ„è¯†ï¼Œå€ŸåŠ©ç”Ÿæ´»çœŸå®åœºæ™¯ï¼ˆç”¨æˆ·æ•…äº‹ï¼Œè¦å¾ˆå¤šæ•…äº‹ï¼‰æ¥è¿˜åŸè¿™ä¸€ç³»åˆ—é—®é¢˜ï¼ŒæŠ“ä½å¹¶æå–æ ¸å¿ƒç‰¹å¾ã€‚<br><a name="-3"></a></p><h4 id="æ¶æ„æ€æƒ³"><a href="#æ¶æ„æ€æƒ³" class="headerlink" title="æ¶æ„æ€æƒ³"></a>æ¶æ„æ€æƒ³</h4><p>CPUè¿ç®—é€Ÿåº¦&gt;&gt;&gt;&gt;&gt;å†…å­˜çš„è¯»å†™é€Ÿåº¦&gt;&gt;&gt;&gt;ç£ç›˜è¯»å†™é€Ÿåº¦</p><ul><li><p>æ»¡è¶³ä¸šåŠ¡å‘å±•éœ€æ±‚æ˜¯æœ€é«˜å‡†åˆ™</p></li><li><p>ä¸šåŠ¡å»ºæ¨¡ï¼ŒæŠ½è±¡å’Œæšä¸¾æ˜¯ä¸¤ç§æ–¹å¼ï¼Œéœ€è¦å¹³è¡¡ï¼Œä¸èƒ½èµ°æç«¯</p></li><li><p>æ¨¡å‹è¦èƒ½æ›´çœŸå®çš„ååº”äº‹ç‰©çš„æœ¬è´¨ï¼Œä¸æ˜¯åè¯æ¦‚å¿µçš„å †ç Œï¼Œä¸èƒ½è¿‡åº¦è®¾è®¡</p></li><li><p>åŸºç¡€æ¶æ„æœ€å…³é”®çš„æ˜¯åˆ†ç¦»ä¸åŒä¸šåŠ¡é¢†åŸŸã€ä¸åŒæŠ€æœ¯é¢†åŸŸï¼Œè®©æ•´ä¸ªç³»ç»Ÿå…·æœ‰æŒç»­ä¼˜åŒ–çš„èƒ½åŠ›ã€‚</p></li><li><p>åˆ†ç¦»åŸºç¡€æœåŠ¡ã€ä¸šåŠ¡è§„åˆ™ã€ä¸šåŠ¡æµç¨‹ï¼Œé€‰æ‹©åˆé€‚çš„å·¥å…·å¤–åŒ–ä¸šåŠ¡è§„åˆ™å’Œä¸šåŠ¡æµç¨‹</p></li><li><p>åˆ†ç¦»ä¸šåŠ¡ç»„ä»¶å’ŒæŠ€æœ¯ç»„ä»¶ï¼Œé«˜ç±»èšï¼Œä½è€¦åˆ - ä¸šåŠ¡ä¿¡æ¯çš„æ‰§è¡Œå¯ä»¥åˆ†æ•£ï¼Œä½†ä¸šåŠ¡ä¿¡æ¯çš„ç®¡ç†è¦å°½é‡é›†ä¸­</p></li><li><p>ä¸è¦è®©è½¯ä»¶çš„é€»è¾‘æ¶æ„ä¸æœ€åç‰©ç†éƒ¨ç½²ç»‘æ­» - é€‰æ‹©åˆé€‚çš„æŠ€æœ¯è€Œä¸æ˜¯é«˜æ·±çš„æŠ€æœ¯ï¼Œéšç€ä¸šåŠ¡çš„å‘å±•è°ƒæ•´ä½¿ç”¨çš„æŠ€æœ¯</p></li><li><p>å¥½çš„ç³»ç»Ÿæ¶æ„éœ€è¦åˆé€‚çš„ç»„ç»‡æ¶æ„å»ä¿éšœ - å›¢é˜Ÿæˆå‘˜æ€æƒ³çš„è½¬å˜ï¼Œæ¼«é•¿è€Œè‰°éš¾</p></li><li><p>ä¸šåŠ¡æ¶æ„ã€ç³»ç»Ÿæ¶æ„ã€æ•°æ®æ¨¡å‹<br><a name="-4"></a></p><h4 id="é¢å¯¹ä¸€å—æ–°ä¸šåŠ¡ï¼Œå¦‚ä½•ç³»ç»Ÿæ¶æ„ï¼Ÿ"><a href="#é¢å¯¹ä¸€å—æ–°ä¸šåŠ¡ï¼Œå¦‚ä½•ç³»ç»Ÿæ¶æ„ï¼Ÿ" class="headerlink" title="é¢å¯¹ä¸€å—æ–°ä¸šåŠ¡ï¼Œå¦‚ä½•ç³»ç»Ÿæ¶æ„ï¼Ÿ"></a>é¢å¯¹ä¸€å—æ–°ä¸šåŠ¡ï¼Œå¦‚ä½•ç³»ç»Ÿæ¶æ„ï¼Ÿ</h4></li><li><p>ä¸šåŠ¡åˆ†æï¼šè¾“å‡ºä¸šåŠ¡æ¶æ„å›¾ï¼Œè¿™ä¸ªç³»ç»Ÿé‡Œæœ‰å¤šå°‘ä¸ªä¸šåŠ¡æ¨¡å—ï¼Œä»å‰å°ç”¨æˆ·åˆ°åº•å±‚ä¸€å…±æœ‰å¤šå°‘å±‚ã€‚</p></li><li><p>ç³»ç»Ÿåˆ’åˆ†ï¼šæ ¹æ®ä¸šåŠ¡æ¶æ„å›¾è¾“å‡ºç³»ç»Ÿæ¶æ„å›¾ï¼Œéœ€è¦æ€è€ƒçš„æ˜¯è¿™å—ä¸šåŠ¡åˆ’åˆ†æˆå¤šå°‘ä¸ªç³»ç»Ÿï¼Œå¯èƒ½ä¸€ä¸ªç³»ç»Ÿèƒ½æ”¯æŒå¤šä¸ªä¸šåŠ¡ã€‚åŸºäºä»€ä¹ˆåŸåˆ™å°†ä¸€ä¸ªç³»ç»Ÿæ‹†åˆ†æˆå¤šä¸ªç³»ç»Ÿï¼ŸåˆåŸºäºä»€ä¹ˆåŸåˆ™å°†ä¸¤ä¸ªç³»ç»Ÿåˆå¹¶æˆä¸€ä¸ªç³»ç»Ÿï¼Ÿ</p></li><li><p>ç³»ç»Ÿåˆ†å±‚ï¼šç³»ç»Ÿæ˜¯å‡ å±‚æ¶æ„ï¼ŒåŸºäºä»€ä¹ˆåŸåˆ™å°†ä¸€ä¸ªç³»ç»Ÿè¿›è¡Œåˆ†å±‚ï¼Œåˆ†æˆå¤šå°‘å±‚ï¼Ÿ</p></li><li><p>æ¨¡å—åŒ–ï¼šç³»ç»Ÿé‡Œæœ‰å¤šå°‘ä¸ªæ¨¡å—ï¼Œå“ªäº›éœ€è¦æ¨¡å—åŒ–ï¼ŸåŸºäºä»€ä¹ˆåŸåˆ™å°†ä¸€ç±»ä»£ç å˜æˆä¸€ä¸ªæ¨¡å—ã€‚<br><a name="-5"></a></p><h4 id="å¦‚ä½•æ¨¡å—åŒ–"><a href="#å¦‚ä½•æ¨¡å—åŒ–" class="headerlink" title="å¦‚ä½•æ¨¡å—åŒ–"></a>å¦‚ä½•æ¨¡å—åŒ–</h4></li><li><p>åŸºäºæ°´å¹³åˆ‡åˆ†ã€‚æŠŠä¸€ä¸ªç³»ç»ŸæŒ‰ç…§ä¸šåŠ¡ç±»å‹è¿›è¡Œæ°´å¹³åˆ‡åˆ†æˆå¤šä¸ªæ¨¡å—ï¼Œæ¯”å¦‚æƒé™ç®¡ç†æ¨¡å—ï¼Œç”¨æˆ·ç®¡ç†æ¨¡å—ï¼Œå„ç§ä¸šåŠ¡æ¨¡å—ç­‰ã€‚</p></li><li><p>åŸºäºå‚ç›´åˆ‡åˆ†ã€‚æŠŠä¸€ä¸ªç³»ç»ŸæŒ‰ç…§ç³»ç»Ÿå±‚æ¬¡è¿›è¡Œå‚ç›´åˆ‡åˆ†æˆå¤šä¸ªæ¨¡å—ï¼Œå¦‚DAOå±‚ï¼ŒSERVICEå±‚ï¼Œä¸šåŠ¡é€»è¾‘å±‚ã€‚</p></li><li><p>åŸºäºå•ä¸€èŒè´£ã€‚å°†ä»£ç æŒ‰ç…§èŒè´£æŠ½è±¡å‡ºæ¥å½¢æˆä¸€ä¸ªä¸€ä¸ªçš„æ¨¡å—ã€‚å°†ç³»ç»Ÿä¸­åŒä¸€èŒè´£çš„ä»£ç æ”¾åœ¨ä¸€ä¸ªæ¨¡å—é‡Œã€‚æ¯”å¦‚æˆ‘ä»¬å¼€å‘çš„ç³»ç»Ÿè¦å¯¹æ¥å¤šä¸ªæ¸ é“çš„æ•°æ®ï¼Œæ¯ä¸ªæ¸ é“çš„å¯¹æ¥æ–¹å¼å’Œæ•°æ®è§£ææ–¹å¼ä¸ä¸€æ ·ï¼Œä¸ºé¿å…ä¸åŒæ¸ é“ä»£ç çš„ç›¸äº’å½±å“ï¼Œæˆ‘ä»¬æŠŠå„ä¸ªæ¸ é“çš„ä»£ç æ”¾åœ¨å„è‡ªçš„æ¨¡å—é‡Œã€‚</p></li><li><p>åŸºäºæ˜“å˜å’Œä¸æ˜“å˜ã€‚å°†ä¸æ˜“å˜çš„ä»£ç æŠ½è±¡åˆ°ä¸€ä¸ªæ¨¡å—é‡Œï¼Œæ¯”å¦‚ç³»ç»Ÿçš„æ¯”è¾ƒé€šç”¨çš„åŠŸèƒ½ã€‚å°†æ˜“å˜çš„ä»£ç æ”¾åœ¨å¦å¤–ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡å—é‡Œï¼Œæ¯”å¦‚ä¸šåŠ¡é€»è¾‘ã€‚å› ä¸ºæ˜“å˜çš„ä»£ç ç»å¸¸ä¿®æ”¹ï¼Œä¼šå¾ˆä¸ç¨³å®šï¼Œåˆ†å¼€ä¹‹åæ˜“å˜ä»£ç åœ¨ä¿®æ”¹æ—¶å€™ï¼Œä¸ä¼šå°†BUGä¼ æŸ“ç»™ä¸å˜çš„ä»£ç ã€‚<br><a name="-6"></a></p><h4 id="æå‡ç³»ç»Ÿçš„ç¨³å®šæ€§"><a href="#æå‡ç³»ç»Ÿçš„ç¨³å®šæ€§" class="headerlink" title="æå‡ç³»ç»Ÿçš„ç¨³å®šæ€§"></a>æå‡ç³»ç»Ÿçš„ç¨³å®šæ€§</h4></li><li><p>æµæ§</p></li></ul><p>åŒ11æœŸé—´ï¼Œå¯¹äºä¸€äº›é‡è¦çš„æ¥å£ï¼ˆæ¯”å¦‚å¸å·çš„æŸ¥è¯¢æ¥å£ï¼Œåº—é“ºé¦–é¡µï¼‰åšæµé‡æ§åˆ¶ï¼Œè¶…è¿‡é˜ˆå€¼ç›´æ¥è¿”å›å¤±è´¥ã€‚<br>å¦å¤–å¯¹äºä¸€äº›ä¸é‡è¦çš„ä¸šåŠ¡ä¹Ÿå¯ä»¥è€ƒè™‘é‡‡ç”¨é™çº§æ–¹æ¡ˆï¼Œå¤§ä¿ƒâ€”&gt;é‚®ä»¶ç³»ç»Ÿã€‚æ ¹æ®28åŸåˆ™ï¼Œæå‰å°†å¤§å–å®¶çº¦1Wå·¦å³åœ¨ç¼“å­˜ä¸­é¢„çƒ­ï¼Œå¹¶è®¾ç½®èµ·æ­¢æ—¶é—´ï¼Œæ´»åŠ¨æœŸé—´å†…è¿™éƒ¨åˆ†å¤§å–å®¶ä¸å‘äº¤æ˜“é‚®ä»¶æé†’ï¼Œä»¥å‡è½»SAé‚®ä»¶æœåŠ¡å™¨çš„å‹åŠ›ã€‚</p><ul><li>å®¹ç¾</li></ul><p>æœ€å¤§ç¨‹åº¦ä¿è¯ä¸»é“¾è·¯çš„å¯ç”¨æ€§ï¼Œæ¯”å¦‚æˆ‘è´Ÿè´£äº¤æ˜“çš„ä¸‹å•ï¼Œè€Œä¸‹å•è¿‡ç¨‹ä¸­æœ‰ä¼˜æƒ çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ­¤æ—¶éœ€è¦è€ƒè™‘UMPç³»ç»ŸæŒ‚æ‰ï¼Œä¸ä¼šå½±å“ç”¨æˆ·ä¸‹å•ï¼ˆåé¢å¯ä»¥é€šè¿‡ä¿®æ”¹ä»·æ ¼å¼¥è¡¥ï¼‰ï¼Œé‡‡ç”¨çš„æ–¹å¼æ˜¯ï¼Œå¦‚æœä¼˜æƒ æŒ‚æ‰ï¼Œé‡æ–°æ¸²æŸ“é¡µé¢ï¼Œå¹¶å¢åŠ umpå±è”½æ ‡è®°ï¼Œä¸‹å•æ—¶ä¼šè‡ªåŠ¨å±è”½umpçš„ä»£ç é€»è¾‘ã€‚<br>å¦å¤–è¿˜ä¼šè®°å½•umpç³»ç»Ÿä¸å¯ç”¨æ¬¡æ•°ï¼Œä¸€å®šæ—¶é—´å†…è¶…è¿‡é˜ˆå€¼ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚</p><ul><li>ç¨³å®šæ€§</li></ul><p>ç¬¬ä¸‰æ–¹ç³»ç»Ÿå¯èƒ½ä¼šä¸ç¨³å®šï¼Œå­˜åœ¨æ¥å£è¶…æ—¶æˆ–å®•æœºï¼Œä¸ºäº†å¢åŠ ç³»ç»Ÿçš„å¥å£®æ€§ï¼Œè°ƒç”¨æ¥å£æ—¶è®¾ç½®è¶…æ—¶æ—¶é—´ä»¥åŠå¼‚å¸¸æ•è·å¤„ç†ã€‚</p><ul><li>å®¹é‡è§„åˆ’</li></ul><p>åšå¥½å®¹é‡è§„åˆ’ã€ç³»ç»Ÿé—´å¼ºå¼±ä¾èµ–å…³ç³»æ¢³ç†ã€‚<br>å¦‚ï¼šå†·çƒ­æ•°æ®ä¸åŒå¤„ç†ï¼Œæ—©æœŸçš„è®¢å•é‡‡ç”¨oracleå­˜å‚¨ï¼Œéšç€è®¢å•çš„æ•°é‡è¶Šæ¥è¶Šå¤šï¼ŒæŸ¥è¯¢ç¼“æ…¢ï¼Œè€ƒè™‘æ•°æ®è¿ç§»ï¼Œå¼•å…¥å†å²è¡¨ï¼Œå°†å·²å½’æ¡£çš„è®°å½•è¿ç§»åˆ°å†å²è¡¨ä¸­ã€‚å½“ç„¶æœ€å¥½çš„æ–¹æ³•æ˜¯åˆ†åº“åˆ†è¡¨ã€‚<br><a name="-7"></a></p><h4 id="åˆ†å¸ƒå¼æ¶æ„"><a href="#åˆ†å¸ƒå¼æ¶æ„" class="headerlink" title="åˆ†å¸ƒå¼æ¶æ„"></a>åˆ†å¸ƒå¼æ¶æ„</h4><ul><li><p>åˆ†å¸ƒå¼ç³»ç»Ÿ</p></li><li><p>åˆ†å¸ƒå¼ç¼“å­˜</p></li><li><p>åˆ†å¸ƒå¼æ•°æ®<br><a name="api"></a></p><h4 id="API-å’Œä¹é«˜ç§¯æœ¨æœ‰ä»€ä¹ˆç›¸ä¼¼ä¹‹å¤„ï¼Ÿ"><a href="#API-å’Œä¹é«˜ç§¯æœ¨æœ‰ä»€ä¹ˆç›¸ä¼¼ä¹‹å¤„ï¼Ÿ" class="headerlink" title="API å’Œä¹é«˜ç§¯æœ¨æœ‰ä»€ä¹ˆç›¸ä¼¼ä¹‹å¤„ï¼Ÿ"></a>API å’Œä¹é«˜ç§¯æœ¨æœ‰ä»€ä¹ˆç›¸ä¼¼ä¹‹å¤„ï¼Ÿ</h4><p>ç›¸ä¿¡æˆ‘ä»¬å¤§å¤šæ•°äººåœ¨å„¿ç«¥æ—¶æœŸéƒ½å–œæ¬¢ç©ä¹é«˜ç§¯æœ¨ã€‚ä¹é«˜ç§¯æœ¨çš„çœŸæ­£ä¹è¶£å’Œå¸å¼•åŠ›åœ¨äºï¼Œå°½ç®¡åŒ…è£…ç›’å¤–é¢éƒ½å¸¦æœ‰ç¤ºæ„å›¾ç‰‡ï¼Œä½†ä½ æœ€ç»ˆéƒ½å¯ä»¥éšå¿ƒæ‰€æ¬²å¾—æ­å‡ºå„ç§æ ·å­æˆ–é€ å‹ã€‚<br>å¯¹ API çš„æœ€ä½³è§£é‡Šå°±æ˜¯å®ƒä»¬åƒä¹é«˜ç§¯æœ¨ä¸€æ ·ã€‚æˆ‘ä»¬å¯ä»¥ç”¨åˆ›é€ æ€§çš„æ–¹å¼æ¥ç»„åˆå®ƒä»¬ï¼Œè€Œä¸ç”¨åœ¨æ„å®ƒä»¬åŸæœ¬çš„è®¾è®¡å’Œå®ç°æ„å›¾ã€‚<br>ä½ å¯ä»¥å‘ç°å¾ˆå¤š API å’Œä¹é«˜ç§¯æœ¨çš„ç›¸ä¼¼ä¹‹å¤„ï¼š</p></li><li><p>æ ‡å‡†åŒ–ï¼šé€šç”¨ã€æ ‡å‡†åŒ–çš„ç»„ä»¶ï¼Œä½œä¸ºåŸºæœ¬çš„æ„å»ºå—ï¼ˆbuilding blocksï¼‰ï¼›<br></p></li><li><p>å¯ç”¨æ€§ï¼šå¼ºè°ƒå¯ç”¨æ€§ï¼Œé™„æœ‰æ–‡æ¡£æˆ–ä½¿ç”¨è¯´æ˜ï¼›<br></p></li><li><p>å¯å®šåˆ¶ï¼šä¸ºä¸åŒåŠŸèƒ½ä½¿ç”¨ä¸åŒçš„APIï¼›<br></p></li><li><p>åˆ›é€ æ€§ï¼šèƒ½å¤Ÿç»„åˆä¸åŒçš„ API æ¥åˆ›é€ æ··æ­çš„ç»“æœï¼›</p></li></ul><p><br>ä¹é«˜å’Œ API éƒ½æœ‰è¶…ç®€å•çš„ç•Œé¢/æ¥å£ï¼Œå¹¶ä¸”å€ŸåŠ©è¿™æ ·ç®€å•çš„ç•Œé¢/æ¥å£ï¼Œå®ƒå¯ä»¥éå¸¸ç›´è§‚ã€å®¹æ˜“ã€å¿«é€Ÿå¾—æ„å»ºã€‚<br>è™½ç„¶ä¹é«˜å’Œ API ä¸€æ ·å¯èƒ½é™„å¸¦ç¤ºæ„å›¾ç‰‡æˆ–ä½¿ç”¨æ–‡æ¡£ï¼Œå¤§æ¦‚æè¿°äº†æ¨èç©æ³•æˆ–ç”¨é€”ï¼Œä½†çœŸæ­£ä»¤äººå…´å¥‹çš„ç»“æœæˆ–æ”¶è·æ°æ°æ˜¯é€šè¿‡åˆ›é€ åŠ›äº§ç”Ÿçš„ã€‚<br><br><br>è®©æˆ‘ä»¬ä»”ç»†åœ°æ€è€ƒä¸‹ä¸Šè¿°çš„ææ³•ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒAPI çš„ä½¿ç”¨è€…æ„å»ºå‡ºäº† API çš„æ„å»ºè€…è¶…å‡ºé¢„æœŸçš„æœåŠ¡æˆ–äº§å“ï¼ŒAPI ä½¿ç”¨è€…æƒ³è¦çš„ï¼Œå’Œ API æ„å»ºè€…è®¤ä¸ºä½¿ç”¨è€…æƒ³è¦çš„ï¼Œè¿™äºŒè€…ä¹‹é—´é€šå¸¸æœ‰ä¸ªæ–­å±‚ã€‚äº‹å®ä¹Ÿç¡®å®å¦‚æ­¤ï¼Œåœ¨ IoT é¢†åŸŸï¼Œæˆ‘ä»¬ä½¿ç”¨ API åˆ›é€ å‡ºäº†ä¸€äº›éå¸¸æœ‰åˆ›é€ æ€§çš„ä½¿ç”¨åœºæ™¯ã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;&lt;a name=&quot;-2&quot;&gt;&lt;/a&gt;&lt;/p&gt;&lt;h2&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;å…³äºä»€ä¹ˆ
      
    
    </summary>
    
    
      <category term="æ¶æ„" scheme="cpeixin.cn/categories/%E6%9E%B6%E6%9E%84/"/>
    
    
  </entry>
  
  <entry>
    <title>kaliä¸­æ–‡è®¾ç½®</title>
    <link href="cpeixin.cn/2019/12/01/kali%E4%B8%AD%E6%96%87%E8%AE%BE%E7%BD%AE/"/>
    <id>cpeixin.cn/2019/12/01/kali%E4%B8%AD%E6%96%87%E8%AE%BE%E7%BD%AE/</id>
    <published>2019-12-01T02:26:15.000Z</published>
    <updated>2020-04-04T11:06:21.313Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><p>æ›´æ–°æº</p><p><a href="https://blog.csdn.net/qq_38333291/article/details/89764967" target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/qq_38333291/article/details/89764967</a></p><p>è®¾ç½®ç¼–ç å’Œä¸­æ–‡å­—ä½“å®‰è£…</p><p><a href="http://www.linuxdiyf.com/linux/20701.html" target="_blank" rel="external nofollow noopener noreferrer">http://www.linuxdiyf.com/linux/20701.html</a></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;æ›´æ–°æº&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/qq_38333291/article/details/897
      
    
    </summary>
    
    
      <category term="Linux" scheme="cpeixin.cn/categories/Linux/"/>
    
    
      <category term="kali" scheme="cpeixin.cn/tags/kali/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼ä¸‹çš„æ•°æ®hashåˆ†å¸ƒ</title>
    <link href="cpeixin.cn/2019/11/19/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8B%E7%9A%84%E6%95%B0%E6%8D%AEhash%E5%88%86%E5%B8%83/"/>
    <id>cpeixin.cn/2019/11/19/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8B%E7%9A%84%E6%95%B0%E6%8D%AEhash%E5%88%86%E5%B8%83/</id>
    <published>2019-11-19T15:05:08.000Z</published>
    <updated>2020-04-04T11:24:04.737Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;!-- rebuild by neat --&gt;
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>ã€è½¬è½½ã€‘å­—èŠ‚è·³åŠ¨åœ¨Spark SQLä¸Šçš„æ ¸å¿ƒä¼˜åŒ–å®è·µ</title>
    <link href="cpeixin.cn/2019/11/12/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E5%9C%A8Spark-SQL%E4%B8%8A%E7%9A%84%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5/"/>
    <id>cpeixin.cn/2019/11/12/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E5%9C%A8Spark-SQL%E4%B8%8A%E7%9A%84%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5/</id>
    <published>2019-11-12T10:57:27.000Z</published>
    <updated>2020-05-16T10:59:03.835Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:12 GMT+0800 (GMT+08:00) --><p><br>æœ¬æ–‡è½¬è½½è‡ªå­—èŠ‚è·³åŠ¨æŠ€æœ¯å›¢é˜Ÿåœ¨æ˜é‡‘ç½‘ä¸Šå‘è¡¨çš„æ–‡ç« ï¼Œä¸»è¦æ˜¯Spark SQLåœ¨å­—èŠ‚æ•°æ®ä»“åº“åº”ç”¨æ–¹é¢çš„ä¼˜åŒ–å®è·µ<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://juejin.im/post/5dc3ed336fb9a04a7847f25c" target="_blank" rel="external nofollow noopener noreferrer">https://juejin.im/post/5dc3ed336fb9a04a7847f25c</a><br><a name="KLy4v"></a></p><h2 id="Spark-SQL-æ¶æ„ç®€ä»‹"><a href="#Spark-SQL-æ¶æ„ç®€ä»‹" class="headerlink" title="Spark SQL æ¶æ„ç®€ä»‹"></a>Spark SQL æ¶æ„ç®€ä»‹</h2><p>æˆ‘ä»¬å…ˆç®€å•èŠä¸€ä¸‹Spark SQL çš„æ¶æ„ã€‚ä¸‹é¢è¿™å¼ å›¾æè¿°äº†ä¸€æ¡ SQL æäº¤ä¹‹åéœ€è¦ç»å†çš„å‡ ä¸ªé˜¶æ®µï¼Œç»“åˆè¿™äº›é˜¶æ®µå°±å¯ä»¥çœ‹åˆ°åœ¨å“ªäº›ç¯èŠ‚å¯ä»¥åšä¼˜åŒ–ã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589617132571-55a23e83-cc96-437b-93a9-871d41c6724e.webp#align=left&display=inline&height=448&margin=%5Bobject%20Object%5D&originHeight=448&originWidth=1080&size=0&status=done&style=none&width=1080" alt><br><br><br>å¾ˆå¤šæ—¶å€™ï¼Œåšæ•°æ®ä»“åº“å»ºæ¨¡çš„åŒå­¦æ›´å€¾å‘äºç›´æ¥å†™ SQL è€Œéä½¿ç”¨ Spark çš„ DSLã€‚ä¸€æ¡ SQL æäº¤ä¹‹åä¼šè¢« Parser è§£æå¹¶è½¬åŒ–ä¸º Unresolved Logical Planã€‚å®ƒçš„é‡ç‚¹æ˜¯ Logical Plan ä¹Ÿå³é€»è¾‘è®¡åˆ’ï¼Œå®ƒæè¿°äº†å¸Œæœ›åšä»€ä¹ˆæ ·çš„æŸ¥è¯¢ã€‚Unresolved æ˜¯æŒ‡è¯¥æŸ¥è¯¢ç›¸å…³çš„ä¸€äº›ä¿¡æ¯æœªçŸ¥ï¼Œæ¯”å¦‚ä¸çŸ¥é“æŸ¥è¯¢çš„ç›®æ ‡è¡¨çš„ Schema ä»¥åŠæ•°æ®ä½ç½®ã€‚<br>ä¸Šè¿°ä¿¡æ¯å­˜äº Catalog å†…ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸€èˆ¬ç”± Hive Metastore æä¾› Catalog æœåŠ¡ã€‚Analyzer ä¼šç»“åˆ Catalog å°† Unresolved Logical Plan è½¬æ¢ä¸º Resolved Logical Planã€‚</p><p>åˆ°è¿™é‡Œè¿˜ä¸å¤Ÿã€‚ä¸åŒçš„äººå†™å‡ºæ¥çš„ SQL ä¸ä¸€æ ·ï¼Œç”Ÿæˆçš„ Resolved Logical Plan ä¹Ÿå°±ä¸ä¸€æ ·ï¼Œæ‰§è¡Œæ•ˆç‡ä¹Ÿä¸ä¸€æ ·ã€‚ä¸ºäº†ä¿è¯æ— è®ºç”¨æˆ·å¦‚ä½•å†™ SQL éƒ½å¯ä»¥é«˜æ•ˆçš„æ‰§è¡Œï¼ŒSpark SQL éœ€è¦å¯¹ Resolved Logical Plan è¿›è¡Œä¼˜åŒ–ï¼Œè¿™ä¸ªä¼˜åŒ–ç”± Optimizer å®Œæˆã€‚Optimizer åŒ…å«äº†ä¸€ç³»åˆ—è§„åˆ™ï¼Œå¯¹ Resolved Logical Plan è¿›è¡Œç­‰ä»·è½¬æ¢ï¼Œæœ€ç»ˆç”Ÿæˆ Optimized Logical Planã€‚<strong>è¯¥ Optimized Logical Plan ä¸èƒ½ä¿è¯æ˜¯å…¨å±€æœ€ä¼˜çš„ï¼Œä½†è‡³å°‘æ˜¯æ¥è¿‘æœ€ä¼˜çš„ã€‚</strong><br>ä¸Šè¿°è¿‡ç¨‹åªä¸ SQL æœ‰å…³ï¼Œä¸æŸ¥è¯¢æœ‰å…³ï¼Œä½†æ˜¯ä¸ Spark æ— å…³ï¼Œå› æ­¤æ— æ³•ç›´æ¥æäº¤ç»™ Spark æ‰§è¡Œã€‚Query Planner è´Ÿè´£å°† Optimized Logical Plan è½¬æ¢ä¸º Physical Planï¼Œè¿›è€Œå¯ä»¥ç›´æ¥ç”± Spark æ‰§è¡Œã€‚<br><br><br>ç”±äºåŒä¸€ç§é€»è¾‘ç®—å­å¯ä»¥æœ‰å¤šç§ç‰©ç†å®ç°ã€‚å¦‚ Join æœ‰å¤šç§å®ç°ï¼ŒShuffledHashJoinã€BroadcastHashJoinã€BroadcastNestedLoopJoinã€SortMergeJoin ç­‰ã€‚å› æ­¤ Optimized Logical Plan å¯è¢« Query Planner è½¬æ¢ä¸ºå¤šä¸ª Physical Planã€‚å¦‚ä½•é€‰æ‹©æœ€ä¼˜çš„ Physical Plan æˆä¸ºä¸€ä»¶éå¸¸å½±å“æœ€ç»ˆæ‰§è¡Œæ€§èƒ½çš„äº‹æƒ…ã€‚ä¸€ç§æ¯”è¾ƒå¥½çš„æ–¹å¼æ˜¯ï¼Œ<strong>æ„å»ºä¸€ä¸ª Cost Modelï¼Œå¹¶å¯¹æ‰€æœ‰å€™é€‰çš„ Physical Plan åº”ç”¨è¯¥ Model å¹¶æŒ‘é€‰ Cost æœ€å°çš„ Physical Plan ä½œä¸ºæœ€ç»ˆçš„ Selected Physical Planã€‚</strong></p><p>Physical Plan å¯ç›´æ¥è½¬æ¢æˆ RDD ç”± Spark æ‰§è¡Œã€‚æˆ‘ä»¬ç»å¸¸è¯´â€œè®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ–â€ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å‘ç°åŸè®¡åˆ’ä¸æ˜¯æœ€ä¼˜çš„ï¼Œåç»­æ‰§è¡Œè®¡åˆ’å¦‚æœèƒ½æ ¹æ®è¿è¡Œæ—¶çš„ç»Ÿè®¡ä¿¡æ¯è¿›è¡Œè°ƒæ•´å¯èƒ½æå‡æ•´ä½“æ‰§è¡Œæ•ˆç‡ã€‚è¿™éƒ¨åˆ†<strong>åŠ¨æ€è°ƒæ•´ç”± Adaptive Execution</strong> å®Œæˆã€‚<br><br><br>åé¢ä»‹ç»å­—èŠ‚è·³åŠ¨åœ¨ Spark SQL ä¸Šåšçš„ä¸€äº›ä¼˜åŒ–ï¼Œä¸»è¦å›´ç»•è¿™ä¸€èŠ‚ä»‹ç»çš„é€»è¾‘è®¡åˆ’ä¼˜åŒ–ä¸ç‰©ç†è®¡åˆ’ä¼˜åŒ–å±•å¼€ã€‚<br><a name="Z68Tc"></a></p><h2 id="Spark-SQLå¼•æ“ä¼˜åŒ–"><a href="#Spark-SQLå¼•æ“ä¼˜åŒ–" class="headerlink" title="Spark SQLå¼•æ“ä¼˜åŒ–"></a>Spark SQLå¼•æ“ä¼˜åŒ–</h2><p><a name="L4CUN"></a></p><h3 id="Bucket-Joinæ”¹è¿›"><a href="#Bucket-Joinæ”¹è¿›" class="headerlink" title="Bucket Joinæ”¹è¿›"></a>Bucket Joinæ”¹è¿›</h3><p>åœ¨ Spark é‡Œï¼Œå®é™…å¹¶æ²¡æœ‰ Bucket Join ç®—å­ã€‚è¿™é‡Œè¯´çš„ Bucket Join æ³›æŒ‡ä¸éœ€è¦ Shuffle çš„ Sort Merge Joinã€‚<br>ä¸‹å›¾å±•ç¤ºäº† Sort Merge Join çš„åŸºæœ¬åŸç†ã€‚ç”¨è™šçº¿æ¡†ä»£è¡¨çš„ Table 1 å’Œ Table 2 æ˜¯ä¸¤å¼ éœ€è¦æŒ‰æŸå­—æ®µè¿›è¡Œ Join çš„è¡¨ã€‚è™šçº¿æ¡†å†…çš„ partition 0 åˆ° partition m æ˜¯è¯¥è¡¨è½¬æ¢æˆ RDD åçš„ Partitionï¼Œè€Œéè¡¨çš„åˆ†åŒºã€‚</p><p>å‡è®¾ Table 1 ä¸ Table 2 è½¬æ¢ä¸º RDD ååˆ†åˆ«åŒ…å« m å’Œ k ä¸ª Partitionã€‚ä¸ºäº†è¿›è¡Œ Joinï¼Œéœ€è¦é€šè¿‡ Shuffle ä¿è¯ç›¸åŒ Join Key çš„æ•°æ®åœ¨åŒä¸€ä¸ª Partition å†…ä¸” Partition å†…æŒ‰ Key æ’åºï¼ŒåŒæ—¶ä¿è¯ Table 1 ä¸ Table 2 ç»è¿‡ Shuffle åçš„ RDD çš„ Partition æ•°ç›¸åŒã€‚<br><br><br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç»è¿‡ Shuffle ååªéœ€è¦å¯åŠ¨ n ä¸ª Taskï¼Œæ¯ä¸ª Task å¤„ç† Table 1 ä¸ Table 2 ä¸­å¯¹åº” Partition çš„æ•°æ®è¿›è¡Œ Join å³å¯ã€‚å¦‚ Task 0 åªéœ€è¦é¡ºåºæ‰«æ Shuffle åçš„å·¦å³ä¸¤è¾¹çš„ partition 0 å³å¯å®Œæˆ Joinã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621443202-f22b73ca-17f1-450c-86ca-e47c9b934bca.webp#align=left&display=inline&height=629&margin=%5Bobject%20Object%5D&originHeight=629&originWidth=1080&size=0&status=done&style=none&width=1080" alt><br><br><br>è¯¥æ–¹æ³•çš„ä¼˜åŠ¿æ˜¯é€‚ç”¨åœºæ™¯å¹¿ï¼Œå‡ ä¹å¯ç”¨äºä»»æ„å¤§å°çš„æ•°æ®é›†ã€‚åŠ£åŠ¿æ˜¯æ¯æ¬¡ Join éƒ½éœ€è¦å¯¹å…¨é‡æ•°æ®è¿›è¡Œ Shuffleï¼Œè€Œ Shuffle æ˜¯æœ€å½±å“ Spark SQL æ€§èƒ½çš„ç¯èŠ‚ã€‚å¦‚æœèƒ½é¿å… Shuffle å¾€å¾€èƒ½å¤§å¹…æå‡ Spark SQL æ€§èƒ½ã€‚</p><p>å¯¹äºå¤§æ•°æ®çš„åœºæ™¯æ¥è®²ï¼Œæ•°æ®ä¸€èˆ¬æ˜¯ä¸€æ¬¡å†™å…¥å¤šæ¬¡æŸ¥è¯¢ã€‚å¦‚æœç»å¸¸å¯¹ä¸¤å¼ è¡¨æŒ‰ç›¸åŒæˆ–ç±»ä¼¼çš„æ–¹å¼è¿›è¡Œ Joinï¼Œæ¯æ¬¡éƒ½éœ€è¦ä»˜å‡º Shuffle çš„ä»£ä»·ã€‚ä¸å…¶è¿™æ ·ï¼Œ<strong>ä¸å¦‚è®©æ•°æ®åœ¨å†™çš„æ—¶å€™ï¼Œå°±è®©æ•°æ®æŒ‰ç…§åˆ©äº Join çš„æ–¹å¼åˆ†å¸ƒï¼Œä»è€Œä½¿å¾— Join æ—¶æ— éœ€è¿›è¡Œ Shuffleã€‚</strong>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒTable 1 ä¸ Table 2 å†…çš„æ•°æ®æŒ‰ç…§ç›¸åŒçš„ Key è¿›è¡Œåˆ†æ¡¶ä¸”æ¡¶æ•°éƒ½ä¸º nï¼ŒåŒæ—¶æ¡¶å†…æŒ‰è¯¥ Key æ’åºã€‚å¯¹è¿™ä¸¤å¼ è¡¨è¿›è¡Œ Join æ—¶ï¼Œå¯ä»¥é¿å… Shuffleï¼Œç›´æ¥å¯åŠ¨ n ä¸ª Task è¿›è¡Œ Joinã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621443345-00aac217-cf9d-4ca2-beea-3a27868e9709.webp#align=left&display=inline&height=697&margin=%5Bobject%20Object%5D&originHeight=697&originWidth=1200&size=0&status=done&style=none&width=1200" alt><br><br><br>å­—èŠ‚è·³åŠ¨å¯¹ Spark SQL çš„ BucketJoin åšäº†å››é¡¹æ¯”è¾ƒå¤§çš„æ”¹è¿›ã€‚<br><strong><br></strong>æ”¹è¿›ä¸€ï¼šæ”¯æŒä¸ Hive å…¼å®¹**<br>åœ¨è¿‡å»ä¸€æ®µæ—¶é—´ï¼Œå­—èŠ‚è·³åŠ¨æŠŠå¤§é‡çš„ Hive ä½œä¸šè¿ç§»åˆ°äº† SparkSQLã€‚è€Œ Hive ä¸ Spark SQL çš„ Bucket è¡¨ä¸å…¼å®¹ã€‚å¯¹äºä½¿ç”¨ Bucket è¡¨çš„åœºæ™¯ï¼Œå¦‚æœç›´æ¥æ›´æ–°è®¡ç®—å¼•æ“ï¼Œä¼šé€ æˆ Spark SQL å†™å…¥ Hive Bucket è¡¨çš„æ•°æ®æ— æ³•è¢«ä¸‹æ¸¸çš„ Hive ä½œä¸šå½“æˆ Bucket è¡¨è¿›è¡Œ Bucket Joinï¼Œä»è€Œé€ æˆä½œä¸šæ‰§è¡Œæ—¶é—´å˜é•¿ï¼Œå¯èƒ½å½±å“ SLAã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è®© Spark SQL æ”¯æŒ Hive å…¼å®¹æ¨¡å¼ï¼Œä»è€Œä¿è¯ Spark SQL å†™å…¥çš„ Bucket è¡¨ä¸ Hive å†™å…¥çš„ Bucket è¡¨æ•ˆæœä¸€è‡´ï¼Œå¹¶ä¸”è¿™ç§è¡¨å¯ä»¥è¢« Hive å’Œ Spark SQL å½“æˆ Bucket è¡¨è¿›è¡Œ Bucket Join è€Œä¸éœ€è¦ Shuffleã€‚é€šè¿‡è¿™ç§æ–¹å¼ä¿è¯ Hive å‘ Spark SQL çš„é€æ˜è¿ç§»ã€‚</p><p>ç¬¬ä¸€ä¸ªéœ€è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼ŒHive çš„ä¸€ä¸ª Bucket ä¸€èˆ¬åªåŒ…å«ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œ Spark SQL çš„ä¸€ä¸ª Bucket å¯èƒ½åŒ…å«å¤šä¸ªæ–‡ä»¶ã€‚<strong>è§£å†³åŠæ³•æ˜¯åŠ¨æ€å¢åŠ ä¸€æ¬¡ä»¥ Bucket Key ä¸º Key å¹¶ä¸”å¹¶è¡Œåº¦ä¸ Bucket ä¸ªæ•°ç›¸åŒçš„ Shuffleã€‚</strong></p><p><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621443237-9db92d7d-db57-44a7-8c38-d02bece98cc8.webp#align=left&display=inline&height=609&margin=%5Bobject%20Object%5D&originHeight=609&originWidth=1200&size=0&status=done&style=none&width=1200" alt><br><br><br><br><br>ç¬¬äºŒä¸ªéœ€è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼ŒHive 1.x çš„å“ˆå¸Œæ–¹å¼ä¸ Spark SQL 2.x çš„å“ˆå¸Œæ–¹å¼ï¼ˆMurmur3Hashï¼‰ä¸åŒï¼Œä½¿å¾—ç›¸åŒçš„æ•°æ®åœ¨ Hive ä¸­çš„ Bucket ID ä¸ Spark SQL ä¸­çš„ Bucket ID ä¸åŒè€Œæ— æ³•ç›´æ¥ Joinã€‚åœ¨ Hive å…¼å®¹æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬è®©ä¸Šè¿°åŠ¨æ€å¢åŠ çš„ Shuffle ä½¿ç”¨ Hive ç›¸åŒçš„å“ˆå¸Œæ–¹å¼ï¼Œä»è€Œè§£å†³è¯¥é—®é¢˜ã€‚<br><strong><br></strong>æ”¹è¿›äºŒï¼šæ”¯æŒå€æ•°å…³ç³»Bucket Join**<br>Spark SQL è¦æ±‚åªæœ‰ Bucket ç›¸åŒçš„è¡¨æ‰èƒ½ï¼ˆå¿…è¦éå……åˆ†æ¡ä»¶ï¼‰è¿›è¡Œ Bucket Joinã€‚å¯¹äºä¸¤å¼ å¤§å°ç›¸å·®å¾ˆå¤§çš„è¡¨ï¼Œæ¯”å¦‚å‡ ç™¾ GB çš„ç»´åº¦è¡¨ä¸å‡ å TB ï¼ˆå•åˆ†åŒºï¼‰çš„äº‹å®è¡¨ï¼Œå®ƒä»¬çš„ Bucket ä¸ªæ•°å¾€å¾€ä¸åŒï¼Œå¹¶ä¸”ä¸ªæ•°ç›¸å·®å¾ˆå¤šï¼Œé»˜è®¤æ— æ³•è¿›è¡Œ Bucket Joinã€‚å› æ­¤æˆ‘ä»¬é€šè¿‡ä¸¤ç§æ–¹å¼æ”¯æŒäº†å€æ•°å…³ç³»çš„ Bucket Joinï¼Œå³å½“ä¸¤å¼  Bucket è¡¨çš„ Bucket æ•°æ˜¯å€æ•°å…³ç³»æ—¶æ”¯æŒ Bucket Joinã€‚</p><p>ç¬¬ä¸€ç§æ–¹å¼ï¼ŒTask ä¸ªæ•°ä¸å°è¡¨ Bucket ä¸ªæ•°ç›¸åŒã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒTable A åŒ…å« 3 ä¸ª Bucketï¼ŒTable B åŒ…å« 6 ä¸ª Bucketã€‚æ­¤æ—¶ Table B çš„ bucket 0 ä¸ bucket 3 çš„æ•°æ®åˆé›†åº”è¯¥ä¸ Table A çš„ bucket 0 è¿›è¡Œ Joinã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å¯åŠ¨ 3 ä¸ª Taskã€‚å…¶ä¸­ Task 0 å¯¹ Table A çš„ bucket 0 ä¸ Table B çš„ bucket 0 + bucket 3 è¿›è¡Œ Joinã€‚åœ¨è¿™é‡Œï¼Œéœ€è¦å¯¹ Table B çš„ bucket 0 ä¸ bucket 3 çš„æ•°æ®å†åšä¸€æ¬¡ merge sort ä»è€Œä¿è¯åˆé›†æœ‰åºã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621443244-bfe94284-63b6-4abe-8e6f-1df98c09fd08.webp#align=left&display=inline&height=616&margin=%5Bobject%20Object%5D&originHeight=616&originWidth=1200&size=0&status=done&style=none&width=1200" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/gif/1072113/1589621444353-c4e9ece6-e014-4583-ba9d-28bda6a5fe62.gif#align=left&display=inline&height=1&margin=%5Bobject%20Object%5D&name=image.gif&originHeight=1&originWidth=1&size=70&status=done&style=none&width=1" alt="image.gif"></p><p>å¦‚æœ Table A ä¸ Table B çš„ Bucket ä¸ªæ•°ç›¸å·®ä¸å¤§ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šè¿°æ–¹å¼ã€‚å¦‚æœ Table B çš„ Bucket ä¸ªæ•°æ˜¯ Bucket A Bucket ä¸ªæ•°çš„ 10 å€ï¼Œé‚£ä¸Šè¿°æ–¹å¼è™½ç„¶é¿å…äº† Shuffleï¼Œä½†å¯èƒ½å› ä¸ºå¹¶è¡Œåº¦ä¸å¤Ÿåè€Œæ¯”åŒ…å« Shuffle çš„ SortMergeJoin é€Ÿåº¦æ…¢ã€‚æ­¤æ—¶å¯ä»¥ä½¿ç”¨å¦å¤–ä¸€ç§æ–¹å¼ï¼Œå³ Task ä¸ªæ•°ä¸å¤§è¡¨ Bucket ä¸ªæ•°ç›¸ç­‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621443251-d514de79-4fd1-4960-9e27-2a4e408c88ba.webp#align=left&display=inline&height=555&margin=%5Bobject%20Object%5D&originHeight=555&originWidth=1080&size=0&status=done&style=none&width=1080" alt><br><br><br>åœ¨è¯¥æ–¹æ¡ˆä¸‹ï¼Œå¯å°† Table A çš„ 3 ä¸ª Bucket è¯»å¤šæ¬¡ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œç›´æ¥å°† Table A ä¸ Table A è¿›è¡Œ Bucket Union ï¼ˆæ–°çš„ç®—å­ï¼Œä¸ Union ç±»ä¼¼ï¼Œä½†ä¿ç•™äº† Bucket ç‰¹æ€§ï¼‰ï¼Œç»“æœç›¸å½“äº 6 ä¸ª Bucketï¼Œä¸ Table B çš„ Bucket ä¸ªæ•°ç›¸åŒï¼Œä»è€Œå¯ä»¥è¿›è¡Œ Bucket Joinã€‚<br><strong><br></strong>æ”¹è¿›ä¸‰ï¼šæ”¯æŒBucketJoin é™çº§**<br>å…¬å¸å†…éƒ¨è¿‡å»ä½¿ç”¨ Bucket çš„è¡¨è¾ƒå°‘ï¼Œåœ¨æˆ‘ä»¬å¯¹ Bucket åšäº†ä¸€ç³»åˆ—æ”¹è¿›åï¼Œå¤§é‡ç”¨æˆ·å¸Œæœ›å°†è¡¨è½¬æ¢ä¸º Bucket è¡¨ã€‚è½¬æ¢åï¼Œè¡¨çš„å…ƒä¿¡æ¯æ˜¾ç¤ºè¯¥è¡¨ä¸º Bucket è¡¨ï¼Œè€Œå†å²åˆ†åŒºå†…çš„æ•°æ®å¹¶æœªæŒ‰ Bucket è¡¨è¦æ±‚åˆ†å¸ƒï¼Œåœ¨æŸ¥è¯¢å†å²æ•°æ®æ—¶ä¼šå‡ºç°æ— æ³•è¯†åˆ« Bucket çš„é—®é¢˜ã€‚</p><p>åŒæ—¶ï¼Œç”±äºæ•°æ®é‡ä¸Šæ¶¨å¿«ï¼Œå¹³å‡ Bucket å¤§å°ä¹Ÿå¿«é€Ÿå¢é•¿ã€‚è¿™ä¼šé€ æˆå• Task éœ€è¦å¤„ç†çš„æ•°æ®é‡è¿‡å¤§è¿›è€Œå¼•èµ·ä½¿ç”¨ Bucket åçš„æ•ˆæœå¯èƒ½ä¸å¦‚ç›´æ¥ä½¿ç”¨åŸºäº Shuffle çš„ Joinã€‚<br><br><br>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬å®ç°äº†æ”¯æŒé™çº§çš„ Bucket è¡¨ã€‚åŸºæœ¬åŸç†æ˜¯ï¼Œæ¯æ¬¡ä¿®æ”¹ Bucket ä¿¡æ¯ï¼ˆåŒ…å«ä¸Šè¿°ä¸¤ç§æƒ…å†µâ€”â€”å°†é Bucket è¡¨è½¬ä¸º Bucket è¡¨ï¼Œä»¥åŠä¿®æ”¹ Bucket ä¸ªæ•°ï¼‰æ—¶ï¼Œè®°å½•ä¿®æ”¹æ—¥æœŸã€‚å¹¶ä¸”åœ¨å†³å®šä½¿ç”¨å“ªç§ Join æ–¹å¼æ—¶ï¼Œå¯¹äº Bucket è¡¨å…ˆæ£€æŸ¥æ‰€æŸ¥è¯¢çš„æ•°æ®æ˜¯å¦åªåŒ…å«è¯¥æ—¥æœŸä¹‹åçš„åˆ†åŒºã€‚å¦‚æœæ˜¯ï¼Œåˆ™å½“æˆ Bucket è¡¨å¤„ç†ï¼Œæ”¯æŒ Bucket Joinï¼›å¦åˆ™å½“æˆæ™®é€šæ—  Bucket çš„è¡¨ã€‚<br><strong><br></strong>æ”¹è¿›å››ï¼šæ”¯æŒè¶…é›†<strong><br>å¯¹äºä¸€å¼ å¸¸ç”¨è¡¨ï¼Œå¯èƒ½ä¼šä¸å¦å¤–ä¸€å¼ è¡¨æŒ‰ User å­—æ®µåš Joinï¼Œä¹Ÿå¯èƒ½ä¼šä¸å¦å¤–ä¸€å¼ è¡¨æŒ‰ User å’Œ App å­—æ®µåš Joinï¼Œä¸å…¶å®ƒè¡¨æŒ‰ User ä¸ Item å­—æ®µè¿›è¡Œ Joinã€‚è€Œ Spark SQL åŸç”Ÿçš„ Bucket Join è¦æ±‚ Join Key Set ä¸è¡¨çš„ Bucket Key Set å®Œå…¨ç›¸åŒæ‰èƒ½è¿›è¡Œ Bucket Joinã€‚åœ¨è¯¥åœºæ™¯ä¸­ï¼Œä¸åŒ Join çš„ Key Set ä¸åŒï¼Œå› æ­¤æ— æ³•åŒæ—¶ä½¿ç”¨ Bucket Joinã€‚è¿™æå¤§çš„é™åˆ¶äº† Bucket Join çš„é€‚ç”¨åœºæ™¯ã€‚<br><br><br>é’ˆå¯¹æ­¤é—®é¢˜ï¼Œæˆ‘ä»¬æ”¯æŒäº†è¶…é›†åœºæ™¯ä¸‹çš„ Bucket Joinã€‚åªè¦ Join Key Set åŒ…å«äº† Bucket Key Setï¼Œå³å¯è¿›è¡Œ Bucket Joinã€‚<br><br><br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒTable X ä¸ Table Yï¼Œéƒ½æŒ‰å­—æ®µ A åˆ† Bucketã€‚è€ŒæŸ¥è¯¢éœ€è¦å¯¹ Table X ä¸ Table Y è¿›è¡Œ Joinï¼Œä¸” Join Key Set ä¸º A ä¸ Bã€‚æ­¤æ—¶ï¼Œç”±äº A ç›¸ç­‰çš„æ•°æ®ï¼Œåœ¨ä¸¤è¡¨ä¸­çš„ Bucket ID ç›¸åŒï¼Œé‚£ A ä¸ B å„è‡ªç›¸ç­‰çš„æ•°æ®åœ¨ä¸¤è¡¨ä¸­çš„ Bucket ID è‚¯å®šä¹Ÿç›¸åŒï¼Œæ‰€ä»¥æ•°æ®åˆ†å¸ƒæ˜¯æ»¡è¶³ Join è¦æ±‚çš„ï¼Œä¸éœ€è¦ Shuffleã€‚åŒæ—¶ï¼ŒBucket Join è¿˜éœ€è¦ä¿è¯ä¸¤è¡¨æŒ‰ Join Key Set å³ A å’Œ B æ’åºï¼Œæ­¤æ—¶åªéœ€è¦å¯¹ Table X ä¸ Table Y è¿›è¡Œåˆ†åŒºå†…æ’åºå³å¯ã€‚ç”±äºä¸¤è¾¹å·²ç»æŒ‰å­—æ®µ A æ’åºäº†ï¼Œæ­¤æ—¶å†æŒ‰ A ä¸ B æ’åºï¼Œä»£ä»·ç›¸å¯¹è¾ƒä½ã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621443338-9f06a217-9078-4734-84ce-860707b4612e.webp#align=left&display=inline&height=661&margin=%5Bobject%20Object%5D&originHeight=661&originWidth=1200&size=0&status=done&style=none&width=1200" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/gif/1072113/1589621444719-a5289c2c-0dea-4316-8924-1e4377bce1ea.gif#align=left&display=inline&height=1&margin=%5Bobject%20Object%5D&name=image.gif&originHeight=1&originWidth=1&size=70&status=done&style=none&width=1" alt="image.gif"><br></strong>ç‰©åŒ–åˆ—**<br>Spark SQL å¤„ç†åµŒå¥—ç±»å‹æ•°æ®æ—¶ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li><strong>è¯»å–å¤§é‡ä¸å¿…è¦çš„æ•°æ®</strong>ï¼šå¯¹äº Parquet / ORC ç­‰åˆ—å¼å­˜å‚¨æ ¼å¼ï¼Œå¯åªè¯»å–éœ€è¦çš„å­—æ®µï¼Œè€Œç›´æ¥è·³è¿‡å…¶å®ƒå­—æ®µï¼Œä»è€Œæå¤§èŠ‚çœ IOã€‚è€Œå¯¹äºåµŒå¥—æ•°æ®ç±»å‹çš„å­—æ®µï¼Œå¦‚ä¸‹å›¾ä¸­çš„ Map ç±»å‹çš„ people å­—æ®µï¼Œå¾€å¾€åªéœ€è¦è¯»å–å…¶ä¸­çš„å­å­—æ®µï¼Œå¦‚ people.ageã€‚å´éœ€è¦å°†æ•´ä¸ª Map ç±»å‹çš„ people å­—æ®µå…¨éƒ¨è¯»å–å‡ºæ¥ç„¶åæŠ½å–å‡º people.age å­—æ®µã€‚è¿™ä¼šå¼•å…¥å¤§é‡çš„æ— æ„ä¹‰çš„ IO å¼€é”€ã€‚åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ï¼Œå­˜åœ¨ä¸å°‘ Map ç±»å‹çš„å­—æ®µï¼Œè€Œä¸”å¾ˆå¤šåŒ…å«å‡ åè‡³å‡ ç™¾ä¸ª Keyï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ IO è¢«æ”¾å¤§äº†å‡ åè‡³å‡ ç™¾å€ã€‚<br></li><li><strong>æ— æ³•è¿›è¡Œå‘é‡åŒ–è¯»å–</strong>ï¼šè€Œå‘é‡åŒ–è¯»èƒ½æå¤§çš„æå‡æ€§èƒ½ã€‚ä½†æˆªæ­¢åˆ°ç›®å‰ï¼ˆ2019å¹´10æœˆ26æ—¥ï¼‰ï¼ŒSpark ä¸æ”¯æŒåŒ…å«åµŒå¥—æ•°æ®ç±»å‹çš„å‘é‡åŒ–è¯»å–ã€‚è¿™æå¤§çš„å½±å“äº†åŒ…å«åµŒå¥—æ•°æ®ç±»å‹çš„æŸ¥è¯¢æ€§èƒ½<br></li><li><strong>ä¸æ”¯æŒ Filter ä¸‹æ¨</strong>ï¼šç›®å‰ï¼ˆ2019å¹´10æœˆ26æ—¥ï¼‰çš„ Spark ä¸æ”¯æŒåµŒå¥—ç±»å‹å­—æ®µä¸Šçš„ Filter çš„ä¸‹æ¨<br></li><li><strong>é‡å¤è®¡ç®—</strong>ï¼šJSON å­—æ®µï¼Œåœ¨ Spark SQL ä¸­ä»¥ String ç±»å‹å­˜åœ¨ï¼Œä¸¥æ ¼æ¥è¯´ä¸ç®—åµŒå¥—æ•°æ®ç±»å‹ã€‚ä¸è¿‡å®è·µä¸­ä¹Ÿå¸¸ç”¨äºä¿å­˜ä¸å›ºå®šçš„å¤šä¸ªå­—æ®µï¼Œåœ¨æŸ¥è¯¢æ—¶é€šè¿‡ JSON Path æŠ½å–ç›®æ ‡å­å­—æ®µï¼Œè€Œå¤§å‹ JSON å­—ç¬¦ä¸²çš„å­—æ®µæŠ½å–éå¸¸æ¶ˆè€— CPUã€‚å¯¹äºçƒ­ç‚¹è¡¨ï¼Œé¢‘ç¹é‡å¤æŠ½å–ç›¸åŒå­å­—æ®µéå¸¸æµªè´¹èµ„æºã€‚<br></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621443241-a0b575d3-4b99-451f-802f-991fd41107f6.webp#align=left&display=inline&height=668&margin=%5Bobject%20Object%5D&originHeight=668&originWidth=1200&size=0&status=done&style=none&width=1200" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/gif/1072113/1589621444769-6635f36d-d873-430c-8223-adcb532766d6.gif#align=left&display=inline&height=1&margin=%5Bobject%20Object%5D&name=image.gif&originHeight=1&originWidth=1&size=70&status=done&style=none&width=1" alt="image.gif"><br>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œåšæ•°ä»“çš„åŒå­¦ä¹Ÿæƒ³äº†ä¸€äº›è§£å†³æ–¹æ¡ˆã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ<strong>åœ¨åä¸º base_table çš„è¡¨ä¹‹å¤–åˆ›å»ºäº†ä¸€å¼ åä¸º sub_table çš„è¡¨ï¼Œå¹¶ä¸”å°†é«˜é¢‘ä½¿ç”¨çš„å­å­—æ®µ people.age è®¾ç½®ä¸ºä¸€ä¸ªé¢å¤–çš„ Integer ç±»å‹çš„å­—æ®µ</strong>ã€‚ä¸‹æ¸¸ä¸å†é€šè¿‡ base_table æŸ¥è¯¢ people.ageï¼Œè€Œæ˜¯ä½¿ç”¨ sub_table ä¸Šçš„ age å­—æ®µä»£æ›¿ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå°†åµŒå¥—ç±»å‹å­—æ®µä¸Šçš„æŸ¥è¯¢è½¬ä¸ºäº† Primitive ç±»å‹å­—æ®µçš„æŸ¥è¯¢ï¼ŒåŒæ—¶è§£å†³äº†ä¸Šè¿°é—®é¢˜ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2020/gif/1072113/1589621444716-a4b11d0a-899e-430c-af62-8d0151c63af6.gif#align=left&display=inline&height=1&margin=%5Bobject%20Object%5D&name=image.gif&originHeight=1&originWidth=1&size=70&status=done&style=none&width=1" alt="image.gif">)<img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621443482-11bc4e9f-a7bb-4d7d-9026-746ea16d0d27.webp#align=left&display=inline&height=611&margin=%5Bobject%20Object%5D&originHeight=611&originWidth=1200&size=0&status=done&style=none&width=1200" alt><br><br><br>è¿™ç§æ–¹æ¡ˆå­˜åœ¨æ˜æ˜¾ç¼ºé™·ï¼š</p><ul><li><strong>é¢å¤–ç»´æŠ¤äº†ä¸€å¼ è¡¨</strong>ï¼Œå¼•å…¥äº†å¤§é‡çš„é¢å¤–å­˜å‚¨/è®¡ç®—å¼€é”€ã€‚<br></li><li>æ— æ³•åœ¨æ–°è¡¨ä¸ŠæŸ¥è¯¢æ–°å¢å­—æ®µçš„å†å²æ•°æ®ï¼ˆå¦‚è¦æ”¯æŒå¯¹å†å²æ•°æ®çš„æŸ¥è¯¢ï¼Œéœ€è¦é‡è·‘å†å²ä½œä¸šï¼Œå¼€é”€è¿‡å¤§ï¼Œæ— æ³•æ¥å—ï¼‰ã€‚<br></li><li>è¡¨çš„ç»´æŠ¤æ–¹éœ€è¦åœ¨ä¿®æ”¹è¡¨ç»“æ„åä¿®æ”¹æ’å…¥æ•°æ®çš„ä½œä¸šã€‚<br></li><li>éœ€è¦ä¸‹æ¸¸æŸ¥è¯¢æ–¹ä¿®æ”¹æŸ¥è¯¢è¯­å¥ï¼Œæ¨å¹¿æˆæœ¬è¾ƒå¤§ã€‚<br></li><li><strong>è¿è¥æˆæœ¬é«˜</strong>ï¼šå¦‚æœé«˜é¢‘å­å­—æ®µå˜åŒ–ï¼Œéœ€è¦åˆ é™¤ä¸å†éœ€è¦çš„ç‹¬ç«‹å­å­—æ®µï¼Œå¹¶æ·»åŠ æ–°å­å­—æ®µä¸ºç‹¬ç«‹å­—æ®µã€‚åˆ é™¤å‰ï¼Œéœ€è¦ç¡®ä¿ä¸‹æ¸¸æ— ä¸šåŠ¡ä½¿ç”¨è¯¥å­—æ®µã€‚è€Œæ–°å¢å­—æ®µéœ€è¦é€šçŸ¥å¹¶æ¨è¿›ä¸‹æ¸¸ä¸šåŠ¡æ–¹ä½¿ç”¨æ–°å­—æ®µã€‚<br></li></ul><p>ä¸ºè§£å†³ä¸Šè¿°æ‰€æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬è®¾è®¡å¹¶å®ç°äº†ç‰©åŒ–åˆ—ã€‚å®ƒçš„åŸç†æ˜¯ï¼š</p><ul><li>æ–°å¢ä¸€ä¸ª Primitive ç±»å‹å­—æ®µï¼Œæ¯”å¦‚ Integer ç±»å‹çš„ age å­—æ®µï¼Œå¹¶ä¸”æŒ‡å®šå®ƒæ˜¯ people.age çš„ç‰©åŒ–å­—æ®µã€‚<br></li><li>æ’å…¥æ•°æ®æ—¶ï¼Œä¸ºç‰©åŒ–å­—æ®µè‡ªåŠ¨ç”Ÿæˆæ•°æ®ï¼Œå¹¶åœ¨ Partition Parameter å†…ä¿å­˜ç‰©åŒ–å…³ç³»ã€‚å› æ­¤å¯¹æ’å…¥æ•°æ®çš„ä½œä¸šå®Œå…¨é€æ˜ï¼Œè¡¨çš„ç»´æŠ¤æ–¹ä¸éœ€è¦ä¿®æ”¹å·²æœ‰ä½œä¸šã€‚<br></li><li>æŸ¥è¯¢æ—¶ï¼Œæ£€æŸ¥æ‰€éœ€æŸ¥è¯¢çš„æ‰€æœ‰ Partitionï¼Œå¦‚æœéƒ½åŒ…å«ç‰©åŒ–ä¿¡æ¯ï¼ˆpeople.age åˆ° age çš„æ˜ å°„ï¼‰ï¼Œç›´æ¥å°† select people.age è‡ªåŠ¨é‡å†™ä¸º select ageï¼Œä»è€Œå®ç°å¯¹ä¸‹æ¸¸æŸ¥è¯¢æ–¹çš„å®Œå…¨é€æ˜ä¼˜åŒ–ã€‚åŒæ—¶å…¼å®¹å†å²æ•°æ®ã€‚<br></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621443240-98b45cc3-1d0f-4093-980d-265abb445a8a.webp#align=left&display=inline&height=683&margin=%5Bobject%20Object%5D&originHeight=683&originWidth=1200&size=0&status=done&style=none&width=1200" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/gif/1072113/1589621444777-84f75218-68e0-4929-909d-4c828ab64f33.gif#align=left&display=inline&height=1&margin=%5Bobject%20Object%5D&name=image.gif&originHeight=1&originWidth=1&size=70&status=done&style=none&width=1" alt="image.gif"><br>ä¸‹å›¾å±•ç¤ºäº†åœ¨æŸå¼ æ ¸å¿ƒè¡¨ä¸Šä½¿ç”¨ç‰©åŒ–åˆ—çš„æ”¶ç›Šï¼š<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621443260-d3424ecd-67fe-41ed-a902-edf0d1ee45ab.webp#align=left&display=inline&height=423&margin=%5Bobject%20Object%5D&originHeight=423&originWidth=1200&size=0&status=done&style=none&width=1200" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/gif/1072113/1589621444729-1b39919b-8ea5-459e-bc2b-db24d8391b39.gif#align=left&display=inline&height=1&margin=%5Bobject%20Object%5D&name=image.gif&originHeight=1&originWidth=1&size=70&status=done&style=none&width=1" alt="image.gif"><br><strong>ç‰©åŒ–è§†å›¾</strong><br>åœ¨ OLAP é¢†åŸŸï¼Œç»å¸¸ä¼šå¯¹ç›¸åŒè¡¨çš„æŸäº›å›ºå®šå­—æ®µè¿›è¡Œ Group By å’Œ Aggregate / Join ç­‰è€—æ—¶æ“ä½œï¼Œé€ æˆå¤§é‡é‡å¤æ€§è®¡ç®—ï¼Œæµªè´¹èµ„æºï¼Œä¸”å½±å“æŸ¥è¯¢æ€§èƒ½ï¼Œä¸åˆ©äºæå‡ç”¨æˆ·ä½“éªŒã€‚<br>æˆ‘ä»¬å®ç°äº†åŸºäºç‰©åŒ–è§†å›¾çš„ä¼˜åŒ–åŠŸèƒ½ï¼š<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621443261-8e8f3de2-937d-475b-aca0-d39fed39babb.webp#align=left&display=inline&height=594&margin=%5Bobject%20Object%5D&originHeight=594&originWidth=1080&size=0&status=done&style=none&width=1080" alt><br><br><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæŸ¥è¯¢å†å²æ˜¾ç¤ºå¤§é‡æŸ¥è¯¢æ ¹æ® user è¿›è¡Œ group byï¼Œç„¶åå¯¹ num è¿›è¡Œ sum æˆ– count è®¡ç®—ã€‚æ­¤æ—¶å¯åˆ›å»ºä¸€å¼ ç‰©åŒ–è§†å›¾ï¼Œä¸”å¯¹ user è¿›è¡Œ gorup byï¼Œå¯¹ num è¿›è¡Œ avgï¼ˆavg ä¼šè‡ªåŠ¨è½¬æ¢ä¸º count å’Œ sumï¼‰ã€‚ç”¨æˆ·å¯¹åŸå§‹è¡¨è¿›è¡Œ select user, sum(num) æŸ¥è¯¢æ—¶ï¼ŒSpark SQL è‡ªåŠ¨å°†æŸ¥è¯¢é‡å†™ä¸ºå¯¹ç‰©åŒ–è§†å›¾çš„ select user, sum_num æŸ¥è¯¢ã€‚<br><strong><br></strong>Spark SQL å¼•æ“ä¸Šçš„å…¶å®ƒä¼˜åŒ–<strong><br>ä¸‹å›¾å±•ç¤ºäº†æˆ‘ä»¬åœ¨ Spark SQL ä¸Šè¿›è¡Œçš„å…¶å®ƒéƒ¨åˆ†ä¼˜åŒ–å·¥ä½œï¼š<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621443207-45af67c8-8989-4026-81f3-d646d8123845.webp#align=left&display=inline&height=750&margin=%5Bobject%20Object%5D&originHeight=750&originWidth=1080&size=0&status=done&style=none&width=1080" alt><br></strong><br><a name="5UxSb"></a></p><h2 id="Spark-Shuffleç¨³å®šæ€§æå‡ä¸æ€§èƒ½ä¼˜åŒ–"><a href="#Spark-Shuffleç¨³å®šæ€§æå‡ä¸æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="Spark Shuffleç¨³å®šæ€§æå‡ä¸æ€§èƒ½ä¼˜åŒ–"></a>Spark Shuffleç¨³å®šæ€§æå‡ä¸æ€§èƒ½ä¼˜åŒ–</h2><p><a name="5rTgp"></a></p><h3><a href="#" class="headerlink"></a></h3><p><a name="Ajtpe"></a></p><h3 id="Spark-Shuffle-å­˜åœ¨çš„é—®é¢˜"><a href="#Spark-Shuffle-å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="Spark Shuffle å­˜åœ¨çš„é—®é¢˜"></a>Spark Shuffle å­˜åœ¨çš„é—®é¢˜</h3><p>Shuffleçš„åŸç†ï¼Œå¾ˆå¤šåŒå­¦åº”è¯¥å·²ç»å¾ˆç†Ÿæ‚‰äº†ã€‚é‰´äºæ—¶é—´å…³ç³»ï¼Œè¿™é‡Œä¸ä»‹ç»è¿‡å¤šç»†èŠ‚ï¼Œåªç®€å•ä»‹ç»ä¸‹åŸºæœ¬æ¨¡å‹ã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/gif/1072113/1589621445126-5aa3b134-c904-42d9-ac04-09618bb32553.gif#align=left&display=inline&height=1&margin=%5Bobject%20Object%5D&name=image.gif&originHeight=1&originWidth=1&size=70&status=done&style=none&width=1" alt="image.gif">)<img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621443213-c2f4bcdb-24e6-4fdc-afc2-3397f6608fec.webp#align=left&display=inline&height=679&margin=%5Bobject%20Object%5D&originHeight=679&originWidth=1200&size=0&status=done&style=none&width=1200" alt><br><br><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å°† Shuffle ä¸Šæ¸¸ Stage ç§°ä¸º Mapper Stageï¼Œå…¶ä¸­çš„ Task ç§°ä¸º Mapperã€‚Shuffle ä¸‹æ¸¸ Stage ç§°ä¸º Reducer Stageï¼Œå…¶ä¸­çš„ Task ç§°ä¸º Reducerã€‚<br>æ¯ä¸ª Mapper ä¼šå°†è‡ªå·±çš„æ•°æ®åˆ†ä¸ºæœ€å¤š N ä¸ªéƒ¨åˆ†ï¼ŒN ä¸º Reducer ä¸ªæ•°ã€‚æ¯ä¸ª Reducer éœ€è¦å»æœ€å¤š M ï¼ˆMapper ä¸ªæ•°ï¼‰ä¸ª Mapper è·å–å±äºè‡ªå·±çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚<br><br><br>è¿™ä¸ªæ¶æ„å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li><strong>ç¨³å®šæ€§é—®é¢˜</strong>ï¼šMapper çš„ Shuffle Write æ•°æ®å­˜äº Mapper æœ¬åœ°ç£ç›˜ï¼Œåªæœ‰ä¸€ä¸ªå‰¯æœ¬ã€‚å½“è¯¥æœºå™¨å‡ºç°ç£ç›˜æ•…éšœï¼Œæˆ–è€… IO æ»¡è½½ï¼ŒCPU æ»¡è½½æ—¶ï¼ŒReducer æ— æ³•è¯»å–è¯¥æ•°æ®ï¼Œä»è€Œå¼•èµ· FetchFailedExceptionï¼Œè¿›è€Œå¯¼è‡´ Stage Retryã€‚Stage Retry ä¼šé€ æˆä½œä¸šæ‰§è¡Œæ—¶é—´å¢é•¿ï¼Œç›´æ¥å½±å“ SLAã€‚åŒæ—¶ï¼Œæ‰§è¡Œæ—¶é—´è¶Šé•¿ï¼Œå‡ºç° Shuffle æ•°æ®æ— æ³•è¯»å–çš„å¯èƒ½æ€§è¶Šå¤§ï¼Œåè¿‡æ¥åˆä¼šé€ æˆæ›´å¤š Stage Retryã€‚å¦‚æ­¤å¾ªç¯ï¼Œå¯èƒ½å¯¼è‡´å¤§å‹ä½œä¸šæ— æ³•æˆåŠŸæ‰§è¡Œã€‚</li></ul><p><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621444392-8549057c-506b-4459-856d-0ce9cddf9910.webp#align=left&display=inline&height=628&margin=%5Bobject%20Object%5D&originHeight=628&originWidth=1200&size=0&status=done&style=none&width=1200" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/gif/1072113/1589621445074-9921e4da-02ca-438c-9b15-403f41fba339.gif#align=left&display=inline&height=1&margin=%5Bobject%20Object%5D&name=image.gif&originHeight=1&originWidth=1&size=70&status=done&style=none&width=1" alt="image.gif"></p><ul><li><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šæ¯ä¸ª Mapper çš„æ•°æ®ä¼šè¢«å¤§é‡ Reducer è¯»å–ï¼Œå¹¶ä¸”æ˜¯éšæœºè¯»å–ä¸åŒéƒ¨åˆ†ã€‚å‡è®¾ Mapper çš„ Shuffle è¾“å‡ºä¸º 512MBï¼ŒReducer æœ‰ 10 ä¸‡ä¸ªï¼Œé‚£å¹³å‡æ¯ä¸ª Reducer è¯»å–æ•°æ® 512MB / 100000 = 5.24KBã€‚å¹¶ä¸”ï¼Œä¸åŒ Reducer å¹¶è¡Œè¯»å–æ•°æ®ã€‚å¯¹äº Mapper è¾“å‡ºæ–‡ä»¶è€Œè¨€ï¼Œå­˜åœ¨å¤§é‡çš„éšæœºè¯»å–ã€‚è€Œ HDD çš„éšæœº IO æ€§èƒ½è¿œä½äºé¡ºåº IOã€‚æœ€ç»ˆçš„ç°è±¡æ˜¯ï¼ŒReducer è¯»å– Shuffle æ•°æ®éå¸¸æ…¢ï¼Œåæ˜ åˆ° Metrics ä¸Šå°±æ˜¯ Reducer Shuffle Read Blocked Time è¾ƒé•¿ï¼Œç”šè‡³å æ•´ä¸ª Reducer æ‰§è¡Œæ—¶é—´çš„ä¸€å¤§åŠï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</li></ul><p><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621444444-a5a5eeea-5d00-473f-892c-bef8ff9e032f.webp#align=left&display=inline&height=545&margin=%5Bobject%20Object%5D&originHeight=545&originWidth=1200&size=0&status=done&style=none&width=1200" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/gif/1072113/1589621445093-1dba238c-18eb-4bc2-a637-4a5f0f069847.gif#align=left&display=inline&height=1&margin=%5Bobject%20Object%5D&name=image.gif&originHeight=1&originWidth=1&size=70&status=done&style=none&width=1" alt="image.gif"><br><strong>åŸºäºHDFSçš„Shuffleç¨³å®šæ€§æå‡</strong><br>ç»è§‚å¯Ÿï¼Œå¼•èµ· Shuffle å¤±è´¥çš„æœ€å¤§å› ç´ ä¸æ˜¯ç£ç›˜æ•…éšœç­‰ç¡¬ä»¶é—®é¢˜ï¼Œè€Œæ˜¯ CPU æ»¡è½½å’Œç£ç›˜ IO æ»¡è½½ã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/gif/1072113/1589621445175-a4b309ba-f45b-4141-ac27-8771c622c313.gif#align=left&display=inline&height=1&margin=%5Bobject%20Object%5D&name=image.gif&originHeight=1&originWidth=1&size=70&status=done&style=none&width=1" alt="image.gif">)<img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621444483-bc3847a8-0664-4c0d-a4ed-ae5f1781331b.webp#align=left&display=inline&height=684&margin=%5Bobject%20Object%5D&originHeight=684&originWidth=1200&size=0&status=done&style=none&width=1200" alt><br><br><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæœºå™¨çš„ CPU ä½¿ç”¨ç‡æ¥è¿‘ 100%ï¼Œä½¿å¾— Mapper ä¾§çš„ Node Manager å†…çš„ Spark External Shuffle Service æ— æ³•åŠæ—¶æä¾› Shuffle æœåŠ¡ã€‚<br>ä¸‹å›¾ä¸­ Data Node å ç”¨äº†æ•´å°æœºå™¨ IO èµ„æºçš„ 84%ï¼Œéƒ¨åˆ†ç£ç›˜ IO å®Œå…¨æ‰“æ»¡ï¼Œè¿™ä½¿å¾—è¯»å– Shuffle æ•°æ®éå¸¸æ…¢ï¼Œè¿›è€Œä½¿å¾— Reducer ä¾§æ— æ³•åœ¨è¶…æ—¶æ—¶é—´å†…è¯»å–æ•°æ®ï¼Œé€ æˆ FetchFailedExceptionã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621444481-5779db89-9d8b-4b17-82e3-7b60b08eed02.webp#align=left&display=inline&height=627&margin=%5Bobject%20Object%5D&originHeight=627&originWidth=1080&size=0&status=done&style=none&width=1080" alt><br><br><br>æ— è®ºæ˜¯ä½•ç§åŸå› ï¼Œé—®é¢˜çš„ç—‡ç»“éƒ½æ˜¯ Mapper ä¾§çš„ Shuffle Write æ•°æ®åªä¿å­˜åœ¨æœ¬åœ°ï¼Œä¸€æ—¦è¯¥èŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼Œä¼šé€ æˆè¯¥èŠ‚ç‚¹ä¸Šæ‰€æœ‰ Shuffle Write æ•°æ®æ— æ³•è¢« Reducer è¯»å–ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªé€šç”¨æ–¹æ³•æ˜¯ï¼Œé€šè¿‡å¤šå‰¯æœ¬ä¿è¯å¯ç”¨æ€§ã€‚<br>æœ€åˆå§‹çš„ä¸€ä¸ªç®€å•æ–¹æ¡ˆæ˜¯ï¼ŒMapper ä¾§æœ€ç»ˆæ•°æ®æ–‡ä»¶ä¸ç´¢å¼•æ–‡ä»¶ä¸å†™åœ¨æœ¬åœ°ç£ç›˜ï¼Œè€Œæ˜¯ç›´æ¥å†™åˆ° HDFSã€‚Reducer ä¸å†é€šè¿‡ Mapper ä¾§çš„ External Shuffle Service è¯»å– Shuffle æ•°æ®ï¼Œè€Œæ˜¯ç›´æ¥ä» HDFS ä¸Šè·å–æ•°æ®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621444436-0efdf8b6-0082-47c1-9218-36b6e6bbee4f.webp#align=left&display=inline&height=541&margin=%5Bobject%20Object%5D&originHeight=541&originWidth=1080&size=0&status=done&style=none&width=1080" alt><br><br><br>å¿«é€Ÿå®ç°è¿™ä¸ªæ–¹æ¡ˆåï¼Œæˆ‘ä»¬åšäº†å‡ ç»„ç®€å•çš„æµ‹è¯•ã€‚ç»“æœè¡¨æ˜ï¼š</p><ul><li>Mapper ä¸ Reducer ä¸å¤šæ—¶ï¼ŒShuffle è¯»å†™æ€§èƒ½ä¸åŸå§‹æ–¹æ¡ˆç›¸æ¯”æ— å·®å¼‚ã€‚<br></li><li>Mapper ä¸ Reducer è¾ƒå¤šæ—¶ï¼ŒShuffle è¯»å˜å¾—éå¸¸æ…¢ã€‚<br></li></ul><p><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621444384-9bb761c9-fbe1-43c8-9a82-a51e97c97f8e.webp#align=left&display=inline&height=540&margin=%5Bobject%20Object%5D&originHeight=540&originWidth=1200&size=0&status=done&style=none&width=1200" alt><br><br><br>åœ¨ä¸Šé¢çš„å®éªŒè¿‡ç¨‹ä¸­ï¼ŒHDFS å‘å‡ºäº†æŠ¥è­¦ä¿¡æ¯ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒHDFS Name Node Proxy çš„ QPS å³°å€¼è¾¾åˆ° 60 ä¸‡ã€‚ï¼ˆæ³¨ï¼šå­—èŠ‚è·³åŠ¨è‡ªç ”äº† Node Name Proxyï¼Œå¹¶åœ¨ Proxy å±‚å®ç°äº†ç¼“å­˜ï¼Œå› æ­¤è¯» QPS å¯ä»¥æ”¯æ’‘åˆ°è¿™ä¸ªé‡çº§ï¼‰ã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621444590-4c232e53-8507-472c-844c-18249a03f85f.webp#align=left&display=inline&height=698&margin=%5Bobject%20Object%5D&originHeight=698&originWidth=1080&size=0&status=done&style=none&width=1080" alt><br><br><br>åŸå› åœ¨äºï¼Œæ€»å…± 10000 Reducerï¼Œéœ€è¦ä» 10000 ä¸ª Mapper å¤„è¯»å–æ•°æ®æ–‡ä»¶å’Œç´¢å¼•æ–‡ä»¶ï¼Œæ€»å…±éœ€è¦è¯»å– HDFS 10000 * 1000 * 2 = 2 äº¿æ¬¡ã€‚</p><p>å¦‚æœåªæ˜¯ Name Node çš„å•ç‚¹æ€§èƒ½é—®é¢˜ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸€äº›ç®€å•çš„æ–¹æ³•è§£å†³ã€‚ä¾‹å¦‚åœ¨ Spark Driver ä¾§ä¿å­˜æ‰€æœ‰ Mapper çš„ Block Locationï¼Œç„¶å Driver å°†è¯¥ä¿¡æ¯å¹¿æ’­è‡³æ‰€æœ‰ Executorï¼Œæ¯ä¸ª Reducer å¯ä»¥ç›´æ¥ä» Executor å¤„è·å– Block Locationï¼Œç„¶åæ— é¡»è¿æ¥ Name Nodeï¼Œè€Œæ˜¯ç›´æ¥ä» Data Node è¯»å–æ•°æ®ã€‚ä½†é‰´äº Data Node çš„çº¿ç¨‹æ¨¡å‹ï¼Œè¿™ç§æ–¹æ¡ˆä¼šå¯¹ Data Node é€ æˆè¾ƒå¤§å†²å‡»ã€‚<br>æœ€åæˆ‘ä»¬é€‰æ‹©äº†ä¸€ç§æ¯”è¾ƒç®€å•å¯è¡Œçš„æ–¹æ¡ˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621444471-aaff74d3-ec02-4014-8d71-1b201eafdbf1.webp#align=left&display=inline&height=582&margin=%5Bobject%20Object%5D&originHeight=582&originWidth=1080&size=0&status=done&style=none&width=1080" alt><br><br><br>Mapper çš„ Shuffle è¾“å‡ºæ•°æ®ä»ç„¶æŒ‰åŸæ–¹æ¡ˆå†™æœ¬åœ°ç£ç›˜ï¼Œå†™å®Œåä¸Šä¼ åˆ° HDFSã€‚Reducer ä»ç„¶æŒ‰åŸå§‹æ–¹æ¡ˆé€šè¿‡ Mapper ä¾§çš„ External Shuffle Service è¯»å– Shuffle æ•°æ®ã€‚å¦‚æœå¤±è´¥äº†ï¼Œåˆ™ä» HDFS è¯»å–ã€‚è¿™ç§æ–¹æ¡ˆæå¤§å‡å°‘äº†å¯¹ HDFS çš„è®¿é—®é¢‘ç‡ã€‚<br>è¯¥æ–¹æ¡ˆä¸Šçº¿è¿‘ä¸€å¹´ï¼š</p><ul><li>è¦†ç›– 57% ä»¥ä¸Šçš„ Spark Shuffle æ•°æ®ã€‚<br></li><li>ä½¿å¾— Spark ä½œä¸šæ•´ä½“æ€§èƒ½æå‡ 14%ã€‚<br></li><li>å¤©çº§å¤§ä½œä¸šæ€§èƒ½æå‡ 18%ã€‚<br></li><li>å°æ—¶çº§ä½œä¸šæ€§èƒ½æå‡ 12%ã€‚<br></li></ul><p><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621444424-472f0478-d4b8-47de-a9ea-557b4c201c05.webp#align=left&display=inline&height=670&margin=%5Bobject%20Object%5D&originHeight=670&originWidth=1200&size=0&status=done&style=none&width=1200" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/gif/1072113/1589621445065-2ed3ba00-5462-4f5f-9752-f2491fc7ea4d.gif#align=left&display=inline&height=1&margin=%5Bobject%20Object%5D&name=image.gif&originHeight=1&originWidth=1&size=70&status=done&style=none&width=1" alt="image.gif"><br>è¯¥æ–¹æ¡ˆæ—¨åœ¨æå‡ Spark Shuffle ç¨³å®šæ€§ä»è€Œæå‡ä½œä¸šç¨³å®šæ€§ï¼Œä½†æœ€ç»ˆæ²¡æœ‰ä½¿ç”¨æ–¹å·®ç­‰æŒ‡æ ‡æ¥è¡¡é‡ç¨³å®šæ€§çš„æå‡ã€‚åŸå› åœ¨äºæ¯å¤©é›†ç¾¤è´Ÿè½½ä¸ä¸€æ ·ï¼Œæ•´ä½“æ–¹å·®è¾ƒå¤§ã€‚Shuffle ç¨³å®šæ€§æå‡åï¼ŒStage Retry å¤§å¹…å‡å°‘ï¼Œæ•´ä½“ä½œä¸šæ‰§è¡Œæ—¶é—´å‡å°‘ï¼Œä¹Ÿå³æ€§èƒ½æå‡ã€‚æœ€ç»ˆé€šè¿‡å¯¹æ¯”ä½¿ç”¨è¯¥æ–¹æ¡ˆå‰åçš„æ€»çš„ä½œä¸šæ‰§è¡Œæ—¶é—´æ¥å¯¹æ¯”æ€§èƒ½çš„æå‡ï¼Œç”¨äºè¡¡é‡è¯¥æ–¹æ¡ˆçš„æ•ˆæœã€‚<br><strong>Shuffleæ€§èƒ½ä¼˜åŒ–å®è·µä¸æ¢ç´¢</strong><br>å¦‚ä¸Šæ–‡æ‰€åˆ†æï¼ŒShuffle æ€§èƒ½é—®é¢˜çš„åŸå› åœ¨äºï¼ŒShuffle Write ç”± Mapper å®Œæˆï¼Œç„¶å Reducer éœ€è¦ä»æ‰€æœ‰ Mapper å¤„è¯»å–æ•°æ®ã€‚è¿™ç§æ¨¡å‹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºä»¥ Mapper ä¸ºä¸­å¿ƒçš„ Shuffleã€‚å®ƒçš„é—®é¢˜åœ¨äºï¼š</p><ul><li>Mapper ä¾§ä¼šæœ‰ M æ¬¡é¡ºåºå†™ IOã€‚<br></li><li>Mapper ä¾§ä¼šæœ‰ M * N * 2 æ¬¡éšæœºè¯» IOï¼ˆè¿™æ˜¯æœ€å¤§çš„æ€§èƒ½ç“¶é¢ˆï¼‰ã€‚<br></li><li>Mapper ä¾§çš„ External Shuffle Service å¿…é¡»ä¸ Mapper ä½äºåŒä¸€å°æœºå™¨ï¼Œæ— æ³•åšåˆ°æœ‰æ•ˆçš„å­˜å‚¨è®¡ç®—åˆ†ç¦»ï¼ŒShuffle æœåŠ¡æ— æ³•ç‹¬ç«‹æ‰©å±•ã€‚<br></li></ul><p>é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬æå‡ºäº†ä»¥ Reducer ä¸ºä¸­å¿ƒçš„ï¼Œå­˜å‚¨è®¡ç®—åˆ†ç¦»çš„ Shuffle æ–¹æ¡ˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/webp/1072113/1589621444445-e51ea3d0-904b-48ff-af72-22657a86b3ba.webp#align=left&display=inline&height=730&margin=%5Bobject%20Object%5D&originHeight=730&originWidth=1200&size=0&status=done&style=none&width=1200" alt><br><br><br>è¯¥æ–¹æ¡ˆçš„åŸç†æ˜¯ï¼ŒMapper ç›´æ¥å°†å±äºä¸åŒ Reducer çš„æ•°æ®å†™åˆ°ä¸åŒçš„ Shuffle Serviceã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œæ€»å…± 2 ä¸ª Mapperï¼Œ5 ä¸ª Reducerï¼Œ5 ä¸ª Shuffle Serviceã€‚æ‰€æœ‰ Mapper éƒ½å°†å±äº Reducer 0 çš„æ•°æ®è¿œç¨‹æµå¼å‘é€ç»™ Shuffle Service 0ï¼Œå¹¶ç”±å®ƒé¡ºåºå†™å…¥ç£ç›˜ã€‚Reducer 0 åªéœ€è¦ä» Shuffle Service 0 é¡ºåºè¯»å–æ‰€æœ‰æ•°æ®å³å¯ï¼Œæ— éœ€å†ä» M ä¸ª Mapper å–æ•°æ®ã€‚è¯¥æ–¹æ¡ˆçš„ä¼˜åŠ¿åœ¨äºï¼š</p><ul><li>å°† M * N * 2 æ¬¡éšæœº IO å˜ä¸º N æ¬¡é¡ºåº IOã€‚<br></li><li>Shuffle Service å¯ä»¥ç‹¬ç«‹äº Mapper æˆ–è€… Reducer éƒ¨ç½²ï¼Œä»è€Œåšåˆ°ç‹¬ç«‹æ‰©å±•ï¼Œåšåˆ°å­˜å‚¨è®¡ç®—åˆ†ç¦»ã€‚<br></li><li>Shuffle Service å¯å°†æ•°æ®ç›´æ¥å­˜äº HDFS ç­‰é«˜å¯ç”¨å­˜å‚¨ï¼Œå› æ­¤å¯åŒæ—¶è§£å†³ Shuffle ç¨³å®šæ€§é—®é¢˜ã€‚<br></li></ul><p>æˆ‘çš„åˆ†äº«å°±åˆ°è¿™é‡Œï¼Œè°¢è°¢å¤§å®¶ã€‚<br><a name="23kL1"></a></p><h2 id="QAé›†é”¦"><a href="#QAé›†é”¦" class="headerlink" title="QAé›†é”¦"></a>QAé›†é”¦</h2><p><strong>- æé—®ï¼šç‰©åŒ–åˆ—æ–°å¢ä¸€åˆ—ï¼Œæ˜¯å¦éœ€è¦ä¿®æ”¹å†å²æ•°æ®ï¼Ÿ</strong><br>å›ç­”ï¼šå†å²æ•°æ®å¤ªå¤šï¼Œä¸é€‚åˆä¿®æ”¹å†å²æ•°æ®ã€‚</p><p><strong>- æé—®ï¼šå¦‚æœç”¨æˆ·çš„è¯·æ±‚åŒæ—¶åŒ…å«æ–°æ•°æ®å’Œå†å²æ•°æ®ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ</strong><br>å›ç­”ï¼šä¸€èˆ¬è€Œè¨€ï¼Œç”¨æˆ·ä¿®æ”¹æ•°æ®éƒ½æ˜¯ä»¥ Partition ä¸ºå•ä½ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨ Partition Parameter ä¸Šä¿å­˜äº†ç‰©åŒ–åˆ—ç›¸å…³ä¿¡æ¯ã€‚å¦‚æœç”¨æˆ·çš„æŸ¥è¯¢åŒæ—¶åŒ…å«äº†æ–° Partition ä¸å†å² Partitionï¼Œæˆ‘ä»¬ä¼šåœ¨æ–° Partition ä¸Šé’ˆå¯¹ç‰©åŒ–åˆ—è¿›è¡Œ SQL Rewriteï¼Œå†å² Partition ä¸ Rewriteï¼Œç„¶åå°†æ–°è€ Partition è¿›è¡Œ Unionï¼Œä»è€Œåœ¨ä¿è¯æ•°æ®æ­£ç¡®æ€§çš„å‰æä¸‹å°½å¯èƒ½å……åˆ†åˆ©ç”¨ç‰©åŒ–åˆ—çš„ä¼˜åŠ¿ã€‚</p><p><strong>- æé—®ï¼šä½ å¥½ï¼Œä½ ä»¬é’ˆå¯¹ç”¨æˆ·çš„åœºæ™¯ï¼Œåšäº†å¾ˆå¤šæŒºæœ‰ä»·å€¼çš„ä¼˜åŒ–ã€‚åƒç‰©åŒ–åˆ—ã€ç‰©åŒ–è§†å›¾ï¼Œéƒ½éœ€è¦æ ¹æ®ç”¨æˆ·çš„æŸ¥è¯¢ Pattern è¿›è¡Œè®¾ç½®ã€‚ç›®å‰ä½ ä»¬æ˜¯äººå·¥åˆ†æè¿™äº›æŸ¥è¯¢ï¼Œè¿˜æ˜¯æœ‰æŸç§æœºåˆ¶è‡ªåŠ¨å»åˆ†æå¹¶ä¼˜åŒ–ï¼Ÿ</strong><br>å›ç­”ï¼šç›®å‰æˆ‘ä»¬ä¸»è¦æ˜¯é€šè¿‡ä¸€äº›å®¡è®¡ä¿¡æ¯è¾…åŠ©äººå·¥åˆ†æã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿæ­£åœ¨åšç‰©åŒ–åˆ—ä¸ç‰©åŒ–è§†å›¾çš„æ¨èæœåŠ¡ï¼Œæœ€ç»ˆåšåˆ°æ™ºèƒ½å»ºè®¾ç‰©åŒ–åˆ—ä¸ç‰©åŒ–è§†å›¾ã€‚</p><p><strong>- æé—®ï¼šåˆšåˆšä»‹ç»çš„åŸºäº HDFS çš„ Spark Shuffle ç¨³å®šæ€§æå‡æ–¹æ¡ˆï¼Œæ˜¯å¦å¯ä»¥å¼‚æ­¥ä¸Šä¼  Shuffle æ•°æ®è‡³ HDFSï¼Ÿ</strong><br>å›ç­”ï¼šè¿™ä¸ªæƒ³æ³•æŒºå¥½ï¼Œæˆ‘ä»¬ä¹‹å‰ä¹Ÿè€ƒè™‘è¿‡ï¼Œä½†åŸºäºå‡ ç‚¹è€ƒè™‘ï¼Œæœ€ç»ˆæ²¡æœ‰è¿™æ ·åšã€‚ç¬¬ä¸€ï¼Œå• Mapper çš„ Shuffle è¾“å‡ºæ•°æ®é‡ä¸€èˆ¬å¾ˆå°ï¼Œä¸Šä¼ åˆ° HDFS è€—æ—¶åœ¨ 2 ç§’ä»¥å†…ï¼Œè¿™ä¸ªæ—¶é—´å¼€é”€å¯ä»¥å¿½ç•¥ï¼›ç¬¬äºŒï¼Œæˆ‘ä»¬å¹¿æ³›ä½¿ç”¨ External Shuffle Service å’Œ Dynamic Allocationï¼ŒMapper æ‰§è¡Œå®Œæˆåå¯èƒ½ Executor å°±å›æ”¶äº†ï¼Œå¦‚æœè¦å¼‚æ­¥ä¸Šä¼ ï¼Œå°±å¿…é¡»ä¾èµ–å…¶å®ƒç»„ä»¶ï¼Œè¿™ä¼šæå‡å¤æ‚åº¦ï¼ŒROI è¾ƒä½ã€‚</p><p><a name="BtHKy"></a></p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>å­—èŠ‚çš„è¿™ç¯‡åˆ†äº«ï¼Œæˆ‘çœŸçš„å¤ªå–œæ¬¢äº†ï¼Œæ‰€æœ‰çš„ä¼˜åŒ–ç‚¹ï¼Œéƒ½æ˜¯æ‹¿çœŸå®çš„ä¸šåŠ¡åœºæ™¯è¿›è¡Œä¸¾ä¾‹ï¼Œè™½ç„¶ä¸Šæ–‡æœ‰çš„æŠ€æœ¯ç‚¹åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­è¿˜æ²¡å¿…è¦å»åšåˆ°è¿™ç§ä¼˜åŒ–ç¨‹åº¦ï¼Œä½†æ˜¯å¦‚æ­¤å®åœ¨çš„æ¥æºäºçº¿ä¸Šçš„æ–¹æ¡ˆï¼Œéå¸¸å®¹æ˜“ç†è§£ã€‚æˆ‘ä»¬å…¬å¸ç›®å‰çš„æ•°æ®é‡è¦æ¯”å­—èŠ‚çš„é‡å°å¾ˆå¤šï¼Œæœ€è¿‘åœ¨æ–°é—»ä¸Šçœ‹åˆ°æŠ–éŸ³çš„æ—¥æ´»å·²ç»è¾¾åˆ°äº†4äº¿ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ•°ä»“ä¸­çš„æ•°æ®ï¼Œè¿˜æ²¡æœ‰ç”¨åˆ°æ›´ç»†ç²’åº¦çš„Bucketè¡¨ï¼Œåˆ†åŒºè¡¨å°±å·²ç»å®Œå…¨å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ä¸Šæ–‡ä¸­çš„ç‰©åŒ–åˆ—æ–¹æ¡ˆï¼Œæˆ‘è§‰å¾—å¾ˆæ–°é¢–ï¼Œä½†æ˜¯ä»å·¥ç¨‹å¸ˆçš„è§’åº¦æ¥è®²ï¼Œåœ¨ç‰©åŒ–åˆ—æ–¹æ¡ˆä¸­ï¼Œå¤šç»´æŠ¤ä¸€å¼ è¡¨ï¼Œæ·»åŠ äº†å¤æ‚åº¦å’Œè¿è¥æˆæœ¬ï¼Œæˆ‘ä»¬åœ¨æ•°æ®çš„å­˜å‚¨ä¸­ï¼Œå°½å¯é‡çš„å›å»é¿å…å¤æ‚ç»“æ„çš„æ•°æ®ç±»å‹ï¼Œè¿™æ ·ä¼šé™ä½å­˜å‚¨ç«¯å’Œè®¡ç®—ç«¯ä»£ç çš„å¤æ‚åº¦ã€‚è¿™ç¯‡æ–‡ç« æ˜¯é’ˆå¯¹Spark SQLçš„ä¼˜åŒ–æ–¹é¢ï¼Œå¯ä»¥è¯´åŸºæœ¬ä¸Šæ¯ä¸ªå¤§æ•°æ®å…¬å¸éƒ½ä¼šç”¨åˆ°Spark SQLï¼Œä¸Šè¿°çš„ä¼˜åŒ–æ–¹æ¡ˆè‚¯å®šä¼šå¸®åŠ©åˆ°æ›´å¤šçš„å¤§æ•°æ®å›¢é˜Ÿ ğŸ’ª</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:12 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;&lt;br&gt;æœ¬æ–‡è½¬è½½è‡ªå­—èŠ‚è·³åŠ¨æŠ€æœ¯å›¢é˜Ÿåœ¨æ˜é‡‘ç½‘ä¸Šå‘è¡¨çš„æ–‡ç« ï¼Œä¸»è¦æ˜¯Spark SQLåœ¨å­—èŠ‚æ•°æ®ä»“åº“åº”ç”¨æ–¹é¢çš„ä¼˜åŒ–å®è·µ&lt;br&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href
      
    
    </summary>
    
    
      <category term="å¤§æ•°æ®" scheme="cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="spark" scheme="cpeixin.cn/tags/spark/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘çš„æœåŠ¡å™¨è¢«é»‘äº†ï¼ˆäºŒï¼‰</title>
    <link href="cpeixin.cn/2019/09/09/%E6%88%91%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E9%BB%91%E4%BA%86%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>cpeixin.cn/2019/09/09/%E6%88%91%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E9%BB%91%E4%BA%86%EF%BC%88%E4%BA%8C%EF%BC%89/</id>
    <published>2019-09-09T02:26:15.000Z</published>
    <updated>2020-04-04T12:00:14.168Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><p>è‹¦é€¼çš„å‘¨ä¸€å¼€å§‹äº†ï¼Œè‹¦é€¼çš„å·¥ä½œå¼€å§‹äº†ï¼Œååˆ°å·¥ä½ä¸Šï¼Œä¸Šç­æ°”æ­£åœ¨é€æ¸çš„å‡å¼±ï¼Œä½†æ˜¯å½“æˆ‘å‘ç°ï¼Œæˆ‘çš„ä¸‰å°æœåŠ¡å™¨åˆè¢«é‚£äº›æ— æƒ…çš„å°é»‘äººä»¬ç›¯ä¸Šäº†çš„æ—¶å€™ï¼Œæˆ‘çš„æ€’æ°”å€¼è¾¾åˆ°äº†é¡¶ç‚¹ï¼ŒåŒæ—¶è¿˜æ„Ÿè§‰æœ‰ç‚¹ä¸¢è„¸ï¼Œå“ˆå“ˆå“ˆã€‚<br><br><br>ç”±äºè¿™ä¸‰å°æœåŠ¡å™¨å±äºæˆ‘ä¸ªäººçš„ï¼Œæ²¡æœ‰ç»è¿‡è¿ç»´å…„å¼Ÿçš„ç…§é¡¾ï¼Œæ‰€ä»¥åœ¨å®‰å…¨æ–¹é¢ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰é˜²æŠ¤ã€‚<br>è¿™æ¬¡æ˜¯æ€ä¹ˆå‘ç°çš„å‘¢ï¼Œæ˜¯å› ä¸ºæˆ‘æœåŠ¡å™¨ä¸Šçš„çˆ¬è™«çªç„¶åœæ­¢äº†ï¼Œæˆ‘å¸¦ç€ç–‘é—®å»çœ‹äº†ä¸‹ç³»ç»Ÿæ—¥å¿—ã€‚äºæ˜¯æ•²ä¸‹äº†ä¸‹é¢çš„å‘½ä»¤<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl -xe</span><br></pre></td></tr></table></figure><p><br>æ˜ å…¥çœ¼å¸˜çš„æ˜¯æ»¡å±çš„æ‰«æå’Œsshå°è¯•ç™»é™†<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">50</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">303</span>]: Failed password <span class="keyword">for</span> invalid user admin <span class="keyword">from</span> <span class="number">117.132</span><span class="number">.175</span><span class="number">.25</span> port <span class="number">42972</span> ssh2</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">50</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">303</span>]: Received disconnect <span class="keyword">from</span> <span class="number">117.132</span><span class="number">.175</span><span class="number">.25</span> port <span class="number">42972</span>:<span class="number">11</span>: Bye Bye [preauth]</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">50</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">303</span>]: Disconnected <span class="keyword">from</span> <span class="number">117.132</span><span class="number">.175</span><span class="number">.25</span> port <span class="number">42972</span> [preauth]</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">50</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65525</span>]: Failed password <span class="keyword">for</span> root <span class="keyword">from</span> <span class="number">49.88</span><span class="number">.112</span><span class="number">.54</span> port <span class="number">24184</span> ssh2</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">50</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">302</span>]: Failed password <span class="keyword">for</span> invalid user ansible <span class="keyword">from</span> <span class="number">149.56</span><span class="number">.96</span><span class="number">.78</span> port <span class="number">44980</span> ssh2</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">50</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">302</span>]: Received disconnect <span class="keyword">from</span> <span class="number">149.56</span><span class="number">.96</span><span class="number">.78</span> port <span class="number">44980</span>:<span class="number">11</span>: Bye Bye [preauth]</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">50</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">302</span>]: Disconnected <span class="keyword">from</span> <span class="number">149.56</span><span class="number">.96</span><span class="number">.78</span> port <span class="number">44980</span> [preauth]</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">50</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65525</span>]: pam_succeed_if(sshd:auth): requirement <span class="string">"uid &gt;= 1000"</span> <span class="keyword">not</span> met by user <span class="string">"root"</span></span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">51</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65522</span>]: Failed password <span class="keyword">for</span> root <span class="keyword">from</span> <span class="number">218.92</span><span class="number">.0</span><span class="number">.163</span> port <span class="number">45157</span> ssh2</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">51</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65522</span>]: error: maximum authentication attempts exceeded <span class="keyword">for</span> root <span class="keyword">from</span> <span class="number">218.92</span><span class="number">.0</span><span class="number">.163</span> port <span class="number">45157</span> ssh2 [preauth]</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">51</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65522</span>]: Disconnecting: Too many authentication failures [preauth]</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">51</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65522</span>]: PAM <span class="number">5</span> more authentication failures; logname= uid=<span class="number">0</span> euid=<span class="number">0</span> tty=ssh ruser= rhost=<span class="number">218.92</span><span class="number">.0</span><span class="number">.163</span>  user=root</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">51</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65522</span>]: PAM service(sshd) ignoring max retries; <span class="number">6</span> &gt; <span class="number">3</span></span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">52</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">310</span>]: pam_unix(sshd:auth): authentication failure; logname= uid=<span class="number">0</span> euid=<span class="number">0</span> tty=ssh ruser= rhost=<span class="number">218.92</span><span class="number">.0</span><span class="number">.163</span>  user=root</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">52</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">310</span>]: pam_succeed_if(sshd:auth): requirement <span class="string">"uid &gt;= 1000"</span> <span class="keyword">not</span> met by user <span class="string">"root"</span></span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">53</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65525</span>]: Failed password <span class="keyword">for</span> root <span class="keyword">from</span> <span class="number">49.88</span><span class="number">.112</span><span class="number">.54</span> port <span class="number">24184</span> ssh2</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">53</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65525</span>]: error: maximum authentication attempts exceeded <span class="keyword">for</span> root <span class="keyword">from</span> <span class="number">49.88</span><span class="number">.112</span><span class="number">.54</span> port <span class="number">24184</span> ssh2 [preauth]</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">53</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65525</span>]: Disconnecting: Too many authentication failures [preauth]</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">53</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65525</span>]: PAM <span class="number">5</span> more authentication failures; logname= uid=<span class="number">0</span> euid=<span class="number">0</span> tty=ssh ruser= rhost=<span class="number">49.88</span><span class="number">.112</span><span class="number">.54</span>  user=root</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">53</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65525</span>]: PAM service(sshd) ignoring max retries; <span class="number">6</span> &gt; <span class="number">3</span></span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">54</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">314</span>]: pam_unix(sshd:auth): authentication failure; logname= uid=<span class="number">0</span> euid=<span class="number">0</span> tty=ssh ruser= rhost=<span class="number">49.88</span><span class="number">.112</span><span class="number">.54</span>  user=root</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">54</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">314</span>]: pam_succeed_if(sshd:auth): requirement <span class="string">"uid &gt;= 1000"</span> <span class="keyword">not</span> met by user <span class="string">"root"</span></span><br><span class="line">lines <span class="number">1105</span><span class="number">-1127</span>/<span class="number">1127</span> (END)</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">49</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65522</span>]: pam_succeed_if(sshd:auth): requirement <span class="string">"uid &gt;= 1000"</span> <span class="keyword">not</span> met by user <span class="string">"root"</span></span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">50</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">303</span>]: Failed password <span class="keyword">for</span> invalid user admin <span class="keyword">from</span> <span class="number">117.132</span><span class="number">.175</span><span class="number">.25</span> port <span class="number">42972</span> ssh2</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">50</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">303</span>]: Received disconnect <span class="keyword">from</span> <span class="number">117.132</span><span class="number">.175</span><span class="number">.25</span> port <span class="number">42972</span>:<span class="number">11</span>: Bye Bye [preauth]</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">50</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">303</span>]: Disconnected <span class="keyword">from</span> <span class="number">117.132</span><span class="number">.175</span><span class="number">.25</span> port <span class="number">42972</span> [preauth]</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">50</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65525</span>]: Failed password <span class="keyword">for</span> root <span class="keyword">from</span> <span class="number">49.88</span><span class="number">.112</span><span class="number">.54</span> port <span class="number">24184</span> ssh2</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">50</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">302</span>]: Failed password <span class="keyword">for</span> invalid user ansible <span class="keyword">from</span> <span class="number">149.56</span><span class="number">.96</span><span class="number">.78</span> port <span class="number">44980</span> ssh2</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">50</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">302</span>]: Received disconnect <span class="keyword">from</span> <span class="number">149.56</span><span class="number">.96</span><span class="number">.78</span> port <span class="number">44980</span>:<span class="number">11</span>: Bye Bye [preauth]</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">50</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">302</span>]: Disconnected <span class="keyword">from</span> <span class="number">149.56</span><span class="number">.96</span><span class="number">.78</span> port <span class="number">44980</span> [preauth]</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">50</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65525</span>]: pam_succeed_if(sshd:auth): requirement <span class="string">"uid &gt;= 1000"</span> <span class="keyword">not</span> met by user <span class="string">"root"</span></span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">51</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65522</span>]: Failed password <span class="keyword">for</span> root <span class="keyword">from</span> <span class="number">218.92</span><span class="number">.0</span><span class="number">.163</span> port <span class="number">45157</span> ssh2</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">51</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65522</span>]: error: maximum authentication attempts exceeded <span class="keyword">for</span> root <span class="keyword">from</span> <span class="number">218.92</span><span class="number">.0</span><span class="number">.163</span> port <span class="number">45157</span> ssh2 [preauth]</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">51</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65522</span>]: Disconnecting: Too many authentication failures [preauth]</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">51</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65522</span>]: PAM <span class="number">5</span> more authentication failures; logname= uid=<span class="number">0</span> euid=<span class="number">0</span> tty=ssh ruser= rhost=<span class="number">218.92</span><span class="number">.0</span><span class="number">.163</span>  user=root</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">51</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65522</span>]: PAM service(sshd) ignoring max retries; <span class="number">6</span> &gt; <span class="number">3</span></span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">52</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">310</span>]: pam_unix(sshd:auth): authentication failure; logname= uid=<span class="number">0</span> euid=<span class="number">0</span> tty=ssh ruser= rhost=<span class="number">218.92</span><span class="number">.0</span><span class="number">.163</span>  user=root</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">52</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">310</span>]: pam_succeed_if(sshd:auth): requirement <span class="string">"uid &gt;= 1000"</span> <span class="keyword">not</span> met by user <span class="string">"root"</span></span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">53</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65525</span>]: Failed password <span class="keyword">for</span> root <span class="keyword">from</span> <span class="number">49.88</span><span class="number">.112</span><span class="number">.54</span> port <span class="number">24184</span> ssh2</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">53</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65525</span>]: error: maximum authentication attempts exceeded <span class="keyword">for</span> root <span class="keyword">from</span> <span class="number">49.88</span><span class="number">.112</span><span class="number">.54</span> port <span class="number">24184</span> ssh2 [preauth]</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">53</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65525</span>]: Disconnecting: Too many authentication failures [preauth]</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">53</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65525</span>]: PAM <span class="number">5</span> more authentication failures; logname= uid=<span class="number">0</span> euid=<span class="number">0</span> tty=ssh ruser= rhost=<span class="number">49.88</span><span class="number">.112</span><span class="number">.54</span>  user=root</span><br><span class="line">Sep <span class="number">09</span> <span class="number">11</span>:<span class="number">02</span>:<span class="number">53</span> <span class="number">4</span>Z-J16-A47 sshd[<span class="number">65525</span>]: PAM service(sshd) ignoring max retries; <span class="number">6</span> &gt; <span class="number">3</span></span><br></pre></td></tr></table></figure><p><br>çœ‹åˆ°è¿™é‡Œï¼Œæ„Ÿè§‰è‡ªå·±å®¶çš„é¸¡ï¼Œéšæ—¶éƒ½è¦è¢«å·èµ°å‘€ã€‚ã€‚ã€‚ã€‚è¿™è¿˜äº†å¾—ã€‚äºæ˜¯é©¬ä¸Šå¼€å§‹äº†åŠ å›ºé˜²æŠ¤<br>å¯¹å¾…è¿™ç§æƒ…å†µï¼Œå°±æ˜¯è¦ç¦æ­¢rootç”¨æˆ·è¿œç¨‹ç™»å½•ï¼Œä½¿ç”¨æ–°å»ºæ™®é€šç”¨æˆ·ï¼Œè¿›è¡Œè¿œç¨‹ç™»å½•ï¼Œè¿˜æœ‰é‡è¦çš„ä¸€ç‚¹ï¼Œä¿®æ”¹é»˜è®¤22ç«¯å£ã€‚<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@*** ~]<span class="comment"># useradd one             #åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">[root@*** ~]<span class="comment"># passwd one              #è®¾ç½®å¯†ç </span></span><br></pre></td></tr></table></figure><p><br>è¾“å…¥æ–°ç”¨æˆ·å¯†ç <br>é¦–å…ˆç¡®ä¿æ–‡ä»¶ /etc/sudoers ä¸­<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">%wheel    ALL=(ALL)    ALL</span><br><span class="line">```  </span><br><span class="line">æ²¡æœ‰è¢«æ³¨é‡Š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```linux</span><br><span class="line">usermod -g wheel onerocket</span><br></pre></td></tr></table></figure><p><br>è®¾ç½®åªæœ‰æŒ‡å®šç”¨æˆ·ç»„æ‰èƒ½ä½¿ç”¨suå‘½ä»¤åˆ‡æ¢åˆ°rootç”¨æˆ·<br><br><br>åœ¨linuxä¸­ï¼Œæœ‰ä¸€ä¸ªé»˜è®¤çš„ç®¡ç†ç»„ wheelã€‚åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå³ä½¿æˆ‘ä»¬æœ‰ç³»ç»Ÿç®¡ç†å‘˜rootçš„æƒé™ï¼Œä¹Ÿä¸æ¨èç”¨rootç”¨æˆ·ç™»å½•ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ç”¨æ™®é€šç”¨æˆ·ç™»å½•å°±å¯ä»¥äº†ï¼Œåœ¨éœ€è¦rootæƒé™æ‰§è¡Œä¸€äº›æ“ä½œæ—¶ï¼Œå†suç™»å½•æˆä¸ºrootç”¨æˆ·ã€‚ä½†æ˜¯ï¼Œä»»ä½•äººåªè¦çŸ¥é“äº†rootçš„å¯†ç ï¼Œå°±éƒ½å¯ä»¥é€šè¿‡suå‘½ä»¤æ¥ç™»å½•ä¸ºrootç”¨æˆ·ï¼Œè¿™æ— ç–‘ä¸ºç³»ç»Ÿå¸¦æ¥äº†å®‰å…¨éšæ‚£ã€‚æ‰€ä»¥ï¼Œå°†æ™®é€šç”¨æˆ·åŠ å…¥åˆ°wheelç»„ï¼Œè¢«åŠ å…¥çš„è¿™ä¸ªæ™®é€šç”¨æˆ·å°±æˆäº†ç®¡ç†å‘˜ç»„å†…çš„ç”¨æˆ·ã€‚ç„¶åè®¾ç½®åªæœ‰wheelç»„å†…çš„æˆå‘˜å¯ä»¥ä½¿ç”¨suå‘½ä»¤åˆ‡æ¢åˆ°rootç”¨æˆ·ã€‚<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /bin/bash</span></span><br><span class="line"><span class="comment"># Function: ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä½¿å¾—åªæœ‰wheelç»„çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨ su æƒé™</span></span><br><span class="line">sed -i <span class="string">'/pam_wheel.so use_uid/c\auth            required        pam_wheel.so use_uid '</span> /etc/pam.d/su</span><br><span class="line">n=`cat /etc/login.defs | grep SU_WHEEL_ONLY | wc -l`</span><br><span class="line"><span class="keyword">if</span> [ $n -eq <span class="number">0</span> ];then</span><br><span class="line">echo SU_WHEEL_ONLY yes &gt;&gt; /etc/login.defs</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p><br>æ‰“å¼€SSHDçš„é…ç½®æ–‡ä»¶<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p><br>æŸ¥æ‰¾â€œ#PermitRootLogin yesâ€ï¼Œå°†å‰é¢çš„â€œ#â€å»æ‰ï¼ŒçŸ­å°¾â€œyesâ€æ”¹ä¸ºâ€œnoâ€ï¼ˆä¸åŒç‰ˆæœ¬å¯èƒ½åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œå¹¶ä¿å­˜æ–‡ä»¶ã€‚<br><br><br>ä¿®æ”¹sshdé»˜è®¤ç«¯å£<br>è™½ç„¶æ›´æ”¹ç«¯å£æ— æ³•åœ¨æ ¹æœ¬ä¸ŠæŠµå¾¡ç«¯å£æ‰«æï¼Œä½†æ˜¯ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜é˜²å¾¡ã€‚<br>æ‰“å¼€sshdé…ç½®æ–‡ä»¶<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p><br>æ‰¾åˆ°#Port 22 åˆ æ‰æ³¨é‡Š<br><br><br><em>æœåŠ¡å™¨ç«¯å£æœ€å¤§å¯ä»¥å¼€åˆ°65536</em><br><br><br>åŒæ—¶å†æ·»åŠ ä¸€ä¸ªPort 61024 ï¼ˆéšæ„è®¾ç½®ï¼‰<br><br><br>Port 22<br>Port 61024<br><br><br>é‡å¯sshdæœåŠ¡<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service sshd restart      <span class="comment">#centos6ç³»åˆ—</span></span><br><span class="line">systemctl restart sshd  <span class="comment">#centos7ç³»åˆ—</span></span><br><span class="line">firewall-cmd --add-port=<span class="number">61024</span>/tcp</span><br></pre></td></tr></table></figure><p><br>æµ‹è¯•ï¼Œä½¿ç”¨æ–°ç”¨æˆ·ï¼Œæ–°ç«¯å£è¿›è¡Œç™»å½•<br><br><br>å¦‚æœç™»é™†æˆåŠŸåï¼Œå†å°†Port22æ³¨é‡Šæ‰ï¼Œé‡å¯sshdæœåŠ¡ã€‚<br>åˆ°è¿™é‡Œï¼Œå…³äºè¿œç¨‹ç™»å½•çš„é˜²æŠ¤å·¥ä½œï¼Œå°±åšå¥½äº†ã€‚<br>æœ€åï¼Œå‘Šè¯«å¤§å®¶ï¼Œäº²èº«ä½“éªŒï¼Œæ²¡æœ‰é˜²æŠ¤è£¸å¥”çš„æœåŠ¡å™¨ï¼ŒçœŸçš„å¤ªå®¹æ˜“è¢«æŠ“è‚‰é¸¡äº†ï¼ï¼ï¼ï¼ï¼</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;è‹¦é€¼çš„å‘¨ä¸€å¼€å§‹äº†ï¼Œè‹¦é€¼çš„å·¥ä½œå¼€å§‹äº†ï¼Œååˆ°å·¥ä½ä¸Šï¼Œä¸Šç­æ°”æ­£åœ¨é€æ¸çš„å‡å¼±ï¼Œä½†æ˜¯å½“æˆ‘å‘ç°ï¼Œæˆ‘çš„ä¸‰å°æœåŠ¡å™¨åˆè¢«é‚£äº›æ— æƒ…çš„å°é»‘äººä»¬ç›¯ä¸Šäº†çš„æ—¶å€™ï¼Œæˆ‘çš„æ€’æ°”å€¼
      
    
    </summary>
    
    
      <category term="Linux" scheme="cpeixin.cn/categories/Linux/"/>
    
    
      <category term="æœåŠ¡å™¨å®‰å…¨" scheme="cpeixin.cn/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘çš„æœåŠ¡å™¨è¢«é»‘äº†</title>
    <link href="cpeixin.cn/2019/08/24/%E6%88%91%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E9%BB%91%E4%BA%86/"/>
    <id>cpeixin.cn/2019/08/24/%E6%88%91%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E9%BB%91%E4%BA%86/</id>
    <published>2019-08-24T02:26:15.000Z</published>
    <updated>2020-04-04T12:00:09.871Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><p><a name="-2"></a></p><h1 id="æœåŠ¡å™¨è‡ªè¿°"><a href="#æœåŠ¡å™¨è‡ªè¿°" class="headerlink" title="æœåŠ¡å™¨è‡ªè¿°"></a>æœåŠ¡å™¨è‡ªè¿°</h1><p>æˆ‘æ˜¯ä¸€å°8æ ¸ï¼Œ16Gå†…å­˜ï¼Œ4Tçš„Linux (centOS 7)æœåŠ¡å™¨â€¦ è¿˜æœ‰ä¸¤å°å’Œæˆ‘ä¸€èµ·è¢«ä¹°æ¥çš„è‹¦ä¸»ï¼Œæˆ‘ä»¬ä¸€åŒé•¿å¤§ï¼Œé…ç½®ä¸€æ ·ï¼Œéƒ½æ˜¯ä»é¦™æ¸¯è¢«è´©å–åˆ°å›½å¤–ï¼Œæˆ‘ä»¬ä¸‰ä¸ªç»„æˆäº†åˆ†å¸ƒå¼çˆ¬è™«æ¡†æ¶ï¼Œå¦ä¸¤ä½è‹¦ä¸»åˆ†åˆ«è´Ÿè´£å¼‚æ­¥çˆ¬å–è¿æ¥ï¼Œå¤šè¿›ç¨‹çˆ¬å–è¿æ¥å’Œscrapy-redisåˆ†å¸ƒå¼çˆ¬å–è§£æã€‚<br><br><br>è€Œæˆ‘æ¯”è¾ƒæ¸…é—²ï¼Œåªè´Ÿè´£å­˜å‚¨. ç½‘é¡µé“¾æ¥æ”¾åœ¨æˆ‘çš„redisä¸­ï¼Œè€Œè§£æå¥½çš„æ–‡ç« ä¿¡æ¯æ”¾åœ¨æˆ‘çš„MySQLä¸­ã€‚ç„¶è€Œæ•…äº‹çš„å¼€å§‹ï¼Œå°±æ˜¯åœ¨å®‰è£…redisçš„é‚£å¤©ï¼Œä¸»äººçš„ç²—å¿ƒå¤§æ„ï¼Œä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œä»è€Œè®©ä»–ä»Šå¤©èŠ±è´¹äº†å°åŠå¤©æ¥å¯¹æˆ‘è¿›è¡Œç»´ä¿®ï¼ï¼ğŸ˜¢<br><a name="-3"></a></p><h1 id="ä¸ºä»€ä¹ˆé»‘æˆ‘çš„æœåŠ¡å™¨"><a href="#ä¸ºä»€ä¹ˆé»‘æˆ‘çš„æœåŠ¡å™¨" class="headerlink" title="ä¸ºä»€ä¹ˆé»‘æˆ‘çš„æœåŠ¡å™¨"></a>ä¸ºä»€ä¹ˆé»‘æˆ‘çš„æœåŠ¡å™¨</h1><p>è¿™æ ·ä¸€å°é…ç½®çš„æœåŠ¡å™¨ï¼Œä¸€ä¸ªæœˆçš„ä»·æ ¼å¤§æ¦‚åœ¨1000RMBä¸€ä¸ªæœˆï¼Œæ€ä¹ˆè¯´å‘¢â€¦ è¿™ä¸ªä»·æ ¼çš„æœåŠ¡å™¨å¯¹äºä¸ªäººç”¨æˆ·æ­å»ºè‡ªå·±ç©çš„ç¯å¢ƒè¿˜æ˜¯æœ‰äº›å°è´µçš„ã€‚ä¾‹å¦‚æˆ‘ç°åœ¨å†™åšå®¢ï¼Œä¹Ÿæ˜¯æ‰˜ç®¡åœ¨GitHubä¸Šçš„ï¼Œæˆ‘ä¹Ÿå¯ä»¥ç§Ÿç”¨ä¸€å°æœåŠ¡å™¨æ¥æ‰˜ç®¡çš„åšå®¢ï¼Œä½†æ˜¯ç›®å‰æˆ‘çš„è¿™ç§çº§åˆ«ï¼Œä¹Ÿæ˜¯è¦è€ƒè™‘åˆ°æŠ•å…¥äº§å‡ºæ¯”æ˜¯å¦åˆé€‚ï¼Œå“ˆå“ˆå“ˆã€‚<br><br><br>ä½†æ˜¯å¯¹äºï¼ŒæœåŠ¡å™¨ä¸Šè¿è¡Œçš„ä»»åŠ¡å’ŒæœåŠ¡äº§å‡ºçš„ä»·å€¼è¦è¿œè¿œå¤§äºæœåŠ¡å™¨ä»·å€¼çš„æ—¶å€™ï¼Œè¿™1000å¤šRMBå°±å¯ä»¥å¿½ç•¥ä¸è®¡äº†ã€‚åŒæ—¶ï¼Œè¿˜æœ‰é»‘è¡£äººï¼Œä»–ä»¬éœ€è¦å¤§é‡çš„æœåŠ¡å™¨ï¼Œæ¥è¿è¡ŒåŒæ ·çš„ç¨‹åºï¼Œäº§å‡ºçš„ä»·å€¼ä»–ä»¬ä¹Ÿæ— æ³•è¡¡é‡ï¼Œæœ‰å¯èƒ½å¾ˆå¤šæœ‰å¯èƒ½å¾ˆå°‘ã€‚ã€‚<br><br><br>é‚£ä¹ˆè¿™æ—¶å€™ï¼Œä»–ä»¬ä¸ºäº†èŠ‚çº¦æˆæœ¬ï¼Œé™ä½æˆæœ¬ï¼Œå°±ä¼šç”¨ä¸€äº›é»‘è‰²çš„æ‰‹æ³•ï¼Œä¾‹å¦‚æ¸—é€ï¼Œsqlæ³¨å…¥ï¼Œæ ¹æ®æ¼æ´æ‰«æç­‰æ–¹æ³•æ¥ æŠ“â€œè‚‰é¸¡â€ï¼ŒæŠ“åˆ°å¤§é‡çš„å¯ä¾µå…¥çš„æœåŠ¡å™¨ï¼Œç„¶ååœ¨ä½ çš„æœåŠ¡å™¨ä¸Šçš„æŸä¸€ä¸ªè§’è½ï¼Œæ”¾ä¸Šä»–çš„ç¨‹åºï¼Œä¸€ç›´åœ¨è¿è¡Œï¼Œä¸€ç›´åœ¨è¿è¡Œï¼Œå ç”¨ç€ä½ çš„cpu,å ç”¨ç€ä½ çš„å¸¦å®½â€¦<br><br><br>é‚£ä¹ˆä¸Šé¢æåˆ°çš„é»‘è¡£äººï¼Œå°±æœ‰é‚£ä¹ˆä¸€ç±»è§’è‰²ï¼Œâ€œçŸ¿å·¥â€ï¼ï¼ï¼ï¼<br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585404954445-f30a25a0-5939-4773-b5d9-8bb6a7c53b02.png#align=left&display=inline&height=892&name=1.png&originHeight=892&originWidth=1244&size=1778564&status=done&style=none&width=1244" alt="1.png"><br><br><br>æ›¾ç»ï¼Œæˆ‘ä¹Ÿä¸“æ³¨è¿‡åŒºå—é“¾ï¼Œæˆ‘ä¹ŸçŸ­æš‚çš„è¿·å¤±åœ¨æ•°å­—è´§å¸çš„æµªæ½®ä¸­ï¼Œä½†æ˜¯æ²¡æœ‰åƒåˆ°çº¢åˆ©ğŸ‘€ğŸ‘€ğŸ‘€ å°±æ˜¯è¿™äº›æ•°å­—ä¸–ç•Œçš„çŸ¿å·¥ï¼Œåˆ©ç”¨æˆ‘æœåŠ¡å™¨çš„æ¼æ´é»‘äº†æˆ‘çš„æœåŠ¡å™¨<br><a name="-4"></a></p><h1 id="å¦‚ä½•å‘ç°è¢«é»‘"><a href="#å¦‚ä½•å‘ç°è¢«é»‘" class="headerlink" title="å¦‚ä½•å‘ç°è¢«é»‘"></a>å¦‚ä½•å‘ç°è¢«é»‘</h1><p>å›åˆ°è¿™ç¯‡åšå®¢çš„æ­£é¢˜ï¼Œæˆ‘æ˜¯å¦‚ä½•å‘ç°ï¼Œæˆ‘çš„æœåŠ¡å™¨è¢«é»‘äº†å‘¢ï¼Ÿï¼Ÿ<br><br><br>æœ€è¿‘æˆ‘åœ¨åšscrapyåˆ†å¸ƒå¼çˆ¬è™«æ–¹é¢çš„å·¥ä½œï¼Œå‡†å¤‡äº†ä¸‰å°æœåŠ¡å™¨ï¼Œè€Œè¿™å°è¢«é»‘çš„æœåŠ¡å™¨æ˜¯æˆ‘ç”¨æ¥åšå­˜å‚¨çš„ï¼Œå…¶ä¸­ç”¨åˆ°äº†rediså’Œmysqlã€‚å…¶ä¸­å¼•å‘è¿™ä»¶äº‹æƒ…çš„å°±æ˜¯redisï¼Œæˆ‘åœ¨å®‰è£…redisçš„æ—¶å€™ï¼Œå¯ä»¥è¯´è´£ä»»å®Œå…¨åœ¨æˆ‘ï¼Œæˆ‘ä¸ºäº†å®‰è£…èŠ‚çº¦æ—¶é—´ï¼Œä»¥åä½¿ç”¨æ–¹ä¾¿ç­‰ï¼Œåšäº†å‡ ä¸ªå¾ˆé”™è¯¯çš„æ“ä½œ<br><br><br>1.å…³é—­äº†Linuxé˜²ç«å¢™<br><br><br>2.æ²¡æœ‰è®¾ç½®redisè®¿é—®å¯†ç <br><br><br>3.æ²¡æœ‰æ›´æ”¹redisé»˜è®¤ç«¯å£<br><br><br>4.å¼€æ”¾äº†ä»»æ„IPå¯ä»¥è¿œç¨‹è¿æ¥<br><br><br>ä»¥ä¸Šå››ä¸ªå¾ˆå‚»çš„æ“ä½œ,éƒ½æ˜¯å› ä¸ºä»¥å‰æ‰€ç”¨çš„rediséƒ½æ˜¯æœ‰å…¬å¸è¿ç»´åŒäº‹è¿›è¡Œå®‰è£…ä»¥åŠå®‰å…¨ç­–ç•¥æ–¹é¢çš„é…ç½®ï¼Œä»¥è‡³æˆ‘è¿™ä¸€æ¬¡æ²¡æœ‰æ³¨æ„åˆ°å®‰è£…æ–¹é¢ã€‚<br><br><br>å½“æˆ‘çš„çˆ¬è™«ç¨‹åºå·²ç»å¹³ç¨³çš„è¿è¡Œäº†ä¸¤å¤©äº†ï¼Œæˆ‘å°±å¼€å§‹æ”¾å¿ƒäº†ï¼Œé™é™åœ°çœ‹ç€spiderç–¯ç‹‚çš„spider,å¯æ˜¯å°±æ˜¯åœ¨éšåï¼ŒredisæœåŠ¡å‡ºç°å¼‚å¸¸ï¼Œé¦–å…ˆæ˜¯æˆ‘æœ¬åœ°å®¢æˆ·ç«¯è¿æ¥ä¸ä¸Šè¿œç¨‹redis-serverï¼Œæˆ‘æœ‰æƒ³è¿‡æ˜¯ä¸æ˜¯ç½‘ç»œä¸ç¨³å®šçš„é—®é¢˜ã€‚åœ¨æˆ‘é‡å¯redisåï¼Œæ¢å¤æ­£å¸¸ï¼Œåˆå¹³ç¨³çš„è¿è¡Œäº†ä¸€å¤©ã€‚<br><br><br>ä½†æ˜¯æ¥ä¸‹æ¥redisé¢‘ç¹å‡ºé—®é¢˜ï¼Œæˆ‘å°±æƒ³ï¼Œæ˜¯ä¸æ˜¯çˆ¬è™«çˆ¬å–äº†å¤§é‡çš„ç½‘é¡µé“¾æ¥ï¼Œå¯¹redisé€ æˆäº†é˜»å¡ã€‚äºæ˜¯ï¼Œæˆ‘å¼€å¯äº†å¯¹redis.confï¼Œè¿˜æœ‰ç¨‹åºç«¯çš„connectä¸¤æ–¹é¢360åº¦çš„ä¼˜åŒ–ï¼Œç„¶å¹¶åµã€‚ã€‚ã€‚<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i tcp:<span class="number">6379</span></span><br></pre></td></tr></table></figure><p><br>ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤åï¼Œå‘ç°redisæœåŠ¡æ­£å¸¸è¿è¡Œï¼Œ6379ç«¯å£ä¹Ÿæ˜¯å¼€å¯çš„ã€‚æˆ‘é™·å…¥äº†æ·±æ·±åœ°è¿·æƒ‘ã€‚ã€‚ã€‚ã€‚ã€‚<br><br><br>ä½†æ˜¯è¿™æ—¶å…¶å®å°±åº”è¯¥çœ‹å‡ºä¸€äº›ç«¯å€ªäº†ï¼Œå› ä¸ºæ­£å¸¸å ç”¨ 6379 ç«¯å£çš„è¿›ç¨‹åæ˜¯ ï¼š redis-ser ã€‚ä½†æ˜¯ç°åœ¨å ç”¨ 6379 ç«¯å£çš„è¿›ç¨‹åæ˜¯ ï¼šxmrig-no (å¿˜è®°æˆªå›¾äº†)ï¼Œä½†æ˜¯è¿™æ—¶æˆ‘ä¹Ÿæ²¡æœ‰å¤šæƒ³<br>ç›´åˆ°æˆ‘è¿è¡Œï¼š<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top</span><br></pre></td></tr></table></figure><p><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585404912911-97736d80-2ee3-455d-a948-6d134f4e2663.png#align=left&display=inline&height=534&name=2.png&originHeight=534&originWidth=3338&size=980508&status=done&style=none&width=3338" alt="2.png"><br>å‘ç°äº†å ç”¨ 6379 ç«¯å£çš„è¿›ç¨‹å…¨åç§°xmrigâ€¦ï¼Œæˆ‘æ‰æç„¶å¤§æ‚Ÿï¼Œæˆ‘çš„ç«¯å£è¢«å ç”¨äº†ã€‚æˆ‘åœ¨googleä¸Šä¸€æŸ¥ï¼Œæ‰å‘ç°ã€‚ã€‚æˆ‘è¢«é»‘äº†<br><a name="-5"></a></p><h1 id="åšäº†å“ªäº›æ€¥æ•‘å·¥ä½œ"><a href="#åšäº†å“ªäº›æ€¥æ•‘å·¥ä½œ" class="headerlink" title="åšäº†å“ªäº›æ€¥æ•‘å·¥ä½œ"></a>åšäº†å“ªäº›æ€¥æ•‘å·¥ä½œ</h1><p>è¿™æ—¶ï¼Œæ„Ÿè§‰è‡ªå·±å¼€å§‹æŠ•å…¥äº†ä¸€åœºå¯¹æŠ—æˆ˜<br><br><br>1.é¦–å…ˆæŸ¥æ‰¾æ¤å…¥ç¨‹åºçš„ä½ç½®ã€‚<br>åœ¨/tmp/ç›®å½•ä¸‹ï¼Œä¸€èˆ¬æ¤å…¥ç¨‹åºéƒ½ä¼šæ”¾åœ¨ /tmp ä¸´æ—¶ç›®å½•ä¸‹ï¼Œå…¶å®å›è¿‡å¤´ä¸€æƒ³ï¼Œæ”¾åœ¨è¿™é‡Œï¼Œä¹Ÿæ˜¯æŒºå¦™çš„ã€‚<br><br><br>2.åˆ é™¤æ¸…ç†å¯ç–‘æ–‡ä»¶<br><br><br>æ€æ­»è¿›ç¨‹<br><br><br>åˆ é™¤äº†æ­£åœ¨è¿è¡Œçš„ç¨‹åºæ–‡ä»¶è¿˜æœ‰å®‰è£…åŒ…<br>3.æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd |cut -f <span class="number">1</span> -d:crontab -uXXX -l</span><br></pre></td></tr></table></figure><p><br>4.å¼€å¯é˜²ç«å¢™<br><br><br>ä»…å¼€æ”¾ä¼šä½¿ç”¨åˆ°çš„ç«¯å£<br>5.ä¿®æ”¹redisé»˜è®¤ç«¯å£<br><br><br>redis.confä¸­çš„port<br>6.æ·»åŠ redisæˆæƒå¯†ç <br><br><br>redis.confä¸­çš„requirepass<br>7.ä¿®æ”¹ç»‘å®šè¿œç¨‹ç»‘å®šip<br><br><br>redis.confä¸­çš„bind<br>æœ€åé‡å¯redisæœåŠ¡ï¼<br><a name="-6"></a></p><h1 id="ä»ä¸­å­¦åˆ°äº†ä»€ä¹ˆ"><a href="#ä»ä¸­å­¦åˆ°äº†ä»€ä¹ˆ" class="headerlink" title="ä»ä¸­å­¦åˆ°äº†ä»€ä¹ˆ"></a>ä»ä¸­å­¦åˆ°äº†ä»€ä¹ˆ</h1><p>æ˜æ˜æ˜¯è‡ªå·±è¢«é»‘äº†ï¼Œä½†æ˜¯åœ¨è¡¥æ•‘çš„è¿‡ç¨‹ä¸­ï¼Œå´å¾—åˆ°äº†å†™ç¨‹åºç»™ä¸äº†çš„æ»¡è¶³æ„Ÿã€‚æ„Ÿè§‰å› ä¸ºè¿™ä»¶äº‹æƒ…ï¼Œä¸Šå¸ç»™æˆ‘æ‰“å¼€äº†å¦ä¸€æ‰‡çª—æˆ·ï½ï½ï½<br>æœ€åè¯´ä¸‹ï¼Œè¿™ä¸ªæœ¨é©¬æ˜¯æ€ä¹ˆè¿›æ¥çš„å‘¢ï¼ŒæŸ¥äº†ä¸€ä¸‹åŸæ¥æ˜¯åˆ©ç”¨Redisç«¯å£æ¼æ´è¿›æ¥çš„ï¼Œå®ƒå¯ä»¥å¯¹æœªæˆæƒè®¿é—®redisçš„æœåŠ¡å™¨ç™»å½•ï¼Œå®šæ—¶ä¸‹è½½å¹¶æ‰§è¡Œè„šæœ¬ï¼Œè„šæœ¬è¿è¡Œï¼ŒæŒ–çŸ¿ï¼Œè¿œç¨‹è°ƒç”¨ç­‰ã€‚æ‰€ä»¥é™¤äº†æ‰§è¡Œä¸Šè¿°æ“ä½œï¼ŒlinuxæœåŠ¡å™¨ä¸­çš„ç”¨æˆ·æƒé™ï¼ŒæœåŠ¡æƒé™ç²¾ç»†åŒ–ï¼Œé˜²æ­¢å†æ¬¡è¢«å…¥ä¾µã€‚<br></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;&lt;a name=&quot;-2&quot;&gt;&lt;/a&gt;&lt;/p&gt;&lt;h1 id=&quot;æœåŠ¡å™¨è‡ªè¿°&quot;&gt;&lt;a href=&quot;#æœåŠ¡å™¨è‡ªè¿°&quot; class=&quot;headerlink&quot; 
      
    
    </summary>
    
    
      <category term="Linux" scheme="cpeixin.cn/categories/Linux/"/>
    
    
      <category term="æœåŠ¡å™¨å®‰å…¨" scheme="cpeixin.cn/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>pythonçˆ¬è™« - åŠ¨æ€çˆ¬å–</title>
    <link href="cpeixin.cn/2019/06/12/python%E7%88%AC%E8%99%AB%E4%B9%8B%E5%8A%A8%E6%80%81%E7%88%AC%E5%8F%96/"/>
    <id>cpeixin.cn/2019/06/12/python%E7%88%AC%E8%99%AB%E4%B9%8B%E5%8A%A8%E6%80%81%E7%88%AC%E5%8F%96/</id>
    <published>2019-06-12T15:26:15.000Z</published>
    <updated>2020-04-04T17:11:17.062Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><p>æˆ‘ä»¬çš„ç›®çš„æ˜¯æŠ“å–æ‹‰å‹¾ç½‘Pythonåˆ†ç±»ä¸‹å…¨å›½åˆ°ç›®å‰ä¸ºæ­¢å±•ç¤ºå‡ºæ¥çš„æ‰€æœ‰æ‹›è˜ä¿¡æ¯ï¼Œé¦–å…ˆåœ¨æµè§ˆå™¨ç‚¹å‡»è¿›å»çœ‹çœ‹å§ã€‚å¦‚æœä½ è¶³å¤Ÿå°å¿ƒæˆ–è€…ç½‘é€Ÿæ¯”è¾ƒæ…¢ï¼Œé‚£ä¹ˆä½ ä¼šå‘ç°ï¼Œåœ¨ç‚¹å‡»Pythonåˆ†ç±»ä¹‹åè·³åˆ°çš„æ–°é¡µé¢ä¸Šï¼Œæ‹›è˜ä¿¡æ¯å‡ºç°æ—¶é—´æ˜¯æ™šäºé¡µé¢æ¡†æ¶å‡ºç°æ—¶é—´çš„ã€‚åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å‡ ä¹å¯ä»¥è‚¯å®šï¼Œæ‹›è˜ä¿¡æ¯å¹¶ä¸åœ¨é¡µé¢HTMLæºç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‰ä¸‹â€command+option+uâ€(åœ¨Windowså’ŒLinuxä¸Šçš„å¿«æ·é”®æ˜¯â€ctrl+uâ€)æ¥æŸ¥çœ‹ç½‘é¡µæºç ï¼Œæœç„¶åœ¨æºç ä¸­æ²¡æœ‰å‡ºç°é¡µé¢å±•ç¤ºçš„æ‹›è˜ä¿¡æ¯ã€‚<br><br><br>åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘çœ‹åˆ°çš„å¤§å¤šæ•°æ•™ç¨‹éƒ½ä¼šæ•™ï¼Œä½¿ç”¨ä»€ä¹ˆä»€ä¹ˆåº“ï¼Œå¦‚ä½•å¦‚ä½•æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒï¼Œé€šè¿‡æ€æ ·æ€æ ·çš„æ–¹å¼å®Œæˆç½‘é¡µçš„æ¸²æŸ“ï¼Œç„¶åå¾—åˆ°é‡Œé¢çš„ä¿¡æ¯â€¦æ°¸è¿œè®°ä½ï¼Œå¯¹äºçˆ¬è™«ç¨‹åºï¼Œæ¨¡æ‹Ÿæµè§ˆå™¨å¾€å¾€æ˜¯ä¸‹ä¸‹ç­–ï¼Œåªæœ‰å®åœ¨æ²¡æœ‰åŠæ³•äº†ï¼Œæ‰å»è€ƒè™‘æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒï¼Œå› ä¸ºé‚£æ ·çš„å†…å­˜å¼€é”€å®åœ¨æ˜¯å¾ˆå¤§ï¼Œè€Œä¸”æ•ˆç‡éå¸¸ä½ã€‚<br><br><br>é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿç»éªŒæ˜¯ï¼Œè¿™æ ·çš„æƒ…å†µï¼Œå¤§å¤šæ˜¯æ˜¯æµè§ˆå™¨ä¼šåœ¨è¯·æ±‚å’Œè§£æHTMLä¹‹åï¼Œæ ¹æ®jsçš„â€œæŒ‡ç¤ºâ€å†å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œå¾—åˆ°é¡µé¢å±•ç¤ºçš„å†…å®¹ï¼Œç„¶åé€šè¿‡jsæ¸²æŸ“ä¹‹åå±•ç¤ºåˆ°ç•Œé¢ã€‚å¥½æ¶ˆæ¯æ˜¯ï¼Œè¿™æ ·çš„è¯·æ±‚å¾€å¾€å¾—åˆ°çš„å†…å®¹æ˜¯jsonæ ¼å¼çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éä½†ä¸ä¼šåŠ é‡çˆ¬è™«çš„ä»»åŠ¡ï¼Œåè€Œå¯èƒ½ä¼šçœå»è§£æHTMLçš„åŠŸå¤«ã€‚<br><br><br>é‚£ä¸ªï¼Œç»§ç»­æ‰“å¼€Chromeçš„å¼€å‘è€…å·¥å…·ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»â€œä¸‹ä¸€é¡µâ€ä¹‹åï¼Œæµè§ˆå™¨å‘é€äº†å¦‚ä¸‹è¯·æ±‚ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585401843101-98e57df8-c124-4923-aa9f-7c42ce2288b6.png#align=left&display=inline&height=1300&originHeight=1300&originWidth=3356&size=0&status=done&style=none&width=3356" alt><br><br><br>æ³¨æ„è§‚å¯Ÿâ€positionAjax.jsonâ€è¿™ä¸ªè¯·æ±‚ï¼Œå®ƒçš„Typeæ˜¯â€xhrâ€ï¼Œå…¨ç§°å«åšâ€XMLHttpRequestâ€ï¼ŒXMLHttpRequestå¯¹è±¡å¯ä»¥åœ¨ä¸å‘æœåŠ¡å™¨æäº¤æ•´ä¸ªé¡µé¢çš„æƒ…å†µä¸‹ï¼Œå®ç°å±€éƒ¨æ›´æ–°ç½‘é¡µã€‚é‚£ä¹ˆï¼Œç°åœ¨å®ƒçš„å¯èƒ½æ€§æœ€å¤§äº†ï¼Œæˆ‘ä»¬å•å‡»å®ƒä¹‹åå¥½å¥½è§‚å¯Ÿè§‚å¯Ÿå§ï¼š<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585401843056-e12f0f79-905f-4420-abfd-fb85625767ac.png#align=left&display=inline&height=1150&originHeight=1150&originWidth=2266&size=0&status=done&style=none&width=2266" alt><br><br><br>ç‚¹å‡»ä¹‹åæˆ‘ä»¬åœ¨å³ä¸‹è§’å‘ç°äº†å¦‚ä¸Šè¯¦æƒ…ï¼Œå…¶ä¸­å‡ ä¸ªtabçš„å†…å®¹è¡¨ç¤ºï¼š<br>Headersï¼šè¯·æ±‚å’Œå“åº”çš„è¯¦ç»†ä¿¡æ¯<br>Previewï¼šå“åº”ä½“æ ¼å¼åŒ–ä¹‹åçš„æ˜¾ç¤º<br>Responseï¼šå“åº”ä½“åŸå§‹å†…å®¹<br>Cookiesï¼šCookies<br>Timingï¼šæ—¶é—´å¼€é”€<br><br><br>é€šè¿‡å¯¹å†…å®¹çš„è§‚å¯Ÿï¼Œè¿”å›çš„ç¡®å®æ˜¯ä¸€ä¸ªjsonå­—ç¬¦ä¸²ï¼Œå†…å®¹åŒ…æ‹¬æœ¬é¡µæ¯ä¸€ä¸ªæ‹›è˜ä¿¡æ¯ï¼Œåˆ°è¿™é‡Œè‡³å°‘æˆ‘ä»¬å·²ç»æ¸…æ¥šäº†ï¼Œç¡®å®ä¸éœ€è¦è§£æHTMLå°±å¯ä»¥æ‹¿åˆ°æ‹‰é’©æ‹›è˜çš„ä¿¡æ¯äº†ã€‚é‚£ä¹ˆï¼Œè¯·æ±‚è¯¥å¦‚ä½•æ¨¡æ‹Ÿå‘¢ï¼Ÿæˆ‘ä»¬åˆ‡æ¢åˆ°Headersè¿™ä¸€æ ï¼Œç•™æ„ä¸‰ä¸ªåœ°æ–¹ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585401842263-072689cf-5dea-4f8b-b103-0758d9c5e52e.png#align=left&display=inline&height=262&originHeight=262&originWidth=1276&size=0&status=done&style=none&width=1276" alt><br><br><br>ä¸Šé¢çš„æˆªå›¾å±•ç¤ºäº†è¿™æ¬¡è¯·æ±‚çš„è¯·æ±‚æ–¹å¼ã€è¯·æ±‚åœ°å€ç­‰ä¿¡æ¯ã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585401843887-cf8bff5f-4570-4ad4-8681-f0f3eae929b3.png#align=left&display=inline&height=884&originHeight=884&originWidth=2652&size=0&status=done&style=none&width=2652" alt><br><br><br>ä¸Šé¢çš„æˆªå›¾å±•ç¤ºäº†è¿™æ¬¡è¯·æ±‚çš„è¯·æ±‚å¤´ï¼Œä¸€èˆ¬æ¥è®²ï¼Œå…¶ä¸­æˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ˜¯Cookie / Host / Origin / Referer / User-Agent / X-Requested-Withç­‰å‚æ•°ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585401843009-4797a28d-3070-421e-a45c-86781d7f580d.png#align=left&display=inline&height=188&originHeight=188&originWidth=848&size=0&status=done&style=none&width=848" alt><br><br><br>ä¸Šé¢è¿™å¼ æˆªå›¾å±•ç¤ºäº†è¿™æ¬¡è¯·æ±‚çš„æäº¤æ•°æ®ï¼Œæ ¹æ®è§‚å¯Ÿï¼Œkdè¡¨ç¤ºæˆ‘ä»¬æŸ¥è¯¢çš„å…³é”®å­—ï¼Œpnè¡¨ç¤ºå½“å‰é¡µç ã€‚<br><br><br>é‚£ä¹ˆï¼Œæˆ‘ä»¬çš„çˆ¬è™«éœ€è¦åšçš„äº‹æƒ…ï¼Œå°±æ˜¯æŒ‰ç…§é¡µç ä¸æ–­å‘è¿™ä¸ªæ¥å£å‘é€è¯·æ±‚ï¼Œå¹¶è§£æå…¶ä¸­çš„jsonå†…å®¹ï¼Œå°†æˆ‘ä»¬éœ€è¦çš„å€¼å­˜å‚¨ä¸‹æ¥å°±å¥½äº†ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼šä»€ä¹ˆæ—¶å€™ç»“æŸï¼Œä»¥åŠå¦‚ä½•çš„åˆ°jsonä¸­æœ‰ä»·å€¼çš„å†…å®¹ã€‚<br><br><br>æˆ‘ä»¬å›è¿‡å¤´é‡æ–°è§‚å¯Ÿä¸€ä¸‹è¿”å›çš„jsonï¼Œæ ¼å¼åŒ–ä¹‹åçš„å±‚çº§å…³ç³»å¦‚ä¸‹ï¼š<br><br><br>å¾ˆå®¹æ˜“å‘ç°ï¼Œcontentä¸‹çš„hasNextPageå³ä¸ºæ˜¯å¦å­˜åœ¨ä¸‹ä¸€é¡µï¼Œè€Œcontentä¸‹çš„resultæ˜¯ä¸€ä¸ªlistï¼Œå…¶ä¸­çš„æ¯é¡¹åˆ™æ˜¯ä¸€æ¡æ‹›è˜ä¿¡æ¯ã€‚åœ¨Pythonä¸­ï¼Œjsonå­—ç¬¦ä¸²åˆ°å¯¹è±¡çš„æ˜ å°„å¯ä»¥é€šè¿‡jsonè¿™ä¸ªåº“å®Œæˆï¼š<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">json_obj = json.loads(<span class="string">"&#123;'key': 'value'&#125;"</span>)  <span class="comment"># å­—ç¬¦ä¸²åˆ°å¯¹è±¡</span></span><br><span class="line">json_str = json.dumps(json_obj)            <span class="comment"># å¯¹è±¡åˆ°å­—ç¬¦ä¸²</span></span><br></pre></td></tr></table></figure><p><br>jsonå­—ç¬¦ä¸²çš„â€[ ]â€œæ˜ å°„åˆ°Pythonçš„ç±»å‹æ˜¯listï¼Œâ€{ }â€æ˜ å°„åˆ°Pythonåˆ™æ˜¯dictã€‚åˆ°è¿™é‡Œï¼Œåˆ†æè¿‡ç¨‹å·²ç»å®Œå…¨ç»“æŸï¼Œå¯ä»¥æ„‰å¿«çš„å†™ä»£ç å•¦ã€‚å…·ä½“ä»£ç è¿™é‡Œä¸å†ç»™å‡ºï¼Œå¸Œæœ›ä½ å¯ä»¥è‡ªå·±ç‹¬ç«‹å®Œæˆï¼Œå¦‚æœåœ¨ç¼–å†™è¿‡ç¨‹ä¸­å­˜åœ¨é—®é¢˜ï¼Œå¯ä»¥è”ç³»æˆ‘è·å–å¸®åŠ©ã€‚<br></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;æˆ‘ä»¬çš„ç›®çš„æ˜¯æŠ“å–æ‹‰å‹¾ç½‘Pythonåˆ†ç±»ä¸‹å…¨å›½åˆ°ç›®å‰ä¸ºæ­¢å±•ç¤ºå‡ºæ¥çš„æ‰€æœ‰æ‹›è˜ä¿¡æ¯ï¼Œé¦–å…ˆåœ¨æµè§ˆå™¨ç‚¹å‡»è¿›å»çœ‹çœ‹å§ã€‚å¦‚æœä½ è¶³å¤Ÿå°å¿ƒæˆ–è€…ç½‘é€Ÿæ¯”è¾ƒæ…¢ï¼Œé‚£ä¹ˆä½ ä¼š
      
    
    </summary>
    
    
      <category term="python" scheme="cpeixin.cn/categories/python/"/>
    
    
      <category term="çˆ¬è™«" scheme="cpeixin.cn/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>SHCï¼šä½¿ç”¨ Spark SQL é«˜æ•ˆåœ°è¯»å†™ HBase</title>
    <link href="cpeixin.cn/2019/05/16/SHC%EF%BC%9A%E4%BD%BF%E7%94%A8-Spark-SQL-%E9%AB%98%E6%95%88%E5%9C%B0%E8%AF%BB%E5%86%99-HBase/"/>
    <id>cpeixin.cn/2019/05/16/SHC%EF%BC%9A%E4%BD%BF%E7%94%A8-Spark-SQL-%E9%AB%98%E6%95%88%E5%9C%B0%E8%AF%BB%E5%86%99-HBase/</id>
    <published>2019-05-16T02:27:59.000Z</published>
    <updated>2020-05-16T02:31:46.066Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:12 GMT+0800 (GMT+08:00) --><p><br>Apache <a href="https://www.iteblog.com/archives/tag/spark/" target="_blank" rel="external nofollow noopener noreferrer">Spark</a> å’Œ Apache <a href="https://www.iteblog.com/archives/tag/hbase/" target="_blank" rel="external nofollow noopener noreferrer">HBase</a> æ˜¯ä¸¤ä¸ªä½¿ç”¨æ¯”è¾ƒå¹¿æ³›çš„å¤§æ•°æ®ç»„ä»¶ã€‚å¾ˆå¤šåœºæ™¯éœ€è¦ä½¿ç”¨ <a href="https://www.iteblog.com/archives/tag/spark/" target="_blank" rel="external nofollow noopener noreferrer">Spark</a> åˆ†æ/æŸ¥è¯¢ <a href="https://www.iteblog.com/archives/tag/hbase/" target="_blank" rel="external nofollow noopener noreferrer">HBase</a> ä¸­çš„æ•°æ®ï¼Œè€Œç›®å‰ <a href="https://www.iteblog.com/archives/tag/spark/" target="_blank" rel="external nofollow noopener noreferrer">Spark</a> å†…ç½®æ˜¯æ”¯æŒå¾ˆå¤šæ•°æ®æºçš„ï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº† HBaseï¼Œä½†æ˜¯å†…ç½®çš„è¯»å–æ•°æ®æºè¿˜æ˜¯ä½¿ç”¨äº† TableInputFormat æ¥è¯»å– HBase ä¸­çš„æ•°æ®ã€‚è¿™ä¸ª TableInputFormat æœ‰ä¸€äº›ç¼ºç‚¹ï¼š</p><ul><li>ä¸€ä¸ª Task é‡Œé¢åªèƒ½å¯åŠ¨ä¸€ä¸ª Scan å» HBase ä¸­è¯»å–æ•°æ®ï¼›</li><li>TableInputFormat ä¸­ä¸æ”¯æŒ BulkGetï¼›</li><li>ä¸èƒ½äº«å—åˆ° Spark SQL å†…ç½®çš„ catalyst å¼•æ“çš„ä¼˜åŒ–ã€‚</li></ul><p><br>ä»å¦ä¸€ä¸ªæ–¹é¢æ¥è®²ï¼Œå¦‚æœå…ˆä¸è°ˆå…³äºæ€§èƒ½çš„æ–¹é¢ï¼Œé‚£ä¹ˆä½ åœ¨å†™HBaseçš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯ä¸æ˜¯æ­¥éª¤æ„Ÿè§‰å¾ˆéº»çƒ¦å‘¢ï¼ŒForeachæ¯æ¡æ•°æ®Putåˆ°HBaseä¸­ï¼Œå¾€å¾€å†™å…¥é€»è¾‘éƒ¨åˆ†çš„ä»£ç å°±è¦å†™å¾ˆé•¿å¾ˆé•¿çš„ä¸€æ®µã€‚<br><br><br>åŸºäºè¿™äº›é—®é¢˜ï¼Œæ¥è‡ª Hortonworks çš„å·¥ç¨‹å¸ˆä»¬ä¸ºæˆ‘ä»¬å¸¦æ¥äº†å…¨æ–°çš„ Apache Sparkâ€”Apache HBase Connectorï¼Œä¸‹é¢ç®€ç§° SHCã€‚é€šè¿‡è¿™ä¸ªç±»åº“ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ Spark SQL å°† DataFrame ä¸­çš„æ•°æ®å†™å…¥åˆ° HBase ä¸­ï¼›è€Œä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ Spark SQL å»æŸ¥è¯¢ HBase ä¸­çš„æ•°æ®ï¼Œåœ¨æŸ¥è¯¢ HBase çš„æ—¶å€™å……åˆ†åˆ©ç”¨äº† catalyst å¼•æ“åšäº†è®¸å¤šä¼˜åŒ–ï¼Œæ¯”å¦‚åˆ†åŒºä¿®å‰ªï¼ˆpartition pruningï¼‰ï¼Œåˆ—ä¿®å‰ªï¼ˆcolumn pruningï¼‰ï¼Œè°“è¯ä¸‹æ¨ï¼ˆpredicate pushdownï¼‰å’Œæ•°æ®æœ¬åœ°æ€§ï¼ˆdata localityï¼‰ç­‰ç­‰ã€‚å› ä¸ºæœ‰äº†è¿™äº›ä¼˜åŒ–ï¼Œé€šè¿‡ Spark æŸ¥è¯¢ HBase çš„é€Ÿåº¦æœ‰äº†å¾ˆå¤§çš„æå‡ã€‚<br><br><br><a href="https://github.com/hortonworks-spark/shc" target="_blank" rel="external nofollow noopener noreferrer">é¡¹ç›®åœ°å€</a><br>å…·ä½“çš„å¼•å…¥æ–¹å¼ï¼Œåœ¨ä¹‹å‰çš„Spark SQLå…¥é—¨ä¸­æœ‰å†™åˆ°<br><a name="EjSTz"></a></p><h2 id="Catalog"><a href="#Catalog" class="headerlink" title="Catalog"></a>Catalog</h2><p>å¯¹äºæ¯ä¸ªè¡¨ï¼Œå¿…é¡»æä¾›ä¸€ä¸ªç›®å½•ï¼Œå…¶ä¸­åŒ…æ‹¬è¡Œé”®å’Œå…·æœ‰é¢„å®šä¹‰åˆ—æ—çš„æ•°æ®ç±»å‹çš„åˆ—ï¼Œå¹¶å®šä¹‰hbaseåˆ—ä¸è¡¨æ¨¡å¼ä¹‹é—´çš„æ˜ å°„ã€‚ç›®å½•æ˜¯ç”¨æˆ·å®šä¹‰çš„jsonæ ¼å¼ã€‚<br></p><p><a name="eXdJt"></a></p><h2 id="æ•°æ®ç±»å‹è½¬æ¢"><a href="#æ•°æ®ç±»å‹è½¬æ¢" class="headerlink" title="æ•°æ®ç±»å‹è½¬æ¢"></a>æ•°æ®ç±»å‹è½¬æ¢</h2><p>æ”¯æŒJavaåŸºæœ¬ç±»å‹ã€‚å°†æ¥ï¼Œå°†æ”¯æŒå…¶ä»–æ•°æ®ç±»å‹ï¼Œè¿™äº›æ•°æ®ç±»å‹ä¾èµ–äºç”¨æˆ·æŒ‡å®šçš„Serdesã€‚SHCæ”¯æŒä¸‰ç§å†…éƒ¨Serdesï¼šAvroï¼ŒPhoenixå’ŒPrimitiveTypeã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡åœ¨ç›®å½•ä¸­å®šä¹‰â€œ tableCoderâ€æ¥æŒ‡å®šè¦ä½¿ç”¨çš„serdeã€‚ä¸ºæ­¤ï¼Œè¯·å‚è€ƒç¤ºä¾‹å’Œå•å…ƒæµ‹è¯•ã€‚ä»¥Avroä¸ºä¾‹ã€‚ç”¨æˆ·å®šä¹‰çš„Serdeså°†è´Ÿè´£å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºAvroå¯¹è±¡ï¼Œè€Œè¿æ¥å™¨å°†è´Ÿè´£å°†Avroå¯¹è±¡è½¬æ¢ä¸ºå‚¬åŒ–å‰‚æ”¯æŒçš„æ•°æ®ç±»å‹ã€‚ç”¨æˆ·å®šä¹‰æ–°Serdeæ—¶ï¼Œéœ€è¦ä½¿å…¶â€œå®ç°â€ç‰¹å¾â€™SHCDataTypeâ€™ã€‚<br><br><br>è¯·æ³¨æ„ï¼Œå¦‚æœç”¨æˆ·å¸Œæœ›DataFrameä»…å¤„ç†å­—èŠ‚æ•°ç»„ï¼Œåˆ™å¯ä»¥æŒ‡å®šäºŒè¿›åˆ¶ç±»å‹ã€‚ç„¶åï¼Œç”¨æˆ·å¯ä»¥è·å¾—æ¯ä¸ªåˆ—ä¸ºå­—èŠ‚æ•°ç»„çš„å‚¬åŒ–å‰‚è¡Œã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨å®šåˆ¶çš„è§£ä¸²å™¨è¿›ä¸€æ­¥å¯¹å®ƒè¿›è¡Œååºåˆ—åŒ–ï¼Œæˆ–è€…ç›´æ¥åœ¨DataFrameçš„RDDä¸Šè¿›è¡Œæ“ä½œã€‚<br></p><p><a name="j3Svo"></a></p><h2 id="æ•°æ®å±€éƒ¨æ€§"><a href="#æ•°æ®å±€éƒ¨æ€§" class="headerlink" title="æ•°æ®å±€éƒ¨æ€§"></a>æ•°æ®å±€éƒ¨æ€§</h2><p>å½“Spark WorkerèŠ‚ç‚¹ä¸hbaseåŒºåŸŸæœåŠ¡å™¨ä½äºåŒä¸€ä½ç½®æ—¶ï¼Œé€šè¿‡æ ‡è¯†åŒºåŸŸæœåŠ¡å™¨ä½ç½®å¹¶å°†æ‰§è¡Œç¨‹åºä¸åŒºåŸŸæœåŠ¡å™¨ä¸€èµ·å®šä½æ¥å®ç°æ•°æ®å±€éƒ¨æ€§ã€‚æ¯ä¸ªæ‰§è¡Œç¨‹åºå°†ä»…å¯¹ä½äºåŒä¸€ä¸»æœºä¸Šçš„åŒä¸€éƒ¨åˆ†æ•°æ®æ‰§è¡ŒScan / BulkGetã€‚<br></p><p><a name="TccVy"></a></p><h2 id="è°“è¯ä¸‹æ¨"><a href="#è°“è¯ä¸‹æ¨" class="headerlink" title="è°“è¯ä¸‹æ¨"></a>è°“è¯ä¸‹æ¨</h2><p>è¯¥åº“ä½¿ç”¨HBaseæä¾›çš„ç°æœ‰æ ‡å‡†HBaseè¿‡æ»¤å™¨ï¼Œå¹¶ä¸”ä¸èƒ½åœ¨åå¤„ç†å™¨ä¸Šè¿è¡Œã€‚<br></p><p><a name="eEPLD"></a></p><h2 id="åˆ†åŒºä¿®å‰ª"><a href="#åˆ†åŒºä¿®å‰ª" class="headerlink" title="åˆ†åŒºä¿®å‰ª"></a>åˆ†åŒºä¿®å‰ª</h2><p>é€šè¿‡ä»è°“è¯ä¸­æå–è¡Œé”®ï¼Œæˆ‘ä»¬å°†scan / BulkGetåˆ’åˆ†ä¸ºå¤šä¸ªéé‡å åŒºåŸŸï¼Œåªæœ‰å…·æœ‰è¯·æ±‚æ•°æ®çš„åŒºåŸŸæœåŠ¡å™¨æ‰ä¼šæ‰§è¡Œscan / BulkGetã€‚å½“å‰ï¼Œåˆ†åŒºä¿®å‰ªæ˜¯åœ¨è¡Œé”®çš„ç¬¬ä¸€ç»´ä¸Šæ‰§è¡Œçš„ã€‚è¯·æ³¨æ„ï¼Œéœ€è¦ä»”ç»†å®šä¹‰WHEREæ¡ä»¶ã€‚å¦åˆ™ï¼Œç»“æœæ‰«æå¯èƒ½ä¼šåŒ…å«ä¸€ä¸ªæ¯”ç”¨æˆ·é¢„æœŸå¤§çš„åŒºåŸŸã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ¡ä»¶å°†å¯¼è‡´å®Œå…¨æ‰«æï¼ˆrowkey1æ˜¯è¡Œé”®çš„ç¬¬ä¸€ç»´ï¼Œè€Œcolumnæ˜¯å¸¸è§„çš„hbaseåˆ—ï¼‰ã€‚å…¶ä¸­rowkey1&gt;â€œ abcâ€ ORåˆ—=â€œ xyzâ€<br></p><p><a name="lDJh4"></a></p><h2 id="æ‰«æå’Œæ‰¹é‡è·å–"><a href="#æ‰«æå’Œæ‰¹é‡è·å–" class="headerlink" title="æ‰«æå’Œæ‰¹é‡è·å–"></a>æ‰«æå’Œæ‰¹é‡è·å–</h2><p>éƒ½é€šè¿‡æŒ‡å®šWHEREå­å¥å‘ç”¨æˆ·å…¬å¼€ï¼Œä¾‹å¦‚ï¼Œå…¶ä¸­column&gt; xå’Œcolumn &lt;yç”¨äºæ‰«æï¼Œè€Œcolumn = xç”¨äºgetã€‚æ‰€æœ‰æ“ä½œéƒ½åœ¨æ‰§è¡Œç¨‹åºä¸­æ‰§è¡Œï¼Œè€Œé©±åŠ¨ç¨‹åºä»…æ„é€ è¿™äº›æ“ä½œã€‚åœ¨å†…éƒ¨ï¼Œæˆ‘ä»¬å°†å®ƒä»¬è½¬æ¢ä¸ºæ‰«ææˆ–è·å–æˆ–ä¸¤è€…ç»“åˆï¼Œä»è€Œå°†Iterator [Row]è¿”å›è‡³å‚¬åŒ–å‰‚å¼•æ“ã€‚<br></p><p><a name="P0Sof"></a></p><h2 id="å¯åˆ›å»ºçš„æ•°æ®æº"><a href="#å¯åˆ›å»ºçš„æ•°æ®æº" class="headerlink" title="å¯åˆ›å»ºçš„æ•°æ®æº"></a>å¯åˆ›å»ºçš„æ•°æ®æº</h2><p>è¯¥åº“æ”¯æŒä»HBaseè¯»å–/å‘HBaseå†™å…¥ã€‚<br><a name="qW63X"></a></p><h2 id="åº”ç”¨ç”¨é€”"><a href="#åº”ç”¨ç”¨é€”" class="headerlink" title="åº”ç”¨ç”¨é€”"></a>åº”ç”¨ç”¨é€”</h2><p>ä¸‹é¢è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨è¿æ¥å™¨çš„åŸºæœ¬æ­¥éª¤ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯å’Œé«˜çº§ç”¨ä¾‹ï¼ˆä¾‹å¦‚Avroå’Œå¤åˆé”®æ”¯æŒï¼‰ï¼Œè¯·å‚è€ƒå­˜å‚¨åº“ä¸­çš„ç¤ºä¾‹ã€‚<br><a name="DjKzs"></a></p><h3 id="å®šä¹‰äº†HBaseç›®å½•"><a href="#å®šä¹‰äº†HBaseç›®å½•" class="headerlink" title="å®šä¹‰äº†HBaseç›®å½•"></a>å®šä¹‰äº†HBaseç›®å½•</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">catalog</span> </span>= <span class="string">s""</span><span class="string">"&#123;</span></span><br><span class="line"><span class="string">        |"</span><span class="string">table":&#123;"</span><span class="string">namespace":"</span><span class="string">default", "</span><span class="string">name":"</span>table1<span class="string">"&#125;,</span></span><br><span class="line"><span class="string">        |"</span><span class="string">rowkey":"</span><span class="string">key",</span></span><br><span class="line"><span class="string">        |"</span><span class="string">columns":&#123;</span></span><br><span class="line"><span class="string">          |"</span>col0<span class="string">":&#123;"</span><span class="string">cf":"</span><span class="string">rowkey", "</span><span class="string">col":"</span><span class="string">key", "</span><span class="string">type":"</span><span class="string">string"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col1<span class="string">":&#123;"</span><span class="string">cf":"</span>cf1<span class="string">", "</span><span class="string">col":"</span>col1<span class="string">", "</span><span class="string">type":"</span><span class="string">boolean"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col2<span class="string">":&#123;"</span><span class="string">cf":"</span>cf2<span class="string">", "</span><span class="string">col":"</span>col2<span class="string">", "</span><span class="string">type":"</span><span class="string">double"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col3<span class="string">":&#123;"</span><span class="string">cf":"</span>cf3<span class="string">", "</span><span class="string">col":"</span>col3<span class="string">", "</span><span class="string">type":"</span><span class="string">float"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col4<span class="string">":&#123;"</span><span class="string">cf":"</span>cf4<span class="string">", "</span><span class="string">col":"</span>col4<span class="string">", "</span><span class="string">type":"</span><span class="string">int"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col5<span class="string">":&#123;"</span><span class="string">cf":"</span>cf5<span class="string">", "</span><span class="string">col":"</span>col5<span class="string">", "</span><span class="string">type":"</span><span class="string">bigint"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col6<span class="string">":&#123;"</span><span class="string">cf":"</span>cf6<span class="string">", "</span><span class="string">col":"</span>col6<span class="string">", "</span><span class="string">type":"</span><span class="string">smallint"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col7<span class="string">":&#123;"</span><span class="string">cf":"</span>cf7<span class="string">", "</span><span class="string">col":"</span>col7<span class="string">", "</span><span class="string">type":"</span><span class="string">string"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col8<span class="string">":&#123;"</span><span class="string">cf":"</span>cf8<span class="string">", "</span><span class="string">col":"</span>col8<span class="string">", "</span><span class="string">type":"</span><span class="string">tinyint"&#125;</span></span><br><span class="line"><span class="string">        |&#125;</span></span><br><span class="line"><span class="string">      |&#125;"</span><span class="string">""</span>.stripMargin</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªåç§°ä¸ºtable1ï¼Œè¡Œé”®ä¸ºé”®ï¼Œåˆ—æ•°ä¸ºï¼ˆcol1-col8ï¼‰çš„HBaseè¡¨çš„æ¶æ„ã€‚è¯·æ³¨æ„ï¼Œè¡Œé”®è¿˜å¿…é¡»è¯¦ç»†å®šä¹‰ä¸ºå…·æœ‰ç‰¹å®šcfï¼ˆè¡Œé”®ï¼‰çš„åˆ—ï¼ˆcol0ï¼‰ã€‚<br></p><p><a name="xic7k"></a></p><h3 id="å†™å…¥HBaseè¡¨ä»¥å¡«å……æ•°æ®"><a href="#å†™å…¥HBaseè¡¨ä»¥å¡«å……æ•°æ®" class="headerlink" title="å†™å…¥HBaseè¡¨ä»¥å¡«å……æ•°æ®"></a>å†™å…¥HBaseè¡¨ä»¥å¡«å……æ•°æ®</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sc.parallelize(data).toDF.write.options(</span><br><span class="line">  <span class="type">Map</span>(<span class="type">HBaseTableCatalog</span>.tableCatalog -&gt; catalog, <span class="type">HBaseTableCatalog</span>.newTable -&gt; <span class="string">"5"</span>))</span><br><span class="line">  .format(<span class="string">"org.apache.spark.sql.execution.datasources.hbase"</span>)</span><br><span class="line">  .save()</span><br></pre></td></tr></table></figure><p>ç»™å®šå…·æœ‰æŒ‡å®šæ¶æ„çš„DataFrameï¼Œä¸Šé¢å°†åˆ›å»ºä¸€ä¸ªå…·æœ‰5ä¸ªåŒºåŸŸçš„HBaseè¡¨å¹¶å°†è¯¥DataFrameä¿å­˜åœ¨å…¶ä¸­ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæœªæŒ‡å®šHBaseTableCatalog.newTableï¼Œåˆ™å¿…é¡»é¢„å…ˆåˆ›å»ºè¡¨ã€‚<br></p><p><a name="wSV5W"></a></p><h3 id="åœ¨HBaseè¡¨çš„é¡¶éƒ¨æ‰§è¡ŒDataFrameæ“ä½œ"><a href="#åœ¨HBaseè¡¨çš„é¡¶éƒ¨æ‰§è¡ŒDataFrameæ“ä½œ" class="headerlink" title="åœ¨HBaseè¡¨çš„é¡¶éƒ¨æ‰§è¡ŒDataFrameæ“ä½œ"></a>åœ¨HBaseè¡¨çš„é¡¶éƒ¨æ‰§è¡ŒDataFrameæ“ä½œ</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">withCatalog</span></span>(cat: <span class="type">String</span>): <span class="type">DataFrame</span> = &#123;</span><br><span class="line">  sqlContext</span><br><span class="line">  .read</span><br><span class="line">  .options(<span class="type">Map</span>(<span class="type">HBaseTableCatalog</span>.tableCatalog-&gt;cat))</span><br><span class="line">  .format(<span class="string">"org.apache.spark.sql.execution.datasources.hbase"</span>)</span><br><span class="line">  .load()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="yQeDt"></a></p><h3 id="å¤æ‚æŸ¥è¯¢"><a href="#å¤æ‚æŸ¥è¯¢" class="headerlink" title="å¤æ‚æŸ¥è¯¢"></a>å¤æ‚æŸ¥è¯¢</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> df = withCatalog(catalog)</span><br><span class="line"><span class="keyword">val</span> s = df.filter((($<span class="string">"col0"</span> &lt;= <span class="string">"row050"</span> &amp;&amp; $<span class="string">"col0"</span> &gt; <span class="string">"row040"</span>) ||</span><br><span class="line">  $<span class="string">"col0"</span> === <span class="string">"row005"</span> ||</span><br><span class="line">  $<span class="string">"col0"</span> === <span class="string">"row020"</span> ||</span><br><span class="line">  $<span class="string">"col0"</span> ===  <span class="string">"r20"</span> ||</span><br><span class="line">  $<span class="string">"col0"</span> &lt;= <span class="string">"row005"</span>) &amp;&amp;</span><br><span class="line">  ($<span class="string">"col4"</span> === <span class="number">1</span> ||</span><br><span class="line">  $<span class="string">"col4"</span> === <span class="number">42</span>))</span><br><span class="line">  .select(<span class="string">"col0"</span>, <span class="string">"col1"</span>, <span class="string">"col4"</span>)</span><br><span class="line">s.show</span><br></pre></td></tr></table></figure><p><a name="mKwKp"></a></p><h3><a href="#" class="headerlink"></a></h3><p><a name="szhEb"></a></p><h3 id="SQLæ”¯æŒ"><a href="#SQLæ”¯æŒ" class="headerlink" title="SQLæ”¯æŒ"></a>SQLæ”¯æŒ</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Load the dataframe</span></span><br><span class="line"><span class="keyword">val</span> df = withCatalog(catalog)</span><br><span class="line"><span class="comment">//SQL example</span></span><br><span class="line">df.createOrReplaceTempView(<span class="string">"table"</span>)</span><br><span class="line">sqlContext.sql(<span class="string">"select count(col1) from table"</span>).show</span><br></pre></td></tr></table></figure><br><a name="raaVM"></a> ## æ”¯æŒAvroæ¨¡å¼ è¯¥è¿æ¥å™¨å®Œå…¨æ”¯æŒæ‰€æœ‰avroæ¨¡å¼ã€‚ç”¨æˆ·å¯ä»¥åœ¨å…¶ç›®å½•ä¸­ä½¿ç”¨å®Œæ•´è®°å½•æ¨¡å¼æˆ–éƒ¨åˆ†å­—æ®µæ¨¡å¼ä½œä¸ºæ•°æ®ç±»å‹ï¼ˆæœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[æ­¤å¤„](https://github.com/hortonworks-spark/shc/wiki/2.-Native-Avro-Support)ï¼‰ã€‚<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> schema_array = <span class="string">s""</span><span class="string">"&#123;"</span><span class="string">type": "</span><span class="string">array", "</span><span class="string">items": ["</span><span class="string">string","</span><span class="string">null"]&#125;"</span><span class="string">""</span>.stripMargin</span><br><span class="line"><span class="keyword">val</span> schema_record =</span><br><span class="line">  <span class="string">s""</span><span class="string">"&#123;"</span><span class="string">namespace": "</span>example.<span class="string">avro",</span></span><br><span class="line"><span class="string">     |   "</span><span class="string">type": "</span><span class="string">record",      "</span><span class="string">name": "</span><span class="type">User</span><span class="string">",</span></span><br><span class="line"><span class="string">     |    "</span><span class="string">fields": [      &#123;"</span><span class="string">name": "</span><span class="string">name", "</span><span class="string">type": "</span><span class="string">string"&#125;,</span></span><br><span class="line"><span class="string">     |      &#123;"</span><span class="string">name": "</span>favorite_<span class="string">number",  "</span><span class="string">type": ["</span><span class="string">int", "</span><span class="string">null"]&#125;,</span></span><br><span class="line"><span class="string">     |        &#123;"</span><span class="string">name": "</span>favorite_<span class="string">color", "</span><span class="string">type": ["</span><span class="string">string", "</span><span class="string">null"]&#125;      ]    &#125;"</span><span class="string">""</span>.stripMargin</span><br><span class="line"><span class="keyword">val</span> catalog = <span class="string">s""</span><span class="string">"&#123;</span></span><br><span class="line"><span class="string">        |"</span><span class="string">table":&#123;"</span><span class="string">namespace":"</span><span class="string">default", "</span><span class="string">name":"</span><span class="string">htable"&#125;,</span></span><br><span class="line"><span class="string">        |"</span><span class="string">rowkey":"</span>key1<span class="string">",</span></span><br><span class="line"><span class="string">        |"</span><span class="string">columns":&#123;</span></span><br><span class="line"><span class="string">          |"</span>col1<span class="string">":&#123;"</span><span class="string">cf":"</span><span class="string">rowkey", "</span><span class="string">col":"</span>key1<span class="string">", "</span><span class="string">type":"</span><span class="string">double"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col2<span class="string">":&#123;"</span><span class="string">cf":"</span>cf1<span class="string">", "</span><span class="string">col":"</span>col1<span class="string">", "</span><span class="string">avro":"</span>schema_<span class="string">array"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col3<span class="string">":&#123;"</span><span class="string">cf":"</span>cf1<span class="string">", "</span><span class="string">col":"</span>col2<span class="string">", "</span><span class="string">avro":"</span>schema_<span class="string">record"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col4<span class="string">":&#123;"</span><span class="string">cf":"</span>cf1<span class="string">", "</span><span class="string">col":"</span>col3<span class="string">", "</span><span class="string">type":"</span><span class="string">double"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col5<span class="string">":&#123;"</span><span class="string">cf":"</span>cf1<span class="string">", "</span><span class="string">col":"</span>col4<span class="string">", "</span><span class="string">type":"</span><span class="string">string"&#125;</span></span><br><span class="line"><span class="string">        |&#125;</span></span><br><span class="line"><span class="string">      |&#125;"</span><span class="string">""</span>.stripMargin</span><br><span class="line"> <span class="keyword">val</span> df = sqlContext.read.options(<span class="type">Map</span>(<span class="string">"schema_array"</span>-&gt;schema_array,<span class="string">"schema_record"</span>-&gt;schema_record, <span class="type">HBaseTableCatalog</span>.tableCatalog-&gt;catalog)).format(<span class="string">"org.apache.spark.sql.execution.datasources.hbase"</span>).load()</span><br><span class="line">df.write.options(<span class="type">Map</span>(<span class="string">"schema_array"</span>-&gt;schema_array,<span class="string">"schema_record"</span>-&gt;schema_record, <span class="type">HBaseTableCatalog</span>.tableCatalog-&gt;catalog)).format(<span class="string">"org.apache.spark.sql.execution.datasources.hbase"</span>).save()</span><br></pre></td></tr></table></figure><a name="LqW7H"></a> ####<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> complex = <span class="string">s""</span><span class="string">"MAP&lt;int, struct&lt;varchar:string&gt;&gt;"</span><span class="string">""</span></span><br><span class="line"><span class="keyword">val</span> schema =</span><br><span class="line">  <span class="string">s""</span><span class="string">"&#123;"</span><span class="string">namespace": "</span>example.<span class="string">avro",</span></span><br><span class="line"><span class="string">     |   "</span><span class="string">type": "</span><span class="string">record",      "</span><span class="string">name": "</span><span class="type">User</span><span class="string">",</span></span><br><span class="line"><span class="string">     |    "</span><span class="string">fields": [      &#123;"</span><span class="string">name": "</span><span class="string">name", "</span><span class="string">type": "</span><span class="string">string"&#125;,</span></span><br><span class="line"><span class="string">     |      &#123;"</span><span class="string">name": "</span>favorite_<span class="string">number",  "</span><span class="string">type": ["</span><span class="string">int", "</span><span class="string">null"]&#125;,</span></span><br><span class="line"><span class="string">     |        &#123;"</span><span class="string">name": "</span>favorite_<span class="string">color", "</span><span class="string">type": ["</span><span class="string">string", "</span><span class="string">null"]&#125;      ]    &#125;"</span><span class="string">""</span>.stripMargin</span><br><span class="line"><span class="keyword">val</span> catalog = <span class="string">s""</span><span class="string">"&#123;</span></span><br><span class="line"><span class="string">        |"</span><span class="string">table":&#123;"</span><span class="string">namespace":"</span><span class="string">default", "</span><span class="string">name":"</span><span class="string">htable"&#125;,</span></span><br><span class="line"><span class="string">        |"</span><span class="string">rowkey":"</span>key1:key2<span class="string">",</span></span><br><span class="line"><span class="string">        |"</span><span class="string">columns":&#123;</span></span><br><span class="line"><span class="string">          |"</span>col1<span class="string">":&#123;"</span><span class="string">cf":"</span><span class="string">rowkey", "</span><span class="string">col":"</span>key1<span class="string">", "</span><span class="string">type":"</span><span class="string">binary"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col2<span class="string">":&#123;"</span><span class="string">cf":"</span><span class="string">rowkey", "</span><span class="string">col":"</span>key2<span class="string">", "</span><span class="string">type":"</span><span class="string">double"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col3<span class="string">":&#123;"</span><span class="string">cf":"</span>cf1<span class="string">", "</span><span class="string">col":"</span>col1<span class="string">", "</span><span class="string">avro":"</span>schema1<span class="string">"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col4<span class="string">":&#123;"</span><span class="string">cf":"</span>cf1<span class="string">", "</span><span class="string">col":"</span>col2<span class="string">", "</span><span class="string">type":"</span><span class="string">string"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col5<span class="string">":&#123;"</span><span class="string">cf":"</span>cf1<span class="string">", "</span><span class="string">col":"</span>col3<span class="string">", "</span><span class="string">type":"</span><span class="string">double",        "</span><span class="string">sedes":"</span>org.apache.spark.sql.execution.datasources.hbase.<span class="type">DoubleSedes</span><span class="string">"&#125;,</span></span><br><span class="line"><span class="string">          |"</span>col6<span class="string">":&#123;"</span><span class="string">cf":"</span>cf1<span class="string">", "</span><span class="string">col":"</span>col4<span class="string">", "</span><span class="string">type":"</span>$<span class="string">complex"&#125;</span></span><br><span class="line"><span class="string">        |&#125;</span></span><br><span class="line"><span class="string">      |&#125;"</span><span class="string">""</span>.stripMargin</span><br><span class="line">   </span><br><span class="line"><span class="keyword">val</span> df = sqlContext.read.options(<span class="type">Map</span>(<span class="string">"schema1"</span>-&gt;schema, <span class="type">HBaseTableCatalog</span>.tableCatalog-&gt;catalog)).format(<span class="string">"org.apache.spark.sql.execution.datasources.hbase"</span>).load()</span><br><span class="line">df.write.options(<span class="type">Map</span>(<span class="string">"schema1"</span>-&gt;schema, <span class="type">HBaseTableCatalog</span>.tableCatalog-&gt;catalog)).format(<span class="string">"org.apache.spark.sql.execution.datasources.hbase"</span>).save()</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šè¯´æ˜äº†æˆ‘ä»¬çš„ä¸‹ä¸€æ­¥ï¼Œå…¶ä¸­åŒ…æ‹¬å¤åˆé”®æ”¯æŒï¼Œå¤æ‚æ•°æ®ç±»å‹ï¼Œå®¢æˆ·åŒ–Serdeå’ŒAvroçš„æ”¯æŒã€‚è¯·æ³¨æ„ï¼Œå°½ç®¡æ‰€æœ‰ä¸»è¦éƒ¨åˆ†éƒ½åŒ…å«åœ¨å½“å‰ä»£ç åº“ä¸­ï¼Œä½†ç°åœ¨å¯èƒ½æ— æ³•è¿è¡Œã€‚<br><br><br></p><p><a name="XtWKn"></a></p><h2 id="SHCæŸ¥è¯¢ä¼˜åŒ–"><a href="#SHCæŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="SHCæŸ¥è¯¢ä¼˜åŒ–"></a>SHCæŸ¥è¯¢ä¼˜åŒ–</h2><p><br>SHC ä¸»è¦ä½¿ç”¨ä¸‹é¢çš„å‡ ç§ä¼˜åŒ–ï¼Œä½¿å¾— Spark è·å– HBase çš„æ•°æ®æ‰«æèŒƒå›´å¾—åˆ°å‡å°‘ï¼Œæé«˜äº†æ•°æ®è¯»å–çš„æ•ˆç‡ã€‚<br><strong><br></strong>å°†ä½¿ç”¨ Rowkey çš„æŸ¥è¯¢è½¬æ¢æˆ get æŸ¥è¯¢**<br>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒHBase ä¸­ä½¿ç”¨ Get æŸ¥è¯¢çš„æ•ˆç‡æ˜¯éå¸¸é«˜çš„ï¼Œæ‰€ä»¥å¦‚æœæŸ¥è¯¢çš„è¿‡æ»¤æ¡ä»¶æ˜¯é’ˆå¯¹ RowKey è¿›è¡Œçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†å®ƒè½¬æ¢æˆ Get æŸ¥è¯¢ã€‚ä¸ºäº†è¯´æ˜è¿™ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„ä¾‹å­è¿›è¡Œè¯´æ˜ã€‚å‡è®¾æˆ‘ä»¬å®šä¹‰å¥½çš„ HBase catalog å¦‚ä¸‹ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> catalog = <span class="string">s""</span><span class="string">"&#123;</span></span><br><span class="line"><span class="string">  |"</span><span class="string">table":&#123;"</span><span class="string">namespace":"</span><span class="string">default", "</span><span class="string">name":"</span><span class="string">iteblog", "</span>tableC<span class="string">oder":"</span><span class="type">PrimitiveType</span><span class="string">"&#125;,</span></span><br><span class="line"><span class="string">  |"</span><span class="string">rowkey":"</span><span class="string">key",</span></span><br><span class="line"><span class="string">  |"</span><span class="string">columns":&#123;</span></span><br><span class="line"><span class="string">    |"</span>col0<span class="string">":&#123;"</span><span class="string">cf":"</span><span class="string">rowkey", "</span><span class="string">col":"</span><span class="string">id", "</span><span class="string">type":"</span><span class="string">int"&#125;,</span></span><br><span class="line"><span class="string">    |"</span>col1<span class="string">":&#123;"</span><span class="string">cf":"</span>cf1<span class="string">", "</span><span class="string">col":"</span>col1<span class="string">", "</span><span class="string">type":"</span><span class="string">boolean"&#125;,</span></span><br><span class="line"><span class="string">    |"</span>col2<span class="string">":&#123;"</span><span class="string">cf":"</span>cf2<span class="string">", "</span><span class="string">col":"</span>col2<span class="string">", "</span><span class="string">type":"</span><span class="string">double"&#125;,</span></span><br><span class="line"><span class="string">    |"</span>col3<span class="string">":&#123;"</span><span class="string">cf":"</span>cf3<span class="string">", "</span><span class="string">col":"</span>col3<span class="string">", "</span><span class="string">type":"</span><span class="string">float"&#125;,</span></span><br><span class="line"><span class="string">    |"</span>col4<span class="string">":&#123;"</span><span class="string">cf":"</span>cf4<span class="string">", "</span><span class="string">col":"</span>col4<span class="string">", "</span><span class="string">type":"</span><span class="string">int"&#125;,</span></span><br><span class="line"><span class="string">    |"</span>col5<span class="string">":&#123;"</span><span class="string">cf":"</span>cf5<span class="string">", "</span><span class="string">col":"</span>col5<span class="string">", "</span><span class="string">type":"</span><span class="string">bigint"&#125;,</span></span><br><span class="line"><span class="string">    |"</span>col6<span class="string">":&#123;"</span><span class="string">cf":"</span>cf6<span class="string">", "</span><span class="string">col":"</span>col6<span class="string">", "</span><span class="string">type":"</span><span class="string">smallint"&#125;,</span></span><br><span class="line"><span class="string">    |"</span>col7<span class="string">":&#123;"</span><span class="string">cf":"</span>cf7<span class="string">", "</span><span class="string">col":"</span>col7<span class="string">", "</span><span class="string">type":"</span><span class="string">string"&#125;,</span></span><br><span class="line"><span class="string">    |"</span>col8<span class="string">":&#123;"</span><span class="string">cf":"</span>cf8<span class="string">", "</span><span class="string">col":"</span>col8<span class="string">", "</span><span class="string">type":"</span><span class="string">tinyint"&#125;</span></span><br><span class="line"><span class="string">  |&#125;</span></span><br><span class="line"><span class="string">|&#125;"</span><span class="string">""</span>.stripMargin</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¦‚æœæœ‰ç±»ä¼¼ä¸‹é¢çš„æŸ¥è¯¢</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> df = withCatalog(catalog)</span><br><span class="line">df.createOrReplaceTempView(<span class="string">"iteblog_table"</span>)</span><br><span class="line">sqlContext.sql(<span class="string">"select * from iteblog_table where id = 1"</span>)</span><br><span class="line">sqlContext.sql(<span class="string">"select * from iteblog_table where id = 1 or id = 2"</span>)</span><br><span class="line">sqlContext.sql(<span class="string">"select * from iteblog_table where id in (1, 2)"</span>)</span><br></pre></td></tr></table></figure><p>å› ä¸ºæŸ¥è¯¢æ¡ä»¶ç›´æ¥æ˜¯é’ˆå¯¹ RowKey è¿›è¡Œçš„ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µç›´æ¥å¯ä»¥è½¬æ¢æˆ Get æˆ–è€… BulkGet è¯·æ±‚çš„ã€‚ç¬¬ä¸€ä¸ª SQL æŸ¥è¯¢è¿‡ç¨‹ç±»ä¼¼äºä¸‹é¢è¿‡ç¨‹<br><a href="https://www.iteblog.com/pic/hbase/shc_get-iteblog.png" target="_blank" rel="external nofollow noopener noreferrer"><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1589595330346-3b5f02d0-85b1-4e32-98d8-7d65433517d4.png#align=left&display=inline&height=409&margin=%5Bobject%20Object%5D&originHeight=409&originWidth=1032&size=0&status=done&style=none&width=1032" alt></a><br><br><br>ä½†æ˜¯ï¼Œå¦‚æœç¢°åˆ°é RowKey çš„è¿‡æ»¤ï¼Œé‚£ä¹ˆè¿™ç§æŸ¥è¯¢æ˜¯éœ€è¦æ‰«æ HBase çš„å…¨è¡¨çš„ã€‚ä¸Šé¢çš„æŸ¥è¯¢åœ¨ shc é‡Œé¢å°±æ˜¯å°† HBase é‡Œé¢çš„æ‰€æœ‰æ•°æ®æ‹¿åˆ°ï¼Œç„¶å<strong>ä¼ è¾“åˆ° Spark ï¼Œå†é€šè¿‡ Spark é‡Œé¢è¿›è¡Œè¿‡æ»¤</strong>ï¼Œå¯è§ shc åœ¨è¿™ç§æƒ…å†µä¸‹æ•ˆç‡æ˜¯å¾ˆä½ä¸‹çš„ã€‚<br><br><br>æ³¨æ„ï¼Œä¸Šé¢çš„æŸ¥è¯¢åœ¨ shc è¿”å›çš„ç»“æœæ˜¯é”™è¯¯çš„ã€‚å…·ä½“åŸå› æ˜¯åœ¨å°† id = 1 or col7 = â€˜xxxâ€™ æŸ¥è¯¢æ¡ä»¶è¿›è¡Œåˆå¹¶æ—¶ï¼Œä¸¢å¼ƒäº†æ‰€æœ‰çš„æŸ¥æ‰¾æ¡ä»¶ï¼Œç›¸å½“äºè¿”å›è¡¨çš„æ‰€æœ‰æ•°æ®ã€‚å®šä½åˆ°ä»£ç å¯ä»¥å‚è§ä¸‹é¢çš„</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">or</span></span>[<span class="type">T</span>](left: <span class="type">HRF</span>[<span class="type">T</span>],</span><br><span class="line">            right: <span class="type">HRF</span>[<span class="type">T</span>])(<span class="keyword">implicit</span> ordering: <span class="type">Ordering</span>[<span class="type">T</span>]): <span class="type">HRF</span>[<span class="type">T</span>] = &#123;</span><br><span class="line">    <span class="keyword">val</span> ranges = <span class="type">ScanRange</span>.or(left.ranges, right.ranges)</span><br><span class="line">    <span class="keyword">val</span> typeFilter = <span class="type">TypedFilter</span>.or(left.tf, right.tf)</span><br><span class="line">    <span class="type">HRF</span>(ranges, typeFilter, left.handled &amp;&amp; right.handled)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒç†ï¼Œç±»ä¼¼äºä¸‹é¢çš„æŸ¥è¯¢åœ¨ shc é‡Œé¢å…¶å®éƒ½æ˜¯å…¨è¡¨æ‰«æï¼Œå¹¶ä¸”å°†æ‰€æœ‰çš„æ•°æ®è¿”å›åˆ° Spark å±‚é¢ä¸Šå†è¿›è¡Œä¸€æ¬¡è¿‡æ»¤ã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sqlContext.sql(<span class="string">"select id, col6, col8 from iteblog_table where id = 1 or col7 &lt;= 'xxx'"</span>)</span><br><span class="line">sqlContext.sql(<span class="string">"select id, col6, col8 from iteblog_table where id = 1 or col7 &gt;= 'xxx'"</span>)</span><br><span class="line">sqlContext.sql(<span class="string">"select id, col6, col8 from iteblog_table where col7 = 'xxx'"</span>)</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜¾ç„¶ï¼Œè¿™ç§æ–¹å¼æŸ¥è¯¢æ•ˆç‡å¹¶ä¸é«˜ï¼Œä¸€ç§å¯è¡Œçš„æ–¹æ¡ˆæ˜¯å°†ç®—å­ä¸‹æ¨åˆ° HBase å±‚é¢ï¼Œåœ¨ HBase å±‚é¢é€šè¿‡ SingleColumnValueFilter è¿‡æ»¤ä¸€éƒ¨åˆ†æ•°æ®ï¼Œç„¶åå†è¿”å›åˆ° Sparkï¼Œè¿™æ ·å¯ä»¥èŠ‚çœå¾ˆå¤šæ•°æ®çš„ä¼ è¾“ã€‚<br></p><p><a name="RHA0U"></a></p><h2 id="ç»„åˆ-RowKey-çš„æŸ¥è¯¢ä¼˜åŒ–"><a href="#ç»„åˆ-RowKey-çš„æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="ç»„åˆ RowKey çš„æŸ¥è¯¢ä¼˜åŒ–"></a>ç»„åˆ RowKey çš„æŸ¥è¯¢ä¼˜åŒ–</h2><p><br>shc è¿˜æ”¯æŒç»„åˆ RowKey çš„æ–¹å¼æ¥å»ºè¡¨ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cat</span> </span>=</span><br><span class="line">  <span class="string">s""</span><span class="string">"&#123;</span></span><br><span class="line"><span class="string">     |"</span><span class="string">table":&#123;"</span><span class="string">namespace":"</span><span class="string">default", "</span><span class="string">name":"</span><span class="string">iteblog", "</span>tableC<span class="string">oder":"</span><span class="type">PrimitiveType</span><span class="string">"&#125;,</span></span><br><span class="line"><span class="string">     |"</span><span class="string">rowkey":"</span>key1:key2<span class="string">",</span></span><br><span class="line"><span class="string">     |"</span><span class="string">columns":&#123;</span></span><br><span class="line"><span class="string">     |"</span>col00<span class="string">":&#123;"</span><span class="string">cf":"</span><span class="string">rowkey", "</span><span class="string">col":"</span>key1<span class="string">", "</span><span class="string">type":"</span><span class="string">string", "</span><span class="string">length":"</span><span class="number">6</span><span class="string">"&#125;,</span></span><br><span class="line"><span class="string">     |"</span>col01<span class="string">":&#123;"</span><span class="string">cf":"</span><span class="string">rowkey", "</span><span class="string">col":"</span>key2<span class="string">", "</span><span class="string">type":"</span><span class="string">int"&#125;,</span></span><br><span class="line"><span class="string">     |"</span>col1<span class="string">":&#123;"</span><span class="string">cf":"</span>cf1<span class="string">", "</span><span class="string">col":"</span>col1<span class="string">", "</span><span class="string">type":"</span><span class="string">boolean"&#125;,</span></span><br><span class="line"><span class="string">     |"</span>col2<span class="string">":&#123;"</span><span class="string">cf":"</span>cf2<span class="string">", "</span><span class="string">col":"</span>col2<span class="string">", "</span><span class="string">type":"</span><span class="string">double"&#125;,</span></span><br><span class="line"><span class="string">     |"</span>col3<span class="string">":&#123;"</span><span class="string">cf":"</span>cf3<span class="string">", "</span><span class="string">col":"</span>col3<span class="string">", "</span><span class="string">type":"</span><span class="string">float"&#125;,</span></span><br><span class="line"><span class="string">     |"</span>col4<span class="string">":&#123;"</span><span class="string">cf":"</span>cf4<span class="string">", "</span><span class="string">col":"</span>col4<span class="string">", "</span><span class="string">type":"</span><span class="string">int"&#125;,</span></span><br><span class="line"><span class="string">     |"</span>col5<span class="string">":&#123;"</span><span class="string">cf":"</span>cf5<span class="string">", "</span><span class="string">col":"</span>col5<span class="string">", "</span><span class="string">type":"</span><span class="string">bigint"&#125;,</span></span><br><span class="line"><span class="string">     |"</span>col6<span class="string">":&#123;"</span><span class="string">cf":"</span>cf6<span class="string">", "</span><span class="string">col":"</span>col6<span class="string">", "</span><span class="string">type":"</span><span class="string">smallint"&#125;,</span></span><br><span class="line"><span class="string">     |"</span>col7<span class="string">":&#123;"</span><span class="string">cf":"</span>cf7<span class="string">", "</span><span class="string">col":"</span>col7<span class="string">", "</span><span class="string">type":"</span><span class="string">string"&#125;,</span></span><br><span class="line"><span class="string">     |"</span>col8<span class="string">":&#123;"</span><span class="string">cf":"</span>cf8<span class="string">", "</span><span class="string">col":"</span>col8<span class="string">", "</span><span class="string">type":"</span><span class="string">tinyint"&#125;</span></span><br><span class="line"><span class="string">     |&#125;</span></span><br><span class="line"><span class="string">     |&#125;"</span><span class="string">""</span>.stripMargin</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ col00 å’Œ col01 ä¸¤åˆ—ç»„åˆæˆä¸€ä¸ª rowkeyï¼Œå¹¶ä¸” col00 æ’åœ¨å‰é¢ï¼Œcol01 æ’åœ¨åé¢ã€‚æ¯”å¦‚ col00 =â€™row002â€™ï¼Œcol01 = 2ï¼Œé‚£ä¹ˆç»„åˆçš„ rowkey ä¸º row002\x00\x00\x00\x02ã€‚é‚£ä¹ˆåœ¨ç»„åˆ Rowkey çš„æŸ¥è¯¢ shc éƒ½æœ‰å“ªäº›ä¼˜åŒ–å‘¢ï¼Ÿç°åœ¨æˆ‘ä»¬æœ‰å¦‚ä¸‹æŸ¥è¯¢</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.sqlContext.sql(<span class="string">"select col00, col01, col1 from iteblog where col00 = 'row000' and col01 = 0"</span>).show()</span><br></pre></td></tr></table></figure><p>æ ¹æ®ä¸Šé¢çš„ä¿¡æ¯ï¼ŒRowKey å…¶å®æ˜¯ç”± col00 å’Œ col01 ç»„åˆè€Œæˆçš„ï¼Œé‚£ä¹ˆä¸Šé¢çš„æŸ¥è¯¢å…¶å®å¯ä»¥å°† col00 å’Œ col01 è¿›è¡Œæ‹¼æ¥ï¼Œç„¶åç»„åˆæˆä¸€ä¸ª RowKeyï¼Œç„¶åä¸Šé¢çš„æŸ¥è¯¢å…¶å®å¯ä»¥è½¬æ¢æˆä¸€ä¸ª Get æŸ¥è¯¢ã€‚ä½†æ˜¯åœ¨ shc é‡Œé¢ï¼Œä¸Šé¢çš„æŸ¥è¯¢æ˜¯è½¬æ¢æˆä¸€ä¸ª scan å’Œä¸€ä¸ª get æŸ¥è¯¢çš„ã€‚scan çš„ startRow ä¸º row000ï¼ŒendRow ä¸º row000\xff\xff\xff\xffï¼›get çš„ rowkey ä¸º row000\xff\xff\xff\xffï¼Œç„¶åå†å°†æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®è¿”å›ï¼Œæœ€åå†åœ¨ Spark å±‚é¢ä¸Šåšä¸€æ¬¡è¿‡æ»¤ï¼Œå¾—åˆ°æœ€åæŸ¥è¯¢çš„ç»“æœã€‚å› ä¸º shc é‡Œé¢ç»„åˆé”®æŸ¥è¯¢çš„ä»£ç è¿˜æ²¡å®Œå–„ï¼Œæ‰€ä»¥å½“å‰å®ç°åº”è¯¥ä¸æ˜¯æœ€ç»ˆçš„ã€‚<br>åœ¨ shc é‡Œé¢ä¸‹é¢ä¸¤æ¡ SQL æŸ¥è¯¢ä¸‹æ²‰åˆ° HBase çš„é€»è¾‘ä¸€è‡´</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.sqlContext.sql(<span class="string">"select col00, col01, col1 from iteblog where col00 = 'row000'"</span>).show()df.sqlContext.sql(<span class="string">"select col00, col01, col1 from iteblog where col00 = 'row000' and col01 = 0"</span>).show()</span><br></pre></td></tr></table></figure><p>å”¯ä¸€åŒºåˆ«æ˜¯åœ¨ Spark å±‚é¢ä¸Šçš„è¿‡æ»¤ã€‚<br><a name="aR7vS"></a></p><h2 id="scan-æŸ¥è¯¢ä¼˜åŒ–"><a href="#scan-æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="scan æŸ¥è¯¢ä¼˜åŒ–"></a>scan æŸ¥è¯¢ä¼˜åŒ–</h2><p>å¦‚æœæˆ‘ä»¬çš„æŸ¥è¯¢æœ‰ &lt; æˆ– &gt; ç­‰æŸ¥è¯¢è¿‡æ»¤æ¡ä»¶ï¼Œæ¯”å¦‚ä¸‹é¢çš„æŸ¥è¯¢æ¡ä»¶ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.sqlContext.sql(<span class="string">"select col00, col01, col1 from iteblog where col00 &gt; 'row000' and col00 &lt; 'row005'"</span>).show()</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåœ¨ shc é‡Œé¢è½¬æ¢æˆ HBase çš„è¿‡æ»¤ä¸ºä¸€æ¡ get å’Œ ä¸€ä¸ª scanï¼Œå…·ä½“ä¸º get çš„ Rowkey ä¸º row0005\xff\xff\xff\xffï¼›scan çš„ startRow ä¸º row000ï¼ŒendRow ä¸º row005\xff\xff\xff\xffï¼Œç„¶åå°†æŸ¥è¯¢çš„ç»“æœè¿”å›åˆ° spark å±‚é¢ä¸Šè¿›è¡Œè¿‡æ»¤ã€‚<br>æ€»ä½“æ¥è¯´ï¼Œshc èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œé¿å…äº†å…¨è¡¨æ‰«æã€‚ä½†æ˜¯ç»è¿‡è¯„æµ‹ï¼Œshc å…¶å®è¿˜æœ‰å¾ˆå¤šåœ°æ–¹ä¸å¤Ÿå®Œå–„ï¼Œç®—å­ä¸‹æ²‰å¹¶æ²¡æœ‰ä¸‹æ²‰åˆ° HBase å±‚é¢ä¸Šè¿›è¡Œã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:12 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;&lt;br&gt;Apache &lt;a href=&quot;https://www.iteblog.com/archives/tag/spark/&quot; target=
      
    
    </summary>
    
    
      <category term="å¤§æ•°æ®" scheme="cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="spark" scheme="cpeixin.cn/tags/spark/"/>
    
  </entry>
  
  <entry>
    <title>shadowsock-vpsæ­å»ºVPN</title>
    <link href="cpeixin.cn/2019/04/19/shadowsock-vps%E6%90%AD%E5%BB%BAVPN/"/>
    <id>cpeixin.cn/2019/04/19/shadowsock-vps%E6%90%AD%E5%BB%BAVPN/</id>
    <published>2019-04-19T15:26:15.000Z</published>
    <updated>2020-04-04T17:11:07.011Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><p><a name="-1"></a></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¿˜æœ‰10å¤©å·¦å³å°±è¦å›å›½äº†ï¼Œç”±äºèŒä¸šçš„éœ€è¦ï¼Œå¯¹Googleçš„ä¾èµ–çš„è¶Šæ¥è¶Šå¤§çš„ï¼Œé‚£ä¹ˆå›å›½åæ€ä¹ˆæ‰èƒ½â€˜ç§‘å­¦ä¸Šç½‘â€™å‘¢ï¼Ÿä¹‹å‰åœ¨å›½å†…çš„æ—¶å€™ï¼Œæœ‰ä½¿ç”¨è¿‡Lanternï¼Œç¨³å®šæ€§å’Œé€Ÿåº¦éƒ½è¿˜æ˜¯ä¸é”™äº†ï¼Œå¯æƒœåæ¥è¢«å’Œè°äº†ã€‚æ‰€ä»¥ä»Šå¤©å‡†å¤‡å°è¯•æ­å»ºVPNï¼Œè‡ªå·±ç‹¬ç«‹ä½¿ç”¨ï¼Œä¸€è¾¹æ­å»ºä¸€è¾¹å°†è¿‡ç¨‹è®°å½•ä¸‹æ¥ã€‚<br><a name="-2"></a></p><h1 id="åè¯è§£é‡Š"><a href="#åè¯è§£é‡Š" class="headerlink" title="åè¯è§£é‡Š"></a>åè¯è§£é‡Š</h1><p>VPS: VPSï¼ˆVirtual Private Server è™šæ‹Ÿä¸“ç”¨æœåŠ¡å™¨ï¼‰æŠ€æœ¯ï¼Œå°†ä¸€å°æœåŠ¡å™¨åˆ†å‰²æˆå¤šä¸ªè™šæ‹Ÿä¸“äº«æœåŠ¡å™¨çš„ä¼˜è´¨æœåŠ¡ã€‚å®ç°VPSçš„æŠ€æœ¯åˆ†ä¸ºå®¹å™¨ [1] æŠ€æœ¯ï¼Œå’Œè™šæ‹ŸåŒ–æŠ€æœ¯ [2] ã€‚åœ¨å®¹å™¨æˆ–è™šæ‹Ÿæœºä¸­ï¼Œæ¯ä¸ªVPSéƒ½å¯åˆ†é…ç‹¬ç«‹å…¬ç½‘IPåœ°å€ã€ç‹¬ç«‹æ“ä½œç³»ç»Ÿã€å®ç°ä¸åŒVPSé—´ç£ç›˜ç©ºé—´ã€å†…å­˜ã€CPUèµ„æºã€è¿›ç¨‹å’Œç³»ç»Ÿé…ç½®çš„éš”ç¦»ï¼Œä¸ºç”¨æˆ·å’Œåº”ç”¨ç¨‹åºæ¨¡æ‹Ÿå‡ºâ€œç‹¬å â€ä½¿ç”¨è®¡ç®—èµ„æºçš„ä½“éªŒã€‚VPSå¯ä»¥åƒç‹¬ç«‹æœåŠ¡å™¨ä¸€æ ·ï¼Œé‡è£…æ“ä½œç³»ç»Ÿï¼Œå®‰è£…ç¨‹åºï¼Œå•ç‹¬é‡å¯æœåŠ¡å™¨ã€‚<br><br><br>VPSä¸ºä½¿ç”¨è€…æä¾›äº†ç®¡ç†é…ç½®çš„è‡ªç”±ï¼Œå¯ç”¨äºä¼ä¸šè™šæ‹ŸåŒ–ï¼Œä¹Ÿå¯ä»¥ç”¨äºIDCèµ„æºç§Ÿç”¨ã€‚<br><br><br>VPN: VPNçš„å­¦åå«è™šæ‹Ÿä¸“ç”¨ç½‘ï¼Œæ´‹æ–‡å«â€œVirtual Private Networkâ€ã€‚ç»´åŸºç™¾ç§‘çš„ä»‹ç»åœ¨â€œè¿™é‡Œâ€ã€‚æœ¬æ¥è¿™ç©æ„å„¿ä¸»è¦æ˜¯ç”¨äºå•†ä¸šå…¬å¸ï¼Œä¸ºäº†è®©é‚£äº›ä¸åœ¨å…¬å¸é‡Œçš„å‘˜å·¥ï¼ˆæ¯”å¦‚å‡ºå·®åœ¨å¤–çš„ï¼‰èƒ½å¤Ÿæ–¹ä¾¿åœ°è®¿é—®å…¬å¸çš„å†…éƒ¨ç½‘ç»œã€‚ä¸ºäº†é˜²æ­¢é»‘å®¢å†’å……å…¬å¸çš„å‘˜å·¥ï¼Œä»å¤–éƒ¨è®¿é—®å…¬å¸çš„å†…éƒ¨ç½‘ç»œï¼ŒVPN è½¯ä»¶éƒ½ä¼šæä¾›å¼ºå¤§çš„åŠ å¯†åŠŸèƒ½ã€‚è€Œè¿™ä¸ªåŠ å¯†åŠŸèƒ½ï¼Œä¹Ÿå°±è®©å®ƒé¡ºä¾¿æˆä¸ºç¿»å¢™çš„åˆ©å™¨ã€‚<br><a name="-3"></a></p><h1 id="ç§‘å­¦ä¸Šç½‘åŸç†"><a href="#ç§‘å­¦ä¸Šç½‘åŸç†" class="headerlink" title="ç§‘å­¦ä¸Šç½‘åŸç†"></a>ç§‘å­¦ä¸Šç½‘åŸç†</h1><p>VPNæµè§ˆå¤–ç½‘çš„åŸç†<br><br><br>ä½¿ç”¨ VPN é€šå¸¸éœ€è¦å…ˆå®‰è£…å®¢æˆ·ç«¯è½¯ä»¶ã€‚å½“ä½ è¿è¡Œ VPN å®¢æˆ·ç«¯ï¼Œå®ƒä¼šå°è¯•è”åˆ° VPN æœåŠ¡å™¨ï¼ˆè¿™ç‚¹è·ŸåŠ å¯†ä»£ç†ç±»ä¼¼ï¼‰ã€‚ä¸€æ—¦å’Œ VPN æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼ŒVPN å®¢æˆ·ç«¯å°±ä¼šåœ¨ä½ çš„ç³»ç»Ÿä¸­å»ºç«‹äº†ä¸€ä¸ªè™šæ‹Ÿå±€åŸŸç½‘ã€‚è€Œä¸”ï¼Œä½ çš„ç³»ç»Ÿä¸­ä¹Ÿä¼šå¤šå‡ºä¸€ä¸ªè™šæ‹Ÿç½‘å¡ï¼ˆåœ¨ Windows ä¸‹ï¼Œå¯ä»¥ç”¨ ipconfig /all å‘½ä»¤ï¼Œçœ‹åˆ°è¿™å¤šå‡ºæ¥çš„ç½‘å¡ï¼‰ã€‚è¿™æ ·ä¸€æ¥ï¼Œä½ çš„ç³»ç»Ÿä¸­å°±æœ‰ä¸æ­¢ä¸€å—ç½‘å¡ã€‚è¿™å°±å¼•å‡ºä¸€ä¸ªé—®é¢˜ï¼šé‚£äº›è®¿é—®ç½‘ç»œçš„ç¨‹åºï¼Œå®ƒçš„æ•°æ®æµåº”è¯¥é€šè¿‡å“ªä¸ªç½‘å¡è¿›å‡ºï¼Ÿ<br>ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼ŒVPN å®¢æˆ·ç«¯é€šå¸¸ä¼šä¿®æ”¹ä½ ç³»ç»Ÿçš„è·¯ç”±è¡¨ï¼Œè®©é‚£äº›æ•°æ®æµï¼Œä¼˜å…ˆä»è™šæ‹Ÿçš„ç½‘å¡è¿›å‡ºã€‚ç”±äºè™šæ‹Ÿçš„ç½‘å¡æ˜¯é€šå¾€ VPN æœåŠ¡å™¨çš„ï¼Œå½“æ•°æ®æµåˆ°è¾¾ VPN æœåŠ¡å™¨ä¹‹åï¼ŒVPN æœåŠ¡å™¨å†å¸®ä½ æŠŠæ•°æ®æµè½¬å‘åˆ°çœŸæ­£çš„ç›®çš„åœ°ã€‚<br><br><br>å‰é¢è¯´äº†ï¼ŒVPN ä¸ºäº†ä¿è¯å®‰å…¨ï¼Œéƒ½é‡‡ç”¨å¼ºåŠ å¯†çš„æ–¹å¼ä¼ è¾“æ•°æ®ã€‚è¿™æ ·ä¸€æ¥ï¼ŒGFW å°±æ— æ³•åˆ†æä½ çš„ç½‘ç»œæ•°æ®æµï¼Œè¿›è¡Œæ•æ„Ÿè¯è¿‡æ»¤ã€‚æ‰€ä»¥ï¼Œä½¿ç”¨å¢™å¤–çš„VPNæœåŠ¡å™¨ï¼Œæ— å½¢ä¸­å°±èƒ½è¾¾åˆ°ç¿»å¢™çš„æ•ˆæœã€‚<br><a name="-4"></a></p><h1 id="æ–¹æ¡ˆé€‰æ‹©"><a href="#æ–¹æ¡ˆé€‰æ‹©" class="headerlink" title="æ–¹æ¡ˆé€‰æ‹©"></a>æ–¹æ¡ˆé€‰æ‹©</h1><p>VPNæ˜¯ä¸€ä¸ªå¤§ç±»ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šå®ç°çš„æ–¹æ³•ï¼Œé˜²ç«é•¿åŸç°åœ¨å°† VPN å±è”½çš„å·²ç»æ‰€å‰©æ— å‡ ï¼Œåæ¥å¤§å®¶çœ‹åˆ°äº†SSHï¼Œä½¿ç”¨SSHçš„sock5å¾ˆç¨³å®šï¼Œä½†æ˜¯ç‰¹å¾ä¹Ÿååˆ†æ˜æ˜¾ï¼Œé˜²ç«é•¿åŸå¯ä»¥å¯¹å…¶ç›´æ¥è¿›è¡Œå®šå‘å¹²æ‰°ã€‚<br><br><br>è€Œé™¤äº†VPNï¼Œå¯¹äºç¿»å¢™å¤§å®¶ä»ç„¶æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæ¯”å¦‚Shadowsocks ã€Lanternã€VPNGate ç­‰ç­‰ï¼Œè€Œå®é™…ä¸Šæ— è®ºå“ªç§æ–¹å¼ï¼Œä»–ä»¬æœ¬èº«éƒ½éœ€è¦ä¸€å°æœåŠ¡å™¨ä½œä¸ºä¸­é—´äººè¿›è¡Œæ¶ˆæ¯ä¼ é€’ã€‚è€ŒVPSè™šæ‹Ÿä¸“ç”¨æœåŠ¡å™¨å°±ååˆ†é€‚åˆæ‹…å½“è¿™ä¸ªè§’è‰²ï¼Œå¹¶ä¸”ç”±äºVPSå¹³æ—¶å°±ä½œä¸ºå•†å“åœ¨å„ç±»äº‘æœåŠ¡å™¨å¹³å°ä¸Šå”®å–ï¼Œè‡ªè¡Œè´­ä¹°å¹¶æ­å»ºç›¸å½“æ–¹ä¾¿ï¼Œå”¯ä¸€éœ€è¦çš„å°±æ˜¯äººä»¬å¯¹äºæœåŠ¡å™¨çš„æ“ä½œæŠ€æœ¯ã€‚<br><br><br><strong>è€Œè¿™æ¬¡é€‰æ‹©çš„æ–¹æ¡ˆæ˜¯ï¼šVPS+Shadowsocks</strong><br>**<br>Shadowsocksç‰¹ç‚¹ï¼š<br><br><br>çœç”µï¼Œåœ¨ç”µé‡æŸ¥çœ‹é‡Œå‡ ä¹çœ‹ä¸åˆ°å®ƒçš„èº«å½±ï¼›<br><br><br>æ”¯æŒå¼€æœºè‡ªå¯åŠ¨ï¼Œä¸”æ–­ç½‘æ— å½±å“ï¼Œæ— éœ€æ‰‹åŠ¨é‡è¿ï¼Œæ–¹ä¾¿ç½‘ç»œä¸ç¨³å®šæˆ–è€…3G&amp;Wi-Fié¢‘ç¹åˆ‡æ¢çš„å°ä¼™ä¼´ï¼›<br><br><br>å¯ä½¿ç”¨è‡ªå·±çš„æœåŠ¡å™¨ï¼Œå®‰å…¨å’Œé€Ÿåº¦çš„ä¿è¯ï¼›<br><br><br>æ”¯æŒåŒºåˆ†å›½å†…å¤–æµé‡ï¼Œä¼ ç»ŸVPNåœ¨ç¿»å‡ºå¢™å¤–åè®¿é—®å›½å†…ç«™ç‚¹ä¼šå˜æ…¢ï¼›<br><br><br>å¯å¯¹åº”ç”¨è®¾ç½®å•ç‹¬ä»£ç†ï¼Œ5.0ä¹‹åçš„ç³»ç»Ÿæ— éœ€rootã€‚<br><br><br>Shadowsocks ç›®å‰ä¸å®¹æ˜“è¢«å°æ€ä¸»è¦æ˜¯å› ä¸ºï¼š<br>å»ºç«‹åœ¨socks5åè®®ä¹‹ä¸Šï¼Œsocks5æ˜¯è¿ç”¨å¾ˆå¹¿æ³›çš„åè®®ï¼Œæ‰€ä»¥æ²¡åŠæ³•ç›´æ¥å°æ€socks5åè®®<br>ä½¿ç”¨socks5åè®®å»ºç«‹è¿æ¥ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨VPNä¸­çš„æœåŠ¡ç«¯èº«ä»½éªŒè¯å’Œå¯†é’¥åå•†è¿‡ç¨‹ã€‚è€Œæ˜¯åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ç›´æ¥å†™æ­»å¯†é’¥å’ŒåŠ å¯†ç®—æ³•ã€‚æ‰€ä»¥é˜²ç«å¢™å¾ˆéš¾æ‰¾åˆ°æ˜æ˜¾çš„ç‰¹å¾ï¼Œå› ä¸ºè¿™å°±æ˜¯ä¸ªæ™®é€šçš„socks5åè®®ã€‚<br><br><br>Shadowsockæ­å»ºä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥å¾ˆå¤šäººè‡ªå·±æ¶è®¾VPSæ­å»ºï¼Œä¸ªäººä½¿ç”¨æµé‡ä¹Ÿå¾ˆå°ï¼Œæ²¡æ³•é€šè¿‡æµé‡ç›‘æ§æ–¹å¼å°æ€ã€‚<br>è‡ªå®šä¹‰åŠ å¯†æ–¹å¼å’Œå¯†é’¥ã€‚å› ä¸ºåŠ å¯†ä¸»è¦ä¸»è¦æ˜¯é˜²æ­¢è¢«æ£€æµ‹ï¼Œæ‰€ä»¥è¦é€‰æ‹©å®‰å…¨ç³»æ•°é«˜çš„åŠ å¯†æ–¹å¼ã€‚ä¹‹å‰RC4ä¼šå¾ˆå®¹æ˜“è¢«ç ´è§£ï¼Œè€Œå¯¼è‡´è¢«å°æ€ã€‚æ‰€ä»¥ç°åœ¨æ¨èä½¿ç”¨AESåŠ å¯†ã€‚è€Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è‡ªå®šä¹‰å¯†é’¥ï¼Œæ³„éœ²çš„é£é™©ç›¸å¯¹è¾ƒå°ã€‚<br>æ‰€ä»¥å¦‚æœæ˜¯è‡ªå·±æ­å»ºçš„Shadosocksè¢«å°çš„æ¦‚ç‡å¾ˆå°ï¼Œä½†æ˜¯å¦‚æœæ˜¯ç¬¬ä¸‰æ–¹çš„Shadeowsocksï¼Œå¯†ç æ˜¯serverå®šçš„ï¼Œä½ çš„æ•°æ®å¾ˆå¯èƒ½é­å—åˆ°ä¸­é—´äººæ”»å‡»ã€‚<br><a name="-5"></a></p><h1 id="å¼€å·¥"><a href="#å¼€å·¥" class="headerlink" title="å¼€å·¥"></a>å¼€å·¥</h1><p><a name="vps"></a></p><h2 id="è´­ä¹°vps"><a href="#è´­ä¹°vps" class="headerlink" title="è´­ä¹°vps"></a>è´­ä¹°vps</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦è´­ä¹°ä¸€å°å¢ƒå¤–çš„æœåŠ¡å™¨ï¼Œæ¥ç€æˆ‘ä»¬åœ¨è¿™å°äº‘æœåŠ¡å™¨é‡Œé¢å®‰è£…ä»£ç†æœåŠ¡ï¼Œé‚£ä¹ˆä»¥åæˆ‘ä»¬ä¸Šç½‘çš„æ—¶å€™å°±å¯ä»¥é€šè¿‡å®ƒæ¥ä¸­è½¬ï¼Œè½»æ¾ç•…å¿«çš„ç•…æ¸¸å…¨ç½‘äº†ã€‚<br>è´­ä¹°VPS,æˆ‘é€‰æ‹©äº†<a href="https://www.vultr.com/" target="_blank" rel="external nofollow noopener noreferrer">vultr</a>ï¼Œå¤§å®¶ç”¨è¿‡éƒ½è¯´å¥½ï¼Œè´­ä¹°çš„è¿‡ç¨‹ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚<br><br><br>ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©ç¦»ä¸­å›½è¾ƒè¿‘å›½å®¶çš„æœåŠ¡å™¨ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585400540784-be727007-a613-4b5b-a3d5-9b5fbf9734a7.png#align=left&display=inline&height=1468&name=step1.png&originHeight=1468&originWidth=3066&size=659813&status=done&style=none&width=3066" alt="step1.png"><br><br><br><br><br>ç¬¬äºŒæ­¥ï¼šé€‰æ‹©æœåŠ¡å™¨é…ç½®å’Œç³»ç»Ÿ<br><br><br>è¿™é‡Œï¼Œç³»ç»Ÿé€‰æ‹©çš„æ˜¯CentOS 7,é…ç½®çš„è¯ï¼Œå¦‚æœåªæ˜¯è‡ªå·±æµè§ˆç½‘é¡µçš„è¯ï¼Œé€‰æ‹©æœ€ä½é…ç½®å°±å¥½ã€‚å…¶ä»–çš„é€‰é¡¹å¯ä»¥ç•¥è¿‡ã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585400556831-e2446e46-8c7e-4292-97a8-b89e6d983c9c.png#align=left&display=inline&height=1594&name=step2.png&originHeight=1594&originWidth=2792&size=669959&status=done&style=none&width=2792" alt="step2.png"><br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585400235703-e6afdea2-828f-42a0-a955-67960c8710bc.png#align=left&display=inline&height=1812&originHeight=1812&originWidth=2600&size=0&status=done&style=none&width=2600" alt><br><br><br>ç¬¬ä¸‰æ­¥ï¼šæ”¯ä»˜å’Œéƒ¨ç½²<br><br><br>æ”¯ä»˜å¯ä»¥é€‰æ‹©æ”¯ä»˜å®æ”¯ä»˜ï¼Œéå¸¸æ–¹ä¾¿ã€‚è´­ä¹°æˆåŠŸåï¼Œç‚¹å‡»Serverä¸­çš„â€œ+â€å·ï¼Œæ¥éƒ¨ç½²ä½ åˆšåˆšé€‰æ‹©çš„æœåŠ¡å™¨ã€‚<br>ç¬¬å››æ­¥ï¼šç™»é™†æœåŠ¡å™¨<br><br><br>æŸ¥çœ‹æœåŠ¡å™¨è¯¦æƒ… Server Details,æ ¹æ®æä¾›çš„æœåŠ¡å™¨ä¿¡æ¯ï¼Œç™»é™†æœåŠ¡å™¨ã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585400235150-95a87ca7-8392-404e-a5d9-c4a606b8ae7e.png#align=left&display=inline&height=1166&originHeight=1166&originWidth=2728&size=0&status=done&style=none&width=2728" alt><br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585400235639-e36e0afa-200d-49ad-a324-350004d08d09.png#align=left&display=inline&height=1232&originHeight=1232&originWidth=2612&size=0&status=done&style=none&width=2612" alt><br><br><br>æˆ‘æ˜¯ä½¿ç”¨Macæœ¬èº«ç»ˆç«¯sshåˆ°æœåŠ¡å™¨ä¸Šçš„ï¼Œå› ä¸ºMacä¸Šå¤šæ•°çš„SSHå®¢æˆ·ç«¯è¦ä¹ˆæ”¶è´¹ï¼Œè¦ä¹ˆä¸å¥½ç”¨ï¼Œè¦ä¹ˆå®‰è£…è¿‡ç¨‹éå¸¸ç¹çã€‚<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -p <span class="number">22</span> root@ip</span><br></pre></td></tr></table></figure><p><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585400235316-408c45f7-df95-4c8c-9428-9f476c6c7190.png#align=left&display=inline&height=244&originHeight=244&originWidth=1304&size=0&status=done&style=none&width=1304" alt><br><a name="shadowsocks"></a></p><h2 id="æ­å»ºshadowsocksæœåŠ¡å™¨"><a href="#æ­å»ºshadowsocksæœåŠ¡å™¨" class="headerlink" title="æ­å»ºshadowsocksæœåŠ¡å™¨"></a>æ­å»ºshadowsocksæœåŠ¡å™¨</h2><p>è¿æ¥åˆ°ä½ çš„ vultr æœåŠ¡å™¨ä¹‹åï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨å‡ ä¸ªå‘½ä»¤è®©ä½ å¿«é€Ÿæ­å»ºä¸€ä¸ªå±äºè‡ªå·±çš„ ss æœåŠ¡å™¨ï¼š<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install wget</span><br></pre></td></tr></table></figure><p><br>æ¥ç€æ‰§è¡Œå®‰è£…shadowsocksï¼š<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget â€“no-check-certificate -O shadowsocks.sh https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.sh</span><br></pre></td></tr></table></figure><p><br>è·å– <a href="http://shadowsocks.sh/" target="_blank" rel="external nofollow noopener noreferrer">shadowsocks.sh</a> è¯»å–æƒé™ï¼š<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x shadowsocks.sh</span><br></pre></td></tr></table></figure><p><br>è®¾ç½®ä½ çš„ ss å¯†ç å’Œç«¯å£å·ï¼š<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./shadowsocks.sh <span class="number">2</span>&gt;&amp;<span class="number">1</span> | tee shadowsocks.log</span><br></pre></td></tr></table></figure><p><br>æ¥ä¸‹æ¥åå°±å¯ä»¥è®¾ç½®å¯†ç å’Œç«¯å£å·äº†<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585400236071-267db22c-ea03-4f8b-969d-86ae5efc4d68.png#align=left&display=inline&height=306&originHeight=306&originWidth=1086&size=0&status=done&style=none&width=1086" alt><br><br><br>å¯†ç å’Œç«¯å£å·å¯ä»¥ä½¿ç”¨é»˜è®¤çš„ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é‡æ–°è¾“å…¥æ–°çš„ã€‚<br>é€‰æ‹©åŠ å¯†æ–¹å¼<br><br><br>è®¾ç½®å®Œå¯†ç å’Œç«¯å£å·ä¹‹åï¼Œæˆ‘ä»¬é€‰æ‹©åŠ å¯†æ–¹å¼ï¼Œè¿™é‡Œé€‰æ‹© 7 ï¼Œä½¿ç”¨aes-256-cfbçš„åŠ å¯†æ¨¡å¼<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585400235435-525e1564-eb61-47e0-b9b1-a28683979702.png#align=left&display=inline&height=684&originHeight=684&originWidth=914&size=0&status=done&style=none&width=914" alt><br><br><br>æ¥ç€æŒ‰ä»»æ„é”®è¿›è¡Œå®‰è£…ã€‚<br>å®‰è£…sså®Œæˆå<br><br><br>ä¼šç»™ä½ æ˜¾ç¤ºä½ éœ€è¦è¿æ¥ vpn çš„ä¿¡æ¯ï¼š<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585400239145-4d70810e-bc73-4cfa-bc8c-4da35e3e0dcf.png#align=left&display=inline&height=464&originHeight=464&originWidth=1186&size=0&status=done&style=none&width=1186" alt><br>æå®šï¼Œå°†è¿™äº›ä¿¡æ¯ä¿å­˜èµ·æ¥ï¼Œé‚£ä¹ˆè¿™æ—¶å€™ä½ å°±å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥ç§‘å­¦ä¸Šç½‘å•¦ã€‚<br><a name="bbr"></a></p><h2 id="ä½¿ç”¨BBRåŠ é€Ÿä¸Šç½‘"><a href="#ä½¿ç”¨BBRåŠ é€Ÿä¸Šç½‘" class="headerlink" title="ä½¿ç”¨BBRåŠ é€Ÿä¸Šç½‘"></a>ä½¿ç”¨BBRåŠ é€Ÿä¸Šç½‘</h2><p>å®‰è£… BBR<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh</span><br></pre></td></tr></table></figure><p><br>è·å–è¯»å†™æƒé™<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x bbr.sh</span><br></pre></td></tr></table></figure><p><br>å¯åŠ¨BBRå®‰è£…<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bbr.sh</span><br></pre></td></tr></table></figure><p><br>æ¥ç€æŒ‰ä»»æ„é”®ï¼Œå¼€å§‹å®‰è£…ï¼Œåç­‰ä¸€ä¼šã€‚å®‰è£…å®Œæˆä¸€ä¼šä¹‹åå®ƒä¼šæç¤ºæˆ‘ä»¬æ˜¯å¦é‡æ–°å¯åŠ¨vpsï¼Œæˆ‘ä»¬è¾“å…¥ y ç¡®å®šé‡å¯æœåŠ¡å™¨ã€‚<br>é‡æ–°å¯åŠ¨ä¹‹åï¼Œè¾“å…¥ï¼š<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep bbr</span><br></pre></td></tr></table></figure><p><br>å¦‚æœçœ‹åˆ° tcp_bbr å°±è¯´æ˜ BBR å·²ç»å¯åŠ¨äº†ã€‚<br><a name="-6"></a></p><h2 id="å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥"><a href="#å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥" class="headerlink" title="å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥"></a>å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥</h2><p><a name="windowsshadowsocks"></a></p><h3 id="windowsä½¿ç”¨Shadowsocks"><a href="#windowsä½¿ç”¨Shadowsocks" class="headerlink" title="windowsä½¿ç”¨Shadowsocks"></a>windowsä½¿ç”¨Shadowsocks</h3><p>windowsç‚¹å‡»ä¸‹è½½ï¼š<a href="https://pan.baidu.com/s/19m0AfTkPDSRj0bfYrGpbIg" target="_blank" rel="external nofollow noopener noreferrer">Shadowsocks windowså®¢æˆ·ç«¯</a><br>æ‰“å¼€ Shadowsocks å®¢æˆ·ç«¯ï¼Œè¾“å…¥ipåœ°å€ï¼Œå¯†ç ï¼Œç«¯å£ï¼Œå’ŒåŠ å¯†æ–¹å¼ã€‚æ¥ç€ç‚¹å‡»ç¡®å®šï¼Œå³ä¸‹è§’ä¼šæœ‰ä¸ªå°é£æœºæŒ‰é’®ï¼Œå³é”®â€“&gt;å¯åŠ¨ä»£ç†ã€‚<br><a name="androidshadowsocks"></a></p><h3 id="Androidä½¿ç”¨Shadowsocks"><a href="#Androidä½¿ç”¨Shadowsocks" class="headerlink" title="Androidä½¿ç”¨Shadowsocks"></a>Androidä½¿ç”¨Shadowsocks</h3><p>Androidç‚¹å‡»ä¸‹è½½ï¼š<a href="https://pan.baidu.com/s/1coAkZn-GuYHu5eIKaHECxA" target="_blank" rel="external nofollow noopener noreferrer">Shadowsocks Androidå®¢æˆ·ç«¯</a><br>æ‰“å¼€apkå®‰è£…ï¼Œæ¥ç€æ‰“å¼€APPï¼Œè¾“å…¥ipåœ°å€ï¼Œå¯†ç ï¼Œç«¯å£ï¼Œå’ŒåŠ å¯†æ–¹å¼ã€‚å³å¯ç§‘å­¦ä¸Šç½‘ã€‚<br><a name="iphoneshadowsocks"></a></p><h3 id="iPhoneä½¿ç”¨Shadowsocks"><a href="#iPhoneä½¿ç”¨Shadowsocks" class="headerlink" title="iPhoneä½¿ç”¨Shadowsocks"></a>iPhoneä½¿ç”¨Shadowsocks</h3><p>iPhoneè¦ä¸‹è½½çš„appéœ€è¦åœ¨appstoreä¸‹è½½ï¼Œä½†æ˜¯éœ€è¦ç”¨ç¾åŒºè´¦å·æ‰èƒ½ä¸‹è½½ï¼Œè€Œä¸”è¿™ä¸ªAPPéœ€è¦é’±ã€‚åœ¨è¿™é‡Œæä¾›ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå°±æ˜¯å¯ä»¥å†æ­å»ºä¸€ä¸ª<a href="https://wistbean.github.io/ipsec,l2tp_vpn.html#%E4%BD%BF%E7%94%A8-IPsec-L2TP-%E8%84%9A%E6%9C%AC%E6%90%AD%E5%BB%BA" target="_blank" rel="external nofollow noopener noreferrer">IPsec/L2TP</a> VPN,ä¸“é—¨ç»™ä½ çš„iPhoneä½¿ç”¨ã€‚<br><a name="mac"></a></p><h3 id="Macé…ç½®"><a href="#Macé…ç½®" class="headerlink" title="Macé…ç½®"></a>Macé…ç½®</h3><p>ç”¨çš„æ˜¯Macç”µè„‘ï¼Œæ‰€ä»¥ç‚¹å‡»ç›¸å…³é“¾æ¥ã€‚ä¸œè¥¿éƒ½æŒ‚åœ¨githubä¸Šï¼Œä¸‹è½½å¯¹åº”çš„zipæ–‡ä»¶ï¼Œä¸‹è½½å®Œæˆåå®‰è£…å¹¶è¿è¡Œèµ·æ¥ã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585400235178-7ccd25cd-8b34-4103-8cc8-204e84672cfe.png#align=left&display=inline&height=748&originHeight=748&originWidth=1302&size=0&status=done&style=none&width=1302" alt><br><br><br>ç‚¹å‡»å›¾æ ‡ï¼Œè¿›å…¥ æœåŠ¡å™¨è®¾ç½®<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585400239120-45698c54-ac3b-48b9-9c4d-9f3537938f87.png#align=left&display=inline&height=926&originHeight=926&originWidth=1302&size=0&status=done&style=none&width=1302" alt><br><br><br>ä¸»è¦æœ‰å››ä¸ªåœ°æ–¹è¦å¡«ï¼ŒæœåŠ¡å™¨çš„åœ°å€ï¼Œç«¯å£å·ï¼ŒåŠ å¯†æ–¹æ³•ï¼Œå¯†ç ã€‚æœåŠ¡å™¨åœ°å€å³ä¸ºä¹‹å‰ Main controlsé€‰é¡¹ä¸­çš„IPåœ°å€ã€‚ç«¯å£å·ã€åŠ å¯†æ–¹æ³•ã€å¯†ç å¿…é¡»ä¸ä¹‹å‰ Shadowsocks Server ä¸­çš„ä¿¡æ¯ä¸€ä¸€åŒ¹é…ï¼Œå¦åˆ™ä¼šè¿æ¥å¤±è´¥ã€‚<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1585400235629-2861fc8f-5bfc-4610-993f-49064774e693.png#align=left&display=inline&height=1156&originHeight=1156&originWidth=1292&size=0&status=done&style=none&width=1292" alt><br><br><br>è®¾ç½®å®Œæˆåç‚¹å‡»ç¡®å®šï¼Œç„¶åæœåŠ¡å™¨é€‰æ‹©è¿™ä¸ªé…ç½®ï¼Œé»˜è®¤é€‰ä¸­PACè‡ªåŠ¨æ¨¡å¼ï¼Œç¡®ä¿ShadowsocksçŠ¶æ€ä¸ºOnï¼Œè¿™æ—¶å€™æ‰“å¼€è°·æ­Œè¯•è¯•~<br>æ¥ç€å°±å¯ä»¥ä¸Šå¤–ç½‘äº† ğŸ˜‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;&lt;a name=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/p&gt;&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=
      
    
    </summary>
    
    
      <category term="å·¥å…·" scheme="cpeixin.cn/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="shadowsock" scheme="cpeixin.cn/tags/shadowsock/"/>
    
  </entry>
  
  <entry>
    <title>Flink apply()&amp;process() è®²è§£</title>
    <link href="cpeixin.cn/2019/03/03/Flink-apply-process-%E8%AE%B2%E8%A7%A3/"/>
    <id>cpeixin.cn/2019/03/03/Flink-apply-process-%E8%AE%B2%E8%A7%A3/</id>
    <published>2019-03-02T17:01:15.000Z</published>
    <updated>2020-06-03T01:19:30.498Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><p>åœ¨å¤„ç†æµæ•°æ®è®¡ç®—æ—¶ï¼Œæˆ‘ä»¬åœ¨å¯¹æµæ•°æ®ä½¿ç”¨äº†keyby()å’Œwindow()åï¼Œéœ€è¦å¯¹åˆ†ç»„åçš„æ•°æ®åšåˆ†ç»„å¤„ç†ï¼Œé‚£ä¹ˆé™¤äº†å¯¹åˆ†ç»„æ•°æ®ç›´æ¥åšreduce()ï¼Œaggregate()ç­‰èšåˆæ“ä½œä¹‹å¤–ï¼Œè¿˜æœ‰å¦ä¸€ç§åœºæ™¯å°±æ˜¯å¯¹åˆ†ç»„åçš„æ•°æ®ï¼Œæ¯ä¸€ä¸ªkeyå¯¹åº”çš„Iterableåšç¨å¾®å¤æ‚ä¸€ç‚¹çš„æ•°æ®è®¡ç®—æˆ–è€…æ•°æ®çš„æ•´åˆæˆ–è€…å˜æ¢ã€‚<br><br><br>é‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨apply()æˆ–è€…process()æ¥å®ç°æ›´åº•å±‚çš„è®¡ç®—é€»è¾‘ã€‚é‚£ä¹ˆä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸¤è€…çš„æºç ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1591115550749-5e415429-c939-4be1-8ff1-b1d9a0b879b5.png#align=left&display=inline&height=1244&margin=%5Bobject%20Object%5D&name=%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202020-06-03%20%E4%B8%8A%E5%8D%8812.31.12.png&originHeight=1244&originWidth=1560&size=304238&status=done&style=none&width=1560" alt="å±å¹•å¿«ç…§ 2020-06-03 ä¸Šåˆ12.31.12.png"><br>ä»ä¸Šé¢çš„å›¾ç‰‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªæ–¹æ³•çš„æ³¨é‡Šå±…ç„¶æ˜¯ä¸€æ ·çš„ã€‚å†…éƒ¨çš„å®ç°åˆ™ä¸åŒï¼Œåˆ†åˆ«è°ƒç”¨äº†ScalaProcessWindowFunctionWrapperå’ŒScalaWindowFunctionWrapper<br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1591116264932-148b3fe5-0efa-4fb9-a84b-e6c3e96c4eb6.png#align=left&display=inline&height=818&margin=%5Bobject%20Object%5D&name=%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202020-06-03%20%E4%B8%8A%E5%8D%8812.35.04.png&originHeight=818&originWidth=1524&size=208907&status=done&style=none&width=1524" alt="å±å¹•å¿«ç…§ 2020-06-03 ä¸Šåˆ12.35.04.png"><br><br><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1591116172141-1502df20-ca88-4795-857d-bb7a192d2433.png#align=left&display=inline&height=986&margin=%5Bobject%20Object%5D&name=image.png&originHeight=986&originWidth=1430&size=240541&status=done&style=none&width=1430" alt="image.png"></p><p>æˆ‘ä»¬æ¥çœ‹ScalaProcessWindowFunctionWrapperï¼Œå†…éƒ¨å®ç°çš„processä¸­ï¼Œä¼ å…¥äº†contextä¸Šä¸‹æ–‡ï¼Œè¿˜æœ‰å…¶ä»–windowç›¸å…³æœ‰ç”¨çš„å‚æ•°ï¼Œä»åŠŸèƒ½ä¸Šæ¥è®²ï¼Œprocesså·²ç»åŒ…å«äº†applyèƒ½æä¾›çš„åŠŸèƒ½ï¼Œapply()æ˜¯æ—§ç‰ˆçš„process()ï¼Œå¹¶ä¸”æ²¡æœ‰æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯å’Œå…¶ä»–windowçš„é«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚æ¯ä¸ªçª—å£çš„keyed stateã€‚apply()å°†åœ¨æŸä¸ªæ—¶é—´è¢«å¼ƒç”¨ã€‚processç®—å­å¸¸è§çš„æœ‰ProcessFunctionå’ŒKeyedProcessFunctionä¸¤ç§è®¡ç®—çš„æ–¹å¼ï¼Œå…·ä½“çš„å®ç°å¯ä»¥çœ‹æºç ã€‚</p><p>processå’Œapplyç®—å­æœ€å¤§çš„åŒºåˆ«åœ¨äºprocesså¯ä»¥è‡ªå·±å®šæ—¶è§¦å‘è®¡ç®—çš„å®šæ—¶å™¨,åœ¨processElementæ–¹æ³•å®šä¹‰å®šæ—¶å™¨ context.timerService().registerEventTimeTimer(timestamp);<br><br><br>å½“å®šæ—¶å™¨æ—¶é—´åˆ°è¾¾ï¼Œä¼šå›è°ƒonTimer()æ–¹æ³•çš„è®¡ç®—ä»»åŠ¡æ—¶å™¨å…è®¸åº”ç”¨ç¨‹åºå¯¹processing timeå’Œevent timeçš„å˜åŒ–åšå‡ºååº”ï¼Œæ¯æ¬¡å¯¹processElement()çš„è°ƒç”¨éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªContextå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å…è®¸è®¿é—®å…ƒç´ äº‹ä»¶æ—¶é—´çš„æ—¶é—´æˆ³å’ŒTimeServerã€‚TimeServerå¯ä»¥ç”¨æ¥ä¸ºå°šæœªå‘ç”Ÿçš„event-timeæˆ–è€…processing-timeæ³¨å†Œå›è°ƒï¼Œå½“å®šæ—¶å™¨çš„æ—¶é—´åˆ°è¾¾æ—¶ï¼ŒonTimer(â€¦)æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚åœ¨è¿™ä¸ªè°ƒç”¨æœŸé—´ï¼Œæ‰€æœ‰çš„çŠ¶æ€éƒ½ä¼šé™å®šåˆ°åˆ›å»ºå®šæ—¶å™¨çš„é”®ï¼Œå¹¶å…è®¸å®šæ—¶å™¨æ“çºµé”®æ§çŠ¶æ€(keyed states)ã€‚</p><p><strong>applyç®—å­å’Œprocessç®—å­</strong><br>**<br>(1) windowæ•°æ®applyç®—å­å¯¹åº”çš„fuction<br>WindowFunction(keyed window) ä¸ AllWindowFunction(no key window)<br><br><br>(2) windowæ•°æ®processç®—å­å¯¹åº”çš„fuction<br>processç®—å­å¯ä»¥è·å–åˆ°windowçª—å£çš„Contextä¿¡æ¯ è€Œ applyç®—å­æ— æ³•è·å–åˆ°<br>ProcessWindowFunction(keyed-window) å’Œ ProcessAllWindowFunction(no keyd window)<br>keyed-window å’Œ nokeyed-window<br><br><br>(3) æ™®é€šæµæ•°æ®ï¼Œprocessç®—å­,å¯¹åº”çš„fuction<br>KeyedProcessFunctionï¼š A keyed function that processes elements of a stream. ï¼ˆå¯å®ç°å®šæ—¶ä»»åŠ¡ï¼‰<br>ProcessFunctionï¼šA function that processes elements of a stream.ï¼ˆå¯å®ç°å®šæ—¶ä»»åŠ¡ï¼‰<br><br><br><br><br>ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªå°å®ä¾‹æ¥æ¼”ç¤ºä¸¤ç§æ–¹æ³•çš„ä½¿ç”¨<br><br><br>éœ€æ±‚ï¼šæ±‚æ¯ä¸ªuserï¼Œå‘¨ä¸€è‡³å‘¨æ—¥ï¼Œæ¯å¤©æˆç»©çš„æ’åºè¯¦æƒ…<br><br><br>æ•°æ®æ ¼å¼ï¼šuser001,1,95ï¼ˆç”¨æˆ·IDï¼Œæ˜ŸæœŸå‡ ï¼Œæˆç»©ï¼‰<br><br><br>ç¨‹åºå¦‚ä¸‹ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> data_stream.function</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala.function.&#123;<span class="type">ProcessWindowFunction</span>, <span class="type">WindowFunction</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala.&#123;<span class="type">DataStream</span>, <span class="type">StreamExecutionEnvironment</span>, <span class="type">WindowedStream</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.<span class="type">Time</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.windows.<span class="type">TimeWindow</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala._</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.<span class="type">Collector</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.collection.mutable.<span class="type">ListBuffer</span></span><br><span class="line"><span class="keyword">import</span> scala.collection.parallel.immutable</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">keyby_datastream</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">UserGrade</span>(<span class="params">user_id: <span class="type">String</span>, weekday: <span class="type">String</span>, grade: <span class="type">Int</span></span>)</span></span><br><span class="line"><span class="class">  <span class="title">case</span> <span class="title">class</span> <span class="title">UserGradeList</span>(<span class="params">user_id: <span class="type">String</span>, gradeList: <span class="type">List</span>[<span class="type">Int</span>]</span>)</span></span><br><span class="line"><span class="class">  <span class="title">def</span> <span class="title">main</span>(<span class="params">args: <span class="type">Array</span>[<span class="type">String</span>]</span>)</span>: <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> env: <span class="type">StreamExecutionEnvironment</span> = <span class="type">StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> socketStream: <span class="type">DataStream</span>[<span class="type">String</span>] = env.socketTextStream(<span class="string">"localhost"</span>, <span class="number">8888</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> userGradeStream: <span class="type">DataStream</span>[<span class="type">UserGrade</span>] = socketStream.map((data: <span class="type">String</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">val</span> user_array: <span class="type">Array</span>[<span class="type">String</span>] = data.split(<span class="string">","</span>)</span><br><span class="line">      <span class="type">UserGrade</span>(user_array(<span class="number">0</span>), user_array(<span class="number">1</span>), user_array(<span class="number">2</span>).toInt)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> keyWondowStream: <span class="type">WindowedStream</span>[<span class="type">UserGrade</span>, <span class="type">String</span>, <span class="type">TimeWindow</span>] = userGradeStream.keyBy((_: <span class="type">UserGrade</span>).user_id)</span><br><span class="line">      .timeWindow(<span class="type">Time</span>.seconds(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    Base interface for functions that are evaluated over keyed (grouped) windows.</span></span><br><span class="line">    <span class="comment">//    trait WindowFunction[IN, OUT, KEY, W &lt;: Window] extends Function with Serializable</span></span><br><span class="line"><span class="comment">//    val resultStream: DataStream[(String, List[Int])] = keyWondowStream.apply(new WindowFunction[UserGrade, (String, List[Int]), String, TimeWindow] &#123;</span></span><br><span class="line"><span class="comment">//      override def apply(key: String, window: TimeWindow, input: Iterable[UserGrade], out: Collector[(String, List[Int])]): Unit = &#123;</span></span><br><span class="line"><span class="comment">//        var gradeList: ListBuffer[Int] = ListBuffer[Int]()</span></span><br><span class="line"><span class="comment">//        for (data &lt;- input) &#123;</span></span><br><span class="line"><span class="comment">//          gradeList += data.grade</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//        out.collect((key,gradeList.toList.sorted))</span></span><br><span class="line"><span class="comment">//      &#125;</span></span><br><span class="line"><span class="comment">//    &#125;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        val resultStream: DataStream[String] = keyWondowStream.apply(new WindowFunction[UserGrade, String, String, TimeWindow] &#123;</span></span><br><span class="line"><span class="comment">//          override def apply(key: String, window: TimeWindow, input: Iterable[UserGrade], out: Collector[String]): Unit = &#123;</span></span><br><span class="line"><span class="comment">//            var gradeList: ListBuffer[Int] = ListBuffer[Int]()</span></span><br><span class="line"><span class="comment">//            for (data &lt;- input)&#123;</span></span><br><span class="line"><span class="comment">//              gradeList+=data.grade</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//            val result: String = key + "===" + gradeList.toList.sorted.toString</span></span><br><span class="line"><span class="comment">//            out.collect(result)</span></span><br><span class="line"><span class="comment">//          &#125;</span></span><br><span class="line"><span class="comment">//        &#125;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> resultStream: <span class="type">DataStream</span>[<span class="type">UserGradeList</span>] = keyWondowStream.process(<span class="keyword">new</span> <span class="type">ProcessWindowFunction</span>[<span class="type">UserGrade</span>, <span class="type">UserGradeList</span>, <span class="type">String</span>, <span class="type">TimeWindow</span>]&#123;</span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">process</span></span>(key: <span class="type">String</span>, context: <span class="type">Context</span>, elements: <span class="type">Iterable</span>[<span class="type">UserGrade</span>], out: <span class="type">Collector</span>[<span class="type">UserGradeList</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">                <span class="keyword">var</span> gradeList: <span class="type">ListBuffer</span>[<span class="type">Int</span>] = <span class="type">ListBuffer</span>[<span class="type">Int</span>]()</span><br><span class="line">                <span class="keyword">for</span> (data &lt;- elements) &#123;</span><br><span class="line">                  gradeList += data.grade</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                out.collect(<span class="type">UserGradeList</span>(key,gradeList.toList.sorted))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    resultStream.print(<span class="string">"==="</span>)</span><br><span class="line">    env.execute(<span class="string">"process apply function"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br>æ§åˆ¶å°è¾“å…¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">user001,1,95</span><br><span class="line">user001,2,200</span><br><span class="line">user001,3,97</span><br><span class="line">user001,4,189</span><br><span class="line">user001,5,99</span><br><span class="line">user001,6,100</span><br><span class="line">user001,7,40</span><br><span class="line">user002,1,1</span><br><span class="line">user002,2,5</span><br><span class="line">user002,3,2</span><br><span class="line">user002,4,88</span><br><span class="line">user002,5,4</span><br><span class="line">user002,6,33</span><br><span class="line">user002,7,22</span><br></pre></td></tr></table></figure><p><br>ç»“æœæ‰“å°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;:3&gt; UserGradeList(user001,List(40, 95, 97, 99, 100, 189, 200))</span><br><span class="line">&#x3D;&#x3D;&#x3D;:2&gt; UserGradeList(user002,List(1, 2, 4, 5, 22, 33, 88))</span><br></pre></td></tr></table></figure><p><br>è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œæˆ‘åœ¨ç¨‹åºä¸­ä½¿ç”¨äº†scalaå¯å˜é›†åˆListBufferï¼Œç¨‹åºæ‰§è¡Œåï¼Œåˆ™æŠ¥é”™<strong>Caused by: java.lang.NumberFormatException: Not a version: 9</strong><br><strong><br></strong>åæ¥Googleå¾—åˆ°ï¼Œè¿™æ˜¯Flinkç‰ˆæœ¬å’ŒScalaç‰ˆæœ¬ä¹‹é—´å¼•èµ·çš„é”™è¯¯ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼ŒåŸæ¥çš„ç‰ˆæœ¬å¯¹åº”æ˜¯Flink 1.10å’ŒScala 2.11.8ï¼Œåæ¥Scalaç‰ˆæœ¬ä¿®æ”¹ä¸º2.11.12ï¼Œè¿™ä¸ªé—®é¢˜å°±è§£å†³äº†ã€‚**<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;åœ¨å¤„ç†æµæ•°æ®è®¡ç®—æ—¶ï¼Œæˆ‘ä»¬åœ¨å¯¹æµæ•°æ®ä½¿ç”¨äº†keyby()å’Œwindow()åï¼Œéœ€è¦å¯¹åˆ†ç»„åçš„æ•°æ®åšåˆ†ç»„å¤„ç†ï¼Œé‚£ä¹ˆé™¤äº†å¯¹åˆ†ç»„æ•°æ®ç›´æ¥åšreduce(
      
    
    </summary>
    
    
      <category term="å¤§æ•°æ®" scheme="cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="Flink" scheme="cpeixin.cn/tags/Flink/"/>
    
  </entry>
  
  <entry>
    <title>Structured Streaming é‡æ¸©</title>
    <link href="cpeixin.cn/2019/02/10/Structured-Streaming-%E9%87%8D%E6%B8%A9/"/>
    <id>cpeixin.cn/2019/02/10/Structured-Streaming-%E9%87%8D%E6%B8%A9/</id>
    <published>2019-02-10T08:03:44.000Z</published>
    <updated>2020-05-09T04:09:47.215Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --><p><a name="N4GjR"></a></p><h2 id="æ€»è§ˆ"><a href="#æ€»è§ˆ" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h2><p>_<br>Structured Streaming åˆ™æ˜¯åœ¨ Spark 2.0 åŠ å…¥çš„ç»è¿‡é‡æ–°è®¾è®¡çš„å…¨æ–°æµå¼å¼•æ“ã€‚å®ƒçš„æ¨¡å‹ååˆ†ç®€æ´ï¼Œæ˜“äºç†è§£ã€‚ä¸€ä¸ªæµçš„æ•°æ®æºä»é€»è¾‘ä¸Šæ¥è¯´å°±æ˜¯ä¸€ä¸ªä¸æ–­å¢é•¿çš„åŠ¨æ€è¡¨æ ¼ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ–°æ•°æ®è¢«æŒç»­ä¸æ–­åœ°æ·»åŠ åˆ°è¡¨æ ¼çš„æœ«å°¾ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨ Dataset/DataFrame æˆ–è€… SQL æ¥å¯¹è¿™ä¸ªåŠ¨æ€æ•°æ®æºè¿›è¡Œå®æ—¶æŸ¥è¯¢ã€‚æ¯æ¬¡æŸ¥è¯¢åœ¨é€»è¾‘ä¸Šå°±æ˜¯å¯¹å½“å‰çš„è¡¨æ ¼å†…å®¹æ‰§è¡Œä¸€æ¬¡ SQL æŸ¥è¯¢ã€‚å¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢åˆ™æ˜¯ç”±ç”¨æˆ·é€šè¿‡è§¦å‘å™¨ï¼ˆTriggerï¼‰æ¥è®¾å®šã€‚ç”¨æˆ·æ—¢å¯ä»¥è®¾å®šå®šæœŸæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥è®©æŸ¥è¯¢å°½å¯èƒ½å¿«åœ°æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°å®æ—¶çš„æ•ˆæœã€‚æœ€åï¼Œç³»ç»Ÿé€šè¿‡ checkpointing å’Œ Write-Ahead Logsæ¥ç¡®ä¿ç«¯åˆ°ç«¯çš„ä¸€æ¬¡å®¹é”™ä¿è¯ã€‚ä¸€ä¸ªæµçš„è¾“å‡ºæœ‰å¤šç§æ¨¡å¼ï¼Œæ—¢å¯ä»¥æ˜¯åŸºäºæ•´ä¸ªè¾“å…¥æ‰§è¡ŒæŸ¥è¯¢åçš„å®Œæ•´ç»“æœï¼Œä¹Ÿå¯ä»¥é€‰æ‹©åªè¾“å‡ºä¸ä¸Šæ¬¡æŸ¥è¯¢ç›¸æ¯”çš„å·®å¼‚ï¼Œæˆ–è€…å°±æ˜¯ç®€å•åœ°è¿½åŠ æœ€æ–°çš„ç»“æœã€‚è¿™ä¸ªæ¨¡å‹å¯¹äºç†Ÿæ‚‰ SQL çš„ç”¨æˆ·æ¥è¯´å¾ˆå®¹æ˜“æŒæ¡ï¼Œå¯¹æµçš„æŸ¥è¯¢è·ŸæŸ¥è¯¢ä¸€ä¸ªè¡¨æ ¼å‡ ä¹å®Œå…¨ä¸€æ ·ã€‚<br><br><br>åœ¨å†…éƒ¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç»“æ„åŒ–æµæŸ¥è¯¢æ˜¯ä½¿ç”¨_å¾®æ‰¹é‡å¤„ç†_å¼•æ“_å¤„ç†çš„_ï¼Œè¯¥å¼•æ“å°†æ•°æ®æµä½œä¸ºä¸€ç³»åˆ—å°æ‰¹é‡ä½œä¸šè¿›è¡Œå¤„ç†ï¼Œä»è€Œå®ç°äº†ä½è‡³100æ¯«ç§’çš„ç«¯åˆ°ç«¯å»¶è¿Ÿä»¥åŠ exactly-onceçš„å®¹é”™ä¿è¯ã€‚ä½†æ˜¯ï¼Œè‡ªSpark 2.3èµ·ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ç§ç§°ä¸ºâ€œ <strong>è¿ç»­å¤„ç†â€</strong>çš„æ–°ä½å»¶è¿Ÿå¤„ç†æ¨¡å¼ï¼Œè¯¥æ¨¡å¼å¯ä»¥å®ç°ä¸€æ¬¡æœ€å°‘ä¿è¯çš„ä½è‡³1æ¯«ç§’çš„ç«¯åˆ°ç«¯å»¶è¿Ÿã€‚åœ¨ä¸æ›´æ”¹æŸ¥è¯¢ä¸­çš„Dataset / DataFrameæ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ‚¨å°†èƒ½å¤Ÿæ ¹æ®åº”ç”¨ç¨‹åºéœ€æ±‚é€‰æ‹©æ¨¡å¼<br><br><br></p><p><a name="YF5tx"></a></p><h2 id="Structured-Streaming-æ˜¯å¯¹-Spark-Streaming-çš„æ”¹è¿›ä¹ˆï¼Ÿ"><a href="#Structured-Streaming-æ˜¯å¯¹-Spark-Streaming-çš„æ”¹è¿›ä¹ˆï¼Ÿ" class="headerlink" title="Structured Streaming æ˜¯å¯¹ Spark Streaming çš„æ”¹è¿›ä¹ˆï¼Ÿ"></a>Structured Streaming æ˜¯å¯¹ Spark Streaming çš„æ”¹è¿›ä¹ˆï¼Ÿ</h2><p><br>Structured Streaming å¹¶ä¸æ˜¯å¯¹ Spark Streaming çš„ç®€å•æ”¹è¿›ï¼Œè€Œæ˜¯æˆ‘ä»¬å¸å–äº†è¿‡å»å‡ å¹´åœ¨å¼€å‘ Spark SQL å’Œ Spark Streaming è¿‡ç¨‹ä¸­çš„ç»éªŒæ•™è®­ï¼Œä»¥åŠ Spark ç¤¾åŒºå’Œ Databricks ä¼—å¤šå®¢æˆ·çš„åé¦ˆï¼Œé‡æ–°å¼€å‘çš„å…¨æ–°æµå¼å¼•æ“ï¼Œè‡´åŠ›äºä¸ºæ‰¹å¤„ç†å’Œæµå¤„ç†æä¾›ç»Ÿä¸€çš„é«˜æ€§èƒ½ APIã€‚åŒæ—¶ï¼Œåœ¨è¿™ä¸ªæ–°çš„å¼•æ“ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå®¹æ˜“å®ç°ä¹‹å‰åœ¨ Spark Streaming ä¸­å¾ˆéš¾å®ç°çš„ä¸€äº›åŠŸèƒ½ï¼Œ<strong>æ¯”å¦‚ Event Time çš„æ”¯æŒ</strong>ï¼ŒStream-Stream Joinï¼Œæ¯«ç§’çº§å»¶è¿Ÿ<br><br><br>ç±»ä¼¼äº Dataset/DataFrame ä»£æ›¿ Spark Core çš„ RDD æˆä¸ºä¸º Spark ç”¨æˆ·ç¼–å†™æ‰¹å¤„ç†ç¨‹åºçš„é¦–é€‰ï¼ŒDataset/DataFrame ä¹Ÿå°†æ›¿ä»£ Spark Streaming çš„ DStreamï¼Œæˆä¸ºç¼–å†™æµå¤„ç†ç¨‹åºçš„é¦–é€‰ã€‚<br></p><p><a name="HuvDe"></a></p><h2 id="Structured-Streaming-çš„-Spark-æœ‰ä»€ä¹ˆä¼˜åŠ£åŠ¿å—ï¼Ÿ"><a href="#Structured-Streaming-çš„-Spark-æœ‰ä»€ä¹ˆä¼˜åŠ£åŠ¿å—ï¼Ÿ" class="headerlink" title="Structured Streaming çš„ Spark æœ‰ä»€ä¹ˆä¼˜åŠ£åŠ¿å—ï¼Ÿ"></a>Structured Streaming çš„ Spark æœ‰ä»€ä¹ˆä¼˜åŠ£åŠ¿å—ï¼Ÿ</h2><ul><li>ç®€æ´çš„æ¨¡å‹ã€‚Structured Streaming çš„æ¨¡å‹å¾ˆç®€æ´ï¼Œæ˜“äºç†è§£ã€‚ç”¨æˆ·å¯ä»¥ç›´æ¥æŠŠä¸€ä¸ªæµæƒ³è±¡æˆæ˜¯æ— é™å¢é•¿çš„è¡¨æ ¼ã€‚</li><li>ä¸€è‡´çš„ APIã€‚ç”±äºå’Œ Spark SQL å…±ç”¨å¤§éƒ¨åˆ† APIï¼Œå¯¹ Spaprk SQL ç†Ÿæ‚‰çš„ç”¨æˆ·å¾ˆå®¹æ˜“ä¸Šæ‰‹ï¼Œä»£ç ä¹Ÿååˆ†ç®€æ´ã€‚åŒæ—¶æ‰¹å¤„ç†å’Œæµå¤„ç†ç¨‹åºè¿˜å¯ä»¥å…±ç”¨ä»£ç ï¼Œä¸éœ€è¦å¼€å‘ä¸¤å¥—ä¸åŒçš„ä»£ç ï¼Œæ˜¾è‘—æé«˜äº†å¼€å‘æ•ˆç‡ã€‚</li><li>å“è¶Šçš„æ€§èƒ½ã€‚Structured Streaming åœ¨ä¸ Spark SQL å…±ç”¨ API çš„åŒæ—¶ï¼Œä¹Ÿç›´æ¥ä½¿ç”¨äº† Spark SQL çš„ Catalyst ä¼˜åŒ–å™¨å’Œ Tungstenï¼Œæ•°æ®å¤„ç†æ€§èƒ½ååˆ†å‡ºè‰²ã€‚æ­¤å¤–ï¼ŒStructured Streaming è¿˜å¯ä»¥ç›´æ¥ä»æœªæ¥ Spark SQL çš„å„ç§æ€§èƒ½ä¼˜åŒ–ä¸­å—ç›Šã€‚</li><li>å¤šè¯­è¨€æ”¯æŒã€‚Structured Streaming ç›´æ¥æ”¯æŒç›®å‰ Spark SQL æ”¯æŒçš„è¯­è¨€ï¼ŒåŒ…æ‹¬ Scalaï¼ŒJavaï¼ŒPythonï¼ŒR å’Œ SQLã€‚ç”¨æˆ·å¯ä»¥é€‰æ‹©è‡ªå·±å–œæ¬¢çš„è¯­è¨€è¿›è¡Œå¼€å‘ã€‚</li></ul><br><br>å‘ƒï½ï½ å…³äºStructured Streamingçš„ä»‹ç»å°±è¯´åˆ°è¿™é‡Œï¼Œå¦‚æœæƒ³çœ‹æ›´è¯¦ç»†æ›´å‡†ç¡®çš„ä»‹ç»å‘¢ï¼Œè¿˜æ˜¯ä¹–ä¹–çš„å»å®˜ç½‘å§ã€‚åœ¨2017å¹´10æœˆä»½çš„æ—¶å€™ï¼Œæ–°ç«‹é¡¹çš„ä¸€ä¸ªappç”¨æˆ·è¡Œä¸ºå®æ—¶é¡¹ç›®ï¼Œæˆ‘æœ‰æ„ä½¿ç”¨Structured Streamingï¼Œæ‰€ä»¥å°±è°ƒç ”äº†ä¸€ä¸‹ï¼Œè‡ªå·±å†™äº†ä¸€ä¸ªdemoï¼Œæˆ‘è®°å¿†é‡Œé‚£æ—¶å†™Structuredå¾ˆåˆ«æ‰­ï¼Œå°±åƒä¸€ä¸ªæ¨¡ç‰ˆä¸€æ ·ï¼Œè¾“å…¥æºå’Œè¾“å‡ºæºéƒ½è¢«è§„å®šå¥½äº†å‡½æ•°å’Œå‚æ•°ï¼Œå¹¶ä¸”åœ¨é‚£æ—¶å€™æµ‹è¯•åçš„æ—¶å€™ï¼Œä¸æ€ä¹ˆç¨³å®šï¼Œè€Œä¸”å®˜æ–¹å¹¶æ²¡æœ‰ç»™å‡ºæˆç†Ÿçš„ç‰ˆæœ¬ï¼Œå½“æ—¶æ‰€æµ‹è¯•çš„åŠŸèƒ½è¿˜éƒ½æ˜¯ alpha ç‰ˆæœ¬ï¼Œæ‰€ä»¥å½“æ—¶å°±è¿˜æ˜¯ä½¿ç”¨äº†Spark Streaming<p>ä¸è¿‡ç°åœ¨æ¥çœ‹ï¼ŒStructured Streaming è¶Šæ¥è¶Šæˆç†Ÿï¼ŒSpark Streamingæ„Ÿè§‰ä¼¼ä¹åœæ­¢äº†æ›´æ–°ã€‚Structured streamingåº”è¯¥æ˜¯Sparkæµå¤„ç†çš„æœªæ¥ï¼Œä½†æ˜¯å¾ˆéš¾æ›¿ä»£Flinkã€‚Flinkåœ¨æµå¤„ç†ä¸Šçš„å¤©ç„¶ä¼˜åŠ¿å¾ˆéš¾è¢«Sparkè¶…è¶Šã€‚<br><br><br>åœ¨è¯»å®Œäº†Structured Streamingå®˜ç½‘åï¼Œè¿˜æ˜¯äº²æ‰‹çš„å†™ä¸€äº›å®ä¾‹æ„Ÿå—ä¸€ä¸‹ï¼Œä»¥ååšæ¶æ„çš„æ—¶å€™ï¼Œå¦‚æœé€‚åˆçš„è¯ï¼Œè¿˜å¯ä»¥åŠ è¿›æ¥ã€‚</p><p><a name="9BWc2"></a></p><h2 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h2><br><a name="TJ1U5"></a> ### complete, append, update<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.streaming.<span class="type">StreamingQuery</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.&#123;<span class="type">DataFrame</span>, <span class="type">Dataset</span>, <span class="type">SparkSession</span>&#125;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.&#123;<span class="type">JSON</span>, <span class="type">JSONObject</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.&#123;<span class="type">Level</span>, <span class="type">Logger</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">structured_kafka</span> </span>&#123;</span><br><span class="line">  <span class="keyword">val</span> logger:<span class="type">Logger</span> = <span class="type">Logger</span>.getRootLogger</span><br><span class="line">  <span class="type">Logger</span>.getLogger(<span class="string">"org"</span>).setLevel(<span class="type">Level</span>.<span class="type">ERROR</span>)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">kafka_format</span>(<span class="params">date_time: <span class="type">String</span>, keyword_list: <span class="type">String</span></span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">val</span> <span class="title">spark</span></span>: <span class="type">SparkSession</span> = <span class="type">SparkSession</span></span><br><span class="line">      .builder()</span><br><span class="line">      .appName(<span class="string">"Structrued-Streaming"</span>)</span><br><span class="line">      .master(<span class="string">"local[2]"</span>)</span><br><span class="line">      .getOrCreate()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> spark.implicits._</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> kafka_df: <span class="type">DataFrame</span> = spark</span><br><span class="line">      .readStream</span><br><span class="line">      .format(<span class="string">"kafka"</span>)</span><br><span class="line">      .option(<span class="string">"kafka.bootstrap.servers"</span>, <span class="string">"localhost:9092"</span>)</span><br><span class="line">      .option(<span class="string">"subscribe"</span>, <span class="string">"weibo_keyword"</span>)</span><br><span class="line">      .option(<span class="string">"startingOffsets"</span>, <span class="string">"earliest"</span>)</span><br><span class="line">      .option(<span class="string">"includeTimestamp"</span>, value = <span class="literal">true</span>)</span><br><span class="line"><span class="comment">//      .option("endingOffsets", "latest")</span></span><br><span class="line"><span class="comment">//      .option("startingOffsets", """&#123;"topic1":&#123;"0":23,"1":-2&#125;,"topic2":&#123;"0":-2&#125;&#125;""")</span></span><br><span class="line"><span class="comment">//      .option("endingOffsets", """&#123;"topic1":&#123;"0":50,"1":-1&#125;,"topic2":&#123;"0":-1&#125;&#125;""")</span></span><br><span class="line">      .load()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> keyvalue_df: <span class="type">DataFrame</span> = kafka_df</span><br><span class="line">      .selectExpr(<span class="string">"CAST(value AS STRING)"</span>)</span><br><span class="line">      .as[<span class="type">String</span>]</span><br><span class="line">      .map((x: <span class="type">String</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">val</span> date_time: <span class="type">String</span> = <span class="type">JSON</span>.parseObject(x).getString(<span class="string">"datetime"</span>)</span><br><span class="line">        <span class="keyword">val</span> keyword_list: <span class="type">String</span> = <span class="type">JSON</span>.parseObject(x).getString(<span class="string">"keywordList"</span>)</span><br><span class="line">        (date_time, keyword_list)</span><br><span class="line">      &#125;)</span><br><span class="line">      .flatMap((x: (<span class="type">String</span>, <span class="type">String</span>)) =&gt;&#123;</span><br><span class="line">        x._2.split(<span class="string">","</span>).map((word: <span class="type">String</span>) =&gt;(x._1,word))</span><br><span class="line">      &#125;)</span><br><span class="line">      .toDF(<span class="string">"date_time"</span>, <span class="string">"keyword"</span>)</span><br><span class="line">      .groupBy(<span class="string">"keyword"</span>).count()</span><br><span class="line">      .orderBy($<span class="string">"count"</span>.desc)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> query: <span class="type">StreamingQuery</span> = keyvalue_df.writeStream</span><br><span class="line">      .outputMode(<span class="string">"complete"</span>) <span class="comment">//append</span></span><br><span class="line">      .format(<span class="string">"console"</span>)</span><br><span class="line">      .start()</span><br><span class="line"></span><br><span class="line">    query.awaitTermination()</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>å…¶ä¸­éœ€è¦æ³¨æ„ï¼š<br>_<br>_Append output mode not supported when there are streaming aggregations on streaming DataFrames/DataSets without watermark;;_<br>_<br>Sorting is not supported on streaming DataFrames/Datasets, unless it is on aggregated DataFrame/Dataset in Complete output mode;<br><br>æœªè¿›è¡Œaggregateçš„streamä¸èƒ½sort<br>_<br>_ <a name="5prwS"></a> ### windowçª—å£ _<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.<span class="type">JSON</span></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.&#123;<span class="type">Level</span>, <span class="type">Logger</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.streaming.&#123;<span class="type">StreamingQuery</span>, <span class="type">Trigger</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.&#123;<span class="type">DataFrame</span>, <span class="type">SparkSession</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions._</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">structured_kafka_window</span> </span>&#123;</span><br><span class="line">  <span class="keyword">val</span> logger:<span class="type">Logger</span> = <span class="type">Logger</span>.getRootLogger</span><br><span class="line">  <span class="type">Logger</span>.getLogger(<span class="string">"org"</span>).setLevel(<span class="type">Level</span>.<span class="type">ERROR</span>)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">kafka_format</span>(<span class="params">date_time: <span class="type">String</span>, keyword_list: <span class="type">String</span></span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">val</span> <span class="title">spark</span></span>: <span class="type">SparkSession</span> = <span class="type">SparkSession</span></span><br><span class="line">      .builder()</span><br><span class="line">      .appName(<span class="string">"Structrued-Streaming"</span>)</span><br><span class="line">      .master(<span class="string">"local[2]"</span>)</span><br><span class="line">      .getOrCreate()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> spark.implicits._</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> kafka_df: <span class="type">DataFrame</span> = spark</span><br><span class="line">      .readStream</span><br><span class="line">      .format(<span class="string">"kafka"</span>)</span><br><span class="line">      .option(<span class="string">"kafka.bootstrap.servers"</span>, <span class="string">"localhost:9092"</span>)</span><br><span class="line">      .option(<span class="string">"subscribe"</span>, <span class="string">"weibo_keyword"</span>)</span><br><span class="line">      .option(<span class="string">"startingOffsets"</span>, <span class="string">"latest"</span>)</span><br><span class="line">      .option(<span class="string">"includeTimestamp"</span>, value = <span class="literal">true</span>)</span><br><span class="line"><span class="comment">//      .option("endingOffsets", "latest")</span></span><br><span class="line"><span class="comment">//      .option("startingOffsets", """&#123;"topic1":&#123;"0":23,"1":-2&#125;,"topic2":&#123;"0":-2&#125;&#125;""")</span></span><br><span class="line"><span class="comment">//      .option("endingOffsets", """&#123;"topic1":&#123;"0":50,"1":-1&#125;,"topic2":&#123;"0":-1&#125;&#125;""")</span></span><br><span class="line">      .load()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> keyvalue_df: <span class="type">DataFrame</span> = kafka_df</span><br><span class="line">      .selectExpr(<span class="string">"CAST(value AS STRING)"</span>)</span><br><span class="line">      .as[<span class="type">String</span>]</span><br><span class="line">      .map((x: <span class="type">String</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">val</span> date_time: <span class="type">String</span> = <span class="type">JSON</span>.parseObject(x).getString(<span class="string">"datetime"</span>)</span><br><span class="line">        <span class="keyword">val</span> keyword_list: <span class="type">String</span> = <span class="type">JSON</span>.parseObject(x).getString(<span class="string">"keywordList"</span>)</span><br><span class="line">        (date_time, keyword_list)</span><br><span class="line">      &#125;)</span><br><span class="line">      .flatMap((x: (<span class="type">String</span>, <span class="type">String</span>)) =&gt;&#123;</span><br><span class="line">        x._2.split(<span class="string">","</span>).map((word: <span class="type">String</span>) =&gt;(x._1,word))</span><br><span class="line">      &#125;)</span><br><span class="line">      .toDF(<span class="string">"date_time"</span>, <span class="string">"keyword"</span>)</span><br><span class="line">      .groupBy(window($<span class="string">"date_time"</span>, <span class="string">"5 minutes"</span>, <span class="string">"1 minutes"</span>),$<span class="string">"keyword"</span>)</span><br><span class="line">      .count()</span><br><span class="line">      .orderBy(<span class="string">"window"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> query: <span class="type">StreamingQuery</span> = keyvalue_df.writeStream</span><br><span class="line">      .outputMode(<span class="string">"complete"</span>) <span class="comment">//append</span></span><br><span class="line">      .format(<span class="string">"console"</span>)</span><br><span class="line">      .option(<span class="string">"truncate"</span>, <span class="string">"false"</span>)</span><br><span class="line">      .trigger(<span class="type">Trigger</span>.<span class="type">ProcessingTime</span>(<span class="string">"5 seconds"</span>))</span><br><span class="line">      .start()</span><br><span class="line">    query.awaitTermination()</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>è¿™é‡Œå…³äºwindowçª—å£çš„åˆ’åˆ†ï¼Œæˆ‘å»ºè®®å¤§å®¶å¥½å¥½çš„ç ”è¯»ä¸€ä¸‹æºç ï¼š<br>**ä½ç½®ï¼špackage **org.apache.spark.sql.catalyst.analysis<br>![å±å¹•å¿«ç…§ 2020-05-08 ä¸‹åˆ11.29.50.png](https://cdn.nlark.com/yuque/0/2020/png/1072113/1588952005543-007c1291-12fd-4148-a625-587b1a6149f3.png#align=left&display=inline&height=1694&margin=%5Bobject%20Object%5D&name=%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202020-05-08%20%E4%B8%8B%E5%8D%8811.29.50.png&originHeight=1694&originWidth=1936&size=488433&status=done&style=none&width=1936)<br><p><a name="cuL0b"></a></p><h3 id="Watermark"><a href="#Watermark" class="headerlink" title="Watermark"></a>Watermark</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºäºevent-timeçš„windowï¼ŒwordsåŒ…å«timestampå’Œwordä¸¤åˆ—</span></span><br><span class="line">word</span><br><span class="line">  .withWatermark(<span class="string">"timestamp"</span>, <span class="string">"30 minutes"</span>)<span class="comment">//æŸçª—å£ç»“æœä¸ºxï¼Œä½†æ˜¯éƒ¨åˆ†æ•°æ®åœ¨è¿™ä¸ªçª—å£çš„æœ€åä¸€ä¸ªtimestampè¿‡åè¿˜æ²¡åˆ°è¾¾ï¼ŒSparkåœ¨è¿™ä¼šç­‰30minï¼Œè¿‡åå°±ä¸å†æ›´æ–°xäº†ã€‚</span></span><br><span class="line">  .dropDuplicates(<span class="string">"User"</span>, <span class="string">"timestamp"</span>)</span><br><span class="line">  .groupBy(window(col(<span class="string">"timestamp"</span>), <span class="string">"10 minutes"</span>),col(<span class="string">"User"</span>))<span class="comment">// 10minåå†åŠ ä¸€ä¸ªå‚æ•°å˜ä¸ºSliding windowsï¼Œè¡¨ç¤ºæ¯éš”å¤šä¹…è®¡ç®—ä¸€æ¬¡ã€‚</span></span><br><span class="line">  .count() </span><br><span class="line">  .writeStream</span><br><span class="line">  .queryName(<span class="string">"events_per_window"</span>)</span><br><span class="line">  .format(<span class="string">"memory"</span>)</span><br><span class="line">  .outputMode(<span class="string">"complete"</span>)</span><br><span class="line">  .start()</span><br><span class="line"></span><br><span class="line">spark.sql(<span class="string">"SELECT * FROM events_per_window"</span>)</span><br></pre></td></tr></table></figure><p>watermark = max event time seen by the engine - late thresholdï¼Œç›¸å½“äºFlinkçš„BoundedOutOfOrdernessTximestampExtractorã€‚<br><br><br>åœ¨windowè®¡ç®—è¢«è§¦å‘æ—¶ï¼ŒSparkä¼šåˆ é™¤ç»“æŸæ—¶é—´ä½äºå½“å‰wmçš„windowçš„ä¸­é—´ç»“æœï¼Œå±äºè¯¥windowçš„è¿Ÿåˆ°æ•°æ®â€œå¯èƒ½â€ä¼šè¢«å¿½ç•¥ï¼Œè¶Šè¿Ÿè¶Šå¯èƒ½è¢«å¿½ç•¥ï¼Œåˆ é™¤å®Œåæ‰æ›´æ–°wmï¼Œæ‰€ä»¥å³ä¾¿ä¸‹ä¸€æ‰¹æ²¡æœ‰æ•°æ®åŠ å…¥ï¼ŒSparkæ‰€ä¾æ®çš„wmä¹Ÿæ˜¯æ–°çš„ï¼Œä¸‹ä¸‹ä¸€æ‰¹wmä¸å˜ã€‚<br><br><br>ä¸Šé¢æ˜¯update modeï¼Œå¦‚æœæ˜¯appendæ¨¡å¼ï¼Œé‚£ä¹ˆç»“æœè¦ç­‰åˆ°triggeråå‘ç°windowçš„ç»“æŸæ—¶é—´ä½äºæ›´æ–°åçš„æ°´ä½çº¿æ—¶æ‰ä¼šå‡ºæ¥ã€‚å¦å¤–ï¼Œmax event time seen by the engine - late thresholdæœºåˆ¶æ„å‘³ç€å¦‚æœä¸‹ä¸€æ‰¹è®¡ç®—æ²¡æœ‰æ›´æ™šçš„æ•°æ®åŠ å…¥ï¼Œé‚£ä¹ˆwmå°±ä¸ä¼šå‰è¿›ï¼Œé‚£ä¹ˆæ•°æ®çš„appendå°±ä¼šè¢«å»¶åã€‚<br><br><br>Conditions for watermarking to clean aggregation state(as of Spark 2.1.1, subject to change in the future)</p><ul><li>ä¸æ”¯æŒcompleteæ¨¡å¼ã€‚</li><li>groupByå¿…é¡»åŒ…å«timestampåˆ—æˆ–è€…window(col(timestamp))ï¼ŒwithWatermarkä¸­çš„åˆ—è¦å’Œå‰é¢çš„timestampåˆ—ç›¸åŒ</li><li>é¡ºåºå¿…é¡»æ˜¯å…ˆwithWatermarkå†åˆ°groupBy</li></ul><p><br>å‚è€ƒï¼š<br><a href="https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html" target="_blank" rel="external nofollow noopener noreferrer">ç»“æ„åŒ–æµç¼–ç¨‹æŒ‡å—</a><br><a href="https://www.cnblogs.com/code2one/p/9872355.html" target="_blank" rel="external nofollow noopener noreferrer">Sparkä¹‹Structured Streaming</a></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Mon Jun 08 2020 00:58:11 GMT+0800 (GMT+08:00) --&gt;&lt;p&gt;&lt;a name=&quot;N4GjR&quot;&gt;&lt;/a&gt;&lt;/p&gt;&lt;h2 id=&quot;æ€»è§ˆ&quot;&gt;&lt;a href=&quot;#æ€»è§ˆ&quot; class=&quot;headerlink&quot; tit
      
    
    </summary>
    
    
      <category term="å¤§æ•°æ®" scheme="cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    
      <category term="spark" scheme="cpeixin.cn/tags/spark/"/>
    
  </entry>
  
</feed>
