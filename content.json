{"meta":{"title":"å¸ƒå…°ç‰¹ | ä¸å¿˜åˆå¿ƒ","subtitle":"äººå¤„åœ¨ä¸€ç§é»˜é»˜å¥‹æ–—çš„çŠ¶æ€ï¼Œç²¾ç¥å°±ä¼šä»çç¢ç”Ÿæ´»ä¸­å¾—åˆ°å‡å","description":"","author":"Brent","url":"cpeixin.cn","root":"/"},"pages":[{"title":"404 Not Foundï¼šè¯¥é¡µæ— æ³•æ˜¾ç¤º","date":"2020-04-04T08:29:08.762Z","updated":"2020-04-03T14:56:33.596Z","comments":false,"path":"/404.html","permalink":"cpeixin.cn/404.html","excerpt":"","text":""},{"title":"å…³äº","date":"2020-04-04T14:37:07.111Z","updated":"2020-04-04T14:37:07.111Z","comments":false,"path":"about/index.html","permalink":"cpeixin.cn/about/index.html","excerpt":"","text":""},{"title":"ä¹¦å•","date":"2020-04-04T08:29:08.739Z","updated":"2020-04-03T14:56:33.596Z","comments":false,"path":"books/index.html","permalink":"cpeixin.cn/books/index.html","excerpt":"","text":""},{"title":"åˆ†ç±»","date":"2020-04-04T08:29:08.728Z","updated":"2020-04-03T14:56:33.597Z","comments":false,"path":"categories/index.html","permalink":"cpeixin.cn/categories/index.html","excerpt":"","text":""},{"title":"å‹æƒ…é“¾æ¥","date":"2020-04-04T08:29:08.717Z","updated":"2020-04-03T14:56:33.597Z","comments":true,"path":"links/index.html","permalink":"cpeixin.cn/links/index.html","excerpt":"","text":""},{"title":"Repositories","date":"2020-04-04T08:29:08.705Z","updated":"2020-04-03T14:56:33.597Z","comments":false,"path":"repository/index.html","permalink":"cpeixin.cn/repository/index.html","excerpt":"","text":""},{"title":"æ ‡ç­¾","date":"2020-04-04T08:29:08.693Z","updated":"2020-04-03T14:56:33.597Z","comments":false,"path":"tags/index.html","permalink":"cpeixin.cn/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"HBase RowKeyè®¾è®¡","slug":"HBase-RowKeyè®¾è®¡","date":"2020-07-21T01:42:33.000Z","updated":"2020-07-21T01:45:26.624Z","comments":true,"path":"2020/07/21/HBase-RowKeyè®¾è®¡/","link":"","permalink":"cpeixin.cn/2020/07/21/HBase-RowKey%E8%AE%BE%E8%AE%A1/","excerpt":"","text":"RowKeyçš„ä½œç”¨RowKeyåœ¨æŸ¥è¯¢ä¸­çš„ä½œç”¨HBaseä¸­RowKeyå¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€è¡Œè®°å½•ï¼Œåœ¨HBaseä¸­æ£€ç´¢æ•°æ®æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼šé€šè¿‡ get æ–¹å¼ï¼ŒæŒ‡å®š RowKey è·å–å”¯ä¸€ä¸€æ¡è®°å½•é€šè¿‡ scan æ–¹å¼ï¼Œè®¾ç½® startRow å’Œ stopRow å‚æ•°è¿›è¡ŒèŒƒå›´åŒ¹é…å…¨è¡¨æ‰«æï¼Œå³ç›´æ¥æ‰«ææ•´å¼ è¡¨ä¸­æ‰€æœ‰è¡Œè®°å½•å½“å¤§é‡è¯·æ±‚è®¿é—®HBaseé›†ç¾¤çš„ä¸€ä¸ªæˆ–å°‘æ•°å‡ ä¸ªèŠ‚ç‚¹ï¼Œé€ æˆå°‘æ•°RegionServerçš„è¯»å†™è¯·æ±‚è¿‡å¤šã€è´Ÿè½½è¿‡å¤§ï¼Œè€Œå…¶ä»–RegionServerè´Ÿè½½å´å¾ˆå°ï¼Œè¿™æ ·å°±é€ æˆçƒ­ç‚¹ç°è±¡ã€‚å¤§é‡è®¿é—®ä¼šä½¿çƒ­ç‚¹Regionæ‰€åœ¨çš„ä¸»æœºè´Ÿè½½è¿‡å¤§ï¼Œå¼•èµ·æ€§èƒ½ä¸‹é™ï¼Œç”šè‡³å¯¼è‡´Regionä¸å¯ç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨å‘HBaseä¸­æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œåº”å°½é‡å‡è¡¡åœ°æŠŠè®°å½•åˆ†æ•£åˆ°ä¸åŒçš„Regioné‡Œå»ï¼Œå¹³è¡¡æ¯ä¸ªRegionçš„å‹åŠ›ã€‚ä¸‹é¢æ ¹æ®ä¸€ä¸ªä¾‹å­åˆ†åˆ«ä»‹ç»ä¸‹æ ¹æ®RowKeyè¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™æ”¯æŒçš„æƒ…å†µã€‚å¦‚æœæˆ‘ä»¬RowKeyè®¾è®¡ä¸ºuid+phone+nameï¼Œé‚£ä¹ˆè¿™ç§è®¾è®¡å¯ä»¥å¾ˆå¥½çš„æ”¯æŒä¸€ä¸‹çš„åœºæ™¯:1uid&#x3D;873969725 AND phone&#x3D;18900000000 AND name&#x3D;zhangsanuid&#x3D; 873969725 AND phone&#x3D;18900000000uid&#x3D; 873969725 AND phone&#x3D;189?uid&#x3D; 873969725å¤åˆ¶ä»£ç éš¾ä»¥æ”¯æŒçš„åœºæ™¯ï¼š1phone&#x3D;18900000000 AND name &#x3D; zhangsanphone&#x3D;18900000000 name&#x3D;zhangsanå¤åˆ¶ä»£ç ä»ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œæ ¹æ®RowKeyä»å‰å‘ååŒ¹é…ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è®¾è®¡RowKeyçš„æ—¶å€™é€‰æ‹©å¥½å­—æ®µä¹‹åï¼Œè¿˜åº”è¯¥ç»“åˆæˆ‘ä»¬çš„å®é™…çš„é«˜é¢‘çš„æŸ¥è¯¢åœºæ™¯æ¥ç»„åˆé€‰æ‹©çš„å­—æ®µï¼Œè¶Šé«˜é¢‘çš„æŸ¥è¯¢å­—æ®µæ’åˆ—è¶Šé å·¦ã€‚RowKeyåœ¨Regionä¸­çš„ä½œç”¨åœ¨ HBase ä¸­ï¼ŒRegion ç›¸å½“äºä¸€ä¸ªæ•°æ®çš„åˆ†ç‰‡ï¼Œæ¯ä¸ª Region éƒ½æœ‰StartRowKeyå’ŒStopRowKeyï¼Œè¿™æ˜¯è¡¨ç¤º Region å­˜å‚¨çš„ RowKey çš„èŒƒå›´ï¼ŒHBase è¡¨çš„æ•°æ®æ—¶æŒ‰ç…§ RowKey æ¥åˆ†æ•£åˆ°ä¸åŒçš„ Regionï¼Œè¦æƒ³å°†æ•°æ®è®°å½•å‡è¡¡çš„åˆ†æ•£åˆ°ä¸åŒçš„Regionä¸­å»ï¼Œå› æ­¤éœ€è¦ RowKey æ»¡è¶³è¿™ç§æ•£åˆ—çš„ç‰¹ç‚¹ã€‚æ­¤å¤–ï¼Œåœ¨æ•°æ®è¯»å†™è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯ä¸RowKey å¯†åˆ‡ç›¸å…³ï¼ŒRowKeyåœ¨è¯»å†™è¿‡ç¨‹ä¸­çš„ä½œç”¨ï¼šè¯»å†™æ•°æ®æ—¶é€šè¿‡ RowKey æ‰¾åˆ°å¯¹åº”çš„ Regionï¼›MemStore ä¸­çš„æ•°æ®æ˜¯æŒ‰ç…§ RowKey çš„å­—å…¸åºæ’åºï¼›HFile ä¸­çš„æ•°æ®æ˜¯æŒ‰ç…§ RowKey çš„å­—å…¸åºæ’åºã€‚RowKeyçš„è®¾è®¡åœ¨HBaseä¸­RowKeyåœ¨æ•°æ®æ£€ç´¢å’Œæ•°æ®å­˜å‚¨æ–¹é¢éƒ½æœ‰é‡è¦çš„ä½œç”¨ï¼Œä¸€ä¸ªå¥½çš„RowKeyè®¾è®¡ä¼šå½±å“åˆ°æ•°æ®åœ¨HBaseä¸­çš„åˆ†å¸ƒï¼Œè¿˜ä¼šå½±å“æˆ‘ä»¬æŸ¥è¯¢æ•ˆç‡ï¼Œæ‰€ä»¥ä¸€ä¸ªå¥½çš„RowKeyçš„è®¾è®¡æ–¹æ¡ˆæ˜¯å¤šä¹ˆé‡è¦ã€‚é¦–å…ˆæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹RowKeyçš„è®¾è®¡åŸåˆ™ã€‚RowKeyè®¾è®¡åŸåˆ™é•¿åº¦åŸåˆ™RowKeyæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶ç æµï¼Œå¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²ï¼Œæœ€å¤§é•¿åº¦ä¸º64kbï¼Œå®é™…åº”ç”¨ä¸­ä¸€èˆ¬ä¸º10-100byteï¼Œä»¥byte[]å½¢å¼ä¿å­˜ï¼Œä¸€èˆ¬è®¾è®¡æˆå®šé•¿ã€‚å»ºè®®è¶ŠçŸ­è¶Šå¥½ï¼Œä¸è¦è¶…è¿‡16ä¸ªå­—èŠ‚ï¼ŒåŸå› å¦‚ä¸‹ï¼šæ•°æ®çš„æŒä¹…åŒ–æ–‡ä»¶HFileä¸­æ—¶æŒ‰ç…§Key-Valueå­˜å‚¨çš„ï¼Œå¦‚æœRowKeyè¿‡é•¿ï¼Œä¾‹å¦‚è¶…è¿‡100byteï¼Œé‚£ä¹ˆ1000wè¡Œçš„è®°å½•ï¼Œä»…RowKeyå°±éœ€å ç”¨è¿‘1GBçš„ç©ºé—´ã€‚è¿™æ ·ä¼šæå¤§å½±å“HFileçš„å­˜å‚¨æ•ˆç‡ã€‚MemStoreä¼šç¼“å­˜éƒ¨åˆ†æ•°æ®åˆ°å†…å­˜ä¸­ï¼Œè‹¥RowKeyå­—æ®µè¿‡é•¿ï¼Œå†…å­˜çš„æœ‰æ•ˆåˆ©ç”¨ç‡å°±ä¼šé™ä½ï¼Œå°±ä¸èƒ½ç¼“å­˜æ›´å¤šçš„æ•°æ®ï¼Œä»è€Œé™ä½æ£€ç´¢æ•ˆç‡ã€‚ç›®å‰æ“ä½œç³»ç»Ÿéƒ½æ˜¯64ä½ç³»ç»Ÿï¼Œå†…å­˜8å­—èŠ‚å¯¹é½ï¼Œæ§åˆ¶åœ¨16å­—èŠ‚ï¼Œ8å­—èŠ‚çš„æ•´æ•°å€åˆ©ç”¨äº†æ“ä½œç³»ç»Ÿçš„æœ€ä½³ç‰¹æ€§ã€‚å”¯ä¸€åŸåˆ™å¿…é¡»åœ¨è®¾è®¡ä¸Šä¿è¯RowKeyçš„å”¯ä¸€æ€§ã€‚ç”±äºåœ¨HBaseä¸­æ•°æ®å­˜å‚¨æ˜¯Key-Valueå½¢å¼ï¼Œè‹¥å‘HBaseä¸­åŒä¸€å¼ è¡¨æ’å…¥ç›¸åŒRowKeyçš„æ•°æ®ï¼Œåˆ™åŸå…ˆå­˜åœ¨çš„æ•°æ®ä¼šè¢«æ–°çš„æ•°æ®è¦†ç›–ã€‚æ’åºåŸåˆ™HBaseçš„RowKeyæ˜¯æŒ‰ç…§ASCIIæœ‰åºæ’åºçš„ï¼Œå› æ­¤æˆ‘ä»¬åœ¨è®¾è®¡RowKeyçš„æ—¶å€™è¦å……åˆ†åˆ©ç”¨è¿™ç‚¹ã€‚æ•£åˆ—åŸåˆ™**è®¾è®¡çš„RowKeyåº”å‡åŒ€çš„åˆ†å¸ƒåœ¨å„ä¸ªHBaseèŠ‚ç‚¹ä¸Šã€‚RowKeyå­—æ®µé€‰æ‹©RowKeyå­—æ®µçš„é€‰æ‹©ï¼Œéµå¾ªçš„æœ€åŸºæœ¬åŸåˆ™æ˜¯å”¯ä¸€æ€§ï¼ŒRowKeyå¿…é¡»èƒ½å¤Ÿå”¯ä¸€çš„è¯†åˆ«ä¸€è¡Œæ•°æ®ã€‚æ— è®ºåº”ç”¨çš„è´Ÿè½½ç‰¹ç‚¹æ˜¯ä»€ä¹ˆæ ·ï¼ŒRowKeyå­—æ®µéƒ½åº”è¯¥å‚è€ƒæœ€é«˜é¢‘çš„æŸ¥è¯¢åœºæ™¯ã€‚æ•°æ®åº“é€šå¸¸éƒ½æ˜¯ä»¥å¦‚ä½•é«˜æ•ˆçš„è¯»å–å’Œæ¶ˆè´¹æ•°æ®ä¸ºç›®çš„ï¼Œè€Œä¸æ˜¯æ•°æ®å­˜å‚¨æœ¬èº«ã€‚ç„¶åï¼Œç»“åˆå…·ä½“çš„è´Ÿè½½ç‰¹ç‚¹ï¼Œå†å¯¹é€‰å–çš„RowKeyå­—æ®µå€¼è¿›è¡Œæ”¹é€ ï¼Œç»„åˆå­—æ®µåœºæ™¯ä¸‹éœ€è¦é‡ç‚¹è€ƒè™‘å­—æ®µçš„é¡ºåºã€‚é¿å…æ•°æ®çƒ­ç‚¹çš„æ–¹æ³•åœ¨å¯¹HBaseçš„è¯»å†™è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•é¿å…çƒ­ç‚¹ç°è±¡å‘¢ï¼Ÿä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼šReversingå¦‚æœç»åˆæ­¥è®¾è®¡å‡ºçš„RowKeyåœ¨æ•°æ®åˆ†å¸ƒä¸Šä¸å‡åŒ€ï¼Œä½†RowKeyå°¾éƒ¨çš„æ•°æ®å´å‘ˆç°å‡ºäº†è‰¯å¥½çš„éšæœºæ€§ï¼Œæ­¤æ—¶ï¼Œå¯ä»¥è€ƒè™‘å°†RowKeyçš„ä¿¡æ¯ç¿»è½¬ï¼Œæˆ–è€…ç›´æ¥å°†å°¾éƒ¨çš„bytesæå‰åˆ°RowKeyçš„å¼€å¤´ã€‚Reversingå¯ä»¥æœ‰æ•ˆçš„ä½¿RowKeyéšæœºåˆ†å¸ƒï¼Œä½†æ˜¯ç‰ºç‰²äº†RowKeyçš„æœ‰åºæ€§ã€‚ç¼ºç‚¹ï¼šåˆ©äºGetæ“ä½œï¼Œä½†ä¸åˆ©äºScanæ“ä½œï¼Œå› ä¸ºæ•°æ®åœ¨åŸRowKeyä¸Šçš„è‡ªç„¶é¡ºåºå·²ç»è¢«æ‰“ä¹±ã€‚SaltingSaltingï¼ˆåŠ ç›ï¼‰çš„åŸç†æ˜¯åœ¨åŸRowKeyçš„å‰é¢æ·»åŠ å›ºå®šé•¿åº¦çš„éšæœºæ•°ï¼Œä¹Ÿå°±æ˜¯ç»™RowKeyåˆ†é…ä¸€ä¸ªéšæœºå‰ç¼€ä½¿å®ƒå’Œä¹‹é—´çš„RowKeyçš„å¼€å¤´ä¸åŒã€‚éšæœºæ•°èƒ½ä¿éšœæ•°æ®åœ¨æ‰€æœ‰Regionsé—´çš„è´Ÿè½½å‡è¡¡ã€‚ç¼ºç‚¹ï¼šå› ä¸ºæ·»åŠ çš„æ˜¯éšæœºæ•°ï¼ŒåŸºäºåŸRowKeyæŸ¥è¯¢æ—¶æ— æ³•çŸ¥é“éšæœºæ•°æ˜¯ä»€ä¹ˆï¼Œé‚£æ ·åœ¨æŸ¥è¯¢çš„æ—¶å€™å°±éœ€è¦å»å„ä¸ªå¯èƒ½çš„Regionsä¸­æŸ¥æ‰¾ï¼ŒSaltingå¯¹äºè¯»å–æ˜¯åˆ©ç©ºçš„ã€‚å¹¶ä¸”åŠ ç›è¿™ç§æ–¹å¼å¢åŠ äº†è¯»å†™æ—¶çš„ååé‡ã€‚Hashing**åŸºäº RowKey çš„å®Œæ•´æˆ–éƒ¨åˆ†æ•°æ®è¿›è¡Œ Hashï¼Œè€Œåå°†Hashingåçš„å€¼å®Œæ•´æ›¿æ¢æˆ–éƒ¨åˆ†æ›¿æ¢åŸRowKeyçš„å‰ç¼€éƒ¨åˆ†ã€‚è¿™é‡Œè¯´çš„ hash åŒ…å« MD5ã€sha1ã€sha256 æˆ– sha512 ç­‰ç®—æ³•ã€‚ç¼ºç‚¹ï¼šä¸ Reversing ç±»ä¼¼ï¼ŒHashing ä¹Ÿä¸åˆ©äº Scanï¼Œå› ä¸ºæ‰“ä¹±äº†åŸRowKeyçš„è‡ªç„¶é¡ºåºã€‚RowKeyè®¾è®¡æ¡ˆä¾‹å‰–æ1. æŸ¥è¯¢æŸç”¨æˆ·åœ¨æŸåº”ç”¨ä¸­çš„æ“ä½œè®°å½•reverse(userid) + appid + timestamp2. æŸ¥è¯¢æŸç”¨æˆ·åœ¨æŸåº”ç”¨ä¸­çš„æ“ä½œè®°å½•ï¼ˆä¼˜å…ˆå±•ç°æœ€è¿‘çš„æ•°æ®ï¼‰reverse(userid) + appid + (Long.Max_Value - timestamp)3. æŸ¥è¯¢æŸç”¨æˆ·åœ¨æŸæ®µæ—¶é—´å†…æ‰€æœ‰åº”ç”¨çš„æ“ä½œè®°å½•reverse(userid) + timestamp + appid4. æŸ¥è¯¢æŸç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯reverse(userid)5. æŸ¥è¯¢æŸeventidè®°å½•ä¿¡æ¯salt + eventid + timestampå¦‚æœ useridæ˜¯æŒ‰æ•°å­—é€’å¢çš„ï¼Œå¹¶ä¸”é•¿åº¦ä¸ä¸€ï¼Œå¯ä»¥å…ˆé¢„ä¼° userid æœ€å¤§é•¿åº¦ï¼Œç„¶åå°†useridè¿›è¡Œç¿»è½¬ï¼Œå†åœ¨ç¿»è½¬ä¹‹åçš„å­—ç¬¦ä¸²åé¢è¡¥0ï¼ˆè‡³æœ€å¤§é•¿åº¦ï¼‰ï¼›å¦‚æœé•¿åº¦å›ºå®šï¼Œç›´æ¥è¿›è¡Œç¿»è½¬å³å¯ï¼ˆå¦‚æ‰‹æœºå·ç ï¼‰ã€‚åœ¨ç¬¬5ä¸ªä¾‹å­ä¸­ï¼ŒåŠ ç›çš„ç›®çš„æ˜¯ä¸ºäº†å¢åŠ æŸ¥è¯¢çš„å¹¶å‘æ€§ï¼ŒåŠ å…¥Slatçš„èŒƒå›´æ˜¯0~nï¼Œå¯ä»¥å°†æ•°æ®åˆ†ä¸ºnä¸ªsplitåŒæ—¶åšscanæ“ä½œï¼Œæœ‰åˆ©äºæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚æ€»ç»“åœ¨HBaseçš„ä½¿ç”¨è¿‡ç¨‹ï¼Œè®¾è®¡RowKeyæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ä¸€ä¸ªç¯èŠ‚ã€‚æˆ‘ä»¬åœ¨è¿›è¡ŒRowKeyè®¾è®¡çš„æ—¶å€™å¯å‚ç…§å¦‚ä¸‹æ­¥éª¤ï¼šç»“åˆä¸šåŠ¡åœºæ™¯ç‰¹ç‚¹ï¼Œé€‰æ‹©åˆé€‚çš„å­—æ®µæ¥åšä¸ºRowKeyï¼Œå¹¶ä¸”æŒ‰ç…§æŸ¥è¯¢é¢‘æ¬¡æ¥æ”¾ç½®å­—æ®µé¡ºåºé€šè¿‡è®¾è®¡çš„RowKeyèƒ½å°½å¯èƒ½çš„å°†æ•°æ®æ‰“æ•£åˆ°æ•´ä¸ªé›†ç¾¤ä¸­ï¼Œå‡è¡¡è´Ÿè½½ï¼Œé¿å…çƒ­ç‚¹é—®é¢˜è®¾è®¡çš„RowKeyåº”å°½é‡ç®€çŸ­","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"HBase","slug":"HBase","permalink":"cpeixin.cn/tags/HBase/"}]},{"title":"æ•°æ®ä»“åº“è¶…è¯¦ç»†æ¡ˆä¾‹","slug":"æ•°æ®ä»“åº“è¶…è¯¦ç»†æ¡ˆä¾‹","date":"2020-07-07T09:17:57.000Z","updated":"2020-08-03T09:19:05.745Z","comments":true,"path":"2020/07/07/æ•°æ®ä»“åº“è¶…è¯¦ç»†æ¡ˆä¾‹/","link":"","permalink":"cpeixin.cn/2020/07/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E8%B6%85%E8%AF%A6%E7%BB%86%E6%A1%88%E4%BE%8B/","excerpt":"","text":"ä»¥ä¸‹è¿™ç¯‡åšå®¢è½¬è½½è‡ªæ•°æ®ä»“åº“æ¡ˆä¾‹ï¼Œå·¨è¯¦ç»†ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ç¦»çº¿æ•°æ®ä»“åº“æ•°æ®ä»“åº“ï¼ˆData WareHouseï¼‰æ˜¯ä¸ºä¼ä¸šæ‰€æœ‰å†³ç­–åˆ¶å®šè¿‡ç¨‹ï¼Œæä¾›æ‰€æœ‰ç³»ç»Ÿæ•°æ®æ”¯æŒçš„æˆ˜ç•¥é›†åˆé€šè¿‡å¯¹æ•°æ®ä»“åº“ä¸­æ•°æ®çš„åˆ†æï¼Œå¯ä»¥å¸®åŠ©ä¼ä¸šï¼Œæ”¹è¿›ä¸šåŠ¡æµç¨‹ã€æ§åˆ¶ã€æˆæœ¬ã€æé«˜äº§å“è´¨é‡ç­‰æ•°æ®ä»“åº“ï¼Œå¹¶ä¸æ˜¯æ•°æ®æœ€ç»ˆç›®çš„åœ°ï¼Œè€Œæ˜¯ä¸ºæ•°æ®æœ€ç»ˆçš„ç›®çš„åœ°åšå¥½å‡†å¤‡ï¼šæ¸…æ´—ã€è½¬ä¹‰ã€åˆ†ç±»ã€é‡ç»„ã€åˆå¹¶ã€æ‹†åˆ†ã€ç»Ÿè®¡ç­‰ç­‰1 é¡¹ç›®ç®€ä»‹1.1 é¡¹ç›®éœ€æ±‚ç”¨æˆ·è¡Œä¸ºæ•°æ®é‡‡é›†å¹³å°æ­å»ºä¸šåŠ¡æ•°æ®é‡‡é›†å¹³å°æ­å»ºæ•°æ®ä»“åº“ç»´åº¦å»ºæ¨¡åˆ†æï¼šç”¨æˆ·ã€æµé‡ã€ä¼šå‘˜ã€å•†å“ã€é”€å”®ã€åœ°åŒºã€æ´»åŠ¨ç­‰ä¸»é¢˜é‡‡ç”¨å³å¸­æŸ¥è¯¢å·¥å…·ï¼Œéšæ—¶è¿›è¡ŒæŒ‡æ ‡åˆ†æå¯¹é›†ç¾¤æ€§èƒ½è¿›è¡Œç›‘æ§ï¼Œå‘ç”Ÿå¼‚å¸¸éœ€è¦æŠ¥è­¦å…ƒæ•°æ®ç®¡ç†è´¨é‡ç›‘æ§1.2 æŠ€æœ¯é€‰å‹æ•°æ®é‡‡é›†åŠŸèƒ½å¦‚ä½•æŠ€æœ¯é€‰å‹é‡‡é›†æ¡†æ¶åç§°ä¸»è¦åŠŸèƒ½Sqoopå¤§æ•°æ®å¹³å°å’Œå…³ç³»å‹æ•°æ®åº“çš„å¯¼å…¥å¯¼å‡ºDataxå¤§æ•°æ®å¹³å°å’Œå…³ç³»å‹æ•°æ®åº“çš„å¯¼å…¥å¯¼å‡ºflumeæ“…é•¿æ—¥å¿—æ•°æ®çš„é‡‡é›†å’Œè§£ælogstashæ“…é•¿æ—¥å¿—æ•°æ®çš„é‡‡é›†å’Œè§£æmaxwellå¸¸ç”¨ä½œå®æ—¶è§£æmysqlçš„binlogæ•°æ®canalå¸¸ç”¨ä½œå®æ—¶è§£æmysqlçš„binlogæ•°æ®waterDropæ•°æ®å¯¼å…¥å¯¼å‡ºå·¥å…·æ¶ˆæ¯ä¸­é—´ä»¶çš„æŠ€æœ¯é€‰å‹å¼€æºMQæ¦‚è¿°RabbitMQLShift ç”¨Erlangå®ç°ï¼Œæ”¯æŒå¤šåè®®ï¼Œbrokeræ¶æ„ï¼Œé‡é‡çº§ZeroMQAMQPæœ€åˆè®¾è®¡è€…iMatixå…¬å¸å®ç°ï¼Œè½»é‡æ¶ˆæ¯å†…æ ¸ï¼Œæ— brokerè®¾è®¡ã€‚C++å®ç°KafkaLinkedInç”¨Scalaè¯­è¨€å®ç°ï¼Œæ”¯æŒhadoopæ•°æ®å¹¶è¡ŒåŠ è½½ActiveMQApachçš„ä¸€ç§JMSå…·ä½“å®ç°ï¼Œæ”¯æŒä»£ç†å’Œp2péƒ¨ç½²ã€‚æ”¯æŒå¤šåè®®ã€‚Javaå®ç°RedisKey-value NoSQLæ•°æ®åº“ï¼Œæœ‰MQçš„åŠŸèƒ½MemcacheQå›½äººåˆ©ç”¨memcacheç¼“å†²é˜Ÿåˆ—åè®®å¼€å‘çš„æ¶ˆæ¯é˜Ÿåˆ—,C/C++å®ç°æ•°æ®æ°¸ä¹…å­˜å‚¨æŠ€æœ¯æ¡†æ¶é€‰å‹æ¡†æ¶åç§°ä¸»è¦ç”¨é€”HDFSåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ç³»ç»ŸHbaseKeyï¼Œvalueå¯¹çš„nosqlæ•°æ®åº“KuduClouderaå…¬å¸å¼€æºæä¾›çš„ç±»ä¼¼äºHbaseçš„æ•°æ®å­˜å‚¨HiveåŸºäºMRçš„æ•°æ®ä»“åº“å·¥å…·æ•°æ®ç¦»çº¿è®¡ç®—æ¡†æ¶æŠ€æœ¯é€‰å‹(hiveå¼•æ“)æ¡†æ¶åç§°åŸºæœ¬ä»‹ç»MapReduceæœ€æ—©æœŸçš„åˆ†å¸ƒå¼æ–‡ä»¶è®¡ç®—ç³»ç»ŸSparkåŸºäºsparkï¼Œä¸€ç«™å¼è§£å†³æ‰¹æµå¤„ç†é—®é¢˜FlinkåŸºäºflinkï¼Œä¸€ç«™å¼è§£å†³æ‰¹æµå¤„ç†é—®é¢˜åˆ†ææ•°æ®åº“é€‰å‹å¯¹æ¯”é¡¹ç›®DruidKylinPrestoImpalaESäºšç§’çº§å“åº”âˆšâˆšÃ—Ã—Ã—ç™¾äº¿æ•°æ®é›†âˆšâˆšâˆšâˆšâˆšSQLæ”¯æŒâˆšâˆšâˆšâˆšâˆš(éœ€æ’ä»¶)ç¦»çº¿âˆšâˆšâˆšâˆšâˆšå®æ—¶âˆšâˆšÃ—Ã—Ã—ç²¾ç¡®å»é‡Ã—âˆšâˆšâˆšÃ—å¤šè¡¨JoinÃ—âˆšâˆšâˆšÃ—JDBC for BIÃ—âˆšâˆšâˆšÃ—å…¶ä»–é€‰å‹ä»»åŠ¡è°ƒåº¦ï¼šDolphinScheduleré›†ç¾¤ç›‘æ§ï¼šCM+CDHå…ƒæ•°æ®ç®¡ç†ï¼šAtlasBIå·¥å…·ï¼šZeppelinã€Superset1.3 æ¶æ„1.4 é›†ç¾¤èµ„æºè§„åˆ’å¦‚ä½•ç¡®è®¤é›†ç¾¤è§„æ¨¡ï¼ˆå‡è®¾æ¯å°æœåŠ¡å™¨8Tç£ç›˜ï¼Œ128Gå†…å­˜ï¼‰æ¯å¤©æ—¥æ´»è·ƒç”¨æˆ·100ä¸‡ï¼Œæ¯äººä¸€å¤©å¹³å‡100æ¡ï¼š100ä¸‡ * 100æ¡ = 1äº¿æ¡æ¯æ¡æ—¥å¿—1Kå·¦å³ï¼Œæ¯å¤©1ä¸€æ¡ï¼š1äº¿ / 1024 /1024 = çº¦100GåŠå¹´å†…ä¸æ‰©å®¹æœåŠ¡å™¨æ¥ç®—ï¼š100G * 180å¤© = çº¦18Tä¿å­˜3ä¸ªå‰¯æœ¬ï¼š18T * 3 = 54Té¢„ç•™20% ~ 30%BUFï¼š54T / 0.7 = 77Tæ€»ç»“ï¼šçº¦10å°æœåŠ¡å™¨ç”±äºèµ„æºæœ‰é™ï¼Œé‡‡ç”¨3å°è¿›è¡Œåˆ¶ä½œæœåŠ¡åç§°å­æœåŠ¡æœåŠ¡å™¨ cdh01.cmæœåŠ¡å™¨ cdh02.cmæœåŠ¡å™¨ cdh03.cmHDFSNameNodeDataNodeSecondaryNameNodeâˆšâˆšâˆšâˆšâˆšYarnNodeManagerResourcemanagerâˆšâˆšâˆšâˆšZookeeperZookeeper ServerâˆšâˆšâˆšFlumeFlumeFlumeï¼ˆæ¶ˆè´¹ Kafkaï¼‰âˆšâˆšâˆšKafkaKafkaâˆšâˆšâˆšHiveHiveâˆšMySQLMySQLâˆšSqoopSqoopâˆšPrestoCoordinatorWorkerâˆšâˆšâˆšDolphinSchedulerDolphinSchedulerâˆšDruidDruidâˆšâˆšâˆšKylinKylinâˆšHbaseHMasterHRegionServerâˆšâˆšâˆšâˆšSupersetSupersetâˆšAtlasAtlasâˆšSolrSolrâˆš2 æ•°æ®ç”Ÿæˆæ¨¡å—æ­¤æ¨¡å—ä¸»è¦é’ˆå¯¹äºç”¨æˆ·è¡Œä¸ºæ•°æ®çš„é‡‡é›†ï¼Œä¸ºä»€ä¹ˆè¦è¿›è¡Œç”¨æˆ·è¡Œä¸ºæ•°æ®çš„é‡‡é›†å‘¢ï¼Ÿå› ä¸ºå¯¹äºä¼ä¸šæ¥è¯´ï¼Œç”¨æˆ·å°±æ˜¯é’±ï¼Œéœ€è¦å°†ç”¨æˆ·çš„ä¹ æƒ¯ç­‰æ•°æ®è¿›è¡Œé‡‡é›†ï¼Œä»¥ä¾¿åœ¨å¤§æ•°æ®è¡ç”Ÿäº§å“å¦‚ç”¨æˆ·ç”»åƒæ ‡ç­¾ç³»ç»Ÿè¿›è¡Œåˆ†æï¼Œé‚£ä¹ˆä¸€èˆ¬æƒ…å†µä¸‹ç”¨æˆ·çš„ä¿¡æ¯éƒ½æ˜¯ç¦»çº¿åˆ†æçš„ï¼ŒåæœŸæˆ‘ä»¬å¯ä»¥å°†åˆ†æç»“æœå­˜å…¥ESç­‰å€’æ’ç´¢å¼•ç”Ÿæ€ä¸­ï¼Œåœ¨ä½¿ç”¨å®æ—¶è®¡ç®—çš„æ–¹å¼åŒ¹é…ç”¨æˆ·ä¹ æƒ¯ï¼Œè¿›è¡Œå®šåˆ¶åŒ–æ¨èï¼Œæ›´è¿›ä¸€æ­¥çš„æ·±åº¦å­¦ä¹ ï¼Œå¯¹ç›¸ä¼¼ç”¨æˆ·è¿›è¡Œæ¨èã€‚2.1 åŸ‹ç‚¹æ•°æ®åŸºæœ¬æ ¼å¼å…¬å…±å­—æ®µï¼šåŸºæœ¬æ‰€æœ‰å®‰å“æ‰‹æœºéƒ½åŒ…å«çš„å­—æ®µä¸šåŠ¡å­—æ®µï¼šåŸ‹ç‚¹ä¸ŠæŠ¥çš„å­—æ®µï¼Œæœ‰å…·ä½“çš„ä¸šåŠ¡ç±»å‹1234567891011121314151617181920212223242526272829303132333435&#123;&quot;ap&quot;:&quot;xxxxx&quot;,&#x2F;&#x2F;é¡¹ç›®æ•°æ®æ¥æº app pc&quot;cm&quot;: &#123; &#x2F;&#x2F;å…¬å…±å­—æ®µ &quot;mid&quot;: &quot;&quot;, &#x2F;&#x2F; (String) è®¾å¤‡å”¯ä¸€æ ‡è¯† &quot;uid&quot;: &quot;&quot;, &#x2F;&#x2F; (String) ç”¨æˆ·æ ‡è¯† &quot;vc&quot;: &quot;1&quot;, &#x2F;&#x2F; (String) versionCodeï¼Œç¨‹åºç‰ˆæœ¬å· &quot;vn&quot;: &quot;1.0&quot;, &#x2F;&#x2F; (String) versionNameï¼Œç¨‹åºç‰ˆæœ¬å &quot;l&quot;: &quot;zh&quot;, &#x2F;&#x2F; (String) language ç³»ç»Ÿè¯­è¨€ &quot;sr&quot;: &quot;&quot;, &#x2F;&#x2F; (String) æ¸ é“å·ï¼Œåº”ç”¨ä»å“ªä¸ªæ¸ é“æ¥çš„ã€‚ &quot;os&quot;: &quot;7.1.1&quot;, &#x2F;&#x2F; (String) Android ç³»ç»Ÿç‰ˆæœ¬ &quot;ar&quot;: &quot;CN&quot;, &#x2F;&#x2F; (String) area åŒºåŸŸ &quot;md&quot;: &quot;BBB100-1&quot;, &#x2F;&#x2F; (String) model æ‰‹æœºå‹å· &quot;ba&quot;: &quot;blackberry&quot;, &#x2F;&#x2F; (String) brand æ‰‹æœºå“ç‰Œ &quot;sv&quot;: &quot;V2.2.1&quot;, &#x2F;&#x2F; (String) sdkVersion &quot;g&quot;: &quot;&quot;, &#x2F;&#x2F; (String) gmail &quot;hw&quot;: &quot;1620x1080&quot;, &#x2F;&#x2F; (String) heightXwidthï¼Œå±å¹•å®½é«˜ &quot;t&quot;: &quot;1506047606608&quot;, &#x2F;&#x2F; (String) å®¢æˆ·ç«¯æ—¥å¿—äº§ç”Ÿæ—¶çš„æ—¶é—´ &quot;nw&quot;: &quot;WIFI&quot;, &#x2F;&#x2F; (String) ç½‘ç»œæ¨¡å¼ &quot;ln&quot;: 0, &#x2F;&#x2F; (double) lng ç»åº¦ &quot;la&quot;: 0 &#x2F;&#x2F; (double) lat çº¬åº¦&#125;,&quot;et&quot;: [ &#x2F;&#x2F;äº‹ä»¶ &#123; &quot;ett&quot;: &quot;1506047605364&quot;, &#x2F;&#x2F;å®¢æˆ·ç«¯äº‹ä»¶äº§ç”Ÿæ—¶é—´ &quot;en&quot;: &quot;display&quot;, &#x2F;&#x2F;äº‹ä»¶åç§° &quot;kv&quot;: &#123; &#x2F;&#x2F;äº‹ä»¶ç»“æœï¼Œä»¥ key-value å½¢å¼è‡ªè¡Œå®šä¹‰ &quot;goodsid&quot;: &quot;236&quot;, &quot;action&quot;: &quot;1&quot;, &quot;extend1&quot;: &quot;1&quot;, &quot;place&quot;: &quot;2&quot;, &quot;category&quot;: &quot;75&quot; &#125; &#125;]&#125;ç¤ºä¾‹æ—¥å¿—ï¼ˆæœåŠ¡å™¨æ—¶é—´æˆ³ | æ—¥å¿—ï¼‰ï¼Œæ—¶é—´æˆ³å¯ä»¥æœ‰æ•ˆåˆ¤å®šç½‘ç»œæœåŠ¡çš„é€šä¿¡æ—¶é•¿ï¼š12345678910111213141516171819202122232425262728293031323334353637383940411540934156385| &#123; &quot;ap&quot;: &quot;gmall&quot;, &#x2F;&#x2F;æ•°ä»“åº“å &quot;cm&quot;: &#123; &quot;uid&quot;: &quot;1234&quot;, &quot;vc&quot;: &quot;2&quot;, &quot;vn&quot;: &quot;1.0&quot;, &quot;la&quot;: &quot;EN&quot;, &quot;sr&quot;: &quot;&quot;, &quot;os&quot;: &quot;7.1.1&quot;, &quot;ar&quot;: &quot;CN&quot;, &quot;md&quot;: &quot;BBB100-1&quot;, &quot;ba&quot;: &quot;blackberry&quot;, &quot;sv&quot;: &quot;V2.2.1&quot;, &quot;g&quot;: &quot;abc@gmail.com&quot;, &quot;hw&quot;: &quot;1620x1080&quot;, &quot;t&quot;: &quot;1506047606608&quot;, &quot;nw&quot;: &quot;WIFI&quot;, &quot;ln&quot;: 0, &quot;la&quot;: 0&#125;,&quot;et&quot;: [ &#123; &quot;ett&quot;: &quot;1506047605364&quot;, &#x2F;&#x2F;å®¢æˆ·ç«¯äº‹ä»¶äº§ç”Ÿæ—¶é—´ &quot;en&quot;: &quot;display&quot;, &#x2F;&#x2F;äº‹ä»¶åç§° &quot;kv&quot;: &#123; &#x2F;&#x2F;äº‹ä»¶ç»“æœï¼Œä»¥ key-value å½¢å¼è‡ªè¡Œå®šä¹‰ &quot;goodsid&quot;: &quot;236&quot;, &quot;action&quot;: &quot;1&quot;, &quot;extend1&quot;: &quot;1&quot;, &quot;place&quot;: &quot;2&quot;, &quot;category&quot;: &quot;75&quot; &#125; &#125;,&#123; &quot;ett&quot;: &quot;1552352626835&quot;, &quot;en&quot;: &quot;active_background&quot;, &quot;kv&quot;: &#123; &quot;active_source&quot;: &quot;1&quot; &#125; &#125; ]&#125;&#125;2.2 åŸ‹ç‚¹äº‹ä»¶æ—¥å¿—æ•°æ®2.2.1 å•†å“åˆ—è¡¨é¡µäº‹ä»¶åç§°ï¼šloadingæ ‡ç­¾å«ä¹‰actionåŠ¨ä½œï¼šå¼€å§‹åŠ è½½=1ï¼ŒåŠ è½½æˆåŠŸ=2ï¼ŒåŠ è½½å¤±è´¥=3loading_timeåŠ è½½æ—¶é•¿ï¼šè®¡ç®—ä¸‹æ‹‰å¼€å§‹åˆ°æ¥å£è¿”å›æ•°æ®çš„æ—¶é—´ï¼Œï¼ˆå¼€å§‹åŠ è½½æŠ¥ 0ï¼ŒåŠ è½½æˆ åŠŸæˆ–åŠ è½½å¤±è´¥æ‰ä¸ŠæŠ¥æ—¶é—´ï¼‰loading_wayåŠ è½½ç±»å‹ï¼š1-è¯»å–ç¼“å­˜ï¼Œ2-ä»æ¥å£æ‹‰æ–°æ•°æ® ï¼ˆåŠ è½½æˆåŠŸæ‰ä¸ŠæŠ¥åŠ è½½ç±»å‹ï¼‰extend1æ‰©å±•å­—æ®µ Extend1extend2æ‰©å±•å­—æ®µ Extend2typeåŠ è½½ç±»å‹ï¼šè‡ªåŠ¨åŠ è½½=1ï¼Œç”¨æˆ·ä¸‹æ‹½åŠ è½½=2ï¼Œåº•éƒ¨åŠ è½½=3ï¼ˆåº•éƒ¨æ¡è§¦å‘ç‚¹å‡»åº•éƒ¨æç¤ºæ¡/ç‚¹å‡»è¿”å›é¡¶éƒ¨åŠ è½½ï¼‰type1åŠ è½½å¤±è´¥ç ï¼šæŠŠåŠ è½½å¤±è´¥çŠ¶æ€ç æŠ¥å›æ¥ï¼ˆæŠ¥ç©ºä¸ºåŠ è½½æˆåŠŸï¼Œæ²¡æœ‰å¤±è´¥ï¼‰2.2.2 å•†å“ç‚¹å‡»äº‹ä»¶æ ‡ç­¾ï¼šdisplayæ ‡ç­¾å«ä¹‰actionåŠ¨ä½œï¼šæ›å…‰å•†å“=1ï¼Œç‚¹å‡»å•†å“=2goodsidå•†å“ IDï¼ˆæœåŠ¡ç«¯ä¸‹å‘çš„ IDï¼‰placeé¡ºåºï¼ˆç¬¬å‡ æ¡å•†å“ï¼Œç¬¬ä¸€æ¡ä¸º 0ï¼Œç¬¬äºŒæ¡ä¸º 1ï¼Œå¦‚æ­¤ç±»æ¨ï¼‰extend1æ›å…‰ç±»å‹ï¼š1 - é¦–æ¬¡æ›å…‰ 2-é‡å¤æ›å…‰categoryåˆ†ç±» IDï¼ˆæœåŠ¡ç«¯å®šä¹‰çš„åˆ†ç±» IDï¼‰2.2.3 å•†å“è¯¦æƒ…é¡µäº‹ä»¶æ ‡ç­¾ï¼šnewsdetailæ ‡ç­¾å«ä¹‰entryé¡µé¢å…¥å£æ¥æºï¼šåº”ç”¨é¦–é¡µ=1ã€push=2ã€è¯¦æƒ…é¡µç›¸å…³æ¨è=3actionåŠ¨ä½œï¼šå¼€å§‹åŠ è½½=1ï¼ŒåŠ è½½æˆåŠŸ=2ï¼ˆpvï¼‰ï¼ŒåŠ è½½å¤±è´¥=3, é€€å‡ºé¡µé¢=4goodsidå•†å“ IDï¼ˆæœåŠ¡ç«¯ä¸‹å‘çš„ IDï¼‰show_styleå•†å“æ ·å¼ï¼š0ã€æ— å›¾ã€1ã€ä¸€å¼ å¤§å›¾ã€2ã€ä¸¤å¼ å›¾ã€3ã€ä¸‰å¼ å°å›¾ã€4ã€ä¸€å¼ å°å›¾ã€ 5ã€ä¸€å¼ å¤§å›¾ä¸¤å¼ å°å›¾news_staytimeé¡µé¢åœç•™æ—¶é•¿ï¼šä»å•†å“å¼€å§‹åŠ è½½æ—¶å¼€å§‹è®¡ç®—ï¼Œåˆ°ç”¨æˆ·å…³é—­é¡µé¢æ‰€ç”¨çš„æ—¶é—´ã€‚ è‹¥ä¸­é€”ç”¨è·³è½¬åˆ°å…¶å®ƒé¡µé¢äº†ï¼Œåˆ™æš‚åœè®¡æ—¶ï¼Œå¾…å›åˆ°è¯¦æƒ…é¡µæ—¶æ¢å¤è®¡æ—¶ã€‚æˆ–ä¸­ é€”åˆ’å‡ºçš„æ—¶é—´è¶…è¿‡ 10 åˆ†é’Ÿï¼Œåˆ™æœ¬æ¬¡è®¡æ—¶ä½œåºŸï¼Œä¸ä¸ŠæŠ¥æœ¬æ¬¡æ•°æ®ã€‚å¦‚æœªåŠ è½½æˆ åŠŸé€€å‡ºï¼Œåˆ™æŠ¥ç©ºã€‚loading_timeåŠ è½½æ—¶é•¿ï¼šè®¡ç®—é¡µé¢å¼€å§‹åŠ è½½åˆ°æ¥å£è¿”å›æ•°æ®çš„æ—¶é—´ ï¼ˆå¼€å§‹åŠ è½½æŠ¥ 0ï¼ŒåŠ è½½ æˆåŠŸæˆ–åŠ è½½å¤±è´¥æ‰ä¸ŠæŠ¥æ—¶é—´ï¼‰type1åŠ è½½å¤±è´¥ç ï¼šæŠŠåŠ è½½å¤±è´¥çŠ¶æ€ç æŠ¥å›æ¥ï¼ˆæŠ¥ç©ºä¸ºåŠ è½½æˆåŠŸï¼Œæ²¡æœ‰å¤±è´¥ï¼‰categoryåˆ†ç±» IDï¼ˆæœåŠ¡ç«¯å®šä¹‰çš„åˆ†ç±» IDï¼‰2.2.4 å¹¿å‘Šäº‹ä»¶åç§°ï¼šadæ ‡ç­¾å«ä¹‰entryå…¥å£ï¼šå•†å“åˆ—è¡¨é¡µ=1 åº”ç”¨é¦–é¡µ=2 å•†å“è¯¦æƒ…é¡µ=3actionåŠ¨ä½œï¼š å¹¿å‘Šå±•ç¤º=1 å¹¿å‘Šç‚¹å‡»=2contentTypeType: 1 å•†å“ 2 è¥é”€æ´»åŠ¨displayMillså±•ç¤ºæ—¶é•¿ æ¯«ç§’æ•°itemIdå•†å“ idactivityIdè¥é”€æ´»åŠ¨ id2.2.5 æ¶ˆæ¯é€šçŸ¥äº‹ä»¶æ ‡ç­¾ï¼šnotificationæ ‡ç­¾å«ä¹‰actionåŠ¨ä½œï¼šé€šçŸ¥äº§ç”Ÿ=1ï¼Œé€šçŸ¥å¼¹å‡º=2ï¼Œé€šçŸ¥ç‚¹å‡»=3ï¼Œå¸¸é©»é€šçŸ¥å±•ç¤ºï¼ˆä¸é‡å¤ä¸Š æŠ¥ï¼Œä¸€å¤©ä¹‹å†…åªæŠ¥ä¸€æ¬¡ï¼‰=4typeé€šçŸ¥ idï¼šé¢„è­¦é€šçŸ¥=1ï¼Œå¤©æ°”é¢„æŠ¥ï¼ˆæ—©=2ï¼Œæ™š=3ï¼‰ï¼Œå¸¸é©»=4ap_timeå®¢æˆ·ç«¯å¼¹å‡ºæ—¶é—´contentå¤‡ç”¨å­—æ®µ2.2.6 ç”¨æˆ·åå°æ´»è·ƒäº‹ä»¶æ ‡ç­¾: active_backgroundæ ‡ç­¾å«ä¹‰active_source1=upgrade,2=download(ä¸‹è½½),3=plugin_upgrade2.2.7 è¯„è®ºæè¿°ï¼šè¯„è®ºè¡¨ï¼ˆcommentï¼‰åºå·å­—æ®µåç§°å­—æ®µæè¿°å­—æ®µç±»å‹é•¿åº¦å…è®¸ç©ºç¼ºçœå€¼1comment_idè¯„è®ºè¡¨int10,02useridç”¨æˆ· idint10,0âˆš03p_comment_idçˆ¶çº§è¯„è®º id(ä¸º 0 åˆ™æ˜¯ä¸€çº§è¯„è®º,ä¸ ä¸º 0 åˆ™æ˜¯å›å¤)int10,0âˆš4contentè¯„è®ºå†…å®¹string1000âˆš5addtimeåˆ›å»ºæ—¶é—´stringâˆš6other_idè¯„è®ºçš„ç›¸å…³ idint10,0âˆš7praise_countç‚¹èµæ•°é‡int10,0âˆš08reply_countå›å¤æ•°é‡int10,0âˆš02.2.8 æ”¶è—æè¿°ï¼šæ”¶è—ï¼ˆfavoritesï¼‰åºå·å­—æ®µåç§°å­—æ®µæè¿°å­—æ®µç±»å‹é•¿åº¦å…è®¸ç©ºç¼ºçœå€¼1idä¸»é”®int10,02course_idå•†å“ idint10,0âˆš03useridç”¨æˆ· IDint10,0âˆš04add_timeåˆ›å»ºæ—¶é—´stringâˆš2.2.9 ç‚¹èµæè¿°ï¼šæ‰€æœ‰çš„ç‚¹èµè¡¨ï¼ˆpraiseï¼‰åºå·å­—æ®µåç§°å­—æ®µæè¿°å­—æ®µç±»å‹é•¿åº¦å…è®¸ç©ºç¼ºçœå€¼1idä¸»é”® idint10,02useridç”¨æˆ· idint10,0âˆš3target_idç‚¹èµçš„å¯¹è±¡ idint10,0âˆš4typeåˆ›å»ºç‚¹èµç±»å‹ï¼š1é—®ç­”ç‚¹èµ 2é—®ç­”è¯„è®ºç‚¹èµ3æ–‡ç« ç‚¹èµæ•° 4è¯„è®ºç‚¹èµint10,0âˆš5add_timeæ·»åŠ æ—¶é—´stringâˆš2.2.10 é”™è¯¯æ—¥å¿—errorBriefé”™è¯¯æ‘˜è¦errorBriefé”™è¯¯è¯¦æƒ…2.3 åŸ‹ç‚¹å¯åŠ¨æ—¥å¿—æ•°æ®1234567891011121314151617181920212223242526&#123; &quot;action&quot;:&quot;1&quot;, &quot;ar&quot;:&quot;MX&quot;, &quot;ba&quot;:&quot;HTC&quot;, &quot;detail&quot;:&quot;&quot;, &quot;en&quot;:&quot;start&quot;, &quot;entry&quot;:&quot;2&quot;, &quot;extend1&quot;:&quot;&quot;, &quot;g&quot;:&quot;43R2SEQX@gmail.com&quot;, &quot;hw&quot;:&quot;640*960&quot;, &quot;l&quot;:&quot;en&quot;, &quot;la&quot;:&quot;20.4&quot;, &quot;ln&quot;:&quot;-99.3&quot;, &quot;loading_time&quot;:&quot;2&quot;, &quot;md&quot;:&quot;HTC-2&quot;, &quot;mid&quot;:&quot;995&quot;, &quot;nw&quot;:&quot;4G&quot;, &quot;open_ad_type&quot;:&quot;2&quot;, &quot;os&quot;:&quot;8.1.2&quot;, &quot;sr&quot;:&quot;B&quot;, &quot;sv&quot;:&quot;V2.0.6&quot;, &quot;t&quot;:&quot;1561472502444&quot;, &quot;uid&quot;:&quot;995&quot;, &quot;vc&quot;:&quot;10&quot;, &quot;vn&quot;:&quot;1.3.4&quot;&#125;äº‹ä»¶æ ‡ç­¾: startæ ‡ç­¾å«ä¹‰entryå…¥ å£ ï¼š push=1 ï¼Œ widget=2 ï¼Œ icon=3 ï¼Œ notification=4, lockscreen_widget =5open_ad_typeå¼€å±å¹¿å‘Šç±»å‹: å¼€å±åŸç”Ÿå¹¿å‘Š=1, å¼€å±æ’å±å¹¿å‘Š=2actionçŠ¶æ€ï¼šæˆåŠŸ=1 å¤±è´¥=2loading_timeåŠ è½½æ—¶é•¿ï¼šè®¡ç®—ä¸‹æ‹‰å¼€å§‹åˆ°æ¥å£è¿”å›æ•°æ®çš„æ—¶é—´ï¼Œï¼ˆå¼€å§‹åŠ è½½æŠ¥ 0ï¼ŒåŠ è½½æˆ åŠŸæˆ–åŠ è½½å¤±è´¥æ‰ä¸ŠæŠ¥æ—¶é—´ï¼‰detailå¤±è´¥ç ï¼ˆæ²¡æœ‰åˆ™ä¸ŠæŠ¥ç©ºï¼‰extend1å¤±è´¥çš„ messageï¼ˆæ²¡æœ‰åˆ™ä¸ŠæŠ¥ç©ºï¼‰enæ—¥å¿—ç±»å‹ start2.4 æ•°æ®ç”Ÿæˆè„šæœ¬å¦‚ä¸‹æ¡ˆä¾‹ä¸­å°†çœç•¥å›¾ä¸­çº¢æ¡†ä¸­çš„æ—¥å¿—ç”Ÿæˆè¿‡ç¨‹ï¼Œç›´æ¥ä½¿ç”¨Javaç¨‹åºæ„å»ºlogFileæ–‡ä»¶ã€‚2.4.1 æ•°æ®ç”Ÿæˆæ ¼å¼å¯åŠ¨æ—¥å¿—{â€œactionâ€:â€1â€,â€arâ€:â€MXâ€,â€baâ€:â€Sumsungâ€,â€detailâ€:â€201â€,â€enâ€:â€startâ€,â€entryâ€:â€4â€,â€extend1â€:â€â€,â€gâ€:â€69021X1Q@gmail.comâ€œ,â€hwâ€:â€1080*1920â€,â€lâ€:â€ptâ€,â€laâ€:â€-11.0â€,â€lnâ€:â€-70.0â€,â€loading_timeâ€:â€9â€,â€mdâ€:â€sumsung-5â€,â€midâ€:â€244â€,â€nwâ€:â€3Gâ€,â€open_ad_typeâ€:â€1â€,â€osâ€:â€8.2.3â€,â€srâ€:â€Dâ€,â€svâ€:â€V2.1.3â€,â€tâ€:â€1589612165914â€,â€uidâ€:â€244â€,â€vcâ€:â€16â€,â€vnâ€:â€1.2.1â€}äº‹ä»¶æ—¥å¿—(ç”±äºè½¬æ¢é—®é¢˜ï¼Œå›¾ä¸­æ²¡æœ‰ â€œæ—¶é—´æˆ³|â€)1589695383284|{â€œcmâ€:{â€œlnâ€:â€-79.4â€,â€svâ€:â€V2.5.3â€,â€osâ€:â€8.0.6â€,â€gâ€:â€81614U54@gmail.comâ€œ,â€midâ€:â€245â€,â€nwâ€:â€WIFIâ€,â€lâ€:â€ptâ€,â€vcâ€:â€6â€,â€hwâ€:â€1080*1920â€,â€arâ€:â€MXâ€,â€uidâ€:â€245â€,â€tâ€:â€1589627025851â€,â€laâ€:â€-39.6â€,â€mdâ€:â€HTC-7â€,â€vnâ€:â€1.3.5â€,â€baâ€:â€HTCâ€,â€srâ€:â€Nâ€},â€apâ€:â€appâ€,â€etâ€:[{â€œettâ€:â€1589650631883â€,â€enâ€:â€displayâ€,â€kvâ€:{â€œgoodsidâ€:â€53â€,â€actionâ€:â€2â€,â€extend1â€:â€2â€,â€placeâ€:â€3â€,â€categoryâ€:â€50â€}},{â€œettâ€:â€1589690866312â€,â€enâ€:â€newsdetailâ€,â€kvâ€:{â€œentryâ€:â€3â€,â€goodsidâ€:â€54â€,â€news_staytimeâ€:â€1â€,â€loading_timeâ€:â€6â€,â€actionâ€:â€4â€,â€showtypeâ€:â€0â€,â€categoryâ€:â€78â€,â€type1â€:â€â€}},{â€œettâ€:â€1589641734037â€,â€enâ€:â€loadingâ€,â€kvâ€:{â€œextend2â€:â€â€,â€loading_timeâ€:â€0â€,â€actionâ€:â€1â€,â€extend1â€:â€â€,â€typeâ€:â€2â€,â€type1â€:â€201â€,â€loading_wayâ€:â€2â€}},{â€œettâ€:â€1589687684878â€,â€enâ€:â€adâ€,â€kvâ€:{â€œactivityIdâ€:â€1â€,â€displayMillsâ€:â€92030â€,â€entryâ€:â€3â€,â€actionâ€:â€5â€,â€contentTypeâ€:â€0â€}},{â€œettâ€:â€1589632980772â€,â€enâ€:â€active_backgroundâ€,â€kvâ€:{â€œactive_sourceâ€:â€1â€}},{â€œettâ€:â€1589682030324â€,â€enâ€:â€errorâ€,â€kvâ€:{â€œerrorDetailâ€:â€java.lang.NullPointerException\\n at cn.lift.appIn.web.AbstractBaseController.validInbound(AbstractBaseController.java:72)\\n at cn.lift.dfdf.web.AbstractBaseController.validInboundâ€,â€errorBriefâ€:â€at cn.lift.dfdf.web.AbstractBaseController.validInbound(AbstractBaseController.java:72)â€}},{â€œettâ€:â€1589675065650â€,â€enâ€:â€commentâ€,â€kvâ€:{â€œp_comment_idâ€:2,â€addtimeâ€:â€1589624299628â€,â€praise_countâ€:509,â€other_idâ€:6,â€comment_idâ€:7,â€reply_countâ€:35,â€useridâ€:3,â€contentâ€:â€å…³è‰²èŠ¦å€™ä½°é—´çº¶çŠæ–‘ç¦å°¹èµæ¶¤ä»‡å½­ä¼å‘µå§œæ¯…â€}},{â€œettâ€:â€1589631359459â€,â€enâ€:â€favoritesâ€,â€kvâ€:{â€œcourse_idâ€:7,â€idâ€:0,â€add_timeâ€:â€1589681240066â€,â€useridâ€:7}},{â€œettâ€:â€1589616574187â€,â€enâ€:â€praiseâ€,â€kvâ€:{â€œtarget_idâ€:1,â€idâ€:7,â€typeâ€:3,â€add_timeâ€:â€1589642497314â€,â€useridâ€:8}}]}2.4.2 åˆ›å»ºmavenå·¥ç¨‹data-producerï¼špom.xml123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263&lt;!--ç‰ˆæœ¬å·ç»Ÿä¸€--&gt; &lt;properties&gt; &lt;slf4j.version&gt;1.7.20&lt;&#x2F;slf4j.version&gt; &lt;logback.version&gt;1.0.7&lt;&#x2F;logback.version&gt; &lt;&#x2F;properties&gt; &lt;dependencies&gt; &lt;!--é˜¿é‡Œå·´å·´å¼€æº json è§£ææ¡†æ¶--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt; &lt;artifactId&gt;fastjson&lt;&#x2F;artifactId&gt; &lt;version&gt;1.2.51&lt;&#x2F;version&gt; &lt;&#x2F;dependency&gt; &lt;!--æ—¥å¿—ç”Ÿæˆæ¡†æ¶--&gt; &lt;dependency&gt; &lt;groupId&gt;ch.qos.logback&lt;&#x2F;groupId&gt; &lt;artifactId&gt;logback-core&lt;&#x2F;artifactId&gt; &lt;version&gt;$&#123;logback.version&#125;&lt;&#x2F;version&gt; &lt;&#x2F;dependency&gt; &lt;dependency&gt; &lt;groupId&gt;ch.qos.logback&lt;&#x2F;groupId&gt; &lt;artifactId&gt;logback-classic&lt;&#x2F;artifactId&gt; &lt;version&gt;$&#123;logback.version&#125;&lt;&#x2F;version&gt; &lt;&#x2F;dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt; &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt; &lt;version&gt;1.18.10&lt;&#x2F;version&gt; &lt;scope&gt;provided&lt;&#x2F;scope&gt; &lt;&#x2F;dependency&gt; &lt;&#x2F;dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt; &lt;version&gt;2.3.2&lt;&#x2F;version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;&#x2F;source&gt; &lt;target&gt;1.8&lt;&#x2F;target&gt; &lt;&#x2F;configuration&gt; &lt;&#x2F;plugin&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-assembly-plugin&lt;&#x2F;artifactId&gt; &lt;configuration&gt; &lt;descriptorRefs&gt; &lt;descriptorRef&gt;jar-with-dependencies&lt;&#x2F;descriptorRef&gt; &lt;&#x2F;descriptorRefs&gt; &lt;archive&gt; &lt;manifest&gt; &lt;!--ä¸»ç±»å--&gt; &lt;mainClass&gt;com.heaton.bigdata.datawarehouse.app.App&lt;&#x2F;mainClass&gt; &lt;&#x2F;manifest&gt; &lt;&#x2F;archive&gt; &lt;&#x2F;configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;make-assembly&lt;&#x2F;id&gt; &lt;phase&gt;package&lt;&#x2F;phase&gt; &lt;goals&gt; &lt;goal&gt;single&lt;&#x2F;goal&gt; &lt;&#x2F;goals&gt; &lt;&#x2F;execution&gt; &lt;&#x2F;executions&gt; &lt;&#x2F;plugin&gt; &lt;&#x2F;plugins&gt; &lt;&#x2F;build&gt;data-producerï¼šlogback.xml12345678910111213141516171819202122232425262728293031323334&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;&lt;configuration debug&#x3D;&quot;false&quot;&gt; &lt;!--å®šä¹‰æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨åœ°å€ å‹¿åœ¨ LogBack çš„é…ç½®ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„ --&gt; &lt;property name&#x3D;&quot;LOG_HOME&quot; value&#x3D;&quot;&#x2F;root&#x2F;logs&#x2F;&quot;&#x2F;&gt; &lt;!-- æ§åˆ¶å°è¾“å‡º --&gt; &lt;appender name&#x3D;&quot;STDOUT&quot; class&#x3D;&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; &lt;encoder class&#x3D;&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%d è¡¨ç¤ºæ—¥æœŸï¼Œ%thread è¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º 5 ä¸ªå­—ç¬¦å®½åº¦%msgï¼š æ—¥å¿—æ¶ˆæ¯ï¼Œ%n æ˜¯æ¢è¡Œç¬¦ --&gt; &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n&lt;&#x2F;pattern&gt; &lt;&#x2F;encoder&gt; &lt;&#x2F;appender&gt; &lt;!-- æŒ‰ç…§æ¯å¤©ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ã€‚å­˜å‚¨äº‹ä»¶æ—¥å¿— --&gt; &lt;appender name&#x3D;&quot;FILE&quot; class&#x3D;&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;!-- &lt;File&gt;$&#123;LOG_HOME&#125;&#x2F;app.log&lt;&#x2F;File&gt;è®¾ç½®æ—¥å¿—ä¸è¶…è¿‡$&#123;log.max.size&#125;æ—¶çš„ä¿å­˜è·¯å¾„ï¼Œæ³¨æ„ï¼Œ å¦‚æœæ˜¯ web é¡¹ç›®ä¼šä¿å­˜åˆ° Tomcat çš„ bin ç›®å½• ä¸‹ --&gt; &lt;rollingPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºçš„æ–‡ä»¶å --&gt; &lt;FileNamePattern&gt;$&#123;LOG_HOME&#125;&#x2F;app-%d&#123;yyyy-MM-dd&#125;.log&lt;&#x2F;FileNamePattern&gt; &lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•° --&gt; &lt;MaxHistory&gt;30&lt;&#x2F;MaxHistory&gt; &lt;&#x2F;rollingPolicy&gt; &lt;encoder class&#x3D;&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;pattern&gt;%msg%n&lt;&#x2F;pattern&gt; &lt;&#x2F;encoder&gt; &lt;!--æ—¥å¿—æ–‡ä»¶æœ€å¤§çš„å¤§å° --&gt; &lt;triggeringPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;&gt; &lt;MaxFileSize&gt;10MB&lt;&#x2F;MaxFileSize&gt; &lt;&#x2F;triggeringPolicy&gt; &lt;&#x2F;appender&gt; &lt;!--å¼‚æ­¥æ‰“å°æ—¥å¿—--&gt; &lt;appender name&#x3D;&quot;ASYNC_FILE&quot; class&#x3D;&quot;ch.qos.logback.classic.AsyncAppender&quot;&gt; &lt;!-- ä¸ä¸¢å¤±æ—¥å¿—.é»˜è®¤çš„,å¦‚æœé˜Ÿåˆ—çš„ 80%å·²æ»¡,åˆ™ä¼šä¸¢å¼ƒ TRACTã€DEBUGã€INFO çº§åˆ«çš„æ—¥å¿— --&gt; &lt;discardingThreshold&gt;0&lt;&#x2F;discardingThreshold&gt; &lt;!-- æ›´æ”¹é»˜è®¤çš„é˜Ÿåˆ—çš„æ·±åº¦,è¯¥å€¼ä¼šå½±å“æ€§èƒ½.é»˜è®¤å€¼ä¸º 256 --&gt; &lt;queueSize&gt;512&lt;&#x2F;queueSize&gt; &lt;!-- æ·»åŠ é™„åŠ çš„ appender,æœ€å¤šåªèƒ½æ·»åŠ ä¸€ä¸ª --&gt; &lt;appender-ref ref&#x3D;&quot;FILE&quot;&#x2F;&gt; &lt;&#x2F;appender&gt; &lt;!-- æ—¥å¿—è¾“å‡ºçº§åˆ« --&gt; &lt;root level&#x3D;&quot;INFO&quot;&gt; &lt;appender-ref ref&#x3D;&quot;STDOUT&quot;&#x2F;&gt; &lt;appender-ref ref&#x3D;&quot;ASYNC_FILE&quot;&#x2F;&gt; &lt;appender-ref ref&#x3D;&quot;error&quot;&#x2F;&gt; &lt;&#x2F;root&gt;&lt;&#x2F;configuration&gt;data-flumeï¼špom.xml12345678910111213141516171819&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flume&lt;&#x2F;groupId&gt; &lt;artifactId&gt;flume-ng-core&lt;&#x2F;artifactId&gt; &lt;version&gt;1.9.0&lt;&#x2F;version&gt; &lt;&#x2F;dependency&gt; &lt;&#x2F;dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt; &lt;version&gt;2.3.2&lt;&#x2F;version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;&#x2F;source&gt; &lt;target&gt;1.8&lt;&#x2F;target&gt; &lt;&#x2F;configuration&gt; &lt;&#x2F;plugin&gt; &lt;&#x2F;plugins&gt; &lt;&#x2F;build&gt;hive-functionï¼špom.xml12345678910111213141516171819&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.hive&lt;&#x2F;groupId&gt; &lt;artifactId&gt;hive-exec&lt;&#x2F;artifactId&gt; &lt;version&gt;2.1.1&lt;&#x2F;version&gt; &lt;&#x2F;dependency&gt; &lt;&#x2F;dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt; &lt;version&gt;2.3.2&lt;&#x2F;version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;&#x2F;source&gt; &lt;target&gt;1.8&lt;&#x2F;target&gt; &lt;&#x2F;configuration&gt; &lt;&#x2F;plugin&gt; &lt;&#x2F;plugins&gt; &lt;&#x2F;build&gt;2.4.3 å„äº‹ä»¶beandata-producerå·¥ç¨‹2.4.3.1 å…¬å…±æ—¥å¿—ç±»123456789101112131415161718192021222324252627import lombok.Data;&#x2F;** * @author Heaton* @email 70416450@qq.com* @date 2020&#x2F;4&#x2F;25 14:54 * @describe å…¬å…±æ—¥å¿—ç±»*&#x2F;@Datapublic class AppBase &#123; private String mid; &#x2F;&#x2F; (String) è®¾å¤‡å”¯ä¸€ private String uid; &#x2F;&#x2F; (String) ç”¨æˆ· uid private String vc; &#x2F;&#x2F; (String) versionCodeï¼Œç¨‹åºç‰ˆæœ¬å· private String vn; &#x2F;&#x2F; (String) versionNameï¼Œç¨‹åºç‰ˆæœ¬å private String l; &#x2F;&#x2F; (String) ç³»ç»Ÿè¯­è¨€ private String sr; &#x2F;&#x2F; (String) æ¸ é“å·ï¼Œåº”ç”¨ä»å“ªä¸ªæ¸ é“æ¥çš„ã€‚ private String os; &#x2F;&#x2F; (String) Android ç³»ç»Ÿç‰ˆæœ¬ private String ar; &#x2F;&#x2F; (String) åŒºåŸŸ private String md; &#x2F;&#x2F; (String) æ‰‹æœºå‹å· private String ba; &#x2F;&#x2F; (String) æ‰‹æœºå“ç‰Œ private String sv; &#x2F;&#x2F; (String) sdkVersion private String g; &#x2F;&#x2F; (String) gmail private String hw; &#x2F;&#x2F; (String) heightXwidthï¼Œå±å¹•å®½é«˜ private String t; &#x2F;&#x2F; (String) å®¢æˆ·ç«¯æ—¥å¿—äº§ç”Ÿæ—¶çš„æ—¶é—´ private String nw; &#x2F;&#x2F; (String) ç½‘ç»œæ¨¡å¼ private String ln; &#x2F;&#x2F; (double) lng ç»åº¦ private String la; &#x2F;&#x2F; (double) lat çº¬åº¦&#125;2.4.3.2 å¯åŠ¨æ—¥å¿—ç±»1234567891011121314151617import lombok.Data;&#x2F;** * @author Heaton * @email 70416450@qq.com * @date 2020&#x2F;4&#x2F;25 14:54 * @describe å¯åŠ¨æ—¥å¿—ç±» *&#x2F;@Datapublic class AppStart extends AppBase &#123; private String entry;&#x2F;&#x2F;å…¥å£ï¼š push&#x3D;1ï¼Œwidget&#x3D;2ï¼Œicon&#x3D;3ï¼Œnotification&#x3D;4, lockscreen_widget private String open_ad_type;&#x2F;&#x2F;å¼€å±å¹¿å‘Šç±»å‹: å¼€å±åŸç”Ÿå¹¿å‘Š&#x3D;1, å¼€å±æ’å±å¹¿å‘Š&#x3D;2 private String action;&#x2F;&#x2F;çŠ¶æ€ï¼šæˆåŠŸ&#x3D;1 å¤±è´¥&#x3D;2 private String loading_time;&#x2F;&#x2F;åŠ è½½æ—¶é•¿ï¼šè®¡ç®—ä¸‹æ‹‰å¼€å§‹åˆ°æ¥å£è¿”å›æ•°æ®çš„æ—¶é—´ï¼Œï¼ˆå¼€å§‹åŠ è½½æŠ¥ 0ï¼ŒåŠ è½½æˆåŠŸæˆ–åŠ è½½å¤±è´¥æ‰ä¸ŠæŠ¥æ—¶é—´ï¼‰ private String detail;&#x2F;&#x2F;å¤±è´¥ç ï¼ˆæ²¡æœ‰åˆ™ä¸ŠæŠ¥ç©ºï¼‰ private String extend1;&#x2F;&#x2F;å¤±è´¥çš„ messageï¼ˆæ²¡æœ‰åˆ™ä¸ŠæŠ¥ç©ºï¼‰ private String en;&#x2F;&#x2F;å¯åŠ¨æ—¥å¿—ç±»å‹æ ‡è®°&#125;2.4.3.3 é”™è¯¯æ—¥å¿—ç±»123456789101112import lombok.Data;&#x2F;** * @author Heaton * @email 70416450@qq.com * @date 2020&#x2F;4&#x2F;25 14:54 * @describe é”™è¯¯æ—¥å¿—ç±» *&#x2F;@Datapublic class AppErrorLog &#123; private String errorBrief; &#x2F;&#x2F;é”™è¯¯æ‘˜è¦ private String errorDetail; &#x2F;&#x2F;é”™è¯¯è¯¦æƒ…&#125;2.4.3.4 å•†å“ç‚¹å‡»æ—¥å¿—ç±»123456789101112131415import lombok.Data;&#x2F;** * @author Heaton * @email 70416450@qq.com * @date 2020&#x2F;4&#x2F;25 14:54 * @describe å•†å“ç‚¹å‡»æ—¥å¿—ç±» *&#x2F;@Datapublic class AppDisplay &#123; private String action;&#x2F;&#x2F;åŠ¨ä½œï¼šæ›å…‰å•†å“&#x3D;1ï¼Œç‚¹å‡»å•†å“&#x3D;2 private String goodsid;&#x2F;&#x2F;å•†å“ IDï¼ˆæœåŠ¡ç«¯ä¸‹å‘çš„ IDï¼‰ private String place;&#x2F;&#x2F;é¡ºåºï¼ˆç¬¬å‡ æ¡å•†å“ï¼Œç¬¬ä¸€æ¡ä¸º 0ï¼Œç¬¬äºŒæ¡ä¸º 1ï¼Œå¦‚æ­¤ç±»æ¨ï¼‰ private String extend1;&#x2F;&#x2F;æ›å…‰ç±»å‹ï¼š1 - é¦–æ¬¡æ›å…‰ 2-é‡å¤æ›å…‰ï¼ˆæ²¡æœ‰ä½¿ç”¨ï¼‰ private String category;&#x2F;&#x2F;åˆ†ç±» IDï¼ˆæœåŠ¡ç«¯å®šä¹‰çš„åˆ†ç±» IDï¼‰&#125;2.4.3.5 å•†å“è¯¦æƒ…ç±»123456789101112131415161718import lombok.Data;&#x2F;** * @author Heaton * @email 70416450@qq.com * @date 2020&#x2F;4&#x2F;25 14:54 * @describe å•†å“è¯¦æƒ…ç±» *&#x2F;@Datapublic class AppNewsDetail &#123; private String entry;&#x2F;&#x2F;é¡µé¢å…¥å£æ¥æºï¼šåº”ç”¨é¦–é¡µ&#x3D;1ã€push&#x3D;2ã€è¯¦æƒ…é¡µç›¸å…³æ¨è private String action;&#x2F;&#x2F;åŠ¨ä½œï¼šå¼€å§‹åŠ è½½&#x3D;1ï¼ŒåŠ è½½æˆåŠŸ&#x3D;2ï¼ˆpvï¼‰ï¼ŒåŠ è½½å¤±è´¥&#x3D;3, é€€å‡ºé¡µé¢&#x3D;4 private String goodsid;&#x2F;&#x2F;å•†å“ IDï¼ˆæœåŠ¡ç«¯ä¸‹å‘çš„ IDï¼‰ private String showtype;&#x2F;&#x2F;å•†å“æ ·å¼ï¼š0ã€æ— å›¾ 1ã€ä¸€å¼ å¤§å›¾ 2ã€ä¸¤å¼ å›¾ 3ã€ä¸‰å¼ å°å›¾ 4ã€ä¸€å¼ å° å›¾ 5ã€ä¸€å¼ å¤§å›¾ä¸¤å¼ å°å›¾ æ¥æºäºè¯¦æƒ…é¡µç›¸å…³æ¨èçš„å•†å“ï¼Œä¸ŠæŠ¥æ ·å¼éƒ½ä¸º 0ï¼ˆå› ä¸ºéƒ½æ˜¯å·¦æ–‡å³å›¾ï¼‰ private String news_staytime;&#x2F;&#x2F;é¡µé¢åœç•™æ—¶é•¿ï¼šä»å•†å“å¼€å§‹åŠ è½½æ—¶å¼€å§‹è®¡ç®—ï¼Œåˆ°ç”¨æˆ·å…³é—­é¡µé¢ æ‰€ç”¨çš„æ—¶é—´ã€‚è‹¥ä¸­é€”ç”¨è·³è½¬åˆ°å…¶å®ƒé¡µé¢äº†ï¼Œåˆ™æš‚åœè®¡æ—¶ï¼Œå¾…å›åˆ°è¯¦æƒ…é¡µæ—¶æ¢å¤è®¡æ—¶ã€‚æˆ–ä¸­é€”åˆ’å‡ºçš„æ—¶é—´è¶… è¿‡ 10 åˆ†é’Ÿï¼Œåˆ™æœ¬æ¬¡è®¡æ—¶ä½œåºŸï¼Œä¸ä¸ŠæŠ¥æœ¬æ¬¡æ•°æ®ã€‚å¦‚æœªåŠ è½½æˆåŠŸé€€å‡ºï¼Œåˆ™æŠ¥ç©ºã€‚ private String loading_time;&#x2F;&#x2F;åŠ è½½æ—¶é•¿ï¼šè®¡ç®—é¡µé¢å¼€å§‹åŠ è½½åˆ°æ¥å£è¿”å›æ•°æ®çš„æ—¶é—´ ï¼ˆå¼€å§‹åŠ  è½½æŠ¥ 0ï¼ŒåŠ è½½æˆåŠŸæˆ–åŠ è½½å¤±è´¥æ‰ä¸ŠæŠ¥æ—¶é—´ï¼‰ private String type1;&#x2F;&#x2F;åŠ è½½å¤±è´¥ç ï¼šæŠŠåŠ è½½å¤±è´¥çŠ¶æ€ç æŠ¥å›æ¥ï¼ˆæŠ¥ç©ºä¸ºåŠ è½½æˆåŠŸï¼Œæ²¡æœ‰å¤±è´¥ï¼‰ private String category;&#x2F;&#x2F;åˆ†ç±» IDï¼ˆæœåŠ¡ç«¯å®šä¹‰çš„åˆ†ç±» IDï¼‰&#125;2.4.3.6 å•†å“åˆ—è¡¨ç±»1234567891011121314151617import lombok.Data;&#x2F;** * @author Heaton * @email 70416450@qq.com * @date 2020&#x2F;4&#x2F;25 14:54 * @describe å•†å“åˆ—è¡¨ç±» *&#x2F;@Datapublic class AppLoading &#123; private String action;&#x2F;&#x2F;åŠ¨ä½œï¼šå¼€å§‹åŠ è½½&#x3D;1ï¼ŒåŠ è½½æˆåŠŸ&#x3D;2ï¼ŒåŠ è½½å¤±è´¥ private String loading_time;&#x2F;&#x2F;åŠ è½½æ—¶é•¿ï¼šè®¡ç®—ä¸‹æ‹‰å¼€å§‹åˆ°æ¥å£è¿”å›æ•°æ®çš„æ—¶é—´ï¼Œï¼ˆå¼€å§‹åŠ è½½æŠ¥ 0ï¼Œ åŠ è½½æˆåŠŸæˆ–åŠ è½½å¤±è´¥æ‰ä¸ŠæŠ¥æ—¶é—´ï¼‰ private String loading_way;&#x2F;&#x2F;åŠ è½½ç±»å‹ï¼š1-è¯»å–ç¼“å­˜ï¼Œ2-ä»æ¥å£æ‹‰æ–°æ•°æ® ï¼ˆåŠ è½½æˆåŠŸæ‰ä¸ŠæŠ¥åŠ  è½½ç±»å‹ï¼‰ private String extend1;&#x2F;&#x2F;æ‰©å±•å­—æ®µ Extend1 private String extend2;&#x2F;&#x2F;æ‰©å±•å­—æ®µ Extend2 private String type;&#x2F;&#x2F;åŠ è½½ç±»å‹ï¼šè‡ªåŠ¨åŠ è½½&#x3D;1ï¼Œç”¨æˆ·ä¸‹æ‹½åŠ è½½&#x3D;2ï¼Œåº•éƒ¨åŠ è½½&#x3D;3ï¼ˆåº•éƒ¨æ¡è§¦å‘ç‚¹å‡»åº• éƒ¨æç¤ºæ¡&#x2F;ç‚¹å‡»è¿”å›é¡¶éƒ¨åŠ è½½ï¼‰ private String type1;&#x2F;&#x2F;åŠ è½½å¤±è´¥ç ï¼šæŠŠåŠ è½½å¤±è´¥çŠ¶æ€ç æŠ¥å›æ¥ï¼ˆæŠ¥ç©ºä¸ºåŠ è½½æˆåŠŸï¼Œæ²¡æœ‰å¤±è´¥ï¼‰&#125;2.4.3.7 å¹¿å‘Šç±»12345678910111213141516import lombok.Data;&#x2F;** * @author Heaton * @email 70416450@qq.com * @date 2020&#x2F;4&#x2F;25 14:54 * @describe å¹¿å‘Šç±» *&#x2F;@Datapublic class AppAd &#123; private String entry;&#x2F;&#x2F;å…¥å£ï¼šå•†å“åˆ—è¡¨é¡µ&#x3D;1 åº”ç”¨é¦–é¡µ&#x3D;2 å•†å“è¯¦æƒ…é¡µ&#x3D;3 private String action;&#x2F;&#x2F;åŠ¨ä½œï¼š å¹¿å‘Šå±•ç¤º&#x3D;1 å¹¿å‘Šç‚¹å‡»&#x3D;2 private String contentType;&#x2F;&#x2F;Type: 1 å•†å“ 2 è¥é”€æ´»åŠ¨ private String displayMills;&#x2F;&#x2F;å±•ç¤ºæ—¶é•¿ æ¯«ç§’æ•° private String itemId; &#x2F;&#x2F;å•†å“id private String activityId; &#x2F;&#x2F;è¥é”€æ´»åŠ¨id&#125;2.4.3.8 æ¶ˆæ¯é€šçŸ¥æ—¥å¿—ç±»1234567891011121314import lombok.Data;&#x2F;** * @author Heaton * @email 70416450@qq.com * @date 2020&#x2F;4&#x2F;25 14:54 * @describe æ¶ˆæ¯é€šçŸ¥æ—¥å¿—ç±» *&#x2F;@Datapublic class AppNotification &#123; private String action;&#x2F;&#x2F;åŠ¨ä½œï¼šé€šçŸ¥äº§ç”Ÿ&#x3D;1ï¼Œé€šçŸ¥å¼¹å‡º&#x3D;2ï¼Œé€šçŸ¥ç‚¹å‡»&#x3D;3ï¼Œå¸¸é©»é€šçŸ¥å±•ç¤ºï¼ˆä¸é‡å¤ä¸Š æŠ¥ï¼Œä¸€å¤©ä¹‹å†…åªæŠ¥ä¸€æ¬¡ï¼‰ private String type;&#x2F;&#x2F;é€šçŸ¥ idï¼šé¢„è­¦é€šçŸ¥&#x3D;1ï¼Œå¤©æ°”é¢„æŠ¥ï¼ˆæ—©&#x3D;2ï¼Œæ™š&#x3D;3ï¼‰ï¼Œå¸¸é©»&#x3D;4 private String ap_time;&#x2F;&#x2F;å®¢æˆ·ç«¯å¼¹å‡ºæ—¶é—´ private String content;&#x2F;&#x2F;å¤‡ç”¨å­—æ®µ&#125;2.4.3.9 ç”¨æˆ·åå°æ´»è·ƒç±»1234567891011import lombok.Data;&#x2F;** * @author Heaton * @email 70416450@qq.com * @date 2020&#x2F;4&#x2F;25 14:54 * @describe ç”¨æˆ·åå°æ´»è·ƒç±» *&#x2F;@Datapublic class AppActive &#123; private String active_source;&#x2F;&#x2F;1&#x3D;upgrade,2&#x3D;download(ä¸‹è½½),3&#x3D;plugin_upgrade&#125;2.4.3.10 ç”¨æˆ·è¯„è®ºç±»123456789101112131415161718import lombok.Data;&#x2F;** * @author Heaton * @email 70416450@qq.com * @date 2020&#x2F;4&#x2F;25 14:54 * @describe ç”¨æˆ·è¯„è®ºç±» *&#x2F;@Datapublic class AppComment &#123; private int comment_id;&#x2F;&#x2F;è¯„è®ºè¡¨ private int userid;&#x2F;&#x2F;ç”¨æˆ· id private int p_comment_id;&#x2F;&#x2F;çˆ¶çº§è¯„è®º id(ä¸º 0 åˆ™æ˜¯ä¸€çº§è¯„è®º,ä¸ä¸º 0 åˆ™æ˜¯å›å¤) private String content;&#x2F;&#x2F;è¯„è®ºå†…å®¹ private String addtime;&#x2F;&#x2F;åˆ›å»ºæ—¶é—´ private int other_id;&#x2F;&#x2F;è¯„è®ºçš„ç›¸å…³ id private int praise_count;&#x2F;&#x2F;ç‚¹èµæ•°é‡ private int reply_count;&#x2F;&#x2F;å›å¤æ•°é‡&#125;2.4.3.11 ç”¨æˆ·æ”¶è—ç±»1234567891011121314import lombok.Data;&#x2F;** * @author Heaton * @email 70416450@qq.com * @date 2020&#x2F;4&#x2F;25 14:54 * @describe ç”¨æˆ·æ”¶è—ç±» *&#x2F;@Datapublic class AppFavorites &#123; private int id;&#x2F;&#x2F;ä¸»é”® private int course_id;&#x2F;&#x2F;å•†å“ id private int userid;&#x2F;&#x2F;ç”¨æˆ· ID private String add_time;&#x2F;&#x2F;åˆ›å»ºæ—¶é—´&#125;2.4.3.12 ç”¨æˆ·ç‚¹èµç±»123456789101112131415import lombok.Data;&#x2F;** * @author Heaton * @email 70416450@qq.com * @date 2020&#x2F;4&#x2F;25 14:54 * @describe ç”¨æˆ·ç‚¹èµç±» *&#x2F;@Datapublic class AppPraise &#123; private int id; &#x2F;&#x2F;ä¸»é”® id private int userid;&#x2F;&#x2F;ç”¨æˆ· id private int target_id;&#x2F;&#x2F;ç‚¹èµçš„å¯¹è±¡ id private int type;&#x2F;&#x2F;ç‚¹èµç±»å‹ 1 é—®ç­”ç‚¹èµ 2 é—®ç­”è¯„è®ºç‚¹èµ 3 æ–‡ç« ç‚¹èµæ•° 4 è¯„è®ºç‚¹èµ private String add_time;&#x2F;&#x2F;æ·»åŠ æ—¶é—´&#125;2.4.4 å¯åŠ¨ç±»123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONArray;import com.alibaba.fastjson.JSONObject;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import java.io.UnsupportedEncodingException;import java.util.Random;&#x2F;** * @author Heaton * @email 70416450@qq.com * @date 2020&#x2F;4&#x2F;25 14:54 * @describe å¯åŠ¨ç±» *&#x2F;public class App &#123; private final static Logger logger &#x3D; LoggerFactory.getLogger(App.class); private static Random rand &#x3D; new Random(); &#x2F;&#x2F; è®¾å¤‡id private static int s_mid &#x3D; 0; &#x2F;&#x2F; ç”¨æˆ·id private static int s_uid &#x3D; 0; &#x2F;&#x2F; å•†å“id private static int s_goodsid &#x3D; 0; public static void main(String[] args) &#123; &#x2F;&#x2F; å‚æ•°ä¸€ï¼šæ§åˆ¶å‘é€æ¯æ¡çš„å»¶æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯0 Long delay &#x3D; args.length &gt; 0 ? Long.parseLong(args[0]) : 0L; &#x2F;&#x2F; å‚æ•°äºŒï¼šå¾ªç¯éå†æ¬¡æ•° int loop_len &#x3D; args.length &gt; 1 ? Integer.parseInt(args[1]) : 1000; &#x2F;&#x2F; ç”Ÿæˆæ•°æ® generateLog(delay, loop_len); &#125; private static void generateLog(Long delay, int loop_len) &#123; for (int i &#x3D; 0; i &lt; loop_len; i++) &#123; int flag &#x3D; rand.nextInt(2); switch (flag) &#123; case (0): &#x2F;&#x2F;åº”ç”¨å¯åŠ¨ AppStart appStart &#x3D; generateStart(); String jsonString &#x3D; JSON.toJSONString(appStart); &#x2F;&#x2F;æ§åˆ¶å°æ‰“å° logger.info(jsonString); break; case (1): JSONObject json &#x3D; new JSONObject(); json.put(&quot;ap&quot;, &quot;app&quot;); json.put(&quot;cm&quot;, generateComFields()); JSONArray eventsArray &#x3D; new JSONArray(); &#x2F;&#x2F; äº‹ä»¶æ—¥å¿— &#x2F;&#x2F; å•†å“ç‚¹å‡»ï¼Œå±•ç¤º if (rand.nextBoolean()) &#123; eventsArray.add(generateDisplay()); json.put(&quot;et&quot;, eventsArray); &#125; &#x2F;&#x2F; å•†å“è¯¦æƒ…é¡µ if (rand.nextBoolean()) &#123; eventsArray.add(generateNewsDetail()); json.put(&quot;et&quot;, eventsArray); &#125; &#x2F;&#x2F; å•†å“åˆ—è¡¨é¡µ if (rand.nextBoolean()) &#123; eventsArray.add(generateNewList()); json.put(&quot;et&quot;, eventsArray); &#125; &#x2F;&#x2F; å¹¿å‘Š if (rand.nextBoolean()) &#123; eventsArray.add(generateAd()); json.put(&quot;et&quot;, eventsArray); &#125; &#x2F;&#x2F; æ¶ˆæ¯é€šçŸ¥ if (rand.nextBoolean()) &#123; eventsArray.add(generateNotification()); json.put(&quot;et&quot;, eventsArray); &#125; &#x2F;&#x2F; ç”¨æˆ·åå°æ´»è·ƒ if (rand.nextBoolean()) &#123; eventsArray.add(generateBackground()); json.put(&quot;et&quot;, eventsArray); &#125; &#x2F;&#x2F;æ•…éšœæ—¥å¿— if (rand.nextBoolean()) &#123; eventsArray.add(generateError()); json.put(&quot;et&quot;, eventsArray); &#125; &#x2F;&#x2F; ç”¨æˆ·è¯„è®º if (rand.nextBoolean()) &#123; eventsArray.add(generateComment()); json.put(&quot;et&quot;, eventsArray); &#125; &#x2F;&#x2F; ç”¨æˆ·æ”¶è— if (rand.nextBoolean()) &#123; eventsArray.add(generateFavorites()); json.put(&quot;et&quot;, eventsArray); &#125; &#x2F;&#x2F; ç”¨æˆ·ç‚¹èµ if (rand.nextBoolean()) &#123; eventsArray.add(generatePraise()); json.put(&quot;et&quot;, eventsArray); &#125; &#x2F;&#x2F;æ—¶é—´ long millis &#x3D; System.currentTimeMillis(); &#x2F;&#x2F;æ§åˆ¶å°æ‰“å° logger.info(millis + &quot;|&quot; + json.toJSONString()); break; &#125; &#x2F;&#x2F; å»¶è¿Ÿ try &#123; Thread.sleep(delay); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#x2F;** * å…¬å…±å­—æ®µè®¾ç½® *&#x2F; private static JSONObject generateComFields() &#123; AppBase appBase &#x3D; new AppBase(); &#x2F;&#x2F;è®¾å¤‡id appBase.setMid(s_mid + &quot;&quot;); s_mid++; &#x2F;&#x2F; ç”¨æˆ·id appBase.setUid(s_uid + &quot;&quot;); s_uid++; &#x2F;&#x2F; ç¨‹åºç‰ˆæœ¬å· 5,6ç­‰ appBase.setVc(&quot;&quot; + rand.nextInt(20)); &#x2F;&#x2F;ç¨‹åºç‰ˆæœ¬å v1.1.1 appBase.setVn(&quot;1.&quot; + rand.nextInt(4) + &quot;.&quot; + rand.nextInt(10)); &#x2F;&#x2F; å®‰å“ç³»ç»Ÿç‰ˆæœ¬ appBase.setOs(&quot;8.&quot; + rand.nextInt(3) + &quot;.&quot; + rand.nextInt(10)); &#x2F;&#x2F; è¯­è¨€ es,en,pt int flag &#x3D; rand.nextInt(3); switch (flag) &#123; case (0): appBase.setL(&quot;es&quot;); break; case (1): appBase.setL(&quot;en&quot;); break; case (2): appBase.setL(&quot;pt&quot;); break; &#125; &#x2F;&#x2F; æ¸ é“å· ä»å“ªä¸ªæ¸ é“æ¥çš„ appBase.setSr(getRandomChar(1)); &#x2F;&#x2F; åŒºåŸŸ flag &#x3D; rand.nextInt(2); switch (flag) &#123; case 0: appBase.setAr(&quot;BR&quot;); case 1: appBase.setAr(&quot;MX&quot;); &#125; &#x2F;&#x2F; æ‰‹æœºå“ç‰Œ ba ,æ‰‹æœºå‹å· mdï¼Œå°±å–2ä½æ•°å­—äº† flag &#x3D; rand.nextInt(3); switch (flag) &#123; case 0: appBase.setBa(&quot;Sumsung&quot;); appBase.setMd(&quot;sumsung-&quot; + rand.nextInt(20)); break; case 1: appBase.setBa(&quot;Huawei&quot;); appBase.setMd(&quot;Huawei-&quot; + rand.nextInt(20)); break; case 2: appBase.setBa(&quot;HTC&quot;); appBase.setMd(&quot;HTC-&quot; + rand.nextInt(20)); break; &#125; &#x2F;&#x2F; åµŒå…¥sdkçš„ç‰ˆæœ¬ appBase.setSv(&quot;V2.&quot; + rand.nextInt(10) + &quot;.&quot; + rand.nextInt(10)); &#x2F;&#x2F; gmail appBase.setG(getRandomCharAndNumr(8) + &quot;@gmail.com&quot;); &#x2F;&#x2F; å±å¹•å®½é«˜ hw flag &#x3D; rand.nextInt(4); switch (flag) &#123; case 0: appBase.setHw(&quot;640*960&quot;); break; case 1: appBase.setHw(&quot;640*1136&quot;); break; case 2: appBase.setHw(&quot;750*1134&quot;); break; case 3: appBase.setHw(&quot;1080*1920&quot;); break; &#125; &#x2F;&#x2F; å®¢æˆ·ç«¯äº§ç”Ÿæ—¥å¿—æ—¶é—´ long millis &#x3D; System.currentTimeMillis(); appBase.setT(&quot;&quot; + (millis - rand.nextInt(99999999))); &#x2F;&#x2F; æ‰‹æœºç½‘ç»œæ¨¡å¼ 3G,4G,WIFI flag &#x3D; rand.nextInt(3); switch (flag) &#123; case 0: appBase.setNw(&quot;3G&quot;); break; case 1: appBase.setNw(&quot;4G&quot;); break; case 2: appBase.setNw(&quot;WIFI&quot;); break; &#125; &#x2F;&#x2F; æ‹‰ä¸ç¾æ´² è¥¿ç»34Â°46â€²è‡³è¥¿ç»117Â°09ï¼›åŒ—çº¬32Â°42â€²è‡³å—çº¬53Â°54â€² &#x2F;&#x2F; ç»åº¦ appBase.setLn((-34 - rand.nextInt(83) - rand.nextInt(60) &#x2F; 10.0) + &quot;&quot;); &#x2F;&#x2F; çº¬åº¦ appBase.setLa((32 - rand.nextInt(85) - rand.nextInt(60) &#x2F; 10.0) + &quot;&quot;); return (JSONObject) JSON.toJSON(appBase); &#125; &#x2F;** * å•†å“å±•ç¤ºäº‹ä»¶ *&#x2F; private static JSONObject generateDisplay() &#123; AppDisplay appDisplay &#x3D; new AppDisplay(); boolean boolFlag &#x3D; rand.nextInt(10) &lt; 7; &#x2F;&#x2F; åŠ¨ä½œï¼šæ›å…‰å•†å“&#x3D;1ï¼Œç‚¹å‡»å•†å“&#x3D;2ï¼Œ if (boolFlag) &#123; appDisplay.setAction(&quot;1&quot;); &#125; else &#123; appDisplay.setAction(&quot;2&quot;); &#125; &#x2F;&#x2F; å•†å“id String goodsId &#x3D; s_goodsid + &quot;&quot;; s_goodsid++; appDisplay.setGoodsid(goodsId); &#x2F;&#x2F; é¡ºåº è®¾ç½®æˆ6æ¡å§ int flag &#x3D; rand.nextInt(6); appDisplay.setPlace(&quot;&quot; + flag); &#x2F;&#x2F; æ›å…‰ç±»å‹ flag &#x3D; 1 + rand.nextInt(2); appDisplay.setExtend1(&quot;&quot; + flag); &#x2F;&#x2F; åˆ†ç±» flag &#x3D; 1 + rand.nextInt(100); appDisplay.setCategory(&quot;&quot; + flag); JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(appDisplay); return packEventJson(&quot;display&quot;, jsonObject); &#125; &#x2F;** * å•†å“è¯¦æƒ…é¡µ *&#x2F; private static JSONObject generateNewsDetail() &#123; AppNewsDetail appNewsDetail &#x3D; new AppNewsDetail(); &#x2F;&#x2F; é¡µé¢å…¥å£æ¥æº int flag &#x3D; 1 + rand.nextInt(3); appNewsDetail.setEntry(flag + &quot;&quot;); &#x2F;&#x2F; åŠ¨ä½œ appNewsDetail.setAction(&quot;&quot; + (rand.nextInt(4) + 1)); &#x2F;&#x2F; å•†å“id appNewsDetail.setGoodsid(s_goodsid + &quot;&quot;); &#x2F;&#x2F; å•†å“æ¥æºç±»å‹ flag &#x3D; 1 + rand.nextInt(3); appNewsDetail.setShowtype(flag + &quot;&quot;); &#x2F;&#x2F; å•†å“æ ·å¼ flag &#x3D; rand.nextInt(6); appNewsDetail.setShowtype(&quot;&quot; + flag); &#x2F;&#x2F; é¡µé¢åœç•™æ—¶é•¿ flag &#x3D; rand.nextInt(10) * rand.nextInt(7); appNewsDetail.setNews_staytime(flag + &quot;&quot;); &#x2F;&#x2F; åŠ è½½æ—¶é•¿ flag &#x3D; rand.nextInt(10) * rand.nextInt(7); appNewsDetail.setLoading_time(flag + &quot;&quot;); &#x2F;&#x2F; åŠ è½½å¤±è´¥ç  flag &#x3D; rand.nextInt(10); switch (flag) &#123; case 1: appNewsDetail.setType1(&quot;102&quot;); break; case 2: appNewsDetail.setType1(&quot;201&quot;); break; case 3: appNewsDetail.setType1(&quot;325&quot;); break; case 4: appNewsDetail.setType1(&quot;433&quot;); break; case 5: appNewsDetail.setType1(&quot;542&quot;); break; default: appNewsDetail.setType1(&quot;&quot;); break; &#125; &#x2F;&#x2F; åˆ†ç±» flag &#x3D; 1 + rand.nextInt(100); appNewsDetail.setCategory(&quot;&quot; + flag); JSONObject eventJson &#x3D; (JSONObject) JSON.toJSON(appNewsDetail); return packEventJson(&quot;newsdetail&quot;, eventJson); &#125; &#x2F;** * å•†å“åˆ—è¡¨ *&#x2F; private static JSONObject generateNewList() &#123; AppLoading appLoading &#x3D; new AppLoading(); &#x2F;&#x2F; åŠ¨ä½œ int flag &#x3D; rand.nextInt(3) + 1; appLoading.setAction(flag + &quot;&quot;); &#x2F;&#x2F; åŠ è½½æ—¶é•¿ flag &#x3D; rand.nextInt(10) * rand.nextInt(7); appLoading.setLoading_time(flag + &quot;&quot;); &#x2F;&#x2F; å¤±è´¥ç  flag &#x3D; rand.nextInt(10); switch (flag) &#123; case 1: appLoading.setType1(&quot;102&quot;); break; case 2: appLoading.setType1(&quot;201&quot;); break; case 3: appLoading.setType1(&quot;325&quot;); break; case 4: appLoading.setType1(&quot;433&quot;); break; case 5: appLoading.setType1(&quot;542&quot;); break; default: appLoading.setType1(&quot;&quot;); break; &#125; &#x2F;&#x2F; é¡µé¢ åŠ è½½ç±»å‹ flag &#x3D; 1 + rand.nextInt(2); appLoading.setLoading_way(&quot;&quot; + flag); &#x2F;&#x2F; æ‰©å±•å­—æ®µ1 appLoading.setExtend1(&quot;&quot;); &#x2F;&#x2F; æ‰©å±•å­—æ®µ2 appLoading.setExtend2(&quot;&quot;); &#x2F;&#x2F; ç”¨æˆ·åŠ è½½ç±»å‹ flag &#x3D; 1 + rand.nextInt(3); appLoading.setType(&quot;&quot; + flag); JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(appLoading); return packEventJson(&quot;loading&quot;, jsonObject); &#125; &#x2F;** * å¹¿å‘Šç›¸å…³å­—æ®µ *&#x2F; private static JSONObject generateAd() &#123; AppAd appAd &#x3D; new AppAd(); &#x2F;&#x2F; å…¥å£ int flag &#x3D; rand.nextInt(3) + 1; appAd.setEntry(flag + &quot;&quot;); &#x2F;&#x2F; åŠ¨ä½œ flag &#x3D; rand.nextInt(5) + 1; appAd.setAction(flag + &quot;&quot;); &#x2F;&#x2F; å†…å®¹ç±»å‹ç±»å‹ flag &#x3D; rand.nextInt(6) + 1; appAd.setContentType(flag + &quot;&quot;); &#x2F;&#x2F; å±•ç¤ºæ ·å¼ flag &#x3D; rand.nextInt(120000) + 1000; appAd.setDisplayMills(flag + &quot;&quot;); flag &#x3D; rand.nextInt(1); if (flag &#x3D;&#x3D; 1) &#123; appAd.setContentType(flag + &quot;&quot;); flag &#x3D; rand.nextInt(6); appAd.setItemId(flag + &quot;&quot;); &#125; else &#123; appAd.setContentType(flag + &quot;&quot;); flag &#x3D; rand.nextInt(1) + 1; appAd.setActivityId(flag + &quot;&quot;); &#125; JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(appAd); return packEventJson(&quot;ad&quot;, jsonObject); &#125; &#x2F;** * å¯åŠ¨æ—¥å¿— *&#x2F; private static AppStart generateStart() &#123; AppStart appStart &#x3D; new AppStart(); &#x2F;&#x2F;è®¾å¤‡id appStart.setMid(s_mid + &quot;&quot;); s_mid++; &#x2F;&#x2F; ç”¨æˆ·id appStart.setUid(s_uid + &quot;&quot;); s_uid++; &#x2F;&#x2F; ç¨‹åºç‰ˆæœ¬å· 5,6ç­‰ appStart.setVc(&quot;&quot; + rand.nextInt(20)); &#x2F;&#x2F;ç¨‹åºç‰ˆæœ¬å v1.1.1 appStart.setVn(&quot;1.&quot; + rand.nextInt(4) + &quot;.&quot; + rand.nextInt(10)); &#x2F;&#x2F; å®‰å“ç³»ç»Ÿç‰ˆæœ¬ appStart.setOs(&quot;8.&quot; + rand.nextInt(3) + &quot;.&quot; + rand.nextInt(10)); &#x2F;&#x2F;è®¾ç½®æ—¥å¿—ç±»å‹ appStart.setEn(&quot;start&quot;); &#x2F;&#x2F; è¯­è¨€ es,en,pt int flag &#x3D; rand.nextInt(3); switch (flag) &#123; case (0): appStart.setL(&quot;es&quot;); break; case (1): appStart.setL(&quot;en&quot;); break; case (2): appStart.setL(&quot;pt&quot;); break; &#125; &#x2F;&#x2F; æ¸ é“å· ä»å“ªä¸ªæ¸ é“æ¥çš„ appStart.setSr(getRandomChar(1)); &#x2F;&#x2F; åŒºåŸŸ flag &#x3D; rand.nextInt(2); switch (flag) &#123; case 0: appStart.setAr(&quot;BR&quot;); case 1: appStart.setAr(&quot;MX&quot;); &#125; &#x2F;&#x2F; æ‰‹æœºå“ç‰Œ ba ,æ‰‹æœºå‹å· mdï¼Œå°±å–2ä½æ•°å­—äº† flag &#x3D; rand.nextInt(3); switch (flag) &#123; case 0: appStart.setBa(&quot;Sumsung&quot;); appStart.setMd(&quot;sumsung-&quot; + rand.nextInt(20)); break; case 1: appStart.setBa(&quot;Huawei&quot;); appStart.setMd(&quot;Huawei-&quot; + rand.nextInt(20)); break; case 2: appStart.setBa(&quot;HTC&quot;); appStart.setMd(&quot;HTC-&quot; + rand.nextInt(20)); break; &#125; &#x2F;&#x2F; åµŒå…¥sdkçš„ç‰ˆæœ¬ appStart.setSv(&quot;V2.&quot; + rand.nextInt(10) + &quot;.&quot; + rand.nextInt(10)); &#x2F;&#x2F; gmail appStart.setG(getRandomCharAndNumr(8) + &quot;@gmail.com&quot;); &#x2F;&#x2F; å±å¹•å®½é«˜ hw flag &#x3D; rand.nextInt(4); switch (flag) &#123; case 0: appStart.setHw(&quot;640*960&quot;); break; case 1: appStart.setHw(&quot;640*1136&quot;); break; case 2: appStart.setHw(&quot;750*1134&quot;); break; case 3: appStart.setHw(&quot;1080*1920&quot;); break; &#125; &#x2F;&#x2F; å®¢æˆ·ç«¯äº§ç”Ÿæ—¥å¿—æ—¶é—´ long millis &#x3D; System.currentTimeMillis(); appStart.setT(&quot;&quot; + (millis - rand.nextInt(99999999))); &#x2F;&#x2F; æ‰‹æœºç½‘ç»œæ¨¡å¼ 3G,4G,WIFI flag &#x3D; rand.nextInt(3); switch (flag) &#123; case 0: appStart.setNw(&quot;3G&quot;); break; case 1: appStart.setNw(&quot;4G&quot;); break; case 2: appStart.setNw(&quot;WIFI&quot;); break; &#125; &#x2F;&#x2F; æ‹‰ä¸ç¾æ´² è¥¿ç»34Â°46â€²è‡³è¥¿ç»117Â°09ï¼›åŒ—çº¬32Â°42â€²è‡³å—çº¬53Â°54â€² &#x2F;&#x2F; ç»åº¦ appStart.setLn((-34 - rand.nextInt(83) - rand.nextInt(60) &#x2F; 10.0) + &quot;&quot;); &#x2F;&#x2F; çº¬åº¦ appStart.setLa((32 - rand.nextInt(85) - rand.nextInt(60) &#x2F; 10.0) + &quot;&quot;); &#x2F;&#x2F; å…¥å£ flag &#x3D; rand.nextInt(5) + 1; appStart.setEntry(flag + &quot;&quot;); &#x2F;&#x2F; å¼€å±å¹¿å‘Šç±»å‹ flag &#x3D; rand.nextInt(2) + 1; appStart.setOpen_ad_type(flag + &quot;&quot;); &#x2F;&#x2F; çŠ¶æ€ flag &#x3D; rand.nextInt(10) &gt; 8 ? 2 : 1; appStart.setAction(flag + &quot;&quot;); &#x2F;&#x2F; åŠ è½½æ—¶é•¿ appStart.setLoading_time(rand.nextInt(20) + &quot;&quot;); &#x2F;&#x2F; å¤±è´¥ç  flag &#x3D; rand.nextInt(10); switch (flag) &#123; case 1: appStart.setDetail(&quot;102&quot;); break; case 2: appStart.setDetail(&quot;201&quot;); break; case 3: appStart.setDetail(&quot;325&quot;); break; case 4: appStart.setDetail(&quot;433&quot;); break; case 5: appStart.setDetail(&quot;542&quot;); break; default: appStart.setDetail(&quot;&quot;); break; &#125; &#x2F;&#x2F; æ‰©å±•å­—æ®µ appStart.setExtend1(&quot;&quot;); return appStart; &#125; &#x2F;** * æ¶ˆæ¯é€šçŸ¥ *&#x2F; private static JSONObject generateNotification() &#123; AppNotification appNotification &#x3D; new AppNotification(); int flag &#x3D; rand.nextInt(4) + 1; &#x2F;&#x2F; åŠ¨ä½œ appNotification.setAction(flag + &quot;&quot;); &#x2F;&#x2F; é€šçŸ¥id flag &#x3D; rand.nextInt(4) + 1; appNotification.setType(flag + &quot;&quot;); &#x2F;&#x2F; å®¢æˆ·ç«¯å¼¹æ—¶é—´ appNotification.setAp_time((System.currentTimeMillis() - rand.nextInt(99999999)) + &quot;&quot;); &#x2F;&#x2F; å¤‡ç”¨å­—æ®µ appNotification.setContent(&quot;&quot;); JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(appNotification); return packEventJson(&quot;notification&quot;, jsonObject); &#125; &#x2F;** * åå°æ´»è·ƒ *&#x2F; private static JSONObject generateBackground() &#123; AppActive appActive_background &#x3D; new AppActive(); &#x2F;&#x2F; å¯åŠ¨æº int flag &#x3D; rand.nextInt(3) + 1; appActive_background.setActive_source(flag + &quot;&quot;); JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(appActive_background); return packEventJson(&quot;active_background&quot;, jsonObject); &#125; &#x2F;** * é”™è¯¯æ—¥å¿—æ•°æ® *&#x2F; private static JSONObject generateError() &#123; AppErrorLog appErrorLog &#x3D; new AppErrorLog(); String[] errorBriefs &#x3D; &#123;&quot;at cn.lift.dfdf.web.AbstractBaseController.validInbound(AbstractBaseController.java:72)&quot;, &quot;at cn.lift.appIn.control.CommandUtil.getInfo(CommandUtil.java:67)&quot;&#125;; &#x2F;&#x2F;é”™è¯¯æ‘˜è¦ String[] errorDetails &#x3D; &#123;&quot;java.lang.NullPointerException\\\\n &quot; + &quot;at cn.lift.appIn.web.AbstractBaseController.validInbound(AbstractBaseController.java:72)\\\\n &quot; + &quot;at cn.lift.dfdf.web.AbstractBaseController.validInbound&quot;, &quot;at cn.lift.dfdfdf.control.CommandUtil.getInfo(CommandUtil.java:67)\\\\n &quot; + &quot;at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\\\\n&quot; + &quot; at java.lang.reflect.Method.invoke(Method.java:606)\\\\n&quot;&#125;; &#x2F;&#x2F;é”™è¯¯è¯¦æƒ… &#x2F;&#x2F;é”™è¯¯æ‘˜è¦ appErrorLog.setErrorBrief(errorBriefs[rand.nextInt(errorBriefs.length)]); &#x2F;&#x2F;é”™è¯¯è¯¦æƒ… appErrorLog.setErrorDetail(errorDetails[rand.nextInt(errorDetails.length)]); JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(appErrorLog); return packEventJson(&quot;error&quot;, jsonObject); &#125; &#x2F;** * ä¸ºå„ä¸ªäº‹ä»¶ç±»å‹çš„å…¬å…±å­—æ®µï¼ˆæ—¶é—´ã€äº‹ä»¶ç±»å‹ã€Jsonæ•°æ®ï¼‰æ‹¼æ¥ *&#x2F; private static JSONObject packEventJson(String eventName, JSONObject jsonObject) &#123; JSONObject eventJson &#x3D; new JSONObject(); eventJson.put(&quot;ett&quot;, (System.currentTimeMillis() - rand.nextInt(99999999)) + &quot;&quot;); eventJson.put(&quot;en&quot;, eventName); eventJson.put(&quot;kv&quot;, jsonObject); return eventJson; &#125; &#x2F;** * è·å–éšæœºå­—æ¯ç»„åˆ * * @param length å­—ç¬¦ä¸²é•¿åº¦ *&#x2F; private static String getRandomChar(Integer length) &#123; StringBuilder str &#x3D; new StringBuilder(); Random random &#x3D; new Random(); for (int i &#x3D; 0; i &lt; length; i++) &#123; &#x2F;&#x2F; å­—ç¬¦ä¸² str.append((char) (65 + random.nextInt(26)));&#x2F;&#x2F; å–å¾—å¤§å†™å­—æ¯ &#125; return str.toString(); &#125; &#x2F;** * è·å–éšæœºå­—æ¯æ•°å­—ç»„åˆ * * @param length å­—ç¬¦ä¸²é•¿åº¦ *&#x2F; private static String getRandomCharAndNumr(Integer length) &#123; StringBuilder str &#x3D; new StringBuilder(); Random random &#x3D; new Random(); for (int i &#x3D; 0; i &lt; length; i++) &#123; boolean b &#x3D; random.nextBoolean(); if (b) &#123; &#x2F;&#x2F; å­—ç¬¦ä¸² &#x2F;&#x2F; int choice &#x3D; random.nextBoolean() ? 65 : 97; å–å¾—65å¤§å†™å­—æ¯è¿˜æ˜¯97å°å†™å­—æ¯ str.append((char) (65 + random.nextInt(26)));&#x2F;&#x2F; å–å¾—å¤§å†™å­—æ¯ &#125; else &#123; &#x2F;&#x2F; æ•°å­— str.append(String.valueOf(random.nextInt(10))); &#125; &#125; return str.toString(); &#125; &#x2F;** * æ”¶è— *&#x2F; private static JSONObject generateFavorites() &#123; AppFavorites favorites &#x3D; new AppFavorites(); favorites.setCourse_id(rand.nextInt(10)); favorites.setUserid(rand.nextInt(10)); favorites.setAdd_time((System.currentTimeMillis() - rand.nextInt(99999999)) + &quot;&quot;); JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(favorites); return packEventJson(&quot;favorites&quot;, jsonObject); &#125; &#x2F;** * ç‚¹èµ *&#x2F; private static JSONObject generatePraise() &#123; AppPraise praise &#x3D; new AppPraise(); praise.setId(rand.nextInt(10)); praise.setUserid(rand.nextInt(10)); praise.setTarget_id(rand.nextInt(10)); praise.setType(rand.nextInt(4) + 1); praise.setAdd_time((System.currentTimeMillis() - rand.nextInt(99999999)) + &quot;&quot;); JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(praise); return packEventJson(&quot;praise&quot;, jsonObject); &#125; &#x2F;** * è¯„è®º *&#x2F; private static JSONObject generateComment() &#123; AppComment comment &#x3D; new AppComment(); comment.setComment_id(rand.nextInt(10)); comment.setUserid(rand.nextInt(10)); comment.setP_comment_id(rand.nextInt(5)); comment.setContent(getCONTENT()); comment.setAddtime((System.currentTimeMillis() - rand.nextInt(99999999)) + &quot;&quot;); comment.setOther_id(rand.nextInt(10)); comment.setPraise_count(rand.nextInt(1000)); comment.setReply_count(rand.nextInt(200)); JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(comment); return packEventJson(&quot;comment&quot;, jsonObject); &#125; &#x2F;** * ç”Ÿæˆå•ä¸ªæ±‰å­— *&#x2F; private static char getRandomChar() &#123; String str &#x3D; &quot;&quot;; int hightPos; &#x2F;&#x2F; int lowPos; Random random &#x3D; new Random(); &#x2F;&#x2F;éšæœºç”Ÿæˆæ±‰å­çš„ä¸¤ä¸ªå­—èŠ‚ hightPos &#x3D; (176 + Math.abs(random.nextInt(39))); lowPos &#x3D; (161 + Math.abs(random.nextInt(93))); byte[] b &#x3D; new byte[2]; b[0] &#x3D; (Integer.valueOf(hightPos)).byteValue(); b[1] &#x3D; (Integer.valueOf(lowPos)).byteValue(); try &#123; str &#x3D; new String(b, &quot;GBK&quot;); &#125; catch (UnsupportedEncodingException e) &#123; e.printStackTrace(); System.out.println(&quot;é”™è¯¯&quot;); &#125; return str.charAt(0); &#125; &#x2F;** * æ‹¼æ¥æˆå¤šä¸ªæ±‰å­— *&#x2F; private static String getCONTENT() &#123; StringBuilder str &#x3D; new StringBuilder(); for (int i &#x3D; 0; i &lt; rand.nextInt(100); i++) &#123; str.append(getRandomChar()); &#125; return str.toString(); &#125;&#125;2.4.5 å¯åŠ¨æµ‹è¯•æ³¨æ„ï¼Œéœ€è¦å°†æ—¥å¿—æ¨¡æ‹Ÿæ”¾åˆ°2å°æœåŠ¡å™¨ä¸Šï¼Œæ¨¡æ‹Ÿæ—¥å¿—æ¯ä¸€æ¡ä¸­å³åŒ…æ‹¬å…¬å…±æ—¥å¿—ï¼ŒåˆåŒ…å«äº‹ä»¶æ—¥å¿—ï¼Œéœ€è¦flumeæ‹¦æˆªå™¨è¿›è¡Œæ—¥å¿—åˆ†å‘ï¼Œå½“ç„¶ä¹Ÿéœ€è¦ä¸¤ä¸ªflume-ngæ¥åšè¿™ä¸ªäº‹æƒ…æ‰“åŒ…ä¸Šä¼ 2å°æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œç”Ÿäº§æ•°æ®ä¸ºåé¢çš„æµ‹è¯•åšå‡†å¤‡ï¼Œè¿™é‡Œä¸ºç”¨æˆ·ç›®å½•testæ–‡ä»¶å¤¹ä¸‹é€šè¿‡å‚æ•°æ§åˆ¶ç”Ÿæˆæ¶ˆæ¯é€Ÿåº¦åŠäº§é‡(å¦‚ä¸‹ 2ç§’ä¸€æ¡ï¼Œæ‰“å°1000æ¡)1234#æ§åˆ¶æ—¶é—´åŠæ¡æ•°nohup java -jar data-producer-1.0-SNAPSHOT-jar-with-dependencies.jar 2000 1000 &amp;#ç›‘æ§æ—¥å¿—tail -F &#x2F;root&#x2F;logs&#x2F;*.logé€šè¿‡www.json.cnæŸ¥çœ‹æ•°æ®æ ¼å¼3 åˆ›å»ºKafKa-Topicåˆ›å»ºå¯åŠ¨æ—¥å¿—ä¸»é¢˜ï¼štopic_startåˆ›å»ºäº‹ä»¶æ—¥å¿—ä¸»é¢˜ï¼štopic_event4 Flumeå‡†å¤‡å…±åˆ†ä¸º2ç»„flumeç¬¬ä¸€ç»„ï¼šå°†æœåŠ¡å™¨æ—¥å¿—æ”¶é›†ï¼Œå¹¶ä½¿ç”¨Kafka-Channelså°†æ•°æ®å‘å¾€Kafkaä¸åŒçš„Topicï¼Œå…¶ä¸­ä½¿ç”¨æ‹¦æˆªå™¨è¿›è¡Œå…¬å…±æ—¥å¿—å’Œäº‹ä»¶æ—¥å¿—çš„åˆ†å‘ï¼Œç¬¬äºŒç»„ï¼šæ”¶é›†Kafkaæ•°æ®ï¼Œä½¿ç”¨Flie-Channelsç¼“å­˜æ•°æ®ï¼Œæœ€ç»ˆå‘å¾€Hdfsä¿å­˜4.1 Flumeï¼šFile-&gt;Kafkaé…ç½®ç¼–å†™vim /root/test/file-flume-kafka.conf1234567891011121314151617181920212223242526272829#1 å®šä¹‰ç»„ä»¶a1.sources&#x3D;r1a1.channels&#x3D;c1 c2# 2 sourceé…ç½® typeç±»å‹ positionFileè®°å½•æ—¥å¿—è¯»å–ä½ç½® filegroupsè¯»å–å“ªäº›ç›®å½• app.+ä¸ºè¯»å–ä»€ä¹ˆå¼€å¤´ channelså‘å¾€å“ªé‡Œa1.sources.r1.type &#x3D; TAILDIRa1.sources.r1.positionFile &#x3D; &#x2F;root&#x2F;test&#x2F;flume&#x2F;log_position.jsona1.sources.r1.filegroups &#x3D; f1a1.sources.r1.filegroups.f1 &#x3D; &#x2F;root&#x2F;logs&#x2F;app.+a1.sources.r1.fileHeader &#x3D; truea1.sources.r1.channels &#x3D; c1 c2#3 æ‹¦æˆªå™¨ è¿™é‡Œ2ä¸ªä¸ºè‡ªå®šä¹‰çš„æ‹¦æˆªå™¨ multiplexingä¸ºç±»å‹åŒºåˆ†é€‰æ‹©å™¨ headerå¤´ç”¨äºåŒºåˆ†ç±»å‹ mappingåŒ¹é…å¤´a1.sources.r1.interceptors &#x3D; i1 i2a1.sources.r1.interceptors.i1.type &#x3D; com.heaton.bigdata.flume.LogETLInterceptor$Buildera1.sources.r1.interceptors.i2.type &#x3D; com.heaton.bigdata.flume.LogTypeInterceptor$Buildera1.sources.r1.selector.type &#x3D; multiplexinga1.sources.r1.selector.header &#x3D; topica1.sources.r1.selector.mapping.topic_start &#x3D; c1a1.sources.r1.selector.mapping.topic_event &#x3D; c2#4 channelé…ç½® kafkaChannela1.channels.c1.type &#x3D; org.apache.flume.channel.kafka.KafkaChannela1.channels.c1.kafka.bootstrap.servers &#x3D; cdh01.cm:9092,cdh02.cm:9092,cdh03.cm:9092a1.channels.c1.kafka.topic &#x3D; topic_starta1.channels.c1.parseAsFlumeEvent &#x3D; falsea1.channels.c1.kafka.consumer.group.id &#x3D; flume-consumera1.channels.c2.type &#x3D;org.apache.flume.channel.kafka.KafkaChannela1.channels.c2.kafka.bootstrap.servers &#x3D; cdh01.cm:9092,cdh02.cm:9092,cdh03.cm:9092a1.channels.c2.kafka.topic &#x3D; topic_eventa1.channels.c2.parseAsFlumeEvent &#x3D; falsea1.channels.c2.kafka.consumer.group.id &#x3D; flume-consumeråœ¨ç”Ÿäº§æ—¥å¿—çš„2å°æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šåˆ›å»ºflumeé…ç½®æ–‡ä»¶ã€‚LogETLInterceptorï¼ŒLogTypeInterceptorä¸ºè‡ªå®šä¹‰æ‹¦æˆª4.2 è‡ªå®šä¹‰æ‹¦æˆªå™¨data-flumeå·¥ç¨‹LogUtils123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960import org.apache.commons.lang.math.NumberUtils;public class LogUtils &#123; public static boolean validateEvent(String log) &#123; &#x2F;** æœåŠ¡å™¨æ—¶é—´ | json 1588319303710|&#123; &quot;cm&quot;:&#123; &quot;ln&quot;:&quot;-51.5&quot;,&quot;sv&quot;:&quot;V2.0.7&quot;,&quot;os&quot;:&quot;8.0.8&quot;,&quot;g&quot;:&quot;L1470998@gmail.com&quot;,&quot;mid&quot;:&quot;13&quot;, &quot;nw&quot;:&quot;4G&quot;,&quot;l&quot;:&quot;en&quot;,&quot;vc&quot;:&quot;7&quot;,&quot;hw&quot;:&quot;640*960&quot;,&quot;ar&quot;:&quot;MX&quot;,&quot;uid&quot;:&quot;13&quot;,&quot;t&quot;:&quot;1588291826938&quot;, &quot;la&quot;:&quot;-38.2&quot;,&quot;md&quot;:&quot;Huawei-14&quot;,&quot;vn&quot;:&quot;1.3.6&quot;,&quot;ba&quot;:&quot;Huawei&quot;,&quot;sr&quot;:&quot;Y&quot; &#125;, &quot;ap&quot;:&quot;app&quot;, &quot;et&quot;:[&#123; &quot;ett&quot;:&quot;1588228193191&quot;,&quot;en&quot;:&quot;ad&quot;,&quot;kv&quot;:&#123;&quot;activityId&quot;:&quot;1&quot;,&quot;displayMills&quot;:&quot;113201&quot;,&quot;entry&quot;:&quot;3&quot;,&quot;action&quot;:&quot;5&quot;,&quot;contentType&quot;:&quot;0&quot;&#125; &#125;,&#123; &quot;ett&quot;:&quot;1588300304713&quot;,&quot;en&quot;:&quot;notification&quot;,&quot;kv&quot;:&#123;&quot;ap_time&quot;:&quot;1588277440794&quot;,&quot;action&quot;:&quot;2&quot;,&quot;type&quot;:&quot;3&quot;,&quot;content&quot;:&quot;&quot;&#125; &#125;,&#123; &quot;ett&quot;:&quot;1588249203743&quot;,&quot;en&quot;:&quot;active_background&quot;,&quot;kv&quot;:&#123;&quot;active_source&quot;:&quot;3&quot;&#125; &#125;,&#123; &quot;ett&quot;:&quot;1588254200122&quot;,&quot;en&quot;:&quot;favorites&quot;,&quot;kv&quot;:&#123;&quot;course_id&quot;:5,&quot;id&quot;:0,&quot;add_time&quot;:&quot;1588264138625&quot;,&quot;userid&quot;:0&#125; &#125;,&#123; &quot;ett&quot;:&quot;1588281152824&quot;,&quot;en&quot;:&quot;praise&quot;,&quot;kv&quot;:&#123;&quot;target_id&quot;:4,&quot;id&quot;:3,&quot;type&quot;:3,&quot;add_time&quot;:&quot;1588307696417&quot;,&quot;userid&quot;:8&#125; &#125;] &#125; *&#x2F; &#x2F;&#x2F; 1 åˆ‡å‰² String[] logContents &#x3D; log.split(&quot;\\\\|&quot;); &#x2F;&#x2F; 2 æ ¡éªŒ if (logContents.length !&#x3D; 2) &#123; return false; &#125; &#x2F;&#x2F;3 æ ¡éªŒæœåŠ¡å™¨æ—¶é—´ if (logContents[0].length() !&#x3D; 13 || !NumberUtils.isDigits(logContents[0])) &#123; return false; &#125; &#x2F;&#x2F; 4 æ ¡éªŒ json if (!logContents[1].trim().startsWith(&quot;&#123;&quot;) || !logContents[1].trim().endsWith(&quot;&#125;&quot;)) &#123; return false; &#125; return true; &#125; public static boolean validateStart(String log) &#123; &#x2F;** &#123; &quot;action&quot;:&quot;1&quot;,&quot;ar&quot;:&quot;MX&quot;,&quot;ba&quot;:&quot;HTC&quot;,&quot;detail&quot;:&quot;201&quot;,&quot;en&quot;:&quot;start&quot;,&quot;entry&quot;:&quot;4&quot;,&quot;extend1&quot;:&quot;&quot;, &quot;g&quot;:&quot;4Z174142@gmail.com&quot;,&quot;hw&quot;:&quot;750*1134&quot;,&quot;l&quot;:&quot;pt&quot;,&quot;la&quot;:&quot;-29.7&quot;,&quot;ln&quot;:&quot;-48.1&quot;,&quot;loading_time&quot;:&quot;0&quot;, &quot;md&quot;:&quot;HTC-18&quot;,&quot;mid&quot;:&quot;14&quot;,&quot;nw&quot;:&quot;3G&quot;,&quot;open_ad_type&quot;:&quot;2&quot;,&quot;os&quot;:&quot;8.0.8&quot;,&quot;sr&quot;:&quot;D&quot;,&quot;sv&quot;:&quot;V2.8.2&quot;, &quot;t&quot;:&quot;1588251833523&quot;,&quot;uid&quot;:&quot;14&quot;,&quot;vc&quot;:&quot;15&quot;,&quot;vn&quot;:&quot;1.2.9&quot; &#125; *&#x2F; if (log &#x3D;&#x3D; null) &#123; return false; &#125; &#x2F;&#x2F; æ ¡éªŒ json if (!log.trim().startsWith(&quot;&#123;&quot;) || !log.trim().endsWith(&quot;&#125;&quot;)) &#123; return false; &#125; return true; &#125;&#125;LogETLInterceptor123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354import org.apache.flume.Context;import org.apache.flume.Event;import org.apache.flume.interceptor.Interceptor;import java.nio.charset.Charset;import java.util.ArrayList;import java.util.List;public class LogETLInterceptor implements Interceptor &#123; @Override public void initialize() &#123; &#x2F;&#x2F;åˆå§‹åŒ– &#125; @Override public Event intercept(Event event) &#123; &#x2F;&#x2F; 1 è·å–æ•°æ® byte[] body &#x3D; event.getBody(); String log &#x3D; new String(body, Charset.forName(&quot;UTF-8&quot;)); &#x2F;&#x2F; 2 åˆ¤æ–­æ•°æ®ç±»å‹å¹¶å‘ Header ä¸­èµ‹å€¼ if (log.contains(&quot;start&quot;)) &#123; if (LogUtils.validateStart(log)) &#123; return event; &#125; &#125; else &#123; if (LogUtils.validateEvent(log)) &#123; return event; &#125; &#125; &#x2F;&#x2F; 3 è¿”å›æ ¡éªŒç»“æœ return null; &#125; @Override public List&lt;Event&gt; intercept(List&lt;Event&gt; events) &#123; ArrayList&lt;Event&gt; interceptors &#x3D; new ArrayList&lt;&gt;(); for (Event event : events) &#123; Event intercept1 &#x3D; intercept(event); if (intercept1 !&#x3D; null) &#123; interceptors.add(intercept1); &#125; &#125; return interceptors; &#125; @Override public void close() &#123; &#x2F;&#x2F;å…³é—­ &#125; public static class Builder implements Interceptor.Builder &#123; @Override public Interceptor build() &#123; return new LogETLInterceptor(); &#125; @Override public void configure(Context context) &#123; &#125; &#125;&#125;LogTypeInterceptor12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849import org.apache.flume.Context;import org.apache.flume.Event;import org.apache.flume.interceptor.Interceptor;import java.nio.charset.Charset;import java.util.ArrayList;import java.util.List;import java.util.Map;public class LogTypeInterceptor implements Interceptor &#123; @Override public void initialize() &#123; &#125; @Override public Event intercept(Event event) &#123; &#x2F;&#x2F; åŒºåˆ†æ—¥å¿—ç±»å‹ï¼š body header &#x2F;&#x2F; 1 è·å– body æ•°æ® byte[] body &#x3D; event.getBody(); String log &#x3D; new String(body, Charset.forName(&quot;UTF-8&quot;)); &#x2F;&#x2F; 2 è·å– header Map&lt;String, String&gt; headers &#x3D; event.getHeaders(); &#x2F;&#x2F; 3 åˆ¤æ–­æ•°æ®ç±»å‹å¹¶å‘ Header ä¸­èµ‹å€¼ if (log.contains(&quot;start&quot;)) &#123; headers.put(&quot;topic&quot;, &quot;topic_start&quot;); &#125; else &#123; headers.put(&quot;topic&quot;, &quot;topic_event&quot;); &#125; return event; &#125; @Override public List&lt;Event&gt; intercept(List&lt;Event&gt; events) &#123; ArrayList&lt;Event&gt; interceptors &#x3D; new ArrayList&lt;&gt;(); for (Event event : events) &#123; Event intercept1 &#x3D; intercept(event); interceptors.add(intercept1); &#125; return interceptors; &#125; @Override public void close() &#123; &#125; public static class Builder implements Interceptor.Builder &#123; @Override public Interceptor build() &#123; return new LogTypeInterceptor(); &#125; @Override public void configure(Context context) &#123; &#125; &#125;&#125;å°†é¡¹ç›®æ‰“åŒ…æ”¾å…¥Flume/libç›®å½•ä¸‹(æ‰€æœ‰èŠ‚ç‚¹)ï¼šCDHè·¯å¾„å‚è€ƒï¼š/opt/cloudera/parcels/CDH-6.2.0-1.cdh6.2.0.p0.967373/lib/flume-ng/lib4.3 Flumeå¯åœè„šæœ¬vim /root/log-kafka-flume.sh1234567891011121314151617#! &#x2F;bin&#x2F;bashcase $1 in&quot;start&quot;)&#123; for i in cdh02.cm cdh03.cm do echo &quot; --------å¯åŠ¨ $i æ¶ˆè´¹ flume-------&quot; ssh $i &quot;nohup flume-ng agent --conf-file &#x2F;root&#x2F;test&#x2F;file-flume-kafka.conf --name a1 -Dflume.root.logger&#x3D;INFO,LOGFILE &gt;&#x2F;root&#x2F;test&#x2F;file-flume-kafka.log 2&gt;&amp;1 &amp;&quot; done&#125;;;&quot;stop&quot;)&#123; for i in cdh02.cm cdh03.cm do echo &quot; --------åœæ­¢ $i æ¶ˆè´¹ flume-------&quot; ssh $i &quot;ps -ef | grep file-flume-kafka | grep -v grep |awk &#39;&#123;print \\$2&#125;&#39; | xargs kill&quot; done&#125;;;esac4.4 Flumeï¼šKafka-&gt;HDFSé…ç½®ç¼–å†™åœ¨ç¬¬ä¸‰å°æœåŠ¡ä¸Šå‡†å¤‡vim /root/test/kafka-flume-hdfs.conf12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364## ç»„ä»¶ a1.sources&#x3D;r1 r2a1.channels&#x3D;c1 c2 a1.sinks&#x3D;k1 k2 ## Kafka-source1a1.sources.r1.type &#x3D; org.apache.flume.source.kafka.KafkaSourcea1.sources.r1.batchSize &#x3D; 5000a1.sources.r1.batchDurationMillis &#x3D; 2000a1.sources.r1.kafka.bootstrap.servers&#x3D; cdh01.cm:9092,cdh02.cm:9092,cdh03.cm:9092a1.sources.r1.kafka.topics &#x3D; topic_start## Kafka- source2a1.sources.r2.type &#x3D; org.apache.flume.source.kafka.KafkaSourcea1.sources.r2.batchSize &#x3D; 5000a1.sources.r2.batchDurationMillis &#x3D; 2000a1.sources.r2.kafka.bootstrap.servers &#x3D; cdh01.cm:9092,cdh02.cm:9092,cdh03.cm:9092a1.sources.r2.kafka.topics &#x3D; topic_event ## channel1a1.channels.c1.type &#x3D; file##ç´¢å¼•æ–‡ä»¶è·¯å¾„a1.channels.c1.checkpointDir&#x3D;&#x2F;root&#x2F;test&#x2F;flume&#x2F;checkpoint&#x2F;behavior1##æŒä¹…åŒ–è·¯å¾„a1.channels.c1.dataDirs &#x3D; &#x2F;root&#x2F;test&#x2F;flume&#x2F;data&#x2F;behavior1&#x2F;a1.channels.c1.maxFileSize &#x3D; 2146435071a1.channels.c1.capacity &#x3D; 1000000a1.channels.c1.keep-alive &#x3D; 6## channel2a1.channels.c2.type &#x3D; file##ç´¢å¼•æ–‡ä»¶è·¯å¾„a1.channels.c1.checkpointDir&#x3D;&#x2F;root&#x2F;test&#x2F;flume&#x2F;checkpoint&#x2F;behavior2##æŒä¹…åŒ–è·¯å¾„a1.channels.c1.dataDirs &#x3D; &#x2F;root&#x2F;test&#x2F;flume&#x2F;data&#x2F;behavior2&#x2F;a1.channels.c2.maxFileSize &#x3D; 2146435071a1.channels.c2.capacity &#x3D; 1000000a1.channels.c2.keep-alive &#x3D; 6 ## HDFS-sink1a1.sinks.k1.type &#x3D; hdfsa1.sinks.k1.hdfs.path&#x3D;&#x2F;origin_data&#x2F;gmall&#x2F;log&#x2F;topic_start&#x2F;%Y-%m-%da1.sinks.k1.hdfs.filePrefix &#x3D; logstart-## HDFS-sink2 a1.sinks.k2.type &#x3D; hdfsa1.sinks.k2.hdfs.path &#x3D; &#x2F;origin_data&#x2F;gmall&#x2F;log&#x2F;topic_event&#x2F;%Y-%m-%da1.sinks.k2.hdfs.filePrefix &#x3D; logevent- ## ä¸è¦äº§ç”Ÿå¤§é‡å°æ–‡ä»¶a1.sinks.k1.hdfs.rollInterval &#x3D; 10a1.sinks.k1.hdfs.rollSize &#x3D; 134217728a1.sinks.k1.hdfs.rollCount &#x3D; 0a1.sinks.k2.hdfs.rollInterval &#x3D; 50a1.sinks.k2.hdfs.rollSize &#x3D; 134217728a1.sinks.k2.hdfs.rollCount &#x3D; 0## æ§åˆ¶è¾“å‡ºæ–‡ä»¶æ˜¯åŸç”Ÿæ–‡ä»¶ã€‚a1.sinks.k1.hdfs.fileType &#x3D; CompressedStreama1.sinks.k2.hdfs.fileType &#x3D; CompressedStreama1.sinks.k1.hdfs.codeC &#x3D; snappya1.sinks.k2.hdfs.codeC &#x3D; snappy ## ç»„ä»¶æ‹¼è£…a1.sources.r1.channels &#x3D; c1a1.sinks.k1.channel&#x3D; c1a1.sources.r2.channels &#x3D; c2a1.sinks.k2.channel&#x3D; c24.5 Flumeå¯åœè„šæœ¬åœ¨ç¬¬ä¸‰å°æœåŠ¡ä¸Šå‡†å¤‡vim /root/test/kafka-hdfs-flume.sh1234567891011121314151617#! &#x2F;bin&#x2F;bashcase $1 in&quot;start&quot;)&#123; for i in cdh01.cm do echo &quot; --------å¯åŠ¨ $i æ¶ˆè´¹ flume-------&quot; ssh $i &quot;nohup flume-ng agent --conf-file &#x2F;root&#x2F;test&#x2F;kafka-flume-hdfs.conf --name a1 -Dflume.root.logger&#x3D;INFO,LOGFILE &gt;&#x2F;root&#x2F;test&#x2F;kafka-flume-hdfs.log 2&gt;&amp;1 &amp;&quot; done&#125;;;&quot;stop&quot;)&#123; for i in cdh01.cm do echo &quot; --------åœæ­¢ $i æ¶ˆè´¹ flume-------&quot; ssh $i &quot;ps -ef | grep kafka-flume-hdfs | grep -v grep |awk &#39;&#123;print \\$2&#125;&#39; | xargs kill&quot; done&#125;;;esac5 ä¸šåŠ¡æ•°æ®æ­¤æ¨¡å—åä¸»è¦é’ˆå¯¹äºä¼ä¸šæŠ¥è¡¨å†³ç­–ï¼Œä¸ºæ•°æ®åˆ†ææä¾›æ•°æ®æ”¯æŒï¼Œè§£å†³å¤§æ•°æ®é‡ä¸‹ï¼Œæ— æ³•å¿«é€Ÿäº§å‡ºæŠ¥è¡¨ï¼ŒåŠä¸€äº›å³å¸­ä¸šåŠ¡éœ€æ±‚çš„å¿«é€Ÿå±•ç¤ºæä¾›æ•°æ®æ”¯æ’‘ã€‚åˆ’åˆ†ä¼ä¸šç¦»çº¿ä¸å®æ—¶ä¸šåŠ¡ï¼Œç”¨ç¦»çº¿çš„æ–¹å¼ç›´è§‚çš„ç®¡ç†æ•°æ®å‘ˆç°ï¼Œä¸ºå®æ—¶æ–¹æ¡ˆå¥ å®šè‰¯å¥½åŸºç¡€ã€‚5.1 ç”µå•†ä¸šåŠ¡æµç¨‹5.2 SKU-SPUSKUï¼ˆStock Keeping Unitï¼‰ï¼šåº“å­˜é‡åŸºæœ¬å•ä½ï¼Œç°åœ¨å·²ç»è¢«å¼•ç”³ä¸ºäº§å“ç»Ÿä¸€ç¼–å·çš„ç®€ç§°ï¼Œ æ¯ç§äº§å“å‡å¯¹åº”æœ‰å”¯ä¸€çš„ SKU å·ã€‚SPUï¼ˆStandard Product Unitï¼‰ï¼šæ˜¯å•†å“ä¿¡æ¯èšåˆçš„æœ€å°å•ä½ï¼Œæ˜¯ä¸€ç»„å¯å¤ç”¨ã€æ˜“æ£€ç´¢çš„ æ ‡å‡†åŒ–ä¿¡æ¯é›†åˆã€‚æ€»ç»“ï¼šé»‘é²¨3 æ‰‹æœºå°±æ˜¯ SPUã€‚ä¸€å°é“ ç”²ç°ã€256G å†…å­˜çš„å°±æ˜¯ SKUã€‚5.3 ä¸šåŠ¡è¡¨ç»“æ„5.3.1 è®¢å•è¡¨ï¼ˆorder_infoï¼‰5.3.2 è®¢å•è¯¦æƒ…è¡¨ï¼ˆorder_detailï¼‰5.3.3 SKU å•†å“è¡¨ï¼ˆsku_infoï¼‰5.3.4 ç”¨æˆ·è¡¨ï¼ˆuser_infoï¼‰5.3.5 å•†å“ä¸€çº§åˆ†ç±»è¡¨ï¼ˆbase_category1ï¼‰5.3.6 å•†å“äºŒçº§åˆ†ç±»è¡¨ï¼ˆbase_category2ï¼‰5.3.7 å•†å“ä¸‰çº§åˆ†ç±»è¡¨ï¼ˆbase_category3ï¼‰5.3.8 æ”¯ä»˜æµæ°´è¡¨ï¼ˆpayment_infoï¼‰5.3.9 çœä»½è¡¨ï¼ˆbase_provinceï¼‰5.3.10 åœ°åŒºè¡¨ï¼ˆbase_regionï¼‰5.3.11 å“ç‰Œè¡¨ï¼ˆbase_trademarkï¼‰5.3.12 è®¢å•çŠ¶æ€è¡¨ï¼ˆorder_status_logï¼‰5.3.13 SPU å•†å“è¡¨ï¼ˆspu_infoï¼‰5.3.14 å•†å“è¯„è®ºè¡¨ï¼ˆcomment_infoï¼‰5.3.15 é€€å•è¡¨ï¼ˆorder_refund_infoï¼‰5.3.16 åŠ å…¥è´­ç‰©è½¦è¡¨ï¼ˆcart_infoï¼‰5.3.17 å•†å“æ”¶è—è¡¨ï¼ˆfavor_infoï¼‰5.3.18 ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨ï¼ˆcoupon_useï¼‰5.3.19 ä¼˜æƒ åˆ¸è¡¨ï¼ˆcoupon_infoï¼‰5.3.20 æ´»åŠ¨è¡¨ï¼ˆactivity_infoï¼‰5.3.21 æ´»åŠ¨è®¢å•å…³è”è¡¨ï¼ˆactivity_orderï¼‰5.3.22 ä¼˜æƒ è§„åˆ™è¡¨ï¼ˆactivity_ruleï¼‰5.3.23 ç¼–ç å­—å…¸è¡¨ï¼ˆbase_dicï¼‰5.3.24 æ´»åŠ¨å‚ä¸å•†å“è¡¨ï¼ˆactivity_skuï¼‰5.4 æ—¶é—´è¡¨ç»“æ„5.4.1 æ—¶é—´è¡¨ï¼ˆdate_infoï¼‰5.4.2 å‡æœŸè¡¨ï¼ˆholiday_infoï¼‰5.4.3 å‡æœŸå¹´è¡¨ï¼ˆholiday_yearï¼‰6 åŒæ­¥ç­–ç•¥åŠæ•°ä»“åˆ†å±‚æ•°æ®åŒæ­¥ç­–ç•¥çš„ç±»å‹åŒ…æ‹¬ï¼šå…¨é‡è¡¨ã€å¢é‡è¡¨ã€æ–°å¢åŠå˜åŒ–è¡¨å…¨é‡è¡¨ï¼šæ¯å¤©ä¸€ä¸ªåˆ†åŒºï¼Œå­˜å‚¨å®Œæ•´çš„æ•°æ®ã€‚å¢é‡è¡¨ï¼šæ¯å¤©æ–°å¢æ•°æ®æ”¾åœ¨ä¸€ä¸ªåˆ†åŒºï¼Œå­˜å‚¨æ–°å¢åŠ çš„æ•°æ®ã€‚æ–°å¢åŠå˜åŒ–è¡¨ï¼šæ¯å¤©æ–°å¢å’Œå˜åŒ–çš„æ•°æ®æ”¾åœ¨ä¸€ä¸ªåˆ†åŒºï¼Œå­˜å‚¨æ–°å¢åŠ çš„æ•°æ®å’Œå˜åŒ–çš„æ•°æ®ã€‚ç‰¹æ®Šè¡¨ï¼šæ²¡æœ‰åˆ†åŒºï¼Œåªéœ€è¦å­˜å‚¨ä¸€æ¬¡ã€‚6.1 å…¨é‡ç­–ç•¥æ¯æ—¥å…¨é‡ï¼Œæ¯å¤©å­˜å‚¨ä¸€ä»½å®Œæ•´æ•°æ®ï¼Œä½œä¸ºä¸€ä¸ªåˆ†åŒºã€‚é€‚åˆåœºæ™¯ï¼šè¡¨æ•°æ®é‡ä¸å¤§ï¼Œä¸”æœ‰æ–°å¢æˆ–ä¿®æ”¹ä¸šåŠ¡çš„åœºæ™¯ä¾‹å¦‚ï¼šå“ç‰Œè¡¨ã€ç¼–ç è¡¨ã€å•†å“åˆ†ç±»è¡¨ã€ä¼˜æƒ è§„åˆ™è¡¨ã€æ´»åŠ¨è¡¨ã€å•†å“è¡¨ã€åŠ è´­è¡¨ã€æ”¶è—è¡¨ã€SKU/SPUè¡¨6.2 å¢é‡ç­–ç•¥æ¯æ—¥å¢é‡ï¼Œæ¯å¤©å‚¨å­˜ä¸€ä»½å¢é‡æ•°æ®ï¼Œä½œä¸ºä¸€ä¸ªåˆ†åŒºé€‚åˆåœºæ™¯ï¼šè¡¨æ•°æ®é‡å¤§ï¼Œä¸”åªä¼šæœ‰æ–°å¢æ•°æ®çš„åœºæ™¯ã€‚ä¾‹å¦‚ï¼šé€€å•è¡¨ã€è®¢å•çŠ¶æ€è¡¨ã€æ”¯ä»˜æµæ°´è¡¨ã€è®¢å•è¯¦æƒ…è¡¨ã€æ´»åŠ¨ä¸è®¢å•å…³è”è¡¨ã€å•†å“è¯„è®ºè¡¨6.3 æ–°å¢åŠå˜åŒ–ç­–ç•¥æ¯æ—¥æ–°å¢åŠå˜åŒ–ï¼Œå‚¨å­˜åˆ›å»ºæ—¶é—´å’Œæ“ä½œæ—¶é—´éƒ½æ˜¯ä»Šå¤©çš„æ•°æ®ï¼Œä½œä¸ºä¸€ä¸ªåˆ†åŒºé€‚åˆåœºæ™¯ï¼šè¡¨æ•°æ®é‡å¤§ï¼Œæ—¢ä¼šæœ‰æ–°å¢ï¼Œåˆä¼šæœ‰ä¿®æ”¹ã€‚ä¾‹å¦‚ï¼šç”¨æˆ·è¡¨ã€è®¢å•è¡¨ã€ä¼˜æƒ å·é¢†ç”¨è¡¨ã€‚6.4 ç‰¹æ®Šç­–ç•¥æŸäº›ç‰¹æ®Šçš„ç»´åº¦è¡¨ï¼Œå¯ä¸å¿…éµå¾ªä¸Šè¿°åŒæ­¥ç­–ç•¥ï¼Œåœ¨æ•°ä»“ä¸­åªåšä¸€æ¬¡åŒæ­¥ï¼Œæ•°æ®ä¸å˜åŒ–ä¸æ›´æ–°é€‚åˆåœºæ™¯ï¼šè¡¨æ•°æ®å‡ ä¹ä¸ä¼šå˜åŒ–1.å®¢è§‚ä¸–ç•Œç»´åº¦ï¼šæ²¡å˜åŒ–çš„å®¢è§‚ä¸–ç•Œçš„ç»´åº¦ï¼ˆæ¯”å¦‚æ€§åˆ«ï¼Œåœ°åŒºï¼Œæ°‘æ—ï¼Œæ”¿æ²»æˆåˆ†ï¼Œé‹å­å°ºç ï¼‰å¯ä»¥åªå­˜ä¸€ ä»½å›ºå®šå€¼2.æ—¥æœŸç»´åº¦ï¼šæ—¥æœŸç»´åº¦å¯ä»¥ä¸€æ¬¡æ€§å¯¼å…¥ä¸€å¹´æˆ–è‹¥å¹²å¹´çš„æ•°æ®ã€‚3.åœ°åŒºç»´åº¦ï¼šçœä»½è¡¨ã€åœ°åŒºè¡¨6.5 åˆ†æä¸šåŠ¡è¡¨åŒæ­¥ç­–ç•¥è€ƒè™‘åˆ°ç‰¹æ®Šè¡¨å¯èƒ½ä¼šç¼“æ…¢å˜åŒ–ï¼Œæ¯”å¦‚æ‰“ä»—å åœ°ç›˜ï¼Œåœ°åŒºè¡¨å¯èƒ½å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ•…ä¹Ÿé€‰æ‹©åˆ†åŒºå…¨é‡åŒæ­¥ç­–ç•¥ã€‚6.6 æ•°ä»“åˆ†å±‚ä¸ºä»€ä¹ˆåˆ†å±‚ï¼šç®€å•åŒ–ï¼šæŠŠå¤æ‚çš„ä»»åŠ¡åˆ†è§£ä¸ºå¤šå±‚æ¥å®Œæˆï¼Œæ¯å±‚å¤„ç†å„è‡ªçš„ä»»åŠ¡ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜ã€‚å‡å°‘é‡å¤å¼€å‘ï¼šè§„èŒƒæ•°æ®åˆ†å±‚ï¼Œé€šè¿‡ä¸­é—´å±‚æ•°æ®ï¼Œèƒ½å¤Ÿæå¤§çš„å‡å°‘é‡å¤è®¡ç®—ï¼Œå¢åŠ ç»“æœå¤ç”¨æ€§ã€‚éš”ç¦»æ•°æ®ï¼šä¸è®ºæ˜¯æ•°æ®å¼‚å¸¸è¿˜æ˜¯æ•°æ®æ•æ„Ÿæ€§ï¼Œä½¿çœŸå®æ•°æ®å’Œç»Ÿè®¡æ•°æ®è§£è€¦ã€‚ä¸€èˆ¬åœ¨DWDå±‚è¿›è¡Œç»´åº¦å»ºæ¨¡ODSå±‚ï¼šåŸå§‹æ•°æ®å±‚ï¼Œå­˜æ”¾åŸå§‹æ•°æ®DWDå±‚ï¼šå¯¹ODSå±‚æ•°æ®è¿›è¡Œæ¸…æ´—ï¼ˆå»ç©ºã€è„æ•°æ®ï¼Œè½¬æ¢ç±»å‹ç­‰ï¼‰ï¼Œç»´åº¦é€€åŒ–ï¼Œè„±æ•(ä¿æŠ¤éšç§)DWSå±‚ï¼šä»¥DWDä¸ºåŸºç¡€ï¼ŒæŒ‰å¤©è¿›è¡Œæ±‡æ€»DWTå±‚ï¼šä»¥DWSä¸ºåŸºç¡€ï¼ŒæŒ‰ä¸»é¢˜è¿›è¡Œæ±‡æ€»ADSå±‚ï¼šä¸ºå„ç§æ•°æ®åˆ†ææŠ¥è¡¨æä¾›æ•°æ®7 SqoopåŒæ­¥æ•°æ®Sqoopæ³¨æ„ç‚¹ï¼šHive ä¸­çš„ Null åœ¨åº•å±‚æ˜¯ä»¥â€œ\\Nâ€æ¥å­˜å‚¨ï¼Œè€Œ MySQL ä¸­çš„ Null åœ¨åº•å±‚å°±æ˜¯ Nullï¼Œä¸ºäº† ä¿è¯æ•°æ®ä¸¤ç«¯çš„ä¸€è‡´æ€§ã€‚åœ¨å¯¼å‡ºæ•°æ®æ—¶é‡‡ç”¨ â€“input-null-string å’Œ â€“input-null-non-stringå¯¼å…¥æ•°æ®æ—¶é‡‡ç”¨ â€“null-string å’Œ â€“null-non-stringæœ¬ä¾‹æ€è·¯ä¸ºï¼šsqoopæŠ½å–mysqlæ•°æ®ä¸Šä¼ è‡³Hdfsä¸Šï¼Œå­˜å‚¨ä¸ºparquetæ–‡ä»¶ï¼Œåœ¨å»ºç«‹hive-odsè¡¨ï¼Œä½¿ç”¨å¯¹åº”æ•°æ®ã€‚ä½¿ç”¨DolphinSchedulerè°ƒåº¦æ‰§è¡Œè„šæœ¬ã€‚Sqoopé‡‡é›†Mysqlå’ŒHiveæ•°æ®æ ¼å¼mysqlå­—æ®µç±»å‹hive:odså­—æ®µç±»å‹hive:dwd-adså­—æ®µç±»å‹tinyinttinyinttinyintintintintbigintbigintbigintvarcharstringstringdatetimebigintstringbitbooleanintdoubledoubledoubledecimaldecimaldecimal8 odså±‚æ„å»º8.1 odså»ºè¡¨hiveåˆ›å»ºodsæ•°æ®åº“ï¼Œä½¿ç”¨DolphinScheduleråˆ›å»ºæ•°æ®æºï¼Œåœ¨åˆ›å»ºDAGæ—¶éœ€è¦é€‰æ‹©hiveåº“ã€‚é¡ºä¾¿å°†dwdï¼Œdwsï¼Œdwtï¼Œadsä¸€èµ·åˆ›å»ºäº†base_dic123456789101112131415drop table if exists ods.mall__base_dicCREATE EXTERNAL TABLE &#96;ods.mall__base_dic&#96;( &#96;dic_code&#96; string COMMENT &#39;ç¼–å·&#39;, &#96;dic_name&#96; string COMMENT &#39;ç¼–ç åç§°&#39;, &#96;parent_code&#96; string COMMENT &#39;çˆ¶ç¼–å·&#39;, &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¥æœŸ&#39;, &#96;operate_time&#96; bigint COMMENT &#39;ä¿®æ”¹æ—¥æœŸ&#39; ) COMMENT &#39;ç¼–ç å­—å…¸è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;base_dic&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)base_trademark123456789101112drop table if exists ods.mall__base_trademarkCREATE EXTERNAL TABLE &#96;ods.mall__base_trademark&#96;( &#96;tm_id&#96; string COMMENT &#39;å“ç‰Œid&#39;, &#96;tm_name&#96; string COMMENT &#39;å“ç‰Œåç§°&#39; ) COMMENT &#39;å“ç‰Œè¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;base_trademark&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)base_category312345678910111213drop table if exists ods.mall__base_category3CREATE EXTERNAL TABLE &#96;ods.mall__base_category3&#96;( &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;, &#96;name&#96; string COMMENT &#39;ä¸‰çº§åˆ†ç±»åç§°&#39;, &#96;category2_id&#96; bigint COMMENT &#39;äºŒçº§åˆ†ç±»ç¼–å·&#39; ) COMMENT &#39;ä¸‰çº§åˆ†ç±»è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;base_category3&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)base_category212345678910111213drop table if exists ods.mall__base_category2CREATE EXTERNAL TABLE &#96;ods.mall__base_category2&#96;( &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;, &#96;name&#96; string COMMENT &#39;äºŒçº§åˆ†ç±»åç§°&#39;, &#96;category1_id&#96; bigint COMMENT &#39;ä¸€çº§åˆ†ç±»ç¼–å·&#39; ) COMMENT &#39;äºŒçº§åˆ†ç±»è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;base_category2&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)base_category1123456789101112drop table if exists ods.mall__base_category1CREATE EXTERNAL TABLE &#96;ods.mall__base_category1&#96;( &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;, &#96;name&#96; string COMMENT &#39;åˆ†ç±»åç§°&#39; ) COMMENT &#39;ä¸€çº§åˆ†ç±»è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;base_category1&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)activity_rule1234567891011121314151617drop table if exists ods.mall__activity_ruleCREATE EXTERNAL TABLE &#96;ods.mall__activity_rule&#96;( &#96;id&#96; int COMMENT &#39;ç¼–å·&#39;, &#96;activity_id&#96; int COMMENT &#39;ç±»å‹&#39;, &#96;condition_amount&#96; decimal(16,2) COMMENT &#39;æ»¡å‡é‡‘é¢&#39;, &#96;condition_num&#96; bigint COMMENT &#39;æ»¡å‡ä»¶æ•°&#39;, &#96;benefit_amount&#96; decimal(16,2) COMMENT &#39;ä¼˜æƒ é‡‘é¢&#39;, &#96;benefit_discount&#96; bigint COMMENT &#39;ä¼˜æƒ æŠ˜æ‰£&#39;, &#96;benefit_level&#96; bigint COMMENT &#39;ä¼˜æƒ çº§åˆ«&#39; ) COMMENT &#39;ä¼˜æƒ è§„åˆ™&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;activity_rule&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)activity_info12345678910111213141516drop table if exists ods.mall__activity_infoCREATE EXTERNAL TABLE &#96;ods.mall__activity_info&#96;( &#96;id&#96; bigint COMMENT &#39;æ´»åŠ¨id&#39;, &#96;activity_name&#96; string COMMENT &#39;æ´»åŠ¨åç§°&#39;, &#96;activity_type&#96; string COMMENT &#39;æ´»åŠ¨ç±»å‹&#39;, &#96;start_time&#96; bigint COMMENT &#39;å¼€å§‹æ—¶é—´&#39;, &#96;end_time&#96; bigint COMMENT &#39;ç»“æŸæ—¶é—´&#39;, &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39; ) COMMENT &#39;æ´»åŠ¨è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;activity_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)activity_sku1234567891011121314drop table if exists ods.mall__activity_skuCREATE EXTERNAL TABLE &#96;ods.mall__activity_sku&#96;( &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;, &#96;activity_id&#96; bigint COMMENT &#39;æ´»åŠ¨id&#39;, &#96;sku_id&#96; bigint COMMENT &#39;sku_id&#39;, &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39; ) COMMENT &#39;æ´»åŠ¨å‚ä¸å•†å“&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;activity_sku&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)cart_info1234567891011121314151617181920drop table if exists ods.mall__cart_infoCREATE EXTERNAL TABLE &#96;ods.mall__cart_info&#96;( &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;, &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·id&#39;, &#96;sku_id&#96; bigint COMMENT &#39;sku_id&#39;, &#96;cart_price&#96; decimal(10,2) COMMENT &#39;æ”¾å…¥è´­ç‰©è½¦æ—¶ä»·æ ¼&#39;, &#96;sku_num&#96; bigint COMMENT &#39;æ•°é‡&#39;, &#96;sku_name&#96; string COMMENT &#39;skuåç§°&#39;, &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;, &#96;operate_time&#96; bigint COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;, &#96;is_ordered&#96; bigint COMMENT &#39;æ˜¯å¦å·²ç»ä¸‹å•&#39;, &#96;order_time&#96; bigint COMMENT &#39;ä¸‹å•æ—¶é—´&#39; ) COMMENT &#39;è´­ç‰©è½¦è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;cart_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)favor_info1234567891011121314151617drop table if exists ods.mall__favor_infoCREATE EXTERNAL TABLE &#96;ods.mall__favor_info&#96;( &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;, &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·id&#39;, &#96;sku_id&#96; bigint COMMENT &#39;sku_id&#39;, &#96;spu_id&#96; bigint COMMENT &#39;å•†å“id&#39;, &#96;is_cancel&#96; string COMMENT &#39;æ˜¯å¦å·²å–æ¶ˆ 0 æ­£å¸¸ 1 å·²å–æ¶ˆ&#39;, &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;, &#96;cancel_time&#96; bigint COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39; ) COMMENT &#39;å•†å“æ”¶è—è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;favor_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)coupon_info1234567891011121314151617181920212223242526drop table if exists ods.mall__coupon_infoCREATE EXTERNAL TABLE &#96;ods.mall__coupon_info&#96;( &#96;id&#96; bigint COMMENT &#39;è´­ç‰©åˆ¸ç¼–å·&#39;, &#96;coupon_name&#96; string COMMENT &#39;è´­ç‰©åˆ¸åç§°&#39;, &#96;coupon_type&#96; string COMMENT &#39;è´­ç‰©åˆ¸ç±»å‹ 1 ç°é‡‘åˆ¸ 2 æŠ˜æ‰£åˆ¸ 3 æ»¡å‡åˆ¸ 4 æ»¡ä»¶æ‰“æŠ˜åˆ¸&#39;, &#96;condition_amount&#96; decimal(10,2) COMMENT &#39;æ»¡é¢æ•°&#39;, &#96;condition_num&#96; bigint COMMENT &#39;æ»¡ä»¶æ•°&#39;, &#96;activity_id&#96; bigint COMMENT &#39;æ´»åŠ¨ç¼–å·&#39;, &#96;benefit_amount&#96; decimal(16,2) COMMENT &#39;å‡é‡‘é¢&#39;, &#96;benefit_discount&#96; bigint COMMENT &#39;æŠ˜æ‰£&#39;, &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;, &#96;range_type&#96; string COMMENT &#39;èŒƒå›´ç±»å‹ 1ã€å•†å“ 2ã€å“ç±» 3ã€å“ç‰Œ&#39;, &#96;spu_id&#96; bigint COMMENT &#39;å•†å“id&#39;, &#96;tm_id&#96; bigint COMMENT &#39;å“ç‰Œid&#39;, &#96;category3_id&#96; bigint COMMENT &#39;å“ç±»id&#39;, &#96;limit_num&#96; int COMMENT &#39;æœ€å¤šé¢†ç”¨æ¬¡æ•°&#39;, &#96;operate_time&#96; bigint COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;, &#96;expire_time&#96; bigint COMMENT &#39;è¿‡æœŸæ—¶é—´&#39; ) COMMENT &#39;ä¼˜æƒ åˆ¸è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;coupon_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)sku_info12345678910111213141516171819drop table if exists ods.mall__sku_infoCREATE EXTERNAL TABLE &#96;ods.mall__sku_info&#96;( &#96;id&#96; bigint COMMENT &#39;skuid&#39;, &#96;spu_id&#96; bigint COMMENT &#39;spuid&#39;, &#96;price&#96; decimal(10,0) COMMENT &#39;ä»·æ ¼&#39;, &#96;sku_name&#96; string COMMENT &#39;skuåç§°&#39;, &#96;sku_desc&#96; string COMMENT &#39;å•†å“è§„æ ¼æè¿°&#39;, &#96;weight&#96; decimal(10,2) COMMENT &#39;é‡é‡&#39;, &#96;tm_id&#96; bigint COMMENT &#39;å“ç‰Œ&#39;, &#96;category3_id&#96; bigint COMMENT &#39;ä¸‰çº§åˆ†ç±»id&#39;, &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39; ) COMMENT &#39;åº“å­˜å•å…ƒè¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;sku_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)spu_info1234567891011121314drop table if exists ods.mall__spu_infoCREATE EXTERNAL TABLE &#96;ods.mall__spu_info&#96;( &#96;id&#96; bigint COMMENT &#39;å•†å“id&#39;, &#96;spu_name&#96; string COMMENT &#39;å•†å“åç§°&#39;, &#96;category3_id&#96; bigint COMMENT &#39;ä¸‰çº§åˆ†ç±»id&#39;, &#96;tm_id&#96; bigint COMMENT &#39;å“ç‰Œid&#39; ) COMMENT &#39;å•†å“è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;spu_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)base_province123456789101112131415drop table if exists ods.mall__base_provinceCREATE EXTERNAL TABLE &#96;ods.mall__base_province&#96;( &#96;id&#96; bigint COMMENT &#39;id&#39;, &#96;name&#96; string COMMENT &#39;çœåç§°&#39;, &#96;region_id&#96; string COMMENT &#39;å¤§åŒºid&#39;, &#96;area_code&#96; string COMMENT &#39;è¡Œæ”¿åŒºä½ç &#39;, &#96;iso_code&#96; string COMMENT &#39;å›½é™…ç¼–ç &#39; ) COMMENT &#39;çœä»½è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;base_province&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)base_region123456789101112drop table if exists ods.mall__base_regionCREATE EXTERNAL TABLE &#96;ods.mall__base_region&#96;( &#96;id&#96; string COMMENT &#39;å¤§åŒºid&#39;, &#96;region_name&#96; string COMMENT &#39;å¤§åŒºåç§°&#39; ) COMMENT &#39;åœ°åŒºè¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;base_region&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)refund_info12345678910111213141516171819drop table if exists ods.mall__order_refund_infoCREATE EXTERNAL TABLE &#96;ods.mall__order_refund_info&#96;( &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;, &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·id&#39;, &#96;order_id&#96; bigint COMMENT &#39;è®¢å•ç¼–å·&#39;, &#96;sku_id&#96; bigint COMMENT &#39;skuid&#39;, &#96;refund_type&#96; string COMMENT &#39;é€€æ¬¾ç±»å‹&#39;, &#96;refund_num&#96; bigint COMMENT &#39;é€€è´§ä»¶æ•°&#39;, &#96;refund_amount&#96; decimal(16,2) COMMENT &#39;é€€æ¬¾é‡‘é¢&#39;, &#96;refund_reason_type&#96; string COMMENT &#39;åŸå› ç±»å‹&#39;, &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39; ) COMMENT &#39;é€€å•è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;order_refund_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)order_status_log1234567891011121314drop table if exists ods.mall__order_status_logCREATE EXTERNAL TABLE &#96;ods.mall__order_status_log&#96;( &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;, &#96;order_id&#96; bigint COMMENT &#39;è®¢å•ç¼–å·&#39;, &#96;order_status&#96; string COMMENT &#39;è®¢å•çŠ¶æ€&#39;, &#96;operate_time&#96; bigint COMMENT &#39;æ“ä½œæ—¶é—´&#39; ) COMMENT &#39;è®¢å•çŠ¶æ€è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;order_status_log&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)payment_info12345678910111213141516171819drop table if exists ods.mall__payment_infoCREATE EXTERNAL TABLE &#96;ods.mall__payment_info&#96;( &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;, &#96;out_trade_no&#96; string COMMENT &#39;å¯¹å¤–ä¸šåŠ¡ç¼–å·&#39;, &#96;order_id&#96; bigint COMMENT &#39;è®¢å•ç¼–å·&#39;, &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·ç¼–å·&#39;, &#96;alipay_trade_no&#96; string COMMENT &#39;æ”¯ä»˜å®äº¤æ˜“æµæ°´ç¼–å·&#39;, &#96;total_amount&#96; decimal(16,2) COMMENT &#39;æ”¯ä»˜é‡‘é¢&#39;, &#96;subject&#96; string COMMENT &#39;äº¤æ˜“å†…å®¹&#39;, &#96;payment_type&#96; string COMMENT &#39;æ”¯ä»˜æ–¹å¼&#39;, &#96;payment_time&#96; bigint COMMENT &#39;æ”¯ä»˜æ—¶é—´&#39; ) COMMENT &#39;æ”¯ä»˜æµæ°´è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;payment_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)order_detail123456789101112131415161718drop table if exists ods.mall__order_detailCREATE EXTERNAL TABLE &#96;ods.mall__order_detail&#96;( &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;, &#96;order_id&#96; bigint COMMENT &#39;è®¢å•ç¼–å·&#39;, &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·id&#39;, &#96;sku_id&#96; bigint COMMENT &#39;sku_id&#39;, &#96;sku_name&#96; string COMMENT &#39;skuåç§°&#39;, &#96;order_price&#96; decimal(10,2) COMMENT &#39;è´­ä¹°ä»·æ ¼(ä¸‹å•æ—¶skuä»·æ ¼ï¼‰&#39;, &#96;sku_num&#96; string COMMENT &#39;è´­ä¹°ä¸ªæ•°&#39;, &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39; ) COMMENT &#39;è®¢å•æ˜ç»†è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;order_detail&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)activity_order1234567891011121314drop table if exists ods.mall__activity_orderCREATE EXTERNAL TABLE &#96;ods.mall__activity_order&#96;( &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;, &#96;activity_id&#96; bigint COMMENT &#39;æ´»åŠ¨id&#39;, &#96;order_id&#96; bigint COMMENT &#39;è®¢å•ç¼–å·&#39;, &#96;create_time&#96; bigint COMMENT &#39;å‘ç”Ÿæ—¥æœŸ&#39; ) COMMENT &#39;æ´»åŠ¨ä¸è®¢å•å…³è”è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;activity_order&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)comment_info123456789101112131415161718drop table if exists ods.mall__comment_infoCREATE EXTERNAL TABLE &#96;ods.mall__comment_info&#96;( &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;, &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·åç§°&#39;, &#96;sku_id&#96; bigint COMMENT &#39;skuid&#39;, &#96;spu_id&#96; bigint COMMENT &#39;å•†å“id&#39;, &#96;order_id&#96; bigint COMMENT &#39;è®¢å•ç¼–å·&#39;, &#96;appraise&#96; string COMMENT &#39;è¯„ä»· 1 å¥½è¯„ 2 ä¸­è¯„ 3 å·®è¯„&#39;, &#96;comment_txt&#96; string COMMENT &#39;è¯„ä»·å†…å®¹&#39;, &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39; ) COMMENT &#39;å•†å“è¯„è®ºè¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;comment_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)coupon_use123456789101112131415161718drop table if exists ods.mall__coupon_useCREATE EXTERNAL TABLE &#96;ods.mall__coupon_use&#96;( &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;, &#96;coupon_id&#96; bigint COMMENT &#39;è´­ç‰©åˆ¸ID&#39;, &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·ID&#39;, &#96;order_id&#96; bigint COMMENT &#39;è®¢å•ID&#39;, &#96;coupon_status&#96; string COMMENT &#39;è´­ç‰©åˆ¸çŠ¶æ€&#39;, &#96;get_time&#96; bigint COMMENT &#39;é¢†åˆ¸æ—¶é—´&#39;, &#96;using_time&#96; bigint COMMENT &#39;ä½¿ç”¨æ—¶é—´&#39;, &#96;used_time&#96; bigint COMMENT &#39;è¿‡æœŸæ—¶é—´&#39; ) COMMENT &#39;ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;coupon_use&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)user_info123456789101112131415161718drop table if exists ods.mall__user_infoCREATE EXTERNAL TABLE &#96;ods.mall__user_info&#96;( &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;, &#96;name&#96; string COMMENT &#39;ç”¨æˆ·å§“å&#39;, &#96;email&#96; string COMMENT &#39;é‚®ç®±&#39;, &#96;user_level&#96; string COMMENT &#39;ç”¨æˆ·çº§åˆ«&#39;, &#96;birthday&#96; bigint COMMENT &#39;ç”¨æˆ·ç”Ÿæ—¥&#39;, &#96;gender&#96; string COMMENT &#39;æ€§åˆ« Mç”·,Få¥³&#39;, &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;, &#96;operate_time&#96; bigint COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39; ) COMMENT &#39;ç”¨æˆ·è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;user_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)order_info123456789101112131415161718192021drop table if exists ods.mall__order_infoCREATE EXTERNAL TABLE &#96;ods.mall__order_info&#96;( &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;, &#96;final_total_amount&#96; decimal(16,2) COMMENT &#39;æ€»é‡‘é¢&#39;, &#96;order_status&#96; string COMMENT &#39;è®¢å•çŠ¶æ€&#39;, &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·id&#39;, &#96;out_trade_no&#96; string COMMENT &#39;è®¢å•äº¤æ˜“ç¼–å·ï¼ˆç¬¬ä¸‰æ–¹æ”¯ä»˜ç”¨)&#39;, &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;, &#96;operate_time&#96; bigint COMMENT &#39;æ“ä½œæ—¶é—´&#39;, &#96;province_id&#96; int COMMENT &#39;åœ°åŒº&#39;, &#96;benefit_reduce_amount&#96; decimal(16,2) COMMENT &#39;ä¼˜æƒ é‡‘é¢&#39;, &#96;original_total_amount&#96; decimal(16,2) COMMENT &#39;åŸä»·é‡‘é¢&#39;, &#96;feight_fee&#96; decimal(16,2) COMMENT &#39;è¿è´¹&#39; ) COMMENT &#39;è®¢å•è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;order_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)start_logæ­¤ä¸ºåŸ‹ç‚¹å¯åŠ¨æ—¥å¿—è¡¨123456789drop table if exists ods.mall__start_logCREATE EXTERNAL TABLE &#96;ods.mall__start_log&#96;( &#96;line&#96; string COMMENT &#39;å¯åŠ¨æ—¥å¿—&#39; ) COMMENT &#39;å¯åŠ¨æ—¥å¿—è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;start_log&#x2F;&#39;event_logæ­¤ä¸ºåŸ‹ç‚¹äº‹ä»¶æ—¥å¿—è¡¨123456789drop table if exists ods.mall__event_logCREATE EXTERNAL TABLE &#96;ods.mall__event_log&#96;( &#96;line&#96; string COMMENT &#39;äº‹ä»¶æ—¥å¿—&#39; ) COMMENT &#39;äº‹ä»¶æ—¥å¿—è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;event_log&#x2F;&#39;date_infoæ­¤ä¸ºæ—¶é—´è¡¨12345678910111213141516171819drop table if exists ods.mall__date_infoCREATE EXTERNAL TABLE &#96;ods.mall__date_info&#96;(&#96;date_id&#96; int COMMENT &#39;æ—¥&#39;,&#96;week_id&#96; int COMMENT &#39;å‘¨&#39;,&#96;week_day&#96; int COMMENT &#39;å‘¨çš„ç¬¬å‡ å¤©&#39;,&#96;day&#96; int COMMENT &#39;æ¯æœˆçš„ç¬¬å‡ å¤©&#39;,&#96;month&#96; int COMMENT &#39;ç¬¬å‡ æœˆ&#39;,&#96;quarter&#96; int COMMENT &#39;ç¬¬å‡ å­£åº¦&#39;,&#96;year&#96; int COMMENT &#39;å¹´&#39;,&#96;is_workday&#96; int COMMENT &#39;æ˜¯å¦æ˜¯å‘¨æœ«&#39;,&#96;holiday_id&#96; int COMMENT &#39;æ˜¯å¦æ˜¯èŠ‚å‡æ—¥&#39; ) COMMENT &#39;æ—¶é—´ç»´åº¦è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;date_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)8.2 mysqlæ•°æ®æŠ½å–sqoopæŠ½å–è„šæœ¬åŸºç¡€12345678910111213141516171819202122232425262728#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;mysql_db_name&#x3D;$&#123;db_name&#125;mysql_db_addr&#x3D;$&#123;db_addr&#125;mysql_db_user&#x3D;$&#123;db_user&#125;mysql_db_password&#x3D;$&#123;db_password&#125;# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fiecho &quot;æ—¥æœŸ:&quot;$db_dateecho &quot;mysqlåº“å:&quot;$mysql_db_nameimport_data() &#123;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;sqoop import \\--connect jdbc:mysql:&#x2F;&#x2F;$mysql_db_addr:3306&#x2F;$mysql_db_name?tinyInt1isBit&#x3D;false \\--username $mysql_db_user \\--password $mysql_db_password \\--target-dir &#x2F;origin_data&#x2F;$mysql_db_name&#x2F;$1&#x2F;$db_date \\--delete-target-dir \\--num-mappers 1 \\--null-string &#39;&#39; \\--null-non-string &#39;\\\\n&#39; \\--fields-terminated-by &quot;\\t&quot; \\--query &quot;$2&quot;&#39; and $CONDITIONS;&#39; \\--as-parquetfile &#125;DolphinSchedulerå…¨å±€å‚æ•°dateä¸ä¼ ä¸ºæ˜¨å¤©db_nameæ•°æ®åº“åå­—db_addræ•°æ®åº“IPåœ°å€db_useræ•°æ®åº“ç”¨æˆ·db_passwordæ•°æ®åº“å¯†ç å…ƒæ•°æ®ä¸­æ•°æ®å¼€å§‹æ—¥æœŸä¸º2020-03-15å¦‚ä¸‹å¯¼å…¥æ•°æ®ä»£ç ç‰‡æ®µï¼Œæ‹¼æ¥ä¸Šè¿°çš„åŸºç¡€ç‰‡æ®µæ‰§è¡Œå…¨é‡è¡¨ä»£ç ç‰‡æ®µ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114import_data &quot;base_dic&quot; &quot;selectdic_code,dic_name,parent_code,create_time,operate_timefrom base_dicwhere 1&#x3D;1&quot;import_data &quot;base_trademark&quot; &quot;selecttm_id,tm_namefrom base_trademarkwhere 1&#x3D;1&quot;import_data &quot;base_category3&quot; &quot;selectid,name,category2_idfrom base_category3 where 1&#x3D;1&quot;import_data &quot;base_category2&quot; &quot;selectid,name,category1_idfrom base_category2 where 1&#x3D;1&quot;import_data &quot;base_category1&quot; &quot;selectid,namefrom base_category1 where 1&#x3D;1&quot;import_data &quot;activity_rule&quot; &quot;selectid,activity_id,condition_amount,condition_num,benefit_amount,benefit_discount,benefit_levelfrom activity_rulewhere 1&#x3D;1&quot;import_data &quot;activity_info&quot; &quot;selectid,activity_name,activity_type,start_time,end_time,create_timefrom activity_infowhere 1&#x3D;1&quot;import_data &quot;activity_sku&quot; &quot;selectid,activity_id,sku_id,create_timeFROMactivity_skuwhere 1&#x3D;1&quot;import_data &quot;cart_info&quot; &quot;selectid,user_id,sku_id,cart_price,sku_num,sku_name,create_time,operate_time,is_ordered,order_timefrom cart_infowhere 1&#x3D;1&quot;import_data &quot;favor_info&quot; &quot;selectid,user_id,sku_id,spu_id,is_cancel,create_time,cancel_timefrom favor_infowhere 1&#x3D;1&quot;import_data &quot;coupon_info&quot; &quot;selectid,coupon_name,coupon_type,condition_amount,condition_num,activity_id,benefit_amount,benefit_discount,create_time,range_type,spu_id,tm_id,category3_id,limit_num,operate_time,expire_timefrom coupon_infowhere 1&#x3D;1&quot;import_data &quot;sku_info&quot; &quot;selectid,spu_id,price,sku_name,sku_desc,weight,tm_id,category3_id,create_timefrom sku_info where 1&#x3D;1&quot;import_data &quot;spu_info&quot; &quot;selectid,spu_name,category3_id,tm_idfrom spu_infowhere 1&#x3D;1&quot;ç‰¹æ®Šè¡¨ä»£ç ç‰‡æ®µ12345678910111213141516171819202122232425import_data &quot;base_province&quot; &quot;selectid,name,region_id,area_code,iso_codefrom base_provincewhere 1&#x3D;1&quot;import_data &quot;base_region&quot; &quot;selectid,region_namefrom base_regionwhere 1&#x3D;1&quot;import_data &quot;date_info&quot; &quot;selectdate_id,week_id,week_day,day,month,quarter,year,is_workday,holiday_idfrom date_infowhere 1&#x3D;1&quot;å¢é‡è¡¨ä»£ç ç‰‡æ®µ12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667import_data &quot;order_refund_info&quot; &quot;selectid,user_id,order_id,sku_id,refund_type,refund_num,refund_amount,refund_reason_type,create_timefrom order_refund_infowheredate_format(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;&quot;import_data &quot;order_status_log&quot; &quot;selectid,order_id,order_status,operate_timefrom order_status_logwheredate_format(operate_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;&quot;import_data &quot;payment_info&quot; &quot;selectid,out_trade_no,order_id,user_id,alipay_trade_no,total_amount,subject,payment_type,payment_timefrom payment_infowhereDATE_FORMAT(payment_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;&quot;import_data &quot;order_detail&quot; &quot;selectod.id,od.order_id,oi.user_id,od.sku_id,od.sku_name,od.order_price,od.sku_num,od.create_timefrom order_detail odjoin order_info oion od.order_id&#x3D;oi.idwhereDATE_FORMAT(od.create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;&quot;import_data &quot;activity_order&quot; &quot;selectid,activity_id,order_id,create_timefrom activity_orderwheredate_format(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;&quot;import_data &quot;comment_info&quot; &quot;selectid,user_id,sku_id,spu_id,order_id,appraise,comment_txt,create_timefrom comment_infowhere date_format(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;&quot;å¢é‡åŠå˜åŒ–è¡¨ä»£ç ç‰‡æ®µ12345678910111213141516171819202122232425262728293031323334353637383940import_data &quot;coupon_use&quot; &quot;selectid,coupon_id,user_id,order_id,coupon_status,get_time,using_time,used_timefrom coupon_usewhere (date_format(get_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;or date_format(using_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;or date_format(used_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;)&quot;import_data &quot;user_info&quot; &quot;selectid,name,birthday,gender,email,user_level,create_time,operate_timefrom user_infowhere (DATE_FORMAT(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;or DATE_FORMAT(operate_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;)&quot;import_data &quot;order_info&quot; &quot;selectid,final_total_amount,order_status,user_id,out_trade_no,create_time,operate_time,province_id,benefit_reduce_amount,original_total_amount,feight_feefrom order_infowhere (date_format(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;or date_format(operate_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;)&quot;8.3 odså±‚æ•°æ®åŠ è½½è„šæœ¬ä¿®æ”¹$table_nameå³å¯æ³¨æ„2å¼ åŸ‹ç‚¹æ—¥å¿—è¡¨çš„æ•°æ®å¯¼å‡ºç›®å½•1234567891011121314151617#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;odstable_name&#x3D;base_dichive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; load data inpath &#39;&#x2F;origin_data&#x2F;$APP1&#x2F;$table_name&#x2F;$db_date&#39; OVERWRITE into table $hive_table_name partition(dt&#x3D;&#39;$db_date&#39;);&quot;$hive -e &quot;$sql&quot;9 dwdå±‚æ„å»º9.1 dwdå±‚æ„å»ºï¼ˆå¯åŠ¨-äº‹ä»¶æ—¥å¿—ï¼‰9.1.1 å¯åŠ¨æ—¥å¿—è¡¨å»ºè¡¨123456789101112131415161718192021222324252627282930313233drop table if exists dwd.mall__start_logCREATE EXTERNAL TABLE &#96;dwd.mall__start_log&#96;( &#96;mid_id&#96; string COMMENT &#39;è®¾å¤‡å”¯ä¸€æ ‡è¯†&#39;, &#96;user_id&#96; string COMMENT &#39;ç”¨æˆ·æ ‡è¯†&#39;, &#96;version_code&#96; string COMMENT &#39;ç¨‹åºç‰ˆæœ¬å·&#39;, &#96;version_name&#96; string COMMENT &#39;ç¨‹åºç‰ˆæœ¬å&#39;, &#96;lang&#96; string COMMENT &#39;ç³»ç»Ÿè¯­è¨€&#39;, &#96;source&#96; string COMMENT &#39;æ¸ é“å·&#39;, &#96;os&#96; string COMMENT &#39;ç³»ç»Ÿç‰ˆæœ¬&#39;, &#96;area&#96; string COMMENT &#39;åŒºåŸŸ&#39;, &#96;model&#96; string COMMENT &#39;æ‰‹æœºå‹å·&#39;, &#96;brand&#96; string COMMENT &#39;æ‰‹æœºå“ç‰Œ&#39;, &#96;sdk_version&#96; string COMMENT &#39;sdkVersion&#39;, &#96;gmail&#96; string COMMENT &#39;gmail&#39;, &#96;height_width&#96; string COMMENT &#39;å±å¹•å®½é«˜&#39;, &#96;app_time&#96; string COMMENT &#39;å®¢æˆ·ç«¯æ—¥å¿—äº§ç”Ÿæ—¶çš„æ—¶é—´&#39;, &#96;network&#96; string COMMENT &#39;ç½‘ç»œæ¨¡å¼&#39;, &#96;lng&#96; string COMMENT &#39;ç»åº¦&#39;, &#96;lat&#96; string COMMENT &#39;çº¬åº¦&#39;, &#96;entry&#96; string COMMENT &#39;å…¥å£: push&#x3D;1,widget&#x3D;2,icon&#x3D;3,notification&#x3D;4,lockscreen_widget&#x3D;5&#39;, &#96;open_ad_type&#96; string COMMENT &#39;å¼€å±å¹¿å‘Šç±»å‹: å¼€å±åŸç”Ÿå¹¿å‘Š&#x3D;1, å¼€å±æ’å±å¹¿å‘Š&#x3D;2&#39;, &#96;action&#96; string COMMENT &#39;çŠ¶æ€ï¼šæˆåŠŸ&#x3D;1 å¤±è´¥&#x3D;2&#39;, &#96;loading_time&#96; string COMMENT &#39;åŠ è½½æ—¶é•¿&#39;, &#96;detail&#96; string COMMENT &#39;å¤±è´¥ç &#39;, &#96;extend1&#96; string COMMENT &#39;å¤±è´¥çš„ message&#39; ) COMMENT &#39;å¯åŠ¨æ—¥å¿—è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;start_log&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥12345678910111213141516171819202122232425262728293031323334353637383940414243444546#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdAPP3&#x3D;odstable_name&#x3D;start_loghive_table_name&#x3D;$APP2.mall__$table_namehive_origin_table_name&#x3D;$APP3.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select get_json_object(line,&#39;$.mid&#39;) mid_id, get_json_object(line,&#39;$.uid&#39;) user_id, get_json_object(line,&#39;$.vc&#39;) version_code, get_json_object(line,&#39;$.vn&#39;) version_name, get_json_object(line,&#39;$.l&#39;) lang, get_json_object(line,&#39;$.sr&#39;) source, get_json_object(line,&#39;$.os&#39;) os, get_json_object(line,&#39;$.ar&#39;) area, get_json_object(line,&#39;$.md&#39;) model, get_json_object(line,&#39;$.ba&#39;) brand, get_json_object(line,&#39;$.sv&#39;) sdk_version, get_json_object(line,&#39;$.g&#39;) gmail, get_json_object(line,&#39;$.hw&#39;) height_width, get_json_object(line,&#39;$.t&#39;) app_time, get_json_object(line,&#39;$.nw&#39;) network, get_json_object(line,&#39;$.ln&#39;) lng, get_json_object(line,&#39;$.la&#39;) lat, get_json_object(line,&#39;$.entry&#39;) entry, get_json_object(line,&#39;$.open_ad_type&#39;) open_ad_type, get_json_object(line,&#39;$.action&#39;) action, get_json_object(line,&#39;$.loading_time&#39;) loading_time, get_json_object(line,&#39;$.detail&#39;) detail, get_json_object(line,&#39;$.extend1&#39;) extend1from $hive_origin_table_namewhere dt&#x3D;&#39;$db_date&#39;;&quot;$hive -e &quot;$sql&quot;9.1.2 äº‹ä»¶æ—¥å¿—è¡¨å»ºè¡¨123456789101112131415161718192021222324252627282930drop table if exists dwd.mall__event_logCREATE EXTERNAL TABLE &#96;dwd.mall__event_log&#96;( &#96;mid_id&#96; string COMMENT &#39;è®¾å¤‡å”¯ä¸€æ ‡è¯†&#39;, &#96;user_id&#96; string COMMENT &#39;ç”¨æˆ·æ ‡è¯†&#39;, &#96;version_code&#96; string COMMENT &#39;ç¨‹åºç‰ˆæœ¬å·&#39;, &#96;version_name&#96; string COMMENT &#39;ç¨‹åºç‰ˆæœ¬å&#39;, &#96;lang&#96; string COMMENT &#39;ç³»ç»Ÿè¯­è¨€&#39;, &#96;source&#96; string COMMENT &#39;æ¸ é“å·&#39;, &#96;os&#96; string COMMENT &#39;ç³»ç»Ÿç‰ˆæœ¬&#39;, &#96;area&#96; string COMMENT &#39;åŒºåŸŸ&#39;, &#96;model&#96; string COMMENT &#39;æ‰‹æœºå‹å·&#39;, &#96;brand&#96; string COMMENT &#39;æ‰‹æœºå“ç‰Œ&#39;, &#96;sdk_version&#96; string COMMENT &#39;sdkVersion&#39;, &#96;gmail&#96; string COMMENT &#39;gmail&#39;, &#96;height_width&#96; string COMMENT &#39;å±å¹•å®½é«˜&#39;, &#96;app_time&#96; string COMMENT &#39;å®¢æˆ·ç«¯æ—¥å¿—äº§ç”Ÿæ—¶çš„æ—¶é—´&#39;, &#96;network&#96; string COMMENT &#39;ç½‘ç»œæ¨¡å¼&#39;, &#96;lng&#96; string COMMENT &#39;ç»åº¦&#39;, &#96;lat&#96; string COMMENT &#39;çº¬åº¦&#39;, &#96;event_name&#96; string COMMENT &#39;äº‹ä»¶åç§°&#39;, &#96;event_json&#96; string COMMENT &#39;äº‹ä»¶è¯¦æƒ…&#39;, &#96;server_time&#96; string COMMENT &#39;æœåŠ¡å™¨æ—¶é—´&#39; ) COMMENT &#39;äº‹ä»¶æ—¥å¿—è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;event_log&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)9.2.1 åˆ¶ä½œ UDF UDTFudf1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859import org.apache.commons.lang.StringUtils;import org.apache.hadoop.hive.ql.exec.UDF;import org.json.JSONException;import org.json.JSONObject;public class BaseFieldUDF extends UDF &#123; public String evaluate(String line, String key) throws JSONException &#123; String[] log &#x3D; line.split(&quot;\\\\|&quot;); if (log.length !&#x3D; 2 || StringUtils.isBlank(log[1])) &#123; return &quot;&quot;; &#125; JSONObject baseJson &#x3D; new JSONObject(log[1].trim()); String result &#x3D; &quot;&quot;; &#x2F;&#x2F; è·å–æœåŠ¡å™¨æ—¶é—´ if (&quot;st&quot;.equals(key)) &#123; result &#x3D; log[0].trim(); &#125; else if (&quot;et&quot;.equals(key)) &#123; &#x2F;&#x2F; è·å–äº‹ä»¶æ•°ç»„ if (baseJson.has(&quot;et&quot;)) &#123; result &#x3D; baseJson.getString(&quot;et&quot;); &#125; &#125; else &#123; JSONObject cm &#x3D; baseJson.getJSONObject(&quot;cm&quot;); &#x2F;&#x2F; è·å– key å¯¹åº”å…¬å…±å­—æ®µçš„ value if (cm.has(key)) &#123; result &#x3D; cm.getString(key); &#125; &#125; return result; &#125; public static void main(String[] args) throws JSONException &#123; String line &#x3D; &quot; 1588319303710|&#123;\\n&quot; + &quot; \\&quot;cm\\&quot;:&#123;\\n&quot; + &quot; \\&quot;ln\\&quot;:\\&quot;-51.5\\&quot;,\\&quot;sv\\&quot;:\\&quot;V2.0.7\\&quot;,\\&quot;os\\&quot;:\\&quot;8.0.8\\&quot;,\\&quot;g\\&quot;:\\&quot;L1470998@gmail.com\\&quot;,\\&quot;mid\\&quot;:\\&quot;13\\&quot;,\\n&quot; + &quot; \\&quot;nw\\&quot;:\\&quot;4G\\&quot;,\\&quot;l\\&quot;:\\&quot;en\\&quot;,\\&quot;vc\\&quot;:\\&quot;7\\&quot;,\\&quot;hw\\&quot;:\\&quot;640*960\\&quot;,\\&quot;ar\\&quot;:\\&quot;MX\\&quot;,\\&quot;uid\\&quot;:\\&quot;13\\&quot;,\\&quot;t\\&quot;:\\&quot;1588291826938\\&quot;,\\n&quot; + &quot; \\&quot;la\\&quot;:\\&quot;-38.2\\&quot;,\\&quot;md\\&quot;:\\&quot;Huawei-14\\&quot;,\\&quot;vn\\&quot;:\\&quot;1.3.6\\&quot;,\\&quot;ba\\&quot;:\\&quot;Huawei\\&quot;,\\&quot;sr\\&quot;:\\&quot;Y\\&quot;\\n&quot; + &quot; &#125;,\\n&quot; + &quot; \\&quot;ap\\&quot;:\\&quot;app\\&quot;,\\n&quot; + &quot; \\&quot;et\\&quot;:[&#123;\\n&quot; + &quot; \\&quot;ett\\&quot;:\\&quot;1588228193191\\&quot;,\\&quot;en\\&quot;:\\&quot;ad\\&quot;,\\&quot;kv\\&quot;:&#123;\\&quot;activityId\\&quot;:\\&quot;1\\&quot;,\\&quot;displayMills\\&quot;:\\&quot;113201\\&quot;,\\&quot;entry\\&quot;:\\&quot;3\\&quot;,\\&quot;action\\&quot;:\\&quot;5\\&quot;,\\&quot;contentType\\&quot;:\\&quot;0\\&quot;&#125;\\n&quot; + &quot; &#125;,&#123;\\n&quot; + &quot; \\&quot;ett\\&quot;:\\&quot;1588300304713\\&quot;,\\&quot;en\\&quot;:\\&quot;notification\\&quot;,\\&quot;kv\\&quot;:&#123;\\&quot;ap_time\\&quot;:\\&quot;1588277440794\\&quot;,\\&quot;action\\&quot;:\\&quot;2\\&quot;,\\&quot;type\\&quot;:\\&quot;3\\&quot;,\\&quot;content\\&quot;:\\&quot;\\&quot;&#125;\\n&quot; + &quot; &#125;,&#123;\\n&quot; + &quot; \\&quot;ett\\&quot;:\\&quot;1588249203743\\&quot;,\\&quot;en\\&quot;:\\&quot;active_background\\&quot;,\\&quot;kv\\&quot;:&#123;\\&quot;active_source\\&quot;:\\&quot;3\\&quot;&#125;\\n&quot; + &quot; &#125;,&#123;\\n&quot; + &quot; \\&quot;ett\\&quot;:\\&quot;1588225856101\\&quot;,\\&quot;en\\&quot;:\\&quot;comment\\&quot;,\\&quot;kv\\&quot;:&#123;\\&quot;p_comment_id\\&quot;:0,\\&quot;addtime\\&quot;:\\&quot;1588263895040\\&quot;,\\&quot;praise_count\\&quot;:231,\\&quot;other_id\\&quot;:5,\\&quot;comment_id\\&quot;:5,\\&quot;reply_count\\&quot;:62,\\&quot;userid\\&quot;:7,\\&quot;content\\&quot;:\\&quot;éª¸æ±\\&quot;&#125;\\n&quot; + &quot; &#125;,&#123;\\n&quot; + &quot; \\&quot;ett\\&quot;:\\&quot;1588254200122\\&quot;,\\&quot;en\\&quot;:\\&quot;favorites\\&quot;,\\&quot;kv\\&quot;:&#123;\\&quot;course_id\\&quot;:5,\\&quot;id\\&quot;:0,\\&quot;add_time\\&quot;:\\&quot;1588264138625\\&quot;,\\&quot;userid\\&quot;:0&#125;\\n&quot; + &quot; &#125;,&#123;\\n&quot; + &quot; \\&quot;ett\\&quot;:\\&quot;1588281152824\\&quot;,\\&quot;en\\&quot;:\\&quot;praise\\&quot;,\\&quot;kv\\&quot;:&#123;\\&quot;target_id\\&quot;:4,\\&quot;id\\&quot;:3,\\&quot;type\\&quot;:3,\\&quot;add_time\\&quot;:\\&quot;1588307696417\\&quot;,\\&quot;userid\\&quot;:8&#125;\\n&quot; + &quot; &#125;]\\n&quot; + &quot; &#125;&quot;; String s &#x3D; new BaseFieldUDF().evaluate(line, &quot;mid&quot;); String ss &#x3D; new BaseFieldUDF().evaluate(line, &quot;st&quot;); String sss &#x3D; new BaseFieldUDF().evaluate(line, &quot;et&quot;); System.out.println(s); System.out.println(ss); System.out.println(sss); &#125;&#125;ç»“æœï¼š131588319303710[{â€œettâ€:â€1588228193191â€,â€enâ€:â€adâ€,â€kvâ€:{â€œactivityIdâ€:â€1â€,â€displayMillsâ€:â€113201â€,â€entryâ€:â€3â€,â€actionâ€:â€5â€,â€contentTypeâ€:â€0â€}},{â€œettâ€:â€1588300304713â€,â€enâ€:â€notificationâ€,â€kvâ€:{â€œap_timeâ€:â€1588277440794â€,â€actionâ€:â€2â€,â€typeâ€:â€3â€,â€contentâ€:â€â€}},{â€œettâ€:â€1588249203743â€,â€enâ€:â€active_backgroundâ€,â€kvâ€:{â€œactive_sourceâ€:â€3â€}},{â€œettâ€:â€1588225856101â€,â€enâ€:â€commentâ€,â€kvâ€:{â€œp_comment_idâ€:0,â€addtimeâ€:â€1588263895040â€,â€praise_countâ€:231,â€other_idâ€:5,â€comment_idâ€:5,â€reply_countâ€:62,â€useridâ€:7,â€contentâ€:â€éª¸æ±â€}},{â€œettâ€:â€1588254200122â€,â€enâ€:â€favoritesâ€,â€kvâ€:{â€œcourse_idâ€:5,â€idâ€:0,â€add_timeâ€:â€1588264138625â€,â€useridâ€:0}},{â€œettâ€:â€1588281152824â€,â€enâ€:â€praiseâ€,â€kvâ€:{â€œtarget_idâ€:4,â€idâ€:3,â€typeâ€:3,â€add_timeâ€:â€1588307696417â€,â€useridâ€:8}}]udtf12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061import org.apache.commons.lang.StringUtils;import org.apache.hadoop.hive.ql.exec.UDFArgumentException;import org.apache.hadoop.hive.ql.metadata.HiveException;import org.apache.hadoop.hive.ql.udf.generic.GenericUDTF;import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspector;import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspectorFactory;import org.apache.hadoop.hive.serde2.objectinspector.StructObjectInspector;import org.apache.hadoop.hive.serde2.objectinspector.primitive.PrimitiveObjectInspectorFactory;import org.json.JSONArray;import org.json.JSONException;import java.util.ArrayList;public class EventJsonUDTF extends GenericUDTF &#123; &#x2F;&#x2F;è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†æŒ‡å®šè¾“å‡ºå‚æ•°çš„åç§°å’Œå‚æ•°ç±»å‹ï¼š public StructObjectInspector initialize(StructObjectInspector argOIs) throws UDFArgumentException &#123; ArrayList&lt;String&gt; fieldNames &#x3D; new ArrayList&lt;String&gt;(); ArrayList&lt;ObjectInspector&gt; fieldOIs &#x3D; new ArrayList&lt;ObjectInspector&gt;(); fieldNames.add(&quot;event_name&quot;); fieldOIs.add(PrimitiveObjectInspectorFactory.javaStringObjectInspector); fieldNames.add(&quot;event_json&quot;); fieldOIs.add(PrimitiveObjectInspectorFactory.javaStringObjectInspector); return ObjectInspectorFactory.getStandardStructObjectInspector(fieldNames, fieldOIs); &#125; &#x2F;&#x2F;è¾“å…¥ 1 æ¡è®°å½•ï¼Œè¾“å‡ºè‹¥å¹²æ¡ç»“æœ @Override public void process(Object[] objects) throws HiveException &#123; &#x2F;&#x2F; è·å–ä¼ å…¥çš„ et String input &#x3D; objects[0].toString(); &#x2F;&#x2F; å¦‚æœä¼ è¿›æ¥çš„æ•°æ®ä¸ºç©ºï¼Œç›´æ¥è¿”å›è¿‡æ»¤æ‰è¯¥æ•°æ® if (StringUtils.isBlank(input)) &#123; return; &#125; else &#123; try &#123; &#x2F;&#x2F; è·å–ä¸€å…±æœ‰å‡ ä¸ªäº‹ä»¶ï¼ˆad&#x2F;facoritersï¼‰ JSONArray ja &#x3D; new JSONArray(input); if (ja &#x3D;&#x3D; null) return; &#x2F;&#x2F; å¾ªç¯éå†æ¯ä¸€ä¸ªäº‹ä»¶ for (int i &#x3D; 0; i &lt; ja.length(); i++) &#123; String[] result &#x3D; new String[2]; try &#123; &#x2F;&#x2F; å–å‡ºæ¯ä¸ªçš„äº‹ä»¶åç§°ï¼ˆad&#x2F;facoritersï¼‰ result[0] &#x3D; ja.getJSONObject(i).getString(&quot;en&quot;); &#x2F;&#x2F; å–å‡ºæ¯ä¸€ä¸ªäº‹ä»¶æ•´ä½“ result[1] &#x3D; ja.getString(i); &#125; catch (JSONException e) &#123; continue; &#125; &#x2F;&#x2F; å°†ç»“æœè¿”å› forward(result); &#125; &#125; catch (JSONException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#x2F;&#x2F;å½“æ²¡æœ‰è®°å½•å¤„ç†çš„æ—¶å€™è¯¥æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œç”¨æ¥æ¸…ç†ä»£ç æˆ–è€…äº§ç”Ÿé¢å¤–çš„è¾“å‡º @Override public void close() throws HiveException &#123; &#125;&#125;9.1.2.2 ç›´æ¥æ°¸ä¹…ä½¿ç”¨UDFä¸Šä¼ UDFèµ„æºå°†hive-function-1.0-SNAPSHOTåŒ…ä¼ åˆ°HDFS çš„/user/hive/jarsä¸‹12hadoop dfs -mkdir &#x2F;user&#x2F;hive&#x2F;jarshadoop dfs -put hive-function-1.0-SNAPSHOT.jar &#x2F;user&#x2F;hive&#x2F;jars&#x2F;hive-function-1.0-SNAPSHOT.jaråœ¨hiveä¸­åˆ›å»ºæ°¸ä¹…UDF12create function base_analizer as &#39;com.heaton.bigdata.udf.BaseFieldUDF&#39; using jar &#39;hdfs:&#x2F;&#x2F;cdh01.cm:8020&#x2F;user&#x2F;hive&#x2F;jars&#x2F;hive-function-1.0-SNAPSHOT.jar&#39;;create function flat_analizer as &#39;com.heaton.bigdata.udtf.EventJsonUDTF&#39; using jar &#39;hdfs:&#x2F;&#x2F;cdh01.cm:8020&#x2F;user&#x2F;hive&#x2F;jars&#x2F;hive-function-1.0-SNAPSHOT.jar&#39;;9.1.2.3 Dolphinä½¿ç”¨æ–¹å¼UDFåœ¨DAGå›¾åˆ›å»ºSQLå·¥å…·ä¸­é€‰æ‹©å¯¹åº”UDFå‡½æ•°å³å¯ä½¿ç”¨ï¼Œä½†æ˜¯ç›®å‰Dolphin1.2.0ä¸­å…³è”å‡½æ•°æ“ä½œä¿å­˜æ— æ•ˆã€‚å¤§å®¶å¯ä»¥ä½¿ç”¨UDFç®¡ç†åŠŸèƒ½å°†JARä¼ å…¥åˆ°HDFSä¸Šï¼Œè¿™æ ·é€šè¿‡è„šæœ¬åŠ å…¥ä¸´æ—¶å‡½æ•°ï¼Œä¹Ÿå¯ä»¥å¾ˆå¥½çš„å®ŒæˆåŠŸèƒ½ã€‚ä¸´æ—¶å‡½æ•°è¯­å¥ï¼š12create temporary function base_analizer as &#39;com.heaton.bigdata.udf.BaseFieldUDF&#39; using jar &#39;hdfs:&#x2F;&#x2F;cdh01.cm:8020&#x2F;dolphinscheduler&#x2F;dolphinscheduler&#x2F;udfs&#x2F;hive-function-1.0-SNAPSHOT.jar&#39;;create temporary function flat_analizer as &#39;com.heaton.bigdata.udtf.EventJsonUDTF&#39; using jar &#39;hdfs:&#x2F;&#x2F;cdh01.cm:8020&#x2F;dolphinscheduler&#x2F;dolphinscheduler&#x2F;udfs&#x2F;hive-function-1.0-SNAPSHOT.jar&#39;;9.2.4 æ•°æ®å¯¼å…¥12345678910111213141516171819202122232425262728293031323334353637383940414243#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdAPP3&#x3D;odstable_name&#x3D;event_loghive_table_name&#x3D;$APP2.mall__$table_namehive_origin_table_name&#x3D;$APP3.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select base_analizer(line,&#39;mid&#39;) as mid_id, base_analizer(line,&#39;uid&#39;) as user_id, base_analizer(line,&#39;vc&#39;) as version_code, base_analizer(line,&#39;vn&#39;) as version_name, base_analizer(line,&#39;l&#39;) as lang, base_analizer(line,&#39;sr&#39;) as source, base_analizer(line,&#39;os&#39;) as os, base_analizer(line,&#39;ar&#39;) as area, base_analizer(line,&#39;md&#39;) as model, base_analizer(line,&#39;ba&#39;) as brand, base_analizer(line,&#39;sv&#39;) as sdk_version, base_analizer(line,&#39;g&#39;) as gmail, base_analizer(line,&#39;hw&#39;) as height_width, base_analizer(line,&#39;t&#39;) as app_time, base_analizer(line,&#39;nw&#39;) as network, base_analizer(line,&#39;ln&#39;) as lng, base_analizer(line,&#39;la&#39;) as lat, event_name, event_json, base_analizer(line,&#39;st&#39;) as server_timefrom $hive_origin_table_name lateral view flat_analizer(base_analizer(line,&#39;et&#39;)) tmp_flat as event_name,event_jsonwhere dt&#x3D;&#39;$db_date&#39; and base_analizer(line,&#39;et&#39;)&lt;&gt;&#39;&#39;;&quot;$hive -e &quot;$sql&quot;9.1.3 å•†å“ç‚¹å‡»è¡¨å»ºè¡¨123456789101112131415161718192021222324252627282930313233drop table if exists dwd.mall__display_logCREATE EXTERNAL TABLE &#96;dwd.mall__display_log&#96;( &#96;mid_id&#96; string, &#96;user_id&#96; string, &#96;version_code&#96; string, &#96;version_name&#96; string, &#96;lang&#96; string, &#96;source&#96; string, &#96;os&#96; string, &#96;area&#96; string, &#96;model&#96; string, &#96;brand&#96; string, &#96;sdk_version&#96; string, &#96;gmail&#96; string, &#96;height_width&#96; string, &#96;app_time&#96; string, &#96;network&#96; string, &#96;lng&#96; string, &#96;lat&#96; string, &#96;action&#96; string, &#96;goodsid&#96; string, &#96;place&#96; string, &#96;extend1&#96; string, &#96;category&#96; string, &#96;server_time&#96; string ) COMMENT &#39;å•†å“ç‚¹å‡»è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;display_log&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥12345678910111213141516171819202122232425262728293031323334353637383940414243444546#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdAPP3&#x3D;odstable_name&#x3D;display_loghive_table_name&#x3D;$APP2.mall__$table_namehive_origin_table_name&#x3D;$APP3.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;) select mid_id, user_id, version_code, version_name, lang, source, os, area, model, brand, sdk_version, gmail, height_width, app_time, network, lng, lat, get_json_object(event_json,&#39;$.kv.action&#39;) action, get_json_object(event_json,&#39;$.kv.goodsid&#39;) goodsid, get_json_object(event_json,&#39;$.kv.place&#39;) place, get_json_object(event_json,&#39;$.kv.extend1&#39;) extend1, get_json_object(event_json,&#39;$.kv.category&#39;) category, server_timefrom dwd.mall__event_logwhere dt&#x3D;&#39;$db_date&#39; and event_name&#x3D;&#39;display&#39;;&quot;$hive -e &quot;$sql&quot;9.1.4 å•†å“åˆ—è¡¨è¡¨å»ºè¡¨1234567891011121314151617181920212223242526272829303132333435drop table if exists dwd.mall__loading_logCREATE EXTERNAL TABLE &#96;dwd.mall__loading_log&#96;( &#96;mid_id&#96; string, &#96;user_id&#96; string, &#96;version_code&#96; string, &#96;version_name&#96; string, &#96;lang&#96; string, &#96;source&#96; string, &#96;os&#96; string, &#96;area&#96; string, &#96;model&#96; string, &#96;brand&#96; string, &#96;sdk_version&#96; string, &#96;gmail&#96; string, &#96;height_width&#96; string, &#96;app_time&#96; string, &#96;network&#96; string, &#96;lng&#96; string, &#96;lat&#96; string, &#96;action&#96; string, &#96;loading_time&#96; string, &#96;loading_way&#96; string, &#96;extend1&#96; string, &#96;extend2&#96; string, &#96;type&#96; string, &#96;type1&#96; string, &#96;server_time&#96; string ) COMMENT &#39;å•†å“åˆ—è¡¨è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;loading_log&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdAPP3&#x3D;odstable_name&#x3D;loading_loghive_table_name&#x3D;$APP2.mall__$table_namehive_origin_table_name&#x3D;$APP3.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select mid_id, user_id, version_code, version_name, lang, source, os, area, model, brand, sdk_version, gmail, height_width, app_time, network, lng, lat, get_json_object(event_json,&#39;$.kv.action&#39;) action, get_json_object(event_json,&#39;$.kv.loading_time&#39;) loading_time, get_json_object(event_json,&#39;$.kv.loading_way&#39;) loading_way, get_json_object(event_json,&#39;$.kv.extend1&#39;) extend1, get_json_object(event_json,&#39;$.kv.extend2&#39;) extend2, get_json_object(event_json,&#39;$.kv.type&#39;) type, get_json_object(event_json,&#39;$.kv.type1&#39;) type1, server_timefrom dwd.mall__event_logwhere dt&#x3D;&#39;$db_date&#39; and event_name&#x3D;&#39;loading&#39;;&quot;$hive -e &quot;$sql&quot;9.1.5 å¹¿å‘Šè¡¨å»ºè¡¨12345678910111213141516171819202122232425262728293031323334drop table if exists dwd.mall__ad_logCREATE EXTERNAL TABLE &#96;dwd.mall__ad_log&#96;( &#96;mid_id&#96; string, &#96;user_id&#96; string, &#96;version_code&#96; string, &#96;version_name&#96; string, &#96;lang&#96; string, &#96;source&#96; string, &#96;os&#96; string, &#96;area&#96; string, &#96;model&#96; string, &#96;brand&#96; string, &#96;sdk_version&#96; string, &#96;gmail&#96; string, &#96;height_width&#96; string, &#96;app_time&#96; string, &#96;network&#96; string, &#96;lng&#96; string, &#96;lat&#96; string, &#96;entry&#96; string, &#96;action&#96; string, &#96;contentType&#96; string, &#96;displayMills&#96; string, &#96;itemId&#96; string, &#96;activityId&#96; string, &#96;server_time&#96; string ) COMMENT &#39;å¹¿å‘Šè¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;ad_log&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdAPP3&#x3D;odstable_name&#x3D;ad_loghive_table_name&#x3D;$APP2.mall__$table_namehive_origin_table_name&#x3D;$APP3.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select mid_id, user_id, version_code, version_name, lang, source, os, area, model, brand, sdk_version, gmail, height_width, app_time, network, lng, lat, get_json_object(event_json,&#39;$.kv.entry&#39;) entry, get_json_object(event_json,&#39;$.kv.action&#39;) action, get_json_object(event_json,&#39;$.kv.contentType&#39;) contentType, get_json_object(event_json,&#39;$.kv.displayMills&#39;) displayMills, get_json_object(event_json,&#39;$.kv.itemId&#39;) itemId, get_json_object(event_json,&#39;$.kv.activityId&#39;) activityId, server_timefrom dwd.mall__event_logwhere dt&#x3D;&#39;db_date&#39; and event_name&#x3D;&#39;ad&#39;;&quot;$hive -e &quot;$sql&quot;9.1.6 æ¶ˆæ¯é€šçŸ¥è¡¨å»ºè¡¨1234567891011121314151617181920212223242526272829303132drop table if exists dwd.mall__notification_logCREATE EXTERNAL TABLE &#96;dwd.mall__notification_log&#96;( &#96;mid_id&#96; string, &#96;user_id&#96; string, &#96;version_code&#96; string, &#96;version_name&#96; string, &#96;lang&#96; string, &#96;source&#96; string, &#96;os&#96; string, &#96;area&#96; string, &#96;model&#96; string, &#96;brand&#96; string, &#96;sdk_version&#96; string, &#96;gmail&#96; string, &#96;height_width&#96; string, &#96;app_time&#96; string, &#96;network&#96; string, &#96;lng&#96; string, &#96;lat&#96; string, &#96;action&#96; string, &#96;noti_type&#96; string, &#96;ap_time&#96; string, &#96;content&#96; string, &#96;server_time&#96; string ) COMMENT &#39;æ¶ˆæ¯é€šçŸ¥è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;notification_log&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥123456789101112131415161718192021222324252627282930313233343536373839404142434445#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdAPP3&#x3D;odstable_name&#x3D;notification_loghive_table_name&#x3D;$APP2.mall__$table_namehive_origin_table_name&#x3D;$APP3.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select mid_id, user_id, version_code, version_name, lang, source, os, area, model, brand, sdk_version, gmail, height_width, app_time, network, lng, lat, get_json_object(event_json,&#39;$.kv.action&#39;) action, get_json_object(event_json,&#39;$.kv.noti_type&#39;) noti_type, get_json_object(event_json,&#39;$.kv.ap_time&#39;) ap_time, get_json_object(event_json,&#39;$.kv.content&#39;) content, server_timefrom dwd.mall__event_logwhere dt&#x3D;&#39;$db_date&#39; and event_name&#x3D;&#39;notification&#39;;&quot;$hive -e &quot;$sql&quot;9.1.7 ç”¨æˆ·åå°æ´»è·ƒè¡¨å»ºè¡¨1234567891011121314151617181920212223242526272829drop table if exists dwd.mall__active_background_logCREATE EXTERNAL TABLE &#96;dwd.mall__active_background_log&#96;( &#96;mid_id&#96; string, &#96;user_id&#96; string, &#96;version_code&#96; string, &#96;version_name&#96; string, &#96;lang&#96; string, &#96;source&#96; string, &#96;os&#96; string, &#96;area&#96; string, &#96;model&#96; string, &#96;brand&#96; string, &#96;sdk_version&#96; string, &#96;gmail&#96; string, &#96;height_width&#96; string, &#96;app_time&#96; string, &#96;network&#96; string, &#96;lng&#96; string, &#96;lat&#96; string, &#96;active_source&#96; string, &#96;server_time&#96; string ) COMMENT &#39;ç”¨æˆ·åå°æ´»è·ƒè¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;active_background_log&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥123456789101112131415161718192021222324252627282930313233343536373839404142#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdAPP3&#x3D;odstable_name&#x3D;active_background_loghive_table_name&#x3D;$APP2.mall__$table_namehive_origin_table_name&#x3D;$APP3.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select mid_id, user_id, version_code, version_name, lang, source, os, area, model, brand, sdk_version, gmail, height_width, app_time, network, lng, lat, get_json_object(event_json,&#39;$.kv.active_source&#39;) active_source, server_timefrom dwd.mall__event_logwhere dt&#x3D;&#39;$db_date&#39; and event_name&#x3D;&#39;active_background&#39;;&quot;$hive -e &quot;$sql&quot;9.1.8 è¯„è®ºè¡¨å»ºè¡¨123456789101112131415161718192021222324252627282930313233343536drop table if exists dwd.mall__comment_logCREATE EXTERNAL TABLE &#96;dwd.mall__comment_log&#96;( &#96;mid_id&#96; string, &#96;user_id&#96; string, &#96;version_code&#96; string, &#96;version_name&#96; string, &#96;lang&#96; string, &#96;source&#96; string, &#96;os&#96; string, &#96;area&#96; string, &#96;model&#96; string, &#96;brand&#96; string, &#96;sdk_version&#96; string, &#96;gmail&#96; string, &#96;height_width&#96; string, &#96;app_time&#96; string, &#96;network&#96; string, &#96;lng&#96; string, &#96;lat&#96; string, &#96;comment_id&#96; int, &#96;userid&#96; int, &#96;p_comment_id&#96; int, &#96;content&#96; string, &#96;addtime&#96; string, &#96;other_id&#96; int, &#96;praise_count&#96; int, &#96;reply_count&#96; int, &#96;server_time&#96; string ) COMMENT &#39;è¯„è®ºè¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;comment_log&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdAPP3&#x3D;odstable_name&#x3D;comment_loghive_table_name&#x3D;$APP2.mall__$table_namehive_origin_table_name&#x3D;$APP3.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select mid_id, user_id, version_code, version_name, lang, source, os, area, model, brand, sdk_version, gmail, height_width, app_time, network, lng, lat, get_json_object(event_json,&#39;$.kv.comment_id&#39;) comment_id, get_json_object(event_json,&#39;$.kv.userid&#39;) userid, get_json_object(event_json,&#39;$.kv.p_comment_id&#39;) p_comment_id, get_json_object(event_json,&#39;$.kv.content&#39;) content, get_json_object(event_json,&#39;$.kv.addtime&#39;) addtime, get_json_object(event_json,&#39;$.kv.other_id&#39;) other_id, get_json_object(event_json,&#39;$.kv.praise_count&#39;) praise_count, get_json_object(event_json,&#39;$.kv.reply_count&#39;) reply_count, server_timefrom dwd.mall__event_logwhere dt&#x3D;&#39;$db_date&#39; and event_name&#x3D;&#39;comment&#39;;&quot;$hive -e &quot;$sql&quot;9.1.9 æ”¶è—è¡¨å»ºè¡¨1234567891011121314151617181920212223242526272829303132drop table if exists dwd.mall__favorites_logCREATE EXTERNAL TABLE &#96;dwd.mall__favorites_log&#96;( &#96;mid_id&#96; string, &#96;user_id&#96; string, &#96;version_code&#96; string, &#96;version_name&#96; string, &#96;lang&#96; string, &#96;source&#96; string, &#96;os&#96; string, &#96;area&#96; string, &#96;model&#96; string, &#96;brand&#96; string, &#96;sdk_version&#96; string, &#96;gmail&#96; string, &#96;height_width&#96; string, &#96;app_time&#96; string, &#96;network&#96; string, &#96;lng&#96; string, &#96;lat&#96; string, &#96;id&#96; int, &#96;course_id&#96; int, &#96;userid&#96; int, &#96;add_time&#96; string, &#96;server_time&#96; string ) COMMENT &#39;æ”¶è—è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;favorites_log&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥123456789101112131415161718192021222324252627282930313233343536373839404142434445#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdAPP3&#x3D;odstable_name&#x3D;favorites_loghive_table_name&#x3D;$APP2.mall__$table_namehive_origin_table_name&#x3D;$APP3.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select mid_id, user_id, version_code, version_name, lang, source, os, area, model, brand, sdk_version, gmail, height_width, app_time, network, lng, lat, get_json_object(event_json,&#39;$.kv.id&#39;) id, get_json_object(event_json,&#39;$.kv.course_id&#39;) course_id, get_json_object(event_json,&#39;$.kv.userid&#39;) userid, get_json_object(event_json,&#39;$.kv.add_time&#39;) add_time, server_timefrom dwd.mall__event_logwhere dt&#x3D;&#39;$db_date&#39; and event_name&#x3D;&#39;favorites&#39;;&quot;$hive -e &quot;$sql&quot;9.1.10 ç‚¹èµè¡¨å»ºè¡¨123456789101112131415161718192021222324252627282930313233drop table if exists dwd.mall__praise_logCREATE EXTERNAL TABLE &#96;dwd.mall__praise_log&#96;( &#96;mid_id&#96; string, &#96;user_id&#96; string, &#96;version_code&#96; string, &#96;version_name&#96; string, &#96;lang&#96; string, &#96;source&#96; string, &#96;os&#96; string, &#96;area&#96; string, &#96;model&#96; string, &#96;brand&#96; string, &#96;sdk_version&#96; string, &#96;gmail&#96; string, &#96;height_width&#96; string, &#96;app_time&#96; string, &#96;network&#96; string, &#96;lng&#96; string, &#96;lat&#96; string, &#96;id&#96; string, &#96;userid&#96; string, &#96;target_id&#96; string, &#96;type&#96; string, &#96;add_time&#96; string, &#96;server_time&#96; string ) COMMENT &#39;ç‚¹èµè¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;praise_log&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥12345678910111213141516171819202122232425262728293031323334353637383940414243444546#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdAPP3&#x3D;odstable_name&#x3D;praise_loghive_table_name&#x3D;$APP2.mall__$table_namehive_origin_table_name&#x3D;$APP3.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select mid_id, user_id, version_code, version_name, lang, source, os, area, model, brand, sdk_version, gmail, height_width, app_time, network, lng, lat, get_json_object(event_json,&#39;$.kv.id&#39;) id, get_json_object(event_json,&#39;$.kv.userid&#39;) userid, get_json_object(event_json,&#39;$.kv.target_id&#39;) target_id, get_json_object(event_json,&#39;$.kv.type&#39;) type, get_json_object(event_json,&#39;$.kv.add_time&#39;) add_time, server_timefrom dwd.mall__event_logwhere dt&#x3D;&#39;$db_date&#39; and event_name&#x3D;&#39;praise&#39;;&quot;$hive -e &quot;$sql&quot;9.1.11 é”™è¯¯æ—¥å¿—è¡¨å»ºè¡¨123456789101112131415161718192021222324252627282930drop table if exists dwd.mall__error_logCREATE EXTERNAL TABLE &#96;dwd.mall__error_log&#96;( &#96;mid_id&#96; string, &#96;user_id&#96; string, &#96;version_code&#96; string, &#96;version_name&#96; string, &#96;lang&#96; string, &#96;source&#96; string, &#96;os&#96; string, &#96;area&#96; string, &#96;model&#96; string, &#96;brand&#96; string, &#96;sdk_version&#96; string, &#96;gmail&#96; string, &#96;height_width&#96; string, &#96;app_time&#96; string, &#96;network&#96; string, &#96;lng&#96; string, &#96;lat&#96; string, &#96;errorBrief&#96; string, &#96;errorDetail&#96; string, &#96;server_time&#96; string ) COMMENT &#39;é”™è¯¯æ—¥å¿—è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;error_log&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥12345678910111213141516171819202122232425262728293031323334353637383940414243#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdAPP3&#x3D;odstable_name&#x3D;error_loghive_table_name&#x3D;$APP2.mall__$table_namehive_origin_table_name&#x3D;$APP3.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select mid_id, user_id, version_code, version_name, lang, source, os, area, model, brand, sdk_version, gmail, height_width, app_time, network, lng, lat, get_json_object(event_json,&#39;$.kv.errorBrief&#39;) errorBrief, get_json_object(event_json,&#39;$.kv.errorDetail&#39;) errorDetail, server_timefrom dwd.mall__event_logwhere dt&#x3D;&#39;$db_date&#39; and event_name&#x3D;&#39;error&#39;;&quot;$hive -e &quot;$sql&quot;9.2 dwdå±‚æ„å»º(ä¸šåŠ¡åº“)æ­¤å±‚åœ¨æ„å»ºä¹‹åˆï¼Œå¢é‡è¡¨éœ€è¦åŠ¨æ€åˆ†åŒºæ¥åˆ’åˆ†æ—¶é—´ï¼Œå°†æ•°æ®æ”¾å…¥æŒ‡å®šåˆ†åŒºäº‹å®/ç»´åº¦æ—¶é—´ç”¨æˆ·åœ°åŒºå•†å“ä¼˜æƒ å·æ´»åŠ¨ç¼–ç åº¦é‡è®¢å•âˆšâˆšâˆšâˆšä»¶æ•°/é‡‘é¢è®¢å•è¯¦æƒ…âˆšâˆšâˆšä»¶æ•°/é‡‘é¢æ”¯ä»˜âˆšâˆšæ¬¡æ•°/é‡‘é¢åŠ å…¥è´­ç‰©è½¦âˆšâˆšâˆšä»¶æ•°/é‡‘é¢æ”¶è—âˆšâˆšâˆšä¸ªæ•°è¯„ä»·âˆšâˆšâˆšä¸ªæ•°é€€æ¬¾âˆšâˆšâˆšä»¶æ•°/é‡‘é¢ä¼˜æƒ å·é¢†ç”¨âˆšâˆšâˆšä¸ªæ•°9.2.1 å•†å“ç»´åº¦è¡¨(å…¨é‡)å»ºè¡¨123456789101112131415161718192021222324252627drop table if exists dwd.mall__dim_sku_info CREATE EXTERNAL TABLE &#96;dwd.mall__dim_sku_info&#96;(&#96;id&#96; string COMMENT &#39;å•†å“ id&#39;,&#96;spu_id&#96; string COMMENT &#39;spuid&#39;,&#96;price&#96; double COMMENT &#39;å•†å“ä»·æ ¼&#39;,&#96;sku_name&#96; string COMMENT &#39;å•†å“åç§°&#39;,&#96;sku_desc&#96; string COMMENT &#39;å•†å“æè¿°&#39;,&#96;weight&#96; double COMMENT &#39;é‡é‡&#39;,&#96;tm_id&#96; string COMMENT &#39;å“ç‰Œ id&#39;,&#96;tm_name&#96; string COMMENT &#39;å“ç‰Œåç§°&#39;,&#96;category3_id&#96; string COMMENT &#39;ä¸‰çº§åˆ†ç±» id&#39;,&#96;category2_id&#96; string COMMENT &#39;äºŒçº§åˆ†ç±» id&#39;,&#96;category1_id&#96; string COMMENT &#39;ä¸€çº§åˆ†ç±» id&#39;,&#96;category3_name&#96; string COMMENT &#39;ä¸‰çº§åˆ†ç±»åç§°&#39;,&#96;category2_name&#96; string COMMENT &#39;äºŒçº§åˆ†ç±»åç§°&#39;,&#96;category1_name&#96; string COMMENT &#39;ä¸€çº§åˆ†ç±»åç§°&#39;,&#96;spu_name&#96; string COMMENT &#39;spu åç§°&#39;,&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´&#39; ) COMMENT &#39;å•†å“ç»´åº¦è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;dim_sku_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdtable_name&#x3D;dim_sku_infohive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select sku.id, sku.spu_id, sku.price, sku.sku_name, sku.sku_desc, sku.weight, sku.tm_id, ob.tm_name, sku.category3_id, c2.id category2_id, c1.id category1_id, c3.name category3_name, c2.name category2_name, c1.name category1_name, spu.spu_name, from_unixtime(cast(sku.create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_timefrom(select * from ods.mall__sku_info where dt&#x3D;&#39;$db_date&#39;)skujoin(select * from ods.mall__base_trademark where dt&#x3D;&#39;$db_date&#39;)ob on sku.tm_id&#x3D;ob.tm_idjoin(select * from ods.mall__spu_info where dt&#x3D;&#39;$db_date&#39;)spu on spu.id &#x3D; sku.spu_idjoin(select * from ods.mall__base_category3 where dt&#x3D;&#39;$db_date&#39;)c3 on sku.category3_id&#x3D;c3.idjoin(select * from ods.mall__base_category2 where dt&#x3D;&#39;$db_date&#39;)c2 on c3.category2_id&#x3D;c2.idjoin(select * from ods.mall__base_category1 where dt&#x3D;&#39;$db_date&#39;)c1 on c2.category1_id&#x3D;c1.id;&quot;$hive -e &quot;$sql&quot;9.2.2 ä¼˜æƒ åˆ¸ä¿¡æ¯ç»´åº¦è¡¨(å…¨é‡)å»ºè¡¨123456789101112131415161718192021222324252627drop table if exists dwd.mall__dim_coupon_info CREATE EXTERNAL TABLE &#96;dwd.mall__dim_coupon_info&#96;(&#96;id&#96; string COMMENT &#39;è´­ç‰©åˆ¸ç¼–å·&#39;,&#96;coupon_name&#96; string COMMENT &#39;è´­ç‰©åˆ¸åç§°&#39;,&#96;coupon_type&#96; string COMMENT &#39;è´­ç‰©åˆ¸ç±»å‹ 1 ç°é‡‘åˆ¸ 2 æŠ˜æ‰£åˆ¸ 3 æ»¡å‡åˆ¸ 4 æ»¡ä»¶æ‰“æŠ˜åˆ¸&#39;,&#96;condition_amount&#96; string COMMENT &#39;æ»¡é¢æ•°&#39;,&#96;condition_num&#96; string COMMENT &#39;æ»¡ä»¶æ•°&#39;,&#96;activity_id&#96; string COMMENT &#39;æ´»åŠ¨ç¼–å·&#39;,&#96;benefit_amount&#96; string COMMENT &#39;å‡é‡‘é¢&#39;,&#96;benefit_discount&#96; string COMMENT &#39;æŠ˜æ‰£&#39;,&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,&#96;range_type&#96; string COMMENT &#39;èŒƒå›´ç±»å‹ 1ã€å•†å“ 2ã€å“ç±» 3ã€å“ç‰Œ&#39;,&#96;spu_id&#96; string COMMENT &#39;å•†å“ id&#39;,&#96;tm_id&#96; string COMMENT &#39;å“ç‰Œ id&#39;,&#96;category3_id&#96; string COMMENT &#39;å“ç±» id&#39;,&#96;limit_num&#96; string COMMENT &#39;æœ€å¤šé¢†ç”¨æ¬¡æ•°&#39;,&#96;operate_time&#96; string COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;,&#96;expire_time&#96; string COMMENT &#39;è¿‡æœŸæ—¶é—´&#39; ) COMMENT &#39;ä¼˜æƒ åˆ¸ä¿¡æ¯ç»´åº¦è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;dim_coupon_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥12345678910111213141516171819202122232425262728293031323334353637#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdtable_name&#x3D;dim_coupon_infohive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select id, coupon_name, coupon_type, condition_amount, condition_num, activity_id, benefit_amount, benefit_discount, from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time, range_type, spu_id, tm_id, category3_id, limit_num, from_unixtime(cast(operate_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) operate_time, from_unixtime(cast(expire_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) expire_timefrom ods.mall__coupon_infowhere dt&#x3D;&#39;$db_date&#39;;&quot;$hive -e &quot;$sql&quot;9.2.3 æ´»åŠ¨ç»´åº¦è¡¨(å…¨é‡)å»ºè¡¨12345678910111213141516171819202122drop table if exists dwd.mall__dim_activity_info CREATE EXTERNAL TABLE &#96;dwd.mall__dim_activity_info&#96;(&#96;id&#96; string COMMENT &#39;ç¼–å·&#39;,&#96;activity_name&#96; string COMMENT &#39;æ´»åŠ¨åç§°&#39;,&#96;activity_type&#96; string COMMENT &#39;æ´»åŠ¨ç±»å‹&#39;,&#96;condition_amount&#96; string COMMENT &#39;æ»¡å‡é‡‘é¢&#39;,&#96;condition_num&#96; string COMMENT &#39;æ»¡å‡ä»¶æ•°&#39;,&#96;benefit_amount&#96; string COMMENT &#39;ä¼˜æƒ é‡‘é¢&#39;,&#96;benefit_discount&#96; string COMMENT &#39;ä¼˜æƒ æŠ˜æ‰£&#39;,&#96;benefit_level&#96; string COMMENT &#39;ä¼˜æƒ çº§åˆ«&#39;,&#96;start_time&#96; string COMMENT &#39;å¼€å§‹æ—¶é—´&#39;,&#96;end_time&#96; string COMMENT &#39;ç»“æŸæ—¶é—´&#39;,&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´&#39; ) COMMENT &#39;æ´»åŠ¨ç»´åº¦è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;dim_activity_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥1234567891011121314151617181920212223242526272829303132333435363738#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdtable_name&#x3D;dim_activity_infohive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select info.id, info.activity_name, info.activity_type, rule.condition_amount, rule.condition_num, rule.benefit_amount, rule.benefit_discount, rule.benefit_level, from_unixtime(cast(info.start_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) start_time, from_unixtime(cast(info.end_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) end_time, from_unixtime(cast(info.create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_timefrom(select * from ods.mall__activity_info where dt&#x3D;&#39;$db_date&#39;)infoleft join(select * from ods.mall__activity_rule where dt&#x3D;&#39;$db_date&#39;)rule on info.id &#x3D; rule.activity_id;&quot;$hive -e &quot;$sql&quot;9.2.4 åœ°åŒºç»´åº¦è¡¨(ç‰¹æ®Š)å»ºè¡¨1234567891011121314151617drop table if exists dwd.mall__dim_base_province CREATE EXTERNAL TABLE &#96;dwd.mall__dim_base_province&#96;(&#96;id&#96; string COMMENT &#39;id&#39;,&#96;province_name&#96; string COMMENT &#39;çœå¸‚åç§°&#39;,&#96;area_code&#96; string COMMENT &#39;åœ°åŒºç¼–ç &#39;,&#96;iso_code&#96; string COMMENT &#39;ISO ç¼–ç &#39;,&#96;region_id&#96; string COMMENT &#39;åœ°åŒº id&#39;,&#96;region_name&#96; string COMMENT &#39;åœ°åŒºåç§°&#39; ) COMMENT &#39;åœ°åŒºç»´åº¦è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;dim_base_province&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥12345678910111213141516171819202122232425262728#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdtable_name&#x3D;dim_base_provincehive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select bp.id, bp.name, bp.area_code, bp.iso_code, bp.region_id, br.region_namefrom ods.mall__base_province bpjoin ods.mall__base_region bron bp.region_id&#x3D;br.id;&quot;$hive -e &quot;$sql&quot;9.2.5 æ—¶é—´ç»´åº¦è¡¨(ç‰¹æ®Š)å»ºè¡¨1234567891011121314151617181920drop table if exists dwd.mall__dim_date_info CREATE EXTERNAL TABLE &#96;dwd.mall__dim_date_info&#96;(&#96;date_id&#96; string COMMENT &#39;æ—¥&#39;,&#96;week_id&#96; int COMMENT &#39;å‘¨&#39;,&#96;week_day&#96; int COMMENT &#39;å‘¨çš„ç¬¬å‡ å¤©&#39;,&#96;day&#96; int COMMENT &#39;æ¯æœˆçš„ç¬¬å‡ å¤©&#39;,&#96;month&#96; int COMMENT &#39;ç¬¬å‡ æœˆ&#39;,&#96;quarter&#96; int COMMENT &#39;ç¬¬å‡ å­£åº¦&#39;,&#96;year&#96; int COMMENT &#39;å¹´&#39;,&#96;is_workday&#96; int COMMENT &#39;æ˜¯å¦æ˜¯å‘¨æœ«&#39;,&#96;holiday_id&#96; int COMMENT &#39;æ˜¯å¦æ˜¯èŠ‚å‡æ—¥&#39; ) COMMENT &#39;æ—¶é—´ç»´åº¦è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;dim_date_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥1234567891011121314151617181920212223242526272829#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdtable_name&#x3D;dim_date_infohive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select date_id, week_id, week_day, day, month, quarter, year, is_workday, holiday_idfrom ods.mall__date_info&quot;$hive -e &quot;$sql&quot;9.2.6 ç”¨æˆ·ç»´åº¦è¡¨(æ–°å¢åŠå˜åŒ–-ç¼“æ…¢å˜åŒ–ç»´-æ‹‰é“¾è¡¨)9.2.6.1 æ‹‰é“¾è¡¨ä»‹ç»æ‹‰é“¾è¡¨ï¼Œè®°å½•æ¯æ¡ä¿¡æ¯çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸€æ—¦ä¸€æ¡è®°å½•çš„ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œå°±é‡æ–°å¼€å§‹ä¸€æ¡æ–°çš„è®°å½•ï¼Œå¹¶æŠŠå½“å‰æ—¥æœŸæ”¾å…¥ç”Ÿæ•ˆå¼€å§‹æ—¥æœŸã€‚å¦‚æœå½“å‰ä¿¡æ¯è‡³ä»Šæœ‰æ•ˆï¼Œåœ¨ç”Ÿæ•ˆç»“æŸæ—¥æœŸä¸­å¡«å…¥ä¸€ä¸ªæå¤§å€¼ï¼ˆå¦‚:9999-99-99ï¼‰,ä¸‹è¡¨ä¸ºå¼ ä¸‰çš„æ‰‹æœºå·å˜åŒ–ä¾‹å­ç”¨æˆ·IDå§“åæ‰‹æœºå·å¼€å§‹æ—¥æœŸç»“æŸæ—¥æœŸ1å¼ ä¸‰134XXXX50502019-01-012019-01-021å¼ ä¸‰139XXXX32322019-01-032020-01-011å¼ ä¸‰137XXXX76762020-01-029999-99-99é€‚åˆåœºæ™¯ï¼šæ•°æ®ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†ä¸å˜ï¼ˆå³ï¼šç¼“æ…¢å˜åŒ–ç»´ï¼‰æ¯”å¦‚ï¼šç”¨æˆ·ä¿¡æ¯å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯æ¯å¤©å˜åŒ–æ¯”ä¾‹ä¸é«˜ï¼ŒæŒ‰ç…§æ¯æ—¥å…¨é‡ï¼Œåˆ™æ•ˆç‡ä½å¦‚ä½•ä½¿ç”¨æ‹‰é“¾è¡¨ï¼šé€šè¿‡â€“&gt;ç”Ÿæ•ˆå¼€å§‹æ—¥æœŸ&lt;=æŸä¸ªæ—¥æœŸ ä¸” ç”Ÿæ•ˆç»“æŸæ—¥æœŸ&gt;=æŸä¸ªæ—¥æœŸï¼Œèƒ½å¤Ÿå¾—åˆ°æŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®å…¨é‡åˆ‡ç‰‡ã€‚æ‹‰é“¾è¡¨å½¢æˆè¿‡ç¨‹åˆ¶ä½œæµç¨‹ç”¨æˆ·å½“æ—¥å…¨éƒ¨æ•°æ®å’ŒMySQLä¸­æ¯å¤©å˜åŒ–çš„æ•°æ®æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ª&lt;æ–°çš„ä¸´æ—¶æ‹‰é“¾è¡¨ã€‚ç”¨ä¸´æ—¶æ‹‰é“¾è¡¨è¦†ç›–æ—§çš„æ‹‰é“¾è¡¨æ•°æ®ã€‚ä»è€Œè§£å†³Hiveä¸­æ•°æ®ä¸èƒ½æ›´æ–°çš„é—®é¢˜9.2.6.2 ç”¨æˆ·ç»´åº¦è¡¨ç”¨æˆ·è¡¨ä¸­çš„æ•°æ®æ¯æ—¥æ—¢æœ‰å¯èƒ½æ–°å¢ï¼Œä¹Ÿæœ‰å¯èƒ½ä¿®æ”¹ï¼Œå±äºç¼“æ…¢å˜åŒ–ç»´åº¦ï¼Œæ­¤å¤„é‡‡ç”¨æ‹‰é“¾è¡¨å­˜å‚¨ç”¨æˆ·ç»´åº¦æ•°æ®ã€‚å»ºè¡¨123456789101112131415161718drop table if exists dwd.mall__dim_user_info_his CREATE EXTERNAL TABLE &#96;dwd.mall__dim_user_info_his&#96;(&#96;id&#96; string COMMENT &#39;ç”¨æˆ· id&#39;,&#96;name&#96; string COMMENT &#39;å§“å&#39;,&#96;birthday&#96; string COMMENT &#39;ç”Ÿæ—¥&#39;,&#96;gender&#96; string COMMENT &#39;æ€§åˆ«&#39;,&#96;email&#96; string COMMENT &#39;é‚®ç®±&#39;,&#96;user_level&#96; string COMMENT &#39;ç”¨æˆ·ç­‰çº§&#39;,&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,&#96;operate_time&#96; string COMMENT &#39;æ“ä½œæ—¶é—´&#39;,&#96;start_date&#96; string COMMENT &#39;æœ‰æ•ˆå¼€å§‹æ—¥æœŸ&#39;,&#96;end_date&#96; string COMMENT &#39;æœ‰æ•ˆç»“æŸæ—¥æœŸ&#39; ) COMMENT &#39;ç”¨æˆ·æ‹‰é“¾è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;dim_user_info_his&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)ä¸´æ—¶è¡¨å»ºè¡¨(ç»“æ„ä¸ä¸»è¡¨ç›¸åŒ)123456789101112131415161718drop table if exists dwd.mall__dim_user_info_his_tmp CREATE EXTERNAL TABLE &#96;dwd.mall__dim_user_info_his_tmp&#96;(&#96;id&#96; string COMMENT &#39;ç”¨æˆ· id&#39;,&#96;name&#96; string COMMENT &#39;å§“å&#39;,&#96;birthday&#96; string COMMENT &#39;ç”Ÿæ—¥&#39;,&#96;gender&#96; string COMMENT &#39;æ€§åˆ«&#39;,&#96;email&#96; string COMMENT &#39;é‚®ç®±&#39;,&#96;user_level&#96; string COMMENT &#39;ç”¨æˆ·ç­‰çº§&#39;,&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,&#96;operate_time&#96; string COMMENT &#39;æ“ä½œæ—¶é—´&#39;,&#96;start_date&#96; string COMMENT &#39;æœ‰æ•ˆå¼€å§‹æ—¥æœŸ&#39;,&#96;end_date&#96; string COMMENT &#39;æœ‰æ•ˆç»“æŸæ—¥æœŸ&#39; ) COMMENT &#39;ç”¨æˆ·æ‹‰é“¾è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;dim_user_info_his_tmp&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)é¦–å…ˆï¼ˆä¸»è¡¨ï¼‰æ•°æ®åˆå§‹åŒ–ï¼Œåªåšä¸€æ¬¡123456789101112131415161718192021222324252627282930#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdtable_name&#x3D;dim_user_info_hishive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_nameselect id, name, from_unixtime(cast(birthday&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) birthday, gender, email, user_level, from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time, from_unixtime(cast(operate_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) operate_time, &#39;$db_date&#39;, &#39;9999-99-99&#39;from ods.mall__user_info oiwhere oi.dt&#x3D;&#39;$db_date&#39;;&quot;$hive -e &quot;$sql&quot;ä¸´æ—¶è¡¨æ•°æ®è®¡ç®—å¯¼å…¥(åœ¨ä¸»è¡¨æ•°æ®ä¹‹åæ‰§è¡Œ)12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdtable_name&#x3D;dim_user_info_his_tmphive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_nameselect* from( --æŸ¥è¯¢å½“å‰æ—¶é—´çš„æ‰€æœ‰ä¿¡æ¯ select cast(id as string) id, name, from_unixtime(cast(birthday&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) birthday, gender, email, user_level, from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time, from_unixtime(cast(operate_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) operate_time, &#39;$db_date&#39; start_date, &#39;9999-99-99&#39; end_date from ods.mall__user_info where dt&#x3D;&#39;$db_date&#39; union all --æŸ¥è¯¢å½“å‰å˜åŒ–äº†çš„æ•°æ®ï¼Œä¿®æ”¹æ—¥æœŸ select uh.id, uh.name, from_unixtime(cast(uh.birthday&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) birthday, uh.gender, uh.email, uh.user_level, from_unixtime(cast(uh.create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time, from_unixtime(cast(uh.operate_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) operate_time, uh.start_date, if(ui.id is not null and uh.end_date&#x3D;&#39;9999-99-99&#39;, date_add(ui.dt,-1),uh.end_date) end_date from dwd.mall__dim_user_info_his uh left join ( --æŸ¥è¯¢å½“å‰æ—¶é—´çš„æ‰€æœ‰ä¿¡æ¯ select cast(id as string) id, name, from_unixtime(cast(birthday&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) birthday, gender, email, user_level, from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time, from_unixtime(cast(operate_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) operate_time, dt from ods.mall__user_info where dt&#x3D;&#39;$db_date&#39; ) ui on uh.id&#x3D;ui.id)hisorder by his.id, start_date;&quot;$hive -e &quot;$sql&quot;æ•°æ®å¯¼å…¥123456789101112131415161718#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdtable_name&#x3D;dim_user_info_hishive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_nameselect * from dwd.mall__dim_user_info_his_tmp;&quot;$hive -e &quot;$sql&quot;9.2.7 è®¢å•è¯¦æƒ…äº‹å®è¡¨(äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢)å»ºè¡¨123456789101112131415161718192021drop table if exists dwd.mall__fact_order_detail CREATE EXTERNAL TABLE &#96;dwd.mall__fact_order_detail&#96;( &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;, &#96;order_id&#96; bigint COMMENT &#39;è®¢å•ç¼–å·&#39;, &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·id&#39;, &#96;sku_id&#96; bigint COMMENT &#39;sku_id&#39;, &#96;sku_name&#96; string COMMENT &#39;skuåç§°&#39;, &#96;order_price&#96; decimal(10,2) COMMENT &#39;è´­ä¹°ä»·æ ¼(ä¸‹å•æ—¶skuä»·æ ¼ï¼‰&#39;, &#96;sku_num&#96; string COMMENT &#39;è´­ä¹°ä¸ªæ•°&#39;, &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;, &#96;province_id&#96; string COMMENT &#39;çœä»½ID&#39;, &#96;total_amount&#96; decimal(20,2) COMMENT &#39;è®¢å•æ€»é‡‘é¢&#39; ) COMMENT &#39;è®¢å•æ˜ç»†è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;fact_order_detail&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥1234567891011121314151617181920212223242526272829303132#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdtable_name&#x3D;fact_order_detailhive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select od.id, od.order_id, od.user_id, od.sku_id, od.sku_name, od.order_price, od.sku_num, od.create_time, oi.province_id, od.order_price*od.sku_num from (select * from ods.mall__order_detail where dt&#x3D;&#39;$db_date&#39; ) od join (select * from ods.mall__order_info where dt&#x3D;&#39;$db_date&#39; ) oi on od.order_id&#x3D;oi.id;&quot;$hive -e &quot;$sql&quot;9.2.7 æ”¯ä»˜äº‹å®è¡¨(äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢)å»ºè¡¨123456789101112131415161718192021drop table if exists dwd.mall__fact_payment_info CREATE EXTERNAL TABLE &#96;dwd.mall__fact_payment_info&#96;(&#96;id&#96; string COMMENT &#39;&#39;,&#96;out_trade_no&#96; string COMMENT &#39;å¯¹å¤–ä¸šåŠ¡ç¼–å·&#39;,&#96;order_id&#96; string COMMENT &#39;è®¢å•ç¼–å·&#39;,&#96;user_id&#96; string COMMENT &#39;ç”¨æˆ·ç¼–å·&#39;,&#96;alipay_trade_no&#96; string COMMENT &#39;æ”¯ä»˜å®äº¤æ˜“æµæ°´ç¼–å·&#39;,&#96;payment_amount&#96; decimal(16,2) COMMENT &#39;æ”¯ä»˜é‡‘é¢&#39;,&#96;subject&#96; string COMMENT &#39;äº¤æ˜“å†…å®¹&#39;,&#96;payment_type&#96; string COMMENT &#39;æ”¯ä»˜ç±»å‹&#39;,&#96;payment_time&#96; string COMMENT &#39;æ”¯ä»˜æ—¶é—´&#39;,&#96;province_id&#96; string COMMENT &#39;çœä»½ ID&#39; ) COMMENT &#39;æ”¯ä»˜äº‹å®è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;fact_payment_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥1234567891011121314151617181920212223242526272829303132333435363738#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdtable_name&#x3D;fact_payment_infohive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select pi.id, pi.out_trade_no, pi.order_id, pi.user_id, pi.alipay_trade_no, pi.total_amount, pi.subject, pi.payment_type, from_unixtime(cast(pi.payment_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) payment_time, oi.province_idfrom(select * from ods.mall__payment_info where dt&#x3D;&#39;$db_date&#39;)pijoin(select id, province_id from ods.mall__order_info where dt&#x3D;&#39;$db_date&#39;)oion pi.order_id &#x3D; oi.id;&quot;$hive -e &quot;$sql&quot;9.2.8 é€€æ¬¾äº‹å®è¡¨(äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢)å»ºè¡¨1234567891011121314151617181920drop table if exists dwd.mall__fact_order_refund_info CREATE EXTERNAL TABLE &#96;dwd.mall__fact_order_refund_info&#96;(&#96;id&#96; string COMMENT &#39;ç¼–å·&#39;,&#96;user_id&#96; string COMMENT &#39;ç”¨æˆ· ID&#39;,&#96;order_id&#96; string COMMENT &#39;è®¢å• ID&#39;,&#96;sku_id&#96; string COMMENT &#39;å•†å“ ID&#39;,&#96;refund_type&#96; string COMMENT &#39;é€€æ¬¾ç±»å‹&#39;,&#96;refund_num&#96; bigint COMMENT &#39;é€€æ¬¾ä»¶æ•°&#39;,&#96;refund_amount&#96; decimal(16,2) COMMENT &#39;é€€æ¬¾é‡‘é¢&#39;,&#96;refund_reason_type&#96; string COMMENT &#39;é€€æ¬¾åŸå› ç±»å‹&#39;,&#96;create_time&#96; string COMMENT &#39;é€€æ¬¾æ—¶é—´&#39; ) COMMENT &#39;é€€æ¬¾äº‹å®è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;fact_order_refund_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥123456789101112131415161718192021222324252627282930#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdtable_name&#x3D;fact_order_refund_infohive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select id, user_id, order_id, sku_id, refund_type, refund_num, refund_amount, refund_reason_type, from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_timefrom ods.mall__order_refund_infowhere dt&#x3D;&#39;$db_date&#39;;&quot;$hive -e &quot;$sql&quot;9.2.9 è¯„ä»·äº‹å®è¡¨(äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢)å»ºè¡¨123456789101112131415161718drop table if exists dwd.mall__fact_comment_info CREATE EXTERNAL TABLE &#96;dwd.mall__fact_comment_info&#96;(&#96;id&#96; string COMMENT &#39;ç¼–å·&#39;,&#96;user_id&#96; string COMMENT &#39;ç”¨æˆ· ID&#39;,&#96;sku_id&#96; string COMMENT &#39;å•†å“ sku&#39;,&#96;spu_id&#96; string COMMENT &#39;å•†å“ spu&#39;,&#96;order_id&#96; string COMMENT &#39;è®¢å• ID&#39;,&#96;appraise&#96; string COMMENT &#39;è¯„ä»·&#39;,&#96;create_time&#96; string COMMENT &#39;è¯„ä»·æ—¶é—´&#39; ) COMMENT &#39;è¯„ä»·äº‹å®è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;fact_comment_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥12345678910111213141516171819202122232425262728#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdtable_name&#x3D;fact_comment_infohive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select id, user_id, sku_id, spu_id, order_id, appraise, from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_timefrom ods.mall__comment_infowhere dt&#x3D;&#39;$db_date&#39;;&quot;$hive -e &quot;$sql&quot;9.2.10 åŠ è´­äº‹å®è¡¨(å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨-å…¨é‡)å»ºè¡¨123456789101112131415161718192021drop table if exists dwd.mall__fact_cart_info CREATE EXTERNAL TABLE &#96;dwd.mall__fact_cart_info&#96;(&#96;id&#96; string COMMENT &#39;ç¼–å·&#39;,&#96;user_id&#96; string COMMENT &#39;ç”¨æˆ· id&#39;,&#96;sku_id&#96; string COMMENT &#39;skuid&#39;,&#96;cart_price&#96; string COMMENT &#39;æ”¾å…¥è´­ç‰©è½¦æ—¶ä»·æ ¼&#39;,&#96;sku_num&#96; string COMMENT &#39;æ•°é‡&#39;,&#96;sku_name&#96; string COMMENT &#39;sku åç§° (å†—ä½™)&#39;,&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,&#96;operate_time&#96; string COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;,&#96;is_ordered&#96; string COMMENT &#39;æ˜¯å¦å·²ç»ä¸‹å•ã€‚1 ä¸ºå·²ä¸‹å•;0 ä¸ºæœªä¸‹å•&#39;,&#96;order_time&#96; string COMMENT &#39;ä¸‹å•æ—¶é—´&#39; ) COMMENT &#39;åŠ è´­äº‹å®è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;fact_cart_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥12345678910111213141516171819202122232425262728293031#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdtable_name&#x3D;fact_cart_infohive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select id, user_id, sku_id, cart_price, sku_num, sku_name, from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time, from_unixtime(cast(operate_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) operate_time, is_ordered, from_unixtime(cast(order_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) order_timefrom ods.mall__cart_infowhere dt&#x3D;&#39;$db_date&#39;;&quot;$hive -e &quot;$sql&quot;9.2.11 æ”¶è—äº‹å®è¡¨(å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨-å…¨é‡)å»ºè¡¨123456789101112131415161718drop table if exists dwd.mall__fact_favor_info CREATE EXTERNAL TABLE &#96;dwd.mall__fact_favor_info&#96;(&#96;id&#96; string COMMENT &#39;ç¼–å·&#39;,&#96;user_id&#96; string COMMENT &#39;ç”¨æˆ· id&#39;,&#96;sku_id&#96; string COMMENT &#39;skuid&#39;,&#96;spu_id&#96; string COMMENT &#39;spuid&#39;,&#96;is_cancel&#96; string COMMENT &#39;æ˜¯å¦å–æ¶ˆ&#39;,&#96;create_time&#96; string COMMENT &#39;æ”¶è—æ—¶é—´&#39;,&#96;cancel_time&#96; string COMMENT &#39;å–æ¶ˆæ—¶é—´&#39; ) COMMENT &#39;æ”¶è—äº‹å®è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;fact_favor_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥12345678910111213141516171819202122232425262728#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdtable_name&#x3D;fact_favor_infohive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select id, user_id, sku_id, spu_id, is_cancel, from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time, from_unixtime(cast(cancel_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) cancel_timefrom ods.mall__favor_infowhere dt&#x3D;&#39;$db_date&#39;;&quot;$hive -e &quot;$sql&quot;9.2.12 ä¼˜æƒ åˆ¸é¢†ç”¨äº‹å®è¡¨(ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢åŠå˜åŒ–)å»ºè¡¨12345678910111213141516171819drop table if exists dwd.mall__fact_coupon_use CREATE EXTERNAL TABLE &#96;dwd.mall__fact_coupon_use&#96;(&#96;&#96; string COMMENT &#39;ç¼–å·&#39;,&#96;coupon_id&#96; string COMMENT &#39;ä¼˜æƒ åˆ¸ ID&#39;,&#96;user_id&#96; string COMMENT &#39;userid&#39;,&#96;order_id&#96; string COMMENT &#39;è®¢å• id&#39;,&#96;coupon_status&#96; string COMMENT &#39;ä¼˜æƒ åˆ¸çŠ¶æ€&#39;,&#96;get_time&#96; string COMMENT &#39;é¢†å–æ—¶é—´&#39;,&#96;using_time&#96; string COMMENT &#39;ä½¿ç”¨æ—¶é—´(ä¸‹å•)&#39;,&#96;used_time&#96; string COMMENT &#39;ä½¿ç”¨æ—¶é—´(æ”¯ä»˜)&#39; ) COMMENT &#39;ä¼˜æƒ åˆ¸é¢†ç”¨äº‹å®è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;fact_coupon_use&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)dt æ˜¯æŒ‰ç…§ä¼˜æƒ å·é¢†ç”¨æ—¶é—´ get_time åšä¸ºåˆ†åŒºã€‚get_time ä¸ºé¢†ç”¨æ—¶é—´ï¼Œé¢†ç”¨è¿‡åæ•°æ®å°±éœ€è¦å­˜åœ¨ï¼Œç„¶ååœ¨ä¸‹å•å’Œæ”¯ä»˜çš„æ—¶å€™å åŠ æ›´æ–°æ—¶é—´æ•°æ®å¯¼å…¥12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdtable_name&#x3D;fact_coupon_usehive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; set hive.exec.dynamic.partition.mode&#x3D;nonstrict;insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select if(new.id is null,old.id,new.id) id, if(new.coupon_id is null,old.coupon_id,new.coupon_id) coupon_id, if(new.user_id is null,old.user_id,new.user_id) user_id, if(new.order_id is null,old.order_id,new.order_id) order_id, if(new.coupon_status is null,old.coupon_status,new.coupon_status) coupon_status, from_unixtime(cast(if(new.get_time is null,old.get_time,new.get_time)&#x2F;1000 as bigint),&#39;yyyy-MM-dd&#39;) get_time, from_unixtime(cast(if(new.using_time is null,old.using_time,new.using_time)&#x2F;1000 as bigint),&#39;yyyy-MM-dd&#39;) using_time, from_unixtime(cast(if(new.used_time is null,old.used_time,new.used_time)&#x2F;1000 as bigint),&#39;yyyy-MM-dd&#39;), from_unixtime(cast(if(new.get_time is null,old.get_time,new.get_time)&#x2F;1000 as bigint),&#39;yyyy-MM-dd&#39;) from( select id, coupon_id, user_id, order_id, coupon_status, get_time, using_time, used_time from dwd.mall__fact_coupon_use where dt in ( select from_unixtime(cast(get_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd&#39;) from ods.mall__coupon_use where dt&#x3D;&#39;$db_date&#39; ))oldfull outer join( select id, coupon_id, user_id, order_id, coupon_status, get_time, using_time, used_time from ods.mall__coupon_use where dt&#x3D;&#39;$db_date&#39;)newon old.id&#x3D;new.id;&quot;$hive -e &quot;$sql&quot;9.2.13 è®¢å•äº‹å®è¡¨(ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢åŠå˜åŒ–)å»ºè¡¨123456789101112131415161718192021222324252627drop table if exists dwd.mall__fact_order_info CREATE EXTERNAL TABLE &#96;dwd.mall__fact_order_info&#96;(&#96;id&#96; string COMMENT &#39;è®¢å•ç¼–å·&#39;,&#96;order_status&#96; string COMMENT &#39;è®¢å•çŠ¶æ€&#39;,&#96;user_id&#96; string COMMENT &#39;ç”¨æˆ· id&#39;,&#96;out_trade_no&#96; string COMMENT &#39;æ”¯ä»˜æµæ°´å·&#39;,&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´(æœªæ”¯ä»˜çŠ¶æ€)&#39;,&#96;payment_time&#96; string COMMENT &#39;æ”¯ä»˜æ—¶é—´(å·²æ”¯ä»˜çŠ¶æ€)&#39;,&#96;cancel_time&#96; string COMMENT &#39;å–æ¶ˆæ—¶é—´(å·²å–æ¶ˆçŠ¶æ€)&#39;,&#96;finish_time&#96; string COMMENT &#39;å®Œæˆæ—¶é—´(å·²å®ŒæˆçŠ¶æ€)&#39;,&#96;refund_time&#96; string COMMENT &#39;é€€æ¬¾æ—¶é—´(é€€æ¬¾ä¸­çŠ¶æ€)&#39;,&#96;refund_finish_time&#96; string COMMENT &#39;é€€æ¬¾å®Œæˆæ—¶é—´(é€€æ¬¾å®ŒæˆçŠ¶æ€)&#39;,&#96;province_id&#96; string COMMENT &#39;çœä»½ ID&#39;,&#96;activity_id&#96; string COMMENT &#39;æ´»åŠ¨ ID&#39;,&#96;original_total_amount&#96; string COMMENT &#39;åŸä»·é‡‘é¢&#39;,&#96;benefit_reduce_amount&#96; string COMMENT &#39;ä¼˜æƒ é‡‘é¢&#39;,&#96;feight_fee&#96; string COMMENT &#39;è¿è´¹&#39;,&#96;final_total_amount&#96; decimal(10,2) COMMENT &#39;è®¢å•é‡‘é¢&#39; ) COMMENT &#39;è®¢å•äº‹å®è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;fact_order_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)æ•°æ®å¯¼å…¥123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwdtable_name&#x3D;fact_order_infohive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select if(new.id is null,old.id,new.id), if(new.order_status is null,old.order_status,new.order_status), if(new.user_id is null,old.user_id,new.user_id), if(new.out_trade_no is null,old.out_trade_no,new.out_trade_no), if(new.tms[&#39;1001&#39;] is null,from_unixtime(cast(old.create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;),new.tms[&#39;1001&#39;]),--1001 å¯¹åº”æœªæ”¯ä»˜çŠ¶æ€ if(new.tms[&#39;1002&#39;] is null,from_unixtime(cast(old.payment_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;),new.tms[&#39;1002&#39;]), if(new.tms[&#39;1003&#39;] is null,from_unixtime(cast(old.cancel_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;),new.tms[&#39;1003&#39;]), if(new.tms[&#39;1004&#39;] is null,from_unixtime(cast(old.finish_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;),new.tms[&#39;1004&#39;]), if(new.tms[&#39;1005&#39;] is null,from_unixtime(cast(old.refund_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;),new.tms[&#39;1005&#39;]), if(new.tms[&#39;1006&#39;] is null,from_unixtime(cast(old.refund_finish_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;),new.tms[&#39;1006&#39;]), if(new.province_id is null,old.province_id,new.province_id), if(new.activity_id is null,old.activity_id,new.activity_id), if(new.original_total_amount is null,old.original_total_amount,new.original_total_amount), if(new.benefit_reduce_amount is null,old.benefit_reduce_amount,new.benefit_reduce_amount), if(new.feight_fee is null,old.feight_fee,new.feight_fee), if(new.final_total_amount is null,old.final_total_amount,new.final_total_amount)from( select id, order_status, user_id, out_trade_no, create_time, payment_time, cancel_time, finish_time, refund_time, refund_finish_time, province_id, activity_id, original_total_amount, benefit_reduce_amount, feight_fee, final_total_amount from dwd.mall__fact_order_info where dt in ( select from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd&#39;) from ods.mall__order_info where dt&#x3D;&#39;$db_date&#39; ))oldfull outer join( select info.id, info.order_status, info.user_id, info.out_trade_no, info.province_id, act.activity_id, log.tms, info.original_total_amount, info.benefit_reduce_amount, info.feight_fee, info.final_total_amount from ( select order_id, str_to_map(concat_ws(&#39;,&#39;,collect_set(concat(order_status,&#39;&#x3D;&#39;,from_unixtime(cast(operate_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd&#39;)))),&#39;,&#39;,&#39;&#x3D;&#39;) tms from ods.mall__order_status_log where dt&#x3D;&#39;$db_date&#39; group by order_id )log join ( select * from ods.mall__order_info where dt&#x3D;&#39;$db_date&#39; )info on log.order_id&#x3D;info.id left join ( select * from ods.mall__activity_order where dt&#x3D;&#39;$db_date&#39; )act on log.order_id&#x3D;act.order_id)newon old.id&#x3D;new.id;&quot;$hive -e &quot;$sql&quot;10 DWSå±‚æ„å»ºä¸åœ¨è¿›è¡Œå‹ç¼©å¤„ç†ï¼Œå› ä¸ºå‹ç¼©å¯¹äºç¡¬ç›˜æ˜¯å¥½çš„ï¼Œä½†æ˜¯å¯¹äºCPUè®¡ç®—æ˜¯å·®çš„ï¼Œå¯¹äºDWSå±‚çš„è¡¨ï¼Œä¼šè¢«ç»å¸¸ä½¿ç”¨ï¼Œé‚£ä¹ˆè®²ç©¶çš„æ˜¯è®¡ç®—æ•ˆç‡ï¼Œæ­¤å±‚ä¸»è¦å¤„ç†æ¯æ—¥ä¸»é¢˜è¡Œä¸º10.1 æ¯æ—¥è®¾å¤‡è¡Œä¸º(ç”¨æˆ·è¡Œä¸º)å»ºè¡¨123456789101112131415161718192021222324252627drop table if exists dws.mall__uv_detail_daycountCREATE EXTERNAL TABLE &#96;dws.mall__uv_detail_daycount&#96;(&#96;mid_id&#96; string COMMENT &#39;è®¾å¤‡å”¯ä¸€æ ‡è¯†&#39;,&#96;user_id&#96; string COMMENT &#39;ç”¨æˆ·æ ‡è¯†&#39;,&#96;version_code&#96; string COMMENT &#39;ç¨‹åºç‰ˆæœ¬å·&#39;,&#96;version_name&#96; string COMMENT &#39;ç¨‹åºç‰ˆæœ¬å&#39;,&#96;lang&#96; string COMMENT &#39;ç³»ç»Ÿè¯­è¨€&#39;,&#96;source&#96; string COMMENT &#39;æ¸ é“å·&#39;,&#96;os&#96; string COMMENT &#39;å®‰å“ç³»ç»Ÿç‰ˆæœ¬&#39;,&#96;area&#96; string COMMENT &#39;åŒºåŸŸ&#39;,&#96;model&#96; string COMMENT &#39;æ‰‹æœºå‹å·&#39;,&#96;brand&#96; string COMMENT &#39;æ‰‹æœºå“ç‰Œ&#39;,&#96;sdk_version&#96; string COMMENT &#39;sdkVersion&#39;,&#96;gmail&#96; string COMMENT &#39;gmail&#39;,&#96;height_width&#96; string COMMENT &#39;å±å¹•å®½é«˜&#39;,&#96;app_time&#96; string COMMENT &#39;å®¢æˆ·ç«¯æ—¥å¿—äº§ç”Ÿæ—¶çš„æ—¶é—´&#39;,&#96;network&#96; string COMMENT &#39;ç½‘ç»œæ¨¡å¼&#39;,&#96;lng&#96; string COMMENT &#39;ç»åº¦&#39;,&#96;lat&#96; string COMMENT &#39;çº¬åº¦&#39;,&#96;login_count&#96; bigint COMMENT &#39;æ´»è·ƒæ¬¡æ•°&#39; ) COMMENT &#39;æ¯æ—¥è®¾å¤‡è¡Œä¸ºè¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dws&#x2F;mall&#x2F;uv_detail_daycount&#x2F;&#39;å¯¼å…¥æ•°æ®12345678910111213141516171819202122232425262728293031323334353637383940#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwstable_name&#x3D;uv_detail_daycounthive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_namePARTITION (dt&#x3D;&#39;$db_date&#39;)select mid_id, concat_ws(&#39;|&#39;, collect_set(user_id)) user_id, concat_ws(&#39;|&#39;, collect_set(version_code)) version_code, concat_ws(&#39;|&#39;, collect_set(version_name)) version_name, concat_ws(&#39;|&#39;, collect_set(lang))lang, concat_ws(&#39;|&#39;, collect_set(source)) source, concat_ws(&#39;|&#39;, collect_set(os)) os, concat_ws(&#39;|&#39;, collect_set(area)) area, concat_ws(&#39;|&#39;, collect_set(model)) model, concat_ws(&#39;|&#39;, collect_set(brand)) brand, concat_ws(&#39;|&#39;, collect_set(sdk_version)) sdk_version, concat_ws(&#39;|&#39;, collect_set(gmail)) gmail, concat_ws(&#39;|&#39;, collect_set(height_width)) height_width, concat_ws(&#39;|&#39;, collect_set(app_time)) app_time, concat_ws(&#39;|&#39;, collect_set(network)) network, concat_ws(&#39;|&#39;, collect_set(lng)) lng, concat_ws(&#39;|&#39;, collect_set(lat)) lat, count(*) login_countfrom dwd.mall__start_logwhere dt&#x3D;&#39;$db_date&#39;group by mid_id;&quot;$hive -e &quot;$sql&quot;10.2 æ¯æ—¥ä¼šå‘˜è¡Œä¸º(ä¸šåŠ¡)å»ºè¡¨1234567891011121314151617drop table if exists dws.mall__user_action_daycountCREATE EXTERNAL TABLE &#96;dws.mall__user_action_daycount&#96;(user_id string comment &#39;ç”¨æˆ· id&#39;,login_count bigint comment &#39;ç™»å½•æ¬¡æ•°&#39;,cart_count bigint comment &#39;åŠ å…¥è´­ç‰©è½¦æ¬¡æ•°&#39;,cart_amount double comment &#39;åŠ å…¥è´­ç‰©è½¦é‡‘é¢&#39;,order_count bigint comment &#39;ä¸‹å•æ¬¡æ•°&#39;,order_amount decimal(16,2) comment &#39;ä¸‹å•é‡‘é¢&#39;,payment_count bigint comment &#39;æ”¯ä»˜æ¬¡æ•°&#39;,payment_amount decimal(16,2) comment &#39;æ”¯ä»˜é‡‘é¢&#39; ) COMMENT &#39;æ¯æ—¥ä¼šå‘˜è¡Œä¸ºè¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dws&#x2F;mall&#x2F;user_action_daycount&#x2F;&#39;å¯¼å…¥æ•°æ®123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwstable_name&#x3D;user_action_daycounthive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; withtmp_login as( select user_id, count(*) login_count from dwd.mall__start_log where dt&#x3D;&#39;$db_date&#39; and user_id is not null group by user_id),tmp_cart as( select user_id, count(*) cart_count, sum(cart_price*sku_num) cart_amount from dwd.mall__fact_cart_info where dt&#x3D;&#39;$db_date&#39; and user_id is not null and date_format(create_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39; group by user_id),tmp_order as( select user_id, count(*) order_count, sum(final_total_amount) order_amount from dwd.mall__fact_order_info where dt&#x3D;&#39;$db_date&#39; group by user_id) ,tmp_payment as( select user_id, count(*) payment_count, sum(payment_amount) payment_amount from dwd.mall__fact_payment_info where dt&#x3D;&#39;$db_date&#39; group by user_id)insert overwrite table $hive_table_name partition(dt&#x3D;&#39;$db_date&#39;)select user_actions.user_id, sum(user_actions.login_count), sum(user_actions.cart_count), sum(user_actions.cart_amount), sum(user_actions.order_count), sum(user_actions.order_amount), sum(user_actions.payment_count), sum(user_actions.payment_amount)from( select user_id, login_count, 0 cart_count, 0 cart_amount, 0 order_count, 0 order_amount, 0 payment_count, 0 payment_amount from tmp_loginunion all select user_id, 0 login_count, cart_count, cart_amount, 0 order_count, 0 order_amount, 0 payment_count, 0 payment_amount from tmp_cartunion all select user_id, 0 login_count, 0 cart_count, 0 cart_amount, order_count, order_amount, 0 payment_count, 0 payment_amount from tmp_orderunion all select user_id, 0 login_count, 0 cart_count, 0 cart_amount, 0 order_count, 0 order_amount, payment_count, payment_amount from tmp_payment) user_actionsgroup by user_id;&quot;$hive -e &quot;$sql&quot;10.3 æ¯æ—¥å•†å“è¡Œä¸º(ä¸šåŠ¡)å»ºè¡¨1234567891011121314151617181920212223242526drop table if exists dws.mall__sku_action_daycountCREATE EXTERNAL TABLE &#96;dws.mall__sku_action_daycount&#96;(sku_id string comment &#39;sku_id&#39;,order_count bigint comment &#39;è¢«ä¸‹å•æ¬¡æ•°&#39;,order_num bigint comment &#39;è¢«ä¸‹å•ä»¶æ•°&#39;,order_amount decimal(16,2) comment &#39;è¢«ä¸‹å•é‡‘é¢&#39;,payment_count bigint comment &#39;è¢«æ”¯ä»˜æ¬¡æ•°&#39;,payment_num bigint comment &#39;è¢«æ”¯ä»˜ä»¶æ•°&#39;,payment_amount decimal(16,2) comment &#39;è¢«æ”¯ä»˜é‡‘é¢&#39;,refund_count bigint comment &#39;è¢«é€€æ¬¾æ¬¡æ•°&#39;,refund_num bigint comment &#39;è¢«é€€æ¬¾ä»¶æ•°&#39;,refund_amount decimal(16,2) comment &#39;è¢«é€€æ¬¾é‡‘é¢&#39;,cart_count bigint comment &#39;è¢«åŠ å…¥è´­ç‰©è½¦æ¬¡æ•°&#39;,cart_num bigint comment &#39;è¢«åŠ å…¥è´­ç‰©è½¦ä»¶æ•°&#39;,favor_count bigint comment &#39;è¢«æ”¶è—æ¬¡æ•°&#39;,appraise_good_count bigint comment &#39;å¥½è¯„æ•°&#39;,appraise_mid_count bigint comment &#39;ä¸­è¯„æ•°&#39;,appraise_bad_count bigint comment &#39;å·®è¯„æ•°&#39;,appraise_default_count bigint comment &#39;é»˜è®¤è¯„ä»·æ•°&#39; ) COMMENT &#39;æ¯æ—¥å•†å“è¡Œä¸ºè¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dws&#x2F;mall&#x2F;sku_action_daycount&#x2F;&#39;å¯¼å…¥æ•°æ®123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwstable_name&#x3D;sku_action_daycounthive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; withtmp_order as( select cast(sku_id as string) sku_id, count(*) order_count, sum(sku_num) order_num, sum(total_amount) order_amount from dwd.mall__fact_order_detail where dt&#x3D;&#39;$db_date&#39; group by sku_id),tmp_payment as( select cast(sku_id as string) sku_id, count(*) payment_count, sum(sku_num) payment_num, sum(total_amount) payment_amount from dwd.mall__fact_order_detail where dt&#x3D;&#39;$db_date&#39; and order_id in ( select id from dwd.mall__fact_order_info where (dt&#x3D;&#39;$db_date&#39; or dt&#x3D;date_add(&#39;$db_date&#39;,-1)) and date_format(payment_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39; ) group by sku_id),tmp_refund as( select cast(sku_id as string) sku_id, count(*) refund_count, sum(refund_num) refund_num, sum(refund_amount) refund_amount from dwd.mall__fact_order_refund_info where dt&#x3D;&#39;$db_date&#39; group by sku_id),tmp_cart as( select cast(sku_id as string) sku_id, count(*) cart_count, sum(sku_num) cart_num from dwd.mall__fact_cart_info where dt&#x3D;&#39;$db_date&#39; and date_format(create_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39; group by sku_id),tmp_favor as( select cast(sku_id as string) sku_id, count(*) favor_count from dwd.mall__fact_favor_info where dt&#x3D;&#39;$db_date&#39; and date_format(create_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39; group by sku_id),tmp_appraise as( select cast(sku_id as string) sku_id, sum(if(appraise&#x3D;&#39;1201&#39;,1,0)) appraise_good_count, sum(if(appraise&#x3D;&#39;1202&#39;,1,0)) appraise_mid_count, sum(if(appraise&#x3D;&#39;1203&#39;,1,0)) appraise_bad_count, sum(if(appraise&#x3D;&#39;1204&#39;,1,0)) appraise_default_count from dwd.mall__fact_comment_info where dt&#x3D;&#39;$db_date&#39; group by sku_id)insert overwrite table $hive_table_name partition(dt&#x3D;&#39;$db_date&#39;)select sku_id, sum(order_count), sum(order_num), sum(order_amount), sum(payment_count), sum(payment_num), sum(payment_amount), sum(refund_count), sum(refund_num), sum(refund_amount), sum(cart_count), sum(cart_num), sum(favor_count), sum(appraise_good_count), sum(appraise_mid_count), sum(appraise_bad_count), sum(appraise_default_count)from( select sku_id, order_count, order_num, order_amount, 0 payment_count, 0 payment_num, 0 payment_amount, 0 refund_count, 0 refund_num, 0 refund_amount, 0 cart_count, 0 cart_num, 0 favor_count, 0 appraise_good_count, 0 appraise_mid_count, 0 appraise_bad_count, 0 appraise_default_count from tmp_orderunion all select sku_id, 0 order_count, 0 order_num, 0 order_amount, payment_count, payment_num, payment_amount, 0 refund_count, 0 refund_num, 0 refund_amount, 0 cart_count, 0 cart_num, 0 favor_count, 0 appraise_good_count, 0 appraise_mid_count, 0 appraise_bad_count, 0 appraise_default_count from tmp_paymentunion all select sku_id, 0 order_count, 0 order_num, 0 order_amount, 0 payment_count, 0 payment_num, 0 payment_amount, refund_count, refund_num, refund_amount, 0 cart_count, 0 cart_num, 0 favor_count, 0 appraise_good_count, 0 appraise_mid_count, 0 appraise_bad_count, 0 appraise_default_count from tmp_refundunion all select sku_id, 0 order_count, 0 order_num, 0 order_amount, 0 payment_count, 0 payment_num, 0 payment_amount, 0 refund_count, 0 refund_num, 0 refund_amount, cart_count, cart_num, 0 favor_count, 0 appraise_good_count, 0 appraise_mid_count, 0 appraise_bad_count, 0 appraise_default_count from tmp_cartunion all select sku_id, 0 order_count, 0 order_num, 0 order_amount, 0 payment_count, 0 payment_num, 0 payment_amount, 0 refund_count, 0 refund_num, 0 refund_amount, 0 cart_count, 0 cart_num, favor_count, 0 appraise_good_count, 0 appraise_mid_count, 0 appraise_bad_count, 0 appraise_default_count from tmp_favorunion all select sku_id, 0 order_count, 0 order_num, 0 order_amount, 0 payment_count, 0 payment_num, 0 payment_amount, 0 refund_count, 0 refund_num, 0 refund_amount, 0 cart_count, 0 cart_num, 0 favor_count, appraise_good_count, appraise_mid_count, appraise_bad_count, appraise_default_count from tmp_appraise)tmpgroup by sku_id;&quot;$hive -e &quot;$sql&quot;10.4 æ¯æ—¥ä¼˜æƒ åˆ¸ç»Ÿè®¡(ä¸šåŠ¡)å»ºè¡¨1234567891011121314151617181920212223242526drop table if exists dws.mall__coupon_use_daycountCREATE EXTERNAL TABLE &#96;dws.mall__coupon_use_daycount&#96;(&#96;coupon_id&#96; string COMMENT &#39;ä¼˜æƒ åˆ¸ ID&#39;,&#96;coupon_name&#96; string COMMENT &#39;è´­ç‰©åˆ¸åç§°&#39;,&#96;coupon_type&#96; string COMMENT &#39;è´­ç‰©åˆ¸ç±»å‹ 1 ç°é‡‘åˆ¸ 2 æŠ˜æ‰£åˆ¸ 3 æ»¡å‡åˆ¸ 4 æ»¡ä»¶æ‰“æŠ˜åˆ¸&#39;,&#96;condition_amount&#96; string COMMENT &#39;æ»¡é¢æ•°&#39;,&#96;condition_num&#96; string COMMENT &#39;æ»¡ä»¶æ•°&#39;,&#96;activity_id&#96; string COMMENT &#39;æ´»åŠ¨ç¼–å·&#39;,&#96;benefit_amount&#96; string COMMENT &#39;å‡é‡‘é¢&#39;,&#96;benefit_discount&#96; string COMMENT &#39;æŠ˜æ‰£&#39;,&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,&#96;range_type&#96; string COMMENT &#39;èŒƒå›´ç±»å‹ 1ã€å•†å“ 2ã€å“ç±» 3ã€å“ç‰Œ&#39;,&#96;spu_id&#96; string COMMENT &#39;å•†å“ id&#39;,&#96;tm_id&#96; string COMMENT &#39;å“ç‰Œ id&#39;,&#96;category3_id&#96; string COMMENT &#39;å“ç±» id&#39;,&#96;limit_num&#96; string COMMENT &#39;æœ€å¤šé¢†ç”¨æ¬¡æ•°&#39;,&#96;get_count&#96; bigint COMMENT &#39;é¢†ç”¨æ¬¡æ•°&#39;,&#96;using_count&#96; bigint COMMENT &#39;ä½¿ç”¨(ä¸‹å•)æ¬¡æ•°&#39;,&#96;used_count&#96; bigint COMMENT &#39;ä½¿ç”¨(æ”¯ä»˜)æ¬¡æ•°&#39; ) COMMENT &#39;æ¯æ—¥ä¼˜æƒ åˆ¸ç»Ÿè®¡è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dws&#x2F;mall&#x2F;coupon_use_daycount&#x2F;&#39;å¯¼å…¥æ•°æ®1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwstable_name&#x3D;coupon_use_daycounthive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_name partition(dt&#x3D;&#39;$db_date&#39;)select cu.coupon_id, ci.coupon_name, ci.coupon_type, ci.condition_amount, ci.condition_num, ci.activity_id, ci.benefit_amount, ci.benefit_discount, ci.create_time, ci.range_type, ci.spu_id, ci.tm_id, ci.category3_id, ci.limit_num, cu.get_count, cu.using_count, cu.used_countfrom( select coupon_id, sum(if(date_format(get_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39;,1,0)) get_count, sum(if(date_format(using_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39;,1,0)) using_count, sum(if(date_format(used_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39;,1,0)) used_count from dwd.mall__fact_coupon_use where dt&#x3D;&#39;$db_date&#39; group by coupon_id)culeft join( select * from dwd.mall__dim_coupon_info where dt&#x3D;&#39;$db_date&#39;)ci on cu.coupon_id&#x3D;ci.id;&quot;$hive -e &quot;$sql&quot;10.5 æ¯æ—¥æ´»åŠ¨ç»Ÿè®¡(ä¸šåŠ¡)å»ºè¡¨1234567891011121314151617drop table if exists dws.mall__activity_info_daycountCREATE EXTERNAL TABLE &#96;dws.mall__activity_info_daycount&#96;(&#96;id&#96; string COMMENT &#39;ç¼–å·&#39;,&#96;activity_name&#96; string COMMENT &#39;æ´»åŠ¨åç§°&#39;,&#96;activity_type&#96; string COMMENT &#39;æ´»åŠ¨ç±»å‹&#39;,&#96;start_time&#96; string COMMENT &#39;å¼€å§‹æ—¶é—´&#39;,&#96;end_time&#96; string COMMENT &#39;ç»“æŸæ—¶é—´&#39;,&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,&#96;order_count&#96; bigint COMMENT &#39;ä¸‹å•æ¬¡æ•°&#39;,&#96;payment_count&#96; bigint COMMENT &#39;æ”¯ä»˜æ¬¡æ•°&#39; ) COMMENT &#39;æ¯æ—¥æ´»åŠ¨ç»Ÿè®¡è¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dws&#x2F;mall&#x2F;activity_info_daycount&#x2F;&#39;å¯¼å…¥æ•°æ®1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwstable_name&#x3D;activity_info_daycounthive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_name partition(dt&#x3D;&#39;$db_date&#39;)select oi.activity_id, ai.activity_name, ai.activity_type, ai.start_time, ai.end_time, ai.create_time, oi.order_count, oi.payment_countfrom( select activity_id, sum(if(date_format(create_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39;,1,0)) order_count, sum(if(date_format(payment_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39;,1,0)) payment_count from dwd.mall__fact_order_info where (dt&#x3D;&#39;$db_date&#39; or dt&#x3D;date_add(&#39;$db_date&#39;,-1)) and activity_id is not null group by activity_id)oijoin( select * from dwd.mall__dim_activity_info where dt&#x3D;&#39;$db_date&#39;)aion oi.activity_id&#x3D;ai.id;&quot;$hive -e &quot;$sql&quot;10.6 æ¯æ—¥è´­ä¹°è¡Œä¸º(ä¸šåŠ¡)å»ºè¡¨123456789101112131415161718192021222324252627drop table if exists dws.mall__sale_detail_daycountCREATE EXTERNAL TABLE &#96;dws.mall__sale_detail_daycount&#96;(user_id string comment &#39;ç”¨æˆ· id&#39;,sku_id string comment &#39;å•†å“ id&#39;,user_gender string comment &#39;ç”¨æˆ·æ€§åˆ«&#39;,user_age string comment &#39;ç”¨æˆ·å¹´é¾„&#39;,user_level string comment &#39;ç”¨æˆ·ç­‰çº§&#39;,order_price decimal(10,2) comment &#39;å•†å“ä»·æ ¼&#39;,sku_name string comment &#39;å•†å“åç§°&#39;,sku_tm_id string comment &#39;å“ç‰Œ id&#39;,sku_category3_id string comment &#39;å•†å“ä¸‰çº§å“ç±» id&#39;,sku_category2_id string comment &#39;å•†å“äºŒçº§å“ç±» id&#39;,sku_category1_id string comment &#39;å•†å“ä¸€çº§å“ç±» id&#39;,sku_category3_name string comment &#39;å•†å“ä¸‰çº§å“ç±»åç§°&#39;,sku_category2_name string comment &#39;å•†å“äºŒçº§å“ç±»åç§°&#39;,sku_category1_name string comment &#39;å•†å“ä¸€çº§å“ç±»åç§°&#39;,spu_id string comment &#39;å•†å“ spu&#39;,sku_num int comment &#39;è´­ä¹°ä¸ªæ•°&#39;,order_count bigint comment &#39;å½“æ—¥ä¸‹å•å•æ•°&#39;,order_amount decimal(16,2) comment &#39;å½“æ—¥ä¸‹å•é‡‘é¢&#39; ) COMMENT &#39;æ¯æ—¥è´­ä¹°è¡Œä¸ºè¡¨&#39;PARTITIONED BY ( &#96;dt&#96; String COMMENT &#39;partition&#39;)row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dws&#x2F;mall&#x2F;sale_detail_daycount&#x2F;&#39;å¯¼å…¥æ•°æ®1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwstable_name&#x3D;sale_detail_daycounthive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_name partition(dt&#x3D;&#39;$db_date&#39;)select op.user_id, op.sku_id, ui.gender, months_between(&#39;$db_date&#39;, ui.birthday)&#x2F;12 age, ui.user_level, si.price, si.sku_name, si.tm_id, si.category3_id, si.category2_id, si.category1_id, si.category3_name, si.category2_name, si.category1_name, si.spu_id, op.sku_num, op.order_count, op.order_amountfrom( select user_id, sku_id, sum(sku_num) sku_num, count(*) order_count, sum(total_amount) order_amount from dwd.mall__fact_order_detail where dt&#x3D;&#39;$db_date&#39; group by user_id, sku_id)opjoin( select * from dwd.mall__dim_user_info_his where end_date&#x3D;&#39;9999-99-99&#39;)ui on op.user_id &#x3D; ui.idjoin( select * from dwd.mall__dim_sku_info where dt&#x3D;&#39;$db_date&#39;)si on op.sku_id &#x3D; si.id;&quot;$hive -e &quot;$sql&quot;11 DWTå±‚æ„å»ºæ­¤å±‚ä¸»è¦é’ˆå¯¹dwså±‚æ¯æ—¥æ•°æ®è¿›è¡Œæ±‡æ€»ï¼Œä¸å»ºç«‹åˆ†åŒºï¼Œä¸å‹ç¼©ï¼Œæ¯æ—¥è¿›è¡Œæ•°æ®è¦†ç›–11.1 è®¾å¤‡ä¸»é¢˜å®½è¡¨å»ºè¡¨123456789101112131415161718192021222324252627drop table if exists dwt.mall__uv_topicCREATE EXTERNAL TABLE &#96;dwt.mall__uv_topic&#96;(&#96;mid_id&#96; string COMMENT &#39;è®¾å¤‡å”¯ä¸€æ ‡è¯†&#39;,&#96;user_id&#96; string COMMENT &#39;ç”¨æˆ·æ ‡è¯†&#39;,&#96;version_code&#96; string COMMENT &#39;ç¨‹åºç‰ˆæœ¬å·&#39;,&#96;version_name&#96; string COMMENT &#39;ç¨‹åºç‰ˆæœ¬å&#39;,&#96;lang&#96; string COMMENT &#39;ç³»ç»Ÿè¯­è¨€&#39;,&#96;source&#96; string COMMENT &#39;æ¸ é“å·&#39;,&#96;os&#96; string COMMENT &#39;å®‰å“ç³»ç»Ÿç‰ˆæœ¬&#39;,&#96;area&#96; string COMMENT &#39;åŒºåŸŸ&#39;,&#96;model&#96; string COMMENT &#39;æ‰‹æœºå‹å·&#39;,&#96;brand&#96; string COMMENT &#39;æ‰‹æœºå“ç‰Œ&#39;,&#96;sdk_version&#96; string COMMENT &#39;sdkVersion&#39;,&#96;gmail&#96; string COMMENT &#39;gmail&#39;,&#96;height_width&#96; string COMMENT &#39;å±å¹•å®½é«˜&#39;,&#96;app_time&#96; string COMMENT &#39;å®¢æˆ·ç«¯æ—¥å¿—äº§ç”Ÿæ—¶çš„æ—¶é—´&#39;,&#96;network&#96; string COMMENT &#39;ç½‘ç»œæ¨¡å¼&#39;,&#96;lng&#96; string COMMENT &#39;ç»åº¦&#39;,&#96;lat&#96; string COMMENT &#39;çº¬åº¦&#39;,&#96;login_date_first&#96; string comment &#39;é¦–æ¬¡æ´»è·ƒæ—¶é—´&#39;,&#96;login_date_last&#96; string comment &#39;æœ«æ¬¡æ´»è·ƒæ—¶é—´&#39;,&#96;login_day_count&#96; bigint comment &#39;å½“æ—¥æ´»è·ƒæ¬¡æ•°&#39;,&#96;login_count&#96; bigint comment &#39;ç´¯ç§¯æ´»è·ƒå¤©æ•°&#39; ) COMMENT &#39;è®¾å¤‡ä¸»é¢˜å®½è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwt&#x2F;mall&#x2F;uv_topic&#x2F;&#39;å¯¼å…¥æ•°æ®1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwttable_name&#x3D;uv_topichive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_nameselect nvl(new.mid_id,old.mid_id), nvl(new.user_id,old.user_id), nvl(new.version_code,old.version_code), nvl(new.version_name,old.version_name), nvl(new.lang,old.lang), nvl(new.source,old.source), nvl(new.os,old.os), nvl(new.area,old.area), nvl(new.model,old.model), nvl(new.brand,old.brand), nvl(new.sdk_version,old.sdk_version), nvl(new.gmail,old.gmail), nvl(new.height_width,old.height_width), nvl(new.app_time,old.app_time), nvl(new.network,old.network), nvl(new.lng,old.lng), nvl(new.lat,old.lat), if(old.mid_id is null,&#39;2020-03-10&#39;,old.login_date_first), if(new.mid_id is not null,&#39;2020-03-10&#39;,old.login_date_last), if(new.mid_id is not null, new.login_count,0), nvl(old.login_count,0)+if(new.login_count&gt;0,1,0)from( select * from dwt.mall__uv_topic)oldfull outer join( select * from dws.mall__uv_detail_daycount where dt&#x3D;&#39;$db_date&#39;)newon old.mid_id&#x3D;new.mid_id;&quot;$hive -e &quot;$sql&quot;11.2 ä¼šå‘˜ä¸»é¢˜å®½è¡¨å»ºè¡¨1234567891011121314151617181920212223drop table if exists dwt.mall__user_topicCREATE EXTERNAL TABLE &#96;dwt.mall__user_topic&#96;(user_id string comment &#39;ç”¨æˆ· id&#39;,login_date_first string comment &#39;é¦–æ¬¡ç™»å½•æ—¶é—´&#39;,login_date_last string comment &#39;æœ«æ¬¡ç™»å½•æ—¶é—´&#39;,login_count bigint comment &#39;ç´¯ç§¯ç™»å½•å¤©æ•°&#39;,login_last_30d_count bigint comment &#39;æœ€è¿‘ 30 æ—¥ç™»å½•å¤©æ•°&#39;,order_date_first string comment &#39;é¦–æ¬¡ä¸‹å•æ—¶é—´&#39;,order_date_last string comment &#39;æœ«æ¬¡ä¸‹å•æ—¶é—´&#39;,order_count bigint comment &#39;ç´¯ç§¯ä¸‹å•æ¬¡æ•°&#39;,order_amount decimal(16,2) comment &#39;ç´¯ç§¯ä¸‹å•é‡‘é¢&#39;,order_last_30d_count bigint comment &#39;æœ€è¿‘ 30 æ—¥ä¸‹å•æ¬¡æ•°&#39;,order_last_30d_amount bigint comment &#39;æœ€è¿‘ 30 æ—¥ä¸‹å•é‡‘é¢&#39;,payment_date_first string comment &#39;é¦–æ¬¡æ”¯ä»˜æ—¶é—´&#39;,payment_date_last string comment &#39;æœ«æ¬¡æ”¯ä»˜æ—¶é—´&#39;,payment_count decimal(16,2) comment &#39;ç´¯ç§¯æ”¯ä»˜æ¬¡æ•°&#39;,payment_amount decimal(16,2) comment &#39;ç´¯ç§¯æ”¯ä»˜é‡‘é¢&#39;,payment_last_30d_count decimal(16,2) comment &#39;æœ€è¿‘ 30 æ—¥æ”¯ä»˜æ¬¡æ•°&#39;,payment_last_30d_amount decimal(16,2) comment &#39;æœ€è¿‘ 30 æ—¥æ”¯ä»˜é‡‘é¢&#39; ) COMMENT &#39;ä¼šå‘˜ä¸»é¢˜å®½è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwt&#x2F;mall&#x2F;user_topic&#x2F;&#39;å¯¼å…¥æ•°æ®1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwttable_name&#x3D;user_topichive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_nameselect nvl(new.user_id,old.user_id), if(old.login_date_first is null and new.login_count&gt;0,&#39;$db_date&#39;,old.login_date_first), if(new.login_count&gt;0,&#39;$db_date&#39;,old.login_date_last), nvl(old.login_count,0)+if(new.login_count&gt;0,1,0), nvl(new.login_last_30d_count,0), if(old.order_date_first is null and new.order_count&gt;0,&#39;$db_date&#39;,old.order_date_first), if(new.order_count&gt;0,&#39;$db_date&#39;,old.order_date_last), nvl(old.order_count,0)+nvl(new.order_count,0), nvl(old.order_amount,0)+nvl(new.order_amount,0), nvl(new.order_last_30d_count,0), nvl(new.order_last_30d_amount,0), if(old.payment_date_first is null and new.payment_count&gt;0,&#39;$db_date&#39;,old.payment_date_first), if(new.payment_count&gt;0,&#39;$db_date&#39;,old.payment_date_last), nvl(old.payment_count,0)+nvl(new.payment_count,0), nvl(old.payment_amount,0)+nvl(new.payment_amount,0), nvl(new.payment_last_30d_count,0), nvl(new.payment_last_30d_amount,0)fromdwt.mall__user_topic oldfull outer join( select user_id, sum(if(dt&#x3D;&#39;$db_date&#39;,login_count,0)) login_count, sum(if(dt&#x3D;&#39;$db_date&#39;,order_count,0)) order_count, sum(if(dt&#x3D;&#39;$db_date&#39;,order_amount,0)) order_amount, sum(if(dt&#x3D;&#39;$db_date&#39;,payment_count,0)) payment_count, sum(if(dt&#x3D;&#39;$db_date&#39;,payment_amount,0)) payment_amount, sum(if(login_count&gt;0,1,0)) login_last_30d_count, sum(order_count) order_last_30d_count, sum(order_amount) order_last_30d_amount, sum(payment_count) payment_last_30d_count, sum(payment_amount) payment_last_30d_amount from dws.mall__user_action_daycount where dt&gt;&#x3D;date_add( &#39;$db_date&#39;,-30) group by user_id)newon old.user_id&#x3D;new.user_id;&quot;$hive -e &quot;$sql&quot;11.3 å•†å“ä¸»é¢˜å®½è¡¨å»ºè¡¨12345678910111213141516171819202122232425262728293031323334353637383940drop table if exists dwt.mall__sku_topicCREATE EXTERNAL TABLE &#96;dwt.mall__sku_topic&#96;(sku_id string comment &#39;sku_id&#39;,spu_id string comment &#39;spu_id&#39;,order_last_30d_count bigint comment &#39;æœ€è¿‘ 30 æ—¥è¢«ä¸‹å•æ¬¡æ•°&#39;,order_last_30d_num bigint comment &#39;æœ€è¿‘ 30 æ—¥è¢«ä¸‹å•ä»¶æ•°&#39;,order_last_30d_amount decimal(16,2) comment &#39;æœ€è¿‘ 30 æ—¥è¢«ä¸‹å•é‡‘é¢&#39;,order_count bigint comment &#39;ç´¯ç§¯è¢«ä¸‹å•æ¬¡æ•°&#39;,order_num bigint comment &#39;ç´¯ç§¯è¢«ä¸‹å•ä»¶æ•°&#39;,order_amount decimal(16,2) comment &#39;ç´¯ç§¯è¢«ä¸‹å•é‡‘é¢&#39;,payment_last_30d_count bigint comment &#39;æœ€è¿‘ 30 æ—¥è¢«æ”¯ä»˜æ¬¡æ•°&#39;,payment_last_30d_num bigint comment &#39;æœ€è¿‘ 30 æ—¥è¢«æ”¯ä»˜ä»¶æ•°&#39;,payment_last_30d_amount decimal(16,2) comment &#39;æœ€è¿‘ 30 æ—¥è¢«æ”¯ä»˜é‡‘é¢&#39;,payment_count bigint comment &#39;ç´¯ç§¯è¢«æ”¯ä»˜æ¬¡æ•°&#39;,payment_num bigint comment &#39;ç´¯ç§¯è¢«æ”¯ä»˜ä»¶æ•°&#39;,payment_amount decimal(16,2) comment &#39;ç´¯ç§¯è¢«æ”¯ä»˜é‡‘é¢&#39;,refund_last_30d_count bigint comment &#39;æœ€è¿‘ä¸‰åæ—¥é€€æ¬¾æ¬¡æ•°&#39;,refund_last_30d_num bigint comment &#39;æœ€è¿‘ä¸‰åæ—¥é€€æ¬¾ä»¶æ•°&#39;,refund_last_30d_amount decimal(10,2) comment &#39;æœ€è¿‘ä¸‰åæ—¥é€€æ¬¾é‡‘é¢&#39;,refund_count bigint comment &#39;ç´¯ç§¯é€€æ¬¾æ¬¡æ•°&#39;,refund_num bigint comment &#39;ç´¯ç§¯é€€æ¬¾ä»¶æ•°&#39;,refund_amount decimal(10,2) comment &#39;ç´¯ç§¯é€€æ¬¾é‡‘é¢&#39;,cart_last_30d_count bigint comment &#39;æœ€è¿‘ 30 æ—¥è¢«åŠ å…¥è´­ç‰©è½¦æ¬¡æ•°&#39;,cart_last_30d_num bigint comment &#39;æœ€è¿‘ 30 æ—¥è¢«åŠ å…¥è´­ç‰©è½¦ä»¶æ•°&#39;,cart_count bigint comment &#39;ç´¯ç§¯è¢«åŠ å…¥è´­ç‰©è½¦æ¬¡æ•°&#39;,cart_num bigint comment &#39;ç´¯ç§¯è¢«åŠ å…¥è´­ç‰©è½¦ä»¶æ•°&#39;,favor_last_30d_count bigint comment &#39;æœ€è¿‘ 30 æ—¥è¢«æ”¶è—æ¬¡æ•°&#39;,favor_count bigint comment &#39;ç´¯ç§¯è¢«æ”¶è—æ¬¡æ•°&#39;,appraise_last_30d_good_count bigint comment &#39;æœ€è¿‘ 30 æ—¥å¥½è¯„æ•°&#39;,appraise_last_30d_mid_count bigint comment &#39;æœ€è¿‘ 30 æ—¥ä¸­è¯„æ•°&#39;,appraise_last_30d_bad_count bigint comment &#39;æœ€è¿‘ 30 æ—¥å·®è¯„æ•°&#39;,appraise_last_30d_default_count bigint comment &#39;æœ€è¿‘ 30 æ—¥é»˜è®¤è¯„ä»·æ•°&#39;,appraise_good_count bigint comment &#39;ç´¯ç§¯å¥½è¯„æ•°&#39;,appraise_mid_count bigint comment &#39;ç´¯ç§¯ä¸­è¯„æ•°&#39;,appraise_bad_count bigint comment &#39;ç´¯ç§¯å·®è¯„æ•°&#39;,appraise_default_count bigint comment &#39;ç´¯ç§¯é»˜è®¤è¯„ä»·æ•°&#39; ) COMMENT &#39;å•†å“ä¸»é¢˜å®½è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwt&#x2F;mall&#x2F;sku_topic&#x2F;&#39;å¯¼å…¥æ•°æ®123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwttable_name&#x3D;sku_topichive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_nameselect nvl(new.sku_id,old.sku_id), sku_info.spu_id, nvl(new.order_count30,0), nvl(new.order_num30,0), nvl(new.order_amount30,0), nvl(old.order_count,0) + nvl(new.order_count,0), nvl(old.order_num,0) + nvl(new.order_num,0), nvl(old.order_amount,0) + nvl(new.order_amount,0), nvl(new.payment_count30,0), nvl(new.payment_num30,0), nvl(new.payment_amount30,0), nvl(old.payment_count,0) + nvl(new.payment_count,0), nvl(old.payment_num,0) + nvl(new.payment_count,0), nvl(old.payment_amount,0) + nvl(new.payment_count,0), nvl(new.refund_count30,0), nvl(new.refund_num30,0), nvl(new.refund_amount30,0), nvl(old.refund_count,0) + nvl(new.refund_count,0), nvl(old.refund_num,0) + nvl(new.refund_num,0), nvl(old.refund_amount,0) + nvl(new.refund_amount,0), nvl(new.cart_count30,0), nvl(new.cart_num30,0), nvl(old.cart_count,0) + nvl(new.cart_count,0), nvl(old.cart_num,0) + nvl(new.cart_num,0), nvl(new.favor_count30,0), nvl(old.favor_count,0) + nvl(new.favor_count,0), nvl(new.appraise_good_count30,0), nvl(new.appraise_mid_count30,0), nvl(new.appraise_bad_count30,0), nvl(new.appraise_default_count30,0) , nvl(old.appraise_good_count,0) + nvl(new.appraise_good_count,0), nvl(old.appraise_mid_count,0) + nvl(new.appraise_mid_count,0), nvl(old.appraise_bad_count,0) + nvl(new.appraise_bad_count,0), nvl(old.appraise_default_count,0) + nvl(new.appraise_default_count,0)from( select sku_id, spu_id, order_last_30d_count, order_last_30d_num, order_last_30d_amount, order_count, order_num, order_amount , payment_last_30d_count, payment_last_30d_num, payment_last_30d_amount, payment_count, payment_num, payment_amount, refund_last_30d_count, refund_last_30d_num, refund_last_30d_amount, refund_count, refund_num, refund_amount, cart_last_30d_count, cart_last_30d_num, cart_count, cart_num, favor_last_30d_count, favor_count, appraise_last_30d_good_count, appraise_last_30d_mid_count, appraise_last_30d_bad_count, appraise_last_30d_default_count, appraise_good_count, appraise_mid_count, appraise_bad_count, appraise_default_count from dwt.mall__sku_topic)oldfull outer join( select sku_id, sum(if(dt&#x3D;&#39;$db_date&#39;, order_count,0 )) order_count, sum(if(dt&#x3D;&#39;$db_date&#39;,order_num ,0 )) order_num, sum(if(dt&#x3D;&#39;$db_date&#39;,order_amount,0 )) order_amount , sum(if(dt&#x3D;&#39;$db_date&#39;,payment_count,0 )) payment_count, sum(if(dt&#x3D;&#39;$db_date&#39;,payment_num,0 )) payment_num, sum(if(dt&#x3D;&#39;$db_date&#39;,payment_amount,0 )) payment_amount, sum(if(dt&#x3D;&#39;$db_date&#39;,refund_count,0 )) refund_count, sum(if(dt&#x3D;&#39;$db_date&#39;,refund_num,0 )) refund_num, sum(if(dt&#x3D;&#39;$db_date&#39;,refund_amount,0 )) refund_amount, sum(if(dt&#x3D;&#39;$db_date&#39;,cart_count,0 )) cart_count, sum(if(dt&#x3D;&#39;$db_date&#39;,cart_num,0 )) cart_num, sum(if(dt&#x3D;&#39;$db_date&#39;,favor_count,0 )) favor_count, sum(if(dt&#x3D;&#39;$db_date&#39;,appraise_good_count,0 )) appraise_good_count, sum(if(dt&#x3D;&#39;$db_date&#39;,appraise_mid_count,0 ) ) appraise_mid_count , sum(if(dt&#x3D;&#39;$db_date&#39;,appraise_bad_count,0 )) appraise_bad_count, sum(if(dt&#x3D;&#39;$db_date&#39;,appraise_default_count,0 )) appraise_default_count, sum(order_count) order_count30 , sum(order_num) order_num30, sum(order_amount) order_amount30, sum(payment_count) payment_count30, sum(payment_num) payment_num30, sum(payment_amount) payment_amount30, sum(refund_count) refund_count30, sum(refund_num) refund_num30, sum(refund_amount) refund_amount30, sum(cart_count) cart_count30, sum(cart_num) cart_num30, sum(favor_count) favor_count30, sum(appraise_good_count) appraise_good_count30, sum(appraise_mid_count) appraise_mid_count30, sum(appraise_bad_count) appraise_bad_count30, sum(appraise_default_count) appraise_default_count30 from dws.mall__sku_action_daycount where dt &gt;&#x3D; date_add (&#39;$db_date&#39;, -30) group by sku_id)newon new.sku_id &#x3D; old.sku_idleft join( select * from dwd.mall__dim_sku_info where dt&#x3D;&#39;$db_date&#39;) sku_infoon nvl(new.sku_id,old.sku_id)&#x3D; sku_info.id;&quot;$hive -e &quot;$sql&quot;11.4 ä¼˜æƒ å·ä¸»é¢˜å®½è¡¨å»ºè¡¨12345678910111213drop table if exists dwt.mall__coupon_topicCREATE EXTERNAL TABLE &#96;dwt.mall__coupon_topic&#96;(&#96;coupon_id&#96; string COMMENT &#39;ä¼˜æƒ åˆ¸ ID&#39;,&#96;get_day_count&#96; bigint COMMENT &#39;å½“æ—¥é¢†ç”¨æ¬¡æ•°&#39;,&#96;using_day_count&#96; bigint COMMENT &#39;å½“æ—¥ä½¿ç”¨(ä¸‹å•)æ¬¡æ•°&#39;,&#96;used_day_count&#96; bigint COMMENT &#39;å½“æ—¥ä½¿ç”¨(æ”¯ä»˜)æ¬¡æ•°&#39;,&#96;get_count&#96; bigint COMMENT &#39;ç´¯ç§¯é¢†ç”¨æ¬¡æ•°&#39;,&#96;using_count&#96; bigint COMMENT &#39;ç´¯ç§¯ä½¿ç”¨(ä¸‹å•)æ¬¡æ•°&#39;,&#96;used_count&#96; bigint COMMENT &#39;ç´¯ç§¯ä½¿ç”¨(æ”¯ä»˜)æ¬¡æ•°&#39; ) COMMENT &#39;ä¼˜æƒ åˆ¸ä¸»é¢˜å®½è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwt&#x2F;mall&#x2F;coupon_topic&#x2F;&#39;å¯¼å…¥æ•°æ®123456789101112131415161718192021222324252627282930313233343536373839404142#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwttable_name&#x3D;coupon_topichive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_nameselect nvl(new.coupon_id,old.coupon_id), nvl(new.get_count,0), nvl(new.using_count,0), nvl(new.used_count,0), nvl(old.get_count,0)+nvl(new.get_count,0), nvl(old.using_count,0)+nvl(new.using_count,0), nvl(old.used_count,0)+nvl(new.used_count,0)from( select * from dwt.mall__coupon_topic)oldfull outer join( select coupon_id, get_count, using_count, used_count from dws.mall__coupon_use_daycount where dt&#x3D;&#39;$db_date&#39;)newon old.coupon_id&#x3D;new.coupon_id;&quot;$hive -e &quot;$sql&quot;11.5 æ´»åŠ¨ä¸»é¢˜å®½è¡¨å»ºè¡¨123456789101112drop table if exists dwt.mall__activity_topicCREATE EXTERNAL TABLE &#96;dwt.mall__activity_topic&#96;(&#96;id&#96; string COMMENT &#39;æ´»åŠ¨ id&#39;,&#96;activity_name&#96; string COMMENT &#39;æ´»åŠ¨åç§°&#39;,&#96;order_day_count&#96; bigint COMMENT &#39;å½“æ—¥æ—¥ä¸‹å•æ¬¡æ•°&#39;,&#96;payment_day_count&#96; bigint COMMENT &#39;å½“æ—¥æ”¯ä»˜æ¬¡æ•°&#39;,&#96;order_count&#96; bigint COMMENT &#39;ç´¯ç§¯ä¸‹å•æ¬¡æ•°&#39;,&#96;payment_count&#96; bigint COMMENT &#39;ç´¯ç§¯æ”¯ä»˜æ¬¡æ•°&#39; ) COMMENT &#39;æ´»åŠ¨ä¸»é¢˜å®½è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;dwt&#x2F;mall&#x2F;activity_topic&#x2F;&#39;å¯¼å…¥æ•°æ®1234567891011121314151617181920212223242526272829303132333435363738394041#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;dwttable_name&#x3D;activity_topichive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert overwrite table $hive_table_nameselect nvl(new.id,old.id), nvl(new.activity_name,old.activity_name), nvl(new.order_count,0), nvl(new.payment_count,0), nvl(old.order_count,0)+nvl(new.order_count,0), nvl(old.payment_count,0)+nvl(new.payment_count,0)from( select * from dwt.mall__activity_topic)oldfull outer join( select id, activity_name, order_count, payment_count from dws.mall__activity_info_daycountwhere dt&#x3D;&#39;$db_date&#39;)newon old.id&#x3D;new.id;&quot;$hive -e &quot;$sql&quot;12 ADSå±‚æ„å»ºæ­¤å±‚ä¸ºæœ€ç»ˆæ•°æ®éœ€æ±‚å±‚ï¼Œè€ƒè™‘æ•°æ®å¯¼å‡ºå’Œæ•°æ®æ•°é‡å†³å®šæ˜¯å¦éœ€è¦å‹ç¼©ï¼Œä¸éœ€è¦åˆ†åŒºï¼Œæ¯å¤©åˆ·å†™12.1 è®¾å¤‡ä¸»é¢˜12.1.1 æ´»è·ƒè®¾å¤‡æ•°ï¼ˆæ—¥ã€å‘¨ã€æœˆï¼‰æ—¥æ´»ï¼šå½“æ—¥æ´»è·ƒçš„è®¾å¤‡æ•°å‘¨æ´»ï¼šå½“å‘¨æ´»è·ƒçš„è®¾å¤‡æ•°æœˆæ´»ï¼šå½“æœˆæ´»è·ƒçš„è®¾å¤‡æ•°å»ºè¡¨12345678910111213drop table if exists ads.mall__uv_countCREATE EXTERNAL TABLE &#96;ads.mall__uv_count&#96;(&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,&#96;day_count&#96; bigint COMMENT &#39;å½“æ—¥ç”¨æˆ·æ•°é‡&#39;,&#96;wk_count&#96; bigint COMMENT &#39;å½“å‘¨ç”¨æˆ·æ•°é‡&#39;,&#96;mn_count&#96; bigint COMMENT &#39;å½“æœˆç”¨æˆ·æ•°é‡&#39;,&#96;is_weekend&#96; string COMMENT &#39;Y,N æ˜¯å¦æ˜¯å‘¨æœ«,ç”¨äºå¾—åˆ°æœ¬å‘¨æœ€ç»ˆç»“æœ&#39;,&#96;is_monthend&#96; string COMMENT &#39;Y,N æ˜¯å¦æ˜¯æœˆæœ«,ç”¨äºå¾—åˆ°æœ¬æœˆæœ€ç»ˆç»“æœ&#39; ) COMMENT &#39;æ´»è·ƒè®¾å¤‡æ•°è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;uv_count&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;uv_counthive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect &#39;$db_date&#39; dt, daycount.ct, wkcount.ct, mncount.ct, if(date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-1)&#x3D;&#39;$db_date&#39;,&#39;Y&#39;,&#39;N&#39;) , if(last_day(&#39;$db_date&#39;)&#x3D;&#39;$db_date&#39;,&#39;Y&#39;,&#39;N&#39;)from( select &#39;$db_date&#39; dt, count(*) ct from dwt.mall__uv_topic where login_date_last&#x3D;&#39;$db_date&#39;)daycount join( select &#39;$db_date&#39; dt, count (*) ct from dwt.mall__uv_topic where login_date_last&gt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-7) and login_date_last&lt;&#x3D; date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-1)) wkcount on daycount.dt&#x3D;wkcount.dtjoin( select &#39;$db_date&#39; dt, count (*) ct from dwt.mall__uv_topic where date_format(login_date_last,&#39;yyyy-MM&#39;)&#x3D;date_format(&#39;$db_date&#39;,&#39;yyyy-MM&#39;))mncount on daycount.dt&#x3D;mncount.dt;&quot;$hive -e &quot;$sql&quot;12.1.2 æ¯æ—¥æ–°å¢è®¾å¤‡å»ºè¡¨123456789drop table if exists ads.mall__new_mid_countCREATE EXTERNAL TABLE &#96;ads.mall__new_mid_count&#96;(&#96;create_date&#96; string comment &#39;åˆ›å»ºæ—¶é—´&#39; ,&#96;new_mid_count&#96; bigint comment &#39;æ–°å¢è®¾å¤‡æ•°é‡&#39; ) COMMENT &#39;æ¯æ—¥æ–°å¢è®¾å¤‡è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;new_mid_count&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®1234567891011121314151617181920212223#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;new_mid_counthive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect login_date_first, count(*)from dwt.mall__uv_topicwhere login_date_first&#x3D;&#39;$db_date&#39;group by login_date_first;&quot;$hive -e &quot;$sql&quot;12.1.3 æ²‰é»˜ç”¨æˆ·æ•°æ²‰é»˜ç”¨æˆ·ï¼šåªåœ¨å®‰è£…å½“å¤©å¯åŠ¨è¿‡ï¼Œä¸”å¯åŠ¨æ—¶é—´æ˜¯åœ¨ 7 å¤©å‰å»ºè¡¨123456789drop table if exists ads.mall__silent_countCREATE EXTERNAL TABLE &#96;ads.mall__silent_count&#96;(&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,&#96;silent_count&#96; bigint COMMENT &#39;æ²‰é»˜è®¾å¤‡æ•°&#39; ) COMMENT &#39;æ²‰é»˜ç”¨æˆ·æ•°è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;silent_count&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®1234567891011121314151617181920212223#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;silent_counthive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect &#39;$db_date&#39;, count(*)from dwt.mall__uv_topicwhere login_date_first&#x3D;login_date_lastand login_date_last&lt;&#x3D;date_add(&#39;$db_date&#39;,-7);&quot;$hive -e &quot;$sql&quot;12.1.4 æœ¬å‘¨å›æµç”¨æˆ·æ•°æœ¬å‘¨å›æµç”¨æˆ·ï¼šä¸Šå‘¨æœªæ´»è·ƒï¼Œæœ¬å‘¨æ´»è·ƒçš„è®¾å¤‡ï¼Œä¸”ä¸æ˜¯æœ¬å‘¨æ–°å¢è®¾å¤‡å»ºè¡¨123456789drop table if exists ads.mall__back_countCREATE EXTERNAL TABLE &#96;ads.mall__back_count&#96;(&#96;wk_dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸæ‰€åœ¨å‘¨&#39;,&#96;wastage_count&#96; bigint COMMENT &#39;å›æµè®¾å¤‡æ•°&#39; ) COMMENT &#39;æœ¬å‘¨å›æµç”¨æˆ·æ•°è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;back_count&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®12345678910111213141516171819202122232425262728293031323334353637383940#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;back_counthive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect &#39;$db_date&#39;, count(*)from( select mid_id from dwt.mall__uv_topic where login_date_last&gt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-7) and login_date_last&lt;&#x3D; date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-1) and login_date_first&lt;date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-7))current_wkleft join( select mid_id from dws.mall__uv_detail_daycount where dt&gt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-7*2) and dt&lt;&#x3D; date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-7-1) group by mid_id)last_wkon current_wk.mid_id&#x3D;last_wk.mid_idwhere last_wk.mid_id is null;&quot;$hive -e &quot;$sql&quot;12.1.5 æµå¤±ç”¨æˆ·æ•°æµå¤±ç”¨æˆ·ï¼šæœ€è¿‘ 7 å¤©æœªæ´»è·ƒçš„è®¾å¤‡å»ºè¡¨123456789drop table if exists ads.mall__wastage_countCREATE EXTERNAL TABLE &#96;ads.mall__wastage_count&#96;(&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,&#96;wastage_count&#96; bigint COMMENT &#39;æµå¤±è®¾å¤‡æ•°&#39; ) COMMENT &#39;æµå¤±ç”¨æˆ·æ•°è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;wastage_count&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®12345678910111213141516171819202122232425262728#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;wastage_counthive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect &#39;$db_date&#39;, count(*)from( select mid_id from dwt.mall__uv_topic where login_date_last&lt;&#x3D;date_add(&#39;$db_date&#39;,-7) group by mid_id)t1;&quot;$hive -e &quot;$sql&quot;12.1.6 ç•™å­˜ç‡å»ºè¡¨12345678910111213drop table if exists ads.mall__user_retention_day_rateCREATE EXTERNAL TABLE &#96;ads.mall__user_retention_day_rate&#96;(&#96;stat_date&#96; string comment &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,&#96;create_date&#96; string comment &#39;è®¾å¤‡æ–°å¢æ—¥æœŸ&#39;,&#96;retention_day&#96; int comment &#39;æˆªæ­¢å½“å‰æ—¥æœŸç•™å­˜å¤©æ•°&#39;,&#96;retention_count&#96; bigint comment &#39;ç•™å­˜æ•°é‡&#39;,&#96;new_mid_count&#96; bigint comment &#39;è®¾å¤‡æ–°å¢æ•°é‡&#39;,&#96;retention_ratio&#96; decimal(10,2) comment &#39;ç•™å­˜ç‡&#39; ) COMMENT &#39;ç•™å­˜ç‡è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;user_retention_day_rate&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;user_retention_day_ratehive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect &#39;$db_date&#39;,--ç»Ÿè®¡æ—¥æœŸ date_add(&#39;$db_date&#39;,-1),--æ–°å¢æ—¥æœŸ 1,--ç•™å­˜å¤©æ•° sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-1) and login_date_last&#x3D;&#39;$db_date&#39;,1,0)),--2020-03-09 çš„ 1 æ—¥ç•™å­˜æ•° sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-1),1,0)),--2020-03-09 æ–°å¢ sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-1) and login_date_last&#x3D;&#39;$db_date&#39;,1,0))&#x2F;sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-1),1,0))*100from dwt.mall__uv_topicunion allselect &#39;$db_date&#39;,--ç»Ÿè®¡æ—¥æœŸ date_add(&#39;$db_date&#39;,-2),--æ–°å¢æ—¥æœŸ 2,--ç•™å­˜å¤©æ•° sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-2) and login_date_last&#x3D;&#39;$db_date&#39;,1,0)),--2020-03-08 çš„ 2 æ—¥ç•™å­˜æ•° sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-2),1,0)),--2020-03-08 æ–°å¢ sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-2) and login_date_last&#x3D;&#39;$db_date&#39;,1,0))&#x2F;sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-2),1,0))*100from dwt.mall__uv_topicunion allselect &#39;$db_date&#39;,--ç»Ÿè®¡æ—¥æœŸ date_add(&#39;$db_date&#39;,-3),--æ–°å¢æ—¥æœŸ 3,--ç•™å­˜å¤©æ•° sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-3) and login_date_last&#x3D;&#39;$db_date&#39;,1,0)),--2020-03-07 çš„ 3 æ—¥ç•™å­˜æ•° sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-3),1,0)),--2020-03-07 æ–°å¢ sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-3) and login_date_last&#x3D;&#39;$db_date&#39;,1,0))&#x2F;sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-3),1,0))*100from dwt.mall__uv_topic;&quot;$hive -e &quot;$sql&quot;12.1.7 æœ€è¿‘è¿ç»­ä¸‰å‘¨æ´»è·ƒç”¨æˆ·æ•°å»ºè¡¨12345678910drop table if exists ads.mall__continuity_wk_countCREATE EXTERNAL TABLE &#96;ads.mall__continuity_wk_count&#96;(&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ,ä¸€èˆ¬ç”¨ç»“æŸå‘¨å‘¨æ—¥æ—¥æœŸ,å¦‚æœæ¯å¤©è®¡ç®—ä¸€æ¬¡,å¯ç”¨å½“å¤©æ—¥æœŸ&#39;,&#96;wk_dt&#96; string COMMENT &#39;æŒç»­æ—¶é—´&#39;,&#96;continuity_count&#96; bigint COMMENT &#39;æ´»è·ƒæ¬¡æ•°&#39; ) COMMENT &#39;æœ€è¿‘è¿ç»­ä¸‰å‘¨æ´»è·ƒç”¨æˆ·æ•°è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;continuity_wk_count&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;continuity_wk_counthive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect &#39;$db_date&#39;, concat(date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-7*3),&#39;_&#39;,date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-1)), count(*)from( select mid_id from ( select mid_id from dws.mall__uv_detail_daycount where dt&gt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;monday&#39;),-7) and dt&lt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;monday&#39;),-1) group by mid_id union all select mid_id from dws.mall__uv_detail_daycount where dt&gt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;monday&#39;),-7*2) and dt&lt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;monday&#39;),-7-1) group by mid_id union all select mid_id from dws.mall__uv_detail_daycount where dt&gt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;monday&#39;),-7*3) and dt&lt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;monday&#39;),-7*2-1) group by mid_id )t1 group by mid_id having count(*)&#x3D;3)t2&quot;$hive -e &quot;$sql&quot;12.1.8 æœ€è¿‘ä¸ƒå¤©å†…è¿ç»­ä¸‰å¤©æ´»è·ƒç”¨æˆ·æ•°å»ºè¡¨12345678910drop table if exists ads.mall__continuity_uv_countCREATE EXTERNAL TABLE &#96;ads.mall__continuity_uv_count&#96;(&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,&#96;wk_dt&#96; string COMMENT &#39;æœ€è¿‘ 7 å¤©æ—¥æœŸ&#39;,&#96;continuity_count&#96; bigint ) COMMENT &#39;æœ€è¿‘ä¸ƒå¤©å†…è¿ç»­ä¸‰å¤©æ´»è·ƒç”¨æˆ·æ•°è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;continuity_uv_count&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;continuity_uv_counthive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect &#39;$db_date&#39;, concat(date_add(&#39;db_date&#39;,-6),&#39;_&#39;,&#39;db_date&#39;), count(*)from( select mid_id from ( select mid_id from ( select mid_id, date_sub(dt,rank) date_dif from ( select mid_id, dt, rank() over(partition by mid_id order by dt) rank from dws.mall__uv_detail_daycount where dt&gt;&#x3D;date_add(&#39;db_date&#39;,-6) and dt&lt;&#x3D;&#39;db_date&#39; )t1 )t2 group by mid_id,date_dif having count(*)&gt;&#x3D;3 )t3 group by mid_id)t4;&quot;$hive -e &quot;$sql&quot;12.2 ä¼šå‘˜ä¸»é¢˜12.2.1 ä¼šå‘˜ä¸»é¢˜ä¿¡æ¯å»ºè¡¨12345678910111213141516drop table if exists ads.mall__user_topicCREATE EXTERNAL TABLE &#96;ads.mall__user_topic&#96;(&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,&#96;day_users&#96; string COMMENT &#39;æ´»è·ƒä¼šå‘˜æ•°&#39;,&#96;day_new_users&#96; string COMMENT &#39;æ–°å¢ä¼šå‘˜æ•°&#39;,&#96;day_new_payment_users&#96; string COMMENT &#39;æ–°å¢æ¶ˆè´¹ä¼šå‘˜æ•°&#39;,&#96;payment_users&#96; string COMMENT &#39;æ€»ä»˜è´¹ä¼šå‘˜æ•°&#39;,&#96;users&#96; string COMMENT &#39;æ€»ä¼šå‘˜æ•°&#39;,&#96;day_users2users&#96; decimal(10,2) COMMENT &#39;ä¼šå‘˜æ´»è·ƒç‡&#39;,&#96;payment_users2users&#96; decimal(10,2) COMMENT &#39;ä¼šå‘˜ä»˜è´¹ç‡&#39;,&#96;day_new_users2users&#96; decimal(10,2) COMMENT &#39;ä¼šå‘˜æ–°é²œåº¦&#39; ) COMMENT &#39;ä¼šå‘˜ä¸»é¢˜ä¿¡æ¯è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;user_topic&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®12345678910111213141516171819202122232425262728#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;user_topichive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect &#39;$db_date&#39;, sum(if(login_date_last&#x3D;&#39;$db_date&#39;,1,0)), sum(if(login_date_first&#x3D;&#39;$db_date&#39;,1,0)), sum(if(payment_date_first&#x3D;&#39;$db_date&#39;,1,0)), sum(if(payment_count&gt;0,1,0)), count(*), sum(if(login_date_last&#x3D;&#39;$db_date&#39;,1,0))&#x2F;count(*), sum(if(payment_count&gt;0,1,0))&#x2F;count(*), sum(if(login_date_first&#x3D;&#39;$db_date&#39;,1,0))&#x2F;sum(if(login_date_last&#x3D;&#39;$db_date&#39;,1,0))from dwt.mall__user_topic&quot;$hive -e &quot;$sql&quot;12.2.2 æ¼æ–—åˆ†æç»Ÿè®¡â€œæµè§ˆ-&gt;è´­ç‰©è½¦-&gt;ä¸‹å•-&gt;æ”¯ä»˜â€çš„è½¬åŒ–ç‡æ€è·¯ï¼šç»Ÿè®¡å„ä¸ªè¡Œä¸ºçš„äººæ•°ï¼Œç„¶åè®¡ç®—æ¯”å€¼ã€‚å»ºè¡¨123456789101112131415drop table if exists ads.mall__user_action_convert_dayCREATE EXTERNAL TABLE &#96;ads.mall__user_action_convert_day&#96;(&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,&#96;total_visitor_m_count&#96; bigint COMMENT &#39;æ€»è®¿é—®äººæ•°&#39;,&#96;cart_u_count&#96; bigint COMMENT &#39;åŠ å…¥è´­ç‰©è½¦çš„äººæ•°&#39;,&#96;visitor2cart_convert_ratio&#96; decimal(10,2) COMMENT &#39;è®¿é—®åˆ°åŠ å…¥è´­ç‰©è½¦è½¬åŒ–ç‡&#39;,&#96;order_u_count&#96; bigint COMMENT &#39;ä¸‹å•äººæ•°&#39;,&#96;cart2order_convert_ratio&#96; decimal(10,2) COMMENT &#39;åŠ å…¥è´­ç‰©è½¦åˆ°ä¸‹å•è½¬åŒ–ç‡&#39;,&#96;payment_u_count&#96; bigint COMMENT &#39;æ”¯ä»˜äººæ•°&#39;,&#96;order2payment_convert_ratio&#96; decimal(10,2) COMMENT &#39;ä¸‹å•åˆ°æ”¯ä»˜çš„è½¬åŒ–ç‡&#39; ) COMMENT &#39;æ¼æ–—åˆ†æè¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;user_action_convert_day&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®12345678910111213141516171819202122232425262728293031323334353637#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;user_action_convert_dayhive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect &#39;$db_date&#39;, uv.day_count, ua.cart_count, cast(ua.cart_count&#x2F;uv.day_count as decimal(10,2)) visitor2cart_convert_ratio, ua.order_count, cast(ua.order_count&#x2F;ua.cart_count as decimal(10,2)) visitor2order_convert_ratio, ua.payment_count, cast(ua.payment_count&#x2F;ua.order_count as decimal(10,2)) order2payment_convert_ratiofrom( select dt, sum(if(cart_count&gt;0,1,0)) cart_count, sum(if(order_count&gt;0,1,0)) order_count, sum(if(payment_count&gt;0,1,0)) payment_count from dws.mall__user_action_daycount where dt&#x3D;&#39;$db_date&#39; group by dt)ua join ads.mall__uv_count uv on uv.dt&#x3D;ua.dt;&quot;$hive -e &quot;$sql&quot;12.3 å•†å“ä¸»é¢˜12.3.1 å•†å“ä¸ªæ•°ä¿¡æ¯å»ºè¡¨12345678910drop table if exists ads.mall__product_infoCREATE EXTERNAL TABLE &#96;ads.mall__product_info&#96;(&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,&#96;sku_num&#96; string COMMENT &#39;sku ä¸ªæ•°&#39;,&#96;spu_num&#96; string COMMENT &#39;spu ä¸ªæ•°&#39; ) COMMENT &#39;å•†å“ä¸ªæ•°ä¿¡æ¯è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;product_info&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®12345678910111213141516171819202122232425262728293031323334353637383940414243444546#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;product_infohive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect &#39;$db_date&#39; dt, sku_num, spu_numfrom( select &#39;$db_date&#39; dt, count(*) sku_num from dwt.mall__sku_topic) tmp_sku_numjoin( select &#39;$db_date&#39; dt, count(*) spu_num from ( select spu_id from dwt.mall__sku_topic group by spu_id ) tmp_spu_id) tmp_spu_numontmp_sku_num.dt&#x3D;tmp_spu_num.dt;&quot;$hive -e &quot;$sql&quot;12.3.2 å•†å“é”€é‡æ’è¡Œå»ºè¡¨12345678910drop table if exists ads.mall__product_sale_topNCREATE EXTERNAL TABLE &#96;ads.mall__product_sale_topN&#96;(&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,&#96;sku_num&#96; string COMMENT &#39;sku ä¸ªæ•°&#39;,&#96;spu_num&#96; string COMMENT &#39;spu ä¸ªæ•°&#39; ) COMMENT &#39;å•†å“é”€é‡æ’åè¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;product_sale_topN&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®123456789101112131415161718192021222324252627#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;product_sale_topNhive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect &#39;$db_date&#39; dt, sku_id, payment_amountfromdws.mall__sku_action_daycountwheredt&#x3D;&#39;$db_date&#39;order by payment_amount desclimit 10;&quot;$hive -e &quot;$sql&quot;12.3.3 å•†å“æ”¶è—æ’åå»ºè¡¨12345678910drop table if exists ads.mall__product_favor_topNCREATE EXTERNAL TABLE &#96;ads.mall__product_favor_topN&#96;(&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,&#96;sku_id&#96; string COMMENT &#39;å•†å“ ID&#39;,&#96;favor_count&#96; bigint COMMENT &#39;æ”¶è—é‡&#39; ) COMMENT &#39;å•†å“æ”¶è—æ’åè¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;product_favor_topN&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®123456789101112131415161718192021222324252627#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;product_favor_topNhive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect &#39;$db_date&#39; dt, sku_id, favor_countfromdws.mall__sku_action_daycountwheredt&#x3D;&#39;$db_date&#39;order by favor_count desclimit 10;&quot;$hive -e &quot;$sql&quot;12.3.4 å•†å“åŠ å…¥è´­ç‰©è½¦æ’åå»ºè¡¨12345678910drop table if exists ads.mall__product_cart_topNCREATE EXTERNAL TABLE &#96;ads.mall__product_cart_topN&#96;(&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,&#96;sku_id&#96; string COMMENT &#39;å•†å“ ID&#39;,&#96;cart_num&#96; bigint COMMENT &#39;åŠ å…¥è´­ç‰©è½¦æ•°é‡&#39; ) COMMENT &#39;å•†å“åŠ å…¥è´­ç‰©è½¦æ’åè¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;product_cart_topN&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®123456789101112131415161718192021222324252627#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;product_cart_topNhive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect &#39;$db_date&#39; dt, sku_id, cart_numfromdws.mall__sku_action_daycountwheredt&#x3D;&#39;$db_date&#39;order by cart_num desclimit 10;&quot;$hive -e &quot;$sql&quot;12.3.5 å•†å“é€€æ¬¾ç‡æ’åï¼ˆè¿‘30å¤©ï¼‰å»ºè¡¨12345678910drop table if exists ads.mall__product_refund_topNCREATE EXTERNAL TABLE &#96;ads.mall__product_refund_topN&#96;(&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,&#96;sku_id&#96; string COMMENT &#39;å•†å“ ID&#39;,&#96;refund_ratio&#96; decimal(10,2) COMMENT &#39;é€€æ¬¾ç‡&#39; ) COMMENT &#39;å•†å“é€€æ¬¾ç‡æ’å(æœ€è¿‘ 30 å¤©)è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;product_refund_topN&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®123456789101112131415161718192021222324#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;product_refund_topNhive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect &#39;$db_date&#39;, sku_id, refund_last_30d_count&#x2F;payment_last_30d_count*100 refund_ratiofrom dwt.mall__sku_topicorder by refund_ratio desclimit 10;&quot;$hive -e &quot;$sql&quot;12.3.6 å•†å“å·®è¯„ç‡å»ºè¡¨12345678910drop table if exists ads.mall__appraise_bad_topNCREATE EXTERNAL TABLE &#96;ads.mall__appraise_bad_topN&#96;(&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,&#96;sku_id&#96; string COMMENT &#39;å•†å“ ID&#39;,&#96;appraise_bad_ratio&#96; decimal(10,2) COMMENT &#39;å·®è¯„ç‡&#39; ) COMMENT &#39;å•†å“å·®è¯„ç‡è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;appraise_bad_topN&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®123456789101112131415161718192021222324252627#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;appraise_bad_topNhive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect &#39;$db_date&#39; dt, sku_id, appraise_bad_count&#x2F;(appraise_good_count+appraise_mid_count+appraise_bad_count+appraise_default_count) appraise_bad_ratiofromdws.mall__sku_action_daycountwheredt&#x3D;&#39;$db_date&#39;order by appraise_bad_ratio desclimit 10;&quot;$hive -e &quot;$sql&quot;12.4 è¥é”€ä¸»é¢˜12.4.1 ä¸‹å•æ•°ç›®ç»Ÿè®¡å»ºè¡¨1234567891011drop table if exists ads.mall__order_daycountCREATE EXTERNAL TABLE &#96;ads.mall__order_daycount&#96;(dt string comment &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,order_count bigint comment &#39;å•æ—¥ä¸‹å•ç¬”æ•°&#39;,order_amount bigint comment &#39;å•æ—¥ä¸‹å•é‡‘é¢&#39;,order_users bigint comment &#39;å•æ—¥ä¸‹å•ç”¨æˆ·æ•°&#39; ) COMMENT &#39;ä¸‹å•æ•°ç›®ç»Ÿè®¡è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;order_daycount&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®123456789101112131415161718192021222324#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;order_daycounthive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect &#39;$db_date&#39;, sum(order_count), sum(order_amount), sum(if(order_count&gt;0,1,0))from dws.mall__user_action_daycountwhere dt&#x3D;&#39;$db_date&#39;;&quot;$hive -e &quot;$sql&quot;12.4.2 æ”¯ä»˜ä¿¡æ¯ç»Ÿè®¡å»ºè¡¨12345678910111213drop table if exists ads.mall__payment_daycountCREATE EXTERNAL TABLE &#96;ads.mall__payment_daycount&#96;(dt string comment &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,order_count bigint comment &#39;å•æ—¥æ”¯ä»˜ç¬”æ•°&#39;,order_amount bigint comment &#39;å•æ—¥æ”¯ä»˜é‡‘é¢&#39;,payment_user_count bigint comment &#39;å•æ—¥æ”¯ä»˜äººæ•°&#39;,payment_sku_count bigint comment &#39;å•æ—¥æ”¯ä»˜å•†å“æ•°&#39;,payment_avg_time double comment &#39;ä¸‹å•åˆ°æ”¯ä»˜çš„å¹³å‡æ—¶é•¿ï¼Œå–åˆ†é’Ÿæ•°&#39; ) COMMENT &#39;æ”¯ä»˜ä¿¡æ¯ç»Ÿè®¡è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;payment_daycount&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;payment_daycounthive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect tmp_payment.dt, tmp_payment.payment_count, tmp_payment.payment_amount, tmp_payment.payment_user_count, tmp_skucount.payment_sku_count, tmp_time.payment_avg_timefrom( select &#39;$db_date&#39; dt, sum(payment_count) payment_count, sum(payment_amount) payment_amount, sum(if(payment_count&gt;0,1,0)) payment_user_count from dws.mall__user_action_daycount where dt&#x3D;&#39;$db_date&#39;)tmp_paymentjoin( select &#39;$db_date&#39; dt, sum(if(payment_count&gt;0,1,0)) payment_sku_count from dws.mall__sku_action_daycount where dt&#x3D;&#39;$db_date&#39;)tmp_skucount on tmp_payment.dt&#x3D;tmp_skucount.dtjoin( select &#39;$db_date&#39; dt, sum(unix_timestamp(payment_time)-unix_timestamp(create_time))&#x2F;count(*)&#x2F;60 payment_avg_time from dwd.mall__fact_order_info where dt&#x3D;&#39;$db_date&#39; and payment_time is not null)tmp_time on tmp_payment.dt&#x3D;tmp_time.dt&quot;$hive -e &quot;$sql&quot;12.4.3 å¤è´­ç‡å»ºè¡¨1234567891011121314151617drop table if exists ads.mall__sale_tm_category1_stat_mnCREATE EXTERNAL TABLE &#96;ads.mall__sale_tm_category1_stat_mn&#96;(tm_id string comment &#39;å“ç‰Œ id&#39;,category1_id string comment &#39;1 çº§å“ç±» id &#39;,category1_name string comment &#39;1 çº§å“ç±»åç§° &#39;,buycount bigint comment &#39;è´­ä¹°äººæ•°&#39;,buy_twice_last bigint comment &#39;ä¸¤æ¬¡ä»¥ä¸Šè´­ä¹°äººæ•°&#39;,buy_twice_last_ratio decimal(10,2) comment &#39;å•æ¬¡å¤è´­ç‡&#39;,buy_3times_last bigint comment &#39;ä¸‰æ¬¡ä»¥ä¸Šè´­ä¹°äººæ•°&#39;,buy_3times_last_ratio decimal(10,2) comment &#39;å¤šæ¬¡å¤è´­ç‡&#39;,stat_mn string comment &#39;ç»Ÿè®¡æœˆä»½&#39;,stat_date string comment &#39;ç»Ÿè®¡æ—¥æœŸ&#39; ) COMMENT &#39;å¤è´­ç‡è¡¨&#39;row format delimited fields terminated by &#39;\\t&#39;stored as parquetlocation &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;sale_tm_category1_stat_mn&#x2F;&#39;tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)å¯¼å…¥æ•°æ®1234567891011121314151617181920212223242526272829303132333435363738394041#!&#x2F;bin&#x2F;bashdb_date&#x3D;$&#123;date&#125;hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hiveAPP1&#x3D;mallAPP2&#x3D;adstable_name&#x3D;sale_tm_category1_stat_mnhive_table_name&#x3D;$APP2.mall__$table_name# å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©if [ -n &quot;$&#123;date&#125;&quot; ] ;then db_date&#x3D;$&#123;date&#125;else db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;fisql&#x3D;&quot; insert into table $hive_table_nameselect mn.sku_tm_id, mn.sku_category1_id, mn.sku_category1_name, sum(if(mn.order_count&gt;&#x3D;1,1,0)) buycount, sum(if(mn.order_count&gt;&#x3D;2,1,0)) buyTwiceLast, sum(if(mn.order_count&gt;&#x3D;2,1,0))&#x2F;sum( if(mn.order_count&gt;&#x3D;1,1,0)) buyTwiceLastRatio, sum(if(mn.order_count&gt;&#x3D;3,1,0)) buy3timeLast , sum(if(mn.order_count&gt;&#x3D;3,1,0))&#x2F;sum( if(mn.order_count&gt;&#x3D;1,1,0)) buy3timeLastRatio, date_format(&#39;$db_date&#39; ,&#39;yyyy-MM&#39;) stat_mn, &#39;$db_date&#39; stat_datefrom( select user_id, sd.sku_tm_id, sd.sku_category1_id, sd.sku_category1_name, sum(order_count) order_count from dws.mall__sale_detail_daycount sd where date_format(dt,&#39;yyyy-MM&#39;)&#x3D;date_format(&#39;$db_date&#39; ,&#39;yyyy-MM&#39;) group by user_id, sd.sku_tm_id, sd.sku_category1_id, sd.sku_category1_name) mngroup by mn.sku_tm_id, mn.sku_category1_id, mn.sku_category1_name;&quot;$hive -e &quot;$sql&quot;","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"æ•°æ®ä»“åº“","slug":"æ•°æ®ä»“åº“","permalink":"cpeixin.cn/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"}]},{"title":"MySQLæ•°æ®åº“ç´¢å¼•-B+æ ‘","slug":"MySQLæ•°æ®åº“ç´¢å¼•-B-æ ‘","date":"2020-06-17T17:02:43.000Z","updated":"2020-08-16T17:04:17.620Z","comments":true,"path":"2020/06/18/MySQLæ•°æ®åº“ç´¢å¼•-B-æ ‘/","link":"","permalink":"cpeixin.cn/2020/06/18/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95-B-%E6%A0%91/","excerpt":"","text":"å¦‚æœä½ å¯¹æ•°æ®åº“çš„æ“ä½œéå¸¸äº†è§£ï¼Œé’ˆå¯¹æˆ‘ä»¬ç°åœ¨è¿™ä¸ªé—®é¢˜ï¼Œä½ å°±èƒ½æŠŠç´¢å¼•çš„éœ€æ±‚å®šä¹‰å¾—éå¸¸æ¸…æ¥šã€‚ä½†æ˜¯ï¼Œå¯¹äºå¤§éƒ¨åˆ†è½¯ä»¶å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œæˆ‘ä»¬å¯èƒ½åªäº†è§£ä¸€å°éƒ¨åˆ†å¸¸ç”¨çš„ SQL è¯­å¥ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾è¦è§£å†³çš„é—®é¢˜ï¼ŒåªåŒ…å«è¿™æ ·ä¸¤ä¸ªå¸¸ç”¨çš„éœ€æ±‚ï¼šæ ¹æ®æŸä¸ªå€¼æŸ¥æ‰¾æ•°æ®ï¼Œæ¯”å¦‚ select * from user where id=1234ï¼›æ ¹æ®åŒºé—´å€¼æ¥æŸ¥æ‰¾æŸäº›æ•°æ®ï¼Œæ¯”å¦‚ select * from user where id &gt; 1234 and id &lt; 2345ã€‚é™¤äº†è¿™äº›åŠŸèƒ½æ€§éœ€æ±‚ä¹‹å¤–ï¼Œè¿™ç§é—®é¢˜å¾€å¾€è¿˜ä¼šæ¶‰åŠä¸€äº›éåŠŸèƒ½æ€§éœ€æ±‚ï¼Œæ¯”å¦‚å®‰å…¨ã€æ€§èƒ½ã€ç”¨æˆ·ä½“éªŒç­‰ç­‰ã€‚é™äºä¸“æ è¦è®¨è®ºçš„ä¸»è¦æ˜¯æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œå¯¹äºéåŠŸèƒ½æ€§éœ€æ±‚ï¼Œæˆ‘ä»¬ç€é‡è€ƒè™‘æ€§èƒ½æ–¹é¢çš„éœ€æ±‚ã€‚æ€§èƒ½æ–¹é¢çš„éœ€æ±‚ï¼Œæˆ‘ä»¬ä¸»è¦è€ƒå¯Ÿæ—¶é—´å’Œç©ºé—´ä¸¤æ–¹é¢ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œæ•ˆç‡å’Œå­˜å‚¨ç©ºé—´ã€‚åœ¨æ‰§è¡Œæ•ˆç‡æ–¹é¢ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡ç´¢å¼•ï¼ŒæŸ¥è¯¢æ•°æ®çš„æ•ˆç‡å°½å¯èƒ½åœ°é«˜ï¼›åœ¨å­˜å‚¨ç©ºé—´æ–¹é¢ï¼Œæˆ‘ä»¬å¸Œæœ›ç´¢å¼•ä¸è¦æ¶ˆè€—å¤ªå¤šçš„å†…å­˜ç©ºé—´ã€‚é—®é¢˜çš„éœ€æ±‚å¤§è‡´å®šä¹‰æ¸…æ¥šäº†ï¼Œæˆ‘ä»¬ç°åœ¨å›æƒ³ä¸€ä¸‹ï¼Œèƒ½å¦åˆ©ç”¨å·²ç»å­¦ä¹ è¿‡çš„æ•°æ®ç»“æ„è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæ”¯æŒå¿«é€ŸæŸ¥è¯¢ã€æ’å…¥ç­‰æ“ä½œçš„åŠ¨æ€æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ è¿‡æ•£åˆ—è¡¨ã€å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ã€è·³è¡¨ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹æ•£åˆ—è¡¨ã€‚æ•£åˆ—è¡¨çš„æŸ¥è¯¢æ€§èƒ½å¾ˆå¥½ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚ä½†æ˜¯ï¼Œæ•£åˆ—è¡¨ä¸èƒ½æ”¯æŒæŒ‰ç…§åŒºé—´å¿«é€ŸæŸ¥æ‰¾æ•°æ®ã€‚æ‰€ä»¥ï¼Œæ•£åˆ—è¡¨ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚æˆ‘ä»¬å†æ¥çœ‹å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ã€‚å°½ç®¡å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘æŸ¥è¯¢çš„æ€§èƒ½ä¹Ÿå¾ˆé«˜ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ã€‚è€Œä¸”ï¼Œå¯¹æ ‘è¿›è¡Œä¸­åºéå†ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¾—åˆ°ä¸€ä¸ªä»å°åˆ°å¤§æœ‰åºçš„æ•°æ®åºåˆ—ï¼Œä½†è¿™ä»ç„¶ä¸è¶³ä»¥æ”¯æŒæŒ‰ç…§åŒºé—´å¿«é€ŸæŸ¥æ‰¾æ•°æ®ã€‚æˆ‘ä»¬å†æ¥çœ‹è·³è¡¨ã€‚è·³è¡¨æ˜¯åœ¨é“¾è¡¨ä¹‹ä¸ŠåŠ ä¸Šå¤šå±‚ç´¢å¼•æ„æˆçš„ã€‚å®ƒæ”¯æŒå¿«é€Ÿåœ°æ’å…¥ã€æŸ¥æ‰¾ã€åˆ é™¤æ•°æ®ï¼Œå¯¹åº”çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ã€‚å¹¶ä¸”ï¼Œè·³è¡¨ä¹Ÿæ”¯æŒæŒ‰ç…§åŒºé—´å¿«é€Ÿåœ°æŸ¥æ‰¾æ•°æ®ã€‚æˆ‘ä»¬åªéœ€è¦å®šä½åˆ°åŒºé—´èµ·ç‚¹å€¼å¯¹åº”åœ¨é“¾è¡¨ä¸­çš„ç»“ç‚¹ï¼Œç„¶åä»è¿™ä¸ªç»“ç‚¹å¼€å§‹ï¼Œé¡ºåºéå†é“¾è¡¨ï¼Œç›´åˆ°åŒºé—´ç»ˆç‚¹å¯¹åº”çš„ç»“ç‚¹ä¸ºæ­¢ï¼Œè¿™æœŸé—´éå†å¾—åˆ°çš„æ•°æ®å°±æ˜¯æ»¡è¶³åŒºé—´å€¼çš„æ•°æ®ã€‚è¿™æ ·çœ‹æ¥ï¼Œè·³è¡¨æ˜¯å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®é™…ä¸Šï¼Œæ•°æ®åº“ç´¢å¼•æ‰€ç”¨åˆ°çš„æ•°æ®ç»“æ„è·Ÿè·³è¡¨éå¸¸ç›¸ä¼¼ï¼Œå«ä½œ B+ æ ‘ã€‚ä¸è¿‡ï¼Œå®ƒæ˜¯é€šè¿‡äºŒå‰æŸ¥æ‰¾æ ‘æ¼”åŒ–è¿‡æ¥çš„ï¼Œè€Œéè·³è¡¨ã€‚ä¸ºäº†ç»™ä½ è¿˜åŸå‘æ˜ B+ æ ‘çš„æ•´ä¸ªæ€è€ƒè¿‡ç¨‹ï¼Œæ‰€ä»¥ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘è¿˜è¦ä»äºŒå‰æŸ¥æ‰¾æ ‘è®²èµ·ï¼Œçœ‹å®ƒæ˜¯å¦‚ä½•ä¸€æ­¥ä¸€æ­¥è¢«æ”¹é€ æˆ B+ æ ‘çš„ã€‚æ”¹é€ äºŒå‰æŸ¥æ‰¾æ ‘æ¥è§£å†³è¿™ä¸ªé—®é¢˜ä¸ºäº†è®©äºŒå‰æŸ¥æ‰¾æ ‘æ”¯æŒæŒ‰ç…§åŒºé—´æ¥æŸ¥æ‰¾æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å®ƒè¿›è¡Œè¿™æ ·çš„æ”¹é€ ï¼šæ ‘ä¸­çš„èŠ‚ç‚¹å¹¶ä¸å­˜å‚¨æ•°æ®æœ¬èº«ï¼Œè€Œæ˜¯åªæ˜¯ä½œä¸ºç´¢å¼•ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬æŠŠæ¯ä¸ªå¶å­èŠ‚ç‚¹ä¸²åœ¨ä¸€æ¡é“¾è¡¨ä¸Šï¼Œé“¾è¡¨ä¸­çš„æ•°æ®æ˜¯ä»å°åˆ°å¤§æœ‰åºçš„ã€‚ç»è¿‡æ”¹é€ ä¹‹åçš„äºŒå‰æ ‘ï¼Œå°±åƒå›¾ä¸­è¿™æ ·ï¼Œçœ‹èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆåƒè·³è¡¨å‘¢ï¼Ÿæ”¹é€ ä¹‹åï¼Œå¦‚æœæˆ‘ä»¬è¦æ±‚æŸä¸ªåŒºé—´çš„æ•°æ®ã€‚æˆ‘ä»¬åªéœ€è¦æ‹¿åŒºé—´çš„èµ·å§‹å€¼ï¼Œåœ¨æ ‘ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œå½“æŸ¥æ‰¾åˆ°æŸä¸ªå¶å­èŠ‚ç‚¹ä¹‹åï¼Œæˆ‘ä»¬å†é¡ºç€é“¾è¡¨å¾€åéå†ï¼Œç›´åˆ°é“¾è¡¨ä¸­çš„ç»“ç‚¹æ•°æ®å€¼å¤§äºåŒºé—´çš„ç»ˆæ­¢å€¼ä¸ºæ­¢ã€‚æ‰€æœ‰éå†åˆ°çš„æ•°æ®ï¼Œå°±æ˜¯ç¬¦åˆåŒºé—´å€¼çš„æ‰€æœ‰æ•°æ®ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¦ä¸ºå‡ åƒä¸‡ã€ä¸Šäº¿çš„æ•°æ®æ„å»ºç´¢å¼•ï¼Œå¦‚æœå°†ç´¢å¼•å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå°½ç®¡å†…å­˜è®¿é—®çš„é€Ÿåº¦éå¸¸å¿«ï¼ŒæŸ¥è¯¢çš„æ•ˆç‡éå¸¸é«˜ï¼Œä½†æ˜¯ï¼Œå ç”¨çš„å†…å­˜ä¼šéå¸¸å¤šã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬ç»™ä¸€äº¿ä¸ªæ•°æ®æ„å»ºäºŒå‰æŸ¥æ‰¾æ ‘ç´¢å¼•ï¼Œé‚£ç´¢å¼•ä¸­ä¼šåŒ…å«å¤§çº¦ 1 äº¿ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å‡è®¾å ç”¨ 16 ä¸ªå­—èŠ‚ï¼Œé‚£å°±éœ€è¦å¤§çº¦ 1GB çš„å†…å­˜ç©ºé—´ã€‚ç»™ä¸€å¼ è¡¨å»ºç«‹ç´¢å¼•ï¼Œæˆ‘ä»¬éœ€è¦ 1GB çš„å†…å­˜ç©ºé—´ã€‚å¦‚æœæˆ‘ä»¬è¦ç»™ 10 å¼ è¡¨å»ºç«‹ç´¢å¼•ï¼Œé‚£å¯¹å†…å­˜çš„éœ€æ±‚æ˜¯æ— æ³•æ»¡è¶³çš„ã€‚å¦‚ä½•è§£å†³è¿™ä¸ªç´¢å¼•å ç”¨å¤ªå¤šå†…å­˜çš„é—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å€ŸåŠ©æ—¶é—´æ¢ç©ºé—´çš„æ€è·¯ï¼ŒæŠŠç´¢å¼•å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­ï¼Œè€Œéå†…å­˜ä¸­ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç¡¬ç›˜æ˜¯ä¸€ä¸ªéå¸¸æ…¢é€Ÿçš„å­˜å‚¨è®¾å¤‡ã€‚é€šå¸¸å†…å­˜çš„è®¿é—®é€Ÿåº¦æ˜¯çº³ç§’çº§åˆ«çš„ï¼Œè€Œç£ç›˜è®¿é—®çš„é€Ÿåº¦æ˜¯æ¯«ç§’çº§åˆ«çš„ã€‚è¯»å–åŒæ ·å¤§å°çš„æ•°æ®ï¼Œä»ç£ç›˜ä¸­è¯»å–èŠ±è´¹çš„æ—¶é—´ï¼Œæ˜¯ä»å†…å­˜ä¸­è¯»å–æ‰€èŠ±è´¹æ—¶é—´çš„ä¸Šä¸‡å€ï¼Œç”šè‡³å‡ åä¸‡å€ã€‚è¿™ç§å°†ç´¢å¼•å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­çš„æ–¹æ¡ˆï¼Œå°½ç®¡å‡å°‘äº†å†…å­˜æ¶ˆè€—ï¼Œä½†æ˜¯åœ¨æ•°æ®æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è¯»å–ç£ç›˜ä¸­çš„ç´¢å¼•ï¼Œå› æ­¤æ•°æ®æŸ¥è¯¢æ•ˆç‡å°±ç›¸åº”é™ä½å¾ˆå¤šã€‚äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œç»è¿‡æ”¹é€ ä¹‹åï¼Œæ”¯æŒåŒºé—´æŸ¥æ‰¾çš„åŠŸèƒ½å°±å®ç°äº†ã€‚ä¸è¿‡ï¼Œä¸ºäº†èŠ‚çœå†…å­˜ï¼Œå¦‚æœæŠŠæ ‘å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­ï¼Œé‚£ä¹ˆæ¯ä¸ªèŠ‚ç‚¹çš„è¯»å–ï¼ˆæˆ–è€…è®¿é—®ï¼‰ï¼Œéƒ½å¯¹åº”ä¸€æ¬¡ç£ç›˜ IO æ“ä½œã€‚æ ‘çš„é«˜åº¦å°±ç­‰äºæ¯æ¬¡æŸ¥è¯¢æ•°æ®æ—¶ç£ç›˜ IO æ“ä½œçš„æ¬¡æ•°ã€‚æˆ‘ä»¬å‰é¢è®²åˆ°ï¼Œæ¯”èµ·å†…å­˜è¯»å†™æ“ä½œï¼Œç£ç›˜ IO æ“ä½œéå¸¸è€—æ—¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼˜åŒ–çš„é‡ç‚¹å°±æ˜¯å°½é‡å‡å°‘ç£ç›˜ IO æ“ä½œï¼Œä¹Ÿå°±æ˜¯ï¼Œå°½é‡é™ä½æ ‘çš„é«˜åº¦ã€‚é‚£å¦‚ä½•é™ä½æ ‘çš„é«˜åº¦å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æŠŠç´¢å¼•æ„å»ºæˆ m å‰æ ‘ï¼Œé«˜åº¦æ˜¯ä¸æ˜¯æ¯”äºŒå‰æ ‘è¦å°å‘¢ï¼Ÿå¦‚å›¾æ‰€ç¤ºï¼Œç»™ 16 ä¸ªæ•°æ®æ„å»ºäºŒå‰æ ‘ç´¢å¼•ï¼Œæ ‘çš„é«˜åº¦æ˜¯ 4ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªæ•°æ®ï¼Œå°±éœ€è¦ 4 ä¸ªç£ç›˜ IO æ“ä½œï¼ˆå¦‚æœæ ¹èŠ‚ç‚¹å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå…¶ä»–èŠ‚ç‚¹å­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼‰ï¼Œå¦‚æœå¯¹ 16 ä¸ªæ•°æ®æ„å»ºäº”å‰æ ‘ç´¢å¼•ï¼Œé‚£é«˜åº¦åªæœ‰ 2ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªæ•°æ®ï¼Œå¯¹åº”åªéœ€è¦ 2 æ¬¡ç£ç›˜æ“ä½œã€‚å¦‚æœ m å‰æ ‘ä¸­çš„ m æ˜¯ 100ï¼Œé‚£å¯¹ä¸€äº¿ä¸ªæ•°æ®æ„å»ºç´¢å¼•ï¼Œæ ‘çš„é«˜åº¦ä¹Ÿåªæ˜¯ 3ï¼Œæœ€å¤šåªè¦ 3 æ¬¡ç£ç›˜ IO å°±èƒ½è·å–åˆ°æ•°æ®ã€‚ç£ç›˜ IO å˜å°‘äº†ï¼ŒæŸ¥æ‰¾æ•°æ®çš„æ•ˆç‡ä¹Ÿå°±æé«˜äº†ã€‚)å¦‚æœæˆ‘ä»¬å°† m å‰æ ‘å®ç° B+ æ ‘ç´¢å¼•ï¼Œç”¨ä»£ç å®ç°å‡ºæ¥ï¼Œå°±æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ï¼ˆå‡è®¾æˆ‘ä»¬ç»™ int ç±»å‹çš„æ•°æ®åº“å­—æ®µæ·»åŠ ç´¢å¼•ï¼Œæ‰€ä»¥ä»£ç ä¸­çš„ keywords æ˜¯ int ç±»å‹çš„ï¼‰ï¼š1234567891011121314151617181920212223242526272829303132333435&#x2F;** * è¿™æ˜¯B+æ ‘éå¶å­èŠ‚ç‚¹çš„å®šä¹‰ã€‚ * * å‡è®¾keywords&#x3D;[3, 5, 8, 10] * 4ä¸ªé”®å€¼å°†æ•°æ®åˆ†ä¸º5ä¸ªåŒºé—´ï¼š(-INF,3), [3,5), [5,8), [8,10), [10,INF) * 5ä¸ªåŒºé—´åˆ†åˆ«å¯¹åº”ï¼šchildren[0]...children[4] * * må€¼æ˜¯äº‹å…ˆè®¡ç®—å¾—åˆ°çš„ï¼Œè®¡ç®—çš„ä¾æ®æ˜¯è®©æ‰€æœ‰ä¿¡æ¯çš„å¤§å°æ­£å¥½ç­‰äºé¡µçš„å¤§å°ï¼š * PAGE_SIZE &#x3D; (m-1)*4[keywordsså¤§å°]+m*8[childrenå¤§å°] *&#x2F;public class BPlusTreeNode &#123; public static int m &#x3D; 5; &#x2F;&#x2F; 5å‰æ ‘ public int[] keywords &#x3D; new int[m-1]; &#x2F;&#x2F; é”®å€¼ï¼Œç”¨æ¥åˆ’åˆ†æ•°æ®åŒºé—´ public BPlusTreeNode[] children &#x3D; new BPlusTreeNode[m];&#x2F;&#x2F;ä¿å­˜å­èŠ‚ç‚¹æŒ‡é’ˆ&#125;&#x2F;** * è¿™æ˜¯B+æ ‘ä¸­å¶å­èŠ‚ç‚¹çš„å®šä¹‰ã€‚ * * B+æ ‘ä¸­çš„å¶å­èŠ‚ç‚¹è·Ÿå†…éƒ¨èŠ‚ç‚¹æ˜¯ä¸ä¸€æ ·çš„, * å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯å€¼ï¼Œè€ŒéåŒºé—´ã€‚ * è¿™ä¸ªå®šä¹‰é‡Œï¼Œæ¯ä¸ªå¶å­èŠ‚ç‚¹å­˜å‚¨3ä¸ªæ•°æ®è¡Œçš„é”®å€¼åŠåœ°å€ä¿¡æ¯ã€‚ * * kå€¼æ˜¯äº‹å…ˆè®¡ç®—å¾—åˆ°çš„ï¼Œè®¡ç®—çš„ä¾æ®æ˜¯è®©æ‰€æœ‰ä¿¡æ¯çš„å¤§å°æ­£å¥½ç­‰äºé¡µçš„å¤§å°ï¼š * PAGE_SIZE &#x3D; k*4[keyw..å¤§å°]+k*8[dataAd..å¤§å°]+8[prevå¤§å°]+8[nextå¤§å°] *&#x2F;public class BPlusTreeLeafNode &#123; public static int k &#x3D; 3; public int[] keywords &#x3D; new int[k]; &#x2F;&#x2F; æ•°æ®çš„é”®å€¼ public long[] dataAddress &#x3D; new long[k]; &#x2F;&#x2F; æ•°æ®åœ°å€ public BPlusTreeLeafNode prev; &#x2F;&#x2F; è¿™ä¸ªç»“ç‚¹åœ¨é“¾è¡¨ä¸­çš„å‰é©±ç»“ç‚¹ public BPlusTreeLeafNode next; &#x2F;&#x2F; è¿™ä¸ªç»“ç‚¹åœ¨é“¾è¡¨ä¸­çš„åç»§ç»“ç‚¹&#125;æˆ‘ç¨å¾®è§£é‡Šä¸€ä¸‹è¿™æ®µä»£ç ã€‚å¯¹äºç›¸åŒä¸ªæ•°çš„æ•°æ®æ„å»º m å‰æ ‘ç´¢å¼•ï¼Œm å‰æ ‘ä¸­çš„ m è¶Šå¤§ï¼Œé‚£æ ‘çš„é«˜åº¦å°±è¶Šå°ï¼Œé‚£ m å‰æ ‘ä¸­çš„ m æ˜¯ä¸æ˜¯è¶Šå¤§è¶Šå¥½å‘¢ï¼Ÿåˆ°åº•å¤šå¤§æ‰æœ€åˆé€‚å‘¢ï¼Ÿä¸ç®¡æ˜¯å†…å­˜ä¸­çš„æ•°æ®ï¼Œè¿˜æ˜¯ç£ç›˜ä¸­çš„æ•°æ®ï¼Œæ“ä½œç³»ç»Ÿéƒ½æ˜¯æŒ‰é¡µï¼ˆä¸€é¡µå¤§å°é€šå¸¸æ˜¯ 4KBï¼Œè¿™ä¸ªå€¼å¯ä»¥é€šè¿‡ getconfig PAGE_SIZE å‘½ä»¤æŸ¥çœ‹ï¼‰æ¥è¯»å–çš„ï¼Œä¸€æ¬¡ä¼šè¯»ä¸€é¡µçš„æ•°æ®ã€‚å¦‚æœè¦è¯»å–çš„æ•°æ®é‡è¶…è¿‡ä¸€é¡µçš„å¤§å°ï¼Œå°±ä¼šè§¦å‘å¤šæ¬¡ IO æ“ä½œã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨é€‰æ‹© m å¤§å°çš„æ—¶å€™ï¼Œè¦å°½é‡è®©æ¯ä¸ªèŠ‚ç‚¹çš„å¤§å°ç­‰äºä¸€ä¸ªé¡µçš„å¤§å°ã€‚è¯»å–ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåªéœ€è¦ä¸€æ¬¡ç£ç›˜ IO æ“ä½œã€‚å°½ç®¡ç´¢å¼•å¯ä»¥æé«˜æ•°æ®åº“çš„æŸ¥è¯¢æ•ˆç‡ï¼Œä½†æ˜¯ï¼Œä½œä¸ºä¸€åå¼€å‘å·¥ç¨‹å¸ˆï¼Œä½ åº”è¯¥ä¹ŸçŸ¥é“ï¼Œç´¢å¼•æœ‰åˆ©ä¹Ÿæœ‰å¼Šï¼Œå®ƒä¹Ÿä¼šè®©å†™å…¥æ•°æ®çš„æ•ˆç‡ä¸‹é™ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ•°æ®çš„å†™å…¥è¿‡ç¨‹ï¼Œä¼šæ¶‰åŠç´¢å¼•çš„æ›´æ–°ï¼Œè¿™æ˜¯ç´¢å¼•å¯¼è‡´å†™å…¥å˜æ…¢çš„ä¸»è¦åŸå› ã€‚å¯¹äºä¸€ä¸ª B+ æ ‘æ¥è¯´ï¼Œm å€¼æ˜¯æ ¹æ®é¡µçš„å¤§å°äº‹å…ˆè®¡ç®—å¥½çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåªèƒ½æœ‰ m ä¸ªå­èŠ‚ç‚¹ã€‚åœ¨å¾€æ•°æ®åº“ä¸­å†™å…¥æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½ä½¿ç´¢å¼•ä¸­æŸäº›èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°è¶…è¿‡ mï¼Œè¿™ä¸ªèŠ‚ç‚¹çš„å¤§å°è¶…è¿‡äº†ä¸€ä¸ªé¡µçš„å¤§å°ï¼Œè¯»å–è¿™æ ·ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±ä¼šå¯¼è‡´å¤šæ¬¡ç£ç›˜ IO æ“ä½œã€‚æˆ‘ä»¬è¯¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå®é™…ä¸Šï¼Œå¤„ç†æ€è·¯å¹¶ä¸å¤æ‚ã€‚æˆ‘ä»¬åªéœ€è¦å°†è¿™ä¸ªèŠ‚ç‚¹åˆ†è£‚æˆä¸¤ä¸ªèŠ‚ç‚¹ã€‚ä½†æ˜¯ï¼ŒèŠ‚ç‚¹åˆ†è£‚ä¹‹åï¼Œå…¶ä¸Šå±‚çˆ¶èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°å°±æœ‰å¯èƒ½è¶…è¿‡ m ä¸ªã€‚ä¸è¿‡è¿™ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œå°†çˆ¶èŠ‚ç‚¹ä¹Ÿåˆ†è£‚æˆä¸¤ä¸ªèŠ‚ç‚¹ã€‚è¿™ç§çº§è”ååº”ä¼šä»ä¸‹å¾€ä¸Šï¼Œä¸€ç›´å½±å“åˆ°æ ¹èŠ‚ç‚¹ã€‚è¿™ä¸ªåˆ†è£‚è¿‡ç¨‹ï¼Œä½ å¯ä»¥ç»“åˆç€ä¸‹é¢è¿™ä¸ªå›¾ä¸€å—çœ‹ï¼Œä¼šæ›´å®¹æ˜“ç†è§£ï¼ˆå›¾ä¸­çš„ B+ æ ‘æ˜¯ä¸€ä¸ªä¸‰å‰æ ‘ã€‚æˆ‘ä»¬é™å®šå¶å­èŠ‚ç‚¹ä¸­ï¼Œæ•°æ®çš„ä¸ªæ•°è¶…è¿‡ 2 ä¸ªå°±åˆ†è£‚èŠ‚ç‚¹ï¼›éå¶å­èŠ‚ç‚¹ä¸­ï¼Œå­èŠ‚ç‚¹çš„ä¸ªæ•°è¶…è¿‡ 3 ä¸ªå°±åˆ†è£‚èŠ‚ç‚¹ï¼‰ã€‚æ­£æ˜¯å› ä¸ºè¦æ—¶åˆ»ä¿è¯ B+ æ ‘ç´¢å¼•æ˜¯ä¸€ä¸ª m å‰æ ‘ï¼Œæ‰€ä»¥ï¼Œç´¢å¼•çš„å­˜åœ¨ä¼šå¯¼è‡´æ•°æ®åº“å†™å…¥çš„é€Ÿåº¦é™ä½ã€‚å®é™…ä¸Šï¼Œä¸å…‰å†™å…¥æ•°æ®ä¼šå˜æ…¢ï¼Œåˆ é™¤æ•°æ®ä¹Ÿä¼šå˜æ…¢ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬åœ¨åˆ é™¤æŸä¸ªæ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿè¦å¯¹åº”åœ°æ›´æ–°ç´¢å¼•èŠ‚ç‚¹ã€‚è¿™ä¸ªå¤„ç†æ€è·¯æœ‰ç‚¹ç±»ä¼¼è·³è¡¨ä¸­åˆ é™¤æ•°æ®çš„å¤„ç†æ€è·¯ã€‚é¢‘ç¹çš„æ•°æ®åˆ é™¤ï¼Œå°±ä¼šå¯¼è‡´æŸäº›èŠ‚ç‚¹ä¸­ï¼Œå­èŠ‚ç‚¹çš„ä¸ªæ•°å˜å¾—éå¸¸å°‘ï¼Œé•¿æ­¤ä»¥å¾€ï¼Œå¦‚æœæ¯ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹éƒ½æ¯”è¾ƒå°‘ï¼ŒåŠ¿å¿…ä¼šå½±å“ç´¢å¼•çš„æ•ˆç‡ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªé˜ˆå€¼ã€‚åœ¨ B+ æ ‘ä¸­ï¼Œè¿™ä¸ªé˜ˆå€¼ç­‰äº m/2ã€‚å¦‚æœæŸä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°å°äº m/2ï¼Œæˆ‘ä»¬å°±å°†å®ƒè·Ÿç›¸é‚»çš„å…„å¼ŸèŠ‚ç‚¹åˆå¹¶ã€‚ä¸è¿‡ï¼Œåˆå¹¶ä¹‹åèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°æœ‰å¯èƒ½ä¼šè¶…è¿‡ mã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©æ’å…¥æ•°æ®æ—¶å€™çš„å¤„ç†æ–¹æ³•ï¼Œå†åˆ†è£‚èŠ‚ç‚¹ã€‚æ–‡å­—æè¿°ä¸æ˜¯å¾ˆç›´è§‚ï¼Œæˆ‘ä¸¾äº†ä¸€ä¸ªåˆ é™¤æ“ä½œçš„ä¾‹å­ï¼Œä½ å¯ä»¥å¯¹æ¯”ç€çœ‹ä¸‹ï¼ˆå›¾ä¸­çš„ B+ æ ‘æ˜¯ä¸€ä¸ªäº”å‰æ ‘ã€‚æˆ‘ä»¬é™å®šå¶å­èŠ‚ç‚¹ä¸­ï¼Œæ•°æ®çš„ä¸ªæ•°å°‘äº 2 ä¸ªå°±åˆå¹¶èŠ‚ç‚¹ï¼›éå¶å­èŠ‚ç‚¹ä¸­ï¼Œå­èŠ‚ç‚¹çš„ä¸ªæ•°å°‘äº 3 ä¸ªå°±åˆå¹¶èŠ‚ç‚¹ã€‚ï¼‰ã€‚æ•°æ®åº“ç´¢å¼•ä»¥åŠ B+ æ ‘çš„ç”±æ¥ï¼Œåˆ°æ­¤å°±è®²å®Œäº†ã€‚ä½ æœ‰æ²¡æœ‰å‘ç°ï¼ŒB+ æ ‘çš„ç»“æ„å’Œæ“ä½œï¼Œè·Ÿè·³è¡¨éå¸¸ç±»ä¼¼ã€‚ç†è®ºä¸Šè®²ï¼Œå¯¹è·³è¡¨ç¨åŠ æ”¹é€ ï¼Œä¹Ÿå¯ä»¥æ›¿ä»£ B+ æ ‘ï¼Œä½œä¸ºæ•°æ®åº“çš„ç´¢å¼•å®ç°çš„ã€‚B+ æ ‘å‘æ˜äº 1972 å¹´ï¼Œè·³è¡¨å‘æ˜äº 1989 å¹´ï¼Œæˆ‘ä»¬å¯ä»¥å¤§èƒ†çŒœæƒ³ä¸‹ï¼Œè·³è¡¨çš„ä½œè€…æœ‰å¯èƒ½å°±æ˜¯å—äº† B+ æ ‘çš„å¯å‘ï¼Œæ‰å‘æ˜å‡ºè·³è¡¨æ¥çš„ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªä¹Ÿæ— ä»è€ƒè¯äº†ã€‚æ€»ç»“ä»Šå¤©ï¼Œæˆ‘ä»¬è®²è§£äº†æ•°æ®åº“ç´¢å¼•å®ç°ï¼Œä¾èµ–çš„åº•å±‚æ•°æ®ç»“æ„ï¼ŒB+ æ ‘ã€‚å®ƒé€šè¿‡å­˜å‚¨åœ¨ç£ç›˜çš„å¤šå‰æ ‘ç»“æ„ï¼Œåšåˆ°äº†æ—¶é—´ã€ç©ºé—´çš„å¹³è¡¡ï¼Œæ—¢ä¿è¯äº†æ‰§è¡Œæ•ˆç‡ï¼ŒåˆèŠ‚çœäº†å†…å­˜ã€‚å‰é¢çš„è®²è§£ä¸­ï¼Œä¸ºäº†ä¸€æ­¥ä¸€æ­¥è¯¦ç»†åœ°ç»™ä½ ä»‹ç» B+ æ ‘çš„ç”±æ¥ï¼Œå†…å®¹çœ‹èµ·æ¥æ¯”è¾ƒé›¶æ•£ã€‚ä¸ºäº†æ–¹ä¾¿ä½ æŒæ¡å’Œè®°å¿†ï¼Œæˆ‘è¿™é‡Œå†æ€»ç»“ä¸€ä¸‹ B+ æ ‘çš„ç‰¹ç‚¹ï¼šæ¯ä¸ªèŠ‚ç‚¹ä¸­å­èŠ‚ç‚¹çš„ä¸ªæ•°ä¸èƒ½è¶…è¿‡ mï¼Œä¹Ÿä¸èƒ½å°äº m/2ï¼›æ ¹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°å¯ä»¥ä¸è¶…è¿‡ m/2ï¼Œè¿™æ˜¯ä¸€ä¸ªä¾‹å¤–ï¼›m å‰æ ‘åªå­˜å‚¨ç´¢å¼•ï¼Œå¹¶ä¸çœŸæ­£å­˜å‚¨æ•°æ®ï¼Œè¿™ä¸ªæœ‰ç‚¹å„¿ç±»ä¼¼è·³è¡¨ï¼›é€šè¿‡é“¾è¡¨å°†å¶å­èŠ‚ç‚¹ä¸²è”åœ¨ä¸€èµ·ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿æŒ‰åŒºé—´æŸ¥æ‰¾ï¼›ä¸€èˆ¬æƒ…å†µï¼Œæ ¹èŠ‚ç‚¹ä¼šè¢«å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå…¶ä»–èŠ‚ç‚¹å­˜å‚¨åœ¨ç£ç›˜ä¸­ã€‚é™¤äº† B+ æ ‘ï¼Œä½ å¯èƒ½è¿˜å¬è¯´è¿‡ B æ ‘ã€B- æ ‘ï¼Œæˆ‘è¿™é‡Œç®€å•æä¸€ä¸‹ã€‚å®é™…ä¸Šï¼ŒB- æ ‘å°±æ˜¯ B æ ‘ï¼Œè‹±æ–‡ç¿»è¯‘éƒ½æ˜¯ B-Treeï¼Œè¿™é‡Œçš„â€œ-â€å¹¶ä¸æ˜¯ç›¸å¯¹ B+ æ ‘ä¸­çš„â€œ+â€ï¼Œè€Œåªæ˜¯ä¸€ä¸ªè¿æ¥ç¬¦ã€‚è¿™ä¸ªå¾ˆå®¹æ˜“è¯¯è§£ï¼Œæ‰€ä»¥æˆ‘å¼ºè°ƒä¸‹ã€‚è€Œ B æ ‘å®é™…ä¸Šæ˜¯ä½çº§ç‰ˆçš„ B+ æ ‘ï¼Œæˆ–è€…è¯´ B+ æ ‘æ˜¯ B æ ‘çš„æ”¹è¿›ç‰ˆã€‚B æ ‘è·Ÿ B+ æ ‘çš„ä¸åŒç‚¹ä¸»è¦é›†ä¸­åœ¨è¿™å‡ ä¸ªåœ°æ–¹ï¼šB+ æ ‘ä¸­çš„èŠ‚ç‚¹ä¸å­˜å‚¨æ•°æ®ï¼Œåªæ˜¯ç´¢å¼•ï¼Œè€Œ B æ ‘ä¸­çš„èŠ‚ç‚¹å­˜å‚¨æ•°æ®ï¼›B æ ‘ä¸­çš„å¶å­èŠ‚ç‚¹å¹¶ä¸éœ€è¦é“¾è¡¨æ¥ä¸²è”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒB æ ‘åªæ˜¯ä¸€ä¸ªæ¯ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°ä¸èƒ½å°äº m/2 çš„ m å‰æ ‘ã€‚","categories":[{"name":"DataBases","slug":"DataBases","permalink":"cpeixin.cn/categories/DataBases/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"cpeixin.cn/tags/mysql/"}]},{"title":"ã€è½¬è½½ã€‘MySQLç´¢å¼•åŸç†","slug":"ã€è½¬è½½ã€‘MySQLç´¢å¼•åŸç†","date":"2020-06-16T16:36:22.000Z","updated":"2020-08-16T16:39:42.433Z","comments":true,"path":"2020/06/17/ã€è½¬è½½ã€‘MySQLç´¢å¼•åŸç†/","link":"","permalink":"cpeixin.cn/2020/06/17/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/","excerpt":"","text":"èƒŒæ™¯MySQLå‡­å€Ÿç€å‡ºè‰²çš„æ€§èƒ½ã€ä½å»‰çš„æˆæœ¬ã€ä¸°å¯Œçš„èµ„æºï¼Œå·²ç»æˆä¸ºç»å¤§å¤šæ•°äº’è”ç½‘å…¬å¸çš„é¦–é€‰å…³ç³»å‹æ•°æ®åº“ã€‚è™½ç„¶æ€§èƒ½å‡ºè‰²ï¼Œä½†æ‰€è°“â€œå¥½é©¬é…å¥½éâ€ï¼Œå¦‚ä½•èƒ½å¤Ÿæ›´å¥½çš„ä½¿ç”¨å®ƒï¼Œå·²ç»æˆä¸ºå¼€å‘å·¥ç¨‹å¸ˆçš„å¿…ä¿®è¯¾ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä»èŒä½æè¿°ä¸Šçœ‹åˆ°è¯¸å¦‚â€œç²¾é€šMySQLâ€ã€â€œSQLè¯­å¥ä¼˜åŒ–â€ã€â€œäº†è§£æ•°æ®åº“åŸç†â€ç­‰è¦æ±‚ã€‚æˆ‘ä»¬çŸ¥é“ä¸€èˆ¬çš„åº”ç”¨ç³»ç»Ÿï¼Œè¯»å†™æ¯”ä¾‹åœ¨10:1å·¦å³ï¼Œè€Œä¸”æ’å…¥æ“ä½œå’Œä¸€èˆ¬çš„æ›´æ–°æ“ä½œå¾ˆå°‘å‡ºç°æ€§èƒ½é—®é¢˜ï¼Œé‡åˆ°æœ€å¤šçš„ï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“å‡ºé—®é¢˜çš„ï¼Œè¿˜æ˜¯ä¸€äº›å¤æ‚çš„æŸ¥è¯¢æ“ä½œï¼Œæ‰€ä»¥æŸ¥è¯¢è¯­å¥çš„ä¼˜åŒ–æ˜¾ç„¶æ˜¯é‡ä¸­ä¹‹é‡ã€‚æœ¬äººä»2013å¹´7æœˆä»½èµ·ï¼Œä¸€ç›´åœ¨ç¾å›¢æ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿéƒ¨åšæ…¢æŸ¥è¯¢çš„ä¼˜åŒ–å·¥ä½œï¼Œå…±è®¡åä½™ä¸ªç³»ç»Ÿï¼Œç´¯è®¡è§£å†³å’Œç§¯ç´¯äº†ä¸Šç™¾ä¸ªæ…¢æŸ¥è¯¢æ¡ˆä¾‹ã€‚éšç€ä¸šåŠ¡çš„å¤æ‚æ€§æå‡ï¼Œé‡åˆ°çš„é—®é¢˜åƒå¥‡ç™¾æ€ªï¼Œäº”èŠ±å…«é—¨ï¼ŒåŒªå¤·æ‰€æ€ã€‚æœ¬æ–‡æ—¨åœ¨ä»¥å¼€å‘å·¥ç¨‹å¸ˆçš„è§’åº¦æ¥è§£é‡Šæ•°æ®åº“ç´¢å¼•çš„åŸç†å’Œå¦‚ä½•ä¼˜åŒ–æ…¢æŸ¥è¯¢ã€‚ä¸€ä¸ªæ…¢æŸ¥è¯¢å¼•å‘çš„æ€è€ƒ12345678910select count(*) from task where status&#x3D;2 and operator_id&#x3D;20839 and operate_time&gt;1371169729 and operate_time&lt;1371174603 and type&#x3D;2;ç³»ç»Ÿä½¿ç”¨è€…ååº”æœ‰ä¸€ä¸ªåŠŸèƒ½è¶Šæ¥è¶Šæ…¢ï¼Œäºæ˜¯å·¥ç¨‹å¸ˆæ‰¾åˆ°äº†ä¸Šé¢çš„SQLã€‚å¹¶ä¸”å…´è‡´å†²å†²çš„æ‰¾åˆ°äº†æˆ‘ï¼Œâ€œè¿™ä¸ªSQLéœ€è¦ä¼˜åŒ–ï¼Œç»™æˆ‘æŠŠæ¯ä¸ªå­—æ®µéƒ½åŠ ä¸Šç´¢å¼•â€ã€‚æˆ‘å¾ˆæƒŠè®¶ï¼Œé—®é“ï¼šâ€œä¸ºä»€ä¹ˆéœ€è¦æ¯ä¸ªå­—æ®µéƒ½åŠ ä¸Šç´¢å¼•ï¼Ÿâ€â€œæŠŠæŸ¥è¯¢çš„å­—æ®µéƒ½åŠ ä¸Šç´¢å¼•ä¼šæ›´å¿«â€ï¼Œå·¥ç¨‹å¸ˆä¿¡å¿ƒæ»¡æ»¡ã€‚â€œè¿™ç§æƒ…å†µå®Œå…¨å¯ä»¥å»ºä¸€ä¸ªè”åˆç´¢å¼•ï¼Œå› ä¸ºæ˜¯æœ€å·¦å‰ç¼€åŒ¹é…ï¼Œæ‰€ä»¥operate_timeéœ€è¦æ”¾åˆ°æœ€åï¼Œè€Œä¸”è¿˜éœ€è¦æŠŠå…¶ä»–ç›¸å…³çš„æŸ¥è¯¢éƒ½æ‹¿æ¥ï¼Œéœ€è¦åšä¸€ä¸ªç»¼åˆè¯„ä¼°ã€‚â€â€œè”åˆç´¢å¼•ï¼Ÿæœ€å·¦å‰ç¼€åŒ¹é…ï¼Ÿç»¼åˆè¯„ä¼°ï¼Ÿâ€å·¥ç¨‹å¸ˆä¸ç¦é™·å…¥äº†æ²‰æ€ã€‚å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çŸ¥é“ç´¢å¼•èƒ½å¤Ÿæé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œä½†åº”è¯¥å¦‚ä½•å»ºç«‹ç´¢å¼•ï¼Ÿç´¢å¼•çš„é¡ºåºå¦‚ä½•ï¼Ÿè®¸å¤šäººå´åªçŸ¥é“å¤§æ¦‚ã€‚å…¶å®ç†è§£è¿™äº›æ¦‚å¿µå¹¶ä¸éš¾ï¼Œè€Œä¸”ç´¢å¼•çš„åŸç†è¿œæ²¡æœ‰æƒ³è±¡çš„é‚£ä¹ˆå¤æ‚ã€‚MySQLç´¢å¼•åŸç†ç´¢å¼•ç›®çš„ç´¢å¼•çš„ç›®çš„åœ¨äºæé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œå¯ä»¥ç±»æ¯”å­—å…¸ï¼Œå¦‚æœè¦æŸ¥â€œmysqlâ€è¿™ä¸ªå•è¯ï¼Œæˆ‘ä»¬è‚¯å®šéœ€è¦å®šä½åˆ°må­—æ¯ï¼Œç„¶åä»ä¸‹å¾€ä¸‹æ‰¾åˆ°yå­—æ¯ï¼Œå†æ‰¾åˆ°å‰©ä¸‹çš„sqlã€‚å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦æŠŠæ‰€æœ‰å•è¯çœ‹ä¸€éæ‰èƒ½æ‰¾åˆ°ä½ æƒ³è¦çš„ï¼Œå¦‚æœæˆ‘æƒ³æ‰¾åˆ°må¼€å¤´çš„å•è¯å‘¢ï¼Ÿæˆ–è€…zeå¼€å¤´çš„å•è¯å‘¢ï¼Ÿæ˜¯ä¸æ˜¯è§‰å¾—å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œè¿™ä¸ªäº‹æƒ…æ ¹æœ¬æ— æ³•å®Œæˆï¼Ÿç´¢å¼•åŸç†é™¤äº†è¯å…¸ï¼Œç”Ÿæ´»ä¸­éšå¤„å¯è§ç´¢å¼•çš„ä¾‹å­ï¼Œå¦‚ç«è½¦ç«™çš„è½¦æ¬¡è¡¨ã€å›¾ä¹¦çš„ç›®å½•ç­‰ã€‚å®ƒä»¬çš„åŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé€šè¿‡ä¸æ–­çš„ç¼©å°æƒ³è¦è·å¾—æ•°æ®çš„èŒƒå›´æ¥ç­›é€‰å‡ºæœ€ç»ˆæƒ³è¦çš„ç»“æœï¼ŒåŒæ—¶æŠŠéšæœºçš„äº‹ä»¶å˜æˆé¡ºåºçš„äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ€»æ˜¯é€šè¿‡åŒä¸€ç§æŸ¥æ‰¾æ–¹å¼æ¥é”å®šæ•°æ®ã€‚æ•°æ®åº“ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä½†æ˜¾ç„¶è¦å¤æ‚è®¸å¤šï¼Œå› ä¸ºä¸ä»…é¢ä¸´ç€ç­‰å€¼æŸ¥è¯¢ï¼Œè¿˜æœ‰èŒƒå›´æŸ¥è¯¢(&gt;ã€&lt;ã€betweenã€in)ã€æ¨¡ç³ŠæŸ¥è¯¢(like)ã€å¹¶é›†æŸ¥è¯¢(or)ç­‰ç­‰ã€‚æ•°æ®åº“åº”è¯¥é€‰æ‹©æ€ä¹ˆæ ·çš„æ–¹å¼æ¥åº”å¯¹æ‰€æœ‰çš„é—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬å›æƒ³å­—å…¸çš„ä¾‹å­ï¼Œèƒ½ä¸èƒ½æŠŠæ•°æ®åˆ†æˆæ®µï¼Œç„¶ååˆ†æ®µæŸ¥è¯¢å‘¢ï¼Ÿæœ€ç®€å•çš„å¦‚æœ1000æ¡æ•°æ®ï¼Œ1åˆ°100åˆ†æˆç¬¬ä¸€æ®µï¼Œ101åˆ°200åˆ†æˆç¬¬äºŒæ®µï¼Œ201åˆ°300åˆ†æˆç¬¬ä¸‰æ®µâ€¦â€¦è¿™æ ·æŸ¥ç¬¬250æ¡æ•°æ®ï¼Œåªè¦æ‰¾ç¬¬ä¸‰æ®µå°±å¯ä»¥äº†ï¼Œä¸€ä¸‹å­å»é™¤äº†90%çš„æ— æ•ˆæ•°æ®ã€‚ä½†å¦‚æœæ˜¯1åƒä¸‡çš„è®°å½•å‘¢ï¼Œåˆ†æˆå‡ æ®µæ¯”è¾ƒå¥½ï¼Ÿç¨æœ‰ç®—æ³•åŸºç¡€çš„åŒå­¦ä¼šæƒ³åˆ°æœç´¢æ ‘ï¼Œå…¶å¹³å‡å¤æ‚åº¦æ˜¯lgNï¼Œå…·æœ‰ä¸é”™çš„æŸ¥è¯¢æ€§èƒ½ã€‚ä½†è¿™é‡Œæˆ‘ä»¬å¿½ç•¥äº†ä¸€ä¸ªå…³é”®çš„é—®é¢˜ï¼Œå¤æ‚åº¦æ¨¡å‹æ˜¯åŸºäºæ¯æ¬¡ç›¸åŒçš„æ“ä½œæˆæœ¬æ¥è€ƒè™‘çš„ï¼Œæ•°æ®åº“å®ç°æ¯”è¾ƒå¤æ‚ï¼Œæ•°æ®ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œè€Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œæ¯æ¬¡åˆå¯ä»¥æŠŠéƒ¨åˆ†æ•°æ®è¯»å…¥å†…å­˜æ¥è®¡ç®—ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“è®¿é—®ç£ç›˜çš„æˆæœ¬å¤§æ¦‚æ˜¯è®¿é—®å†…å­˜çš„åä¸‡å€å·¦å³ï¼Œæ‰€ä»¥ç®€å•çš„æœç´¢æ ‘éš¾ä»¥æ»¡è¶³å¤æ‚çš„åº”ç”¨åœºæ™¯ã€‚ç£ç›˜IOä¸é¢„è¯»å‰é¢æåˆ°äº†è®¿é—®ç£ç›˜ï¼Œé‚£ä¹ˆè¿™é‡Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹ç£ç›˜IOå’Œé¢„è¯»ï¼Œç£ç›˜è¯»å–æ•°æ®é çš„æ˜¯æœºæ¢°è¿åŠ¨ï¼Œæ¯æ¬¡è¯»å–æ•°æ®èŠ±è´¹çš„æ—¶é—´å¯ä»¥åˆ†ä¸ºå¯»é“æ—¶é—´ã€æ—‹è½¬å»¶è¿Ÿã€ä¼ è¾“æ—¶é—´ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå¯»é“æ—¶é—´æŒ‡çš„æ˜¯ç£è‡‚ç§»åŠ¨åˆ°æŒ‡å®šç£é“æ‰€éœ€è¦çš„æ—¶é—´ï¼Œä¸»æµç£ç›˜ä¸€èˆ¬åœ¨5msä»¥ä¸‹ï¼›æ—‹è½¬å»¶è¿Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸å¬è¯´çš„ç£ç›˜è½¬é€Ÿï¼Œæ¯”å¦‚ä¸€ä¸ªç£ç›˜7200è½¬ï¼Œè¡¨ç¤ºæ¯åˆ†é’Ÿèƒ½è½¬7200æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´1ç§’é’Ÿèƒ½è½¬120æ¬¡ï¼Œæ—‹è½¬å»¶è¿Ÿå°±æ˜¯1/120/2 = 4.17msï¼›ä¼ è¾“æ—¶é—´æŒ‡çš„æ˜¯ä»ç£ç›˜è¯»å‡ºæˆ–å°†æ•°æ®å†™å…¥ç£ç›˜çš„æ—¶é—´ï¼Œä¸€èˆ¬åœ¨é›¶ç‚¹å‡ æ¯«ç§’ï¼Œç›¸å¯¹äºå‰ä¸¤ä¸ªæ—¶é—´å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚é‚£ä¹ˆè®¿é—®ä¸€æ¬¡ç£ç›˜çš„æ—¶é—´ï¼Œå³ä¸€æ¬¡ç£ç›˜IOçš„æ—¶é—´çº¦ç­‰äº5+4.17 = 9mså·¦å³ï¼Œå¬èµ·æ¥è¿˜æŒºä¸é”™çš„ï¼Œä½†è¦çŸ¥é“ä¸€å°500 -MIPSçš„æœºå™¨æ¯ç§’å¯ä»¥æ‰§è¡Œ5äº¿æ¡æŒ‡ä»¤ï¼Œå› ä¸ºæŒ‡ä»¤ä¾é çš„æ˜¯ç”µçš„æ€§è´¨ï¼Œæ¢å¥è¯è¯´æ‰§è¡Œä¸€æ¬¡IOçš„æ—¶é—´å¯ä»¥æ‰§è¡Œ40ä¸‡æ¡æŒ‡ä»¤ï¼Œæ•°æ®åº“åŠ¨è¾„åä¸‡ç™¾ä¸‡ä¹ƒè‡³åƒä¸‡çº§æ•°æ®ï¼Œæ¯æ¬¡9æ¯«ç§’çš„æ—¶é—´ï¼Œæ˜¾ç„¶æ˜¯ä¸ªç¾éš¾ã€‚ä¸‹å›¾æ˜¯è®¡ç®—æœºç¡¬ä»¶å»¶è¿Ÿçš„å¯¹æ¯”å›¾ï¼Œä¾›å¤§å®¶å‚è€ƒï¼švarious-system-software-hardware-latenciesè€ƒè™‘åˆ°ç£ç›˜IOæ˜¯éå¸¸é«˜æ˜‚çš„æ“ä½œï¼Œè®¡ç®—æœºæ“ä½œç³»ç»Ÿåšäº†ä¸€äº›ä¼˜åŒ–ï¼Œå½“ä¸€æ¬¡IOæ—¶ï¼Œä¸å…‰æŠŠå½“å‰ç£ç›˜åœ°å€çš„æ•°æ®ï¼Œè€Œæ˜¯æŠŠç›¸é‚»çš„æ•°æ®ä¹Ÿéƒ½è¯»å–åˆ°å†…å­˜ç¼“å†²åŒºå†…ï¼Œå› ä¸ºå±€éƒ¨é¢„è¯»æ€§åŸç†å‘Šè¯‰æˆ‘ä»¬ï¼Œå½“è®¡ç®—æœºè®¿é—®ä¸€ä¸ªåœ°å€çš„æ•°æ®çš„æ—¶å€™ï¼Œä¸å…¶ç›¸é‚»çš„æ•°æ®ä¹Ÿä¼šå¾ˆå¿«è¢«è®¿é—®åˆ°ã€‚æ¯ä¸€æ¬¡IOè¯»å–çš„æ•°æ®æˆ‘ä»¬ç§°ä¹‹ä¸ºä¸€é¡µ(page)ã€‚å…·ä½“ä¸€é¡µæœ‰å¤šå¤§æ•°æ®è·Ÿæ“ä½œç³»ç»Ÿæœ‰å…³ï¼Œä¸€èˆ¬ä¸º4kæˆ–8kï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯»å–ä¸€é¡µå†…çš„æ•°æ®æ—¶å€™ï¼Œå®é™…ä¸Šæ‰å‘ç”Ÿäº†ä¸€æ¬¡IOï¼Œè¿™ä¸ªç†è®ºå¯¹äºç´¢å¼•çš„æ•°æ®ç»“æ„è®¾è®¡éå¸¸æœ‰å¸®åŠ©ã€‚ç´¢å¼•çš„æ•°æ®ç»“æ„å‰é¢è®²äº†ç”Ÿæ´»ä¸­ç´¢å¼•çš„ä¾‹å­ï¼Œç´¢å¼•çš„åŸºæœ¬åŸç†ï¼Œæ•°æ®åº“çš„å¤æ‚æ€§ï¼Œåˆè®²äº†æ“ä½œç³»ç»Ÿçš„ç›¸å…³çŸ¥è¯†ï¼Œç›®çš„å°±æ˜¯è®©å¤§å®¶äº†è§£ï¼Œä»»ä½•ä¸€ç§æ•°æ®ç»“æ„éƒ½ä¸æ˜¯å‡­ç©ºäº§ç”Ÿçš„ï¼Œä¸€å®šä¼šæœ‰å®ƒçš„èƒŒæ™¯å’Œä½¿ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬ç°åœ¨æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è¿™ç§æ•°æ®ç»“æ„èƒ½å¤Ÿåšäº›ä»€ä¹ˆï¼Œå…¶å®å¾ˆç®€å•ï¼Œé‚£å°±æ˜¯ï¼šæ¯æ¬¡æŸ¥æ‰¾æ•°æ®æ—¶æŠŠç£ç›˜IOæ¬¡æ•°æ§åˆ¶åœ¨ä¸€ä¸ªå¾ˆå°çš„æ•°é‡çº§ï¼Œæœ€å¥½æ˜¯å¸¸æ•°æ•°é‡çº§ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±æƒ³åˆ°å¦‚æœä¸€ä¸ªé«˜åº¦å¯æ§çš„å¤šè·¯æœç´¢æ ‘æ˜¯å¦èƒ½æ»¡è¶³éœ€æ±‚å‘¢ï¼Ÿå°±è¿™æ ·ï¼Œb+æ ‘åº”è¿è€Œç”Ÿã€‚è¯¦è§£b+æ ‘b+æ ‘å¦‚ä¸Šå›¾ï¼Œæ˜¯ä¸€é¢—b+æ ‘ï¼Œå…³äºb+æ ‘çš„å®šä¹‰å¯ä»¥å‚è§B+æ ‘ï¼Œè¿™é‡Œåªè¯´ä¸€äº›é‡ç‚¹ï¼Œæµ…è“è‰²çš„å—æˆ‘ä»¬ç§°ä¹‹ä¸ºä¸€ä¸ªç£ç›˜å—ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªç£ç›˜å—åŒ…å«å‡ ä¸ªæ•°æ®é¡¹ï¼ˆæ·±è“è‰²æ‰€ç¤ºï¼‰å’ŒæŒ‡é’ˆï¼ˆé»„è‰²æ‰€ç¤ºï¼‰ï¼Œå¦‚ç£ç›˜å—1åŒ…å«æ•°æ®é¡¹17å’Œ35ï¼ŒåŒ…å«æŒ‡é’ˆP1ã€P2ã€P3ï¼ŒP1è¡¨ç¤ºå°äº17çš„ç£ç›˜å—ï¼ŒP2è¡¨ç¤ºåœ¨17å’Œ35ä¹‹é—´çš„ç£ç›˜å—ï¼ŒP3è¡¨ç¤ºå¤§äº35çš„ç£ç›˜å—ã€‚çœŸå®çš„æ•°æ®å­˜åœ¨äºå¶å­èŠ‚ç‚¹å³3ã€5ã€9ã€10ã€13ã€15ã€28ã€29ã€36ã€60ã€75ã€79ã€90ã€99ã€‚éå¶å­èŠ‚ç‚¹åªä¸å­˜å‚¨çœŸå®çš„æ•°æ®ï¼Œåªå­˜å‚¨æŒ‡å¼•æœç´¢æ–¹å‘çš„æ•°æ®é¡¹ï¼Œå¦‚17ã€35å¹¶ä¸çœŸå®å­˜åœ¨äºæ•°æ®è¡¨ä¸­ã€‚b+æ ‘çš„æŸ¥æ‰¾è¿‡ç¨‹å¦‚å›¾æ‰€ç¤ºï¼Œå¦‚æœè¦æŸ¥æ‰¾æ•°æ®é¡¹29ï¼Œé‚£ä¹ˆé¦–å…ˆä¼šæŠŠç£ç›˜å—1ç”±ç£ç›˜åŠ è½½åˆ°å†…å­˜ï¼Œæ­¤æ—¶å‘ç”Ÿä¸€æ¬¡IOï¼Œåœ¨å†…å­˜ä¸­ç”¨äºŒåˆ†æŸ¥æ‰¾ç¡®å®š29åœ¨17å’Œ35ä¹‹é—´ï¼Œé”å®šç£ç›˜å—1çš„P2æŒ‡é’ˆï¼Œå†…å­˜æ—¶é—´å› ä¸ºéå¸¸çŸ­ï¼ˆç›¸æ¯”ç£ç›˜çš„IOï¼‰å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œé€šè¿‡ç£ç›˜å—1çš„P2æŒ‡é’ˆçš„ç£ç›˜åœ°å€æŠŠç£ç›˜å—3ç”±ç£ç›˜åŠ è½½åˆ°å†…å­˜ï¼Œå‘ç”Ÿç¬¬äºŒæ¬¡IOï¼Œ29åœ¨26å’Œ30ä¹‹é—´ï¼Œé”å®šç£ç›˜å—3çš„P2æŒ‡é’ˆï¼Œé€šè¿‡æŒ‡é’ˆåŠ è½½ç£ç›˜å—8åˆ°å†…å­˜ï¼Œå‘ç”Ÿç¬¬ä¸‰æ¬¡IOï¼ŒåŒæ—¶å†…å­˜ä¸­åšäºŒåˆ†æŸ¥æ‰¾æ‰¾åˆ°29ï¼Œç»“æŸæŸ¥è¯¢ï¼Œæ€»è®¡ä¸‰æ¬¡IOã€‚çœŸå®çš„æƒ…å†µæ˜¯ï¼Œ3å±‚çš„b+æ ‘å¯ä»¥è¡¨ç¤ºä¸Šç™¾ä¸‡çš„æ•°æ®ï¼Œå¦‚æœä¸Šç™¾ä¸‡çš„æ•°æ®æŸ¥æ‰¾åªéœ€è¦ä¸‰æ¬¡IOï¼Œæ€§èƒ½æé«˜å°†æ˜¯å·¨å¤§çš„ï¼Œå¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œæ¯ä¸ªæ•°æ®é¡¹éƒ½è¦å‘ç”Ÿä¸€æ¬¡IOï¼Œé‚£ä¹ˆæ€»å…±éœ€è¦ç™¾ä¸‡æ¬¡çš„IOï¼Œæ˜¾ç„¶æˆæœ¬éå¸¸éå¸¸é«˜ã€‚b+æ ‘æ€§è´¨1.é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“IOæ¬¡æ•°å–å†³äºb+æ•°çš„é«˜åº¦hï¼Œå‡è®¾å½“å‰æ•°æ®è¡¨çš„æ•°æ®ä¸ºNï¼Œæ¯ä¸ªç£ç›˜å—çš„æ•°æ®é¡¹çš„æ•°é‡æ˜¯mï¼Œåˆ™æœ‰h=ã’(m+1)Nï¼Œå½“æ•°æ®é‡Nä¸€å®šçš„æƒ…å†µä¸‹ï¼Œmè¶Šå¤§ï¼Œhè¶Šå°ï¼›è€Œm = ç£ç›˜å—çš„å¤§å° / æ•°æ®é¡¹çš„å¤§å°ï¼Œç£ç›˜å—çš„å¤§å°ä¹Ÿå°±æ˜¯ä¸€ä¸ªæ•°æ®é¡µçš„å¤§å°ï¼Œæ˜¯å›ºå®šçš„ï¼Œå¦‚æœæ•°æ®é¡¹å çš„ç©ºé—´è¶Šå°ï¼Œæ•°æ®é¡¹çš„æ•°é‡è¶Šå¤šï¼Œæ ‘çš„é«˜åº¦è¶Šä½ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¯ä¸ªæ•°æ®é¡¹ï¼Œå³ç´¢å¼•å­—æ®µè¦å°½é‡çš„å°ï¼Œæ¯”å¦‚intå 4å­—èŠ‚ï¼Œè¦æ¯”bigint8å­—èŠ‚å°‘ä¸€åŠã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆb+æ ‘è¦æ±‚æŠŠçœŸå®çš„æ•°æ®æ”¾åˆ°å¶å­èŠ‚ç‚¹è€Œä¸æ˜¯å†…å±‚èŠ‚ç‚¹ï¼Œä¸€æ—¦æ”¾åˆ°å†…å±‚èŠ‚ç‚¹ï¼Œç£ç›˜å—çš„æ•°æ®é¡¹ä¼šå¤§å¹…åº¦ä¸‹é™ï¼Œå¯¼è‡´æ ‘å¢é«˜ã€‚å½“æ•°æ®é¡¹ç­‰äº1æ—¶å°†ä¼šé€€åŒ–æˆçº¿æ€§è¡¨ã€‚2.å½“b+æ ‘çš„æ•°æ®é¡¹æ˜¯å¤åˆçš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚(name,age,sex)çš„æ—¶å€™ï¼Œb+æ•°æ˜¯æŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºæ¥å»ºç«‹æœç´¢æ ‘çš„ï¼Œæ¯”å¦‚å½“(å¼ ä¸‰,20,F)è¿™æ ·çš„æ•°æ®æ¥æ£€ç´¢çš„æ—¶å€™ï¼Œb+æ ‘ä¼šä¼˜å…ˆæ¯”è¾ƒnameæ¥ç¡®å®šä¸‹ä¸€æ­¥çš„æ‰€æœæ–¹å‘ï¼Œå¦‚æœnameç›¸åŒå†ä¾æ¬¡æ¯”è¾ƒageå’Œsexï¼Œæœ€åå¾—åˆ°æ£€ç´¢çš„æ•°æ®ï¼›ä½†å½“(20,F)è¿™æ ·çš„æ²¡æœ‰nameçš„æ•°æ®æ¥çš„æ—¶å€™ï¼Œb+æ ‘å°±ä¸çŸ¥é“ä¸‹ä¸€æ­¥è¯¥æŸ¥å“ªä¸ªèŠ‚ç‚¹ï¼Œå› ä¸ºå»ºç«‹æœç´¢æ ‘çš„æ—¶å€™nameå°±æ˜¯ç¬¬ä¸€ä¸ªæ¯”è¾ƒå› å­ï¼Œå¿…é¡»è¦å…ˆæ ¹æ®nameæ¥æœç´¢æ‰èƒ½çŸ¥é“ä¸‹ä¸€æ­¥å»å“ªé‡ŒæŸ¥è¯¢ã€‚æ¯”å¦‚å½“(å¼ ä¸‰,F)è¿™æ ·çš„æ•°æ®æ¥æ£€ç´¢æ—¶ï¼Œb+æ ‘å¯ä»¥ç”¨nameæ¥æŒ‡å®šæœç´¢æ–¹å‘ï¼Œä½†ä¸‹ä¸€ä¸ªå­—æ®µageçš„ç¼ºå¤±ï¼Œæ‰€ä»¥åªèƒ½æŠŠåå­—ç­‰äºå¼ ä¸‰çš„æ•°æ®éƒ½æ‰¾åˆ°ï¼Œç„¶åå†åŒ¹é…æ€§åˆ«æ˜¯Fçš„æ•°æ®äº†ï¼Œ è¿™ä¸ªæ˜¯éå¸¸é‡è¦çš„æ€§è´¨ï¼Œå³ç´¢å¼•çš„æœ€å·¦åŒ¹é…ç‰¹æ€§ã€‚æ…¢æŸ¥è¯¢ä¼˜åŒ–å…³äºMySQLç´¢å¼•åŸç†æ˜¯æ¯”è¾ƒæ¯ç‡¥çš„ä¸œè¥¿ï¼Œå¤§å®¶åªéœ€è¦æœ‰ä¸€ä¸ªæ„Ÿæ€§çš„è®¤è¯†ï¼Œå¹¶ä¸éœ€è¦ç†è§£å¾—éå¸¸é€å½»å’Œæ·±å…¥ã€‚æˆ‘ä»¬å›å¤´æ¥çœ‹çœ‹ä¸€å¼€å§‹æˆ‘ä»¬è¯´çš„æ…¢æŸ¥è¯¢ï¼Œäº†è§£å®Œç´¢å¼•åŸç†ä¹‹åï¼Œå¤§å®¶æ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆæƒ³æ³•å‘¢ï¼Ÿå…ˆæ€»ç»“ä¸€ä¸‹ç´¢å¼•çš„å‡ å¤§åŸºæœ¬åŸåˆ™ï¼šå»ºç´¢å¼•çš„å‡ å¤§åŸåˆ™1.æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Œéå¸¸é‡è¦çš„åŸåˆ™ï¼Œmysqlä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢(&gt;ã€&lt;ã€betweenã€like)å°±åœæ­¢åŒ¹é…ï¼Œæ¯”å¦‚a = 1 and b = 2 and c &gt; 3 and d = 4 å¦‚æœå»ºç«‹(a,b,c,d)é¡ºåºçš„ç´¢å¼•ï¼Œdæ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„ï¼Œå¦‚æœå»ºç«‹(a,b,d,c)çš„ç´¢å¼•åˆ™éƒ½å¯ä»¥ç”¨åˆ°ï¼Œa,b,dçš„é¡ºåºå¯ä»¥ä»»æ„è°ƒæ•´ã€‚2.=å’Œinå¯ä»¥ä¹±åºï¼Œæ¯”å¦‚a = 1 and b = 2 and c = 3 å»ºç«‹(a,b,c)ç´¢å¼•å¯ä»¥ä»»æ„é¡ºåºï¼Œmysqlçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šå¸®ä½ ä¼˜åŒ–æˆç´¢å¼•å¯ä»¥è¯†åˆ«çš„å½¢å¼ã€‚3.å°½é‡é€‰æ‹©åŒºåˆ†åº¦é«˜çš„åˆ—ä½œä¸ºç´¢å¼•ï¼ŒåŒºåˆ†åº¦çš„å…¬å¼æ˜¯count(distinct col)/count(*)ï¼Œè¡¨ç¤ºå­—æ®µä¸é‡å¤çš„æ¯”ä¾‹ï¼Œæ¯”ä¾‹è¶Šå¤§æˆ‘ä»¬æ‰«æçš„è®°å½•æ•°è¶Šå°‘ï¼Œå”¯ä¸€é”®çš„åŒºåˆ†åº¦æ˜¯1ï¼Œè€Œä¸€äº›çŠ¶æ€ã€æ€§åˆ«å­—æ®µå¯èƒ½åœ¨å¤§æ•°æ®é¢å‰åŒºåˆ†åº¦å°±æ˜¯0ï¼Œé‚£å¯èƒ½æœ‰äººä¼šé—®ï¼Œè¿™ä¸ªæ¯”ä¾‹æœ‰ä»€ä¹ˆç»éªŒå€¼å—ï¼Ÿä½¿ç”¨åœºæ™¯ä¸åŒï¼Œè¿™ä¸ªå€¼ä¹Ÿå¾ˆéš¾ç¡®å®šï¼Œä¸€èˆ¬éœ€è¦joinçš„å­—æ®µæˆ‘ä»¬éƒ½è¦æ±‚æ˜¯0.1ä»¥ä¸Šï¼Œå³å¹³å‡1æ¡æ‰«æ10æ¡è®°å½•ã€‚4.ç´¢å¼•åˆ—ä¸èƒ½å‚ä¸è®¡ç®—ï¼Œä¿æŒåˆ—â€œå¹²å‡€â€ï¼Œæ¯”å¦‚from_unixtime(create_time) = â€™2014-05-29â€™å°±ä¸èƒ½ä½¿ç”¨åˆ°ç´¢å¼•ï¼ŒåŸå› å¾ˆç®€å•ï¼Œb+æ ‘ä¸­å­˜çš„éƒ½æ˜¯æ•°æ®è¡¨ä¸­çš„å­—æ®µå€¼ï¼Œä½†è¿›è¡Œæ£€ç´¢æ—¶ï¼Œéœ€è¦æŠŠæ‰€æœ‰å…ƒç´ éƒ½åº”ç”¨å‡½æ•°æ‰èƒ½æ¯”è¾ƒï¼Œæ˜¾ç„¶æˆæœ¬å¤ªå¤§ã€‚æ‰€ä»¥è¯­å¥åº”è¯¥å†™æˆcreate_time = unix_timestamp(â€™2014-05-29â€™)ã€‚5.å°½é‡çš„æ‰©å±•ç´¢å¼•ï¼Œä¸è¦æ–°å»ºç´¢å¼•ã€‚æ¯”å¦‚è¡¨ä¸­å·²ç»æœ‰açš„ç´¢å¼•ï¼Œç°åœ¨è¦åŠ (a,b)çš„ç´¢å¼•ï¼Œé‚£ä¹ˆåªéœ€è¦ä¿®æ”¹åŸæ¥çš„ç´¢å¼•å³å¯ã€‚å›åˆ°å¼€å§‹çš„æ…¢æŸ¥è¯¢æ ¹æ®æœ€å·¦åŒ¹é…åŸåˆ™ï¼Œæœ€å¼€å§‹çš„sqlè¯­å¥çš„ç´¢å¼•åº”è¯¥æ˜¯statusã€operator_idã€typeã€operate_timeçš„è”åˆç´¢å¼•ï¼›å…¶ä¸­statusã€operator_idã€typeçš„é¡ºåºå¯ä»¥é¢ å€’ï¼Œæ‰€ä»¥æˆ‘æ‰ä¼šè¯´ï¼ŒæŠŠè¿™ä¸ªè¡¨çš„æ‰€æœ‰ç›¸å…³æŸ¥è¯¢éƒ½æ‰¾åˆ°ï¼Œä¼šç»¼åˆåˆ†æï¼›æ¯”å¦‚è¿˜æœ‰å¦‚ä¸‹æŸ¥è¯¢ï¼š1select * from task where status &#x3D; 0 and type &#x3D; 12 limit 10;1select count(*) from task where status &#x3D; 0 ;é‚£ä¹ˆç´¢å¼•å»ºç«‹æˆ(status,type,operator_id,operate_time)å°±æ˜¯éå¸¸æ­£ç¡®çš„ï¼Œå› ä¸ºå¯ä»¥è¦†ç›–åˆ°æ‰€æœ‰æƒ…å†µã€‚è¿™ä¸ªå°±æ˜¯åˆ©ç”¨äº†ç´¢å¼•çš„æœ€å·¦åŒ¹é…çš„åŸåˆ™æŸ¥è¯¢ä¼˜åŒ–ç¥å™¨ - explainå‘½ä»¤å…³äºexplainå‘½ä»¤ç›¸ä¿¡å¤§å®¶å¹¶ä¸é™Œç”Ÿï¼Œå…·ä½“ç”¨æ³•å’Œå­—æ®µå«ä¹‰å¯ä»¥å‚è€ƒå®˜ç½‘explain-outputï¼Œè¿™é‡Œéœ€è¦å¼ºè°ƒrowsæ˜¯æ ¸å¿ƒæŒ‡æ ‡ï¼Œç»å¤§éƒ¨åˆ†rowså°çš„è¯­å¥æ‰§è¡Œä¸€å®šå¾ˆå¿«ï¼ˆæœ‰ä¾‹å¤–ï¼Œä¸‹é¢ä¼šè®²åˆ°ï¼‰ã€‚æ‰€ä»¥ä¼˜åŒ–è¯­å¥åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨ä¼˜åŒ–rowsã€‚æ…¢æŸ¥è¯¢ä¼˜åŒ–åŸºæœ¬æ­¥éª¤0.å…ˆè¿è¡Œçœ‹çœ‹æ˜¯å¦çœŸçš„å¾ˆæ…¢ï¼Œæ³¨æ„è®¾ç½®SQL_NO_CACHE1.whereæ¡ä»¶å•è¡¨æŸ¥ï¼Œé”å®šæœ€å°è¿”å›è®°å½•è¡¨ã€‚è¿™å¥è¯çš„æ„æ€æ˜¯æŠŠæŸ¥è¯¢è¯­å¥çš„whereéƒ½åº”ç”¨åˆ°è¡¨ä¸­è¿”å›çš„è®°å½•æ•°æœ€å°çš„è¡¨å¼€å§‹æŸ¥èµ·ï¼Œå•è¡¨æ¯ä¸ªå­—æ®µåˆ†åˆ«æŸ¥è¯¢ï¼Œçœ‹å“ªä¸ªå­—æ®µçš„åŒºåˆ†åº¦æœ€é«˜2.explainæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œæ˜¯å¦ä¸1é¢„æœŸä¸€è‡´ï¼ˆä»é”å®šè®°å½•è¾ƒå°‘çš„è¡¨å¼€å§‹æŸ¥è¯¢ï¼‰3.order by limit å½¢å¼çš„sqlè¯­å¥è®©æ’åºçš„è¡¨ä¼˜å…ˆæŸ¥4.äº†è§£ä¸šåŠ¡æ–¹ä½¿ç”¨åœºæ™¯5.åŠ ç´¢å¼•æ—¶å‚ç…§å»ºç´¢å¼•çš„å‡ å¤§åŸåˆ™6.è§‚å¯Ÿç»“æœï¼Œä¸ç¬¦åˆé¢„æœŸç»§ç»­ä»0åˆ†æå‡ ä¸ªæ…¢æŸ¥è¯¢æ¡ˆä¾‹ä¸‹é¢å‡ ä¸ªä¾‹å­è¯¦ç»†è§£é‡Šäº†å¦‚ä½•åˆ†æå’Œä¼˜åŒ–æ…¢æŸ¥è¯¢ã€‚å¤æ‚è¯­å¥å†™æ³•å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å†™SQLåªæ˜¯ä¸ºäº†å®ç°åŠŸèƒ½ï¼Œè¿™åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œä¸åŒçš„è¯­å¥ä¹¦å†™æ–¹å¼å¯¹äºæ•ˆç‡å¾€å¾€æœ‰æœ¬è´¨çš„å·®åˆ«ï¼Œè¿™è¦æ±‚æˆ‘ä»¬å¯¹mysqlçš„æ‰§è¡Œè®¡åˆ’å’Œç´¢å¼•åŸåˆ™æœ‰éå¸¸æ¸…æ¥šçš„è®¤è¯†ï¼Œè¯·çœ‹ä¸‹é¢çš„è¯­å¥ï¼š12345678910111213141516171819202122232425262728select distinct cert.emp_id from cm_log cl inner join ( select emp.id as emp_id, emp_cert.id as cert_id from employee emp left join emp_certificate emp_cert on emp.id &#x3D; emp_cert.emp_id where emp.is_deleted&#x3D;0 ) cert on ( cl.ref_table&#x3D;&#39;Employee&#39; and cl.ref_oid&#x3D; cert.emp_id ) or ( cl.ref_table&#x3D;&#39;EmpCertificate&#39; and cl.ref_oid&#x3D; cert.cert_id ) where cl.last_upd_date &gt;&#x3D;&#39;2013-11-07 15:03:00&#39; and cl.last_upd_date&lt;&#x3D;&#39;2013-11-08 16:00:00&#39;;0.å…ˆè¿è¡Œä¸€ä¸‹ï¼Œ53æ¡è®°å½• 1.87ç§’ï¼Œåˆæ²¡æœ‰ç”¨èšåˆè¯­å¥ï¼Œæ¯”è¾ƒæ…¢153 rows in set (1.87 sec)1.explain12345678+----+-------------+------------+-------+---------------------------------+-----------------------+---------+-------------------+-------+--------------------------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+------------+-------+---------------------------------+-----------------------+---------+-------------------+-------+--------------------------------+| 1 | PRIMARY | cl | range | cm_log_cls_id,idx_last_upd_date | idx_last_upd_date | 8 | NULL | 379 | Using where; Using temporary || 1 | PRIMARY | &lt;derived2&gt; | ALL | NULL | NULL | NULL | NULL | 63727 | Using where; Using join buffer || 2 | DERIVED | emp | ALL | NULL | NULL | NULL | NULL | 13317 | Using where || 2 | DERIVED | emp_cert | ref | emp_certificate_empid | emp_certificate_empid | 4 | meituanorg.emp.id | 1 | Using index |+----+-------------+------------+-------+---------------------------------+-----------------------+---------+-------------------+-------+--------------------------------+ç®€è¿°ä¸€ä¸‹æ‰§è¡Œè®¡åˆ’ï¼Œé¦–å…ˆmysqlæ ¹æ®idx_last_upd_dateç´¢å¼•æ‰«æcm_logè¡¨è·å¾—379æ¡è®°å½•ï¼›ç„¶åæŸ¥è¡¨æ‰«æäº†63727æ¡è®°å½•ï¼Œåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œderivedè¡¨ç¤ºæ„é€ è¡¨ï¼Œä¹Ÿå°±æ˜¯ä¸å­˜åœ¨çš„è¡¨ï¼Œå¯ä»¥ç®€å•ç†è§£æˆæ˜¯ä¸€ä¸ªè¯­å¥å½¢æˆçš„ç»“æœé›†ï¼Œåé¢çš„æ•°å­—è¡¨ç¤ºè¯­å¥çš„IDã€‚derived2è¡¨ç¤ºçš„æ˜¯ID = 2çš„æŸ¥è¯¢æ„é€ äº†è™šæ‹Ÿè¡¨ï¼Œå¹¶ä¸”è¿”å›äº†63727æ¡è®°å½•ã€‚æˆ‘ä»¬å†æ¥çœ‹çœ‹ID = 2çš„è¯­å¥ç©¶ç«Ÿåšäº†å†™ä»€ä¹ˆè¿”å›äº†è¿™ä¹ˆå¤§é‡çš„æ•°æ®ï¼Œé¦–å…ˆå…¨è¡¨æ‰«æemployeeè¡¨13317æ¡è®°å½•ï¼Œç„¶åæ ¹æ®ç´¢å¼•emp_certificate_empidå…³è”emp_certificateè¡¨ï¼Œrows = 1è¡¨ç¤ºï¼Œæ¯ä¸ªå…³è”éƒ½åªé”å®šäº†ä¸€æ¡è®°å½•ï¼Œæ•ˆç‡æ¯”è¾ƒé«˜ã€‚è·å¾—åï¼Œå†å’Œcm_logçš„379æ¡è®°å½•æ ¹æ®è§„åˆ™å…³è”ã€‚ä»æ‰§è¡Œè¿‡ç¨‹ä¸Šå¯ä»¥çœ‹å‡ºè¿”å›äº†å¤ªå¤šçš„æ•°æ®ï¼Œè¿”å›çš„æ•°æ®ç»å¤§éƒ¨åˆ†cm_logéƒ½ç”¨ä¸åˆ°ï¼Œå› ä¸ºcm_logåªé”å®šäº†379æ¡è®°å½•ã€‚å¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨è¿è¡Œå®Œåè¿˜æ˜¯è¦å’Œcm_logåšjoin,é‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½ä¹‹å‰å’Œcm_logåšjoinå‘¢ï¼Ÿä»”ç»†åˆ†æè¯­å¥ä¸éš¾å‘ç°ï¼Œå…¶åŸºæœ¬æ€æƒ³æ˜¯å¦‚æœcm_logçš„ref_tableæ˜¯EmpCertificateå°±å…³è”emp_certificateè¡¨ï¼Œå¦‚æœref_tableæ˜¯Employeeå°±å…³è”employeeè¡¨ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æ‹†æˆä¸¤éƒ¨åˆ†ï¼Œå¹¶ç”¨unionè¿æ¥èµ·æ¥ï¼Œæ³¨æ„è¿™é‡Œç”¨unionï¼Œè€Œä¸ç”¨union allæ˜¯å› ä¸ºåŸè¯­å¥æœ‰â€œdistinctâ€æ¥å¾—åˆ°å”¯ä¸€çš„è®°å½•ï¼Œè€Œunionæ°å¥½å…·å¤‡äº†è¿™ç§åŠŸèƒ½ã€‚å¦‚æœåŸè¯­å¥ä¸­æ²¡æœ‰distinctä¸éœ€è¦å»é‡ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨union alläº†ï¼Œå› ä¸ºä½¿ç”¨unionéœ€è¦å»é‡çš„åŠ¨ä½œï¼Œä¼šå½±å“SQLæ€§èƒ½ã€‚ä¼˜åŒ–è¿‡çš„è¯­å¥å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728select emp.id from cm_log cl inner join employee emp on cl.ref_table &#x3D; &#39;Employee&#39; and cl.ref_oid &#x3D; emp.id where cl.last_upd_date &gt;&#x3D;&#39;2013-11-07 15:03:00&#39; and cl.last_upd_date&lt;&#x3D;&#39;2013-11-08 16:00:00&#39; and emp.is_deleted &#x3D; 0 unionselect emp.id from cm_log cl inner join emp_certificate ec on cl.ref_table &#x3D; &#39;EmpCertificate&#39; and cl.ref_oid &#x3D; ec.id inner join employee emp on emp.id &#x3D; ec.emp_id where cl.last_upd_date &gt;&#x3D;&#39;2013-11-07 15:03:00&#39; and cl.last_upd_date&lt;&#x3D;&#39;2013-11-08 16:00:00&#39; and emp.is_deleted &#x3D; 04.ä¸éœ€è¦äº†è§£ä¸šåŠ¡åœºæ™¯ï¼Œåªéœ€è¦æ”¹é€ çš„è¯­å¥å’Œæ”¹é€ ä¹‹å‰çš„è¯­å¥ä¿æŒç»“æœä¸€è‡´5.ç°æœ‰ç´¢å¼•å¯ä»¥æ»¡è¶³ï¼Œä¸éœ€è¦å»ºç´¢å¼•6.ç”¨æ”¹é€ åçš„è¯­å¥å®éªŒä¸€ä¸‹ï¼Œåªéœ€è¦10ms é™ä½äº†è¿‘200å€ï¼1234567891011+----+--------------+------------+--------+---------------------------------+-------------------+---------+-----------------------+------+-------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+--------------+------------+--------+---------------------------------+-------------------+---------+-----------------------+------+-------------+| 1 | PRIMARY | cl | range | cm_log_cls_id,idx_last_upd_date | idx_last_upd_date | 8 | NULL | 379 | Using where || 1 | PRIMARY | emp | eq_ref | PRIMARY | PRIMARY | 4 | meituanorg.cl.ref_oid | 1 | Using where || 2 | UNION | cl | range | cm_log_cls_id,idx_last_upd_date | idx_last_upd_date | 8 | NULL | 379 | Using where || 2 | UNION | ec | eq_ref | PRIMARY,emp_certificate_empid | PRIMARY | 4 | meituanorg.cl.ref_oid | 1 | || 2 | UNION | emp | eq_ref | PRIMARY | PRIMARY | 4 | meituanorg.ec.emp_id | 1 | Using where || NULL | UNION RESULT | &lt;union1,2&gt; | ALL | NULL | NULL | NULL | NULL | NULL | |+----+--------------+------------+--------+---------------------------------+-------------------+---------+-----------------------+------+-------------+53 rows in set (0.01 sec)æ˜ç¡®åº”ç”¨åœºæ™¯ä¸¾è¿™ä¸ªä¾‹å­çš„ç›®çš„åœ¨äºé¢ è¦†æˆ‘ä»¬å¯¹åˆ—çš„åŒºåˆ†åº¦çš„è®¤çŸ¥ï¼Œä¸€èˆ¬ä¸Šæˆ‘ä»¬è®¤ä¸ºåŒºåˆ†åº¦è¶Šé«˜çš„åˆ—ï¼Œè¶Šå®¹æ˜“é”å®šæ›´å°‘çš„è®°å½•ï¼Œä½†åœ¨ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼Œè¿™ç§ç†è®ºæ˜¯æœ‰å±€é™æ€§çš„ã€‚1234567891011select * from stage_poi sp where sp.accurate_result&#x3D;1 and ( sp.sync_status&#x3D;0 or sp.sync_status&#x3D;2 or sp.sync_status&#x3D;4 );0.å…ˆçœ‹çœ‹è¿è¡Œå¤šé•¿æ—¶é—´,951æ¡æ•°æ®6.22ç§’ï¼ŒçœŸçš„å¾ˆæ…¢ã€‚1951 rows in set (6.22 sec)1.å…ˆexplainï¼Œrowsè¾¾åˆ°äº†361ä¸‡ï¼Œtype = ALLè¡¨æ˜æ˜¯å…¨è¡¨æ‰«æã€‚12345+----+-------------+-------+------+---------------+------+---------+------+---------+-------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-------+------+---------------+------+---------+------+---------+-------------+| 1 | SIMPLE | sp | ALL | NULL | NULL | NULL | NULL | 3613155 | Using where |+----+-------------+-------+------+---------------+------+---------+------+---------+-------------+2.æ‰€æœ‰å­—æ®µéƒ½åº”ç”¨æŸ¥è¯¢è¿”å›è®°å½•æ•°ï¼Œå› ä¸ºæ˜¯å•è¡¨æŸ¥è¯¢ 0å·²ç»åšè¿‡äº†951æ¡ã€‚3.è®©explainçš„rows å°½é‡é€¼è¿‘951ã€‚çœ‹ä¸€ä¸‹accurate_result = 1çš„è®°å½•æ•°ï¼š12345678select count(*),accurate_result from stage_poi group by accurate_result;+----------+-----------------+| count(*) | accurate_result |+----------+-----------------+| 1023 | -1 || 2114655 | 0 || 972815 | 1 |+----------+-----------------+æˆ‘ä»¬çœ‹åˆ°accurate_resultè¿™ä¸ªå­—æ®µçš„åŒºåˆ†åº¦éå¸¸ä½ï¼Œæ•´ä¸ªè¡¨åªæœ‰-1,0,1ä¸‰ä¸ªå€¼ï¼ŒåŠ ä¸Šç´¢å¼•ä¹Ÿæ— æ³•é”å®šç‰¹åˆ«å°‘é‡çš„æ•°æ®ã€‚å†çœ‹ä¸€ä¸‹sync_statuså­—æ®µçš„æƒ…å†µï¼š1234567select count(*),sync_status from stage_poi group by sync_status;+----------+-------------+| count(*) | sync_status |+----------+-------------+| 3080 | 0 || 3085413 | 3 |+----------+-------------+åŒæ ·çš„åŒºåˆ†åº¦ä¹Ÿå¾ˆä½ï¼Œæ ¹æ®ç†è®ºï¼Œä¹Ÿä¸é€‚åˆå»ºç«‹ç´¢å¼•ã€‚é—®é¢˜åˆ†æåˆ°è¿™ï¼Œå¥½åƒå¾—å‡ºäº†è¿™ä¸ªè¡¨æ— æ³•ä¼˜åŒ–çš„ç»“è®ºï¼Œä¸¤ä¸ªåˆ—çš„åŒºåˆ†åº¦éƒ½å¾ˆä½ï¼Œå³ä¾¿åŠ ä¸Šç´¢å¼•ä¹Ÿåªèƒ½é€‚åº”è¿™ç§æƒ…å†µï¼Œå¾ˆéš¾åšæ™®éæ€§çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚å½“sync_status 0ã€3åˆ†å¸ƒçš„å¾ˆå¹³å‡ï¼Œé‚£ä¹ˆé”å®šè®°å½•ä¹Ÿæ˜¯ç™¾ä¸‡çº§åˆ«çš„ã€‚4.æ‰¾ä¸šåŠ¡æ–¹å»æ²Ÿé€šï¼Œçœ‹çœ‹ä½¿ç”¨åœºæ™¯ã€‚ä¸šåŠ¡æ–¹æ˜¯è¿™ä¹ˆæ¥ä½¿ç”¨è¿™ä¸ªSQLè¯­å¥çš„ï¼Œæ¯éš”äº”åˆ†é’Ÿä¼šæ‰«æç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼Œå¤„ç†å®ŒæˆåæŠŠsync_statusè¿™ä¸ªå­—æ®µå˜æˆ1,äº”åˆ†é’Ÿç¬¦åˆæ¡ä»¶çš„è®°å½•æ•°å¹¶ä¸ä¼šå¤ªå¤šï¼Œ1000ä¸ªå·¦å³ã€‚äº†è§£äº†ä¸šåŠ¡æ–¹çš„ä½¿ç”¨åœºæ™¯åï¼Œä¼˜åŒ–è¿™ä¸ªSQLå°±å˜å¾—ç®€å•äº†ï¼Œå› ä¸ºä¸šåŠ¡æ–¹ä¿è¯äº†æ•°æ®çš„ä¸å¹³è¡¡ï¼Œå¦‚æœåŠ ä¸Šç´¢å¼•å¯ä»¥è¿‡æ»¤æ‰ç»å¤§éƒ¨åˆ†ä¸éœ€è¦çš„æ•°æ®ã€‚5.æ ¹æ®å»ºç«‹ç´¢å¼•è§„åˆ™ï¼Œä½¿ç”¨å¦‚ä¸‹è¯­å¥å»ºç«‹ç´¢å¼•1alter table stage_poi add index idx_acc_status(accurate_result,sync_status);6.è§‚å¯Ÿé¢„æœŸç»“æœ,å‘ç°åªéœ€è¦200msï¼Œå¿«äº†30å¤šå€ã€‚1952 rows in set (0.20 sec)æˆ‘ä»¬å†æ¥å›é¡¾ä¸€ä¸‹åˆ†æé—®é¢˜çš„è¿‡ç¨‹ï¼Œå•è¡¨æŸ¥è¯¢ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¥½ä¼˜åŒ–ï¼Œå¤§éƒ¨åˆ†æ—¶å€™åªéœ€è¦æŠŠwhereæ¡ä»¶é‡Œé¢çš„å­—æ®µä¾ç…§è§„åˆ™åŠ ä¸Šç´¢å¼•å°±å¥½ï¼Œå¦‚æœåªæ˜¯è¿™ç§â€œæ— è„‘â€ä¼˜åŒ–çš„è¯ï¼Œæ˜¾ç„¶ä¸€äº›åŒºåˆ†åº¦éå¸¸ä½çš„åˆ—ï¼Œä¸åº”è¯¥åŠ ç´¢å¼•çš„åˆ—ä¹Ÿä¼šè¢«åŠ ä¸Šç´¢å¼•ï¼Œè¿™æ ·ä¼šå¯¹æ’å…¥ã€æ›´æ–°æ€§èƒ½é€ æˆä¸¥é‡çš„å½±å“ï¼ŒåŒæ—¶ä¹Ÿæœ‰å¯èƒ½å½±å“å…¶å®ƒçš„æŸ¥è¯¢è¯­å¥ã€‚æ‰€ä»¥æˆ‘ä»¬ç¬¬4æ­¥è°ƒå·®SQLçš„ä½¿ç”¨åœºæ™¯éå¸¸å…³é”®ï¼Œæˆ‘ä»¬åªæœ‰çŸ¥é“è¿™ä¸ªä¸šåŠ¡åœºæ™¯ï¼Œæ‰èƒ½æ›´å¥½åœ°è¾…åŠ©æˆ‘ä»¬æ›´å¥½çš„åˆ†æå’Œä¼˜åŒ–æŸ¥è¯¢è¯­å¥ã€‚æ— æ³•ä¼˜åŒ–çš„è¯­å¥12345678910111213141516171819202122232425262728293031323334353637select c.id, c.name, c.position, c.sex, c.phone, c.office_phone, c.feature_info, c.birthday, c.creator_id, c.is_keyperson, c.giveup_reason, c.status, c.data_source, from_unixtime(c.created_time) as created_time, from_unixtime(c.last_modified) as last_modified, c.last_modified_user_id from contact c inner join contact_branch cb on c.id &#x3D; cb.contact_id inner join branch_user bu on cb.branch_id &#x3D; bu.branch_id and bu.status in ( 1, 2) inner join org_emp_info oei on oei.data_id &#x3D; bu.user_id and oei.node_left &gt;&#x3D; 2875 and oei.node_right &lt;&#x3D; 10802 and oei.org_category &#x3D; - 1 order by c.created_time desc limit 0 , 10;è¿˜æ˜¯å‡ ä¸ªæ­¥éª¤ã€‚0.å…ˆçœ‹è¯­å¥è¿è¡Œå¤šé•¿æ—¶é—´ï¼Œ10æ¡è®°å½•ç”¨äº†13ç§’ï¼Œå·²ç»ä¸å¯å¿å—ã€‚110 rows in set (13.06 sec)1.explain12345678+----+-------------+-------+--------+-------------------------------------+-------------------------+---------+--------------------------+------+----------------------------------------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-------+--------+-------------------------------------+-------------------------+---------+--------------------------+------+----------------------------------------------+| 1 | SIMPLE | oei | ref | idx_category_left_right,idx_data_id | idx_category_left_right | 5 | const | 8849 | Using where; Using temporary; Using filesort || 1 | SIMPLE | bu | ref | PRIMARY,idx_userid_status | idx_userid_status | 4 | meituancrm.oei.data_id | 76 | Using where; Using index || 1 | SIMPLE | cb | ref | idx_branch_id,idx_contact_branch_id | idx_branch_id | 4 | meituancrm.bu.branch_id | 1 | || 1 | SIMPLE | c | eq_ref | PRIMARY | PRIMARY | 108 | meituancrm.cb.contact_id | 1 | |+----+-------------+-------+--------+-------------------------------------+-------------------------+---------+--------------------------+------+----------------------------------------------+ä»æ‰§è¡Œè®¡åˆ’ä¸Šçœ‹ï¼Œmysqlå…ˆæŸ¥org_emp_infoè¡¨æ‰«æ8849è®°å½•ï¼Œå†ç”¨ç´¢å¼•idx_userid_statuså…³è”branch_userè¡¨ï¼Œå†ç”¨ç´¢å¼•idx_branch_idå…³è”contact_branchè¡¨ï¼Œæœ€åä¸»é”®å…³è”contactè¡¨ã€‚rowsè¿”å›çš„éƒ½éå¸¸å°‘ï¼Œçœ‹ä¸åˆ°æœ‰ä»€ä¹ˆå¼‚å¸¸æƒ…å†µã€‚æˆ‘ä»¬åœ¨çœ‹ä¸€ä¸‹è¯­å¥ï¼Œå‘ç°åé¢æœ‰order by + limitç»„åˆï¼Œä¼šä¸ä¼šæ˜¯æ’åºé‡å¤ªå¤§æçš„ï¼Ÿäºæ˜¯æˆ‘ä»¬ç®€åŒ–SQLï¼Œå»æ‰åé¢çš„order by å’Œ limitï¼Œçœ‹çœ‹åˆ°åº•ç”¨äº†å¤šå°‘è®°å½•æ¥æ’åºã€‚12345678910111213141516171819202122232425select count(*)from contact c inner join contact_branch cb on c.id &#x3D; cb.contact_id inner join branch_user bu on cb.branch_id &#x3D; bu.branch_id and bu.status in ( 1, 2) inner join org_emp_info oei on oei.data_id &#x3D; bu.user_id and oei.node_left &gt;&#x3D; 2875 and oei.node_right &lt;&#x3D; 10802 and oei.org_category &#x3D; - 1 +----------+| count(*) |+----------+| 778878 |+----------+1 row in set (5.19 sec)å‘ç°æ’åºä¹‹å‰å±…ç„¶é”å®šäº†778878æ¡è®°å½•ï¼Œå¦‚æœé’ˆå¯¹70ä¸‡çš„ç»“æœé›†æ’åºï¼Œå°†æ˜¯ç¾éš¾æ€§çš„ï¼Œæ€ªä¸å¾—è¿™ä¹ˆæ…¢ï¼Œé‚£æˆ‘ä»¬èƒ½ä¸èƒ½æ¢ä¸ªæ€è·¯ï¼Œå…ˆæ ¹æ®contactçš„created_timeæ’åºï¼Œå†æ¥joinä¼šä¸ä¼šæ¯”è¾ƒå¿«å‘¢ï¼Ÿäºæ˜¯æ”¹é€ æˆä¸‹é¢çš„è¯­å¥ï¼Œä¹Ÿå¯ä»¥ç”¨straight_joinæ¥ä¼˜åŒ–ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243select c.id, c.name, c.position, c.sex, c.phone, c.office_phone, c.feature_info, c.birthday, c.creator_id, c.is_keyperson, c.giveup_reason, c.status, c.data_source, from_unixtime(c.created_time) as created_time, from_unixtime(c.last_modified) as last_modified, c.last_modified_user_id from contact c where exists ( select 1 from contact_branch cb inner join branch_user bu on cb.branch_id &#x3D; bu.branch_id and bu.status in ( 1, 2) inner join org_emp_info oei on oei.data_id &#x3D; bu.user_id and oei.node_left &gt;&#x3D; 2875 and oei.node_right &lt;&#x3D; 10802 and oei.org_category &#x3D; - 1 where c.id &#x3D; cb.contact_id ) order by c.created_time desc limit 0 , 10;éªŒè¯ä¸€ä¸‹æ•ˆæœ é¢„è®¡åœ¨1mså†…ï¼Œæå‡äº†13000å¤šå€ï¼110 rows in set (0.00 sec)æœ¬ä»¥ä¸ºè‡³æ­¤å¤§å·¥å‘Šæˆï¼Œä½†æˆ‘ä»¬åœ¨å‰é¢çš„åˆ†æä¸­æ¼äº†ä¸€ä¸ªç»†èŠ‚ï¼Œå…ˆæ’åºå†joinå’Œå…ˆjoinå†æ’åºç†è®ºä¸Šå¼€é”€æ˜¯ä¸€æ ·çš„ï¼Œä¸ºä½•æå‡è¿™ä¹ˆå¤šæ˜¯å› ä¸ºæœ‰ä¸€ä¸ªlimitï¼å¤§è‡´æ‰§è¡Œè¿‡ç¨‹æ˜¯ï¼šmysqlå…ˆæŒ‰ç´¢å¼•æ’åºå¾—åˆ°å‰10æ¡è®°å½•ï¼Œç„¶åå†å»joinè¿‡æ»¤ï¼Œå½“å‘ç°ä¸å¤Ÿ10æ¡çš„æ—¶å€™ï¼Œå†æ¬¡å»10æ¡ï¼Œå†æ¬¡joinï¼Œè¿™æ˜¾ç„¶åœ¨å†…å±‚joinè¿‡æ»¤çš„æ•°æ®éå¸¸å¤šçš„æ—¶å€™ï¼Œå°†æ˜¯ç¾éš¾çš„ï¼Œæç«¯æƒ…å†µï¼Œå†…å±‚ä¸€æ¡æ•°æ®éƒ½æ‰¾ä¸åˆ°ï¼Œmysqlè¿˜å‚»ä¹ä¹çš„æ¯æ¬¡å–10æ¡ï¼Œå‡ ä¹éå†äº†è¿™ä¸ªæ•°æ®è¡¨ï¼ç”¨ä¸åŒå‚æ•°çš„SQLè¯•éªŒä¸‹ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344select sql_no_cache c.id, c.name, c.position, c.sex, c.phone, c.office_phone, c.feature_info, c.birthday, c.creator_id, c.is_keyperson, c.giveup_reason, c.status, c.data_source, from_unixtime(c.created_time) as created_time, from_unixtime(c.last_modified) as last_modified, c.last_modified_user_id from contact c where exists ( select 1 from contact_branch cb inner join branch_user bu on cb.branch_id &#x3D; bu.branch_id and bu.status in ( 1, 2) inner join org_emp_info oei on oei.data_id &#x3D; bu.user_id and oei.node_left &gt;&#x3D; 2875 and oei.node_right &lt;&#x3D; 2875 and oei.org_category &#x3D; - 1 where c.id &#x3D; cb.contact_id ) order by c.created_time desc limit 0 , 10;Empty set (2 min 18.99 sec)2 min 18.99 secï¼æ¯”ä¹‹å‰çš„æƒ…å†µè¿˜ç³Ÿç³•å¾ˆå¤šã€‚ç”±äºmysqlçš„nested loopæœºåˆ¶ï¼Œé‡åˆ°è¿™ç§æƒ…å†µï¼ŒåŸºæœ¬æ˜¯æ— æ³•ä¼˜åŒ–çš„ã€‚è¿™æ¡è¯­å¥æœ€ç»ˆä¹Ÿåªèƒ½äº¤ç»™åº”ç”¨ç³»ç»Ÿå»ä¼˜åŒ–è‡ªå·±çš„é€»è¾‘äº†ã€‚é€šè¿‡è¿™ä¸ªä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰è¯­å¥éƒ½èƒ½ä¼˜åŒ–ï¼Œè€Œå¾€å¾€æˆ‘ä»¬ä¼˜åŒ–æ—¶ï¼Œç”±äºSQLç”¨ä¾‹å›å½’æ—¶è½æ‰ä¸€äº›æç«¯æƒ…å†µï¼Œä¼šé€ æˆæ¯”åŸæ¥è¿˜ä¸¥é‡çš„åæœã€‚æ‰€ä»¥ï¼Œç¬¬ä¸€ï¼šä¸è¦æŒ‡æœ›æ‰€æœ‰è¯­å¥éƒ½èƒ½é€šè¿‡SQLä¼˜åŒ–ï¼Œç¬¬äºŒï¼šä¸è¦è¿‡äºè‡ªä¿¡ï¼Œåªé’ˆå¯¹å…·ä½“caseæ¥ä¼˜åŒ–ï¼Œè€Œå¿½ç•¥äº†æ›´å¤æ‚çš„æƒ…å†µã€‚æ…¢æŸ¥è¯¢çš„æ¡ˆä¾‹å°±åˆ†æåˆ°è¿™å„¿ï¼Œä»¥ä¸Šåªæ˜¯ä¸€äº›æ¯”è¾ƒå…¸å‹çš„æ¡ˆä¾‹ã€‚æˆ‘ä»¬åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­é‡åˆ°è¿‡è¶…è¿‡1000è¡Œï¼Œæ¶‰åŠåˆ°16ä¸ªè¡¨joinçš„â€œåƒåœ¾SQLâ€ï¼Œä¹Ÿé‡åˆ°è¿‡çº¿ä¸Šçº¿ä¸‹æ•°æ®åº“å·®å¼‚å¯¼è‡´åº”ç”¨ç›´æ¥è¢«æ…¢æŸ¥è¯¢æ‹–æ­»ï¼Œä¹Ÿé‡åˆ°è¿‡varcharç­‰å€¼æ¯”è¾ƒæ²¡æœ‰å†™å•å¼•å·ï¼Œè¿˜é‡åˆ°è¿‡ç¬›å¡å°”ç§¯æŸ¥è¯¢ç›´æ¥æŠŠä»åº“ææ­»ã€‚å†å¤šçš„æ¡ˆä¾‹å…¶å®ä¹Ÿåªæ˜¯ä¸€äº›ç»éªŒçš„ç§¯ç´¯ï¼Œå¦‚æœæˆ‘ä»¬ç†Ÿæ‚‰æŸ¥è¯¢ä¼˜åŒ–å™¨ã€ç´¢å¼•çš„å†…éƒ¨åŸç†ï¼Œé‚£ä¹ˆåˆ†æè¿™äº›æ¡ˆä¾‹å°±å˜å¾—ç‰¹åˆ«ç®€å•äº†ã€‚å†™åœ¨åé¢çš„è¯æœ¬æ–‡ä»¥ä¸€ä¸ªæ…¢æŸ¥è¯¢æ¡ˆä¾‹å¼•å…¥äº†MySQLç´¢å¼•åŸç†ã€ä¼˜åŒ–æ…¢æŸ¥è¯¢çš„ä¸€äº›æ–¹æ³•è®º;å¹¶é’ˆå¯¹é‡åˆ°çš„å…¸å‹æ¡ˆä¾‹åšäº†è¯¦ç»†çš„åˆ†æã€‚å…¶å®åšäº†è¿™ä¹ˆé•¿æ—¶é—´çš„è¯­å¥ä¼˜åŒ–åæ‰å‘ç°ï¼Œä»»ä½•æ•°æ®åº“å±‚é¢çš„ä¼˜åŒ–éƒ½æŠµä¸ä¸Šåº”ç”¨ç³»ç»Ÿçš„ä¼˜åŒ–ï¼ŒåŒæ ·æ˜¯MySQLï¼Œå¯ä»¥ç”¨æ¥æ”¯æ’‘Google/FaceBook/Taobaoåº”ç”¨ï¼Œä½†å¯èƒ½è¿ä½ çš„ä¸ªäººç½‘ç«™éƒ½æ’‘ä¸ä½ã€‚å¥—ç”¨æœ€è¿‘æ¯”è¾ƒæµè¡Œçš„è¯ï¼šâ€œæŸ¥è¯¢å®¹æ˜“ï¼Œä¼˜åŒ–ä¸æ˜“ï¼Œä¸”å†™ä¸”çæƒœï¼â€è½¬è½½è‡ªç¾å›¢æŠ€æœ¯å›¢é˜Ÿ","categories":[{"name":"DataBases","slug":"DataBases","permalink":"cpeixin.cn/categories/DataBases/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"cpeixin.cn/tags/mysql/"}]},{"title":"Linuxç›´æ¥ä¸‹è½½Google Driveæ–‡ä»¶","slug":"Linuxç›´æ¥ä¸‹è½½Google-Driveæ–‡ä»¶","date":"2020-05-27T17:03:54.000Z","updated":"2020-05-28T15:08:18.891Z","comments":true,"path":"2020/05/28/Linuxç›´æ¥ä¸‹è½½Google-Driveæ–‡ä»¶/","link":"","permalink":"cpeixin.cn/2020/05/28/Linux%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BDGoogle-Drive%E6%96%87%E4%BB%B6/","excerpt":"","text":"åœ¨Google Colabä¸­è®­ç»ƒå®Œæ¨¡å‹ï¼Œä¿å­˜åœ¨Google Driveä¸­ï¼Œæ•´ä¸ªé¡¹ç›®å¤§å°æœ‰3ã€4GBå¤§å°ï¼Œæ­¤æ—¶æƒ³å°†è¿™æ•´ä¸ªé¡¹ç›®æ”¾åˆ°æœåŠ¡å™¨ä¸­è¿›è¡Œéƒ¨ç½²æµ‹è¯•ã€‚é¦–é€‰æ–¹æ¡ˆæ˜¯å°†æ•´ä¸ªé¡¹ç›®ä¸Šä¼ åˆ°GitHubä¸­ï¼Œéšååœ¨æœåŠ¡å™¨ä¸­ç›´æ¥wgetï¼Œä½†æ˜¯æ¨¡å‹æ–‡ä»¶è¿‡å¤§ï¼ŒGitHubå•ä¸ªæ–‡ä»¶çš„é™åˆ¶æ˜¯100MBã€‚çªç„¶æƒ³åˆ°å¯ä¸å¯ä»¥ç›´æ¥ä»Google Driveä¸Šè¿›è¡Œä¸‹è½½æ¨¡å‹æ–‡ä»¶åˆ°æœåŠ¡å™¨ğŸ˜…ä¸‹è½½å°æ–‡ä»¶ï¼šé€‰æ‹©è¦ä¸‹è½½çš„æ–‡ä»¶å³é”®ç‚¹å‡»â€œå…±äº«â€ç‚¹å‡»â€œæ›´æ”¹â€ï¼Œè®¾ç½®åˆ†äº«æƒé™è¿™æ˜¯å¤åˆ¶å›¾ä¸­é€‰ä¸­éƒ¨åˆ†çš„IDæ‹¼æ¥ä¸‹è½½é“¾æ¥ï¼Œè¿›è¡Œä¸‹è½½wget https://drive.google.com/uc?id=å¤åˆ¶ä¸‹æ¥çš„å…±äº«id -O your_file_nameä¸‹è½½å¤§æ–‡ä»¶ï¼šä¸Šé¢çš„æ–¹æ³•ï¼Œé€‚åˆä¸‹è½½ä¸€äº›å°æ–‡ä»¶ï¼Œå¤§æ–‡ä»¶å°±ä¸å¯ä»¥äº†ã€‚æ›´æ¢ä¸‹é¢å‘½ä»¤çš„idé€‰é¡¹ï¼Œå¹¶ä¸”å‡†å¤‡å¥½cookies.txtå…³äºcookies.txtï¼Œå¯ä»¥åœ¨Chromeæµè§ˆå™¨ä¸­ä¸‹è½½cookie.txtè¿™ä¸ªæ’ä»¶ï¼Œç‚¹å‡»ä¸‹è½½ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸­/tmpç›®å½•ä¸‹å³å¯å…³äºæ–‡ä»¶idï¼Œå’Œä¸Šé¢æ–¹æ³•è·å–ä¸€è‡´ï¼Œæ¥ä¸‹æ¥è¿è¡Œä¸‹é¢å‘½ä»¤å³å¯ã€‚1wget --load-cookies /tmp/cookies.txt \"https://docs.google.com/uc?export=download&amp;confirm=$(wget --quiet --save-cookies /tmp/cookies.txt --keep-session-cookies --no-check-certificate 'https://docs.google.com/uc?export=download&amp;id=15q9WdqjpZKiVXUo7FOII7O2WLxZag' -O- | sed -rn 's/.*confirm=([0-9A-Za-z_]+).*/\\1\\n/p')&amp;id=15q9WdqjpZKiVXUo7FOII7O2WLxZagARe\" -O pytorch_model.bin","categories":[{"name":"Tools","slug":"Tools","permalink":"cpeixin.cn/categories/Tools/"}],"tags":[]},{"title":"Flink State çŠ¶æ€ç®¡ç†","slug":"Flink-State-çŠ¶æ€ç®¡ç†","date":"2020-04-29T01:51:40.000Z","updated":"2020-08-05T07:17:49.051Z","comments":true,"path":"2020/04/29/Flink-State-çŠ¶æ€ç®¡ç†/","link":"","permalink":"cpeixin.cn/2020/04/29/Flink-State-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/","excerpt":"","text":"æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹åˆ°åº•ä»€ä¹ˆæ˜¯ stateï¼Œæµå¼è®¡ç®—çš„æ•°æ®å¾€å¾€æ˜¯è½¬ç¬å³é€ï¼Œ å½“ç„¶ï¼ŒçœŸå®ä¸šåŠ¡åœºæ™¯ä¸å¯èƒ½è¯´æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯è¿›æ¥ä¹‹åå°±èµ°æ‰ï¼Œæ²¡æœ‰ä»»ä½•ä¸œè¥¿ç•™ä¸‹æ¥ï¼Œé‚£ä¹ˆç•™ä¸‹æ¥çš„ä¸œè¥¿å…¶å®å°±æ˜¯ç§°ä¹‹ä¸º stateï¼Œä¸­æ–‡å¯ä»¥ç¿»è¯‘æˆçŠ¶æ€ã€‚åœ¨ä¸‹é¢è¿™ä¸ªå›¾ä¸­ï¼Œæˆ‘ä»¬çš„æ‰€æœ‰çš„åŸå§‹æ•°æ®è¿›å…¥ç”¨æˆ·ä»£ç ä¹‹åå†è¾“å‡ºåˆ°ä¸‹æ¸¸ï¼Œå¦‚æœä¸­é—´æ¶‰åŠåˆ° state çš„è¯»å†™ï¼Œè¿™äº›çŠ¶æ€ä¼šå­˜å‚¨åœ¨æœ¬åœ°çš„ state backendï¼ˆå¯ä»¥å¯¹æ ‡æˆåµŒå…¥å¼æœ¬åœ° kv å­˜å‚¨ï¼‰å½“ä¸­ã€‚ä¸€. çŠ¶æ€ç®¡ç†çš„åŸºæœ¬æ¦‚å¿µ1. ä»€ä¹ˆæ˜¯çŠ¶æ€é¦–å…ˆä¸¾ä¸€ä¸ªæ— çŠ¶æ€è®¡ç®—çš„ä¾‹å­ï¼šæ¶ˆè´¹å»¶è¿Ÿè®¡ç®—ã€‚å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¸­æœ‰ä¸€ä¸ªç”Ÿäº§è€…æŒç»­å¾€æ¶ˆè´¹é˜Ÿåˆ—å†™å…¥æ¶ˆæ¯ï¼Œå¤šä¸ªæ¶ˆè´¹è€…åˆ†åˆ«ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¯»å–æ¶ˆæ¯ã€‚ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼Œç”Ÿäº§è€…å·²ç»å†™å…¥ 16 æ¡æ¶ˆæ¯ï¼ŒOffset åœç•™åœ¨ 15 ï¼›æœ‰ 3 ä¸ªæ¶ˆè´¹è€…ï¼Œæœ‰çš„æ¶ˆè´¹å¿«ï¼Œè€Œæœ‰çš„æ¶ˆè´¹æ…¢ã€‚æ¶ˆè´¹å¿«çš„å·²ç»æ¶ˆè´¹äº† 13 æ¡æ•°æ®ï¼Œæ¶ˆè´¹è€…æ…¢çš„æ‰æ¶ˆè´¹äº† 7ã€8 æ¡æ•°æ®ã€‚å¦‚ä½•å®æ—¶ç»Ÿè®¡æ¯ä¸ªæ¶ˆè´¹è€…è½åå¤šå°‘æ¡æ•°æ®ï¼Œå¦‚å›¾ç»™å‡ºäº†è¾“å…¥è¾“å‡ºçš„ç¤ºä¾‹ã€‚å¯ä»¥äº†è§£åˆ°è¾“å…¥çš„æ—¶é—´ç‚¹æœ‰ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œç”Ÿäº§è€…å°†æ¶ˆæ¯å†™åˆ°äº†æŸä¸ªæ—¶é—´ç‚¹çš„ä½ç½®ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…åŒä¸€æ—¶é—´ç‚¹åˆ†åˆ«è¯»åˆ°äº†ä»€ä¹ˆä½ç½®ã€‚åˆšæ‰ä¹Ÿæåˆ°äº†ç”Ÿäº§è€…å†™å…¥äº† 15 æ¡ï¼Œæ¶ˆè´¹è€…åˆ†åˆ«è¯»å–äº† 10ã€7ã€12 æ¡ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆå°†ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…çš„è¿›åº¦è½¬æ¢ä¸ºå³ä¾§ç¤ºæ„å›¾ä¿¡æ¯å‘¢ï¼Ÿconsumer 0 è½åäº† 5 æ¡ï¼Œconsumer 1 è½åäº† 8 æ¡ï¼Œconsumer 2 è½åäº† 3 æ¡ï¼Œæ ¹æ® Flink çš„åŸç†ï¼Œæ­¤å¤„éœ€è¿›è¡Œ Map æ“ä½œã€‚Map é¦–å…ˆæŠŠæ¶ˆæ¯è¯»å–è¿›æ¥ï¼Œç„¶ååˆ†åˆ«ç›¸å‡ï¼Œå³å¯çŸ¥é“æ¯ä¸ª consumer åˆ†åˆ«è½åäº†å‡ æ¡ã€‚Map ä¸€ç›´å¾€ä¸‹å‘ï¼Œåˆ™ä¼šå¾—å‡ºæœ€ç»ˆç»“æœã€‚å¤§å®¶ä¼šå‘ç°ï¼Œåœ¨è¿™ç§æ¨¡å¼çš„è®¡ç®—ä¸­ï¼Œæ— è®ºè¿™æ¡è¾“å…¥è¿›æ¥å¤šå°‘æ¬¡ï¼Œè¾“å‡ºçš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºå•æ¡è¾“å…¥ä¸­å·²ç»åŒ…å«äº†æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚æ¶ˆè´¹è½åç­‰äºç”Ÿäº§è€…å‡å»æ¶ˆè´¹è€…ã€‚ç”Ÿäº§è€…çš„æ¶ˆè´¹åœ¨å•æ¡æ•°æ®ä¸­å¯ä»¥å¾—åˆ°ï¼Œæ¶ˆè´¹è€…çš„æ•°æ®ä¹Ÿå¯ä»¥åœ¨å•æ¡æ•°æ®ä¸­å¾—åˆ°ï¼Œæ‰€ä»¥ç›¸åŒè¾“å…¥å¯ä»¥å¾—åˆ°ç›¸åŒè¾“å‡ºï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„è®¡ç®—ã€‚ç›¸åº”çš„ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€çš„è®¡ç®—ï¼Ÿä»¥è®¿é—®æ—¥å¿—ç»Ÿè®¡é‡çš„ä¾‹å­è¿›è¡Œè¯´æ˜ï¼Œæ¯”å¦‚å½“å‰æ‹¿åˆ°ä¸€ä¸ª Nginx è®¿é—®æ—¥å¿—ï¼Œä¸€æ¡æ—¥å¿—è¡¨ç¤ºä¸€ä¸ªè¯·æ±‚ï¼Œè®°å½•è¯¥è¯·æ±‚ä»å“ªé‡Œæ¥ï¼Œè®¿é—®çš„å“ªä¸ªåœ°å€ï¼Œéœ€è¦å®æ—¶ç»Ÿè®¡æ¯ä¸ªåœ°å€æ€»å…±è¢«è®¿é—®äº†å¤šå°‘æ¬¡ï¼Œä¹Ÿå³æ¯ä¸ª API è¢«è°ƒç”¨äº†å¤šå°‘æ¬¡ã€‚å¯ä»¥çœ‹åˆ°ä¸‹é¢ç®€åŒ–çš„è¾“å…¥å’Œè¾“å‡ºï¼Œè¾“å…¥ç¬¬ä¸€æ¡æ˜¯åœ¨æŸä¸ªæ—¶é—´ç‚¹è¯·æ±‚ GET äº† /api/aï¼›ç¬¬äºŒæ¡æ—¥å¿—è®°å½•äº†æŸä¸ªæ—¶é—´ç‚¹ Post /api/b ; ç¬¬ä¸‰æ¡æ˜¯åœ¨æŸä¸ªæ—¶é—´ç‚¹ GET äº†ä¸€ä¸ª /api/aï¼Œæ€»å…±æœ‰ 3 ä¸ª Nginx æ—¥å¿—ã€‚ä»è¿™ 3 æ¡ Nginx æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œç¬¬ä¸€æ¡è¿›æ¥è¾“å‡º /api/a è¢«è®¿é—®äº†ä¸€æ¬¡ï¼Œç¬¬äºŒæ¡è¿›æ¥è¾“å‡º /api/b è¢«è®¿é—®äº†ä¸€æ¬¡ï¼Œç´§æ¥ç€åˆè¿›æ¥ä¸€æ¡è®¿é—® api/aï¼Œæ‰€ä»¥ api/a è¢«è®¿é—®äº† 2 æ¬¡ã€‚ä¸åŒçš„æ˜¯ï¼Œä¸¤æ¡ /api/a çš„ Nginx æ—¥å¿—è¿›æ¥çš„æ•°æ®æ˜¯ä¸€æ ·çš„ï¼Œä½†è¾“å‡ºçš„æ—¶å€™ç»“æœå¯èƒ½ä¸åŒï¼Œç¬¬ä¸€æ¬¡è¾“å‡º count=1 ï¼Œç¬¬äºŒæ¬¡è¾“å‡º count=2ï¼Œè¯´æ˜ç›¸åŒè¾“å…¥å¯èƒ½å¾—åˆ°ä¸åŒè¾“å‡ºã€‚è¾“å‡ºçš„ç»“æœå–å†³äºå½“å‰è¯·æ±‚çš„ API åœ°å€ä¹‹å‰ç´¯è®¡è¢«è®¿é—®è¿‡å¤šå°‘æ¬¡ã€‚ç¬¬ä¸€æ¡è¿‡æ¥ç´¯è®¡æ˜¯ 0 æ¬¡ï¼Œcount = 1ï¼Œç¬¬äºŒæ¡è¿‡æ¥ API çš„è®¿é—®å·²ç»æœ‰ä¸€æ¬¡äº†ï¼Œæ‰€ä»¥ /api/a è®¿é—®ç´¯è®¡æ¬¡æ•° count=2ã€‚å•æ¡æ•°æ®å…¶å®ä»…åŒ…å«å½“å‰è¿™æ¬¡è®¿é—®çš„ä¿¡æ¯ï¼Œè€Œä¸åŒ…å«æ‰€æœ‰çš„ä¿¡æ¯ã€‚è¦å¾—åˆ°è¿™ä¸ªç»“æœï¼Œè¿˜éœ€è¦ä¾èµ– API ç´¯è®¡è®¿é—®çš„é‡ï¼Œå³çŠ¶æ€ã€‚è¿™ä¸ªè®¡ç®—æ¨¡å¼æ˜¯å°†æ•°æ®è¾“å…¥ç®—å­ä¸­ï¼Œç”¨æ¥è¿›è¡Œå„ç§å¤æ‚çš„è®¡ç®—å¹¶è¾“å‡ºæ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ç®—å­ä¼šå»è®¿é—®ä¹‹å‰å­˜å‚¨åœ¨é‡Œé¢çš„çŠ¶æ€ã€‚å¦å¤–ä¸€æ–¹é¢ï¼Œå®ƒè¿˜ä¼šæŠŠç°åœ¨çš„æ•°æ®å¯¹çŠ¶æ€çš„å½±å“å®æ—¶æ›´æ–°ï¼Œå¦‚æœè¾“å…¥ 200 æ¡æ•°æ®ï¼Œæœ€åè¾“å‡ºå°±æ˜¯ 200 æ¡ç»“æœã€‚ä»€ä¹ˆåœºæ™¯ä¼šç”¨åˆ°çŠ¶æ€å‘¢ï¼Ÿä¸‹é¢åˆ—ä¸¾äº†å¸¸è§çš„ 4 ç§ï¼šå»é‡ï¼šæ¯”å¦‚ä¸Šæ¸¸çš„ç³»ç»Ÿæ•°æ®å¯èƒ½ä¼šæœ‰é‡å¤ï¼Œè½åˆ°ä¸‹æ¸¸ç³»ç»Ÿæ—¶å¸Œæœ›æŠŠé‡å¤çš„æ•°æ®éƒ½å»æ‰ã€‚å»é‡éœ€è¦å…ˆäº†è§£å“ªäº›æ•°æ®æ¥è¿‡ï¼Œå“ªäº›æ•°æ®è¿˜æ²¡æœ‰æ¥ï¼Œä¹Ÿå°±æ˜¯æŠŠæ‰€æœ‰çš„ä¸»é”®éƒ½è®°å½•ä¸‹æ¥ï¼Œå½“ä¸€æ¡æ•°æ®åˆ°æ¥åï¼Œèƒ½å¤Ÿçœ‹åˆ°åœ¨ä¸»é”®å½“ä¸­æ˜¯å¦å­˜åœ¨ã€‚çª—å£è®¡ç®—ï¼šæ¯”å¦‚ç»Ÿè®¡æ¯åˆ†é’Ÿ Nginx æ—¥å¿— API è¢«è®¿é—®äº†å¤šå°‘æ¬¡ã€‚çª—å£æ˜¯ä¸€åˆ†é’Ÿè®¡ç®—ä¸€æ¬¡ï¼Œåœ¨çª—å£è§¦å‘å‰ï¼Œå¦‚ 08:00 ~ 08:01 è¿™ä¸ªçª—å£ï¼Œå‰ 59 ç§’çš„æ•°æ®æ¥äº†éœ€è¦å…ˆæ”¾å…¥å†…å­˜ï¼Œå³éœ€è¦æŠŠè¿™ä¸ªçª—å£ä¹‹å†…çš„æ•°æ®å…ˆä¿ç•™ä¸‹æ¥ï¼Œç­‰åˆ° 8:01 æ—¶ä¸€åˆ†é’Ÿåï¼Œå†å°†æ•´ä¸ªçª—å£å†…è§¦å‘çš„æ•°æ®è¾“å‡ºã€‚æœªè§¦å‘çš„çª—å£æ•°æ®ä¹Ÿæ˜¯ä¸€ç§çŠ¶æ€ã€‚æœºå™¨å­¦ä¹  / æ·±åº¦å­¦ä¹ ï¼šå¦‚è®­ç»ƒçš„æ¨¡å‹ä»¥åŠå½“å‰æ¨¡å‹çš„å‚æ•°ä¹Ÿæ˜¯ä¸€ç§çŠ¶æ€ï¼Œæœºå™¨å­¦ä¹ å¯èƒ½æ¯æ¬¡éƒ½ç”¨æœ‰ä¸€ä¸ªæ•°æ®é›†ï¼Œéœ€è¦åœ¨æ•°æ®é›†ä¸Šè¿›è¡Œå­¦ä¹ ï¼Œå¯¹æ¨¡å‹è¿›è¡Œä¸€ä¸ªåé¦ˆã€‚è®¿é—®å†å²æ•°æ®ï¼šæ¯”å¦‚ä¸æ˜¨å¤©çš„æ•°æ®è¿›è¡Œå¯¹æ¯”ï¼Œéœ€è¦è®¿é—®ä¸€äº›å†å²æ•°æ®ã€‚å¦‚æœæ¯æ¬¡ä»å¤–éƒ¨å»è¯»ï¼Œå¯¹èµ„æºçš„æ¶ˆè€—å¯èƒ½æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥ä¹Ÿå¸Œæœ›æŠŠè¿™äº›å†å²æ•°æ®ä¹Ÿæ”¾å…¥çŠ¶æ€ä¸­åšå¯¹æ¯”ã€‚2. ä¸ºä»€ä¹ˆè¦ç®¡ç†çŠ¶æ€ç®¡ç†çŠ¶æ€æœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯å°†æ•°æ®éƒ½æ”¾åˆ°å†…å­˜ä¸­ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¸¸è§çš„åšæ³•ã€‚æ¯”å¦‚åœ¨åš WordCount æ—¶ï¼ŒWord ä½œä¸ºè¾“å…¥ï¼ŒCount ä½œä¸ºè¾“å‡ºã€‚åœ¨è®¡ç®—çš„è¿‡ç¨‹ä¸­æŠŠè¾“å…¥ä¸æ–­ç´¯åŠ åˆ° Countã€‚ä½†å¯¹äºæµå¼ä½œä¸šæœ‰ä»¥ä¸‹è¦æ±‚ï¼š7*24 å°æ—¶è¿è¡Œï¼Œé«˜å¯é ï¼›æ•°æ®ä¸ä¸¢ä¸é‡ï¼Œæ°å¥½è®¡ç®—ä¸€æ¬¡ï¼›æ•°æ®å®æ—¶äº§å‡ºï¼Œä¸å»¶è¿Ÿï¼›åŸºäºä»¥ä¸Šè¦æ±‚ï¼Œå†…å­˜çš„ç®¡ç†å°±ä¼šå‡ºç°ä¸€äº›é—®é¢˜ã€‚ç”±äºå†…å­˜çš„å®¹é‡æ˜¯æœ‰é™åˆ¶çš„ã€‚å¦‚æœè¦åš 24 å°æ—¶çš„çª—å£è®¡ç®—ï¼Œå°† 24 å°æ—¶çš„æ•°æ®éƒ½æ”¾åˆ°å†…å­˜ï¼Œå¯èƒ½ä¼šå‡ºç°å†…å­˜ä¸è¶³ï¼›å¦å¤–ï¼Œä½œä¸šæ˜¯ 7*24ï¼Œéœ€è¦ä¿éšœé«˜å¯ç”¨ï¼Œæœºå™¨è‹¥å‡ºç°æ•…éšœæˆ–è€…å®•æœºï¼Œéœ€è¦è€ƒè™‘å¦‚ä½•å¤‡ä»½åŠä»å¤‡ä»½ä¸­å»æ¢å¤ï¼Œä¿è¯è¿è¡Œçš„ä½œä¸šä¸å—å½±å“ï¼›æ­¤å¤–ï¼Œè€ƒè™‘æ¨ªå‘æ‰©å±•ï¼Œå‡å¦‚ç½‘ç«™çš„è®¿é—®é‡ä¸é«˜ï¼Œç»Ÿè®¡æ¯ä¸ª API è®¿é—®æ¬¡æ•°çš„ç¨‹åºå¯ä»¥ç”¨å•çº¿ç¨‹å»è¿è¡Œï¼Œä½†å¦‚æœç½‘ç«™è®¿é—®é‡çªç„¶å¢åŠ ï¼Œå•èŠ‚ç‚¹æ— æ³•å¤„ç†å…¨éƒ¨è®¿é—®æ•°æ®ï¼Œæ­¤æ—¶éœ€è¦å¢åŠ å‡ ä¸ªèŠ‚ç‚¹è¿›è¡Œæ¨ªå‘æ‰©å±•ï¼Œè¿™æ—¶æ•°æ®çš„çŠ¶æ€å¦‚ä½•å¹³å‡åˆ†é…åˆ°æ–°å¢åŠ çš„èŠ‚ç‚¹ä¹Ÿé—®é¢˜ä¹‹ä¸€ã€‚å› æ­¤ï¼Œå°†æ•°æ®éƒ½æ”¾åˆ°å†…å­˜ä¸­ï¼Œå¹¶ä¸æ˜¯æœ€åˆé€‚çš„ä¸€ç§çŠ¶æ€ç®¡ç†æ–¹å¼ã€‚3. ç†æƒ³çš„çŠ¶æ€ç®¡ç†æœ€ç†æƒ³çš„çŠ¶æ€ç®¡ç†éœ€è¦æ»¡è¶³æ˜“ç”¨ã€é«˜æ•ˆã€å¯é ä¸‰ç‚¹éœ€æ±‚ï¼šæ˜“ç”¨ï¼ŒFlink æä¾›äº†ä¸°å¯Œçš„æ•°æ®ç»“æ„ã€å¤šæ ·çš„çŠ¶æ€ç»„ç»‡å½¢å¼ä»¥åŠç®€æ´çš„æ‰©å±•æ¥å£ï¼Œè®©çŠ¶æ€ç®¡ç†æ›´åŠ æ˜“ç”¨ï¼›é«˜æ•ˆï¼Œå®æ—¶ä½œä¸šä¸€èˆ¬éœ€è¦æ›´ä½çš„å»¶è¿Ÿï¼Œä¸€æ—¦å‡ºç°æ•…éšœï¼Œæ¢å¤é€Ÿåº¦ä¹Ÿéœ€è¦æ›´å¿«ï¼›å½“å¤„ç†èƒ½åŠ›ä¸å¤Ÿæ—¶ï¼Œå¯ä»¥æ¨ªå‘æ‰©å±•ï¼ŒåŒæ—¶åœ¨å¤„ç†å¤‡ä»½æ—¶ï¼Œä¸å½±å“ä½œä¸šæœ¬èº«å¤„ç†æ€§èƒ½ï¼›å¯é ï¼ŒFlink æä¾›äº†çŠ¶æ€æŒä¹…åŒ–ï¼ŒåŒ…æ‹¬ä¸ä¸¢ä¸é‡çš„è¯­ä¹‰ä»¥åŠå…·å¤‡è‡ªåŠ¨çš„å®¹é”™èƒ½åŠ›ï¼Œæ¯”å¦‚ HAï¼Œå½“èŠ‚ç‚¹æŒ‚æ‰åä¼šè‡ªåŠ¨æ‹‰èµ·ï¼Œä¸éœ€è¦äººå·¥ä»‹å…¥ã€‚äºŒ.Flink çŠ¶æ€çš„ç±»å‹ä¸ä½¿ç”¨ç¤ºä¾‹1.Managed State &amp; Raw StateManaged State æ˜¯ Flink è‡ªåŠ¨ç®¡ç†çš„ Stateï¼Œè€Œ Raw State æ˜¯åŸç”Ÿæ€ Stateï¼Œä¸¤è€…çš„åŒºåˆ«å¦‚ä¸‹ï¼šä»çŠ¶æ€ç®¡ç†æ–¹å¼çš„æ–¹å¼æ¥è¯´ï¼ŒManaged State ç”± Flink Runtime ç®¡ç†ï¼Œè‡ªåŠ¨å­˜å‚¨ï¼Œè‡ªåŠ¨æ¢å¤ï¼Œåœ¨å†…å­˜ç®¡ç†ä¸Šæœ‰ä¼˜åŒ–ï¼›è€Œ Raw State éœ€è¦ç”¨æˆ·è‡ªå·±ç®¡ç†ï¼Œéœ€è¦è‡ªå·±åºåˆ—åŒ–ï¼ŒFlink ä¸çŸ¥é“ State ä¸­å­˜å…¥çš„æ•°æ®æ˜¯ä»€ä¹ˆç»“æ„ï¼Œåªæœ‰ç”¨æˆ·è‡ªå·±çŸ¥é“ï¼Œéœ€è¦æœ€ç»ˆåºåˆ—åŒ–ä¸ºå¯å­˜å‚¨çš„æ•°æ®ç»“æ„ã€‚ä»çŠ¶æ€æ•°æ®ç»“æ„æ¥è¯´ï¼ŒManaged State æ”¯æŒå·²çŸ¥çš„æ•°æ®ç»“æ„ï¼Œå¦‚ Valueã€Listã€Map ç­‰ã€‚è€Œ Raw State åªæ”¯æŒå­—èŠ‚æ•°ç»„ ï¼Œæ‰€æœ‰çŠ¶æ€éƒ½è¦è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—èŠ‚æ•°ç»„æ‰å¯ä»¥ã€‚ä»æ¨èä½¿ç”¨åœºæ™¯æ¥è¯´ï¼ŒManaged State å¤§å¤šæ•°æƒ…å†µä¸‹å‡å¯ä½¿ç”¨ï¼Œè€Œ Raw State æ˜¯å½“ Managed State ä¸å¤Ÿç”¨æ—¶ï¼Œæ¯”å¦‚éœ€è¦è‡ªå®šä¹‰ Operator æ—¶ï¼Œæ¨èä½¿ç”¨ Raw Stateã€‚2.Keyed State &amp; Operator StateManaged State åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯ Keyed Stateï¼›å¦å¤–ä¸€ç§æ˜¯ Operator Stateã€‚åœ¨ Flink Stream æ¨¡å‹ä¸­ï¼ŒDatastream ç»è¿‡ keyBy çš„æ“ä½œå¯ä»¥å˜ä¸º KeyedStream ã€‚æ¯ä¸ª Key å¯¹åº”ä¸€ä¸ª Stateï¼Œå³ä¸€ä¸ª Operator å®ä¾‹å¤„ç†å¤šä¸ª Keyï¼Œè®¿é—®ç›¸åº”çš„å¤šä¸ª Stateï¼Œå¹¶ç”±æ­¤å°±è¡ç”Ÿäº† Keyed Stateã€‚Keyed State åªèƒ½ç”¨åœ¨ KeyedStream çš„ç®—å­ä¸­ï¼Œå³åœ¨æ•´ä¸ªç¨‹åºä¸­æ²¡æœ‰ keyBy çš„è¿‡ç¨‹å°±æ²¡æœ‰åŠæ³•ä½¿ç”¨ KeyedStreamã€‚ç›¸æ¯”è¾ƒè€Œè¨€ï¼ŒOperator State å¯ä»¥ç”¨äºæ‰€æœ‰ç®—å­ï¼Œç›¸å¯¹äºæ•°æ®æºæœ‰ä¸€ä¸ªæ›´å¥½çš„åŒ¹é…æ–¹å¼ï¼Œå¸¸ç”¨äº Sourceï¼Œä¾‹å¦‚ FlinkKafkaConsumerã€‚ç›¸æ¯” Keyed Stateï¼Œä¸€ä¸ª Operator å®ä¾‹å¯¹åº”ä¸€ä¸ª Stateï¼Œéšç€å¹¶å‘çš„æ”¹å˜ï¼ŒKeyed State ä¸­ï¼ŒState éšç€ Key åœ¨å®ä¾‹é—´è¿ç§»ï¼Œæ¯”å¦‚åŸæ¥æœ‰ 1 ä¸ªå¹¶å‘ï¼Œå¯¹åº”çš„ API è¯·æ±‚è¿‡æ¥ï¼Œ/api/a å’Œ /api/b éƒ½å­˜æ”¾åœ¨è¿™ä¸ªå®ä¾‹å½“ä¸­ï¼›å¦‚æœè¯·æ±‚é‡å˜å¤§ï¼Œéœ€è¦æ‰©å®¹ï¼Œå°±ä¼šæŠŠ /api/a çš„çŠ¶æ€å’Œ /api/b çš„çŠ¶æ€åˆ†åˆ«æ”¾åœ¨ä¸åŒçš„èŠ‚ç‚¹ã€‚ç”±äº Operator State æ²¡æœ‰ Keyï¼Œå¹¶å‘æ”¹å˜æ—¶éœ€è¦é€‰æ‹©çŠ¶æ€å¦‚ä½•é‡æ–°åˆ†é…ã€‚å…¶ä¸­å†…ç½®äº† 2 ç§åˆ†é…æ–¹å¼ï¼šä¸€ç§æ˜¯å‡åŒ€åˆ†é…ï¼Œå¦å¤–ä¸€ç§æ˜¯å°†æ‰€æœ‰ State åˆå¹¶ä¸ºå…¨é‡ State å†åˆ†å‘ç»™æ¯ä¸ªå®ä¾‹ã€‚åœ¨è®¿é—®ä¸Šï¼ŒKeyed State é€šè¿‡ RuntimeContext è®¿é—®ï¼Œè¿™éœ€è¦ Operator æ˜¯ä¸€ä¸ª Rich Functionã€‚Operator State éœ€è¦è‡ªå·±å®ç° CheckpointedFunction æˆ– ListCheckpointed æ¥å£ã€‚åœ¨æ•°æ®ç»“æ„ä¸Šï¼ŒKeyed State æ”¯æŒçš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ ValueStateã€ListStateã€ReducingStateã€AggregatingState å’Œ MapStateï¼›è€Œ Operator State æ”¯æŒçš„æ•°æ®ç»“æ„ç›¸å¯¹è¾ƒå°‘ï¼Œå¦‚ ListStateã€‚3.Keyed State &amp; Operator State åŒºåˆ«æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šåœ¨å››ä¸ªç»´åº¦æ¥åŒºåˆ†ä¸¤ç§ä¸åŒçš„ stateï¼šoperator state ä»¥åŠ keyed stateã€‚1. æ˜¯å¦å­˜åœ¨å½“å‰å¤„ç†çš„ keyï¼ˆcurrent keyï¼‰ï¼šoperator state æ˜¯æ²¡æœ‰å½“å‰ key çš„æ¦‚å¿µï¼Œè€Œ keyed state çš„æ•°å€¼æ€»æ˜¯ä¸ä¸€ä¸ª current key å¯¹åº”ã€‚2. å­˜å‚¨å¯¹è±¡æ˜¯å¦ on heap: ç›®å‰ operator state backend ä»…æœ‰ä¸€ç§ on-heap çš„å®ç°ï¼›è€Œ keyed state backend æœ‰ on-heap å’Œ off-heapï¼ˆRocksDBï¼‰çš„å¤šç§å®ç°ã€‚3. æ˜¯å¦éœ€è¦æ‰‹åŠ¨å£°æ˜å¿«ç…§ï¼ˆsnapshotï¼‰å’Œæ¢å¤ (restore) æ–¹æ³•ï¼šoperator state éœ€è¦æ‰‹åŠ¨å®ç° snapshot å’Œ restore æ–¹æ³•ï¼›è€Œ keyed state åˆ™ç”± backend è‡ªè¡Œå®ç°ï¼Œå¯¹ç”¨æˆ·é€æ˜ã€‚4. æ•°æ®å¤§å°ï¼šä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬è®¤ä¸º operator state çš„æ•°æ®è§„æ¨¡æ˜¯æ¯”è¾ƒå°çš„ï¼›è®¤ä¸º keyed state è§„æ¨¡æ˜¯ç›¸å¯¹æ¯”è¾ƒå¤§çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªç»éªŒåˆ¤æ–­ï¼Œä¸æ˜¯ä¸€ä¸ªç»å¯¹çš„åˆ¤æ–­åŒºåˆ†æ ‡å‡†ã€‚4.Keyed State ä½¿ç”¨ç¤ºä¾‹Keyed State æœ‰å¾ˆå¤šç§ï¼Œå¦‚å›¾ä¸ºå‡ ç§ Keyed State ä¹‹é—´çš„å…³ç³»ã€‚é¦–å…ˆ State çš„å­ç±»ä¸­ä¸€çº§å­ç±»æœ‰ ValueStateã€MapStateã€AppendingStateã€‚AppendingState åˆæœ‰ä¸€ä¸ªå­ç±» MergingStateã€‚MergingState åˆåˆ†ä¸º 3 ä¸ªå­ç±»åˆ†åˆ«æ˜¯ ListStateã€ReducingStateã€AggregatingStateã€‚è¿™ä¸ªç»§æ‰¿å…³ç³»ä½¿å®ƒä»¬çš„è®¿é—®æ–¹å¼ã€æ•°æ®ç»“æ„ä¹Ÿå­˜åœ¨å·®å¼‚ã€‚å‡ ç§ Keyed State çš„å·®å¼‚å…·ä½“ä½“ç°åœ¨ï¼šValueState å­˜å‚¨å•ä¸ªå€¼ï¼Œæ¯”å¦‚ Wordcountï¼Œç”¨ Word å½“ Keyï¼ŒState å°±æ˜¯å®ƒçš„ Countã€‚è¿™é‡Œé¢çš„å•ä¸ªå€¼å¯èƒ½æ˜¯æ•°å€¼æˆ–è€…å­—ç¬¦ä¸²ï¼Œä½œä¸ºå•ä¸ªå€¼ï¼Œè®¿é—®æ¥å£å¯èƒ½æœ‰ä¸¤ç§ï¼Œget å’Œ setã€‚åœ¨ State ä¸Šä½“ç°çš„æ˜¯ update(T) / T value()ã€‚MapState çš„çŠ¶æ€æ•°æ®ç±»å‹æ˜¯ Mapï¼Œåœ¨ State ä¸Šæœ‰ putã€remove ç­‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åœ¨ MapState ä¸­çš„ key å’Œ Keyed state ä¸­çš„ key ä¸æ˜¯åŒä¸€ä¸ªã€‚ListState çŠ¶æ€æ•°æ®ç±»å‹æ˜¯ Listï¼Œè®¿é—®æ¥å£å¦‚ addã€update ç­‰ã€‚ReducingState å’Œ AggregatingState ä¸ ListState éƒ½æ˜¯åŒä¸€ä¸ªçˆ¶ç±»ï¼Œä½†çŠ¶æ€æ•°æ®ç±»å‹ä¸Šæ˜¯å•ä¸ªå€¼ï¼ŒåŸå› åœ¨äºå…¶ä¸­çš„ add æ–¹æ³•ä¸æ˜¯æŠŠå½“å‰çš„å…ƒç´ è¿½åŠ åˆ°åˆ—è¡¨ä¸­ï¼Œè€Œæ˜¯æŠŠå½“å‰å…ƒç´ ç›´æ¥æ›´æ–°è¿›äº† Reducing çš„ç»“æœä¸­ã€‚AggregatingState çš„åŒºåˆ«æ˜¯åœ¨è®¿é—®æ¥å£ï¼ŒReducingState ä¸­ addï¼ˆTï¼‰å’Œ T get() è¿›å»å’Œå‡ºæ¥çš„å…ƒç´ éƒ½æ˜¯åŒä¸€ä¸ªç±»å‹ï¼Œä½†åœ¨ AggregatingState è¾“å…¥çš„ INï¼Œè¾“å‡ºçš„æ˜¯ OUTã€‚ä¸‹é¢ä»¥ ValueState ä¸ºä¾‹ï¼Œæ¥é˜è¿°ä¸€ä¸‹å…·ä½“å¦‚ä½•ä½¿ç”¨ï¼Œä»¥çŠ¶æ€æœºçš„æ¡ˆä¾‹æ¥è®²è§£ ã€‚æºä»£ç åœ°å€æ„Ÿå…´è¶£çš„åŒå­¦å¯ç›´æ¥æŸ¥çœ‹å®Œæ•´æºä»£ç ï¼Œåœ¨æ­¤æˆªå–éƒ¨åˆ†ã€‚å¦‚å›¾ä¸º Flink ä½œä¸šçš„ä¸»æ–¹æ³•ä¸ä¸»å‡½æ•°ä¸­çš„å†…å®¹ï¼Œå‰é¢çš„è¾“å…¥ã€åé¢çš„è¾“å‡ºä»¥åŠä¸€äº›ä¸ªæ€§åŒ–çš„é…ç½®é¡¹éƒ½å·²å»æ‰ï¼Œä»…ä¿ç•™äº†ä¸»å¹²ã€‚é¦–å…ˆ events æ˜¯ä¸€ä¸ª DataStreamï¼Œé€šè¿‡ env.addSource åŠ è½½æ•°æ®è¿›æ¥ï¼Œæ¥ä¸‹æ¥æœ‰ä¸€ä¸ª DataStream å« alertsï¼Œå…ˆ keyby ä¸€ä¸ª sourceAddressï¼Œç„¶ååœ¨ flatMap ä¸€ä¸ª StateMachineMapperã€‚StateMachineMapper å°±æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼ŒçŠ¶æ€æœºæŒ‡æœ‰ä¸åŒçš„çŠ¶æ€ä¸çŠ¶æ€é—´æœ‰ä¸åŒçš„è½¬æ¢å…³ç³»çš„ç»“åˆï¼Œä»¥ä¹°ä¸œè¥¿çš„è¿‡ç¨‹ç®€å•ä¸¾ä¾‹ã€‚é¦–å…ˆä¸‹è®¢å•ï¼Œè®¢å•ç”ŸæˆåçŠ¶æ€ä¸ºå¾…ä»˜æ¬¾ï¼Œå½“å†æ¥ä¸€ä¸ªäº‹ä»¶çŠ¶æ€ä»˜æ¬¾æˆåŠŸï¼Œåˆ™äº‹ä»¶çš„çŠ¶æ€å°†ä¼šä»å¾…ä»˜æ¬¾å˜ä¸ºå·²ä»˜æ¬¾ï¼Œå¾…å‘è´§ã€‚å·²ä»˜æ¬¾ï¼Œå¾…å‘è´§çš„çŠ¶æ€å†æ¥ä¸€ä¸ªäº‹ä»¶å‘è´§ï¼Œè®¢å•çŠ¶æ€å°†ä¼šå˜ä¸ºé…é€ä¸­ï¼Œé…é€ä¸­çš„çŠ¶æ€å†æ¥ä¸€ä¸ªäº‹ä»¶ç­¾æ”¶ï¼Œåˆ™è¯¥è®¢å•çš„çŠ¶æ€å°±å˜ä¸ºå·²ç­¾æ”¶ã€‚åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œéšæ—¶éƒ½å¯ä»¥æ¥ä¸€ä¸ªäº‹ä»¶ï¼Œå–æ¶ˆè®¢å•ï¼Œæ— è®ºå“ªä¸ªçŠ¶æ€ï¼Œä¸€æ—¦è§¦å‘äº†å–æ¶ˆè®¢å•äº‹ä»¶æœ€ç»ˆå°±ä¼šå°†çŠ¶æ€è½¬ç§»åˆ°å·²å–æ¶ˆï¼Œè‡³æ­¤çŠ¶æ€å°±ç»“æŸäº†ã€‚Flink å†™çŠ¶æ€æœºæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿé¦–å…ˆè¿™æ˜¯ä¸€ä¸ª RichFlatMapFunctionï¼Œè¦ç”¨ Keyed State getRuntimeContextï¼ŒgetRuntimeContext çš„è¿‡ç¨‹ä¸­éœ€è¦ RichFunctionï¼Œæ‰€ä»¥éœ€è¦åœ¨ open æ–¹æ³•ä¸­è·å– currentState ï¼Œç„¶å getStateï¼ŒcurrentState ä¿å­˜çš„æ˜¯å½“å‰çŠ¶æ€æœºä¸Šçš„çŠ¶æ€ã€‚å¦‚æœåˆšä¸‹è®¢å•ï¼Œé‚£ä¹ˆ currentState å°±æ˜¯å¾…ä»˜æ¬¾çŠ¶æ€ï¼Œåˆå§‹åŒ–åï¼ŒcurrentState å°±ä»£è¡¨è®¢å•å®Œæˆã€‚è®¢å•æ¥äº†åï¼Œå°±ä¼šèµ° flatMap è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨ flatMap æ–¹æ³•ä¸­ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ª Stateï¼Œä» currentState å–å‡ºï¼Œå³ Valueï¼ŒValue å–å€¼åå…ˆåˆ¤æ–­å€¼æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœ sourceAddress state æ˜¯ç©ºï¼Œåˆ™è¯´æ˜æ²¡æœ‰è¢«ä½¿ç”¨è¿‡ï¼Œé‚£ä¹ˆæ­¤çŠ¶æ€åº”è¯¥ä¸ºåˆšåˆ›å»ºè®¢å•çš„åˆå§‹çŠ¶æ€ï¼Œå³å¾…ä»˜æ¬¾ã€‚ç„¶åèµ‹å€¼ state = State.Initialï¼Œæ³¨æ„æ­¤å¤„çš„ State æ˜¯æœ¬åœ°çš„å˜é‡ï¼Œè€Œä¸æ˜¯ Flink ä¸­ç®¡ç†çš„çŠ¶æ€ï¼Œå°†å®ƒçš„å€¼ä»çŠ¶æ€ä¸­å–å‡ºã€‚æ¥ä¸‹æ¥åœ¨æœ¬åœ°åˆä¼šæ¥ä¸€ä¸ªå˜é‡ï¼Œç„¶å transitionï¼Œå°†äº‹ä»¶å¯¹å®ƒçš„å½±å“åŠ ä¸Šï¼Œåˆšæ‰å¾…ä»˜æ¬¾çš„è®¢å•æ”¶åˆ°ä»˜æ¬¾æˆåŠŸçš„äº‹ä»¶ï¼Œå°±ä¼šå˜æˆå·²ä»˜æ¬¾ï¼Œå¾…å‘è´§ï¼Œç„¶å nextState å³å¯ç®—å‡ºã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦åˆ¤æ–­ State æ˜¯å¦åˆæ³•ï¼Œæ¯”å¦‚ä¸€ä¸ªå·²ç­¾æ”¶çš„è®¢å•ï¼Œåˆæ¥ä¸€ä¸ªçŠ¶æ€å«å–æ¶ˆè®¢å•ï¼Œä¼šå‘ç°å·²ç­¾æ”¶è®¢å•ä¸èƒ½è¢«å–æ¶ˆï¼Œæ­¤æ—¶è¿™ä¸ªçŠ¶æ€å°±ä¼šä¸‹å‘ï¼Œè®¢å•çŠ¶æ€ä¸ºéæ³•çŠ¶æ€ã€‚å¦‚æœä¸æ˜¯éæ³•çš„çŠ¶æ€ï¼Œè¿˜è¦çœ‹è¯¥çŠ¶æ€æ˜¯å¦å·²ç»æ— æ³•è½¬æ¢ï¼Œæ¯”å¦‚è¿™ä¸ªçŠ¶æ€å˜ä¸ºå·²å–æ¶ˆæ—¶ï¼Œå°±ä¸ä¼šåœ¨æœ‰å…¶ä»–çš„çŠ¶æ€å†å‘ç”Ÿäº†ï¼Œæ­¤æ—¶å°±ä¼šä» state ä¸­ clearã€‚clear æ˜¯æ‰€æœ‰çš„ Flink ç®¡ç† keyed state éƒ½æœ‰çš„å…¬å…±æ–¹æ³•ï¼Œæ„å‘³ç€å°†ä¿¡æ¯åˆ é™¤ï¼Œå¦‚æœæ—¢ä¸æ˜¯ä¸€ä¸ªéæ³•çŠ¶æ€ä¹Ÿä¸æ˜¯ä¸€ä¸ªç»“æŸçŠ¶æ€ï¼Œåé¢å¯èƒ½è¿˜ä¼šæœ‰æ›´å¤šçš„è½¬æ¢ï¼Œæ­¤æ—¶éœ€è¦å°†è®¢å•çš„å½“å‰çŠ¶æ€ update ï¼Œè¿™æ ·å°±å®Œæˆäº† ValueState çš„åˆå§‹åŒ–ã€å–å€¼ã€æ›´æ–°ä»¥åŠæ¸…é›¶ï¼Œåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­çŠ¶æ€æœºçš„ä½œç”¨å°±æ˜¯å°†éæ³•çš„çŠ¶æ€è¿›è¡Œä¸‹å‘ï¼Œæ–¹ä¾¿ä¸‹æ¸¸è¿›è¡Œå¤„ç†ã€‚å…¶ä»–çš„çŠ¶æ€ä¹Ÿæ˜¯ç±»ä¼¼çš„ä½¿ç”¨æ–¹å¼ã€‚ä¸‰. å®¹é”™æœºåˆ¶ä¸æ•…éšœæ¢å¤1. çŠ¶æ€å¦‚ä½•ä¿å­˜åŠæ¢å¤Flink çŠ¶æ€ä¿å­˜ä¸»è¦ä¾é  Checkpoint æœºåˆ¶ï¼ŒCheckpoint ä¼šå®šæ—¶åˆ¶ä½œåˆ†å¸ƒå¼å¿«ç…§ï¼Œå¯¹ç¨‹åºä¸­çš„çŠ¶æ€è¿›è¡Œå¤‡ä»½ï¼Œè¿™é‡Œå°±ä¸åœ¨é˜è¿°åˆ†å¸ƒå¼å¿«ç…§å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„ã€‚åˆ†å¸ƒå¼å¿«ç…§ Checkpoint å®Œæˆåï¼Œå½“ä½œä¸šå‘ç”Ÿæ•…éšœäº†å¦‚ä½•å»æ¢å¤ï¼Ÿå‡å¦‚ä½œä¸šåˆ†å¸ƒè·‘åœ¨ 3 å°æœºå™¨ä¸Šï¼Œå…¶ä¸­ä¸€å°æŒ‚äº†ã€‚è¿™ä¸ªæ—¶å€™éœ€è¦æŠŠè¿›ç¨‹æˆ–è€…çº¿ç¨‹ç§»åˆ° active çš„ 2 å°æœºå™¨ä¸Šï¼Œæ­¤æ—¶è¿˜éœ€è¦å°†æ•´ä¸ªä½œä¸šçš„æ‰€æœ‰ Task éƒ½å›æ»šåˆ°æœ€åä¸€æ¬¡æˆåŠŸ Checkpoint ä¸­çš„çŠ¶æ€ï¼Œç„¶åä»è¯¥ç‚¹å¼€å§‹ç»§ç»­å¤„ç†ã€‚å¦‚æœè¦ä» Checkpoint æ¢å¤ï¼Œå¿…è¦æ¡ä»¶æ˜¯æ•°æ®æºéœ€è¦æ”¯æŒæ•°æ®é‡æ–°å‘é€ã€‚Checkpoint æ¢å¤åï¼Œ Flink æä¾›ä¸¤ç§ä¸€è‡´æ€§è¯­ä¹‰ï¼Œä¸€ç§æ˜¯æ°å¥½ä¸€æ¬¡ï¼Œä¸€ç§æ˜¯è‡³å°‘ä¸€æ¬¡ã€‚åœ¨åš Checkpoint æ—¶ï¼Œå¯æ ¹æ® Barries å¯¹é½æ¥åˆ¤æ–­æ˜¯æ°å¥½ä¸€æ¬¡è¿˜æ˜¯è‡³å°‘ä¸€æ¬¡ï¼Œå¦‚æœå¯¹é½ï¼Œåˆ™ä¸ºæ°å¥½ä¸€æ¬¡ï¼Œå¦åˆ™æ²¡æœ‰å¯¹é½å³ä¸ºè‡³å°‘ä¸€æ¬¡ã€‚å¦‚æœä½œä¸šæ˜¯å•çº¿ç¨‹å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ Barries æ˜¯ä¸éœ€è¦å¯¹é½çš„ï¼›å¦‚æœåªæœ‰ä¸€ä¸ª Checkpoint åœ¨åšï¼Œä¸ç®¡ä»€ä¹ˆæ—¶å€™ä» Checkpoint æ¢å¤ï¼Œéƒ½ä¼šæ¢å¤åˆ°åˆšæ‰çš„çŠ¶æ€ï¼›å¦‚æœæœ‰å¤šä¸ªèŠ‚ç‚¹ï¼Œå‡å¦‚ä¸€ä¸ªæ•°æ®çš„ Barries åˆ°äº†ï¼Œå¦ä¸€ä¸ª Barries è¿˜æ²¡æœ‰æ¥ï¼Œå†…å­˜ä¸­çš„çŠ¶æ€å¦‚æœå·²ç»å­˜å‚¨ã€‚é‚£ä¹ˆè¿™ 2 ä¸ªæµæ˜¯ä¸å¯¹é½çš„ï¼Œæ¢å¤çš„æ—¶å€™å…¶ä¸­ä¸€ä¸ªæµå¯èƒ½ä¼šæœ‰é‡å¤ã€‚Checkpoint é€šè¿‡ä»£ç çš„å®ç°æ–¹æ³•å¦‚ä¸‹ï¼šé¦–å…ˆä»ä½œä¸šçš„è¿è¡Œç¯å¢ƒ env.enableCheckpointing ä¼ å…¥ 1000ï¼Œæ„æ€æ˜¯åš 2 ä¸ª Checkpoint çš„äº‹ä»¶é—´éš”ä¸º 1 ç§’ã€‚Checkpoint åšçš„è¶Šé¢‘ç¹ï¼Œæ¢å¤æ—¶è¿½æ•°æ®å°±ä¼šç›¸å¯¹å‡å°‘ï¼ŒåŒæ—¶ Checkpoint ç›¸åº”çš„ä¹Ÿä¼šæœ‰ä¸€äº› IO æ¶ˆè€—ã€‚æ¥ä¸‹æ¥æ˜¯è®¾ç½® Checkpoint çš„ modelï¼Œå³è®¾ç½®äº† Exactly_Once è¯­ä¹‰ï¼Œå¹¶ä¸”éœ€è¦ Barries å¯¹é½ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ä¹Ÿä¸ä¼šé‡å¤ã€‚setMinPauseBetweenCheckpoints æ˜¯ 2 ä¸ª Checkpoint ä¹‹é—´æœ€å°‘æ˜¯è¦ç­‰ 500msï¼Œä¹Ÿå°±æ˜¯åˆšåšå®Œä¸€ä¸ª Checkpointã€‚æ¯”å¦‚æŸä¸ª Checkpoint åšäº† 700msï¼ŒæŒ‰ç…§åŸåˆ™è¿‡ 300ms åº”è¯¥æ˜¯åšä¸‹ä¸€ä¸ª Checkpointï¼Œå› ä¸ºè®¾ç½®äº† 1000ms åšä¸€æ¬¡ Checkpoint çš„ï¼Œä½†æ˜¯ä¸­é—´çš„ç­‰å¾…æ—¶é—´æ¯”è¾ƒçŸ­ï¼Œä¸è¶³ 500ms äº†ï¼Œéœ€è¦å¤šç­‰ 200msï¼Œå› æ­¤ä»¥è¿™æ ·çš„æ–¹å¼é˜²æ­¢ Checkpoint å¤ªè¿‡äºé¢‘ç¹è€Œå¯¼è‡´ä¸šåŠ¡å¤„ç†çš„é€Ÿåº¦ä¸‹é™ã€‚setCheckpointTimeout è¡¨ç¤ºåš Checkpoint å¤šä¹…è¶…æ—¶ï¼Œå¦‚æœ Checkpoint åœ¨ 1min ä¹‹å†…å°šæœªå®Œæˆï¼Œè¯´æ˜ Checkpoint è¶…æ—¶å¤±è´¥ã€‚setMaxConcurrentCheckpoints è¡¨ç¤ºåŒæ—¶æœ‰å¤šå°‘ä¸ª Checkpoint åœ¨åšå¿«ç…§ï¼Œè¿™ä¸ªå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚å»åšè®¾ç½®ã€‚enableExternalizedCheckpoints è¡¨ç¤ºä¸‹ Cancel æ—¶æ˜¯å¦éœ€è¦ä¿ç•™å½“å‰çš„ Checkpointï¼Œé»˜è®¤ Checkpoint ä¼šåœ¨æ•´ä¸ªä½œä¸š Cancel æ—¶è¢«åˆ é™¤ã€‚Checkpoint æ˜¯ä½œä¸šçº§åˆ«çš„ä¿å­˜ç‚¹ã€‚ä¸Šé¢è®²è¿‡ï¼Œé™¤äº†æ•…éšœæ¢å¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦å¯ä»¥æ‰‹åŠ¨å»è°ƒæ•´å¹¶å‘é‡æ–°åˆ†é…è¿™äº›çŠ¶æ€ã€‚æ‰‹åŠ¨è°ƒæ•´å¹¶å‘ï¼Œå¿…é¡»è¦é‡å¯ä½œä¸šå¹¶ä¼šæç¤º Checkpoint å·²ç»ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä½œä¸šå¦‚ä½•æ¢å¤æ•°æ®ï¼Ÿä¸€æ–¹é¢ Flink åœ¨ Cancel æ—¶å…è®¸åœ¨å¤–éƒ¨ä»‹è´¨ä¿ç•™ Checkpoint ï¼›å¦ä¸€æ–¹é¢ï¼ŒFlink è¿˜æœ‰å¦å¤–ä¸€ä¸ªæœºåˆ¶æ˜¯ SavePointã€‚Savepoint ä¸ Checkpoint ç±»ä¼¼ï¼ŒåŒæ ·æ˜¯æŠŠçŠ¶æ€å­˜å‚¨åˆ°å¤–éƒ¨ä»‹è´¨ã€‚å½“ä½œä¸šå¤±è´¥æ—¶ï¼Œå¯ä»¥ä»å¤–éƒ¨æ¢å¤ã€‚Savepoint ä¸ Checkpoint æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿä»è§¦å‘ç®¡ç†æ–¹å¼æ¥è®²ï¼ŒCheckpoint ç”± Flink è‡ªåŠ¨è§¦å‘å¹¶ç®¡ç†ï¼Œè€Œ Savepoint ç”±ç”¨æˆ·æ‰‹åŠ¨è§¦å‘å¹¶äººè‚‰ç®¡ç†ï¼›ä»ç”¨é€”æ¥è®²ï¼ŒCheckpoint åœ¨ Task å‘ç”Ÿå¼‚å¸¸æ—¶å¿«é€Ÿæ¢å¤ï¼Œä¾‹å¦‚ç½‘ç»œæŠ–åŠ¨æˆ–è¶…æ—¶å¼‚å¸¸ï¼Œè€Œ Savepoint æœ‰è®¡åˆ’åœ°è¿›è¡Œå¤‡ä»½ï¼Œä½¿ä½œä¸šèƒ½åœæ­¢åå†æ¢å¤ï¼Œä¾‹å¦‚ä¿®æ”¹ä»£ç ã€è°ƒæ•´å¹¶å‘ï¼›æœ€åä»ç‰¹ç‚¹æ¥è®²ï¼ŒCheckpoint æ¯”è¾ƒè½»é‡çº§ï¼Œä½œä¸šå‡ºç°é—®é¢˜ä¼šè‡ªåŠ¨ä»æ•…éšœä¸­æ¢å¤ï¼Œåœ¨ä½œä¸šåœæ­¢åé»˜è®¤æ¸…é™¤ï¼›è€Œ Savepoint æ¯”è¾ƒæŒä¹…ï¼Œä»¥æ ‡å‡†æ ¼å¼å­˜å‚¨ï¼Œå…è®¸ä»£ç æˆ–é…ç½®å‘ç”Ÿæ”¹å˜ï¼Œæ¢å¤éœ€è¦å¯åŠ¨ä½œä¸šæ‰‹åŠ¨æŒ‡å®šä¸€ä¸ªè·¯å¾„æ¢å¤ã€‚2. å¯é€‰çš„çŠ¶æ€å­˜å‚¨æ–¹å¼Checkpoint çš„å­˜å‚¨ï¼Œç¬¬ä¸€ç§æ˜¯å†…å­˜å­˜å‚¨ï¼Œå³ MemoryStateBackendï¼Œæ„é€ æ–¹æ³•æ˜¯è®¾ç½®æœ€å¤§çš„ StateSizeï¼Œé€‰æ‹©æ˜¯å¦åšå¼‚æ­¥å¿«ç…§ï¼Œè¿™ç§å­˜å‚¨çŠ¶æ€æœ¬èº«å­˜å‚¨åœ¨ TaskManager èŠ‚ç‚¹ä¹Ÿå°±æ˜¯æ‰§è¡ŒèŠ‚ç‚¹å†…å­˜ä¸­çš„ï¼Œå› ä¸ºå†…å­˜æœ‰å®¹é‡é™åˆ¶ï¼Œæ‰€ä»¥å•ä¸ª State maxStateSize é»˜è®¤ 5 Mï¼Œä¸”éœ€è¦æ³¨æ„ maxStateSize &lt;= akka.framesize é»˜è®¤ 10 Mã€‚Checkpoint å­˜å‚¨åœ¨ JobManager å†…å­˜ä¸­ï¼Œå› æ­¤æ€»å¤§å°ä¸è¶…è¿‡ JobManager çš„å†…å­˜ã€‚æ¨èä½¿ç”¨çš„åœºæ™¯ä¸ºï¼šæœ¬åœ°æµ‹è¯•ã€å‡ ä¹æ— çŠ¶æ€çš„ä½œä¸šï¼Œæ¯”å¦‚ ETLã€JobManager ä¸å®¹æ˜“æŒ‚ï¼Œæˆ–æŒ‚æ‰å½±å“ä¸å¤§çš„æƒ…å†µã€‚ä¸æ¨èåœ¨ç”Ÿäº§åœºæ™¯ä½¿ç”¨ã€‚å¦ä¸€ç§å°±æ˜¯åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ FsStateBackend ï¼Œæ„å»ºæ–¹æ³•æ˜¯éœ€è¦ä¼ ä¸€ä¸ªæ–‡ä»¶è·¯å¾„å’Œæ˜¯å¦å¼‚æ­¥å¿«ç…§ã€‚State ä¾ç„¶åœ¨ TaskManager å†…å­˜ä¸­ï¼Œä½†ä¸ä¼šåƒ MemoryStateBackend æœ‰ 5 M çš„è®¾ç½®ä¸Šé™ï¼ŒCheckpoint å­˜å‚¨åœ¨å¤–éƒ¨æ–‡ä»¶ç³»ç»Ÿï¼ˆæœ¬åœ°æˆ– HDFSï¼‰ï¼Œæ‰“ç ´äº†æ€»å¤§å° Jobmanager å†…å­˜çš„é™åˆ¶ã€‚å®¹é‡é™åˆ¶ä¸Šï¼Œå• TaskManager ä¸Š State æ€»é‡ä¸è¶…è¿‡å®ƒçš„å†…å­˜ï¼Œæ€»å¤§å°ä¸è¶…è¿‡é…ç½®çš„æ–‡ä»¶ç³»ç»Ÿå®¹é‡ã€‚æ¨èä½¿ç”¨çš„åœºæ™¯ã€å¸¸è§„ä½¿ç”¨çŠ¶æ€çš„ä½œä¸šã€ä¾‹å¦‚åˆ†é’Ÿçº§çª—å£èšåˆæˆ– joinã€éœ€è¦å¼€å¯ HA çš„ä½œä¸šã€‚è¿˜æœ‰ä¸€ç§å­˜å‚¨ä¸º RocksDBStateBackend ï¼ŒRocksDB æ˜¯ä¸€ä¸ª key/value çš„å†…å­˜å­˜å‚¨ç³»ç»Ÿï¼Œå’Œå…¶ä»–çš„ key/value ä¸€æ ·ï¼Œå…ˆå°†çŠ¶æ€æ”¾åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœå†…å­˜å¿«æ»¡æ—¶ï¼Œåˆ™å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œä½†éœ€è¦æ³¨æ„ RocksDB ä¸æ”¯æŒåŒæ­¥çš„ Checkpointï¼Œæ„é€ æ–¹æ³•ä¸­æ²¡æœ‰åŒæ­¥å¿«ç…§è¿™ä¸ªé€‰é¡¹ã€‚ä¸è¿‡ RocksDB æ”¯æŒå¢é‡çš„ Checkpointï¼Œä¹Ÿæ˜¯ç›®å‰å”¯ä¸€å¢é‡ Checkpoint çš„ Backendï¼Œæ„å‘³ç€æ¯æ¬¡ç”¨æˆ·ä¸éœ€è¦å°†æ‰€æœ‰çŠ¶æ€éƒ½å†™è¿›å»ï¼Œå°†å¢é‡çš„æ”¹å˜çš„çŠ¶æ€å†™è¿›å»å³å¯ã€‚å®ƒçš„ Checkpoint å­˜å‚¨åœ¨å¤–éƒ¨æ–‡ä»¶ç³»ç»Ÿï¼ˆæœ¬åœ°æˆ– HDFSï¼‰ï¼Œå…¶å®¹é‡é™åˆ¶åªè¦å•ä¸ª TaskManager ä¸Š State æ€»é‡ä¸è¶…è¿‡å®ƒçš„å†…å­˜ + ç£ç›˜ï¼Œå• Key æœ€å¤§ 2Gï¼Œæ€»å¤§å°ä¸è¶…è¿‡é…ç½®çš„æ–‡ä»¶ç³»ç»Ÿå®¹é‡å³å¯ã€‚æ¨èä½¿ç”¨çš„åœºæ™¯ä¸ºï¼šè¶…å¤§çŠ¶æ€çš„ä½œä¸šï¼Œä¾‹å¦‚å¤©çº§çª—å£èšåˆã€éœ€è¦å¼€å¯ HA çš„ä½œä¸šã€æœ€å¥½æ˜¯å¯¹çŠ¶æ€è¯»å†™æ€§èƒ½è¦æ±‚ä¸é«˜çš„ä½œä¸šã€‚**3. StateBackend çš„åˆ†ç±»ä¸‹é¢è¿™å¼ å›¾å¯¹ç›®å‰å¹¿æ³›ä½¿ç”¨çš„ä¸‰ç±» state backend åšäº†åŒºåˆ†ï¼Œå…¶ä¸­ç»¿è‰²è¡¨ç¤ºæ‰€åˆ›å»ºçš„operator/keyed state backend æ˜¯ on-heap çš„ï¼Œé»„è‰²åˆ™è¡¨ç¤ºæ˜¯ off-heap çš„ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œåœ¨ç”Ÿäº§ä¸­ï¼Œæˆ‘ä»¬ä¼šåœ¨ FsStateBackend å’Œ RocksDBStateBackend é—´é€‰æ‹©ï¼šFsStateBackendï¼šæ€§èƒ½æ›´å¥½ï¼›æ—¥å¸¸å­˜å‚¨æ˜¯åœ¨å †å†…å­˜ä¸­ï¼Œé¢ä¸´ç€ OOM çš„é£é™©ï¼Œä¸æ”¯æŒå¢é‡ checkpointã€‚RocksDBStateBackendï¼šæ— éœ€æ‹…å¿ƒ OOM é£é™©ï¼Œæ˜¯å¤§éƒ¨åˆ†æ—¶å€™çš„é€‰æ‹©ã€‚4.RocksDB StateBackend æ¦‚è§ˆå’Œç›¸å…³é…ç½®è®¨è®ºRocksDB æ˜¯ Facebook å¼€æºçš„ LSM çš„é”®å€¼å­˜å‚¨æ•°æ®åº“ï¼Œè¢«å¹¿æ³›åº”ç”¨äºå¤§æ•°æ®ç³»ç»Ÿçš„å•æœºç»„ä»¶ä¸­ã€‚Flink çš„ keyed state æœ¬è´¨ä¸Šæ¥è¯´å°±æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œæ‰€ä»¥ä¸ RocksDB çš„æ•°æ®æ¨¡å‹æ˜¯å»åˆçš„ã€‚ä¸‹å›¾åˆ†åˆ«æ˜¯ â€œwindow stateâ€ å’Œ â€œvalue stateâ€ åœ¨ RocksDB ä¸­çš„å­˜å‚¨æ ¼å¼ï¼Œæ‰€æœ‰å­˜å‚¨çš„ keyï¼Œvalue å‡è¢«åºåˆ—åŒ–æˆ bytes è¿›è¡Œå­˜å‚¨ã€‚åœ¨ RocksDB ä¸­ï¼Œæ¯ä¸ª state ç‹¬äº«ä¸€ä¸ª Column Familyï¼Œè€Œæ¯ä¸ª Column family ä½¿ç”¨å„è‡ªç‹¬äº«çš„ write buffer å’Œ block cacheï¼Œä¸Šå›¾ä¸­çš„ window state å’Œ value stateå®é™…ä¸Šåˆ†å±ä¸åŒçš„ column familyã€‚ä¸‹é¢ä»‹ç»ä¸€äº›å¯¹ RocksDB æ€§èƒ½æ¯”è¾ƒæœ‰å½±å“çš„å‚æ•°ï¼Œå¹¶æ•´ç†äº†ä¸€äº›ç›¸å…³çš„æ¨èé…ç½®ï¼Œè‡³äºå…¶ä»–é…ç½®é¡¹ï¼Œå¯ä»¥å‚é˜…ç¤¾åŒºç›¸å…³æ–‡æ¡£ã€‚çŠ¶æ€å»ºè®®state.backend.rocksdb.thread.numåå° flush å’Œ compaction çš„çº¿ç¨‹æ•°. é»˜è®¤å€¼ â€˜1â€˜. å»ºè®®è°ƒå¤§state.backend.rocksdb.writebuffer.countæ¯ä¸ª column family çš„ write buffer æ•°ç›®ï¼Œé»˜è®¤å€¼ â€˜2â€˜. å¦‚æœæœ‰éœ€è¦å¯ä»¥é€‚å½“è°ƒå¤§state.backend.rocksdb.writebuffer.sizeæ¯ä¸ª write buffer çš„ sizeï¼Œé»˜è®¤å€¼â€˜64MBâ€˜. å¯¹äºå†™é¢‘ç¹çš„åœºæ™¯ï¼Œå»ºè®®è°ƒå¤§state.backend.rocksdb.block.cache-sizeæ¯ä¸ª column family çš„ block cacheå¤§å°ï¼Œé»˜è®¤å€¼â€˜8MBâ€™ï¼Œå¦‚æœå­˜åœ¨é‡å¤è¯»çš„åœºæ™¯ï¼Œå»ºè®®è°ƒå¤§5.State best practiceï¼šä¸€äº›ä½¿ç”¨ state çš„å¿ƒå¾—Operator state ä½¿ç”¨å»ºè®®â–  æ…é‡ä½¿ç”¨é•¿ listä¸‹å›¾å±•ç¤ºçš„æ˜¯ç›®å‰ task ç«¯ operator state åœ¨æ‰§è¡Œå®Œ checkpoint è¿”å›ç»™ job master ç«¯çš„ StateMetaInfo çš„ä»£ç ç‰‡æ®µã€‚ç”±äº operator state æ²¡æœ‰ key group çš„æ¦‚å¿µï¼Œæ‰€ä»¥ä¸ºäº†å®ç°æ”¹å¹¶å‘æ¢å¤çš„åŠŸèƒ½ï¼Œéœ€è¦å¯¹ operator state ä¸­çš„æ¯ä¸€ä¸ªåºåˆ—åŒ–åçš„å…ƒç´ å­˜å‚¨ä¸€ä¸ªä½ç½®åç§» offsetï¼Œä¹Ÿå°±æ˜¯æ„æˆäº†ä¸Šå›¾çº¢æ¡†ä¸­çš„ offset æ•°ç»„ã€‚é‚£ä¹ˆå¦‚æœä½ çš„ operator state ä¸­çš„ list é•¿åº¦è¾¾åˆ°ä¸€å®šè§„æ¨¡æ—¶ï¼Œè¿™ä¸ª offset æ•°ç»„å°±å¯èƒ½ä¼šæœ‰å‡ å MB çš„è§„æ¨¡ï¼Œå…³é”®è¿™ä¸ªæ•°ç»„æ˜¯ä¼šè¿”å›ç»™ job masterï¼Œå½“ operator çš„å¹¶å‘æ•°ç›®å¾ˆå¤§æ—¶ï¼Œå¾ˆå®¹æ˜“è§¦å‘ job master çš„å†…å­˜è¶…ç”¨é—®é¢˜ã€‚æˆ‘ä»¬é‡åˆ°è¿‡ç”¨æˆ·æŠŠ operator state å½“åšé»‘åå•å­˜å‚¨ï¼Œç»“æœè¿™ä¸ªé»‘åå•è§„æ¨¡å¾ˆå¤§ï¼Œå¯¼è‡´ä¸€æ—¦å¼€å§‹æ‰§è¡Œ checkpointï¼Œjob master å°±ä¼šå› ä¸ºæ”¶åˆ° task å‘æ¥çš„â€œå·¨å¤§â€çš„ offset æ•°ç»„ï¼Œè€Œå†…å­˜ä¸æ–­å¢é•¿ç›´åˆ°è¶…ç”¨æ— æ³•æ­£å¸¸å“åº”ã€‚â–  æ­£ç¡®ä½¿ç”¨ UnionListState**union list state ç›®å‰è¢«å¹¿æ³›ä½¿ç”¨åœ¨ kafka connector ä¸­ï¼Œä¸è¿‡å¯èƒ½ç”¨æˆ·æ—¥å¸¸å¼€å‘ä¸­è¾ƒå°‘é‡åˆ°ï¼Œä»–çš„è¯­ä¹‰æ˜¯ä»æ£€æŸ¥ç‚¹æ¢å¤ä¹‹åæ¯ä¸ªå¹¶å‘ task å†…æ‹¿åˆ°çš„æ˜¯åŸå…ˆæ‰€æœ‰operator ä¸Šçš„ stateï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼škafka connector ä½¿ç”¨è¯¥åŠŸèƒ½ï¼Œä¸ºçš„æ˜¯ä»æ£€æŸ¥ç‚¹æ¢å¤æ—¶ï¼Œå¯ä»¥æ‹¿åˆ°ä¹‹å‰çš„å…¨å±€ä¿¡æ¯ï¼Œå¦‚æœç”¨æˆ·éœ€è¦ä½¿ç”¨è¯¥åŠŸèƒ½ï¼Œéœ€è¦åˆ‡è®°æ¢å¤çš„ task åªå–å…¶ä¸­çš„ä¸€éƒ¨åˆ†è¿›è¡Œå¤„ç†å’Œç”¨äºä¸‹ä¸€æ¬¡ snapshotï¼Œå¦åˆ™æœ‰å¯èƒ½éšç€ä½œä¸šä¸æ–­çš„é‡å¯è€Œå¯¼è‡´ state è§„æ¨¡ä¸æ–­å¢é•¿ã€‚6. Keyed state ä½¿ç”¨å»ºè®®â–  å¦‚ä½•æ­£ç¡®æ¸…ç©ºå½“å‰çš„ statestate.clear() å®é™…ä¸Šåªèƒ½æ¸…ç†å½“å‰ key å¯¹åº”çš„ value å€¼ï¼Œå¦‚æœæƒ³è¦æ¸…ç©ºæ•´ä¸ª stateï¼Œéœ€è¦å€ŸåŠ©äº applyToAllKeys æ–¹æ³•ï¼Œå…·ä½“ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼šå¦‚æœä½ çš„éœ€æ±‚ä¸­åªæ˜¯å¯¹ state æœ‰è¿‡æœŸéœ€æ±‚ï¼Œå€ŸåŠ©äº state TTL åŠŸèƒ½æ¥æ¸…ç†ä¼šæ˜¯ä¸€ä¸ªæ€§èƒ½æ›´å¥½çš„æ–¹æ¡ˆã€‚â–  RocksDB ä¸­è€ƒè™‘ value å€¼å¾ˆå¤§çš„æé™åœºæ™¯å—é™äº JNI bridge API çš„é™åˆ¶ï¼Œå•ä¸ª value åªæ”¯æŒ 2^31 bytes å¤§å°ï¼Œå¦‚æœå­˜åœ¨å¾ˆæé™çš„æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ MapState æ¥æ›¿ä»£ ListState æˆ–è€… ValueStateï¼Œå› ä¸ºRocksDB çš„ map state å¹¶ä¸æ˜¯å°†æ•´ä¸ª map ä½œä¸º value è¿›è¡Œå­˜å‚¨ï¼Œè€Œæ˜¯å°† map ä¸­çš„ä¸€ä¸ªæ¡ç›®ä½œä¸ºé”®å€¼å¯¹è¿›è¡Œå­˜å‚¨ã€‚â–  å¦‚ä½•çŸ¥é“å½“å‰ RocksDB çš„è¿è¡Œæƒ…å†µæ¯”è¾ƒç›´è§‚çš„æ–¹å¼æ˜¯æ‰“å¼€ RocksDB çš„ native metrics ï¼Œåœ¨é»˜è®¤ä½¿ç”¨ Flink managed memory æ–¹å¼çš„æƒ…å†µä¸‹ï¼Œstate.backend.rocksdb.metrics.block-cache-usage ï¼Œstate.backend.rocksdb.metrics.mem-table-flush-pendingï¼Œstate.backend.rocksdb.metrics.num-running-compactions ä»¥åŠ state.backend.rocksdb.metrics.num-running-flushes æ˜¯æ¯”è¾ƒé‡è¦çš„ç›¸å…³ metricsã€‚ä¸‹é¢è¿™å¼ å›¾æ˜¯ Flink-1.10 ä¹‹åï¼Œæ‰“å¼€ç›¸å…³ metrics çš„ç¤ºä¾‹å›¾ï¼šè€Œä¸‹é¢è¿™å¼ æ˜¯ Flink-1.10 ä¹‹å‰æˆ–è€…å…³é—­ state.backend.rocksdb.memory.managed çš„æ•ˆæœï¼šâ–  å®¹å™¨å†…è¿è¡Œçš„ RocksDB çš„å†…å­˜è¶…ç”¨é—®é¢˜åœ¨ Flink-1.10 ä¹‹å‰ï¼Œç”±äºä¸€ä¸ª state ç‹¬å è‹¥å¹² write buffer å’Œä¸€å— block cacheï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šå»ºè®®ç”¨æˆ·ä¸è¦åœ¨ä¸€ä¸ª operator å†…åˆ›å»ºè¿‡å¤šçš„ stateï¼Œå¦åˆ™éœ€è¦è€ƒè™‘åˆ°ç›¸åº”çš„é¢å¤–å†…å­˜ä½¿ç”¨é‡ï¼Œå¦åˆ™å®¹æ˜“é€ æˆåœ¨å®¹å™¨å†…è¿è¡Œæ—¶ï¼Œç›¸å…³è¿›ç¨‹è¢«å®¹å™¨ç¯å¢ƒæ‰€æ€ã€‚å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œéœ€è¦è€ƒè™‘ä¸€ä¸ª slot å†…æœ‰å¤šå°‘ RocksDB å®ä¾‹åœ¨è¿è¡Œï¼Œä¸€ä¸ª RocksDB ä¸­æœ‰å¤šå°‘ stateï¼Œæ•´ä½“çš„è®¡ç®—è§„åˆ™å°±å¾ˆå¤æ‚ï¼Œå¾ˆéš¾çœŸå¾—è½åœ°å®æ–½ã€‚Flink-1.10 ä¹‹åï¼Œç”±äºå¼•å…¥äº† RocksDB çš„å†…å­˜æ‰˜ç®¡æœºåˆ¶ï¼Œåœ¨ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œ RocksDB çš„è¿™ä¸€éƒ¨åˆ† native å†…å­˜æ˜¯å¯æ§çš„ï¼Œä¸è¿‡å—é™äº RocksDB çš„ç›¸å…³ cache å®ç°é™åˆ¶ï¼ˆè¿™é‡Œæš‚ä¸å±•å¼€ï¼Œåç»­ä¼šæœ‰æ–‡ç« è®¨è®ºï¼‰ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæ— æ³•åšåˆ°å®Œç¾æ§åˆ¶ï¼Œè¿™æ—¶å€™å»ºè®®æ‰“å¼€ä¸Šæ–‡æåˆ°çš„ native metricsï¼Œè§‚å¯Ÿç›¸å…³ block cache å†…å­˜ä½¿ç”¨æ˜¯å¦å­˜åœ¨è¶…ç”¨æƒ…å†µï¼Œå¯ä»¥å°†ç›¸å…³å†…å­˜æ·»åŠ åˆ° taskmanager.memory.task.off-heap.size ä¸­ï¼Œä½¿å¾— Flink æœ‰æ›´å¤šçš„ç©ºé—´ç»™ native å†…å­˜ä½¿ç”¨ã€‚7.ä¸€äº›ä½¿ç”¨ checkpoint çš„ä½¿ç”¨å»ºè®®â–  Checkpoint é—´éš”ä¸è¦å¤ªçŸ­è™½ç„¶ç†è®ºä¸Š Flink æ”¯æŒå¾ˆçŸ­çš„ checkpoint é—´éš”ï¼Œä½†æ˜¯åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œè¿‡çŸ­çš„é—´éš”å¯¹äºåº•å±‚åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿè€Œè¨€ï¼Œä¼šå¸¦æ¥å¾ˆå¤§çš„å‹åŠ›ã€‚å¦ä¸€æ–¹é¢ï¼Œç”±äºæ£€æŸ¥ç‚¹çš„è¯­ä¹‰ï¼Œæ‰€ä»¥å®é™…ä¸Š Flink ä½œä¸šå¤„ç† record ä¸æ‰§è¡Œ checkpoint å­˜åœ¨äº’æ–¥é”ï¼Œè¿‡äºé¢‘ç¹çš„ checkpointï¼Œå¯èƒ½ä¼šå½±å“æ•´ä½“çš„æ€§èƒ½ã€‚å½“ç„¶ï¼Œè¿™ä¸ªå»ºè®®çš„å‡ºå‘ç‚¹æ˜¯åº•å±‚åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„å‹åŠ›è€ƒè™‘ã€‚â–  åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´é»˜è®¤çš„è¶…æ—¶æ—¶é—´æ˜¯ 10minï¼Œå¦‚æœ state è§„æ¨¡å¤§ï¼Œåˆ™éœ€è¦åˆç†é…ç½®ã€‚æœ€åæƒ…å†µæ˜¯åˆ†å¸ƒå¼åœ°åˆ›å»ºé€Ÿåº¦å¤§äºå•ç‚¹ï¼ˆjob master ç«¯ï¼‰çš„åˆ é™¤é€Ÿåº¦ï¼Œå¯¼è‡´æ•´ä½“å­˜å‚¨é›†ç¾¤å¯ç”¨ç©ºé—´å‹åŠ›è¾ƒå¤§ã€‚å»ºè®®å½“æ£€æŸ¥ç‚¹é¢‘ç¹å› ä¸ºè¶…æ—¶è€Œå¤±è´¥æ—¶ï¼Œå¢å¤§è¶…æ—¶æ—¶é—´ã€‚**å››. æ€»ç»“1. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çŠ¶æ€ï¼Ÿå‰é¢æåˆ°æœ‰çŠ¶æ€çš„ä½œä¸šè¦æœ‰æœ‰çŠ¶æ€çš„é€»è¾‘ï¼Œæœ‰çŠ¶æ€çš„é€»è¾‘æ˜¯å› ä¸ºæ•°æ®ä¹‹é—´å­˜åœ¨å…³è”ï¼Œå•æ¡æ•°æ®æ˜¯æ²¡æœ‰åŠæ³•æŠŠæ‰€æœ‰çš„ä¿¡æ¯ç»™è¡¨ç°å‡ºæ¥ã€‚æ‰€ä»¥éœ€è¦é€šè¿‡çŠ¶æ€æ¥æ»¡è¶³ä¸šåŠ¡é€»è¾‘ã€‚2. ä¸ºä»€ä¹ˆè¦ç®¡ç†çŠ¶æ€ï¼Ÿä½¿ç”¨äº†çŠ¶æ€ï¼Œä¸ºä»€ä¹ˆè¦ç®¡ç†çŠ¶æ€ï¼Ÿå› ä¸ºå®æ—¶ä½œä¸šéœ€è¦ 7*24 ä¸é—´æ–­çš„è¿è¡Œï¼Œéœ€è¦åº”å¯¹ä¸å¯é çš„å› ç´ è€Œå¸¦æ¥çš„å½±å“ã€‚3. å¦‚ä½•é€‰æ‹©çŠ¶æ€çš„ç±»å‹å’Œå­˜å‚¨æ–¹å¼ï¼Ÿé‚£å¦‚ä½•é€‰æ‹©çŠ¶æ€çš„ç±»å‹å’Œå­˜å‚¨æ–¹å¼ï¼Ÿç»“åˆå‰é¢çš„å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆæ˜¯è¦åˆ†ææ¸…æ¥šä¸šåŠ¡åœºæ™¯ï¼›æ¯”å¦‚æƒ³è¦åšä»€ä¹ˆï¼ŒçŠ¶æ€åˆ°åº•å¤§ä¸å¤§ã€‚æ¯”è¾ƒå„ä¸ªæ–¹æ¡ˆçš„åˆ©å¼Šï¼Œé€‰æ‹©æ ¹æ®éœ€æ±‚åˆé€‚çš„çŠ¶æ€ç±»å‹å’Œå­˜å‚¨æ–¹å¼å³å¯ã€‚è½¬è½½è‡ªï¼šFlink State æœ€ä½³å®è·µApache Flink é›¶åŸºç¡€å…¥é—¨ï¼ˆå…­ï¼‰ï¼šçŠ¶æ€ç®¡ç†åŠå®¹é”™æœºåˆ¶","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"def neverGrowUp()","slug":"def-neverGrowUp","date":"2020-04-05T16:00:00.000Z","updated":"2020-04-05T15:10:24.541Z","comments":true,"path":"2020/04/06/def-neverGrowUp/","link":"","permalink":"cpeixin.cn/2020/04/06/def-neverGrowUp/","excerpt":"","text":"123456789def neverGrowUp() while true: å¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒ å¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒ å¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒ å¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒ å¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒ å¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒ å¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒå¼€å¿ƒ","categories":[],"tags":[]},{"title":"æŠ—ç–«è‹±é›„","slug":"æŠ—ç–«è‹±é›„","date":"2020-04-04T14:45:15.000Z","updated":"2020-04-05T14:46:33.308Z","comments":true,"path":"2020/04/04/æŠ—ç–«è‹±é›„/","link":"","permalink":"cpeixin.cn/2020/04/04/%E6%8A%97%E7%96%AB%E8%8B%B1%E9%9B%84/","excerpt":"","text":"è‡´æ•¬ç¼…æ€€æ¯ä¸€ä½æŠ—ç–«è‹±é›„","categories":[],"tags":[]},{"title":"python Flask & Ajax æ•°æ®ä¼ è¾“","slug":"python-Flask-Ajax-æ•°æ®ä¼ è¾“","date":"2020-03-11T14:43:01.000Z","updated":"2020-04-04T17:13:00.080Z","comments":true,"path":"2020/03/11/python-Flask-Ajax-æ•°æ®ä¼ è¾“/","link":"","permalink":"cpeixin.cn/2020/03/11/python-Flask-Ajax-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93/","excerpt":"","text":"å¸®æœ‹å‹å†™ä¸ªå°å·¥å…·ï¼Œæ²¡æƒ³åˆ°è¿˜è¦æå®šJSï¼Œå¤§å­¦æ¯•ä¸šåå°±æ²¡æœ‰å†™è¿‡JSï¼ŒçœŸçš„æ˜¯éš¾ä¸ºæˆ‘äº†ğŸ˜‚å¿™æ´»ä¸‰ä¸ªå°æ—¶ï¼Œç»ˆäºæŠŠå‰ç«¯å’Œåç«¯æ‰“é€šäº†ï½ï½å‰ç«¯demoï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;script src=\"http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js\"&gt;&lt;/script&gt;&lt;body&gt;&lt;!-- å‘é€æ•°æ®ï¼Œè¡¨å•æ–¹å¼ ï¼ˆæ³¨æ„ï¼šåç«¯æ¥æ”¶æ•°æ®å¯¹åº”ä»£ç ä¸åŒï¼‰--&gt;&lt;form action=\"&#123;&#123; url_for('send_message') &#125;&#125;\" method=\"post\"&gt; &lt;textarea name =\"domain\" rows=\"30\" cols=\"100\" placeholder=\"è¯·è¾“å…¥éœ€è¦æŸ¥è¯¢çš„åŸŸå,å¦‚cq5999.com\"&gt;&lt;/textarea&gt; &lt;!--&lt;input id=\"submit\" type=\"submit\" value=\"å‘é€\"&gt;--&gt; &lt;button type=\"submit\" id=\"btn-bq\" data-toggle=\"modal\" data-target=\"#myModal\"&gt;æŸ¥è¯¢&lt;/button&gt;&lt;/form&gt;&lt;!-- å‘é€æ•°æ®ï¼Œinputæ–¹å¼ ï¼ˆæ³¨æ„ï¼šåç«¯æ¥æ”¶æ•°æ®å¯¹åº”ä»£ç ä¸åŒï¼‰ --&gt;&lt;div&gt; &lt;label for=\"send_content\"&gt;å‘åå°å‘é€æ¶ˆæ¯ï¼š&lt;/label&gt; &lt;input id=\"send_content\" type=\"text\" name=\"send_content\"&gt; &lt;input id=\"send\" type=\"button\" value=\"å‘é€\"&gt;&lt;/div&gt;&lt;div&gt; &lt;label for=\"recv_content\"&gt;ä»åå°æ¥æ”¶æ¶ˆæ¯ï¼š&lt;/label&gt; &lt;input id=\"recv_content\" type=\"text\" name=\"recv_content\"&gt;&lt;/div&gt;&lt;!-- inputæ–¹å¼ å¯¹åº”çš„jsä»£ç ï¼Œå¦‚ç”¨è¡¨å•æ–¹å¼è¯·æ³¨é‡Šæ‰ --&gt;&lt;!-- å‘é€ --&gt;&lt;script type=\"text/javascript\"&gt; $(\"#send\").click(function () &#123; var message = $(\"#send_content\").val() alert(message) $.ajax(&#123; url:\"/send_message\", type:\"POST\", data:&#123; message:message &#125;, dataType: 'json', success:function (data) &#123; &#125; &#125;) &#125;)&lt;/script&gt;&lt;!-- æ¥æ”¶ --&gt;&lt;script type=\"text/javascript\"&gt; $(\"#send\").click(function () &#123; $.getJSON(\"/change_to_json\",function (data) &#123; $(\"#recv_content\").val(data.message) //å°†åç«¯æ•°æ®æ˜¾ç¤ºåœ¨å‰ç«¯ console.log(\"ä¼ åˆ°å‰ç«¯çš„æ•°æ®çš„ç±»å‹ï¼š\" + typeof (data.message)) $(\"#send_content\").val(\"\")//å‘é€çš„è¾“å…¥æ¡†æ¸…ç©º &#125;) &#125;)&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;åç«¯demo:1234567891011121314151617181920212223242526272829303132333435from flask import Flask, render_template, request, jsonifyapp = Flask(__name__)@app.route('/')def index(): return render_template(\"index_v6.html\")@app.route('/send_message', methods=['POST'])def send_message(): global message_get message_get = \"\" message_get = request.form[\"domain\"].split('\\n') # message_get = request.form['message'] #inputæäº¤ print(\"æ”¶åˆ°å‰ç«¯å‘è¿‡æ¥çš„ä¿¡æ¯ï¼š%s\" % message_get) print(\"æ”¶åˆ°æ•°æ®çš„ç±»å‹ä¸ºï¼š\" + str(type(message_get))) return \"æ”¶åˆ°æ¶ˆæ¯\"@app.route('/change_to_json', methods=['GET'])def change_to_json(): global message_get message_json = &#123; \"message\": message_get &#125; return jsonify(message_json)if __name__ == '__main__': app.run(host='0.0.0.0', port=80,debug=True)","categories":[{"name":"python","slug":"python","permalink":"cpeixin.cn/categories/python/"}],"tags":[{"name":"flask","slug":"flask","permalink":"cpeixin.cn/tags/flask/"}]},{"title":"Python Flaskæ¥å£è®¾è®¡-ç¤ºä¾‹","slug":"Python-Flaskæ¥å£è®¾è®¡-ç¤ºä¾‹","date":"2020-03-10T15:08:35.000Z","updated":"2020-04-04T17:12:52.356Z","comments":true,"path":"2020/03/10/Python-Flaskæ¥å£è®¾è®¡-ç¤ºä¾‹/","link":"","permalink":"cpeixin.cn/2020/03/10/Python-Flask%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-%E7%A4%BA%E4%BE%8B/","excerpt":"","text":"Get è¯·æ±‚å¼€å‘ä¸€ä¸ªåªæ¥å—getæ–¹æ³•çš„æ¥å£ï¼Œæ¥å—å‚æ•°ä¸ºnameå’Œageï¼Œå¹¶è¿”å›ç›¸åº”å†…å®¹ã€‚**æ–¹æ³• 1:****123456789101112131415161718192021222324252627282930313233343536from flask import Flaskfrom flask import requestfrom flask import redirectfrom flask import jsonifyimport jsonapp = Flask(__name__)@app.route(\"/test_1.0\", methods=[\"GET\"])def check(): # é»˜è®¤è¿”å›å†…å®¹ return_dict = &#123;'return_code': '200', 'return_info': 'å¤„ç†æˆåŠŸ', 'result': False&#125; # åˆ¤æ–­å…¥å‚æ˜¯å¦ä¸ºç©º if request.args is None: return_dict['return_code'] = '5004' return_dict['return_info'] = 'è¯·æ±‚å‚æ•°ä¸ºç©º' return json.dumps(return_dict, ensure_ascii=False) # è·å–ä¼ å…¥çš„paramså‚æ•° get_data = request.args.to_dict() name = get_data.get('name') age = get_data.get('age') # å¯¹å‚æ•°è¿›è¡Œæ“ä½œ return_dict['result'] = tt(name, age) return json.dumps(return_dict, ensure_ascii=False)# åŠŸèƒ½å‡½æ•°def tt(name, age): result_str = \"%sä»Šå¹´%så²\" % (name, age) return result_strif __name__ == '__main__': app.run(host='0.0.0.0', port=80)æ­¤ç§æ–¹å¼å¯¹åº”çš„requestè¯·æ±‚æ–¹å¼ï¼šæ‹¼æ¥è¯·æ±‚é“¾æ¥, ç›´æ¥è¯·æ±‚ï¼šhttp://0.0.0.0/test_1.0?name=ccc&amp;age=18request è¯·æ±‚ä¸­å¸¦æœ‰å‚æ•°ï¼Œå¦‚ä¸‹å›¾æ–¹æ³• 2:123@app.route('/api/banWordSingle/&lt;string:word&gt;', methods=['GET'])def banWordSingleStart(word): return getWordStatus(word)æ­¤æ–¹æ³• ä¸ æ–¹æ³• 1 ä¸­çš„æ‹¼æ¥é“¾æ¥ç›¸ä¼¼ï¼Œä½†æ˜¯ä¸ç”¨è¾“å…¥å…³é”®å­—è¯·æ±‚é“¾æ¥ï¼šhttp://0.0.0.0/api/banWordSingle/è¾“å…¥è¯Post è¯·æ±‚123456789101112131415161718192021222324252627282930313233343536from flask import Flaskfrom flask import requestfrom flask import redirectfrom flask import jsonifyimport jsonapp = Flask(__name__)@app.route(\"/test_1.0\", methods=[\"POST\"])def check(): # é»˜è®¤è¿”å›å†…å®¹ return_dict = &#123;'return_code': '200', 'return_info': 'å¤„ç†æˆåŠŸ', 'result': False&#125; # åˆ¤æ–­å…¥å‚æ˜¯å¦ä¸ºç©º if request.args is None: return_dict['return_code'] = '5004' return_dict['return_info'] = 'è¯·æ±‚å‚æ•°ä¸ºç©º' return json.dumps(return_dict, ensure_ascii=False) # è·å–ä¼ å…¥çš„paramså‚æ•° get_data = request.args.to_dict() name = get_data.get('name') age = get_data.get('age') # å¯¹å‚æ•°è¿›è¡Œæ“ä½œ return_dict['result'] = tt(name, age) return json.dumps(return_dict, ensure_ascii=False)# åŠŸèƒ½å‡½æ•°def tt(name, age): result_str = \"%sä»Šå¹´%så²\" % (name, age) return result_strif __name__ == '__main__': app.run(host='0.0.0.0', port=8080)è¯·æ±‚æ–¹å¼ï¼š","categories":[{"name":"python","slug":"python","permalink":"cpeixin.cn/categories/python/"}],"tags":[{"name":"flask","slug":"flask","permalink":"cpeixin.cn/tags/flask/"}]},{"title":"Flink 1.10ç‰ˆæœ¬å‘å¸ƒ","slug":"Flink-1-10ç‰ˆæœ¬å‘å¸ƒ","date":"2020-02-12T17:22:22.000Z","updated":"2020-06-03T14:38:01.179Z","comments":true,"path":"2020/02/13/Flink-1-10ç‰ˆæœ¬å‘å¸ƒ/","link":"","permalink":"cpeixin.cn/2020/02/13/Flink-1-10%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/","excerpt":"","text":"Apache Flinkç¤¾åŒºå¾ˆé«˜å…´èƒ½è¾¾åˆ°ä¸¤ä½æ•°å¹¶å®£å¸ƒå‘å¸ƒFlink 1.10.0ï¼ç”±äºè¿„ä»Šä¸ºæ­¢ç¤¾åŒºæœ€å¤§çš„åŠªåŠ›ï¼Œå·²å®æ–½äº†1.2kä¸ªé—®é¢˜ï¼Œè´¡çŒ®äº†200å¤šä¸ªè´¡çŒ®è€…ï¼Œæ­¤ç‰ˆæœ¬å¼•å…¥äº†å¯¹Flinkä½œä¸šçš„æ•´ä½“æ€§èƒ½å’Œç¨³å®šæ€§çš„é‡å¤§æ”¹è¿›ï¼ŒåŸç”ŸKubernetesé›†æˆçš„é¢„è§ˆä»¥åŠPythonæ”¯æŒçš„å·¨å¤§è¿›æ­¥ï¼ˆPyFlinkï¼‰ã€‚(Sparkå¯¹Pythonçš„æ”¯æŒä¹Ÿè¶Šæ¥è¶Šå¥½ğŸ˜‚)Flink 1.10è¿˜æ ‡å¿—ç€Blinké›†æˆçš„å®Œæˆï¼Œå¼ºåŒ–äº†æµæ•°æ®SQLå¹¶é€šè¿‡å¯ç”¨äºç”Ÿäº§çš„Hiveé›†æˆå’ŒTPC-DSè¦†ç›–å°†æˆç†Ÿçš„æ‰¹å¤„ç†å¼•å…¥Flinkã€‚è¿™ç¯‡åšå®¢æ–‡ç« æè¿°äº†æ‰€æœ‰ä¸»è¦çš„æ–°åŠŸèƒ½å’Œæ”¹è¿›ï¼Œéœ€è¦æ³¨æ„çš„é‡è¦æ›´æ”¹ä»¥åŠé¢„æœŸçš„å‘å±•ã€‚ç°åœ¨å¯ä»¥åœ¨Flinkç½‘ç«™çš„æ›´æ–°çš„â€œ ä¸‹è½½â€é¡µé¢ä¸Šæ‰¾åˆ°äºŒè¿›åˆ¶åˆ†å‘æ–‡ä»¶å’Œæºå·¥ä»¶ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹å®Œæ•´çš„å‘è¡Œå˜æ›´æ—¥å¿—å’Œæ›´æ–°çš„æ–‡æ¡£ã€‚æˆ‘ä»¬é¼“åŠ±æ‚¨ä¸‹è½½å‘è¡Œç‰ˆï¼Œå¹¶é€šè¿‡Flinké‚®ä»¶åˆ—è¡¨æˆ–JIRAä¸ç¤¾åŒºåˆ†äº«æ‚¨çš„åé¦ˆã€‚æ–°åŠŸèƒ½å’Œæ”¹è¿›æ”¹è¿›çš„å†…å­˜ç®¡ç†å’Œé…ç½®ç›®å‰Flinkä¸­çš„TaskExecutorå†…å­˜é…ç½®å­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼Œè¿™äº›ç¼ºç‚¹ä½¿å¾—éš¾ä»¥æ¨ç†æˆ–ä¼˜åŒ–èµ„æºåˆ©ç”¨ç‡ï¼Œä¾‹å¦‚ï¼šæµå¤„ç†å’Œæ‰¹å¤„ç†æ‰§è¡Œä¸­ç”¨äºå†…å­˜å ç”¨çš„ä¸åŒé…ç½®æ¨¡å‹ï¼›æµå¤„ç†æ‰§è¡Œä¸­å †å¤–çŠ¶æ€åç«¯ï¼ˆå³RocksDBï¼‰çš„å¤æ‚ä¸”ä¾èµ–ç”¨æˆ·çš„é…ç½®ã€‚ä¸ºäº†ä½¿å†…å­˜é€‰é¡¹å¯¹ç”¨æˆ·æ›´æ˜ç¡®å’Œç›´è§‚ï¼ŒFlink 1.10å¯¹TaskExecutorå†…å­˜æ¨¡å‹å’Œé…ç½®é€»è¾‘ï¼ˆFLIP-49ï¼‰è¿›è¡Œäº†é‡å¤§æ›´æ”¹ã€‚è¿™äº›æ›´æ”¹ä½¿Flinkæ›´é€‚åˆäºå„ç§éƒ¨ç½²ç¯å¢ƒï¼ˆä¾‹å¦‚Kubernetesï¼ŒYarnï¼ŒMesosï¼‰ï¼Œä»è€Œä½¿ç”¨æˆ·å¯ä»¥ä¸¥æ ¼æ§åˆ¶å…¶å†…å­˜æ¶ˆè€—ã€‚æ‰˜ç®¡å†…å­˜æ‰©å±•æ‰˜ç®¡å†…å­˜å·²ç»æ‰©å±•æ‰©å±•ï¼Œå½“ç„¶è¿˜è€ƒè™‘äº†RocksDB StateBackendçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚è™½ç„¶æ‰¹å¤„ç†ä½œä¸šå¯ä»¥ä½¿ç”¨å †å†…ï¼ˆon-heapï¼‰æˆ–å †å¤–ï¼ˆoff-heapï¼‰å†…å­˜ï¼Œä½†å…·æœ‰è¿™äº›åŠŸèƒ½çš„æµä½œä¸šRocksDBStateBackendåªèƒ½ä½¿ç”¨å †å†…å†…å­˜ã€‚å› æ­¤ï¼Œä¸ºäº†å…è®¸ç”¨æˆ·åœ¨æµæ‰§è¡Œå’Œæ‰¹å¤„ç†æ‰§è¡Œä¹‹é—´åˆ‡æ¢è€Œä¸å¿…ä¿®æ”¹ç¾¤é›†é…ç½®ï¼Œæ‰˜ç®¡å†…å­˜ç°åœ¨å§‹ç»ˆå¤„äºå †å¤–çŠ¶æ€ã€‚ç®€åŒ–RocksDBé…ç½®**æ›¾ç»é…ç½®åƒRocksDBè¿™æ ·çš„off-heap (å †å¤–)state backendæ¶‰åŠå¤§é‡çš„æ‰‹åŠ¨è°ƒæ•´ï¼Œä¾‹å¦‚å‡å°JVMå †å¤§å°æˆ–å°†Flinkè®¾ç½®ä¸ºä½¿ç”¨å †å¤–å†…å­˜ã€‚ç°åœ¨å¯ä»¥é€šè¿‡Flinkçš„ç°æˆé…ç½®æ¥å®ç°ï¼Œå¹¶ä¸”è°ƒæ•´RocksDBStateBackendå†…å­˜é¢„ç®—å°±åƒè°ƒæ•´å†…å­˜å¤§å°ä¸€æ ·ç®€å•ã€‚å¦ä¸€ä¸ªé‡è¦çš„æ”¹è¿›æ˜¯å…è®¸Flinkç»‘å®šRocksDBæœ¬åœ°å†…å­˜ä½¿ç”¨æƒ…å†µï¼ˆFLINK-7289ï¼‰ï¼Œä»è€Œé˜²æ­¢å…¶è¶…å‡ºæ€»å†…å­˜é¢„ç®—-è¿™åœ¨Kubernetesç­‰å®¹å™¨åŒ–ç¯å¢ƒä¸­å°¤å…¶é‡è¦ã€‚æœ‰å…³å¦‚ä½•å¯ç”¨å’Œè°ƒæ•´æ­¤åŠŸèƒ½çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…Tuning RocksDBã€‚æ³¨æ„ FLIP-49æ›´æ”¹äº†ç¾¤é›†èµ„æºé…ç½®çš„è¿‡ç¨‹ï¼Œè¿™å¯èƒ½éœ€è¦è°ƒæ•´ç¾¤é›†ä»¥ä»ä»¥å‰çš„Flinkç‰ˆæœ¬è¿›è¡Œå‡çº§ã€‚æœ‰å…³æ‰€å¼•å…¥æ›´æ”¹å’Œè°ƒæ•´æŒ‡å—çš„å…¨é¢æ¦‚è¿°ï¼Œè¯·å‚é˜…æ­¤è®¾ç½®ã€‚æäº¤ä½œä¸šçš„ç»Ÿä¸€é€»è¾‘åœ¨æ­¤ç‰ˆæœ¬ä¹‹å‰ï¼Œæäº¤ä½œä¸šæ˜¯æ‰§è¡Œç¯å¢ƒçš„ä¸€éƒ¨åˆ†èŒè´£ï¼Œå¹¶ä¸”ä¸ä¸åŒçš„éƒ¨ç½²ç›®æ ‡ï¼ˆä¾‹å¦‚ï¼ŒYarnï¼ŒKubernetesï¼ŒMesosï¼‰ç´§å¯†ç›¸å…³ã€‚è¿™å¯¼è‡´å…³æ³¨ç‚¹åˆ†ç¦»ä¸ä½³ï¼Œå¹¶ä¸”éšç€æ—¶é—´çš„æµé€ï¼Œç”¨æˆ·éœ€è¦å•ç‹¬é…ç½®å’Œç®¡ç†çš„å®šåˆ¶ç¯å¢ƒè¶Šæ¥è¶Šå¤šã€‚åœ¨Flink 1.10ä¸­ï¼Œä½œä¸šæäº¤é€»è¾‘è¢«æŠ½è±¡åˆ°é€šç”¨Executoræ¥å£ï¼ˆFLIP-73ï¼‰ä¸­ã€‚å¦å¤–ExecutorCLIï¼ˆFLIP-81ï¼‰å¼•å…¥äº†ä¸€ä¸ªç»Ÿä¸€çš„æ–¹å¼å»æŒ‡å®šé…ç½®å‚æ•°å¯¹äºä»»ä½• æ‰§è¡Œå¯¹è±¡ã€‚ä¸ºäº†å®Œå–„è¿™é¡¹å·¥ä½œï¼Œç»“æœæ£€ç´¢çš„è¿‡ç¨‹ä¹Ÿä¸ä½œä¸šæäº¤åˆ†ç¦»ï¼Œå¼•å…¥äº†JobClientï¼ˆFLINK-74ï¼‰æ¥è´Ÿè´£è·å–JobExecutionResultã€‚ç‰¹åˆ«æ˜¯ï¼Œè¿™äº›æ›´æ”¹é€šè¿‡ä¸ºç”¨æˆ·æä¾›Flinkçš„ç»Ÿä¸€å…¥å£ç‚¹ï¼Œä½¿åœ¨ä¸‹æ¸¸æ¡†æ¶ï¼ˆä¾‹å¦‚Apache Beamæˆ–Zeppelinäº¤äº’å¼ç¬”è®°æœ¬ï¼‰ä¸­ä»¥ç¼–ç¨‹æ–¹å¼ä½¿ç”¨Flinkå˜å¾—æ›´åŠ å®¹æ˜“ã€‚å¯¹äºè·¨å¤šä¸ªç›®æ ‡ç¯å¢ƒä½¿ç”¨Flinkçš„ç”¨æˆ·ï¼Œå‘åŸºäºé…ç½®çš„æ‰§è¡Œè¿‡ç¨‹çš„è¿‡æ¸¡è¿˜å¯ä»¥æ˜¾ç€å‡å°‘æ ·æ¿ä»£ç å’Œå¯ç»´æŠ¤æ€§å¼€é”€ã€‚åŸç”ŸKubernetesé›†æˆï¼ˆæµ‹è¯•ç‰ˆï¼‰å¯¹äºå¸Œæœ›åœ¨å®¹å™¨åŒ–ç¯å¢ƒä¸Šå¼€å§‹ä½¿ç”¨Flinkçš„ç”¨æˆ·ï¼Œåœ¨Kubernetesä¹‹ä¸Šéƒ¨ç½²å’Œç®¡ç†ç‹¬ç«‹é›†ç¾¤éœ€è¦æœ‰å…³å®¹å™¨ï¼Œç®—å­å’Œç¯å¢ƒå·¥å…·kubectlçš„ä¸€äº›çŸ¥è¯†ã€‚åœ¨Flink 1.10ä¸­ï¼Œæˆ‘ä»¬æ¨å‡ºäº†Active Kubernetesé›†æˆï¼ˆFLINK-9953ï¼‰çš„ç¬¬ä¸€é˜¶æ®µï¼Œå…¶ä¸­ï¼Œâ€œä¸»åŠ¨â€æŒ‡ Flink ResourceManager (K8sResMngr) åŸç”Ÿåœ°ä¸ Kubernetes é€šä¿¡ï¼Œåƒ Flink åœ¨ Yarn å’Œ Mesos ä¸Šä¸€æ ·æŒ‰éœ€ç”³è¯· podã€‚ç”¨æˆ·å¯ä»¥åˆ©ç”¨ namespaceï¼Œåœ¨å¤šç§Ÿæˆ·ç¯å¢ƒä¸­ä»¥è¾ƒå°‘çš„èµ„æºå¼€é”€å¯åŠ¨ Flinkã€‚è¿™éœ€è¦ç”¨æˆ·æå‰é…ç½®å¥½ RBAC è§’è‰²å’Œæœ‰è¶³å¤Ÿæƒé™çš„æœåŠ¡è´¦å·ã€‚æ­£å¦‚åˆšåˆšè®²åˆ°çš„ï¼ŒFlink 1.10ä¸­çš„æ‰€æœ‰å‘½ä»¤è¡Œé€‰é¡¹éƒ½æ˜ å°„åˆ°ç»Ÿä¸€é…ç½®ã€‚å› æ­¤ï¼Œç”¨æˆ·å¯ä»¥ç®€å•åœ°å¼•ç”¨Kubernetesé…ç½®é€‰é¡¹ï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨CLIä¸­å°†ä½œä¸šæäº¤åˆ°Kubernetesä¸Šçš„ç°æœ‰Flinkä¼šè¯ï¼š1.&#x2F;bin&#x2F;flink run -d -e kubernetes-session -Dkubernetes.cluster-id&#x3D;&lt;ClusterId&gt; examples&#x2F;streaming&#x2F;WindowJoin.jarå¦‚æœæ‚¨æƒ³å°è¯•ä½¿ç”¨æ­¤é¢„è§ˆåŠŸèƒ½ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨é€æ­¥å®Œæˆæœ¬æœºKubernetesçš„å®‰è£…ï¼Œè¯•ç”¨å¹¶ä¸ç¤¾åŒºåˆ†äº«åé¦ˆã€‚Table API / SQLï¼šç”Ÿäº§å°±ç»ªçš„Hiveé›†æˆHiveé›†æˆåœ¨Flink 1.9ä¸­å®£å¸ƒä¸ºé¢„è§ˆåŠŸèƒ½ã€‚æ­¤é¢„è§ˆå…è®¸ç”¨æˆ·ä½¿ç”¨SQL DDLå°†Flink-specificå…ƒæ•°æ®ï¼ˆä¾‹å¦‚Kafkaè¡¨ï¼‰ä¿ç•™åœ¨Hive Metastoreä¸­ï¼Œè°ƒç”¨Hiveä¸­å®šä¹‰çš„UDFå¹¶ä½¿ç”¨Flinkè¯»å–å’Œå†™å…¥Hiveè¡¨ã€‚Flink 1.10é€šè¿‡è¿›ä¸€æ­¥çš„å¼€å‘ä½¿è¿™é¡¹å·¥ä½œæ›´åŠ åœ†æ»¡ï¼Œè¿™äº›å¼€å‘ä½¿å¯ç«‹å³æŠ•å…¥ç”Ÿäº§çš„Hiveé›†æˆåˆ°Flinkï¼Œå¹¶å…·æœ‰ä¸å¤§å¤šæ•°Hiveç‰ˆæœ¬çš„å®Œå…¨å…¼å®¹æ€§ã€‚æ‰¹å¤„ç†SQLçš„æœ¬åœ°åˆ†åŒºæ”¯æŒ1.10ç‰ˆæœ¬ä»¥å‰ï¼Œä»…æ”¯æŒå¯¹æœªåˆ†åŒºçš„Hiveè¡¨è¿›è¡Œå†™å…¥ã€‚åœ¨Flink 1.10ä¸­ï¼ŒFlink SQLè¯­æ³•å·²é€šè¿‡INSERT OVERWRITEå’ŒPARTITIONï¼ˆFLIP-63ï¼‰è¿›è¡Œäº†æ‰©å±•ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿåœ¨Hiveä¸­å†™å…¥é™æ€å’ŒåŠ¨æ€åˆ†åŒºã€‚é™æ€åˆ†åŒºå†™å…¥**1INSERT &#123; INTO | OVERWRITE &#125; TABLE tablename1 [PARTITION (partcol1&#x3D;val1, partcol2&#x3D;val2 ...)] select_statement1 FROM from_statement;åŠ¨æ€åˆ†åŒºç¼–å†™**1INSERT &#123; INTO | OVERWRITE &#125; TABLE tablename1 select_statement1 FROM from_statement;Flinkå¯¹äºåˆ†åŒºè¡¨çš„å…¨é¢æ”¯æŒï¼Œå…è®¸ç”¨æˆ·åˆ©ç”¨è¯»å–æ—¶çš„åˆ†åŒºä¿®å‰ªåŠŸèƒ½ï¼Œé€šè¿‡å‡å°‘éœ€è¦æ‰«æçš„æ•°æ®é‡æ¥æ˜¾ç€æé«˜è¿™äº›æ“ä½œçš„æ€§èƒ½ã€‚è¿›ä¸€æ­¥ä¼˜åŒ–é™¤äº†åˆ†åŒºä¿®å‰ªå¤–ï¼ŒFlink 1.10è¿˜ä¸ºHiveé›†æˆå¼•å…¥äº†æ›´å¤šè¯»å–ä¼˜åŒ–ï¼Œä¾‹å¦‚ï¼šæŠ•å½±ä¸‹æ¨ï¼š Flinké€šè¿‡çœç•¥è¡¨æ‰«æä¸­ä¸å¿…è¦çš„å­—æ®µï¼Œåˆ©ç”¨æŠ•å½±ä¸‹æ¨æ¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘Flinkå’ŒHiveè¡¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€‚è¿™å¯¹äºå…·æœ‰å¤§é‡åˆ—çš„è¡¨å°¤å…¶æœ‰åˆ©ã€‚LIMITä¸‹æ¨ï¼šå¯¹äºå¸¦æœ‰LIMITå­å¥çš„æŸ¥è¯¢ï¼ŒFlinkå°†å°½å¯èƒ½é™åˆ¶è¾“å‡ºè®°å½•çš„æ•°é‡ï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘é€šè¿‡ç½‘ç»œä¼ è¾“çš„æ•°æ®é‡ã€‚è¯»å–æ—¶è¿›è¡ŒORCçŸ¢é‡åŒ–ï¼šä¸ºäº†æé«˜ORCæ–‡ä»¶çš„è¯»å–æ€§èƒ½ï¼ŒFlinkç°åœ¨é»˜è®¤å°†æœ¬æœºORCçŸ¢é‡åŒ–é˜…è¯»å™¨ç”¨äº2.0.0ä»¥ä¸Šçš„Hiveç‰ˆæœ¬ä»¥åŠå…·æœ‰éå¤æ‚æ•°æ®ç±»å‹çš„åˆ—ã€‚å¯æ’æ‹”æ¨¡å—ä½œä¸ºFlinkç³»ç»Ÿå¯¹è±¡ï¼ˆBetaï¼‰Flink 1.10å¼•å…¥äº†Flink Tableæ ¸å¿ƒä¸­å¯æ’æ‹”æ¨¡å—çš„é€šç”¨æœºåˆ¶ï¼Œé¦–å…ˆå…³æ³¨ç³»ç»ŸåŠŸèƒ½ï¼ˆFLIP-68ï¼‰ã€‚ä½¿ç”¨è¯¥æ¨¡å—ï¼Œç”¨æˆ·å¯ä»¥æ‰©å±•Flinkçš„ç³»ç»Ÿå¯¹è±¡ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨è¡Œä¸ºç±»ä¼¼äºFlinkç³»ç»ŸåŠŸèƒ½çš„Hiveå†…ç½®å‡½æ•°ã€‚è¯¥ç‰ˆæœ¬é™„å¸¦ä¸€ä¸ªé¢„å…ˆå®ç°çš„HiveModuleï¼Œæ”¯æŒå¤šä¸ªHiveç‰ˆæœ¬çš„ç‰ˆæœ¬ï¼Œä½†ç”¨æˆ·ä¹Ÿå¯ä»¥ç¼–å†™è‡ªå·±çš„å¯æ’æ‹”æ¨¡å—ã€‚Table API / SQLçš„å…¶ä»–æ”¹è¿›SQL DDLä¸­çš„æ°´å°å’Œè®¡ç®—åˆ—Flink 1.10æ”¯æŒç‰¹å®šäºæµçš„è¯­æ³•æ‰©å±•ï¼Œä»¥åœ¨Flink SQL DDLï¼ˆFLIP-66ï¼‰ä¸­å®šä¹‰æ—¶é—´å±æ€§å’Œæ°´å°ç”Ÿæˆã€‚è¿™å…è®¸åŸºäºæ—¶é—´çš„æ“ä½œï¼ˆä¾‹å¦‚åŠ çª—ï¼‰ï¼Œä»¥åŠåœ¨ä½¿ç”¨DDLè¯­å¥åˆ›å»ºçš„è¡¨ä¸Šå®šä¹‰æ°´å°ç­–ç•¥ã€‚12345CREATE TABLE table_name ( WATERMARK FOR columnName AS &lt;watermark_strategy_expression&gt;) WITH ( ...)æ­¤ç‰ˆæœ¬è¿˜å¼•å…¥äº†å¯¹è™šæ‹Ÿè®¡ç®—åˆ—ï¼ˆFLIP-70ï¼‰çš„æ”¯æŒï¼Œè¯¥åˆ—å¯åŸºäºåŒä¸€è¡¨ä¸­çš„å…¶ä»–åˆ—æˆ–ç¡®å®šæ€§è¡¨è¾¾å¼ï¼ˆå³ï¼Œæ–‡å­—å€¼ï¼ŒUDFå’Œå†…ç½®å‡½æ•°ï¼‰æ´¾ç”Ÿã€‚åœ¨Flinkä¸­ï¼Œè®¡ç®—åˆ—å¯ç”¨äºåœ¨åˆ›å»ºè¡¨æ—¶å®šä¹‰æ—¶é—´å±æ€§ã€‚SQL DDLçš„å…¶ä»–æ‰©å±•ç°åœ¨ï¼Œtemporary/persistent å’Œ system/catalogï¼ˆFLIP-57ï¼‰ä¹‹é—´æœ‰æ˜æ˜¾çš„åŒºåˆ«ã€‚è¿™ä¸ä»…æ¶ˆé™¤äº†å‡½æ•°å¼•ç”¨ä¸­çš„æ­§ä¹‰ï¼Œè€Œä¸”å…è®¸ç¡®å®šæ€§çš„å‡½æ•°è§£æé¡ºåºï¼ˆå³ï¼Œåœ¨å‘½åå†²çªçš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå‡½æ•°å°†ä¼˜å…ˆäºç›®å½•å‡½æ•°ï¼Œè€Œä¸´æ—¶å‡½æ•°çš„ä¼˜å…ˆçº§é«˜äºä¸¤ä¸ªç»´åº¦çš„æŒä¹…æ€§å‡½æ•°ï¼‰ã€‚éµå¾ªFLIP-57çš„åŸºç¡€çŸ¥è¯†ï¼Œæˆ‘ä»¬æ‰©å±•äº†SQL DDLè¯­æ³•ä»¥æ”¯æŒç›®å½•åŠŸèƒ½ï¼Œä¸´æ—¶åŠŸèƒ½å’Œä¸´æ—¶ç³»ç»ŸåŠŸèƒ½ï¼ˆFLIP-79ï¼‰çš„åˆ›å»ºï¼š123CREATE [TEMPORARY|TEMPORARY SYSTEM] FUNCTION [IF NOT EXISTS] [catalog_name.][db_name.]function_name AS identifier [LANGUAGE JAVA|SCALA]æœ‰å…³Flink SQLä¸­DDLæ”¯æŒçš„å½“å‰çŠ¶æ€çš„å®Œæ•´æ¦‚è¿°ï¼Œè¯·æŸ¥çœ‹æ›´æ–°çš„æ–‡æ¡£ã€‚æ³¨æ„**ä¸ºäº†å°†æ¥èƒ½æ­£ç¡®å¤„ç†å’Œä¿è¯å…ƒå¯¹è±¡ï¼ˆè¡¨ï¼Œè§†å›¾ï¼Œå‡½æ•°ï¼‰ä¹‹é—´çš„è¡Œä¸ºä¸€è‡´ï¼Œä¸å»ºè®®ä½¿ç”¨Table APIä¸­çš„æŸäº›å¯¹è±¡å£°æ˜æ–¹æ³•ï¼Œè€Œåº”ä½¿ç”¨æ›´æ¥è¿‘æ ‡å‡†SQL DDLçš„æ–¹æ³•ï¼ˆFLIP -64ï¼‰ã€‚TPC-DSçš„å®Œæ•´è¦†ç›–èŒƒå›´å¯æ‰¹é‡å¤„ç†TPC-DSæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„è¡Œä¸šæ ‡å‡†å†³ç­–æ”¯æŒåŸºå‡†ï¼Œç”¨äºè¯„ä¼°å’Œè¡¡é‡åŸºäºSQLçš„æ•°æ®å¤„ç†å¼•æ“çš„æ€§èƒ½ã€‚åœ¨Flink 1.10ä¸­ï¼Œç«¯åˆ°ç«¯ï¼ˆFLINK-11491ï¼‰æ”¯æŒæ‰€æœ‰TPC-DSæŸ¥è¯¢ï¼Œè¿™åæ˜ äº†å®ƒçš„SQLå¼•æ“å·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥æ»¡è¶³ç±»ä¼¼ç°ä»£æ•°æ®ä»“åº“çš„å·¥ä½œè´Ÿè½½çš„éœ€æ±‚ã€‚PyFlinkï¼šæ”¯æŒæœ¬æœºç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼ˆUDFï¼‰åœ¨ä»¥å‰çš„å‘è¡Œç‰ˆä¸­å¼•å…¥äº†PyFlinkçš„é¢„è§ˆç‰ˆï¼Œæœç€å®ç°Flinkä¸­å®Œå…¨Pythonæ”¯æŒçš„ç›®æ ‡è¿ˆè¿›äº†ä¸€æ­¥ã€‚å¯¹äºæ­¤å‘è¡Œç‰ˆï¼Œé‡ç‚¹æ˜¯ä½¿ç”¨æˆ·èƒ½å¤Ÿåœ¨è¡¨API / SQLï¼ˆFLIP-58ï¼‰ä¸­æ³¨å†Œå’Œä½¿ç”¨Pythonç”¨æˆ·å®šä¹‰å‡½æ•°ï¼ˆUDFï¼Œå·²è®¡åˆ’UDTF / UDAF ï¼‰ã€‚å¦‚æœæ‚¨å¯¹åŸºç¡€å®ç°æ„Ÿå…´è¶£ï¼ˆåˆ©ç”¨Apache Beamçš„å¯ç§»æ¤æ€§æ¡†æ¶ï¼‰ï¼Œè¯·å‚è€ƒFLIP-58çš„â€œæ¶æ„â€éƒ¨åˆ†ï¼Œä¹Ÿè¯·å‚è€ƒFLIP-78ã€‚è¿™äº›æ•°æ®ç»“æ„ä¸ºPandasæ”¯æŒå’ŒPyFlinkæœ€ç»ˆåˆ°è¾¾DataStream APIå¥ å®šäº†å¿…è¦çš„åŸºç¡€ã€‚ä»Flink 1.10å¼€å§‹ï¼Œç”¨æˆ·è¿˜å¯ä»¥pipä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è½»æ¾å®‰è£…PyFlink ï¼š1pip install apache-flinkæœ‰å…³PyFlinkè®¡åˆ’è¿›è¡Œçš„å…¶ä»–æ”¹è¿›çš„é¢„è§ˆï¼Œè¯·æŸ¥çœ‹FLINK-14500å¹¶å‚ä¸æœ‰å…³æ‰€éœ€ç”¨æˆ·åŠŸèƒ½çš„è®¨è®ºã€‚é‡è¦å˜åŒ–[ FLINK-10725 ] Flinkç°åœ¨å¯ä»¥ç¼–è¯‘å¹¶åœ¨Java 11ä¸Šè¿è¡Œã€‚[ FLINK-15495 ] Blinkè®¡åˆ’ç¨‹åºç°åœ¨æ˜¯SQL Clientä¸­çš„é»˜è®¤è®¾ç½®ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥ä»æ‰€æœ‰æœ€æ–°åŠŸèƒ½å’Œæ”¹è¿›ä¸­å—ç›Šã€‚åœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¸­ï¼Œè¿˜è®¡åˆ’ä»Table APIä¸­çš„æ—§è®¡åˆ’ç¨‹åºè¿›è¡Œåˆ‡æ¢ï¼Œå› æ­¤æˆ‘ä»¬å»ºè®®ç”¨æˆ·å¼€å§‹ç†Ÿæ‚‰Blinkè®¡åˆ’ç¨‹åºã€‚[ FLINK-13025 ]æœ‰ä¸€ä¸ªæ–°çš„Elasticsearchæ¥æ”¶å™¨è¿æ¥å™¨ï¼Œå®Œå…¨æ”¯æŒElasticsearch 7.xç‰ˆæœ¬ã€‚[ FLINK-15115 ] Kafka 0.8å’Œ0.9çš„è¿æ¥å™¨å·²æ ‡è®°ä¸ºä¸æ¨èä½¿ç”¨ï¼Œå°†ä¸å†å¾—åˆ°ç§¯ææ”¯æŒã€‚å¦‚æœæ‚¨ä»åœ¨ä½¿ç”¨è¿™äº›ç‰ˆæœ¬æˆ–æœ‰ä»»ä½•å…¶ä»–ç›¸å…³é—®é¢˜ï¼Œè¯·è”ç³»@devé‚®ä»¶åˆ—è¡¨ã€‚[ FLINK-14516 ]åˆ é™¤äº†éåŸºäºä¿¡ç”¨çš„ç½‘ç»œæµæ§åˆ¶ä»£ç ä»¥åŠé…ç½®é€‰é¡¹taskmanager.network.credit.modelã€‚å±•æœ›æœªæ¥ï¼ŒFlinkå°†å§‹ç»ˆä½¿ç”¨åŸºäºä¿¡ç”¨çš„æµé‡æ§åˆ¶ã€‚[ FLINK-12122 ] FLIP-6åœ¨Flink 1.5.0ä¸­æ¨å‡ºï¼Œå¹¶å¼•å…¥äº†ä¸ä»ä¸­åˆ†é…æ’æ§½æ–¹å¼æœ‰å…³çš„ä»£ç å›å½’TaskManagersã€‚è¦ä½¿ç”¨æ›´æ¥è¿‘FLIPä¹‹å‰è¡Œä¸ºçš„è°ƒåº¦ç­–ç•¥ï¼ˆFlinkå°è¯•å°†å·¥ä½œè´Ÿè½½åˆ†æ•£åˆ°æ‰€æœ‰å½“å‰å¯ç”¨çš„è¡Œä¸ºä¸­ï¼‰TaskManagersï¼Œç”¨æˆ·å¯ä»¥cluster.evenly-spread-out-slots: trueåœ¨ä¸­è®¾ç½®flink-conf.yamlã€‚[ FLINK-11956 ] s3-hadoopå’Œs3-prestoæ–‡ä»¶ç³»ç»Ÿä¸å†ä½¿ç”¨ç±»é‡å®šä½ï¼Œè€Œåº”é€šè¿‡æ’ä»¶åŠ è½½ï¼Œä½†ç°åœ¨å¯ä»¥ä¸æ‰€æœ‰å‡­æ®æä¾›ç¨‹åºæ— ç¼é›†æˆã€‚å¼ºçƒˆå»ºè®®å°†å…¶ä»–æ–‡ä»¶ç³»ç»Ÿä»…ç”¨ä½œæ’ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬å°†ç»§ç»­åˆ é™¤é‡å®šä½ã€‚Flink 1.9å¸¦æœ‰é‡æ„çš„Web UIï¼Œä¿ç•™äº†æ—§ç‰ˆçš„UIä½œä¸ºå¤‡ä»½ï¼Œä»¥é˜²ä¸‡ä¸€æŸäº›åŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå°šæœªæŠ¥å‘Šä»»ä½•é—®é¢˜ï¼Œå› æ­¤ç¤¾åŒºæŠ•ç¥¨å†³å®šåœ¨Flink 1.10ä¸­åˆ é™¤æ—§ç‰ˆWeb UIã€‚å‘è¡Œè¯´æ˜å¦‚æœæ‚¨æ‰“ç®—å°†è®¾ç½®å‡çº§åˆ°Flink 1.10ï¼Œè¯·ä»”ç»†æŸ¥çœ‹å‘è¡Œè¯´æ˜ï¼Œä»¥è·å–è¯¦ç»†çš„æ›´æ”¹å’Œæ–°åŠŸèƒ½åˆ—è¡¨ã€‚æ­¤ç‰ˆæœ¬ä¸ä»¥å‰çš„1.xç‰ˆæœ¬çš„APIå…¼å®¹ï¼Œè¿™äº›ç‰ˆæœ¬çš„APIä½¿ç”¨@Publicæ³¨é‡Šè¿›è¡Œäº†æ³¨é‡Šã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"IDEA install TabNine","slug":"IDEA-install-TabNine","date":"2020-01-22T02:26:15.000Z","updated":"2020-04-04T11:06:48.223Z","comments":true,"path":"2020/01/22/IDEA-install-TabNine/","link":"","permalink":"cpeixin.cn/2020/01/22/IDEA-install-TabNine/","excerpt":"","text":"TabNineæ˜¯æˆ‘ç›®å‰é‡åˆ°è¿‡æœ€å¥½çš„æ™ºèƒ½è¡¥å…¨å·¥å…·TabNineåŸºäºGPT-2çš„æ’ä»¶å®‰è£…IDEAç¼–è¯‘å™¨ï¼Œæ‰¾åˆ°pluginsWindows pycharmï¼šFile&gt;settings&gt;plugins;Mac pycharmï¼šperformence&gt;plugins&gt;marketplace or plugins&gt;Install JetBrains PluginsæŸ¥æ‰¾ TabNine, ç‚¹å‡» install, éšå restarté‡å¯åï¼šHelp&gt;Edit Custom Propertiesâ€¦&gt;Create;åœ¨è·³å‡ºæ¥çš„idea.propertiesä¸­è¾“å…¥ï¼ˆæ³¨ï¼šè‹±æ–‡å­—ç¬¦ï¼‰ TabNine::configéšå³ä¼šè‡ªåŠ¨å¼¹å‡ºTabNineæ¿€æ´»é¡µé¢ï¼›æ¿€æ´»ç‚¹å‡»Activation Keyä¸‹é¢çš„hereï¼›è¾“å…¥ä½ çš„é‚®ç®±å·ï¼›å¤åˆ¶ç²˜è´´é‚®ä»¶é‡Œé¢çš„API Keyåˆ°Activation Keyä¸‹é¢ï¼›ï¼ˆå¾—åˆ°çš„ key å¯ä»¥åœ¨å„ç§ç¼–è¯‘å™¨ä¸­å…±ç”¨ï¼‰ç­‰å¾…è‡ªåŠ¨å®‰è£…ï¼Œè§‚å¯Ÿé¡µé¢ï¼ˆæœ€ä¸‹é¢æœ‰logå¯ä»¥çœ‹å½“å‰è¿›åº¦ï¼‰ï¼›æ¿€æ´»å®ŒæˆåTabNine Cloudä¸ºEnabledçŠ¶æ€ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å®‰è£…è¿›åº¦å®Œæˆååˆ·æ–°é¡µé¢æ‰‹åŠ¨é€‰æ‹©Enabledï¼›ç¡®è®¤æ¿€æ´»å®Œæˆï¼Œé‡å¯pycharmå³å¯ï¼›","categories":[{"name":"å¼€å‘å·¥å…·","slug":"å¼€å‘å·¥å…·","permalink":"cpeixin.cn/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"}],"tags":[{"name":"IDEA","slug":"IDEA","permalink":"cpeixin.cn/tags/IDEA/"}]},{"title":"ã€è½¬è½½ã€‘å­—èŠ‚è·³åŠ¨ EB çº§ HDFS å®è·µ","slug":"ã€è½¬è½½ã€‘å­—èŠ‚è·³åŠ¨-EB-çº§-HDFS-å®è·µ","date":"2020-01-02T15:25:55.000Z","updated":"2020-05-31T15:28:54.936Z","comments":true,"path":"2020/01/02/ã€è½¬è½½ã€‘å­—èŠ‚è·³åŠ¨-EB-çº§-HDFS-å®è·µ/","link":"","permalink":"cpeixin.cn/2020/01/02/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8-EB-%E7%BA%A7-HDFS-%E5%AE%9E%E8%B7%B5/","excerpt":"","text":"è½¬è½½è‡ªå­—èŠ‚è·³åŠ¨ EB çº§ HDFS å®è·µï¼Œå­¦ä¹ å­¦ä¹ å­—èŠ‚è·³åŠ¨åŸºç¡€æ¶æ„éƒ¨é—¨å¯¹ä¸Šä¸‡èŠ‚ç‚¹çš„HDFSé›†ç¾¤çš„ç®¡ç†æ–¹å¼æ–‡ç« çš„æœ€åï¼Œæœ‰å†™ä¸Šè‡ªå·±çš„æ€»ç»“ï¼Œå·¥ä½œè¿™å‡ å¹´ï¼Œç¡®å®æ²¡æœ‰é‡åˆ°è¿‡è¿™ä¹ˆåºå¤§çš„æ•°æ®é‡å’Œé›†ç¾¤ï¼Œé‚£ä¹ˆå°±ä¸èƒ½å…ˆå®æˆ˜å†æ€»ç»“äº†ï¼Œç›®å‰æ˜¯ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šçœ‹çœ‹è¿œå¤„çš„é£æ™¯ï¼Œå½“æˆ‘åˆ°è¾¾çš„é‚£ä¸€å¤©ï¼Œå°±ä¼šæ›´ä»å®¹çš„èå…¥é£æ™¯äº†ã€‚HDFS ç®€ä»‹å› ä¸º HDFS è¿™æ ·ä¸€ä¸ªç³»ç»Ÿå·²ç»å­˜åœ¨äº†éå¸¸é•¿çš„æ—¶é—´ï¼Œåº”ç”¨çš„åœºæ™¯å·²ç»éå¸¸æˆç†Ÿäº†ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†æˆ‘ä»¬ä¼šæ¯”è¾ƒç®€å•åœ°ä»‹ç»ã€‚HDFS å…¨å Hadoop Distributed File Systemï¼Œæ˜¯ä¸šç•Œä½¿ç”¨æœ€å¹¿æ³›çš„å¼€æºåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚åŸç†å’Œæ¶æ„ä¸ Google çš„ GFS åŸºæœ¬ä¸€è‡´ã€‚å®ƒçš„ç‰¹ç‚¹ä¸»è¦æœ‰ä»¥ä¸‹å‡ é¡¹ï¼šå’Œæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸€æ ·çš„ç›®å½•æ ‘è§†å›¾Append Only çš„å†™å…¥ï¼ˆä¸æ”¯æŒéšæœºå†™ï¼‰é¡ºåºå’Œéšæœºè¯»è¶…å¤§æ•°æ®è§„æ¨¡æ˜“æ‰©å±•ï¼Œå®¹é”™ç‡é«˜å­—èŠ‚è·³åŠ¨ç‰¹è‰²çš„ HDFSå­—èŠ‚è·³åŠ¨åº”ç”¨ HDFS å·²ç»éå¸¸é•¿çš„æ—¶é—´äº†ï¼Œç»å†äº† 7 å¹´çš„å‘å±•ï¼Œç›®å‰å·²ç›´æ¥æ”¯æŒäº†åå¤šç§æ•°æ®å¹³å°ï¼Œé—´æ¥æ”¯æŒäº†ä¸Šç™¾ç§ä¸šåŠ¡å‘å±•ã€‚ä»é›†ç¾¤è§„æ¨¡å’Œæ•°æ®é‡æ¥è¯´ï¼ŒHDFS å¹³å°åœ¨å…¬å¸å†…éƒ¨å·²ç»æˆé•¿ä¸ºæ€»æ•°å‡ ä¸‡å°æœåŠ¡å™¨çš„å¤§å¹³å°ï¼Œæ”¯æŒäº† EB çº§åˆ«çš„æ•°æ®é‡ã€‚åœ¨æ·±å…¥ç›¸å…³çš„æŠ€æœ¯ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹å­—èŠ‚è·³åŠ¨çš„ HDFS æ¶æ„ã€‚æ¶æ„ä»‹ç»æ¥å…¥å±‚æ¥å…¥å±‚æ˜¯åŒºåˆ«äºç¤¾åŒºç‰ˆæœ¬æœ€å¤§çš„ä¸€å±‚ï¼Œç¤¾åŒºç‰ˆæœ¬ä¸­å¹¶æ— è¿™ä¸€å±‚å®šä¹‰ã€‚åœ¨å­—èŠ‚è·³åŠ¨çš„è½åœ°å®è·µä¸­ï¼Œç”±äºé›†ç¾¤çš„èŠ‚ç‚¹è¿‡äºåºå¤§ï¼Œæˆ‘ä»¬éœ€è¦éå¸¸å¤šçš„ NameNode å®ç°è”é‚¦æœºåˆ¶æ¥æ¥å…¥ä¸åŒä¸Šå±‚ä¸šåŠ¡çš„æ•°æ®æœåŠ¡ã€‚ä½†å½“ NameNode æ•°é‡ä¹Ÿå˜å¾—éå¸¸å¤šäº†ä»¥åï¼Œç”¨æˆ·è¯·æ±‚çš„ç»Ÿä¸€æ¥å…¥åŠç»Ÿä¸€è§†å›¾çš„ç®¡ç†ä¹Ÿä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³ç”¨æˆ·æ¥å…¥è¿‡äºåˆ†æ•£ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„æ¥å…¥å±‚æ¥æ”¯æŒç”¨æˆ·è¯·æ±‚çš„ç»Ÿä¸€æ¥å…¥ï¼Œè½¬å‘è·¯ç”±ï¼›åŒæ—¶ä¹Ÿèƒ½ç»“åˆä¸šåŠ¡æä¾›ç”¨æˆ·æƒé™å’Œæµé‡æ§åˆ¶èƒ½åŠ›ï¼›å¦å¤–ï¼Œè¯¥æ¥å…¥å±‚ä¹Ÿéœ€è¦æä¾›å¯¹å¤–çš„ç›®å½•æ ‘ç»Ÿä¸€è§†å›¾ã€‚è¯¥æ¥å…¥å±‚ä»éƒ¨ç½²å½¢æ€ä¸Šæ¥è®²ï¼Œä¾èµ–äºä¸€äº›å¤–éƒ¨ç»„ä»¶å¦‚ Redisï¼ŒMySQL ç­‰ï¼Œä¼šæœ‰ä¸€æ‰¹æ— çŠ¶æ€çš„ NNProxy ç»„æˆï¼Œä»–ä»¬æä¾›äº†è¯·æ±‚è·¯ç”±ï¼ŒQuota é™åˆ¶ï¼ŒTracing èƒ½åŠ›åŠæµé‡é™é€Ÿç­‰èƒ½åŠ›ã€‚å…ƒæ•°æ®å±‚è¿™ä¸€å±‚ä¸»è¦æ¨¡å—æœ‰ Name Nodeï¼ŒZKFCï¼Œå’Œ BookKeeperï¼ˆä¸åŒäº QJMï¼ŒBookKeeper åœ¨å¤§è§„æ¨¡å¤šèŠ‚ç‚¹æ•°æ®åŒæ­¥ä¸Šæ¥è®²ä¼šè¡¨ç°å¾—æ›´ç¨³å®šå¯é ï¼‰ã€‚Name Node è´Ÿè´£å­˜å‚¨æ•´ä¸ª HDFS é›†ç¾¤çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œæ˜¯æ•´ä¸ªç³»ç»Ÿçš„å¤§è„‘ã€‚ä¸€æ—¦æ•…éšœï¼Œæ•´ä¸ªé›†ç¾¤éƒ½ä¼šé™·å…¥ä¸å¯ç”¨çŠ¶æ€ã€‚å› æ­¤ Name Node æœ‰ä¸€å¥—åŸºäº ZKFC çš„ä¸»ä»çƒ­å¤‡çš„é«˜å¯ç”¨æ–¹æ¡ˆã€‚Name Node è¿˜é¢ä¸´ç€æ‰©å±•æ€§çš„é—®é¢˜ï¼Œå•æœºæ‰¿è½½èƒ½åŠ›å§‹ç»ˆå—é™ã€‚äºæ˜¯ HDFS å¼•å…¥äº†è”é‚¦ï¼ˆFederationï¼‰æœºåˆ¶ã€‚ä¸€ä¸ªé›†ç¾¤ä¸­å¯ä»¥éƒ¨ç½²å¤šç»„ Name Nodeï¼Œå®ƒä»¬ç‹¬ç«‹ç»´æŠ¤è‡ªå·±çš„å…ƒæ•°æ®ï¼Œå…±ç”¨ Data Node å­˜å‚¨èµ„æºã€‚è¿™æ ·ï¼Œä¸€ä¸ª HDFS é›†ç¾¤å°±å¯ä»¥æ— é™æ‰©å±•äº†ã€‚ä½†æ˜¯è¿™ç§ Federation æœºåˆ¶ä¸‹ï¼Œæ¯ä¸€ç»„ Name Node çš„ç›®å½•æ ‘éƒ½äº’ç›¸å‰²è£‚çš„ã€‚äºæ˜¯åˆå‡ºç°äº†ä¸€äº›è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿä½¿æ•´ä¸ª Federation é›†ç¾¤å¯¹å¤–æä¾›ä¸€ä¸ªå®Œæ•´ç›®å½•æ ‘çš„è§†å›¾ã€‚æ•°æ®å±‚ç›¸æ¯”å…ƒæ•°æ®å±‚ï¼Œæ•°æ®å±‚ä¸»è¦èŠ‚ç‚¹æ˜¯ Data Nodeã€‚Data Node è´Ÿè´£å®é™…çš„æ•°æ®å­˜å‚¨å’Œè¯»å–ã€‚ç”¨æˆ·æ–‡ä»¶è¢«åˆ‡åˆ†æˆå—å¤åˆ¶æˆå¤šå‰¯æœ¬ï¼Œæ¯ä¸ªå‰¯æœ¬éƒ½å­˜åœ¨ä¸åŒçš„ Data Node ä¸Šï¼Œä»¥è¾¾åˆ°å®¹é”™å®¹ç¾çš„æ•ˆæœã€‚æ¯ä¸ªå‰¯æœ¬åœ¨ Data Node ä¸Šéƒ½ä»¥æ–‡ä»¶çš„å½¢å¼å­˜å‚¨ï¼Œå…ƒä¿¡æ¯åœ¨å¯åŠ¨æ—¶è¢«åŠ è½½åˆ°å†…å­˜ä¸­ã€‚Data Node ä¼šå®šæ—¶å‘ Name Node åšå¿ƒè·³æ±‡æŠ¥ï¼Œå¹¶ä¸”å‘¨æœŸæ€§å°†è‡ªå·±æ‰€å­˜å‚¨çš„å‰¯æœ¬ä¿¡æ¯æ±‡æŠ¥ç»™ Name Nodeã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹ Federation ä¸­çš„æ¯ä¸ªé›†ç¾¤éƒ½æ˜¯ç‹¬ç«‹å®Œæˆçš„ã€‚åœ¨å¿ƒè·³æ±‡æŠ¥çš„è¿”å›ç»“æœä¸­ï¼Œä¼šæºå¸¦ Name Node å¯¹ Data Node ä¸‹å‘çš„æŒ‡ä»¤ï¼Œä¾‹å¦‚ï¼Œéœ€è¦å°†æŸä¸ªå‰¯æœ¬æ‹·è´åˆ°å¦å¤–ä¸€å° Data Node æˆ–è€…å°†æŸä¸ªå‰¯æœ¬åˆ é™¤ç­‰ã€‚ä¸»è¦ä¸šåŠ¡å…ˆæ¥çœ‹ä¸€ä¸‹å½“å‰åœ¨å­—èŠ‚è·³åŠ¨ HDFS æ‰¿è½½çš„ä¸»è¦ä¸šåŠ¡ï¼šHiveï¼ŒHBaseï¼Œæ—¥å¿—æœåŠ¡ï¼ŒKafka æ•°æ®å­˜å‚¨Yarnï¼ŒFlink çš„è®¡ç®—æ¡†æ¶å¹³å°æ•°æ®Sparkï¼ŒMapReduce çš„è®¡ç®—ç›¸å…³æ•°æ®å­˜å‚¨å‘å±•é˜¶æ®µåœ¨å­—èŠ‚è·³åŠ¨ï¼Œéšç€ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•ï¼ŒHDFS çš„æ•°æ®é‡å’Œé›†ç¾¤è§„æ¨¡å¿«é€Ÿæ‰©å¤§ï¼ŒåŸæ¥çš„ HDFS çš„é›†ç¾¤ä»å‡ ç™¾å°ï¼Œè¿…é€Ÿçªç ´åƒå°å’Œä¸‡å°çš„è§„æ¨¡ã€‚è¿™ä¸­é—´ï¼Œè¸©äº†æ— æ•°çš„å‘ï¼Œå¤§çš„é˜¶æ®µå½’çº³èµ·æ¥ä¼šæœ‰è¿™æ ·å‡ ä¸ªé˜¶æ®µã€‚ç¬¬ä¸€é˜¶æ®µä¸šåŠ¡å¢é•¿åˆæœŸï¼Œé›†ç¾¤è§„æ¨¡å¢é•¿è¶‹åŠ¿éå¸¸é™¡å³­ï¼Œå•é›†ç¾¤è§„æ¨¡å¾ˆå¿«åœ¨å…ƒæ•°æ®æœåŠ¡å™¨ Name Node ä¾§é‡åˆ°ç“¶é¢ˆã€‚å¼•å…¥è”é‚¦æœºåˆ¶ï¼ˆFederationï¼‰å®ç°é›†ç¾¤çš„æ¨ªå‘æ‰©å±•ã€‚è”é‚¦åˆå¸¦æ¥ç»Ÿä¸€å‘½åç©ºé—´é—®é¢˜ï¼Œå› æ­¤ï¼Œéœ€è¦ç»Ÿä¸€è§†å›¾ç©ºé—´å¸®åŠ©ä¸šåŠ¡æ„å»ºç»Ÿä¸€æ¥å…¥ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº† Name Node Proxy ç»„ä»¶å®ç°ç»Ÿä¸€è§†å›¾å’Œå¤šç§Ÿæˆ·ç®¡ç†ç­‰åŠŸèƒ½ï¼Œè¿™éƒ¨åˆ†ä¼šåœ¨ä¸‹æ–‡çš„ NNProxy ç« èŠ‚ä¸­ä»‹ç»ã€‚ç¬¬äºŒé˜¶æ®µæ•°æ®é‡ç»§ç»­å¢å¤§ï¼ŒFederation æ–¹å¼ä¸‹çš„ç›®å½•æ ‘ç®¡ç†ä¹Ÿå­˜åœ¨ç“¶é¢ˆï¼Œä¸»è¦ä½“ç°åœ¨æ•°æ®é‡å¢å¤§åï¼ŒJava ç‰ˆæœ¬çš„ GC å˜å¾—æ›´åŠ é¢‘ç¹ï¼Œè·¨å­æ ‘è¿ç§»èŠ‚ç‚¹ä»£ä»·è¿‡å¤§ï¼ŒèŠ‚ç‚¹å¯åŠ¨æ—¶é—´å¤ªé•¿ç­‰é—®é¢˜ã€‚å› æ­¤æˆ‘ä»¬é€šè¿‡é‡æ„çš„æ–¹å¼ï¼Œè§£å†³äº† GCï¼Œé”ä¼˜åŒ–ï¼Œå¯åŠ¨åŠ é€Ÿç­‰é—®é¢˜ï¼Œå°†åŸ Name Node çš„æœåŠ¡èƒ½åŠ›è¿›ä¸€æ­¥æé«˜ã€‚å®¹çº³æ›´å¤šçš„å…ƒæ•°æ®ä¿¡æ¯ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿå®ç°äº†å­—èŠ‚è·³åŠ¨ç‰¹è‰²çš„ DanceNN ç»„ä»¶ï¼Œå…¼å®¹äº†åŸæœ‰ Java ç‰ˆæœ¬ NameNode çš„å…¨éƒ¨åŠŸèƒ½åŸºç¡€ä¸Šï¼Œå¤§å¤§å¢å¼ºäº†ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚ç›¸å…³è¯¦ç»†ä»‹ç»ä¼šåœ¨ä¸‹é¢çš„ DanceNN ç« èŠ‚ä¸­ä»‹ç»ã€‚ç¬¬ä¸‰é˜¶æ®µå½“æ•°æ®é‡è·¨è¿‡ EBï¼Œé›†ç¾¤è§„æ¨¡æ‰©å¤§åˆ°å‡ ä¸‡å°çš„æ—¶å€™ï¼Œæ…¢èŠ‚ç‚¹é—®é¢˜ï¼Œæ›´ç»†ç²’åº¦æœåŠ¡åˆ†çº§é—®é¢˜ï¼Œæˆæœ¬é—®é¢˜å’Œå…ƒæ•°æ®ç“¶é¢ˆè¿›ä¸€æ­¥å‡¸æ˜¾ã€‚æˆ‘ä»¬åœ¨æ¶æ„ä¸Šè¿›ä¸€æ­¥åœ¨åŒ…æ‹¬å®Œå–„å¤šç§Ÿæˆ·ä½“ç³»æ„å»ºï¼Œé‡æ„æ•°æ®èŠ‚ç‚¹å’Œå…ƒæ•°æ®åˆ†å±‚ç­‰æ–¹å‘è¿›ä¸€æ­¥æ¼”è¿›ã€‚è¿™éƒ¨åˆ†ç›®å‰æ­£åœ¨è¿›è¡Œä¸­ï¼Œå› ä¸ºä¼˜åŒ–çš„ç‚¹ä¼šéå¸¸å¤šï¼Œæœ¬æ–‡ä¼šç»™å‡ºæ…¢èŠ‚ç‚¹ä¼˜åŒ–çš„è½åœ°å®è·µã€‚å…³é”®æ”¹è¿›åœ¨æ•´ä¸ªæ¶æ„æ¼”è¿›çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åšäº†éå¸¸å¤šçš„æ¢ç´¢å’Œå°è¯•ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œç»“åˆä¹‹å‰æåˆ°çš„å‡ ä¸ªå¤§çš„æŒ‘æˆ˜å’Œé—®é¢˜ï¼Œæˆ‘ä»¬å°±å…¶ä¸­å…³é”®çš„ Name Node Proxy å’Œ Dance Name Node è¿™ä¸¤ä¸ªé‡ç‚¹ç»„ä»¶åšä¸€ä¸‹ä»‹ç»ï¼ŒåŒæ—¶ï¼Œä¹Ÿä¼šä»‹ç»ä¸€ä¸‹æˆ‘ä»¬åœ¨æ…¢èŠ‚ç‚¹æ–¹é¢çš„ä¼˜åŒ–å’Œæ”¹è¿›ã€‚NNProxyï¼ˆName Node Proxyï¼‰ä½œä¸ºç³»ç»Ÿçš„å…ƒæ•°æ®æ“ä½œæ¥å…¥ç«¯ï¼ŒNNProxy æä¾›äº†è”é‚¦æ¨¡å¼ä¸‹ç»Ÿä¸€å…ƒæ•°æ®è§†å›¾ï¼Œè§£å†³äº†ç”¨æˆ·è¯·æ±‚çš„ç»Ÿä¸€è½¬å‘ï¼Œä¸šåŠ¡æµé‡çš„ç»Ÿä¸€ç®¡æ§çš„é—®é¢˜ã€‚å…ˆä»‹ç»ä¸€ä¸‹ NNProxy æ‰€å¤„çš„ç³»ç»Ÿä¸Šä¸‹æ¸¸ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ NNProxy éƒ½åšäº†ä»€ä¹ˆå·¥ä½œã€‚è·¯ç”±ç®¡ç†åœ¨ä¸Šé¢ Federation çš„ä»‹ç»ä¸­æåˆ°ï¼Œæ¯ä¸ªé›†ç¾¤éƒ½ç»´æŠ¤è‡ªå·±ç‹¬ç«‹çš„ç›®å½•æ ‘ï¼Œæ— æ³•å¯¹å¤–æä¾›ä¸€ä¸ªå®Œæ•´çš„ç›®å½•æ ‘è§†å›¾ã€‚NNProxy ä¸­çš„è·¯ç”±ç®¡ç†å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚è·¯ç”±ç®¡ç†å­˜å‚¨äº†ä¸€å¼  mount tableï¼Œè¡¨ä¸­è®°å½•è‹¥å¹²æ¡è·¯å¾„åˆ°é›†ç¾¤çš„æ˜ å°„å…³ç³»ã€‚ä¾‹å¦‚ /user -&gt; hdfs://namenodeBï¼Œè¿™æ¡æ˜ å°„å…³ç³»çš„å«ä¹‰å°±æ˜¯ /user åŠå…¶å­ç›®å½•è¿™ä¸ªç›®å½•åœ¨ namenodeB è¿™ä¸ªé›†ç¾¤ä¸Šï¼Œæ‰€æœ‰å¯¹ /user åŠå…¶å­ç›®å½•çš„è®¿é—®éƒ½ä¼šç”± NNProxy è½¬å‘ç»™ namenodeBï¼Œè·å–ç»“æœåå†è¿”å›ç»™ Clientã€‚åŒ¹é…åŸåˆ™ä¸ºæœ€é•¿åŒ¹é…ï¼Œä¾‹å¦‚æˆ‘ä»¬è¿˜æœ‰å¦å¤–ä¸€æ¡æ˜ å°„ /user/tiger/dump -&gt; hdfs://namenodeCï¼Œé‚£ä¹ˆ /user/tiger/dump åŠå…¶æ‰€æœ‰å­ç›®å½•éƒ½åœ¨ namenodeCï¼Œè€Œ /user ç›®å½•ä¸‹å…¶ä»–å­ç›®å½•éƒ½åœ¨ namenodeB ä¸Šã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šQuota é™åˆ¶ä½¿ç”¨è¿‡ HDFS çš„åŒå­¦ä¼šçŸ¥é“ Quota è¿™ä¸ªæ¦‚å¿µã€‚æˆ‘ä»¬ç»™æ¯ä¸ªç›®å½•é›†åˆåˆ†é…äº†é¢å®šçš„ç©ºé—´èµ„æºï¼Œä¸€æ—¦ä½¿ç”¨è¶…è¿‡è¿™ä¸ªé˜ˆå€¼ï¼Œå°±ä¼šè¢«ç¦æ­¢å†™å…¥ã€‚è¿™ä¸ªå·¥ä½œå°±æ˜¯ç”± NNProxy å®Œæˆçš„ã€‚NNProxy ä¼šé€šè¿‡ Quota å®æ—¶ç›‘æ§ç³»ç»Ÿè·å–æœ€æ–° Quota ä½¿ç”¨æƒ…å†µï¼Œå½“ç”¨æˆ·è¿›è¡Œå…ƒæ•°æ®æ“ä½œçš„æ—¶å€™ï¼ŒNNProxy å°±ä¼šæ ¹æ®ç”¨æˆ·çš„ Quota æƒ…å†µä½œå‡ºåˆ¤æ–­ï¼Œå†³å®šé€šè¿‡æˆ–è€…æ‹’ç»ã€‚Trace æ”¯æŒByteTrace æ˜¯ä¸€ä¸ª Trace ç³»ç»Ÿï¼Œè®°å½•è¿½è¸ªç”¨æˆ·å’Œç³»ç»Ÿä»¥åŠç³»ç»Ÿä¹‹é—´çš„è°ƒç”¨è¡Œä¸ºï¼Œä»¥è¾¾åˆ°åˆ†æå’Œè¿ç»´çš„ç›®çš„ã€‚å…¶ä¸­çš„ Trace ä¿¡æ¯ä¼šé™„åœ¨å‘ NNProxy çš„è¯·æ±‚ RPC ä¸­ã€‚NNProxy æ‹¿åˆ° ByteTrace ä»¥åå°±å¯ä»¥çŸ¥é“å½“å‰è¯·æ±‚çš„ä¸Šæ¸¸æ¨¡å—ï¼ŒUSER åŠ Application ID ç­‰ä¿¡æ¯ã€‚NNProxy ä¸€æ–¹é¢å°†è¿™äº›ä¿¡æ¯å‘åˆ° Kafka åšä¸€äº›ç¦»çº¿åˆ†æï¼Œä¸€æ–¹é¢å®æ—¶èšåˆå¹¶æ‰“ç‚¹ï¼Œä»¥ä¾¿è¿½æº¯çº¿ä¸Šæµé‡ã€‚æµé‡é™åˆ¶è™½ç„¶ NNProxy éå¸¸è½»é‡ï¼Œå¯ä»¥æ‰¿å—å¾ˆé«˜çš„ QPSï¼Œä½†æ˜¯åç«¯çš„ Name Node æ‰¿è½½èƒ½åŠ›æ˜¯æœ‰é™çš„ã€‚å› æ­¤çªå‘çš„å¤§ä½œä¸šé€ æˆé«˜ QPS çš„è¯»å†™è¯·æ±‚è¢«å…¨é‡è½¬å‘åˆ° Name Node ä¸Šæ—¶ï¼Œä¼šé€ æˆ Name Node è¿‡è½½ï¼Œå»¶æ—¶å˜é«˜ï¼Œç”šè‡³å‡ºç° OOMï¼Œå½±å“é›†ç¾¤ä¸Šæ‰€æœ‰ç”¨æˆ·ã€‚å› æ­¤ NNProxy å¦ä¸€ä¸ªéå¸¸é‡è¦çš„ä»»åŠ¡å°±æ˜¯é™æµï¼Œä»¥ä¿æŠ¤åç«¯ Name Nodeã€‚ç›®å‰é™æµåŸºäºè·¯å¾„+RPC ä»¥åŠ ç”¨æˆ·+RPC ç»´åº¦ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é™åˆ¶ /user/tiger/warhouse è·¯å¾„çš„ create è¯·æ±‚ä¸º 100 QPSï¼Œæˆ–è€…æŸä¸ªç”¨æˆ·çš„ delete è¯·æ±‚ä¸º 5 QPSã€‚ä¸€æ—¦è¯¥ç”¨æˆ·çš„è®¿é—®é‡è¶…è¿‡è¿™ä¸ªé˜ˆå€¼ï¼ŒNNProxy ä¼šè¿”å›ä¸€ä¸ªå¯é‡è¯•å¼‚å¸¸ï¼ŒClient æ”¶åˆ°è¿™ä¸ªå¼‚å¸¸åä¼šé‡è¯•ã€‚å› æ­¤è¢«é™æµçš„è·¯å¾„æˆ–ç”¨æˆ·ä¼šæ„Ÿè§‰åˆ°è®¿é—® HDFS å˜æ…¢ï¼Œä½†æ˜¯å¹¶ä¸ä¼šå¤±è´¥ã€‚Dance NNï¼ˆDance Name Nodeï¼‰è§£å†³çš„é—®é¢˜å¦‚å‰æ‰€è¿°ï¼Œåœ¨æ•°æ®é‡ä¸Šåˆ° EB çº§åˆ«çš„åœºæ™¯åï¼ŒåŸæœ‰çš„ Java ç‰ˆæœ¬çš„ Name Node å­˜åœ¨äº†éå¸¸å¤šçš„çº¿ä¸Šé—®é¢˜éœ€è¦è§£å†³ã€‚ä»¥ä¸‹æ˜¯åœ¨å®è·µè¿‡ç¨‹ä¸­æˆ‘ä»¬é‡åˆ°çš„ä¸€äº›é—®é¢˜æ€»ç»“ï¼šJava ç‰ˆæœ¬ Name Node é‡‡ç”¨ Java è¯­è¨€å¼€å‘ï¼Œåœ¨ INode è§„æ¨¡ä¸Šäº¿æ—¶ï¼Œä¸å¯é¿å…çš„ä¼šå¸¦æ¥ä¸¥é‡çš„ GC é—®é¢˜ï¼›Java ç‰ˆæœ¬ Name Node å°† INode meta ä¿¡æ¯å®Œå…¨æ”¾ç½®äºå†…å­˜ï¼Œ10 äº¿ INode å¤§çº¦å ç”¨ 800GB å†…å­˜ï¼ˆåŒ…å« JVM è‡ªèº«å ç”¨çš„éƒ¨åˆ† native memoryï¼‰ï¼Œæ›´è¿›ä¸€æ­¥åŠ é‡äº† GCï¼›æˆ‘ä»¬ç›®å‰çš„é›†ç¾¤è§„æ¨¡ä¸‹ï¼ŒName Node ä»é‡å¯åˆ°æ¢å¤æœåŠ¡éœ€è¦ 6 ä¸ªå°æ—¶ï¼Œåœ¨ä¸»å¤‡åŒæ—¶å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹ï¼Œä¸¥é‡å½±å“ä¸Šå±‚ä¸šåŠ¡ï¼›Java ç‰ˆæœ¬ Name Node å…¨å±€ä¸€æŠŠè¯»å†™é”ï¼Œä»»ä½•å¯¹ç›®å½•æ ‘çš„ä¿®æ”¹æ“ä½œéƒ½ä¼šé˜»å¡å…¶ä»–çš„è¯»å†™æ“ä½œï¼Œå¹¶å‘åº¦è¾ƒä½ï¼›ä»ä¸Šå¯ä»¥çœ‹å‡ºï¼Œåœ¨å¤§æ•°æ®é‡åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬äºŸéœ€ä¸€ä¸ªæ–°æ¶æ„ç‰ˆæœ¬çš„ Name Node æ¥æ‰¿è½½æˆ‘ä»¬çš„æµ·é‡å…ƒæ•°æ®ã€‚é™¤äº† C++è¯­è¨€é‡å†™æ¥è§„é¿ Java å¸¦æ¥çš„ GC é—®é¢˜ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜åœ¨ä¸€äº›åœºæ™¯ä¸‹åšäº†ç‰¹æ®Šçš„ä¼˜åŒ–ã€‚ç›®å½•æ ‘é”è®¾è®¡HDFS å¯¹å†…æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤ï¼Œå¯¹å¤–æä¾›çš„æ˜¯ä¸€ä¸ª unified çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å¯¹æ–‡ä»¶åŠç›®å½•çš„æ“ä½œéœ€è¦åƒæ“ä½œ Linux æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸€æ ·ã€‚è¿™å°±è¦æ±‚ HDFS æ»¡è¶³ç±»ä¼¼äºæ•°æ®åº“ç³»ç»Ÿä¸­ ACID ç‰¹æ€§ä¸€æ ·çš„åŸå­æ€§ï¼Œä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§ã€‚å› æ­¤ DanceNN åœ¨é¢å¯¹å¤šä¸ªç”¨æˆ·åŒæ—¶æ“ä½œåŒä¸€ä¸ªæ–‡ä»¶æˆ–è€…åŒä¸€ä¸ªç›®å½•æ—¶ï¼Œéœ€è¦ä¿è¯ä¸ä¼šç ´åæ‰ ACID å±æ€§ï¼Œéœ€è¦å¯¹æ“ä½œåšé”ä¿æŠ¤ã€‚ä¸åŒäºä¼ ç»Ÿçš„ KV å­˜å‚¨å’Œæ•°æ®åº“è¡¨ç»“æ„ï¼ŒDanceNN ä¸Šç»´æŠ¤çš„æ˜¯ä¸€æ£µæ ‘çŠ¶çš„æ•°æ®ç»“æ„ï¼Œå› æ­¤å•çº¯çš„ key é”æˆ–è€…è¡Œé”åœ¨ DanceNN ä¸‹ä¸é€‚ç”¨ã€‚è€Œåƒæ•°æ®åº“çš„è¡¨é”æˆ–è€…åŸç”Ÿ NN çš„åšæ³•ï¼Œå¯¹æ•´æ£µç›®å½•æ ‘åŠ å•ç‹¬ä¸€æŠŠé”åˆä¼šä¸¥é‡çš„å½±å“æ•´ä½“ååå’Œå»¶è¿Ÿï¼Œå› æ­¤ DanceNN é‡æ–°è®¾è®¡äº†æ ‘çŠ¶é”ç»“æ„ï¼Œåšåˆ°ä¿è¯ ACID çš„æƒ…å†µä¸‹ï¼Œè¯»ååèƒ½å¤Ÿåˆ° 8wï¼Œå†™ååèƒ½å¤Ÿåˆ° 2wï¼Œæ˜¯åŸç”Ÿ NN æ€§èƒ½çš„ 10 å€ä»¥ä¸Šã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä¼šé‡æ–°å¯¹ RPC åšåˆ†ç±»ï¼Œåƒ createFileï¼ŒgetFileInfoï¼ŒsetXAttr è¿™ç±» RPC ä¾ç„¶æ˜¯ç®€å•çš„å¯¹æŸä¸€ä¸ª INode è¿›è¡Œ CURD æ“ä½œï¼›åƒ delete RPCï¼Œæœ‰å¯èƒ½åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šåˆ é™¤ç›®å½•ï¼Œåè€…ä¼šå½±å“æ•´æ£µå­æ ‘ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼›åƒ rename RPCï¼Œåˆ™æ˜¯æ›´å¤æ‚çš„å¦å¤–ä¸€ç±»æ“ä½œï¼Œå¯èƒ½ä¼šæ¶‰åŠåˆ°å¤šä¸ª INodeï¼Œç”šè‡³æ˜¯å¤šæ£µå­æ ‘ä¸‹çš„æ‰€æœ‰ INodeã€‚DanceNN å¯åŠ¨ä¼˜åŒ–ç”±äºæˆ‘ä»¬çš„ DanceNN åº•å±‚å…ƒæ•°æ®å®ç°äº†æœ¬åœ°ç›®å½•æ ‘ç®¡ç†ç»“æ„ï¼Œå› æ­¤æˆ‘ä»¬ DanceNN çš„å¯åŠ¨ä¼˜åŒ–éƒ½æ˜¯å›´ç»•ç€è¿™æ ·çš„è®¾è®¡æ¥åšçš„ã€‚å¤šçº¿ç¨‹æ‰«æå’Œå¡«å…… BlockMapåœ¨ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯è¯»å–ç›®å½•æ ‘ä¸­ä¿å­˜çš„ä¿¡æ¯å¹¶ä¸”å¡«å…¥ BlockMap ä¸­ï¼Œç±»ä¼¼ Java ç‰ˆ NN è¯»å– FSImage çš„æ“ä½œã€‚åœ¨å…·ä½“å®ç°è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆèµ·å¤šä¸ªçº¿ç¨‹å¹¶è¡Œæ‰«æé™æ€ç›®å½•æ ‘ç»“æ„ã€‚å°†æ‰«æçš„ç»“æœæ”¾å…¥ä¸€ä¸ªåŠ é”çš„ Buffer ä¸­ã€‚å½“ Buffer ä¸­çš„å…ƒç´ ä¸ªæ•°è¾¾åˆ°è®¾å®šçš„æ•°é‡ä»¥åï¼Œé‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„ Buffer æ¥æ”¶è¯·æ±‚ï¼Œå¹¶åœ¨è€ Buffer ä¸Šèµ·ä¸€ä¸ªçº¿ç¨‹å°†æ•°æ®å¡«å…¥ BlockMapã€‚æ¥æ”¶å—ä¸ŠæŠ¥ä¼˜åŒ–DanceNN å¯åŠ¨ä»¥åä¼šé¦–å…ˆè¿›å…¥å®‰å…¨æ¨¡å¼ï¼Œæ¥æ”¶æ‰€æœ‰ Date Node çš„å—ä¸ŠæŠ¥ï¼Œå®Œå–„ BlockMap ä¸­ä¿å­˜çš„ä¿¡æ¯ã€‚å½“ä¸ŠæŠ¥çš„ Date Node è¾¾åˆ°ä¸€å®šæ¯”ä¾‹ä»¥åï¼Œæ‰ä¼šé€€å‡ºå®‰å…¨æ¨¡å¼ï¼Œè¿™æ—¶å€™æ‰èƒ½æ­£å¼æ¥æ”¶ client çš„è¯·æ±‚ã€‚æ‰€ä»¥æ¥æ”¶å—ä¸ŠæŠ¥çš„é€Ÿåº¦ä¹Ÿä¼šå½±å“ Date Node çš„å¯åŠ¨æ—¶é•¿ã€‚DanceNN è¿™é‡Œåšäº†ä¸€ä¸ªä¼˜åŒ–ï¼Œæ ¹æ® BlockID å°†ä¸åŒè¯·æ±‚åˆ†é…ç»™ä¸åŒçš„çº¿ç¨‹å¤„ç†ï¼Œæ¯ä¸ªçº¿ç¨‹è´Ÿè´£å›ºå®šçš„ Sliceï¼Œçº¿ç¨‹ä¹‹é—´æ— ç«äº‰ï¼Œè¿™æ ·å°±æå¤§çš„åŠ å¿«äº†æ¥æ”¶å—ä¸ŠæŠ¥çš„é€Ÿåº¦ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šæ…¢èŠ‚ç‚¹ä¼˜åŒ–æ…¢èŠ‚ç‚¹é—®é¢˜åœ¨å¾ˆå¤šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­éƒ½å­˜åœ¨ã€‚å…¶äº§ç”Ÿçš„åŸå› é€šå¸¸ä¸ºä¸Šå±‚ä¸šåŠ¡çš„çƒ­ç‚¹æˆ–è€…åº•å±‚èµ„æºæ•…éšœã€‚ä¸Šå±‚ä¸šåŠ¡çƒ­ç‚¹ï¼Œä¼šå¯¼è‡´ä¸€äº›æ•°æ®åœ¨è¾ƒçŸ­çš„æ—¶é—´æ®µå†…è¢«é›†ä¸­è®¿é—®ã€‚è€Œåº•å±‚èµ„æºæ•…éšœï¼Œå¦‚å‡ºç°æ…¢ç›˜æˆ–è€…ç›˜æŸåï¼Œæ›´å¤šçš„è¯·æ±‚å°±ä¼šé›†ä¸­åˆ°æŸä¸€ä¸ªå‰¯æœ¬èŠ‚ç‚¹ä¸Šä»è€Œå¯¼è‡´æ…¢èŠ‚ç‚¹ã€‚é€šå¸¸æ¥è¯´ï¼Œæ…¢èŠ‚ç‚¹é—®é¢˜çš„ä¼˜åŒ–å’Œä¸Šå±‚ä¸šåŠ¡éœ€æ±‚åŠåº•å±‚èµ„æºé‡æœ‰å¾ˆå¤§çš„å…³ç³»ï¼Œæç«¯æƒ…å†µï¼Œä¸Šå±‚è¯·æ±‚å¾ˆå°ï¼Œä¸‹å±‚èµ„æºå……åˆ†å¯Œè£•çš„æƒ…å†µä¸‹ï¼Œæ…¢èŠ‚ç‚¹é—®é¢˜å°†ä¼šéå¸¸å°‘ï¼Œåä¹‹åˆ™ä¼šå˜å¾—éå¸¸ä¸¥é‡ã€‚åœ¨å­—èŠ‚è·³åŠ¨çš„ HDFS é›†ç¾¤ä¸­ï¼Œæ…¢èŠ‚ç‚¹é—®é¢˜ä¸€åº¦éå¸¸ä¸¥é‡ï¼Œå°¤å…¶æ˜¯ç£ç›˜å ç”¨ç™¾åˆ†æ¯”éå¸¸é«˜ä»¥åï¼Œå„ç§æ…¢èŠ‚ç‚¹é—®é¢˜å±‚å‡ºä¸ç©·ã€‚å…¶æ ¹æœ¬åŸå› å°±æ˜¯èµ„æºçš„å¹³è¡¡æ»åï¼Œè®¸å¤šæœºå™¨çš„ç£ç›˜å ç”¨å·²ç»è§¦åŠçº¢çº¿å¯¼è‡´å†™é™çº§ï¼›æ–°å¢çƒ­èµ„æºåˆ™ä¼šé›†ä¸­åˆ°å°‘é‡æœºå™¨ä¸Šï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå½“ä¸Šå±‚ä¸šåŠ¡çš„æ¯ç§’è¯·æ±‚æ•°å‡é«˜åï¼Œå¯¹äº P999 æ—¶å»¶è¦æ±‚æ¯”è¾ƒé«˜çš„ä¸€äº›å¤§æ•°æ®åˆ†ææŸ¥è¯¢ä¸šåŠ¡å°±å®¹æ˜“å‡ºç°ä¸€å¤§æ‰¹æ•°æ®è®¿é—®ï¼ˆ&gt;10000 è¯·æ±‚ï¼‰è¢«å¡åœ¨æŸä¸ªæ…¢è¯·æ±‚çš„å¤„ç†ä¸Šã€‚æˆ‘ä»¬ä¼˜åŒ–çš„æ–¹å‘ä¼šåˆ†ä¸ºè¯»æ…¢èŠ‚ç‚¹å’Œå†™æ…¢èŠ‚ç‚¹ä¸¤ä¸ªæ–¹é¢ã€‚è¯»æ…¢èŠ‚ç‚¹ä¼˜åŒ–æˆ‘ä»¬ç»å†äº†å‡ ä¸ªé˜¶æ®µï¼šæœ€æ—©ï¼Œä½¿ç”¨ç¤¾åŒºç‰ˆæœ¬ï¼Œå…¶ Switch Read ä»¥è¯»å–ä¸€ä¸ª packet çš„æ—¶é•¿ä¸ºç»Ÿè®¡å•ä½ï¼Œå½“è¯»å–ä¸€ä¸ª packet çš„æ—¶é—´è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œè®¤ä¸ºè¯»å–å½“å‰ packet è¶…æ—¶ã€‚å¦‚æœä¸€å®šæ—¶é—´çª—å£å†…è¶…æ—¶ packet çš„æ•°é‡è¿‡å¤šï¼Œåˆ™è®¤ä¸ºå½“å‰èŠ‚ç‚¹æ˜¯æ…¢èŠ‚ç‚¹ã€‚ä½†è¿™ä¸ªé—®é¢˜åœ¨äºä»¥ packet ä½œä¸ºç»Ÿè®¡å•ä½ä½¿å¾—ç®—æ³•ä¸å¤Ÿæ•æ„Ÿï¼Œè¿™æ ·ä½¿å¾—æ¯æ¬¡è¯»æ…¢èŠ‚ç‚¹å‘ç”Ÿçš„æ—¶å€™ï¼Œå¯¹äºå° IO åœºæ™¯ï¼ˆå­—èŠ‚è·³åŠ¨çš„ä¸€äº›ä¸šåŠ¡æ˜¯ä»¥å¤§é‡éšæœºå° IO ä¸ºå…¸å‹ä½¿ç”¨åœºæ™¯çš„ï¼‰ï¼Œè¿™äº›ä¸ªç§¯æ”’çš„ Packet å·²ç»é€ æˆäº†é—®é¢˜ã€‚åç»­ï¼Œæˆ‘ä»¬ç ”å‘äº† Hedged Read çš„è¯»ä¼˜åŒ–ã€‚Hedged Read å¯¹æ¯ä¸€æ¬¡è¯»å–è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ã€‚å¦‚æœè¯»å–è¶…æ—¶ï¼Œé‚£ä¹ˆä¼šå¦å¼€ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨æ–°çš„çº¿ç¨‹ä¸­å‘ç¬¬äºŒä¸ªå‰¯æœ¬å‘èµ·è¯»è¯·æ±‚ï¼Œæœ€åå–ç¬¬ä¸€ç¬¬äºŒä¸ªå‰¯æœ¬ä¸Šä¼˜å…ˆè¿”å›çš„ response ä½œä¸ºè¯»å–çš„ç»“æœã€‚ä½†è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨æ…¢èŠ‚ç‚¹é›†ä¸­å‘ç”Ÿçš„æ—¶å€™ï¼Œä¼šå¯¼è‡´è¯»æµé‡æ”¾å¤§ã€‚ä¸¥é‡çš„æ—¶å€™ç”šè‡³å¯¼è‡´å°èŒƒå›´å¸¦å®½çŸ­æ—¶é—´å†…ä¸å¯ç”¨ã€‚åŸºäºä¹‹å‰çš„ç»éªŒï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå¼€å¯äº† Fast Switch Read çš„ä¼˜åŒ–ï¼Œè¯¥ä¼˜åŒ–æ–¹å¼ä½¿ç”¨ååé‡ä½œä¸ºåˆ¤æ–­æ…¢èŠ‚ç‚¹çš„æ ‡å‡†ï¼Œå½“ä¸€æ®µæ—¶é—´çª—å£å†…çš„ååé‡å°äºé˜ˆå€¼æ—¶ï¼Œè®¤ä¸ºå½“å‰èŠ‚ç‚¹æ˜¯æ…¢èŠ‚ç‚¹ã€‚å¹¶ä¸”æ ¹æ®å½“å‰çš„è¯»å–çŠ¶å†µåŠ¨æ€åœ°è°ƒæ•´é˜ˆå€¼ï¼ŒåŠ¨æ€æ”¹å˜æ—¶é—´çª—å£çš„é•¿åº¦ä»¥åŠååé‡é˜ˆå€¼çš„å¤§å°ã€‚ä¸‹è¡¨æ˜¯å½“æ—¶çº¿ä¸ŠæŸä¸šåŠ¡æµ‹è¯•çš„å€¼ï¼šHost:X.X.X.X3 å‰¯æœ¬ Switch Read2 å‰¯æœ¬ Hedged Read3 å‰¯æœ¬ Hedged Read3 å‰¯æœ¬ Fast Switch Readï¼ˆä¼˜åŒ–åç®—æ³•ï¼‰è¯»å–æ—¶é•¿ p999977 ms549 ms192 ms128 msæœ€é•¿è¯»å–æ—¶é—´300 s125 s60 s15.5 sé•¿å°¾å‡ºç°æ¬¡æ•°ï¼ˆå¤§äº 500msï¼‰238 æ¬¡/å¤©75 æ¬¡/å¤©15 æ¬¡/å¤©3 æ¬¡/å¤©é•¿å°¾å‡ºç°æ¬¡æ•°ï¼ˆå¤§äº 1000msï¼‰196 æ¬¡/å¤©64 æ¬¡/å¤©6 æ¬¡/å¤©3 æ¬¡/å¤©è¿›ä¸€æ­¥çš„ç›¸å…³æµ‹è¯•æ•°æ®ï¼šå†™æ…¢èŠ‚ç‚¹ä¼˜åŒ–å†™æ…¢èŠ‚ç‚¹ä¼˜åŒ–çš„é€‚ç”¨åœºæ™¯ä¼šç›¸å¯¹ç®€å•ä¸€äº›ã€‚ä¸»è¦è§£å†³çš„æ˜¯å†™è¿‡ç¨‹ä¸­ï¼ŒPipeline çš„ä¸­é—´èŠ‚ç‚¹å˜æ…¢çš„æƒ…å†µã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿå‘å±•äº† Fast Failover å’Œ Fast Failover+ä¸¤ç§ç®—æ³•ã€‚Fast FailoverFast Failover ä¼šç»´æŠ¤ä¸€æ®µæ—¶é—´å†… ACK æ—¶é—´è¿‡é•¿çš„ packet æ•°ç›®ï¼Œå½“è¶…æ—¶ ACK çš„æ•°é‡è¶…è¿‡é˜ˆå€¼åï¼Œä¼šç»“æŸå½“å‰çš„ blockï¼Œå‘ namenode ç”³è¯·æ–°å—ç»§ç»­å†™å…¥ã€‚Fast Failover çš„é—®é¢˜åœ¨äºï¼Œéšæ„ç»“æŸå½“å‰çš„ block ä¼šé€ æˆç³»ç»Ÿçš„å° block æ•°ç›®å¢åŠ ï¼Œç»™ä¹‹åçš„è¯»å–é€Ÿåº¦ä»¥åŠ namenode çš„å…ƒæ•°æ®ç»´æŠ¤éƒ½å¸¦æ¥è´Ÿé¢å½±å“ã€‚æ‰€ä»¥ Fast Failover ç»´æŠ¤äº†ä¸€ä¸ªåˆ‡æ¢é˜ˆå€¼ï¼Œå¦‚æœå·²å†™å…¥çš„æ•°æ®é‡ï¼ˆblock çš„å¤§å°ï¼‰å¤§äºè¿™ä¸ªé˜ˆå€¼ï¼Œæ‰ä¼šè¿›è¡Œ block åˆ‡æ¢ã€‚ä½†æ˜¯å¾€å¾€ä¸ºäº†è¾¾åˆ°è¿™ä¸ªå†™å…¥æ•°æ®å¤§å°é˜ˆå€¼ï¼Œå°±ä¼šé€ æˆç”¨æˆ·éš¾ä»¥æ¥æ”¶çš„å»¶è¿Ÿï¼Œå› æ­¤å½“æ•°æ®é‡å°äºé˜ˆæ—¶éœ€è¦è¿›é¢å¤–çš„ä¼˜åŒ–ã€‚Fast Failover+ä¸ºäº†è§£å†³ä¸Šè¿°çš„é—®é¢˜ï¼Œå½“å·²å†™å…¥çš„æ•°æ®é‡ï¼ˆblock çš„å¤§å°ï¼‰å°äºé˜ˆå€¼æ—¶ï¼Œæˆ‘ä»¬å¼•å…¥äº†æ–°çš„ä¼˜åŒ–æ‰‹æ®µâ€”â€”Fast Failover+ã€‚è¯¥ç®—æ³•é¦–å…ˆä» pipeline ä¸­ç­›é€‰å‡ºé€Ÿåº¦è¾ƒæ…¢çš„ datanodeï¼Œå°†æ…¢èŠ‚ç‚¹ä»å½“å‰ pipeline ä¸­å‰”é™¤ï¼Œå¹¶è¿›å…¥ Pipeline Recovery é˜¶æ®µã€‚Pipeline Recovery ä¼šå‘ namenode ç”³è¯·ä¸€ä¸ªæ–°çš„ datanodeï¼Œä¸å‰©ä¸‹çš„ datanode ç»„æˆä¸€ä¸ªæ–°çš„ pipelineï¼Œå¹¶å°†å·²å†™å…¥çš„æ•°æ®åŒæ­¥åˆ°æ–°çš„ datanode ä¸Šï¼ˆè¯¥æ­¥éª¤ç§°ä¸º transfer blockï¼‰ã€‚ç”±äºå·²ç»å†™å…¥çš„æ•°æ®é‡è¾ƒå°ï¼Œtransfer block çš„è€—æ—¶å¹¶ä¸é«˜ã€‚ç»Ÿè®¡ p999 å¹³å‡è€—æ—¶åªæœ‰ 150msã€‚ç”± Pipeline Recovery æ‰€å¸¦æ¥çš„é¢å¤–æ¶ˆè€—æ˜¯å¯æ¥å—çš„ã€‚ä¸‹è¡¨æ˜¯å½“æ—¶çº¿ä¸ŠæŸä¸šåŠ¡æµ‹è¯•çš„å€¼ï¼šHost:X.X.X.XFast Failover p99Fast Failover+ p99 (ä¼˜åŒ–åç®—æ³•)Fast Failover p95Fast Failover+ p95 (ä¼˜åŒ–åç®—æ³•)å¹³å‡ Flush æ—¶é•¿1.49 s1.23 s182 ms147 msæœ€é•¿ Flush æ—¶é—´80 s66 s9.7 s6.5 sé•¿å°¾å‡ºç°æ¬¡æ•°ï¼ˆp99 å¤§äº 10s, p95 å¤§äº 1sï¼‰63 æ¬¡/å¤©38 æ¬¡/å¤©94 æ¬¡/å¤©55 æ¬¡/å¤©é•¿å°¾å‡ºç°æ¬¡æ•°ï¼ˆp99 å¤§äº 5s, p95 å¤§äº 0.5sï¼‰133 æ¬¡/å¤©101 æ¬¡/å¤©173 æ¬¡/å¤©156 æ¬¡/å¤©ä¸€äº›è¿›ä¸€æ­¥çš„å®é™…æ•ˆæœå¯¹æ¯”ï¼šç»“å°¾HDFS åœ¨å­—èŠ‚è·³åŠ¨çš„å‘å±•å†ç¨‹å·²ç»éå¸¸é•¿äº†ã€‚ä»æœ€åˆçš„å‡ ç™¾å°çš„é›†ç¾¤è§„æ¨¡æ”¯æŒ PB çº§åˆ«çš„æ•°æ®é‡ï¼Œåˆ°ç°åœ¨å‡ ä¸‡å°çº§åˆ«å¤šé›†ç¾¤çš„å¹³å°æ”¯æŒ EB çº§åˆ«çš„æ•°æ®é‡ï¼Œæˆ‘ä»¬ç»å†äº† 7 å¹´çš„å‘å±•ã€‚ä¼´éšç€ä¸šåŠ¡çš„å¿«é€Ÿä¸Šé‡ï¼Œæˆ‘ä»¬å›¢é˜Ÿä¹Ÿç»å†äº†é‡è›®å¼çˆ†å‘ï¼Œè§„æ¨¡åŒ–å‘å±•ï¼Œå¹³å°åŒ–è¿è¥çš„é˜¶æ®µã€‚è¿™è¿‡ç¨‹ä¸­æˆ‘ä»¬è¸©äº†ä¸å°‘å‘ï¼Œä¹Ÿç§¯ç´¯äº†ç›¸å½“ä¸°å¯Œçš„ç»éªŒã€‚å½“ç„¶ï¼Œæœ€é‡è¦çš„ï¼Œå…¬å¸è¿˜åœ¨æŒç»­é«˜é€Ÿå‘å±•ï¼Œè€Œæˆ‘ä»¬ä»æ—§ä¸å¿˜åˆå¿ƒï¼ŒåšæŒâ€œDAY ONEâ€ï¼Œç»§ç»­åœ¨è·¯ä¸Šã€‚å­¦ä¹ æ€»ç»“æ¥å…¥å±‚ï¼šæ¥å…¥å±‚æ˜¯å­—èŠ‚è®¾è®¡å‡å¦‚çš„ä¸€å±‚ï¼Œåœ¨ä¸Šä¸‡èŠ‚ç‚¹çš„HDFSé›†ç¾¤ä¸­ï¼Œå¿…ç„¶è¦ä½¿ç”¨å¤šNameNodeæ¨¡å¼ï¼Œé‚£ä¹ˆå¯¹äºç”¨æˆ·å¤§é‡çš„è¯·æ±‚ç»Ÿä¸€ç®¡ç†ï¼Œå­—èŠ‚å¼•å…¥äº†æ¥å…¥å±‚ï¼Œå…·ä½“å®ç°å€Ÿç”¨Redisï¼ŒMysqlä»¥åŠNNProxyè½¬å‘è·¯ç”±ç­‰å¤–ç•Œç»„ä»¶å®ç°ã€‚å…ƒæ•°æ®å±‚ï¼šè¿™é‡Œé¢æœ‰ä¸€ç‚¹ï¼Œåœ¨å­—èŠ‚çš„HDFSé›†ç¾¤ä¸­ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ç¤¾åŒºç‰ˆçš„QJM HAé«˜å¯ç”¨æ–¹æ¡ˆï¼Œè€Œæ˜¯ä½¿ç”¨äº†BookKeeperã€‚Apache bookkeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ï¼Œå¯æ‰©å±•ï¼Œå®¹é”™ï¼ˆå¤šå‰¯æœ¬ï¼‰ï¼Œä½å»¶è¿Ÿçš„å­˜å‚¨ç³»ç»Ÿï¼Œå…¶æä¾›äº†é«˜æ€§èƒ½ï¼Œé«˜ååçš„å­˜å‚¨èƒ½åŠ›ã€‚è€ŒQJM/Qurom Journal Manageræ˜¯Cloueraæå‡ºçš„ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºPaxosç®—æ³•å®ç°çš„HDFS HAæ–¹æ¡ˆæ•°æ®å±‚å€’æ˜¯æ²¡ä»€ä¹ˆç‰¹åˆ«çš„æ”¹å–„å¯ä»¥çœ‹å‡ºï¼Œå­—èŠ‚çš„æ•°æ®æš´æ¶¨é˜¶æ®µï¼Œé¦–å…ˆé‡åˆ°çš„é—®é¢˜æ˜¯Name Nodeçš„ç“¶é¢ˆï¼Œè€Œæ­¤æ—¶å­—èŠ‚çš„é›†ç¾¤ç¯å¢ƒä¸ºå•é›†ç¾¤ï¼Œæ­¤æ—¶çš„è§£å†³æ–¹æ¡ˆæ˜¯é‡‡ç”¨Federationã€‚æ•°æ®æŒç»­é«˜é€Ÿå¢é•¿ï¼ŒFederation æ–¹å¼ä¸‹çš„ç›®å½•æ ‘ç®¡ç†ä¹Ÿå­˜åœ¨ç“¶é¢ˆï¼Œä¸»è¦åŸå› æ˜¯Javaé¢‘ç¹GCï¼Œé‚£ä¹ˆå­—èŠ‚çš„è§£å†³æ–¹æ¡ˆå°±æ˜¾å¾—æœ‰äº›ç¡¬æ ¸äº†ï¼Œé‡å†™äº†NameNodeï¼Œåœ¨å­—èŠ‚ä¸­å«åšDanceNN ğŸ‚ğŸºã€‚åœ¨æ•°æ®è¶…è¿‡EBçº§åˆ«ä¹‹åï¼Œé‡åˆ°çš„é—®é¢˜å°±æ›´å¤šäº†ã€‚ä¸åŒç²’åº¦æœåŠ¡åˆ†çº§ï¼Œå…ƒæ•°æ®å­˜å‚¨ç“¶é¢ˆï¼Œæ…¢èŠ‚ç‚¹ç­‰é—®é¢˜ã€‚é‚£ä¹ˆå­—èŠ‚çš„è§£å†³æ–¹æ¡ˆåˆ™æ˜¯è€ƒè™‘åˆ°ä¸€æ–¹é¢ä»å­˜å‚¨æ–¹é¢çš„æ•°æ®èŠ‚ç‚¹è¿›è¡Œé‡æ„ï¼Œå¦ä¸€æ–¹é¢å¯¹äºå¤§å—çš„å…ƒæ•°æ®è¿›è¡Œåˆ†çº§ã€‚è¿™é‡Œè¦è¯´ä¸€ä¸‹ä¸Šé¢æåˆ°çš„NNProxyï¼Œå¥½ç”¨ï¼ï¼ä¸»è¦æœ‰ä¸¤ä¸ªåŠŸèƒ½å¾ˆå¸å¼•æˆ‘ï¼Œåœ¨Hadoopé›†ç¾¤åŸæœ‰çš„åŸºç¡€ä¸Šï¼Œå­—èŠ‚æ·»åŠ äº†NNProxyï¼Œä¸€ä¸ªæ˜¯æ ¹æ®ç”¨æˆ·è¯·æ±‚çš„è·¯å¾„è½¬å‘åˆ°ä¸åŒçš„HDFSç©ºé—´ï¼ŒäºŒå‘¢ï¼Œå¯¹å¤šç§Ÿæˆ·çš„åœºæ™¯ä¸‹ï¼Œå¯¹æ¯ä¸ªç”¨æˆ·çš„è¯·æ±‚åšåˆ¤æ–­ï¼Œå¦‚æœæŸä¸ªè¯·æ±‚é‡è¿‡å¤§ï¼Œåˆ™ä¼šå¯¹å…¶é™æµã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä¹Ÿé¢†ç•¥åˆ°äº†ä¸€ä¸ªåœºæ™¯ï¼Œé‚£å°±æ˜¯åœ¨å­—èŠ‚EBçº§åˆ«çš„é›†ç¾¤è§„æ¨¡ä¸‹ï¼Œé›†ç¾¤é‡å¯åˆ°å…¨éƒ¨æœåŠ¡æ¢å¤ï¼Œéœ€è¦6ä¸ªå°æ—¶å·¦å³ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"hdfs","slug":"hdfs","permalink":"cpeixin.cn/tags/hdfs/"}]},{"title":"GPT-2 Chinese è‡ªåŠ¨ç”Ÿæˆæ–‡ç«  - ç¯å¢ƒå‡†å¤‡","slug":"GPT-2-Chinese-è‡ªåŠ¨ç”Ÿæˆæ–‡ç« -ç¯å¢ƒå‡†å¤‡","date":"2020-01-01T14:28:43.000Z","updated":"2020-04-13T09:28:23.224Z","comments":true,"path":"2020/01/01/GPT-2-Chinese-è‡ªåŠ¨ç”Ÿæˆæ–‡ç« -ç¯å¢ƒå‡†å¤‡/","link":"","permalink":"cpeixin.cn/2020/01/01/GPT-2-Chinese-%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E6%96%87%E7%AB%A0-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/","excerpt":"","text":"Google ColabColaboratory æ˜¯ä¸€ä¸ª Google ç ”ç©¶é¡¹ç›®ï¼Œæ—¨åœ¨å¸®åŠ©ä¼ æ’­æœºå™¨å­¦ä¹ åŸ¹è®­å’Œç ”ç©¶æˆæœã€‚å®ƒæ˜¯ä¸€ä¸ª Jupyter ç¬”è®°æœ¬ç¯å¢ƒï¼Œä¸éœ€è¦è¿›è¡Œä»»ä½•è®¾ç½®å°±å¯ä»¥ä½¿ç”¨ï¼Œå¹¶ä¸”å®Œå…¨åœ¨äº‘ç«¯è¿è¡Œã€‚Colaboratory ç¬”è®°æœ¬å­˜å‚¨åœ¨ Google äº‘ç«¯ç¡¬ç›˜ä¸­ï¼Œå¹¶ä¸”å¯ä»¥å…±äº«ï¼Œå°±å¦‚åŒæ‚¨ä½¿ç”¨ Google æ–‡æ¡£æˆ–è¡¨æ ¼ä¸€æ ·ã€‚Colaboratory å¯å…è´¹ä½¿ç”¨ã€‚åˆ©ç”¨Colaboratory ï¼Œå¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨Keras,TensorFlow,PyTorchç­‰æ¡†æ¶è¿›è¡Œæ·±åº¦å­¦ä¹ åº”ç”¨çš„å¼€å‘ã€‚ç¼ºç‚¹æ˜¯æœ€å¤šåªèƒ½è¿è¡Œ12å°æ—¶ï¼Œæ—¶é—´ä¸€åˆ°å°±ä¼šæ¸…ç©ºVMä¸Šæ‰€æœ‰æ•°æ®ã€‚è¿™åŒ…æ‹¬æˆ‘ä»¬å®‰è£…çš„è½¯ä»¶ï¼ŒåŒ…æ‹¬æˆ‘ä»¬ä¸‹è½½çš„æ•°æ®ï¼Œå­˜æ”¾çš„è®¡ç®—ç»“æœï¼Œ æ‰€ä»¥æœ€å¥½ä¸è¦ç›´æ¥åœ¨colabä¸Šè¿›è¡Œæ–‡ä»¶çš„ä¿®æ”¹ï¼Œä»¥é˜²ä¿å­˜ä¸åŠæ—¶è€Œé€ æˆä¸¢å¤±ï¼Œè€Œä¸”Google Driveåªæœ‰å…è´¹çš„15Gç©ºé—´ï¼Œå¦‚æœè®­ç»ƒæ–‡ä»¶å¾ˆå¤§çš„è¯ï¼Œéœ€è¦æ‰©å®¹ã€‚ä¼˜ç‚¹ å…è´¹ï¼ å…è´¹ï¼å…è´¹ï¼**è°·æ­Œäº‘ç›˜å½“ç™»å½•è´¦å·è¿›å…¥è°·æ­Œäº‘ç›˜æ—¶ï¼Œç³»ç»Ÿä¼šç»™äºˆ15Gå…è´¹ç©ºé—´å¤§å°ã€‚ç”±äºColabéœ€è¦ä¾é è°·æ­Œäº‘ç›˜ï¼Œæ•…éœ€è¦åœ¨äº‘ç›˜ä¸Šæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ¥å­˜æ”¾ä½ çš„ä»£ç æˆ–è€…æ•°æ®ã€‚å¯ä»¥çœ‹åˆ°ä¸Šå›¾ï¼Œæˆ‘çš„å­˜å‚¨ç©ºé—´å‡ ä¹å¿«æ»¡äº†ï¼Œåœ¨é€‰æ‹©è¿›è¡Œæ‰©å®¹çš„æ—¶å€™å‘¢ï¼Œåˆ™éœ€è¦å›½å¤–é“¶è¡Œå¡å’Œå›½å¤–æ”¯ä»˜æ–¹å¼ï¼Œè¿™ä¸€ç‚¹å°±æœ‰ç‚¹å¤´ç—›ï¼Œä½†æ˜¯ä¸è¦å¿˜è®°ä¸‡èƒ½çš„æ·˜å®ï¼Œæœ€åé€šè¿‡æ·˜å®çš„ï¼ŒèŠ±è´¹20å…ƒå·¦å³ï¼Œå°±å‡çº§åˆ°äº†æ— é™ç©ºé—´ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œå‡çº§å­˜å‚¨ç©ºé—´çš„æ–¹å¼æ˜¯æ·»åŠ ä¸€å—å…±äº«äº‘ç›˜ï¼Œå¦‚ä¸‹å›¾ï¼šå¼•å…¥Colabè®¾ç½®GPUç¯å¢ƒæ‰“å¼€colabåï¼Œæˆ‘ä»¬è¦è®¾ç½®è¿è¡Œç¯å¢ƒã€‚â€ä¿®æ”¹â€â€”&gt;â€ç¬”è®°æœ¬è®¾ç½®â€æŒ‚è½½å’Œåˆ‡æ¢å·¥ä½œç›®å½•1234567from google.colab import drivedrive.mount('/content/drive')import os# os.chdir('/content/drive/My Drive/code/GPT2-Chinese') # åŸæœ¬Google driveçš„ç›®å½•os.chdir('/content/drive/Shared drives/brentfromchina/code_warehouse/GPT2-Chinese') ## å…±äº«äº‘ç›˜çš„ç›®å½•å…¶ä¸­ï¼š My Drive ä»£è¡¨ä½ çš„googleç½‘ç›˜æ ¹ç›®å½•code/GPT2-Chinese æˆ–è€… code_warehouse/GPT2-Chinese ä»£è¡¨ç½‘ç›˜ä¸­ä½ çš„ç¨‹åºæ–‡ä»¶ç›®å½•åœ¨Colabä¸­è¿è¡Œä»»åŠ¡ä¸‹å›¾æ˜¯æˆ‘google driveä¸­çš„æ–‡ä»¶ç»“æ„ï¼Œ åœ¨é¡¹ç›®æ–‡ä»¶ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª.ipynbæ–‡ä»¶ï¼Œæ¥æ‰§è¡Œä½ çš„æ‰€æœ‰æ“ä½œã€‚.ipynbæ–‡ä»¶å†…å®¹","categories":[{"name":"NLP","slug":"NLP","permalink":"cpeixin.cn/categories/NLP/"}],"tags":[{"name":"GPT-2","slug":"GPT-2","permalink":"cpeixin.cn/tags/GPT-2/"}]},{"title":"æ¶æ„æ€æƒ³","slug":"æ¶æ„æ€æƒ³","date":"2019-12-20T02:26:15.000Z","updated":"2020-04-04T11:23:45.206Z","comments":true,"path":"2019/12/20/æ¶æ„æ€æƒ³/","link":"","permalink":"cpeixin.cn/2019/12/20/%E6%9E%B6%E6%9E%84%E6%80%9D%E6%83%B3/","excerpt":"","text":"å…³äºä»€ä¹ˆæ˜¯æ¶æ„ï¼Œä¸€ç§æ¯”è¾ƒé€šä¿—çš„è¯´æ³•æ˜¯ â€œæœ€é«˜å±‚æ¬¡çš„è§„åˆ’ï¼Œéš¾ä»¥æ”¹å˜çš„å†³å®šâ€ï¼Œè¿™äº›è§„åˆ’å’Œå†³å®šå¥ å®šäº†äº‹ç‰©æœªæ¥å‘å±•çš„æ–¹å‘å’Œæœ€ç»ˆçš„è“å›¾ã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼Œäººç”Ÿè§„åˆ’ä¹Ÿæ˜¯ä¸€ç§æ¶æ„ã€‚é€‰ä»€ä¹ˆå­¦æ ¡ã€å­¦ä»€ä¹ˆä¸“ä¸šã€è¿›ä»€ä¹ˆå…¬å¸ã€æ‰¾ä»€ä¹ˆå¯¹è±¡ï¼Œè¿‡ä»€ä¹ˆæ ·çš„ç”Ÿæ´»ï¼Œéƒ½æ˜¯è‡ªå·±äººç”Ÿçš„æ¶æ„ã€‚å…·ä½“åˆ°è½¯ä»¶æ¶æ„ï¼Œç»´åŸºç™¾ç§‘æ˜¯è¿™æ ·å®šä¹‰çš„ï¼šâ€œæœ‰å…³è½¯ä»¶æ•´ä½“ç»“æ„ä¸ç»„ä»¶çš„æŠ½è±¡æè¿°ï¼Œç”¨äºæŒ‡å¯¼å¤§å‹è½¯ä»¶ç³»ç»Ÿå„ä¸ªæ–¹é¢çš„è®¾è®¡â€ã€‚ç³»ç»Ÿçš„å„ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†åŠå…¶å…³ç³»æ„æˆäº†ç³»ç»Ÿçš„æ¶æ„ï¼Œè¿™äº›ç»„æˆéƒ¨åˆ†å¯ä»¥æ˜¯å…·ä½“çš„åŠŸèƒ½æ¨¡å—ï¼Œä¹Ÿå¯ä»¥æ˜¯éåŠŸèƒ½çš„è®¾è®¡ä¸å†³ç­–ï¼Œä»–ä»¬ç›¸äº’å…³ç³»ç»„æˆä¸€ä¸ªæ•´ä½“ï¼Œå…±åŒæ„æˆäº†è½¯ä»¶ç³»ç»Ÿçš„æ¶æ„ã€‚æ¶æ„å…¶å®å°±æ˜¯æŠŠå¤æ‚çš„é—®é¢˜æŠ½è±¡åŒ–ã€ç®€å•åŒ–ï¼Œå¯èƒ½ä½ ä¼šè§‰å¾—â€œè¯´èµ·æ¥å®¹æ˜“ä½†åšèµ·æ¥éš¾â€ï¼Œå¦‚ä½•èƒ½å¿«é€Ÿä¸Šæ‰‹ã€‚å¯ä»¥å¤šè§‚å¯Ÿï¼Œæ ¹æ®ç‰©è´¨å†³å®šæ„è¯†ï¼Œå€ŸåŠ©ç”Ÿæ´»çœŸå®åœºæ™¯ï¼ˆç”¨æˆ·æ•…äº‹ï¼Œè¦å¾ˆå¤šæ•…äº‹ï¼‰æ¥è¿˜åŸè¿™ä¸€ç³»åˆ—é—®é¢˜ï¼ŒæŠ“ä½å¹¶æå–æ ¸å¿ƒç‰¹å¾ã€‚æ¶æ„æ€æƒ³CPUè¿ç®—é€Ÿåº¦&gt;&gt;&gt;&gt;&gt;å†…å­˜çš„è¯»å†™é€Ÿåº¦&gt;&gt;&gt;&gt;ç£ç›˜è¯»å†™é€Ÿåº¦æ»¡è¶³ä¸šåŠ¡å‘å±•éœ€æ±‚æ˜¯æœ€é«˜å‡†åˆ™ä¸šåŠ¡å»ºæ¨¡ï¼ŒæŠ½è±¡å’Œæšä¸¾æ˜¯ä¸¤ç§æ–¹å¼ï¼Œéœ€è¦å¹³è¡¡ï¼Œä¸èƒ½èµ°æç«¯æ¨¡å‹è¦èƒ½æ›´çœŸå®çš„ååº”äº‹ç‰©çš„æœ¬è´¨ï¼Œä¸æ˜¯åè¯æ¦‚å¿µçš„å †ç Œï¼Œä¸èƒ½è¿‡åº¦è®¾è®¡åŸºç¡€æ¶æ„æœ€å…³é”®çš„æ˜¯åˆ†ç¦»ä¸åŒä¸šåŠ¡é¢†åŸŸã€ä¸åŒæŠ€æœ¯é¢†åŸŸï¼Œè®©æ•´ä¸ªç³»ç»Ÿå…·æœ‰æŒç»­ä¼˜åŒ–çš„èƒ½åŠ›ã€‚åˆ†ç¦»åŸºç¡€æœåŠ¡ã€ä¸šåŠ¡è§„åˆ™ã€ä¸šåŠ¡æµç¨‹ï¼Œé€‰æ‹©åˆé€‚çš„å·¥å…·å¤–åŒ–ä¸šåŠ¡è§„åˆ™å’Œä¸šåŠ¡æµç¨‹åˆ†ç¦»ä¸šåŠ¡ç»„ä»¶å’ŒæŠ€æœ¯ç»„ä»¶ï¼Œé«˜ç±»èšï¼Œä½è€¦åˆ - ä¸šåŠ¡ä¿¡æ¯çš„æ‰§è¡Œå¯ä»¥åˆ†æ•£ï¼Œä½†ä¸šåŠ¡ä¿¡æ¯çš„ç®¡ç†è¦å°½é‡é›†ä¸­ä¸è¦è®©è½¯ä»¶çš„é€»è¾‘æ¶æ„ä¸æœ€åç‰©ç†éƒ¨ç½²ç»‘æ­» - é€‰æ‹©åˆé€‚çš„æŠ€æœ¯è€Œä¸æ˜¯é«˜æ·±çš„æŠ€æœ¯ï¼Œéšç€ä¸šåŠ¡çš„å‘å±•è°ƒæ•´ä½¿ç”¨çš„æŠ€æœ¯å¥½çš„ç³»ç»Ÿæ¶æ„éœ€è¦åˆé€‚çš„ç»„ç»‡æ¶æ„å»ä¿éšœ - å›¢é˜Ÿæˆå‘˜æ€æƒ³çš„è½¬å˜ï¼Œæ¼«é•¿è€Œè‰°éš¾ä¸šåŠ¡æ¶æ„ã€ç³»ç»Ÿæ¶æ„ã€æ•°æ®æ¨¡å‹é¢å¯¹ä¸€å—æ–°ä¸šåŠ¡ï¼Œå¦‚ä½•ç³»ç»Ÿæ¶æ„ï¼Ÿä¸šåŠ¡åˆ†æï¼šè¾“å‡ºä¸šåŠ¡æ¶æ„å›¾ï¼Œè¿™ä¸ªç³»ç»Ÿé‡Œæœ‰å¤šå°‘ä¸ªä¸šåŠ¡æ¨¡å—ï¼Œä»å‰å°ç”¨æˆ·åˆ°åº•å±‚ä¸€å…±æœ‰å¤šå°‘å±‚ã€‚ç³»ç»Ÿåˆ’åˆ†ï¼šæ ¹æ®ä¸šåŠ¡æ¶æ„å›¾è¾“å‡ºç³»ç»Ÿæ¶æ„å›¾ï¼Œéœ€è¦æ€è€ƒçš„æ˜¯è¿™å—ä¸šåŠ¡åˆ’åˆ†æˆå¤šå°‘ä¸ªç³»ç»Ÿï¼Œå¯èƒ½ä¸€ä¸ªç³»ç»Ÿèƒ½æ”¯æŒå¤šä¸ªä¸šåŠ¡ã€‚åŸºäºä»€ä¹ˆåŸåˆ™å°†ä¸€ä¸ªç³»ç»Ÿæ‹†åˆ†æˆå¤šä¸ªç³»ç»Ÿï¼ŸåˆåŸºäºä»€ä¹ˆåŸåˆ™å°†ä¸¤ä¸ªç³»ç»Ÿåˆå¹¶æˆä¸€ä¸ªç³»ç»Ÿï¼Ÿç³»ç»Ÿåˆ†å±‚ï¼šç³»ç»Ÿæ˜¯å‡ å±‚æ¶æ„ï¼ŒåŸºäºä»€ä¹ˆåŸåˆ™å°†ä¸€ä¸ªç³»ç»Ÿè¿›è¡Œåˆ†å±‚ï¼Œåˆ†æˆå¤šå°‘å±‚ï¼Ÿæ¨¡å—åŒ–ï¼šç³»ç»Ÿé‡Œæœ‰å¤šå°‘ä¸ªæ¨¡å—ï¼Œå“ªäº›éœ€è¦æ¨¡å—åŒ–ï¼ŸåŸºäºä»€ä¹ˆåŸåˆ™å°†ä¸€ç±»ä»£ç å˜æˆä¸€ä¸ªæ¨¡å—ã€‚å¦‚ä½•æ¨¡å—åŒ–åŸºäºæ°´å¹³åˆ‡åˆ†ã€‚æŠŠä¸€ä¸ªç³»ç»ŸæŒ‰ç…§ä¸šåŠ¡ç±»å‹è¿›è¡Œæ°´å¹³åˆ‡åˆ†æˆå¤šä¸ªæ¨¡å—ï¼Œæ¯”å¦‚æƒé™ç®¡ç†æ¨¡å—ï¼Œç”¨æˆ·ç®¡ç†æ¨¡å—ï¼Œå„ç§ä¸šåŠ¡æ¨¡å—ç­‰ã€‚åŸºäºå‚ç›´åˆ‡åˆ†ã€‚æŠŠä¸€ä¸ªç³»ç»ŸæŒ‰ç…§ç³»ç»Ÿå±‚æ¬¡è¿›è¡Œå‚ç›´åˆ‡åˆ†æˆå¤šä¸ªæ¨¡å—ï¼Œå¦‚DAOå±‚ï¼ŒSERVICEå±‚ï¼Œä¸šåŠ¡é€»è¾‘å±‚ã€‚åŸºäºå•ä¸€èŒè´£ã€‚å°†ä»£ç æŒ‰ç…§èŒè´£æŠ½è±¡å‡ºæ¥å½¢æˆä¸€ä¸ªä¸€ä¸ªçš„æ¨¡å—ã€‚å°†ç³»ç»Ÿä¸­åŒä¸€èŒè´£çš„ä»£ç æ”¾åœ¨ä¸€ä¸ªæ¨¡å—é‡Œã€‚æ¯”å¦‚æˆ‘ä»¬å¼€å‘çš„ç³»ç»Ÿè¦å¯¹æ¥å¤šä¸ªæ¸ é“çš„æ•°æ®ï¼Œæ¯ä¸ªæ¸ é“çš„å¯¹æ¥æ–¹å¼å’Œæ•°æ®è§£ææ–¹å¼ä¸ä¸€æ ·ï¼Œä¸ºé¿å…ä¸åŒæ¸ é“ä»£ç çš„ç›¸äº’å½±å“ï¼Œæˆ‘ä»¬æŠŠå„ä¸ªæ¸ é“çš„ä»£ç æ”¾åœ¨å„è‡ªçš„æ¨¡å—é‡Œã€‚åŸºäºæ˜“å˜å’Œä¸æ˜“å˜ã€‚å°†ä¸æ˜“å˜çš„ä»£ç æŠ½è±¡åˆ°ä¸€ä¸ªæ¨¡å—é‡Œï¼Œæ¯”å¦‚ç³»ç»Ÿçš„æ¯”è¾ƒé€šç”¨çš„åŠŸèƒ½ã€‚å°†æ˜“å˜çš„ä»£ç æ”¾åœ¨å¦å¤–ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡å—é‡Œï¼Œæ¯”å¦‚ä¸šåŠ¡é€»è¾‘ã€‚å› ä¸ºæ˜“å˜çš„ä»£ç ç»å¸¸ä¿®æ”¹ï¼Œä¼šå¾ˆä¸ç¨³å®šï¼Œåˆ†å¼€ä¹‹åæ˜“å˜ä»£ç åœ¨ä¿®æ”¹æ—¶å€™ï¼Œä¸ä¼šå°†BUGä¼ æŸ“ç»™ä¸å˜çš„ä»£ç ã€‚æå‡ç³»ç»Ÿçš„ç¨³å®šæ€§æµæ§åŒ11æœŸé—´ï¼Œå¯¹äºä¸€äº›é‡è¦çš„æ¥å£ï¼ˆæ¯”å¦‚å¸å·çš„æŸ¥è¯¢æ¥å£ï¼Œåº—é“ºé¦–é¡µï¼‰åšæµé‡æ§åˆ¶ï¼Œè¶…è¿‡é˜ˆå€¼ç›´æ¥è¿”å›å¤±è´¥ã€‚å¦å¤–å¯¹äºä¸€äº›ä¸é‡è¦çš„ä¸šåŠ¡ä¹Ÿå¯ä»¥è€ƒè™‘é‡‡ç”¨é™çº§æ–¹æ¡ˆï¼Œå¤§ä¿ƒâ€”&gt;é‚®ä»¶ç³»ç»Ÿã€‚æ ¹æ®28åŸåˆ™ï¼Œæå‰å°†å¤§å–å®¶çº¦1Wå·¦å³åœ¨ç¼“å­˜ä¸­é¢„çƒ­ï¼Œå¹¶è®¾ç½®èµ·æ­¢æ—¶é—´ï¼Œæ´»åŠ¨æœŸé—´å†…è¿™éƒ¨åˆ†å¤§å–å®¶ä¸å‘äº¤æ˜“é‚®ä»¶æé†’ï¼Œä»¥å‡è½»SAé‚®ä»¶æœåŠ¡å™¨çš„å‹åŠ›ã€‚å®¹ç¾æœ€å¤§ç¨‹åº¦ä¿è¯ä¸»é“¾è·¯çš„å¯ç”¨æ€§ï¼Œæ¯”å¦‚æˆ‘è´Ÿè´£äº¤æ˜“çš„ä¸‹å•ï¼Œè€Œä¸‹å•è¿‡ç¨‹ä¸­æœ‰ä¼˜æƒ çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ­¤æ—¶éœ€è¦è€ƒè™‘UMPç³»ç»ŸæŒ‚æ‰ï¼Œä¸ä¼šå½±å“ç”¨æˆ·ä¸‹å•ï¼ˆåé¢å¯ä»¥é€šè¿‡ä¿®æ”¹ä»·æ ¼å¼¥è¡¥ï¼‰ï¼Œé‡‡ç”¨çš„æ–¹å¼æ˜¯ï¼Œå¦‚æœä¼˜æƒ æŒ‚æ‰ï¼Œé‡æ–°æ¸²æŸ“é¡µé¢ï¼Œå¹¶å¢åŠ umpå±è”½æ ‡è®°ï¼Œä¸‹å•æ—¶ä¼šè‡ªåŠ¨å±è”½umpçš„ä»£ç é€»è¾‘ã€‚å¦å¤–è¿˜ä¼šè®°å½•umpç³»ç»Ÿä¸å¯ç”¨æ¬¡æ•°ï¼Œä¸€å®šæ—¶é—´å†…è¶…è¿‡é˜ˆå€¼ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚ç¨³å®šæ€§ç¬¬ä¸‰æ–¹ç³»ç»Ÿå¯èƒ½ä¼šä¸ç¨³å®šï¼Œå­˜åœ¨æ¥å£è¶…æ—¶æˆ–å®•æœºï¼Œä¸ºäº†å¢åŠ ç³»ç»Ÿçš„å¥å£®æ€§ï¼Œè°ƒç”¨æ¥å£æ—¶è®¾ç½®è¶…æ—¶æ—¶é—´ä»¥åŠå¼‚å¸¸æ•è·å¤„ç†ã€‚å®¹é‡è§„åˆ’åšå¥½å®¹é‡è§„åˆ’ã€ç³»ç»Ÿé—´å¼ºå¼±ä¾èµ–å…³ç³»æ¢³ç†ã€‚å¦‚ï¼šå†·çƒ­æ•°æ®ä¸åŒå¤„ç†ï¼Œæ—©æœŸçš„è®¢å•é‡‡ç”¨oracleå­˜å‚¨ï¼Œéšç€è®¢å•çš„æ•°é‡è¶Šæ¥è¶Šå¤šï¼ŒæŸ¥è¯¢ç¼“æ…¢ï¼Œè€ƒè™‘æ•°æ®è¿ç§»ï¼Œå¼•å…¥å†å²è¡¨ï¼Œå°†å·²å½’æ¡£çš„è®°å½•è¿ç§»åˆ°å†å²è¡¨ä¸­ã€‚å½“ç„¶æœ€å¥½çš„æ–¹æ³•æ˜¯åˆ†åº“åˆ†è¡¨ã€‚åˆ†å¸ƒå¼æ¶æ„åˆ†å¸ƒå¼ç³»ç»Ÿåˆ†å¸ƒå¼ç¼“å­˜åˆ†å¸ƒå¼æ•°æ®API å’Œä¹é«˜ç§¯æœ¨æœ‰ä»€ä¹ˆç›¸ä¼¼ä¹‹å¤„ï¼Ÿç›¸ä¿¡æˆ‘ä»¬å¤§å¤šæ•°äººåœ¨å„¿ç«¥æ—¶æœŸéƒ½å–œæ¬¢ç©ä¹é«˜ç§¯æœ¨ã€‚ä¹é«˜ç§¯æœ¨çš„çœŸæ­£ä¹è¶£å’Œå¸å¼•åŠ›åœ¨äºï¼Œå°½ç®¡åŒ…è£…ç›’å¤–é¢éƒ½å¸¦æœ‰ç¤ºæ„å›¾ç‰‡ï¼Œä½†ä½ æœ€ç»ˆéƒ½å¯ä»¥éšå¿ƒæ‰€æ¬²å¾—æ­å‡ºå„ç§æ ·å­æˆ–é€ å‹ã€‚å¯¹ API çš„æœ€ä½³è§£é‡Šå°±æ˜¯å®ƒä»¬åƒä¹é«˜ç§¯æœ¨ä¸€æ ·ã€‚æˆ‘ä»¬å¯ä»¥ç”¨åˆ›é€ æ€§çš„æ–¹å¼æ¥ç»„åˆå®ƒä»¬ï¼Œè€Œä¸ç”¨åœ¨æ„å®ƒä»¬åŸæœ¬çš„è®¾è®¡å’Œå®ç°æ„å›¾ã€‚ä½ å¯ä»¥å‘ç°å¾ˆå¤š API å’Œä¹é«˜ç§¯æœ¨çš„ç›¸ä¼¼ä¹‹å¤„ï¼šæ ‡å‡†åŒ–ï¼šé€šç”¨ã€æ ‡å‡†åŒ–çš„ç»„ä»¶ï¼Œä½œä¸ºåŸºæœ¬çš„æ„å»ºå—ï¼ˆbuilding blocksï¼‰ï¼›å¯ç”¨æ€§ï¼šå¼ºè°ƒå¯ç”¨æ€§ï¼Œé™„æœ‰æ–‡æ¡£æˆ–ä½¿ç”¨è¯´æ˜ï¼›å¯å®šåˆ¶ï¼šä¸ºä¸åŒåŠŸèƒ½ä½¿ç”¨ä¸åŒçš„APIï¼›åˆ›é€ æ€§ï¼šèƒ½å¤Ÿç»„åˆä¸åŒçš„ API æ¥åˆ›é€ æ··æ­çš„ç»“æœï¼›ä¹é«˜å’Œ API éƒ½æœ‰è¶…ç®€å•çš„ç•Œé¢/æ¥å£ï¼Œå¹¶ä¸”å€ŸåŠ©è¿™æ ·ç®€å•çš„ç•Œé¢/æ¥å£ï¼Œå®ƒå¯ä»¥éå¸¸ç›´è§‚ã€å®¹æ˜“ã€å¿«é€Ÿå¾—æ„å»ºã€‚è™½ç„¶ä¹é«˜å’Œ API ä¸€æ ·å¯èƒ½é™„å¸¦ç¤ºæ„å›¾ç‰‡æˆ–ä½¿ç”¨æ–‡æ¡£ï¼Œå¤§æ¦‚æè¿°äº†æ¨èç©æ³•æˆ–ç”¨é€”ï¼Œä½†çœŸæ­£ä»¤äººå…´å¥‹çš„ç»“æœæˆ–æ”¶è·æ°æ°æ˜¯é€šè¿‡åˆ›é€ åŠ›äº§ç”Ÿçš„ã€‚è®©æˆ‘ä»¬ä»”ç»†åœ°æ€è€ƒä¸‹ä¸Šè¿°çš„ææ³•ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒAPI çš„ä½¿ç”¨è€…æ„å»ºå‡ºäº† API çš„æ„å»ºè€…è¶…å‡ºé¢„æœŸçš„æœåŠ¡æˆ–äº§å“ï¼ŒAPI ä½¿ç”¨è€…æƒ³è¦çš„ï¼Œå’Œ API æ„å»ºè€…è®¤ä¸ºä½¿ç”¨è€…æƒ³è¦çš„ï¼Œè¿™äºŒè€…ä¹‹é—´é€šå¸¸æœ‰ä¸ªæ–­å±‚ã€‚äº‹å®ä¹Ÿç¡®å®å¦‚æ­¤ï¼Œåœ¨ IoT é¢†åŸŸï¼Œæˆ‘ä»¬ä½¿ç”¨ API åˆ›é€ å‡ºäº†ä¸€äº›éå¸¸æœ‰åˆ›é€ æ€§çš„ä½¿ç”¨åœºæ™¯ã€‚","categories":[{"name":"æ¶æ„","slug":"æ¶æ„","permalink":"cpeixin.cn/categories/%E6%9E%B6%E6%9E%84/"}],"tags":[]},{"title":"è®¾è®¡æ¨¡å¼ - å•ä¾‹æ¨¡å¼ï¼ˆä¸Šï¼‰","slug":"è®¾è®¡æ¨¡å¼-å•ä¾‹æ¨¡å¼ï¼ˆä¸Šï¼‰","date":"2019-12-09T07:38:03.000Z","updated":"2020-08-09T07:40:39.845Z","comments":true,"path":"2019/12/09/è®¾è®¡æ¨¡å¼-å•ä¾‹æ¨¡å¼ï¼ˆä¸Šï¼‰/","link":"","permalink":"cpeixin.cn/2019/12/09/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%B8%8A%EF%BC%89/","excerpt":"","text":"å¤§çº²ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å•ä¾‹ï¼Ÿå•ä¾‹å­˜åœ¨å“ªäº›é—®é¢˜ï¼Ÿå•ä¾‹ä¸é™æ€ç±»çš„åŒºåˆ«ï¼Ÿæœ‰ä½•æ›¿ä»£çš„è§£å†³æ–¹æ¡ˆï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨å•ä¾‹ï¼Ÿå•ä¾‹è®¾è®¡æ¨¡å¼ï¼ˆSingleton Design Patternï¼‰ç†è§£èµ·æ¥éå¸¸ç®€å•ã€‚ä¸€ä¸ªç±»åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ˆæˆ–è€…å®ä¾‹ï¼‰ï¼Œé‚£è¿™ä¸ªç±»å°±æ˜¯ä¸€ä¸ªå•ä¾‹ç±»ï¼Œè¿™ç§è®¾è®¡æ¨¡å¼å°±å«ä½œå•ä¾‹è®¾è®¡æ¨¡å¼ï¼Œç®€ç§°å•ä¾‹æ¨¡å¼ã€‚å¯¹äºå•ä¾‹çš„æ¦‚å¿µï¼Œæˆ‘è§‰å¾—æ²¡å¿…è¦è§£é‡Šå¤ªå¤šï¼Œä½ ä¸€çœ‹å°±èƒ½æ˜ç™½ã€‚æˆ‘ä»¬é‡ç‚¹çœ‹ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å•ä¾‹è¿™ç§è®¾è®¡æ¨¡å¼ï¼Ÿå®ƒèƒ½è§£å†³å“ªäº›é—®é¢˜ï¼Ÿæ¥ä¸‹æ¥æˆ‘é€šè¿‡ä¸¤ä¸ªå®æˆ˜æ¡ˆä¾‹æ¥è®²è§£ã€‚å®æˆ˜æ¡ˆä¾‹ä¸€ï¼šå¤„ç†èµ„æºè®¿é—®å†²çªæˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªä¾‹å­ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰å®ç°äº†ä¸€ä¸ªå¾€æ–‡ä»¶ä¸­æ‰“å°æ—¥å¿—çš„ Logger ç±»ã€‚å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š1234567891011121314151617181920212223242526272829303132public class Logger &#123; private FileWriter writer; public Logger() &#123; File file = new File(\"/Users/wangzheng/log.txt\"); writer = new FileWriter(file, true); //trueè¡¨ç¤ºè¿½åŠ å†™å…¥ &#125; public void log(String message) &#123; writer.write(mesasge); &#125;&#125;// Loggerç±»çš„åº”ç”¨ç¤ºä¾‹ï¼špublic class UserController &#123; private Logger logger = new Logger(); public void login(String username, String password) &#123; // ...çœç•¥ä¸šåŠ¡é€»è¾‘ä»£ç ... logger.log(username + \" logined!\"); &#125;&#125;public class OrderController &#123; private Logger logger = new Logger(); public void create(OrderVo order) &#123; // ...çœç•¥ä¸šåŠ¡é€»è¾‘ä»£ç ... logger.log(\"Created an order: \" + order.toString()); &#125;&#125;çœ‹å®Œä»£ç ä¹‹åï¼Œå…ˆåˆ«ç€æ€¥çœ‹æˆ‘ä¸‹é¢çš„è®²è§£ï¼Œä½ å¯ä»¥å…ˆæ€è€ƒä¸€ä¸‹ï¼Œè¿™æ®µä»£ç å­˜åœ¨ä»€ä¹ˆé—®é¢˜ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ï¼Œæ‰€æœ‰çš„æ—¥å¿—éƒ½å†™å…¥åˆ°åŒä¸€ä¸ªæ–‡ä»¶ /Users/wangzheng/log.txt ä¸­ã€‚åœ¨ UserController å’Œ OrderController ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«åˆ›å»ºä¸¤ä¸ª Logger å¯¹è±¡ã€‚åœ¨ Web å®¹å™¨çš„ Servlet å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¦‚æœä¸¤ä¸ª Servlet çº¿ç¨‹åŒæ—¶åˆ†åˆ«æ‰§è¡Œ login() å’Œ create() ä¸¤ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”åŒæ—¶å†™æ—¥å¿—åˆ° log.txt æ–‡ä»¶ä¸­ï¼Œé‚£å°±æœ‰å¯èƒ½å­˜åœ¨æ—¥å¿—ä¿¡æ¯äº’ç›¸è¦†ç›–çš„æƒ…å†µã€‚ä¸ºä»€ä¹ˆä¼šå‡ºç°äº’ç›¸è¦†ç›–å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç±»æ¯”ç€ç†è§£ã€‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ç»™åŒä¸€ä¸ªå…±äº«å˜é‡åŠ  1ï¼Œå› ä¸ºå…±äº«å˜é‡æ˜¯ç«äº‰èµ„æºï¼Œæ‰€ä»¥ï¼Œå…±äº«å˜é‡æœ€åçš„ç»“æœæœ‰å¯èƒ½å¹¶ä¸æ˜¯åŠ äº† 2ï¼Œè€Œæ˜¯åªåŠ äº† 1ã€‚åŒç†ï¼Œè¿™é‡Œçš„ log.txt æ–‡ä»¶ä¹Ÿæ˜¯ç«äº‰èµ„æºï¼Œä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¾€é‡Œé¢å†™æ•°æ®ï¼Œå°±æœ‰å¯èƒ½å­˜åœ¨äº’ç›¸è¦†ç›–çš„æƒ…å†µã€‚é‚£å¦‚ä½•æ¥è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬æœ€å…ˆæƒ³åˆ°çš„å°±æ˜¯é€šè¿‡åŠ é”çš„æ–¹å¼ï¼šç»™ log() å‡½æ•°åŠ äº’æ–¥é”ï¼ˆJava ä¸­å¯ä»¥é€šè¿‡ synchronized çš„å…³é”®å­—ï¼‰ï¼ŒåŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨æ‰§è¡Œ log() å‡½æ•°ã€‚å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š123456789101112131415public class Logger &#123; private FileWriter writer; public Logger() &#123; File file = new File(\"/Users/wangzheng/log.txt\"); writer = new FileWriter(file, true); //trueè¡¨ç¤ºè¿½åŠ å†™å…¥ &#125; public void log(String message) &#123; synchronized(this) &#123; writer.write(mesasge); &#125; &#125;&#125;ä¸è¿‡ï¼Œä½ ä»”ç»†æƒ³æƒ³ï¼Œè¿™çœŸçš„èƒ½è§£å†³å¤šçº¿ç¨‹å†™å…¥æ—¥å¿—æ—¶äº’ç›¸è¦†ç›–çš„é—®é¢˜å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚è¿™æ˜¯å› ä¸ºï¼Œè¿™ç§é”æ˜¯ä¸€ä¸ªå¯¹è±¡çº§åˆ«çš„é”ï¼Œä¸€ä¸ªå¯¹è±¡åœ¨ä¸åŒçš„çº¿ç¨‹ä¸‹åŒæ—¶è°ƒç”¨ log() å‡½æ•°ï¼Œä¼šè¢«å¼ºåˆ¶è¦æ±‚é¡ºåºæ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä¸åŒçš„å¯¹è±¡ä¹‹é—´å¹¶ä¸å…±äº«åŒä¸€æŠŠé”ã€‚åœ¨ä¸åŒçš„çº¿ç¨‹ä¸‹ï¼Œé€šè¿‡ä¸åŒçš„å¯¹è±¡è°ƒç”¨æ‰§è¡Œ log() å‡½æ•°ï¼Œé”å¹¶ä¸ä¼šèµ·ä½œç”¨ï¼Œä»ç„¶æœ‰å¯èƒ½å­˜åœ¨å†™å…¥æ—¥å¿—äº’ç›¸è¦†ç›–çš„é—®é¢˜ã€‚æˆ‘è¿™é‡Œç¨å¾®è¡¥å……ä¸€ä¸‹ï¼Œåœ¨åˆšåˆšçš„è®²è§£å’Œç»™å‡ºçš„ä»£ç ä¸­ï¼Œæˆ‘æ•…æ„â€œéšç’â€äº†ä¸€ä¸ªäº‹å®ï¼šæˆ‘ä»¬ç»™ log() å‡½æ•°åŠ ä¸åŠ å¯¹è±¡çº§åˆ«çš„é”ï¼Œå…¶å®éƒ½æ²¡æœ‰å…³ç³»ã€‚å› ä¸º FileWriter æœ¬èº«å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒçš„å†…éƒ¨å®ç°ä¸­æœ¬èº«å°±åŠ äº†å¯¹è±¡çº§åˆ«çš„é”ï¼Œå› æ­¤ï¼Œåœ¨å¤–å±‚è°ƒç”¨ write() å‡½æ•°çš„æ—¶å€™ï¼Œå†åŠ å¯¹è±¡çº§åˆ«çš„é”å®é™…ä¸Šæ˜¯å¤šæ­¤ä¸€ä¸¾ã€‚å› ä¸ºä¸åŒçš„ Logger å¯¹è±¡ä¸å…±äº« FileWriter å¯¹è±¡ï¼Œæ‰€ä»¥ï¼ŒFileWriter å¯¹è±¡çº§åˆ«çš„é”ä¹Ÿè§£å†³ä¸äº†æ•°æ®å†™å…¥äº’ç›¸è¦†ç›–çš„é—®é¢˜ã€‚é‚£æˆ‘ä»¬è¯¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå®é™…ä¸Šï¼Œè¦æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿä¸éš¾ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠå¯¹è±¡çº§åˆ«çš„é”ï¼Œæ¢æˆç±»çº§åˆ«çš„é”å°±å¯ä»¥äº†ã€‚è®©æ‰€æœ‰çš„å¯¹è±¡éƒ½å…±äº«åŒä¸€æŠŠé”ã€‚è¿™æ ·å°±é¿å…äº†ä¸åŒå¯¹è±¡ä¹‹é—´åŒæ—¶è°ƒç”¨ log() å‡½æ•°ï¼Œè€Œå¯¼è‡´çš„æ—¥å¿—è¦†ç›–é—®é¢˜ã€‚å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š123456789101112131415public class Logger &#123; private FileWriter writer; public Logger() &#123; File file = new File(\"/Users/wangzheng/log.txt\"); writer = new FileWriter(file, true); //trueè¡¨ç¤ºè¿½åŠ å†™å…¥ &#125; public void log(String message) &#123; synchronized(Logger.class) &#123; // ç±»çº§åˆ«çš„é” writer.write(mesasge); &#125; &#125;&#125;é™¤äº†ä½¿ç”¨ç±»çº§åˆ«é”ä¹‹å¤–ï¼Œå®é™…ä¸Šï¼Œè§£å†³èµ„æºç«äº‰é—®é¢˜çš„åŠæ³•è¿˜æœ‰å¾ˆå¤šï¼Œåˆ†å¸ƒå¼é”æ˜¯æœ€å¸¸å¬åˆ°çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚ä¸è¿‡ï¼Œå®ç°ä¸€ä¸ªå®‰å…¨å¯é ã€æ—  bugã€é«˜æ€§èƒ½çš„åˆ†å¸ƒå¼é”ï¼Œå¹¶ä¸æ˜¯ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¹¶å‘é˜Ÿåˆ—ï¼ˆæ¯”å¦‚ Java ä¸­çš„ BlockingQueueï¼‰ä¹Ÿå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶å¾€å¹¶å‘é˜Ÿåˆ—é‡Œå†™æ—¥å¿—ï¼Œä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹è´Ÿè´£å°†å¹¶å‘é˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œå†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ã€‚è¿™ç§æ–¹å¼å®ç°èµ·æ¥ä¹Ÿç¨å¾®æœ‰ç‚¹å¤æ‚ã€‚ç›¸å¯¹äºè¿™ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œå•ä¾‹æ¨¡å¼çš„è§£å†³æ€è·¯å°±ç®€å•ä¸€äº›äº†ã€‚å•ä¾‹æ¨¡å¼ç›¸å¯¹äºä¹‹å‰ç±»çº§åˆ«é”çš„å¥½å¤„æ˜¯ï¼Œä¸ç”¨åˆ›å»ºé‚£ä¹ˆå¤š Logger å¯¹è±¡ï¼Œä¸€æ–¹é¢èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå¦ä¸€æ–¹é¢èŠ‚çœç³»ç»Ÿæ–‡ä»¶å¥æŸ„ï¼ˆå¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œæ–‡ä»¶å¥æŸ„ä¹Ÿæ˜¯ä¸€ç§èµ„æºï¼Œä¸èƒ½éšä¾¿æµªè´¹ï¼‰ã€‚æˆ‘ä»¬å°† Logger è®¾è®¡æˆä¸€ä¸ªå•ä¾‹ç±»ï¼Œç¨‹åºä¸­åªå…è®¸åˆ›å»ºä¸€ä¸ª Logger å¯¹è±¡ï¼Œæ‰€æœ‰çš„çº¿ç¨‹å…±äº«ä½¿ç”¨çš„è¿™ä¸€ä¸ª Logger å¯¹è±¡ï¼Œå…±äº«ä¸€ä¸ª FileWriter å¯¹è±¡ï¼Œè€Œ FileWriter æœ¬èº«æ˜¯å¯¹è±¡çº§åˆ«çº¿ç¨‹å®‰å…¨çš„ï¼Œä¹Ÿå°±é¿å…äº†å¤šçº¿ç¨‹æƒ…å†µä¸‹å†™æ—¥å¿—ä¼šäº’ç›¸è¦†ç›–çš„é—®é¢˜ã€‚æŒ‰ç…§è¿™ä¸ªè®¾è®¡æ€è·¯ï¼Œæˆ‘ä»¬å®ç°äº† Logger å•ä¾‹ç±»ã€‚å…·ä½“ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š123456789101112131415161718192021222324252627282930313233public class Logger &#123; private FileWriter writer; private static final Logger instance = new Logger(); private Logger() &#123; File file = new File(\"/Users/wangzheng/log.txt\"); writer = new FileWriter(file, true); //trueè¡¨ç¤ºè¿½åŠ å†™å…¥ &#125; public static Logger getInstance() &#123; return instance; &#125; public void log(String message) &#123; writer.write(mesasge); &#125;&#125;// Loggerç±»çš„åº”ç”¨ç¤ºä¾‹ï¼špublic class UserController &#123; public void login(String username, String password) &#123; // ...çœç•¥ä¸šåŠ¡é€»è¾‘ä»£ç ... Logger.getInstance().log(username + \" logined!\"); &#125;&#125;public class OrderController &#123; public void create(OrderVo order) &#123; // ...çœç•¥ä¸šåŠ¡é€»è¾‘ä»£ç ... Logger.getInstance().log(\"Created a order: \" + order.toString()); &#125;&#125;**å®æˆ˜æ¡ˆä¾‹äºŒï¼šè¡¨ç¤ºå…¨å±€å”¯ä¸€ç±»ä»ä¸šåŠ¡æ¦‚å¿µä¸Šï¼Œå¦‚æœæœ‰äº›æ•°æ®åœ¨ç³»ç»Ÿä¸­åªåº”ä¿å­˜ä¸€ä»½ï¼Œé‚£å°±æ¯”è¾ƒé€‚åˆè®¾è®¡ä¸ºå•ä¾‹ç±»ã€‚æ¯”å¦‚ï¼Œé…ç½®ä¿¡æ¯ç±»ã€‚åœ¨ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå½“é…ç½®æ–‡ä»¶è¢«åŠ è½½åˆ°å†…å­˜ä¹‹åï¼Œä»¥å¯¹è±¡çš„å½¢å¼å­˜åœ¨ï¼Œä¹Ÿç†æ‰€åº”å½“åªæœ‰ä¸€ä»½ã€‚å†æ¯”å¦‚ï¼Œå”¯ä¸€é€’å¢ ID å·ç ç”Ÿæˆå™¨ï¼ˆç¬¬ 34 è®²ä¸­æˆ‘ä»¬è®²çš„æ˜¯å”¯ä¸€ ID ç”Ÿæˆå™¨ï¼Œè¿™é‡Œè®²çš„æ˜¯å”¯ä¸€é€’å¢ ID ç”Ÿæˆå™¨ï¼‰ï¼Œå¦‚æœç¨‹åºä¸­æœ‰ä¸¤ä¸ªå¯¹è±¡ï¼Œé‚£å°±ä¼šå­˜åœ¨ç”Ÿæˆé‡å¤ ID çš„æƒ…å†µï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åº”è¯¥å°† ID ç”Ÿæˆå™¨ç±»è®¾è®¡ä¸ºå•ä¾‹ã€‚12345678910111213141516171819import java.util.concurrent.atomic.AtomicLong;public class IdGenerator &#123; // AtomicLongæ˜¯ä¸€ä¸ªJavaå¹¶å‘åº“ä¸­æä¾›çš„ä¸€ä¸ªåŸå­å˜é‡ç±»å‹, // å®ƒå°†ä¸€äº›çº¿ç¨‹ä¸å®‰å…¨éœ€è¦åŠ é”çš„å¤åˆæ“ä½œå°è£…ä¸ºäº†çº¿ç¨‹å®‰å…¨çš„åŸå­æ“ä½œï¼Œ // æ¯”å¦‚ä¸‹é¢ä¼šç”¨åˆ°çš„incrementAndGet(). private AtomicLong id = new AtomicLong(0); private static final IdGenerator instance = new IdGenerator(); private IdGenerator() &#123;&#125; public static IdGenerator getInstance() &#123; return instance; &#125; public long getId() &#123; return id.incrementAndGet(); &#125;&#125;// IdGeneratorä½¿ç”¨ä¸¾ä¾‹long id = IdGenerator.getInstance().getId();å®é™…ä¸Šï¼Œä»Šå¤©è®²åˆ°çš„ä¸¤ä¸ªä»£ç å®ä¾‹ï¼ˆLoggerã€IdGeneratorï¼‰ï¼Œè®¾è®¡çš„éƒ½å¹¶ä¸ä¼˜é›…ï¼Œè¿˜å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚å¦‚ä½•å®ç°ä¸€ä¸ªå•ä¾‹ï¼Ÿå°½ç®¡ä»‹ç»å¦‚ä½•å®ç°ä¸€ä¸ªå•ä¾‹æ¨¡å¼çš„æ–‡ç« å·²ç»æœ‰å¾ˆå¤šäº†ï¼Œä½†ä¸ºäº†ä¿è¯å†…å®¹çš„å®Œæ•´æ€§ï¼Œæˆ‘è¿™é‡Œè¿˜æ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹å‡ ç§ç»å…¸å®ç°æ–¹å¼ã€‚æ¦‚æ‹¬èµ·æ¥ï¼Œè¦å®ç°ä¸€ä¸ªå•ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„ç‚¹æ— å¤–ä¹ä¸‹é¢å‡ ä¸ªï¼šæ„é€ å‡½æ•°éœ€è¦æ˜¯ private è®¿é—®æƒé™çš„ï¼Œè¿™æ ·æ‰èƒ½é¿å…å¤–éƒ¨é€šè¿‡ new åˆ›å»ºå®ä¾‹ï¼›è€ƒè™‘å¯¹è±¡åˆ›å»ºæ—¶çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›è€ƒè™‘æ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼›è€ƒè™‘ getInstance() æ€§èƒ½æ˜¯å¦é«˜ï¼ˆæ˜¯å¦åŠ é”ï¼‰ã€‚å¦‚æœä½ å¯¹è¿™å—å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œä½ å¯ä»¥å½“ä½œå¤ä¹ ã€‚æ³¨æ„ï¼Œä¸‹é¢çš„å‡ ç§å•ä¾‹å®ç°æ–¹å¼æ˜¯é’ˆå¯¹ Java è¯­è¨€è¯­æ³•çš„ï¼Œå¦‚æœä½ ç†Ÿæ‚‰çš„æ˜¯å…¶ä»–è¯­è¨€ï¼Œä¸å¦¨å¯¹æ¯” Java çš„è¿™å‡ ç§å®ç°æ–¹å¼ï¼Œè‡ªå·±è¯•ç€æ€»ç»“ä¸€ä¸‹ï¼Œåˆ©ç”¨ä½ ç†Ÿæ‚‰çš„è¯­è¨€ï¼Œè¯¥å¦‚ä½•å®ç°ã€‚1. é¥¿æ±‰å¼é¥¿æ±‰å¼çš„å®ç°æ–¹å¼æ¯”è¾ƒç®€å•ã€‚åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œinstance é™æ€å®ä¾‹å°±å·²ç»åˆ›å»ºå¹¶åˆå§‹åŒ–å¥½äº†ï¼Œæ‰€ä»¥ï¼Œinstance å®ä¾‹çš„åˆ›å»ºè¿‡ç¨‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¸è¿‡ï¼Œè¿™æ ·çš„å®ç°æ–¹å¼ä¸æ”¯æŒå»¶è¿ŸåŠ è½½ï¼ˆåœ¨çœŸæ­£ç”¨åˆ° IdGenerator çš„æ—¶å€™ï¼Œå†åˆ›å»ºå®ä¾‹ï¼‰ï¼Œä»åå­—ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºè¿™ä¸€ç‚¹ã€‚å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š123456789101112public class IdGenerator &#123; private AtomicLong id = new AtomicLong(0); private static final IdGenerator instance = new IdGenerator(); private IdGenerator() &#123;&#125; public static IdGenerator getInstance() &#123; return instance; &#125; public long getId() &#123; return id.incrementAndGet(); &#125;&#125;æœ‰äººè§‰å¾—è¿™ç§å®ç°æ–¹å¼ä¸å¥½ï¼Œå› ä¸ºä¸æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œå¦‚æœå®ä¾‹å ç”¨èµ„æºå¤šï¼ˆæ¯”å¦‚å ç”¨å†…å­˜å¤šï¼‰æˆ–åˆå§‹åŒ–è€—æ—¶é•¿ï¼ˆæ¯”å¦‚éœ€è¦åŠ è½½å„ç§é…ç½®æ–‡ä»¶ï¼‰ï¼Œæå‰åˆå§‹åŒ–å®ä¾‹æ˜¯ä¸€ç§æµªè´¹èµ„æºçš„è¡Œä¸ºã€‚æœ€å¥½çš„æ–¹æ³•åº”è¯¥åœ¨ç”¨åˆ°çš„æ—¶å€™å†å»åˆå§‹åŒ–ã€‚ä¸è¿‡ï¼Œæˆ‘ä¸ªäººå¹¶ä¸è®¤åŒè¿™æ ·çš„è§‚ç‚¹ã€‚å¦‚æœåˆå§‹åŒ–è€—æ—¶é•¿ï¼Œé‚£æˆ‘ä»¬æœ€å¥½ä¸è¦ç­‰åˆ°çœŸæ­£è¦ç”¨å®ƒçš„æ—¶å€™ï¼Œæ‰å»æ‰§è¡Œè¿™ä¸ªè€—æ—¶é•¿çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè¿™ä¼šå½±å“åˆ°ç³»ç»Ÿçš„æ€§èƒ½ï¼ˆæ¯”å¦‚ï¼Œåœ¨å“åº”å®¢æˆ·ç«¯æ¥å£è¯·æ±‚çš„æ—¶å€™ï¼Œåšè¿™ä¸ªåˆå§‹åŒ–æ“ä½œï¼Œä¼šå¯¼è‡´æ­¤è¯·æ±‚çš„å“åº”æ—¶é—´å˜é•¿ï¼Œç”šè‡³è¶…æ—¶ï¼‰ã€‚é‡‡ç”¨é¥¿æ±‰å¼å®ç°æ–¹å¼ï¼Œå°†è€—æ—¶çš„åˆå§‹åŒ–æ“ä½œï¼Œæå‰åˆ°ç¨‹åºå¯åŠ¨çš„æ—¶å€™å®Œæˆï¼Œè¿™æ ·å°±èƒ½é¿å…åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œå†å»åˆå§‹åŒ–å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚å¦‚æœå®ä¾‹å ç”¨èµ„æºå¤šï¼ŒæŒ‰ç…§ fail-fast çš„è®¾è®¡åŸåˆ™ï¼ˆæœ‰é—®é¢˜åŠæ—©æš´éœ²ï¼‰ï¼Œé‚£æˆ‘ä»¬ä¹Ÿå¸Œæœ›åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±å°†è¿™ä¸ªå®ä¾‹åˆå§‹åŒ–å¥½ã€‚å¦‚æœèµ„æºä¸å¤Ÿï¼Œå°±ä¼šåœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™è§¦å‘æŠ¥é”™ï¼ˆæ¯”å¦‚ Java ä¸­çš„ PermGen Space OOMï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç«‹å³å»ä¿®å¤ã€‚è¿™æ ·ä¹Ÿèƒ½é¿å…åœ¨ç¨‹åºè¿è¡Œä¸€æ®µæ—¶é—´åï¼Œçªç„¶å› ä¸ºåˆå§‹åŒ–è¿™ä¸ªå®ä¾‹å ç”¨èµ„æºè¿‡å¤šï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œå½±å“ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚2. æ‡’æ±‰å¼æœ‰é¥¿æ±‰å¼ï¼Œå¯¹åº”çš„ï¼Œå°±æœ‰æ‡’æ±‰å¼ã€‚æ‡’æ±‰å¼ç›¸å¯¹äºé¥¿æ±‰å¼çš„ä¼˜åŠ¿æ˜¯æ”¯æŒå»¶è¿ŸåŠ è½½ã€‚å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š123456789101112131415public class IdGenerator &#123; private AtomicLong id = new AtomicLong(0); private static IdGenerator instance; private IdGenerator() &#123;&#125; public static synchronized IdGenerator getInstance() &#123; if (instance == null) &#123; instance = new IdGenerator(); &#125; return instance; &#125; public long getId() &#123; return id.incrementAndGet(); &#125;&#125;ä¸è¿‡æ‡’æ±‰å¼çš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬ç»™ getInstance() è¿™ä¸ªæ–¹æ³•åŠ äº†ä¸€æŠŠå¤§é”ï¼ˆsynchronzedï¼‰ï¼Œå¯¼è‡´è¿™ä¸ªå‡½æ•°çš„å¹¶å‘åº¦å¾ˆä½ã€‚é‡åŒ–ä¸€ä¸‹çš„è¯ï¼Œå¹¶å‘åº¦æ˜¯ 1ï¼Œä¹Ÿå°±ç›¸å½“äºä¸²è¡Œæ“ä½œäº†ã€‚è€Œè¿™ä¸ªå‡½æ•°æ˜¯åœ¨å•ä¾‹ä½¿ç”¨æœŸé—´ï¼Œä¸€ç›´ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœè¿™ä¸ªå•ä¾‹ç±»å¶å°”ä¼šè¢«ç”¨åˆ°ï¼Œé‚£è¿™ç§å®ç°æ–¹å¼è¿˜å¯ä»¥æ¥å—ã€‚ä½†æ˜¯ï¼Œå¦‚æœé¢‘ç¹åœ°ç”¨åˆ°ï¼Œé‚£é¢‘ç¹åŠ é”ã€é‡Šæ”¾é”åŠå¹¶å‘åº¦ä½ç­‰é—®é¢˜ï¼Œä¼šå¯¼è‡´æ€§èƒ½ç“¶é¢ˆï¼Œè¿™ç§å®ç°æ–¹å¼å°±ä¸å¯å–äº†ã€‚3. åŒé‡æ£€æµ‹é¥¿æ±‰å¼ä¸æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œæ‡’æ±‰å¼æœ‰æ€§èƒ½é—®é¢˜ï¼Œä¸æ”¯æŒé«˜å¹¶å‘ã€‚é‚£æˆ‘ä»¬å†æ¥çœ‹ä¸€ç§æ—¢æ”¯æŒå»¶è¿ŸåŠ è½½ã€åˆæ”¯æŒé«˜å¹¶å‘çš„å•ä¾‹å®ç°æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯åŒé‡æ£€æµ‹å®ç°æ–¹å¼ã€‚åœ¨è¿™ç§å®ç°æ–¹å¼ä¸­ï¼Œåªè¦ instance è¢«åˆ›å»ºä¹‹åï¼Œå³ä¾¿å†è°ƒç”¨ getInstance() å‡½æ•°ä¹Ÿä¸ä¼šå†è¿›å…¥åˆ°åŠ é”é€»è¾‘ä¸­äº†ã€‚æ‰€ä»¥ï¼Œè¿™ç§å®ç°æ–¹å¼è§£å†³äº†æ‡’æ±‰å¼å¹¶å‘åº¦ä½çš„é—®é¢˜ã€‚å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š12345678910111213141516171819public class IdGenerator &#123; private AtomicLong id = new AtomicLong(0); private static IdGenerator instance; private IdGenerator() &#123;&#125; public static IdGenerator getInstance() &#123; if (instance == null) &#123; synchronized(IdGenerator.class) &#123; // æ­¤å¤„ä¸ºç±»çº§åˆ«çš„é” if (instance == null) &#123; instance = new IdGenerator(); &#125; &#125; &#125; return instance; &#125; public long getId() &#123; return id.incrementAndGet(); &#125;&#125;ç½‘ä¸Šæœ‰äººè¯´ï¼Œè¿™ç§å®ç°æ–¹å¼æœ‰äº›é—®é¢˜ã€‚å› ä¸ºæŒ‡ä»¤é‡æ’åºï¼Œå¯èƒ½ä¼šå¯¼è‡´ IdGenerator å¯¹è±¡è¢« new å‡ºæ¥ï¼Œå¹¶ä¸”èµ‹å€¼ç»™ instance ä¹‹åï¼Œè¿˜æ²¡æ¥å¾—åŠåˆå§‹åŒ–ï¼ˆæ‰§è¡Œæ„é€ å‡½æ•°ä¸­çš„ä»£ç é€»è¾‘ï¼‰ï¼Œå°±è¢«å¦ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨äº†ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç»™ instance æˆå‘˜å˜é‡åŠ ä¸Š volatile å…³é”®å­—ï¼Œç¦æ­¢æŒ‡ä»¤é‡æ’åºæ‰è¡Œã€‚å®é™…ä¸Šï¼Œåªæœ‰å¾ˆä½ç‰ˆæœ¬çš„ Java æ‰ä¼šæœ‰è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬ç°åœ¨ç”¨çš„é«˜ç‰ˆæœ¬çš„ Java å·²ç»åœ¨ JDK å†…éƒ¨å®ç°ä¸­è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼ˆè§£å†³çš„æ–¹æ³•å¾ˆç®€å•ï¼Œåªè¦æŠŠå¯¹è±¡ new æ“ä½œå’Œåˆå§‹åŒ–æ“ä½œè®¾è®¡ä¸ºåŸå­æ“ä½œï¼Œå°±è‡ªç„¶èƒ½ç¦æ­¢é‡æ’åºï¼‰ã€‚å…³äºè¿™ç‚¹çš„è¯¦ç»†è§£é‡Šï¼Œè·Ÿç‰¹å®šè¯­è¨€æœ‰å…³ï¼Œæˆ‘å°±ä¸å±•å¼€è®²äº†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œç ”ç©¶ä¸€ä¸‹ã€‚4. é™æ€å†…éƒ¨ç±»æˆ‘ä»¬å†æ¥çœ‹ä¸€ç§æ¯”åŒé‡æ£€æµ‹æ›´åŠ ç®€å•çš„å®ç°æ–¹æ³•ï¼Œé‚£å°±æ˜¯åˆ©ç”¨ Java çš„é™æ€å†…éƒ¨ç±»ã€‚å®ƒæœ‰ç‚¹ç±»ä¼¼é¥¿æ±‰å¼ï¼Œä½†åˆèƒ½åšåˆ°äº†å»¶è¿ŸåŠ è½½ã€‚å…·ä½“æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹å®ƒçš„ä»£ç å®ç°ã€‚1234567891011121314151617public class IdGenerator &#123; private AtomicLong id = new AtomicLong(0); private IdGenerator() &#123;&#125; private static class SingletonHolder&#123; private static final IdGenerator instance = new IdGenerator(); &#125; public static IdGenerator getInstance() &#123; return SingletonHolder.instance; &#125; public long getId() &#123; return id.incrementAndGet(); &#125;&#125;SingletonHolder æ˜¯ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œå½“å¤–éƒ¨ç±» IdGenerator è¢«åŠ è½½çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šåˆ›å»º SingletonHolder å®ä¾‹å¯¹è±¡ã€‚åªæœ‰å½“è°ƒç”¨ getInstance() æ–¹æ³•æ—¶ï¼ŒSingletonHolder æ‰ä¼šè¢«åŠ è½½ï¼Œè¿™ä¸ªæ—¶å€™æ‰ä¼šåˆ›å»º instanceã€‚instance çš„å”¯ä¸€æ€§ã€åˆ›å»ºè¿‡ç¨‹çš„çº¿ç¨‹å®‰å…¨æ€§ï¼Œéƒ½ç”± JVM æ¥ä¿è¯ã€‚æ‰€ä»¥ï¼Œè¿™ç§å®ç°æ–¹æ³•æ—¢ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œåˆèƒ½åšåˆ°å»¶è¿ŸåŠ è½½ã€‚5. æšä¸¾æœ€åï¼Œæˆ‘ä»¬ä»‹ç»ä¸€ç§æœ€ç®€å•çš„å®ç°æ–¹å¼ï¼ŒåŸºäºæšä¸¾ç±»å‹çš„å•ä¾‹å®ç°ã€‚è¿™ç§å®ç°æ–¹å¼é€šè¿‡ Java æšä¸¾ç±»å‹æœ¬èº«çš„ç‰¹æ€§ï¼Œä¿è¯äº†å®ä¾‹åˆ›å»ºçš„çº¿ç¨‹å®‰å…¨æ€§å’Œå®ä¾‹çš„å”¯ä¸€æ€§ã€‚å…·ä½“çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š123456789public enum IdGenerator &#123; INSTANCE; private AtomicLong id = new AtomicLong(0); public long getId() &#123; return id.incrementAndGet(); &#125;&#125;æ€»ç»“å¥½äº†ï¼Œä»Šå¤©çš„å†…å®¹åˆ°æ­¤å°±è®²å®Œäº†ã€‚æˆ‘ä»¬æ¥æ€»ç»“å›é¡¾ä¸€ä¸‹ï¼Œä½ éœ€è¦æŒæ¡çš„é‡ç‚¹å†…å®¹ã€‚1. å•ä¾‹çš„å®šä¹‰å•ä¾‹è®¾è®¡æ¨¡å¼ï¼ˆSingleton Design Patternï¼‰ç†è§£èµ·æ¥éå¸¸ç®€å•ã€‚ä¸€ä¸ªç±»åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ˆæˆ–è€…å«å®ä¾‹ï¼‰ï¼Œé‚£è¿™ä¸ªç±»å°±æ˜¯ä¸€ä¸ªå•ä¾‹ç±»ï¼Œè¿™ç§è®¾è®¡æ¨¡å¼å°±å«ä½œå•ä¾‹è®¾è®¡æ¨¡å¼ï¼Œç®€ç§°å•ä¾‹æ¨¡å¼ã€‚2. å•ä¾‹çš„ç”¨å¤„ä»ä¸šåŠ¡æ¦‚å¿µä¸Šï¼Œæœ‰äº›æ•°æ®åœ¨ç³»ç»Ÿä¸­åªåº”è¯¥ä¿å­˜ä¸€ä»½ï¼Œå°±æ¯”è¾ƒé€‚åˆè®¾è®¡ä¸ºå•ä¾‹ç±»ã€‚æ¯”å¦‚ï¼Œç³»ç»Ÿçš„é…ç½®ä¿¡æ¯ç±»ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å•ä¾‹è§£å†³èµ„æºè®¿é—®å†²çªçš„é—®é¢˜ã€‚3. å•ä¾‹çš„å®ç°å•ä¾‹æœ‰ä¸‹é¢å‡ ç§ç»å…¸çš„å®ç°æ–¹å¼ã€‚é¥¿æ±‰å¼é¥¿æ±‰å¼çš„å®ç°æ–¹å¼ï¼Œåœ¨ç±»åŠ è½½çš„æœŸé—´ï¼Œå°±å·²ç»å°† instance é™æ€å®ä¾‹åˆå§‹åŒ–å¥½äº†ï¼Œæ‰€ä»¥ï¼Œinstance å®ä¾‹çš„åˆ›å»ºæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¸è¿‡ï¼Œè¿™æ ·çš„å®ç°æ–¹å¼ä¸æ”¯æŒå»¶è¿ŸåŠ è½½å®ä¾‹ã€‚æ‡’æ±‰å¼æ‡’æ±‰å¼ç›¸å¯¹äºé¥¿æ±‰å¼çš„ä¼˜åŠ¿æ˜¯æ”¯æŒå»¶è¿ŸåŠ è½½ã€‚è¿™ç§å®ç°æ–¹å¼ä¼šå¯¼è‡´é¢‘ç¹åŠ é”ã€é‡Šæ”¾é”ï¼Œä»¥åŠå¹¶å‘åº¦ä½ç­‰é—®é¢˜ï¼Œé¢‘ç¹çš„è°ƒç”¨ä¼šäº§ç”Ÿæ€§èƒ½ç“¶é¢ˆã€‚åŒé‡æ£€æµ‹åŒé‡æ£€æµ‹å®ç°æ–¹å¼æ—¢æ”¯æŒå»¶è¿ŸåŠ è½½ã€åˆæ”¯æŒé«˜å¹¶å‘çš„å•ä¾‹å®ç°æ–¹å¼ã€‚åªè¦ instance è¢«åˆ›å»ºä¹‹åï¼Œå†è°ƒç”¨ getInstance() å‡½æ•°éƒ½ä¸ä¼šè¿›å…¥åˆ°åŠ é”é€»è¾‘ä¸­ã€‚æ‰€ä»¥ï¼Œè¿™ç§å®ç°æ–¹å¼è§£å†³äº†æ‡’æ±‰å¼å¹¶å‘åº¦ä½çš„é—®é¢˜ã€‚é™æ€å†…éƒ¨ç±»åˆ©ç”¨ Java çš„é™æ€å†…éƒ¨ç±»æ¥å®ç°å•ä¾‹ã€‚è¿™ç§å®ç°æ–¹å¼ï¼Œæ—¢æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œä¹Ÿæ”¯æŒé«˜å¹¶å‘ï¼Œå®ç°èµ·æ¥ä¹Ÿæ¯”åŒé‡æ£€æµ‹ç®€å•ã€‚æšä¸¾æœ€ç®€å•çš„å®ç°æ–¹å¼ï¼ŒåŸºäºæšä¸¾ç±»å‹çš„å•ä¾‹å®ç°ã€‚è¿™ç§å®ç°æ–¹å¼é€šè¿‡ Java æšä¸¾ç±»å‹æœ¬èº«çš„ç‰¹æ€§ï¼Œä¿è¯äº†å®ä¾‹åˆ›å»ºçš„çº¿ç¨‹å®‰å…¨æ€§å’Œå®ä¾‹çš„å”¯ä¸€æ€§ã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"cpeixin.cn/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"å•ä¾‹æ¨¡å¼","slug":"å•ä¾‹æ¨¡å¼","permalink":"cpeixin.cn/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"}]},{"title":"kaliä¸­æ–‡è®¾ç½®","slug":"kaliä¸­æ–‡è®¾ç½®","date":"2019-12-01T02:26:15.000Z","updated":"2020-04-04T11:06:21.313Z","comments":true,"path":"2019/12/01/kaliä¸­æ–‡è®¾ç½®/","link":"","permalink":"cpeixin.cn/2019/12/01/kali%E4%B8%AD%E6%96%87%E8%AE%BE%E7%BD%AE/","excerpt":"","text":"æ›´æ–°æºhttps://blog.csdn.net/qq_38333291/article/details/89764967è®¾ç½®ç¼–ç å’Œä¸­æ–‡å­—ä½“å®‰è£…http://www.linuxdiyf.com/linux/20701.html","categories":[{"name":"Linux","slug":"Linux","permalink":"cpeixin.cn/categories/Linux/"}],"tags":[{"name":"kali","slug":"kali","permalink":"cpeixin.cn/tags/kali/"}]},{"title":"åˆ†å¸ƒå¼ä¸‹çš„æ•°æ®hashåˆ†å¸ƒ","slug":"åˆ†å¸ƒå¼ä¸‹çš„æ•°æ®hashåˆ†å¸ƒ","date":"2019-11-19T15:05:08.000Z","updated":"2020-04-04T11:24:04.737Z","comments":true,"path":"2019/11/19/åˆ†å¸ƒå¼ä¸‹çš„æ•°æ®hashåˆ†å¸ƒ/","link":"","permalink":"cpeixin.cn/2019/11/19/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8B%E7%9A%84%E6%95%B0%E6%8D%AEhash%E5%88%86%E5%B8%83/","excerpt":"","text":"","categories":[],"tags":[]},{"title":"ã€è½¬è½½ã€‘å­—èŠ‚è·³åŠ¨åœ¨Spark SQLä¸Šçš„æ ¸å¿ƒä¼˜åŒ–å®è·µ","slug":"ã€è½¬è½½ã€‘å­—èŠ‚è·³åŠ¨åœ¨Spark-SQLä¸Šçš„æ ¸å¿ƒä¼˜åŒ–å®è·µ","date":"2019-11-12T10:57:27.000Z","updated":"2020-05-16T10:59:03.835Z","comments":true,"path":"2019/11/12/ã€è½¬è½½ã€‘å­—èŠ‚è·³åŠ¨åœ¨Spark-SQLä¸Šçš„æ ¸å¿ƒä¼˜åŒ–å®è·µ/","link":"","permalink":"cpeixin.cn/2019/11/12/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E5%9C%A8Spark-SQL%E4%B8%8A%E7%9A%84%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5/","excerpt":"","text":"æœ¬æ–‡è½¬è½½è‡ªå­—èŠ‚è·³åŠ¨æŠ€æœ¯å›¢é˜Ÿåœ¨æ˜é‡‘ç½‘ä¸Šå‘è¡¨çš„æ–‡ç« ï¼Œä¸»è¦æ˜¯Spark SQLåœ¨å­—èŠ‚æ•°æ®ä»“åº“åº”ç”¨æ–¹é¢çš„ä¼˜åŒ–å®è·µåŸæ–‡é“¾æ¥ï¼šhttps://juejin.im/post/5dc3ed336fb9a04a7847f25cSpark SQL æ¶æ„ç®€ä»‹æˆ‘ä»¬å…ˆç®€å•èŠä¸€ä¸‹Spark SQL çš„æ¶æ„ã€‚ä¸‹é¢è¿™å¼ å›¾æè¿°äº†ä¸€æ¡ SQL æäº¤ä¹‹åéœ€è¦ç»å†çš„å‡ ä¸ªé˜¶æ®µï¼Œç»“åˆè¿™äº›é˜¶æ®µå°±å¯ä»¥çœ‹åˆ°åœ¨å“ªäº›ç¯èŠ‚å¯ä»¥åšä¼˜åŒ–ã€‚å¾ˆå¤šæ—¶å€™ï¼Œåšæ•°æ®ä»“åº“å»ºæ¨¡çš„åŒå­¦æ›´å€¾å‘äºç›´æ¥å†™ SQL è€Œéä½¿ç”¨ Spark çš„ DSLã€‚ä¸€æ¡ SQL æäº¤ä¹‹åä¼šè¢« Parser è§£æå¹¶è½¬åŒ–ä¸º Unresolved Logical Planã€‚å®ƒçš„é‡ç‚¹æ˜¯ Logical Plan ä¹Ÿå³é€»è¾‘è®¡åˆ’ï¼Œå®ƒæè¿°äº†å¸Œæœ›åšä»€ä¹ˆæ ·çš„æŸ¥è¯¢ã€‚Unresolved æ˜¯æŒ‡è¯¥æŸ¥è¯¢ç›¸å…³çš„ä¸€äº›ä¿¡æ¯æœªçŸ¥ï¼Œæ¯”å¦‚ä¸çŸ¥é“æŸ¥è¯¢çš„ç›®æ ‡è¡¨çš„ Schema ä»¥åŠæ•°æ®ä½ç½®ã€‚ä¸Šè¿°ä¿¡æ¯å­˜äº Catalog å†…ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸€èˆ¬ç”± Hive Metastore æä¾› Catalog æœåŠ¡ã€‚Analyzer ä¼šç»“åˆ Catalog å°† Unresolved Logical Plan è½¬æ¢ä¸º Resolved Logical Planã€‚åˆ°è¿™é‡Œè¿˜ä¸å¤Ÿã€‚ä¸åŒçš„äººå†™å‡ºæ¥çš„ SQL ä¸ä¸€æ ·ï¼Œç”Ÿæˆçš„ Resolved Logical Plan ä¹Ÿå°±ä¸ä¸€æ ·ï¼Œæ‰§è¡Œæ•ˆç‡ä¹Ÿä¸ä¸€æ ·ã€‚ä¸ºäº†ä¿è¯æ— è®ºç”¨æˆ·å¦‚ä½•å†™ SQL éƒ½å¯ä»¥é«˜æ•ˆçš„æ‰§è¡Œï¼ŒSpark SQL éœ€è¦å¯¹ Resolved Logical Plan è¿›è¡Œä¼˜åŒ–ï¼Œè¿™ä¸ªä¼˜åŒ–ç”± Optimizer å®Œæˆã€‚Optimizer åŒ…å«äº†ä¸€ç³»åˆ—è§„åˆ™ï¼Œå¯¹ Resolved Logical Plan è¿›è¡Œç­‰ä»·è½¬æ¢ï¼Œæœ€ç»ˆç”Ÿæˆ Optimized Logical Planã€‚è¯¥ Optimized Logical Plan ä¸èƒ½ä¿è¯æ˜¯å…¨å±€æœ€ä¼˜çš„ï¼Œä½†è‡³å°‘æ˜¯æ¥è¿‘æœ€ä¼˜çš„ã€‚ä¸Šè¿°è¿‡ç¨‹åªä¸ SQL æœ‰å…³ï¼Œä¸æŸ¥è¯¢æœ‰å…³ï¼Œä½†æ˜¯ä¸ Spark æ— å…³ï¼Œå› æ­¤æ— æ³•ç›´æ¥æäº¤ç»™ Spark æ‰§è¡Œã€‚Query Planner è´Ÿè´£å°† Optimized Logical Plan è½¬æ¢ä¸º Physical Planï¼Œè¿›è€Œå¯ä»¥ç›´æ¥ç”± Spark æ‰§è¡Œã€‚ç”±äºåŒä¸€ç§é€»è¾‘ç®—å­å¯ä»¥æœ‰å¤šç§ç‰©ç†å®ç°ã€‚å¦‚ Join æœ‰å¤šç§å®ç°ï¼ŒShuffledHashJoinã€BroadcastHashJoinã€BroadcastNestedLoopJoinã€SortMergeJoin ç­‰ã€‚å› æ­¤ Optimized Logical Plan å¯è¢« Query Planner è½¬æ¢ä¸ºå¤šä¸ª Physical Planã€‚å¦‚ä½•é€‰æ‹©æœ€ä¼˜çš„ Physical Plan æˆä¸ºä¸€ä»¶éå¸¸å½±å“æœ€ç»ˆæ‰§è¡Œæ€§èƒ½çš„äº‹æƒ…ã€‚ä¸€ç§æ¯”è¾ƒå¥½çš„æ–¹å¼æ˜¯ï¼Œæ„å»ºä¸€ä¸ª Cost Modelï¼Œå¹¶å¯¹æ‰€æœ‰å€™é€‰çš„ Physical Plan åº”ç”¨è¯¥ Model å¹¶æŒ‘é€‰ Cost æœ€å°çš„ Physical Plan ä½œä¸ºæœ€ç»ˆçš„ Selected Physical Planã€‚Physical Plan å¯ç›´æ¥è½¬æ¢æˆ RDD ç”± Spark æ‰§è¡Œã€‚æˆ‘ä»¬ç»å¸¸è¯´â€œè®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ–â€ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å‘ç°åŸè®¡åˆ’ä¸æ˜¯æœ€ä¼˜çš„ï¼Œåç»­æ‰§è¡Œè®¡åˆ’å¦‚æœèƒ½æ ¹æ®è¿è¡Œæ—¶çš„ç»Ÿè®¡ä¿¡æ¯è¿›è¡Œè°ƒæ•´å¯èƒ½æå‡æ•´ä½“æ‰§è¡Œæ•ˆç‡ã€‚è¿™éƒ¨åˆ†åŠ¨æ€è°ƒæ•´ç”± Adaptive Execution å®Œæˆã€‚åé¢ä»‹ç»å­—èŠ‚è·³åŠ¨åœ¨ Spark SQL ä¸Šåšçš„ä¸€äº›ä¼˜åŒ–ï¼Œä¸»è¦å›´ç»•è¿™ä¸€èŠ‚ä»‹ç»çš„é€»è¾‘è®¡åˆ’ä¼˜åŒ–ä¸ç‰©ç†è®¡åˆ’ä¼˜åŒ–å±•å¼€ã€‚Spark SQLå¼•æ“ä¼˜åŒ–Bucket Joinæ”¹è¿›åœ¨ Spark é‡Œï¼Œå®é™…å¹¶æ²¡æœ‰ Bucket Join ç®—å­ã€‚è¿™é‡Œè¯´çš„ Bucket Join æ³›æŒ‡ä¸éœ€è¦ Shuffle çš„ Sort Merge Joinã€‚ä¸‹å›¾å±•ç¤ºäº† Sort Merge Join çš„åŸºæœ¬åŸç†ã€‚ç”¨è™šçº¿æ¡†ä»£è¡¨çš„ Table 1 å’Œ Table 2 æ˜¯ä¸¤å¼ éœ€è¦æŒ‰æŸå­—æ®µè¿›è¡Œ Join çš„è¡¨ã€‚è™šçº¿æ¡†å†…çš„ partition 0 åˆ° partition m æ˜¯è¯¥è¡¨è½¬æ¢æˆ RDD åçš„ Partitionï¼Œè€Œéè¡¨çš„åˆ†åŒºã€‚å‡è®¾ Table 1 ä¸ Table 2 è½¬æ¢ä¸º RDD ååˆ†åˆ«åŒ…å« m å’Œ k ä¸ª Partitionã€‚ä¸ºäº†è¿›è¡Œ Joinï¼Œéœ€è¦é€šè¿‡ Shuffle ä¿è¯ç›¸åŒ Join Key çš„æ•°æ®åœ¨åŒä¸€ä¸ª Partition å†…ä¸” Partition å†…æŒ‰ Key æ’åºï¼ŒåŒæ—¶ä¿è¯ Table 1 ä¸ Table 2 ç»è¿‡ Shuffle åçš„ RDD çš„ Partition æ•°ç›¸åŒã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç»è¿‡ Shuffle ååªéœ€è¦å¯åŠ¨ n ä¸ª Taskï¼Œæ¯ä¸ª Task å¤„ç† Table 1 ä¸ Table 2 ä¸­å¯¹åº” Partition çš„æ•°æ®è¿›è¡Œ Join å³å¯ã€‚å¦‚ Task 0 åªéœ€è¦é¡ºåºæ‰«æ Shuffle åçš„å·¦å³ä¸¤è¾¹çš„ partition 0 å³å¯å®Œæˆ Joinã€‚è¯¥æ–¹æ³•çš„ä¼˜åŠ¿æ˜¯é€‚ç”¨åœºæ™¯å¹¿ï¼Œå‡ ä¹å¯ç”¨äºä»»æ„å¤§å°çš„æ•°æ®é›†ã€‚åŠ£åŠ¿æ˜¯æ¯æ¬¡ Join éƒ½éœ€è¦å¯¹å…¨é‡æ•°æ®è¿›è¡Œ Shuffleï¼Œè€Œ Shuffle æ˜¯æœ€å½±å“ Spark SQL æ€§èƒ½çš„ç¯èŠ‚ã€‚å¦‚æœèƒ½é¿å… Shuffle å¾€å¾€èƒ½å¤§å¹…æå‡ Spark SQL æ€§èƒ½ã€‚å¯¹äºå¤§æ•°æ®çš„åœºæ™¯æ¥è®²ï¼Œæ•°æ®ä¸€èˆ¬æ˜¯ä¸€æ¬¡å†™å…¥å¤šæ¬¡æŸ¥è¯¢ã€‚å¦‚æœç»å¸¸å¯¹ä¸¤å¼ è¡¨æŒ‰ç›¸åŒæˆ–ç±»ä¼¼çš„æ–¹å¼è¿›è¡Œ Joinï¼Œæ¯æ¬¡éƒ½éœ€è¦ä»˜å‡º Shuffle çš„ä»£ä»·ã€‚ä¸å…¶è¿™æ ·ï¼Œä¸å¦‚è®©æ•°æ®åœ¨å†™çš„æ—¶å€™ï¼Œå°±è®©æ•°æ®æŒ‰ç…§åˆ©äº Join çš„æ–¹å¼åˆ†å¸ƒï¼Œä»è€Œä½¿å¾— Join æ—¶æ— éœ€è¿›è¡Œ Shuffleã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒTable 1 ä¸ Table 2 å†…çš„æ•°æ®æŒ‰ç…§ç›¸åŒçš„ Key è¿›è¡Œåˆ†æ¡¶ä¸”æ¡¶æ•°éƒ½ä¸º nï¼ŒåŒæ—¶æ¡¶å†…æŒ‰è¯¥ Key æ’åºã€‚å¯¹è¿™ä¸¤å¼ è¡¨è¿›è¡Œ Join æ—¶ï¼Œå¯ä»¥é¿å… Shuffleï¼Œç›´æ¥å¯åŠ¨ n ä¸ª Task è¿›è¡Œ Joinã€‚å­—èŠ‚è·³åŠ¨å¯¹ Spark SQL çš„ BucketJoin åšäº†å››é¡¹æ¯”è¾ƒå¤§çš„æ”¹è¿›ã€‚æ”¹è¿›ä¸€ï¼šæ”¯æŒä¸ Hive å…¼å®¹**åœ¨è¿‡å»ä¸€æ®µæ—¶é—´ï¼Œå­—èŠ‚è·³åŠ¨æŠŠå¤§é‡çš„ Hive ä½œä¸šè¿ç§»åˆ°äº† SparkSQLã€‚è€Œ Hive ä¸ Spark SQL çš„ Bucket è¡¨ä¸å…¼å®¹ã€‚å¯¹äºä½¿ç”¨ Bucket è¡¨çš„åœºæ™¯ï¼Œå¦‚æœç›´æ¥æ›´æ–°è®¡ç®—å¼•æ“ï¼Œä¼šé€ æˆ Spark SQL å†™å…¥ Hive Bucket è¡¨çš„æ•°æ®æ— æ³•è¢«ä¸‹æ¸¸çš„ Hive ä½œä¸šå½“æˆ Bucket è¡¨è¿›è¡Œ Bucket Joinï¼Œä»è€Œé€ æˆä½œä¸šæ‰§è¡Œæ—¶é—´å˜é•¿ï¼Œå¯èƒ½å½±å“ SLAã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è®© Spark SQL æ”¯æŒ Hive å…¼å®¹æ¨¡å¼ï¼Œä»è€Œä¿è¯ Spark SQL å†™å…¥çš„ Bucket è¡¨ä¸ Hive å†™å…¥çš„ Bucket è¡¨æ•ˆæœä¸€è‡´ï¼Œå¹¶ä¸”è¿™ç§è¡¨å¯ä»¥è¢« Hive å’Œ Spark SQL å½“æˆ Bucket è¡¨è¿›è¡Œ Bucket Join è€Œä¸éœ€è¦ Shuffleã€‚é€šè¿‡è¿™ç§æ–¹å¼ä¿è¯ Hive å‘ Spark SQL çš„é€æ˜è¿ç§»ã€‚ç¬¬ä¸€ä¸ªéœ€è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼ŒHive çš„ä¸€ä¸ª Bucket ä¸€èˆ¬åªåŒ…å«ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œ Spark SQL çš„ä¸€ä¸ª Bucket å¯èƒ½åŒ…å«å¤šä¸ªæ–‡ä»¶ã€‚è§£å†³åŠæ³•æ˜¯åŠ¨æ€å¢åŠ ä¸€æ¬¡ä»¥ Bucket Key ä¸º Key å¹¶ä¸”å¹¶è¡Œåº¦ä¸ Bucket ä¸ªæ•°ç›¸åŒçš„ Shuffleã€‚ç¬¬äºŒä¸ªéœ€è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼ŒHive 1.x çš„å“ˆå¸Œæ–¹å¼ä¸ Spark SQL 2.x çš„å“ˆå¸Œæ–¹å¼ï¼ˆMurmur3Hashï¼‰ä¸åŒï¼Œä½¿å¾—ç›¸åŒçš„æ•°æ®åœ¨ Hive ä¸­çš„ Bucket ID ä¸ Spark SQL ä¸­çš„ Bucket ID ä¸åŒè€Œæ— æ³•ç›´æ¥ Joinã€‚åœ¨ Hive å…¼å®¹æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬è®©ä¸Šè¿°åŠ¨æ€å¢åŠ çš„ Shuffle ä½¿ç”¨ Hive ç›¸åŒçš„å“ˆå¸Œæ–¹å¼ï¼Œä»è€Œè§£å†³è¯¥é—®é¢˜ã€‚æ”¹è¿›äºŒï¼šæ”¯æŒå€æ•°å…³ç³»Bucket Join**Spark SQL è¦æ±‚åªæœ‰ Bucket ç›¸åŒçš„è¡¨æ‰èƒ½ï¼ˆå¿…è¦éå……åˆ†æ¡ä»¶ï¼‰è¿›è¡Œ Bucket Joinã€‚å¯¹äºä¸¤å¼ å¤§å°ç›¸å·®å¾ˆå¤§çš„è¡¨ï¼Œæ¯”å¦‚å‡ ç™¾ GB çš„ç»´åº¦è¡¨ä¸å‡ å TB ï¼ˆå•åˆ†åŒºï¼‰çš„äº‹å®è¡¨ï¼Œå®ƒä»¬çš„ Bucket ä¸ªæ•°å¾€å¾€ä¸åŒï¼Œå¹¶ä¸”ä¸ªæ•°ç›¸å·®å¾ˆå¤šï¼Œé»˜è®¤æ— æ³•è¿›è¡Œ Bucket Joinã€‚å› æ­¤æˆ‘ä»¬é€šè¿‡ä¸¤ç§æ–¹å¼æ”¯æŒäº†å€æ•°å…³ç³»çš„ Bucket Joinï¼Œå³å½“ä¸¤å¼  Bucket è¡¨çš„ Bucket æ•°æ˜¯å€æ•°å…³ç³»æ—¶æ”¯æŒ Bucket Joinã€‚ç¬¬ä¸€ç§æ–¹å¼ï¼ŒTask ä¸ªæ•°ä¸å°è¡¨ Bucket ä¸ªæ•°ç›¸åŒã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒTable A åŒ…å« 3 ä¸ª Bucketï¼ŒTable B åŒ…å« 6 ä¸ª Bucketã€‚æ­¤æ—¶ Table B çš„ bucket 0 ä¸ bucket 3 çš„æ•°æ®åˆé›†åº”è¯¥ä¸ Table A çš„ bucket 0 è¿›è¡Œ Joinã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å¯åŠ¨ 3 ä¸ª Taskã€‚å…¶ä¸­ Task 0 å¯¹ Table A çš„ bucket 0 ä¸ Table B çš„ bucket 0 + bucket 3 è¿›è¡Œ Joinã€‚åœ¨è¿™é‡Œï¼Œéœ€è¦å¯¹ Table B çš„ bucket 0 ä¸ bucket 3 çš„æ•°æ®å†åšä¸€æ¬¡ merge sort ä»è€Œä¿è¯åˆé›†æœ‰åºã€‚å¦‚æœ Table A ä¸ Table B çš„ Bucket ä¸ªæ•°ç›¸å·®ä¸å¤§ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šè¿°æ–¹å¼ã€‚å¦‚æœ Table B çš„ Bucket ä¸ªæ•°æ˜¯ Bucket A Bucket ä¸ªæ•°çš„ 10 å€ï¼Œé‚£ä¸Šè¿°æ–¹å¼è™½ç„¶é¿å…äº† Shuffleï¼Œä½†å¯èƒ½å› ä¸ºå¹¶è¡Œåº¦ä¸å¤Ÿåè€Œæ¯”åŒ…å« Shuffle çš„ SortMergeJoin é€Ÿåº¦æ…¢ã€‚æ­¤æ—¶å¯ä»¥ä½¿ç”¨å¦å¤–ä¸€ç§æ–¹å¼ï¼Œå³ Task ä¸ªæ•°ä¸å¤§è¡¨ Bucket ä¸ªæ•°ç›¸ç­‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚åœ¨è¯¥æ–¹æ¡ˆä¸‹ï¼Œå¯å°† Table A çš„ 3 ä¸ª Bucket è¯»å¤šæ¬¡ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œç›´æ¥å°† Table A ä¸ Table A è¿›è¡Œ Bucket Union ï¼ˆæ–°çš„ç®—å­ï¼Œä¸ Union ç±»ä¼¼ï¼Œä½†ä¿ç•™äº† Bucket ç‰¹æ€§ï¼‰ï¼Œç»“æœç›¸å½“äº 6 ä¸ª Bucketï¼Œä¸ Table B çš„ Bucket ä¸ªæ•°ç›¸åŒï¼Œä»è€Œå¯ä»¥è¿›è¡Œ Bucket Joinã€‚æ”¹è¿›ä¸‰ï¼šæ”¯æŒBucketJoin é™çº§**å…¬å¸å†…éƒ¨è¿‡å»ä½¿ç”¨ Bucket çš„è¡¨è¾ƒå°‘ï¼Œåœ¨æˆ‘ä»¬å¯¹ Bucket åšäº†ä¸€ç³»åˆ—æ”¹è¿›åï¼Œå¤§é‡ç”¨æˆ·å¸Œæœ›å°†è¡¨è½¬æ¢ä¸º Bucket è¡¨ã€‚è½¬æ¢åï¼Œè¡¨çš„å…ƒä¿¡æ¯æ˜¾ç¤ºè¯¥è¡¨ä¸º Bucket è¡¨ï¼Œè€Œå†å²åˆ†åŒºå†…çš„æ•°æ®å¹¶æœªæŒ‰ Bucket è¡¨è¦æ±‚åˆ†å¸ƒï¼Œåœ¨æŸ¥è¯¢å†å²æ•°æ®æ—¶ä¼šå‡ºç°æ— æ³•è¯†åˆ« Bucket çš„é—®é¢˜ã€‚åŒæ—¶ï¼Œç”±äºæ•°æ®é‡ä¸Šæ¶¨å¿«ï¼Œå¹³å‡ Bucket å¤§å°ä¹Ÿå¿«é€Ÿå¢é•¿ã€‚è¿™ä¼šé€ æˆå• Task éœ€è¦å¤„ç†çš„æ•°æ®é‡è¿‡å¤§è¿›è€Œå¼•èµ·ä½¿ç”¨ Bucket åçš„æ•ˆæœå¯èƒ½ä¸å¦‚ç›´æ¥ä½¿ç”¨åŸºäº Shuffle çš„ Joinã€‚ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬å®ç°äº†æ”¯æŒé™çº§çš„ Bucket è¡¨ã€‚åŸºæœ¬åŸç†æ˜¯ï¼Œæ¯æ¬¡ä¿®æ”¹ Bucket ä¿¡æ¯ï¼ˆåŒ…å«ä¸Šè¿°ä¸¤ç§æƒ…å†µâ€”â€”å°†é Bucket è¡¨è½¬ä¸º Bucket è¡¨ï¼Œä»¥åŠä¿®æ”¹ Bucket ä¸ªæ•°ï¼‰æ—¶ï¼Œè®°å½•ä¿®æ”¹æ—¥æœŸã€‚å¹¶ä¸”åœ¨å†³å®šä½¿ç”¨å“ªç§ Join æ–¹å¼æ—¶ï¼Œå¯¹äº Bucket è¡¨å…ˆæ£€æŸ¥æ‰€æŸ¥è¯¢çš„æ•°æ®æ˜¯å¦åªåŒ…å«è¯¥æ—¥æœŸä¹‹åçš„åˆ†åŒºã€‚å¦‚æœæ˜¯ï¼Œåˆ™å½“æˆ Bucket è¡¨å¤„ç†ï¼Œæ”¯æŒ Bucket Joinï¼›å¦åˆ™å½“æˆæ™®é€šæ—  Bucket çš„è¡¨ã€‚æ”¹è¿›å››ï¼šæ”¯æŒè¶…é›†å¯¹äºä¸€å¼ å¸¸ç”¨è¡¨ï¼Œå¯èƒ½ä¼šä¸å¦å¤–ä¸€å¼ è¡¨æŒ‰ User å­—æ®µåš Joinï¼Œä¹Ÿå¯èƒ½ä¼šä¸å¦å¤–ä¸€å¼ è¡¨æŒ‰ User å’Œ App å­—æ®µåš Joinï¼Œä¸å…¶å®ƒè¡¨æŒ‰ User ä¸ Item å­—æ®µè¿›è¡Œ Joinã€‚è€Œ Spark SQL åŸç”Ÿçš„ Bucket Join è¦æ±‚ Join Key Set ä¸è¡¨çš„ Bucket Key Set å®Œå…¨ç›¸åŒæ‰èƒ½è¿›è¡Œ Bucket Joinã€‚åœ¨è¯¥åœºæ™¯ä¸­ï¼Œä¸åŒ Join çš„ Key Set ä¸åŒï¼Œå› æ­¤æ— æ³•åŒæ—¶ä½¿ç”¨ Bucket Joinã€‚è¿™æå¤§çš„é™åˆ¶äº† Bucket Join çš„é€‚ç”¨åœºæ™¯ã€‚é’ˆå¯¹æ­¤é—®é¢˜ï¼Œæˆ‘ä»¬æ”¯æŒäº†è¶…é›†åœºæ™¯ä¸‹çš„ Bucket Joinã€‚åªè¦ Join Key Set åŒ…å«äº† Bucket Key Setï¼Œå³å¯è¿›è¡Œ Bucket Joinã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒTable X ä¸ Table Yï¼Œéƒ½æŒ‰å­—æ®µ A åˆ† Bucketã€‚è€ŒæŸ¥è¯¢éœ€è¦å¯¹ Table X ä¸ Table Y è¿›è¡Œ Joinï¼Œä¸” Join Key Set ä¸º A ä¸ Bã€‚æ­¤æ—¶ï¼Œç”±äº A ç›¸ç­‰çš„æ•°æ®ï¼Œåœ¨ä¸¤è¡¨ä¸­çš„ Bucket ID ç›¸åŒï¼Œé‚£ A ä¸ B å„è‡ªç›¸ç­‰çš„æ•°æ®åœ¨ä¸¤è¡¨ä¸­çš„ Bucket ID è‚¯å®šä¹Ÿç›¸åŒï¼Œæ‰€ä»¥æ•°æ®åˆ†å¸ƒæ˜¯æ»¡è¶³ Join è¦æ±‚çš„ï¼Œä¸éœ€è¦ Shuffleã€‚åŒæ—¶ï¼ŒBucket Join è¿˜éœ€è¦ä¿è¯ä¸¤è¡¨æŒ‰ Join Key Set å³ A å’Œ B æ’åºï¼Œæ­¤æ—¶åªéœ€è¦å¯¹ Table X ä¸ Table Y è¿›è¡Œåˆ†åŒºå†…æ’åºå³å¯ã€‚ç”±äºä¸¤è¾¹å·²ç»æŒ‰å­—æ®µ A æ’åºäº†ï¼Œæ­¤æ—¶å†æŒ‰ A ä¸ B æ’åºï¼Œä»£ä»·ç›¸å¯¹è¾ƒä½ã€‚ç‰©åŒ–åˆ—**Spark SQL å¤„ç†åµŒå¥—ç±»å‹æ•°æ®æ—¶ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼šè¯»å–å¤§é‡ä¸å¿…è¦çš„æ•°æ®ï¼šå¯¹äº Parquet / ORC ç­‰åˆ—å¼å­˜å‚¨æ ¼å¼ï¼Œå¯åªè¯»å–éœ€è¦çš„å­—æ®µï¼Œè€Œç›´æ¥è·³è¿‡å…¶å®ƒå­—æ®µï¼Œä»è€Œæå¤§èŠ‚çœ IOã€‚è€Œå¯¹äºåµŒå¥—æ•°æ®ç±»å‹çš„å­—æ®µï¼Œå¦‚ä¸‹å›¾ä¸­çš„ Map ç±»å‹çš„ people å­—æ®µï¼Œå¾€å¾€åªéœ€è¦è¯»å–å…¶ä¸­çš„å­å­—æ®µï¼Œå¦‚ people.ageã€‚å´éœ€è¦å°†æ•´ä¸ª Map ç±»å‹çš„ people å­—æ®µå…¨éƒ¨è¯»å–å‡ºæ¥ç„¶åæŠ½å–å‡º people.age å­—æ®µã€‚è¿™ä¼šå¼•å…¥å¤§é‡çš„æ— æ„ä¹‰çš„ IO å¼€é”€ã€‚åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ï¼Œå­˜åœ¨ä¸å°‘ Map ç±»å‹çš„å­—æ®µï¼Œè€Œä¸”å¾ˆå¤šåŒ…å«å‡ åè‡³å‡ ç™¾ä¸ª Keyï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ IO è¢«æ”¾å¤§äº†å‡ åè‡³å‡ ç™¾å€ã€‚æ— æ³•è¿›è¡Œå‘é‡åŒ–è¯»å–ï¼šè€Œå‘é‡åŒ–è¯»èƒ½æå¤§çš„æå‡æ€§èƒ½ã€‚ä½†æˆªæ­¢åˆ°ç›®å‰ï¼ˆ2019å¹´10æœˆ26æ—¥ï¼‰ï¼ŒSpark ä¸æ”¯æŒåŒ…å«åµŒå¥—æ•°æ®ç±»å‹çš„å‘é‡åŒ–è¯»å–ã€‚è¿™æå¤§çš„å½±å“äº†åŒ…å«åµŒå¥—æ•°æ®ç±»å‹çš„æŸ¥è¯¢æ€§èƒ½ä¸æ”¯æŒ Filter ä¸‹æ¨ï¼šç›®å‰ï¼ˆ2019å¹´10æœˆ26æ—¥ï¼‰çš„ Spark ä¸æ”¯æŒåµŒå¥—ç±»å‹å­—æ®µä¸Šçš„ Filter çš„ä¸‹æ¨é‡å¤è®¡ç®—ï¼šJSON å­—æ®µï¼Œåœ¨ Spark SQL ä¸­ä»¥ String ç±»å‹å­˜åœ¨ï¼Œä¸¥æ ¼æ¥è¯´ä¸ç®—åµŒå¥—æ•°æ®ç±»å‹ã€‚ä¸è¿‡å®è·µä¸­ä¹Ÿå¸¸ç”¨äºä¿å­˜ä¸å›ºå®šçš„å¤šä¸ªå­—æ®µï¼Œåœ¨æŸ¥è¯¢æ—¶é€šè¿‡ JSON Path æŠ½å–ç›®æ ‡å­å­—æ®µï¼Œè€Œå¤§å‹ JSON å­—ç¬¦ä¸²çš„å­—æ®µæŠ½å–éå¸¸æ¶ˆè€— CPUã€‚å¯¹äºçƒ­ç‚¹è¡¨ï¼Œé¢‘ç¹é‡å¤æŠ½å–ç›¸åŒå­å­—æ®µéå¸¸æµªè´¹èµ„æºã€‚å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œåšæ•°ä»“çš„åŒå­¦ä¹Ÿæƒ³äº†ä¸€äº›è§£å†³æ–¹æ¡ˆã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨åä¸º base_table çš„è¡¨ä¹‹å¤–åˆ›å»ºäº†ä¸€å¼ åä¸º sub_table çš„è¡¨ï¼Œå¹¶ä¸”å°†é«˜é¢‘ä½¿ç”¨çš„å­å­—æ®µ people.age è®¾ç½®ä¸ºä¸€ä¸ªé¢å¤–çš„ Integer ç±»å‹çš„å­—æ®µã€‚ä¸‹æ¸¸ä¸å†é€šè¿‡ base_table æŸ¥è¯¢ people.ageï¼Œè€Œæ˜¯ä½¿ç”¨ sub_table ä¸Šçš„ age å­—æ®µä»£æ›¿ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå°†åµŒå¥—ç±»å‹å­—æ®µä¸Šçš„æŸ¥è¯¢è½¬ä¸ºäº† Primitive ç±»å‹å­—æ®µçš„æŸ¥è¯¢ï¼ŒåŒæ—¶è§£å†³äº†ä¸Šè¿°é—®é¢˜ã€‚)è¿™ç§æ–¹æ¡ˆå­˜åœ¨æ˜æ˜¾ç¼ºé™·ï¼šé¢å¤–ç»´æŠ¤äº†ä¸€å¼ è¡¨ï¼Œå¼•å…¥äº†å¤§é‡çš„é¢å¤–å­˜å‚¨/è®¡ç®—å¼€é”€ã€‚æ— æ³•åœ¨æ–°è¡¨ä¸ŠæŸ¥è¯¢æ–°å¢å­—æ®µçš„å†å²æ•°æ®ï¼ˆå¦‚è¦æ”¯æŒå¯¹å†å²æ•°æ®çš„æŸ¥è¯¢ï¼Œéœ€è¦é‡è·‘å†å²ä½œä¸šï¼Œå¼€é”€è¿‡å¤§ï¼Œæ— æ³•æ¥å—ï¼‰ã€‚è¡¨çš„ç»´æŠ¤æ–¹éœ€è¦åœ¨ä¿®æ”¹è¡¨ç»“æ„åä¿®æ”¹æ’å…¥æ•°æ®çš„ä½œä¸šã€‚éœ€è¦ä¸‹æ¸¸æŸ¥è¯¢æ–¹ä¿®æ”¹æŸ¥è¯¢è¯­å¥ï¼Œæ¨å¹¿æˆæœ¬è¾ƒå¤§ã€‚è¿è¥æˆæœ¬é«˜ï¼šå¦‚æœé«˜é¢‘å­å­—æ®µå˜åŒ–ï¼Œéœ€è¦åˆ é™¤ä¸å†éœ€è¦çš„ç‹¬ç«‹å­å­—æ®µï¼Œå¹¶æ·»åŠ æ–°å­å­—æ®µä¸ºç‹¬ç«‹å­—æ®µã€‚åˆ é™¤å‰ï¼Œéœ€è¦ç¡®ä¿ä¸‹æ¸¸æ— ä¸šåŠ¡ä½¿ç”¨è¯¥å­—æ®µã€‚è€Œæ–°å¢å­—æ®µéœ€è¦é€šçŸ¥å¹¶æ¨è¿›ä¸‹æ¸¸ä¸šåŠ¡æ–¹ä½¿ç”¨æ–°å­—æ®µã€‚ä¸ºè§£å†³ä¸Šè¿°æ‰€æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬è®¾è®¡å¹¶å®ç°äº†ç‰©åŒ–åˆ—ã€‚å®ƒçš„åŸç†æ˜¯ï¼šæ–°å¢ä¸€ä¸ª Primitive ç±»å‹å­—æ®µï¼Œæ¯”å¦‚ Integer ç±»å‹çš„ age å­—æ®µï¼Œå¹¶ä¸”æŒ‡å®šå®ƒæ˜¯ people.age çš„ç‰©åŒ–å­—æ®µã€‚æ’å…¥æ•°æ®æ—¶ï¼Œä¸ºç‰©åŒ–å­—æ®µè‡ªåŠ¨ç”Ÿæˆæ•°æ®ï¼Œå¹¶åœ¨ Partition Parameter å†…ä¿å­˜ç‰©åŒ–å…³ç³»ã€‚å› æ­¤å¯¹æ’å…¥æ•°æ®çš„ä½œä¸šå®Œå…¨é€æ˜ï¼Œè¡¨çš„ç»´æŠ¤æ–¹ä¸éœ€è¦ä¿®æ”¹å·²æœ‰ä½œä¸šã€‚æŸ¥è¯¢æ—¶ï¼Œæ£€æŸ¥æ‰€éœ€æŸ¥è¯¢çš„æ‰€æœ‰ Partitionï¼Œå¦‚æœéƒ½åŒ…å«ç‰©åŒ–ä¿¡æ¯ï¼ˆpeople.age åˆ° age çš„æ˜ å°„ï¼‰ï¼Œç›´æ¥å°† select people.age è‡ªåŠ¨é‡å†™ä¸º select ageï¼Œä»è€Œå®ç°å¯¹ä¸‹æ¸¸æŸ¥è¯¢æ–¹çš„å®Œå…¨é€æ˜ä¼˜åŒ–ã€‚åŒæ—¶å…¼å®¹å†å²æ•°æ®ã€‚ä¸‹å›¾å±•ç¤ºäº†åœ¨æŸå¼ æ ¸å¿ƒè¡¨ä¸Šä½¿ç”¨ç‰©åŒ–åˆ—çš„æ”¶ç›Šï¼šç‰©åŒ–è§†å›¾åœ¨ OLAP é¢†åŸŸï¼Œç»å¸¸ä¼šå¯¹ç›¸åŒè¡¨çš„æŸäº›å›ºå®šå­—æ®µè¿›è¡Œ Group By å’Œ Aggregate / Join ç­‰è€—æ—¶æ“ä½œï¼Œé€ æˆå¤§é‡é‡å¤æ€§è®¡ç®—ï¼Œæµªè´¹èµ„æºï¼Œä¸”å½±å“æŸ¥è¯¢æ€§èƒ½ï¼Œä¸åˆ©äºæå‡ç”¨æˆ·ä½“éªŒã€‚æˆ‘ä»¬å®ç°äº†åŸºäºç‰©åŒ–è§†å›¾çš„ä¼˜åŒ–åŠŸèƒ½ï¼šå¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæŸ¥è¯¢å†å²æ˜¾ç¤ºå¤§é‡æŸ¥è¯¢æ ¹æ® user è¿›è¡Œ group byï¼Œç„¶åå¯¹ num è¿›è¡Œ sum æˆ– count è®¡ç®—ã€‚æ­¤æ—¶å¯åˆ›å»ºä¸€å¼ ç‰©åŒ–è§†å›¾ï¼Œä¸”å¯¹ user è¿›è¡Œ gorup byï¼Œå¯¹ num è¿›è¡Œ avgï¼ˆavg ä¼šè‡ªåŠ¨è½¬æ¢ä¸º count å’Œ sumï¼‰ã€‚ç”¨æˆ·å¯¹åŸå§‹è¡¨è¿›è¡Œ select user, sum(num) æŸ¥è¯¢æ—¶ï¼ŒSpark SQL è‡ªåŠ¨å°†æŸ¥è¯¢é‡å†™ä¸ºå¯¹ç‰©åŒ–è§†å›¾çš„ select user, sum_num æŸ¥è¯¢ã€‚Spark SQL å¼•æ“ä¸Šçš„å…¶å®ƒä¼˜åŒ–ä¸‹å›¾å±•ç¤ºäº†æˆ‘ä»¬åœ¨ Spark SQL ä¸Šè¿›è¡Œçš„å…¶å®ƒéƒ¨åˆ†ä¼˜åŒ–å·¥ä½œï¼šSpark Shuffleç¨³å®šæ€§æå‡ä¸æ€§èƒ½ä¼˜åŒ–Spark Shuffle å­˜åœ¨çš„é—®é¢˜Shuffleçš„åŸç†ï¼Œå¾ˆå¤šåŒå­¦åº”è¯¥å·²ç»å¾ˆç†Ÿæ‚‰äº†ã€‚é‰´äºæ—¶é—´å…³ç³»ï¼Œè¿™é‡Œä¸ä»‹ç»è¿‡å¤šç»†èŠ‚ï¼Œåªç®€å•ä»‹ç»ä¸‹åŸºæœ¬æ¨¡å‹ã€‚)å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å°† Shuffle ä¸Šæ¸¸ Stage ç§°ä¸º Mapper Stageï¼Œå…¶ä¸­çš„ Task ç§°ä¸º Mapperã€‚Shuffle ä¸‹æ¸¸ Stage ç§°ä¸º Reducer Stageï¼Œå…¶ä¸­çš„ Task ç§°ä¸º Reducerã€‚æ¯ä¸ª Mapper ä¼šå°†è‡ªå·±çš„æ•°æ®åˆ†ä¸ºæœ€å¤š N ä¸ªéƒ¨åˆ†ï¼ŒN ä¸º Reducer ä¸ªæ•°ã€‚æ¯ä¸ª Reducer éœ€è¦å»æœ€å¤š M ï¼ˆMapper ä¸ªæ•°ï¼‰ä¸ª Mapper è·å–å±äºè‡ªå·±çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚è¿™ä¸ªæ¶æ„å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼šç¨³å®šæ€§é—®é¢˜ï¼šMapper çš„ Shuffle Write æ•°æ®å­˜äº Mapper æœ¬åœ°ç£ç›˜ï¼Œåªæœ‰ä¸€ä¸ªå‰¯æœ¬ã€‚å½“è¯¥æœºå™¨å‡ºç°ç£ç›˜æ•…éšœï¼Œæˆ–è€… IO æ»¡è½½ï¼ŒCPU æ»¡è½½æ—¶ï¼ŒReducer æ— æ³•è¯»å–è¯¥æ•°æ®ï¼Œä»è€Œå¼•èµ· FetchFailedExceptionï¼Œè¿›è€Œå¯¼è‡´ Stage Retryã€‚Stage Retry ä¼šé€ æˆä½œä¸šæ‰§è¡Œæ—¶é—´å¢é•¿ï¼Œç›´æ¥å½±å“ SLAã€‚åŒæ—¶ï¼Œæ‰§è¡Œæ—¶é—´è¶Šé•¿ï¼Œå‡ºç° Shuffle æ•°æ®æ— æ³•è¯»å–çš„å¯èƒ½æ€§è¶Šå¤§ï¼Œåè¿‡æ¥åˆä¼šé€ æˆæ›´å¤š Stage Retryã€‚å¦‚æ­¤å¾ªç¯ï¼Œå¯èƒ½å¯¼è‡´å¤§å‹ä½œä¸šæ— æ³•æˆåŠŸæ‰§è¡Œã€‚æ€§èƒ½é—®é¢˜ï¼šæ¯ä¸ª Mapper çš„æ•°æ®ä¼šè¢«å¤§é‡ Reducer è¯»å–ï¼Œå¹¶ä¸”æ˜¯éšæœºè¯»å–ä¸åŒéƒ¨åˆ†ã€‚å‡è®¾ Mapper çš„ Shuffle è¾“å‡ºä¸º 512MBï¼ŒReducer æœ‰ 10 ä¸‡ä¸ªï¼Œé‚£å¹³å‡æ¯ä¸ª Reducer è¯»å–æ•°æ® 512MB / 100000 = 5.24KBã€‚å¹¶ä¸”ï¼Œä¸åŒ Reducer å¹¶è¡Œè¯»å–æ•°æ®ã€‚å¯¹äº Mapper è¾“å‡ºæ–‡ä»¶è€Œè¨€ï¼Œå­˜åœ¨å¤§é‡çš„éšæœºè¯»å–ã€‚è€Œ HDD çš„éšæœº IO æ€§èƒ½è¿œä½äºé¡ºåº IOã€‚æœ€ç»ˆçš„ç°è±¡æ˜¯ï¼ŒReducer è¯»å– Shuffle æ•°æ®éå¸¸æ…¢ï¼Œåæ˜ åˆ° Metrics ä¸Šå°±æ˜¯ Reducer Shuffle Read Blocked Time è¾ƒé•¿ï¼Œç”šè‡³å æ•´ä¸ª Reducer æ‰§è¡Œæ—¶é—´çš„ä¸€å¤§åŠï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚åŸºäºHDFSçš„Shuffleç¨³å®šæ€§æå‡ç»è§‚å¯Ÿï¼Œå¼•èµ· Shuffle å¤±è´¥çš„æœ€å¤§å› ç´ ä¸æ˜¯ç£ç›˜æ•…éšœç­‰ç¡¬ä»¶é—®é¢˜ï¼Œè€Œæ˜¯ CPU æ»¡è½½å’Œç£ç›˜ IO æ»¡è½½ã€‚)å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæœºå™¨çš„ CPU ä½¿ç”¨ç‡æ¥è¿‘ 100%ï¼Œä½¿å¾— Mapper ä¾§çš„ Node Manager å†…çš„ Spark External Shuffle Service æ— æ³•åŠæ—¶æä¾› Shuffle æœåŠ¡ã€‚ä¸‹å›¾ä¸­ Data Node å ç”¨äº†æ•´å°æœºå™¨ IO èµ„æºçš„ 84%ï¼Œéƒ¨åˆ†ç£ç›˜ IO å®Œå…¨æ‰“æ»¡ï¼Œè¿™ä½¿å¾—è¯»å– Shuffle æ•°æ®éå¸¸æ…¢ï¼Œè¿›è€Œä½¿å¾— Reducer ä¾§æ— æ³•åœ¨è¶…æ—¶æ—¶é—´å†…è¯»å–æ•°æ®ï¼Œé€ æˆ FetchFailedExceptionã€‚æ— è®ºæ˜¯ä½•ç§åŸå› ï¼Œé—®é¢˜çš„ç—‡ç»“éƒ½æ˜¯ Mapper ä¾§çš„ Shuffle Write æ•°æ®åªä¿å­˜åœ¨æœ¬åœ°ï¼Œä¸€æ—¦è¯¥èŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼Œä¼šé€ æˆè¯¥èŠ‚ç‚¹ä¸Šæ‰€æœ‰ Shuffle Write æ•°æ®æ— æ³•è¢« Reducer è¯»å–ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªé€šç”¨æ–¹æ³•æ˜¯ï¼Œé€šè¿‡å¤šå‰¯æœ¬ä¿è¯å¯ç”¨æ€§ã€‚æœ€åˆå§‹çš„ä¸€ä¸ªç®€å•æ–¹æ¡ˆæ˜¯ï¼ŒMapper ä¾§æœ€ç»ˆæ•°æ®æ–‡ä»¶ä¸ç´¢å¼•æ–‡ä»¶ä¸å†™åœ¨æœ¬åœ°ç£ç›˜ï¼Œè€Œæ˜¯ç›´æ¥å†™åˆ° HDFSã€‚Reducer ä¸å†é€šè¿‡ Mapper ä¾§çš„ External Shuffle Service è¯»å– Shuffle æ•°æ®ï¼Œè€Œæ˜¯ç›´æ¥ä» HDFS ä¸Šè·å–æ•°æ®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å¿«é€Ÿå®ç°è¿™ä¸ªæ–¹æ¡ˆåï¼Œæˆ‘ä»¬åšäº†å‡ ç»„ç®€å•çš„æµ‹è¯•ã€‚ç»“æœè¡¨æ˜ï¼šMapper ä¸ Reducer ä¸å¤šæ—¶ï¼ŒShuffle è¯»å†™æ€§èƒ½ä¸åŸå§‹æ–¹æ¡ˆç›¸æ¯”æ— å·®å¼‚ã€‚Mapper ä¸ Reducer è¾ƒå¤šæ—¶ï¼ŒShuffle è¯»å˜å¾—éå¸¸æ…¢ã€‚åœ¨ä¸Šé¢çš„å®éªŒè¿‡ç¨‹ä¸­ï¼ŒHDFS å‘å‡ºäº†æŠ¥è­¦ä¿¡æ¯ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒHDFS Name Node Proxy çš„ QPS å³°å€¼è¾¾åˆ° 60 ä¸‡ã€‚ï¼ˆæ³¨ï¼šå­—èŠ‚è·³åŠ¨è‡ªç ”äº† Node Name Proxyï¼Œå¹¶åœ¨ Proxy å±‚å®ç°äº†ç¼“å­˜ï¼Œå› æ­¤è¯» QPS å¯ä»¥æ”¯æ’‘åˆ°è¿™ä¸ªé‡çº§ï¼‰ã€‚åŸå› åœ¨äºï¼Œæ€»å…± 10000 Reducerï¼Œéœ€è¦ä» 10000 ä¸ª Mapper å¤„è¯»å–æ•°æ®æ–‡ä»¶å’Œç´¢å¼•æ–‡ä»¶ï¼Œæ€»å…±éœ€è¦è¯»å– HDFS 10000 * 1000 * 2 = 2 äº¿æ¬¡ã€‚å¦‚æœåªæ˜¯ Name Node çš„å•ç‚¹æ€§èƒ½é—®é¢˜ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸€äº›ç®€å•çš„æ–¹æ³•è§£å†³ã€‚ä¾‹å¦‚åœ¨ Spark Driver ä¾§ä¿å­˜æ‰€æœ‰ Mapper çš„ Block Locationï¼Œç„¶å Driver å°†è¯¥ä¿¡æ¯å¹¿æ’­è‡³æ‰€æœ‰ Executorï¼Œæ¯ä¸ª Reducer å¯ä»¥ç›´æ¥ä» Executor å¤„è·å– Block Locationï¼Œç„¶åæ— é¡»è¿æ¥ Name Nodeï¼Œè€Œæ˜¯ç›´æ¥ä» Data Node è¯»å–æ•°æ®ã€‚ä½†é‰´äº Data Node çš„çº¿ç¨‹æ¨¡å‹ï¼Œè¿™ç§æ–¹æ¡ˆä¼šå¯¹ Data Node é€ æˆè¾ƒå¤§å†²å‡»ã€‚æœ€åæˆ‘ä»¬é€‰æ‹©äº†ä¸€ç§æ¯”è¾ƒç®€å•å¯è¡Œçš„æ–¹æ¡ˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚Mapper çš„ Shuffle è¾“å‡ºæ•°æ®ä»ç„¶æŒ‰åŸæ–¹æ¡ˆå†™æœ¬åœ°ç£ç›˜ï¼Œå†™å®Œåä¸Šä¼ åˆ° HDFSã€‚Reducer ä»ç„¶æŒ‰åŸå§‹æ–¹æ¡ˆé€šè¿‡ Mapper ä¾§çš„ External Shuffle Service è¯»å– Shuffle æ•°æ®ã€‚å¦‚æœå¤±è´¥äº†ï¼Œåˆ™ä» HDFS è¯»å–ã€‚è¿™ç§æ–¹æ¡ˆæå¤§å‡å°‘äº†å¯¹ HDFS çš„è®¿é—®é¢‘ç‡ã€‚è¯¥æ–¹æ¡ˆä¸Šçº¿è¿‘ä¸€å¹´ï¼šè¦†ç›– 57% ä»¥ä¸Šçš„ Spark Shuffle æ•°æ®ã€‚ä½¿å¾— Spark ä½œä¸šæ•´ä½“æ€§èƒ½æå‡ 14%ã€‚å¤©çº§å¤§ä½œä¸šæ€§èƒ½æå‡ 18%ã€‚å°æ—¶çº§ä½œä¸šæ€§èƒ½æå‡ 12%ã€‚è¯¥æ–¹æ¡ˆæ—¨åœ¨æå‡ Spark Shuffle ç¨³å®šæ€§ä»è€Œæå‡ä½œä¸šç¨³å®šæ€§ï¼Œä½†æœ€ç»ˆæ²¡æœ‰ä½¿ç”¨æ–¹å·®ç­‰æŒ‡æ ‡æ¥è¡¡é‡ç¨³å®šæ€§çš„æå‡ã€‚åŸå› åœ¨äºæ¯å¤©é›†ç¾¤è´Ÿè½½ä¸ä¸€æ ·ï¼Œæ•´ä½“æ–¹å·®è¾ƒå¤§ã€‚Shuffle ç¨³å®šæ€§æå‡åï¼ŒStage Retry å¤§å¹…å‡å°‘ï¼Œæ•´ä½“ä½œä¸šæ‰§è¡Œæ—¶é—´å‡å°‘ï¼Œä¹Ÿå³æ€§èƒ½æå‡ã€‚æœ€ç»ˆé€šè¿‡å¯¹æ¯”ä½¿ç”¨è¯¥æ–¹æ¡ˆå‰åçš„æ€»çš„ä½œä¸šæ‰§è¡Œæ—¶é—´æ¥å¯¹æ¯”æ€§èƒ½çš„æå‡ï¼Œç”¨äºè¡¡é‡è¯¥æ–¹æ¡ˆçš„æ•ˆæœã€‚Shuffleæ€§èƒ½ä¼˜åŒ–å®è·µä¸æ¢ç´¢å¦‚ä¸Šæ–‡æ‰€åˆ†æï¼ŒShuffle æ€§èƒ½é—®é¢˜çš„åŸå› åœ¨äºï¼ŒShuffle Write ç”± Mapper å®Œæˆï¼Œç„¶å Reducer éœ€è¦ä»æ‰€æœ‰ Mapper å¤„è¯»å–æ•°æ®ã€‚è¿™ç§æ¨¡å‹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºä»¥ Mapper ä¸ºä¸­å¿ƒçš„ Shuffleã€‚å®ƒçš„é—®é¢˜åœ¨äºï¼šMapper ä¾§ä¼šæœ‰ M æ¬¡é¡ºåºå†™ IOã€‚Mapper ä¾§ä¼šæœ‰ M * N * 2 æ¬¡éšæœºè¯» IOï¼ˆè¿™æ˜¯æœ€å¤§çš„æ€§èƒ½ç“¶é¢ˆï¼‰ã€‚Mapper ä¾§çš„ External Shuffle Service å¿…é¡»ä¸ Mapper ä½äºåŒä¸€å°æœºå™¨ï¼Œæ— æ³•åšåˆ°æœ‰æ•ˆçš„å­˜å‚¨è®¡ç®—åˆ†ç¦»ï¼ŒShuffle æœåŠ¡æ— æ³•ç‹¬ç«‹æ‰©å±•ã€‚é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬æå‡ºäº†ä»¥ Reducer ä¸ºä¸­å¿ƒçš„ï¼Œå­˜å‚¨è®¡ç®—åˆ†ç¦»çš„ Shuffle æ–¹æ¡ˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚è¯¥æ–¹æ¡ˆçš„åŸç†æ˜¯ï¼ŒMapper ç›´æ¥å°†å±äºä¸åŒ Reducer çš„æ•°æ®å†™åˆ°ä¸åŒçš„ Shuffle Serviceã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œæ€»å…± 2 ä¸ª Mapperï¼Œ5 ä¸ª Reducerï¼Œ5 ä¸ª Shuffle Serviceã€‚æ‰€æœ‰ Mapper éƒ½å°†å±äº Reducer 0 çš„æ•°æ®è¿œç¨‹æµå¼å‘é€ç»™ Shuffle Service 0ï¼Œå¹¶ç”±å®ƒé¡ºåºå†™å…¥ç£ç›˜ã€‚Reducer 0 åªéœ€è¦ä» Shuffle Service 0 é¡ºåºè¯»å–æ‰€æœ‰æ•°æ®å³å¯ï¼Œæ— éœ€å†ä» M ä¸ª Mapper å–æ•°æ®ã€‚è¯¥æ–¹æ¡ˆçš„ä¼˜åŠ¿åœ¨äºï¼šå°† M * N * 2 æ¬¡éšæœº IO å˜ä¸º N æ¬¡é¡ºåº IOã€‚Shuffle Service å¯ä»¥ç‹¬ç«‹äº Mapper æˆ–è€… Reducer éƒ¨ç½²ï¼Œä»è€Œåšåˆ°ç‹¬ç«‹æ‰©å±•ï¼Œåšåˆ°å­˜å‚¨è®¡ç®—åˆ†ç¦»ã€‚Shuffle Service å¯å°†æ•°æ®ç›´æ¥å­˜äº HDFS ç­‰é«˜å¯ç”¨å­˜å‚¨ï¼Œå› æ­¤å¯åŒæ—¶è§£å†³ Shuffle ç¨³å®šæ€§é—®é¢˜ã€‚æˆ‘çš„åˆ†äº«å°±åˆ°è¿™é‡Œï¼Œè°¢è°¢å¤§å®¶ã€‚QAé›†é”¦- æé—®ï¼šç‰©åŒ–åˆ—æ–°å¢ä¸€åˆ—ï¼Œæ˜¯å¦éœ€è¦ä¿®æ”¹å†å²æ•°æ®ï¼Ÿå›ç­”ï¼šå†å²æ•°æ®å¤ªå¤šï¼Œä¸é€‚åˆä¿®æ”¹å†å²æ•°æ®ã€‚- æé—®ï¼šå¦‚æœç”¨æˆ·çš„è¯·æ±‚åŒæ—¶åŒ…å«æ–°æ•°æ®å’Œå†å²æ•°æ®ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿå›ç­”ï¼šä¸€èˆ¬è€Œè¨€ï¼Œç”¨æˆ·ä¿®æ”¹æ•°æ®éƒ½æ˜¯ä»¥ Partition ä¸ºå•ä½ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨ Partition Parameter ä¸Šä¿å­˜äº†ç‰©åŒ–åˆ—ç›¸å…³ä¿¡æ¯ã€‚å¦‚æœç”¨æˆ·çš„æŸ¥è¯¢åŒæ—¶åŒ…å«äº†æ–° Partition ä¸å†å² Partitionï¼Œæˆ‘ä»¬ä¼šåœ¨æ–° Partition ä¸Šé’ˆå¯¹ç‰©åŒ–åˆ—è¿›è¡Œ SQL Rewriteï¼Œå†å² Partition ä¸ Rewriteï¼Œç„¶åå°†æ–°è€ Partition è¿›è¡Œ Unionï¼Œä»è€Œåœ¨ä¿è¯æ•°æ®æ­£ç¡®æ€§çš„å‰æä¸‹å°½å¯èƒ½å……åˆ†åˆ©ç”¨ç‰©åŒ–åˆ—çš„ä¼˜åŠ¿ã€‚- æé—®ï¼šä½ å¥½ï¼Œä½ ä»¬é’ˆå¯¹ç”¨æˆ·çš„åœºæ™¯ï¼Œåšäº†å¾ˆå¤šæŒºæœ‰ä»·å€¼çš„ä¼˜åŒ–ã€‚åƒç‰©åŒ–åˆ—ã€ç‰©åŒ–è§†å›¾ï¼Œéƒ½éœ€è¦æ ¹æ®ç”¨æˆ·çš„æŸ¥è¯¢ Pattern è¿›è¡Œè®¾ç½®ã€‚ç›®å‰ä½ ä»¬æ˜¯äººå·¥åˆ†æè¿™äº›æŸ¥è¯¢ï¼Œè¿˜æ˜¯æœ‰æŸç§æœºåˆ¶è‡ªåŠ¨å»åˆ†æå¹¶ä¼˜åŒ–ï¼Ÿå›ç­”ï¼šç›®å‰æˆ‘ä»¬ä¸»è¦æ˜¯é€šè¿‡ä¸€äº›å®¡è®¡ä¿¡æ¯è¾…åŠ©äººå·¥åˆ†æã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿæ­£åœ¨åšç‰©åŒ–åˆ—ä¸ç‰©åŒ–è§†å›¾çš„æ¨èæœåŠ¡ï¼Œæœ€ç»ˆåšåˆ°æ™ºèƒ½å»ºè®¾ç‰©åŒ–åˆ—ä¸ç‰©åŒ–è§†å›¾ã€‚- æé—®ï¼šåˆšåˆšä»‹ç»çš„åŸºäº HDFS çš„ Spark Shuffle ç¨³å®šæ€§æå‡æ–¹æ¡ˆï¼Œæ˜¯å¦å¯ä»¥å¼‚æ­¥ä¸Šä¼  Shuffle æ•°æ®è‡³ HDFSï¼Ÿå›ç­”ï¼šè¿™ä¸ªæƒ³æ³•æŒºå¥½ï¼Œæˆ‘ä»¬ä¹‹å‰ä¹Ÿè€ƒè™‘è¿‡ï¼Œä½†åŸºäºå‡ ç‚¹è€ƒè™‘ï¼Œæœ€ç»ˆæ²¡æœ‰è¿™æ ·åšã€‚ç¬¬ä¸€ï¼Œå• Mapper çš„ Shuffle è¾“å‡ºæ•°æ®é‡ä¸€èˆ¬å¾ˆå°ï¼Œä¸Šä¼ åˆ° HDFS è€—æ—¶åœ¨ 2 ç§’ä»¥å†…ï¼Œè¿™ä¸ªæ—¶é—´å¼€é”€å¯ä»¥å¿½ç•¥ï¼›ç¬¬äºŒï¼Œæˆ‘ä»¬å¹¿æ³›ä½¿ç”¨ External Shuffle Service å’Œ Dynamic Allocationï¼ŒMapper æ‰§è¡Œå®Œæˆåå¯èƒ½ Executor å°±å›æ”¶äº†ï¼Œå¦‚æœè¦å¼‚æ­¥ä¸Šä¼ ï¼Œå°±å¿…é¡»ä¾èµ–å…¶å®ƒç»„ä»¶ï¼Œè¿™ä¼šæå‡å¤æ‚åº¦ï¼ŒROI è¾ƒä½ã€‚æœ€åå­—èŠ‚çš„è¿™ç¯‡åˆ†äº«ï¼Œæˆ‘çœŸçš„å¤ªå–œæ¬¢äº†ï¼Œæ‰€æœ‰çš„ä¼˜åŒ–ç‚¹ï¼Œéƒ½æ˜¯æ‹¿çœŸå®çš„ä¸šåŠ¡åœºæ™¯è¿›è¡Œä¸¾ä¾‹ï¼Œè™½ç„¶ä¸Šæ–‡æœ‰çš„æŠ€æœ¯ç‚¹åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­è¿˜æ²¡å¿…è¦å»åšåˆ°è¿™ç§ä¼˜åŒ–ç¨‹åº¦ï¼Œä½†æ˜¯å¦‚æ­¤å®åœ¨çš„æ¥æºäºçº¿ä¸Šçš„æ–¹æ¡ˆï¼Œéå¸¸å®¹æ˜“ç†è§£ã€‚æˆ‘ä»¬å…¬å¸ç›®å‰çš„æ•°æ®é‡è¦æ¯”å­—èŠ‚çš„é‡å°å¾ˆå¤šï¼Œæœ€è¿‘åœ¨æ–°é—»ä¸Šçœ‹åˆ°æŠ–éŸ³çš„æ—¥æ´»å·²ç»è¾¾åˆ°äº†4äº¿ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ•°ä»“ä¸­çš„æ•°æ®ï¼Œè¿˜æ²¡æœ‰ç”¨åˆ°æ›´ç»†ç²’åº¦çš„Bucketè¡¨ï¼Œåˆ†åŒºè¡¨å°±å·²ç»å®Œå…¨å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ä¸Šæ–‡ä¸­çš„ç‰©åŒ–åˆ—æ–¹æ¡ˆï¼Œæˆ‘è§‰å¾—å¾ˆæ–°é¢–ï¼Œä½†æ˜¯ä»å·¥ç¨‹å¸ˆçš„è§’åº¦æ¥è®²ï¼Œåœ¨ç‰©åŒ–åˆ—æ–¹æ¡ˆä¸­ï¼Œå¤šç»´æŠ¤ä¸€å¼ è¡¨ï¼Œæ·»åŠ äº†å¤æ‚åº¦å’Œè¿è¥æˆæœ¬ï¼Œæˆ‘ä»¬åœ¨æ•°æ®çš„å­˜å‚¨ä¸­ï¼Œå°½å¯é‡çš„å›å»é¿å…å¤æ‚ç»“æ„çš„æ•°æ®ç±»å‹ï¼Œè¿™æ ·ä¼šé™ä½å­˜å‚¨ç«¯å’Œè®¡ç®—ç«¯ä»£ç çš„å¤æ‚åº¦ã€‚è¿™ç¯‡æ–‡ç« æ˜¯é’ˆå¯¹Spark SQLçš„ä¼˜åŒ–æ–¹é¢ï¼Œå¯ä»¥è¯´åŸºæœ¬ä¸Šæ¯ä¸ªå¤§æ•°æ®å…¬å¸éƒ½ä¼šç”¨åˆ°Spark SQLï¼Œä¸Šè¿°çš„ä¼˜åŒ–æ–¹æ¡ˆè‚¯å®šä¼šå¸®åŠ©åˆ°æ›´å¤šçš„å¤§æ•°æ®å›¢é˜Ÿ ğŸ’ª","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"æ•°ä»“-è§„èŒƒ","slug":"æ•°ä»“-è§„èŒƒ","date":"2019-10-20T12:42:13.000Z","updated":"2020-08-04T12:44:04.462Z","comments":true,"path":"2019/10/20/æ•°ä»“-è§„èŒƒ/","link":"","permalink":"cpeixin.cn/2019/10/20/%E6%95%B0%E4%BB%93-%E8%A7%84%E8%8C%83/","excerpt":"","text":"æ¨¡å‹æ˜¯æ•´ä¸ªæ•°ä»“å»ºè®¾åŸºçŸ³ï¼Œè§„èŒƒæ˜¯æ•°ä»“å»ºè®¾çš„ä¿éšœã€‚ä¸ºäº†é¿å…å‡ºç°æŒ‡æ ‡é‡å¤å»ºè®¾å’Œæ•°æ®è´¨é‡å·®çš„æƒ…å†µï¼Œæˆ‘ä»¬ç»Ÿä¸€æŒ‰ç…§æœ€è¯¦ç»†ã€å¯è½åœ°çš„æ–¹æ³•è¿›è¡Œè§„èŒƒå»ºè®¾ã€‚(1) è¯æ ¹è¯æ ¹æ˜¯ç»´åº¦å’ŒæŒ‡æ ‡ç®¡ç†çš„åŸºç¡€ï¼Œåˆ’åˆ†ä¸ºæ™®é€šè¯æ ¹ä¸ä¸“æœ‰è¯æ ¹ï¼Œæé«˜è¯æ ¹çš„æ˜“ç”¨æ€§å’Œå…³è”æ€§ã€‚æ™®é€šè¯æ ¹ï¼šæè¿°äº‹ç‰©çš„æœ€å°å•å…ƒä½“ï¼Œå¦‚ï¼šäº¤æ˜“-tradeã€‚ä¸“æœ‰è¯æ ¹ï¼šå…·å¤‡çº¦å®šæˆä¿—æˆ–è¡Œä¸šä¸“å±çš„æè¿°ä½“ï¼Œå¦‚ï¼šç¾å…ƒ-USDã€‚(2) è¡¨å‘½åè§„èŒƒé€šç”¨è§„èŒƒè¡¨åã€å­—æ®µåé‡‡ç”¨ä¸€ä¸ªä¸‹åˆ’çº¿åˆ†éš”è¯æ ¹ï¼ˆç¤ºä¾‹ï¼šclienttype-&gt;client_typeï¼‰ã€‚æ¯éƒ¨åˆ†ä½¿ç”¨å°å†™è‹±æ–‡å•è¯ï¼Œå±äºé€šç”¨å­—æ®µçš„å¿…é¡»æ»¡è¶³é€šç”¨å­—æ®µä¿¡æ¯çš„å®šä¹‰ã€‚è¡¨åã€å­—æ®µåéœ€ä»¥å­—æ¯ä¸ºå¼€å¤´ã€‚è¡¨åã€å­—æ®µåæœ€é•¿ä¸è¶…è¿‡64ä¸ªè‹±æ–‡å­—ç¬¦ã€‚ä¼˜å…ˆä½¿ç”¨è¯æ ¹ä¸­å·²æœ‰å…³é”®å­—ï¼ˆæ•°ä»“æ ‡å‡†é…ç½®ä¸­çš„è¯æ ¹ç®¡ç†ï¼‰ï¼Œå®šæœŸReviewæ–°å¢å‘½åçš„ä¸åˆç†æ€§ã€‚åœ¨è¡¨åè‡ªå®šä¹‰éƒ¨åˆ†ç¦æ­¢é‡‡ç”¨éæ ‡å‡†çš„ç¼©å†™ã€‚è¡¨å‘½åè§„åˆ™è¡¨åç§° = ç±»å‹ + ä¸šåŠ¡ä¸»é¢˜ + å­ä¸»é¢˜ + è¡¨å«ä¹‰ + å­˜å‚¨æ ¼å¼ + æ›´æ–°é¢‘ç‡ +ç»“å°¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå›¾6 ç»Ÿä¸€çš„è¡¨å‘½åè§„èŒƒ(3) æŒ‡æ ‡å‘½åè§„èŒƒç»“åˆæŒ‡æ ‡çš„ç‰¹æ€§ä»¥åŠè¯æ ¹ç®¡ç†è§„èŒƒï¼Œå°†æŒ‡æ ‡è¿›è¡Œç»“æ„åŒ–å¤„ç†ã€‚A. åŸºç¡€æŒ‡æ ‡è¯æ ¹ï¼Œå³æ‰€æœ‰æŒ‡æ ‡å¿…é¡»åŒ…å«ä»¥ä¸‹åŸºç¡€è¯æ ¹ï¼šåŸºç¡€æŒ‡æ ‡è¯æ ¹è‹±æ–‡å…¨ç§°Hiveæ•°æ®ç±»å‹MySQLæ•°æ®ç±»å‹é•¿åº¦ç²¾åº¦è¯æ ¹æ ·ä¾‹æ•°é‡countBigintBigint100cnté‡‘é¢ç±»amoutDecimalDecimal204amtæ¯”ç‡/å æ¯”ratioDecimalDecimal104ratio0.9818â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦B.ä¸šåŠ¡ä¿®é¥°è¯ï¼Œç”¨äºæè¿°ä¸šåŠ¡åœºæ™¯çš„è¯æ±‡ï¼Œä¾‹å¦‚trade-äº¤æ˜“ã€‚C.æ—¥æœŸä¿®é¥°è¯ï¼Œç”¨äºä¿®é¥°ä¸šåŠ¡å‘ç”Ÿçš„æ—¶é—´åŒºé—´ã€‚æ—¥æœŸç±»å‹å…¨ç§°è¯æ ¹å¤‡æ³¨æ—¥dailydå‘¨weeklywâ€¦â€¦â€¦â€¦â€¦â€¦D.èšåˆä¿®é¥°è¯ï¼Œå¯¹ç»“æœè¿›è¡Œèšé›†æ“ä½œã€‚èšåˆç±»å‹å…¨ç§°è¯æ ¹å¤‡æ³¨å¹³å‡averageavgå‘¨ç´¯è®¡wtdwtdæœ¬å‘¨ä¸€æˆªæ­¢åˆ°å½“å¤©ç´¯è®¡â€¦â€¦â€¦â€¦â€¦â€¦E.åŸºç¡€æŒ‡æ ‡ï¼Œå•ä¸€çš„ä¸šåŠ¡ä¿®é¥°è¯+åŸºç¡€æŒ‡æ ‡è¯æ ¹æ„å»ºåŸºç¡€æŒ‡æ ‡ ï¼Œä¾‹å¦‚ï¼šäº¤æ˜“é‡‘é¢-trade_amtã€‚F.æ´¾ç”ŸæŒ‡æ ‡ï¼Œå¤šä¿®é¥°è¯+åŸºç¡€æŒ‡æ ‡è¯æ ¹æ„å»ºæ´¾ç”ŸæŒ‡æ ‡ã€‚æ´¾ç”ŸæŒ‡æ ‡ç»§æ‰¿åŸºç¡€æŒ‡æ ‡çš„ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼šå®‰è£…é—¨åº—æ•°é‡-install_poi_cntã€‚G.æ™®é€šæŒ‡æ ‡å‘½åè§„èŒƒï¼Œä¸å­—æ®µå‘½åè§„èŒƒä¸€è‡´ï¼Œç”±è¯æ±‡è½¬æ¢å³å¯ä»¥ã€‚å›¾7 æ™®é€šæŒ‡æ ‡è§„èŒƒH.æ—¥æœŸç±»å‹æŒ‡æ ‡å‘½åè§„èŒƒï¼Œå‘½åæ—¶è¦éµå¾ªï¼šä¸šåŠ¡ä¿®é¥°è¯+åŸºç¡€æŒ‡æ ‡è¯æ ¹+æ—¥æœŸä¿®é¥°è¯/èšåˆä¿®é¥°è¯ã€‚å°†æ—¥æœŸåç¼€åŠ åˆ°åç§°åé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå›¾8 æ—¥æœŸç±»å‹æŒ‡æ ‡è§„èŒƒI.èšåˆç±»å‹æŒ‡æ ‡ï¼Œå‘½åæ—¶è¦éµå¾ªï¼šä¸šåŠ¡ä¿®é¥°è¯+åŸºç¡€æŒ‡æ ‡è¯æ ¹+èšåˆç±»å‹+æ—¥æœŸä¿®é¥°è¯ã€‚å°†ç´¯ç§¯æ ‡è®°åŠ åˆ°åç§°åé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå›¾9 èšåˆç±»æŒ‡æ ‡è§„èŒƒ(4) æ¸…æ´—è§„èŒƒç¡®è®¤äº†å­—æ®µå‘½åå’ŒæŒ‡æ ‡å‘½åä¹‹åï¼Œæ ¹æ®æŒ‡æ ‡ä¸å­—æ®µçš„éƒ¨åˆ†ç‰¹æ€§ï¼Œæˆ‘ä»¬æ•´ç†å‡ºäº†æ•´ä¸ªæ•°ä»“å¯é¢„çŸ¥çš„24æ¡æ¸…æ´—è§„èŒƒï¼šæ•°æ®ç±»å‹æ•°æ®ç±»åˆ«Hiveç±»å‹MySQLç±»å‹é•¿åº¦ç²¾åº¦è¯æ ¹æ ¼å¼è¯´æ˜å¤‡æ³¨æ—¥æœŸç±»å‹å­—ç¬¦æ—¥æœŸç±»stringvarchar10dateYYYY-MM-DDæ—¥æœŸæ¸…æ´—ä¸ºç›¸åº”çš„æ ¼å¼æ•°æ®ç±»å‹æ•°é‡ç±»bigintbigint100cntæ´»è·ƒé—¨åº—æ•°é‡â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦åŒºåˆ†ä½¿ç”¨ TINYINTã€SMALLINTã€INTã€BIGINT æ•°æ®ç±»å‹,ï¼›å»ºè®®ä½¿ç”¨ TINYINT ä»£æ›¿ BOOLEAN, æé«˜æ‰©å±•æ€§å’Œç±»å‹è½¬æ¢å…¼å®¹æ€§ï¼›å°½é‡ä½¿ç”¨ä½å­˜å‚¨æ•°æ®ç±»å‹ä»¥æé«˜è¿è¡Œæ•ˆç‡ï¼›é‡‘é¢å­—æ®µç»Ÿä¸€ä½¿ç”¨DECIMALï¼Œæ—¶é—´å­—æ®µ(ç²¾ç¡®åˆ°ååˆ†ç§’)å­—æ®µç»Ÿä¸€ä½¿ç”¨TIMESTAMPä»¥æå‡æ¯”è¾ƒæ•ˆç‡ï¼Œ åˆ†åŒºå­—æ®µåŠæ—¥æœŸå­—æ®µï¼ˆæ²¡æœ‰æ—¶åˆ†ç§’ï¼‰ä½¿ç”¨ Stringï¼ˆæ ¼å¼ç»Ÿä¸€ä¸º yyyyMMddï¼‰ã€‚(4) ç¼–ç è§„èŒƒ1ã€ç¨‹åºä»£ç ï¼šæ¯å±‚ä¸€ä¸ªä»£ç ç›®å½•ï¼Œç”¨äºå­˜æ”¾å¯¹åº”å±‚çš„æ¨¡å‹å¼€å‘å·¥ç¨‹ã€‚2ã€HQLä»£ç ï¼š(1) ä½¿ç”¨ left semi join ä»£æ›¿ in/existsï¼›(2) join æ—¶å°è¡¨å°½é‡æ”¾åœ¨å·¦è¾¹ï¼Œå¦‚å°è¡¨è¶³å¤Ÿå°å¯ä½¿ç”¨ map joinï¼Œhive å·²æ”¯æŒè‡ªåŠ¨åˆ¤æ–­å¤§å°è¡¨ï¼›(3) æ’åºå°½é‡ä½¿ç”¨ distribute+sort ç»„åˆï¼Œé¿å…å…¨è¡¨ order byï¼›(4) å°½é‡ä½¿ç”¨é™æ€åˆ†åŒºï¼Œæå‡è¿è¡Œæ•ˆç‡ï¼›ä¾‹è¡Œè¡¥æ•°å»ºè®®ä½¿ç”¨åŠ¨æ€åˆ†åŒºç®€åŒ–ä»£ç ï¼›(5) æ…ç”¨ç¬›å¡å°”ç§¯ joinï¼Œå¡å†å²æ•°æ®å»ºè®®ä½¿ç”¨æ—¥æœŸç»´åº¦è¡¨ä½œç¬›å¡å°”ç§¯ï¼Œä»¥å¹¶è¡Œå¾ªç¯æ“ä½œï¼›(6) å°½é‡ä½¿ç”¨çª—å£å‡½æ•°ã€udf ç®€åŒ– sql é€»è¾‘ï¼Œæå‡ä»£ç å¯è¯»æ€§ï¼›(7) join/group by/distinct æ³¨æ„å¤„ç† NULL å€¼ï¼Œå°½é‡é¿å…æ•°æ®å€¾æ–œï¼›(8) union ä¼šå»é‡, ä¸ç”¨å»é‡æ—¶ä½¿ç”¨ union allï¼›(9) è¡¨æŸ¥è¯¢å¦‚æœæ˜¯åˆ†åŒºè¡¨, å°½é‡åŠ ä¸Šåˆ†åŒºé™åˆ¶ã€‚ç»“åˆæ¨¡å‹ä¸è§„èŒƒï¼Œå½¢æˆæ¨¡å‹è®¾è®¡åŠæ¨¡å‹è¯„å®¡ä¸¤è€…çš„å·¥ä½œèŒè´£ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå›¾10 æ¨¡å‹è®¾è®¡å’Œå®¡è®¡èŒè´£ç»Ÿä¸€åº”ç”¨å½’å£åœ¨å¯¹åŸæœ‰çš„åº”ç”¨æ”¯æŒæµç¨‹è¿›è¡Œæ¢³ç†çš„æ—¶å€™ï¼Œæˆ‘ä»¬å‘ç°æ•´ä¸ªç ”å‘è¿‡ç¨‹æ˜¯çƒŸå›±å¼ã€‚å¦‚æœä¸è¿›è¡Œæ”¹å–„å°±ä¼šå¯¼è‡´å‰é¢çš„å»ºè®¾â€æ¯äºä¸€æ—¦â€œï¼Œæ‰€ä»¥éœ€å¯¹åŸæœ‰åº”ç”¨æ”¯æŒæµç¨‹è¿›è¡Œæ”¹é€ ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå›¾11 åº”ç”¨å½’å£ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œé‡æ„å‰ä¸€ä¸ªåº”ç”¨å­˜åœ¨å¤šæ¬¡è¿­ä»£ï¼Œæ¯æ¬¡è¿­ä»£éƒ½å„è‡ªç»´æŠ¤è‡ªå·±çš„æ–‡æ¡£ã€‚çƒŸå›±å¼å¼€å‘ä¼šå¯¼è‡´ä¸šåŠ¡ä¿¡æ¯æ··ä¹±ã€åº”ç”¨æ— æ³•ä¸æ–‡æ¡£å¯¹é½ã€çŸ¥è¯†ä¼ é€’æˆæœ¬ã€ç»´æŠ¤æˆæœ¬å’Œè¿­ä»£æˆæœ¬å¤§å¤§å¢åŠ ç­‰é—®é¢˜ã€‚é‡æ„åï¼Œåº”ç”¨ä¸çŸ¥è¯†åº“ç›¸å¯¹åº”ï¼Œä¿è¯ä¸€ä¸ªåº”ç”¨åªå¯¹åº”ä¸€ä»½æ–‡æ¡£ï¼Œä¸”åº”ç”¨ç»Ÿä¸€è¦æ±‚åœ¨ä¸€ä»½æ–‡æ¡£ä¸Šè¿›è¡Œè¿­ä»£ï¼Œä»æ ¹æºä¸Šæ”¹å˜åº”ç”¨æ”¯æŒæµç¨‹ã€‚åŒæ—¶ï¼Œé’ˆå¯¹æ ¸å¿ƒä¸šåŠ¡ç»†èŠ‚å’Œæ‰€æ”¯æ’‘çš„æ•°æ®ä¿¡æ¯ï¼Œè¿›è¡Œäº†å…¨å±€è°ƒç ”å¹¶å½’çº³åˆ°çŸ¥è¯†åº“ã€‚ç»¼åˆç»Ÿä¸€çš„çŸ¥è¯†åº“ï¼Œé™ä½äº†çŸ¥è¯†ä¼ é€’ã€ç†è§£ã€ç»´æŠ¤å’Œè¿­ä»£æˆæœ¬ã€‚ç»Ÿä¸€å½’å£ç­–ç•¥åŒ…å«ä¸šåŠ¡å½’å£ç»Ÿä¸€ã€è®¾è®¡å½’å£ç»Ÿä¸€å’Œåº”ç”¨å½’å£ç»Ÿä¸€ï¼Œä»åº•å±‚ä¿è¯äº†æ•°ä»“å»ºè®¾çš„ä¸‰ç‰¹æ€§å’Œä¸‰æ•ˆæœã€‚ç»Ÿä¸€æ•°æ®å‡ºå£æ•°ä»“å»ºè®¾ä¸ä»…ä»…æ˜¯ä¸ºäº†æ•°æ®å†…å®¹è€Œå»ºè®¾ï¼ŒåŒæ—¶ä¹Ÿä¸ºäº†æé«˜äº¤ä»˜çš„æ•°æ®è´¨é‡ä¸æ•°æ®ä½¿ç”¨çš„ä¾¿åˆ©æ€§ã€‚å¦‚ä½•ä¿è¯æ•°æ®è´¨é‡ä»¥åŠæ¨å¹¿æ•°æ®çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬æå‡ºäº†ç»Ÿä¸€æ•°æ®å‡ºå£ç­–ç•¥ã€‚åœ¨è¿›è¡Œæ•°æ®èµ„äº§ç®¡ç†å’Œç»Ÿä¸€æ•°æ®å‡ºå£ä¹‹å‰ï¼Œå¿…é¡»é«˜è´¨é‡åœ°ä¿éšœè¾“å‡ºçš„æ•°æ®è´¨é‡ï¼Œä»è€Œæ ‘ç«‹OneDataæ•°æ®æœåŠ¡ä½“ç³»çš„æƒå¨æ€§ã€‚1.äº¤ä»˜æ ‡å‡†åŒ–å¦‚ä½•ä¿è¯æ•°æ®è´¨é‡ï¼Œæ»¡è¶³ä»€ä¹ˆæ ·çš„æ•°æ®æ‰æ˜¯å¯äº¤ä»˜çš„ï¼Œæ˜¯æ•°æ®å»ºè®¾è€…ä¸€ç›´æ¢ç´¢çš„é—®é¢˜ã€‚ä¸ºäº†ä¿è¯äº¤ä»˜çš„ä¸¥è°¨æ€§ï¼Œåœ¨å…·ä½“åŒ–æµ‹è¯•æ–¹æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬ç»“åˆæ•°ä»“çš„ç‰¹ç‚¹æ˜ç¡®äº†æ•°æ®äº¤ä»˜æ ‡å‡†çš„äº”ä¸ªç‰¹æ€§ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå›¾12 äº¤ä»˜æ ‡å‡†åŒ–ã€Šäº¤ä»˜æ ‡å‡†åŒ–ã€‹å®Œå–„äº†æ•´ä¸ªäº¤ä»˜ç»†èŠ‚ï¼Œä»æ ¹æœ¬ä¸Šä¿è¯äº†æ•°æ®çš„è´¨é‡ï¼Œå¦‚ï¼šä¸šåŠ¡æµ‹è¯•ä¿éšœæ•°æ®çš„åˆç†æ€§ã€ä¸€è‡´æ€§ï¼›æŠ€æœ¯æµ‹è¯•ä¿éšœæ•°æ®çš„å”¯ä¸€æ€§ã€å‡†ç¡®æ€§ï¼›æ•°æ®å¹³å°çš„ç¨³å®šæ€§å’ŒåæœŸäººå·¥ç»´æŠ¤ä¿éšœæ•°æ®çš„åŠæ—¶æ€§ã€‚2.æ•°æ®èµ„äº§ç®¡ç†é’ˆå¯¹å¦‚ä½•è§£å†³æ•°æ®è´¨é‡ä¸­ç»´åº¦ä¸æŒ‡æ ‡ä¸€è‡´æ€§ä»¥åŠå¦‚ä½•æé«˜æ•°æ®æ˜“ç”¨æ€§çš„é—®é¢˜ï¼Œæˆ‘ä»¬æå‡ºæ•°æ®èµ„äº§çš„æ¦‚å¿µï¼Œå€ŸåŠ©å…¬å¸å†…éƒ¨å¹³å°å·¥å…·â€œèµ·æºæ•°æ®å¹³å°â€å®ç°äº†æ•´ä¸ªæ•°æ®èµ„äº§ç®¡ç†ï¼Œå®ƒçš„åŠŸèƒ½å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå›¾13 èµ·æºåŠŸèƒ½ä½“ç³»å€Ÿç”¨èµ·æºæ•°æ®å¹³å°ï¼Œæˆ‘ä»¬å®ç°äº†ï¼šç»Ÿä¸€æŒ‡æ ‡ç®¡ç†ï¼Œä¿è¯äº†æŒ‡æ ‡å®šä¹‰ã€è®¡ç®—å£å¾„ã€æ•°æ®æ¥æºçš„ä¸€è‡´æ€§ã€‚ç»Ÿä¸€ç»´åº¦ç®¡ç†ï¼Œä¿è¯äº†ç»´åº¦å®šä¹‰ã€ç»´åº¦å€¼çš„ä¸€è‡´æ€§ã€‚ç»Ÿä¸€æ•°æ®å‡ºå£ï¼Œå®ç°äº†ç»´åº¦å’ŒæŒ‡æ ‡å…ƒæ•°æ®ä¿¡æ¯çš„å”¯ä¸€å‡ºå£ï¼Œç»´å€¼å’ŒæŒ‡æ ‡æ•°æ®çš„å”¯ä¸€å‡ºå£ã€‚é€šè¿‡äº¤ä»˜æ ‡å‡†åŒ–å’Œæ•°æ®èµ„äº§ç®¡ç†ï¼Œä¿è¯äº†æ•°æ®è´¨é‡ä¸æ•°æ®çš„æ˜“ç”¨æ€§ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿæ„å»ºå‡ºOneDataæ•°æ®ä½“ç³»ä¸­æ•°æ®æŒ‡æ ‡ç®¡ç†çš„æ ¸å¿ƒã€‚è½¬è½½è‡ª https://tech.meituan.com/2019/10/17/meituan-saas-data-warehouse.htmlçœŸå¿ƒæ„Ÿè§‰ç¾å›¢æŠ€æœ¯å›¢é˜ŸğŸ‚ğŸº","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"æ•°æ®ä»“åº“","slug":"æ•°æ®ä»“åº“","permalink":"cpeixin.cn/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"}]},{"title":"Hive çª—å£å‡½æ•°","slug":"Hive-çª—å£å‡½æ•°","date":"2019-10-05T00:22:52.000Z","updated":"2020-08-26T07:58:15.731Z","comments":true,"path":"2019/10/05/Hive-çª—å£å‡½æ•°/","link":"","permalink":"cpeixin.cn/2019/10/05/Hive-%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0/","excerpt":"","text":"ç®€ä»‹æœ¬æ–‡ä¸»è¦ä»‹ç»hiveä¸­çš„çª—å£å‡½æ•°ï¼Œhiveä¸­çš„çª—å£å‡½æ•°å’Œsqlä¸­çš„çª—å£å‡½æ•°ç›¸ç±»ä¼¼,éƒ½æ˜¯ç”¨æ¥åšä¸€äº›æ•°æ®åˆ†æç±»çš„å·¥ä½œ,ä¸€èˆ¬ç”¨äºOLAPåˆ†æï¼ˆåœ¨çº¿åˆ†æå¤„ç†ï¼‰ã€‚æ¦‚å¿µçª—å£å‡½æ•°æ˜¯ç”¨äºåˆ†æç”¨çš„ä¸€ç±»å‡½æ•°ï¼Œè¦ç†è§£çª—å£å‡½æ•°è¦å…ˆä»èšåˆå‡½æ•°è¯´èµ·ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“åœ¨sqlä¸­æœ‰ä¸€ç±»å‡½æ•°å«åšèšåˆå‡½æ•°,ä¾‹å¦‚sum()ã€avg()ã€max()ç­‰ç­‰,è¿™ç±»å‡½æ•°å¯ä»¥å°†å¤šè¡Œæ•°æ®æŒ‰ç…§è§„åˆ™èšé›†ä¸ºä¸€è¡Œï¼Œä¸€èˆ¬æ¥è®²èšé›†åçš„è¡Œæ•°æ˜¯è¦å°‘äºèšé›†å‰çš„è¡Œæ•°çš„.ä½†æ˜¯æœ‰æ—¶æˆ‘ä»¬æƒ³è¦æ—¢æ˜¾ç¤ºèšé›†å‰çš„æ•°æ®,åˆè¦æ˜¾ç¤ºèšé›†åçš„æ•°æ®,è¿™æ—¶æˆ‘ä»¬ä¾¿å¼•å…¥äº†çª—å£å‡½æ•°ã€‚çª—å£å‡½æ•°å¯ä»¥åœ¨æœ¬è¡Œå†…åšè¿ç®—ï¼Œå¾—åˆ°å¤šè¡Œçš„ç»“æœï¼Œå³æ¯ä¸€è¡Œå¯¹åº”ä¸€è¡Œçš„å€¼ã€‚ é€šç”¨çš„çª—å£å‡½æ•°å¯ä»¥ç”¨ä¸‹é¢çš„è¯­æ³•æ¥æ¦‚æ‹¬ï¼š1Function() Over (Partition By Column1ï¼ŒColumn2ï¼ŒOrder By Column3)çª—å£å‡½æ•°åˆåˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼šèšåˆå‹çª—å£å‡½æ•°åˆ†æå‹çª—å£å‡½æ•°å–å€¼å‹çª—å£å‡½æ•°over()å­å¥æˆ‘ä»¬å¯ä»¥å½¢è±¡çš„æŠŠover()å­å¥ç†è§£æˆå¼€çª—å­å¥ï¼Œå³æ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œçª—å£å†…åŒ…å«å¤šæ¡è®°å½•ï¼Œover()ä¼šç»™æ¯ä¸€è¡Œå¼€ä¸€ä¸ªçª—å£ã€‚å¦‚ä¸‹å›¾ï¼Œæ€»å…±æœ‰5æ¡è®°å½•ï¼Œæ¯ä¸€è¡Œä»£è¡¨ä¸€æ¡è®°å½•ï¼Œover()åœ¨æ¯ä¸€æ¡è®°å½•çš„åŸºç¡€ä¸Šæ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œç»™r1è®°å½•æ‰“å¼€w1çª—å£ï¼Œçª—å£å†…åªåŒ…å«è‡ªå·±ï¼Œç»™r2æ‰“å¼€w2çª—å£ï¼Œçª—å£å†…åŒ…å«r1ã€r2ï¼Œç»™r3æ‰“å¼€w3çª—å£ï¼Œçª—å£å†…åŒ…å«r1ã€r2ã€r3ï¼Œä»¥æ­¤ç±»æ¨â€¦..over()å­å¥çš„å¼€çª—èŒƒå›´å…ˆçœ‹ä¸€å¼ å›¾ï¼šcurrent rowä»£è¡¨æŸ¥è¯¢çš„å½“å‰è¡Œï¼Œ1 precedingä»£è¡¨å‰ä¸€è¡Œï¼Œ1 followingä»£è¡¨åä¸€è¡Œï¼Œunbounded precedingä»£è¡¨ç¬¬ä¸€è¡Œï¼Œunbounded followingä»£è¡¨æœ€åä¸€è¡Œã€‚ï¼ˆæ³¨æ„è¿™é‡Œçš„ç¬¬ä¸€è¡Œå’Œæœ€åä¸€è¡Œå¹¶ä¸æ˜¯ä¸¥æ ¼çš„ç¬¬ä¸€è¡Œå’Œæœ€åä¸€è¡Œï¼Œæ ¹æ®å…·ä½“æƒ…å†µè€Œå®šï¼‰ç”±ä¸Šæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œåœ¨ä½¿ç”¨over()å­å¥è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œ ä¸ä»…å¯ä»¥æŸ¥è¯¢åˆ°æ¯æ¡è®°å½•çš„ä¿¡æ¯ï¼Œè¿˜å¯ä»¥æŸ¥è¯¢åˆ°è¿™æ¡è®°å½•å¯¹åº”çª—å£å†…çš„æ‰€æœ‰è®°å½•çš„èšåˆä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸ç»“åˆèšåˆå‡½æ•°å’Œover()å­å¥ä¸€èµ·ä½¿ç”¨ã€‚é‚£ä¹ˆover()æ˜¯å¦‚ä½•è¿›è¡Œå¼€çª—çš„å‘¢ï¼Ÿå³æ¯æ¡è®°å½•å¯¹åº”çš„çª—å£å†…åº”è¯¥åŒ…å«å“ªäº›è®°å½•å‘¢ï¼Ÿè¿™äº›éƒ½æ˜¯åœ¨over()å­å¥çš„æ‹¬å·å†…è¿›è¡Œå®šä¹‰ã€‚order byå¦‚æœover()å­å¥ä¸­æ¥order byï¼Œä¾‹å¦‚ï¼šover(order by date)ï¼Œåˆ™é»˜è®¤çš„å¼€çª—èŒƒå›´ä¸ºæ ¹æ®dateæ’åºåçš„rows between unbounded preceding and current rowï¼Œå³ç¬¬ä¸€è¡Œåˆ°å½“å‰è¡Œï¼Œæ„æ€æ˜¯over(order by date)å’Œover(order by date rows rows between unbounded preceding and current row)çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚partition byå¦‚æœoverå­å¥ä¸­æ¥partition byï¼ˆå’Œgroup byç±»ä¼¼ï¼Œéƒ½æ˜¯æ ¹æ®åˆ—å€¼å¯¹è¡Œè¿›è¡Œåˆ†ç»„ï¼‰ï¼Œä¾‹å¦‚over(partition by month(date))ï¼Œåˆ™æ¯ä¸€è¡Œçš„é»˜è®¤çš„å¼€çª—èŒƒå›´ä¸ºå½“å‰è¡Œæ‰€åœ¨åˆ†ç»„çš„æ‰€æœ‰è®°å½•ã€‚æ³¨æ„partition byå­å¥ä¸èƒ½å•ç‹¬å’Œwindow clauseå­å¥ä¸€èµ·ä½¿ç”¨ï¼Œå¿…é¡»ç»“åˆorder byå­å¥ï¼Œä¸‹é¢ä¼šè®¨è®ºã€‚partition by + order byå…ˆåˆ†ç»„ï¼Œå†æ’åºï¼Œå³ç»„å†…æ’åºã€‚åŒæ ·çš„ï¼Œå¦‚æœ order byåä¸æ¥window clauseï¼Œåˆ™æ¯ä¸€è¡Œçš„é»˜è®¤çš„å¼€çª—èŒƒå›´ä¸ºï¼šå½“å‰è¡Œæ‰€åœ¨åˆ†ç»„çš„ç¬¬ä¸€è¡Œåˆ°å½“å‰è¡Œï¼Œå³over(partition by (month(date)) order by orderdate)å’Œover(partition by (month(date)) order by orderdate rows between undounded preceding and current row)æ˜¯ä¸€æ ·çš„ã€‚çª—å£å¤§å°over()å­å¥çš„å¼€çª—èŒƒå›´å¯ä»¥é€šè¿‡window å­å¥ï¼ˆwindow clauseï¼‰åœ¨over()çš„æ‹¬å·ä¸­å®šä¹‰ï¼Œwindow clauseçš„è§„èŒƒå¦‚ä¸‹ï¼š123456789101112(ROWS | RANGE) BETWEEN (UNBOUNDED | [num]) PRECEDING AND ([num] PRECEDING | CURRENT ROW | (UNBOUNDED | [num]) FOLLOWING)(ROWS | RANGE) BETWEEN CURRENT ROW AND (CURRENT ROW | (UNBOUNDED | [num]) FOLLOWING)(ROWS | RANGE) BETWEEN [num] FOLLOWING AND (UNBOUNDED | [num]) FOLLOWINGpartition by â€¦order byâ€¦rows between unbounded preceding and current rowçª—å£å¤§å°ä¸ºä»èµ·å§‹è¡Œå¾—åˆ°å½“å‰è¡Œã€‚partition by â€¦order byâ€¦ rows between 3 preceding and current rowçª—å£å¤§å°ä¸ºä»å½“å‰è¡Œåˆ°ä¹‹å‰ä¸‰è¡Œpartition by â€¦order byâ€¦ rows between 3 preceding and 1 followingçª—å£å¤§å°ä¸ºå½“å‰è¡Œçš„å‰ä¸‰è¡Œåˆ°ä¹‹åçš„ä¸€è¡Œpartition by â€¦order byâ€¦ rows between 3 preceding and unbounded followingçª—å£å¤§å°ä¸ºå½“å‰è¡Œçš„å‰ä¸‰è¡Œåˆ°ä¹‹åçš„æ‰€æœ‰è¡Œä¾‹å¦‚ select ,sum(column_name) over( rows between unbounded preceding and unbounded following) from table_name è¡¨ç¤ºæŸ¥è¯¢æ¯ä¸€è¡Œçš„æ‰€æœ‰åˆ—å€¼ï¼ŒåŒæ—¶ç»™æ¯ä¸€è¡Œæ‰“å¼€ä¸€ä¸ªä»ç¬¬ä¸€è¡Œåˆ°æœ€åä¸€è¡Œçš„çª—å£ï¼Œå¹¶ç»Ÿè®¡çª—å£å†…æ‰€æœ‰è®°å½•çš„column_nameåˆ—å€¼çš„å’Œã€‚æœ€åç»™æ¯ä¸€è¡Œè¾“å‡ºè¯¥è¡Œçš„æ‰€æœ‰å±æ€§ä»¥åŠè¯¥è¡Œå¯¹åº”çª—å£å†…è®°å½•çš„èšåˆå€¼ã€‚å¦‚æœover()å­å¥ä¸­ä»€ä¹ˆéƒ½ä¸å†™çš„è¯ï¼Œé»˜è®¤å¼€çª—èŒƒå›´æ˜¯ï¼šrows between unbounded preceding and unbounded following*åœ¨æ·±å…¥ç ”ç©¶Overå­å¥ä¹‹å‰ï¼Œä¸€å®šè¦æ³¨æ„ï¼šåœ¨SQLå¤„ç†ä¸­ï¼Œçª—å£å‡½æ•°éƒ½æ˜¯æœ€åä¸€æ­¥æ‰§è¡Œï¼Œè€Œä¸”ä»…ä½äºOrder byå­—å¥ä¹‹å‰ã€‚å®è·µå‡†å¤‡åˆ›å»ºHiveè¡¨12345CREATE TABLE user_match_temp (user_name string,opponent string,result int,create_time timestamp);æ•°æ®é‡è¾ƒå°‘ï¼Œå°±ç›´æ¥æ‰‹åŠ¨æ’å…¥äº†123456789INSERT INTO TABLE user_match_temp values(&#39;A&#39;,&#39;B&#39;,1,&#39;2019-07-18 23:19:00&#39;),(&#39;B&#39;,&#39;A&#39;,0,&#39;2019-07-18 23:19:00&#39;),(&#39;A&#39;,&#39;C&#39;,0,&#39;2019-07-18 23:20:00&#39;),(&#39;C&#39;,&#39;A&#39;,1,&#39;2019-07-18 23:20:00&#39;),(&#39;A&#39;,&#39;D&#39;,1,&#39;2019-07-19 22:19:00&#39;),(&#39;D&#39;,&#39;A&#39;,0,&#39;2019-07-19 22:19:00&#39;),(&#39;C&#39;,&#39;B&#39;,0,&#39;2019-07-19 23:19:00&#39;),(&#39;B&#39;,&#39;C&#39;,1,&#39;2019-07-19 23:19:00&#39;);æ•°æ®åŒ…å«4åˆ—ï¼Œåˆ†åˆ«ä¸º user_nameï¼Œopponentï¼Œresultï¼Œcreate_timeã€‚ æˆ‘ä»¬å°†åŸºäºè¿™äº›æ•°æ®æ¥ä»‹ç»ä¸‹çª—å£å‡½æ•°çš„ä¸€äº›ä½¿ç”¨åœºæ™¯ã€‚åŸå§‹æ•°æ®**user_name opponent result create_timeA B 1 2019-07-18 23:19:00B A 0 2019-07-18 23:19:00A C 0 2019-07-18 23:20:00C A 1 2019-07-18 23:20:00A D 1 2019-07-19 22:19:00D A 0 2019-07-19 22:19:00C B 0 2019-07-19 23:19:00B C 1 2019-07-19 23:19:00èšåˆå‹çª—å£å‡½æ•°èšåˆå‹å³SUM(), MIN(),MAX(),AVG(),COUNT()è¿™äº›å¸¸è§çš„èšåˆå‡½æ•°ã€‚ èšåˆå‡½æ•°é…åˆçª—å£å‡½æ•°ä½¿ç”¨å¯ä»¥ä½¿è®¡ç®—æ›´åŠ çµæ´»ï¼Œä¾‹å¦‚ä»¥ä¸‹åœºæ™¯ï¼šè‡³ä»Šç´¯è®¡åˆ†æ•°1234567891011select *, sum(result) over(partition by user_name order by create_time) result_sum from user_match_temp;user_name opponent result create_time result_sumA B 1 2019-07-18 23:19:00 1A C 0 2019-07-18 23:20:00 1A D 1 2019-07-19 22:19:00 2B A 0 2019-07-18 23:19:00 0B C 1 2019-07-19 23:19:00 1C A 1 2019-07-18 23:20:00 1C B 0 2019-07-19 23:19:00 1D A 0 2019-07-19 22:19:00 0ä¹‹å‰3åœºå¹³å‡èƒœåœº1234567891011hive (test)&gt; SELECT *,avg(result) over (partition by user_name order by create_time rows between 3 preceding and current row) as recently_wins from user_match_temp;user_match_temp.user_name user_match_temp.opponent user_match_temp.result user_match_temp.create_time recently_winsA B 1 2019-07-18 23:19:00 1.0A C 0 2019-07-18 23:20:00 0.5A D 1 2019-07-19 22:19:00 0.6666666666666666B A 0 2019-07-18 23:19:00 0.0B C 1 2019-07-19 23:19:00 0.5C A 1 2019-07-18 23:20:00 1.0C B 0 2019-07-19 23:19:00 0.5D A 0 2019-07-19 22:19:00 0.0æˆ‘ä»¬é€šè¿‡rows between å³å¯å®šä¹‰çª—å£çš„èŒƒå›´ï¼Œè¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†çª—å£çš„èŒƒå›´ä¸ºä¹‹å‰3è¡Œåˆ°è¯¥è¡Œã€‚ç´¯è®¡é‡åˆ°çš„å¯¹æ‰‹æ•°é‡éœ€è¦æ³¨æ„çš„æ˜¯count(distinct xxx)åœ¨çª—å£å‡½æ•°é‡Œæ˜¯ä¸å…è®¸ä½¿ç”¨çš„ï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨size(collect_set() over(partition by order by))æ¥æ›¿ä»£å®ç°æˆ‘ä»¬çš„éœ€æ±‚1234567891011hive (test)&gt; SELECT *,size(collect_set(opponent) over (partition by user_name order by create_time)) as recently_wins from user_match_temp;user_match_temp.user_name user_match_temp.opponent user_match_temp.result user_match_temp.create_time recently_winsA B 1 2019-07-18 23:19:00 1A C 0 2019-07-18 23:20:00 2A D 1 2019-07-19 22:19:00 3B A 0 2019-07-18 23:19:00 1B C 1 2019-07-19 23:19:00 2C A 1 2019-07-18 23:20:00 1C B 0 2019-07-19 23:19:00 2D A 0 2019-07-19 22:19:00 1collect_set()ä¹Ÿæ˜¯ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œä½œç”¨æ˜¯å°†å¤šè¡Œèšåˆè¿›ä¸€è¡Œçš„æŸä¸ªsetå†…ï¼Œå†ç”¨size()ç»Ÿè®¡é›†åˆå†…çš„å…ƒç´ ä¸ªæ•°ï¼Œå³å¯å®ç°æˆ‘ä»¬çš„éœ€æ±‚ã€‚åˆ†æå‹çª—å£å‡½æ•°åˆ†æå‹å³RANk(),ROW_NUMBER(),DENSE_RANK()ç­‰å¸¸è§çš„æ’åºç”¨çš„çª—å£å‡½æ•°ï¼Œä¸è¿‡ä»–ä»¬ä¹Ÿæ˜¯æœ‰åŒºåˆ«çš„ã€‚æ’åå‡½æ•°ä¸æ”¯æŒwindowå­å¥ï¼Œå³ä¸æ”¯æŒè‡ªå®šä¹‰çª—å£å¤§å°**1234567891011hive (test)&gt; SELECT *,rank() over (order by create_time) as user_rank,row_number() over (order by create_time) as user_row_number,dense_rank() over (order by create_time) as user_dense_rank FROM user_match_temp;user_name opponent result create_time user_rank user_row_number user_dense_rankB A 0 2019-07-18 23:19:00 1 1 1A B 1 2019-07-18 23:19:00 1 2 1C A 1 2019-07-18 23:20:00 3 3 2A C 0 2019-07-18 23:20:00 3 4 2D A 0 2019-07-19 22:19:00 5 5 3A D 1 2019-07-19 22:19:00 5 6 3B C 1 2019-07-19 23:19:00 7 7 4C B 0 2019-07-19 23:19:00 7 8 4å¦‚ä¸Šæ‰€ç¤ºï¼š row_numberå‡½æ•°ï¼šç”Ÿæˆè¿ç»­çš„åºå·ï¼ˆç›¸åŒå…ƒç´ åºå·ç›¸åŒï¼‰ï¼›rankå‡½æ•°ï¼šå¦‚ä¸¤å…ƒç´ æ’åºç›¸åŒåˆ™åºå·ç›¸åŒï¼Œå¹¶ä¸”ä¼šè·³è¿‡ä¸‹ä¸€ä¸ªåºå·ï¼›dense_rankå‡½æ•°ï¼šå¦‚ä¸¤å…ƒç´ æ’åºç›¸åŒåˆ™åºå·ç›¸åŒï¼Œä¸ä¼šè·³è¿‡ä¸‹ä¸€ä¸ªåºå·ï¼›é™¤äº†è¿™ä¸‰ä¸ªæ’åºç”¨çš„å‡½æ•°ï¼Œè¿˜æœ‰ _CUME_DISTå‡½æ•° ï¼šå°äºç­‰äºå½“å‰å€¼çš„è¡Œåœ¨æ‰€æœ‰è¡Œä¸­çš„å æ¯” _PERCENT_RANK() ï¼šå°äºå½“å‰å€¼çš„è¡Œåœ¨æ‰€æœ‰è¡Œä¸­çš„å æ¯” * NTILE() ï¼šå¦‚æœæŠŠæ•°æ®æŒ‰è¡Œæ•°åˆ†ä¸ºnä»½ï¼Œé‚£ä¹ˆè¯¥è¡Œæ‰€å±çš„ä»½æ•°æ˜¯ç¬¬å‡ ä»½ è¿™ä¸‰ç§çª—å£å‡½æ•° sqlå¦‚ä¸‹ï¼š1SELECT *, CUME_DIST() over (order by create_time) as user_CUME_DIST, PERCENT_RANK() over (order by create_time) as user_PERCENT_RANK, NTILE(3) over (order by create_time) as user_NTILE FROM user_match_temp; ## å–å€¼å‹çª—å£å‡½æ•° è¿™å‡ ä¸ªå‡½æ•°å¯ä»¥é€šè¿‡å­—é¢æ„æ€è®°å¾—ï¼ŒLAGæ˜¯è¿Ÿæ»çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯å¯¹æŸä¸€åˆ—è¿›è¡Œå¾€åé”™è¡Œï¼›LEADæ˜¯LAGçš„åä¹‰è¯ï¼Œä¹Ÿå°±æ˜¯å¯¹æŸä¸€åˆ—è¿›è¡Œæå‰å‡ è¡Œï¼›FIRST_VALUEæ˜¯å¯¹è¯¥åˆ—åˆ°ç›®å‰ä¸ºæ­¢çš„é¦–ä¸ªå€¼ï¼Œè€ŒLAST_VALUEæ˜¯åˆ°ç›®å‰è¡Œä¸ºæ­¢çš„æœ€åä¸€ä¸ªå€¼ã€‚LAG()å’ŒLEAD() å¯ä»¥å¸¦3ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯è¿”å›çš„å€¼ï¼Œç¬¬äºŒä¸ªæ˜¯å‰ç½®æˆ–è€…åç½®çš„è¡Œæ•°ï¼Œç¬¬ä¸‰ä¸ªæ˜¯é»˜è®¤å€¼ã€‚ä¸‹ä¸€ä¸ªå¯¹æ‰‹ï¼Œä¸Šä¸€ä¸ªå¯¹æ‰‹ï¼Œæœ€è¿‘3å±€çš„ç¬¬ä¸€ä¸ªå¯¹æ‰‹åŠæœ€åä¸€ä¸ªå¯¹æ‰‹ï¼Œå¦‚ä¸‹ï¼š12345678hive&gt; SELECT *,hive&gt; lag(opponent,1) hive&gt; over (partition by user_name order by create_time) as lag_opponent,hive&gt; lead(opponent,1) over hive&gt; (partition by user_name order by create_time) as lead_opponent,hive&gt; first_value(opponent) over (partition by user_name order by create_time rows hive&gt; between 3 preceding and 3 following) as first_opponent,hive&gt; last_value(opponent) over (partition by user_name order by create_time rows hive&gt; between 3 preceding and 3 following) as last_opponenthive&gt; From user_match_temp;å‚è€ƒæ–‡ç« ï¼š[https://blog.csdn.net/czr11616/article/details/101645693](https://blog.csdn.net/czr11616/article/details/101645693)[https://zhuanlan.zhihu.com/p/77705681](https://zhuanlan.zhihu.com/p/77705681)[https://blog.csdn.net/qq_37296285/article/details/90940591](https://blog.csdn.net/qq_37296285/article/details/90940591)","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"hive","slug":"hive","permalink":"cpeixin.cn/tags/hive/"}]},{"title":"æˆ‘çš„æœåŠ¡å™¨è¢«é»‘äº†ï¼ˆäºŒï¼‰","slug":"æˆ‘çš„æœåŠ¡å™¨è¢«é»‘äº†ï¼ˆäºŒï¼‰","date":"2019-09-09T02:26:15.000Z","updated":"2020-04-04T12:00:14.168Z","comments":true,"path":"2019/09/09/æˆ‘çš„æœåŠ¡å™¨è¢«é»‘äº†ï¼ˆäºŒï¼‰/","link":"","permalink":"cpeixin.cn/2019/09/09/%E6%88%91%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E9%BB%91%E4%BA%86%EF%BC%88%E4%BA%8C%EF%BC%89/","excerpt":"","text":"è‹¦é€¼çš„å‘¨ä¸€å¼€å§‹äº†ï¼Œè‹¦é€¼çš„å·¥ä½œå¼€å§‹äº†ï¼Œååˆ°å·¥ä½ä¸Šï¼Œä¸Šç­æ°”æ­£åœ¨é€æ¸çš„å‡å¼±ï¼Œä½†æ˜¯å½“æˆ‘å‘ç°ï¼Œæˆ‘çš„ä¸‰å°æœåŠ¡å™¨åˆè¢«é‚£äº›æ— æƒ…çš„å°é»‘äººä»¬ç›¯ä¸Šäº†çš„æ—¶å€™ï¼Œæˆ‘çš„æ€’æ°”å€¼è¾¾åˆ°äº†é¡¶ç‚¹ï¼ŒåŒæ—¶è¿˜æ„Ÿè§‰æœ‰ç‚¹ä¸¢è„¸ï¼Œå“ˆå“ˆå“ˆã€‚ç”±äºè¿™ä¸‰å°æœåŠ¡å™¨å±äºæˆ‘ä¸ªäººçš„ï¼Œæ²¡æœ‰ç»è¿‡è¿ç»´å…„å¼Ÿçš„ç…§é¡¾ï¼Œæ‰€ä»¥åœ¨å®‰å…¨æ–¹é¢ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰é˜²æŠ¤ã€‚è¿™æ¬¡æ˜¯æ€ä¹ˆå‘ç°çš„å‘¢ï¼Œæ˜¯å› ä¸ºæˆ‘æœåŠ¡å™¨ä¸Šçš„çˆ¬è™«çªç„¶åœæ­¢äº†ï¼Œæˆ‘å¸¦ç€ç–‘é—®å»çœ‹äº†ä¸‹ç³»ç»Ÿæ—¥å¿—ã€‚äºæ˜¯æ•²ä¸‹äº†ä¸‹é¢çš„å‘½ä»¤1journalctl -xeæ˜ å…¥çœ¼å¸˜çš„æ˜¯æ»¡å±çš„æ‰«æå’Œsshå°è¯•ç™»é™†1234567891011121314151617181920212223242526272829303132333435363738394041424344Sep 09 11:02:50 4Z-J16-A47 sshd[303]: Failed password for invalid user admin from 117.132.175.25 port 42972 ssh2Sep 09 11:02:50 4Z-J16-A47 sshd[303]: Received disconnect from 117.132.175.25 port 42972:11: Bye Bye [preauth]Sep 09 11:02:50 4Z-J16-A47 sshd[303]: Disconnected from 117.132.175.25 port 42972 [preauth]Sep 09 11:02:50 4Z-J16-A47 sshd[65525]: Failed password for root from 49.88.112.54 port 24184 ssh2Sep 09 11:02:50 4Z-J16-A47 sshd[302]: Failed password for invalid user ansible from 149.56.96.78 port 44980 ssh2Sep 09 11:02:50 4Z-J16-A47 sshd[302]: Received disconnect from 149.56.96.78 port 44980:11: Bye Bye [preauth]Sep 09 11:02:50 4Z-J16-A47 sshd[302]: Disconnected from 149.56.96.78 port 44980 [preauth]Sep 09 11:02:50 4Z-J16-A47 sshd[65525]: pam_succeed_if(sshd:auth): requirement \"uid &gt;= 1000\" not met by user \"root\"Sep 09 11:02:51 4Z-J16-A47 sshd[65522]: Failed password for root from 218.92.0.163 port 45157 ssh2Sep 09 11:02:51 4Z-J16-A47 sshd[65522]: error: maximum authentication attempts exceeded for root from 218.92.0.163 port 45157 ssh2 [preauth]Sep 09 11:02:51 4Z-J16-A47 sshd[65522]: Disconnecting: Too many authentication failures [preauth]Sep 09 11:02:51 4Z-J16-A47 sshd[65522]: PAM 5 more authentication failures; logname= uid=0 euid=0 tty=ssh ruser= rhost=218.92.0.163 user=rootSep 09 11:02:51 4Z-J16-A47 sshd[65522]: PAM service(sshd) ignoring max retries; 6 &gt; 3Sep 09 11:02:52 4Z-J16-A47 sshd[310]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=218.92.0.163 user=rootSep 09 11:02:52 4Z-J16-A47 sshd[310]: pam_succeed_if(sshd:auth): requirement \"uid &gt;= 1000\" not met by user \"root\"Sep 09 11:02:53 4Z-J16-A47 sshd[65525]: Failed password for root from 49.88.112.54 port 24184 ssh2Sep 09 11:02:53 4Z-J16-A47 sshd[65525]: error: maximum authentication attempts exceeded for root from 49.88.112.54 port 24184 ssh2 [preauth]Sep 09 11:02:53 4Z-J16-A47 sshd[65525]: Disconnecting: Too many authentication failures [preauth]Sep 09 11:02:53 4Z-J16-A47 sshd[65525]: PAM 5 more authentication failures; logname= uid=0 euid=0 tty=ssh ruser= rhost=49.88.112.54 user=rootSep 09 11:02:53 4Z-J16-A47 sshd[65525]: PAM service(sshd) ignoring max retries; 6 &gt; 3Sep 09 11:02:54 4Z-J16-A47 sshd[314]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=49.88.112.54 user=rootSep 09 11:02:54 4Z-J16-A47 sshd[314]: pam_succeed_if(sshd:auth): requirement \"uid &gt;= 1000\" not met by user \"root\"lines 1105-1127/1127 (END)Sep 09 11:02:49 4Z-J16-A47 sshd[65522]: pam_succeed_if(sshd:auth): requirement \"uid &gt;= 1000\" not met by user \"root\"Sep 09 11:02:50 4Z-J16-A47 sshd[303]: Failed password for invalid user admin from 117.132.175.25 port 42972 ssh2Sep 09 11:02:50 4Z-J16-A47 sshd[303]: Received disconnect from 117.132.175.25 port 42972:11: Bye Bye [preauth]Sep 09 11:02:50 4Z-J16-A47 sshd[303]: Disconnected from 117.132.175.25 port 42972 [preauth]Sep 09 11:02:50 4Z-J16-A47 sshd[65525]: Failed password for root from 49.88.112.54 port 24184 ssh2Sep 09 11:02:50 4Z-J16-A47 sshd[302]: Failed password for invalid user ansible from 149.56.96.78 port 44980 ssh2Sep 09 11:02:50 4Z-J16-A47 sshd[302]: Received disconnect from 149.56.96.78 port 44980:11: Bye Bye [preauth]Sep 09 11:02:50 4Z-J16-A47 sshd[302]: Disconnected from 149.56.96.78 port 44980 [preauth]Sep 09 11:02:50 4Z-J16-A47 sshd[65525]: pam_succeed_if(sshd:auth): requirement \"uid &gt;= 1000\" not met by user \"root\"Sep 09 11:02:51 4Z-J16-A47 sshd[65522]: Failed password for root from 218.92.0.163 port 45157 ssh2Sep 09 11:02:51 4Z-J16-A47 sshd[65522]: error: maximum authentication attempts exceeded for root from 218.92.0.163 port 45157 ssh2 [preauth]Sep 09 11:02:51 4Z-J16-A47 sshd[65522]: Disconnecting: Too many authentication failures [preauth]Sep 09 11:02:51 4Z-J16-A47 sshd[65522]: PAM 5 more authentication failures; logname= uid=0 euid=0 tty=ssh ruser= rhost=218.92.0.163 user=rootSep 09 11:02:51 4Z-J16-A47 sshd[65522]: PAM service(sshd) ignoring max retries; 6 &gt; 3Sep 09 11:02:52 4Z-J16-A47 sshd[310]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=218.92.0.163 user=rootSep 09 11:02:52 4Z-J16-A47 sshd[310]: pam_succeed_if(sshd:auth): requirement \"uid &gt;= 1000\" not met by user \"root\"Sep 09 11:02:53 4Z-J16-A47 sshd[65525]: Failed password for root from 49.88.112.54 port 24184 ssh2Sep 09 11:02:53 4Z-J16-A47 sshd[65525]: error: maximum authentication attempts exceeded for root from 49.88.112.54 port 24184 ssh2 [preauth]Sep 09 11:02:53 4Z-J16-A47 sshd[65525]: Disconnecting: Too many authentication failures [preauth]Sep 09 11:02:53 4Z-J16-A47 sshd[65525]: PAM 5 more authentication failures; logname= uid=0 euid=0 tty=ssh ruser= rhost=49.88.112.54 user=rootSep 09 11:02:53 4Z-J16-A47 sshd[65525]: PAM service(sshd) ignoring max retries; 6 &gt; 3çœ‹åˆ°è¿™é‡Œï¼Œæ„Ÿè§‰è‡ªå·±å®¶çš„é¸¡ï¼Œéšæ—¶éƒ½è¦è¢«å·èµ°å‘€ã€‚ã€‚ã€‚ã€‚è¿™è¿˜äº†å¾—ã€‚äºæ˜¯é©¬ä¸Šå¼€å§‹äº†åŠ å›ºé˜²æŠ¤å¯¹å¾…è¿™ç§æƒ…å†µï¼Œå°±æ˜¯è¦ç¦æ­¢rootç”¨æˆ·è¿œç¨‹ç™»å½•ï¼Œä½¿ç”¨æ–°å»ºæ™®é€šç”¨æˆ·ï¼Œè¿›è¡Œè¿œç¨‹ç™»å½•ï¼Œè¿˜æœ‰é‡è¦çš„ä¸€ç‚¹ï¼Œä¿®æ”¹é»˜è®¤22ç«¯å£ã€‚12[root@*** ~]# useradd one #åˆ›å»ºç”¨æˆ·[root@*** ~]# passwd one #è®¾ç½®å¯†ç è¾“å…¥æ–°ç”¨æˆ·å¯†ç é¦–å…ˆç¡®ä¿æ–‡ä»¶ /etc/sudoers ä¸­1234567%wheel ALL=(ALL) ALL``` æ²¡æœ‰è¢«æ³¨é‡Š```linuxusermod -g wheel onerocketè®¾ç½®åªæœ‰æŒ‡å®šç”¨æˆ·ç»„æ‰èƒ½ä½¿ç”¨suå‘½ä»¤åˆ‡æ¢åˆ°rootç”¨æˆ·åœ¨linuxä¸­ï¼Œæœ‰ä¸€ä¸ªé»˜è®¤çš„ç®¡ç†ç»„ wheelã€‚åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå³ä½¿æˆ‘ä»¬æœ‰ç³»ç»Ÿç®¡ç†å‘˜rootçš„æƒé™ï¼Œä¹Ÿä¸æ¨èç”¨rootç”¨æˆ·ç™»å½•ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ç”¨æ™®é€šç”¨æˆ·ç™»å½•å°±å¯ä»¥äº†ï¼Œåœ¨éœ€è¦rootæƒé™æ‰§è¡Œä¸€äº›æ“ä½œæ—¶ï¼Œå†suç™»å½•æˆä¸ºrootç”¨æˆ·ã€‚ä½†æ˜¯ï¼Œä»»ä½•äººåªè¦çŸ¥é“äº†rootçš„å¯†ç ï¼Œå°±éƒ½å¯ä»¥é€šè¿‡suå‘½ä»¤æ¥ç™»å½•ä¸ºrootç”¨æˆ·ï¼Œè¿™æ— ç–‘ä¸ºç³»ç»Ÿå¸¦æ¥äº†å®‰å…¨éšæ‚£ã€‚æ‰€ä»¥ï¼Œå°†æ™®é€šç”¨æˆ·åŠ å…¥åˆ°wheelç»„ï¼Œè¢«åŠ å…¥çš„è¿™ä¸ªæ™®é€šç”¨æˆ·å°±æˆäº†ç®¡ç†å‘˜ç»„å†…çš„ç”¨æˆ·ã€‚ç„¶åè®¾ç½®åªæœ‰wheelç»„å†…çš„æˆå‘˜å¯ä»¥ä½¿ç”¨suå‘½ä»¤åˆ‡æ¢åˆ°rootç”¨æˆ·ã€‚1234567#! /bin/bash# Function: ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä½¿å¾—åªæœ‰wheelç»„çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨ su æƒé™sed -i '/pam_wheel.so use_uid/c\\auth required pam_wheel.so use_uid ' /etc/pam.d/sun=`cat /etc/login.defs | grep SU_WHEEL_ONLY | wc -l`if [ $n -eq 0 ];thenecho SU_WHEEL_ONLY yes &gt;&gt; /etc/login.defsfiæ‰“å¼€SSHDçš„é…ç½®æ–‡ä»¶1vim /etc/ssh/sshd_configæŸ¥æ‰¾â€œ#PermitRootLogin yesâ€ï¼Œå°†å‰é¢çš„â€œ#â€å»æ‰ï¼ŒçŸ­å°¾â€œyesâ€æ”¹ä¸ºâ€œnoâ€ï¼ˆä¸åŒç‰ˆæœ¬å¯èƒ½åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œå¹¶ä¿å­˜æ–‡ä»¶ã€‚ä¿®æ”¹sshdé»˜è®¤ç«¯å£è™½ç„¶æ›´æ”¹ç«¯å£æ— æ³•åœ¨æ ¹æœ¬ä¸ŠæŠµå¾¡ç«¯å£æ‰«æï¼Œä½†æ˜¯ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜é˜²å¾¡ã€‚æ‰“å¼€sshdé…ç½®æ–‡ä»¶1vi /etc/ssh/sshd_configæ‰¾åˆ°#Port 22 åˆ æ‰æ³¨é‡ŠæœåŠ¡å™¨ç«¯å£æœ€å¤§å¯ä»¥å¼€åˆ°65536åŒæ—¶å†æ·»åŠ ä¸€ä¸ªPort 61024 ï¼ˆéšæ„è®¾ç½®ï¼‰Port 22Port 61024é‡å¯sshdæœåŠ¡123service sshd restart #centos6ç³»åˆ—systemctl restart sshd #centos7ç³»åˆ—firewall-cmd --add-port=61024/tcpæµ‹è¯•ï¼Œä½¿ç”¨æ–°ç”¨æˆ·ï¼Œæ–°ç«¯å£è¿›è¡Œç™»å½•å¦‚æœç™»é™†æˆåŠŸåï¼Œå†å°†Port22æ³¨é‡Šæ‰ï¼Œé‡å¯sshdæœåŠ¡ã€‚åˆ°è¿™é‡Œï¼Œå…³äºè¿œç¨‹ç™»å½•çš„é˜²æŠ¤å·¥ä½œï¼Œå°±åšå¥½äº†ã€‚æœ€åï¼Œå‘Šè¯«å¤§å®¶ï¼Œäº²èº«ä½“éªŒï¼Œæ²¡æœ‰é˜²æŠ¤è£¸å¥”çš„æœåŠ¡å™¨ï¼ŒçœŸçš„å¤ªå®¹æ˜“è¢«æŠ“è‚‰é¸¡äº†ï¼ï¼ï¼ï¼ï¼","categories":[{"name":"Linux","slug":"Linux","permalink":"cpeixin.cn/categories/Linux/"}],"tags":[{"name":"æœåŠ¡å™¨å®‰å…¨","slug":"æœåŠ¡å™¨å®‰å…¨","permalink":"cpeixin.cn/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8/"}]},{"title":"æˆ‘çš„æœåŠ¡å™¨è¢«é»‘äº†","slug":"æˆ‘çš„æœåŠ¡å™¨è¢«é»‘äº†","date":"2019-08-24T02:26:15.000Z","updated":"2020-04-04T12:00:09.871Z","comments":true,"path":"2019/08/24/æˆ‘çš„æœåŠ¡å™¨è¢«é»‘äº†/","link":"","permalink":"cpeixin.cn/2019/08/24/%E6%88%91%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E9%BB%91%E4%BA%86/","excerpt":"","text":"æœåŠ¡å™¨è‡ªè¿°æˆ‘æ˜¯ä¸€å°8æ ¸ï¼Œ16Gå†…å­˜ï¼Œ4Tçš„Linux (centOS 7)æœåŠ¡å™¨â€¦ è¿˜æœ‰ä¸¤å°å’Œæˆ‘ä¸€èµ·è¢«ä¹°æ¥çš„è‹¦ä¸»ï¼Œæˆ‘ä»¬ä¸€åŒé•¿å¤§ï¼Œé…ç½®ä¸€æ ·ï¼Œéƒ½æ˜¯ä»é¦™æ¸¯è¢«è´©å–åˆ°å›½å¤–ï¼Œæˆ‘ä»¬ä¸‰ä¸ªç»„æˆäº†åˆ†å¸ƒå¼çˆ¬è™«æ¡†æ¶ï¼Œå¦ä¸¤ä½è‹¦ä¸»åˆ†åˆ«è´Ÿè´£å¼‚æ­¥çˆ¬å–è¿æ¥ï¼Œå¤šè¿›ç¨‹çˆ¬å–è¿æ¥å’Œscrapy-redisåˆ†å¸ƒå¼çˆ¬å–è§£æã€‚è€Œæˆ‘æ¯”è¾ƒæ¸…é—²ï¼Œåªè´Ÿè´£å­˜å‚¨. ç½‘é¡µé“¾æ¥æ”¾åœ¨æˆ‘çš„redisä¸­ï¼Œè€Œè§£æå¥½çš„æ–‡ç« ä¿¡æ¯æ”¾åœ¨æˆ‘çš„MySQLä¸­ã€‚ç„¶è€Œæ•…äº‹çš„å¼€å§‹ï¼Œå°±æ˜¯åœ¨å®‰è£…redisçš„é‚£å¤©ï¼Œä¸»äººçš„ç²—å¿ƒå¤§æ„ï¼Œä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œä»è€Œè®©ä»–ä»Šå¤©èŠ±è´¹äº†å°åŠå¤©æ¥å¯¹æˆ‘è¿›è¡Œç»´ä¿®ï¼ï¼ğŸ˜¢ä¸ºä»€ä¹ˆé»‘æˆ‘çš„æœåŠ¡å™¨è¿™æ ·ä¸€å°é…ç½®çš„æœåŠ¡å™¨ï¼Œä¸€ä¸ªæœˆçš„ä»·æ ¼å¤§æ¦‚åœ¨1000RMBä¸€ä¸ªæœˆï¼Œæ€ä¹ˆè¯´å‘¢â€¦ è¿™ä¸ªä»·æ ¼çš„æœåŠ¡å™¨å¯¹äºä¸ªäººç”¨æˆ·æ­å»ºè‡ªå·±ç©çš„ç¯å¢ƒè¿˜æ˜¯æœ‰äº›å°è´µçš„ã€‚ä¾‹å¦‚æˆ‘ç°åœ¨å†™åšå®¢ï¼Œä¹Ÿæ˜¯æ‰˜ç®¡åœ¨GitHubä¸Šçš„ï¼Œæˆ‘ä¹Ÿå¯ä»¥ç§Ÿç”¨ä¸€å°æœåŠ¡å™¨æ¥æ‰˜ç®¡çš„åšå®¢ï¼Œä½†æ˜¯ç›®å‰æˆ‘çš„è¿™ç§çº§åˆ«ï¼Œä¹Ÿæ˜¯è¦è€ƒè™‘åˆ°æŠ•å…¥äº§å‡ºæ¯”æ˜¯å¦åˆé€‚ï¼Œå“ˆå“ˆå“ˆã€‚ä½†æ˜¯å¯¹äºï¼ŒæœåŠ¡å™¨ä¸Šè¿è¡Œçš„ä»»åŠ¡å’ŒæœåŠ¡äº§å‡ºçš„ä»·å€¼è¦è¿œè¿œå¤§äºæœåŠ¡å™¨ä»·å€¼çš„æ—¶å€™ï¼Œè¿™1000å¤šRMBå°±å¯ä»¥å¿½ç•¥ä¸è®¡äº†ã€‚åŒæ—¶ï¼Œè¿˜æœ‰é»‘è¡£äººï¼Œä»–ä»¬éœ€è¦å¤§é‡çš„æœåŠ¡å™¨ï¼Œæ¥è¿è¡ŒåŒæ ·çš„ç¨‹åºï¼Œäº§å‡ºçš„ä»·å€¼ä»–ä»¬ä¹Ÿæ— æ³•è¡¡é‡ï¼Œæœ‰å¯èƒ½å¾ˆå¤šæœ‰å¯èƒ½å¾ˆå°‘ã€‚ã€‚é‚£ä¹ˆè¿™æ—¶å€™ï¼Œä»–ä»¬ä¸ºäº†èŠ‚çº¦æˆæœ¬ï¼Œé™ä½æˆæœ¬ï¼Œå°±ä¼šç”¨ä¸€äº›é»‘è‰²çš„æ‰‹æ³•ï¼Œä¾‹å¦‚æ¸—é€ï¼Œsqlæ³¨å…¥ï¼Œæ ¹æ®æ¼æ´æ‰«æç­‰æ–¹æ³•æ¥ æŠ“â€œè‚‰é¸¡â€ï¼ŒæŠ“åˆ°å¤§é‡çš„å¯ä¾µå…¥çš„æœåŠ¡å™¨ï¼Œç„¶ååœ¨ä½ çš„æœåŠ¡å™¨ä¸Šçš„æŸä¸€ä¸ªè§’è½ï¼Œæ”¾ä¸Šä»–çš„ç¨‹åºï¼Œä¸€ç›´åœ¨è¿è¡Œï¼Œä¸€ç›´åœ¨è¿è¡Œï¼Œå ç”¨ç€ä½ çš„cpu,å ç”¨ç€ä½ çš„å¸¦å®½â€¦é‚£ä¹ˆä¸Šé¢æåˆ°çš„é»‘è¡£äººï¼Œå°±æœ‰é‚£ä¹ˆä¸€ç±»è§’è‰²ï¼Œâ€œçŸ¿å·¥â€ï¼ï¼ï¼ï¼æ›¾ç»ï¼Œæˆ‘ä¹Ÿä¸“æ³¨è¿‡åŒºå—é“¾ï¼Œæˆ‘ä¹ŸçŸ­æš‚çš„è¿·å¤±åœ¨æ•°å­—è´§å¸çš„æµªæ½®ä¸­ï¼Œä½†æ˜¯æ²¡æœ‰åƒåˆ°çº¢åˆ©ğŸ‘€ğŸ‘€ğŸ‘€ å°±æ˜¯è¿™äº›æ•°å­—ä¸–ç•Œçš„çŸ¿å·¥ï¼Œåˆ©ç”¨æˆ‘æœåŠ¡å™¨çš„æ¼æ´é»‘äº†æˆ‘çš„æœåŠ¡å™¨å¦‚ä½•å‘ç°è¢«é»‘å›åˆ°è¿™ç¯‡åšå®¢çš„æ­£é¢˜ï¼Œæˆ‘æ˜¯å¦‚ä½•å‘ç°ï¼Œæˆ‘çš„æœåŠ¡å™¨è¢«é»‘äº†å‘¢ï¼Ÿï¼Ÿæœ€è¿‘æˆ‘åœ¨åšscrapyåˆ†å¸ƒå¼çˆ¬è™«æ–¹é¢çš„å·¥ä½œï¼Œå‡†å¤‡äº†ä¸‰å°æœåŠ¡å™¨ï¼Œè€Œè¿™å°è¢«é»‘çš„æœåŠ¡å™¨æ˜¯æˆ‘ç”¨æ¥åšå­˜å‚¨çš„ï¼Œå…¶ä¸­ç”¨åˆ°äº†rediså’Œmysqlã€‚å…¶ä¸­å¼•å‘è¿™ä»¶äº‹æƒ…çš„å°±æ˜¯redisï¼Œæˆ‘åœ¨å®‰è£…redisçš„æ—¶å€™ï¼Œå¯ä»¥è¯´è´£ä»»å®Œå…¨åœ¨æˆ‘ï¼Œæˆ‘ä¸ºäº†å®‰è£…èŠ‚çº¦æ—¶é—´ï¼Œä»¥åä½¿ç”¨æ–¹ä¾¿ç­‰ï¼Œåšäº†å‡ ä¸ªå¾ˆé”™è¯¯çš„æ“ä½œ1.å…³é—­äº†Linuxé˜²ç«å¢™2.æ²¡æœ‰è®¾ç½®redisè®¿é—®å¯†ç 3.æ²¡æœ‰æ›´æ”¹redisé»˜è®¤ç«¯å£4.å¼€æ”¾äº†ä»»æ„IPå¯ä»¥è¿œç¨‹è¿æ¥ä»¥ä¸Šå››ä¸ªå¾ˆå‚»çš„æ“ä½œ,éƒ½æ˜¯å› ä¸ºä»¥å‰æ‰€ç”¨çš„rediséƒ½æ˜¯æœ‰å…¬å¸è¿ç»´åŒäº‹è¿›è¡Œå®‰è£…ä»¥åŠå®‰å…¨ç­–ç•¥æ–¹é¢çš„é…ç½®ï¼Œä»¥è‡³æˆ‘è¿™ä¸€æ¬¡æ²¡æœ‰æ³¨æ„åˆ°å®‰è£…æ–¹é¢ã€‚å½“æˆ‘çš„çˆ¬è™«ç¨‹åºå·²ç»å¹³ç¨³çš„è¿è¡Œäº†ä¸¤å¤©äº†ï¼Œæˆ‘å°±å¼€å§‹æ”¾å¿ƒäº†ï¼Œé™é™åœ°çœ‹ç€spiderç–¯ç‹‚çš„spider,å¯æ˜¯å°±æ˜¯åœ¨éšåï¼ŒredisæœåŠ¡å‡ºç°å¼‚å¸¸ï¼Œé¦–å…ˆæ˜¯æˆ‘æœ¬åœ°å®¢æˆ·ç«¯è¿æ¥ä¸ä¸Šè¿œç¨‹redis-serverï¼Œæˆ‘æœ‰æƒ³è¿‡æ˜¯ä¸æ˜¯ç½‘ç»œä¸ç¨³å®šçš„é—®é¢˜ã€‚åœ¨æˆ‘é‡å¯redisåï¼Œæ¢å¤æ­£å¸¸ï¼Œåˆå¹³ç¨³çš„è¿è¡Œäº†ä¸€å¤©ã€‚ä½†æ˜¯æ¥ä¸‹æ¥redisé¢‘ç¹å‡ºé—®é¢˜ï¼Œæˆ‘å°±æƒ³ï¼Œæ˜¯ä¸æ˜¯çˆ¬è™«çˆ¬å–äº†å¤§é‡çš„ç½‘é¡µé“¾æ¥ï¼Œå¯¹redisé€ æˆäº†é˜»å¡ã€‚äºæ˜¯ï¼Œæˆ‘å¼€å¯äº†å¯¹redis.confï¼Œè¿˜æœ‰ç¨‹åºç«¯çš„connectä¸¤æ–¹é¢360åº¦çš„ä¼˜åŒ–ï¼Œç„¶å¹¶åµã€‚ã€‚ã€‚1lsof -i tcp:6379ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤åï¼Œå‘ç°redisæœåŠ¡æ­£å¸¸è¿è¡Œï¼Œ6379ç«¯å£ä¹Ÿæ˜¯å¼€å¯çš„ã€‚æˆ‘é™·å…¥äº†æ·±æ·±åœ°è¿·æƒ‘ã€‚ã€‚ã€‚ã€‚ã€‚ä½†æ˜¯è¿™æ—¶å…¶å®å°±åº”è¯¥çœ‹å‡ºä¸€äº›ç«¯å€ªäº†ï¼Œå› ä¸ºæ­£å¸¸å ç”¨ 6379 ç«¯å£çš„è¿›ç¨‹åæ˜¯ ï¼š redis-ser ã€‚ä½†æ˜¯ç°åœ¨å ç”¨ 6379 ç«¯å£çš„è¿›ç¨‹åæ˜¯ ï¼šxmrig-no (å¿˜è®°æˆªå›¾äº†)ï¼Œä½†æ˜¯è¿™æ—¶æˆ‘ä¹Ÿæ²¡æœ‰å¤šæƒ³ç›´åˆ°æˆ‘è¿è¡Œï¼š1topå‘ç°äº†å ç”¨ 6379 ç«¯å£çš„è¿›ç¨‹å…¨åç§°xmrigâ€¦ï¼Œæˆ‘æ‰æç„¶å¤§æ‚Ÿï¼Œæˆ‘çš„ç«¯å£è¢«å ç”¨äº†ã€‚æˆ‘åœ¨googleä¸Šä¸€æŸ¥ï¼Œæ‰å‘ç°ã€‚ã€‚æˆ‘è¢«é»‘äº†åšäº†å“ªäº›æ€¥æ•‘å·¥ä½œè¿™æ—¶ï¼Œæ„Ÿè§‰è‡ªå·±å¼€å§‹æŠ•å…¥äº†ä¸€åœºå¯¹æŠ—æˆ˜1.é¦–å…ˆæŸ¥æ‰¾æ¤å…¥ç¨‹åºçš„ä½ç½®ã€‚åœ¨/tmp/ç›®å½•ä¸‹ï¼Œä¸€èˆ¬æ¤å…¥ç¨‹åºéƒ½ä¼šæ”¾åœ¨ /tmp ä¸´æ—¶ç›®å½•ä¸‹ï¼Œå…¶å®å›è¿‡å¤´ä¸€æƒ³ï¼Œæ”¾åœ¨è¿™é‡Œï¼Œä¹Ÿæ˜¯æŒºå¦™çš„ã€‚2.åˆ é™¤æ¸…ç†å¯ç–‘æ–‡ä»¶æ€æ­»è¿›ç¨‹åˆ é™¤äº†æ­£åœ¨è¿è¡Œçš„ç¨‹åºæ–‡ä»¶è¿˜æœ‰å®‰è£…åŒ…3.æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡1cat /etc/passwd |cut -f 1 -d:crontab -uXXX -l4.å¼€å¯é˜²ç«å¢™ä»…å¼€æ”¾ä¼šä½¿ç”¨åˆ°çš„ç«¯å£5.ä¿®æ”¹redisé»˜è®¤ç«¯å£redis.confä¸­çš„port6.æ·»åŠ redisæˆæƒå¯†ç redis.confä¸­çš„requirepass7.ä¿®æ”¹ç»‘å®šè¿œç¨‹ç»‘å®šipredis.confä¸­çš„bindæœ€åé‡å¯redisæœåŠ¡ï¼ä»ä¸­å­¦åˆ°äº†ä»€ä¹ˆæ˜æ˜æ˜¯è‡ªå·±è¢«é»‘äº†ï¼Œä½†æ˜¯åœ¨è¡¥æ•‘çš„è¿‡ç¨‹ä¸­ï¼Œå´å¾—åˆ°äº†å†™ç¨‹åºç»™ä¸äº†çš„æ»¡è¶³æ„Ÿã€‚æ„Ÿè§‰å› ä¸ºè¿™ä»¶äº‹æƒ…ï¼Œä¸Šå¸ç»™æˆ‘æ‰“å¼€äº†å¦ä¸€æ‰‡çª—æˆ·ï½ï½ï½æœ€åè¯´ä¸‹ï¼Œè¿™ä¸ªæœ¨é©¬æ˜¯æ€ä¹ˆè¿›æ¥çš„å‘¢ï¼ŒæŸ¥äº†ä¸€ä¸‹åŸæ¥æ˜¯åˆ©ç”¨Redisç«¯å£æ¼æ´è¿›æ¥çš„ï¼Œå®ƒå¯ä»¥å¯¹æœªæˆæƒè®¿é—®redisçš„æœåŠ¡å™¨ç™»å½•ï¼Œå®šæ—¶ä¸‹è½½å¹¶æ‰§è¡Œè„šæœ¬ï¼Œè„šæœ¬è¿è¡Œï¼ŒæŒ–çŸ¿ï¼Œè¿œç¨‹è°ƒç”¨ç­‰ã€‚æ‰€ä»¥é™¤äº†æ‰§è¡Œä¸Šè¿°æ“ä½œï¼ŒlinuxæœåŠ¡å™¨ä¸­çš„ç”¨æˆ·æƒé™ï¼ŒæœåŠ¡æƒé™ç²¾ç»†åŒ–ï¼Œé˜²æ­¢å†æ¬¡è¢«å…¥ä¾µã€‚","categories":[{"name":"Linux","slug":"Linux","permalink":"cpeixin.cn/categories/Linux/"}],"tags":[{"name":"æœåŠ¡å™¨å®‰å…¨","slug":"æœåŠ¡å™¨å®‰å…¨","permalink":"cpeixin.cn/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8/"}]},{"title":"å›¢ç­ LeetCode è‚¡ç¥¨ä¹°å–é—®é¢˜","slug":"å›¢ç­-LeetCode-è‚¡ç¥¨ä¹°å–é—®é¢˜","date":"2019-08-04T17:00:08.000Z","updated":"2020-07-04T17:01:29.086Z","comments":true,"path":"2019/08/05/å›¢ç­-LeetCode-è‚¡ç¥¨ä¹°å–é—®é¢˜/","link":"","permalink":"cpeixin.cn/2019/08/05/%E5%9B%A2%E7%81%AD-LeetCode-%E8%82%A1%E7%A5%A8%E4%B9%B0%E5%8D%96%E9%97%AE%E9%A2%98/","excerpt":"","text":"æ€è·¯ä»‹ç»å¾ˆå¤šè¯»è€…æŠ±æ€¨ LeetCode çš„è‚¡ç¥¨ç³»åˆ—é—®é¢˜å¥‡æŠ€æ·«å·§å¤ªå¤šï¼Œå¦‚æœé¢è¯•çœŸçš„é‡åˆ°è¿™ç±»é—®é¢˜ï¼ŒåŸºæœ¬ä¸ä¼šæƒ³åˆ°é‚£äº›å·§å¦™çš„åŠæ³•ï¼Œæ€ä¹ˆåŠï¼Ÿæ‰€ä»¥æœ¬æ–‡æ‹’ç»å¥‡æŠ€æ·«å·§ï¼Œè€Œæ˜¯ç¨³æ‰ç¨³æ‰“ï¼Œåªç”¨ä¸€ç§é€šç”¨æ–¹æ³•è§£å†³æ‰€ç”¨é—®é¢˜ï¼Œä»¥ä¸å˜åº”ä¸‡å˜ã€‚è¿™ç¯‡æ–‡ç« ç”¨çŠ¶æ€æœºçš„æŠ€å·§æ¥è§£å†³ï¼Œå¯ä»¥å…¨éƒ¨æäº¤é€šè¿‡ã€‚ä¸è¦è§‰å¾—è¿™ä¸ªåè¯é«˜å¤§ä¸Šï¼Œæ–‡å­¦è¯æ±‡è€Œå·²ï¼Œå®é™…ä¸Šå°±æ˜¯ DP tableï¼Œçœ‹ä¸€çœ¼å°±æ˜ç™½äº†ã€‚PSï¼šæœ¬æ–‡å‚è€ƒè‡ªè‹±æ–‡ç‰ˆ LeetCode çš„ä¸€ç¯‡é¢˜è§£ã€‚å…ˆéšä¾¿æŠ½å‡ºä¸€é“é¢˜ï¼Œçœ‹çœ‹åˆ«äººçš„è§£æ³•ï¼š123456789101112int maxProfit(vector&lt;int&gt;&amp; prices) &#123; if(prices.empty()) return 0; int s1=-prices[0],s2=INT_MIN,s3=INT_MIN,s4=INT_MIN; for(int i=1;i&lt;prices.size();++i) &#123; s1 = max(s1, -prices[i]); s2 = max(s2, s1+prices[i]); s3 = max(s3, s2-prices[i]); s4 = max(s4, s3+prices[i]); &#125; return max(0,s4);&#125;èƒ½çœ‹æ‡‚å§ï¼Ÿä¼šåšäº†å—ï¼Ÿä¸å¯èƒ½çš„ï¼Œä½ çœ‹ä¸æ‡‚ï¼Œè¿™æ‰æ­£å¸¸ã€‚å°±ç®—ä½ å‹‰å¼ºçœ‹æ‡‚äº†ï¼Œä¸‹ä¸€ä¸ªé—®é¢˜ä½ è¿˜æ˜¯åšä¸å‡ºæ¥ã€‚ä¸ºä»€ä¹ˆåˆ«äººèƒ½å†™å‡ºè¿™ä¹ˆè¯¡å¼‚å´åˆé«˜æ•ˆçš„è§£æ³•å‘¢ï¼Ÿå› ä¸ºè¿™ç±»é—®é¢˜æ˜¯æœ‰æ¡†æ¶çš„ï¼Œä½†æ˜¯äººå®¶ä¸ä¼šå‘Šè¯‰ä½ çš„ï¼Œå› ä¸ºä¸€æ—¦å‘Šè¯‰ä½ ï¼Œä½ äº”åˆ†é’Ÿå°±å­¦ä¼šäº†ï¼Œè¯¥ç®—æ³•é¢˜å°±ä¸å†ç¥ç§˜ï¼Œå˜å¾—ä¸å ªä¸€å‡»äº†ã€‚æœ¬æ–‡å°±æ¥å‘Šè¯‰ä½ è¿™ä¸ªæ¡†æ¶ï¼Œç„¶åå¸¦ç€ä½ ä¸€é“ä¸€é“ç§’æ€ã€‚è¿™ç¯‡æ–‡ç« ç”¨çŠ¶æ€æœºçš„æŠ€å·§æ¥è§£å†³ï¼Œå¯ä»¥å…¨éƒ¨æäº¤é€šè¿‡ã€‚ä¸è¦è§‰å¾—è¿™ä¸ªåè¯é«˜å¤§ä¸Šï¼Œæ–‡å­¦è¯æ±‡è€Œå·²ï¼Œå®é™…ä¸Šå°±æ˜¯ DP tableï¼Œçœ‹ä¸€çœ¼å°±æ˜ç™½äº†ã€‚è¿™ 6 é“é¢˜ç›®æ˜¯æœ‰å…±æ€§çš„ï¼Œæˆ‘å°±æŠ½å‡ºæ¥ç¬¬ 4 é“é¢˜ç›®ï¼Œå› ä¸ºè¿™é“é¢˜æ˜¯ä¸€ä¸ªæœ€æ³›åŒ–çš„å½¢å¼ï¼Œå…¶ä»–çš„é—®é¢˜éƒ½æ˜¯è¿™ä¸ªå½¢å¼çš„ç®€åŒ–ï¼Œçœ‹ä¸‹é¢˜ç›®ï¼šç¬¬ä¸€é¢˜æ˜¯åªè¿›è¡Œä¸€æ¬¡äº¤æ˜“ï¼Œç›¸å½“äº k = 1ï¼›ç¬¬äºŒé¢˜æ˜¯ä¸é™äº¤æ˜“æ¬¡æ•°ï¼Œç›¸å½“äº k = +infinityï¼ˆæ­£æ— ç©·ï¼‰ï¼›ç¬¬ä¸‰é¢˜æ˜¯åªè¿›è¡Œ 2 æ¬¡äº¤æ˜“ï¼Œç›¸å½“äº k = 2ï¼›å‰©ä¸‹ä¸¤é“ä¹Ÿæ˜¯ä¸é™æ¬¡æ•°ï¼Œä½†æ˜¯åŠ äº†äº¤æ˜“ã€Œå†·å†»æœŸã€å’Œã€Œæ‰‹ç»­è´¹ã€çš„é¢å¤–æ¡ä»¶ï¼Œå…¶å®å°±æ˜¯ç¬¬äºŒé¢˜çš„å˜ç§ï¼Œéƒ½å¾ˆå®¹æ˜“å¤„ç†ã€‚ä¸€ã€ç©·ä¸¾æ¡†æ¶é¦–å…ˆï¼Œè¿˜æ˜¯ä¸€æ ·çš„æ€è·¯ï¼šå¦‚ä½•ç©·ä¸¾ï¼Ÿè¿™é‡Œçš„ç©·ä¸¾æ€è·¯å’Œä¸Šç¯‡æ–‡ç« é€’å½’çš„æ€æƒ³ä¸å¤ªä¸€æ ·ã€‚é€’å½’å…¶å®æ˜¯ç¬¦åˆæˆ‘ä»¬æ€è€ƒçš„é€»è¾‘çš„ï¼Œä¸€æ­¥æ­¥æ¨è¿›ï¼Œé‡åˆ°æ— æ³•è§£å†³çš„å°±ä¸¢ç»™é€’å½’ï¼Œä¸€ä¸å°å¿ƒå°±åšå‡ºæ¥äº†ï¼Œå¯è¯»æ€§è¿˜å¾ˆå¥½ã€‚ç¼ºç‚¹å°±æ˜¯ä¸€æ—¦å‡ºé”™ï¼Œä½ ä¹Ÿä¸å®¹æ˜“æ‰¾åˆ°é”™è¯¯å‡ºç°çš„åŸå› ã€‚æ¯”å¦‚ä¸Šç¯‡æ–‡ç« çš„é€’å½’è§£æ³•ï¼Œè‚¯å®šè¿˜æœ‰è®¡ç®—å†—ä½™ï¼Œä½†ç¡®å®ä¸å®¹æ˜“æ‰¾åˆ°ã€‚è€Œè¿™é‡Œï¼Œæˆ‘ä»¬ä¸ç”¨é€’å½’æ€æƒ³è¿›è¡Œç©·ä¸¾ï¼Œè€Œæ˜¯åˆ©ç”¨ã€ŒçŠ¶æ€ã€è¿›è¡Œç©·ä¸¾ã€‚æˆ‘ä»¬å…·ä½“åˆ°æ¯ä¸€å¤©ï¼Œçœ‹çœ‹æ€»å…±æœ‰å‡ ç§å¯èƒ½çš„ã€ŒçŠ¶æ€ã€ï¼Œå†æ‰¾å‡ºæ¯ä¸ªã€ŒçŠ¶æ€ã€å¯¹åº”çš„ã€Œé€‰æ‹©ã€ã€‚æˆ‘ä»¬è¦ç©·ä¸¾æ‰€æœ‰ã€ŒçŠ¶æ€ã€ï¼Œç©·ä¸¾çš„ç›®çš„æ˜¯æ ¹æ®å¯¹åº”çš„ã€Œé€‰æ‹©ã€æ›´æ–°çŠ¶æ€ã€‚å¬èµ·æ¥æŠ½è±¡ï¼Œä½ åªè¦è®°ä½ã€ŒçŠ¶æ€ã€å’Œã€Œé€‰æ‹©ã€ä¸¤ä¸ªè¯å°±è¡Œï¼Œä¸‹é¢å®æ“ä¸€ä¸‹å°±å¾ˆå®¹æ˜“æ˜ç™½äº†ã€‚1234for çŠ¶æ€1 in çŠ¶æ€1çš„æ‰€æœ‰å–å€¼ï¼š for çŠ¶æ€2 in çŠ¶æ€2çš„æ‰€æœ‰å–å€¼ï¼š for ... dp[çŠ¶æ€1][çŠ¶æ€2][...] = æ‹©ä¼˜(é€‰æ‹©1ï¼Œé€‰æ‹©2...)æ¯”å¦‚è¯´è¿™ä¸ªé—®é¢˜ï¼Œæ¯å¤©éƒ½æœ‰ä¸‰ç§ã€Œé€‰æ‹©ã€ï¼šä¹°å…¥ã€å–å‡ºã€æ— æ“ä½œï¼Œæˆ‘ä»¬ç”¨ buy, sell, rest è¡¨ç¤ºè¿™ä¸‰ç§é€‰æ‹©ã€‚ä½†é—®é¢˜æ˜¯ï¼Œå¹¶ä¸æ˜¯æ¯å¤©éƒ½å¯ä»¥ä»»æ„é€‰æ‹©è¿™ä¸‰ç§é€‰æ‹©çš„ï¼Œå› ä¸º sell å¿…é¡»åœ¨ buy ä¹‹åï¼Œbuy å¿…é¡»åœ¨ sell ä¹‹åã€‚é‚£ä¹ˆ rest æ“ä½œè¿˜åº”è¯¥åˆ†ä¸¤ç§çŠ¶æ€ï¼Œä¸€ç§æ˜¯ buy ä¹‹åçš„ restï¼ˆæŒæœ‰äº†è‚¡ç¥¨ï¼‰ï¼Œä¸€ç§æ˜¯ sell ä¹‹åçš„ restï¼ˆæ²¡æœ‰æŒæœ‰è‚¡ç¥¨ï¼‰ã€‚è€Œä¸”åˆ«å¿˜äº†ï¼Œæˆ‘ä»¬è¿˜æœ‰äº¤æ˜“æ¬¡æ•° k çš„é™åˆ¶ï¼Œå°±æ˜¯è¯´ä½  buy è¿˜åªèƒ½åœ¨ k &gt; 0 çš„å‰æä¸‹æ“ä½œã€‚å¾ˆå¤æ‚å¯¹å§ï¼Œä¸è¦æ€•ï¼Œæˆ‘ä»¬ç°åœ¨çš„ç›®çš„åªæ˜¯ç©·ä¸¾ï¼Œä½ æœ‰å†å¤šçš„çŠ¶æ€ï¼Œè€å¤«è¦åšçš„å°±æ˜¯ä¸€æŠŠæ¢­å…¨éƒ¨åˆ—ä¸¾å‡ºæ¥ã€‚è¿™ä¸ªé—®é¢˜çš„ã€ŒçŠ¶æ€ã€æœ‰ä¸‰ä¸ªï¼Œç¬¬ä¸€ä¸ªæ˜¯å¤©æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯å…è®¸äº¤æ˜“çš„æœ€å¤§æ¬¡æ•°ï¼Œç¬¬ä¸‰ä¸ªæ˜¯å½“å‰çš„æŒæœ‰çŠ¶æ€ï¼ˆå³ä¹‹å‰è¯´çš„ rest çš„çŠ¶æ€ï¼Œæˆ‘ä»¬ä¸å¦¨ç”¨ 1 è¡¨ç¤ºæŒæœ‰ï¼Œ0 è¡¨ç¤ºæ²¡æœ‰æŒæœ‰ï¼‰ã€‚ç„¶åæˆ‘ä»¬ç”¨ä¸€ä¸ªä¸‰ç»´æ•°ç»„å°±å¯ä»¥è£…ä¸‹è¿™å‡ ç§çŠ¶æ€çš„å…¨éƒ¨ç»„åˆï¼š12345678dp[i][k][0 or 1]0 &lt;= i &lt;= n-1, 1 &lt;= k &lt;= Kn ä¸ºå¤©æ•°ï¼Œå¤§ K ä¸ºæœ€å¤šäº¤æ˜“æ•°æ­¤é—®é¢˜å…± n Ã— K Ã— 2 ç§çŠ¶æ€ï¼Œå…¨éƒ¨ç©·ä¸¾å°±èƒ½æå®šã€‚for i in range(n): for k in range(1,K+1): for s in &#123;0, 1&#125;: dp[i][k][s] = max(buy, sell, rest)è€Œä¸”æˆ‘ä»¬å¯ä»¥ç”¨è‡ªç„¶è¯­è¨€æè¿°å‡ºæ¯ä¸€ä¸ªçŠ¶æ€çš„å«ä¹‰ï¼Œæ¯”å¦‚è¯´ dp[3][2][1] çš„å«ä¹‰å°±æ˜¯ï¼šä»Šå¤©æ˜¯ç¬¬ä¸‰å¤©ï¼Œæˆ‘ç°åœ¨æ‰‹ä¸ŠæŒæœ‰ç€è‚¡ç¥¨ï¼Œè‡³ä»Šæœ€å¤šè¿›è¡Œ 2 æ¬¡äº¤æ˜“ã€‚å†æ¯”å¦‚ dp[2][3][0] çš„å«ä¹‰ï¼šä»Šå¤©æ˜¯ç¬¬äºŒå¤©ï¼Œæˆ‘ç°åœ¨æ‰‹ä¸Šæ²¡æœ‰æŒæœ‰è‚¡ç¥¨ï¼Œè‡³ä»Šæœ€å¤šè¿›è¡Œ 3 æ¬¡äº¤æ˜“ã€‚å¾ˆå®¹æ˜“ç†è§£ï¼Œå¯¹å§ï¼Ÿæˆ‘ä»¬æƒ³æ±‚çš„æœ€ç»ˆç­”æ¡ˆæ˜¯ dp[n - 1][K][0]ï¼Œå³æœ€åä¸€å¤©ï¼Œæœ€å¤šå…è®¸ K æ¬¡äº¤æ˜“ï¼Œæœ€å¤šè·å¾—å¤šå°‘åˆ©æ¶¦ã€‚è¯»è€…å¯èƒ½é—®ä¸ºä»€ä¹ˆä¸æ˜¯ dp[n - 1][K][1]ï¼Ÿå› ä¸º [1] ä»£è¡¨æ‰‹ä¸Šè¿˜æŒæœ‰è‚¡ç¥¨ï¼Œ[0] è¡¨ç¤ºæ‰‹ä¸Šçš„è‚¡ç¥¨å·²ç»å–å‡ºå»äº†ï¼Œå¾ˆæ˜¾ç„¶åè€…å¾—åˆ°çš„åˆ©æ¶¦ä¸€å®šå¤§äºå‰è€…ã€‚è®°ä½å¦‚ä½•è§£é‡Šã€ŒçŠ¶æ€ã€ï¼Œä¸€æ—¦ä½ è§‰å¾—å“ªé‡Œä¸å¥½ç†è§£ï¼ŒæŠŠå®ƒç¿»è¯‘æˆè‡ªç„¶è¯­è¨€å°±å®¹æ˜“ç†è§£äº†ã€‚äºŒã€çŠ¶æ€è½¬ç§»æ¡†æ¶ç°åœ¨ï¼Œæˆ‘ä»¬å®Œæˆäº†ã€ŒçŠ¶æ€ã€çš„ç©·ä¸¾ï¼Œæˆ‘ä»¬å¼€å§‹æ€è€ƒæ¯ç§ã€ŒçŠ¶æ€ã€æœ‰å“ªäº›ã€Œé€‰æ‹©ã€ï¼Œåº”è¯¥å¦‚ä½•æ›´æ–°ã€ŒçŠ¶æ€ã€ã€‚åªçœ‹ã€ŒæŒæœ‰çŠ¶æ€ã€ï¼Œå¯ä»¥ç”»ä¸ªçŠ¶æ€è½¬ç§»å›¾ã€‚é€šè¿‡è¿™ä¸ªå›¾å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°ï¼Œæ¯ç§çŠ¶æ€ï¼ˆ0 å’Œ 1ï¼‰æ˜¯å¦‚ä½•è½¬ç§»è€Œæ¥çš„ã€‚æ ¹æ®è¿™ä¸ªå›¾ï¼Œæˆ‘ä»¬æ¥å†™ä¸€ä¸‹çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š12dp[i][k][0] = max(dp[i-1][k][0], dp[i-1][k][1] + prices[i]) #ï¿¥max( é€‰æ‹© rest , é€‰æ‹© sell )è§£é‡Šï¼šä»Šå¤©æˆ‘æ²¡æœ‰æŒæœ‰è‚¡ç¥¨ï¼Œæœ‰ä¸¤ç§å¯èƒ½ï¼šè¦ä¹ˆæ˜¯æˆ‘æ˜¨å¤©å°±æ²¡æœ‰æŒæœ‰ï¼Œç„¶åä»Šå¤©é€‰æ‹© restï¼Œæ‰€ä»¥æˆ‘ä»Šå¤©è¿˜æ˜¯æ²¡æœ‰æŒæœ‰ï¼›è¦ä¹ˆæ˜¯æˆ‘æ˜¨å¤©æŒæœ‰è‚¡ç¥¨ï¼Œä½†æ˜¯ä»Šå¤©æˆ‘ sell äº†ï¼Œæ‰€ä»¥æˆ‘ä»Šå¤©æ²¡æœ‰æŒæœ‰è‚¡ç¥¨äº†ã€‚12dp[i][k][1] = max(dp[i-1][k][1], dp[i-1][k-1][0] - prices[i]) #max( é€‰æ‹© rest , é€‰æ‹© buy )è§£é‡Šï¼šä»Šå¤©æˆ‘æŒæœ‰ç€è‚¡ç¥¨ï¼Œæœ‰ä¸¤ç§å¯èƒ½ï¼šè¦ä¹ˆæˆ‘æ˜¨å¤©å°±æŒæœ‰ç€è‚¡ç¥¨ï¼Œç„¶åä»Šå¤©é€‰æ‹© restï¼Œæ‰€ä»¥æˆ‘ä»Šå¤©è¿˜æŒæœ‰ç€è‚¡ç¥¨ï¼›è¦ä¹ˆæˆ‘æ˜¨å¤©æœ¬æ²¡æœ‰æŒæœ‰ï¼Œä½†ä»Šå¤©æˆ‘é€‰æ‹© buyï¼Œæ‰€ä»¥ä»Šå¤©æˆ‘å°±æŒæœ‰è‚¡ç¥¨äº†ã€‚è¿™ä¸ªè§£é‡Šåº”è¯¥å¾ˆæ¸…æ¥šäº†ï¼Œå¦‚æœ buyï¼Œå°±è¦ä»åˆ©æ¶¦ä¸­å‡å» prices[i]ï¼Œå¦‚æœ sellï¼Œå°±è¦ç»™åˆ©æ¶¦å¢åŠ  prices[i]ã€‚ä»Šå¤©çš„æœ€å¤§åˆ©æ¶¦å°±æ˜¯è¿™ä¸¤ç§å¯èƒ½é€‰æ‹©ä¸­è¾ƒå¤§çš„é‚£ä¸ªã€‚è€Œä¸”æ³¨æ„ k çš„é™åˆ¶å’Œå˜åŒ–ï¼Œæ ¹æ®é¢˜æ„ï¼Œ**å…è®¸å®Œæˆä¸€ç¬”äº¤æ˜“ï¼ˆå³ä¹°å…¥å’Œå–å‡ºä¸€æ”¯è‚¡ç¥¨ä¸€æ¬¡ï¼‰ï¼Œ**æˆ‘ä»¬åœ¨é€‰æ‹© buy çš„æ—¶å€™ï¼ŒæŠŠ k å‡å°äº† 1ï¼Œæ‰€ä»¥åœ¨å–å‡ºçš„æ—¶å€™å°±ä¸ç”¨å‡å°1äº†ï¼Œå¾ˆå¥½ç†è§£å§ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨ sell çš„æ—¶å€™å‡ 1ï¼Œä¸€æ ·çš„ã€‚**ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†åŠ¨æ€è§„åˆ’ä¸­æœ€å›°éš¾çš„ä¸€æ­¥ï¼šçŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚å¦‚æœä¹‹å‰çš„å†…å®¹ä½ éƒ½å¯ä»¥ç†è§£ï¼Œé‚£ä¹ˆä½ å·²ç»å¯ä»¥ç§’æ€æ‰€æœ‰é—®é¢˜äº†ï¼Œåªè¦å¥—è¿™ä¸ªæ¡†æ¶å°±è¡Œäº†ã€‚ä¸è¿‡è¿˜å·®æœ€åä¸€ç‚¹ç‚¹ï¼Œå°±æ˜¯å®šä¹‰ base caseï¼Œå³æœ€ç®€å•çš„æƒ…å†µã€‚12345678dp[-1][k][0] = 0è§£é‡Šï¼šå› ä¸º i æ˜¯ä» 0 å¼€å§‹çš„ï¼Œæ‰€ä»¥ i = -1 æ„å‘³ç€è¿˜æ²¡æœ‰å¼€å§‹ï¼Œè¿™æ—¶å€™çš„åˆ©æ¶¦å½“ç„¶æ˜¯ 0 ã€‚dp[-1][k][1] = -infinityè§£é‡Šï¼šè¿˜æ²¡å¼€å§‹çš„æ—¶å€™ï¼Œæ˜¯ä¸å¯èƒ½æŒæœ‰è‚¡ç¥¨çš„ï¼Œç”¨è´Ÿæ— ç©·è¡¨ç¤ºè¿™ç§ä¸å¯èƒ½ã€‚dp[i][0][0] = 0è§£é‡Šï¼šå› ä¸º k æ˜¯ä» 1 å¼€å§‹çš„ï¼Œæ‰€ä»¥ k = 0 æ„å‘³ç€æ ¹æœ¬ä¸å…è®¸äº¤æ˜“ï¼Œè¿™æ—¶å€™åˆ©æ¶¦å½“ç„¶æ˜¯ 0 ã€‚dp[i][0][1] = -infinityè§£é‡Šï¼šä¸å…è®¸äº¤æ˜“çš„æƒ…å†µä¸‹ï¼Œæ˜¯ä¸å¯èƒ½æŒæœ‰è‚¡ç¥¨çš„ï¼Œç”¨è´Ÿæ— ç©·è¡¨ç¤ºè¿™ç§ä¸å¯èƒ½ã€‚æŠŠä¸Šé¢çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ€»ç»“ä¸€ä¸‹ï¼š123456base caseï¼šdp[-1][k][0] = dp[i][0][0] = 0dp[-1][k][1] = dp[i][0][1] = -infinityçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼šdp[i][k][0] = max(dp[i-1][k][0], dp[i-1][k][1] + prices[i])dp[i][k][1] = max(dp[i-1][k][1], dp[i-1][k-1][0] - prices[i])è¯»è€…å¯èƒ½ä¼šé—®ï¼Œè¿™ä¸ªæ•°ç»„ç´¢å¼•æ˜¯ -1 æ€ä¹ˆç¼–ç¨‹è¡¨ç¤ºå‡ºæ¥å‘¢ï¼Œè´Ÿæ— ç©·æ€ä¹ˆè¡¨ç¤ºå‘¢ï¼Ÿè¿™éƒ½æ˜¯ç»†èŠ‚é—®é¢˜ï¼Œæœ‰å¾ˆå¤šæ–¹æ³•å®ç°ã€‚ç°åœ¨å®Œæ•´çš„æ¡†æ¶å·²ç»å®Œæˆï¼Œä¸‹é¢å¼€å§‹å…·ä½“åŒ–ã€‚ä»¥ä¸Šæ˜¯labuladongè®²è§£çš„çŠ¶æ€æ–¹ç¨‹å˜åŒ–ï¼Œæˆ‘è§‰å¾—è®²çš„å¾ˆä¸é”™ï¼Œè‡³å°‘æˆ‘ä»ä¸çŸ¥é“çŠ¶æ€æ–¹ç¨‹æ˜¯ä»€ä¹ˆï¼Œåˆ°å·²ç»ç†è§£äº†ã€‚ä¸‹é¢çš„é¢˜è§£éƒ¨åˆ†ï¼Œæˆ‘æœ‰ä¿®æ”¹æˆpythonï¼Œå¹¶ä¸”æ ¹æ®è‡ªå·±èƒ½æ›´å¥½ç†è§£çš„æ–¹å¼è¿›è¡Œäº†ä¿®æ”¹ï¼Œlabuladongçš„é¢˜è§£æ˜¯é‡‡ç”¨äº†ç©ºé—´å¤æ‚åº¦O(1)çš„æ–¹æ³•ï¼Œä½¿ç”¨å›ºå®šçš„ä¸¤ä¸ªå˜é‡æ¥è½¬æ¢ã€‚è€Œæˆ‘ä¸‹é¢çš„æ–¹å¼æ˜¯dp[i][0]è¿™ç§æ–¹å¼ï¼Œè¿™ç§æ–¹å¼æˆ‘å†™çš„æ—¶å€™æ€è·¯æ›´æ¸…æ™°ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼çš„ç©ºé—´å¤æ‚åº¦è²Œä¼¼æ˜¯O(n)çš„ã€‚ä¸‰ã€ç§’æ€é¢˜ç›®ç¬¬ä¸€é¢˜ï¼Œk = 1ç›´æ¥å¥—çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œæ ¹æ® base caseï¼Œå¯ä»¥åšä¸€äº›åŒ–ç®€ï¼š123dp[i][1][0] &#x3D; max(dp[i-1][1][0], dp[i-1][1][1] + prices[i])dp[i][1][1] &#x3D; max(dp[i-1][1][1], dp[i-1][0][0] - prices[i]) &#x3D; max(dp[i-1][1][1], -prices[i])è§£é‡Šï¼šk = 0 çš„ base caseï¼Œæ‰€ä»¥ dp[i-1][0][0] = 0ã€‚ç°åœ¨å‘ç° k éƒ½æ˜¯ 1ï¼Œä¸ä¼šæ”¹å˜ï¼Œå³ k å¯¹çŠ¶æ€è½¬ç§»å·²ç»æ²¡æœ‰å½±å“äº†ã€‚å¯ä»¥è¿›è¡Œè¿›ä¸€æ­¥åŒ–ç®€å»æ‰æ‰€æœ‰ kï¼š12dp[i][0] &#x3D; max(dp[i-1][0], dp[i-1][1] + prices[i])dp[i][1] &#x3D; max(dp[i-1][1], -prices[i])ç›´æ¥å†™å‡ºä»£ç ï¼š123456n = len(prices)dp = [[]]for i in range(n): dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i]) dp[i][1] = max(dp[i-1][1], -prices[i])return dp[n - 1][0]æ˜¾ç„¶ i = 0 æ—¶ dp[i-1] æ˜¯ä¸åˆæ³•çš„ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å¯¹ i çš„ base case è¿›è¡Œå¤„ç†ã€‚å¯ä»¥è¿™æ ·å¤„ç†ï¼š1234567891011121314151617for i in range(n): if i - 1 == -1: dp[i][0] = 0; # è§£é‡Šï¼š # dp[i][0] = max(dp[-1][0], dp[-1][1] + prices[i]) # = max(0, -infinity + prices[i]) = 0 dp[i][1] = -prices[i] #è§£é‡Šï¼š # dp[i][1] = max(dp[-1][1], dp[-1][0] - prices[i]) # = max(-infinity, 0 - prices[i]) # = -prices[i] continue dp[i][0] = Math.max(dp[i-1][0], dp[i-1][1] + prices[i]) dp[i][1] = Math.max(dp[i-1][1], -prices[i])return dp[n - 1][0]ç¬¬ä¸€é¢˜å°±è§£å†³äº†ï¼Œä½†æ˜¯è¿™æ ·å¤„ç† base case å¾ˆéº»çƒ¦ï¼Œè€Œä¸”æ³¨æ„ä¸€ä¸‹çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œæ–°çŠ¶æ€åªå’Œç›¸é‚»çš„ä¸€ä¸ªçŠ¶æ€æœ‰å…³ï¼Œå…¶å®ä¸ç”¨æ•´ä¸ª dp æ•°ç»„ï¼Œåªéœ€è¦ä¸€ä¸ªå˜é‡å‚¨å­˜ç›¸é‚»çš„é‚£ä¸ªçŠ¶æ€å°±è¶³å¤Ÿäº†ï¼Œè¿™æ ·å¯ä»¥æŠŠç©ºé—´å¤æ‚åº¦é™åˆ° O(1):12345678910111213// k == 1def maxProfit(self, prices): n = len(prices) // base case: dp[-1][0] = 0, dp[-1][1] = -infinity dp_i_0 = 0 dp_i_1 = float('-inf'); for (int i = 0; i &lt; n; i++) &#123; // dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i]) dp_i_0 = Math.max(dp_i_0, dp_i_1 + prices[i]); // dp[i][1] = max(dp[i-1][1], -prices[i]) dp_i_1 = Math.max(dp_i_1, -prices[i]); return dp_i_0;ä¸¤ç§æ–¹å¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡è¿™ç§ç¼–ç¨‹æ–¹æ³•ç®€æ´å¾ˆå¤šã€‚ä½†æ˜¯å¦‚æœæ²¡æœ‰å‰é¢çŠ¶æ€è½¬ç§»æ–¹ç¨‹çš„å¼•å¯¼ï¼Œæ˜¯è‚¯å®šçœ‹ä¸æ‡‚çš„ã€‚åç»­çš„é¢˜ç›®ï¼Œæˆ‘ä¸»è¦å†™è¿™ç§ç©ºé—´å¤æ‚åº¦ O(1) çš„è§£æ³•ã€‚æ²¡æœ‰ä½¿ç”¨å˜é‡çš„pythonä»£ç ï¼š12345678910111213141516class Solution(object): def maxProfit(self, prices): \"\"\" :type prices: List[int] :rtype: int \"\"\" n = len(prices) if n&lt;=1: return 0 dp = [[None, None] for _ in range(n)] # base case: dp[0][0] = 0 dp[0][1] = -prices[0] for i in range(1, n): dp[i][0] = max(dp[i-1][0], dp[i-1][1]+prices[i]) dp[i][1] = max(dp[i-1][1], -prices[i]) return dp[-1][0]ç¬¬äºŒé¢˜ï¼Œk = +infinityæ¯å¤©éƒ½æœ‰ä¸‰ç§åŠ¨ä½œï¼šä¹°å…¥ï¼ˆbuyï¼‰ã€å–å‡ºï¼ˆsellï¼‰ã€æ— æ“ä½œï¼ˆrestï¼‰ã€‚å› ä¸ºä¸é™åˆ¶äº¤æ˜“æ¬¡æ•°ï¼Œå› æ­¤äº¤æ˜“æ¬¡æ•°è¿™ä¸ªå› ç´ ä¸å½±å“é¢˜ç›®ï¼Œä¸å¿…è€ƒè™‘ã€‚DP Table æ˜¯äºŒç»´çš„ï¼Œä¸¤ä¸ªç»´åº¦åˆ†åˆ«æ˜¯å¤©æ•°ï¼ˆ0,1,â€¦,n-1ï¼‰å’Œæ˜¯å¦æŒæœ‰è‚¡ç¥¨ï¼ˆ1 è¡¨æŒæœ‰ï¼Œ0 è¡¨ä¸æŒæœ‰ï¼‰ã€‚çŠ¶æ€è½¬ç§»æ–¹ç¨‹Case 1ï¼Œä»Šå¤©æˆ‘æ²¡æœ‰è‚¡ç¥¨ï¼Œæœ‰ä¸¤ç§å¯èƒ½ï¼š**æ˜¨å¤©æˆ‘æ‰‹ä¸Šå°±æ²¡æœ‰è‚¡ç¥¨ï¼Œä»Šå¤©ä¸åšä»»ä½•æ“ä½œï¼ˆrestï¼‰ï¼›æ˜¨å¤©æˆ‘æ‰‹ä¸Šæœ‰ä¸€åªè‚¡ç¥¨ï¼Œä»Šå¤©æŒ‰ç…§æ—¶ä»·å–æ‰äº†ï¼ˆsellï¼‰ï¼Œæ”¶è·äº†ä¸€ç¬”é’±Case 2ï¼Œä»Šå¤©æŒæœ‰ä¸€åªè‚¡ç¥¨ï¼Œæœ‰ä¸¤ç§å¯èƒ½ï¼šæ˜¨å¤©æˆ‘æ‰‹ä¸Šå°±æœ‰è¿™åªè‚¡ç¥¨ï¼Œä»Šå¤©ä¸åšä»»ä½•æ“ä½œï¼ˆrestï¼‰ï¼›æ˜¨å¤©æˆ‘æ²¡æœ‰è‚¡ç¥¨ï¼Œä»Šå¤©æŒ‰ç…§æ—¶ä»·ä¹°å…¥ä¸€åªï¼ˆsellï¼‰ï¼ŒèŠ±æ‰äº†ä¸€ç¬”é’±ç»¼ä¸Šï¼Œç¬¬ i å¤©çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼š12dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])dp[i][1] = max(dp[i-1][1], dp[i-1][0] - prices[i])æ³¨æ„ä¸Šé¢çš„è½¬ç§»æ–¹ç¨‹åªæ˜¯å¯¹æŸä¸€å¤©è€Œè¨€çš„ï¼Œè¦æ±‚å‡ºæ•´ä¸ª DP Table çš„çŠ¶æ€ï¼Œéœ€è¦å¯¹ i è¿›è¡Œéå†ã€‚è¾¹ç•ŒçŠ¶æ€è§‚å¯ŸçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œç¬¬ i å¤©çš„çŠ¶æ€åªç”±ç¬¬ i-1 å¤©çŠ¶æ€æ¨å¯¼è€Œæ¥ï¼Œå› æ­¤è¾¹ç•ŒçŠ¶æ€åªéœ€è¦å®šä¹‰ i=0ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€å¤©ï¼‰å³å¯ï¼š12dp[0][0] = 0 # ç¬¬ä¸€å¤©æ²¡æœ‰è‚¡ç¥¨ï¼Œè¯´æ˜æ²¡ä¹°æ²¡å–ï¼Œè·åˆ©ä¸º0dp[0][1] = -prices[0] # ç¬¬ä¸€å¤©æŒæœ‰è‚¡ç¥¨ï¼Œè¯´æ˜ä¹°å…¥äº†ï¼ŒèŠ±æ‰ä¸€ç¬”é’±ä»£ç 12345678910111213141516171819class Solution: def maxProfit(self, prices): n = len(prices) if n&lt;=1: return 0 # dp table dp = [[None, None] for _ in range(n)] \"\"\" è¾¹ç•Œæ¡ä»¶ï¼Œåˆå§‹æ¡ä»¶ ç¬¬ i å¤©çš„çŠ¶æ€åªç”±ç¬¬ i-1 å¤©çŠ¶æ€æ¨å¯¼è€Œæ¥ï¼Œå› æ­¤è¾¹ç•ŒçŠ¶æ€åªéœ€è¦å®šä¹‰ i=0ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€å¤©ï¼‰ \"\"\" dp[0][0] = 0 dp[0][1] = -prices[0] # for i in range(1, n): dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i]) dp[i][1] = max(dp[i-1][1], dp[i-1][0] - prices[i]) return dp[-1][0]# è¿”å›æœ€åä¸€å¤©ä¸”æ‰‹ä¸Šæ²¡æœ‰è‚¡ç¥¨æ—¶çš„è·åˆ©æƒ…å†µç¬¬ä¸‰é¢˜ï¼Œk = +infinity with cooldowné¢˜è§£ï¼šè¿™é“é¢˜çš„åœ¨ ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II çš„åŸºç¡€ä¸Šæ·»åŠ äº†å†·å†»æœŸçš„è¦æ±‚ï¼Œå³æ¯æ¬¡ sell ä¹‹åè¦ç­‰ä¸€å¤©æ‰èƒ½ç»§ç»­äº¤æ˜“ã€‚çŠ¶æ€è½¬ç§»æ–¹ç¨‹è¦åšä¿®æ”¹ï¼Œå¦‚æœç¬¬ i å¤©é€‰æ‹©ä¹°å…¥è‚¡ç¥¨ï¼ŒçŠ¶æ€è¦ä»ç¬¬ i-2 çš„è½¬ç§»ï¼Œè€Œä¸æ˜¯ i-1 (å› ä¸ºç¬¬ i-1 å¤©æ˜¯å†·å†»æœŸ)ã€‚å¦å¤–ï¼Œç”±äºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸­å‡ºç°äº† dp[i-2] æ¨å¯¼ dp[i-1]ï¼Œå› æ­¤çŠ¶æ€è¾¹ç•Œé™¤äº†è€ƒè™‘ i=0 å¤©ï¼Œè¿˜è¦åŠ ä¸Š i=1 å¤©çš„çŠ¶æ€ã€‚Solution å¦‚ä¸‹ä»£ç ï¼š123456789101112131415161718192021222324class Solution(object): def maxProfit(self, prices): \"\"\" :type prices: List[int] :rtype: int \"\"\" n = len(prices) if n &lt;= 1: return 0 dp = [[None, None] for _ in range(n)] \"\"\" å¦‚æœç¬¬ i å¤©é€‰æ‹©ä¹°å…¥è‚¡ç¥¨ï¼ŒçŠ¶æ€è¦ä»ç¬¬ i-2 çš„è½¬ç§»ï¼Œè€Œä¸æ˜¯ i-1 (å› ä¸ºç¬¬ i-1 å¤©æ˜¯å†·å†»æœŸ)ã€‚ å¦å¤–ï¼Œç”±äºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸­å‡ºç°äº† dp[i-2] æ¨å¯¼ dp[i-1]ï¼Œå› æ­¤çŠ¶æ€è¾¹ç•Œé™¤äº†è€ƒè™‘ i=0 å¤©ï¼Œè¿˜è¦åŠ ä¸Š i=1 å¤©çš„çŠ¶æ€ã€‚ \"\"\" dp[0][0] = 0 dp[0][1] = -prices[0] dp[1][0] = max(dp[0][0], dp[0][1] + prices[1]) dp[1][1] = max(dp[0][1], dp[0][0] - prices[1]) for i in range(2, n): dp[i][0] = max(dp[i-1][0], dp[i-1][1]+prices[i]) dp[i][1] = max(dp[i-1][1], dp[i-2][0]-prices[i]) return dp[-1][0]ç¬¬å››é¢˜ï¼Œk = +infinity with feeæ¯æ¬¡äº¤æ˜“è¦æ”¯ä»˜æ‰‹ç»­è´¹ï¼Œåªè¦æŠŠæ‰‹ç»­è´¹ä»åˆ©æ¶¦ä¸­å‡å»å³å¯ã€‚æ”¹å†™æ–¹ç¨‹ï¼š1234dp[i][0] &#x3D; max(dp[i-1][0], dp[i-1][1] + prices[i])dp[i][1] &#x3D; max(dp[i-1][1], dp[i-1][0] - prices[i] - fee)è§£é‡Šï¼šç›¸å½“äºä¹°å…¥è‚¡ç¥¨çš„ä»·æ ¼å‡é«˜äº†ã€‚åœ¨ç¬¬ä¸€ä¸ªå¼å­é‡Œå‡ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œç›¸å½“äºå–å‡ºè‚¡ç¥¨çš„ä»·æ ¼å‡å°äº†ã€‚ç›´æ¥ç¿»è¯‘æˆä»£ç ï¼š12345678910111213class Solution: def maxProfit(self, prices: List[int], fee: int) -&gt; int: n = len(prices) if n&lt;=1: return 0 dp = [[None, None] for _ in range(n)] dp[0][0] = 0 dp[0][1] = -prices[0] for i in range(1, n): dp[i][0] = max(dp[i-1][0], dp[i-1][1]+prices[i]-fee) # å–å‡ºè‚¡ç¥¨æ—¶æ³¨æ„è¦ç¼´æ‰‹ç»­è´¹ dp[i][1] = max(dp[i-1][1], dp[i-1][0]-prices[i]) return dp[-1][0]ç¬¬äº”é¢˜ï¼Œk = 2é¢˜ç›®çº¦å®šæœ€å¤šäº¤æ˜“æ¬¡æ•° k=2ï¼Œå› æ­¤äº¤æ˜“æ¬¡æ•°å¿…é¡»ä½œä¸ºä¸€ä¸ªæ–°çš„ç»´åº¦è€ƒè™‘è¿› DP Table é‡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é“é¢˜éœ€è¦ä¸‰ç»´ DP æ¥è§£å†³ã€‚ä¸‰ä¸ªç»´åº¦åˆ†åˆ«ä¸ºï¼šå¤©æ•° iï¼ˆi=0,1,â€¦,n-1ï¼‰ï¼Œä¹°å…¥è‚¡ç¥¨çš„æ¬¡æ•° jï¼ˆj=1,2,â€¦,kï¼‰å’Œæ˜¯å¦æŒæœ‰è‚¡ç¥¨ï¼ˆ1 è¡¨æŒæœ‰ï¼Œ0 è¡¨ä¸æŒæœ‰ï¼‰. ç‰¹åˆ«æ³¨æ„ä¹°å…¥è‚¡ç¥¨çš„æ¬¡æ•°ä¸º j æ—¶ï¼Œå…¶å®éšå«äº†å¦ä¸€ä¸ªä¿¡æ¯ï¼Œå°±æ˜¯å–å‡ºè‚¡ç¥¨çš„æ¬¡æ•°ä¸º j-1 æˆ– j æ¬¡ã€‚çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œè¿™é‡Œè¿˜æ˜¯æ¯”è¾ƒéš¾æ‡‚ï¼Œè¯»äº†å‡ éï¼Œæˆ‘çš„ç†è§£æ˜¯ï¼Œä¸‹é¢ç¬¬ä¸€è¡Œä»£ç ï¼Œå³è¾¹è¡¨ç¤ºçš„æ˜¯ï¼Œæ˜¨å¤©æŒæœ‰è‚¡ç¥¨ï¼Œä½†æ˜¯ä»Šå¤©æ²¡æœ‰æŒæœ‰ï¼Œæ‰€ä»¥å–æ‰ï¼Œå–æ‰æ²¡æœ‰å½±å“kçš„æ¬¡æ•°ã€‚ä½†æ˜¯ç¬¬äºŒè¡Œä»£ç çš„å³è¾¹ï¼Œæ˜¨å¤©æ²¡æœ‰æŒæœ‰è‚¡ç¥¨è€Œä»Šå¤©æœ‰æŒæœ‰ï¼Œåˆ™æ˜¯ä»Šå¤©ğŸˆ¶è´­ä¹°è‚¡ç¥¨ï¼Œæ˜¨å¤©æ²¡æœ‰è´­ä¹°çš„æƒ…å†µä¸‹ï¼Œåˆ™å¯¹åº”çš„kä¸ºk-11234dp[i][j][0] = max(dp[i-1][j][0], dp[i-1][j][1]+prices[i]) # å³è¾¹:ä»Šå¤©å–äº†æ˜¨å¤©æŒæœ‰çš„è‚¡ç¥¨ï¼Œæ‰€ä»¥ä¸¤å¤©ä¹°å…¥è‚¡ç¥¨çš„æ¬¡æ•°éƒ½æ˜¯jdp[i][j][1] = max(dp[i-1][j][1], dp[i-1][j-1][0]-prices[i]) # å³è¾¹:æ˜¨å¤©æ²¡æœ‰æŒè‚¡è€Œä»Šå¤©ä¹°å…¥ä¸€åªï¼Œæ•…æ˜¨å¤©ä¹°å…¥çš„æ¬¡æ•°æ˜¯j-1æ³¨æ„ä¸Šé¢çš„è½¬ç§»æ–¹ç¨‹åªæ˜¯ç©·ä¸¾äº†ç¬¬ä¸‰ä¸ªç»´åº¦ï¼Œè¦æ±‚å‡ºæ•´ä¸ª DP Table çš„çŠ¶æ€ï¼Œéœ€è¦å¯¹ i å’Œ j è¿›è¡Œéå†ã€‚è¾¹ç•ŒçŠ¶æ€è§‚å¯ŸçŠ¶æ€è½¬ç§»æ–¹ç¨‹çŸ¥ï¼Œè¾¹ç•ŒçŠ¶æ€éœ€è¦è€ƒè™‘ä¸¤ä¸ªæ–¹é¢ï¼ši=0 å’Œ j=012345678# j=0 for i in range(n): dp[i][0][0] = 0 # æ²¡æœ‰ä¹°å…¥è¿‡è‚¡ç¥¨ï¼Œä¸”æ‰‹å¤´æ²¡æœ‰æŒè‚¡ï¼Œåˆ™è·å–çš„åˆ©æ¶¦ä¸º0 dp[i][0][1] = -float('inf') # æ²¡æœ‰ä¹°å…¥è¿‡è‚¡ç¥¨ï¼Œä¸å¯èƒ½æŒè‚¡ï¼Œç”¨åˆ©æ¶¦è´Ÿæ— ç©·è¡¨ç¤ºè¿™ç§ä¸å¯èƒ½# i=0for j in range(1, k+1): # å‰é¢j=0å·²ç»èµ‹å€¼äº†ï¼Œè¿™é‡Œjä»1å¼€å§‹ dp[0][k][0] = 0 dp[0][k][1] = -prices[0]ç‰¹åˆ«æ³¨æ„ï¼Œä¸Šè¿°ä¸¤è½®è¾¹ç•Œå®šä¹‰æœ‰äº¤é›†â€”â€”dp[0][0][0] å’Œ dp[0][0][1] ï¼Œåè€…ä¼šå¾—åˆ°ä¸åŒçš„ç»“æœï¼Œåº”ä»¥ j=0 æ—¶èµ‹å€¼ç»“æœä¸ºå‡†ã€‚1234567891011121314151617181920class Solution: def maxProfit(self, prices: List[int]) -&gt; int: n = len(prices) if n&lt;=1: return 0 # dp table dp = [[[None, None] for _ in range(3)] for _ in range(n)] \"\"\"è¾¹ç•Œæ¡ä»¶ï¼Œåˆ†åˆ«ä¸ºi=0, k=0\"\"\" for i in range(n): dp[i][0][0] = 0 dp[i][0][1] = float('-inf') for k in range(3): dp[0][k][0] = 0 dp[0][k][1] = -prices[0] # è¿™é‡Œæ³¨æ„ï¼ši=0ï¼Œ k=0åœ¨ä¸Šé¢å·²ç»è®¡ç®—è¿‡äº†ã€‚æ‰€ä»¥è¿™é‡Œçš„ä¸‹æ ‡ä»1å¼€å§‹ for i in range(1,n): for k in range(1, 3): dp[i][k][0] = max(dp[i-1][k][0], dp[i-1][k][1] + prices[i]) dp[i][k][1] = max(dp[i-1][k][1], dp[i-1][k-1][0] - prices[i]) return dp[-1][-1][0]ç¬¬å…­é¢˜ï¼Œk = any integer**æœ‰äº†ä¸Šä¸€é¢˜ k = 2 çš„é“ºå«ï¼Œè¿™é¢˜åº”è¯¥å’Œä¸Šä¸€é¢˜çš„ç¬¬ä¸€ä¸ªè§£æ³•æ²¡å•¥åŒºåˆ«ã€‚ä½†æ˜¯å‡ºç°äº†ä¸€ä¸ªè¶…å†…å­˜çš„é”™è¯¯ï¼ŒåŸæ¥æ˜¯ä¼ å…¥çš„ k å€¼ä¼šéå¸¸å¤§ï¼Œdp æ•°ç»„å¤ªå¤§äº†ã€‚ç°åœ¨æƒ³æƒ³ï¼Œäº¤æ˜“æ¬¡æ•° k æœ€å¤šæœ‰å¤šå¤§å‘¢ï¼Ÿä¸€æ¬¡äº¤æ˜“ç”±ä¹°å…¥å’Œå–å‡ºæ„æˆï¼Œè‡³å°‘éœ€è¦ä¸¤å¤©ã€‚æ‰€ä»¥è¯´æœ‰æ•ˆçš„é™åˆ¶ k åº”è¯¥ä¸è¶…è¿‡ n/2ï¼Œå¦‚æœè¶…è¿‡ï¼Œå°±æ²¡æœ‰çº¦æŸä½œç”¨äº†ï¼Œç›¸å½“äº k = +infinityã€‚è¿™ç§æƒ…å†µæ˜¯ä¹‹å‰è§£å†³è¿‡çš„ã€‚ç›´æ¥æŠŠä¹‹å‰çš„ä»£ç é‡ç”¨ï¼š123456789101112131415161718192021222324252627282930313233343536373839class Solution(object): def maxProfit(self, k, prices): \"\"\" :type k: int :type prices: List[int] :rtype: int \"\"\" n = len(prices) if n&lt;=1: return 0 \"\"\" æ­£å¸¸äº¤æ˜“çš„æƒ…å†µä¸‹ï¼Œå®Œæˆä¸€æ¬¡äº¤æ˜“æœ€å°‘ä¹Ÿéœ€è¦ä¸¤å¤©çš„æ—¶é—´ã€‚æ‰€ä»¥æœ‰æ•ˆçš„äº¤æ˜“æ¬¡æ•°åº”è¯¥å°äºç­‰äº n//2 å¦‚æœå¤§äº n//2 ï¼Œåˆ™æ­¤ç§æƒ…å†µé€€åŒ–ä¸ºå¯äº¤æ˜“ä»»æ„æ¬¡çš„æƒ…å†µ \"\"\" if k &gt; n // 2: dp_1 = [[None, None] for _ in range(n)] # # è¾¹ç•Œæ¡ä»¶ dp_1[0][0] = 0 dp_1[0][1] = -prices[0] for i in range(1, n): dp_1[i][0] = max(dp_1[i - 1][0], dp_1[i - 1][1] + prices[i]) dp_1[i][1] = max(dp_1[i - 1][1], dp_1[i - 1][0] - prices[i]) return dp_1[-1][0] else: dp_2 = [[[None, None] for _ in range(k+1)] for _ in range(n)] \"\"\"è¾¹ç•Œæ¡ä»¶ï¼Œåˆ†åˆ«ä¸ºi=0, k=0\"\"\" for i in range(n): dp_2[i][0][0] = 0 dp_2[i][0][1] = float('-inf') for k in range(k+1): dp_2[0][k][0] = 0 dp_2[0][k][1] = -prices[0] for i in range(1, n): for k in range(1, k+1): dp_2[i][k][0] = max(dp_2[i-1][k][0], dp_2[i-1][k][1] + prices[i]) dp_2[i][k][1] = max(dp_2[i-1][k][1], dp_2[i-1][k-1][0] - prices[i]) return dp_2[-1][-1][0]è‡³æ­¤ï¼Œ6 é“é¢˜ç›®é€šè¿‡ä¸€ä¸ªçŠ¶æ€è½¬ç§»æ–¹ç¨‹å…¨éƒ¨è§£å†³ã€‚å››ã€æœ€åæ€»ç»“æœ¬æ–‡ç»™å¤§å®¶è®²äº†å¦‚ä½•é€šè¿‡çŠ¶æ€è½¬ç§»çš„æ–¹æ³•è§£å†³å¤æ‚çš„é—®é¢˜ï¼Œç”¨ä¸€ä¸ªçŠ¶æ€è½¬ç§»æ–¹ç¨‹ç§’æ€äº† 6 é“è‚¡ç¥¨ä¹°å–é—®é¢˜ï¼Œç°åœ¨æƒ³æƒ³ï¼Œå…¶å®ä¹Ÿä¸ç®—éš¾å¯¹å§ï¼Ÿè¿™å·²ç»å±äºåŠ¨æ€è§„åˆ’é—®é¢˜ä¸­è¾ƒå›°éš¾çš„äº†ã€‚å…³é”®å°±åœ¨äºåˆ—ä¸¾å‡ºæ‰€æœ‰å¯èƒ½çš„ã€ŒçŠ¶æ€ã€ï¼Œç„¶åæƒ³æƒ³æ€ä¹ˆç©·ä¸¾æ›´æ–°è¿™äº›ã€ŒçŠ¶æ€ã€ã€‚ä¸€èˆ¬ç”¨ä¸€ä¸ªå¤šç»´ dp æ•°ç»„å‚¨å­˜è¿™äº›çŠ¶æ€ï¼Œä» base case å¼€å§‹å‘åæ¨è¿›ï¼Œæ¨è¿›åˆ°æœ€åçš„çŠ¶æ€ï¼Œå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç­”æ¡ˆã€‚æƒ³æƒ³è¿™ä¸ªè¿‡ç¨‹ï¼Œä½ æ˜¯ä¸æ˜¯æœ‰ç‚¹ç†è§£ã€ŒåŠ¨æ€è§„åˆ’ã€è¿™ä¸ªåè¯çš„æ„ä¹‰äº†å‘¢ï¼Ÿ","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"åŠ¨æ€è§„åˆ’","slug":"åŠ¨æ€è§„åˆ’","permalink":"cpeixin.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"}]},{"title":"Apache Flinkç»“åˆKafkaæ„å»ºç«¯åˆ°ç«¯çš„Exactly-Onceå¤„ç†","slug":"Apache-Flinkç»“åˆKafkaæ„å»ºç«¯åˆ°ç«¯çš„Exactly-Onceå¤„ç†","date":"2019-07-03T17:06:47.000Z","updated":"2020-07-03T17:07:49.898Z","comments":true,"path":"2019/07/04/Apache-Flinkç»“åˆKafkaæ„å»ºç«¯åˆ°ç«¯çš„Exactly-Onceå¤„ç†/","link":"","permalink":"cpeixin.cn/2019/07/04/Apache-Flink%E7%BB%93%E5%90%88Kafka%E6%9E%84%E5%BB%BA%E7%AB%AF%E5%88%B0%E7%AB%AF%E7%9A%84Exactly-Once%E5%A4%84%E7%90%86/","excerpt":"","text":"Apache Flinkè‡ª2017å¹´12æœˆå‘å¸ƒçš„1.4.0ç‰ˆæœ¬å¼€å§‹ï¼Œä¸ºæµè®¡ç®—å¼•å…¥äº†ä¸€ä¸ªé‡è¦çš„é‡Œç¨‹ç¢‘ç‰¹æ€§ï¼šTwoPhaseCommitSinkFunctionï¼ˆç›¸å…³çš„Jiraï¼‰ã€‚å®ƒæå–äº†ä¸¤é˜¶æ®µæäº¤åè®®çš„é€šç”¨é€»è¾‘ï¼Œä½¿å¾—é€šè¿‡Flinkæ¥æ„å»ºç«¯åˆ°ç«¯çš„Exactly-Onceç¨‹åºæˆä¸ºå¯èƒ½ã€‚åŒæ—¶æ”¯æŒä¸€äº›æ•°æ®æºï¼ˆsourceï¼‰å’Œè¾“å‡ºç«¯ï¼ˆsinkï¼‰ï¼ŒåŒ…æ‹¬Apache Kafka 0.11åŠæ›´é«˜ç‰ˆæœ¬ã€‚å®ƒæä¾›äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œç”¨æˆ·åªéœ€è¦å®ç°å°‘æ•°æ–¹æ³•å°±èƒ½å®ç°ç«¯åˆ°ç«¯çš„Exactly-Onceè¯­ä¹‰ã€‚æœ‰å…³TwoPhaseCommitSinkFunctionçš„ä½¿ç”¨è¯¦è§æ–‡æ¡£: TwoPhaseCommitSinkFunctionã€‚æˆ–è€…å¯ä»¥ç›´æ¥é˜…è¯»Kafka 0.11 sinkçš„æ–‡æ¡£: kafkaã€‚æ¥ä¸‹æ¥ä¼šè¯¦ç»†åˆ†æè¿™ä¸ªæ–°åŠŸèƒ½ä»¥åŠFlinkçš„å®ç°é€»è¾‘ï¼Œåˆ†ä¸ºå¦‚ä¸‹å‡ ç‚¹ã€‚æè¿°Flink checkpointæœºåˆ¶æ˜¯å¦‚ä½•ä¿è¯Flinkç¨‹åºç»“æœçš„Exactly-Onceçš„æ˜¾ç¤ºFlinkå¦‚ä½•é€šè¿‡ä¸¤é˜¶æ®µæäº¤åè®®ä¸æ•°æ®æºå’Œæ•°æ®è¾“å‡ºç«¯äº¤äº’ï¼Œä»¥æä¾›ç«¯åˆ°ç«¯çš„Exactly-Onceä¿è¯é€šè¿‡ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨TwoPhaseCommitSinkFunctionå®ç°Exactly-Onceçš„æ–‡ä»¶è¾“å‡ºApache Flinkåº”ç”¨ç¨‹åºä¸­çš„Exactly-Onceè¯­ä¹‰å½“æˆ‘ä»¬è¯´ã€Exactly-Onceã€æ—¶ï¼ŒæŒ‡çš„æ˜¯æ¯ä¸ªè¾“å…¥çš„äº‹ä»¶åªå½±å“æœ€ç»ˆç»“æœä¸€æ¬¡ã€‚å³ä½¿æœºå™¨æˆ–è½¯ä»¶å‡ºç°æ•…éšœï¼Œæ—¢æ²¡æœ‰é‡å¤æ•°æ®ï¼Œä¹Ÿä¸ä¼šä¸¢æ•°æ®ã€‚Flinkå¾ˆä¹…ä¹‹å‰å°±æä¾›äº†Exactly-Onceè¯­ä¹‰ã€‚åœ¨è¿‡å»å‡ å¹´ä¸­ï¼Œæˆ‘ä»¬å¯¹Flinkçš„checkpointæœºåˆ¶æœ‰è¿‡æ·±å…¥çš„æè¿°ï¼Œè¿™æ˜¯Flinkæœ‰èƒ½åŠ›æä¾›Exactly-Onceè¯­ä¹‰çš„æ ¸å¿ƒã€‚Flinkæ–‡æ¡£è¿˜æä¾›äº†è¯¥åŠŸèƒ½çš„å…¨é¢æ¦‚è¿°ã€‚åœ¨ç»§ç»­ä¹‹å‰ï¼Œå…ˆçœ‹ä¸‹å¯¹checkpointæœºåˆ¶çš„ç®€è¦ä»‹ç»ï¼Œè¿™å¯¹ç†è§£åé¢çš„ä¸»é¢˜è‡³å…³é‡è¦ã€‚ä¸€æ¬¡checkpointæ˜¯ä»¥ä¸‹å†…å®¹çš„ä¸€è‡´æ€§å¿«ç…§ï¼šåº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€, eg: pv{â€˜app_1â€™:5000, â€˜app_2â€™:6000}è¾“å…¥æµçš„ä½ç½®, eg: offset:200Flinkå¯ä»¥é…ç½®ä¸€ä¸ªå›ºå®šçš„æ—¶é—´ç‚¹ï¼Œå®šæœŸäº§ç”Ÿcheckpointï¼Œå°†checkpointçš„æ•°æ®å†™å…¥æŒä¹…å­˜å‚¨ç³»ç»Ÿï¼Œä¾‹å¦‚S3æˆ–HDFSã€‚å°†checkpointæ•°æ®å†™å…¥æŒä¹…å­˜å‚¨æ˜¯å¼‚æ­¥å‘ç”Ÿçš„ï¼Œè¿™æ„å‘³ç€Flinkåº”ç”¨ç¨‹åºåœ¨checkpointè¿‡ç¨‹ä¸­å¯ä»¥ç»§ç»­å¤„ç†æ•°æ®ã€‚å¦‚æœå‘ç”Ÿæœºå™¨æˆ–è½¯ä»¶æ•…éšœï¼Œé‡æ–°å¯åŠ¨åï¼ŒFlinkåº”ç”¨ç¨‹åºå°†ä»æœ€æ–°çš„checkpointç‚¹æ¢å¤å¤„ç†ï¼› Flinkä¼šæ¢å¤åº”ç”¨ç¨‹åºçŠ¶æ€ï¼Œå°†è¾“å…¥æµå›æ»šåˆ°ä¸Šæ¬¡checkpointä¿å­˜çš„ä½ç½®ï¼Œç„¶åé‡æ–°å¼€å§‹è¿è¡Œã€‚è¿™æ„å‘³ç€Flinkå¯ä»¥åƒä»æœªå‘ç”Ÿè¿‡æ•…éšœä¸€æ ·è®¡ç®—ç»“æœã€‚åœ¨Flink 1.4.0ä¹‹å‰ï¼ŒExactly-Onceè¯­ä¹‰ä»…é™äºFlinkåº”ç”¨ç¨‹åºå†…éƒ¨ï¼Œå¹¶æ²¡æœ‰æ‰©å±•åˆ°Flinkæ•°æ®å¤„ç†å®Œåå‘é€çš„å¤§å¤šæ•°å¤–éƒ¨ç³»ç»Ÿã€‚Flinkåº”ç”¨ç¨‹åºä¸å„ç§æ•°æ®è¾“å‡ºç«¯è¿›è¡Œäº¤äº’ï¼Œå¼€å‘äººå‘˜éœ€è¦æœ‰èƒ½åŠ›è‡ªå·±ç»´æŠ¤ç»„ä»¶çš„ä¸Šä¸‹æ–‡æ¥ä¿è¯Exactly-Onceè¯­ä¹‰ã€‚ä¸ºäº†æä¾›ç«¯åˆ°ç«¯çš„Exactly-Onceè¯­ä¹‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé™¤äº†Flinkåº”ç”¨ç¨‹åºå†…éƒ¨ï¼ŒFlinkå†™å…¥çš„å¤–éƒ¨ç³»ç»Ÿä¹Ÿéœ€è¦èƒ½æ»¡è¶³Exactly-Onceè¯­ä¹‰ ï¼Œè¿™äº›å¤–éƒ¨ç³»ç»Ÿå¿…é¡»æä¾›æäº¤æˆ–å›æ»šçš„æ–¹æ³•ï¼Œç„¶åé€šè¿‡Flinkçš„checkpointæœºåˆ¶æ¥åè°ƒã€‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåè°ƒæäº¤å’Œå›æ»šçš„å¸¸ç”¨æ–¹æ³•æ˜¯ä¸¤é˜¶æ®µæäº¤åè®®ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºFlinkçš„TwoPhaseCommitSinkFunctionæ˜¯å¦‚ä½•åˆ©ç”¨ä¸¤é˜¶æ®µæäº¤åè®®æ¥æä¾›ç«¯åˆ°ç«¯çš„Exactly-Onceè¯­ä¹‰ã€‚Flinkåº”ç”¨ç¨‹åºç«¯åˆ°ç«¯çš„Exactly-Onceè¯­ä¹‰æˆ‘ä»¬å°†ä»‹ç»ä¸¤é˜¶æ®µæäº¤åè®®ï¼Œä»¥åŠå®ƒå¦‚ä½•åœ¨ä¸€ä¸ªè¯»å†™Kafkaçš„Flinkç¨‹åºä¸­å®ç°ç«¯åˆ°ç«¯çš„Exactly-Onceè¯­ä¹‰ã€‚Kafkaæ˜¯ä¸€ä¸ªæµè¡Œçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œç»å¸¸ä¸Flinkä¸€èµ·ä½¿ç”¨ã€‚Kafkaåœ¨æœ€è¿‘çš„0.11ç‰ˆæœ¬ä¸­æ·»åŠ äº†å¯¹äº‹åŠ¡çš„æ”¯æŒã€‚è¿™æ„å‘³ç€ç°åœ¨é€šè¿‡Flinkè¯»å†™Kafakaï¼Œå¹¶æä¾›ç«¯åˆ°ç«¯çš„Exactly-Onceè¯­ä¹‰æœ‰äº†å¿…è¦çš„æ”¯æŒã€‚Flinkå¯¹ç«¯åˆ°ç«¯çš„Exactly-Onceè¯­ä¹‰çš„æ”¯æŒä¸ä»…å±€é™äºKafkaï¼Œæ‚¨å¯ä»¥å°†å®ƒä¸ä»»ä½•ä¸€ä¸ªæä¾›äº†å¿…è¦çš„åè°ƒæœºåˆ¶çš„æº/è¾“å‡ºç«¯ä¸€èµ·ä½¿ç”¨ã€‚ä¾‹å¦‚Pravegaï¼Œæ¥è‡ªDELL/EMCçš„å¼€æºæµåª’ä½“å­˜å‚¨ç³»ç»Ÿï¼Œé€šè¿‡Flinkçš„TwoPhaseCommitSinkFunctionä¹Ÿèƒ½æ”¯æŒç«¯åˆ°ç«¯çš„Exactly-Onceè¯­ä¹‰ã€‚åœ¨ä»Šå¤©è®¨è®ºçš„è¿™ä¸ªç¤ºä¾‹ç¨‹åºä¸­ï¼Œæˆ‘ä»¬æœ‰ï¼šä»Kafkaè¯»å–çš„æ•°æ®æºï¼ˆFlinkå†…ç½®çš„KafkaConsumerï¼‰çª—å£èšåˆå°†æ•°æ®å†™å›Kafkaçš„æ•°æ®è¾“å‡ºç«¯ï¼ˆFlinkå†…ç½®çš„KafkaProducerï¼‰è¦ä½¿æ•°æ®è¾“å‡ºç«¯æä¾›Exactly-Onceä¿è¯ï¼Œå®ƒå¿…é¡»å°†æ‰€æœ‰æ•°æ®é€šè¿‡ä¸€ä¸ªäº‹åŠ¡æäº¤ç»™Kafkaã€‚æäº¤æ†ç»‘äº†ä¸¤ä¸ªcheckpointä¹‹é—´çš„æ‰€æœ‰è¦å†™å…¥çš„æ•°æ®ã€‚è¿™å¯ç¡®ä¿åœ¨å‘ç”Ÿæ•…éšœæ—¶èƒ½å›æ»šå†™å…¥çš„æ•°æ®ã€‚ä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä¼šæœ‰å¤šä¸ªå¹¶å‘è¿è¡Œçš„å†™å…¥ä»»åŠ¡çš„ï¼Œç®€å•çš„æäº¤æˆ–å›æ»šæ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºæ‰€æœ‰ç»„ä»¶å¿…é¡»åœ¨æäº¤æˆ–å›æ»šæ—¶â€œä¸€è‡´â€æ‰èƒ½ç¡®ä¿ä¸€è‡´çš„ç»“æœã€‚Flinkä½¿ç”¨ä¸¤é˜¶æ®µæäº¤åè®®åŠé¢„æäº¤é˜¶æ®µæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨checkpointå¼€å§‹çš„æ—¶å€™ï¼Œå³ä¸¤é˜¶æ®µæäº¤åè®®çš„â€œé¢„æäº¤â€é˜¶æ®µã€‚å½“checkpointå¼€å§‹æ—¶ï¼ŒFlinkçš„JobManagerä¼šå°†checkpoint barrierï¼ˆå°†æ•°æ®æµä¸­çš„è®°å½•åˆ†ä¸ºè¿›å…¥å½“å‰checkpointä¸è¿›å…¥ä¸‹ä¸€ä¸ªcheckpointï¼‰æ³¨å…¥æ•°æ®æµã€‚brarrieråœ¨operatorä¹‹é—´ä¼ é€’ã€‚å¯¹äºæ¯ä¸€ä¸ªoperatorï¼Œå®ƒè§¦å‘operatorçš„çŠ¶æ€å¿«ç…§å†™å…¥åˆ°state backendã€‚æ•°æ®æºä¿å­˜äº†æ¶ˆè´¹Kafkaçš„åç§»é‡(offset)ï¼Œä¹‹åå°†checkpoint barrierä¼ é€’ç»™ä¸‹ä¸€ä¸ªoperatorã€‚è¿™ç§æ–¹å¼ä»…é€‚ç”¨äºoperatorå…·æœ‰ã€å†…éƒ¨ã€çŠ¶æ€ã€‚æ‰€è°“å†…éƒ¨çŠ¶æ€ï¼Œæ˜¯æŒ‡Flink state backendä¿å­˜å’Œç®¡ç†çš„ã€‚ä¾‹å¦‚ï¼Œç¬¬äºŒä¸ªoperatorä¸­windowèšåˆç®—å‡ºæ¥çš„sumå€¼ã€‚å½“ä¸€ä¸ªè¿›ç¨‹æœ‰å®ƒçš„å†…éƒ¨çŠ¶æ€çš„æ—¶å€™ï¼Œé™¤äº†åœ¨checkpointä¹‹å‰éœ€è¦å°†æ•°æ®å˜æ›´å†™å…¥åˆ°state backendï¼Œä¸éœ€è¦åœ¨é¢„æäº¤é˜¶æ®µæ‰§è¡Œä»»ä½•å…¶ä»–æ“ä½œã€‚Flinkè´Ÿè´£åœ¨checkpointæˆåŠŸçš„æƒ…å†µä¸‹æ­£ç¡®æäº¤è¿™äº›å†™å…¥ï¼Œæˆ–è€…åœ¨å‡ºç°æ•…éšœæ—¶ä¸­æ­¢è¿™äº›å†™å…¥ã€‚Flinkåº”ç”¨ç¨‹åºå¯åŠ¨é¢„æäº¤é˜¶æ®µä½†æ˜¯ï¼Œå½“è¿›ç¨‹å…·æœ‰ã€å¤–éƒ¨ã€çŠ¶æ€æ—¶ï¼Œéœ€è¦ä½œäº›é¢å¤–çš„å¤„ç†ã€‚å¤–éƒ¨çŠ¶æ€é€šå¸¸ä»¥å†™å…¥å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚Kafkaï¼‰çš„å½¢å¼å‡ºç°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†æä¾›Exactly-Onceä¿è¯ï¼Œå¤–éƒ¨ç³»ç»Ÿå¿…é¡»æ”¯æŒäº‹åŠ¡ï¼Œè¿™æ ·æ‰èƒ½å’Œä¸¤é˜¶æ®µæäº¤åè®®é›†æˆã€‚åœ¨æœ¬æ–‡ç¤ºä¾‹ä¸­çš„æ•°æ®éœ€è¦å†™å…¥Kafkaï¼Œå› æ­¤æ•°æ®è¾“å‡ºç«¯ï¼ˆData Sinkï¼‰æœ‰å¤–éƒ¨çŠ¶æ€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨é¢„æäº¤é˜¶æ®µï¼Œé™¤äº†å°†å…¶çŠ¶æ€å†™å…¥state backendä¹‹å¤–ï¼Œæ•°æ®è¾“å‡ºç«¯è¿˜å¿…é¡»é¢„å…ˆæäº¤å…¶å¤–éƒ¨äº‹åŠ¡ã€‚å½“checkpoint barrieråœ¨æ‰€æœ‰operatoréƒ½ä¼ é€’äº†ä¸€éï¼Œå¹¶ä¸”è§¦å‘çš„checkpointå›è°ƒæˆåŠŸå®Œæˆæ—¶ï¼Œé¢„æäº¤é˜¶æ®µå°±ç»“æŸäº†ã€‚æ‰€æœ‰è§¦å‘çš„çŠ¶æ€å¿«ç…§éƒ½è¢«è§†ä¸ºè¯¥checkpointçš„ä¸€éƒ¨åˆ†ã€‚checkpointæ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçŠ¶æ€çš„å¿«ç…§ï¼ŒåŒ…æ‹¬é¢„å…ˆæäº¤çš„å¤–éƒ¨çŠ¶æ€ã€‚å¦‚æœå‘ç”Ÿæ•…éšœï¼Œæˆ‘ä»¬å¯ä»¥å›æ»šåˆ°ä¸Šæ¬¡æˆåŠŸå®Œæˆå¿«ç…§çš„æ—¶é—´ç‚¹ã€‚ä¸‹ä¸€æ­¥æ˜¯é€šçŸ¥æ‰€æœ‰operatorï¼Œcheckpointå·²ç»æˆåŠŸäº†ã€‚è¿™æ˜¯ä¸¤é˜¶æ®µæäº¤åè®®çš„æäº¤é˜¶æ®µï¼ŒJobManagerä¸ºåº”ç”¨ç¨‹åºä¸­çš„æ¯ä¸ªoperatorå‘å‡ºcheckpointå·²å®Œæˆçš„å›è°ƒã€‚æ•°æ®æºå’Œwidnow operatoræ²¡æœ‰å¤–éƒ¨çŠ¶æ€ï¼Œå› æ­¤åœ¨æäº¤é˜¶æ®µï¼Œè¿™äº›operatorä¸å¿…æ‰§è¡Œä»»ä½•æ“ä½œã€‚ä½†æ˜¯ï¼Œæ•°æ®è¾“å‡ºç«¯ï¼ˆData Sinkï¼‰æ‹¥æœ‰å¤–éƒ¨çŠ¶æ€ï¼Œæ­¤æ—¶åº”è¯¥æäº¤å¤–éƒ¨äº‹åŠ¡ã€‚æˆ‘ä»¬å¯¹ä¸Šè¿°çŸ¥è¯†ç‚¹æ€»ç»“ä¸‹ï¼šä¸€æ—¦æ‰€æœ‰operatorå®Œæˆé¢„æäº¤ï¼Œå°±æäº¤ä¸€ä¸ªcommitã€‚å¦‚æœè‡³å°‘æœ‰ä¸€ä¸ªé¢„æäº¤å¤±è´¥ï¼Œåˆ™æ‰€æœ‰å…¶ä»–æäº¤éƒ½å°†ä¸­æ­¢ï¼Œæˆ‘ä»¬å°†å›æ»šåˆ°ä¸Šä¸€ä¸ªæˆåŠŸå®Œæˆçš„checkpointã€‚åœ¨é¢„æäº¤æˆåŠŸä¹‹åï¼Œæäº¤çš„commitéœ€è¦ä¿è¯æœ€ç»ˆæˆåŠŸ ï¼Œoperatorå’Œå¤–éƒ¨ç³»ç»Ÿéƒ½éœ€è¦ä¿éšœè¿™ç‚¹ã€‚å¦‚æœcommitå¤±è´¥ï¼ˆä¾‹å¦‚ï¼Œç”±äºé—´æ­‡æ€§ç½‘ç»œé—®é¢˜ï¼‰ï¼Œæ•´ä¸ªFlinkåº”ç”¨ç¨‹åºå°†å¤±è´¥ï¼Œåº”ç”¨ç¨‹åºå°†æ ¹æ®ç”¨æˆ·çš„é‡å¯ç­–ç•¥é‡æ–°å¯åŠ¨ï¼Œè¿˜ä¼šå°è¯•å†æäº¤ã€‚è¿™ä¸ªè¿‡ç¨‹è‡³å…³é‡è¦ï¼Œå› ä¸ºå¦‚æœcommitæœ€ç»ˆæ²¡æœ‰æˆåŠŸï¼Œå°†ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šæ‰€æœ‰operatoréƒ½åŒæ„checkpointçš„æœ€ç»ˆç»“æœï¼šæ‰€æœ‰operatoréƒ½åŒæ„æ•°æ®å·²æäº¤ï¼Œæˆ–æäº¤è¢«ä¸­æ­¢å¹¶å›æ»šã€‚åœ¨Flinkä¸­å®ç°ä¸¤é˜¶æ®µæäº¤Operatorå®Œæ•´çš„å®ç°ä¸¤é˜¶æ®µæäº¤åè®®å¯èƒ½æœ‰ç‚¹å¤æ‚ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆFlinkå°†å®ƒçš„é€šç”¨é€»è¾‘æå–åˆ°æŠ½è±¡ç±»TwoPhaseCommitSinkFunctionä¸­çš„åŸå› ã€‚æ¥ä¸‹æ¥åŸºäºè¾“å‡ºåˆ°æ–‡ä»¶çš„ç®€å•ç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•ä½¿ç”¨TwoPhaseCommitSinkFunctionã€‚ç”¨æˆ·åªéœ€è¦å®ç°å››ä¸ªå‡½æ•°ï¼Œå°±èƒ½ä¸ºæ•°æ®è¾“å‡ºç«¯å®ç°Exactly-Onceè¯­ä¹‰ï¼šbeginTransaction - åœ¨äº‹åŠ¡å¼€å§‹å‰ï¼Œæˆ‘ä»¬åœ¨ç›®æ ‡æ–‡ä»¶ç³»ç»Ÿçš„ä¸´æ—¶ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ã€‚éšåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤„ç†æ•°æ®æ—¶å°†æ•°æ®å†™å…¥æ­¤æ–‡ä»¶ã€‚preCommit - åœ¨é¢„æäº¤é˜¶æ®µï¼Œæˆ‘ä»¬åˆ·æ–°æ–‡ä»¶åˆ°å­˜å‚¨ï¼Œå…³é—­æ–‡ä»¶ï¼Œä¸å†é‡æ–°å†™å…¥ã€‚æˆ‘ä»¬è¿˜å°†ä¸ºå±äºä¸‹ä¸€ä¸ªcheckpointçš„ä»»ä½•åç»­æ–‡ä»¶å†™å…¥å¯åŠ¨ä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚commit - åœ¨æäº¤é˜¶æ®µï¼Œæˆ‘ä»¬å°†é¢„æäº¤é˜¶æ®µçš„æ–‡ä»¶åŸå­åœ°ç§»åŠ¨åˆ°çœŸæ­£çš„ç›®æ ‡ç›®å½•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¼šå¢åŠ è¾“å‡ºæ•°æ®å¯è§æ€§çš„å»¶è¿Ÿã€‚abort - åœ¨ä¸­æ­¢é˜¶æ®µï¼Œæˆ‘ä»¬åˆ é™¤ä¸´æ—¶æ–‡ä»¶ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœå‘ç”Ÿä»»ä½•æ•…éšœï¼ŒFlinkä¼šå°†åº”ç”¨ç¨‹åºçš„çŠ¶æ€æ¢å¤åˆ°æœ€æ–°çš„ä¸€æ¬¡checkpointç‚¹ã€‚ä¸€ç§æç«¯çš„æƒ…å†µæ˜¯ï¼Œé¢„æäº¤æˆåŠŸäº†ï¼Œä½†åœ¨è¿™æ¬¡commitçš„é€šçŸ¥åˆ°è¾¾operatorä¹‹å‰å‘ç”Ÿäº†æ•…éšœã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒFlinkä¼šå°†operatorçš„çŠ¶æ€æ¢å¤åˆ°å·²ç»é¢„æäº¤ï¼Œä½†å°šæœªçœŸæ­£æäº¤çš„çŠ¶æ€ã€‚æˆ‘ä»¬éœ€è¦åœ¨é¢„æäº¤é˜¶æ®µä¿å­˜è¶³å¤Ÿå¤šçš„ä¿¡æ¯åˆ°checkpointçŠ¶æ€ä¸­ï¼Œä»¥ä¾¿åœ¨é‡å¯åèƒ½æ­£ç¡®çš„ä¸­æ­¢æˆ–æäº¤äº‹åŠ¡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿™äº›ä¿¡æ¯æ˜¯ä¸´æ—¶æ–‡ä»¶å’Œç›®æ ‡ç›®å½•çš„è·¯å¾„ã€‚TwoPhaseCommitSinkFunctionå·²ç»æŠŠè¿™ç§æƒ…å†µè€ƒè™‘åœ¨å†…äº†ï¼Œå¹¶ä¸”åœ¨ä»checkpointç‚¹æ¢å¤çŠ¶æ€æ—¶ï¼Œä¼šä¼˜å…ˆå‘å‡ºä¸€ä¸ªcommitã€‚æˆ‘ä»¬éœ€è¦ä»¥å¹‚ç­‰æ–¹å¼å®ç°æäº¤ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™å¹¶ä¸éš¾ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¯†åˆ«å‡ºè¿™æ ·çš„æƒ…å†µï¼šä¸´æ—¶æ–‡ä»¶ä¸åœ¨ä¸´æ—¶ç›®å½•ä¸­ï¼Œä½†å·²ç»ç§»åŠ¨åˆ°ç›®æ ‡ç›®å½•äº†ã€‚åœ¨TwoPhaseCommitSinkFunctionä¸­ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–è¾¹ç•Œæƒ…å†µä¹Ÿä¼šè€ƒè™‘åœ¨å†…ï¼Œè¯·å‚è€ƒFlinkæ–‡æ¡£äº†è§£æ›´å¤šä¿¡æ¯ã€‚æ€»ç»“æ€»ç»“ä¸‹æœ¬æ–‡æ¶‰åŠçš„ä¸€äº›è¦ç‚¹ï¼šFlinkçš„checkpointæœºåˆ¶æ˜¯æ”¯æŒä¸¤é˜¶æ®µæäº¤åè®®å¹¶æä¾›ç«¯åˆ°ç«¯çš„Exactly-Onceè¯­ä¹‰çš„åŸºç¡€ã€‚è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯: Flinkä¸åƒå…¶ä»–ä¸€äº›ç³»ç»Ÿé‚£æ ·ï¼Œé€šè¿‡ç½‘ç»œä¼ è¾“å­˜å‚¨æ•°æ® - ä¸éœ€è¦åƒå¤§å¤šæ•°æ‰¹å¤„ç†ç¨‹åºé‚£æ ·å°†è®¡ç®—çš„æ¯ä¸ªé˜¶æ®µå†™å…¥ç£ç›˜ã€‚Flinkçš„TwoPhaseCommitSinkFunctionæå–äº†ä¸¤é˜¶æ®µæäº¤åè®®çš„é€šç”¨é€»è¾‘ï¼ŒåŸºäºæ­¤å°†Flinkå’Œæ”¯æŒäº‹åŠ¡çš„å¤–éƒ¨ç³»ç»Ÿç»“åˆï¼Œæ„å»ºç«¯åˆ°ç«¯çš„Exactly-Onceæˆä¸ºå¯èƒ½ã€‚ä»Flink 1.4.0å¼€å§‹ï¼ŒPravegaå’ŒKafka 0.11 produceréƒ½æä¾›äº†Exactly-Onceè¯­ä¹‰ï¼›Kafkaåœ¨0.11ç‰ˆæœ¬é¦–æ¬¡å¼•å…¥äº†äº‹åŠ¡ï¼Œä¸ºåœ¨Flinkç¨‹åºä¸­ä½¿ç”¨Kafka produceræä¾›Exactly-Onceè¯­ä¹‰æä¾›äº†å¯èƒ½æ€§ã€‚Kafaka 0.11 producerçš„äº‹åŠ¡æ˜¯åœ¨TwoPhaseCommitSinkFunctionåŸºç¡€ä¸Šå®ç°çš„ï¼Œå’Œat-least-once producerç›¸æ¯”åªå¢åŠ äº†éå¸¸ä½çš„å¼€é”€ã€‚è¿™æ˜¯ä¸ªä»¤äººå…´å¥‹çš„åŠŸèƒ½ï¼ŒæœŸå¾…Flink TwoPhaseCommitSinkFunctionåœ¨æœªæ¥æ”¯æŒæ›´å¤šçš„æ•°æ®æ¥æ”¶ç«¯ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"flink","slug":"flink","permalink":"cpeixin.cn/tags/flink/"}]},{"title":"ä¸€æ–‡ææ‡‚Flinkå†…éƒ¨çš„Exactly Onceå’ŒAt Least Once","slug":"ä¸€æ–‡ææ‡‚Flinkå†…éƒ¨çš„Exactly-Onceå’ŒAt-Least-Once","date":"2019-07-03T13:24:51.000Z","updated":"2020-07-03T13:26:50.945Z","comments":true,"path":"2019/07/03/ä¸€æ–‡ææ‡‚Flinkå†…éƒ¨çš„Exactly-Onceå’ŒAt-Least-Once/","link":"","permalink":"cpeixin.cn/2019/07/03/%E4%B8%80%E6%96%87%E6%90%9E%E6%87%82Flink%E5%86%85%E9%83%A8%E7%9A%84Exactly-Once%E5%92%8CAt-Least-Once/","excerpt":"","text":"å¤§çº²ä»‹ç»CheckPointå¦‚ä½•ä¿éšœFlinkä»»åŠ¡çš„é«˜å¯ç”¨CheckPointä¸­çš„çŠ¶æ€ç®€ä»‹å¦‚ä½•å®ç°å…¨åŸŸä¸€è‡´çš„åˆ†å¸ƒå¼å¿«ç…§ï¼Ÿä»€ä¹ˆæ˜¯barrierï¼Ÿä»€ä¹ˆæ˜¯barrierå¯¹é½ï¼Ÿä¸ºä»€ä¹ˆbarrierå¯¹é½å°±æ˜¯Exactly Onceï¼Ÿä¸ºä»€ä¹ˆbarrierä¸å¯¹é½å°±æ˜¯ At Least Onceï¼ŸFlinkç®€ä»‹Apache FlinkÂ® - Stateful Computations over Data StreamsApache FlinkÂ® - æ•°æ®æµä¸Šçš„æœ‰çŠ¶æ€è®¡ç®—Flink 1.8 DocumentState &amp; Fault Toleranceæœ‰çŠ¶æ€å‡½æ•°å’Œè¿ç®—ç¬¦åœ¨å„ä¸ªå…ƒç´ /äº‹ä»¶çš„å¤„ç†ä¸­å­˜å‚¨æ•°æ®ï¼ˆçŠ¶æ€æ•°æ®å¯ä»¥ä¿®æ”¹å’ŒæŸ¥è¯¢ï¼Œå¯ä»¥è‡ªå·±ç»´æŠ¤ï¼Œæ ¹æ®è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯ï¼Œä¿å­˜å†å²æ•°æ®æˆ–è€…ä¸­é—´ç»“æœåˆ°çŠ¶æ€ä¸­ï¼‰ä¾‹å¦‚ï¼šå½“åº”ç”¨ç¨‹åºæœç´¢æŸäº›äº‹ä»¶æ¨¡å¼æ—¶ï¼ŒçŠ¶æ€å°†å­˜å‚¨åˆ°ç›®å‰ä¸ºæ­¢é‡åˆ°çš„äº‹ä»¶åºåˆ—ã€‚åœ¨æ¯åˆ†é’Ÿ/å°æ—¶/å¤©èšåˆäº‹ä»¶æ—¶ï¼ŒçŠ¶æ€ä¿å­˜å¾…å¤„ç†çš„èšåˆã€‚å½“åœ¨æ•°æ®ç‚¹æµä¸Šè®­ç»ƒæœºå™¨å­¦ä¹ æ¨¡å‹æ—¶ï¼ŒçŠ¶æ€ä¿æŒæ¨¡å‹å‚æ•°çš„å½“å‰ç‰ˆæœ¬ã€‚å½“éœ€è¦ç®¡ç†å†å²æ•°æ®æ—¶ï¼ŒçŠ¶æ€å…è®¸æœ‰æ•ˆè®¿é—®è¿‡å»å‘ç”Ÿçš„äº‹ä»¶ã€‚ä»€ä¹ˆæ˜¯çŠ¶æ€ï¼Ÿæ— çŠ¶æ€è®¡ç®—çš„ä¾‹å­æ¯”å¦‚ï¼šæˆ‘ä»¬åªæ˜¯è¿›è¡Œä¸€ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¾“å…¥ aï¼Œè¾“å‡º a_666,è¾“å…¥bï¼Œè¾“å‡º b_666è¾“å‡ºçš„ç»“æœè·Ÿä¹‹å‰çš„çŠ¶æ€æ²¡å…³ç³»ï¼Œç¬¦åˆå¹‚ç­‰æ€§ã€‚å¹‚ç­‰æ€§ï¼šå°±æ˜¯ç”¨æˆ·å¯¹äºåŒä¸€æ“ä½œå‘èµ·çš„ä¸€æ¬¡è¯·æ±‚æˆ–è€…å¤šæ¬¡è¯·æ±‚çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œä¸ä¼šå› ä¸ºå¤šæ¬¡ç‚¹å‡»è€Œäº§ç”Ÿäº†å‰¯ä½œç”¨æœ‰çŠ¶æ€è®¡ç®—çš„ä¾‹å­è®¡ç®—pvã€uvè¾“å‡ºçš„ç»“æœè·Ÿä¹‹å‰çš„çŠ¶æ€æœ‰å…³ç³»ï¼Œä¸ç¬¦åˆå¹‚ç­‰æ€§ï¼Œè®¿é—®å¤šæ¬¡ï¼Œpvä¼šå¢åŠ Flinkçš„CheckPointåŠŸèƒ½ç®€ä»‹Flink CheckPoint çš„å­˜åœ¨å°±æ˜¯ä¸ºäº†è§£å†³flinkä»»åŠ¡failoveræ‰ä¹‹åï¼Œèƒ½å¤Ÿæ­£å¸¸æ¢å¤ä»»åŠ¡ã€‚é‚£CheckPointå…·ä½“åšäº†å“ªäº›åŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆä»»åŠ¡æŒ‚æ‰ä¹‹åï¼Œé€šè¿‡CheckPointèƒ½ä½¿å¾—ä»»åŠ¡æ¢å¤å‘¢ï¼ŸCheckPointæ˜¯é€šè¿‡ç»™ç¨‹åºå¿«ç…§çš„æ–¹å¼ä½¿å¾—å°†å†å²æŸäº›æ—¶åˆ»çš„çŠ¶æ€ä¿å­˜ä¸‹æ¥ï¼Œå½“ä»»åŠ¡æŒ‚æ‰ä¹‹åï¼Œé»˜è®¤ä»æœ€è¿‘ä¸€æ¬¡ä¿å­˜çš„å®Œæ•´å¿«ç…§å¤„è¿›è¡Œæ¢å¤ä»»åŠ¡ã€‚é—®é¢˜æ¥äº†ï¼Œå¿«ç…§æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿèƒ½åƒå—ï¼ŸSnapShotç¿»è¯‘ä¸ºå¿«ç…§ï¼ŒæŒ‡å°†ç¨‹åºä¸­æŸäº›ä¿¡æ¯å­˜ä¸€ä»½ï¼ŒåæœŸå¯ä»¥ç”¨æ¥æ¢å¤ã€‚å¯¹äºä¸€ä¸ªFlinkä»»åŠ¡æ¥è®²ï¼Œå¿«ç…§é‡Œé¢åˆ°åº•ä¿å­˜ç€ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿæ™¦æ¶©éš¾æ‡‚çš„æ¦‚å¿µæ€ä¹ˆåŠï¼Ÿå½“ç„¶ç”¨æ¡ˆä¾‹æ¥ä»£æ›¿å’¯ï¼Œç”¨æ¡ˆä¾‹è®©å¤§å®¶ç†è§£å¿«ç…§é‡Œé¢åˆ°åº•å­˜ä»€ä¹ˆä¿¡æ¯ã€‚é€‰ä¸€ä¸ªå¤§å®¶éƒ½æ¯”è¾ƒæ¸…æ¥šçš„æŒ‡æ ‡ï¼Œappçš„pvï¼Œflinkè¯¥æ€ä¹ˆç»Ÿè®¡å‘¢ï¼Ÿæˆ‘ä»¬ä»Kafkaè¯»å–åˆ°ä¸€æ¡æ¡çš„æ—¥å¿—ï¼Œä»æ—¥å¿—ä¸­è§£æå‡ºapp_idï¼Œç„¶åå°†ç»Ÿè®¡çš„ç»“æœæ”¾åˆ°å†…å­˜ä¸­ä¸€ä¸ªMapé›†åˆï¼Œapp_idåšä¸ºkeyï¼Œå¯¹åº”çš„pvåšä¸ºvalueï¼Œæ¯æ¬¡åªéœ€è¦å°†ç›¸åº”app_id çš„pvå€¼+1åputåˆ°Mapä¸­å³å¯flinkçš„Source taskè®°å½•äº†å½“å‰æ¶ˆè´¹åˆ°kafka test topicçš„æ‰€æœ‰partitionçš„offsetï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£CheckPointçš„ä½œç”¨ï¼Œè¿™é‡Œå…ˆç”¨ä¸€ä¸ªpartitionè¿›è¡Œè®²è§£ï¼Œå‡è®¾åä¸º â€œtestâ€çš„ topicåªæœ‰ä¸€ä¸ªpartition0ä¾‹ï¼šï¼ˆ0ï¼Œ1000ï¼‰,è¡¨ç¤º0å·partitionç›®å‰æ¶ˆè´¹åˆ°offsetä¸º1000çš„æ•°æ®flinkçš„pv taskè®°å½•äº†å½“å‰è®¡ç®—çš„å„appçš„pvå€¼ï¼Œä¸ºäº†æ–¹ä¾¿è®²è§£ï¼Œæˆ‘è¿™é‡Œæœ‰ä¸¤ä¸ªappï¼šapp1ã€app2ä¾‹ï¼šï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰ï¼Œè¡¨ç¤ºapp1å½“å‰pvå€¼ä¸º50000 ï¼Œè¡¨ç¤ºapp2å½“å‰pvå€¼ä¸º10000ï¼Œæ¯æ¥ä¸€æ¡æ•°æ®ï¼Œåªéœ€è¦ç¡®å®šç›¸åº”app_idï¼Œå°†ç›¸åº”çš„valueå€¼+1åputåˆ°mapä¸­å³å¯è¯¥æ¡ˆä¾‹ä¸­ï¼ŒCheckPointåˆ°åº•è®°å½•äº†ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿè®°å½•çš„å…¶å®å°±æ˜¯ç¬¬næ¬¡CheckPointæ¶ˆè´¹çš„offsetä¿¡æ¯å’Œå„appçš„pvå€¼ä¿¡æ¯ï¼Œè®°å½•ä¸€ä¸‹å‘ç”ŸCheckPointå½“å‰çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶å°†è¯¥çŠ¶æ€ä¿¡æ¯ä¿å­˜åˆ°ç›¸åº”çš„çŠ¶æ€åç«¯ã€‚ï¼ˆæ³¨ï¼šçŠ¶æ€åç«¯æ˜¯ä¿å­˜çŠ¶æ€çš„åœ°æ–¹ï¼Œå†³å®šçŠ¶æ€å¦‚ä½•ä¿å­˜ï¼Œå¦‚ä½•ä¿éšœçŠ¶æ€é«˜å¯ç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ï¼Œæˆ‘ä»¬èƒ½ä»çŠ¶æ€åç«¯æ‹¿åˆ°offsetä¿¡æ¯å’Œpvä¿¡æ¯å³å¯ã€‚çŠ¶æ€åç«¯å¿…é¡»æ˜¯é«˜å¯ç”¨çš„ï¼Œå¦åˆ™æˆ‘ä»¬çš„çŠ¶æ€åç«¯ç»å¸¸å‡ºç°æ•…éšœï¼Œä¼šå¯¼è‡´æ— æ³•é€šè¿‡checkpointæ¥æ¢å¤æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼‰chk-100ï¼š{offsetï¼šï¼ˆ0ï¼Œ1000ï¼‰pvï¼šï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰}è¯¥çŠ¶æ€ä¿¡æ¯è¡¨ç¤ºç¬¬100æ¬¡CheckPointçš„æ—¶å€™ï¼Œ partition 0 offsetæ¶ˆè´¹åˆ°äº†1000ï¼Œpvç»Ÿè®¡ç»“æœä¸ºï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰ä»»åŠ¡æŒ‚äº†ï¼Œå¦‚ä½•æ¢å¤ï¼Ÿå‡å¦‚æˆ‘ä»¬è®¾ç½®äº†ä¸‰åˆ†é’Ÿè¿›è¡Œä¸€æ¬¡CheckPointï¼Œä¿å­˜äº†ä¸Šè¿°æ‰€è¯´çš„ chk-100 çš„CheckPointçŠ¶æ€åï¼Œè¿‡äº†åç§’é’Ÿï¼Œoffsetå·²ç»æ¶ˆè´¹åˆ° ï¼ˆ0ï¼Œ1100ï¼‰ï¼Œpvç»Ÿè®¡ç»“æœå˜æˆäº†ï¼ˆapp1ï¼Œ50080ï¼‰ï¼ˆapp2ï¼Œ10020ï¼‰ï¼Œä½†æ˜¯çªç„¶ä»»åŠ¡æŒ‚äº†ï¼Œæ€ä¹ˆåŠï¼Ÿè«æ…Œï¼Œå…¶å®å¾ˆç®€å•ï¼Œflinkåªéœ€è¦ä»æœ€è¿‘ä¸€æ¬¡æˆåŠŸçš„CheckPointä¿å­˜çš„offsetï¼ˆ0ï¼Œ1000ï¼‰å¤„æ¥ç€æ¶ˆè´¹å³å¯ï¼Œå½“ç„¶pvå€¼ä¹Ÿè¦æŒ‰ç…§çŠ¶æ€é‡Œçš„pvå€¼ï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰è¿›è¡Œç´¯åŠ ï¼Œä¸èƒ½ä»ï¼ˆapp1ï¼Œ50080ï¼‰ï¼ˆapp2ï¼Œ10020ï¼‰å¤„è¿›è¡Œç´¯åŠ ï¼Œå› ä¸º partition 0 offsetæ¶ˆè´¹åˆ° 1000æ—¶ï¼Œpvç»Ÿè®¡ç»“æœä¸ºï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰å½“ç„¶å¦‚æœä½ æƒ³ä»offset ï¼ˆ0ï¼Œ1100ï¼‰pvï¼ˆapp1ï¼Œ50080ï¼‰ï¼ˆapp2ï¼Œ10020ï¼‰è¿™ä¸ªçŠ¶æ€æ¢å¤ï¼Œä¹Ÿæ˜¯åšä¸åˆ°çš„ï¼Œå› ä¸ºé‚£ä¸ªæ—¶åˆ»ç¨‹åºçªç„¶æŒ‚äº†ï¼Œè¿™ä¸ªçŠ¶æ€æ ¹æœ¬æ²¡æœ‰ä¿å­˜ä¸‹æ¥ã€‚æˆ‘ä»¬èƒ½åšçš„æœ€é«˜æ•ˆæ–¹å¼å°±æ˜¯ä»æœ€è¿‘ä¸€æ¬¡æˆåŠŸçš„CheckPointå¤„æ¢å¤ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä¸€ç›´æ‰€è¯´çš„chk-100,ä»¥ä¸Šè®²è§£ï¼ŒåŸºæœ¬å°±æ˜¯CheckPointæ‰¿æ‹…çš„å·¥ä½œï¼Œæè¿°çš„åœºæ™¯æ¯”è¾ƒç®€å•ç–‘é—®ï¼Œè®¡ç®—pvçš„taskåœ¨ä¸€ç›´è¿è¡Œï¼Œå®ƒæ€ä¹ˆçŸ¥é“ä»€ä¹ˆæ—¶å€™å»åšè¿™ä¸ªå¿«ç…§ï¼Ÿæˆ–è€…è¯´è®¡ç®—pvçš„taskæ€ä¹ˆä¿éšœå®ƒè‡ªå·±è®¡ç®—çš„pvå€¼ï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰å°±æ˜¯offsetï¼ˆ0ï¼Œ1000ï¼‰é‚£ä¸€åˆ»çš„ç»Ÿè®¡ç»“æœå‘¢ï¼Ÿflinkæ˜¯åœ¨æ•°æ®ä¸­åŠ äº†ä¸€ä¸ªå«åšbarrierçš„ä¸œè¥¿ï¼ˆbarrierä¸­æ–‡ç¿»è¯‘ï¼šæ …æ ï¼‰ï¼Œä¸‹å›¾ä¸­çº¢åœˆå¤„å°±æ˜¯ä¸¤ä¸ªbarrierbarrierä»Source Taskå¤„ç”Ÿæˆï¼Œä¸€ç›´æµåˆ°Sink Taskï¼ŒæœŸé—´æ‰€æœ‰çš„Taskåªè¦ç¢°åˆ°barrierï¼Œå°±ä¼šè§¦å‘è‡ªèº«è¿›è¡Œå¿«ç…§CheckPoint , barrier n-1å¤„åšçš„å¿«ç…§å°±æ˜¯æŒ‡Jobä»å¼€å§‹å¤„ç†åˆ° barrier n-1æ‰€æœ‰çš„çŠ¶æ€æ•°æ®, barrier n å¤„åšçš„å¿«ç…§å°±æ˜¯æŒ‡ä»Jobå¼€å§‹åˆ°å¤„ç†åˆ° barrier næ‰€æœ‰çš„çŠ¶æ€æ•°æ®å¯¹åº”åˆ°pvæ¡ˆä¾‹ä¸­å°±æ˜¯ï¼ŒSource Taskæ¥æ”¶åˆ°JobManagerçš„ç¼–å·ä¸ºchk-100çš„CheckPointè§¦å‘è¯·æ±‚åï¼Œå‘ç°è‡ªå·±æ°å¥½æ¥æ”¶åˆ°kafka offsetï¼ˆ0ï¼Œ1000ï¼‰å¤„çš„æ•°æ®ï¼Œæ‰€ä»¥ä¼šå¾€offsetï¼ˆ0ï¼Œ1000ï¼‰æ•°æ®ä¹‹åoffsetï¼ˆ0ï¼Œ1001ï¼‰æ•°æ®ä¹‹å‰å®‰æ’ä¸€ä¸ªbarrierï¼Œç„¶åè‡ªå·±å¼€å§‹åšå¿«ç…§ï¼Œä¹Ÿå°±æ˜¯å°†offsetï¼ˆ0ï¼Œ1000ï¼‰ä¿å­˜åˆ°çŠ¶æ€åç«¯chk-100ä¸­ã€‚ç„¶åbarrieræ¥ç€å¾€ä¸‹æ¸¸å‘é€ï¼Œå½“ç»Ÿè®¡pvçš„taskæ¥æ”¶åˆ°barrieråï¼Œä¹Ÿä¼šæš‚åœå¤„ç†æ•°æ®ï¼Œå°†è‡ªå·±å†…å­˜ä¸­ä¿å­˜çš„pvä¿¡æ¯ï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰ä¿å­˜åˆ°çŠ¶æ€åç«¯chk-100ä¸­ã€‚OKï¼Œflinkå¤§æ¦‚å°±æ˜¯é€šè¿‡è¿™ä¸ªåŸç†æ¥ä¿å­˜å¿«ç…§çš„ã€‚ç»Ÿè®¡pvçš„taskæ¥æ”¶åˆ°barrierï¼Œå°±æ„å‘³ç€barrierä¹‹å‰çš„æ•°æ®éƒ½å¤„ç†äº†ï¼Œæ‰€ä»¥è¯´ï¼Œä¸ä¼šå‡ºç°ä¸¢æ•°æ®çš„æƒ…å†µbarrierçš„ä½œç”¨å°±æ˜¯ä¸ºäº†æŠŠæ•°æ®åŒºåˆ†å¼€ï¼ŒCheckPointè¿‡ç¨‹ä¸­æœ‰ä¸€ä¸ªåŒæ­¥åšå¿«ç…§çš„ç¯èŠ‚ä¸èƒ½å¤„ç†barrierä¹‹åçš„æ•°æ®ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœåšå¿«ç…§çš„åŒæ—¶ï¼Œä¹Ÿåœ¨å¤„ç†æ•°æ®ï¼Œé‚£ä¹ˆå¤„ç†çš„æ•°æ®å¯èƒ½ä¼šä¿®æ”¹å¿«ç…§å†…å®¹ï¼Œæ‰€ä»¥å…ˆæš‚åœå¤„ç†æ•°æ®ï¼ŒæŠŠå†…å­˜ä¸­å¿«ç…§ä¿å­˜å¥½åï¼Œå†å¤„ç†æ•°æ®ç»“åˆæ¡ˆä¾‹æ¥è®²å°±æ˜¯ï¼Œç»Ÿè®¡pvçš„taskæƒ³å¯¹ï¼ˆapp1ï¼Œ50000ï¼‰ï¼ˆapp2ï¼Œ10000ï¼‰åšå¿«ç…§ï¼Œä½†æ˜¯å¦‚æœæ•°æ®è¿˜åœ¨å¤„ç†ï¼Œå¯èƒ½å¿«ç…§è¿˜æ²¡ä¿å­˜ä¸‹æ¥ï¼ŒçŠ¶æ€å·²ç»å˜æˆäº†ï¼ˆapp1ï¼Œ50001ï¼‰ï¼ˆapp2ï¼Œ10001ï¼‰ï¼Œå¿«ç…§å°±ä¸å‡†ç¡®äº†ï¼Œå°±ä¸èƒ½ä¿éšœExactly Onceäº†æ€»ç»“æµå¼è®¡ç®—ä¸­çŠ¶æ€äº¤äº’ç®€æ˜“åœºæ™¯ç²¾ç¡®ä¸€æ¬¡çš„å®¹é”™æ–¹æ³•ï¼Œå‘¨æœŸæ€§åœ°å¯¹æ¶ˆè´¹offsetå’Œç»Ÿè®¡çš„çŠ¶æ€ä¿¡æ¯æˆ–ç»Ÿè®¡ç»“æœè¿›è¡Œå¿«ç…§æ¶ˆè´¹åˆ°Xä½ç½®çš„æ—¶å€™ï¼Œå°†Xå¯¹åº”çš„çŠ¶æ€ä¿å­˜ä¸‹æ¥æ¶ˆè´¹åˆ°Yä½ç½®çš„æ—¶å€™ï¼Œå°†Yå¯¹åº”çš„çŠ¶æ€ä¿å­˜ä¸‹æ¥å¤šå¹¶è¡Œåº¦ã€å¤šOperatoræƒ…å†µä¸‹ï¼ŒCheckPointè¿‡ç¨‹åˆ†å¸ƒå¼çŠ¶æ€å®¹é”™é¢ä¸´çš„é—®é¢˜ä¸æŒ‘æˆ˜å¦‚ä½•ç¡®ä¿çŠ¶æ€æ‹¥æœ‰ç²¾ç¡®ä¸€æ¬¡çš„å®¹é”™ä¿è¯ï¼Ÿå¦‚ä½•åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹æ›¿å¤šä¸ªæ‹¥æœ‰æœ¬åœ°çŠ¶æ€çš„ç®—å­äº§ç”Ÿä¸€ä¸ªå…¨åŸŸä¸€è‡´çš„å¿«ç…§ï¼Ÿå¦‚ä½•åœ¨ä¸ä¸­æ–­è¿ç®—çš„å‰æä¸‹äº§ç”Ÿå¿«ç…§ï¼Ÿå¤šå¹¶è¡Œåº¦ã€å¤šOperatorå®ä¾‹çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•åšå…¨åŸŸä¸€è‡´çš„å¿«ç…§æ‰€æœ‰çš„Operatorè¿è¡Œè¿‡ç¨‹ä¸­é‡åˆ°barrieråï¼Œéƒ½å¯¹è‡ªèº«çš„çŠ¶æ€è¿›è¡Œä¸€æ¬¡å¿«ç…§ï¼Œä¿å­˜åˆ°ç›¸åº”çŠ¶æ€åç«¯å¯¹åº”åˆ°pvæ¡ˆä¾‹ï¼šæœ‰çš„Operatorè®¡ç®—çš„app1çš„pvï¼Œæœ‰çš„Operatorè®¡ç®—çš„app2çš„pvï¼Œå½“ä»–ä»¬ç¢°åˆ°barrieræ—¶ï¼Œéƒ½éœ€è¦å°†ç›®å‰ç»Ÿè®¡çš„pvä¿¡æ¯å¿«ç…§åˆ°çŠ¶æ€åç«¯å¤šOperatorçŠ¶æ€æ¢å¤å…·ä½“æ€ä¹ˆåšè¿™ä¸ªå¿«ç…§å‘¢ï¼Ÿåˆ©ç”¨ä¹‹å‰æ‰€è®²çš„barrierç­–ç•¥JobManagerå‘Source Taskå‘é€CheckPointTriggerï¼ŒSource Taskä¼šåœ¨æ•°æ®æµä¸­å®‰æ’CheckPoint barrierSource Taskè‡ªèº«åšå¿«ç…§ï¼Œå¹¶ä¿å­˜åˆ°çŠ¶æ€åç«¯Source Taskå°†barrierè·Ÿæ•°æ®æµä¸€å—å¾€ä¸‹æ¸¸å‘é€å½“ä¸‹æ¸¸çš„Operatorå®ä¾‹æ¥æ”¶åˆ°CheckPoint barrieråï¼Œå¯¹è‡ªèº«åšå¿«ç…§å¤šå¹¶è¡Œåº¦å¿«ç…§è¯¦å›¾ä¸Šè¿°å›¾ä¸­ï¼Œæœ‰4ä¸ªå¸¦çŠ¶æ€çš„Operatorå®ä¾‹ï¼Œç›¸åº”çš„çŠ¶æ€åç«¯å°±å¯ä»¥æƒ³è±¡æˆå¡«4ä¸ªæ ¼å­ã€‚æ•´ä¸ªCheckPoint çš„è¿‡ç¨‹å¯ä»¥å½“åšOperatorå®ä¾‹å¡«è‡ªå·±æ ¼å­çš„è¿‡ç¨‹ï¼ŒOperatorå®ä¾‹å°†è‡ªèº«çš„çŠ¶æ€å†™åˆ°çŠ¶æ€åç«¯ä¸­ç›¸åº”çš„æ ¼å­ï¼Œå½“æ‰€æœ‰çš„æ ¼å­å¡«æ»¡å¯ä»¥ç®€å•çš„è®¤ä¸ºä¸€æ¬¡å®Œæ•´çš„CheckPointåšå®Œäº†ä¸Šé¢åªæ˜¯å¿«ç…§çš„è¿‡ç¨‹ï¼Œæ•´ä¸ªCheckPointæ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹1ã€JobManagerç«¯çš„ CheckPointCoordinatorå‘ æ‰€æœ‰SourceTaskå‘é€CheckPointTriggerï¼ŒSource Taskä¼šåœ¨æ•°æ®æµä¸­å®‰æ’CheckPoint barrier2ã€å½“taskæ”¶åˆ°æ‰€æœ‰çš„barrieråï¼Œå‘è‡ªå·±çš„ä¸‹æ¸¸ç»§ç»­ä¼ é€’barrierï¼Œç„¶åè‡ªèº«æ‰§è¡Œå¿«ç…§ï¼Œå¹¶å°†è‡ªå·±çš„çŠ¶æ€å¼‚æ­¥å†™å…¥åˆ°æŒä¹…åŒ–å­˜å‚¨ä¸­å¢é‡CheckPointåªæ˜¯æŠŠæœ€æ–°çš„ä¸€éƒ¨åˆ†æ›´æ–°å†™å…¥åˆ°å¤–éƒ¨å­˜å‚¨ä¸ºäº†ä¸‹æ¸¸å°½å¿«åšCheckPointï¼Œæ‰€ä»¥ä¼šå…ˆå‘é€barrieråˆ°ä¸‹æ¸¸ï¼Œè‡ªèº«å†åŒæ­¥è¿›è¡Œå¿«ç…§3ã€å½“taskå®Œæˆå¤‡ä»½åï¼Œä¼šå°†å¤‡ä»½æ•°æ®çš„åœ°å€ï¼ˆstate handleï¼‰é€šçŸ¥ç»™JobManagerçš„CheckPointCoordinatorå¦‚æœCheckPointçš„æŒç»­æ—¶é•¿è¶…è¿‡ äº†CheckPointè®¾å®šçš„è¶…æ—¶æ—¶é—´ï¼ŒCheckPointCoordinator è¿˜æ²¡æœ‰æ”¶é›†å®Œæ‰€æœ‰çš„ State Handleï¼ŒCheckPointCoordinatorå°±ä¼šè®¤ä¸ºæœ¬æ¬¡CheckPointå¤±è´¥ï¼Œä¼šæŠŠè¿™æ¬¡CheckPointäº§ç”Ÿçš„æ‰€æœ‰ çŠ¶æ€æ•°æ®å…¨éƒ¨åˆ é™¤4ã€ æœ€å CheckPoint Coordinator ä¼šæŠŠæ•´ä¸ª StateHandle å°è£…æˆ completed CheckPoint Metaï¼Œå†™å…¥åˆ°hdfsbarrierå¯¹é½ä»€ä¹ˆæ˜¯barrierå¯¹é½ï¼Ÿä¸€æ—¦Operatorä»è¾“å…¥æµæ¥æ”¶åˆ°CheckPoint barrier nï¼Œå®ƒå°±ä¸èƒ½å¤„ç†æ¥è‡ªè¯¥æµçš„ä»»ä½•æ•°æ®è®°å½•ï¼Œç›´åˆ°å®ƒä»å…¶ä»–æ‰€æœ‰è¾“å…¥æ¥æ”¶åˆ°barrier nä¸ºæ­¢ã€‚å¦åˆ™ï¼Œå®ƒä¼šæ··åˆå±äºå¿«ç…§nçš„è®°å½•å’Œå±äºå¿«ç…§n + 1çš„è®°å½•æ¥æ”¶åˆ°barrier nçš„æµæš‚æ—¶è¢«æç½®ã€‚ä»è¿™äº›æµæ¥æ”¶çš„è®°å½•ä¸ä¼šè¢«å¤„ç†ï¼Œè€Œæ˜¯æ”¾å…¥è¾“å…¥ç¼“å†²åŒºã€‚ä¸Šå›¾ä¸­ç¬¬2ä¸ªå›¾ï¼Œè™½ç„¶æ•°å­—æµå¯¹åº”çš„barrierå·²ç»åˆ°è¾¾äº†ï¼Œä½†æ˜¯barrierä¹‹åçš„1ã€2ã€3è¿™äº›æ•°æ®åªèƒ½æ”¾åˆ°bufferä¸­ï¼Œç­‰å¾…å­—æ¯æµçš„barrieråˆ°è¾¾ä¸€æ—¦æœ€åæ‰€æœ‰è¾“å…¥æµéƒ½æ¥æ”¶åˆ°barrier nï¼ŒOperatorå°±ä¼šæŠŠç¼“å†²åŒºä¸­pending çš„è¾“å‡ºæ•°æ®å‘å‡ºå»ï¼Œç„¶åæŠŠCheckPoint barrier næ¥ç€å¾€ä¸‹æ¸¸å‘é€è¿™é‡Œè¿˜ä¼šå¯¹è‡ªèº«è¿›è¡Œå¿«ç…§ï¼Œä¹‹åï¼ŒOperatorå°†ç»§ç»­å¤„ç†æ¥è‡ªæ‰€æœ‰è¾“å…¥æµçš„è®°å½•ï¼Œåœ¨å¤„ç†æ¥è‡ªæµçš„è®°å½•ä¹‹å‰å…ˆå¤„ç†æ¥è‡ªè¾“å…¥ç¼“å†²åŒºçš„è®°å½•ä»€ä¹ˆæ˜¯barrierä¸å¯¹é½ï¼Ÿä¸Šè¿°å›¾2ä¸­ï¼Œå½“è¿˜æœ‰å…¶ä»–è¾“å…¥æµçš„barrierè¿˜æ²¡æœ‰åˆ°è¾¾æ—¶ï¼Œä¼šæŠŠå·²åˆ°è¾¾çš„barrierä¹‹åçš„æ•°æ®1ã€2ã€3æç½®åœ¨ç¼“å†²åŒºï¼Œç­‰å¾…å…¶ä»–æµçš„barrieråˆ°è¾¾åæ‰èƒ½å¤„ç†barrierä¸å¯¹é½å°±æ˜¯æŒ‡å½“è¿˜æœ‰å…¶ä»–æµçš„barrierè¿˜æ²¡åˆ°è¾¾æ—¶ï¼Œä¸ºäº†ä¸å½±å“æ€§èƒ½ï¼Œä¹Ÿä¸ç”¨ç†ä¼šï¼Œç›´æ¥å¤„ç†barrierä¹‹åçš„æ•°æ®ã€‚ç­‰åˆ°æ‰€æœ‰æµçš„barrierçš„éƒ½åˆ°è¾¾åï¼Œå°±å¯ä»¥å¯¹è¯¥OperatoråšCheckPointäº†ä¸ºä»€ä¹ˆè¦è¿›è¡Œbarrierå¯¹é½ï¼Ÿä¸å¯¹é½åˆ°åº•è¡Œä¸è¡Œï¼Ÿç­”ï¼šExactly Onceæ—¶å¿…é¡»barrierå¯¹é½ï¼Œå¦‚æœbarrierä¸å¯¹é½å°±å˜æˆäº†At Least Onceåé¢çš„éƒ¨åˆ†ä¸»è¦è¯æ˜è¿™å¥è¯CheckPointçš„ç›®çš„å°±æ˜¯ä¸ºäº†ä¿å­˜å¿«ç…§ï¼Œå¦‚æœä¸å¯¹é½ï¼Œé‚£ä¹ˆåœ¨chk-100å¿«ç…§ä¹‹å‰ï¼Œå·²ç»å¤„ç†äº†ä¸€äº›chk-100 å¯¹åº”çš„offsetä¹‹åçš„æ•°æ®ï¼Œå½“ç¨‹åºä»chk-100æ¢å¤ä»»åŠ¡æ—¶ï¼Œchk-100å¯¹åº”çš„offsetä¹‹åçš„æ•°æ®è¿˜ä¼šè¢«å¤„ç†ä¸€æ¬¡ï¼Œæ‰€ä»¥å°±å‡ºç°äº†é‡å¤æ¶ˆè´¹ã€‚å¦‚æœå¬ä¸æ‡‚æ²¡å…³ç³»ï¼Œåé¢æœ‰æ¡ˆä¾‹è®©æ‚¨æ‡‚ç»“åˆpvæ¡ˆä¾‹æ¥çœ‹ï¼Œä¹‹å‰çš„æ¡ˆä¾‹ä¸ºäº†ç®€å•ï¼Œæè¿°çš„kafkaçš„topicåªæœ‰1ä¸ªpartitionï¼Œè¿™é‡Œä¸ºäº†è®²è¿°barrierå¯¹é½ï¼Œæ‰€ä»¥topicæœ‰2ä¸ªpartittionç»“åˆä¸šåŠ¡ï¼Œå…ˆä»‹ç»ä¸€ä¸‹ä¸Šè¿°æ‰€æœ‰ç®—å­åœ¨ä¸šåŠ¡ä¸­çš„åŠŸèƒ½Sourceçš„kafkaçš„Consumerï¼Œä»kakfaä¸­è¯»å–æ•°æ®åˆ°flinkåº”ç”¨ä¸­TaskAä¸­çš„mapå°†è¯»å–åˆ°çš„ä¸€æ¡kafkaæ—¥å¿—è½¬æ¢ä¸ºæˆ‘ä»¬éœ€è¦ç»Ÿè®¡çš„app_idkeyBy æŒ‰ç…§app_idè¿›è¡ŒkeyByï¼Œç›¸åŒçš„app_id ä¼šåˆ†åˆ°ä¸‹æ¸¸TaskBçš„åŒä¸€ä¸ªå®ä¾‹ä¸­TaskBçš„mapåœ¨çŠ¶æ€ä¸­æŸ¥å‡ºè¯¥app_id å¯¹åº”çš„pvå€¼ï¼Œç„¶å+1ï¼Œå­˜å‚¨åˆ°çŠ¶æ€ä¸­åˆ©ç”¨Sinkå°†ç»Ÿè®¡çš„pvå€¼å†™å…¥åˆ°å¤–éƒ¨å­˜å‚¨ä»‹è´¨ä¸­æˆ‘ä»¬ä»kafkaçš„ä¸¤ä¸ªpartitionæ¶ˆè´¹æ•°æ®ï¼ŒTaskAå’ŒTaskBéƒ½æœ‰ä¸¤ä¸ªå¹¶è¡Œåº¦ï¼Œæ‰€ä»¥æ€»å…±flinkæœ‰4ä¸ªOperatorå®ä¾‹ï¼Œè¿™é‡Œæˆ‘ä»¬ç§°ä¹‹ä¸º TaskA0ã€TaskA1ã€TaskB0ã€TaskB1å‡è®¾å·²ç»æˆåŠŸåšäº†99æ¬¡CheckPointï¼Œè¿™é‡Œè¯¦ç»†è§£é‡Šç¬¬100æ¬¡CheckPointè¿‡ç¨‹JobManagerå†…éƒ¨æœ‰ä¸ªå®šæ—¶è°ƒåº¦ï¼Œå‡å¦‚ç°åœ¨10ç‚¹00åˆ†00ç§’åˆ°äº†ç¬¬100æ¬¡CheckPointçš„æ—¶é—´äº†ï¼ŒJobManagerçš„CheckPointCoordinatorè¿›ç¨‹ä¼šå‘æ‰€æœ‰çš„Source Taskå‘é€CheckPointTriggerï¼Œä¹Ÿå°±æ˜¯å‘TaskA0ã€TaskA1å‘é€CheckPointTriggerTaskA0ã€TaskA1æ¥æ”¶åˆ°CheckPointTriggerï¼Œä¼šå¾€æ•°æ®æµä¸­å®‰æ’barrierï¼Œå°†barrierå‘é€åˆ°ä¸‹æ¸¸ï¼Œåœ¨è‡ªå·±çš„çŠ¶æ€ä¸­è®°å½•barrierå®‰æ’çš„offsetä½ç½®ï¼Œç„¶åè‡ªèº«åšå¿«ç…§ï¼Œå°†offsetä¿¡æ¯ä¿å­˜åˆ°çŠ¶æ€åç«¯è¿™é‡Œå‡å¦‚TaskA0æ¶ˆè´¹çš„partition0çš„offsetä¸º10000ï¼ŒTaskA1æ¶ˆè´¹çš„partition1çš„offsetä¸º10005ã€‚é‚£ä¹ˆçŠ¶æ€ä¸­ä¼šä¿å­˜ (0ï¼Œ10000)(1ï¼Œ10005)ï¼Œè¡¨ç¤º0å·partitionæ¶ˆè´¹åˆ°äº†offsetä¸º10000çš„ä½ç½®ï¼Œ1å·partitionæ¶ˆè´¹åˆ°äº†offsetä¸º10005çš„ä½ç½®ç„¶åTaskAçš„mapå’ŒkeyByç®—å­ä¸­å¹¶æ²¡æœ‰çŠ¶æ€ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿›è¡Œå¿«ç…§æ¥ç€æ•°æ®å’Œbarrieréƒ½å‘ä¸‹æ¸¸TaskBå‘é€ï¼Œç›¸åŒçš„app_id ä¼šå‘é€åˆ°ç›¸åŒçš„TaskBå®ä¾‹ä¸Šï¼Œè¿™é‡Œå‡è®¾æœ‰ä¸¤ä¸ªappï¼šapp0å’Œapp1ï¼Œç»è¿‡keyByåï¼Œå‡è®¾app0åˆ†åˆ°äº†TaskB0ä¸Šï¼Œapp1åˆ†åˆ°äº†TaskB1ä¸Šã€‚åŸºäºä¸Šé¢æè¿°ï¼ŒTaskA0å’ŒTaskA1ä¸­çš„æ‰€æœ‰app0çš„æ•°æ®éƒ½å‘é€åˆ°TaskB0ä¸Šï¼Œæ‰€æœ‰app1çš„æ•°æ®éƒ½å‘é€åˆ°TaskB1ä¸Šç°åœ¨æˆ‘ä»¬å‡è®¾TaskB0åšCheckPointçš„æ—¶å€™barrierå¯¹é½äº†ï¼ŒTaskB1åšCheckPointçš„æ—¶å€™barrierä¸å¯¹é½ï¼Œå½“ç„¶ä¸èƒ½è¿™ä¹ˆé…ç½®ï¼Œæˆ‘å°±æ˜¯ä¸¾è¿™ä¹ˆä¸ªä¾‹å­ï¼Œå¸¦å¤§å®¶åˆ†æä¸€ä¸‹barrierå¯¹ä¸å¯¹é½åˆ°åº•å¯¹ç»Ÿè®¡ç»“æœæœ‰ä»€ä¹ˆå½±å“ï¼Ÿä¸Šé¢è¯´äº†chk-100çš„è¿™æ¬¡CheckPointï¼Œoffsetä½ç½®ä¸º(0ï¼Œ10000)(1ï¼Œ10005)ï¼ŒTaskB0ä½¿ç”¨barrierå¯¹é½ï¼Œä¹Ÿå°±æ˜¯è¯´TaskB0ä¸ä¼šå¤„ç†barrierä¹‹åçš„æ•°æ®ï¼Œæ‰€ä»¥TaskB0åœ¨chk-100å¿«ç…§çš„æ—¶å€™ï¼ŒçŠ¶æ€åç«¯ä¿å­˜çš„app0çš„pvæ•°æ®æ˜¯ä»ç¨‹åºå¼€å§‹å¯åŠ¨åˆ°kafka offsetä½ç½®ä¸º(0ï¼Œ10000)(1ï¼Œ10005)çš„æ‰€æœ‰æ•°æ®è®¡ç®—å‡ºæ¥çš„pvå€¼ï¼Œä¸€æ¡ä¸å¤šï¼ˆæ²¡å¤„ç†barrierä¹‹åï¼Œæ‰€ä»¥ä¸ä¼šé‡å¤ï¼‰ï¼Œä¸€æ¡ä¸å°‘(barrierä¹‹å‰çš„æ‰€æœ‰æ•°æ®éƒ½å¤„ç†äº†ï¼Œæ‰€ä»¥ä¸ä¼šä¸¢å¤±)ï¼Œå‡å¦‚ä¿å­˜çš„çŠ¶æ€ä¿¡æ¯ä¸º(app0ï¼Œ8000)è¡¨ç¤ºæ¶ˆè´¹åˆ°(0ï¼Œ10000)(1ï¼Œ10005)offsetçš„æ—¶å€™ï¼Œapp0çš„pvå€¼ä¸º8000TaskB1ä½¿ç”¨çš„barrierä¸å¯¹é½ï¼Œå‡å¦‚TaskA0ç”±äºæœåŠ¡å™¨çš„CPUæˆ–è€…ç½‘ç»œç­‰å…¶ä»–æ³¢åŠ¨ï¼Œå¯¼è‡´TaskA0å¤„ç†æ•°æ®è¾ƒæ…¢ï¼Œè€ŒTaskA1å¾ˆç¨³å®šï¼Œæ‰€ä»¥å¤„ç†æ•°æ®æ¯”è¾ƒå¿«ã€‚å¯¼è‡´çš„ç»“æœå°±æ˜¯TaskB1å…ˆæ¥æ”¶åˆ°äº†TaskA1çš„barrierï¼Œç”±äºé…ç½®çš„barrierä¸å¯¹é½ï¼Œæ‰€ä»¥TaskB1ä¼šæ¥ç€å¤„ç†TaskA1 barrierä¹‹åçš„æ•°æ®ï¼Œè¿‡äº†2ç§’åï¼ŒTaskB1æ¥æ”¶åˆ°äº†TaskA0çš„barrierï¼Œäºæ˜¯å¯¹çŠ¶æ€ä¸­å­˜å‚¨çš„app1çš„pvå€¼å¼€å§‹åšCheckPoint å¿«ç…§ï¼Œä¿å­˜çš„çŠ¶æ€ä¿¡æ¯ä¸º(app1ï¼Œ12050)ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“è¿™ä¸ª(app1ï¼Œ12050)å®é™…ä¸Šå¤šå¤„ç†äº†2ç§’TaskA1å‘æ¥çš„barrierä¹‹åçš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯kafka topicå¯¹åº”çš„partition1 offset 10005ä¹‹åçš„æ•°æ®ï¼Œapp1çœŸå®çš„pvæ•°æ®è‚¯å®šè¦å°äºè¿™ä¸ª12050ï¼Œpartition1çš„offsetä¿å­˜çš„offsetè™½ç„¶æ˜¯10005ï¼Œä½†æ˜¯æˆ‘ä»¬å®é™…ä¸Šå¯èƒ½å·²ç»å¤„ç†åˆ°äº†offset 10200çš„æ•°æ®ï¼Œå‡è®¾å°±æ˜¯å¤„ç†åˆ°äº†10200è™½ç„¶çŠ¶æ€ä¿å­˜çš„pvå€¼åé«˜äº†ï¼Œä½†æ˜¯ä¸èƒ½è¯´æ˜é‡å¤å¤„ç†ï¼Œå› ä¸ºæˆ‘çš„TaskA1å¹¶æ²¡æœ‰å†æ¬¡å»æ¶ˆè´¹partition1çš„offset 10005~10200çš„æ•°æ®ï¼Œæ‰€ä»¥ç›¸å½“äºä¹Ÿæ²¡æœ‰é‡å¤æ¶ˆè´¹ï¼Œåªæ˜¯å±•ç¤ºçš„ç»“æœæ›´å®æ—¶äº†åˆ†æåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹æˆ‘ä»¬çš„çŠ¶æ€ä¿å­˜äº†ä»€ä¹ˆï¼šchk-100offsetï¼š(0ï¼Œ10000)(1ï¼Œ10005)pvï¼š(app0ï¼Œ8000) (app1ï¼Œ12050)æ¥ç€ç¨‹åºåœ¨ç»§ç»­è¿è¡Œï¼Œè¿‡äº†10ç§’ï¼Œç”±äºæŸä¸ªæœåŠ¡å™¨æŒ‚äº†ï¼Œå¯¼è‡´æˆ‘ä»¬çš„å››ä¸ªOperatorå®ä¾‹æœ‰ä¸€ä¸ªOperatoræŒ‚äº†ï¼Œæ‰€ä»¥Flinkä¼šä»æœ€è¿‘ä¸€æ¬¡çš„çŠ¶æ€æ¢å¤ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åˆšåˆšè¯¦ç»†è®²çš„chk-100å¤„æ¢å¤ï¼Œé‚£å…·ä½“æ˜¯æ€ä¹ˆæ¢å¤çš„å‘¢ï¼ŸFlink åŒæ ·ä¼šèµ·å››ä¸ªOperatorå®ä¾‹ï¼Œæˆ‘è¿˜ç§°ä»–ä»¬æ˜¯ TaskA0ã€TaskA1ã€TaskB0ã€TaskB1ã€‚å››ä¸ªOperatorä¼šä»çŠ¶æ€åç«¯è¯»å–ä¿å­˜çš„çŠ¶æ€ä¿¡æ¯ã€‚ä»offsetï¼š(0ï¼Œ10000)(1ï¼Œ10005) å¼€å§‹æ¶ˆè´¹ï¼Œå¹¶ä¸”åŸºäº pvï¼š(app0ï¼Œ8000) (app1ï¼Œ12050)å€¼è¿›è¡Œç´¯åŠ ç»Ÿè®¡ç„¶åä½ å°±åº”è¯¥ä¼šå‘ç°è¿™ä¸ªapp1çš„pvå€¼12050å®é™…ä¸Šå·²ç»åŒ…å«äº†partition1çš„offset 1000510200çš„æ•°æ®ï¼Œæ‰€ä»¥partition1ä»offset 10005æ¢å¤ä»»åŠ¡æ—¶ï¼Œpartition1çš„offset 1000510200çš„æ•°æ®è¢«æ¶ˆè´¹äº†ä¸¤æ¬¡TaskB1è®¾ç½®çš„barrierä¸å¯¹é½ï¼Œæ‰€ä»¥CheckPoint chk-100å¯¹åº”çš„çŠ¶æ€ä¸­å¤šæ¶ˆè´¹äº†barrierä¹‹åçš„ä¸€äº›æ•°æ®ï¼ˆTaskA1å‘é€ï¼‰ï¼Œé‡å¯åæ˜¯ä»chk-100ä¿å­˜çš„offsetæ¢å¤ï¼Œè¿™å°±æ˜¯æ‰€è¯´çš„At Least Onceç”±äºä¸Šé¢è¯´TaskB0è®¾ç½®çš„barrierå¯¹é½ï¼Œæ‰€ä»¥app0ä¸ä¼šå‡ºç°é‡å¤æ¶ˆè´¹ï¼Œå› ä¸ºapp0æ²¡æœ‰æ¶ˆè´¹offsetï¼š(0ï¼Œ10000)(1ï¼Œ10005) ä¹‹åçš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„Exactly Onceçœ‹åˆ°è¿™é‡Œä½ åº”è¯¥å·²ç»çŸ¥é“äº†å“ªç§æƒ…å†µä¼šå‡ºç°é‡å¤æ¶ˆè´¹äº†ï¼Œä¹Ÿåº”è¯¥è¦æŒæ¡ä¸ºä»€ä¹ˆbarrierå¯¹é½å°±æ˜¯Exactly Onceï¼Œä¸ºä»€ä¹ˆbarrierä¸å¯¹é½å°±æ˜¯ At Least Onceåˆ°åº•ä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°barrierå¯¹é½ï¼Ÿé¦–å…ˆè®¾ç½®äº†Flinkçš„CheckPointè¯­ä¹‰æ˜¯ï¼šExactly OnceOperatorå®ä¾‹å¿…é¡»æœ‰å¤šä¸ªè¾“å…¥æµæ‰ä¼šå‡ºç°barrierå¯¹é½- å¯¹é½ï¼Œæ±‰è¯­è¯æ±‡ï¼Œé‡Šä¹‰ä¸ºä½¿ä¸¤ä¸ªä»¥ä¸Šäº‹ç‰©é…åˆæˆ–æ¥è§¦å¾—æ•´é½ã€‚ç”±æ±‰è¯­è§£é‡Šå¯å¾—å¯¹é½è‚¯å®šéœ€è¦ä¸¤ä¸ªä»¥ä¸Šäº‹ç‰©ï¼Œæ‰€ä»¥ï¼Œå¿…é¡»æœ‰å¤šä¸ªæµæ‰å«å¯¹é½ã€‚barrierå¯¹é½å…¶å®ä¹Ÿå°±æ˜¯ä¸Šæ¸¸å¤šä¸ªæµé…åˆä½¿å¾—æ•°æ®å¯¹é½çš„è¿‡ç¨‹ - è¨€å¤–ä¹‹æ„ï¼šå¦‚æœOperatorå®ä¾‹åªæœ‰ä¸€ä¸ªè¾“å…¥æµï¼Œå°±æ ¹æœ¬ä¸å­˜åœ¨barrierå¯¹é½ï¼Œè‡ªå·±è·Ÿè‡ªå·±é»˜è®¤æ°¸è¿œéƒ½æ˜¯å¯¹é½çš„Q&amp;Aç¬¬ä¸€ç§åœºæ™¯è®¡ç®—PVï¼Œkafkaåªæœ‰ä¸€ä¸ªpartitionï¼Œç²¾ç¡®ä¸€æ¬¡ï¼Œè‡³å°‘ä¸€æ¬¡å°±æ²¡æœ‰åŒºåˆ«ï¼Ÿç­”ï¼šå¦‚æœåªæœ‰ä¸€ä¸ªpartitionï¼Œå¯¹åº”flinkä»»åŠ¡çš„Source Taskå¹¶è¡Œåº¦åªèƒ½æ˜¯1ï¼Œç¡®å®æ²¡æœ‰åŒºåˆ«ï¼Œä¸ä¼šæœ‰è‡³å°‘ä¸€æ¬¡çš„å­˜åœ¨äº†ï¼Œè‚¯å®šæ˜¯ç²¾ç¡®ä¸€æ¬¡ã€‚å› ä¸ºåªæœ‰barrierä¸å¯¹é½æ‰ä¼šæœ‰å¯èƒ½é‡å¤å¤„ç†ï¼Œè¿™é‡Œå¹¶è¡Œåº¦éƒ½å·²ç»ä¸º1ï¼Œé»˜è®¤å°±æ˜¯å¯¹é½çš„ï¼Œåªæœ‰å½“ä¸Šæ¸¸æœ‰å¤šä¸ªå¹¶è¡Œåº¦çš„æ—¶å€™ï¼Œå¤šä¸ªå¹¶è¡Œåº¦å‘åˆ°ä¸‹æ¸¸çš„barrieræ‰éœ€è¦å¯¹é½ï¼Œå•å¹¶è¡Œåº¦ä¸ä¼šå‡ºç°barrierä¸å¯¹é½ï¼Œæ‰€ä»¥å¿…ç„¶ç²¾ç¡®ä¸€æ¬¡ã€‚å…¶å®è¿˜æ˜¯è¦ç†è§£barrierå¯¹é½å°±æ˜¯Exactly Onceä¸ä¼šé‡å¤æ¶ˆè´¹ï¼Œbarrierä¸å¯¹é½å°±æ˜¯ At Least Onceå¯èƒ½é‡å¤æ¶ˆè´¹ï¼Œè¿™é‡Œåªæœ‰å•ä¸ªå¹¶è¡Œåº¦æ ¹æœ¬ä¸ä¼šå­˜åœ¨barrierä¸å¯¹é½ï¼Œæ‰€ä»¥ä¸ä¼šå­˜åœ¨è‡³å°‘ä¸€æ¬¡è¯­ä¹‰ä¸ºäº†ä¸‹æ¸¸å°½å¿«åšCheckPointï¼Œæ‰€ä»¥ä¼šå…ˆå‘é€barrieråˆ°ä¸‹æ¸¸ï¼Œè‡ªèº«å†åŒæ­¥è¿›è¡Œå¿«ç…§ï¼›è¿™ä¸€æ­¥ï¼Œå¦‚æœå‘ä¸‹å‘é€barrieråï¼Œè‡ªå·±åŒæ­¥å¿«ç…§æ…¢æ€ä¹ˆåŠï¼Ÿä¸‹æ¸¸å·²ç»åŒæ­¥å¥½äº†ï¼Œè‡ªå·±è¿˜æ²¡ï¼Ÿç­”: å¯èƒ½ä¼šå‡ºç°ä¸‹æ¸¸æ¯”ä¸Šæ¸¸å¿«ç…§è¿˜æ—©çš„æƒ…å†µï¼Œä½†æ˜¯è¿™ä¸å½±å“å¿«ç…§ç»“æœï¼Œåªæ˜¯ä¸‹æ¸¸å¿«ç…§çš„æ›´åŠæ—¶äº†ï¼Œæˆ‘åªè¦ä¿éšœä¸‹æ¸¸æŠŠbarrierä¹‹å‰çš„æ•°æ®éƒ½å¤„ç†äº†ï¼Œå¹¶ä¸”ä¸å¤„ç†barrierä¹‹åçš„æ•°æ®ï¼Œç„¶ååšå¿«ç…§ï¼Œé‚£ä¹ˆä¸‹æ¸¸ä¹ŸåŒæ ·æ”¯æŒç²¾ç¡®ä¸€æ¬¡ã€‚è¿™ä¸ªé—®é¢˜ä½ ä¸è¦ä»å…¨å±€æ€è€ƒï¼Œä½ å•ç‹¬æ€è€ƒä¸Šæ¸¸å’Œä¸‹æ¸¸çš„å®ä¾‹ï¼Œä½ ä¼šå‘ç°ä¸Šä¸‹æ¸¸çš„çŠ¶æ€éƒ½æ˜¯å‡†ç¡®çš„ï¼Œæ—¢æ²¡æœ‰ä¸¢ï¼Œä¹Ÿæ²¡æœ‰é‡å¤è®¡ç®—ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœæœ‰ä¸€ä¸ªOperator çš„CheckPointå¤±è´¥äº†æˆ–è€…å› ä¸ºCheckPointè¶…æ—¶ä¹Ÿä¼šå¯¼è‡´å¤±è´¥ï¼Œé‚£ä¹ˆJobManagerä¼šè®¤ä¸ºæ•´ä¸ªCheckPointå¤±è´¥ã€‚å¤±è´¥çš„CheckPointæ˜¯ä¸èƒ½ç”¨æ¥æ¢å¤ä»»åŠ¡çš„ï¼Œå¿…é¡»æ‰€æœ‰çš„ç®—å­çš„CheckPointéƒ½æˆåŠŸï¼Œé‚£ä¹ˆè¿™æ¬¡CheckPointæ‰èƒ½è®¤ä¸ºæ˜¯æˆåŠŸçš„ï¼Œæ‰èƒ½ç”¨æ¥æ¢å¤ä»»åŠ¡æˆ‘ç¨‹åºä¸­Flinkçš„CheckPointè¯­ä¹‰è®¾ç½®äº† Exactly Onceï¼Œä½†æ˜¯æˆ‘çš„mysqlä¸­çœ‹åˆ°æ•°æ®é‡å¤äº†ï¼Ÿç¨‹åºä¸­è®¾ç½®äº†1åˆ†é’Ÿ1æ¬¡CheckPointï¼Œä½†æ˜¯5ç§’å‘mysqlå†™ä¸€æ¬¡æ•°æ®ï¼Œå¹¶commitç­”ï¼šFlinkè¦æ±‚end to endçš„ç²¾ç¡®ä¸€æ¬¡éƒ½å¿…é¡»å®ç°TwoPhaseCommitSinkFunctionã€‚å¦‚æœä½ çš„chk-100æˆåŠŸäº†ï¼Œè¿‡äº†30ç§’ï¼Œç”±äº5ç§’commitä¸€æ¬¡ï¼Œæ‰€ä»¥å®é™…ä¸Šå·²ç»å†™å…¥äº†6æ‰¹æ•°æ®è¿›å…¥mysqlï¼Œä½†æ˜¯çªç„¶ç¨‹åºæŒ‚äº†ï¼Œä»chk100å¤„æ¢å¤ï¼Œè¿™æ ·çš„è¯ï¼Œä¹‹å‰æäº¤çš„6æ‰¹æ•°æ®å°±ä¼šé‡å¤å†™å…¥ï¼Œæ‰€ä»¥å‡ºç°äº†é‡å¤æ¶ˆè´¹ã€‚Flinkçš„ç²¾ç¡®ä¸€æ¬¡æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ä¸ªæ˜¯Flinkå†…éƒ¨çš„ç²¾ç¡®ä¸€æ¬¡ï¼Œä¸€ä¸ªæ˜¯ç«¯å¯¹ç«¯çš„ç²¾ç¡®ä¸€æ¬¡ï¼Œè¿™ä¸ªåšå®¢æ‰€æè¿°çš„éƒ½æ˜¯å…³äºFlinkå†…éƒ¨å»çš„ç²¾ç¡®ä¸€æ¬¡ï¼Œæˆ‘åæœŸå†å‘ä¸€ä¸ªåšå®¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹Flinkç«¯å¯¹ç«¯çš„ç²¾ç¡®ä¸€æ¬¡å¦‚ä½•å®ç°è½¬è½½è‡ªï¼šhttps://www.jianshu.com/p/8d6569361999","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"flink","slug":"flink","permalink":"cpeixin.cn/tags/flink/"}]},{"title":"pythonçˆ¬è™« - åŠ¨æ€çˆ¬å–","slug":"pythonçˆ¬è™«ä¹‹åŠ¨æ€çˆ¬å–","date":"2019-06-12T15:26:15.000Z","updated":"2020-04-04T17:11:17.062Z","comments":true,"path":"2019/06/12/pythonçˆ¬è™«ä¹‹åŠ¨æ€çˆ¬å–/","link":"","permalink":"cpeixin.cn/2019/06/12/python%E7%88%AC%E8%99%AB%E4%B9%8B%E5%8A%A8%E6%80%81%E7%88%AC%E5%8F%96/","excerpt":"","text":"æˆ‘ä»¬çš„ç›®çš„æ˜¯æŠ“å–æ‹‰å‹¾ç½‘Pythonåˆ†ç±»ä¸‹å…¨å›½åˆ°ç›®å‰ä¸ºæ­¢å±•ç¤ºå‡ºæ¥çš„æ‰€æœ‰æ‹›è˜ä¿¡æ¯ï¼Œé¦–å…ˆåœ¨æµè§ˆå™¨ç‚¹å‡»è¿›å»çœ‹çœ‹å§ã€‚å¦‚æœä½ è¶³å¤Ÿå°å¿ƒæˆ–è€…ç½‘é€Ÿæ¯”è¾ƒæ…¢ï¼Œé‚£ä¹ˆä½ ä¼šå‘ç°ï¼Œåœ¨ç‚¹å‡»Pythonåˆ†ç±»ä¹‹åè·³åˆ°çš„æ–°é¡µé¢ä¸Šï¼Œæ‹›è˜ä¿¡æ¯å‡ºç°æ—¶é—´æ˜¯æ™šäºé¡µé¢æ¡†æ¶å‡ºç°æ—¶é—´çš„ã€‚åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å‡ ä¹å¯ä»¥è‚¯å®šï¼Œæ‹›è˜ä¿¡æ¯å¹¶ä¸åœ¨é¡µé¢HTMLæºç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‰ä¸‹â€command+option+uâ€(åœ¨Windowså’ŒLinuxä¸Šçš„å¿«æ·é”®æ˜¯â€ctrl+uâ€)æ¥æŸ¥çœ‹ç½‘é¡µæºç ï¼Œæœç„¶åœ¨æºç ä¸­æ²¡æœ‰å‡ºç°é¡µé¢å±•ç¤ºçš„æ‹›è˜ä¿¡æ¯ã€‚åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘çœ‹åˆ°çš„å¤§å¤šæ•°æ•™ç¨‹éƒ½ä¼šæ•™ï¼Œä½¿ç”¨ä»€ä¹ˆä»€ä¹ˆåº“ï¼Œå¦‚ä½•å¦‚ä½•æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒï¼Œé€šè¿‡æ€æ ·æ€æ ·çš„æ–¹å¼å®Œæˆç½‘é¡µçš„æ¸²æŸ“ï¼Œç„¶åå¾—åˆ°é‡Œé¢çš„ä¿¡æ¯â€¦æ°¸è¿œè®°ä½ï¼Œå¯¹äºçˆ¬è™«ç¨‹åºï¼Œæ¨¡æ‹Ÿæµè§ˆå™¨å¾€å¾€æ˜¯ä¸‹ä¸‹ç­–ï¼Œåªæœ‰å®åœ¨æ²¡æœ‰åŠæ³•äº†ï¼Œæ‰å»è€ƒè™‘æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒï¼Œå› ä¸ºé‚£æ ·çš„å†…å­˜å¼€é”€å®åœ¨æ˜¯å¾ˆå¤§ï¼Œè€Œä¸”æ•ˆç‡éå¸¸ä½ã€‚é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿç»éªŒæ˜¯ï¼Œè¿™æ ·çš„æƒ…å†µï¼Œå¤§å¤šæ˜¯æ˜¯æµè§ˆå™¨ä¼šåœ¨è¯·æ±‚å’Œè§£æHTMLä¹‹åï¼Œæ ¹æ®jsçš„â€œæŒ‡ç¤ºâ€å†å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œå¾—åˆ°é¡µé¢å±•ç¤ºçš„å†…å®¹ï¼Œç„¶åé€šè¿‡jsæ¸²æŸ“ä¹‹åå±•ç¤ºåˆ°ç•Œé¢ã€‚å¥½æ¶ˆæ¯æ˜¯ï¼Œè¿™æ ·çš„è¯·æ±‚å¾€å¾€å¾—åˆ°çš„å†…å®¹æ˜¯jsonæ ¼å¼çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éä½†ä¸ä¼šåŠ é‡çˆ¬è™«çš„ä»»åŠ¡ï¼Œåè€Œå¯èƒ½ä¼šçœå»è§£æHTMLçš„åŠŸå¤«ã€‚é‚£ä¸ªï¼Œç»§ç»­æ‰“å¼€Chromeçš„å¼€å‘è€…å·¥å…·ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»â€œä¸‹ä¸€é¡µâ€ä¹‹åï¼Œæµè§ˆå™¨å‘é€äº†å¦‚ä¸‹è¯·æ±‚ï¼šæ³¨æ„è§‚å¯Ÿâ€positionAjax.jsonâ€è¿™ä¸ªè¯·æ±‚ï¼Œå®ƒçš„Typeæ˜¯â€xhrâ€ï¼Œå…¨ç§°å«åšâ€XMLHttpRequestâ€ï¼ŒXMLHttpRequestå¯¹è±¡å¯ä»¥åœ¨ä¸å‘æœåŠ¡å™¨æäº¤æ•´ä¸ªé¡µé¢çš„æƒ…å†µä¸‹ï¼Œå®ç°å±€éƒ¨æ›´æ–°ç½‘é¡µã€‚é‚£ä¹ˆï¼Œç°åœ¨å®ƒçš„å¯èƒ½æ€§æœ€å¤§äº†ï¼Œæˆ‘ä»¬å•å‡»å®ƒä¹‹åå¥½å¥½è§‚å¯Ÿè§‚å¯Ÿå§ï¼šç‚¹å‡»ä¹‹åæˆ‘ä»¬åœ¨å³ä¸‹è§’å‘ç°äº†å¦‚ä¸Šè¯¦æƒ…ï¼Œå…¶ä¸­å‡ ä¸ªtabçš„å†…å®¹è¡¨ç¤ºï¼šHeadersï¼šè¯·æ±‚å’Œå“åº”çš„è¯¦ç»†ä¿¡æ¯Previewï¼šå“åº”ä½“æ ¼å¼åŒ–ä¹‹åçš„æ˜¾ç¤ºResponseï¼šå“åº”ä½“åŸå§‹å†…å®¹Cookiesï¼šCookiesTimingï¼šæ—¶é—´å¼€é”€é€šè¿‡å¯¹å†…å®¹çš„è§‚å¯Ÿï¼Œè¿”å›çš„ç¡®å®æ˜¯ä¸€ä¸ªjsonå­—ç¬¦ä¸²ï¼Œå†…å®¹åŒ…æ‹¬æœ¬é¡µæ¯ä¸€ä¸ªæ‹›è˜ä¿¡æ¯ï¼Œåˆ°è¿™é‡Œè‡³å°‘æˆ‘ä»¬å·²ç»æ¸…æ¥šäº†ï¼Œç¡®å®ä¸éœ€è¦è§£æHTMLå°±å¯ä»¥æ‹¿åˆ°æ‹‰é’©æ‹›è˜çš„ä¿¡æ¯äº†ã€‚é‚£ä¹ˆï¼Œè¯·æ±‚è¯¥å¦‚ä½•æ¨¡æ‹Ÿå‘¢ï¼Ÿæˆ‘ä»¬åˆ‡æ¢åˆ°Headersè¿™ä¸€æ ï¼Œç•™æ„ä¸‰ä¸ªåœ°æ–¹ï¼šä¸Šé¢çš„æˆªå›¾å±•ç¤ºäº†è¿™æ¬¡è¯·æ±‚çš„è¯·æ±‚æ–¹å¼ã€è¯·æ±‚åœ°å€ç­‰ä¿¡æ¯ã€‚ä¸Šé¢çš„æˆªå›¾å±•ç¤ºäº†è¿™æ¬¡è¯·æ±‚çš„è¯·æ±‚å¤´ï¼Œä¸€èˆ¬æ¥è®²ï¼Œå…¶ä¸­æˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ˜¯Cookie / Host / Origin / Referer / User-Agent / X-Requested-Withç­‰å‚æ•°ã€‚ä¸Šé¢è¿™å¼ æˆªå›¾å±•ç¤ºäº†è¿™æ¬¡è¯·æ±‚çš„æäº¤æ•°æ®ï¼Œæ ¹æ®è§‚å¯Ÿï¼Œkdè¡¨ç¤ºæˆ‘ä»¬æŸ¥è¯¢çš„å…³é”®å­—ï¼Œpnè¡¨ç¤ºå½“å‰é¡µç ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬çš„çˆ¬è™«éœ€è¦åšçš„äº‹æƒ…ï¼Œå°±æ˜¯æŒ‰ç…§é¡µç ä¸æ–­å‘è¿™ä¸ªæ¥å£å‘é€è¯·æ±‚ï¼Œå¹¶è§£æå…¶ä¸­çš„jsonå†…å®¹ï¼Œå°†æˆ‘ä»¬éœ€è¦çš„å€¼å­˜å‚¨ä¸‹æ¥å°±å¥½äº†ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼šä»€ä¹ˆæ—¶å€™ç»“æŸï¼Œä»¥åŠå¦‚ä½•çš„åˆ°jsonä¸­æœ‰ä»·å€¼çš„å†…å®¹ã€‚æˆ‘ä»¬å›è¿‡å¤´é‡æ–°è§‚å¯Ÿä¸€ä¸‹è¿”å›çš„jsonï¼Œæ ¼å¼åŒ–ä¹‹åçš„å±‚çº§å…³ç³»å¦‚ä¸‹ï¼šå¾ˆå®¹æ˜“å‘ç°ï¼Œcontentä¸‹çš„hasNextPageå³ä¸ºæ˜¯å¦å­˜åœ¨ä¸‹ä¸€é¡µï¼Œè€Œcontentä¸‹çš„resultæ˜¯ä¸€ä¸ªlistï¼Œå…¶ä¸­çš„æ¯é¡¹åˆ™æ˜¯ä¸€æ¡æ‹›è˜ä¿¡æ¯ã€‚åœ¨Pythonä¸­ï¼Œjsonå­—ç¬¦ä¸²åˆ°å¯¹è±¡çš„æ˜ å°„å¯ä»¥é€šè¿‡jsonè¿™ä¸ªåº“å®Œæˆï¼š1234import jsonjson_obj = json.loads(\"&#123;'key': 'value'&#125;\") # å­—ç¬¦ä¸²åˆ°å¯¹è±¡json_str = json.dumps(json_obj) # å¯¹è±¡åˆ°å­—ç¬¦ä¸²jsonå­—ç¬¦ä¸²çš„â€[ ]â€œæ˜ å°„åˆ°Pythonçš„ç±»å‹æ˜¯listï¼Œâ€{ }â€æ˜ å°„åˆ°Pythonåˆ™æ˜¯dictã€‚åˆ°è¿™é‡Œï¼Œåˆ†æè¿‡ç¨‹å·²ç»å®Œå…¨ç»“æŸï¼Œå¯ä»¥æ„‰å¿«çš„å†™ä»£ç å•¦ã€‚å…·ä½“ä»£ç è¿™é‡Œä¸å†ç»™å‡ºï¼Œå¸Œæœ›ä½ å¯ä»¥è‡ªå·±ç‹¬ç«‹å®Œæˆï¼Œå¦‚æœåœ¨ç¼–å†™è¿‡ç¨‹ä¸­å­˜åœ¨é—®é¢˜ï¼Œå¯ä»¥è”ç³»æˆ‘è·å–å¸®åŠ©ã€‚","categories":[{"name":"python","slug":"python","permalink":"cpeixin.cn/categories/python/"}],"tags":[{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"cpeixin.cn/tags/%E7%88%AC%E8%99%AB/"}]},{"title":"ã€è½¬è½½ã€‘è°ˆè°ˆæµè®¡ç®—ä¸­çš„ã€Exactly Onceã€ç‰¹æ€§","slug":"ã€è½¬è½½ã€‘è°ˆè°ˆæµè®¡ç®—ä¸­çš„ã€Exactly-Onceã€ç‰¹æ€§","date":"2019-06-02T16:40:09.000Z","updated":"2020-07-01T16:41:41.011Z","comments":true,"path":"2019/06/03/ã€è½¬è½½ã€‘è°ˆè°ˆæµè®¡ç®—ä¸­çš„ã€Exactly-Onceã€ç‰¹æ€§/","link":"","permalink":"cpeixin.cn/2019/06/03/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E8%B0%88%E8%B0%88%E6%B5%81%E8%AE%A1%E7%AE%97%E4%B8%AD%E7%9A%84%E3%80%8EExactly-Once%E3%80%8F%E7%89%B9%E6%80%A7/","excerpt":"","text":"æœ¬æ–‡ç¿»è¯‘è‡ª streaml.io ç½‘ç«™ä¸Šçš„ä¸€ç¯‡åšæ–‡ï¼šâ€œExactly once is NOT exactly the sameâ€ ï¼Œåˆ†æäº†æµè®¡ç®—ç³»ç»Ÿä¸­å¸¸è¯´çš„ã€Exactly Onceã€ç‰¹æ€§ï¼Œä¸»è¦è§‚ç‚¹æ˜¯ï¼šã€ç²¾ç¡®ä¸€æ¬¡ã€å¹¶ä¸ä¿è¯æ˜¯å®Œå…¨ä¸€æ ·ã€‚ä¸»è¦å†…å®¹å¦‚ä¸‹ï¼šèƒŒæ™¯â€“ 1.1. æœ€å¤šä¸€æ¬¡ï¼ˆAt-most-onceï¼‰â€“ 1.2. è‡³å°‘ä¸€æ¬¡ï¼ˆAt-least-onceï¼‰â€“ 1.3. ç²¾ç¡®ä¸€æ¬¡ï¼ˆExactly-onceï¼‰ã€ç²¾ç¡®ä¸€æ¬¡ã€æ˜¯çœŸæ­£çš„ã€ç²¾ç¡®ä¸€æ¬¡ã€å—?åˆ†å¸ƒå¼å¿«ç…§ä¸è‡³å°‘ä¸€æ¬¡äº‹ä»¶ä¼ é€’å’Œé‡å¤æ•°æ®åˆ é™¤çš„æ¯”è¾ƒç»“è®ºå‚è€ƒç›®å‰å¸‚é¢ä¸Šä½¿ç”¨è¾ƒå¤šçš„æµè®¡ç®—ç³»ç»Ÿæœ‰ Apache Stormï¼ŒApache Flink, Heron, Apache Kafka (Kafka Streams) å’Œ Apache Spark (Spark Streaming)ã€‚å…³äºæµè®¡ç®—ç³»ç»Ÿæœ‰ä¸ªè¢«å¹¿æ³›è®¨è®ºçš„ç‰¹æ€§æ˜¯ã€exactly-onceã€è¯­ä¹‰ï¼Œå¾ˆå¤šç³»ç»Ÿå®£ç§°å·²ç»æ”¯æŒäº†è¿™ä¸€ç‰¹æ€§ã€‚ä½†æ˜¯ï¼Œåˆ°åº•ä»€ä¹ˆæ˜¯ã€exactly-onceã€ï¼Œæ€ä¹ˆæ ·æ‰ç®—æ˜¯å®ç°äº†ã€exactly-onceã€ï¼Œäººä»¬å­˜åœ¨å¾ˆå¤šè¯¯è§£å’Œæ­§ä¹‰ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åšä¸‹åˆ†æã€‚èƒŒæ™¯æµå¤„ç†ï¼ˆæœ‰æ—¶ç§°ä¸ºäº‹ä»¶å¤„ç†ï¼‰å¯ä»¥ç®€å•åœ°æè¿°ä¸ºæ˜¯å¯¹æ— ç•Œæ•°æ®æˆ–äº‹ä»¶çš„è¿ç»­å¤„ç†ã€‚æµæˆ–äº‹ä»¶å¤„ç†åº”ç”¨ç¨‹åºå¯ä»¥æˆ–å¤šæˆ–å°‘åœ°è¢«æè¿°ä¸ºæœ‰å‘å›¾ï¼Œå¹¶ä¸”é€šå¸¸è¢«æè¿°ä¸ºæœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ã€‚åœ¨è¿™æ ·çš„å›¾ä¸­ï¼Œæ¯ä¸ªè¾¹è¡¨ç¤ºæ•°æ®æˆ–äº‹ä»¶æµï¼Œæ¯ä¸ªé¡¶ç‚¹è¡¨ç¤ºè¿ç®—ç¬¦ï¼Œä¼šä½¿ç”¨ç¨‹åºä¸­å®šä¹‰çš„é€»è¾‘å¤„ç†æ¥è‡ªç›¸é‚»è¾¹çš„æ•°æ®æˆ–äº‹ä»¶ã€‚æœ‰ä¸¤ç§ç‰¹æ®Šç±»å‹çš„é¡¶ç‚¹ï¼Œé€šå¸¸ç§°ä¸º sources å’Œ sinksã€‚sourcesè¯»å–å¤–éƒ¨æ•°æ®/äº‹ä»¶åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œè€Œ sinks é€šå¸¸ä¼šæ”¶é›†åº”ç”¨ç¨‹åºç”Ÿæˆçš„ç»“æœã€‚ä¸‹å›¾æ˜¯æµå¼åº”ç”¨ç¨‹åºçš„ç¤ºä¾‹ã€‚A typical stream processing topologyæµå¤„ç†å¼•æ“é€šå¸¸å…è®¸ç”¨æˆ·æŒ‡å®šå¯é æ€§æ¨¡å¼æˆ–å¤„ç†è¯­ä¹‰ï¼Œä»¥æŒ‡ç¤ºå®ƒå°†ä¸ºæ•´ä¸ªåº”ç”¨ç¨‹åºä¸­çš„æ•°æ®å¤„ç†æä¾›å“ªäº›ä¿è¯ã€‚è¿™äº›ä¿è¯æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºä½ å§‹ç»ˆä¼šé‡åˆ°ç”±äºç½‘ç»œï¼Œæœºå™¨ç­‰å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±çš„æ•…éšœã€‚æµå¤„ç†å¼•æ“é€šå¸¸ä¸ºåº”ç”¨ç¨‹åºæä¾›äº†ä¸‰ç§æ•°æ®å¤„ç†è¯­ä¹‰ï¼šæœ€å¤šä¸€æ¬¡ã€è‡³å°‘ä¸€æ¬¡å’Œç²¾ç¡®ä¸€æ¬¡ã€‚å¦‚ä¸‹æ˜¯å¯¹è¿™äº›ä¸åŒå¤„ç†è¯­ä¹‰çš„å®½æ¾å®šä¹‰ï¼šæœ€å¤šä¸€æ¬¡ï¼ˆAt-most-onceï¼‰è¿™æœ¬è´¨ä¸Šæ˜¯ä¸€ã€å°½åŠ›è€Œä¸ºã€çš„æ–¹æ³•ã€‚ä¿è¯æ•°æ®æˆ–äº‹ä»¶æœ€å¤šç”±åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰ç®—å­å¤„ç†ä¸€æ¬¡ã€‚ è¿™æ„å‘³ç€å¦‚æœæ•°æ®åœ¨è¢«æµåº”ç”¨ç¨‹åºå®Œå…¨å¤„ç†ä¹‹å‰å‘ç”Ÿä¸¢å¤±ï¼Œåˆ™ä¸ä¼šè¿›è¡Œå…¶ä»–é‡è¯•æˆ–è€…é‡æ–°å‘é€ã€‚ä¸‹å›¾ä¸­çš„ä¾‹å­è¯´æ˜äº†è¿™ç§æƒ…å†µã€‚è‡³å°‘ä¸€æ¬¡ï¼ˆAt-least-onceï¼‰åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰ç®—å­éƒ½ä¿è¯æ•°æ®æˆ–äº‹ä»¶è‡³å°‘è¢«å¤„ç†ä¸€æ¬¡ã€‚è¿™é€šå¸¸æ„å‘³ç€å¦‚æœäº‹ä»¶åœ¨æµåº”ç”¨ç¨‹åºå®Œå…¨å¤„ç†ä¹‹å‰ä¸¢å¤±ï¼Œåˆ™å°†ä»æºå¤´é‡æ”¾æˆ–é‡æ–°ä¼ è¾“äº‹ä»¶ã€‚ç„¶è€Œï¼Œç”±äºäº‹ä»¶æ˜¯å¯ä»¥è¢«é‡ä¼ çš„ï¼Œå› æ­¤ä¸€ä¸ªäº‹ä»¶æœ‰æ—¶ä¼šè¢«å¤„ç†å¤šæ¬¡ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„è‡³å°‘ä¸€æ¬¡ã€‚ä¸‹å›¾çš„ä¾‹å­æè¿°äº†è¿™ç§æƒ…å†µï¼šç¬¬ä¸€ä¸ªç®—å­æœ€åˆæœªèƒ½æˆåŠŸå¤„ç†äº‹ä»¶ï¼Œç„¶ååœ¨é‡è¯•æ—¶æˆåŠŸï¼Œæ¥ç€åœ¨ç¬¬äºŒæ¬¡é‡è¯•æ—¶ä¹ŸæˆåŠŸäº†ï¼Œå…¶å®æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚ç²¾ç¡®ä¸€æ¬¡ï¼ˆExactly-onceï¼‰å³ä½¿æ˜¯åœ¨å„ç§æ•…éšœçš„æƒ…å†µä¸‹ï¼Œæµåº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰ç®—å­éƒ½ä¿è¯äº‹ä»¶åªä¼šè¢«ã€ç²¾ç¡®ä¸€æ¬¡ã€çš„å¤„ç†ã€‚ï¼ˆä¹Ÿæœ‰æ–‡ç« å°† Exactly-once ç¿»è¯‘ä¸ºï¼šå®Œå…¨ä¸€æ¬¡ï¼Œæ°å¥½ä¸€æ¬¡ï¼‰é€šå¸¸ä½¿ç”¨ä¸¤ç§æµè¡Œçš„æœºåˆ¶æ¥å®ç°ã€ç²¾ç¡®ä¸€æ¬¡ã€å¤„ç†è¯­ä¹‰ã€‚â€“ åˆ†å¸ƒå¼å¿«ç…§ / çŠ¶æ€æ£€æŸ¥ç‚¹â€“ è‡³å°‘ä¸€æ¬¡äº‹ä»¶ä¼ é€’å’Œå¯¹é‡å¤æ•°æ®å»é‡å®ç°ã€ç²¾ç¡®ä¸€æ¬¡ã€çš„åˆ†å¸ƒå¼å¿«ç…§/çŠ¶æ€æ£€æŸ¥ç‚¹æ–¹æ³•å—åˆ° Chandy-Lamport åˆ†å¸ƒå¼å¿«ç…§ç®—æ³•çš„å¯å‘[1]ã€‚é€šè¿‡è¿™ç§æœºåˆ¶ï¼Œæµåº”ç”¨ç¨‹åºä¸­æ¯ä¸ªç®—å­çš„æ‰€æœ‰çŠ¶æ€éƒ½ä¼šå®šæœŸåš checkpointã€‚å¦‚æœæ˜¯åœ¨ç³»ç»Ÿä¸­çš„ä»»ä½•åœ°æ–¹å‘ç”Ÿå¤±è´¥ï¼Œæ¯ä¸ªç®—å­çš„æ‰€æœ‰çŠ¶æ€éƒ½å›æ»šåˆ°æœ€æ–°çš„å…¨å±€ä¸€è‡´ checkpoint ç‚¹**ã€‚åœ¨å›æ»šæœŸé—´ï¼Œå°†æš‚åœæ‰€æœ‰å¤„ç†ã€‚æºä¹Ÿä¼šé‡ç½®ä¸ºä¸æœ€è¿‘ checkpoint ç›¸å¯¹åº”çš„æ­£ç¡®åç§»é‡ã€‚æ•´ä¸ªæµåº”ç”¨ç¨‹åºåŸºæœ¬ä¸Šæ˜¯å›åˆ°æœ€è¿‘ä¸€æ¬¡çš„ä¸€è‡´çŠ¶æ€ï¼Œç„¶åç¨‹åºå¯ä»¥ä»è¯¥çŠ¶æ€é‡æ–°å¯åŠ¨ã€‚ä¸‹å›¾æè¿°äº†è¿™ç§ checkpoint æœºåˆ¶çš„åŸºç¡€çŸ¥è¯†ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œæµåº”ç”¨ç¨‹åºåœ¨ T1 æ—¶é—´å¤„æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”åšäº†checkpointã€‚ç„¶è€Œï¼Œåœ¨æ—¶é—´ T2ï¼Œç®—å­æœªèƒ½å¤„ç†è¾“å…¥çš„æ•°æ®ã€‚æ­¤æ—¶ï¼ŒS=4 çš„çŠ¶æ€å€¼å·²ä¿å­˜åˆ°æŒä¹…å­˜å‚¨å™¨ä¸­ï¼Œè€ŒçŠ¶æ€å€¼ S=12 ä¿å­˜åœ¨ç®—å­çš„å†…å­˜ä¸­ã€‚ä¸ºäº†ä¿®å¤è¿™ç§å·®å¼‚ï¼Œåœ¨æ—¶é—´ T3ï¼Œå¤„ç†ç¨‹åºå°†çŠ¶æ€å›æ»šåˆ° S=4 å¹¶â€œé‡æ”¾â€æµä¸­çš„æ¯ä¸ªè¿ç»­çŠ¶æ€ç›´åˆ°æœ€è¿‘ï¼Œå¹¶å¤„ç†æ¯ä¸ªæ•°æ®ã€‚æœ€ç»ˆç»“æœæ˜¯æœ‰äº›æ•°æ®å·²è¢«å¤„ç†äº†å¤šæ¬¡ï¼Œä½†è¿™æ²¡å…³ç³»ï¼Œå› ä¸ºæ— è®ºæ‰§è¡Œäº†å¤šå°‘æ¬¡å›æ»šï¼Œç»“æœçŠ¶æ€éƒ½æ˜¯ç›¸åŒçš„ã€‚å¦ä¸€ç§å®ç°ã€ç²¾ç¡®ä¸€æ¬¡ã€çš„æ–¹æ³•æ˜¯ï¼šåœ¨æ¯ä¸ªç®—å­ä¸Šå®ç°è‡³å°‘ä¸€æ¬¡äº‹ä»¶ä¼ é€’å’Œå¯¹é‡å¤æ•°æ®å»é‡ã€‚ä½¿ç”¨æ­¤æ–¹æ³•çš„æµå¤„ç†å¼•æ“å°†é‡æ”¾å¤±è´¥äº‹ä»¶ï¼Œä»¥ä¾¿åœ¨äº‹ä»¶è¿›å…¥ç®—å­ä¸­çš„ç”¨æˆ·å®šä¹‰é€»è¾‘ä¹‹å‰ï¼Œè¿›ä¸€æ­¥å°è¯•å¤„ç†å¹¶ç§»é™¤æ¯ä¸ªç®—å­çš„é‡å¤äº‹ä»¶ã€‚æ­¤æœºåˆ¶è¦æ±‚ä¸ºæ¯ä¸ªç®—å­ç»´æŠ¤ä¸€ä¸ªäº‹åŠ¡æ—¥å¿—ï¼Œä»¥è·Ÿè¸ªå®ƒå·²å¤„ç†çš„äº‹ä»¶ã€‚åˆ©ç”¨è¿™ç§æœºåˆ¶çš„å¼•æ“æœ‰ Google çš„ MillWheel[2] å’Œ Apache Kafka Streamsã€‚ä¸‹å›¾è¯´æ˜äº†è¿™ç§æœºåˆ¶çš„è¦ç‚¹ã€‚ã€ç²¾ç¡®ä¸€æ¬¡ã€æ˜¯çœŸæ­£çš„ã€ç²¾ç¡®ä¸€æ¬¡ã€å—?ç°åœ¨è®©æˆ‘ä»¬é‡æ–°å®¡è§†ã€ç²¾ç¡®ä¸€æ¬¡ã€å¤„ç†è¯­ä¹‰çœŸæ­£å¯¹æœ€ç»ˆç”¨æˆ·çš„ä¿è¯ã€‚ã€ç²¾ç¡®ä¸€æ¬¡ã€è¿™ä¸ªæœ¯è¯­åœ¨æè¿°æ­£å¥½å¤„ç†ä¸€æ¬¡æ—¶ä¼šè®©äººäº§ç”Ÿè¯¯å¯¼ã€‚æœ‰äº›äººå¯èƒ½è®¤ä¸ºã€ç²¾ç¡®ä¸€æ¬¡ã€æè¿°äº†äº‹ä»¶å¤„ç†çš„ä¿è¯ï¼Œå…¶ä¸­æµä¸­çš„æ¯ä¸ªäº‹ä»¶åªè¢«å¤„ç†ä¸€æ¬¡ã€‚å®é™…ä¸Šï¼Œæ²¡æœ‰å¼•æ“èƒ½å¤Ÿä¿è¯æ­£å¥½åªå¤„ç†ä¸€æ¬¡ã€‚åœ¨é¢å¯¹ä»»æ„æ•…éšœæ—¶ï¼Œä¸å¯èƒ½ä¿è¯æ¯ä¸ªç®—å­ä¸­çš„ç”¨æˆ·å®šä¹‰é€»è¾‘åœ¨æ¯ä¸ªäº‹ä»¶ä¸­åªæ‰§è¡Œä¸€æ¬¡ï¼Œå› ä¸ºç”¨æˆ·ä»£ç è¢«éƒ¨åˆ†æ‰§è¡Œçš„å¯èƒ½æ€§æ˜¯æ°¸è¿œå­˜åœ¨çš„ã€‚è€ƒè™‘å…·æœ‰æµå¤„ç†è¿ç®—ç¬¦çš„åœºæ™¯ï¼Œè¯¥è¿ç®—ç¬¦æ‰§è¡Œæ‰“å°ä¼ å…¥äº‹ä»¶çš„ ID çš„æ˜ å°„æ“ä½œï¼Œç„¶åè¿”å›äº‹ä»¶ä¸å˜ã€‚ä¸‹é¢çš„ä¼ªä»£ç è¯´æ˜äº†è¿™ä¸ªæ“ä½œï¼š1234Map (Event event) &#123; Print \"Event ID: \" + event.getId() Return event&#125;æ¯ä¸ªäº‹ä»¶éƒ½æœ‰ä¸€ä¸ª GUID (å…¨å±€æƒŸä¸€ID)ã€‚å¦‚æœç”¨æˆ·é€»è¾‘çš„ç²¾ç¡®æ‰§è¡Œä¸€æ¬¡å¾—åˆ°ä¿è¯ï¼Œé‚£ä¹ˆäº‹ä»¶ ID å°†åªè¾“å‡ºä¸€æ¬¡ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯æ— æ³•ä¿è¯çš„ï¼Œå› ä¸ºåœ¨ç”¨æˆ·å®šä¹‰çš„é€»è¾‘çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œéšæ—¶éƒ½å¯èƒ½å‘ç”Ÿæ•…éšœã€‚å¼•æ“æ— æ³•è‡ªè¡Œç¡®å®šæ‰§è¡Œç”¨æˆ·å®šä¹‰çš„å¤„ç†é€»è¾‘çš„æ—¶é—´ç‚¹ã€‚å› æ­¤ï¼Œä¸èƒ½ä¿è¯ä»»æ„ç”¨æˆ·å®šä¹‰çš„é€»è¾‘åªæ‰§è¡Œä¸€æ¬¡ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œåœ¨ç”¨æˆ·å®šä¹‰çš„é€»è¾‘ä¸­å®ç°çš„å¤–éƒ¨æ“ä½œ(å¦‚å†™æ•°æ®åº“)ä¹Ÿä¸èƒ½ä¿è¯åªæ‰§è¡Œä¸€æ¬¡ã€‚æ­¤ç±»æ“ä½œä»ç„¶éœ€è¦ä»¥å¹‚ç­‰çš„æ–¹å¼æ‰§è¡Œã€‚é‚£ä¹ˆï¼Œå½“å¼•æ“å£°æ˜ã€ç²¾ç¡®ä¸€æ¬¡ã€å¤„ç†è¯­ä¹‰æ—¶ï¼Œå®ƒä»¬èƒ½ä¿è¯ä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœä¸èƒ½ä¿è¯ç”¨æˆ·é€»è¾‘åªæ‰§è¡Œä¸€æ¬¡ï¼Œé‚£ä¹ˆä»€ä¹ˆé€»è¾‘åªæ‰§è¡Œä¸€æ¬¡ï¼Ÿå½“å¼•æ“å£°æ˜ã€ç²¾ç¡®ä¸€æ¬¡ã€å¤„ç†è¯­ä¹‰æ—¶ï¼Œå®ƒä»¬å®é™…ä¸Šæ˜¯åœ¨è¯´ï¼Œå®ƒä»¬å¯ä»¥ä¿è¯å¼•æ“ç®¡ç†çš„çŠ¶æ€æ›´æ–°åªæäº¤ä¸€æ¬¡åˆ°æŒä¹…çš„åç«¯å­˜å‚¨ã€‚ä¸Šé¢æè¿°çš„ä¸¤ç§æœºåˆ¶éƒ½ä½¿ç”¨æŒä¹…çš„åç«¯å­˜å‚¨ä½œä¸ºçœŸå®æ€§çš„æ¥æºï¼Œå¯ä»¥ä¿å­˜æ¯ä¸ªç®—å­çš„çŠ¶æ€å¹¶è‡ªåŠ¨å‘å…¶æäº¤æ›´æ–°ã€‚å¯¹äºæœºåˆ¶ 1 (åˆ†å¸ƒå¼å¿«ç…§ / çŠ¶æ€æ£€æŸ¥ç‚¹)ï¼Œæ­¤æŒä¹…åç«¯çŠ¶æ€ç”¨äºä¿å­˜æµåº”ç”¨ç¨‹åºçš„å…¨å±€ä¸€è‡´çŠ¶æ€æ£€æŸ¥ç‚¹(æ¯ä¸ªç®—å­çš„æ£€æŸ¥ç‚¹çŠ¶æ€)ã€‚å¯¹äºæœºåˆ¶ 2 (è‡³å°‘ä¸€æ¬¡äº‹ä»¶ä¼ é€’åŠ ä¸Šé‡å¤æ•°æ®åˆ é™¤)ï¼ŒæŒä¹…åç«¯çŠ¶æ€ç”¨äºå­˜å‚¨æ¯ä¸ªç®—å­çš„çŠ¶æ€ä»¥åŠæ¯ä¸ªç®—å­çš„äº‹åŠ¡æ—¥å¿—ï¼Œè¯¥æ—¥å¿—è·Ÿè¸ªå®ƒå·²ç»å®Œå…¨å¤„ç†çš„æ‰€æœ‰äº‹ä»¶ã€‚æäº¤çŠ¶æ€æˆ–å¯¹ä½œä¸ºçœŸå®æ¥æºçš„æŒä¹…åç«¯åº”ç”¨æ›´æ–°å¯ä»¥è¢«æè¿°ä¸ºæ°å¥½å‘ç”Ÿä¸€æ¬¡ã€‚ç„¶è€Œï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œè®¡ç®—çŠ¶æ€çš„æ›´æ–° / æ›´æ”¹ï¼Œå³å¤„ç†åœ¨äº‹ä»¶ä¸Šæ‰§è¡Œä»»æ„ç”¨æˆ·å®šä¹‰é€»è¾‘çš„äº‹ä»¶ï¼Œå¦‚æœå‘ç”Ÿæ•…éšœï¼Œåˆ™å¯èƒ½ä¸æ­¢ä¸€æ¬¡åœ°å‘ç”Ÿã€‚æ¢å¥è¯è¯´ï¼Œäº‹ä»¶çš„å¤„ç†å¯ä»¥å‘ç”Ÿå¤šæ¬¡ï¼Œä½†æ˜¯è¯¥å¤„ç†çš„æ•ˆæœåªåœ¨æŒä¹…åç«¯çŠ¶æ€å­˜å‚¨ä¸­åæ˜ ä¸€æ¬¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è®¤ä¸ºæœ‰æ•ˆåœ°æè¿°è¿™äº›å¤„ç†è¯­ä¹‰æœ€å¥½çš„æœ¯è¯­æ˜¯ã€æœ‰æ•ˆä¸€æ¬¡ã€ï¼ˆeffectively onceï¼‰ã€‚**åˆ†å¸ƒå¼å¿«ç…§ä¸è‡³å°‘ä¸€æ¬¡äº‹ä»¶ä¼ é€’å’Œé‡å¤æ•°æ®åˆ é™¤çš„æ¯”è¾ƒä»è¯­ä¹‰çš„è§’åº¦æ¥çœ‹ï¼Œåˆ†å¸ƒå¼å¿«ç…§å’Œè‡³å°‘ä¸€æ¬¡äº‹ä»¶ä¼ é€’ä»¥åŠé‡å¤æ•°æ®åˆ é™¤æœºåˆ¶éƒ½æä¾›äº†ç›¸åŒçš„ä¿è¯ã€‚ç„¶è€Œï¼Œç”±äºä¸¤ç§æœºåˆ¶ä¹‹é—´çš„å®ç°å·®å¼‚ï¼Œå­˜åœ¨æ˜¾ç€çš„æ€§èƒ½å·®å¼‚ã€‚æœºåˆ¶ 1ï¼ˆåˆ†å¸ƒå¼å¿«ç…§ / çŠ¶æ€æ£€æŸ¥ç‚¹ï¼‰çš„æ€§èƒ½å¼€é”€æ˜¯æœ€å°çš„ï¼Œå› ä¸ºå¼•æ“å®é™…ä¸Šæ˜¯å¾€æµåº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰ç®—å­ä¸€èµ·å‘é€å¸¸è§„äº‹ä»¶å’Œç‰¹æ®Šäº‹ä»¶ï¼Œè€ŒçŠ¶æ€æ£€æŸ¥ç‚¹å¯ä»¥åœ¨åå°å¼‚æ­¥æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œå¯¹äºå¤§å‹æµåº”ç”¨ç¨‹åºï¼Œæ•…éšœå¯èƒ½ä¼šæ›´é¢‘ç¹åœ°å‘ç”Ÿï¼Œå¯¼è‡´å¼•æ“éœ€è¦æš‚åœåº”ç”¨ç¨‹åºå¹¶å›æ»šæ‰€æœ‰ç®—å­çš„çŠ¶æ€ï¼Œè¿™åè¿‡æ¥åˆä¼šå½±å“æ€§èƒ½ã€‚æµå¼åº”ç”¨ç¨‹åºè¶Šå¤§ï¼Œæ•…éšœå‘ç”Ÿçš„å¯èƒ½æ€§å°±è¶Šå¤§ï¼Œå› æ­¤ä¹Ÿè¶Šé¢‘ç¹ï¼Œåè¿‡æ¥ï¼Œæµå¼åº”ç”¨ç¨‹åºçš„æ€§èƒ½å—åˆ°çš„å½±å“ä¹Ÿå°±è¶Šå¤§ã€‚ç„¶è€Œï¼Œè¿™ç§æœºåˆ¶æ˜¯éä¾µå…¥æ€§çš„ï¼Œè¿è¡Œæ—¶éœ€è¦çš„é¢å¤–èµ„æºå½±å“å¾ˆå°ã€‚æœºåˆ¶ 2ï¼ˆè‡³å°‘ä¸€æ¬¡äº‹ä»¶ä¼ é€’åŠ é‡å¤æ•°æ®åˆ é™¤ï¼‰å¯èƒ½éœ€è¦æ›´å¤šèµ„æºï¼Œå°¤å…¶æ˜¯å­˜å‚¨ã€‚ä½¿ç”¨æ­¤æœºåˆ¶ï¼Œå¼•æ“éœ€è¦èƒ½å¤Ÿè·Ÿè¸ªæ¯ä¸ªç®—å­å®ä¾‹å·²å®Œå…¨å¤„ç†çš„æ¯ä¸ªå…ƒç»„ï¼Œä»¥æ‰§è¡Œé‡å¤æ•°æ®åˆ é™¤ï¼Œä»¥åŠä¸ºæ¯ä¸ªäº‹ä»¶æ‰§è¡Œé‡å¤æ•°æ®åˆ é™¤æœ¬èº«ã€‚è¿™æ„å‘³ç€éœ€è¦è·Ÿè¸ªå¤§é‡çš„æ•°æ®ï¼Œå°¤å…¶æ˜¯åœ¨æµåº”ç”¨ç¨‹åºå¾ˆå¤§æˆ–è€…æœ‰è®¸å¤šåº”ç”¨ç¨‹åºåœ¨è¿è¡Œçš„æƒ…å†µä¸‹ã€‚æ‰§è¡Œé‡å¤æ•°æ®åˆ é™¤çš„æ¯ä¸ªç®—å­ä¸Šçš„æ¯ä¸ªäº‹ä»¶éƒ½ä¼šäº§ç”Ÿæ€§èƒ½å¼€é”€ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è¿™ç§æœºåˆ¶ï¼Œæµåº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¸å¤ªå¯èƒ½å—åˆ°åº”ç”¨ç¨‹åºå¤§å°çš„å½±å“ã€‚å¯¹äºæœºåˆ¶ 1ï¼Œå¦‚æœä»»ä½•ç®—å­å‘ç”Ÿæ•…éšœï¼Œåˆ™éœ€è¦å‘ç”Ÿå…¨å±€æš‚åœå’ŒçŠ¶æ€å›æ»šï¼›å¯¹äºæœºåˆ¶ 2ï¼Œå¤±è´¥çš„å½±å“æ›´åŠ å±€éƒ¨æ€§ã€‚å½“åœ¨ç®—å­ä¸­å‘ç”Ÿæ•…éšœæ—¶ï¼Œå¯èƒ½å°šæœªå®Œå…¨å¤„ç†çš„äº‹ä»¶ä»…ä»ä¸Šæ¸¸æºé‡æ”¾/é‡ä¼ ã€‚æ€§èƒ½å½±å“ä¸æµåº”ç”¨ç¨‹åºä¸­å‘ç”Ÿæ•…éšœçš„ä½ç½®æ˜¯éš”ç¦»çš„ï¼Œå¹¶ä¸”å¯¹æµåº”ç”¨ç¨‹åºä¸­å…¶ä»–ç®—å­çš„æ€§èƒ½å‡ ä¹æ²¡æœ‰å½±å“ã€‚ä»æ€§èƒ½è§’åº¦æ¥çœ‹ï¼Œè¿™ä¸¤ç§æœºåˆ¶çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ã€‚åˆ†å¸ƒå¼å¿«ç…§ / çŠ¶æ€æ£€æŸ¥ç‚¹çš„ä¼˜ç¼ºç‚¹ï¼šä¼˜ç‚¹ï¼šâ€“ è¾ƒå°çš„æ€§èƒ½å’Œèµ„æºå¼€ç¼ºç‚¹ï¼šâ€“ å¯¹æ€§èƒ½çš„å½±å“è¾ƒå¤§â€“ æ‹“æ‰‘è¶Šå¤§ï¼Œå¯¹æ€§èƒ½çš„æ½œåœ¨å½±å“è¶Šå¤§è‡³å°‘ä¸€æ¬¡äº‹ä»¶ä¼ é€’ä»¥åŠé‡å¤æ•°æ®åˆ é™¤æœºåˆ¶çš„ä¼˜ç¼ºç‚¹ï¼šä¼˜ç‚¹ï¼š **â€“ æ•…éšœå¯¹æ€§èƒ½çš„å½±å“æ˜¯å±€éƒ¨çš„â€“ æ•…éšœçš„å½±å“ä¸ä¸€å®šä¼šéšç€æ‹“æ‰‘çš„å¤§å°è€Œå¢åŠ ç¼ºç‚¹ï¼š**â€“ å¯èƒ½éœ€è¦å¤§é‡çš„å­˜å‚¨å’ŒåŸºç¡€è®¾æ–½æ¥æ”¯æŒâ€“ æ¯ä¸ªç®—å­çš„æ¯ä¸ªäº‹ä»¶çš„æ€§èƒ½å¼€é”€è™½ç„¶ä»ç†è®ºä¸Šè®²ï¼Œåˆ†å¸ƒå¼å¿«ç…§å’Œè‡³å°‘ä¸€æ¬¡äº‹ä»¶ä¼ é€’åŠ é‡å¤æ•°æ®åˆ é™¤æœºåˆ¶ä¹‹é—´å­˜åœ¨å·®å¼‚ï¼Œä½†ä¸¤è€…éƒ½å¯ä»¥ç®€åŒ–ä¸ºè‡³å°‘ä¸€æ¬¡å¤„ç†åŠ å¹‚ç­‰æ€§ã€‚å¯¹äºè¿™ä¸¤ç§æœºåˆ¶ï¼Œå½“å‘ç”Ÿæ•…éšœæ—¶(è‡³å°‘å®ç°ä¸€æ¬¡)ï¼Œäº‹ä»¶å°†è¢«é‡æ”¾/é‡ä¼ ï¼Œå¹¶ä¸”é€šè¿‡çŠ¶æ€å›æ»šæˆ–äº‹ä»¶é‡å¤æ•°æ®åˆ é™¤ï¼Œç®—å­åœ¨æ›´æ–°å†…éƒ¨ç®¡ç†çŠ¶æ€æ—¶æœ¬è´¨ä¸Šæ˜¯å¹‚ç­‰çš„ã€‚ç»“è®ºåœ¨è¿™ç¯‡åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿè®©ä½ ç›¸ä¿¡ã€ç²¾ç¡®ä¸€æ¬¡ã€è¿™ä¸ªè¯æ˜¯éå¸¸å…·æœ‰è¯¯å¯¼æ€§çš„ã€‚æä¾›ã€ç²¾ç¡®ä¸€æ¬¡ã€çš„å¤„ç†è¯­ä¹‰å®é™…ä¸Šæ„å‘³ç€æµå¤„ç†å¼•æ“ç®¡ç†çš„ç®—å­çŠ¶æ€çš„ä¸åŒæ›´æ–°åªåæ˜ ä¸€æ¬¡ã€‚ã€ç²¾ç¡®ä¸€æ¬¡ã€å¹¶ä¸èƒ½ä¿è¯äº‹ä»¶çš„å¤„ç†ï¼Œå³ä»»æ„ç”¨æˆ·å®šä¹‰é€»è¾‘çš„æ‰§è¡Œï¼Œåªä¼šå‘ç”Ÿä¸€æ¬¡ã€‚æˆ‘ä»¬æ›´å–œæ¬¢ç”¨ã€æœ‰æ•ˆä¸€æ¬¡ã€ï¼ˆeffectively onceï¼‰è¿™ä¸ªæœ¯è¯­æ¥è¡¨ç¤ºè¿™ç§ä¿è¯ï¼Œå› ä¸ºå¤„ç†ä¸ä¸€å®šä¿è¯åªå‘ç”Ÿä¸€æ¬¡ï¼Œä½†æ˜¯å¯¹å¼•æ“ç®¡ç†çš„çŠ¶æ€çš„å½±å“åªåæ˜ ä¸€æ¬¡ã€‚ä¸¤ç§æµè¡Œçš„æœºåˆ¶ï¼Œåˆ†å¸ƒå¼å¿«ç…§å’Œé‡å¤æ•°æ®åˆ é™¤ï¼Œè¢«ç”¨æ¥å®ç°ç²¾ç¡®/æœ‰æ•ˆçš„ä¸€æ¬¡æ€§å¤„ç†è¯­ä¹‰ã€‚è¿™ä¸¤ç§æœºåˆ¶ä¸ºæ¶ˆæ¯å¤„ç†å’ŒçŠ¶æ€æ›´æ–°æä¾›äº†ç›¸åŒçš„è¯­ä¹‰ä¿è¯ï¼Œä½†æ˜¯åœ¨æ€§èƒ½ä¸Šå­˜åœ¨å·®å¼‚ã€‚è¿™ç¯‡æ–‡ç« å¹¶ä¸æ˜¯è¦è®©ä½ ç›¸ä¿¡ä»»ä½•ä¸€ç§æœºåˆ¶éƒ½ä¼˜äºå¦ä¸€ç§ï¼Œå› ä¸ºå®ƒä»¬å„æœ‰åˆ©å¼Šã€‚ç»“","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"å¸ƒéš†è¿‡æ»¤å™¨-BloomFilter","slug":"å¸ƒéš†è¿‡æ»¤å™¨-BloomFilter","date":"2019-05-31T15:57:09.000Z","updated":"2020-07-31T15:59:50.613Z","comments":true,"path":"2019/05/31/å¸ƒéš†è¿‡æ»¤å™¨-BloomFilter/","link":"","permalink":"cpeixin.cn/2019/05/31/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8-BloomFilter/","excerpt":"","text":"ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿå…ˆæ¥çœ‹å‡ ä¸ªæ¯”è¾ƒå¸¸è§çš„ä¾‹å­å­—å¤„ç†è½¯ä»¶ä¸­ï¼Œéœ€è¦æ£€æŸ¥ä¸€ä¸ªè‹±è¯­å•è¯æ˜¯å¦æ‹¼å†™æ­£ç¡®åœ¨ FBIï¼Œä¸€ä¸ªå«Œç–‘äººçš„åå­—æ˜¯å¦å·²ç»åœ¨å«Œç–‘åå•ä¸Šåœ¨ç½‘ç»œçˆ¬è™«é‡Œï¼Œä¸€ä¸ªç½‘å€æ˜¯å¦è¢«è®¿é—®è¿‡yahoo, gmailç­‰é‚®ç®±åƒåœ¾é‚®ä»¶è¿‡æ»¤åŠŸèƒ½è¿™å‡ ä¸ªä¾‹å­æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼š å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Ÿå¸¸è§„æ€è·¯æ•°ç»„é“¾è¡¨æ ‘ã€å¹³è¡¡äºŒå‰æ ‘ã€TrieMap (çº¢é»‘æ ‘)å“ˆå¸Œè¡¨è™½ç„¶ä¸Šé¢æè¿°çš„è¿™å‡ ç§æ•°æ®ç»“æ„é…åˆå¸¸è§çš„æ’åºã€äºŒåˆ†æœç´¢å¯ä»¥å¿«é€Ÿé«˜æ•ˆçš„å¤„ç†ç»å¤§éƒ¨åˆ†åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨é›†åˆä¸­çš„éœ€æ±‚ã€‚ä½†æ˜¯å½“é›†åˆé‡Œé¢çš„å…ƒç´ æ•°é‡è¶³å¤Ÿå¤§ï¼Œå¦‚æœæœ‰500ä¸‡æ¡è®°å½•ç”šè‡³1äº¿æ¡è®°å½•å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å¸¸è§„çš„æ•°æ®ç»“æ„çš„é—®é¢˜å°±å‡¸æ˜¾å‡ºæ¥äº†ã€‚æ•°ç»„ã€é“¾è¡¨ã€æ ‘ç­‰æ•°æ®ç»“æ„ä¼šå­˜å‚¨å…ƒç´ çš„å†…å®¹ï¼Œä¸€æ—¦æ•°æ®é‡è¿‡å¤§ï¼Œæ¶ˆè€—çš„å†…å­˜ä¹Ÿä¼šå‘ˆç°çº¿æ€§å¢é•¿ï¼Œæœ€ç»ˆè¾¾åˆ°ç“¶é¢ˆã€‚æœ‰çš„åŒå­¦å¯èƒ½ä¼šé—®ï¼Œå“ˆå¸Œè¡¨ä¸æ˜¯æ•ˆç‡å¾ˆé«˜å—ï¼ŸæŸ¥è¯¢æ•ˆç‡å¯ä»¥è¾¾åˆ°O(1)ã€‚ä½†æ˜¯å“ˆå¸Œè¡¨éœ€è¦æ¶ˆè€—çš„å†…å­˜ä¾ç„¶å¾ˆé«˜ã€‚ä½¿ç”¨å“ˆå¸Œè¡¨å­˜å‚¨ä¸€äº¿ ä¸ªåƒåœ¾ email åœ°å€çš„æ¶ˆè€—ï¼Ÿå“ˆå¸Œè¡¨çš„åšæ³•ï¼šé¦–å…ˆï¼Œå“ˆå¸Œå‡½æ•°å°†ä¸€ä¸ªemailåœ°å€æ˜ å°„æˆ8å­—èŠ‚ä¿¡æ¯æŒ‡çº¹ï¼›è€ƒè™‘åˆ°å“ˆå¸Œè¡¨å­˜å‚¨æ•ˆç‡é€šå¸¸å°äº50%ï¼ˆå“ˆå¸Œå†²çªï¼‰ï¼›å› æ­¤æ¶ˆè€—çš„å†…å­˜ï¼š8 * 2 * 1äº¿ å­—èŠ‚ = 1.6G å†…å­˜ï¼Œæ™®é€šè®¡ç®—æœºæ˜¯æ— æ³•æä¾›å¦‚æ­¤å¤§çš„å†…å­˜ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰å°±åº”è¿è€Œç”Ÿã€‚åœ¨ç»§ç»­ä»‹ç»å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†æ—¶ï¼Œå…ˆè®²è§£ä¸‹å…³äºå“ˆå¸Œå‡½æ•°çš„é¢„å¤‡çŸ¥è¯†ã€‚å“ˆå¸Œå‡½æ•°å“ˆå¸Œå‡½æ•°çš„æ¦‚å¿µæ˜¯ï¼šå°†ä»»æ„å¤§å°çš„æ•°æ®è½¬æ¢æˆç‰¹å®šå¤§å°çš„æ•°æ®çš„å‡½æ•°ï¼Œè½¬æ¢åçš„æ•°æ®ç§°ä¸ºå“ˆå¸Œå€¼æˆ–å“ˆå¸Œç¼–ç ã€‚ä¸‹é¢æ˜¯ä¸€å¹…ç¤ºæ„å›¾ï¼šå¯ä»¥æ˜æ˜¾çš„çœ‹åˆ°ï¼ŒåŸå§‹æ•°æ®ç»è¿‡å“ˆå¸Œå‡½æ•°çš„æ˜ å°„åç§°ä¸ºäº†ä¸€ä¸ªä¸ªçš„å“ˆå¸Œç¼–ç ï¼Œæ•°æ®å¾—åˆ°å‹ç¼©ã€‚å“ˆå¸Œå‡½æ•°æ˜¯å®ç°å“ˆå¸Œè¡¨å’Œå¸ƒéš†è¿‡æ»¤å™¨çš„åŸºç¡€ã€‚å¸ƒéš†è¿‡æ»¤å™¨ä»‹ç»å·´é¡¿.å¸ƒéš†äºä¸€ä¹ä¸ƒé›¶å¹´æå‡ºä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡ ï¼ˆä½æ•°ç»„ï¼‰ä¸€ç³»åˆ—éšæœºå‡½æ•° (å“ˆå¸Œ)ç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢æ•ˆç‡é«˜æœ‰ä¸€å®šçš„è¯¯åˆ¤ç‡ï¼ˆå“ˆå¸Œè¡¨æ˜¯ç²¾ç¡®åŒ¹é…ï¼‰å¸ƒéš†è¿‡æ»¤å™¨åŸç†å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰çš„æ ¸å¿ƒå®ç°æ˜¯ä¸€ä¸ªè¶…å¤§çš„ä½æ•°ç»„å’Œå‡ ä¸ªå“ˆå¸Œå‡½æ•°ã€‚å‡è®¾ä½æ•°ç»„çš„é•¿åº¦ä¸ºmï¼Œå“ˆå¸Œå‡½æ•°çš„ä¸ªæ•°ä¸ºkä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œå…·ä½“çš„æ“ä½œæµç¨‹ï¼šå‡è®¾é›†åˆé‡Œé¢æœ‰3ä¸ªå…ƒç´ {x, y, z}ï¼Œå“ˆå¸Œå‡½æ•°çš„ä¸ªæ•°ä¸º3ã€‚é¦–å…ˆå°†ä½æ•°ç»„è¿›è¡Œåˆå§‹åŒ–ï¼Œå°†é‡Œé¢æ¯ä¸ªä½éƒ½è®¾ç½®ä½0ã€‚å¯¹äºé›†åˆé‡Œé¢çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå°†å…ƒç´ ä¾æ¬¡é€šè¿‡3ä¸ªå“ˆå¸Œå‡½æ•°è¿›è¡Œæ˜ å°„ï¼Œæ¯æ¬¡æ˜ å°„éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œè¿™ä¸ªå€¼å¯¹åº”ä½æ•°ç»„ä¸Šé¢çš„ä¸€ä¸ªç‚¹ï¼Œç„¶åå°†ä½æ•°ç»„å¯¹åº”çš„ä½ç½®æ ‡è®°ä¸º1ã€‚æŸ¥è¯¢Wå…ƒç´ æ˜¯å¦å­˜åœ¨é›†åˆä¸­çš„æ—¶å€™ï¼ŒåŒæ ·çš„æ–¹æ³•å°†Wé€šè¿‡å“ˆå¸Œæ˜ å°„åˆ°ä½æ•°ç»„ä¸Šçš„3ä¸ªç‚¹ã€‚å¦‚æœ3ä¸ªç‚¹çš„å…¶ä¸­æœ‰ä¸€ä¸ªç‚¹ä¸ä¸º1ï¼Œåˆ™å¯ä»¥åˆ¤æ–­è¯¥å…ƒç´ ä¸€å®šä¸å­˜åœ¨é›†åˆä¸­ã€‚åä¹‹ï¼Œå¦‚æœ3ä¸ªç‚¹éƒ½ä¸º1ï¼Œåˆ™è¯¥å…ƒç´ å¯èƒ½å­˜åœ¨é›†åˆä¸­ã€‚æ³¨æ„ï¼šæ­¤å¤„ä¸èƒ½åˆ¤æ–­è¯¥å…ƒç´ æ˜¯å¦ä¸€å®šå­˜åœ¨é›†åˆä¸­ï¼Œå¯èƒ½å­˜åœ¨ä¸€å®šçš„è¯¯åˆ¤ç‡ã€‚å¯ä»¥ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼šå‡è®¾æŸä¸ªå…ƒç´ é€šè¿‡æ˜ å°„å¯¹åº”ä¸‹æ ‡ä¸º4ï¼Œ5ï¼Œ6è¿™3ä¸ªç‚¹ã€‚è™½ç„¶è¿™3ä¸ªç‚¹éƒ½ä¸º1ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾è¿™3ä¸ªç‚¹æ˜¯ä¸åŒå…ƒç´ ç»è¿‡å“ˆå¸Œå¾—åˆ°çš„ä½ç½®ï¼Œå› æ­¤è¿™ç§æƒ…å†µè¯´æ˜å…ƒç´ è™½ç„¶ä¸åœ¨é›†åˆä¸­ï¼Œä¹Ÿå¯èƒ½å¯¹åº”çš„éƒ½æ˜¯1ï¼Œè¿™æ˜¯è¯¯åˆ¤ç‡å­˜åœ¨çš„åŸå› ã€‚å¸ƒéš†è¿‡æ»¤å™¨æ·»åŠ å…ƒç´ å°†è¦æ·»åŠ çš„å…ƒç´ ç»™kä¸ªå“ˆå¸Œå‡½æ•°å¾—åˆ°å¯¹åº”äºä½æ•°ç»„ä¸Šçš„kä¸ªä½ç½®å°†è¿™kä¸ªä½ç½®è®¾ä¸º1å¸ƒéš†è¿‡æ»¤å™¨æŸ¥è¯¢å…ƒç´ å°†è¦æŸ¥è¯¢çš„å…ƒç´ ç»™kä¸ªå“ˆå¸Œå‡½æ•°å¾—åˆ°å¯¹åº”äºä½æ•°ç»„ä¸Šçš„kä¸ªä½ç½®å¦‚æœkä¸ªä½ç½®æœ‰ä¸€ä¸ªä¸º0ï¼Œåˆ™è‚¯å®šä¸åœ¨é›†åˆä¸­å¦‚æœkä¸ªä½ç½®å…¨éƒ¨ä¸º1ï¼Œåˆ™å¯èƒ½åœ¨é›†åˆä¸­å¸ƒéš†è¿‡æ»¤å™¨å®ç°ä¸‹é¢ç»™å‡ºpythonçš„å®ç°ï¼Œä½¿ç”¨murmurhashç®—æ³•1234567891011121314151617181920212223from bitarray import bitarrayimport mmh3class BloomFilter: def __init__(self,size, hash_num): self.size = size self.hash_num = hash_num self.bit_array = bitarray(size) self.bit_array.serall(0) def add(self, data): for seed in range(self.hash_num): result = mmh3.hash(seed, data) self.bit_array[result] = 1 def lookup(self, data): for seed in range(self.hash_num): result = mmh3.hash(seed, data) if self.bit_array[result] == 0: return 'No this data' return 'Probably'","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"cpeixin.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"å¸ƒéš†è¿‡æ»¤å™¨","slug":"å¸ƒéš†è¿‡æ»¤å™¨","permalink":"cpeixin.cn/tags/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/"}]},{"title":"Kafka é‡å¹³è¡¡æµç¨‹è§£æ","slug":"Kafka-é‡å¹³è¡¡æµç¨‹è§£æ","date":"2019-05-30T08:01:05.000Z","updated":"2020-07-11T08:02:32.879Z","comments":true,"path":"2019/05/30/Kafka-é‡å¹³è¡¡æµç¨‹è§£æ/","link":"","permalink":"cpeixin.cn/2019/05/30/Kafka-%E9%87%8D%E5%B9%B3%E8%A1%A1%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/","excerpt":"","text":"é‡å¹³è¡¡æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦äº†è§£ä»–ï¼Ÿé‡å¹³è¡¡æ˜¯ä»€ä¹ˆRebalanceï¼ˆé‡å¹³è¡¡ ï¼‰æœ¬è´¨ä¸Šæ˜¯ä¸€ç§åè®®ï¼Œè§„å®šäº†ä¸€ä¸ªConsumer Groupä¸‹çš„æ‰€æœ‰ Consumer å¦‚ä½•è¾¾æˆä¸€è‡´ï¼Œæ¥åˆ†é…è®¢é˜…Topicçš„æ¯ä¸ªåˆ†åŒºã€‚è¯´ç®€å•ç‚¹å°±æ˜¯ ç»™æ¶ˆè´¹ç»„æ¯ä¸ªæ¶ˆè´¹è€…åˆ†é…æ¶ˆè´¹ä»»åŠ¡çš„è¿‡ç¨‹ã€‚ä¸ºä»€ä¹ˆè¦äº†è§£ä»–ï¼ŸRebalanceæ˜¯å¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹è€…ç»„å¿…ç»çš„è¿‡ç¨‹ï¼Œå½“ç„¶è¿™ä¸æ˜¯æœ€ä¸»è¦çš„ï¼Œæœ€ä¸»è¦çš„æ˜¯ï¼Œåœ¨æ¶ˆè´¹çš„è¿‡ç¨‹ä¸­ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šå¯¼è‡´è¿™ä¸ªè¿‡ç¨‹å†æ¬¡å‘ç”Ÿï¼Œå¸¦æ¥çš„åæœå°±æ˜¯æ•´ä¸ªé›†ç¾¤æš‚æ—¶æ€§çš„ç˜«ç—ªï¼Œä¸¥é‡å½±å“åˆ°Kafkaçš„é«˜å¯ç”¨å‘ç”Ÿé‡å¹³è¡¡çš„æ—¶æœºé‚£ä¹ˆ Rebalance ä¼šåœ¨ä»€ä¹ˆæ—¶å€™å‘ç”Ÿå‘¢ï¼Ÿè®¢é˜…ä¸»é¢˜æ•°å‘ç”Ÿå˜åŒ–è¿™ç§æƒ…å†µä¸€èˆ¬ä¸ä¼šå‘ç”Ÿï¼Œå¦‚æœå‘ç”Ÿï¼Œé‚£ä¹Ÿæ˜¯å› ä¸ºæˆ‘ä»¬çš„ä¸šåŠ¡è°ƒæ•´æ‰ä¼šï¼Œæ‰€ä»¥è¿™ç§åŸºæœ¬è¦ä¹ˆä¸å‘ç”Ÿè¦ä¹ˆå°±æ˜¯ä¸å¯é¿å…ã€‚ä¸»é¢˜åˆ†åŒºå‘ç”Ÿå˜åŒ–è¿™ç§æƒ…å†µå‘ç”Ÿä¼šç›¸å¯¹å¤šä¸€ç‚¹ï¼Œä½†æ˜¯ä¹Ÿæœ‰é™ï¼Œåœ¨éƒ¨ç½²Kafkaé›†ç¾¤å‰ï¼Œæˆ‘ä»¬å°±éœ€è¦è€ƒè™‘åˆ°è¯¥é›†ç¾¤çš„å®¹é‡ï¼Œä»¥ä¾¿æ¥ç¡®å®šå¥½åˆ†åŒºæ•°ã€‚è™½ç„¶ä¸ä¸€å®šä¸€æ­¥åˆ°ä½ï¼Œä½†æ˜¯è°ƒæ•´çš„æ¬¡æ•°åº”è¯¥æ˜¯æå…¶æœ‰é™çš„ï¼Œä¸€èˆ¬ä¹Ÿå¯ä»¥é€‰æ‹©åœ¨åŠå¤œä½å³°çš„æ—¶å€™è¿›è¡Œè°ƒæ•´ï¼Œå½±å“ä¸å¤§ã€‚æ¶ˆè´¹ç«¯çš„æ¶ˆè´¹è€…ç»„æˆå‘˜å˜åŒ–åŸºæœ¬ä¸Šå½±å“æœ€å¤§çš„å°±æ˜¯è¿™ä¸ªåŸå› äº†ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿæˆ‘ä»¬è€ƒè™‘ä¸‹ä»€ä¹ˆæ—¶å€™æ¶ˆè´¹è€…ç»„çš„æˆå‘˜ä¼šå‘ç”Ÿå˜åŒ–å°±èƒ½å¤§æ¦‚äº†è§£äº†ã€‚æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯è¶…æ—¶ï¼Œå³å¦‚æœæ¶ˆè´¹è€…å¤„ç†æ¶ˆè´¹çš„æ¶ˆæ¯çš„æ—¶é—´è¶…è¿‡äº†Kafkaé›†ç¾¤é…ç½®çš„ max.poll.interval.ms çš„å€¼ï¼Œé‚£ä¹ˆè¯¥æ¶ˆè´¹è€…å°†ä¼šè‡ªåŠ¨ç¦»ç»„å¿ƒè·³è¶…æ—¶ï¼Œå¦‚æœæ¶ˆè´¹è€…åœ¨æŒ‡å®šçš„session.timeout.msæ—¶é—´å†…æ²¡æœ‰æ±‡æŠ¥å¿ƒè·³ï¼Œé‚£ä¹ˆKafkaå°±ä¼šè®¤ä¸ºè¯¥æ¶ˆè´¹å·²ç»deadäº†å¯ä»¥çœ‹å‡ºï¼Œæ¶ˆè´¹ç«¯çš„æ¶ˆè´¹è€…ç»„æˆå‘˜å˜åŒ–ä¸€èˆ¬éƒ½æ˜¯ç”±äºå¼‚å¸¸å¼•èµ·çš„ï¼Œæ‰€ä»¥å…¶äº§ç”Ÿçš„ Rebalance ä¹Ÿæ˜¯æœ€éš¾æ§åˆ¶çš„ã€‚Kafkaçš„å¿ƒè·³æœºåˆ¶ ä¸ RebalanceKafkaçš„å¿ƒè·³æœºåˆ¶ ä¸ Rebalance æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿäº‹å®ä¸Šï¼Œé‡å¹³è¡¡è¿‡ç¨‹æ˜¯é æ¶ˆè´¹è€…ç«¯çš„å¿ƒè·³çº¿ç¨‹ï¼ˆHeartbeat Threadï¼‰é€šçŸ¥åˆ°å…¶ä»–æ¶ˆè´¹è€…å®ä¾‹çš„æ¯å½“æ¶ˆè´¹è€…å‘å…¶ coordinator æ±‡æŠ¥å¿ƒè·³çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™ coordinator å†³å®šå¼€å¯ Rebalance ï¼Œé‚£ä¹ˆ coordinator ä¼šå°†REBALANCE_IN_PROGRESSå°è£…åˆ°å¿ƒè·³çš„å“åº”ä¸­ï¼Œå½“æ¶ˆè´¹è€…æ¥å—åˆ°è¿™ä¸ªREBALANCE_IN_PROGRESSï¼Œä»–å°±çŸ¥é“éœ€è¦å¼€å¯æ–°çš„ä¸€è½® Rebalance äº†,æ‰€ä»¥heartbeat.interval.msé™¤äº†æ˜¯è®¾ç½®å¿ƒè·³çš„é—´éš”æ—¶é—´ï¼Œå…¶å®ä¹Ÿæ„å‘³ç€ Rebalance æ„ŸçŸ¥é€Ÿåº¦ï¼Œå¿ƒè·³è¶Šå¿«ï¼Œé‚£ä¹ˆ Rebalance å°±èƒ½æ›´å¿«çš„è¢«å„ä¸ªæ¶ˆè´¹è€…æ„ŸçŸ¥ã€‚åœ¨ Kafka 0.10.1.0 ç‰ˆæœ¬ä¹‹å‰ï¼Œå‘é€å¿ƒè·³è¯·æ±‚æ˜¯åœ¨æ¶ˆè´¹è€…ä¸»çº¿ç¨‹å®Œæˆçš„ï¼Œä¹Ÿå°±æ˜¯ä½ å†™ä»£ç è°ƒç”¨KafkaConsumer.pollæ–¹æ³•çš„é‚£ä¸ªçº¿ç¨‹ã€‚è¿™æ ·åšæœ‰è¯¸å¤šå¼Šç—…ï¼Œæœ€å¤§çš„é—®é¢˜åœ¨äºï¼Œæ¶ˆæ¯å¤„ç†é€»è¾‘ä¹Ÿæ˜¯åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­å®Œæˆçš„ã€‚å› æ­¤ï¼Œä¸€æ—¦æ¶ˆæ¯å¤„ç†æ¶ˆè€—äº†è¿‡é•¿çš„æ—¶é—´ï¼Œå¿ƒè·³è¯·æ±‚å°†æ— æ³•åŠæ—¶å‘åˆ°åè°ƒè€…é‚£é‡Œï¼Œå¯¼è‡´åè°ƒè€…â€œé”™è¯¯åœ°â€è®¤ä¸ºè¯¥æ¶ˆè´¹è€…å·²â€œæ­»â€ã€‚è‡ª 0.10.1.0 ç‰ˆæœ¬å¼€å§‹ï¼Œç¤¾åŒºå¼•å…¥äº†ä¸€ä¸ªå•ç‹¬çš„å¿ƒè·³çº¿ç¨‹æ¥ä¸“é—¨æ‰§è¡Œå¿ƒè·³è¯·æ±‚å‘é€ï¼Œé¿å…äº†è¿™ä¸ªé—®é¢˜ã€‚æ¶ˆè´¹è€…ç»„çŠ¶æ€åˆ‡æ¢ä¸ºä»€ä¹ˆè¦äº†è§£ æ¶ˆè´¹è€…ç»„çŠ¶æ€ å‘¢ï¼Ÿè¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿è®²è§£ Rebalance æµç¨‹ï¼Œæ‰€ä»¥ä½ éœ€è¦å¤§æ¦‚äº†è§£ä¸€ä¸‹æ¶ˆè´¹è€…ç»„çš„çŠ¶æ€åˆ‡æ¢ï¼Œå¦‚ä¸‹å›¾å…¶æµè½¬è¿‡ç¨‹å¤§æ¦‚å¦‚ä¸‹ï¼šä¸€ä¸ªæ¶ˆè´¹è€…ç»„æœ€å¼€å§‹æ˜¯EmptyçŠ¶æ€ï¼Œå½“é‡å¹³è¡¡è¿‡ç¨‹å¼€å¯åï¼Œå®ƒä¼šè¢«ç½®äºPreparingRebalanceçŠ¶æ€ ç­‰å¾…æˆå‘˜åŠ å…¥ï¼Œæˆå‘˜éƒ½åŠ å…¥ä¹‹åå˜æ›´åˆ°CompletingRebalanceçŠ¶æ€ç­‰å¾…åˆ†é…æ–¹æ¡ˆï¼Œå½“coordinatoråˆ†é…å®Œä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹çš„åˆ†åŒºåï¼Œæœ€åå°±æµè½¬åˆ°StableçŠ¶æ€å®Œæˆé‡å¹³è¡¡ã€‚å½“æœ‰æ–°æˆå‘˜åŠ å…¥æˆ–å·²æœ‰æˆå‘˜é€€å‡ºæ—¶ï¼Œæ¶ˆè´¹è€…ç»„çš„çŠ¶æ€ ä»Stableç›´æ¥è·³åˆ°PreparingRebalanceçŠ¶æ€ï¼Œæ­¤æ—¶ï¼Œæ‰€æœ‰ç°å­˜æˆå‘˜å°±å¿…é¡»é‡æ–°ç”³è¯·åŠ å…¥ç»„ã€‚å½“æ‰€æœ‰æˆå‘˜éƒ½é€€å‡ºç»„åï¼Œæ¶ˆè´¹è€…ç»„çŠ¶æ€å˜æ›´ä¸ºEmptyã€‚Kafkaå®šæœŸè‡ªåŠ¨åˆ é™¤è¿‡æœŸä½ç§»çš„æ¡ä»¶å°±æ˜¯ï¼Œç»„è¦å¤„äºEmptyçŠ¶æ€ã€‚å› æ­¤ï¼Œå¦‚æœä½ çš„æ¶ˆè´¹è€…ç»„åœæ‰äº†å¾ˆé•¿æ—¶é—´ï¼ˆè¶…è¿‡7å¤©ï¼‰ï¼Œé‚£ä¹ˆKafkaå¾ˆå¯èƒ½å°±æŠŠè¯¥ç»„çš„ä½ç§»æ•°æ®åˆ é™¤äº†ã€‚æ¶ˆè´¹è€…ç«¯é‡å¹³è¡¡æµç¨‹åœ¨æ¶ˆè´¹è€…ç«¯ï¼Œé‡å¹³è¡¡åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼šåŠ å…¥ç»„ã€‚å½“ç»„å†…æˆå‘˜åŠ å…¥ç»„æ—¶ï¼Œå®ƒä¼šå‘ coordinator å‘é€JoinGroupè¯·æ±‚ã€‚åœ¨è¯¥è¯·æ±‚ä¸­ï¼Œæ¯ä¸ªæˆå‘˜éƒ½è¦å°†è‡ªå·±è®¢é˜…çš„ä¸»é¢˜ä¸ŠæŠ¥ï¼Œè¿™æ ·åè°ƒè€…å°±èƒ½æ”¶é›†åˆ°æ‰€æœ‰æˆå‘˜çš„è®¢é˜…ä¿¡æ¯ã€‚ä¸€æ—¦æ”¶é›†äº†å…¨éƒ¨æˆå‘˜çš„JoinGroupè¯·æ±‚åï¼ŒCoordinator ä¼šä»è¿™äº›æˆå‘˜ä¸­é€‰æ‹©ä¸€ä¸ªæ‹…ä»»è¿™ä¸ªæ¶ˆè´¹è€…ç»„çš„é¢†å¯¼è€…ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ä¸ªå‘é€JoinGroupè¯·æ±‚çš„æˆå‘˜è‡ªåŠ¨æˆä¸ºé¢†å¯¼è€…ã€‚é¢†å¯¼è€…æ¶ˆè´¹è€…çš„ä»»åŠ¡æ˜¯æ”¶é›†æ‰€æœ‰æˆå‘˜çš„è®¢é˜…ä¿¡æ¯ï¼Œç„¶åæ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œåˆ¶å®šå…·ä½“çš„åˆ†åŒºæ¶ˆè´¹åˆ†é…æ–¹æ¡ˆã€‚ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼šè¿™é‡Œè¯´çš„æ˜¯æ¶ˆè´¹è€…é¢†å¯¼è€…ã€‚é€‰å‡ºé¢†å¯¼è€…ä¹‹åï¼ŒCoordinator ä¼šæŠŠæ¶ˆè´¹è€…ç»„è®¢é˜…ä¿¡æ¯å°è£…è¿›JoinGroupè¯·æ±‚çš„ å“åº”ä½“ä¸­ï¼Œç„¶åå‘ç»™é¢†å¯¼è€…ï¼Œç”±é¢†å¯¼è€…ç»Ÿä¸€åšå‡ºåˆ†é…æ–¹æ¡ˆåï¼Œè¿›å…¥åˆ°ä¸‹ä¸€æ­¥ï¼šå‘é€SyncGroupè¯·æ±‚ã€‚å¦‚ä¸‹å›¾å°±æ˜¯ JoinGroup çš„å…¨è¿‡ç¨‹[å›¾ç‰‡ä¸Šä¼ ä¸­â€¦(25-æ¶ˆè´¹è€…ç»„é‡å¹³è¡¡å…¨æµç¨‹è§£æ.jpg-d67470-1567669412412-0)]JoinGroup æµç¨‹è§£æ.jpgé¢†å¯¼è€…æ¶ˆè´¹è€…ï¼ˆLeader Consumerï¼‰åˆ†é…æ–¹æ¡ˆã€‚é¢†å¯¼è€…å‘ Coordinator å‘é€SyncGroupè¯·æ±‚ï¼Œå°†åˆšåˆšåšå‡ºçš„åˆ†é…æ–¹æ¡ˆå‘ç»™åè°ƒè€…ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå…¶ä»–æˆå‘˜ä¹Ÿä¼šå‘ Coordinator å‘é€SyncGroupè¯·æ±‚ï¼Œåªä¸è¿‡è¯·æ±‚ä½“ä¸­å¹¶æ²¡æœ‰å®é™…çš„å†…å®¹ã€‚è¿™ä¸€æ­¥çš„ä¸»è¦ç›®çš„æ˜¯è®© Coordinator æ¥æ”¶åˆ†é…æ–¹æ¡ˆï¼Œç„¶åç»Ÿä¸€ä»¥ SyncGroup å“åº”çš„æ–¹å¼åˆ†å‘ç»™æ‰€æœ‰æˆå‘˜ï¼Œè¿™æ ·ç»„å†…æ‰€æœ‰æˆå‘˜å°±éƒ½çŸ¥é“è‡ªå·±è¯¥æ¶ˆè´¹å“ªäº›åˆ†åŒºäº†ã€‚å¦‚ä¸‹å›¾ï¼šSyncGroupå…¨æµç¨‹è§£æ.jpgæ¶ˆè´¹è€…ç«¯é‡å¹³è¡¡æµç¨‹ å¤§æ¦‚å°±è¿™æ ·äº†ï¼Œä¸‹é¢æˆ‘ä»¬å†æ¥çœ‹çœ‹ï¼šBrokerç«¯é‡å¹³è¡¡Brokerç«¯é‡å¹³è¡¡è¦å‰–æåè°ƒè€…ç«¯å¤„ç†é‡å¹³è¡¡çš„å…¨æµç¨‹ï¼Œæˆ‘ä»¬å¿…é¡»è¦åˆ†å‡ ä¸ªåœºæ™¯æ¥è®¨è®ºã€‚è¿™å‡ ä¸ªåœºæ™¯åˆ†åˆ«æ˜¯æ–°æˆå‘˜åŠ å…¥ç»„ç»„æˆå‘˜ä¸»åŠ¨ç¦»ç»„ç»„æˆå‘˜å´©æºƒç¦»ç»„ç»„æˆå‘˜æäº¤ä½ç§»ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªæ¥è®¨è®ºã€‚æ–°æˆå‘˜å…¥ç»„ã€‚æ–°æˆå‘˜å…¥ç»„æ˜¯æŒ‡ç»„å¤„äºStableçŠ¶æ€åï¼Œæœ‰æ–°æˆå‘˜åŠ å…¥ã€‚å¦‚æœæ˜¯å…¨æ–°å¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹è€…ç»„ï¼ŒKafkaæ˜¯æœ‰ä¸€äº›è‡ªå·±çš„å°ä¼˜åŒ–çš„ï¼Œæµç¨‹ä¸Šä¼šæœ‰äº›è®¸çš„ä¸åŒã€‚æˆ‘ä»¬è¿™é‡Œè®¨è®ºçš„æ˜¯ï¼Œç»„ç¨³å®šäº†ä¹‹åæœ‰æ–°æˆå‘˜åŠ å…¥çš„æƒ…å½¢ã€‚å½“åè°ƒè€…æ”¶åˆ°æ–°çš„JoinGroupè¯·æ±‚åï¼Œå®ƒä¼šé€šè¿‡å¿ƒè·³è¯·æ±‚å“åº”çš„æ–¹å¼é€šçŸ¥ç»„å†…ç°æœ‰çš„æ‰€æœ‰æˆå‘˜ï¼Œå¼ºåˆ¶å®ƒä»¬å¼€å¯æ–°ä¸€è½®çš„é‡å¹³è¡¡ã€‚å…·ä½“çš„è¿‡ç¨‹å’Œä¹‹å‰çš„å®¢æˆ·ç«¯é‡å¹³è¡¡æµç¨‹æ˜¯ä¸€æ ·çš„ã€‚ç°åœ¨ï¼Œæˆ‘ç”¨ä¸€å¼ æ—¶åºå›¾æ¥è¯´æ˜åè°ƒè€…ä¸€ç«¯æ˜¯å¦‚ä½•å¤„ç†æ–°æˆå‘˜å…¥ç»„çš„ã€‚ç»„æˆå‘˜ä¸»åŠ¨ç¦»ç»„ã€‚ä½•è°“ä¸»åŠ¨ç¦»ç»„ï¼Ÿå°±æ˜¯æŒ‡æ¶ˆè´¹è€…å®ä¾‹æ‰€åœ¨çº¿ç¨‹æˆ–è¿›ç¨‹è°ƒç”¨close()æ–¹æ³•ä¸»åŠ¨é€šçŸ¥åè°ƒè€…å®ƒè¦é€€å‡ºã€‚è¿™ä¸ªåœºæ™¯å°±æ¶‰åŠåˆ°äº†ç¬¬ä¸‰ç±»è¯·æ±‚ï¼šLeaveGroupè¯·æ±‚ã€‚åè°ƒè€…æ”¶åˆ°LeaveGroupè¯·æ±‚åï¼Œä¾ç„¶ä¼šä»¥å¿ƒè·³å“åº”çš„æ–¹å¼é€šçŸ¥å…¶ä»–æˆå‘˜ï¼Œå› æ­¤æˆ‘å°±ä¸å†èµ˜è¿°äº†ï¼Œè¿˜æ˜¯ç›´æ¥ç”¨ä¸€å¼ å›¾æ¥è¯´æ˜ã€‚ç»„æˆå‘˜å´©æºƒç¦»ç»„ã€‚å´©æºƒç¦»ç»„æ˜¯æŒ‡æ¶ˆè´¹è€…å®ä¾‹å‡ºç°ä¸¥é‡æ•…éšœï¼Œçªç„¶å®•æœºå¯¼è‡´çš„ç¦»ç»„ã€‚å®ƒå’Œä¸»åŠ¨ç¦»ç»„æ˜¯æœ‰åŒºåˆ«çš„ï¼Œå› ä¸ºåè€…æ˜¯ä¸»åŠ¨å‘èµ·çš„ç¦»ç»„ï¼Œåè°ƒè€…èƒ½é©¬ä¸Šæ„ŸçŸ¥å¹¶å¤„ç†ã€‚ä½†å´©æºƒç¦»ç»„æ˜¯è¢«åŠ¨çš„ï¼Œåè°ƒè€…é€šå¸¸éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´æ‰èƒ½æ„ŸçŸ¥åˆ°ï¼Œè¿™æ®µæ—¶é—´ä¸€èˆ¬æ˜¯ç”±æ¶ˆè´¹è€…ç«¯å‚æ•°session.timeout.msæ§åˆ¶çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒKafkaä¸€èˆ¬ä¸ä¼šè¶…è¿‡session.timeout.mså°±èƒ½æ„ŸçŸ¥åˆ°è¿™ä¸ªå´©æºƒã€‚å½“ç„¶ï¼Œåé¢å¤„ç†å´©æºƒç¦»ç»„çš„æµç¨‹ä¸ä¹‹å‰æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢è¿™å¼ å›¾ã€‚é‡å¹³è¡¡æ—¶åè°ƒè€…å¯¹ç»„å†…æˆå‘˜æäº¤ä½ç§»çš„å¤„ç†ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¯ä¸ªç»„å†…æˆå‘˜éƒ½ä¼šå®šæœŸæ±‡æŠ¥ä½ç§»ç»™åè°ƒè€…ã€‚å½“é‡å¹³è¡¡å¼€å¯æ—¶ï¼Œåè°ƒè€…ä¼šç»™äºˆæˆå‘˜ä¸€æ®µç¼“å†²æ—¶é—´ï¼Œè¦æ±‚æ¯ä¸ªæˆå‘˜å¿…é¡»åœ¨è¿™æ®µæ—¶é—´å†…å¿«é€Ÿåœ°ä¸ŠæŠ¥è‡ªå·±çš„ä½ç§»ä¿¡æ¯ï¼Œç„¶åå†å¼€å¯æ­£å¸¸çš„JoinGroup/SyncGroupè¯·æ±‚å‘é€ã€‚è¿˜æ˜¯è€åŠæ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€å¼ å›¾æ¥è¯´æ˜ã€‚æ€»ç»“å…¶å®ä¸è®ºå“ªç§æ–¹å¼ï¼Œéƒ½æ˜¯å·®ä¸å¤šçš„æµç¨‹ï¼Œè¿™é‡Œæ”¾å¼€ä¸¾ä¾‹ï¼Œæœ€ä¸»è¦çš„è¿˜æ˜¯ä¸ºäº†æ›´åŠ æ¸…æ™°ï¼Œå¦‚æœå‘ç”Ÿç±»ä¼¼çš„é—®é¢˜ï¼Œå¯ä»¥å¾ˆå¿«çš„ä»ä¸Šé¢è¿™äº›å¯èƒ½å…¥æ‰‹ã€‚åŸºæœ¬æµç¨‹å°±æ˜¯ Coordinator æ„ŸçŸ¥åˆ° æ¶ˆè´¹è€…ç»„çš„å˜åŒ–ï¼Œç„¶ååœ¨å¿ƒè·³çš„è¿‡ç¨‹ä¸­å‘é€é‡å¹³è¡¡ä¿¡å·é€šçŸ¥å„ä¸ªæ¶ˆè´¹è€…ç¦»ç»„ï¼Œç„¶åæ¶ˆè´¹è€…é‡æ–°ä»¥ JoinGroup æ–¹å¼åŠ å…¥ Coordinatorï¼Œå¹¶é€‰å‡ºConsumer Leaderã€‚å½“æ‰€æœ‰æ¶ˆè´¹è€…åŠ å…¥ Coordinatorï¼ŒConsumer Leaderä¼šæ ¹æ® Coordinatorç»™äºˆçš„åˆ†åŒºä¿¡æ¯ç»™å‡ºåˆ†åŒºæ–¹æ¡ˆã€‚Coordinator å°†è¯¥æ–¹æ¡ˆä»¥ SyncGroup çš„æ–¹å¼å°†è¯¥æ–¹æ¡ˆæ‰§è¡Œä¸‹å»ï¼Œé€šçŸ¥å„ä¸ªæ¶ˆè´¹è€…ï¼Œè¿™æ ·å°±å®Œæˆäº†ä¸€è½® é‡å¹³è¡¡äº†ã€‚è½¬è½½æ¥æºï¼šhttps://www.jianshu.com/p/6915e8c983bc","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"cpeixin.cn/tags/kafka/"}]},{"title":"SHCï¼šä½¿ç”¨ Spark SQL é«˜æ•ˆåœ°è¯»å†™ HBase","slug":"SHCï¼šä½¿ç”¨-Spark-SQL-é«˜æ•ˆåœ°è¯»å†™-HBase","date":"2019-05-16T02:27:59.000Z","updated":"2020-05-16T02:31:46.066Z","comments":true,"path":"2019/05/16/SHCï¼šä½¿ç”¨-Spark-SQL-é«˜æ•ˆåœ°è¯»å†™-HBase/","link":"","permalink":"cpeixin.cn/2019/05/16/SHC%EF%BC%9A%E4%BD%BF%E7%94%A8-Spark-SQL-%E9%AB%98%E6%95%88%E5%9C%B0%E8%AF%BB%E5%86%99-HBase/","excerpt":"","text":"Apache Spark å’Œ Apache HBase æ˜¯ä¸¤ä¸ªä½¿ç”¨æ¯”è¾ƒå¹¿æ³›çš„å¤§æ•°æ®ç»„ä»¶ã€‚å¾ˆå¤šåœºæ™¯éœ€è¦ä½¿ç”¨ Spark åˆ†æ/æŸ¥è¯¢ HBase ä¸­çš„æ•°æ®ï¼Œè€Œç›®å‰ Spark å†…ç½®æ˜¯æ”¯æŒå¾ˆå¤šæ•°æ®æºçš„ï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº† HBaseï¼Œä½†æ˜¯å†…ç½®çš„è¯»å–æ•°æ®æºè¿˜æ˜¯ä½¿ç”¨äº† TableInputFormat æ¥è¯»å– HBase ä¸­çš„æ•°æ®ã€‚è¿™ä¸ª TableInputFormat æœ‰ä¸€äº›ç¼ºç‚¹ï¼šä¸€ä¸ª Task é‡Œé¢åªèƒ½å¯åŠ¨ä¸€ä¸ª Scan å» HBase ä¸­è¯»å–æ•°æ®ï¼›TableInputFormat ä¸­ä¸æ”¯æŒ BulkGetï¼›ä¸èƒ½äº«å—åˆ° Spark SQL å†…ç½®çš„ catalyst å¼•æ“çš„ä¼˜åŒ–ã€‚ä»å¦ä¸€ä¸ªæ–¹é¢æ¥è®²ï¼Œå¦‚æœå…ˆä¸è°ˆå…³äºæ€§èƒ½çš„æ–¹é¢ï¼Œé‚£ä¹ˆä½ åœ¨å†™HBaseçš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯ä¸æ˜¯æ­¥éª¤æ„Ÿè§‰å¾ˆéº»çƒ¦å‘¢ï¼ŒForeachæ¯æ¡æ•°æ®Putåˆ°HBaseä¸­ï¼Œå¾€å¾€å†™å…¥é€»è¾‘éƒ¨åˆ†çš„ä»£ç å°±è¦å†™å¾ˆé•¿å¾ˆé•¿çš„ä¸€æ®µã€‚åŸºäºè¿™äº›é—®é¢˜ï¼Œæ¥è‡ª Hortonworks çš„å·¥ç¨‹å¸ˆä»¬ä¸ºæˆ‘ä»¬å¸¦æ¥äº†å…¨æ–°çš„ Apache Sparkâ€”Apache HBase Connectorï¼Œä¸‹é¢ç®€ç§° SHCã€‚é€šè¿‡è¿™ä¸ªç±»åº“ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ Spark SQL å°† DataFrame ä¸­çš„æ•°æ®å†™å…¥åˆ° HBase ä¸­ï¼›è€Œä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ Spark SQL å»æŸ¥è¯¢ HBase ä¸­çš„æ•°æ®ï¼Œåœ¨æŸ¥è¯¢ HBase çš„æ—¶å€™å……åˆ†åˆ©ç”¨äº† catalyst å¼•æ“åšäº†è®¸å¤šä¼˜åŒ–ï¼Œæ¯”å¦‚åˆ†åŒºä¿®å‰ªï¼ˆpartition pruningï¼‰ï¼Œåˆ—ä¿®å‰ªï¼ˆcolumn pruningï¼‰ï¼Œè°“è¯ä¸‹æ¨ï¼ˆpredicate pushdownï¼‰å’Œæ•°æ®æœ¬åœ°æ€§ï¼ˆdata localityï¼‰ç­‰ç­‰ã€‚å› ä¸ºæœ‰äº†è¿™äº›ä¼˜åŒ–ï¼Œé€šè¿‡ Spark æŸ¥è¯¢ HBase çš„é€Ÿåº¦æœ‰äº†å¾ˆå¤§çš„æå‡ã€‚é¡¹ç›®åœ°å€å…·ä½“çš„å¼•å…¥æ–¹å¼ï¼Œåœ¨ä¹‹å‰çš„Spark SQLå…¥é—¨ä¸­æœ‰å†™åˆ°Catalogå¯¹äºæ¯ä¸ªè¡¨ï¼Œå¿…é¡»æä¾›ä¸€ä¸ªç›®å½•ï¼Œå…¶ä¸­åŒ…æ‹¬è¡Œé”®å’Œå…·æœ‰é¢„å®šä¹‰åˆ—æ—çš„æ•°æ®ç±»å‹çš„åˆ—ï¼Œå¹¶å®šä¹‰hbaseåˆ—ä¸è¡¨æ¨¡å¼ä¹‹é—´çš„æ˜ å°„ã€‚ç›®å½•æ˜¯ç”¨æˆ·å®šä¹‰çš„jsonæ ¼å¼ã€‚æ•°æ®ç±»å‹è½¬æ¢æ”¯æŒJavaåŸºæœ¬ç±»å‹ã€‚å°†æ¥ï¼Œå°†æ”¯æŒå…¶ä»–æ•°æ®ç±»å‹ï¼Œè¿™äº›æ•°æ®ç±»å‹ä¾èµ–äºç”¨æˆ·æŒ‡å®šçš„Serdesã€‚SHCæ”¯æŒä¸‰ç§å†…éƒ¨Serdesï¼šAvroï¼ŒPhoenixå’ŒPrimitiveTypeã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡åœ¨ç›®å½•ä¸­å®šä¹‰â€œ tableCoderâ€æ¥æŒ‡å®šè¦ä½¿ç”¨çš„serdeã€‚ä¸ºæ­¤ï¼Œè¯·å‚è€ƒç¤ºä¾‹å’Œå•å…ƒæµ‹è¯•ã€‚ä»¥Avroä¸ºä¾‹ã€‚ç”¨æˆ·å®šä¹‰çš„Serdeså°†è´Ÿè´£å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºAvroå¯¹è±¡ï¼Œè€Œè¿æ¥å™¨å°†è´Ÿè´£å°†Avroå¯¹è±¡è½¬æ¢ä¸ºå‚¬åŒ–å‰‚æ”¯æŒçš„æ•°æ®ç±»å‹ã€‚ç”¨æˆ·å®šä¹‰æ–°Serdeæ—¶ï¼Œéœ€è¦ä½¿å…¶â€œå®ç°â€ç‰¹å¾â€™SHCDataTypeâ€™ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœç”¨æˆ·å¸Œæœ›DataFrameä»…å¤„ç†å­—èŠ‚æ•°ç»„ï¼Œåˆ™å¯ä»¥æŒ‡å®šäºŒè¿›åˆ¶ç±»å‹ã€‚ç„¶åï¼Œç”¨æˆ·å¯ä»¥è·å¾—æ¯ä¸ªåˆ—ä¸ºå­—èŠ‚æ•°ç»„çš„å‚¬åŒ–å‰‚è¡Œã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨å®šåˆ¶çš„è§£ä¸²å™¨è¿›ä¸€æ­¥å¯¹å®ƒè¿›è¡Œååºåˆ—åŒ–ï¼Œæˆ–è€…ç›´æ¥åœ¨DataFrameçš„RDDä¸Šè¿›è¡Œæ“ä½œã€‚æ•°æ®å±€éƒ¨æ€§å½“Spark WorkerèŠ‚ç‚¹ä¸hbaseåŒºåŸŸæœåŠ¡å™¨ä½äºåŒä¸€ä½ç½®æ—¶ï¼Œé€šè¿‡æ ‡è¯†åŒºåŸŸæœåŠ¡å™¨ä½ç½®å¹¶å°†æ‰§è¡Œç¨‹åºä¸åŒºåŸŸæœåŠ¡å™¨ä¸€èµ·å®šä½æ¥å®ç°æ•°æ®å±€éƒ¨æ€§ã€‚æ¯ä¸ªæ‰§è¡Œç¨‹åºå°†ä»…å¯¹ä½äºåŒä¸€ä¸»æœºä¸Šçš„åŒä¸€éƒ¨åˆ†æ•°æ®æ‰§è¡ŒScan / BulkGetã€‚è°“è¯ä¸‹æ¨è¯¥åº“ä½¿ç”¨HBaseæä¾›çš„ç°æœ‰æ ‡å‡†HBaseè¿‡æ»¤å™¨ï¼Œå¹¶ä¸”ä¸èƒ½åœ¨åå¤„ç†å™¨ä¸Šè¿è¡Œã€‚åˆ†åŒºä¿®å‰ªé€šè¿‡ä»è°“è¯ä¸­æå–è¡Œé”®ï¼Œæˆ‘ä»¬å°†scan / BulkGetåˆ’åˆ†ä¸ºå¤šä¸ªéé‡å åŒºåŸŸï¼Œåªæœ‰å…·æœ‰è¯·æ±‚æ•°æ®çš„åŒºåŸŸæœåŠ¡å™¨æ‰ä¼šæ‰§è¡Œscan / BulkGetã€‚å½“å‰ï¼Œåˆ†åŒºä¿®å‰ªæ˜¯åœ¨è¡Œé”®çš„ç¬¬ä¸€ç»´ä¸Šæ‰§è¡Œçš„ã€‚è¯·æ³¨æ„ï¼Œéœ€è¦ä»”ç»†å®šä¹‰WHEREæ¡ä»¶ã€‚å¦åˆ™ï¼Œç»“æœæ‰«æå¯èƒ½ä¼šåŒ…å«ä¸€ä¸ªæ¯”ç”¨æˆ·é¢„æœŸå¤§çš„åŒºåŸŸã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ¡ä»¶å°†å¯¼è‡´å®Œå…¨æ‰«æï¼ˆrowkey1æ˜¯è¡Œé”®çš„ç¬¬ä¸€ç»´ï¼Œè€Œcolumnæ˜¯å¸¸è§„çš„hbaseåˆ—ï¼‰ã€‚å…¶ä¸­rowkey1&gt;â€œ abcâ€ ORåˆ—=â€œ xyzâ€æ‰«æå’Œæ‰¹é‡è·å–éƒ½é€šè¿‡æŒ‡å®šWHEREå­å¥å‘ç”¨æˆ·å…¬å¼€ï¼Œä¾‹å¦‚ï¼Œå…¶ä¸­column&gt; xå’Œcolumn &lt;yç”¨äºæ‰«æï¼Œè€Œcolumn = xç”¨äºgetã€‚æ‰€æœ‰æ“ä½œéƒ½åœ¨æ‰§è¡Œç¨‹åºä¸­æ‰§è¡Œï¼Œè€Œé©±åŠ¨ç¨‹åºä»…æ„é€ è¿™äº›æ“ä½œã€‚åœ¨å†…éƒ¨ï¼Œæˆ‘ä»¬å°†å®ƒä»¬è½¬æ¢ä¸ºæ‰«ææˆ–è·å–æˆ–ä¸¤è€…ç»“åˆï¼Œä»è€Œå°†Iterator [Row]è¿”å›è‡³å‚¬åŒ–å‰‚å¼•æ“ã€‚å¯åˆ›å»ºçš„æ•°æ®æºè¯¥åº“æ”¯æŒä»HBaseè¯»å–/å‘HBaseå†™å…¥ã€‚åº”ç”¨ç”¨é€”ä¸‹é¢è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨è¿æ¥å™¨çš„åŸºæœ¬æ­¥éª¤ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯å’Œé«˜çº§ç”¨ä¾‹ï¼ˆä¾‹å¦‚Avroå’Œå¤åˆé”®æ”¯æŒï¼‰ï¼Œè¯·å‚è€ƒå­˜å‚¨åº“ä¸­çš„ç¤ºä¾‹ã€‚å®šä¹‰äº†HBaseç›®å½•123456789101112131415def catalog = s\"\"\"&#123; |\"table\":&#123;\"namespace\":\"default\", \"name\":\"table1\"&#125;, |\"rowkey\":\"key\", |\"columns\":&#123; |\"col0\":&#123;\"cf\":\"rowkey\", \"col\":\"key\", \"type\":\"string\"&#125;, |\"col1\":&#123;\"cf\":\"cf1\", \"col\":\"col1\", \"type\":\"boolean\"&#125;, |\"col2\":&#123;\"cf\":\"cf2\", \"col\":\"col2\", \"type\":\"double\"&#125;, |\"col3\":&#123;\"cf\":\"cf3\", \"col\":\"col3\", \"type\":\"float\"&#125;, |\"col4\":&#123;\"cf\":\"cf4\", \"col\":\"col4\", \"type\":\"int\"&#125;, |\"col5\":&#123;\"cf\":\"cf5\", \"col\":\"col5\", \"type\":\"bigint\"&#125;, |\"col6\":&#123;\"cf\":\"cf6\", \"col\":\"col6\", \"type\":\"smallint\"&#125;, |\"col7\":&#123;\"cf\":\"cf7\", \"col\":\"col7\", \"type\":\"string\"&#125;, |\"col8\":&#123;\"cf\":\"cf8\", \"col\":\"col8\", \"type\":\"tinyint\"&#125; |&#125; |&#125;\"\"\".stripMarginä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªåç§°ä¸ºtable1ï¼Œè¡Œé”®ä¸ºé”®ï¼Œåˆ—æ•°ä¸ºï¼ˆcol1-col8ï¼‰çš„HBaseè¡¨çš„æ¶æ„ã€‚è¯·æ³¨æ„ï¼Œè¡Œé”®è¿˜å¿…é¡»è¯¦ç»†å®šä¹‰ä¸ºå…·æœ‰ç‰¹å®šcfï¼ˆè¡Œé”®ï¼‰çš„åˆ—ï¼ˆcol0ï¼‰ã€‚å†™å…¥HBaseè¡¨ä»¥å¡«å……æ•°æ®1234sc.parallelize(data).toDF.write.options( Map(HBaseTableCatalog.tableCatalog -&gt; catalog, HBaseTableCatalog.newTable -&gt; \"5\")) .format(\"org.apache.spark.sql.execution.datasources.hbase\") .save()ç»™å®šå…·æœ‰æŒ‡å®šæ¶æ„çš„DataFrameï¼Œä¸Šé¢å°†åˆ›å»ºä¸€ä¸ªå…·æœ‰5ä¸ªåŒºåŸŸçš„HBaseè¡¨å¹¶å°†è¯¥DataFrameä¿å­˜åœ¨å…¶ä¸­ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæœªæŒ‡å®šHBaseTableCatalog.newTableï¼Œåˆ™å¿…é¡»é¢„å…ˆåˆ›å»ºè¡¨ã€‚åœ¨HBaseè¡¨çš„é¡¶éƒ¨æ‰§è¡ŒDataFrameæ“ä½œ1234567def withCatalog(cat: String): DataFrame = &#123; sqlContext .read .options(Map(HBaseTableCatalog.tableCatalog-&gt;cat)) .format(\"org.apache.spark.sql.execution.datasources.hbase\") .load()&#125;å¤æ‚æŸ¥è¯¢12345678910val df = withCatalog(catalog)val s = df.filter((($\"col0\" &lt;= \"row050\" &amp;&amp; $\"col0\" &gt; \"row040\") || $\"col0\" === \"row005\" || $\"col0\" === \"row020\" || $\"col0\" === \"r20\" || $\"col0\" &lt;= \"row005\") &amp;&amp; ($\"col4\" === 1 || $\"col4\" === 42)) .select(\"col0\", \"col1\", \"col4\")s.showSQLæ”¯æŒ12345// Load the dataframeval df = withCatalog(catalog)//SQL exampledf.createOrReplaceTempView(\"table\")sqlContext.sql(\"select count(col1) from table\").show ## æ”¯æŒAvroæ¨¡å¼ è¯¥è¿æ¥å™¨å®Œå…¨æ”¯æŒæ‰€æœ‰avroæ¨¡å¼ã€‚ç”¨æˆ·å¯ä»¥åœ¨å…¶ç›®å½•ä¸­ä½¿ç”¨å®Œæ•´è®°å½•æ¨¡å¼æˆ–éƒ¨åˆ†å­—æ®µæ¨¡å¼ä½œä¸ºæ•°æ®ç±»å‹ï¼ˆæœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[æ­¤å¤„](https://github.com/hortonworks-spark/shc/wiki/2.-Native-Avro-Support)ï¼‰ã€‚1234567891011121314151617181920val schema_array = s\"\"\"&#123;\"type\": \"array\", \"items\": [\"string\",\"null\"]&#125;\"\"\".stripMarginval schema_record = s\"\"\"&#123;\"namespace\": \"example.avro\", | \"type\": \"record\", \"name\": \"User\", | \"fields\": [ &#123;\"name\": \"name\", \"type\": \"string\"&#125;, | &#123;\"name\": \"favorite_number\", \"type\": [\"int\", \"null\"]&#125;, | &#123;\"name\": \"favorite_color\", \"type\": [\"string\", \"null\"]&#125; ] &#125;\"\"\".stripMarginval catalog = s\"\"\"&#123; |\"table\":&#123;\"namespace\":\"default\", \"name\":\"htable\"&#125;, |\"rowkey\":\"key1\", |\"columns\":&#123; |\"col1\":&#123;\"cf\":\"rowkey\", \"col\":\"key1\", \"type\":\"double\"&#125;, |\"col2\":&#123;\"cf\":\"cf1\", \"col\":\"col1\", \"avro\":\"schema_array\"&#125;, |\"col3\":&#123;\"cf\":\"cf1\", \"col\":\"col2\", \"avro\":\"schema_record\"&#125;, |\"col4\":&#123;\"cf\":\"cf1\", \"col\":\"col3\", \"type\":\"double\"&#125;, |\"col5\":&#123;\"cf\":\"cf1\", \"col\":\"col4\", \"type\":\"string\"&#125; |&#125; |&#125;\"\"\".stripMargin val df = sqlContext.read.options(Map(\"schema_array\"-&gt;schema_array,\"schema_record\"-&gt;schema_record, HBaseTableCatalog.tableCatalog-&gt;catalog)).format(\"org.apache.spark.sql.execution.datasources.hbase\").load()df.write.options(Map(\"schema_array\"-&gt;schema_array,\"schema_record\"-&gt;schema_record, HBaseTableCatalog.tableCatalog-&gt;catalog)).format(\"org.apache.spark.sql.execution.datasources.hbase\").save() ####12345678910111213141516171819202122val complex = s\"\"\"MAP&lt;int, struct&lt;varchar:string&gt;&gt;\"\"\"val schema = s\"\"\"&#123;\"namespace\": \"example.avro\", | \"type\": \"record\", \"name\": \"User\", | \"fields\": [ &#123;\"name\": \"name\", \"type\": \"string\"&#125;, | &#123;\"name\": \"favorite_number\", \"type\": [\"int\", \"null\"]&#125;, | &#123;\"name\": \"favorite_color\", \"type\": [\"string\", \"null\"]&#125; ] &#125;\"\"\".stripMarginval catalog = s\"\"\"&#123; |\"table\":&#123;\"namespace\":\"default\", \"name\":\"htable\"&#125;, |\"rowkey\":\"key1:key2\", |\"columns\":&#123; |\"col1\":&#123;\"cf\":\"rowkey\", \"col\":\"key1\", \"type\":\"binary\"&#125;, |\"col2\":&#123;\"cf\":\"rowkey\", \"col\":\"key2\", \"type\":\"double\"&#125;, |\"col3\":&#123;\"cf\":\"cf1\", \"col\":\"col1\", \"avro\":\"schema1\"&#125;, |\"col4\":&#123;\"cf\":\"cf1\", \"col\":\"col2\", \"type\":\"string\"&#125;, |\"col5\":&#123;\"cf\":\"cf1\", \"col\":\"col3\", \"type\":\"double\", \"sedes\":\"org.apache.spark.sql.execution.datasources.hbase.DoubleSedes\"&#125;, |\"col6\":&#123;\"cf\":\"cf1\", \"col\":\"col4\", \"type\":\"$complex\"&#125; |&#125; |&#125;\"\"\".stripMargin val df = sqlContext.read.options(Map(\"schema1\"-&gt;schema, HBaseTableCatalog.tableCatalog-&gt;catalog)).format(\"org.apache.spark.sql.execution.datasources.hbase\").load()df.write.options(Map(\"schema1\"-&gt;schema, HBaseTableCatalog.tableCatalog-&gt;catalog)).format(\"org.apache.spark.sql.execution.datasources.hbase\").save()ä»¥ä¸Šè¯´æ˜äº†æˆ‘ä»¬çš„ä¸‹ä¸€æ­¥ï¼Œå…¶ä¸­åŒ…æ‹¬å¤åˆé”®æ”¯æŒï¼Œå¤æ‚æ•°æ®ç±»å‹ï¼Œå®¢æˆ·åŒ–Serdeå’ŒAvroçš„æ”¯æŒã€‚è¯·æ³¨æ„ï¼Œå°½ç®¡æ‰€æœ‰ä¸»è¦éƒ¨åˆ†éƒ½åŒ…å«åœ¨å½“å‰ä»£ç åº“ä¸­ï¼Œä½†ç°åœ¨å¯èƒ½æ— æ³•è¿è¡Œã€‚SHCæŸ¥è¯¢ä¼˜åŒ–SHC ä¸»è¦ä½¿ç”¨ä¸‹é¢çš„å‡ ç§ä¼˜åŒ–ï¼Œä½¿å¾— Spark è·å– HBase çš„æ•°æ®æ‰«æèŒƒå›´å¾—åˆ°å‡å°‘ï¼Œæé«˜äº†æ•°æ®è¯»å–çš„æ•ˆç‡ã€‚å°†ä½¿ç”¨ Rowkey çš„æŸ¥è¯¢è½¬æ¢æˆ get æŸ¥è¯¢**æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒHBase ä¸­ä½¿ç”¨ Get æŸ¥è¯¢çš„æ•ˆç‡æ˜¯éå¸¸é«˜çš„ï¼Œæ‰€ä»¥å¦‚æœæŸ¥è¯¢çš„è¿‡æ»¤æ¡ä»¶æ˜¯é’ˆå¯¹ RowKey è¿›è¡Œçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†å®ƒè½¬æ¢æˆ Get æŸ¥è¯¢ã€‚ä¸ºäº†è¯´æ˜è¿™ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„ä¾‹å­è¿›è¡Œè¯´æ˜ã€‚å‡è®¾æˆ‘ä»¬å®šä¹‰å¥½çš„ HBase catalog å¦‚ä¸‹ï¼š123456789101112131415val catalog = s\"\"\"&#123; |\"table\":&#123;\"namespace\":\"default\", \"name\":\"iteblog\", \"tableCoder\":\"PrimitiveType\"&#125;, |\"rowkey\":\"key\", |\"columns\":&#123; |\"col0\":&#123;\"cf\":\"rowkey\", \"col\":\"id\", \"type\":\"int\"&#125;, |\"col1\":&#123;\"cf\":\"cf1\", \"col\":\"col1\", \"type\":\"boolean\"&#125;, |\"col2\":&#123;\"cf\":\"cf2\", \"col\":\"col2\", \"type\":\"double\"&#125;, |\"col3\":&#123;\"cf\":\"cf3\", \"col\":\"col3\", \"type\":\"float\"&#125;, |\"col4\":&#123;\"cf\":\"cf4\", \"col\":\"col4\", \"type\":\"int\"&#125;, |\"col5\":&#123;\"cf\":\"cf5\", \"col\":\"col5\", \"type\":\"bigint\"&#125;, |\"col6\":&#123;\"cf\":\"cf6\", \"col\":\"col6\", \"type\":\"smallint\"&#125;, |\"col7\":&#123;\"cf\":\"cf7\", \"col\":\"col7\", \"type\":\"string\"&#125;, |\"col8\":&#123;\"cf\":\"cf8\", \"col\":\"col8\", \"type\":\"tinyint\"&#125; |&#125;|&#125;\"\"\".stripMarginé‚£ä¹ˆå¦‚æœæœ‰ç±»ä¼¼ä¸‹é¢çš„æŸ¥è¯¢12345val df = withCatalog(catalog)df.createOrReplaceTempView(\"iteblog_table\")sqlContext.sql(\"select * from iteblog_table where id = 1\")sqlContext.sql(\"select * from iteblog_table where id = 1 or id = 2\")sqlContext.sql(\"select * from iteblog_table where id in (1, 2)\")å› ä¸ºæŸ¥è¯¢æ¡ä»¶ç›´æ¥æ˜¯é’ˆå¯¹ RowKey è¿›è¡Œçš„ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µç›´æ¥å¯ä»¥è½¬æ¢æˆ Get æˆ–è€… BulkGet è¯·æ±‚çš„ã€‚ç¬¬ä¸€ä¸ª SQL æŸ¥è¯¢è¿‡ç¨‹ç±»ä¼¼äºä¸‹é¢è¿‡ç¨‹ä½†æ˜¯ï¼Œå¦‚æœç¢°åˆ°é RowKey çš„è¿‡æ»¤ï¼Œé‚£ä¹ˆè¿™ç§æŸ¥è¯¢æ˜¯éœ€è¦æ‰«æ HBase çš„å…¨è¡¨çš„ã€‚ä¸Šé¢çš„æŸ¥è¯¢åœ¨ shc é‡Œé¢å°±æ˜¯å°† HBase é‡Œé¢çš„æ‰€æœ‰æ•°æ®æ‹¿åˆ°ï¼Œç„¶åä¼ è¾“åˆ° Spark ï¼Œå†é€šè¿‡ Spark é‡Œé¢è¿›è¡Œè¿‡æ»¤ï¼Œå¯è§ shc åœ¨è¿™ç§æƒ…å†µä¸‹æ•ˆç‡æ˜¯å¾ˆä½ä¸‹çš„ã€‚æ³¨æ„ï¼Œä¸Šé¢çš„æŸ¥è¯¢åœ¨ shc è¿”å›çš„ç»“æœæ˜¯é”™è¯¯çš„ã€‚å…·ä½“åŸå› æ˜¯åœ¨å°† id = 1 or col7 = â€˜xxxâ€™ æŸ¥è¯¢æ¡ä»¶è¿›è¡Œåˆå¹¶æ—¶ï¼Œä¸¢å¼ƒäº†æ‰€æœ‰çš„æŸ¥æ‰¾æ¡ä»¶ï¼Œç›¸å½“äºè¿”å›è¡¨çš„æ‰€æœ‰æ•°æ®ã€‚å®šä½åˆ°ä»£ç å¯ä»¥å‚è§ä¸‹é¢çš„123456def or[T](left: HRF[T], right: HRF[T])(implicit ordering: Ordering[T]): HRF[T] = &#123; val ranges = ScanRange.or(left.ranges, right.ranges) val typeFilter = TypedFilter.or(left.tf, right.tf) HRF(ranges, typeFilter, left.handled &amp;&amp; right.handled)&#125;åŒç†ï¼Œç±»ä¼¼äºä¸‹é¢çš„æŸ¥è¯¢åœ¨ shc é‡Œé¢å…¶å®éƒ½æ˜¯å…¨è¡¨æ‰«æï¼Œå¹¶ä¸”å°†æ‰€æœ‰çš„æ•°æ®è¿”å›åˆ° Spark å±‚é¢ä¸Šå†è¿›è¡Œä¸€æ¬¡è¿‡æ»¤ã€‚123sqlContext.sql(\"select id, col6, col8 from iteblog_table where id = 1 or col7 &lt;= 'xxx'\")sqlContext.sql(\"select id, col6, col8 from iteblog_table where id = 1 or col7 &gt;= 'xxx'\")sqlContext.sql(\"select id, col6, col8 from iteblog_table where col7 = 'xxx'\")å¾ˆæ˜¾ç„¶ï¼Œè¿™ç§æ–¹å¼æŸ¥è¯¢æ•ˆç‡å¹¶ä¸é«˜ï¼Œä¸€ç§å¯è¡Œçš„æ–¹æ¡ˆæ˜¯å°†ç®—å­ä¸‹æ¨åˆ° HBase å±‚é¢ï¼Œåœ¨ HBase å±‚é¢é€šè¿‡ SingleColumnValueFilter è¿‡æ»¤ä¸€éƒ¨åˆ†æ•°æ®ï¼Œç„¶åå†è¿”å›åˆ° Sparkï¼Œè¿™æ ·å¯ä»¥èŠ‚çœå¾ˆå¤šæ•°æ®çš„ä¼ è¾“ã€‚ç»„åˆ RowKey çš„æŸ¥è¯¢ä¼˜åŒ–shc è¿˜æ”¯æŒç»„åˆ RowKey çš„æ–¹å¼æ¥å»ºè¡¨ï¼Œå…·ä½“å¦‚ä¸‹ï¼š1234567891011121314151617def cat = s\"\"\"&#123; |\"table\":&#123;\"namespace\":\"default\", \"name\":\"iteblog\", \"tableCoder\":\"PrimitiveType\"&#125;, |\"rowkey\":\"key1:key2\", |\"columns\":&#123; |\"col00\":&#123;\"cf\":\"rowkey\", \"col\":\"key1\", \"type\":\"string\", \"length\":\"6\"&#125;, |\"col01\":&#123;\"cf\":\"rowkey\", \"col\":\"key2\", \"type\":\"int\"&#125;, |\"col1\":&#123;\"cf\":\"cf1\", \"col\":\"col1\", \"type\":\"boolean\"&#125;, |\"col2\":&#123;\"cf\":\"cf2\", \"col\":\"col2\", \"type\":\"double\"&#125;, |\"col3\":&#123;\"cf\":\"cf3\", \"col\":\"col3\", \"type\":\"float\"&#125;, |\"col4\":&#123;\"cf\":\"cf4\", \"col\":\"col4\", \"type\":\"int\"&#125;, |\"col5\":&#123;\"cf\":\"cf5\", \"col\":\"col5\", \"type\":\"bigint\"&#125;, |\"col6\":&#123;\"cf\":\"cf6\", \"col\":\"col6\", \"type\":\"smallint\"&#125;, |\"col7\":&#123;\"cf\":\"cf7\", \"col\":\"col7\", \"type\":\"string\"&#125;, |\"col8\":&#123;\"cf\":\"cf8\", \"col\":\"col8\", \"type\":\"tinyint\"&#125; |&#125; |&#125;\"\"\".stripMarginä¸Šé¢çš„ col00 å’Œ col01 ä¸¤åˆ—ç»„åˆæˆä¸€ä¸ª rowkeyï¼Œå¹¶ä¸” col00 æ’åœ¨å‰é¢ï¼Œcol01 æ’åœ¨åé¢ã€‚æ¯”å¦‚ col00 =â€™row002â€™ï¼Œcol01 = 2ï¼Œé‚£ä¹ˆç»„åˆçš„ rowkey ä¸º row002\\x00\\x00\\x00\\x02ã€‚é‚£ä¹ˆåœ¨ç»„åˆ Rowkey çš„æŸ¥è¯¢ shc éƒ½æœ‰å“ªäº›ä¼˜åŒ–å‘¢ï¼Ÿç°åœ¨æˆ‘ä»¬æœ‰å¦‚ä¸‹æŸ¥è¯¢1df.sqlContext.sql(\"select col00, col01, col1 from iteblog where col00 = 'row000' and col01 = 0\").show()æ ¹æ®ä¸Šé¢çš„ä¿¡æ¯ï¼ŒRowKey å…¶å®æ˜¯ç”± col00 å’Œ col01 ç»„åˆè€Œæˆçš„ï¼Œé‚£ä¹ˆä¸Šé¢çš„æŸ¥è¯¢å…¶å®å¯ä»¥å°† col00 å’Œ col01 è¿›è¡Œæ‹¼æ¥ï¼Œç„¶åç»„åˆæˆä¸€ä¸ª RowKeyï¼Œç„¶åä¸Šé¢çš„æŸ¥è¯¢å…¶å®å¯ä»¥è½¬æ¢æˆä¸€ä¸ª Get æŸ¥è¯¢ã€‚ä½†æ˜¯åœ¨ shc é‡Œé¢ï¼Œä¸Šé¢çš„æŸ¥è¯¢æ˜¯è½¬æ¢æˆä¸€ä¸ª scan å’Œä¸€ä¸ª get æŸ¥è¯¢çš„ã€‚scan çš„ startRow ä¸º row000ï¼ŒendRow ä¸º row000\\xff\\xff\\xff\\xffï¼›get çš„ rowkey ä¸º row000\\xff\\xff\\xff\\xffï¼Œç„¶åå†å°†æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®è¿”å›ï¼Œæœ€åå†åœ¨ Spark å±‚é¢ä¸Šåšä¸€æ¬¡è¿‡æ»¤ï¼Œå¾—åˆ°æœ€åæŸ¥è¯¢çš„ç»“æœã€‚å› ä¸º shc é‡Œé¢ç»„åˆé”®æŸ¥è¯¢çš„ä»£ç è¿˜æ²¡å®Œå–„ï¼Œæ‰€ä»¥å½“å‰å®ç°åº”è¯¥ä¸æ˜¯æœ€ç»ˆçš„ã€‚åœ¨ shc é‡Œé¢ä¸‹é¢ä¸¤æ¡ SQL æŸ¥è¯¢ä¸‹æ²‰åˆ° HBase çš„é€»è¾‘ä¸€è‡´1df.sqlContext.sql(\"select col00, col01, col1 from iteblog where col00 = 'row000'\").show()df.sqlContext.sql(\"select col00, col01, col1 from iteblog where col00 = 'row000' and col01 = 0\").show()å”¯ä¸€åŒºåˆ«æ˜¯åœ¨ Spark å±‚é¢ä¸Šçš„è¿‡æ»¤ã€‚scan æŸ¥è¯¢ä¼˜åŒ–å¦‚æœæˆ‘ä»¬çš„æŸ¥è¯¢æœ‰ &lt; æˆ– &gt; ç­‰æŸ¥è¯¢è¿‡æ»¤æ¡ä»¶ï¼Œæ¯”å¦‚ä¸‹é¢çš„æŸ¥è¯¢æ¡ä»¶ï¼š1df.sqlContext.sql(\"select col00, col01, col1 from iteblog where col00 &gt; 'row000' and col00 &lt; 'row005'\").show()è¿™ä¸ªåœ¨ shc é‡Œé¢è½¬æ¢æˆ HBase çš„è¿‡æ»¤ä¸ºä¸€æ¡ get å’Œ ä¸€ä¸ª scanï¼Œå…·ä½“ä¸º get çš„ Rowkey ä¸º row0005\\xff\\xff\\xff\\xffï¼›scan çš„ startRow ä¸º row000ï¼ŒendRow ä¸º row005\\xff\\xff\\xff\\xffï¼Œç„¶åå°†æŸ¥è¯¢çš„ç»“æœè¿”å›åˆ° spark å±‚é¢ä¸Šè¿›è¡Œè¿‡æ»¤ã€‚æ€»ä½“æ¥è¯´ï¼Œshc èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œé¿å…äº†å…¨è¡¨æ‰«æã€‚ä½†æ˜¯ç»è¿‡è¯„æµ‹ï¼Œshc å…¶å®è¿˜æœ‰å¾ˆå¤šåœ°æ–¹ä¸å¤Ÿå®Œå–„ï¼Œç®—å­ä¸‹æ²‰å¹¶æ²¡æœ‰ä¸‹æ²‰åˆ° HBase å±‚é¢ä¸Šè¿›è¡Œã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"shadowsock-vpsæ­å»ºVPN","slug":"shadowsock-vpsæ­å»ºVPN","date":"2019-04-19T15:26:15.000Z","updated":"2020-04-04T17:11:07.011Z","comments":true,"path":"2019/04/19/shadowsock-vpsæ­å»ºVPN/","link":"","permalink":"cpeixin.cn/2019/04/19/shadowsock-vps%E6%90%AD%E5%BB%BAVPN/","excerpt":"","text":"å‰è¨€è¿˜æœ‰10å¤©å·¦å³å°±è¦å›å›½äº†ï¼Œç”±äºèŒä¸šçš„éœ€è¦ï¼Œå¯¹Googleçš„ä¾èµ–çš„è¶Šæ¥è¶Šå¤§çš„ï¼Œé‚£ä¹ˆå›å›½åæ€ä¹ˆæ‰èƒ½â€˜ç§‘å­¦ä¸Šç½‘â€™å‘¢ï¼Ÿä¹‹å‰åœ¨å›½å†…çš„æ—¶å€™ï¼Œæœ‰ä½¿ç”¨è¿‡Lanternï¼Œç¨³å®šæ€§å’Œé€Ÿåº¦éƒ½è¿˜æ˜¯ä¸é”™äº†ï¼Œå¯æƒœåæ¥è¢«å’Œè°äº†ã€‚æ‰€ä»¥ä»Šå¤©å‡†å¤‡å°è¯•æ­å»ºVPNï¼Œè‡ªå·±ç‹¬ç«‹ä½¿ç”¨ï¼Œä¸€è¾¹æ­å»ºä¸€è¾¹å°†è¿‡ç¨‹è®°å½•ä¸‹æ¥ã€‚åè¯è§£é‡ŠVPS: VPSï¼ˆVirtual Private Server è™šæ‹Ÿä¸“ç”¨æœåŠ¡å™¨ï¼‰æŠ€æœ¯ï¼Œå°†ä¸€å°æœåŠ¡å™¨åˆ†å‰²æˆå¤šä¸ªè™šæ‹Ÿä¸“äº«æœåŠ¡å™¨çš„ä¼˜è´¨æœåŠ¡ã€‚å®ç°VPSçš„æŠ€æœ¯åˆ†ä¸ºå®¹å™¨ [1] æŠ€æœ¯ï¼Œå’Œè™šæ‹ŸåŒ–æŠ€æœ¯ [2] ã€‚åœ¨å®¹å™¨æˆ–è™šæ‹Ÿæœºä¸­ï¼Œæ¯ä¸ªVPSéƒ½å¯åˆ†é…ç‹¬ç«‹å…¬ç½‘IPåœ°å€ã€ç‹¬ç«‹æ“ä½œç³»ç»Ÿã€å®ç°ä¸åŒVPSé—´ç£ç›˜ç©ºé—´ã€å†…å­˜ã€CPUèµ„æºã€è¿›ç¨‹å’Œç³»ç»Ÿé…ç½®çš„éš”ç¦»ï¼Œä¸ºç”¨æˆ·å’Œåº”ç”¨ç¨‹åºæ¨¡æ‹Ÿå‡ºâ€œç‹¬å â€ä½¿ç”¨è®¡ç®—èµ„æºçš„ä½“éªŒã€‚VPSå¯ä»¥åƒç‹¬ç«‹æœåŠ¡å™¨ä¸€æ ·ï¼Œé‡è£…æ“ä½œç³»ç»Ÿï¼Œå®‰è£…ç¨‹åºï¼Œå•ç‹¬é‡å¯æœåŠ¡å™¨ã€‚VPSä¸ºä½¿ç”¨è€…æä¾›äº†ç®¡ç†é…ç½®çš„è‡ªç”±ï¼Œå¯ç”¨äºä¼ä¸šè™šæ‹ŸåŒ–ï¼Œä¹Ÿå¯ä»¥ç”¨äºIDCèµ„æºç§Ÿç”¨ã€‚VPN: VPNçš„å­¦åå«è™šæ‹Ÿä¸“ç”¨ç½‘ï¼Œæ´‹æ–‡å«â€œVirtual Private Networkâ€ã€‚ç»´åŸºç™¾ç§‘çš„ä»‹ç»åœ¨â€œè¿™é‡Œâ€ã€‚æœ¬æ¥è¿™ç©æ„å„¿ä¸»è¦æ˜¯ç”¨äºå•†ä¸šå…¬å¸ï¼Œä¸ºäº†è®©é‚£äº›ä¸åœ¨å…¬å¸é‡Œçš„å‘˜å·¥ï¼ˆæ¯”å¦‚å‡ºå·®åœ¨å¤–çš„ï¼‰èƒ½å¤Ÿæ–¹ä¾¿åœ°è®¿é—®å…¬å¸çš„å†…éƒ¨ç½‘ç»œã€‚ä¸ºäº†é˜²æ­¢é»‘å®¢å†’å……å…¬å¸çš„å‘˜å·¥ï¼Œä»å¤–éƒ¨è®¿é—®å…¬å¸çš„å†…éƒ¨ç½‘ç»œï¼ŒVPN è½¯ä»¶éƒ½ä¼šæä¾›å¼ºå¤§çš„åŠ å¯†åŠŸèƒ½ã€‚è€Œè¿™ä¸ªåŠ å¯†åŠŸèƒ½ï¼Œä¹Ÿå°±è®©å®ƒé¡ºä¾¿æˆä¸ºç¿»å¢™çš„åˆ©å™¨ã€‚ç§‘å­¦ä¸Šç½‘åŸç†VPNæµè§ˆå¤–ç½‘çš„åŸç†ä½¿ç”¨ VPN é€šå¸¸éœ€è¦å…ˆå®‰è£…å®¢æˆ·ç«¯è½¯ä»¶ã€‚å½“ä½ è¿è¡Œ VPN å®¢æˆ·ç«¯ï¼Œå®ƒä¼šå°è¯•è”åˆ° VPN æœåŠ¡å™¨ï¼ˆè¿™ç‚¹è·ŸåŠ å¯†ä»£ç†ç±»ä¼¼ï¼‰ã€‚ä¸€æ—¦å’Œ VPN æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼ŒVPN å®¢æˆ·ç«¯å°±ä¼šåœ¨ä½ çš„ç³»ç»Ÿä¸­å»ºç«‹äº†ä¸€ä¸ªè™šæ‹Ÿå±€åŸŸç½‘ã€‚è€Œä¸”ï¼Œä½ çš„ç³»ç»Ÿä¸­ä¹Ÿä¼šå¤šå‡ºä¸€ä¸ªè™šæ‹Ÿç½‘å¡ï¼ˆåœ¨ Windows ä¸‹ï¼Œå¯ä»¥ç”¨ ipconfig /all å‘½ä»¤ï¼Œçœ‹åˆ°è¿™å¤šå‡ºæ¥çš„ç½‘å¡ï¼‰ã€‚è¿™æ ·ä¸€æ¥ï¼Œä½ çš„ç³»ç»Ÿä¸­å°±æœ‰ä¸æ­¢ä¸€å—ç½‘å¡ã€‚è¿™å°±å¼•å‡ºä¸€ä¸ªé—®é¢˜ï¼šé‚£äº›è®¿é—®ç½‘ç»œçš„ç¨‹åºï¼Œå®ƒçš„æ•°æ®æµåº”è¯¥é€šè¿‡å“ªä¸ªç½‘å¡è¿›å‡ºï¼Ÿä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼ŒVPN å®¢æˆ·ç«¯é€šå¸¸ä¼šä¿®æ”¹ä½ ç³»ç»Ÿçš„è·¯ç”±è¡¨ï¼Œè®©é‚£äº›æ•°æ®æµï¼Œä¼˜å…ˆä»è™šæ‹Ÿçš„ç½‘å¡è¿›å‡ºã€‚ç”±äºè™šæ‹Ÿçš„ç½‘å¡æ˜¯é€šå¾€ VPN æœåŠ¡å™¨çš„ï¼Œå½“æ•°æ®æµåˆ°è¾¾ VPN æœåŠ¡å™¨ä¹‹åï¼ŒVPN æœåŠ¡å™¨å†å¸®ä½ æŠŠæ•°æ®æµè½¬å‘åˆ°çœŸæ­£çš„ç›®çš„åœ°ã€‚å‰é¢è¯´äº†ï¼ŒVPN ä¸ºäº†ä¿è¯å®‰å…¨ï¼Œéƒ½é‡‡ç”¨å¼ºåŠ å¯†çš„æ–¹å¼ä¼ è¾“æ•°æ®ã€‚è¿™æ ·ä¸€æ¥ï¼ŒGFW å°±æ— æ³•åˆ†æä½ çš„ç½‘ç»œæ•°æ®æµï¼Œè¿›è¡Œæ•æ„Ÿè¯è¿‡æ»¤ã€‚æ‰€ä»¥ï¼Œä½¿ç”¨å¢™å¤–çš„VPNæœåŠ¡å™¨ï¼Œæ— å½¢ä¸­å°±èƒ½è¾¾åˆ°ç¿»å¢™çš„æ•ˆæœã€‚æ–¹æ¡ˆé€‰æ‹©VPNæ˜¯ä¸€ä¸ªå¤§ç±»ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šå®ç°çš„æ–¹æ³•ï¼Œé˜²ç«é•¿åŸç°åœ¨å°† VPN å±è”½çš„å·²ç»æ‰€å‰©æ— å‡ ï¼Œåæ¥å¤§å®¶çœ‹åˆ°äº†SSHï¼Œä½¿ç”¨SSHçš„sock5å¾ˆç¨³å®šï¼Œä½†æ˜¯ç‰¹å¾ä¹Ÿååˆ†æ˜æ˜¾ï¼Œé˜²ç«é•¿åŸå¯ä»¥å¯¹å…¶ç›´æ¥è¿›è¡Œå®šå‘å¹²æ‰°ã€‚è€Œé™¤äº†VPNï¼Œå¯¹äºç¿»å¢™å¤§å®¶ä»ç„¶æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæ¯”å¦‚Shadowsocks ã€Lanternã€VPNGate ç­‰ç­‰ï¼Œè€Œå®é™…ä¸Šæ— è®ºå“ªç§æ–¹å¼ï¼Œä»–ä»¬æœ¬èº«éƒ½éœ€è¦ä¸€å°æœåŠ¡å™¨ä½œä¸ºä¸­é—´äººè¿›è¡Œæ¶ˆæ¯ä¼ é€’ã€‚è€ŒVPSè™šæ‹Ÿä¸“ç”¨æœåŠ¡å™¨å°±ååˆ†é€‚åˆæ‹…å½“è¿™ä¸ªè§’è‰²ï¼Œå¹¶ä¸”ç”±äºVPSå¹³æ—¶å°±ä½œä¸ºå•†å“åœ¨å„ç±»äº‘æœåŠ¡å™¨å¹³å°ä¸Šå”®å–ï¼Œè‡ªè¡Œè´­ä¹°å¹¶æ­å»ºç›¸å½“æ–¹ä¾¿ï¼Œå”¯ä¸€éœ€è¦çš„å°±æ˜¯äººä»¬å¯¹äºæœåŠ¡å™¨çš„æ“ä½œæŠ€æœ¯ã€‚è€Œè¿™æ¬¡é€‰æ‹©çš„æ–¹æ¡ˆæ˜¯ï¼šVPS+Shadowsocks**Shadowsocksç‰¹ç‚¹ï¼šçœç”µï¼Œåœ¨ç”µé‡æŸ¥çœ‹é‡Œå‡ ä¹çœ‹ä¸åˆ°å®ƒçš„èº«å½±ï¼›æ”¯æŒå¼€æœºè‡ªå¯åŠ¨ï¼Œä¸”æ–­ç½‘æ— å½±å“ï¼Œæ— éœ€æ‰‹åŠ¨é‡è¿ï¼Œæ–¹ä¾¿ç½‘ç»œä¸ç¨³å®šæˆ–è€…3G&amp;Wi-Fié¢‘ç¹åˆ‡æ¢çš„å°ä¼™ä¼´ï¼›å¯ä½¿ç”¨è‡ªå·±çš„æœåŠ¡å™¨ï¼Œå®‰å…¨å’Œé€Ÿåº¦çš„ä¿è¯ï¼›æ”¯æŒåŒºåˆ†å›½å†…å¤–æµé‡ï¼Œä¼ ç»ŸVPNåœ¨ç¿»å‡ºå¢™å¤–åè®¿é—®å›½å†…ç«™ç‚¹ä¼šå˜æ…¢ï¼›å¯å¯¹åº”ç”¨è®¾ç½®å•ç‹¬ä»£ç†ï¼Œ5.0ä¹‹åçš„ç³»ç»Ÿæ— éœ€rootã€‚Shadowsocks ç›®å‰ä¸å®¹æ˜“è¢«å°æ€ä¸»è¦æ˜¯å› ä¸ºï¼šå»ºç«‹åœ¨socks5åè®®ä¹‹ä¸Šï¼Œsocks5æ˜¯è¿ç”¨å¾ˆå¹¿æ³›çš„åè®®ï¼Œæ‰€ä»¥æ²¡åŠæ³•ç›´æ¥å°æ€socks5åè®®ä½¿ç”¨socks5åè®®å»ºç«‹è¿æ¥ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨VPNä¸­çš„æœåŠ¡ç«¯èº«ä»½éªŒè¯å’Œå¯†é’¥åå•†è¿‡ç¨‹ã€‚è€Œæ˜¯åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ç›´æ¥å†™æ­»å¯†é’¥å’ŒåŠ å¯†ç®—æ³•ã€‚æ‰€ä»¥é˜²ç«å¢™å¾ˆéš¾æ‰¾åˆ°æ˜æ˜¾çš„ç‰¹å¾ï¼Œå› ä¸ºè¿™å°±æ˜¯ä¸ªæ™®é€šçš„socks5åè®®ã€‚Shadowsockæ­å»ºä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥å¾ˆå¤šäººè‡ªå·±æ¶è®¾VPSæ­å»ºï¼Œä¸ªäººä½¿ç”¨æµé‡ä¹Ÿå¾ˆå°ï¼Œæ²¡æ³•é€šè¿‡æµé‡ç›‘æ§æ–¹å¼å°æ€ã€‚è‡ªå®šä¹‰åŠ å¯†æ–¹å¼å’Œå¯†é’¥ã€‚å› ä¸ºåŠ å¯†ä¸»è¦ä¸»è¦æ˜¯é˜²æ­¢è¢«æ£€æµ‹ï¼Œæ‰€ä»¥è¦é€‰æ‹©å®‰å…¨ç³»æ•°é«˜çš„åŠ å¯†æ–¹å¼ã€‚ä¹‹å‰RC4ä¼šå¾ˆå®¹æ˜“è¢«ç ´è§£ï¼Œè€Œå¯¼è‡´è¢«å°æ€ã€‚æ‰€ä»¥ç°åœ¨æ¨èä½¿ç”¨AESåŠ å¯†ã€‚è€Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è‡ªå®šä¹‰å¯†é’¥ï¼Œæ³„éœ²çš„é£é™©ç›¸å¯¹è¾ƒå°ã€‚æ‰€ä»¥å¦‚æœæ˜¯è‡ªå·±æ­å»ºçš„Shadosocksè¢«å°çš„æ¦‚ç‡å¾ˆå°ï¼Œä½†æ˜¯å¦‚æœæ˜¯ç¬¬ä¸‰æ–¹çš„Shadeowsocksï¼Œå¯†ç æ˜¯serverå®šçš„ï¼Œä½ çš„æ•°æ®å¾ˆå¯èƒ½é­å—åˆ°ä¸­é—´äººæ”»å‡»ã€‚å¼€å·¥è´­ä¹°vpsé¦–å…ˆæˆ‘ä»¬éœ€è¦è´­ä¹°ä¸€å°å¢ƒå¤–çš„æœåŠ¡å™¨ï¼Œæ¥ç€æˆ‘ä»¬åœ¨è¿™å°äº‘æœåŠ¡å™¨é‡Œé¢å®‰è£…ä»£ç†æœåŠ¡ï¼Œé‚£ä¹ˆä»¥åæˆ‘ä»¬ä¸Šç½‘çš„æ—¶å€™å°±å¯ä»¥é€šè¿‡å®ƒæ¥ä¸­è½¬ï¼Œè½»æ¾ç•…å¿«çš„ç•…æ¸¸å…¨ç½‘äº†ã€‚è´­ä¹°VPS,æˆ‘é€‰æ‹©äº†vultrï¼Œå¤§å®¶ç”¨è¿‡éƒ½è¯´å¥½ï¼Œè´­ä¹°çš„è¿‡ç¨‹ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©ç¦»ä¸­å›½è¾ƒè¿‘å›½å®¶çš„æœåŠ¡å™¨ã€‚ç¬¬äºŒæ­¥ï¼šé€‰æ‹©æœåŠ¡å™¨é…ç½®å’Œç³»ç»Ÿè¿™é‡Œï¼Œç³»ç»Ÿé€‰æ‹©çš„æ˜¯CentOS 7,é…ç½®çš„è¯ï¼Œå¦‚æœåªæ˜¯è‡ªå·±æµè§ˆç½‘é¡µçš„è¯ï¼Œé€‰æ‹©æœ€ä½é…ç½®å°±å¥½ã€‚å…¶ä»–çš„é€‰é¡¹å¯ä»¥ç•¥è¿‡ã€‚ç¬¬ä¸‰æ­¥ï¼šæ”¯ä»˜å’Œéƒ¨ç½²æ”¯ä»˜å¯ä»¥é€‰æ‹©æ”¯ä»˜å®æ”¯ä»˜ï¼Œéå¸¸æ–¹ä¾¿ã€‚è´­ä¹°æˆåŠŸåï¼Œç‚¹å‡»Serverä¸­çš„â€œ+â€å·ï¼Œæ¥éƒ¨ç½²ä½ åˆšåˆšé€‰æ‹©çš„æœåŠ¡å™¨ã€‚ç¬¬å››æ­¥ï¼šç™»é™†æœåŠ¡å™¨æŸ¥çœ‹æœåŠ¡å™¨è¯¦æƒ… Server Details,æ ¹æ®æä¾›çš„æœåŠ¡å™¨ä¿¡æ¯ï¼Œç™»é™†æœåŠ¡å™¨ã€‚æˆ‘æ˜¯ä½¿ç”¨Macæœ¬èº«ç»ˆç«¯sshåˆ°æœåŠ¡å™¨ä¸Šçš„ï¼Œå› ä¸ºMacä¸Šå¤šæ•°çš„SSHå®¢æˆ·ç«¯è¦ä¹ˆæ”¶è´¹ï¼Œè¦ä¹ˆä¸å¥½ç”¨ï¼Œè¦ä¹ˆå®‰è£…è¿‡ç¨‹éå¸¸ç¹çã€‚1ssh -p 22 root@ipæ­å»ºshadowsocksæœåŠ¡å™¨è¿æ¥åˆ°ä½ çš„ vultr æœåŠ¡å™¨ä¹‹åï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨å‡ ä¸ªå‘½ä»¤è®©ä½ å¿«é€Ÿæ­å»ºä¸€ä¸ªå±äºè‡ªå·±çš„ ss æœåŠ¡å™¨ï¼š1yum install wgetæ¥ç€æ‰§è¡Œå®‰è£…shadowsocksï¼š1wget â€“no-check-certificate -O shadowsocks.sh https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.shè·å– shadowsocks.sh è¯»å–æƒé™ï¼š1chmod +x shadowsocks.shè®¾ç½®ä½ çš„ ss å¯†ç å’Œç«¯å£å·ï¼š1./shadowsocks.sh 2&gt;&amp;1 | tee shadowsocks.logæ¥ä¸‹æ¥åå°±å¯ä»¥è®¾ç½®å¯†ç å’Œç«¯å£å·äº†å¯†ç å’Œç«¯å£å·å¯ä»¥ä½¿ç”¨é»˜è®¤çš„ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é‡æ–°è¾“å…¥æ–°çš„ã€‚é€‰æ‹©åŠ å¯†æ–¹å¼è®¾ç½®å®Œå¯†ç å’Œç«¯å£å·ä¹‹åï¼Œæˆ‘ä»¬é€‰æ‹©åŠ å¯†æ–¹å¼ï¼Œè¿™é‡Œé€‰æ‹© 7 ï¼Œä½¿ç”¨aes-256-cfbçš„åŠ å¯†æ¨¡å¼æ¥ç€æŒ‰ä»»æ„é”®è¿›è¡Œå®‰è£…ã€‚å®‰è£…sså®Œæˆåä¼šç»™ä½ æ˜¾ç¤ºä½ éœ€è¦è¿æ¥ vpn çš„ä¿¡æ¯ï¼šæå®šï¼Œå°†è¿™äº›ä¿¡æ¯ä¿å­˜èµ·æ¥ï¼Œé‚£ä¹ˆè¿™æ—¶å€™ä½ å°±å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥ç§‘å­¦ä¸Šç½‘å•¦ã€‚ä½¿ç”¨BBRåŠ é€Ÿä¸Šç½‘å®‰è£… BBR1wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.shè·å–è¯»å†™æƒé™1chmod +x bbr.shå¯åŠ¨BBRå®‰è£…1./bbr.shæ¥ç€æŒ‰ä»»æ„é”®ï¼Œå¼€å§‹å®‰è£…ï¼Œåç­‰ä¸€ä¼šã€‚å®‰è£…å®Œæˆä¸€ä¼šä¹‹åå®ƒä¼šæç¤ºæˆ‘ä»¬æ˜¯å¦é‡æ–°å¯åŠ¨vpsï¼Œæˆ‘ä»¬è¾“å…¥ y ç¡®å®šé‡å¯æœåŠ¡å™¨ã€‚é‡æ–°å¯åŠ¨ä¹‹åï¼Œè¾“å…¥ï¼š1lsmod | grep bbrå¦‚æœçœ‹åˆ° tcp_bbr å°±è¯´æ˜ BBR å·²ç»å¯åŠ¨äº†ã€‚å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥windowsä½¿ç”¨Shadowsockswindowsç‚¹å‡»ä¸‹è½½ï¼šShadowsocks windowså®¢æˆ·ç«¯æ‰“å¼€ Shadowsocks å®¢æˆ·ç«¯ï¼Œè¾“å…¥ipåœ°å€ï¼Œå¯†ç ï¼Œç«¯å£ï¼Œå’ŒåŠ å¯†æ–¹å¼ã€‚æ¥ç€ç‚¹å‡»ç¡®å®šï¼Œå³ä¸‹è§’ä¼šæœ‰ä¸ªå°é£æœºæŒ‰é’®ï¼Œå³é”®â€“&gt;å¯åŠ¨ä»£ç†ã€‚Androidä½¿ç”¨ShadowsocksAndroidç‚¹å‡»ä¸‹è½½ï¼šShadowsocks Androidå®¢æˆ·ç«¯æ‰“å¼€apkå®‰è£…ï¼Œæ¥ç€æ‰“å¼€APPï¼Œè¾“å…¥ipåœ°å€ï¼Œå¯†ç ï¼Œç«¯å£ï¼Œå’ŒåŠ å¯†æ–¹å¼ã€‚å³å¯ç§‘å­¦ä¸Šç½‘ã€‚iPhoneä½¿ç”¨ShadowsocksiPhoneè¦ä¸‹è½½çš„appéœ€è¦åœ¨appstoreä¸‹è½½ï¼Œä½†æ˜¯éœ€è¦ç”¨ç¾åŒºè´¦å·æ‰èƒ½ä¸‹è½½ï¼Œè€Œä¸”è¿™ä¸ªAPPéœ€è¦é’±ã€‚åœ¨è¿™é‡Œæä¾›ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå°±æ˜¯å¯ä»¥å†æ­å»ºä¸€ä¸ªIPsec/L2TP VPN,ä¸“é—¨ç»™ä½ çš„iPhoneä½¿ç”¨ã€‚Macé…ç½®ç”¨çš„æ˜¯Macç”µè„‘ï¼Œæ‰€ä»¥ç‚¹å‡»ç›¸å…³é“¾æ¥ã€‚ä¸œè¥¿éƒ½æŒ‚åœ¨githubä¸Šï¼Œä¸‹è½½å¯¹åº”çš„zipæ–‡ä»¶ï¼Œä¸‹è½½å®Œæˆåå®‰è£…å¹¶è¿è¡Œèµ·æ¥ã€‚ç‚¹å‡»å›¾æ ‡ï¼Œè¿›å…¥ æœåŠ¡å™¨è®¾ç½®ä¸»è¦æœ‰å››ä¸ªåœ°æ–¹è¦å¡«ï¼ŒæœåŠ¡å™¨çš„åœ°å€ï¼Œç«¯å£å·ï¼ŒåŠ å¯†æ–¹æ³•ï¼Œå¯†ç ã€‚æœåŠ¡å™¨åœ°å€å³ä¸ºä¹‹å‰ Main controlsé€‰é¡¹ä¸­çš„IPåœ°å€ã€‚ç«¯å£å·ã€åŠ å¯†æ–¹æ³•ã€å¯†ç å¿…é¡»ä¸ä¹‹å‰ Shadowsocks Server ä¸­çš„ä¿¡æ¯ä¸€ä¸€åŒ¹é…ï¼Œå¦åˆ™ä¼šè¿æ¥å¤±è´¥ã€‚è®¾ç½®å®Œæˆåç‚¹å‡»ç¡®å®šï¼Œç„¶åæœåŠ¡å™¨é€‰æ‹©è¿™ä¸ªé…ç½®ï¼Œé»˜è®¤é€‰ä¸­PACè‡ªåŠ¨æ¨¡å¼ï¼Œç¡®ä¿ShadowsocksçŠ¶æ€ä¸ºOnï¼Œè¿™æ—¶å€™æ‰“å¼€è°·æ­Œè¯•è¯•~æ¥ç€å°±å¯ä»¥ä¸Šå¤–ç½‘äº† ğŸ˜‚","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"cpeixin.cn/categories/%E5%B7%A5%E5%85%B7/"}],"tags":[{"name":"shadowsock","slug":"shadowsock","permalink":"cpeixin.cn/tags/shadowsock/"}]},{"title":"Kafka æ¶ˆè´¹è€…è¯¦è§£","slug":"Kafka-æ¶ˆè´¹è€…è¯¦è§£","date":"2019-04-10T15:09:38.000Z","updated":"2020-07-10T15:12:07.475Z","comments":true,"path":"2019/04/10/Kafka-æ¶ˆè´¹è€…è¯¦è§£/","link":"","permalink":"cpeixin.cn/2019/04/10/Kafka-%E6%B6%88%E8%B4%B9%E8%80%85%E8%AF%A6%E8%A7%A3/","excerpt":"","text":"ä¸€ã€æ¶ˆè´¹è€…å’Œæ¶ˆè´¹è€…ç¾¤ç»„åœ¨ Kafka ä¸­ï¼Œæ¶ˆè´¹è€…é€šå¸¸æ˜¯æ¶ˆè´¹è€…ç¾¤ç»„çš„ä¸€éƒ¨åˆ†ï¼Œå¤šä¸ªæ¶ˆè´¹è€…ç¾¤ç»„å…±åŒè¯»å–åŒä¸€ä¸ªä¸»é¢˜æ—¶ï¼Œå½¼æ­¤ä¹‹é—´äº’ä¸å½±å“ã€‚Kafka ä¹‹æ‰€ä»¥è¦å¼•å…¥æ¶ˆè´¹è€…ç¾¤ç»„è¿™ä¸ªæ¦‚å¿µæ˜¯å› ä¸º Kafka æ¶ˆè´¹è€…ç»å¸¸ä¼šåšä¸€äº›é«˜å»¶è¿Ÿçš„æ“ä½œï¼Œæ¯”å¦‚æŠŠæ•°æ®å†™åˆ°æ•°æ®åº“æˆ– HDFS ï¼Œæˆ–è€…è¿›è¡Œè€—æ—¶çš„è®¡ç®—ï¼Œåœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå•ä¸ªæ¶ˆè´¹è€…æ— æ³•è·Ÿä¸Šæ•°æ®ç”Ÿæˆçš„é€Ÿåº¦ã€‚æ­¤æ—¶å¯ä»¥å¢åŠ æ›´å¤šçš„æ¶ˆè´¹è€…ï¼Œè®©å®ƒä»¬åˆ†æ‹…è´Ÿè½½ï¼Œåˆ†åˆ«å¤„ç†éƒ¨åˆ†åˆ†åŒºçš„æ¶ˆæ¯ï¼Œè¿™å°±æ˜¯ Kafka å®ç°æ¨ªå‘ä¼¸ç¼©çš„ä¸»è¦æ‰‹æ®µã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåŒä¸€ä¸ªåˆ†åŒºåªèƒ½è¢«åŒä¸€ä¸ªæ¶ˆè´¹è€…ç¾¤ç»„é‡Œé¢çš„ä¸€ä¸ªæ¶ˆè´¹è€…è¯»å–ï¼Œä¸å¯èƒ½å­˜åœ¨åŒä¸€ä¸ªåˆ†åŒºè¢«åŒä¸€ä¸ªæ¶ˆè´¹è€…ç¾¤é‡Œå¤šä¸ªæ¶ˆè´¹è€…å…±åŒè¯»å–çš„æƒ…å†µï¼Œå¦‚å›¾ï¼šå¯ä»¥çœ‹åˆ°å³ä¾¿æ¶ˆè´¹è€… Consumer5 ç©ºé—²äº†ï¼Œä½†æ˜¯ä¹Ÿä¸ä¼šå»è¯»å–ä»»ä½•ä¸€ä¸ªåˆ†åŒºçš„æ•°æ®ï¼Œè¿™åŒæ—¶ä¹Ÿæé†’æˆ‘ä»¬åœ¨ä½¿ç”¨æ—¶åº”è¯¥åˆç†è®¾ç½®æ¶ˆè´¹è€…çš„æ•°é‡ï¼Œä»¥å…é€ æˆé—²ç½®å’Œé¢å¤–å¼€é”€ã€‚äºŒã€åˆ†åŒºå†å‡è¡¡å› ä¸ºç¾¤ç»„é‡Œçš„æ¶ˆè´¹è€…å…±åŒè¯»å–ä¸»é¢˜çš„åˆ†åŒºï¼Œæ‰€ä»¥å½“ä¸€ä¸ªæ¶ˆè´¹è€…è¢«å…³é—­æˆ–å‘ç”Ÿå´©æºƒæ—¶ï¼Œå®ƒå°±ç¦»å¼€äº†ç¾¤ç»„ï¼ŒåŸæœ¬ç”±å®ƒè¯»å–çš„åˆ†åŒºå°†ç”±ç¾¤ç»„é‡Œçš„å…¶ä»–æ¶ˆè´¹è€…æ¥è¯»å–ã€‚åŒæ—¶åœ¨ä¸»é¢˜å‘ç”Ÿå˜åŒ–æ—¶ ï¼Œ æ¯”å¦‚æ·»åŠ äº†æ–°çš„åˆ†åŒºï¼Œä¹Ÿä¼šå‘ç”Ÿåˆ†åŒºä¸æ¶ˆè´¹è€…çš„é‡æ–°åˆ†é…ï¼Œåˆ†åŒºçš„æ‰€æœ‰æƒä»ä¸€ä¸ªæ¶ˆè´¹è€…è½¬ç§»åˆ°å¦ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œè¿™æ ·çš„è¡Œä¸ºè¢«ç§°ä¸ºå†å‡è¡¡ã€‚æ­£æ˜¯å› ä¸ºå†å‡è¡¡ï¼Œæ‰€ä»¥æ¶ˆè´¹è´¹è€…ç¾¤ç»„æ‰èƒ½ä¿è¯é«˜å¯ç”¨æ€§å’Œä¼¸ç¼©æ€§ã€‚æ¶ˆè´¹è€…é€šè¿‡å‘ç¾¤ç»„åè°ƒå™¨æ‰€åœ¨çš„ broker å‘é€å¿ƒè·³æ¥ç»´æŒå®ƒä»¬å’Œç¾¤ç»„çš„ä»å±å…³ç³»ä»¥åŠå®ƒä»¬å¯¹åˆ†åŒºçš„æ‰€æœ‰æƒã€‚åªè¦æ¶ˆè´¹è€…ä»¥æ­£å¸¸çš„æ—¶é—´é—´éš”å‘é€å¿ƒè·³ï¼Œå°±è¢«è®¤ä¸ºæ˜¯æ´»è·ƒçš„ï¼Œè¯´æ˜å®ƒè¿˜åœ¨è¯»å–åˆ†åŒºé‡Œçš„æ¶ˆæ¯ã€‚æ¶ˆè´¹è€…ä¼šåœ¨è½®è¯¢æ¶ˆæ¯æˆ–æäº¤åç§»é‡æ—¶å‘é€å¿ƒè·³ã€‚å¦‚æœæ¶ˆè´¹è€…åœæ­¢å‘é€å¿ƒè·³çš„æ—¶é—´è¶³å¤Ÿé•¿ï¼Œä¼šè¯å°±ä¼šè¿‡æœŸï¼Œç¾¤ç»„åè°ƒå™¨è®¤ä¸ºå®ƒå·²ç»æ­»äº¡ï¼Œå°±ä¼šè§¦å‘å†å‡è¡¡ã€‚ä¸‰ã€åˆ›å»ºKafkaæ¶ˆè´¹è€…åœ¨åˆ›å»ºæ¶ˆè´¹è€…çš„æ—¶å€™ä»¥ä¸‹ä»¥ä¸‹ä¸‰ä¸ªé€‰é¡¹æ˜¯å¿…é€‰çš„ï¼šbootstrap.servers ï¼šæŒ‡å®š broker çš„åœ°å€æ¸…å•ï¼Œæ¸…å•é‡Œä¸éœ€è¦åŒ…å«æ‰€æœ‰çš„ broker åœ°å€ï¼Œç”Ÿäº§è€…ä¼šä»ç»™å®šçš„ broker é‡ŒæŸ¥æ‰¾ broker çš„ä¿¡æ¯ã€‚ä¸è¿‡å»ºè®®è‡³å°‘è¦æä¾›ä¸¤ä¸ª broker çš„ä¿¡æ¯ä½œä¸ºå®¹é”™ï¼›key.deserializer ï¼šæŒ‡å®šé”®çš„ååºåˆ—åŒ–å™¨ï¼›value.deserializer ï¼šæŒ‡å®šå€¼çš„ååºåˆ—åŒ–å™¨ã€‚é™¤æ­¤ä¹‹å¤–ä½ è¿˜éœ€è¦æŒ‡æ˜ä½ éœ€è¦æƒ³è®¢é˜…çš„ä¸»é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä¸¤ä¸ª API :consumer.subscribe(Collectiontopics)ï¼šæŒ‡æ˜éœ€è¦è®¢é˜…çš„ä¸»é¢˜çš„é›†åˆï¼›consumer.subscribe(Pattern pattern) ï¼šä½¿ç”¨æ­£åˆ™æ¥åŒ¹é…éœ€è¦è®¢é˜…çš„é›†åˆã€‚æœ€ååªéœ€è¦é€šè¿‡è½®è¯¢ API(poll) å‘æœåŠ¡å™¨å®šæ—¶è¯·æ±‚æ•°æ®ã€‚ä¸€æ—¦æ¶ˆè´¹è€…è®¢é˜…äº†ä¸»é¢˜ï¼Œè½®è¯¢å°±ä¼šå¤„ç†æ‰€æœ‰çš„ç»†èŠ‚ï¼ŒåŒ…æ‹¬ç¾¤ç»„åè°ƒã€åˆ†åŒºå†å‡è¡¡ã€å‘é€å¿ƒè·³å’Œè·å–æ•°æ®ï¼Œè¿™ä½¿å¾—å¼€å‘è€…åªéœ€è¦å…³æ³¨ä»åˆ†åŒºè¿”å›çš„æ•°æ®ï¼Œç„¶åè¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚ ç¤ºä¾‹å¦‚ä¸‹ï¼š123456789101112val kafkaParams: Map[String, Object] = Map[String, Object]( \"bootstrap.servers\" -&gt; \"localhost:9092\", \"key.deserializer\" -&gt; classOf[StringDeserializer], \"value.deserializer\" -&gt; classOf[StringDeserializer], \"group.id\" -&gt; \"kafka_spark_streaming\", \"auto.offset.reset\" -&gt; \"earliest\", // earliest \"enable.auto.commit\" -&gt; (false: java.lang.Boolean))val topics = Array(\"weibo_keyword\")val kafkaStream: InputDStream[ConsumerRecord[String, String]] = KafkaUtils .createDirectStream[String, String](ssc, PreferConsistent, Subscribe[String, String](topics, kafkaParams))æœ¬ç¯‡æ–‡ç« çš„æ‰€æœ‰ç¤ºä¾‹ä»£ç å¯ä»¥ä» Github ä¸Šè¿›è¡Œä¸‹è½½ï¼škafka-basisä¸‰ã€ è‡ªåŠ¨æäº¤åç§»é‡3.1 åç§»é‡çš„é‡è¦æ€§Kafka çš„æ¯ä¸€æ¡æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªåç§»é‡å±æ€§ï¼Œè®°å½•äº†å…¶åœ¨åˆ†åŒºä¸­çš„ä½ç½®ï¼Œåç§»é‡æ˜¯ä¸€ä¸ªå•è°ƒé€’å¢çš„æ•´æ•°ã€‚æ¶ˆè´¹è€…é€šè¿‡å¾€ä¸€ä¸ªå«ä½œ ï¼¿consumer_offset çš„ç‰¹æ®Šä¸»é¢˜å‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯é‡ŒåŒ…å«æ¯ä¸ªåˆ†åŒºçš„åç§»é‡ã€‚ å¦‚æœæ¶ˆè´¹è€…ä¸€ç›´å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œé‚£ä¹ˆåç§»é‡å°±æ²¡æœ‰ä»€ä¹ˆç”¨å¤„ã€‚ä¸è¿‡ï¼Œå¦‚æœæœ‰æ¶ˆè´¹è€…é€€å‡ºæˆ–è€…æ–°åˆ†åŒºåŠ å…¥ï¼Œæ­¤æ—¶å°±ä¼šè§¦å‘å†å‡è¡¡ã€‚å®Œæˆå†å‡è¡¡ä¹‹åï¼Œæ¯ä¸ªæ¶ˆè´¹è€…å¯èƒ½åˆ†é…åˆ°æ–°çš„åˆ†åŒºï¼Œè€Œä¸æ˜¯ä¹‹å‰å¤„ç†çš„é‚£ä¸ªã€‚ä¸ºäº†èƒ½å¤Ÿç»§ç»­ä¹‹å‰çš„å·¥ä½œï¼Œæ¶ˆè´¹è€…éœ€è¦è¯»å–æ¯ä¸ªåˆ†åŒºæœ€åä¸€æ¬¡æäº¤çš„åç§»é‡ï¼Œç„¶åä»åç§»é‡æŒ‡å®šçš„åœ°æ–¹ç»§ç»­å¤„ç†ã€‚ å› ä¸ºè¿™ä¸ªåŸå› ï¼Œæ‰€ä»¥å¦‚æœä¸èƒ½æ­£ç¡®æäº¤åç§»é‡ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–è€…é‡å¤å‡ºç°æ¶ˆè´¹ï¼Œæ¯”å¦‚ä¸‹é¢æƒ…å†µï¼šå¦‚æœæäº¤çš„åç§»é‡å°äºå®¢æˆ·ç«¯å¤„ç†çš„æœ€åä¸€ä¸ªæ¶ˆæ¯çš„åç§»é‡ ï¼Œé‚£ä¹ˆå¤„äºä¸¤ä¸ªåç§»é‡ä¹‹é—´çš„æ¶ˆæ¯å°±ä¼šè¢«é‡å¤æ¶ˆè´¹ï¼›å¦‚æœæäº¤çš„åç§»é‡å¤§äºå®¢æˆ·ç«¯å¤„ç†çš„æœ€åä¸€ä¸ªæ¶ˆæ¯çš„åç§»é‡ï¼Œé‚£ä¹ˆå¤„äºä¸¤ä¸ªåç§»é‡ä¹‹é—´çš„æ¶ˆæ¯å°†ä¼šä¸¢å¤±ã€‚3.2 è‡ªåŠ¨æäº¤åç§»é‡Kafka æ”¯æŒè‡ªåŠ¨æäº¤å’Œæ‰‹åŠ¨æäº¤åç§»é‡ä¸¤ç§æ–¹å¼ã€‚è¿™é‡Œå…ˆä»‹ç»æ¯”è¾ƒç®€å•çš„è‡ªåŠ¨æäº¤ï¼šåªéœ€è¦å°†æ¶ˆè´¹è€…çš„ enable.auto.commit å±æ€§é…ç½®ä¸º true å³å¯å®Œæˆè‡ªåŠ¨æäº¤çš„é…ç½®ã€‚ æ­¤æ—¶æ¯éš”å›ºå®šçš„æ—¶é—´ï¼Œæ¶ˆè´¹è€…å°±ä¼šæŠŠ poll() æ–¹æ³•æ¥æ”¶åˆ°çš„æœ€å¤§åç§»é‡è¿›è¡Œæäº¤ï¼Œæäº¤é—´éš”ç”± auto.commit.interval.ms å±æ€§è¿›è¡Œé…ç½®ï¼Œé»˜è®¤å€¼æ˜¯ 5sã€‚ä½¿ç”¨è‡ªåŠ¨æäº¤æ˜¯å­˜åœ¨éšæ‚£çš„ï¼Œå‡è®¾æˆ‘ä»¬ä½¿ç”¨é»˜è®¤çš„ 5s æäº¤æ—¶é—´é—´éš”ï¼Œåœ¨æœ€è¿‘ä¸€æ¬¡æäº¤ä¹‹åçš„ 3s å‘ç”Ÿäº†å†å‡è¡¡ï¼Œå†å‡è¡¡ä¹‹åï¼Œæ¶ˆè´¹è€…ä»æœ€åä¸€æ¬¡æäº¤çš„åç§»é‡ä½ç½®å¼€å§‹è¯»å–æ¶ˆæ¯ã€‚è¿™ä¸ªæ—¶å€™åç§»é‡å·²ç»è½åäº† 3s ï¼Œæ‰€ä»¥åœ¨è¿™ 3s å†…åˆ°è¾¾çš„æ¶ˆæ¯ä¼šè¢«é‡å¤å¤„ç†ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹æäº¤æ—¶é—´é—´éš”æ¥æ›´é¢‘ç¹åœ°æäº¤åç§»é‡ï¼Œå‡å°å¯èƒ½å‡ºç°é‡å¤æ¶ˆæ¯çš„æ—¶é—´çª—ï¼Œä¸è¿‡è¿™ç§æƒ…å†µæ˜¯æ— æ³•å®Œå…¨é¿å…çš„ã€‚åŸºäºè¿™ä¸ªåŸå› ï¼ŒKafka ä¹Ÿæä¾›äº†æ‰‹åŠ¨æäº¤åç§»é‡çš„ APIï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ›´ä¸ºçµæ´»çš„æäº¤åç§»é‡ã€‚å››ã€æ‰‹åŠ¨æäº¤åç§»é‡ç”¨æˆ·å¯ä»¥é€šè¿‡å°† enable.auto.commit è®¾ä¸º falseï¼Œç„¶åæ‰‹åŠ¨æäº¤åç§»é‡ã€‚åŸºäºç”¨æˆ·éœ€æ±‚æ‰‹åŠ¨æäº¤åç§»é‡å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šæ‰‹åŠ¨æäº¤å½“å‰åç§»é‡ï¼šå³æ‰‹åŠ¨æäº¤å½“å‰è½®è¯¢çš„æœ€å¤§åç§»é‡ï¼›æ‰‹åŠ¨æäº¤å›ºå®šåç§»é‡ï¼šå³æŒ‰ç…§ä¸šåŠ¡éœ€æ±‚ï¼Œæäº¤æŸä¸€ä¸ªå›ºå®šçš„åç§»é‡ã€‚è€ŒæŒ‰ç…§ Kafka APIï¼Œæ‰‹åŠ¨æäº¤åç§»é‡åˆå¯ä»¥åˆ†ä¸ºåŒæ­¥æäº¤å’Œå¼‚æ­¥æäº¤ã€‚4.1 åŒæ­¥æäº¤é€šè¿‡è°ƒç”¨ consumer.commitSync() æ¥è¿›è¡ŒåŒæ­¥æäº¤ï¼Œä¸ä¼ é€’ä»»ä½•å‚æ•°æ—¶æäº¤çš„æ˜¯å½“å‰è½®è¯¢çš„æœ€å¤§åç§»é‡ã€‚123456789while (true) &#123; ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.of(100, ChronoUnit.MILLIS)); for (ConsumerRecord&lt;String, String&gt; record : records) &#123; System.out.println(record); &#125; /*åŒæ­¥æäº¤*/ consumer.commitSync();&#125;å¤åˆ¶ä»£ç å¦‚æœæŸä¸ªæäº¤å¤±è´¥ï¼ŒåŒæ­¥æäº¤è¿˜ä¼šè¿›è¡Œé‡è¯•ï¼Œè¿™å¯ä»¥ä¿è¯æ•°æ®èƒ½å¤Ÿæœ€å¤§é™åº¦æäº¤æˆåŠŸï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿä¼šé™ä½ç¨‹åºçš„ååé‡ã€‚åŸºäºè¿™ä¸ªåŸå› ï¼ŒKafka è¿˜æä¾›äº†å¼‚æ­¥æäº¤çš„ APIã€‚4.2 å¼‚æ­¥æäº¤å¼‚æ­¥æäº¤å¯ä»¥æé«˜ç¨‹åºçš„ååé‡ï¼Œå› ä¸ºæ­¤æ—¶ä½ å¯ä»¥å°½ç®¡è¯·æ±‚æ•°æ®ï¼Œè€Œä¸ç”¨ç­‰å¾… Broker çš„å“åº”ã€‚ä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718while (true) &#123; ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.of(100, ChronoUnit.MILLIS)); for (ConsumerRecord&lt;String, String&gt; record : records) &#123; System.out.println(record); &#125; /*å¼‚æ­¥æäº¤å¹¶å®šä¹‰å›è°ƒ*/ consumer.commitAsync(new OffsetCommitCallback() &#123; @Override public void onComplete(Map&lt;TopicPartition, OffsetAndMetadata&gt; offsets, Exception exception) &#123; if (exception != null) &#123; System.out.println(\"é”™è¯¯å¤„ç†\"); offsets.forEach((x, y) -&gt; System.out.printf(\"topic = %s,partition = %d, offset = %s \\n\", x.topic(), x.partition(), y.offset())); &#125; &#125; &#125;);&#125;å¤åˆ¶ä»£ç å¼‚æ­¥æäº¤å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œåœ¨æäº¤å¤±è´¥çš„æ—¶å€™ä¸ä¼šè¿›è¡Œè‡ªåŠ¨é‡è¯•ï¼Œå®é™…ä¸Šä¹Ÿä¸èƒ½è¿›è¡Œè‡ªåŠ¨é‡è¯•ã€‚å‡è®¾ç¨‹åºåŒæ—¶æäº¤äº† 200 å’Œ 300 çš„åç§»é‡ï¼Œæ­¤æ—¶ 200 çš„åç§»é‡å¤±è´¥çš„ï¼Œä½†æ˜¯ç´§éšå…¶åçš„ 300 çš„åç§»é‡æˆåŠŸäº†ï¼Œæ­¤æ—¶å¦‚æœé‡è¯•å°±ä¼šå­˜åœ¨ 200 è¦†ç›– 300 åç§»é‡çš„å¯èƒ½ã€‚åŒæ­¥æäº¤å°±ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºåœ¨åŒæ­¥æäº¤çš„æƒ…å†µä¸‹ï¼Œ300 çš„æäº¤è¯·æ±‚å¿…é¡»ç­‰å¾…æœåŠ¡å™¨è¿”å› 200 æäº¤è¯·æ±‚çš„æˆåŠŸåé¦ˆåæ‰ä¼šå‘å‡ºã€‚åŸºäºè¿™ä¸ªåŸå› ï¼ŒæŸäº›æƒ…å†µä¸‹ï¼Œéœ€è¦åŒæ—¶ç»„åˆåŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æäº¤æ–¹å¼ã€‚æ³¨ï¼šè™½ç„¶ç¨‹åºä¸èƒ½åœ¨å¤±è´¥æ—¶å€™è¿›è¡Œè‡ªåŠ¨é‡è¯•ï¼Œä½†æ˜¯æˆ‘ä»¬æ˜¯å¯ä»¥æ‰‹åŠ¨è¿›è¡Œé‡è¯•çš„ï¼Œä½ å¯ä»¥é€šè¿‡ä¸€ä¸ª Map&lt;TopicPartition, Integer&gt; offsets æ¥ç»´æŠ¤ä½ æäº¤çš„æ¯ä¸ªåˆ†åŒºçš„åç§»é‡ï¼Œç„¶åå½“å¤±è´¥æ—¶å€™ï¼Œä½ å¯ä»¥åˆ¤æ–­å¤±è´¥çš„åç§»é‡æ˜¯å¦å°äºä½ ç»´æŠ¤çš„åŒä¸»é¢˜åŒåˆ†åŒºçš„æœ€åæäº¤çš„åç§»é‡ï¼Œå¦‚æœå°äºåˆ™ä»£è¡¨ä½ å·²ç»æäº¤äº†æ›´å¤§çš„åç§»é‡è¯·æ±‚ï¼Œæ­¤æ—¶ä¸éœ€è¦é‡è¯•ï¼Œå¦åˆ™å°±å¯ä»¥è¿›è¡Œæ‰‹åŠ¨é‡è¯•ã€‚4.3 åŒæ­¥åŠ å¼‚æ­¥æäº¤ä¸‹é¢è¿™ç§æƒ…å†µï¼Œåœ¨æ­£å¸¸çš„è½®è¯¢ä¸­ä½¿ç”¨å¼‚æ­¥æäº¤æ¥ä¿è¯ååé‡ï¼Œä½†æ˜¯å› ä¸ºåœ¨æœ€åå³å°†è¦å…³é—­æ¶ˆè´¹è€…äº†ï¼Œæ‰€ä»¥æ­¤æ—¶éœ€è¦ç”¨åŒæ­¥æäº¤æ¥ä¿è¯æœ€å¤§é™åº¦çš„æäº¤æˆåŠŸã€‚1234567891011121314151617181920try &#123; while (true) &#123; ConsumerRecords&lt;String, String&gt; records &#x3D; consumer.poll(Duration.of(100, ChronoUnit.MILLIS)); for (ConsumerRecord&lt;String, String&gt; record : records) &#123; System.out.println(record); &#125; &#x2F;&#x2F; å¼‚æ­¥æäº¤ consumer.commitAsync(); &#125;&#125; catch (Exception e) &#123; e.printStackTrace();&#125; finally &#123; try &#123; &#x2F;&#x2F; å› ä¸ºå³å°†è¦å…³é—­æ¶ˆè´¹è€…ï¼Œæ‰€ä»¥è¦ç”¨åŒæ­¥æäº¤ä¿è¯æäº¤æˆåŠŸ consumer.commitSync(); &#125; finally &#123; consumer.close(); &#125;&#125;å¤åˆ¶ä»£ç 4.4 æäº¤ç‰¹å®šåç§»é‡åœ¨ä¸Šé¢åŒæ­¥å’Œå¼‚æ­¥æäº¤çš„ API ä¸­ï¼Œå®é™…ä¸Šæˆ‘ä»¬éƒ½æ²¡æœ‰å¯¹ commit æ–¹æ³•ä¼ é€’å‚æ•°ï¼Œæ­¤æ—¶é»˜è®¤æäº¤çš„æ˜¯å½“å‰è½®è¯¢çš„æœ€å¤§åç§»é‡ï¼Œå¦‚æœä½ éœ€è¦æäº¤ç‰¹å®šçš„åç§»é‡ï¼Œå¯ä»¥è°ƒç”¨å®ƒä»¬çš„é‡è½½æ–¹æ³•ã€‚12345&#x2F;*åŒæ­¥æäº¤ç‰¹å®šåç§»é‡*&#x2F;commitSync(Map&lt;TopicPartition, OffsetAndMetadata&gt; offsets) &#x2F;*å¼‚æ­¥æäº¤ç‰¹å®šåç§»é‡*&#x2F; commitAsync(Map&lt;TopicPartition, OffsetAndMetadata&gt; offsets, OffsetCommitCallback callback)å¤åˆ¶ä»£ç éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºä½ å¯ä»¥è®¢é˜…å¤šä¸ªä¸»é¢˜ï¼Œæ‰€ä»¥ offsets ä¸­å¿…é¡»è¦åŒ…å«æ‰€æœ‰ä¸»é¢˜çš„æ¯ä¸ªåˆ†åŒºçš„åç§»é‡ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718try &#123; while (true) &#123; ConsumerRecords&lt;String, String&gt; records &#x3D; consumer.poll(Duration.of(100, ChronoUnit.MILLIS)); for (ConsumerRecord&lt;String, String&gt; record : records) &#123; System.out.println(record); &#x2F;*è®°å½•æ¯ä¸ªä¸»é¢˜çš„æ¯ä¸ªåˆ†åŒºçš„åç§»é‡*&#x2F; TopicPartition topicPartition &#x3D; new TopicPartition(record.topic(), record.partition()); OffsetAndMetadata offsetAndMetadata &#x3D; new OffsetAndMetadata(record.offset()+1, &quot;no metaData&quot;); &#x2F;*TopicPartition é‡å†™è¿‡ hashCode å’Œ equals æ–¹æ³•ï¼Œæ‰€ä»¥èƒ½å¤Ÿä¿è¯åŒä¸€ä¸»é¢˜å’Œåˆ†åŒºçš„å®ä¾‹ä¸ä¼šè¢«é‡å¤æ·»åŠ *&#x2F; offsets.put(topicPartition, offsetAndMetadata); &#125; &#x2F;*æäº¤ç‰¹å®šåç§»é‡*&#x2F; consumer.commitAsync(offsets, null); &#125;&#125; finally &#123; consumer.close();&#125;å¤åˆ¶ä»£ç äº”ã€ç›‘å¬åˆ†åŒºå†å‡è¡¡å› ä¸ºåˆ†åŒºå†å‡è¡¡ä¼šå¯¼è‡´åˆ†åŒºä¸æ¶ˆè´¹è€…çš„é‡æ–°åˆ’åˆ†ï¼Œæœ‰æ—¶å€™ä½ å¯èƒ½å¸Œæœ›åœ¨å†å‡è¡¡å‰æ‰§è¡Œä¸€äº›æ“ä½œï¼šæ¯”å¦‚æäº¤å·²ç»å¤„ç†ä½†æ˜¯å°šæœªæäº¤çš„åç§»é‡ï¼Œå…³é—­æ•°æ®åº“è¿æ¥ç­‰ã€‚æ­¤æ—¶å¯ä»¥åœ¨è®¢é˜…ä¸»é¢˜æ—¶å€™ï¼Œè°ƒç”¨ subscribe çš„é‡è½½æ–¹æ³•ä¼ å…¥è‡ªå®šä¹‰çš„åˆ†åŒºå†å‡è¡¡ç›‘å¬å™¨ã€‚12345&#x2F;*è®¢é˜…æŒ‡å®šé›†åˆå†…çš„æ‰€æœ‰ä¸»é¢˜*&#x2F;subscribe(Collection&lt;String&gt; topics, ConsumerRebalanceListener listener) &#x2F;*ä½¿ç”¨æ­£åˆ™åŒ¹é…éœ€è¦è®¢é˜…çš„ä¸»é¢˜*&#x2F; subscribe(Pattern pattern, ConsumerRebalanceListener listener) å¤åˆ¶ä»£ç ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627282930Map&lt;TopicPartition, OffsetAndMetadata&gt; offsets &#x3D; new HashMap&lt;&gt;();consumer.subscribe(Collections.singletonList(topic), new ConsumerRebalanceListener() &#123; &#x2F;*è¯¥æ–¹æ³•ä¼šåœ¨æ¶ˆè´¹è€…åœæ­¢è¯»å–æ¶ˆæ¯ä¹‹åï¼Œå†å‡è¡¡å¼€å§‹ä¹‹å‰å°±è°ƒç”¨*&#x2F; @Override public void onPartitionsRevoked(Collection&lt;TopicPartition&gt; partitions) &#123; System.out.println(&quot;å†å‡è¡¡å³å°†è§¦å‘&quot;); &#x2F;&#x2F; æäº¤å·²ç»å¤„ç†çš„åç§»é‡ consumer.commitSync(offsets); &#125; &#x2F;*è¯¥æ–¹æ³•ä¼šåœ¨é‡æ–°åˆ†é…åˆ†åŒºä¹‹åï¼Œæ¶ˆè´¹è€…å¼€å§‹è¯»å–æ¶ˆæ¯ä¹‹å‰è¢«è°ƒç”¨*&#x2F; @Override public void onPartitionsAssigned(Collection&lt;TopicPartition&gt; partitions) &#123; &#125;&#125;);try &#123; while (true) &#123; ConsumerRecords&lt;String, String&gt; records &#x3D; consumer.poll(Duration.of(100, ChronoUnit.MILLIS)); for (ConsumerRecord&lt;String, String&gt; record : records) &#123; System.out.println(record); TopicPartition topicPartition &#x3D; new TopicPartition(record.topic(), record.partition()); OffsetAndMetadata offsetAndMetadata &#x3D; new OffsetAndMetadata(record.offset() + 1, &quot;no metaData&quot;); &#x2F;*TopicPartition é‡å†™è¿‡ hashCode å’Œ equals æ–¹æ³•ï¼Œæ‰€ä»¥èƒ½å¤Ÿä¿è¯åŒä¸€ä¸»é¢˜å’Œåˆ†åŒºçš„å®ä¾‹ä¸ä¼šè¢«é‡å¤æ·»åŠ *&#x2F; offsets.put(topicPartition, offsetAndMetadata); &#125; consumer.commitAsync(offsets, null); &#125;&#125; finally &#123; consumer.close();&#125;å¤åˆ¶ä»£ç å…­ ã€é€€å‡ºè½®è¯¢Kafka æä¾›äº† consumer.wakeup() æ–¹æ³•ç”¨äºé€€å‡ºè½®è¯¢ï¼Œå®ƒé€šè¿‡æŠ›å‡º WakeupException å¼‚å¸¸æ¥è·³å‡ºå¾ªç¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨é€€å‡ºçº¿ç¨‹æ—¶æœ€å¥½æ˜¾ç¤ºçš„è°ƒç”¨ consumer.close() , æ­¤æ—¶æ¶ˆè´¹è€…ä¼šæäº¤ä»»ä½•è¿˜æ²¡æœ‰æäº¤çš„ä¸œè¥¿ï¼Œå¹¶å‘ç¾¤ç»„åè°ƒå™¨å‘é€æ¶ˆæ¯ï¼Œå‘ŠçŸ¥è‡ªå·±è¦ç¦»å¼€ç¾¤ç»„ï¼Œæ¥ä¸‹æ¥å°±ä¼šè§¦å‘å†å‡è¡¡ ï¼Œè€Œä¸éœ€è¦ç­‰å¾…ä¼šè¯è¶…æ—¶ã€‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸ºç›‘å¬æ§åˆ¶å°è¾“å‡ºï¼Œå½“è¾“å…¥ exit æ—¶ç»“æŸè½®è¯¢ï¼Œå…³é—­æ¶ˆè´¹è€…å¹¶é€€å‡ºç¨‹åºï¼š1234567891011121314151617181920212223242526272829303132&#x2F;*è°ƒç”¨ wakeup ä¼˜é›…çš„é€€å‡º*&#x2F;final Thread mainThread &#x3D; Thread.currentThread();new Thread(() -&gt; &#123; Scanner sc &#x3D; new Scanner(System.in); while (sc.hasNext()) &#123; if (&quot;exit&quot;.equals(sc.next())) &#123; consumer.wakeup(); try &#123; &#x2F;*ç­‰å¾…ä¸»çº¿ç¨‹å®Œæˆæäº¤åç§»é‡ã€å…³é—­æ¶ˆè´¹è€…ç­‰æ“ä½œ*&#x2F; mainThread.join(); break; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125;).start();try &#123; while (true) &#123; ConsumerRecords&lt;String, String&gt; records &#x3D; consumer.poll(Duration.of(100, ChronoUnit.MILLIS)); for (ConsumerRecord&lt;String, String&gt; rd : records) &#123; System.out.printf(&quot;topic &#x3D; %s,partition &#x3D; %d, key &#x3D; %s, value &#x3D; %s, offset &#x3D; %d,\\n&quot;, rd.topic(), rd.partition(), rd.key(), rd.value(), rd.offset()); &#125; &#125;&#125; catch (WakeupException e) &#123; &#x2F;&#x2F;å¯¹äº wakeup() è°ƒç”¨å¼•èµ·çš„ WakeupException å¼‚å¸¸å¯ä»¥ä¸å¿…å¤„ç†&#125; finally &#123; consumer.close(); System.out.println(&quot;consumer å…³é—­&quot;);&#125;å¤åˆ¶ä»£ç ä¸ƒã€ç‹¬ç«‹çš„æ¶ˆè´¹è€…å› ä¸º Kafka çš„è®¾è®¡ç›®æ ‡æ˜¯é«˜ååå’Œä½å»¶è¿Ÿï¼Œæ‰€ä»¥åœ¨ Kafka ä¸­ï¼Œæ¶ˆè´¹è€…é€šå¸¸éƒ½æ˜¯ä»å±äºæŸä¸ªç¾¤ç»„çš„ï¼Œè¿™æ˜¯å› ä¸ºå•ä¸ªæ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›æ˜¯æœ‰é™çš„ã€‚ä½†æ˜¯æŸäº›æ—¶å€™ä½ çš„éœ€æ±‚å¯èƒ½å¾ˆç®€å•ï¼Œæ¯”å¦‚å¯èƒ½åªéœ€è¦ä¸€ä¸ªæ¶ˆè´¹è€…ä»ä¸€ä¸ªä¸»é¢˜çš„æ‰€æœ‰åˆ†åŒºæˆ–è€…æŸä¸ªç‰¹å®šçš„åˆ†åŒºè¯»å–æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¸éœ€è¦æ¶ˆè´¹è€…ç¾¤ç»„å’Œå†å‡è¡¡äº†ï¼Œ åªéœ€è¦æŠŠä¸»é¢˜æˆ–è€…åˆ†åŒºåˆ†é…ç»™æ¶ˆè´¹è€…ï¼Œç„¶åå¼€å§‹è¯»å–æ¶ˆæ¯äº•æäº¤åç§»é‡å³å¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±ä¸éœ€è¦è®¢é˜…ä¸»é¢˜ï¼Œ å–è€Œä»£ä¹‹çš„æ˜¯æ¶ˆè´¹è€…ä¸ºè‡ªå·±åˆ†é…åˆ†åŒºã€‚ ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥è®¢é˜…ä¸»é¢˜ï¼ˆäº•åŠ å…¥æ¶ˆè´¹è€…ç¾¤ç»„ï¼‰ï¼Œæˆ–è€…ä¸ºè‡ªå·±åˆ†é…åˆ†åŒºï¼Œä½†ä¸èƒ½åŒæ—¶åšè¿™ä¸¤ä»¶äº‹æƒ…ã€‚ åˆ†é…åˆ†åŒºçš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š12345678910111213141516171819List&lt;TopicPartition&gt; partitions &#x3D; new ArrayList&lt;&gt;();List&lt;PartitionInfo&gt; partitionInfos &#x3D; consumer.partitionsFor(topic);&#x2F;*å¯ä»¥æŒ‡å®šè¯»å–å“ªäº›åˆ†åŒº å¦‚è¿™é‡Œå‡è®¾åªè¯»å–ä¸»é¢˜çš„ 0 åˆ†åŒº*&#x2F;for (PartitionInfo partition : partitionInfos) &#123; if (partition.partition()&#x3D;&#x3D;0)&#123; partitions.add(new TopicPartition(partition.topic(), partition.partition())); &#125;&#125;&#x2F;&#x2F; ä¸ºæ¶ˆè´¹è€…æŒ‡å®šåˆ†åŒºconsumer.assign(partitions);while (true) &#123; ConsumerRecords&lt;Integer, String&gt; records &#x3D; consumer.poll(Duration.of(100, ChronoUnit.MILLIS)); for (ConsumerRecord&lt;Integer, String&gt; record : records) &#123; System.out.printf(&quot;partition &#x3D; %s, key &#x3D; %d, value &#x3D; %s\\n&quot;, record.partition(), record.key(), record.value()); &#125; consumer.commitSync();&#125;å¤åˆ¶ä»£ç é™„å½• : Kafkaæ¶ˆè´¹è€…å¯é€‰å±æ€§1. fetch.min.byteæ¶ˆè´¹è€…ä»æœåŠ¡å™¨è·å–è®°å½•çš„æœ€å°å­—èŠ‚æ•°ã€‚å¦‚æœå¯ç”¨çš„æ•°æ®é‡å°äºè®¾ç½®å€¼ï¼Œbroker ä¼šç­‰å¾…æœ‰è¶³å¤Ÿçš„å¯ç”¨æ•°æ®æ—¶æ‰ä¼šæŠŠå®ƒè¿”å›ç»™æ¶ˆè´¹è€…ã€‚2. fetch.max.wait.msbroker è¿”å›ç»™æ¶ˆè´¹è€…æ•°æ®çš„ç­‰å¾…æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 500msã€‚3. max.partition.fetch.bytesè¯¥å±æ€§æŒ‡å®šäº†æœåŠ¡å™¨ä»æ¯ä¸ªåˆ†åŒºè¿”å›ç»™æ¶ˆè´¹è€…çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œé»˜è®¤ä¸º 1MBã€‚4. session.timeout.msæ¶ˆè´¹è€…åœ¨è¢«è®¤ä¸ºæ­»äº¡ä¹‹å‰å¯ä»¥ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥çš„æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 3sã€‚5. auto.offset.resetè¯¥å±æ€§æŒ‡å®šäº†æ¶ˆè´¹è€…åœ¨è¯»å–ä¸€ä¸ªæ²¡æœ‰åç§»é‡çš„åˆ†åŒºæˆ–è€…åç§»é‡æ— æ•ˆçš„æƒ…å†µä¸‹è¯¥ä½œä½•å¤„ç†ï¼šlatest (é»˜è®¤å€¼) ï¼šåœ¨åç§»é‡æ— æ•ˆçš„æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…å°†ä»æœ€æ–°çš„è®°å½•å¼€å§‹è¯»å–æ•°æ®ï¼ˆåœ¨æ¶ˆè´¹è€…å¯åŠ¨ä¹‹åç”Ÿæˆçš„æœ€æ–°è®°å½•ï¼‰;earliest ï¼šåœ¨åç§»é‡æ— æ•ˆçš„æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…å°†ä»èµ·å§‹ä½ç½®è¯»å–åˆ†åŒºçš„è®°å½•ã€‚6. enable.auto.commitæ˜¯å¦è‡ªåŠ¨æäº¤åç§»é‡ï¼Œé»˜è®¤å€¼æ˜¯ trueã€‚ä¸ºäº†é¿å…å‡ºç°é‡å¤æ¶ˆè´¹å’Œæ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥æŠŠå®ƒè®¾ç½®ä¸º falseã€‚7. client.idå®¢æˆ·ç«¯ idï¼ŒæœåŠ¡å™¨ç”¨æ¥è¯†åˆ«æ¶ˆæ¯çš„æ¥æºã€‚8. max.poll.recordså•æ¬¡è°ƒç”¨ poll() æ–¹æ³•èƒ½å¤Ÿè¿”å›çš„è®°å½•æ•°é‡ã€‚9. receive.buffer.bytes &amp; send.buffer.byteè¿™ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æŒ‡å®š TCP socket æ¥æ”¶å’Œå‘é€æ•°æ®åŒ…ç¼“å†²åŒºçš„å¤§å°ï¼Œ-1 ä»£è¡¨ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„é»˜è®¤å€¼ã€‚è½¬è½½è‡ªKafka ç³»åˆ—ï¼ˆå››ï¼‰â€”â€” Kafka æ¶ˆè´¹è€…è¯¦è§£","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"cpeixin.cn/tags/kafka/"}]},{"title":"Flinkå’ŒSpark Streamingä¸­çš„Back Pressure","slug":"Flinkå’ŒSpark-Streamingä¸­çš„Back-Pressure","date":"2019-03-15T15:09:25.000Z","updated":"2020-08-05T07:17:35.185Z","comments":true,"path":"2019/03/15/Flinkå’ŒSpark-Streamingä¸­çš„Back-Pressure/","link":"","permalink":"cpeixin.cn/2019/03/15/Flink%E5%92%8CSpark-Streaming%E4%B8%AD%E7%9A%84Back-Pressure/","excerpt":"","text":"Spark Streaming BackPressureSpark Streamingçš„back pressureå‡ºç°çš„åŸå› å‘¢ï¼Œæˆ‘æƒ³å¤§å®¶åº”è¯¥éƒ½çŸ¥é“ï¼Œæ˜¯ä¸ºäº†åº”å¯¹çŸ­æœŸæ•°æ®å°–å³°ã€‚Spark Streamingçš„back pressureæ˜¯ä»spark 1.5ä»¥åå¼•å…¥çš„ï¼Œåœ¨ä¹‹å‰å‘¢ï¼Œåªèƒ½é€šè¿‡é™åˆ¶æœ€å¤§æ¶ˆè´¹é€Ÿåº¦ï¼ˆè¿™ä¸ªè¦äººä¸ºå‹æµ‹é¢„ä¼°ï¼‰ï¼Œå¯¹äºåŸºäºReceiver å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½® spark.streaming.receiver.maxRate å‚æ•°æ¥é™åˆ¶æ¯ä¸ª receiver æ¯ç§’æœ€å¤§å¯ä»¥æ¥æ”¶çš„è®°å½•çš„æ•°æ®ï¼›å¯¹äº Direct Approach çš„æ•°æ®æ¥æ”¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½® spark.streaming.kafka.maxRatePerPartition å‚æ•°æ¥é™åˆ¶æ¯æ¬¡ä½œä¸šä¸­æ¯ä¸ª Kafka åˆ†åŒºæœ€å¤šè¯»å–çš„è®°å½•æ¡æ•°ã€‚è¿™ç§é™é€Ÿçš„å¼Šç«¯å¾ˆæ˜æ˜¾ï¼Œæ¯”å¦‚å‡å¦‚æˆ‘ä»¬åç«¯å¤„ç†èƒ½åŠ›è¶…è¿‡äº†è¿™ä¸ªæœ€å¤§çš„é™åˆ¶ï¼Œä¼šå¯¼è‡´èµ„æºæµªè´¹ã€‚éœ€è¦å¯¹æ¯ä¸ªspark Streamingä»»åŠ¡è¿›è¡Œå‹æµ‹é¢„ä¼°ã€‚æˆæœ¬æ¯”è¾ƒé«˜ã€‚ç”±æ­¤ï¼Œä»1.5å¼€å§‹å¼•å…¥äº†back pressureï¼Œè¿™ç§æœºåˆ¶å‘¢å®é™…ä¸Šæ˜¯åŸºäºè‡ªåŠ¨æ§åˆ¶ç†è®ºçš„pidè¿™ä¸ªæ¦‚å¿µã€‚æˆ‘ä»¬å°±ç®€å•è®²ä¸€ä¸‹å…¶ä¸­æ€è·¯ï¼šä¸ºäº†å®ç°è‡ªåŠ¨è°ƒèŠ‚æ•°æ®çš„ä¼ è¾“é€Ÿç‡ï¼Œåœ¨åŸæœ‰çš„æ¶æ„ä¸Šæ–°å¢äº†ä¸€ä¸ªåä¸º RateController çš„ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ç»§æ‰¿è‡ª StreamingListenerï¼Œå…¶ç›‘å¬æ‰€æœ‰ä½œä¸šçš„ onBatchCompleted äº‹ä»¶ï¼Œå¹¶ä¸”åŸºäº processingDelay ã€schedulingDelay ã€å½“å‰ Batch å¤„ç†çš„è®°å½•æ¡æ•°ä»¥åŠå¤„ç†å®Œæˆäº‹ä»¶æ¥ä¼°ç®—å‡ºä¸€ä¸ªé€Ÿç‡ï¼›è¿™ä¸ªé€Ÿç‡ä¸»è¦ç”¨äºæ›´æ–°æµæ¯ç§’èƒ½å¤Ÿå¤„ç†çš„æœ€å¤§è®°å½•çš„æ¡æ•°ã€‚è¿™æ ·å°±å¯ä»¥å®ç°å¤„ç†èƒ½åŠ›å¥½çš„è¯å°±ä¼šæœ‰ä¸€ä¸ªè¾ƒå¤§çš„æœ€å¤§å€¼ï¼Œå¤„ç†èƒ½åŠ›ä¸‹é™äº†å°±ä¼šç”Ÿæˆä¸€ä¸ªè¾ƒå°çš„æœ€å¤§å€¼ã€‚æ¥ä¿è¯Spark Streamingæµç•…è¿è¡Œã€‚pidé€Ÿç‡è®¡ç®—æºç **æ¯ä¸€ä¸ªBatchå¤„ç†å®Œæˆåéƒ½ä¼šè°ƒç”¨æ­¤æ–¹æ³•1234567891011121314override def onBatchCompleted(batchCompleted: StreamingListenerBatchCompleted) &#123; val elements = batchCompleted.batchInfo.streamIdToInputInfo for &#123; // å¤„ç†ç»“æŸæ—¶é—´ processingEnd &lt;- batchCompleted.batchInfo.processingEndTime // å¤„ç†æ—¶é—´,å³`processingEndTime` - `processingStartTime` workDelay &lt;- batchCompleted.batchInfo.processingDelay // åœ¨è°ƒåº¦é˜Ÿåˆ—ä¸­çš„ç­‰å¾…æ—¶é—´,å³`processingStartTime` - `submissionTime` waitDelay &lt;- batchCompleted.batchInfo.schedulingDelay // å½“å‰æ‰¹æ¬¡å¤„ç†çš„è®°å½•æ•° elems &lt;- elements.get(streamUID).map(_.numRecords) &#125; computeAndPublish(processingEnd, elems, workDelay, waitDelay) &#125;æ¥ç€åˆè°ƒç”¨çš„æ˜¯computeAndPublishæ–¹æ³•1234567891011private def computeAndPublish(time: Long, elems: Long, workDelay: Long, waitDelay: Long): Unit = Future[Unit] &#123; // æ ¹æ®å¤„ç†æ—¶é—´ã€è°ƒåº¦æ—¶é—´ã€å½“å‰Batchè®°å½•æ•°ï¼Œé¢„ä¼°æ–°é€Ÿç‡ val newRate = rateEstimator.compute(time, elems, workDelay, waitDelay) newRate.foreach &#123; s =&gt; // è®¾ç½®æ–°é€Ÿç‡ rateLimit.set(s.toLong) // å‘å¸ƒæ–°é€Ÿç‡ publish(getLatestRate()) &#125; &#125;æ›´æ·±ä¸€å±‚ï¼Œå…·ä½“è°ƒç”¨çš„æ˜¯rateEstimator.computeæ–¹æ³•æ¥é¢„ä¼°æ–°é€Ÿç‡ï¼Œå¦‚ä¸‹:12345def compute( time: Long, elements: Long, processingDelay: Long, schedulingDelay: Long): Option[Double]è¯¥æ–¹æ³•æ˜¯æ¥å£RateEstimatorä¸­çš„æ–¹æ³•ï¼Œä¼šè®¡ç®—å‡ºæ–°çš„æ‰¹æ¬¡æ¯ç§’åº”æ‘„å…¥çš„è®°å½•æ•°ã€‚PIDRateEstimatorï¼Œå³PIDé€Ÿç‡ä¼°ç®—å™¨,æ˜¯RateEstimatorçš„å”¯ä¸€å®ç°,å…·ä½“ä¼°ç®—é€»è¾‘å¯çœ‹PIDRateEstimator.computeæ–¹æ³•ï¼Œé€»è¾‘å¾ˆå¤æ‚ï¼Œç”¨åˆ°äº†å¾®ç§¯åˆ†ç›¸å…³çš„çŸ¥è¯†ï¼Œæ€»ä¹‹ï¼Œä¸€å¥è¯ï¼Œå³æ ¹æ®å½“å‰Batchçš„ç»“æœå’ŒæœŸæœ›çš„å·®å€¼æ¥ä¼°ç®—æ–°çš„è¾“å…¥é€Ÿç‡ã€‚é…ç½®Spark Streamingçš„back pressurespark.streaming.backpressure.initialRateï¼š å¯ç”¨åå‹æœºåˆ¶æ—¶æ¯ä¸ªæ¥æ”¶å™¨æ¥æ”¶ç¬¬ä¸€æ‰¹æ•°æ®çš„åˆå§‹æœ€å¤§é€Ÿç‡ã€‚é»˜è®¤å€¼æ²¡æœ‰è®¾ç½®ã€‚spark.streaming.backpressure.rateEstimatorï¼šé€Ÿç‡ä¼°ç®—å™¨ç±»ï¼Œé»˜è®¤å€¼ä¸º pid ï¼Œç›®å‰ Spark åªæ”¯æŒè¿™ä¸ªï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦å®ç°ã€‚spark.streaming.backpressure.pid.proportionalï¼šç”¨äºå“åº”é”™è¯¯çš„æƒé‡ï¼ˆæœ€åæ‰¹æ¬¡å’Œå½“å‰æ‰¹æ¬¡ä¹‹é—´çš„æ›´æ”¹ï¼‰ã€‚é»˜è®¤å€¼ä¸º1ï¼Œåªèƒ½è®¾ç½®æˆéè´Ÿå€¼ã€‚weight for response to â€œerrorâ€ (change between last batch and this batch)spark.streaming.backpressure.pid.integralï¼šé”™è¯¯ç§¯ç´¯çš„å“åº”æƒé‡ï¼Œå…·æœ‰æŠ‘åˆ¶ä½œç”¨ï¼ˆæœ‰æ•ˆé˜»å°¼ï¼‰ã€‚é»˜è®¤å€¼ä¸º 0.2 ï¼Œåªèƒ½è®¾ç½®æˆéè´Ÿå€¼ã€‚weight for the response to the accumulation of error. This has a dampening effect.spark.streaming.backpressure.pid.derivedï¼šå¯¹é”™è¯¯è¶‹åŠ¿çš„å“åº”æƒé‡ã€‚ è¿™å¯èƒ½ä¼šå¼•èµ· batch size çš„æ³¢åŠ¨ï¼Œå¯ä»¥å¸®åŠ©å¿«é€Ÿå¢åŠ /å‡å°‘å®¹é‡ã€‚é»˜è®¤å€¼ä¸º0ï¼Œåªèƒ½è®¾ç½®æˆéè´Ÿå€¼ã€‚weight for the response to the trend in error. This can cause arbitrary/noise-induced fluctuations in batch size, but can also help react quickly to increased/reduced capacity.spark.streaming.backpressure.pid.minRateï¼šå¯ä»¥ä¼°ç®—çš„æœ€ä½è´¹ç‡æ˜¯å¤šå°‘ã€‚é»˜è®¤å€¼ä¸º 100ï¼Œåªèƒ½è®¾ç½®æˆéè´Ÿå€¼ã€‚Flink BackPressureå¦‚æœä½ çœ‹åˆ°ä¸€ä¸ªtaskçš„back pressureå‘Šè­¦ï¼ˆæ¯”å¦‚ï¼Œhighï¼‰ï¼Œè¿™æ„å‘³ç€ç”Ÿäº§æ•°æ®æ¯”ä¸‹æ¸¸æ“ä½œç®—å­æ¶ˆè´¹çš„é€Ÿåº¦å¿«ã€‚Recordçš„åœ¨ä½ å·¥ä½œæµçš„ä¼ è¾“æ–¹å‘æ˜¯å‘ä¸‹æ¸¸ï¼Œæ¯”å¦‚ä»sourceåˆ°sinkï¼Œè€Œback pressureæ­£å¥½æ˜¯æ²¿ç€åæ–¹å‘ï¼Œå¾€ä¸Šæ¸¸ä¼ æ’­ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¸€ä¸ªå·¥ä½œæµï¼Œåªæœ‰sourceåˆ°sinkä¸¤ä¸ªæ­¥éª¤ã€‚å‡å¦‚ä½ çœ‹åˆ°sourceç«¯æœ‰ä¸ªå‘Šè­¦ï¼Œè¿™æ„å‘³ç€sinkæ¶ˆè´¹æ•°æ®é€Ÿç‡æ…¢äºç”Ÿäº§è€…çš„ç”Ÿäº§æ•°æ®é€Ÿç‡ã€‚Sinkæ­£åœ¨å‘ä¸Šæ¸¸è¿›è¡Œback pressureã€‚é‡‡æ ·çº¿ç¨‹Back Pressureï¼ˆåé¢ç¿»è¯‘æˆèƒŒå‹ï¼‰æ˜¯é€šè¿‡é‡å¤é‡‡æ ·æ­£åœ¨è¿è¡Œçš„tasksçš„tack traceæ ·æœ¬æ•°æ®æ¥ç›‘æ§ä»»åŠ¡çš„ã€‚JobManagerä¼šé’ˆå¯¹ä½ çš„jobçš„tasksé‡å¤è§¦å‘è°ƒç”¨Thread.getStackTrace()ã€‚å¦‚æœæ ·æœ¬æ•°æ®æ˜¾ç¤ºä»»åŠ¡çº¿ç¨‹å¡åœ¨æŸä¸ªå†…éƒ¨æ–¹æ³•è°ƒç”¨ä¸­ï¼ˆä»ç½‘ç»œå †æ ˆè¯·æ±‚ç¼“å†²åŒºï¼‰ï¼Œåˆ™è¡¨ç¤ºè¯¥ä»»åŠ¡å­˜åœ¨èƒŒå‹ã€‚é»˜è®¤æƒ…å†µï¼Œä¸ºäº†åˆ¤æ–­æ˜¯å¦è¿›è¡ŒèƒŒå‹ï¼Œjobmanagerä¼šæ¯50msè§¦å‘100æ¬¡stack tracesã€‚Webç•Œé¢ä¸­æ˜¾ç¤ºçš„æ¯”ç‡ï¼Œå‘Šè¯‰ä½ åœ¨è¿™äº›stack tracesä¸­ï¼Œé˜»å¡åœ¨å†…éƒ¨æ–¹æ³•è°ƒç”¨çš„stack traceså æ‰€æœ‰çš„ç™¾åˆ†æ¯”ï¼Œä¾‹å¦‚ï¼Œ0.01ï¼Œä»£è¡¨ç€100æ¬¡ä¸­æœ‰ä¸€æ¬¡é˜»å¡åœ¨å†…éƒ¨è°ƒç”¨ã€‚â€¢ **OK: 0 &lt;= Ratio &lt;= 0.10â€¢ LOW: 0.10 &lt; Ratio &lt;= 0.5â€¢ HIGH: 0.5 &lt; Ratio &lt;= 1ä¸ºä¾‹é¿å…stack traceé‡‡æ ·å¯¼è‡´task managerså‹åŠ›è¿‡å¤§ï¼Œweb ç•Œé¢ä»…ä»…åœ¨60såˆ·æ–°ä¸€æ¬¡ã€‚é…ç½®å¯ä»¥é€šè¿‡ä¸‹é¢çš„å±æ€§è¿›è¡Œé…ç½®1ï¼Œ jobmanager.web.backpressure.refresh-interval:åœ¨è¿™ä¸ªæ—¶é—´ä¹‹åï¼Œç»Ÿè®¡æ•°æ®å°†ä¼šåºŸå¼ƒï¼Œéœ€è¦é‡æ–°åˆ·æ–°ã€‚é»˜è®¤æ˜¯60000ï¼Œä¹Ÿå³æ˜¯1minã€‚2ï¼Œ jobmanager.web.backpressure.num-samples:åˆ¤æ–­èƒŒå‹éœ€è¦è¿›è¡Œstack traceé‡‡æ ·çš„ä¸ªæ•°ï¼Œé»˜è®¤æ˜¯1003ï¼Œ jobmanager.web.backpressure.delay-between-samples:ä¸¤æ¬¡stack traceä¸ªé‡‡ç”¨é—´éš”ã€‚ä¾‹å­åœ¨flinkçš„webui çš„jobç•Œé¢ä¸­å¯ä»¥çœ‹åˆ°èƒŒå‹ã€‚ä¸‹å›¾ä¸­çº¢è‰²çš„Sampling in progressâ€¦, è¿™æ„å‘³ç€JobManagerå¯¹æ­£åœ¨è¿è¡Œçš„tasksè§¦å‘stack traceé‡‡æ ·ã€‚é»˜è®¤é…ç½®ï¼Œè¿™å°†ä¼šèŠ±è´¹äº”ç§’é’Ÿå®Œæˆã€‚ç‚¹å‡»ä¹‹åï¼Œå°±è§¦å‘äº†è¯¥æ“ä½œç®—å­æ‰€æœ‰taskçš„é‡‡æ ·ã€‚èƒŒå‹çŠ¶æ€å¦‚æœæ‚¨çœ‹åˆ°ä»»åŠ¡çš„çŠ¶æ€okï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰èƒŒå‹æŒ‡ç¤ºã€‚å¦ä¸€æ–¹é¢ï¼ŒHIGHæ„å‘³ç€ä»»åŠ¡è¢«åŠ å‹ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Flink apply()&process() è®²è§£","slug":"Flink-apply-process-è®²è§£","date":"2019-03-02T17:01:15.000Z","updated":"2020-06-03T01:19:30.498Z","comments":true,"path":"2019/03/03/Flink-apply-process-è®²è§£/","link":"","permalink":"cpeixin.cn/2019/03/03/Flink-apply-process-%E8%AE%B2%E8%A7%A3/","excerpt":"","text":"åœ¨å¤„ç†æµæ•°æ®è®¡ç®—æ—¶ï¼Œæˆ‘ä»¬åœ¨å¯¹æµæ•°æ®ä½¿ç”¨äº†keyby()å’Œwindow()åï¼Œéœ€è¦å¯¹åˆ†ç»„åçš„æ•°æ®åšåˆ†ç»„å¤„ç†ï¼Œé‚£ä¹ˆé™¤äº†å¯¹åˆ†ç»„æ•°æ®ç›´æ¥åšreduce()ï¼Œaggregate()ç­‰èšåˆæ“ä½œä¹‹å¤–ï¼Œè¿˜æœ‰å¦ä¸€ç§åœºæ™¯å°±æ˜¯å¯¹åˆ†ç»„åçš„æ•°æ®ï¼Œæ¯ä¸€ä¸ªkeyå¯¹åº”çš„Iterableåšç¨å¾®å¤æ‚ä¸€ç‚¹çš„æ•°æ®è®¡ç®—æˆ–è€…æ•°æ®çš„æ•´åˆæˆ–è€…å˜æ¢ã€‚é‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨apply()æˆ–è€…process()æ¥å®ç°æ›´åº•å±‚çš„è®¡ç®—é€»è¾‘ã€‚é‚£ä¹ˆä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸¤è€…çš„æºç ï¼šä»ä¸Šé¢çš„å›¾ç‰‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªæ–¹æ³•çš„æ³¨é‡Šå±…ç„¶æ˜¯ä¸€æ ·çš„ã€‚å†…éƒ¨çš„å®ç°åˆ™ä¸åŒï¼Œåˆ†åˆ«è°ƒç”¨äº†ScalaProcessWindowFunctionWrapperå’ŒScalaWindowFunctionWrapperæˆ‘ä»¬æ¥çœ‹ScalaProcessWindowFunctionWrapperï¼Œå†…éƒ¨å®ç°çš„processä¸­ï¼Œä¼ å…¥äº†contextä¸Šä¸‹æ–‡ï¼Œè¿˜æœ‰å…¶ä»–windowç›¸å…³æœ‰ç”¨çš„å‚æ•°ï¼Œä»åŠŸèƒ½ä¸Šæ¥è®²ï¼Œprocesså·²ç»åŒ…å«äº†applyèƒ½æä¾›çš„åŠŸèƒ½ï¼Œapply()æ˜¯æ—§ç‰ˆçš„process()ï¼Œå¹¶ä¸”æ²¡æœ‰æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯å’Œå…¶ä»–windowçš„é«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚æ¯ä¸ªçª—å£çš„keyed stateã€‚apply()å°†åœ¨æŸä¸ªæ—¶é—´è¢«å¼ƒç”¨ã€‚processç®—å­å¸¸è§çš„æœ‰ProcessFunctionå’ŒKeyedProcessFunctionä¸¤ç§è®¡ç®—çš„æ–¹å¼ï¼Œå…·ä½“çš„å®ç°å¯ä»¥çœ‹æºç ã€‚processå’Œapplyç®—å­æœ€å¤§çš„åŒºåˆ«åœ¨äºprocesså¯ä»¥è‡ªå·±å®šæ—¶è§¦å‘è®¡ç®—çš„å®šæ—¶å™¨,åœ¨processElementæ–¹æ³•å®šä¹‰å®šæ—¶å™¨ context.timerService().registerEventTimeTimer(timestamp);å½“å®šæ—¶å™¨æ—¶é—´åˆ°è¾¾ï¼Œä¼šå›è°ƒonTimer()æ–¹æ³•çš„è®¡ç®—ä»»åŠ¡æ—¶å™¨å…è®¸åº”ç”¨ç¨‹åºå¯¹processing timeå’Œevent timeçš„å˜åŒ–åšå‡ºååº”ï¼Œæ¯æ¬¡å¯¹processElement()çš„è°ƒç”¨éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªContextå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å…è®¸è®¿é—®å…ƒç´ äº‹ä»¶æ—¶é—´çš„æ—¶é—´æˆ³å’ŒTimeServerã€‚TimeServerå¯ä»¥ç”¨æ¥ä¸ºå°šæœªå‘ç”Ÿçš„event-timeæˆ–è€…processing-timeæ³¨å†Œå›è°ƒï¼Œå½“å®šæ—¶å™¨çš„æ—¶é—´åˆ°è¾¾æ—¶ï¼ŒonTimer(â€¦)æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚åœ¨è¿™ä¸ªè°ƒç”¨æœŸé—´ï¼Œæ‰€æœ‰çš„çŠ¶æ€éƒ½ä¼šé™å®šåˆ°åˆ›å»ºå®šæ—¶å™¨çš„é”®ï¼Œå¹¶å…è®¸å®šæ—¶å™¨æ“çºµé”®æ§çŠ¶æ€(keyed states)ã€‚applyç®—å­å’Œprocessç®—å­**(1) windowæ•°æ®applyç®—å­å¯¹åº”çš„fuctionWindowFunction(keyed window) ä¸ AllWindowFunction(no key window)(2) windowæ•°æ®processç®—å­å¯¹åº”çš„fuctionprocessç®—å­å¯ä»¥è·å–åˆ°windowçª—å£çš„Contextä¿¡æ¯ è€Œ applyç®—å­æ— æ³•è·å–åˆ°ProcessWindowFunction(keyed-window) å’Œ ProcessAllWindowFunction(no keyd window)keyed-window å’Œ nokeyed-window(3) æ™®é€šæµæ•°æ®ï¼Œprocessç®—å­,å¯¹åº”çš„fuctionKeyedProcessFunctionï¼š A keyed function that processes elements of a stream. ï¼ˆå¯å®ç°å®šæ—¶ä»»åŠ¡ï¼‰ProcessFunctionï¼šA function that processes elements of a stream.ï¼ˆå¯å®ç°å®šæ—¶ä»»åŠ¡ï¼‰ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªå°å®ä¾‹æ¥æ¼”ç¤ºä¸¤ç§æ–¹æ³•çš„ä½¿ç”¨éœ€æ±‚ï¼šæ±‚æ¯ä¸ªuserï¼Œå‘¨ä¸€è‡³å‘¨æ—¥ï¼Œæ¯å¤©æˆç»©çš„æ’åºè¯¦æƒ…æ•°æ®æ ¼å¼ï¼šuser001,1,95ï¼ˆç”¨æˆ·IDï¼Œæ˜ŸæœŸå‡ ï¼Œæˆç»©ï¼‰ç¨‹åºå¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970package data_stream.functionimport org.apache.flink.streaming.api.scala.function.&#123;ProcessWindowFunction, WindowFunction&#125;import org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment, WindowedStream&#125;import org.apache.flink.streaming.api.windowing.time.Timeimport org.apache.flink.streaming.api.windowing.windows.TimeWindowimport org.apache.flink.streaming.api.scala._import org.apache.flink.util.Collectorimport scala.collection.mutable.ListBufferimport scala.collection.parallel.immutableobject keyby_datastream &#123; case class UserGrade(user_id: String, weekday: String, grade: Int) case class UserGradeList(user_id: String, gradeList: List[Int]) def main(args: Array[String]): Unit = &#123; val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment val socketStream: DataStream[String] = env.socketTextStream(\"localhost\", 8888) val userGradeStream: DataStream[UserGrade] = socketStream.map((data: String) =&gt; &#123; val user_array: Array[String] = data.split(\",\") UserGrade(user_array(0), user_array(1), user_array(2).toInt) &#125;) val keyWondowStream: WindowedStream[UserGrade, String, TimeWindow] = userGradeStream.keyBy((_: UserGrade).user_id) .timeWindow(Time.seconds(5)) // Base interface for functions that are evaluated over keyed (grouped) windows. // trait WindowFunction[IN, OUT, KEY, W &lt;: Window] extends Function with Serializable// val resultStream: DataStream[(String, List[Int])] = keyWondowStream.apply(new WindowFunction[UserGrade, (String, List[Int]), String, TimeWindow] &#123;// override def apply(key: String, window: TimeWindow, input: Iterable[UserGrade], out: Collector[(String, List[Int])]): Unit = &#123;// var gradeList: ListBuffer[Int] = ListBuffer[Int]()// for (data &lt;- input) &#123;// gradeList += data.grade// &#125;// out.collect((key,gradeList.toList.sorted))// &#125;// &#125;)// val resultStream: DataStream[String] = keyWondowStream.apply(new WindowFunction[UserGrade, String, String, TimeWindow] &#123;// override def apply(key: String, window: TimeWindow, input: Iterable[UserGrade], out: Collector[String]): Unit = &#123;// var gradeList: ListBuffer[Int] = ListBuffer[Int]()// for (data &lt;- input)&#123;// gradeList+=data.grade// &#125;// val result: String = key + \"===\" + gradeList.toList.sorted.toString// out.collect(result)// &#125;// &#125;) val resultStream: DataStream[UserGradeList] = keyWondowStream.process(new ProcessWindowFunction[UserGrade, UserGradeList, String, TimeWindow]&#123; override def process(key: String, context: Context, elements: Iterable[UserGrade], out: Collector[UserGradeList]): Unit = &#123; var gradeList: ListBuffer[Int] = ListBuffer[Int]() for (data &lt;- elements) &#123; gradeList += data.grade &#125; out.collect(UserGradeList(key,gradeList.toList.sorted)) &#125; &#125;) resultStream.print(\"===\") env.execute(\"process apply function\") &#125;&#125;æ§åˆ¶å°è¾“å…¥ï¼š1234567891011121314user001,1,95user001,2,200user001,3,97user001,4,189user001,5,99user001,6,100user001,7,40user002,1,1user002,2,5user002,3,2user002,4,88user002,5,4user002,6,33user002,7,22ç»“æœæ‰“å°ï¼š12&#x3D;&#x3D;&#x3D;:3&gt; UserGradeList(user001,List(40, 95, 97, 99, 100, 189, 200))&#x3D;&#x3D;&#x3D;:2&gt; UserGradeList(user002,List(1, 2, 4, 5, 22, 33, 88))è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œæˆ‘åœ¨ç¨‹åºä¸­ä½¿ç”¨äº†scalaå¯å˜é›†åˆListBufferï¼Œç¨‹åºæ‰§è¡Œåï¼Œåˆ™æŠ¥é”™Caused by: java.lang.NumberFormatException: Not a version: 9åæ¥Googleå¾—åˆ°ï¼Œè¿™æ˜¯Flinkç‰ˆæœ¬å’ŒScalaç‰ˆæœ¬ä¹‹é—´å¼•èµ·çš„é”™è¯¯ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼ŒåŸæ¥çš„ç‰ˆæœ¬å¯¹åº”æ˜¯Flink 1.10å’ŒScala 2.11.8ï¼Œåæ¥Scalaç‰ˆæœ¬ä¿®æ”¹ä¸º2.11.12ï¼Œè¿™ä¸ªé—®é¢˜å°±è§£å†³äº†ã€‚**","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Spark OOMè§£å†³æ–¹æ¡ˆ","slug":"Spark-OOMè§£å†³æ–¹æ¡ˆ","date":"2019-02-27T11:16:38.000Z","updated":"2020-06-28T11:18:37.972Z","comments":true,"path":"2019/02/27/Spark-OOMè§£å†³æ–¹æ¡ˆ/","link":"","permalink":"cpeixin.cn/2019/02/27/Spark-OOM%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/","excerpt":"","text":"OOMåœºæ™¯Sparkä¸­çš„OOMé—®é¢˜ä¸å¤–ä¹ä»¥ä¸‹ä¸¤ç§æƒ…å†µDriver å†…å­˜ä¸å¤Ÿè¯»å–æ•°æ®å¤ªå¤§æ•°æ®å›ä¼ Executor å†…å­˜ä¸å¤Ÿmapæ‰§è¡Œä¸­å†…å­˜æº¢å‡ºshuffleåå†…å­˜æº¢å‡ºmapæ‰§è¡Œä¸­å†…å­˜æº¢å‡ºä»£è¡¨äº†æ‰€æœ‰mapç±»å‹çš„æ“ä½œï¼ŒåŒ…æ‹¬ï¼šflatMapï¼Œfilterï¼ŒmapPatitionsç­‰ã€‚shuffleåå†…å­˜æº¢å‡ºçš„shuffleæ“ä½œåŒ…æ‹¬joinï¼ŒreduceByKeyï¼Œrepartitionç­‰æ“ä½œã€‚å¯¹äºDriveç«¯çš„å†…å­˜æº¢å‡ºï¼Œæˆ‘ä»¬è¦è°¨æ…ä½¿ç”¨collectç­‰æ“ä½œï¼Œå°†æ‰€æœ‰executorçš„æ•°æ®èšåˆåˆ°driverå¯¼è‡´ã€‚å°½é‡ä¸è¦ä½¿ç”¨collectæ“ä½œå³å¯ã€‚Spark å†…å­˜æ¨¡å‹Sparkåœ¨ä¸€ä¸ªExecutorä¸­çš„å†…å­˜åˆ†ä¸ºä¸‰å—ï¼Œä¸€å—æ˜¯executionå†…å­˜ï¼Œä¸€å—æ˜¯storageå†…å­˜ï¼Œä¸€å—æ˜¯otherå†…å­˜ã€‚executionå†…å­˜æ˜¯æ‰§è¡Œå†…å­˜ï¼Œä¸»è¦ç”¨äºå­˜æ”¾ Shuffleã€Joinã€Sortã€Aggregation ç­‰è®¡ç®—è¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ•°æ®ï¼Œæ»¡äº†å†å†™å…¥ç£ç›˜ï¼Œèƒ½å¤Ÿå‡å°‘IOã€‚å…¶å®mapè¿‡ç¨‹ä¹Ÿæ˜¯åœ¨è¿™ä¸ªå†…å­˜ä¸­æ‰§è¡Œçš„ã€‚storageå†…å­˜ä¸»è¦ç”¨äºå­˜å‚¨ spark çš„ cache æ•°æ®ï¼Œä¾‹å¦‚RDDçš„ç¼“å­˜ã€unrollæ•°æ®ï¼›otherå†…å­˜æ˜¯ç¨‹åºæ‰§è¡Œæ—¶é¢„ç•™ç»™è‡ªå·±çš„å†…å­˜ã€‚executionå’Œstorageæ˜¯Spark Executorä¸­å†…å­˜çš„å¤§æˆ·ï¼Œå åˆ°äº†å †å†…å†…å­˜çš„60%ï¼Œotherå ç”¨å†…å­˜ç›¸å¯¹å°‘å¾ˆå¤šï¼Œè¿™é‡Œå°±ä¸è¯´äº†ã€‚åœ¨spark-1.6.0ä»¥å‰çš„ç‰ˆæœ¬ï¼Œexecutionå’Œstorageçš„å†…å­˜åˆ†é…æ˜¯å›ºå®šçš„ï¼Œä½¿ç”¨çš„å‚æ•°é…ç½®åˆ†åˆ«æ˜¯spark.shuffle.memoryFractionï¼ˆexecutionå†…å­˜å Executoræ€»å†…å­˜å¤§å°ï¼Œdefault 0.2ï¼‰å’Œspark.storage.memoryFractionï¼ˆstorageå†…å­˜å Executorå†…å­˜å¤§å°ï¼Œdefault 0.6ï¼‰ï¼Œå› ä¸ºæ˜¯1.6.0ä»¥å‰è¿™ä¸¤å—å†…å­˜æ˜¯äº’ç›¸éš”ç¦»çš„ï¼Œè¿™å°±å¯¼è‡´äº†Executorçš„å†…å­˜åˆ©ç”¨ç‡ä¸é«˜ï¼Œè€Œä¸”éœ€è¦æ ¹æ®Applicationçš„å…·ä½“æƒ…å†µï¼Œä½¿ç”¨è€…è‡ªå·±æ¥è°ƒèŠ‚è¿™ä¸¤ä¸ªå‚æ•°æ‰èƒ½ä¼˜åŒ–Sparkçš„å†…å­˜ä½¿ç”¨ã€‚åœ¨spark-1.6.0ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œexecutionå†…å­˜å’Œstorageå†…å­˜å¯ä»¥ç›¸äº’å€Ÿç”¨ï¼Œæé«˜äº†å†…å­˜çš„Sparkä¸­å†…å­˜çš„ä½¿ç”¨ç‡ï¼ŒåŒæ—¶ä¹Ÿå‡å°‘äº†OOMçš„æƒ…å†µã€‚åœ¨Spark-1.6.0ååŠ å…¥äº†å †å¤–å†…å­˜ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–äº†Sparkçš„å†…å­˜ä½¿ç”¨ï¼Œå †å¤–å†…å­˜ä½¿ç”¨JVMå †ä»¥å¤–çš„å†…å­˜ï¼Œä¸ä¼šè¢«gcå›æ”¶ï¼Œå¯ä»¥å‡å°‘é¢‘ç¹çš„full gcï¼Œæ‰€ä»¥åœ¨Sparkç¨‹åºä¸­ï¼Œä¼šé•¿æ—¶é—´é€—ç•™å†Sparkç¨‹åºä¸­çš„å¤§å†…å­˜å¯¹è±¡å¯ä»¥ä½¿ç”¨å †å¤–å†…å­˜å­˜å‚¨ã€‚ä½¿ç”¨å †å¤–å†…å­˜æœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€ç§æ˜¯åœ¨rddè°ƒç”¨persistçš„æ—¶å€™ä¼ å…¥å‚æ•°StorageLevel.OFF_HEAPï¼Œè¿™ç§ä½¿ç”¨æ–¹å¼éœ€è¦é…åˆTachyonä¸€èµ·ä½¿ç”¨ã€‚å¦å¤–ä¸€ç§æ˜¯ä½¿ç”¨Sparkè‡ªå¸¦çš„spark.memory.offHeap.enabled é…ç½®ä¸ºtrueè¿›è¡Œä½¿ç”¨OOMçš„é—®é¢˜é€šå¸¸å‡ºç°åœ¨executionè¿™å—å†…å­˜ä¸­ï¼Œå› ä¸ºstorageè¿™å—å†…å­˜åœ¨å­˜æ”¾æ•°æ®æ»¡äº†ä¹‹åï¼Œä¼šç›´æ¥ä¸¢å¼ƒå†…å­˜ä¸­æ—§çš„æ•°æ®ï¼Œå¯¹æ€§èƒ½æœ‰å½±å“ä½†æ˜¯ä¸ä¼šæœ‰OOMçš„é—®é¢˜ã€‚å†…å­˜æº¢å‡ºè§£å†³æ–¹æ³•mapè¿‡ç¨‹äº§ç”Ÿå¤§é‡å¯¹è±¡å¯¼è‡´å†…å­˜æº¢å‡ºè¿™ç§æº¢å‡ºçš„åŸå› æ˜¯åœ¨å•ä¸ªmapä¸­äº§ç”Ÿäº†å¤§é‡çš„å¯¹è±¡å¯¼è‡´çš„ï¼Œä¾‹å¦‚ï¼š1rdd.map(x=&gt;for(i &lt;- 1 to 10000) yield i.toString)è¿™ä¸ªæ“ä½œåœ¨rddä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½äº§ç”Ÿäº†10000ä¸ªå¯¹è±¡ï¼Œè¿™è‚¯å®šå¾ˆå®¹æ˜“äº§ç”Ÿå†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚é’ˆå¯¹è¿™ç§é—®é¢˜ï¼Œåœ¨ä¸å¢åŠ å†…å­˜çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡å‡å°‘æ¯ä¸ªTaskçš„å¤§å°ï¼Œä»¥ä¾¿è¾¾åˆ°æ¯ä¸ªTaskå³ä½¿äº§ç”Ÿå¤§é‡çš„å¯¹è±¡Executorçš„å†…å­˜ä¹Ÿèƒ½å¤Ÿè£…å¾—ä¸‹ã€‚å…·ä½“åšæ³•å¯ä»¥åœ¨ä¼šäº§ç”Ÿå¤§é‡å¯¹è±¡çš„mapæ“ä½œä¹‹å‰è°ƒç”¨repartitionæ–¹æ³•ï¼Œåˆ†åŒºæˆæ›´å°çš„å—ä¼ å…¥mapã€‚ä¾‹å¦‚ï¼š1rdd.repartition(10000).map(x=&gt;for(i &lt;- 1 to 10000) yield i.toString)é¢å¯¹è¿™ç§é—®é¢˜æ³¨æ„ï¼Œä¸èƒ½ä½¿ç”¨rdd.coalesceæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åªèƒ½å‡å°‘åˆ†åŒºï¼Œä¸èƒ½å¢åŠ åˆ†åŒºï¼Œä¸ä¼šæœ‰shuffleçš„è¿‡ç¨‹ã€‚æ•°æ®ä¸å¹³è¡¡å¯¼è‡´å†…å­˜æº¢å‡ºæ•°æ®ä¸å¹³è¡¡é™¤äº†æœ‰å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºå¤–ï¼Œä¹Ÿæœ‰å¯èƒ½å¯¼è‡´æ€§èƒ½çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ³•å’Œä¸Šé¢è¯´çš„ç±»ä¼¼ï¼Œå°±æ˜¯è°ƒç”¨repartitioné‡æ–°åˆ†åŒºã€‚coalesceè°ƒç”¨å¯¼è‡´å†…å­˜æº¢å‡ºè¿™æ˜¯æˆ‘æœ€è¿‘æ‰é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºhdfsä¸­ä¸é€‚åˆå­˜å°é—®é¢˜ï¼Œæ‰€ä»¥Sparkè®¡ç®—åå¦‚æœäº§ç”Ÿçš„æ–‡ä»¶å¤ªå°ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨coalesceåˆå¹¶æ–‡ä»¶å†å­˜å…¥hdfsä¸­ã€‚ä½†æ˜¯è¿™ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚åœ¨coalesceä¹‹å‰æœ‰100ä¸ªæ–‡ä»¶ï¼Œè¿™ä¹Ÿæ„å‘³ç€èƒ½å¤Ÿæœ‰100ä¸ªTaskï¼Œç°åœ¨è°ƒç”¨coalesce(10)ï¼Œæœ€ååªäº§ç”Ÿ10ä¸ªæ–‡ä»¶ï¼Œå› ä¸ºcoalesceå¹¶ä¸æ˜¯shuffleæ“ä½œï¼Œè¿™æ„å‘³ç€coalesceå¹¶ä¸æ˜¯æŒ‰ç…§æˆ‘åŸæœ¬æƒ³çš„é‚£æ ·å…ˆæ‰§è¡Œ100ä¸ªTaskï¼Œå†å°†Taskçš„æ‰§è¡Œç»“æœåˆå¹¶æˆ10ä¸ªï¼Œè€Œæ˜¯ä»å¤´åˆ°ä½åªæœ‰10ä¸ªTaskåœ¨æ‰§è¡Œï¼ŒåŸæœ¬100ä¸ªæ–‡ä»¶æ˜¯åˆ†å¼€æ‰§è¡Œçš„ï¼Œç°åœ¨æ¯ä¸ªTaskåŒæ—¶ä¸€æ¬¡è¯»å–10ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨çš„å†…å­˜æ˜¯åŸæ¥çš„10å€ï¼Œè¿™å¯¼è‡´äº†OOMã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯ä»¤ç¨‹åºæŒ‰ç…§æˆ‘ä»¬æƒ³çš„å…ˆæ‰§è¡Œ100ä¸ªTaskå†å°†ç»“æœåˆå¹¶æˆ10ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªé—®é¢˜åŒæ ·å¯ä»¥é€šè¿‡repartitionè§£å†³ï¼Œè°ƒç”¨repartition(10)ï¼Œå› ä¸ºè¿™å°±æœ‰ä¸€ä¸ªshuffleçš„è¿‡ç¨‹ï¼Œshuffleå‰åæ˜¯ä¸¤ä¸ªStageï¼Œä¸€ä¸ª100ä¸ªåˆ†åŒºï¼Œä¸€ä¸ªæ˜¯10ä¸ªåˆ†åŒºï¼Œå°±èƒ½æŒ‰ç…§æˆ‘ä»¬çš„æƒ³æ³•æ‰§è¡Œã€‚shuffleåå†…å­˜æº¢å‡ºshuffleå†…å­˜æº¢å‡ºçš„æƒ…å†µå¯ä»¥è¯´éƒ½æ˜¯shuffleåï¼Œå•ä¸ªæ–‡ä»¶è¿‡å¤§å¯¼è‡´çš„ã€‚åœ¨Sparkä¸­ï¼Œjoinï¼ŒreduceByKeyè¿™ä¸€ç±»å‹çš„è¿‡ç¨‹ï¼Œéƒ½ä¼šæœ‰shuffleçš„è¿‡ç¨‹ï¼Œåœ¨shuffleçš„ä½¿ç”¨ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªpartitionerï¼Œå¤§éƒ¨åˆ†Sparkä¸­çš„shuffleæ“ä½œï¼Œé»˜è®¤çš„partitioneréƒ½æ˜¯HashPatitionerï¼Œé»˜è®¤å€¼æ˜¯çˆ¶RDDä¸­æœ€å¤§çš„åˆ†åŒºæ•°,è¿™ä¸ªå‚æ•°é€šè¿‡spark.default.parallelismæ§åˆ¶(åœ¨spark-sqlä¸­ç”¨spark.sql.shuffle.partitions) ï¼Œ** spark.default.parallelismå‚æ•°åªå¯¹HashPartitioneræœ‰æ•ˆ**ï¼Œæ‰€ä»¥å¦‚æœæ˜¯åˆ«çš„Partitioneræˆ–è€…è‡ªå·±å®ç°çš„Partitionerå°±ä¸èƒ½ä½¿ç”¨spark.default.parallelismè¿™ä¸ªå‚æ•°æ¥æ§åˆ¶shuffleçš„å¹¶å‘é‡äº†ã€‚å¦‚æœæ˜¯åˆ«çš„partitionerå¯¼è‡´çš„shuffleå†…å­˜æº¢å‡ºï¼Œå°±éœ€è¦ä»partitionerçš„ä»£ç å¢åŠ partitionsçš„æ•°é‡ã€‚standaloneæ¨¡å¼ä¸‹èµ„æºåˆ†é…ä¸å‡åŒ€å¯¼è‡´å†…å­˜æº¢å‡ºåœ¨standaloneçš„æ¨¡å¼ä¸‹å¦‚æœé…ç½®äº†â€“total-executor-cores å’Œ â€“executor-memory è¿™ä¸¤ä¸ªå‚æ•°ï¼Œä½†æ˜¯æ²¡æœ‰é…ç½®â€“executor-coresè¿™ä¸ªå‚æ•°çš„è¯ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´ï¼Œæ¯ä¸ªExecutorçš„memoryæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯coresçš„æ•°é‡ä¸åŒï¼Œé‚£ä¹ˆåœ¨coresæ•°é‡å¤šçš„Executorä¸­ï¼Œç”±äºèƒ½å¤ŸåŒæ—¶æ‰§è¡Œå¤šä¸ªTaskï¼Œå°±å®¹æ˜“å¯¼è‡´å†…å­˜æº¢å‡ºçš„æƒ…å†µã€‚è¿™ç§æƒ…å†µçš„è§£å†³æ–¹æ³•å°±æ˜¯åŒæ—¶é…ç½®â€“executor-coresæˆ–è€…spark.executor.coreså‚æ•°ï¼Œç¡®ä¿Executorèµ„æºåˆ†é…å‡åŒ€ã€‚åœ¨RDDä¸­ï¼Œå…±ç”¨å¯¹è±¡èƒ½å¤Ÿå‡å°‘OOMçš„æƒ…å†µè¿™ä¸ªæ¯”è¾ƒç‰¹æ®Šï¼Œè¿™é‡Œè¯´è®°å½•ä¸€ä¸‹ï¼Œé‡åˆ°è¿‡ä¸€ç§æƒ…å†µï¼Œç±»ä¼¼è¿™æ ·rdd.flatMap(x=&gt;for(i &lt;- 1 to 1000) yield (â€œkeyâ€,â€valueâ€))å¯¼è‡´OOMï¼Œä½†æ˜¯åœ¨åŒæ ·çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨rdd.flatMap(x=&gt;for(i &lt;- 1 to 1000) yield â€œkeyâ€+â€valueâ€)å°±ä¸ä¼šæœ‰OOMçš„é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºæ¯æ¬¡(â€œkeyâ€,â€valueâ€)éƒ½äº§ç”Ÿä¸€ä¸ªTupleå¯¹è±¡ï¼Œè€Œâ€keyâ€+â€valueâ€ï¼Œä¸ç®¡å¤šå°‘ä¸ªï¼Œéƒ½åªæœ‰ä¸€ä¸ªå¯¹è±¡ï¼ŒæŒ‡å‘å¸¸é‡æ± ã€‚å…·ä½“æµ‹è¯•å¦‚ä¸‹ï¼šè¿™ä¸ªä¾‹å­è¯´æ˜(â€œkeyâ€,â€valueâ€)å’Œ(â€œkeyâ€,â€valueâ€)åœ¨å†…å­˜ä¸­æ˜¯å­˜åœ¨ä¸åŒä½ç½®çš„,ä¹Ÿå°±æ˜¯å­˜äº†ä¸¤ä»½,ä½†æ˜¯â€keyâ€+â€valueâ€è™½ç„¶å‡ºç°äº†ä¸¤æ¬¡,ä½†æ˜¯åªå­˜äº†ä¸€ä»½,åœ¨åŒä¸€ä¸ªåœ°å€,è¿™ç”¨åˆ°äº†JVMå¸¸é‡æ± çš„çŸ¥è¯†.äºæ˜¯ä¹,å¦‚æœRDDä¸­æœ‰å¤§é‡çš„é‡å¤æ•°æ®,æˆ–è€…Arrayä¸­éœ€è¦å­˜å¤§é‡é‡å¤æ•°æ®çš„æ—¶å€™æˆ‘ä»¬éƒ½å¯ä»¥å°†é‡å¤æ•°æ®è½¬åŒ–ä¸ºString,èƒ½å¤Ÿæœ‰æ•ˆçš„å‡å°‘å†…å­˜ä½¿ç”¨.ä»£ç å±‚é¢ä¼˜åŒ–ä½¿ç”¨mapPartitionsä»£æ›¿å¤§éƒ¨åˆ†mapæ“ä½œï¼Œæˆ–è€…è¿ç»­ä½¿ç”¨çš„mapæ“ä½œè¿™é‡Œéœ€è¦ç¨å¾®è®²ä¸€ä¸‹RDDå’ŒDataFrameçš„åŒºåˆ«ã€‚RDDå¼ºè°ƒçš„æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œæ¯ä¸ªRDDéƒ½æ˜¯ä¸å¯å˜çš„ï¼Œå½“è°ƒç”¨RDDçš„mapç±»å‹æ“ä½œçš„æ—¶å€™ï¼Œéƒ½æ˜¯äº§ç”Ÿä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™å°±å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœå¯¹ä¸€ä¸ªRDDè°ƒç”¨å¤§é‡çš„mapç±»å‹æ“ä½œçš„è¯ï¼Œæ¯ä¸ªmapæ“ä½œä¼šäº§ç”Ÿä¸€ä¸ªåˆ°å¤šä¸ªRDDå¯¹è±¡ï¼Œè¿™è™½ç„¶ä¸ä¸€å®šä¼šå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œä½†æ˜¯ä¼šäº§ç”Ÿå¤§é‡çš„ä¸­é—´æ•°æ®ï¼Œå¢åŠ äº†gcæ“ä½œã€‚å¦å¤–RDDåœ¨è°ƒç”¨actionæ“ä½œçš„æ—¶å€™ï¼Œä¼šå‡ºå‘Stageçš„åˆ’åˆ†ï¼Œä½†æ˜¯åœ¨æ¯ä¸ªStageå†…éƒ¨å¯ä¼˜åŒ–çš„éƒ¨åˆ†æ˜¯ä¸ä¼šè¿›è¡Œä¼˜åŒ–çš„ï¼Œä¾‹å¦‚rdd.map(+1).map(+1)ï¼Œè¿™ä¸ªæ“ä½œåœ¨æ•°å€¼å‹RDDä¸­æ˜¯ç­‰ä»·äºrdd.map(_+2)çš„ï¼Œä½†æ˜¯RDDå†…éƒ¨ä¸ä¼šå¯¹è¿™ä¸ªè¿‡ç¨‹è¿›è¡Œä¼˜åŒ–ã€‚DataFrameåˆ™ä¸åŒï¼ŒDataFrameç”±äºæœ‰ç±»å‹ä¿¡æ¯æ‰€ä»¥æ˜¯å¯å˜çš„ï¼Œå¹¶ä¸”åœ¨å¯ä»¥ä½¿ç”¨sqlçš„ç¨‹åºä¸­ï¼Œéƒ½æœ‰é™¤äº†è§£é‡Šå™¨å¤–ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªsqlä¼˜åŒ–å™¨ï¼ŒDataFrameä¹Ÿä¸ä¾‹å¤–ï¼Œæœ‰ä¸€ä¸ªä¼˜åŒ–å™¨Catalystä¸Šé¢è¯´åˆ°çš„è¿™äº›RDDçš„å¼Šç«¯ï¼Œæœ‰ä¸€éƒ¨åˆ†å°±å¯ä»¥ä½¿ç”¨mapPartitionsè¿›è¡Œä¼˜åŒ–ï¼ŒmapPartitionså¯ä»¥åŒæ—¶æ›¿ä»£rdd.map,rdd.filter,rdd.flatMapçš„ä½œç”¨ï¼Œæ‰€ä»¥åœ¨é•¿æ“ä½œä¸­ï¼Œå¯ä»¥åœ¨mapPartitonsä¸­å°†RDDå¤§é‡çš„æ“ä½œå†™åœ¨ä¸€èµ·ï¼Œé¿å…äº§ç”Ÿå¤§é‡çš„ä¸­é—´rddå¯¹è±¡ï¼Œå¦å¤–æ˜¯mapPartitionsåœ¨ä¸€ä¸ªpartitionä¸­å¯ä»¥å¤ç”¨å¯å˜ç±»å‹ï¼Œè¿™ä¹Ÿèƒ½å¤Ÿé¿å…é¢‘ç¹çš„åˆ›å»ºæ–°å¯¹è±¡ã€‚ä½¿ç”¨mapPartitionsçš„å¼Šç«¯å°±æ˜¯ç‰ºç‰²äº†ä»£ç çš„æ˜“è¯»æ€§ã€‚broadcast joinå’Œæ™®é€šjoinåœ¨å¤§æ•°æ®åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤§é‡æ•°æ®çš„ç§»åŠ¨å¯¹æ€§èƒ½çš„å½±å“ä¹Ÿæ˜¯å·¨å¤§çš„ã€‚åŸºäºè¿™ä¸ªæ€æƒ³ï¼Œåœ¨ä¸¤ä¸ªRDDè¿›è¡Œjoinæ“ä½œçš„æ—¶å€™ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªRDDç›¸å¯¹å°å¾ˆå¤šï¼Œå¯ä»¥å°†å°çš„RDDè¿›è¡Œcollectæ“ä½œç„¶åè®¾ç½®ä¸ºbroadcastå˜é‡ï¼Œè¿™æ ·åšä¹‹åï¼Œå¦ä¸€ä¸ªRDDå°±å¯ä»¥ä½¿ç”¨mapæ“ä½œè¿›è¡Œjoinï¼Œè¿™æ ·èƒ½å¤Ÿæœ‰æ•ˆçš„å‡å°‘ç›¸å¯¹å¤§å¾ˆå¤šçš„é‚£ä¸ªRDDçš„æ•°æ®ç§»åŠ¨ã€‚å…ˆfilteråœ¨joinè¿™ä¸ªå°±æ˜¯è°“è¯ä¸‹æ¨ï¼Œè¿™ä¸ªå¾ˆæ˜¾ç„¶ï¼Œfilterä¹‹åå†joinï¼Œshuffleçš„æ•°æ®é‡ä¼šå‡å°‘ï¼Œè¿™é‡Œæä¸€ç‚¹æ˜¯spark-sqlçš„ä¼˜åŒ–å™¨å·²ç»å¯¹è¿™éƒ¨åˆ†æœ‰ä¼˜åŒ–äº†ï¼Œä¸éœ€è¦ç”¨æˆ·æ˜¾ç¤ºçš„æ“ä½œï¼Œä¸ªäººå®ç°rddçš„è®¡ç®—çš„æ—¶å€™éœ€è¦æ³¨æ„è¿™ä¸ªã€‚partitonByä¼˜åŒ–combineByKeyçš„ä½¿ç”¨è¿™ä¸ªæ“ä½œåœ¨Map-Reduceä¸­ä¹Ÿæœ‰ï¼Œè¿™é‡Œä¸¾ä¸ªä¾‹å­ï¼šrdd.groupByKey().mapValue(_.sum)æ¯”rdd.reduceByKeyçš„æ•ˆç‡ä½ï¼ŒåŸå› å¦‚ä¸‹ä¸¤å¹…å›¾æ‰€ç¤º:ä¸Šä¸‹ä¸¤å¹…å›¾çš„åŒºåˆ«å°±æ˜¯ä¸Šé¢é‚£å¹…æœ‰combineByKeyçš„è¿‡ç¨‹å‡å°‘äº†shuffleçš„æ•°æ®é‡ï¼Œä¸‹é¢çš„æ²¡æœ‰ã€‚combineByKeyæ˜¯key-valueå‹rddè‡ªå¸¦çš„APIï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚åœ¨å†…å­˜ä¸è¶³çš„ä½¿ç”¨ï¼Œä½¿ç”¨rdd.persist(StorageLevel.MEMORY_AND_DISK_SER)ä»£æ›¿rdd.cache():rdd.cache()å’Œrdd.persist(Storage.MEMORY_ONLY)æ˜¯ç­‰ä»·çš„ï¼Œåœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™rdd.cache()çš„æ•°æ®ä¼šä¸¢å¤±ï¼Œå†æ¬¡ä½¿ç”¨çš„æ—¶å€™ä¼šé‡ç®—ï¼Œè€Œrdd.persist(StorageLevel.MEMORY_AND_DISK_SER)åœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™ä¼šå­˜å‚¨åœ¨ç£ç›˜ï¼Œé¿å…é‡ç®—ï¼Œåªæ˜¯æ¶ˆè€—ç‚¹IOæ—¶é—´ã€‚åœ¨sparkä½¿ç”¨hbaseçš„æ—¶å€™ï¼Œsparkå’Œhbaseæ­å»ºåœ¨åŒä¸€ä¸ªé›†ç¾¤åœ¨sparkç»“åˆhbaseçš„ä½¿ç”¨ä¸­ï¼Œsparkå’Œhbaseæœ€å¥½æ­å»ºåœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸Šä¸Šï¼Œæˆ–è€…sparkçš„é›†ç¾¤èŠ‚ç‚¹èƒ½å¤Ÿè¦†ç›–hbaseçš„æ‰€æœ‰èŠ‚ç‚¹ã€‚hbaseä¸­çš„æ•°æ®å­˜å‚¨åœ¨HFileä¸­ï¼Œé€šå¸¸å•ä¸ªHFileéƒ½ä¼šæ¯”è¾ƒå¤§ï¼Œå¦å¤–Sparkåœ¨è¯»å–Hbaseçš„æ•°æ®çš„æ—¶å€™ï¼Œä¸æ˜¯æŒ‰ç…§ä¸€ä¸ªHFileå¯¹åº”ä¸€ä¸ªRDDçš„åˆ†åŒºï¼Œè€Œæ˜¯ä¸€ä¸ªregionå¯¹åº”ä¸€ä¸ªRDDåˆ†åŒºã€‚æ‰€ä»¥åœ¨Sparkè¯»å–Hbaseçš„æ•°æ®æ—¶ï¼Œé€šå¸¸å•ä¸ªRDDéƒ½ä¼šæ¯”è¾ƒå¤§ï¼Œå¦‚æœä¸æ˜¯æ­å»ºåœ¨åŒä¸€ä¸ªé›†ç¾¤ï¼Œæ•°æ®ç§»åŠ¨ä¼šè€—è´¹å¾ˆå¤šçš„æ—¶é—´ã€‚å‚æ•°å±‚é¢ä¼˜åŒ–*â€“driver-memory MEM *é€ æˆ Driver å†…å­˜æº¢å‡º,è§£å†³æ€è·¯æ˜¯å¢åŠ  Driver å†…å­˜ï¼Œå…·ä½“åšæ³•ä¸ºè®¾ç½®å‚æ•°spark.driver.memory (default 1g)è¿™ä¸ªå‚æ•°ç”¨æ¥è®¾ç½®Driverçš„å†…å­˜ã€‚åœ¨Sparkç¨‹åºä¸­ï¼ŒSparkContextï¼ŒDAGScheduleréƒ½æ˜¯è¿è¡Œåœ¨Driverç«¯çš„ã€‚å¯¹åº”rddçš„Stageåˆ‡åˆ†ä¹Ÿæ˜¯åœ¨Driverç«¯è¿è¡Œï¼Œå¦‚æœç”¨æˆ·è‡ªå·±å†™çš„ç¨‹åºæœ‰è¿‡å¤šçš„æ­¥éª¤ï¼Œåˆ‡åˆ†å‡ºè¿‡å¤šçš„Stageï¼Œè¿™éƒ¨åˆ†ä¿¡æ¯æ¶ˆè€—çš„æ˜¯Driverçš„å†…å­˜ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦è°ƒå¤§Driverçš„å†…å­˜ã€‚*spark.rdd.compress (default false) *è¿™ä¸ªå‚æ•°åœ¨å†…å­˜åƒç´§çš„æ—¶å€™ï¼Œåˆéœ€è¦persistæ•°æ®æœ‰è‰¯å¥½çš„æ€§èƒ½ï¼Œå°±å¯ä»¥è®¾ç½®è¿™ä¸ªå‚æ•°ä¸ºtrueï¼Œè¿™æ ·åœ¨ä½¿ç”¨persist(StorageLevel.MEMORY_ONLY_SER)çš„æ—¶å€™ï¼Œå°±èƒ½å¤Ÿå‹ç¼©å†…å­˜ä¸­çš„rddæ•°æ®ã€‚å‡å°‘å†…å­˜æ¶ˆè€—ï¼Œå°±æ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™ä¼šå ç”¨CPUçš„è§£å‹æ—¶é—´ã€‚spark.serializer (default org.apache.spark.serializer.JavaSerializer )å»ºè®®è®¾ç½®ä¸º org.apache.spark.serializer.KryoSerializerï¼ŒKryoåºåˆ—åŒ–æœºåˆ¶æ¯”Javaåºåˆ—åŒ–æœºåˆ¶æ€§èƒ½æé«˜10å€å·¦å³ï¼ŒSparkä¹‹æ‰€ä»¥æ²¡æœ‰é»˜è®¤ä½¿ç”¨Kryoä½œä¸ºåºåˆ—åŒ–ç±»åº“ï¼Œæ˜¯å› ä¸ºå®ƒä¸æ”¯æŒæ‰€æœ‰å¯¹è±¡çš„åºåˆ—åŒ–ï¼ŒåŒæ—¶Kryoéœ€è¦ç”¨æˆ·åœ¨ä½¿ç”¨å‰æ³¨å†Œéœ€è¦åºåˆ—åŒ–çš„ç±»å‹ï¼Œä¸å¤Ÿæ–¹ä¾¿12345678910import com.esotericsoftware.kryo.Kryo;import org.apache.spark.serializer.KryoRegistrator;public class DemoRegistrator implements KryoRegistrator &#123; @Override public void registerClasses (Kryo kryo) &#123; //ä»¥ä¸‹ä¸ºç¤ºä¾‹ç±»ï¼Œéœ€æ³¨å†Œè‡ªå®šä¹‰ç±» kryo.register(AggrateKey.class); kryo.register(AggrateValue.class); &#125;&#125;123val conf = new SparkConf()conf.set(\"spark.serializer\", \"org.apache.spark.serializer.KryoSerializer\") .set(\"spark.kryo.registrator\", \"com.etl.common.DemoRegistrator\")spark.memory.storageFraction (default 0.5)è¿™ä¸ªå‚æ•°è®¾ç½®å†…å­˜è¡¨ç¤º Executorå†…å­˜ä¸­ storage/(storage+execution)ï¼Œè™½ç„¶spark-1.6.0+çš„ç‰ˆæœ¬å†…å­˜storageå’Œexecutionçš„å†…å­˜å·²ç»æ˜¯å¯ä»¥äº’ç›¸å€Ÿç”¨çš„äº†ï¼Œä½†æ˜¯å€Ÿç”¨å’Œèµå›ä¹Ÿæ˜¯éœ€è¦æ¶ˆè€—æ€§èƒ½çš„ï¼Œæ‰€ä»¥å¦‚æœæ˜çŸ¥é“ç¨‹åºä¸­storageæ˜¯å¤šæ˜¯å°‘å°±å¯ä»¥è°ƒèŠ‚ä¸€ä¸‹è¿™ä¸ªå‚æ•°ã€‚spark.locality.wait (default 3s)sparkä¸­æœ‰4ç§æœ¬åœ°åŒ–æ‰§è¡Œlevelï¼ŒPROCESS_LOCAL-&gt;NODE_LOCAL-&gt;RACK_LOCAL-&gt;ANY,ä¸€ä¸ªtaskæ‰§è¡Œå®Œï¼Œç­‰å¾…spark.locality.waitæ—¶é—´å¦‚æœï¼Œç¬¬ä¸€æ¬¡ç­‰å¾…PROCESSçš„Taskåˆ°è¾¾ï¼Œå¦‚æœæ²¡æœ‰ï¼Œç­‰å¾…ä»»åŠ¡çš„ç­‰çº§ä¸‹è°ƒåˆ°NODEå†ç­‰å¾…spark.locality.waitæ—¶é—´ï¼Œä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°ANYã€‚åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯å¦èƒ½å¤Ÿå¾ˆå¥½çš„æ‰§è¡Œæœ¬åœ°æ–‡ä»¶å¯¹æ€§èƒ½çš„å½±å“ä¹Ÿæ˜¯å¾ˆå¤§çš„ã€‚å¦‚æœRDDçš„æ¯ä¸ªåˆ†åŒºæ•°æ®æ¯”è¾ƒå¤šï¼Œæ¯ä¸ªåˆ†åŒºå¤„ç†æ—¶é—´è¿‡é•¿ï¼Œå°±åº”è¯¥æŠŠ spark.locality.wait é€‚å½“è°ƒå¤§ä¸€ç‚¹ï¼Œè®©Taskèƒ½å¤Ÿæœ‰æ›´å¤šçš„æ—¶é—´ç­‰å¾…æœ¬åœ°æ•°æ®ã€‚ç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨persistæˆ–è€…cacheåï¼Œè¿™ä¸¤ä¸ªæ“ä½œè¿‡åï¼Œåœ¨æœ¬åœ°æœºå™¨è°ƒç”¨å†…å­˜ä¸­ä¿å­˜çš„æ•°æ®æ•ˆç‡ä¼šå¾ˆé«˜ï¼Œä½†æ˜¯å¦‚æœéœ€è¦è·¨æœºå™¨ä¼ è¾“å†…å­˜ä¸­çš„æ•°æ®ï¼Œæ•ˆç‡å°±ä¼šå¾ˆä½ã€‚spark.speculation (default false)ä¸€ä¸ªå¤§çš„é›†ç¾¤ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„æ€§èƒ½ä¼šæœ‰å·®å¼‚ï¼Œspark.speculationè¿™ä¸ªå‚æ•°è¡¨ç¤ºç©ºé—²çš„èµ„æºèŠ‚ç‚¹ä¼šä¸ä¼šå°è¯•æ‰§è¡Œè¿˜åœ¨è¿è¡Œï¼Œå¹¶ä¸”è¿è¡Œæ—¶é—´è¿‡é•¿çš„Taskï¼Œé¿å…å•ä¸ªèŠ‚ç‚¹è¿è¡Œé€Ÿåº¦è¿‡æ…¢å¯¼è‡´æ•´ä¸ªä»»åŠ¡å¡åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚è¿™ä¸ªå‚æ•°æœ€å¥½è®¾ç½®ä¸ºtrueã€‚ä¸ä¹‹ç›¸é…åˆå¯ä»¥ä¸€èµ·è®¾ç½®çš„å‚æ•°æœ‰spark.speculation.Ã—å¼€å¤´çš„å‚æ•°ã€‚å‚è€ƒä¸­æœ‰æ–‡ç« è¯¦ç»†è¯´æ˜è¿™ä¸ªå‚æ•°ã€‚æœ€åï¼Œå…³äºOOMçš„é—®é¢˜ï¼Œè¿˜æ˜¯è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼Œæ’æŸ¥æ—¥å¿—ï¼Œæ‰¾åˆ°é—®é¢˜æ‰€åœ¨ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯å›´ç»•è¿™åŠ å†…å­˜ï¼Œè°ƒæ•´å¹¶è¡Œåº¦ï¼Œä»£ç è°ƒä¼˜ï¼Œå‚æ•°è°ƒä¼˜å››ä¸ªæ–¹é¢æ¥è¿›è¡Œã€‚å‚è€ƒé“¾æ¥ï¼šhttps://blog.csdn.net/yhb315279058/article/details/51035631","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"åˆ›å»ºhiveè¡¨æ—¶æ ¼å¼å¦‚ä½•é€‰æ‹©","slug":"åˆ›å»ºhiveè¡¨æ—¶æ ¼å¼å¦‚ä½•é€‰æ‹©","date":"2019-02-10T09:24:25.000Z","updated":"2020-06-14T09:26:39.186Z","comments":true,"path":"2019/02/10/åˆ›å»ºhiveè¡¨æ—¶æ ¼å¼å¦‚ä½•é€‰æ‹©/","link":"","permalink":"cpeixin.cn/2019/02/10/%E5%88%9B%E5%BB%BAhive%E8%A1%A8%E6%97%B6%E6%A0%BC%E5%BC%8F%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9/","excerpt":"","text":"æœ¬æ–‡è½¬è½½è‡ªhttps://www.cnblogs.com/barneywill/p/10109508.htmlå¶ç„¶çœ‹åˆ°è¿™ç¯‡æ–‡ç« ï¼Œè¿™ä½è€å“¥åšçš„å¯¹æ¯”æµ‹è¯•å¾ˆå¥½ï¼Œå½“åˆæˆ‘ä»¬åœ¨æ–°æ•°ä»“è®¾è®¡æ—¶ï¼Œéƒ½æ²¡æœ‰å¯¹æ¯”æµ‹è¯•çš„è¿™ä¹ˆè¯¦ç»†ã€‚å¸¸ç”¨æ ¼å¼textfileéœ€è¦å®šä¹‰åˆ†éš”ç¬¦ï¼Œå ç”¨ç©ºé—´å¤§ï¼Œè¯»å†™æ•ˆç‡æœ€ä½ï¼Œéå¸¸å®¹æ˜“å‘ç”Ÿå†²çªï¼ˆåˆ†éš”ç¬¦ï¼‰çš„ä¸€ç§æ ¼å¼ï¼ŒåŸºæœ¬ä¸Šåªæœ‰éœ€è¦å¯¼å…¥æ•°æ®çš„æ—¶å€™æ‰ä¼šä½¿ç”¨ï¼Œæ¯”å¦‚å¯¼å…¥csvæ–‡ä»¶ï¼›ROW FORMAT DELIMITEDFIELDS TERMINATED BY â€˜\\u0001â€™LINES TERMINATED BY â€˜\\nâ€™STORED AS TEXTFILEjsonhive3.0åå®˜æ–¹æ”¯æŒjsonæ ¼å¼ï¼Œä¹‹å‰éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹ï¼Œå¯¼å…¥jarï¼Œhttp://www.congiu.net/hive-json-serde/ï¼Œadd jar hdfs://nn/jarpath/json-udf-1.3.8-jar-with-dependencies.jar;add jar hdfs://nn/jarpath/json-serde-1.3.8-jar-with-dependencies.jar;å ç”¨ç©ºé—´æœ€å¤§ï¼Œè¯»å†™æ•ˆç‡ä½ï¼ŒåŸºæœ¬ä¸Šåªæœ‰éœ€è¦å¯¼å…¥æ•°æ®çš„æ—¶å€™æ‰ä¼šä½¿ç”¨ï¼Œæ¯”å¦‚å¯¼å…¥jsonæ–‡ä»¶ï¼›ROW FORMAT SERDE â€˜org.openx.data.jsonserde.JsonSerDeâ€™STORED AS TEXTFILExmlhttp://central.maven.org/maven2/com/ibm/spss/hive/serde2/xml/hivexmlserde/1.0.0.0/hivexmlserde-1.0.0.0.jar12345678910111213CREATE TABLE xml_bank(customer_id STRING, income BIGINT, demographics map&lt;string,string&gt;, financial map&lt;string,string&gt;) ROW FORMAT SERDE 'com.ibm.spss.hive.serde2.xml.XmlSerDe' WITH SERDEPROPERTIES ( \"column.xpath.customer_id\"=\"/record/@customer_id\", \"column.xpath.income\"=\"/record/income/text()\", \"column.xpath.demographics\"=\"/record/demographics/*\", \"column.xpath.financial\"=\"/record/financial/*\" ) TBLPROPERTIES ( \"xmlinput.start\"=\"&lt;record customer\", \"xmlinput.end\"=\"&lt;/record&gt;\" );lzoç›¸æ¯”textfileå¤šäº†lzoå‹ç¼©ï¼Œå ç”¨ç©ºé—´æ›´å°ï¼›ROW FORMAT DELIMITEDFIELDS TERMINATED BY â€˜\\tâ€™STORED AS INPUTFORMATâ€˜com.hadoop.mapred.DeprecatedLzoTextInputFormatâ€™OUTPUTFORMATâ€˜org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormatâ€™orcåˆ—å¼å­˜å‚¨ï¼Œå ç”¨ç©ºé—´æœ€å°ï¼Œéå¸¸é€‚åˆç”¨æ¥åšæ•°ä»“ï¼›STORED AS ORCå‹ç¼©STORED AS ORC TBLPROPERTIES (â€œorc.compressionâ€=â€ZLIBâ€)STORED AS ORC TBLPROPERTIES (â€œorc.compressionâ€=â€SNAPPYâ€)æ³¨æ„è®¾ç½®orcå‹ç¼©æ ¼å¼å‰ä¸€å®šè¦å…ˆè®¾ç½®ï¼šset hive.exec.orc.compression.strategy=COMPRESSION;å¦åˆ™å‹ç¼©ä¸ç”Ÿæ•ˆï¼›parquetåˆ—å¼å­˜å‚¨ï¼Œå ç”¨ç©ºé—´å±…ä¸­ï¼Œå¦‚æœåæœŸä½¿ç”¨sparkæ¥å¤„ç†ï¼Œparquetæ˜¯æœ€ä½³æ ¼å¼ï¼›STORED AS PARQUETparquet+snappySTORED AS PARQUET TBLPROPERTIES (â€œparquet.compressionâ€=â€SNAPPYâ€)å¯¹æ¯”æµ‹è¯•æµ‹è¯•è¡¨ï¼štest_tableæµ‹è¯•è¡Œæ•°ï¼š10äº¿æµ‹è¯•sqlç±»å‹ï¼šaggregationæµ‹è¯•sqlï¼šselect col_1, count(1) from test_table group by col_1;æµ‹è¯•ç»“æœfshdfskuduformattextfilelzoparquetparquet snappyorcorc snappy** **capacity464.0 G169.4 G177.2 G111.3 G71.5 G65.7G184 G100%36%37%23%15%14%39%Hive2.3.4816 s711 s250 s158 s130 s127 sHive2.3.4Tuning251 s163 s109 s96 sHive2.3.4Onspark2.4.054 s47 s149 s138 sSpark2.1.1371 s293 s17 s16 s51 sSpark2.4.0496 s297 s16 s16 s21 s21 sDrill1.15.059 s57 s75 s45 sImpala2.1215 s16 sPresto0.21525 s21 s13 s12 s** **** **ä»æ•°æ®å¤§å°å’ŒæŸ¥è¯¢æ•ˆç‡ä¸Šçœ‹ï¼Œè¡¨ç°æœ€å¥½çš„æ˜¯presto+orc+snappyï¼›hiveä¸‹æœ€ä½³æ ¼å¼ä¸ºorc snappyï¼Œæ•°æ®å¤§å°æœ€å°ï¼Œå¹¶ä¸”æŸ¥è¯¢æœ€å¿«ï¼›hiveåˆ‡æ¢engineä¸ºsparkåï¼Œå¯¹parquetæ ¼å¼çš„æŸ¥è¯¢æœ‰ä¸€äº›æå‡ï¼Œä½†æ˜¯å ç”¨ç›¸åŒèµ„æºçš„æƒ…å†µä¸‹ï¼Œè¿œä¸å¦‚ç›´æ¥ä½¿ç”¨spark sqlå¿«ï¼›spark2.3ä»¥åå¯¹orcæ ¼å¼ç›¸æ¯”ä¹‹å‰æœ‰å¾ˆå¤§ä¼˜åŒ–ï¼Œå·²ç»å¾ˆæ¥è¿‘parquetæ ¼å¼ï¼›impala+parquet+hdfsçš„æ€§èƒ½å’Œimpala+kuduå·®ä¸å¤šï¼Œkuduçš„å¥½å¤„æ˜¯æ”¯æŒå®æ—¶æ›´æ–°ï¼›drillçœ‹èµ·æ¥æ²¡æœ‰å¿…è¦ï¼›spark2.4.0ä¸­çš„parquetä¸º2.4ï¼Œparquetä»2.5å¼€å§‹æ”¯æŒcolumn indexï¼Œé¢„è®¡ä»¥åçš„sparkç‰ˆæœ¬å¯¹parquetçš„æŸ¥è¯¢ä¼šæ›´å¿«ï¼›impalaå¯¹orcçš„æ”¯æŒä»3.1å¼€å§‹ä½œä¸ºå®éªŒåŠŸèƒ½çš„ä¸€éƒ¨åˆ†ï¼›è¯¦ç»†æ•°æ®yarn 200g 50core1 hive-2.3.412345678910111213141516171819202122232425262728293031323334set mapreduce.map.memory.mb=4096;set mapreduce.map.java.opts=-Xmx3072m;hive-textfile:Time taken: 816.202 seconds, Fetched: 32 row(s)Stage-Stage-1: Map: 1831 Reduce: 1009 Cumulative CPU: 27614.77 sec HDFS Read: 498267775168 HDFS Write: 88861 SUCCESSTotal MapReduce CPU Time Spent: 0 days 7 hours 40 minutes 14 seconds 770 msechive-lzo:Time taken: 711.266 seconds, Fetched: 32 row(s)Stage-Stage-1: Map: 183 Reduce: 711 Cumulative CPU: 13949.24 sec HDFS Read: 181881436157 HDFS Write: 62935 SUCCESSTotal MapReduce CPU Time Spent: 0 days 3 hours 52 minutes 29 seconds 240 msechive-orc:Time taken: 130.194 seconds, Fetched: 32 row(s)Stage-Stage-1: Map: 275 Reduce: 300 Cumulative CPU: 4368.67 sec HDFS Read: 626004573 HDFS Write: 27178 SUCCESSTotal MapReduce CPU Time Spent: 0 days 1 hours 12 minutes 48 seconds 670 msechive-orc snappy:Time taken: 127.803 seconds, Fetched: 32 row(s)Stage-Stage-1: Map: 191 Reduce: 276 Cumulative CPU: 4374.74 sec HDFS Read: 580889407 HDFS Write: 25090 SUCCESSTotal MapReduce CPU Time Spent: 0 days 1 hours 12 minutes 54 seconds 740 msechive-orc-tuning:Time taken: 109.539 seconds, Fetched: 32 row(s)Stage-Stage-1: Map: 275 Reduce: 300 Cumulative CPU: 3051.67 sec HDFS Read: 627064673 HDFS Write: 40321 SUCCESSTotal MapReduce CPU Time Spent: 50 minutes 51 seconds 670 msechive-orc snappy-tuning:Time taken: 94.135 seconds, Fetched: 32 row(s)Stage-Stage-1: Map: 191 Reduce: 276 Cumulative CPU: 2393.92 sec HDFS Read: 581727151 HDFS Write: 37201 SUCCESSTotal MapReduce CPU Time Spent: 39 minutes 53 seconds 920 msechive-parquet:Time taken: 250.786 seconds, Fetched: 32 row(s)Stage-Stage-1: Map: 642 Reduce: 744 Cumulative CPU: 10919.85 sec HDFS Read: 873784253 HDFS Write: 65806 SUCCESSTotal MapReduce CPU Time Spent: 0 days 3 hours 1 minutes 59 seconds 850 msechive-parquet snappy:Time taken: 158.009 seconds, Fetched: 32 row(s)Stage-Stage-1: Map: 367 Reduce: 467 Cumulative CPU: 6246.0 sec HDFS Read: 721915438 HDFS Write: 41707 SUCCESSTotal MapReduce CPU Time Spent: 0 days 1 hours 44 minutes 6 seconds 0 msec ### 2 hive-2.3.4 on spark-2.4.01234567891011set spark.driver.memory=4g;set spark.executor.memory=4g;set spark.executor.instances=10;hive on spark-parquet:Time taken: 54.446 seconds, Fetched: 32 row(s)hive on spark-parquet snappy:Time taken: 47.364 seconds, Fetched: 32 row(s)hive on spark-orc:Time taken: 149.901 seconds, Fetched: 32 row(s)hive on spark-orc snappy:Time taken: 138.844 seconds, Fetched: 32 row(s) ### 3 impala-2.121234567891011121314MEM_LIMIT=20g * 3impala-parquet snappy:Fetched 32 row(s) in 15.10s+--------------+--------+----------+----------+-------+------------+-----------+---------------+---------------------------------------------------+| Operator | #Hosts | Avg Time | Max Time | #Rows | Est. #Rows | Peak Mem | Est. Peak Mem | Detail |+--------------+--------+----------+----------+-------+------------+-----------+---------------+---------------------------------------------------+| 04:EXCHANGE | 1 | 211.45us | 211.45us | 32 | 50 | 208.00 KB | 0 B | UNPARTITIONED || 03:AGGREGATE | 3 | 2.58ms | 2.91ms | 32 | 50 | 34.03 MB | 128.00 MB | FINALIZE || 02:EXCHANGE | 3 | 29.23us | 30.92us | 96 | 1.04B | 32.00 KB | 0 B | HASH(cpp_addr_province) || 01:AGGREGATE | 3 | 13.29s | 13.97s | 96 | 1.04B | 34.05 MB | 128.00 MB | STREAMING || 00:SCAN HDFS | 3 | 723.09ms | 760.01ms | 1.04B | 1.04B | 36.55 MB | 88.00 MB | temp.app_ba_userprofile_prop_nonpolar_view_ext_ps |+--------------+--------+----------+----------+-------+------------+-----------+---------------+---------------------------------------------------+impala-kudu:Fetched 32 row(s) in 15.61s ### 4 drill-1.1512345678910g+10g+1g+1g * 3drill-parquet:32 rows selected (59.501 seconds)drill-parquet snappy:32 rows selected (57.653 seconds)drill-orc:32 rows selected (75.749 seconds)drill-orc snappy:32 rows selected (45.323 seconds)5 spark-sql â€“master yarn â€“num-executors 10 â€“executor-memory 4g â€“driver-memory 4g5.1 spark-2.1.112345678910spark sql-textfile:Time taken: 371.77 seconds, Fetched 32 row(s)spark sql-lzo:Time taken: 293.391 seconds, Fetched 32 row(s)spark sql-parquet:Time taken: 17.338 seconds, Fetched 32 row(s)spark sql-parquet snappy:Time taken: 16.609 seconds, Fetched 32 row(s)spark sql-orc:Time taken: 51.959 seconds, Fetched 32 row(s)5.2 spark-2.4.0123456789101112spark sql-textfile:Time taken: 496.395 seconds, Fetched 32 row(s)spark sql-lzo:Time taken: 297.142 seconds, Fetched 32 row(s)spark sql-parquet:Time taken: 16.728 seconds, Fetched 32 row(s)spark sql-parquet snappy:Time taken: 16.879 seconds, Fetched 32 row(s)spark sql-orc:Time taken: 21.432 seconds, Fetched 32 row(s)spark sql-orc snappy:Time taken: 21.935 seconds, Fetched 32 row(s)6 presto123456789101112presto-parquet:Splits: 3,182 total, 3,182 done (100.00%)0:25 [1.04B rows, 612MB] [42.2M rows/s, 24.9MB/s]presto-parquet snappy:Splits: 2,088 total, 2,088 done (100.00%)0:21 [1.04B rows, 584MB] [49.3M rows/s, 27.8MB/spresto-orcï¼šSplits: 1,532 total, 1,532 done (100.00%)0:13 [1.04B rows, 850MB] [81.7M rows/s, 66.8MB/s]presto-orc snappyï¼šSplits: 1,353 total, 1,353 done (100.00%)0:12 [1.04B rows, 1.13GB] [87.5M rows/s, 97.4MB/s]","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"æ•°æ®ä»“åº“","slug":"æ•°æ®ä»“åº“","permalink":"cpeixin.cn/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"}]},{"title":"Structured Streaming é‡æ¸©","slug":"Structured-Streaming-é‡æ¸©","date":"2019-02-10T08:03:44.000Z","updated":"2020-05-09T04:09:47.215Z","comments":true,"path":"2019/02/10/Structured-Streaming-é‡æ¸©/","link":"","permalink":"cpeixin.cn/2019/02/10/Structured-Streaming-%E9%87%8D%E6%B8%A9/","excerpt":"","text":"æ€»è§ˆ_Structured Streaming åˆ™æ˜¯åœ¨ Spark 2.0 åŠ å…¥çš„ç»è¿‡é‡æ–°è®¾è®¡çš„å…¨æ–°æµå¼å¼•æ“ã€‚å®ƒçš„æ¨¡å‹ååˆ†ç®€æ´ï¼Œæ˜“äºç†è§£ã€‚ä¸€ä¸ªæµçš„æ•°æ®æºä»é€»è¾‘ä¸Šæ¥è¯´å°±æ˜¯ä¸€ä¸ªä¸æ–­å¢é•¿çš„åŠ¨æ€è¡¨æ ¼ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ–°æ•°æ®è¢«æŒç»­ä¸æ–­åœ°æ·»åŠ åˆ°è¡¨æ ¼çš„æœ«å°¾ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨ Dataset/DataFrame æˆ–è€… SQL æ¥å¯¹è¿™ä¸ªåŠ¨æ€æ•°æ®æºè¿›è¡Œå®æ—¶æŸ¥è¯¢ã€‚æ¯æ¬¡æŸ¥è¯¢åœ¨é€»è¾‘ä¸Šå°±æ˜¯å¯¹å½“å‰çš„è¡¨æ ¼å†…å®¹æ‰§è¡Œä¸€æ¬¡ SQL æŸ¥è¯¢ã€‚å¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢åˆ™æ˜¯ç”±ç”¨æˆ·é€šè¿‡è§¦å‘å™¨ï¼ˆTriggerï¼‰æ¥è®¾å®šã€‚ç”¨æˆ·æ—¢å¯ä»¥è®¾å®šå®šæœŸæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥è®©æŸ¥è¯¢å°½å¯èƒ½å¿«åœ°æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°å®æ—¶çš„æ•ˆæœã€‚æœ€åï¼Œç³»ç»Ÿé€šè¿‡ checkpointing å’Œ Write-Ahead Logsæ¥ç¡®ä¿ç«¯åˆ°ç«¯çš„ä¸€æ¬¡å®¹é”™ä¿è¯ã€‚ä¸€ä¸ªæµçš„è¾“å‡ºæœ‰å¤šç§æ¨¡å¼ï¼Œæ—¢å¯ä»¥æ˜¯åŸºäºæ•´ä¸ªè¾“å…¥æ‰§è¡ŒæŸ¥è¯¢åçš„å®Œæ•´ç»“æœï¼Œä¹Ÿå¯ä»¥é€‰æ‹©åªè¾“å‡ºä¸ä¸Šæ¬¡æŸ¥è¯¢ç›¸æ¯”çš„å·®å¼‚ï¼Œæˆ–è€…å°±æ˜¯ç®€å•åœ°è¿½åŠ æœ€æ–°çš„ç»“æœã€‚è¿™ä¸ªæ¨¡å‹å¯¹äºç†Ÿæ‚‰ SQL çš„ç”¨æˆ·æ¥è¯´å¾ˆå®¹æ˜“æŒæ¡ï¼Œå¯¹æµçš„æŸ¥è¯¢è·ŸæŸ¥è¯¢ä¸€ä¸ªè¡¨æ ¼å‡ ä¹å®Œå…¨ä¸€æ ·ã€‚åœ¨å†…éƒ¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç»“æ„åŒ–æµæŸ¥è¯¢æ˜¯ä½¿ç”¨_å¾®æ‰¹é‡å¤„ç†_å¼•æ“_å¤„ç†çš„_ï¼Œè¯¥å¼•æ“å°†æ•°æ®æµä½œä¸ºä¸€ç³»åˆ—å°æ‰¹é‡ä½œä¸šè¿›è¡Œå¤„ç†ï¼Œä»è€Œå®ç°äº†ä½è‡³100æ¯«ç§’çš„ç«¯åˆ°ç«¯å»¶è¿Ÿä»¥åŠ exactly-onceçš„å®¹é”™ä¿è¯ã€‚ä½†æ˜¯ï¼Œè‡ªSpark 2.3èµ·ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ç§ç§°ä¸ºâ€œ è¿ç»­å¤„ç†â€çš„æ–°ä½å»¶è¿Ÿå¤„ç†æ¨¡å¼ï¼Œè¯¥æ¨¡å¼å¯ä»¥å®ç°ä¸€æ¬¡æœ€å°‘ä¿è¯çš„ä½è‡³1æ¯«ç§’çš„ç«¯åˆ°ç«¯å»¶è¿Ÿã€‚åœ¨ä¸æ›´æ”¹æŸ¥è¯¢ä¸­çš„Dataset / DataFrameæ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ‚¨å°†èƒ½å¤Ÿæ ¹æ®åº”ç”¨ç¨‹åºéœ€æ±‚é€‰æ‹©æ¨¡å¼Structured Streaming æ˜¯å¯¹ Spark Streaming çš„æ”¹è¿›ä¹ˆï¼ŸStructured Streaming å¹¶ä¸æ˜¯å¯¹ Spark Streaming çš„ç®€å•æ”¹è¿›ï¼Œè€Œæ˜¯æˆ‘ä»¬å¸å–äº†è¿‡å»å‡ å¹´åœ¨å¼€å‘ Spark SQL å’Œ Spark Streaming è¿‡ç¨‹ä¸­çš„ç»éªŒæ•™è®­ï¼Œä»¥åŠ Spark ç¤¾åŒºå’Œ Databricks ä¼—å¤šå®¢æˆ·çš„åé¦ˆï¼Œé‡æ–°å¼€å‘çš„å…¨æ–°æµå¼å¼•æ“ï¼Œè‡´åŠ›äºä¸ºæ‰¹å¤„ç†å’Œæµå¤„ç†æä¾›ç»Ÿä¸€çš„é«˜æ€§èƒ½ APIã€‚åŒæ—¶ï¼Œåœ¨è¿™ä¸ªæ–°çš„å¼•æ“ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå®¹æ˜“å®ç°ä¹‹å‰åœ¨ Spark Streaming ä¸­å¾ˆéš¾å®ç°çš„ä¸€äº›åŠŸèƒ½ï¼Œæ¯”å¦‚ Event Time çš„æ”¯æŒï¼ŒStream-Stream Joinï¼Œæ¯«ç§’çº§å»¶è¿Ÿç±»ä¼¼äº Dataset/DataFrame ä»£æ›¿ Spark Core çš„ RDD æˆä¸ºä¸º Spark ç”¨æˆ·ç¼–å†™æ‰¹å¤„ç†ç¨‹åºçš„é¦–é€‰ï¼ŒDataset/DataFrame ä¹Ÿå°†æ›¿ä»£ Spark Streaming çš„ DStreamï¼Œæˆä¸ºç¼–å†™æµå¤„ç†ç¨‹åºçš„é¦–é€‰ã€‚Structured Streaming çš„ Spark æœ‰ä»€ä¹ˆä¼˜åŠ£åŠ¿å—ï¼Ÿç®€æ´çš„æ¨¡å‹ã€‚Structured Streaming çš„æ¨¡å‹å¾ˆç®€æ´ï¼Œæ˜“äºç†è§£ã€‚ç”¨æˆ·å¯ä»¥ç›´æ¥æŠŠä¸€ä¸ªæµæƒ³è±¡æˆæ˜¯æ— é™å¢é•¿çš„è¡¨æ ¼ã€‚ä¸€è‡´çš„ APIã€‚ç”±äºå’Œ Spark SQL å…±ç”¨å¤§éƒ¨åˆ† APIï¼Œå¯¹ Spaprk SQL ç†Ÿæ‚‰çš„ç”¨æˆ·å¾ˆå®¹æ˜“ä¸Šæ‰‹ï¼Œä»£ç ä¹Ÿååˆ†ç®€æ´ã€‚åŒæ—¶æ‰¹å¤„ç†å’Œæµå¤„ç†ç¨‹åºè¿˜å¯ä»¥å…±ç”¨ä»£ç ï¼Œä¸éœ€è¦å¼€å‘ä¸¤å¥—ä¸åŒçš„ä»£ç ï¼Œæ˜¾è‘—æé«˜äº†å¼€å‘æ•ˆç‡ã€‚å“è¶Šçš„æ€§èƒ½ã€‚Structured Streaming åœ¨ä¸ Spark SQL å…±ç”¨ API çš„åŒæ—¶ï¼Œä¹Ÿç›´æ¥ä½¿ç”¨äº† Spark SQL çš„ Catalyst ä¼˜åŒ–å™¨å’Œ Tungstenï¼Œæ•°æ®å¤„ç†æ€§èƒ½ååˆ†å‡ºè‰²ã€‚æ­¤å¤–ï¼ŒStructured Streaming è¿˜å¯ä»¥ç›´æ¥ä»æœªæ¥ Spark SQL çš„å„ç§æ€§èƒ½ä¼˜åŒ–ä¸­å—ç›Šã€‚å¤šè¯­è¨€æ”¯æŒã€‚Structured Streaming ç›´æ¥æ”¯æŒç›®å‰ Spark SQL æ”¯æŒçš„è¯­è¨€ï¼ŒåŒ…æ‹¬ Scalaï¼ŒJavaï¼ŒPythonï¼ŒR å’Œ SQLã€‚ç”¨æˆ·å¯ä»¥é€‰æ‹©è‡ªå·±å–œæ¬¢çš„è¯­è¨€è¿›è¡Œå¼€å‘ã€‚å‘ƒï½ï½ å…³äºStructured Streamingçš„ä»‹ç»å°±è¯´åˆ°è¿™é‡Œï¼Œå¦‚æœæƒ³çœ‹æ›´è¯¦ç»†æ›´å‡†ç¡®çš„ä»‹ç»å‘¢ï¼Œè¿˜æ˜¯ä¹–ä¹–çš„å»å®˜ç½‘å§ã€‚åœ¨2017å¹´10æœˆä»½çš„æ—¶å€™ï¼Œæ–°ç«‹é¡¹çš„ä¸€ä¸ªappç”¨æˆ·è¡Œä¸ºå®æ—¶é¡¹ç›®ï¼Œæˆ‘æœ‰æ„ä½¿ç”¨Structured Streamingï¼Œæ‰€ä»¥å°±è°ƒç ”äº†ä¸€ä¸‹ï¼Œè‡ªå·±å†™äº†ä¸€ä¸ªdemoï¼Œæˆ‘è®°å¿†é‡Œé‚£æ—¶å†™Structuredå¾ˆåˆ«æ‰­ï¼Œå°±åƒä¸€ä¸ªæ¨¡ç‰ˆä¸€æ ·ï¼Œè¾“å…¥æºå’Œè¾“å‡ºæºéƒ½è¢«è§„å®šå¥½äº†å‡½æ•°å’Œå‚æ•°ï¼Œå¹¶ä¸”åœ¨é‚£æ—¶å€™æµ‹è¯•åçš„æ—¶å€™ï¼Œä¸æ€ä¹ˆç¨³å®šï¼Œè€Œä¸”å®˜æ–¹å¹¶æ²¡æœ‰ç»™å‡ºæˆç†Ÿçš„ç‰ˆæœ¬ï¼Œå½“æ—¶æ‰€æµ‹è¯•çš„åŠŸèƒ½è¿˜éƒ½æ˜¯ alpha ç‰ˆæœ¬ï¼Œæ‰€ä»¥å½“æ—¶å°±è¿˜æ˜¯ä½¿ç”¨äº†Spark Streamingä¸è¿‡ç°åœ¨æ¥çœ‹ï¼ŒStructured Streaming è¶Šæ¥è¶Šæˆç†Ÿï¼ŒSpark Streamingæ„Ÿè§‰ä¼¼ä¹åœæ­¢äº†æ›´æ–°ã€‚Structured streamingåº”è¯¥æ˜¯Sparkæµå¤„ç†çš„æœªæ¥ï¼Œä½†æ˜¯å¾ˆéš¾æ›¿ä»£Flinkã€‚Flinkåœ¨æµå¤„ç†ä¸Šçš„å¤©ç„¶ä¼˜åŠ¿å¾ˆéš¾è¢«Sparkè¶…è¶Šã€‚åœ¨è¯»å®Œäº†Structured Streamingå®˜ç½‘åï¼Œè¿˜æ˜¯äº²æ‰‹çš„å†™ä¸€äº›å®ä¾‹æ„Ÿå—ä¸€ä¸‹ï¼Œä»¥ååšæ¶æ„çš„æ—¶å€™ï¼Œå¦‚æœé€‚åˆçš„è¯ï¼Œè¿˜å¯ä»¥åŠ è¿›æ¥ã€‚å®ä¾‹ ### complete, append, update123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657import org.apache.spark.sql.streaming.StreamingQueryimport org.apache.spark.sql.&#123;DataFrame, Dataset, SparkSession&#125;import com.alibaba.fastjson.&#123;JSON, JSONObject&#125;import org.apache.log4j.&#123;Level, Logger&#125;object structured_kafka &#123; val logger:Logger = Logger.getRootLogger Logger.getLogger(\"org\").setLevel(Level.ERROR) def main(args: Array[String]): Unit = &#123; case class kafka_format(date_time: String, keyword_list: String) val spark: SparkSession = SparkSession .builder() .appName(\"Structrued-Streaming\") .master(\"local[2]\") .getOrCreate() import spark.implicits._ val kafka_df: DataFrame = spark .readStream .format(\"kafka\") .option(\"kafka.bootstrap.servers\", \"localhost:9092\") .option(\"subscribe\", \"weibo_keyword\") .option(\"startingOffsets\", \"earliest\") .option(\"includeTimestamp\", value = true)// .option(\"endingOffsets\", \"latest\")// .option(\"startingOffsets\", \"\"\"&#123;\"topic1\":&#123;\"0\":23,\"1\":-2&#125;,\"topic2\":&#123;\"0\":-2&#125;&#125;\"\"\")// .option(\"endingOffsets\", \"\"\"&#123;\"topic1\":&#123;\"0\":50,\"1\":-1&#125;,\"topic2\":&#123;\"0\":-1&#125;&#125;\"\"\") .load() val keyvalue_df: DataFrame = kafka_df .selectExpr(\"CAST(value AS STRING)\") .as[String] .map((x: String) =&gt; &#123; val date_time: String = JSON.parseObject(x).getString(\"datetime\") val keyword_list: String = JSON.parseObject(x).getString(\"keywordList\") (date_time, keyword_list) &#125;) .flatMap((x: (String, String)) =&gt;&#123; x._2.split(\",\").map((word: String) =&gt;(x._1,word)) &#125;) .toDF(\"date_time\", \"keyword\") .groupBy(\"keyword\").count() .orderBy($\"count\".desc) val query: StreamingQuery = keyvalue_df.writeStream .outputMode(\"complete\") //append .format(\"console\") .start() query.awaitTermination() &#125;&#125;å…¶ä¸­éœ€è¦æ³¨æ„ï¼š__Append output mode not supported when there are streaming aggregations on streaming DataFrames/DataSets without watermark;;__Sorting is not supported on streaming DataFrames/Datasets, unless it is on aggregated DataFrame/Dataset in Complete output mode;æœªè¿›è¡Œaggregateçš„streamä¸èƒ½sort__ ### windowçª—å£ _1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859import com.alibaba.fastjson.JSONimport org.apache.log4j.&#123;Level, Logger&#125;import org.apache.spark.sql.streaming.&#123;StreamingQuery, Trigger&#125;import org.apache.spark.sql.&#123;DataFrame, SparkSession&#125;import org.apache.spark.sql.functions._object structured_kafka_window &#123; val logger:Logger = Logger.getRootLogger Logger.getLogger(\"org\").setLevel(Level.ERROR) def main(args: Array[String]): Unit = &#123; case class kafka_format(date_time: String, keyword_list: String) val spark: SparkSession = SparkSession .builder() .appName(\"Structrued-Streaming\") .master(\"local[2]\") .getOrCreate() import spark.implicits._ val kafka_df: DataFrame = spark .readStream .format(\"kafka\") .option(\"kafka.bootstrap.servers\", \"localhost:9092\") .option(\"subscribe\", \"weibo_keyword\") .option(\"startingOffsets\", \"latest\") .option(\"includeTimestamp\", value = true)// .option(\"endingOffsets\", \"latest\")// .option(\"startingOffsets\", \"\"\"&#123;\"topic1\":&#123;\"0\":23,\"1\":-2&#125;,\"topic2\":&#123;\"0\":-2&#125;&#125;\"\"\")// .option(\"endingOffsets\", \"\"\"&#123;\"topic1\":&#123;\"0\":50,\"1\":-1&#125;,\"topic2\":&#123;\"0\":-1&#125;&#125;\"\"\") .load() val keyvalue_df: DataFrame = kafka_df .selectExpr(\"CAST(value AS STRING)\") .as[String] .map((x: String) =&gt; &#123; val date_time: String = JSON.parseObject(x).getString(\"datetime\") val keyword_list: String = JSON.parseObject(x).getString(\"keywordList\") (date_time, keyword_list) &#125;) .flatMap((x: (String, String)) =&gt;&#123; x._2.split(\",\").map((word: String) =&gt;(x._1,word)) &#125;) .toDF(\"date_time\", \"keyword\") .groupBy(window($\"date_time\", \"5 minutes\", \"1 minutes\"),$\"keyword\") .count() .orderBy(\"window\") val query: StreamingQuery = keyvalue_df.writeStream .outputMode(\"complete\") //append .format(\"console\") .option(\"truncate\", \"false\") .trigger(Trigger.ProcessingTime(\"5 seconds\")) .start() query.awaitTermination() &#125;&#125;è¿™é‡Œå…³äºwindowçª—å£çš„åˆ’åˆ†ï¼Œæˆ‘å»ºè®®å¤§å®¶å¥½å¥½çš„ç ”è¯»ä¸€ä¸‹æºç ï¼š**ä½ç½®ï¼špackage **org.apache.spark.sql.catalyst.analysis![å±å¹•å¿«ç…§ 2020-05-08 ä¸‹åˆ11.29.50.png](https://cdn.nlark.com/yuque/0/2020/png/1072113/1588952005543-007c1291-12fd-4148-a625-587b1a6149f3.png#align=left&display=inline&height=1694&margin=%5Bobject%20Object%5D&name=%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202020-05-08%20%E4%B8%8B%E5%8D%8811.29.50.png&originHeight=1694&originWidth=1936&size=488433&status=done&style=none&width=1936)Watermark12345678910111213// åŸºäºevent-timeçš„windowï¼ŒwordsåŒ…å«timestampå’Œwordä¸¤åˆ—word .withWatermark(\"timestamp\", \"30 minutes\")//æŸçª—å£ç»“æœä¸ºxï¼Œä½†æ˜¯éƒ¨åˆ†æ•°æ®åœ¨è¿™ä¸ªçª—å£çš„æœ€åä¸€ä¸ªtimestampè¿‡åè¿˜æ²¡åˆ°è¾¾ï¼ŒSparkåœ¨è¿™ä¼šç­‰30minï¼Œè¿‡åå°±ä¸å†æ›´æ–°xäº†ã€‚ .dropDuplicates(\"User\", \"timestamp\") .groupBy(window(col(\"timestamp\"), \"10 minutes\"),col(\"User\"))// 10minåå†åŠ ä¸€ä¸ªå‚æ•°å˜ä¸ºSliding windowsï¼Œè¡¨ç¤ºæ¯éš”å¤šä¹…è®¡ç®—ä¸€æ¬¡ã€‚ .count() .writeStream .queryName(\"events_per_window\") .format(\"memory\") .outputMode(\"complete\") .start()spark.sql(\"SELECT * FROM events_per_window\")watermark = max event time seen by the engine - late thresholdï¼Œç›¸å½“äºFlinkçš„BoundedOutOfOrdernessTximestampExtractorã€‚åœ¨windowè®¡ç®—è¢«è§¦å‘æ—¶ï¼ŒSparkä¼šåˆ é™¤ç»“æŸæ—¶é—´ä½äºå½“å‰wmçš„windowçš„ä¸­é—´ç»“æœï¼Œå±äºè¯¥windowçš„è¿Ÿåˆ°æ•°æ®â€œå¯èƒ½â€ä¼šè¢«å¿½ç•¥ï¼Œè¶Šè¿Ÿè¶Šå¯èƒ½è¢«å¿½ç•¥ï¼Œåˆ é™¤å®Œåæ‰æ›´æ–°wmï¼Œæ‰€ä»¥å³ä¾¿ä¸‹ä¸€æ‰¹æ²¡æœ‰æ•°æ®åŠ å…¥ï¼ŒSparkæ‰€ä¾æ®çš„wmä¹Ÿæ˜¯æ–°çš„ï¼Œä¸‹ä¸‹ä¸€æ‰¹wmä¸å˜ã€‚ä¸Šé¢æ˜¯update modeï¼Œå¦‚æœæ˜¯appendæ¨¡å¼ï¼Œé‚£ä¹ˆç»“æœè¦ç­‰åˆ°triggeråå‘ç°windowçš„ç»“æŸæ—¶é—´ä½äºæ›´æ–°åçš„æ°´ä½çº¿æ—¶æ‰ä¼šå‡ºæ¥ã€‚å¦å¤–ï¼Œmax event time seen by the engine - late thresholdæœºåˆ¶æ„å‘³ç€å¦‚æœä¸‹ä¸€æ‰¹è®¡ç®—æ²¡æœ‰æ›´æ™šçš„æ•°æ®åŠ å…¥ï¼Œé‚£ä¹ˆwmå°±ä¸ä¼šå‰è¿›ï¼Œé‚£ä¹ˆæ•°æ®çš„appendå°±ä¼šè¢«å»¶åã€‚Conditions for watermarking to clean aggregation state(as of Spark 2.1.1, subject to change in the future)ä¸æ”¯æŒcompleteæ¨¡å¼ã€‚groupByå¿…é¡»åŒ…å«timestampåˆ—æˆ–è€…window(col(timestamp))ï¼ŒwithWatermarkä¸­çš„åˆ—è¦å’Œå‰é¢çš„timestampåˆ—ç›¸åŒé¡ºåºå¿…é¡»æ˜¯å…ˆwithWatermarkå†åˆ°groupByå‚è€ƒï¼šç»“æ„åŒ–æµç¼–ç¨‹æŒ‡å—Sparkä¹‹Structured Streaming","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"Spark Streaming Exactly once è¯­ä¹‰","slug":"Spark-Streaming-Exactly-once-è¯­ä¹‰","date":"2019-01-28T15:11:36.000Z","updated":"2020-06-28T15:15:07.563Z","comments":true,"path":"2019/01/28/Spark-Streaming-Exactly-once-è¯­ä¹‰/","link":"","permalink":"cpeixin.cn/2019/01/28/Spark-Streaming-Exactly-once-%E8%AF%AD%E4%B9%89/","excerpt":"","text":"Exactly-OnceExactly-Onceä¸æ˜¯æŒ‡å¯¹è¾“å…¥çš„æ•°æ®åªå¤„ç†ä¸€æ¬¡ï¼ŒæŒ‡çš„æ˜¯, åœ¨æµè®¡ç®—å¼•æ“ä¸­, ç®—å­ç»™ä¸‹æ¸¸çš„ç»“æœæ˜¯Exactly-Onceçš„(å³:ç»™ä¸‹æ¸¸çš„ç»“æœæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªï¼Œä¸”ä¸é‡å¤ã€ä¸å°‘ç®—)ã€‚å¦‚åœ¨Spark Streamingå¤„ç†è¿‡ç¨‹ä¸­ï¼Œä»ä¸€ä¸ªç®—å­(Operator)åˆ°å¦ä¸€ä¸ªç®—å­(Operator)ï¼Œå¯èƒ½ä¼šå› ä¸ºå„ç§ä¸å¯æŠ—åŠ›å¦‚æœºå™¨æŒ‚æ‰ç­‰åŸå› ï¼Œå¯¼è‡´æŸäº›Taskå¤„ç†å¤±è´¥ï¼ŒSparkå†…éƒ¨ä¼šåŸºäºLineageæˆ–Checkpointå¯åŠ¨é‡è¯•Taskå»é‡æ–°å¤„ç†åŒæ ·çš„æ•°æ®ã€‚å› ä¸å¯æŠ—åŠ›çš„å­˜åœ¨ï¼Œæµå¤„ç†å¼•æ“å†…éƒ¨ä¸å¯èƒ½åšåˆ°ä¸€æ¡æ•°æ®ä»…è¢«å¤„ç†ä¸€æ¬¡ã€‚æ‰€ä»¥ï¼Œå½“æµå¤„ç†å¼•æ“å£°ç§°æä¾›Exactly-Onceè¯­ä¹‰æ—¶ï¼ŒæŒ‡çš„æ˜¯ä»ä¸€ä¸ªOperatoråˆ°å¦ä¸€ä¸ªOperatorï¼ŒåŒæ ·çš„æ•°æ®ï¼Œæ— è®ºé‡å¤å¤„ç†å¤šå°‘æ¬¡ï¼Œæœ€ç»ˆçš„ç»“æœçŠ¶æ€æ˜¯Exactly-Onceã€‚Spark Streamingä¿è¯Exactly-Onceè¯­ä¹‰ä¸€ä¸ªSpark Streamingæµå¤„ç†ç¨‹åºï¼Œä»å¹¿ä¹‰ä¸Šè®²ï¼ŒåŒ…å«ä¸‰ä¸ªæ­¥éª¤ã€‚æ¥æ”¶æ•°æ®:ä»Sourceä¸­æ¥æ”¶æ•°æ®ã€‚è½¬æ¢æ•°æ®:ç”¨DStreamå’ŒRDDç®—å­è½¬æ¢ã€‚å‚¨å­˜æ•°æ®:å°†ç»“æœä¿å­˜è‡³å¤–éƒ¨ç³»ç»Ÿã€‚å¦‚æœæµå¤„ç†ç¨‹åºéœ€è¦å®ç°Exactly-Onceè¯­ä¹‰ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªæ­¥éª¤éƒ½è¦ä¿è¯Exactly-Onceã€‚æ¥æ”¶æ•°æ®Exactly-OnceSpark Streamingä¸Šæ¸¸å¯¹æ¥kafkaæ—¶å¦‚ä½•ä¿è¯Exactly Onceï¼Ÿç®€è¦è¯´ä¸€ä¸‹ï¼ŒSpark Streamingä½¿ç”¨Directæ¨¡å¼å¯¹æ¥ä¸Šæ¸¸kafkaã€‚æ— è®ºkafkaæœ‰å¤šå°‘ä¸ªpartitionï¼Œ ä½¿ç”¨Directæ¨¡å¼æ€»èƒ½ä¿è¯Spark Streamingä¸­æœ‰ç›¸åŒæ•°é‡çš„partitionä¸ä¹‹ç›¸å¯¹ï¼Œ ä¹Ÿå°±æ˜¯è¯´Spark Streamingä¸­çš„KafkaRDDçš„å¹¶å‘æ•°é‡åœ¨Directæ¨¡å¼ä¸‹æ˜¯ç”±ä¸Šæ¸¸kafkaå†³å®šçš„ã€‚åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œkafkaçš„offsetæ˜¯ä½œä¸ºKafkaRDDçš„ä¸€éƒ¨åˆ†å­˜åœ¨ï¼Œä¼šå­˜å‚¨åœ¨checkpointsä¸­ï¼Œ ç”±äºcheckpointsåªå­˜å‚¨offsetå†…å®¹ï¼Œè€Œä¸å­˜å‚¨æ•°æ®ï¼Œè¿™å°±ä½¿å¾—checkpointsæ˜¯ç›¸å¯¹è½»çš„æ“ä½œã€‚ è¿™å°±ä½¿å¾—Spark Streamingåœ¨é‡åˆ°æ•…éšœæ—¶ï¼Œå¯ä»¥ä»checkpointä¸­æ¢å¤ä¸Šæ¸¸kafkaçš„offsetï¼Œä»è€Œä¿è¯exactly onceã€‚è¿™é‡Œæœ‰ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹è¿™é‡Œæœ‰ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯checkpointæ–¹æ³•åœ¨sparkä¸­ä¸»è¦æœ‰ä¸¤å—åº”ç”¨ï¼šä¸€å—æ˜¯åœ¨spark coreä¸­å¯¹RDDåšcheckpointï¼Œå¯ä»¥åˆ‡æ–­åšcheckpoint RDDçš„ä¾èµ–å…³ç³»ï¼Œå°†RDDæ•°æ®ä¿å­˜åˆ°å¯é å­˜å‚¨ï¼ˆå¦‚HDFSï¼‰ä»¥ä¾¿æ•°æ®æ¢å¤ï¼›å¦å¤–ä¸€å—æ˜¯åº”ç”¨åœ¨spark streamingä¸­ï¼Œä½¿ç”¨checkpointç”¨æ¥ä¿å­˜DStreamGraphä»¥åŠç›¸å…³é…ç½®ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨Driverå´©æºƒé‡å¯çš„æ—¶å€™èƒ½å¤Ÿæ¥ç€ä¹‹å‰è¿›åº¦ç»§ç»­è¿›è¡Œå¤„ç† ï¼ˆå¦‚ä¹‹å‰waiting batchçš„jobä¼šåœ¨é‡å¯åç»§ç»­å¤„ç†ï¼‰ã€‚1.1 checkpoint æœºåˆ¶èƒ½å‡†ç¡®ä¿è¯ä¸é‡å¤æ¶ˆè´¹å—ï¼Ÿè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦æ˜ç¡®checkpointè¿™ä¸ªåŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ã€‚cache å’Œcheckpointçš„åŒºåˆ«å’Œè”ç³»- Checkpoint çš„å±€é™1.2 è§£å†³checkpointè‡ªèº«ç¼ºé™·çš„æ–¹æ¡ˆï¼Ÿé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œåœ¨æˆ‘ä»¬ç»“åˆ Spark Streaming + kafka çš„åº”ç”¨ä¸­ï¼Œ æˆ‘ä»¬è‡ªè¡Œç»´æŠ¤äº†æ¶ˆè´¹çš„ offsetsï¼Œè¿™æ ·ä¸€æ¥å³ä½¿é‡æ–°ç¼–è¯‘ applicationï¼Œ è¿˜æ˜¯å¯ä»¥ä»éœ€è¦çš„ offsets æ¥æ¶ˆè´¹æ•°æ®ã€‚å°† Spark Streaming + Kafka direct çš„ offset å­˜å…¥Zookeeperå¹¶é‡ç”¨Spark Streaming Crash å¦‚ä½•ä¿è¯Exactly Once SemanticsSpark Streaming ä¸ Kafka é›†æˆåˆ†æExactly-Once Streaming from Kafka1.3 checkpointé”™è¯¯å®ç°ä¸»è¦å‡ºç°çš„é—®é¢˜æ˜¯é’ˆå¯¹streamæ“ä½œçš„æ—¶å€™ï¼Œå‡ºç°åœ¨äº†functionToCreateContextå‡½æ•°çš„å¤–é¢ï¼›è¿™æ ·çš„è¯ï¼Œä¼šå¯¼è‡´ä¸‹æ¬¡å¯åŠ¨çš„æ—¶å€™ï¼Œå‡å¦‚æƒ³é€šè¿‡checkpointå¯åŠ¨çš„è¯ä¼šæ²¡æ³•åˆå§‹åŒ–çš„é”™è¯¯ï¼›1val ssc = StreamingContext.getOrCreate(checkpointDirectory, functionToCreateContext)https://stackoverflow.com/questions/35090180/why-does-spark-throw-sparkexception-dstream-has-not-been-initialized-when-resä¸‹é¢æœ‰ä¸ªä¸­æ–‡çš„è¯¦ç»†çš„ä»‹ç»ï¼š https://blog.csdn.net/Dax1n/article/details/534256681.4 æ­£ç¡®çš„å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142import org.apache.spark.streaming.&#123;Seconds, StreamingContext&#125;import org.apache.kafka.common.serialization.StringDeserializerimport org.apache.spark.&#123;SparkConf, TaskContext&#125;import org.apache.spark.streaming.kafka010._import org.apache.spark.streaming.kafka010.ConsumerStrategies.Subscribeimport org.apache.spark.streaming.kafka010.LocationStrategies.PreferConsistentobject feed_ops &#123; def main(args: Array[String]): Unit = &#123; val checkpointDirectory = \"./check\" def functionToCreateContext(): StreamingContext = &#123; val conf = new SparkConf().setMaster(\"local[2]\").setAppName(\"feed:alg:test\") val ssc = new StreamingContext(conf, Seconds(1)) ssc.checkpoint(checkpointDirectory) // set checkpoint directory val kafkaParams = Map[String, Object] ( \"bootstrap.servers\" -&gt; \"xxx:9092\", \"key.deserializer\" -&gt; classOf[StringDeserializer], \"value.deserializer\" -&gt; classOf[StringDeserializer], \"group.id\" -&gt; \"feed:alg:test\", \"auto.offset.reset\" -&gt; \"earliest\", \"enable.auto.commit\" -&gt; (false: java.lang.Boolean) ) val topics = Array(\"test\") val stream = KafkaUtils.createDirectStream(ssc, PreferConsistent, Subscribe[String, String](topics, kafkaParams)) stream.map(record =&gt; (record.key, record.value)). filter(x=&gt;x._2.contains(\"kankan_v2\")).filter(x=&gt;x._2.contains(\"NewsList\") || x._2.contains(\"NewsPage\") ). map(x =&gt;(x._1, x._2.split(\"\\u0001\",0).filter(x=&gt;x!=\"\")) ).map(x=&gt;(x._1, x._2.mkString(\"^\"))). print() stream.foreachRDD &#123; rdd =&gt; val offsetRanges = rdd.asInstanceOf[HasOffsetRanges].offsetRanges rdd.foreachPartition &#123; iter =&gt; val o:OffsetRange = offsetRanges(TaskContext.get.partitionId) println(\"data: \", iter.map(x=&gt;(x.key, x.value)).take(2).foreach(println)) println(s\"$&#123;o.topic&#125; $&#123;o.partition&#125; $&#123;o.fromOffset&#125; $&#123;o.untilOffset&#125;\") &#125; &#125; ssc &#125; val ssc = StreamingContext.getOrCreate(checkpointDirectory, functionToCreateContext) ssc.start() ssc.awaitTermination() &#125;&#125;1.5 streamingä¸­checkpointå†™æµç¨‹åŒæ ·ï¼Œé’ˆå¯¹streamingä¸­checkpointçš„å†™æµç¨‹ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼Œå¹¶å¯¹æ­¤åšç›¸å…³è§£é‡Šã€‚Q1ï¼šstreamingä¸­checkpointæ˜¯åœ¨ä½•æ—¶åšçš„ï¼ŸA1ï¼šåœ¨spark streamingä¸­ï¼ŒjobGeneratorä¼šå®šæœŸç”Ÿæˆä»»åŠ¡ï¼ˆjobGenerator.generateJobs)ã€‚åœ¨ä»»åŠ¡ç”Ÿæˆåå°†ä¼šè°ƒç”¨doCheckpointæ–¹æ³•å¯¹ç³»ç»Ÿåšcheckpointã€‚æ­¤å¤–ï¼Œåœ¨å½“å‰æ‰¹æ¬¡ä»»åŠ¡ç»“æŸï¼Œæ¸…ç†metadataï¼ˆjobGenerator.clearMetadataï¼‰æ—¶ï¼Œä¹Ÿä¼šè°ƒç”¨doCheckpointæ–¹æ³•ã€‚Q2ï¼šåœ¨streaming checkpointè¿‡ç¨‹ä¸­ï¼Œå…·ä½“éƒ½å†™å…¥äº†å“ªäº›æ•°æ®åˆ°checkpointç›®å½•ï¼ŸA2: åšcheckpointçš„ä¸»è¦é€»è¾‘åŸºæœ¬éƒ½åœ¨JobGenerator.doCheckpointæ–¹æ³•ä¸­ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œé¦–å…ˆæ›´æ–°å½“å‰æ—¶é—´æ®µéœ€è¦åšcheckpoint RDDçš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚åœ¨DirectKafkaInputDStreamä¸­ï¼Œå°†å·²ç»ç”Ÿæˆçš„RDDä¿¡æ¯çš„æ—¶é—´ï¼Œtopicï¼Œpartitionï¼Œoffsetç­‰ç›¸å…³ä¿¡æ¯è¿›è¡Œæ›´æ–°ã€‚å…¶æ¬¡ï¼Œé€šè¿‡checkpointWriterå°†Checkpointå¯¹è±¡å†™å…¥åˆ°checkpointç›®å½•ä¸­ï¼ˆCheckPoint.write â†’ CheckpointWriteHandleï¼‰ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬æ¸…æ¥šäº†ï¼Œå†™å…¥åˆ°checkpointç›®å½•çš„æ•°æ®å…¶å®å°±æ˜¯Checkpointå¯¹è±¡ã€‚Checkpointä¸»è¦åŒ…å«çš„ä¿¡æ¯å¦‚ä¸‹ï¼š12345678val master = ssc.sc.masterval framework = ssc.sc.appNameval jars = ssc.sc.jarsval graph = ssc.graphval checkpointDir = ssc.checkpointDirval checkpointDuration = ssc.checkpointDurationval pendingTimes = ssc.scheduler.getPendingTimes().toArrayval sparkConfPairs = ssc.conf.getAllå…·ä½“åŒ…æ‹¬ç›¸å…³é…ç½®ä¿¡æ¯ï¼Œcheckpointç›®å½•ï¼ŒDStreamGraphç­‰ã€‚å¯¹äºDStreamGraphï¼Œä¸»è¦åŒ…å«InputDstreamä»¥åŠoutputStreamç­‰ç›¸å…³ä¿¡æ¯ï¼Œä»è€Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå®šä¹‰åº”ç”¨ç›¸å…³çš„è®¡ç®—å‡½æ•°ä¹Ÿè¢«åºåˆ—åŒ–ä¿å­˜åˆ°checkpointç›®å½•ä¸­äº†ã€‚Q3: streaming checkpointéƒ½æœ‰å“ªäº›å‘ï¼ŸA3ï¼šä»A2ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåº”ç”¨å®šä¹‰çš„è®¡ç®—å‡½æ•°ä¹Ÿè¢«åºåˆ—åŒ–åˆ°checkpointç›®å½•ï¼Œå½“åº”ç”¨ä»£ç å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ­¤æ—¶å°±æ²¡æ³•ä»checkpointæ¢å¤ã€‚ä¸ªäººæ„Ÿè§‰è¿™æ˜¯checkpointåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸­ç¢°åˆ°çš„æœ€å¤§éšœç¢ã€‚å¦å¤–ï¼Œå½“ä»checkpointç›®å½•æ¢å¤streamingContextæ—¶ï¼Œé…ç½®ä¿¡æ¯ä¹Ÿéƒ½æ˜¯ä»checkpointè¯»å–çš„ï¼ˆåªæœ‰å¾ˆå°‘çš„ä¸€éƒ¨åˆ†é…ç½®æ˜¯reloadçš„ï¼Œå…·ä½“è§è¯»æµç¨‹ï¼‰ï¼Œå½“é‡å¯ä»»åŠ¡æ—¶ï¼Œæ–°æ”¹å˜çš„é…ç½®å°±å¯èƒ½ä¸ç”Ÿæ•ˆï¼Œå¯¼è‡´å¾ˆå¥‡æ€ªçš„é—®é¢˜ã€‚æ­¤å¤–ï¼Œbroadcastå˜é‡åœ¨checkpointä¸­ä½¿ç”¨ä¹Ÿå—åˆ°é™åˆ¶ï¼ˆSPARK-5206ï¼‰ã€‚è¾“å‡ºæ•°æ®Exactly-Onceé¦–å…ˆè¾“å‡ºæ“ä½œæ˜¯å…·æœ‰At-least Onceè¯­ä¹‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´Spark Streamingå¯ä»¥ä¿è¯éœ€è¦è¾“å‡ºçš„æ•°æ®ä¸€å®šä¼šè¾“å‡ºå‡ºå»ï¼Œåªä¸è¿‡ç”±äºå¤±è´¥ç­‰åŸå› å¯èƒ½ä¼šè¾“å‡ºå¤šæ¬¡ã€‚ é‚£ä¹ˆå¦‚ä½•ä¿è¯Exactly onceï¼Ÿç¬¬ä¸€ç§å¹‚ç­‰è¾“å‡ºï¼Œå°±æ˜¯æœŸæœ›ä¸‹æ¸¸ï¼ˆæ•°æ®ï¼‰å…·æœ‰å¹‚ç­‰ç‰¹æ€§ã€‚å°†kafkaå‚æ•°enable.auto.commitè®¾ç½®ä¸ºfalseã€‚ç”Ÿäº§ä¸­å¯ç”¨Kafkaã€Zookeeperã€HBaseç­‰ä¿å­˜offsetã€‚ç¬¬äºŒç§ä½¿ç”¨äº‹åŠ¡æ›´æ–°1234567dstream.foreachRDD &#123; (rdd, time) =&gt; rdd.foreachPartition &#123; partitionIterator =&gt; val partitionId = TaskContext.get.partitionId() val uniqueId = generateUniqueId(time.milliseconds, partitionId) // use this uniqueId to transactionally commit the data in partitionIterator &#125;&#125;è¿™æ ·ä¿è¯åŒä¸€ä¸ªpartitionè¦ä¹ˆä¸€èµ·æ›´æ–°æˆåŠŸï¼Œè¦ä¹ˆä¸€èµ·å¤±è´¥ï¼Œé€šè¿‡uniqueIdæ¥æ ‡è¯†è¿™ä¸€æ¬¡çš„æ›´æ–°ï¼Œè¿™å°±è¦æ±‚ä¸‹æ¸¸æ”¯æŒäº‹åŠ¡æœºåˆ¶ã€‚è½¬æ¢æ•°æ®Exactly-OnceSpark Streamingå†…éƒ¨çš„å®ç°æœºåˆ¶æ˜¯åŸºäºRDDæ¨¡å‹çš„ï¼ŒRDDä¸ºä¿è¯è®¡ç®—è¿‡ç¨‹ä¸­æ•°æ®ä¸ä¸¢å¤±ä½¿ç”¨äº†checkpointæœºåˆ¶ï¼Œ ä¹Ÿå°±æ˜¯è¯´å…¶è®¡ç®—é€»è¾‘æ˜¯RDDçš„å˜æ¢è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯DAGï¼Œå¯ä»¥åœ¨è®¡ç®—è¿‡ç¨‹ä¸­çš„ä»»ä½•ä¸€ä¸ªé˜¶æ®µï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªé˜¶æ®µçš„RDDï¼‰ ä¸Šä½¿ç”¨checkpointæ–¹æ³•ï¼Œå°±å¯ä»¥ä¿è¯å½“åç»­è®¡ç®—å¤±è´¥ï¼Œå¯ä»¥ä»è¿™ä¸ªcheckpointé‡æ–°ç®—èµ·ï¼Œä½¿å¾—è®¡ç®—å»¶ç»­ä¸‹å»ã€‚å½“Spark Streamingåœºæ™¯ä¸‹ï¼Œå…¶å¤©ç„¶ä¼šè¿›è¡Œbatchæ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´kafkaè¿‡æ¥çš„æ•°æ®ï¼Œ æ¯ç§’ï¼ˆä¸€ä¸ªå›ºå®šbatchçš„æ—¶é—´å‘¨æœŸï¼‰ä¼šå¯¹å½“å‰kafkaä¸­çš„æ•°æ®äº§ç”Ÿä¸€ä¸ªRDDï¼Œ é‚£ä¹ˆåç»­è®¡ç®—å°±æ˜¯åœ¨è¿™ä¸ªRDDä¸Šè¿›è¡Œçš„ã€‚åªéœ€è¦åœ¨kafkaRDDè¿™ä¸ªä½ç½®åˆç†ä½¿ç”¨äº†checkpoint ï¼ˆè¿™ä¸€ç‚¹åœ¨å‰é¢å·²ç»è®²è¿‡ï¼Œå¯ä»¥ä¿è¯ï¼‰å°±èƒ½ä¿è¯Spark Streamingå†…éƒ¨çš„Exactly onceã€‚æ³¨æ„ä¸€ç‚¹ï¼šSpark Streamingä¸­æ²¡æœ‰Tupleçº§åˆ«çš„ACKï¼Œå…¶æ“ä½œå¿…ç„¶æ˜¯åœ¨RDDçš„æŸä¸ªpartitionä¸Šçš„ï¼Œ è¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆä¸åšï¼Œè¦ä¹ˆå¤±è´¥ï¼Œè¦ä¹ˆæˆåŠŸï¼Œéƒ½æ˜¯åŸºäºRDDçš„partitionçš„ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"Kafka Exactly once è¯­ä¹‰","slug":"Kafka-Exactly-once-è¯­ä¹‰","date":"2019-01-04T10:23:47.000Z","updated":"2020-07-11T10:26:18.303Z","comments":true,"path":"2019/01/04/Kafka-Exactly-once-è¯­ä¹‰/","link":"","permalink":"cpeixin.cn/2019/01/04/Kafka-Exactly-once-%E8%AF%AD%E4%B9%89/","excerpt":"","text":"åœ¨å¾ˆå¤šçš„æµå¤„ç†æ¡†æ¶çš„ä»‹ç»ä¸­ï¼Œéƒ½ä¼šè¯´kafkaæ˜¯ä¸€ä¸ªå¯é çš„æ•°æ®æºï¼Œå¹¶ä¸”æ¨èä½¿ç”¨Kafkaå½“ä½œæ•°æ®æºæ¥è¿›è¡Œä½¿ç”¨ã€‚è¿™æ˜¯å› ä¸ºä¸å…¶ä»–æ¶ˆæ¯å¼•æ“ç³»ç»Ÿç›¸æ¯”ï¼Œkafkaæä¾›äº†å¯é çš„æ•°æ®ä¿å­˜åŠå¤‡ä»½æœºåˆ¶ã€‚å¹¶ä¸”é€šè¿‡æ¶ˆè´¹è€…ä½ç§»è¿™ä¸€æ¦‚å¿µï¼Œå¯ä»¥è®©æ¶ˆè´¹è€…åœ¨å› æŸäº›åŸå› å®•æœºè€Œé‡å¯åï¼Œå¯ä»¥è½»æ˜“å¾—å›åˆ°å®•æœºå‰çš„ä½ç½®ã€‚ä½†å…¶å®kafkaçš„å¯é æ€§ä¹Ÿåªèƒ½è¯´æ˜¯ç›¸å¯¹çš„ï¼Œåœ¨æ•´æ¡æ•°æ®é“¾æ¡ä¸­ï¼Œæ€»æœ‰å¯ä»¥è®©æ•°æ®å‡ºç°ä¸¢å¤±çš„æƒ…å†µï¼Œä»Šå¤©å°±æ¥è®¨è®ºå¦‚ä½•é¿å…kafkaæ•°æ®ä¸¢å¤±ï¼Œä»¥åŠå®ç°ç²¾ç¡®ä¸€è‡´å¤„ç†çš„è¯­ä¹‰ã€‚kafkaæ— æ¶ˆæ¯ä¸¢å¤±å¤„ç†åœ¨è®¨è®ºå¦‚ä½•å®ç°kafkaæ— æ¶ˆæ¯ä¸¢å¤±çš„æ—¶å€™ï¼Œé¦–å…ˆè¦å…ˆæ¸…æ¥šå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ¶ˆæ¯ä¸¢å¤±æ˜¯åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å‘ç”Ÿçš„ã€‚ä¸ºä»€ä¹ˆæ˜¯å¤§éƒ¨åˆ†ï¼Œå› ä¸ºæ€»æœ‰ä¸€äº›éå¸¸ç‰¹æ®Šçš„æƒ…å†µä¼šè¢«äººå¿½ç•¥ï¼Œè€Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨æ™®éçš„æƒ…å†µå°±è¶³å¤Ÿäº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è®¨è®ºå¦‚ä½•è¾ƒä¸ºæ™®éçš„æ•°æ®ä¸¢å¤±æƒ…å†µã€‚1.1 ç”Ÿäº§è€…ä¸¢å¤±åœ¨Kafkaåˆ†åŒºå’Œå‰¯æœ¬ä¸­ï¼Œproducerå®¢æˆ·ç«¯æœ‰ä¸€ä¸ªacksçš„é…ç½®ï¼Œè¿™ä¸ªé…ç½®ä¸º0çš„æ—¶å€™ï¼Œproduceræ˜¯å‘é€ä¹‹åä¸ç®¡çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±å¾ˆæœ‰å¯èƒ½å› ä¸ºç½‘ç»œç­‰åŸå› é€ æˆæ•°æ®ä¸¢å¤±ï¼Œæ‰€ä»¥åº”è¯¥å°½é‡é¿å…ã€‚ä½†æ˜¯å°†ackè®¾ç½®ä¸º1å°±æ²¡é—®é¢˜äº†å—ï¼Œé‚£ä¹Ÿä¸ä¸€å®šï¼Œå› ä¸ºæœ‰å¯èƒ½åœ¨leaderå‰¯æœ¬æ¥æ”¶åˆ°æ•°æ®ï¼Œä½†è¿˜æ²¡åŒæ­¥ç»™å…¶ä»–å‰¯æœ¬çš„æ—¶å€™å°±æŒ‚æ‰äº†ï¼Œè¿™æ—¶å€™æ•°æ®ä¹Ÿæ˜¯ä¸¢å¤±äº†ã€‚å¹¶ä¸”è¿™ç§æ—¶å€™æ˜¯å®¢æˆ·ç«¯ä»¥ä¸ºæ¶ˆæ¯å‘é€æˆåŠŸï¼Œä½†kafkaä¸¢å¤±äº†æ•°æ®ã€‚è¦è¾¾åˆ°æœ€ä¸¥æ ¼çš„æ— æ¶ˆæ¯ä¸¢å¤±é…ç½®ï¼Œåº”è¯¥æ˜¯è¦å°†acksçš„å‚æ•°è®¾ç½®ä¸º-1ï¼ˆä¹Ÿå°±æ˜¯allï¼‰ï¼Œå¹¶ä¸”å°†min.insync.replicasé…ç½®é¡¹è°ƒé«˜åˆ°å¤§äº1ï¼ŒåŒæ—¶è¿˜éœ€è¦ä½¿ç”¨å¸¦æœ‰å›è°ƒçš„producer apiï¼Œæ¥å‘é€æ•°æ®ã€‚æ³¨æ„è¿™é‡Œè®¨è®ºçš„éƒ½æ˜¯å¼‚æ­¥å‘é€æ¶ˆæ¯ï¼ŒåŒæ­¥å‘é€ä¸åœ¨è®¨è®ºèŒƒå›´ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041public class send&#123; ...... public static void main()&#123; ... /* * ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ ProducerRecord ç±»å‹çš„å¯¹è±¡ï¼Œå°è£…äº†ç›®æ ‡ Topicï¼Œæ¶ˆæ¯çš„ kv * ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª CallBack å¯¹è±¡ï¼Œå½“ç”Ÿäº§è€…æ¥æ”¶åˆ° Kafka å‘æ¥çš„ ACK ç¡®è®¤æ¶ˆæ¯çš„æ—¶å€™ï¼Œ * ä¼šè°ƒç”¨æ­¤ CallBack å¯¹è±¡çš„ onCompletion() æ–¹æ³•ï¼Œå®ç°å›è°ƒåŠŸèƒ½ */ producer.send(new ProducerRecord&lt;&gt;(topic, messageNo, messageStr), new DemoCallBack(startTime, messageNo, messageStr)); ... &#125; ......&#125;class DemoCallBack implements Callback &#123; /* å¼€å§‹å‘é€æ¶ˆæ¯çš„æ—¶é—´æˆ³ */ private final long startTime; private final int key; private final String message; public DemoCallBack(long startTime, int key, String message) &#123; this.startTime = startTime; this.key = key; this.message = message; &#125; /** * ç”Ÿäº§è€…æˆåŠŸå‘é€æ¶ˆæ¯ï¼Œæ”¶åˆ° Kafka æœåŠ¡ç«¯å‘æ¥çš„ ACK ç¡®è®¤æ¶ˆæ¯åï¼Œä¼šè°ƒç”¨æ­¤å›è°ƒå‡½æ•° * @param metadata ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯çš„å…ƒæ•°æ®ï¼Œå¦‚æœå‘é€è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œæ­¤å‚æ•°ä¸º null * @param exception å‘é€è¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ï¼Œå¦‚æœå‘é€æˆåŠŸä¸º null */ @Override public void onCompletion(RecordMetadata metadata, Exception exception) &#123; long elapsedTime = System.currentTimeMillis() - startTime; if (metadata != null) &#123; System.out.printf(\"message: (%d, %s) send to partition %d, offset: %d, in %d\\n\", key, message, metadata.partition(), metadata.offset(), elapsedTime); &#125; else &#123; exception.printStackTrace(); &#125; &#125;&#125;æˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡ï¼Œproducerå‘é€åˆ°kafka brokerçš„æ—¶å€™ï¼Œæ˜¯æœ‰å¤šç§å¯èƒ½ä¼šå¤±è´¥çš„ï¼Œè€Œå›è°ƒå‡½æ•°èƒ½å‡†ç¡®å‘Šè¯‰ä½ æ˜¯å¦ç¡®è®¤å‘é€æˆåŠŸï¼Œå½“ç„¶è¿™ä¾æ‰˜äºackså’Œmin.insync.replicasçš„é…ç½®ã€‚è€Œå½“æ•°æ®å‘é€ä¸¢å¤±çš„æ—¶å€™ï¼Œå°±å¯ä»¥è¿›è¡Œæ‰‹åŠ¨é‡å‘æˆ–å…¶ä»–æ“ä½œï¼Œä»è€Œç¡®ä¿ç”Ÿäº§è€…å‘é€æˆåŠŸã€‚1.2 kafkaå†…éƒ¨ä¸¢å¤±æœ‰äº›æ—¶å€™ï¼Œkafkaå†…éƒ¨å› ä¸ºä¸€äº›ä¸å¤§å¥½çš„é…ç½®ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€äº›æä¸ºéšè”½çš„æ•°æ®ä¸¢å¤±æƒ…å†µï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ†åˆ«è®¨è®ºä¸‹å¤§è‡´éƒ½æœ‰å“ªå‡ ç§æƒ…å†µã€‚é¦–å…ˆæ˜¯replication.factoré…ç½®å‚æ•°ï¼Œè¿™ä¸ªé…ç½®å†³å®šäº†å‰¯æœ¬çš„æ•°é‡ï¼Œé»˜è®¤æ˜¯1ã€‚æ³¨æ„è¿™ä¸ªå‚æ•°ä¸èƒ½è¶…è¿‡brokerçš„æ•°é‡ã€‚è¯´è¿™ä¸ªå‚æ•°å…¶å®æ˜¯å› ä¸ºå¦‚æœä½¿ç”¨é»˜è®¤çš„1ï¼Œæˆ–è€…ä¸åœ¨åˆ›å»ºtopicçš„æ—¶å€™æŒ‡å®šå‰¯æœ¬æ•°é‡ï¼ˆä¹Ÿå°±æ˜¯å‰¯æœ¬æ•°ä¸º1ï¼‰ï¼Œé‚£ä¹ˆå½“ä¸€å°æœºå™¨å‡ºç°ç£ç›˜æŸåç­‰æƒ…å†µï¼Œé‚£ä¹ˆæ•°æ®ä¹Ÿå°±ä»kafkaé‡Œé¢ä¸¢å¤±äº†ã€‚æ‰€ä»¥replication.factorè¿™ä¸ªå‚æ•°æœ€å¥½æ˜¯é…ç½®å¤§äº1ï¼Œæ¯”å¦‚è¯´3ã€‚æ¥ä¸‹æ¥è¦è¯´çš„è¿˜æ˜¯å’Œå‰¯æœ¬ç›¸å…³çš„ï¼Œä¹Ÿæ˜¯ä¸Šä¸€ç¯‡å‰¯æœ¬ä¸­æåˆ°çš„unclean.leader.election.enable å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯åœ¨ä¸»å‰¯æœ¬æŒ‚æ‰ï¼Œç„¶ååœ¨ISRé›†åˆä¸­æ²¡æœ‰å‰¯æœ¬å¯ä»¥æˆä¸ºleaderçš„æ—¶å€™ï¼Œè¦ä¸è¦è®©è¿›åº¦æ¯”è¾ƒæ…¢çš„å‰¯æœ¬æˆä¸ºleaderçš„ã€‚ä¸ç”¨å¤šè¯´ï¼Œè®©è¿›åº¦æ¯”è¾ƒæ…¢çš„å‰¯æœ¬æˆä¸ºleaderï¼Œè‚¯å®šæ˜¯è¦ä¸¢æ•°æ®çš„ã€‚è™½ç„¶å¯èƒ½ä¼šæé«˜ä¸€äº›å¯ç”¨æ€§ï¼Œä½†å¦‚æœä½ çš„ä¸šåŠ¡åœºæ™¯ä¸¢å¤±æ•°æ®æ›´åŠ ä¸èƒ½å¿å—ï¼Œé‚£è¿˜æ˜¯å°†unclean.leader.election.enableè®¾ç½®ä¸ºfalseå§ã€‚1.3 æ¶ˆè´¹è€…ä¸¢å¤±æ¶ˆè´¹è€…ä¸¢å¤±çš„æƒ…å†µï¼Œå…¶å®è·Ÿæ¶ˆè´¹è€…ä½ç§»å¤„ç†ä¸å½“æœ‰å…³ã€‚æ¶ˆè´¹è€…ä½ç§»æäº¤æœ‰ä¸€ä¸ªå‚æ•°ï¼Œenable.auto.commitï¼Œé»˜è®¤æ˜¯trueï¼Œå†³å®šæ˜¯å¦è¦è®©æ¶ˆè´¹è€…è‡ªåŠ¨æäº¤ä½ç§»ã€‚å¦‚æœå¼€å¯ï¼Œé‚£ä¹ˆconsumeræ¯æ¬¡éƒ½æ˜¯å…ˆæäº¤ä½ç§»ï¼Œå†è¿›è¡Œæ¶ˆè´¹ï¼Œæ¯”å¦‚å…ˆè·Ÿbrokerè¯´è¿™5ä¸ªæ•°æ®æˆ‘æ¶ˆè´¹å¥½äº†ï¼Œç„¶åæ‰å¼€å§‹æ…¢æ…¢æ¶ˆè´¹è¿™5ä¸ªæ•°æ®ã€‚è¿™æ ·å¤„ç†çš„è¯ï¼Œå¥½å¤„æ˜¯ç®€å•ï¼Œåå¤„å°±æ˜¯æ¼æ¶ˆè´¹æ•°æ®ï¼Œæ¯”å¦‚ä½ è¯´è¦æ¶ˆè´¹5ä¸ªæ•°æ®ï¼Œæ¶ˆè´¹äº†2ä¸ªè‡ªå·±å°±æŒ‚äº†ã€‚é‚£ä¸‹æ¬¡è¯¥consumeré‡å¯åï¼Œåœ¨brokerçš„è®°å½•ä¸­è¿™ä¸ªconsumeræ˜¯å·²ç»æ¶ˆè´¹äº†5ä¸ªçš„ã€‚æ‰€ä»¥æœ€å¥½çš„åšæ³•å°±æ˜¯å°†enable.auto.commitè®¾ç½®ä¸ºfalseï¼Œæ”¹ä¸ºæ‰‹åŠ¨æäº¤ä½ç§»ï¼Œåœ¨æ¯æ¬¡æ¶ˆè´¹å®Œä¹‹åå†æ‰‹åŠ¨æäº¤ä½ç§»ä¿¡æ¯ã€‚å½“ç„¶è¿™æ ·åˆæœ‰å¯èƒ½ä¼šé‡å¤æ¶ˆè´¹æ•°æ®ï¼Œæ¯•ç«Ÿexactly onceå¤„ç†ä¸€ç›´æ˜¯ä¸€ä¸ªé—®é¢˜å‘€ï¼ˆ/æ‘Šæ‰‹ï¼‰ã€‚é—æ†¾çš„æ˜¯kafkaç›®å‰æ²¡æœ‰ä¿è¯consumerå¹‚ç­‰æ¶ˆè´¹çš„æªæ–½ï¼Œå¦‚æœç¡®å®éœ€è¦ä¿è¯consumerçš„å¹‚ç­‰ï¼Œå¯ä»¥å¯¹æ¯æ¡æ¶ˆæ¯ç»´æŒä¸€ä¸ªå…¨å±€çš„idï¼Œæ¯æ¬¡æ¶ˆè´¹è¿›è¡Œå»é‡ï¼Œå½“ç„¶è€—è´¹è¿™ä¹ˆå¤šçš„èµ„æºæ¥å®ç°exactly onceçš„æ¶ˆè´¹åˆ°åº•å€¼ä¸å€¼ï¼Œé‚£å°±å¾—çœ‹å…·ä½“ä¸šåŠ¡äº†ã€‚1.4 æ— æ¶ˆæ¯ä¸¢å¤±å°ç»“é‚£ä¹ˆåˆ°è¿™é‡Œå…ˆæ¥æ€»ç»“ä¸‹æ— æ¶ˆæ¯ä¸¢å¤±çš„ä¸»è¦é…ç½®å§ï¼šproducerçš„acksè®¾ç½®ä½-1ï¼ŒåŒæ—¶min.insync.replicasè®¾ç½®å¤§äº1ã€‚å¹¶ä¸”ä½¿ç”¨å¸¦æœ‰å›è°ƒçš„producer apiå‘ç”Ÿæ¶ˆæ¯ã€‚é»˜è®¤å‰¯æœ¬æ•°replication.factorè®¾ç½®ä¸ºå¤§äº1ï¼Œæˆ–è€…åˆ›å»ºtopicçš„æ—¶å€™æŒ‡å®šå¤§äº1çš„å‰¯æœ¬æ•°ã€‚unclean.leader.election.enable è®¾ç½®ä¸ºfalseï¼Œé˜²æ­¢å®šæœŸå‰¯æœ¬leaderé‡é€‰ä¸¾æ¶ˆè´¹è€…ç«¯ï¼Œè‡ªåŠ¨æäº¤ä½ç§»enable.auto.commitè®¾ç½®ä¸ºfalseã€‚åœ¨æ¶ˆè´¹å®Œåæ‰‹åŠ¨æäº¤ä½ç§»ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ¥è¯´è¯´kafkaå®ç°ç²¾ç¡®ä¸€æ¬¡ï¼ˆexactly onceï¼‰å¤„ç†çš„æ–¹æ³•å§ã€‚å®ç°ç²¾ç¡®ä¸€æ¬¡ï¼ˆexactly onceï¼‰å¤„ç†åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œè¦å®ç°æ¶ˆæ¯ä¸€è‡´ä¸ç²¾ç¡®ä¸€æ¬¡ï¼ˆexactly onceï¼‰è¯­ä¹‰å¤„ç†æ˜¯å¾ˆéš¾çš„ã€‚ç²¾ç¡®ä¸€æ¬¡å¤„ç†æ„å‘³ç€ä¸€ä¸ªæ¶ˆæ¯åªå¤„ç†ä¸€æ¬¡ï¼Œé€ æˆä¸€æ¬¡çš„æ•ˆæœï¼Œä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘ã€‚é‚£ä¹ˆkafkaå¦‚ä½•èƒ½å¤Ÿå®ç°è¿™æ ·çš„æ•ˆæœå‘¢ï¼Ÿåœ¨ä»‹ç»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ä»‹ç»å…¶ä»–ä¸¤ä¸ªè¯­ä¹‰ï¼Œè‡³å¤šä¸€æ¬¡ï¼ˆat most onceï¼‰å’Œè‡³å°‘ä¸€æ¬¡ï¼ˆat least onceï¼‰ã€‚æœ€å¤šä¸€æ¬¡å’Œè‡³å°‘ä¸€æ¬¡æœ€å¤šä¸€æ¬¡å°±æ˜¯ä¿è¯ä¸€æ¡æ¶ˆæ¯åªå‘é€ä¸€æ¬¡ï¼Œè¿™ä¸ªå…¶å®æœ€ç®€å•ï¼Œå¼‚æ­¥å‘é€ä¸€æ¬¡ç„¶åä¸ç®¡å°±å¯ä»¥ï¼Œç¼ºç‚¹æ˜¯å®¹æ˜“ä¸¢æ•°æ®ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸é‡‡ç”¨ã€‚è‡³å°‘ä¸€æ¬¡è¯­ä¹‰æ˜¯kafkaé»˜è®¤æä¾›çš„è¯­ä¹‰ï¼Œå®ƒä¿è¯æ¯æ¡æ¶ˆæ¯éƒ½èƒ½è‡³å°‘æ¥æ”¶å¹¶å¤„ç†ä¸€æ¬¡ï¼Œç¼ºç‚¹æ˜¯å¯èƒ½æœ‰é‡å¤æ•°æ®ã€‚å‰é¢æœ‰ä»‹ç»è¿‡acksæœºåˆ¶ï¼Œå½“è®¾ç½®producerå®¢æˆ·ç«¯çš„acksæ˜¯1çš„æ—¶å€™ï¼Œbrokeræ¥æ”¶åˆ°æ¶ˆæ¯å°±ä¼šè·Ÿproducerç¡®è®¤ã€‚ä½†producerå‘é€ä¸€æ¡æ¶ˆæ¯åï¼Œå¯èƒ½å› ä¸ºç½‘ç»œåŸå› æ¶ˆæ¯è¶…æ—¶æœªè¾¾ï¼Œè¿™æ—¶å€™producerå®¢æˆ·ç«¯ä¼šé€‰æ‹©é‡å‘ï¼Œbrokerå›åº”æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œä½†å¾ˆå¯èƒ½æœ€å¼€å§‹å‘é€çš„æ¶ˆæ¯å»¶è¿Ÿåˆ°è¾¾ï¼Œå°±ä¼šé€ æˆæ¶ˆæ¯é‡å¤æ¥æ”¶ã€‚é‚£ä¹ˆé’ˆå¯¹è¿™äº›æƒ…å†µï¼Œè¦å¦‚ä½•å®ç°ç²¾ç¡®ä¸€æ¬¡å¤„ç†çš„è¯­ä¹‰å‘¢ï¼Ÿä¸šåŠ¡æ§åˆ¶å¯¹ç”Ÿäº§è€…ï¼šæ¯ä¸ªåˆ†åŒºåªæœ‰ä¸€ä¸ªç”Ÿäº§è€…å†™å…¥æ¶ˆæ¯ï¼Œå½“å‡ºç°å¼‚å¸¸æˆ–è¶…æ—¶ï¼Œç”Ÿäº§è€…æŸ¥è¯¢æ­¤åˆ†åŒºæœ€åä¸€ä¸ªæ¶ˆæ¯ï¼Œç”¨äºå†³å®šåç»­æ“ä½œæ—¶é‡ä¼ è¿˜æ˜¯ç»§ç»­å‘é€ã€‚ä¸ºæ¯ä¸ªæ¶ˆæ¯å¢åŠ å”¯ä¸€ä¸»é”®ï¼Œç”Ÿäº§è€…ä¸åšå¤„ç†ï¼Œç”±æ¶ˆè´¹è€…æ ¹æ®ä¸»é”®å»é‡ã€‚å¯¹æ¶ˆè´¹è€…ï¼šå…³é—­è‡ªåŠ¨æäº¤ offset çš„åŠŸèƒ½ï¼Œä¸ä½¿ç”¨ Offsets Topic è¿™ä¸ªå†…éƒ¨ Topic è®°å½•å…¶ offsetï¼Œè€Œæ˜¯ç”±æ¶ˆè´¹è€…è‡ªåŠ¨ä¿å­˜ offsetã€‚å°† offset å’Œæ¶ˆæ¯å¤„ç†æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œé¢ï¼Œäº‹åŠ¡æ‰§è¡ŒæˆåŠŸè®¤ä¸ºæ¶ˆæ¯è¢«æ¶ˆè´¹ï¼Œå¦åˆ™äº‹åŠ¡å›æ»šéœ€è¦é‡æ–°å¤„ç†ã€‚å½“å‡ºç°æ¶ˆè´¹è€…é‡å¯æˆ–è€… Rebalance æ“ä½œï¼Œå¯ä»¥ä»æ•°æ®åº“æ‰¾åˆ°å¯¹åº”çš„ offsetï¼Œç„¶åè°ƒç”¨ KafkaConsumer.seek() è®¾ç½®æ¶ˆè´¹è€…ä½ç½®ï¼Œä»æ­¤ offset å¼€å§‹æ¶ˆè´¹ã€‚kafkaæ§åˆ¶å¹‚ç­‰çš„producerè¦ä»‹ç»å¹‚ç­‰çš„producerä¹‹å‰ï¼Œå¾—å…ˆäº†è§£ä¸€ä¸‹å¹‚ç­‰è¿™ä¸ªè¯æ˜¯ä»€ä¹ˆæ„æ€ã€‚å¹‚ç­‰è¿™ä¸ªè¯æœ€æ—©èµ·æºäºå‡½æ•°å¼ç¼–ç¨‹ï¼Œæ„æ€æ˜¯ä¸€ä¸ªå‡½æ•°æ— è®ºæ‰§è¡Œå¤šå°‘æ¬¡éƒ½ä¼šè¿”å›ä¸€æ ·çš„ç»“æœã€‚æ¯”å¦‚è¯´è®©ä¸€ä¸ªæ•°åŠ 1å°±ä¸æ˜¯å¹‚ç­‰çš„ï¼Œè€Œè®©ä¸€ä¸ªæ•°å–æ•´å°±æ˜¯å¹‚ç­‰çš„ã€‚å› ä¸ºè¿™ä¸ªç‰¹æ€§æ‰€ä»¥å¹‚ç­‰çš„å‡½æ•°é€‚ç”¨äºå¹¶å‘çš„åœºæ™¯ä¸‹ã€‚ä½†å¹‚ç­‰åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å«ä¹‰åˆåšäº†è¿›ä¸€æ­¥çš„å»¶ç”³ï¼Œæ¯”å¦‚åœ¨kafkaä¸­ï¼Œå¹‚ç­‰æ€§æ„å‘³ç€ä¸€ä¸ªæ¶ˆæ¯æ— è®ºé‡å¤å¤šå°‘æ¬¡ï¼Œéƒ½ä¼šè¢«å½“ä½œä¸€ä¸ªæ¶ˆæ¯æ¥æŒä¹…åŒ–å¤„ç†ã€‚kafkaçš„produceré»˜è®¤æ˜¯æ”¯æŒæœ€å°‘ä¸€æ¬¡è¯­ä¹‰ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸æ˜¯å¹‚ç­‰çš„ï¼Œè¿™æ ·åœ¨ä¸€äº›æ¯”å¦‚æ”¯ä»˜ç­‰è¦æ±‚ç²¾ç¡®æ•°æ®çš„åœºæ™¯ä¼šå‡ºç°é—®é¢˜ï¼Œåœ¨0.11.0åï¼Œkafkaæä¾›äº†è®©produceræ”¯æŒå¹‚ç­‰çš„é…ç½®æ“ä½œã€‚å³ï¼šprops.put(â€œenable.idempotenceâ€, ture)åœ¨åˆ›å»ºproducerå®¢æˆ·ç«¯çš„æ—¶å€™ï¼Œæ·»åŠ è¿™ä¸€è¡Œé…ç½®ï¼Œproducerå°±å˜æˆå¹‚ç­‰çš„äº†ã€‚æ³¨æ„å¼€å¯å¹‚ç­‰æ€§çš„æ—¶å€™ï¼Œackså°±è‡ªåŠ¨æ˜¯â€œallâ€äº†ï¼Œå¦‚æœè¿™æ—¶å€™æ‰‹åŠ¨å°†ackssè®¾ç½®ä¸º0ï¼Œé‚£ä¹ˆä¼šæŠ¥é”™ã€‚è€Œåº•å±‚å®ç°å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å¯¹æ¯æ¡æ¶ˆæ¯ç”Ÿæˆä¸€ä¸ªidå€¼ï¼Œbrokerä¼šæ ¹æ®è¿™ä¸ªidå€¼è¿›è¡Œå»é‡ï¼Œä»è€Œå®ç°å¹‚ç­‰ï¼Œè¿™æ ·ä¸€æ¥å°±èƒ½å¤Ÿå®ç°ç²¾ç¡®ä¸€æ¬¡çš„è¯­ä¹‰äº†ã€‚ä½†æ˜¯ï¼å¹‚ç­‰çš„producerä¹Ÿå¹¶éä¸‡èƒ½ã€‚æœ‰ä¸¤ä¸ªä¸»è¦æ˜¯ç¼ºé™·ï¼šå¹‚ç­‰æ€§çš„producerä»…åšåˆ°å•åˆ†åŒºä¸Šçš„å¹‚ç­‰æ€§ï¼Œå³å•åˆ†åŒºæ¶ˆæ¯ä¸é‡å¤ï¼Œå¤šåˆ†åŒºæ— æ³•ä¿è¯å¹‚ç­‰æ€§ã€‚åªèƒ½ä¿æŒå•ä¼šè¯çš„å¹‚ç­‰æ€§ï¼Œæ— æ³•å®ç°è·¨ä¼šè¯çš„å¹‚ç­‰æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœproduceræŒ‚æ‰å†é‡å¯ï¼Œæ— æ³•ä¿è¯ä¸¤ä¸ªä¼šè¯é—´çš„å¹‚ç­‰ï¼ˆæ–°ä¼šè¯å¯èƒ½ä¼šé‡å‘ï¼‰ã€‚å› ä¸ºbrokerç«¯æ— æ³•è·å–ä¹‹å‰çš„çŠ¶æ€ä¿¡æ¯ï¼Œæ‰€ä»¥æ— æ³•å®ç°è·¨ä¼šè¯çš„å¹‚ç­‰ã€‚äº‹åŠ¡çš„producerä¸Šè¿°å¹‚ç­‰è®¾è®¡åªèƒ½ä¿è¯å•ä¸ª Producer å¯¹äºåŒä¸€ä¸ª &lt;Topic, Partition&gt; çš„ Exactly Once è¯­ä¹‰ã€‚Kafka ç°åœ¨é€šè¿‡æ–°çš„äº‹åŠ¡ API æ”¯æŒè·¨åˆ†åŒºåŸå­å†™å…¥ã€‚è¿™å°†å…è®¸ä¸€ä¸ªç”Ÿäº§è€…å‘é€ä¸€æ‰¹åˆ°ä¸åŒåˆ†åŒºçš„æ¶ˆæ¯ï¼Œè¿™äº›æ¶ˆæ¯è¦ä¹ˆå…¨éƒ¨å¯¹ä»»ä½•ä¸€ä¸ªæ¶ˆè´¹è€…å¯è§ï¼Œè¦ä¹ˆå¯¹ä»»ä½•ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½ä¸å¯è§ã€‚è¿™ä¸ªç‰¹æ€§ä¹Ÿå…è®¸åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å¤„ç†æ¶ˆè´¹æ•°æ®å’Œæäº¤æ¶ˆè´¹åç§»é‡ï¼Œä»è€Œå®ç°ç«¯åˆ°ç«¯çš„ç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰ã€‚ä¸ºäº†å®ç°è¿™ç§æ•ˆæœï¼Œåº”ç”¨ç¨‹åºå¿…é¡»æä¾›ä¸€ä¸ªç¨³å®šçš„ï¼ˆé‡å¯åä¸å˜ï¼‰å”¯ä¸€çš„ IDï¼Œä¹Ÿå³Transaction ID ã€‚ Transactin ID ä¸ PID å¯èƒ½ä¸€ä¸€å¯¹åº”ã€‚åŒºåˆ«åœ¨äº Transaction ID ç”±ç”¨æˆ·æä¾›ï¼Œå°†ç”Ÿäº§è€…çš„ transactional.id é…ç½®é¡¹è®¾ç½®ä¸ºæŸä¸ªå”¯ä¸€IDã€‚è€Œ PID æ˜¯å†…éƒ¨çš„å®ç°å¯¹ç”¨æˆ·é€æ˜ã€‚å¦å¤–ï¼Œä¸ºäº†ä¿è¯æ–°çš„ Producer å¯åŠ¨åï¼Œæ—§çš„å…·æœ‰ç›¸åŒ Transaction ID çš„ Producer å¤±æ•ˆï¼Œæ¯æ¬¡ Producer é€šè¿‡ Transaction ID æ‹¿åˆ° PID çš„åŒæ—¶ï¼Œè¿˜ä¼šè·å–ä¸€ä¸ªå•è°ƒé€’å¢çš„ epochã€‚ç”±äºæ—§çš„ Producer çš„ epoch æ¯”æ–° Producer çš„ epoch å°ï¼ŒKafka å¯ä»¥å¾ˆå®¹æ˜“è¯†åˆ«å‡ºè¯¥ Producer æ˜¯è€çš„ Producer å¹¶æ‹’ç»å…¶è¯·æ±‚ã€‚äº‹åŠ¡å¯ä»¥æ”¯æŒå¤šåˆ†åŒºçš„æ•°æ®å®Œæ•´æ€§ï¼ŒåŸå­æ€§ã€‚å¹¶ä¸”æ”¯æŒè·¨ä¼šè¯çš„exactly onceå¤„ç†è¯­ä¹‰ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœproducerå®•æœºé‡å¯ï¼Œä¾æ—§èƒ½ä¿è¯æ•°æ®åªå¤„ç†ä¸€æ¬¡ã€‚å¼€å¯äº‹åŠ¡ä¹Ÿå¾ˆç®€å•ï¼Œé¦–å…ˆéœ€è¦å¼€å¯å¹‚ç­‰æ€§ï¼Œå³è®¾ç½®enable.idempotenceä¸ºtrueã€‚ç„¶åå¯¹producerå‘é€ä»£ç åšä¸€äº›å°å°çš„ä¿®æ”¹ã€‚12345678910111213//åˆå§‹åŒ–äº‹åŠ¡producer.initTransactions();try &#123; //å¼€å¯ä¸€ä¸ªäº‹åŠ¡ producer.beginTransaction(); producer.send(record1); producer.send(record2); //æäº¤ producer.commitTransaction();&#125; catch (KafkaException e) &#123; //å‡ºç°å¼‚å¸¸çš„æ—¶å€™ï¼Œç»ˆæ­¢äº‹åŠ¡ producer.abortTransaction();&#125;ä½†æ— è®ºå¼€å¯å¹‚ç­‰è¿˜æ˜¯äº‹åŠ¡çš„ç‰¹æ€§ï¼Œéƒ½ä¼šå¯¹æ€§èƒ½æœ‰ä¸€å®šå½±å“ï¼Œè¿™æ˜¯å¿…ç„¶çš„ã€‚æ‰€ä»¥kafkaé»˜è®¤ä¹Ÿå¹¶æ²¡æœ‰å¼€å¯è¿™ä¸¤ä¸ªç‰¹æ€§ï¼Œè€Œæ˜¯äº¤ç”±å¼€å‘è€…æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹è¿›è¡Œå¤„ç†ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"cpeixin.cn/tags/kafka/"}]},{"title":"æ·±åº¦å­¦ä¹  Let's go","slug":"æ·±åº¦å­¦ä¹ -Let-s-go","date":"2019-01-01T15:03:48.000Z","updated":"2020-05-06T16:54:06.970Z","comments":true,"path":"2019/01/01/æ·±åº¦å­¦ä¹ -Let-s-go/","link":"","permalink":"cpeixin.cn/2019/01/01/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-Let-s-go/","excerpt":"","text":"å‰æ®µæ—¶é—´è®²äº†æ•°æ®æŒ–æ˜åå¤§ç»å…¸ç®—æ³•ï¼Œåœ¨å®æˆ˜ä¸­ä¹Ÿäº†è§£äº†éšæœºæ£®æ—ã€é€»è¾‘å›å½’çš„æ¦‚å¿µåŠå·¥å…·ä½¿ç”¨ã€‚è¿™äº›ç®—æ³•éƒ½å±äºä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ ç®—æ³•ã€‚ä½ è‚¯å®šå¬è¯´è¿‡è¿™ä¸¤å¹´å¾ˆç«çš„æ·±åº¦å­¦ä¹ ï¼Œé‚£ä¹ˆæœºå™¨å­¦ä¹ ç®—æ³•å’Œæ·±åº¦å­¦ä¹ æœ‰ä»€ä¹ˆå…³è”å‘¢ï¼Ÿåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ä»¥ä¸‹å‡ ä¸ªæ–¹é¢äº†è§£æ·±åº¦å­¦ä¹ ï¼šæ•°æ®æŒ–æ˜ã€æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿè¿™äº›æ¦‚å¿µéƒ½ä»£è¡¨ä»€ä¹ˆï¼Ÿæˆ‘ä»¬é€šè¿‡æ·±åº¦å­¦ä¹ è®©æœºå™¨å…·å¤‡äººçš„èƒ½åŠ›ï¼Œç”šè‡³æŸäº›æŠ€èƒ½çš„æ°´å¹³è¶…è¿‡äººç±»ï¼Œæ¯”å¦‚å›¾åƒè¯†åˆ«ã€ä¸‹æ£‹å¯¹å¼ˆç­‰ã€‚é‚£ä¹ˆæ·±åº¦å­¦ä¹ çš„å¤§è„‘æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿæ·±åº¦å­¦ä¹ æ˜¯åŸºäºç¥ç»ç½‘ç»œæ„å»ºçš„ï¼Œéƒ½æœ‰å“ªäº›å¸¸ç”¨çš„ç½‘ç»œæ¨¡å‹ï¼Ÿæ·±åº¦å­¦ä¹ æœ‰ä¸‰ä¸ªé‡è¦çš„åº”ç”¨é¢†åŸŸï¼Œè¿™ä¸‰ä¸ªåº”ç”¨é¢†åŸŸåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿæ•°æ®æŒ–æ˜ï¼Œæœºå™¨å­¦ä¹ ï¼Œæ·±åº¦å­¦ä¹ çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå®é™…ä¸Šæ•°æ®æŒ–æ˜å’Œæœºå™¨å­¦ä¹ åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯é‡å çš„ã€‚ä¸€äº›å¸¸ç”¨ç®—æ³•ï¼Œæ¯”å¦‚ K-Meansã€KNNã€SVMã€å†³ç­–æ ‘å’Œæœ´ç´ è´å¶æ–¯ç­‰ï¼Œæ—¢å¯ä»¥è¯´æ˜¯æ•°æ®æŒ–æ˜ç®—æ³•ï¼Œåˆå¯ä»¥è¯´æ˜¯æœºå™¨å­¦ä¹ ç®—æ³•ã€‚é‚£ä¹ˆæ•°æ®æŒ–æ˜å’Œæœºå™¨å­¦ä¹ ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿæ•°æ®æŒ–æ˜é€šå¸¸æ˜¯ä»ç°æœ‰çš„æ•°æ®ä¸­æå–è§„å¾‹æ¨¡å¼ï¼ˆpatternï¼‰ä»¥åŠä½¿ç”¨ç®—æ³•æ¨¡å‹ï¼ˆmodelï¼‰ã€‚æ ¸å¿ƒç›®çš„æ˜¯æ‰¾åˆ°è¿™äº›æ•°æ®å˜é‡ä¹‹é—´çš„å…³ç³»ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿä¼šé€šè¿‡æ•°æ®å¯è§†åŒ–å¯¹å˜é‡ä¹‹é—´çš„å…³ç³»è¿›è¡Œå‘ˆç°ï¼Œç”¨ç®—æ³•æ¨¡å‹æŒ–æ˜å˜é‡ä¹‹é—´çš„å…³è”å…³ç³»ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½åˆ¤æ–­å‡ºæ¥å˜é‡ A å’Œå˜é‡ B æ˜¯æœ‰å…³ç³»çš„ï¼Œä½†å¹¶ä¸ä¸€å®šæ¸…æ¥šè¿™ä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆå…·ä½“å…³ç³»ã€‚åœ¨æˆ‘ä»¬è°ˆè®ºæ•°æ®æŒ–æ˜çš„æ—¶å€™ï¼Œæ›´å¼ºè°ƒçš„æ˜¯ä»æ•°æ®ä¸­æŒ–æ˜ä»·å€¼ã€‚æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæŒ‡çš„æ˜¯é€šè¿‡è®­ç»ƒæ•°æ®å’Œç®—æ³•æ¨¡å‹è®©æœºå™¨å…·æœ‰ä¸€å®šçš„æ™ºèƒ½ã€‚ä¸€èˆ¬æ˜¯é€šè¿‡å·²æœ‰çš„æ•°æ®æ¥å­¦ä¹ çŸ¥è¯†ï¼Œå¹¶é€šè¿‡å„ç§ç®—æ³•æ¨¡å‹å½¢æˆä¸€å®šçš„å¤„ç†èƒ½åŠ›ï¼Œæ¯”å¦‚åˆ†ç±»ã€èšç±»ã€é¢„æµ‹ã€æ¨èèƒ½åŠ›ç­‰ã€‚è¿™æ ·å½“æœ‰æ–°çš„æ•°æ®è¿›æ¥æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡è®­ç»ƒå¥½çš„æ¨¡å‹å¯¹è¿™äº›æ•°æ®è¿›è¡Œé¢„æµ‹ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡æœºå™¨çš„æ™ºèƒ½å¸®æˆ‘ä»¬å®ŒæˆæŸäº›ç‰¹å®šçš„ä»»åŠ¡ã€‚æ·±åº¦å­¦ä¹ å±äºæœºå™¨å­¦ä¹ çš„ä¸€ç§ï¼Œå®ƒçš„ç›®æ ‡åŒæ ·æ˜¯è®©æœºå™¨å…·æœ‰æ™ºèƒ½ï¼Œåªæ˜¯ä¸ä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ ç®—æ³•ä¸åŒï¼Œå®ƒæ˜¯é€šè¿‡ç¥ç»ç½‘ç»œæ¥å®ç°çš„ã€‚ç¥ç»ç½‘ç»œå°±å¥½æ¯”æ˜¯æœºå™¨çš„å¤§è„‘ï¼Œåˆšå¼€å§‹å°±åƒä¸€ä¸ªå©´å„¿ä¸€æ ·ï¼Œæ˜¯ä¸€å¼ ç™½çº¸ã€‚ä½†é€šè¿‡å¤šæ¬¡è®­ç»ƒä¹‹åï¼Œâ€œå¤§è„‘â€å°±å¯ä»¥é€æ¸å…·å¤‡æŸç§èƒ½åŠ›ã€‚è¿™ä¸ªè®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰è¿™ä¸ªå¤§è„‘è¾“å…¥æ•°æ®æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¯¹åº”çš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆå³å¯ã€‚é€šè¿‡å¤šæ¬¡è®­ç»ƒï¼Œâ€œå¤§è„‘â€ä¸­çš„å¤šå±‚ç¥ç»ç½‘ç»œçš„å‚æ•°å°±ä¼šè‡ªåŠ¨ä¼˜åŒ–ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªé€‚åº”äºè®­ç»ƒæ•°æ®çš„æ¨¡å‹ã€‚æ‰€ä»¥ä½ èƒ½çœ‹åˆ°åœ¨ä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šè®²è§£æ¨¡å‹çš„ç®—æ³•åŸç†ï¼Œæ¯”å¦‚ K-Means çš„ç®—æ³•åŸç†ï¼ŒKNN çš„åŸç†ç­‰ã€‚è€Œåˆ°äº†ç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬æ›´å…³æ³¨çš„æ˜¯ç½‘ç»œç»“æ„ï¼Œä»¥åŠç½‘ç»œç»“æ„ä¸­æ¯å±‚ç¥ç»å…ƒçš„ä¼ è¾“æœºåˆ¶ã€‚æˆ‘ä»¬ä¸éœ€è¦å‘Šè¯‰æœºå™¨å…·ä½“çš„ç‰¹å¾è§„å¾‹æ˜¯ä»€ä¹ˆï¼Œåªéœ€æŠŠæˆ‘ä»¬æƒ³è¦è®­ç»ƒçš„æ•°æ®å’Œå¯¹åº”çš„ç»“æœå‘Šè¯‰æœºå™¨å¤§è„‘å³å¯ã€‚æ·±åº¦å­¦ä¹ ä¼šè‡ªå·±æ‰¾åˆ°æ•°æ®çš„ç‰¹å¾è§„å¾‹ï¼è€Œä¼ ç»Ÿæœºå™¨å­¦ä¹ å¾€å¾€éœ€è¦ä¸“å®¶ï¼ˆæˆ‘ä»¬ï¼‰æ¥å‘Šè¯‰æœºå™¨é‡‡ç”¨ä»€ä¹ˆæ ·çš„æ¨¡å‹ç®—æ³•ï¼Œè¿™å°±æ˜¯æ·±åº¦å­¦ä¹ ä¸ä¼ ç»Ÿæœºå™¨å­¦ä¹ æœ€å¤§çš„åŒºåˆ«ã€‚å¦å¤–æ·±åº¦å­¦ä¹ çš„ç¥ç»ç½‘ç»œç»“æ„é€šå¸¸æ¯”è¾ƒæ·±ï¼Œä¸€èˆ¬éƒ½æ˜¯ 5 å±‚ä»¥ä¸Šï¼Œç”šè‡³ä¹Ÿæœ‰ 101 å±‚æˆ–æ›´å¤šçš„å±‚æ•°ã€‚è¿™äº›æ·±åº¦çš„ç¥ç»ç½‘ç»œå¯ä»¥è®©æœºå™¨æ›´å¥½åœ°è‡ªåŠ¨æ•è·æ•°æ®çš„ç‰¹å¾ã€‚ç¥ç»ç½‘ç»œæ˜¯å¦‚ä½•å·¥ä½œçš„ç¥ç»ç½‘ç»œå¯ä»¥è¯´æ˜¯æœºå™¨çš„å¤§è„‘ï¼Œç»å…¸çš„ç¥ç»ç½‘ç»œç»“æ„å¯ä»¥ç”¨ä¸‹é¢çš„å›¾æ¥è¡¨ç¤ºã€‚è¿™é‡Œæœ‰ä¸€äº›æ¦‚å¿µä½ éœ€è¦äº†è§£ã€‚èŠ‚ç‚¹ï¼šç¥ç»ç½‘ç»œæ˜¯ç”±ç¥ç»å…ƒç»„æˆçš„ï¼Œä¹Ÿç§°ä¹‹ä¸ºèŠ‚ç‚¹ï¼Œå®ƒä»¬åˆ†å¸ƒåœ¨ç¥ç»ç½‘ç»œçš„å„ä¸ªå±‚ä¸­ï¼Œè¿™äº›å±‚åŒ…æ‹¬è¾“å…¥å±‚ï¼Œè¾“å‡ºå±‚å’Œéšè—å±‚ã€‚è¾“å…¥å±‚ï¼šè´Ÿè´£æ¥æ”¶ä¿¡å·ï¼Œå¹¶åˆ†å‘åˆ°éšè—å±‚ã€‚ä¸€èˆ¬æˆ‘ä»¬å°†æ•°æ®ä¼ ç»™è¾“å…¥å±‚ã€‚è¾“å‡ºå±‚ï¼šè´Ÿè´£è¾“å‡ºè®¡ç®—ç»“æœï¼Œä¸€èˆ¬æ¥è¯´è¾“å‡ºå±‚èŠ‚ç‚¹æ•°ç­‰äºæˆ‘ä»¬è¦åˆ†ç±»çš„ä¸ªæ•°ã€‚éšè—å±‚ï¼šé™¤äº†è¾“å…¥å±‚å’Œè¾“å‡ºå±‚å¤–çš„ç¥ç»ç½‘ç»œéƒ½å±äºéšè—å±‚ï¼Œéšè—å±‚å¯ä»¥æ˜¯ä¸€å±‚ä¹Ÿå¯ä»¥æ˜¯å¤šå±‚ï¼Œæ¯ä¸ªéšè—å±‚éƒ½ä¼šæŠŠå‰ä¸€å±‚èŠ‚ç‚¹ä¼ è¾“å‡ºæ¥çš„æ•°æ®è¿›è¡Œè®¡ç®—ï¼ˆä½ å¯ä»¥ç†è§£æ˜¯æŸç§æŠ½è±¡è¡¨ç¤ºï¼‰ï¼Œè¿™ç›¸å½“äºæŠŠæ•°æ®æŠ½è±¡åˆ°å¦ä¸€ä¸ªç»´åº¦çš„ç©ºé—´ä¸­ï¼Œå¯ä»¥æ›´å¥½åœ°æå–å’Œè®¡ç®—æ•°æ®çš„ç‰¹å¾ã€‚å·¥ä½œåŸç†ï¼šç¥ç»ç½‘ç»œå°±å¥½æ¯”ä¸€ä¸ªé»‘ç›’å­ï¼Œæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰è¿™ä¸ªé»‘ç›’å­è¾“å…¥æ•°æ®å’Œè¾“å‡ºæ•°æ®ï¼Œç¥ç»ç½‘ç»œå°±å¯ä»¥è‡ªæˆ‘è®­ç»ƒã€‚ä¸€æ—¦è®­ç»ƒå¥½ä¹‹åï¼Œå°±å¯ä»¥åƒé»‘ç›’å­ä¸€æ ·ä½¿ç”¨ï¼Œå½“ä½ ä¼ å…¥ä¸€ä¸ªæ–°çš„æ•°æ®æ—¶ï¼Œå®ƒå°±ä¼šå‘Šè¯‰ä½ å¯¹åº”çš„è¾“å‡ºç»“æœã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œç¥ç»ç½‘ç»œä¸»è¦æ˜¯é€šè¿‡å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­æœºåˆ¶è¿ä½œçš„ã€‚ä»€ä¹ˆæ˜¯å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­å‘¢ï¼Ÿå‰å‘ä¼ æ’­ï¼šæ•°æ®ä»è¾“å…¥å±‚ä¼ é€’åˆ°è¾“å‡ºå±‚çš„è¿‡ç¨‹å«åšå‰å‘ä¼ æ’­ã€‚è¿™ä¸ªè¿‡ç¨‹çš„è®¡ç®—ç»“æœé€šå¸¸æ˜¯é€šè¿‡ä¸Šä¸€å±‚çš„ç¥ç»å…ƒçš„è¾“å‡ºç»è¿‡çŸ©é˜µè¿ç®—å’Œæ¿€æ´»å‡½æ•°å¾—åˆ°çš„ã€‚è¿™æ ·å°±å®Œæˆäº†æ¯å±‚ä¹‹é—´çš„ç¥ç»å…ƒæ•°æ®çš„ä¼ è¾“ã€‚åå‘ä¼ æ’­ï¼šå½“å‰å‘ä¼ æ’­ä½œç”¨åˆ°è¾“å‡ºå±‚å¾—åˆ°åˆ†ç±»ç»“æœä¹‹åï¼Œæˆ‘ä»¬éœ€è¦ä¸å®é™…å€¼è¿›è¡Œæ¯”å¯¹ï¼Œä»è€Œå¾—åˆ°è¯¯å·®ã€‚åå‘ä¼ æ’­ä¹Ÿå«ä½œè¯¯å·®åå‘ä¼ æ’­ï¼Œæ ¸å¿ƒåŸç†æ˜¯é€šè¿‡ä»£ä»·å‡½æ•°å¯¹ç½‘ç»œä¸­çš„å‚æ•°è¿›è¡Œä¿®æ­£ï¼Œè¿™æ ·æ›´å®¹æ˜“è®©ç½‘ç»œå‚æ•°å¾—åˆ°æ”¶æ•›ã€‚æ‰€ä»¥ï¼Œæ•´ä¸ªç¥ç»ç½‘ç»œè®­ç»ƒçš„è¿‡ç¨‹å°±æ˜¯ä¸æ–­åœ°é€šè¿‡å‰å‘ - åå‘ä¼ æ’­è¿­ä»£å®Œæˆçš„ï¼Œå½“è¾¾åˆ°æŒ‡å®šçš„è¿­ä»£æ¬¡æ•°æˆ–è€…è¾¾åˆ°æ”¶æ•›æ ‡å‡†çš„æ—¶å€™å³å¯ä»¥åœæ­¢è®­ç»ƒã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥æ‹¿è®­ç»ƒå¥½çš„ç½‘ç»œæ¨¡å‹å¯¹æ–°çš„æ•°æ®è¿›è¡Œé¢„æµ‹ã€‚å½“ç„¶ï¼Œæ·±åº¦ç¥ç»ç½‘ç»œæ˜¯åŸºäºç¥ç»ç½‘ç»œå‘å±•èµ·æ¥çš„ï¼Œå®ƒçš„åŸç†ä¸ç¥ç»ç½‘ç»œçš„åŸç†ä¸€æ ·ï¼Œåªä¸è¿‡å¼ºè°ƒäº†æ¨¡å‹ç»“æ„çš„æ·±åº¦ï¼Œé€šå¸¸æœ‰ 5 å±‚ä»¥ä¸Šï¼Œè¿™æ ·æ¨¡å‹çš„å­¦ä¹ èƒ½åŠ›ä¼šæ›´å¼ºå¤§ã€‚å¸¸ç”¨çš„ç¥ç»ç½‘ç»œéƒ½æœ‰å“ªäº›æŒ‰ç…§ä¸­é—´å±‚åŠŸèƒ½çš„ä¸åŒï¼Œç¥ç»ç½‘ç»œå¯ä»¥åˆ†ä¸ºä¸‰ç§ç½‘ç»œç»“æ„ï¼Œåˆ†åˆ«ä¸º FNNã€CNN å’Œ RNNã€‚FNNï¼ˆFully-connected Neural Networkï¼‰æŒ‡çš„æ˜¯å…¨è¿æ¥ç¥ç»ç½‘ç»œï¼Œå…¨è¿æ¥çš„æ„æ€æ˜¯æ¯ä¸€å±‚çš„ç¥ç»å…ƒä¸ä¸Šä¸€å±‚çš„æ‰€æœ‰ç¥ç»å…ƒéƒ½æ˜¯è¿æ¥çš„ã€‚ä¸è¿‡åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå…¨è¿æ¥çš„å‚æ•°ä¼šè¿‡å¤šï¼Œå¯¼è‡´è®¡ç®—é‡è¿‡å¤§ã€‚å› æ­¤åœ¨å®é™…ä½¿ç”¨ä¸­å…¨è¿æ¥ç¥ç»ç½‘ç»œçš„å±‚æ•°ä¸€èˆ¬æ¯”è¾ƒå°‘ã€‚CNN å«ä½œå·ç§¯ç¥ç»ç½‘ç»œï¼Œåœ¨å›¾åƒå¤„ç†ä¸­æœ‰å¹¿æ³›çš„åº”ç”¨ï¼Œäº†è§£å›¾åƒè¯†åˆ«çš„åŒå­¦å¯¹è¿™ä¸ªè¯ä¸€å®šä¸é™Œç”Ÿã€‚CNN ç½‘ç»œä¸­ï¼ŒåŒ…æ‹¬äº†å·ç§¯å±‚ã€æ± åŒ–å±‚å’Œå…¨è¿æ¥å±‚ã€‚è¿™ä¸‰ä¸ªå±‚éƒ½æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿå·ç§¯å±‚ç›¸å½“äºä¸€ä¸ªæ»¤é•œçš„ä½œç”¨ï¼Œå®ƒå¯ä»¥æŠŠå›¾åƒè¿›è¡Œåˆ†å—ï¼Œå¯¹æ¯ä¸€å—çš„å›¾åƒè¿›è¡Œå˜æ¢æ“ä½œã€‚æ± åŒ–å±‚ç›¸å½“äºå¯¹ç¥ç»å…ƒçš„æ•°æ®è¿›è¡Œé™ç»´å¤„ç†ï¼Œè¿™æ ·è¾“å‡ºçš„ç»´æ•°å°±ä¼šå‡å°‘å¾ˆå¤šï¼Œä»è€Œé™ä½æ•´ä½“çš„è®¡ç®—é‡ã€‚å…¨è¿æ¥å±‚é€šå¸¸æ˜¯è¾“å‡ºå±‚çš„ä¸Šä¸€å±‚ï¼Œå®ƒå°†ä¸Šä¸€å±‚ç¥ç»å…ƒè¾“å‡ºçš„æ•°æ®è½¬å˜æˆä¸€ç»´çš„å‘é‡ã€‚RNN ç§°ä¸ºå¾ªç¯ç¥ç»ç½‘ç»œï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ç¥ç»å…ƒçš„è¾“å‡ºå¯ä»¥åœ¨ä¸‹ä¸€ä¸ªæ—¶åˆ»ä½œç”¨åˆ°è‡ªèº«ï¼Œè¿™æ · RNN å°±å¯ä»¥çœ‹åšæ˜¯åœ¨æ—¶é—´ä¸Šä¼ é€’çš„ç¥ç»ç½‘ç»œã€‚å®ƒå¯ä»¥åº”ç”¨åœ¨è¯­éŸ³è¯†åˆ«ã€è‡ªç„¶è¯­è¨€å¤„ç†ç­‰ä¸ä¸Šä¸‹æ–‡ç›¸å…³çš„åœºæ™¯ã€‚æ·±åº¦å­¦ä¹ ç½‘ç»œå¾€å¾€åŒ…æ‹¬äº†è¿™ä¸‰ç§ç½‘ç»œçš„å˜ç§å½¢æˆï¼Œå¸¸ç”¨çš„æ·±åº¦ç¥ç»ç½‘ç»œåŒ…æ‹¬ AlexNetã€VGG19ã€GoogleNetã€ResNet ç­‰ï¼Œæˆ‘æ€»ç»“äº†è¿™äº›ç½‘ç»œçš„ç‰¹ç‚¹ï¼Œä½ å¯ä»¥çœ‹ä¸‹ï¼šä½ èƒ½çœ‹å‡ºéšç€æ—¶é—´çš„æ¨è¿›ï¼Œæå‡ºçš„æ·±åº¦å­¦ä¹ ç½‘ç»œå±‚æ•°è¶Šæ¥è¶Šæ·±ï¼ŒTop-5 é”™è¯¯ç‡è¶Šæ¥è¶Šä½ã€‚ä½ å¯èƒ½ä¼šé—®ä»€ä¹ˆæ˜¯ Top-5 é”™è¯¯ç‡ï¼Œå®é™…ä¸Šè¿™äº›ç½‘ç»œç»“æ„çš„æå‡ºå’Œä¸€ä¸ªæ¯”èµ›ç›¸å…³ï¼Œè¿™ä¸ªæ¯”èµ›å«åš ILSVRCï¼Œè‹±æ–‡å…¨ç§°å«åš Large Scale Visual Recognition Challengeã€‚å®ƒæ˜¯ä¸€ä¸ªå…³äºå¤§è§„æ¨¡å›¾åƒå¯è§†åŒ–è¯†åˆ«çš„æ¯”èµ›ï¼Œæ‰€åŸºäºçš„æ•°æ®é›†å°±æ˜¯è‘—åçš„ ImageNet æ•°æ®é›†ï¼Œä¸€å…±åŒ…æ‹¬äº† 1400 ä¸‡å¼ å›¾ç‰‡ï¼Œæ¶µç›– 2 ä¸‡å¤šä¸ªç±»åˆ«ã€‚è¡¨æ ¼ä¸­çš„ AlexNet å°±æ˜¯ 2012 å¹´çš„ ILSVRC å† å†›ï¼Œå½“æ—¶çš„ Top-5 æ­£ç¡®ç‡æ˜¯ 84.7%ï¼ŒVGG å’Œ GoogleNet æ˜¯ 2014 å¹´ ILSVRC æ¯”èµ›çš„æ¨¡å‹ï¼Œå…¶ä¸­ GoogleNet æ˜¯å½“æ—¶æ¯”èµ›çš„å† å†›ï¼Œè€Œ VGG æ˜¯å½“æ—¶æ¯”èµ›çš„äºšå†›ï¼Œå®ƒçš„æ•ˆç‡ä½äº GoogleNetã€‚VGG æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼ŒVGG16 å’Œ VGG19ï¼Œåˆ†åˆ«æ˜¯ 16 å±‚å’Œ 19 å±‚çš„ VGG ç½‘ç»œï¼Œè¿™ä¸¤è€…æ²¡æœ‰æœ¬è´¨çš„åŒºåˆ«ï¼Œåªæ˜¯ç½‘ç»œæ·±åº¦ä¸åŒã€‚åˆ°äº† 2015 å¹´ï¼Œæ¯”èµ›å† å†›æ˜¯ ResNetï¼ŒTop-5 æ­£ç¡®ç‡è¾¾åˆ°äº† 96.43%ã€‚ResNet ä¹Ÿæœ‰ä¸åŒçš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚ ResNet50ã€ResNet101 å’Œ ResNet152 ç­‰ï¼Œåç§°åé¢çš„æ•°å­—ä»£è¡¨çš„æ˜¯ä¸åŒçš„ç½‘ç»œæ·±åº¦ã€‚ä¹‹å ResNet åœ¨å…¶ä»–å›¾åƒæ¯”èµ›ä¸­ä¹Ÿå¤šæ¬¡æ‹¿åˆ°å† å†›ã€‚æ·±åº¦å­¦ä¹ çš„åº”ç”¨é¢†åŸŸä» ImageNet è·‘å‡ºæ¥çš„è¿™äº›ä¼˜ç§€æ¨¡å‹éƒ½æ˜¯åŸºäº CNN å·ç§¯ç¥ç»ç½‘ç»œçš„ã€‚å®é™…ä¸Šæ·±åº¦å­¦ä¹ æœ‰ä¸‰å¤§åº”ç”¨é¢†åŸŸï¼Œå›¾åƒè¯†åˆ«å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå…¶ä»–é¢†åŸŸåˆ†åˆ«æ˜¯è¯­éŸ³è¯†åˆ«å’Œè‡ªç„¶è¯­è¨€å¤„ç†ã€‚è¿™ä¸‰ä¸ªåº”ç”¨é¢†åŸŸæœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹æ€§ï¼Œå°±æ˜¯éƒ½æ¥è‡ªäºä¿¡å·å¤„ç†ã€‚æˆ‘ä»¬äººç±»å¹³æ—¶ä¼šå¤„ç†å›¾åƒä¿¡æ¯ï¼Œè¯­éŸ³ä¿¡æ¯ä»¥åŠè¯­è¨€æ–‡å­—ä¿¡æ¯ã€‚æœºå™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆè¿™ä¸‰ä¸ªåº”ç”¨é‡Œçš„æŸäº›å·¥ä½œã€‚æ¯”å¦‚å›¾åƒè¯†åˆ«é¢†åŸŸä¸­å›¾åƒåˆ†ç±»å’Œç‰©ä½“æ£€æµ‹å°±æ˜¯ä¸¤ä¸ªæ ¸å¿ƒçš„ä»»åŠ¡ã€‚æˆ‘ä»¬å¯ä»¥è®©æœºå™¨åˆ¤æ–­å›¾åƒä¸­éƒ½æœ‰å“ªäº›ç‰©ä½“ï¼Œç±»åˆ«æ˜¯ä»€ä¹ˆï¼Œä»¥åŠè¿™äº›ç‰©ä½“æ‰€å¤„çš„ä½ç½®ã€‚å›¾åƒè¯†åˆ«è¢«å¹¿æ³›åº”ç”¨åœ¨å®‰é˜²æ£€æµ‹ä¸­ã€‚æ­¤å¤–äººè„¸è¯†åˆ«ä¹Ÿæ˜¯å›¾åƒè¯†åˆ«é‡è¦çš„åº”ç”¨åœºæ™¯ã€‚Siri å¤§å®¶ä¸€å®šä¸é™Œç”Ÿï¼Œæ­¤å¤–è¿˜æœ‰æˆ‘ä»¬ä½¿ç”¨çš„æ™ºèƒ½ç”µè§†ç­‰ï¼Œéƒ½é‡‡ç”¨äº†è¯­éŸ³è¯†åˆ«æŠ€æœ¯ã€‚è¯­éŸ³è¯†åˆ«æŠ€æœ¯å¯ä»¥è¯†åˆ«äººç±»çš„è¯­éŸ³æŒ‡ä»¤å¹¶è¿›è¡Œäº¤äº’ã€‚åœ¨è¯­éŸ³å¯¼èˆªä¸­ï¼Œè¿˜é‡‡ç”¨äº†è¯­éŸ³åˆæˆæŠ€æœ¯ï¼Œè¿™æ ·å°±å¯ä»¥è®©æœºå™¨æ¨¡æ‹Ÿäººçš„å£°éŸ³ä¸ºæˆ‘ä»¬æœåŠ¡ï¼ŒSiri è¯­éŸ³åŠ©æ‰‹ä¹Ÿé‡‡ç”¨äº†è¯­éŸ³è¯†åˆ«å’Œåˆæˆçš„æŠ€æœ¯ã€‚è‡ªç„¶è¯­è¨€å¤„ç†çš„è‹±æ–‡ç¼©å†™æ˜¯ NLPï¼Œå®ƒè¢«å¹¿æ³›åº”ç”¨åˆ°è‡ªåŠ¨é—®ç­”ã€æ™ºèƒ½å®¢æœã€è¿‡æ»¤åƒåœ¾é‚®ä»¶å’ŒçŸ­ä¿¡ç­‰é¢†åŸŸä¸­ã€‚åœ¨ç”µå•†é¢†åŸŸï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ NLP è‡ªåŠ¨ç»™å•†å“è¯„è®ºæ‰“æ ‡ç­¾ï¼Œåœ¨ç”¨æˆ·å†³ç­–çš„æ—¶å€™æä¾›æ•°æ®æ”¯æŒã€‚åœ¨è‡ªåŠ¨é—®ç­”ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¾“å…¥è‡ªå·±æƒ³é—®çš„é—®é¢˜ï¼Œè®©æœºå™¨æ¥å›ç­”ï¼Œæ¯”å¦‚åœ¨ç™¾åº¦ä¸­è¾“å…¥â€œå§šæ˜çš„è€å©†â€ï¼Œå°±ä¼šè‡ªåŠ¨æ˜¾ç¤ºå‡ºâ€å¶è‰â€œã€‚æ­¤å¤–è¿™äº›æŠ€æœ¯è¿˜å¯ä»¥ç›¸äº’ç»„åˆä¸ºæˆ‘ä»¬æä¾›æœåŠ¡ï¼Œæ¯”å¦‚åœ¨æ— äººé©¾é©¶ä¸­å°±é‡‡ç”¨äº†å›¾åƒè¯†åˆ«ã€è¯­éŸ³è¯†åˆ«ç­‰æŠ€æœ¯ã€‚åœ¨è¶…å¸‚è´­ç‰©ä¸­ä¹Ÿé‡‡ç”¨äº†é›†æˆå›¾åƒè¯†åˆ«ã€æ„å›¾è¯†åˆ«ç­‰æŠ€æœ¯ç­‰ã€‚æ€»ç»“ä»Šå¤©æˆ‘ä»¬å¤§æ¦‚äº†è§£äº†ä¸€ä¸‹æ·±åº¦å­¦ä¹ ã€‚æ·±åº¦å­¦ä¹ ä¹Ÿæ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ç§ã€‚æˆ‘ä»¬ä¹‹å‰è®²è§£äº†æ•°æ®æŒ–æ˜åå¤§ç»å…¸ç®—æ³•ï¼Œè¿˜æœ‰é€»è¾‘å›å½’ã€éšæœºæ£®æ—ç®—æ³•ç­‰ï¼Œè¿™äº›éƒ½æ˜¯ä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ ç®—æ³•ã€‚åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œå¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†çš„æœºå™¨å­¦ä¹ ä»»åŠ¡ã€‚ä½†æ˜¯å¯¹äºæ•°æ®é‡æ›´å¤§ï¼Œæ›´å¼€æ”¾æ€§çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡‡ç”¨æ·±åº¦å­¦ä¹ çš„ç®—æ³•ï¼Œè®©æœºå™¨è‡ªå·±æ¥æ‰¾è§„å¾‹ï¼Œè€Œä¸æ˜¯é€šè¿‡æˆ‘ä»¬æŒ‡å®šçš„ç®—æ³•æ¥æ‰¾åˆ†ç±»è§„å¾‹ã€‚æ‰€ä»¥æ·±åº¦å­¦ä¹ çš„æ™®é€‚æ€§ä¼šæ›´å¼ºä¸€äº›ï¼Œä½†ä¹Ÿå¹¶ä¸ä»£è¡¨æ·±åº¦å­¦ä¹ å°±ä¼˜äºæœºå™¨å­¦ä¹ ã€‚ä¸€æ–¹é¢æ·±åº¦å­¦ä¹ éœ€è¦å¤§é‡çš„æ•°æ®ï¼Œå¦ä¸€æ–¹é¢æ·±åº¦å­¦ä¹ çš„å­¦ä¹ æ—¶é—´ï¼Œå’Œéœ€è¦çš„è®¡ç®—èµ„æºéƒ½è¦å¤§äºä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ ã€‚ä½ èƒ½çœ‹åˆ°å„ç§æ·±åº¦å­¦ä¹ çš„è®­ç»ƒé›†ä¸€èˆ¬éƒ½è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œæ¯”å¦‚ ImageNet å°±åŒ…æ‹¬äº† 1400 ä¸‡å¼ å›¾ç‰‡ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰æä¾›å¤§é‡çš„è®­ç»ƒæ•°æ®ï¼Œè®­ç»ƒå‡ºæ¥çš„æ·±åº¦æ¨¡å‹è¯†åˆ«ç»“æœæœªå¿…å¥½äºä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ ã€‚å®é™…ä¸Šç¥ç»ç½‘ç»œæœ€æ—©æ˜¯åœ¨ 1986 å¹´æå‡ºæ¥çš„ï¼Œä¹‹åä¸æ¸©ä¸ç«ï¼Œç›´åˆ° ImageNet äº 2009 å¹´æå‡ºï¼Œåœ¨ 2010 å¹´å¼€å§‹ä¸¾åŠæ¯å¹´çš„ ImageNet å¤§è§„æ¨¡è§†è§‰è¯†åˆ«æŒ‘æˆ˜èµ›ï¼ˆILSVRCï¼‰ï¼Œæ·±åº¦å­¦ä¹ æ‰å¾—åˆ°è¿…çŒ›å‘å±•ã€‚2016 å¹´ Google ç ”å‘çš„ AlphaGo å‡»è´¥äº†äººç±»å† å†›æä¸–çŸ³ï¼Œæ›´æ˜¯è®©äººä»¬çœ‹åˆ°äº†æ·±åº¦å­¦ä¹ çš„åŠ›é‡ã€‚ä¸€ä¸ªå¥½é—®é¢˜çš„æå‡ºï¼Œå¯ä»¥æ¿€å‘æ— ç©·çš„èƒ½é‡ï¼Œè¿™æ˜¯ç§‘æŠ€è¿›æ­¥çš„æºæ³‰ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨ç§‘å­¦ä¸Šï¼Œæˆ‘ä»¬ä¼šæœ‰å„ç§å…¬å¼€çš„æ•°æ®é›†ã€‚ä¸€ä¸ªå¥½çš„æ•°æ®é›†å°±ä»£è¡¨äº†ä¸€ä¸ªå¥½çš„é—®é¢˜å’Œä½¿ç”¨åœºæ™¯ã€‚æ­£æ˜¯è¿™äº›éœ€æ±‚çš„å‡ºç°ï¼Œæ‰èƒ½è®©æˆ‘ä»¬çš„ç®—æ³•æœ‰æ›´å¥½çš„ç”¨æ­¦ä¹‹åœ°ï¼ŒåŒæ—¶ä¹Ÿæœ‰äº†å„ç§ç®—æ³•ç›¸äº’æ¯”æ‹¼çš„å¹³å°ã€‚","categories":[{"name":"æ·±åº¦å­¦ä¹ ","slug":"æ·±åº¦å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"æ·±åº¦å­¦ä¹ ","slug":"æ·±åº¦å­¦ä¹ ","permalink":"cpeixin.cn/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"}]},{"title":"ETLé‡Œçš„34ä¸ªå­ç³»ç»Ÿ","slug":"ETLé‡Œçš„34ä¸ªå­ç³»ç»Ÿ","date":"2018-11-02T18:16:48.000Z","updated":"2020-06-01T02:38:13.981Z","comments":true,"path":"2018/11/03/ETLé‡Œçš„34ä¸ªå­ç³»ç»Ÿ/","link":"","permalink":"cpeixin.cn/2018/11/03/ETL%E9%87%8C%E7%9A%8434%E4%B8%AA%E5%AD%90%E7%B3%BB%E7%BB%9F/","excerpt":"","text":"ETLé‡Œçš„34ä¸ªå­ç³»ç»ŸRalph Kimballå’ŒJoe Casertaäº2004å¹´ç¼–å†™çš„ã€ŠThe Data Warehouse ETL Toolkitã€‹ä¸€ä¹¦ç³»ç»Ÿçš„é˜è¿°äº†ETLè¿™ä¸€æ¦‚å¿µåŠå»ºè®¾ETLç³»ç»Ÿçš„è¦ç‚¹ï¼Œå°†ETLä»BIçš„ä¸€éƒ¨åˆ†æŠ½ç¦»äº†å‡ºæ¥ã€‚éšåï¼Œè¿™æœ¬ä¹¦é‡Œçš„ä¸€äº›æ€æƒ³å½¢æˆäº†ä¸€ç¯‡æ–‡ç« ã€ŠETLé‡Œçš„38ä¸ªå­ç³»ç»Ÿã€‹ï¼Œç³»ç»Ÿæ€»ç»“äº†ETLé¡¹ç›®è¦é¢ä¸´çš„ä¸åŒä»»åŠ¡ã€‚æˆ‘ä»¬è¿˜å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾åˆ°åŸå§‹çš„è¿™ç¯‡æ–‡ç« https://www.informationweek.com/software/information-management/the-38-subsystems-of-etl/d/d-id/1028653ã€‚åœ¨2008å¹´ï¼ŒWileyå‡ºç‰ˆäº†æœ€æµè¡Œçš„ä¸€æœ¬BIå›¾ä¹¦çš„ç¬¬äºŒç‰ˆï¼šä¹Ÿæ˜¯ç”±Kimballå’Œä»–åŒäº‹ç¼–å†™çš„ã€ŠThe Data Warehouse Lifecycle Toolkitã€‹ã€‚åœ¨è¿™æœ¬ä¹¦é‡ŒETLå­ç³»ç»Ÿè¢«é‡æ„æˆäº†34ç§å­ç³»ç»Ÿã€‚æ¥ä¸‹æ¥æœ¬æ–‡å°†ç®€è¦ä»‹ç»è¿™34ç§ETLé‡Œçš„å­ç³»ç»Ÿã€‚è¿™34ç§å­ç³»ç»Ÿæä¾›äº†ä¸€å¥—æ¡†æ¶ï¼Œå¸®åŠ©æˆ‘ä»¬ç†è§£ETLè§£å†³æ–¹æ¡ˆçš„å®ç°å’Œç®¡ç†ï¼Œå¹¶å¯¹å…¶è¿›è¡Œåˆ†ç±»ã€‚åœ¨ETLè§£å†³æ–¹æ¡ˆçš„è®¾è®¡ä¸å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ¸…æ¥šçš„äº†è§£éœ€è¦ã€å·²å­˜åœ¨çš„ç³»ç»Ÿã€å¯ç”¨çš„æŠ€å·§å’ŒæŠ€æœ¯æ¥ç¡®è®¤æˆ‘ä»¬çš„é¢„æœŸæ˜¯ä»€ä¹ˆï¼Œä»¥åŠè¾¾åˆ°é¢„æœŸçš„æ¨åŠ¨å’Œé™åˆ¶å› ç´ ã€‚è¿™34ä¸ªå­ç³»ç»Ÿå¯ä»¥åˆ†ä¸ºï¼”ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå…¶ä¸­å¾ˆå¤šéƒ½æ˜¯ç®¡ç†ç±»çš„å­ç³»ç»Ÿï¼Œå› ä¸ºå½“é¡¹ç›®å‘å¸ƒæ—¶ï¼Œç³»ç»Ÿçš„ç”Ÿå‘½å‘¨æœŸæ‰åˆšåˆšå¼€å§‹ï¼Œç®¡ç†ä¹Ÿæ˜¯ETLçš„é‡ä¸­ä¹‹é‡ã€‚æŠ½å–ï¼šETLçš„ç¬¬ä¸€ä¸ªå•è¯Extractå°±æ˜¯æŠ½å–çš„æ„æ€ï¼Œæ•°æ®æŠ½å–æ˜¯ETLç³»ç»Ÿçš„æœ€å¤§æŒ‘æˆ˜ä¹‹ä¸€ï¼Œå­ç³»ç»Ÿ1~3å±äºè¿™ä¸ªä¸»é¢˜ã€‚æ¸…æ´—å’Œæ›´æ­£ï¼šæ— è®ºä½¿ç”¨ä»€ä¹ˆæ•°æ®ä»“åº“æ¶æ„ï¼Œåœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œæ•°æ®éƒ½è¦ç»è¿‡æ¸…æ´—ä»¥æ»¡è¶³ä¸šåŠ¡çš„è¦æ±‚ã€‚ç»å…¸æ•°æ®ä»“åº“æ¨¡å‹ï¼Œæ•°æ®è¿›å…¥åˆ°æ•°æ®ä»“åº“ä¹‹å‰å°±è¢«æ¸…æ´—äº†ï¼ˆâ€œçœŸå®çš„æ•°æ®åªæœ‰ä¸€ä¸ªç‰ˆæœ¬â€ï¼‰ã€‚è€ŒDataVaultæ¨¡å‹ï¼Œæ•°æ®æ˜¯æŒ‰ç…§åŸæ ·è¿›å…¥æ•°æ®ä»“åº“çš„ï¼ˆâ€œäº‹å®çš„æ•°æ®åªæœ‰ä¸€ä¸ªç‰ˆæœ¬â€ï¼‰ï¼Œè€Œæ¸…æ´—å’Œæ›´æ­£è¿‡ç¨‹å‘ç”Ÿåœ¨åé¢çš„é˜¶æ®µã€‚å­ç³»ç»Ÿ4~8å±äºè¿™ä¸ªä¸»é¢˜ã€‚å‘å¸ƒï¼š34ä¸ªå­ç³»ç»Ÿä¸­æœ‰13ä¸ªéƒ½æ˜¯å…³äºå¦‚ä½•æŠŠæ•°æ®å‘å¸ƒåˆ°ç›®æ ‡æ•°æ®åº“ä¸­çš„ï¼Œå‘å¸ƒå¹¶ä¸ä»…ä»…æ„å‘³ç€æŠŠæ•°æ®å†™å…¥åˆ°ç›®æ ‡æ•°æ®åº“ä¸­ï¼Œä¹ŸåŒ…æ‹¬æŠŠæ•°æ®å†™å…¥åˆ°ç»´åº¦è¡¨æˆ–äº‹å®è¡¨ä¸­çš„é‚£äº›è½¬æ¢ã€‚ç®¡ç†ï¼šä»»ä½•çš„ä¿¡æ¯åŸºç¡€æ¶æ„éƒ½è¦å¯ä»¥è¢«ç®¡ç†å’Œç›‘æ§ï¼ŒETLç³»ç»Ÿä¹Ÿä¸ä¾‹å¤–ï¼Œå­ç³»ç»Ÿ22~34å±äºè¿™ä¸€ä¸ªä¸»é¢˜ã€‚ä¸‹é¢çš„ä¸»è¦å†…å®¹éƒ½æ˜¯æ‘˜å½•ç½‘ä¸Šå’Œä¹¦é‡Œèµ„æ–™ï¼Œå¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ã€‚æŠ½å–ETLæ–¹æ¡ˆçš„ç¬¬ä¸€éƒ¨åˆ†å°±æ˜¯è¦ä»ä¸åŒçš„æ•°æ®æºæŠ½å–æ•°æ®ã€‚è®¿é—®æ•°æ®æºä¼šæœ‰å¾ˆå¤šå›°éš¾ï¼Œæ”¿ç­–æ€§é—®é¢˜æ˜¯æœ€éš¾ä»¥é€¾è¶Šçš„éšœç¢ã€‚å¦å¤–ï¼ŒåŸºäºå®‰å…¨æ€§å’Œæ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼Œæ•°æ®ç³»ç»Ÿçš„ç®¡ç†äººå‘˜ä¸ä¼šè®©æœªç»æˆæƒçš„ç”¨æˆ·è®¿é—®ç³»ç»Ÿã€‚ä¸€äº›ERPç³»ç»Ÿçš„å‚å•†ï¼ˆSAPæˆ–Oracleï¼‰ä¹Ÿä¸å…è®¸å…¶ä»–ç³»ç»Ÿè®¿é—®ERPåº•å±‚æ•°æ®åº“ã€‚å­ç³»ç»Ÿ1ï¼šæ•°æ®å‰–æç³»ç»Ÿç›®æ ‡æ˜¯è¦åˆ†æä¸åŒæ•°æ®æºçš„ç»“æ„å’Œå†…å®¹ã€‚æ•°æ®å‰–ææä¾›äº†ç±»ä¼¼è¡Œç»Ÿè®¡ã€NULLå€¼ä¸ªæ•°ç»Ÿè®¡ç­‰ç®€å•çš„ç»Ÿè®¡é¡¹ï¼Œå½“ç„¶ä¹Ÿæœ‰ä¸€äº›æ›´å¤æ‚çš„åˆ†æï¼Œå¦‚å•è¯æ¨¡å¼åˆ†æç­‰ã€‚å­ç³»ç»Ÿ2ï¼šå¢é‡æ•°æ®æ•è·ç³»ç»Ÿç›®æ ‡æ˜¯æ•è·æºç³»ç»Ÿé‡Œæ•°æ®çš„å˜åŒ–ï¼ŒCDCï¼ˆChanged Data Captureï¼Œå˜åŒ–æ•°æ®è·å–ï¼‰å¸¸ç”¨çš„æ–¹å¼æœ‰ï¼šå®¡è®¡åˆ—ï¼šæºç³»ç»ŸåŒ…å«å®¡è®¡åˆ—ï¼Œæ¯”å¦‚æ’å…¥æˆ–ä¿®æ”¹çš„æ—¶é—´ã€‚å®šæ—¶è·å–å…¨å·®å¼‚åŒ–æ¯”è¾ƒæ•°æ®åº“æ—¥å¿—æŠ“å–æ¶ˆæ¯é˜Ÿåˆ—ç›‘æ§å­ç³»ç»Ÿ3ï¼šæŠ½å–ç³»ç»ŸæŠ½å–å­ç³»ç»Ÿä»ä¸åŒçš„æ•°æ®æºæŠ½å–æ•°æ®ï¼Œå¹¶è¾“å…¥åˆ°ETLæµç¨‹é‡Œã€‚Kimballæ˜ç¡®åŒºåˆ†äº†åŸºäºæ–‡ä»¶çš„å’ŒåŸºäºæµçš„ä¸¤ç§æŠ½å–ã€‚æ³¨æ„ï¼Œè¿™é‡ŒåŸºäºæµçš„æŠ½å–å¹¶ä¸æ„å‘³ç€å®æ—¶æ•°æ®æµã€‚è¿™ç§åŒºåˆ†æ–¹æ³•ä¸å¤ªæ°å½“ï¼Œå› ä¸ºæ— è®ºä»æ•°æ®åº“ï¼Œæ–‡ä»¶ã€å®æ—¶æ•°æ®æºã€Web Servicesè¿˜æ˜¯å…¶ä»–ä»»ä½•æ•°æ®æºï¼Œåªè¦å¯ä»¥è®¿é—®åˆ°æ•°æ®ï¼Œæ•°æ®éƒ½æ˜¯ä»¥æµçš„æ–¹å¼é€šè¿‡æ•´ä¸ªè½¬æ¢çš„ã€‚äº‹å®ä¸Šå”¯ä¸€æœ‰åŒºåˆ«çš„åœ°æ–¹æ˜¯åœ¨ETLä½œä¸šè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®æºçš„æ•°æ®æ˜¯å¦åœ¨å‘ç”Ÿå˜åŒ–ã€‚æ‰€ä»¥æŠ½å–çš„ä¸»è¦çš„åŒºåˆ«ä¸æ˜¯æ–‡ä»¶æˆ–æµï¼Œè€Œæ˜¯é™æ€æˆ–åŠ¨æ€çš„é—®é¢˜ã€‚å¦‚æœè½¬æ¢å¤±è´¥ï¼Œè¿™ç§åŒºåˆ†æ–¹å¼å°±æ˜¾å¾—æ›´ä¸ºé‡è¦ã€‚å¦‚æœä½ çš„æ•°æ®æºæ˜¯é™æ€çš„ï¼ˆæ–‡ä»¶çš„æƒ…å†µåŸºæœ¬éƒ½æ˜¯å¦‚æ­¤ï¼‰ï¼Œé‡æ–°å¯åŠ¨ä¸€ä¸ªä½œä¸šå°±å¯ä»¥äº†ã€‚è€Œå¦‚æœä½ çš„æ•°æ®æºæ˜¯åŠ¨æ€çš„ã€‚ä¾‹å¦‚äº‹åŠ¡å‹çš„æ•°æ®åº“ï¼Œåœ¨ä½ è¿è¡Œä½œä¸šçš„æ—¶å€™ï¼Œæ•°æ®åº“é‡Œé¢çš„æ•°æ®å·²ç»å‘ç”Ÿäº†å˜åŒ–ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåŠ è½½é”€å”®æ•°æ®çš„ä½œä¸šï¼Œæ‰€æœ‰çš„ç»´åº¦éƒ½æ­£å¸¸åŠ è½½ï¼Œåœ¨åŠ è½½é”€å”®è®¢å•çš„äº‹å®æ•°æ®æ—¶åœç”µäº†ï¼Œè€Œåœ¨åŠ è½½ç»´åº¦æ•°æ®çš„åŒæ—¶ï¼Œæºç³»ç»Ÿä¸­æœ‰äº†ä¸€ä¸ªæ–°çš„å®¢æˆ·ï¼Œå¹¶äº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„è®¢å•ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æºç³»ç»Ÿä¸­æœ‰äº†æ–°çš„ç»´åº¦æ•°æ®å’Œäº‹å®æ•°æ®ã€‚é™¤éæŠŠæ‰€æœ‰çš„ç»´åº¦è¡¨é‡æ–°è·‘ä¸€éï¼Œå¦åˆ™åœ¨é‡æ–°åŠ è½½äº‹å®è¡¨æ—¶ï¼Œå°±ä¼šå‘ç°æœ‰çš„å®¢æˆ·ç»´åº¦æ²¡æœ‰æ‰¾åˆ°ã€‚å¦å¤–ï¼ŒCDCçš„å®ç°æ–¹å¼ä¸åŒï¼Œä»è¿™ç±»é”™è¯¯ä¸­è¿›è¡Œæ•°æ®æ¢å¤ä¹Ÿæ˜¯éå¸¸å›°éš¾çš„äº‹æƒ…ã€‚æ¸…æ´—å’Œæ›´æ­£æ•°æ®ä¸–ç•Œä¸Šæ²¡æœ‰ä»»ä½•ä¸€ä¸ªç»„ç»‡çš„æ•°æ®æ˜¯æ²¡æœ‰è´¨é‡é—®é¢˜çš„ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨æŠŠæ•°æ®åŠ è½½åˆ°æ•°æ®ä»“åº“ä¹‹å‰è¦å¢åŠ ä¸€äº›æ­¥éª¤æ¥æ¸…æ´—å’Œæ›´æ­£è¿™äº›æ•°æ®ï¼Œä»¥æ»¡è¶³ä¸šåŠ¡çš„éœ€æ±‚ã€‚å¦å¤–ï¼Œåªä½¿ç”¨ä¸€ä¸ªå•ä¸€çš„ç³»ç»Ÿæ¥å­˜å‚¨æ•°æ®çš„ç»„ç»‡ä¹Ÿå¾ˆå°‘ï¼›é€šå¸¸ï¼Œä¸ºäº†æ”¯æ’‘ä¸šåŠ¡è¿è¡Œï¼Œéƒ½ä¼šå­˜åœ¨å¤šä¸ªç³»ç»Ÿï¼Œå¯èƒ½æ¯ä¸ªéƒ¨é—¨éƒ½ä¼šæœ‰è‡ªå·±çš„ç³»ç»Ÿã€‚å¦‚è´¢åŠ¡ã€äººåŠ›ã€é‡‡è´­æˆ–å®¢æœç®¡ç†ç­‰ã€‚æ¯ä¸ªç³»ç»Ÿå­˜å‚¨æ•°æ®çš„æ–¹å¼å¯èƒ½éƒ½ä¸ç›¸åŒã€‚ä¾‹å¦‚åœ¨ç³»ç»ŸAé‡Œï¼Œå®¢æˆ·æ€§åˆ«ä¿å­˜ä¸ºFï¼ˆfemaleï¼‰ã€Mï¼ˆmaleï¼‰ã€Uï¼ˆunknownï¼‰ï¼›åœ¨ç³»ç»ŸBé‡Œï¼Œåˆ†åˆ«ä½¿ç”¨0ã€1ã€NULLæ¥ä»£è¡¨è¿™ä¸‰ç±»æ•°æ®ã€‚æ‰€æœ‰çš„è¿™äº›ç³»ç»Ÿéƒ½åº”è¯¥éµç…§æ•°æ®ä»“åº“çš„ç»Ÿä¸€æ ‡å‡†æ¥å­˜å‚¨ã€‚å­ç³»ç»Ÿ4ï¼šæ•°æ®æ¸…æ´—å’Œè´¨é‡å¤„ç†ç³»ç»Ÿæ•°æ®æ¸…æ´—æ˜¯æŒ‡ä¿®æ”¹æˆ–æ•´ç†è¿›å…¥åˆ°ETLæµç¨‹ä¸­çš„è„æ•°æ®ã€‚è™½ç„¶é€šå¸¸æ¥è¯´ï¼Œæ•°æ®æ¸…æ´—åº”è¯¥åœ¨åŸå§‹ç³»ç»Ÿä¸­äº§ç”Ÿæ•°æ®çš„åœ°æ–¹è¿›è¡Œã€‚ä½†å¾€å¾€æé«˜åŸå§‹æ•°æ®è´¨é‡æ‰€éœ€è¦çš„æ—¶é—´ä¸èƒ½æ»¡è¶³å¼€å‘æ•°æ®ä»“åº“çš„æ—¶é—´è¦æ±‚ã€‚ä½†æ˜¯æ— è®ºå¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½è¦ç»™ç”¨æˆ·æä¾›ä¸€ä»½å¹²å‡€çš„æ•°æ®ã€‚æ‰€ä»¥ä¸€èˆ¬å°±éœ€è¦ä½¿ç”¨ETLé¡¹ç›®æ¥æé«˜æ•°æ®è´¨é‡ï¼ŒETLé¡¹ç›®çš„ä¼˜åŠ¿åœ¨äºï¼šé¦–å…ˆï¼Œåœ¨ETLçš„æ•°æ®å‰–æé˜¶æ®µï¼Œå¯ä»¥æ‰¾å‡ºæœ‰å“ªäº›é”™è¯¯æ•°æ®ï¼›å…¶æ¬¡ï¼Œåœ¨æºç³»ç»Ÿä¸­éœ€è¦çš„æ•°æ®æ¸…æ´—è§„åˆ™ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨äºETLç¯å¢ƒä¸­ã€‚æœ€åï¼Œæœ€ç»ˆä½¿ç”¨æ•°æ®çš„ä¸šåŠ¡äººå‘˜å¯ä»¥åŠ å…¥åˆ°ETLå¼€å‘ä¸­ï¼Œåªæœ‰ä¸šåŠ¡äººå‘˜æ‰èƒ½å‘Šè¯‰æˆ‘ä»¬å“ªäº›æ•°æ®æ˜¯æ­£ç¡®çš„æ•°æ®ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œä¸šåŠ¡äººå‘˜/æ•°æ®æ‰€æœ‰è€…ã€æºç³»ç»Ÿå¼€å‘äººå‘˜/ç®¡ç†è€…å’ŒETLå¼€å‘äººå‘˜éœ€è¦å…±åŒå®Œæˆæé«˜æ•°æ®è´¨é‡çš„å·¥ä½œã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¸æ­£ç¡®æ•°æ®ä¸»è¦æ¥æºäºé‚£äº›æŠŠæ•°æ®è¾“å…¥åˆ°ç³»ç»Ÿé‡Œçš„ä¸šåŠ¡äººå‘˜ã€‚ä¾‹å¦‚ï¼šä¸€å¥—åŒ…æ‹¬ETLæµç¨‹çš„æ•°æ®è´¨é‡è§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸ªæ–¹æ¡ˆè¯»å–å¹¶è½¬æ¢ä¸šåŠ¡ç³»ç»Ÿä¸­çš„æ•°æ®ï¼Œæœ€åæŠŠæ•°æ®åŠ è½½åˆ°ä¸€ä¸ªæ£€æŸ¥ç³»ç»Ÿï¼Œåœ¨è¿™ä¸ªæ£€æŸ¥ç³»ç»Ÿé‡Œç”¨æˆ·å¯ä»¥å¯è§†åŒ–æŸ¥çœ‹æ•°æ®ï¼Œå¹¶ç»™ä¸æ­£ç¡®æ•°æ®æ‰“æ ‡è®°ã€‚å¦å¤–ï¼ŒETLæµç¨‹è¿˜å¯ä»¥è‡ªåŠ¨ç»™æŸäº›å¸¸è§çš„é”™è¯¯æ‰“æ ‡è®°ï¼Œå¦‚å­—æ®µä¸ºç©ºã€ä¸æ­£ç¡®çš„æ ¼å¼æˆ–é”™è¯¯çš„ç”µè¯å·ç ç­‰ã€‚æ¯å‘¨æ•°æ®è´¨é‡çš„æ£€æŸ¥ç»“æœå°±ä¼šæŠ¥å‘Šç»™æ•°æ®ç®¡ç†äººå‘˜ã€‚å°½ç®¡ä¸šåŠ¡ä¸Šè¦æ±‚100%æ²¡æœ‰é”™è¯¯æ•°æ®ï¼Œä½†å®é™…ä¸Šï¼Œåœ¨æ²¡æœ‰åšè¿™ä¸ªæ•°æ®è´¨é‡é¡¹ç›®ä¹‹å‰ï¼Œæ­£ç¡®æ•°æ®çš„æ¯”ä¾‹ä½äº50%ï¼Œåœ¨åšäº†è¿™ä¸ªå¯è§†åŒ–çš„æ•°æ®è´¨é‡é¡¹ç›®åï¼Œç¬¬ä¸€å¹´ï¼Œæ­£ç¡®æ•°æ®çš„æ¯”ä¾‹å·²ç»å‡ ä¹è¾¾åˆ°äº†90%ã€‚è¿™ä¸ªä¾‹å­æ˜¾ç¤ºäº†ä¸€ä¸ªç®€å•çš„ETLæµç¨‹å†åŠ ä¸Šä¸€äº›æŠ¥å‘Šï¼Œå¦‚ä½•ä½¿ç”¨æˆ·é‡è§†å¹¶æé«˜æ•°æ®è´¨é‡é—®é¢˜ã€‚å­ç³»ç»Ÿ5ï¼šé”™è¯¯äº‹ä»¶å¤„ç†é”™è¯¯äº‹ä»¶å¤„ç†çš„ç›®çš„æ˜¯è®°å½•ä¸‹ETLè¿‡ç¨‹ä¸­çš„æ¯ä¸€ä¸ªé”™è¯¯ã€‚è¿™æ ·ä¾¿äºç®¡ç†å‘˜å®šæœŸç›‘æ§å’Œåˆ†æé”™è¯¯æ˜¯æ•°æ®è´¨é‡é”™è¯¯è¿˜æ˜¯ç³»ç»Ÿé”™è¯¯æˆ–å…¶ä»–é”™è¯¯ã€‚Kimballæåˆ°è¦ä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çš„é”™è¯¯äº‹ä»¶æ¨¡å¼æ¥ä¿ç•™è¿™äº›é”™è¯¯ã€‚å­ç³»ç»Ÿ6ï¼šå®¡è®¡ç»´åº¦å°½ç®¡é”™è¯¯äº‹ä»¶æ¨¡å¼å’Œæ•°æ®ä»“åº“çš„ä¸šåŠ¡æ•°æ®æ˜¯ç‹¬ç«‹çš„ï¼Œä½†å®¡è®¡ç»´åº¦è¡¨å´æ˜¯æ•°æ®ä»“åº“å†…éƒ¨çš„ã€‚å®¡è®¡ç»´åº¦è¡¨æ˜¯ä¸€ç±»ç‰¹æ®Šçš„ç»´åº¦è¡¨ï¼Œæ•°æ®ä»“åº“é‡Œçš„æ‰€æœ‰äº‹å®è¡¨éƒ½å’Œå®¡è®¡ç»´åº¦è¡¨å…³è”ï¼Œå®¡è®¡ç»´åº¦è¡¨åŒ…å«äº†å¯¹äº‹å®è¡¨å˜æ›´çš„å…ƒæ•°æ®ï¼Œå¦‚åŠ è½½æ•°æ®çš„æ—¥æœŸå’Œæ—¶é—´ã€æ•°æ®çš„è´¨é‡æŒ‡æ ‡ç­‰ã€‚å®é™…ä¸Šï¼Œç»™æ•°æ®ä»“åº“å¢åŠ å®¡è®¡ç»´åº¦ï¼Œå¯ä»¥å¸¦æ¥å¾ˆå¤šå¥½å¤„ã€‚å°±åƒåœ¨å¤šç»´æ•°æ®ä»“åº“ä¸Šä½¿ç”¨Data Vaultæ¶æ„æ‰€å¸¦æ¥çš„å¥½å¤„ä¸€æ ·ã€‚å­ç³»ç»Ÿ7ï¼šæ’é™¤é‡å¤è®°å½•ç³»ç»Ÿæ’é™¤é‡å¤è®°å½•å¯èƒ½æ˜¯ETLä¸­æœ€æ£˜æ‰‹çš„é—®é¢˜ï¼Œå¤§éƒ¨åˆ†ETLå·¥å…·ä¹Ÿæ²¡æœ‰èƒ½è‡ªåŠ¨å¤„ç†é‡å¤æ•°æ®çš„èƒ½åŠ›ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ’é‡æ˜¯æŒ‡åˆ é™¤é‡å¤çš„æ•°æ®ï¼Œæˆ–è€…æŠŠä¸åŒç³»ç»Ÿé‡Œäº’ç›¸å†²çªçš„æ•°æ®ç»Ÿä¸€ã€‚å­ç³»ç»Ÿ8ï¼šæ•°æ®ä¸€è‡´æ€§æ•°æ®ç»è¿‡æ•°æ®æ’é‡å­ç³»ç»Ÿå’Œå‰é¢æåˆ°çš„å…¶ä»–æ•°æ®è´¨é‡æ­¥éª¤å¤„ç†åï¼Œå°±äº¤ç»™æ•°æ®ä¸€è‡´æ€§å­ç³»ç»Ÿæ¥å¤„ç†ã€‚è¿™ä¸ªæ­¥éª¤çš„ç›®çš„å°±æ˜¯ä½¿æ¥æºäºå¤šä¸ªä¸šåŠ¡ç³»ç»Ÿçš„äº‹å®æ•°æ®éµç…§ç›¸åŒçš„ç»´åº¦ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå…¬å¸æœ‰ä¸€ä¸ªå®¢æœç®¡ç†ç³»ç»Ÿï¼Œè¿™ä¸ªç³»ç»Ÿæœ‰è‡ªå·±çš„å®¢æˆ·æ•°æ®åº“ï¼Œä¸ºäº†æŠŠå®¢æœç®¡ç†ç³»ç»Ÿå’Œé”€å”®ç³»ç»Ÿæ”¾åˆ°åŒä¸€ä¸ªæ•°æ®ä»“åº“é‡Œï¼Œéœ€è¦æŠŠå®¢æœç®¡ç†ç³»ç»Ÿçš„å®¢æˆ·æ•°æ®å’Œé”€å”®ç³»ç»Ÿçš„å®¢æˆ·æ•°æ®ç»Ÿä¸€æˆä¸€ä¸ªå®¢æˆ·ç»´åº¦è¡¨ï¼Œå½“åˆ†åˆ«åŠ è½½æ¥è‡ªè¿™ä¸¤ä¸ªç³»ç»Ÿçš„äº‹å®æ•°æ®æ—¶ï¼Œéœ€è¦æŠŠæ¥è‡ªä¸¤ä¸ªç³»ç»Ÿçš„äº‹å®æ•°æ®æŒ‡å‘åŒä¸€ä¸ªå®¢æˆ·ç»´åº¦è¡¨ã€‚è§£å†³è¿™ä¸ªé—®é¢˜æœ€å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯ç»´åº¦è¡¨ä¸­ä¿ç•™ä»ä¸åŒç³»ç»Ÿå¸¦æ¥çš„è‡ªç„¶é”®ï¼Œåœ¨åŠ è½½äº‹å®æ•°æ®æ—¶ï¼Œå¯ä»¥æŸ¥æ‰¾ç»´åº¦è¡¨ä¸­çš„è¿™äº›æºç³»ç»Ÿçš„è‡ªç„¶é”®ã€‚æ•°æ®å‘å¸ƒå‘å¸ƒæ–°çš„æ•°æ®å¹¶ä¸åªæ˜¯å¾€ç›®æ ‡æ•°æ®åº“é‡Œæ’å…¥æ–°çš„æ•°æ®è¿™ä¹ˆç®€å•ï¼Œå‘å¸ƒæ–°çš„æ•°æ®å…¶å®æœ‰å¾ˆå¤šå·¥ä½œã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä»ä¸åŒç¼“æ…¢å˜æ›´ç»´åº¦æŠ€æœ¯å¯ä»¥çœ‹åˆ°ï¼Œæ›´æ–°ç»´åº¦è¡¨å°±æœ‰å¾ˆå¤šç§æ–¹å¼ã€‚å¦å¤–ï¼Œä½ éœ€è¦ç”Ÿæˆä»£ç†é”®ã€æŸ¥è¯¢æ­£ç¡®çš„ç»´åº¦é”®ã€ç¡®ä¿ç»´åº¦æ•°æ®åœ¨äº‹å®æ•°æ®åŠ è½½å‰å°±å·²ç»åŠ è½½å®Œã€å‡†å¤‡è¦åŠ è½½çš„äº‹å®æ•°æ®ã€‚åŠ è½½äº‹å®æ•°æ®æœ¬èº«ä¹Ÿæ˜¯ä¸€é¡¹æœ‰æŒ‘æˆ˜æ€§çš„å·¥ä½œï¼šäº‹å®æ•°æ®çš„æ•°æ®é‡å¯èƒ½æ¯”è¾ƒå¤§ï¼Œä¹Ÿæœ‰å¯èƒ½è¿˜è¦æ›´æ–°äº‹å®æ•°æ®ï¼Œæˆ–è€…åŒæ—¶å‡ºç°è¿™ä¸¤ç§æƒ…å†µã€‚æ‰€ä»¥éœ€è¦ç‰¹åˆ«å…³å¿ƒè¡¨å’Œå­˜å‚¨çš„åŠŸèƒ½ï¼Œå¦‚OLAPæ•°æ®åº“ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ34ç§å­ç³»ç»Ÿé‡Œæœ‰å¾ˆå¤šéƒ½å±äºæ•°æ®å‘å¸ƒèŒƒç•´ã€‚å­ç³»ç»Ÿ9ï¼šç¼“æ…¢å˜æ›´ç»´åº¦å¤„ç†ç¼“æ…¢å˜æ›´ç»´åº¦ï¼ˆSCDsï¼‰æ˜¯å¤šç»´æ•°æ®ä»“åº“æˆ–è€…æ€»çº¿æ¶æ„çš„åŸºç¡€ã€‚æˆ‘ä»¬çŸ¥é“ç»´åº¦è¡¨é‡Œä¿å­˜äº†ç”¨æ¥å¯¹äº‹å®è¿›è¡Œåˆ†ææˆ–åˆ†ç»„çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç»´åº¦é‡Œæœ‰å®¢æˆ·æ‰€åœ¨åŸå¸‚å­—æ®µï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»Ÿè®¡æˆ–åˆ—å‡ºæŸä¸ªåŸå¸‚é‡Œå®¢æˆ·çš„é”€å”®æƒ…å†µã€‚å¦‚æœå®¢æˆ·æ¢äº†å¦ä¸€ä¸ªåŸå¸‚ï¼Œä¸šåŠ¡ç³»ç»Ÿé‡Œè‚¯å®šè¦ç›¸åº”ä¿®æ”¹è¿™ä¸ªå®¢æˆ·æ‰€åœ¨çš„åŸå¸‚ï¼Œç¼“æ…¢å˜æ›´ç»´åº¦çš„è¿‡ç¨‹ä¹Ÿä¼šæ ¹æ®ä¸åŒçš„è§„åˆ™æ¥å˜æ›´æ•°æ®ä»“åº“ä¸­çš„å®¢æˆ·ç»´åº¦ã€‚æ€»çš„æ¥è¯´ï¼Œæœ‰ä»¥ä¸‹å‡ ç§ç¼“æ…¢å˜æ›´ç»´åº¦çš„æ–¹æ³•ã€‚è¦†ç›–ï¼šç›´æ¥ç”¨æ–°å€¼ä»£æ›¿æ—§å€¼ã€‚å¢åŠ æ–°è¡Œï¼šæŠŠå½“å‰è¡Œæ ‡è®°ä¸ºâ€œoldâ€å¹¶è®¾ç½®ä¸€ä¸ªâ€œç»“æŸâ€æ—¶é—´æˆ³ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªæ–°è¡Œï¼Œæ ‡è®°ä¸ºâ€œcurrentâ€ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªâ€œå¼€å§‹â€æ—¶é—´æˆ³ã€‚å¢åŠ æ–°åˆ—ï¼šç»™è¡¨å¢åŠ ä¸€ä¸ªæ–°åˆ—ï¼Œæ¥å­˜å‚¨æ–°å€¼ï¼ŒåŒæ—¶ä¿ç•™åŸæ¥çš„å€¼ä¸å˜ã€‚å¢åŠ ä¸€ä¸ªå°ç»´åº¦è¡¨ï¼šæŠŠç»å¸¸å˜æ›´çš„è¡¨å±æ€§ä»ä¸»ç»´åº¦è¡¨é‡Œåˆ†ç¦»å‡ºæ¥ï¼Œä¿å­˜åœ¨è‡ªå·±çš„è¡¨é‡Œã€‚åˆ†ç¦»å†å²è¡¨ï¼šæŠŠæ¯æ¬¡å˜åŒ–ä¿å­˜åˆ°ä¸€ä¸ªå†å²è¡¨é‡Œï¼ŒåŒæ—¶ä¿å­˜å˜åŒ–çš„ç±»å‹å’Œå˜åŒ–çš„æ—¶é—´ã€‚è¿™æ ·çš„å†å²è¡¨å¯ä»¥å›ç­”ç±»ä¼¼â€œå»å¹´æœ‰å¤šå°‘å®¢æˆ·ä»æˆéƒ½ç§»åŠ¨åˆ°äº†é‡åº†â€è¿™æ ·çš„é—®é¢˜ã€‚æ··åˆå‹ï¼šæŠŠç±»å‹1ã€2ã€3ç»“åˆèµ·æ¥ï¼ˆ1+2+3=6ï¼‰ã€‚å­ç³»ç»Ÿ10ï¼šä»£ç†é”®ç”Ÿæˆç³»ç»ŸETLæµç¨‹åº”è¯¥å¯ä»¥ç”Ÿæˆä»£ç†é”®ã€‚ä¸€èˆ¬æœ‰ä¸‰ç§æ–¹å¼ï¼šä½¿ç”¨è¡¨é‡Œç°åœ¨ä»£ç†é”®çš„æœ€å¤§å€¼+1ã€‚ä½¿ç”¨æ•°æ®åº“åºåˆ—ã€‚ä½¿ç”¨ä¸€ä¸ªè‡ªå¢çš„å­—æ®µã€‚åé¢ä¸€ç§æ–¹æ³•ä¹Ÿå¯ç”¨äºè¡¨è¾“å‡ºæ­¥éª¤ã€‚å­ç³»ç»Ÿ11ï¼šå±‚æ¬¡ç»´åº¦æ„å»ºåœ¨æ•°æ®ä»“åº“é‡Œè¿˜è¦è€ƒè™‘å¦‚ä½•æ„å»ºå’Œç»´æŠ¤æ•°æ®ä»“åº“é‡Œçš„å±‚æ¬¡ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªå­ç³»ç»Ÿçš„å®Œæ•´çš„åç§°æ˜¯â€œæ„å»ºå›ºå®šçš„ï¼Œå¯å˜æ·±åº¦çš„ï¼Œå¯æœ‰çº§åˆ«ç¼ºå¤±çš„å±‚æ¬¡ç»´åº¦ç³»ç»Ÿâ€ã€‚å±‚æ¬¡å¯ä»¥è®©ç”¨æˆ·åˆ†ææŸ¥çœ‹ç»´åº¦ä¸åŒçº§åˆ«ä¸Šçš„æ•°æ®ã€‚æœ€ç®€å•çš„å±‚æ¬¡æ¦‚å¿µå°±æ˜¯æ—¶é—´ç»´åº¦çš„å±‚æ¬¡ã€‚åœ¨ç°å®ä¸­ï¼Œæ—¶é—´ç»´åº¦éƒ½éœ€è¦è‡³å°‘ä¸€ä¸ªä»¥ä¸Šçš„å±‚æ¬¡ã€‚ä¾‹å¦‚æœ‰â€œå¹´â€”å­£â€”æœˆâ€”æ—¥â€è¿™æ ·çš„å±‚æ¬¡ï¼Œä¹Ÿæœ‰â€œå¹´â€”å‘¨â€”æ—¥â€è¿™æ ·çš„å±‚æ¬¡ã€‚æ—¶é—´ç»´åº¦ä¹Ÿæ˜¯â€œå¹³è¡¡å±‚æ¬¡â€çš„ä¸€ä¸ªä¾‹å­ã€‚åœ¨æ—¶é—´ç»´åº¦é‡Œï¼Œæ‰€æœ‰çº§åˆ«çš„æ·±åº¦éƒ½æ˜¯å›ºå®šä¸€æ ·çš„ã€‚ç»„ç»‡ç»“æ„çš„ç»´åº¦æ›´å¤æ‚ä¸€äº›ï¼Œè¿™ç§ç»´åº¦é€šå¸¸éƒ½æ˜¯â€œä¸å¹³è¡¡çš„â€æˆ–ç§°ä¸ºâ€œå¯å˜æ·±åº¦çš„â€ï¼ˆå­æ ‘çš„æ·±åº¦ä¸åŒï¼‰æˆ–â€œçº§åˆ«ç¼ºå¤±çš„â€ï¼ˆåœ¨å±‚æ¬¡ä¸Šç¼ºå¤±äº†ä¸€äº›çº§åˆ«ï¼‰ã€‚å…³äºåé¢â€œç¼ºå¤±çš„â€ï¼Œå¯ä»¥æƒ³ä¸€ä¸‹åœ°ç†ç»´åº¦ï¼Œåœ°ç†ç»´åº¦é€šå¸¸çš„å±‚æ¬¡æ˜¯â€œå›½å®¶â€”åœ°åŒºâ€”å·ï¼ˆçœï¼‰â€”åŸå¸‚â€ã€‚ä¸€äº›å›½å®¶å¯èƒ½æ²¡æœ‰â€œåœ°åŒºâ€æˆ–â€œå·ï¼ˆçœï¼‰â€æˆ–éƒ½æ²¡æœ‰ï¼Œè¿™å°±æ˜¯ç¼ºå¤±äº†çº§åˆ«ã€‚åœ¨æºç³»ç»Ÿé‡Œï¼Œé€šå¸¸ä½¿ç”¨â€œé€’å½’â€çš„å…³ç³»æ¥å®ç°â€œä¸å¹³è¡¡çš„â€æˆ–â€œçº§åˆ«ç¼ºå¤±çš„â€çš„æƒ…å†µã€‚å­ç³»ç»Ÿ12ï¼šç‰¹æ®Šç»´åº¦ç”Ÿæˆç³»ç»Ÿé™¤äº†ç¼“æ…¢å˜åŒ–ç»´åº¦ï¼ŒåŸºäºå¤šç»´æ¨¡å‹çš„æ•°æ®ä»“åº“ï¼Œè‡³å°‘éƒ½åŒ…å«ä¸€ä¸ªç‰¹æ®Šç»´åº¦ï¼Œæ—¶é—´ç»´åº¦ã€‚ä¸‹é¢ä¸€äº›ç±»å‹çš„ç»´åº¦ä¹Ÿéƒ½æ˜¯ç‰¹æ®Šç»´åº¦ã€‚æ‚é¡¹ç»´åº¦ï¼ˆä¹Ÿç§°ä¸ºåƒåœ¾ç»´åº¦ï¼‰ï¼šä¸€äº›é›¶æ•£çš„å±æ€§ï¼Œåˆ†æéœ€è¦ä½†åˆä¸é€‚åˆæ”¾åœ¨å…¶ä»–ç»´åº¦è¡¨é‡Œã€‚ä¾‹å¦‚çŠ¶æ€æ ‡å¿—ã€yes/noå’Œå…¶ä»–ä½é˜¶ï¼ˆlowcardinalityï¼‰å­—æ®µéƒ½å¯ä»¥æ”¾åœ¨æ‚é¡¹ç»´åº¦è¡¨é‡Œã€‚å°ç»´åº¦ï¼šä»å¤§ç»´åº¦è¡¨é‡Œåˆ†ç¦»å‡ºç»å¸¸å‘ç”Ÿå˜åŒ–çš„ä¸€äº›å±æ€§ï¼Œå•ç‹¬æ”¾åœ¨ä¸€ä¸ªå°ç»´åº¦è¡¨é‡Œã€‚æˆ‘ä»¬ä¹ŸæŠŠè¿™ç§å°ç»´åº¦è¡¨ç§°ä¸ºSCD4ã€‚æ”¶ç¼©çš„æˆ–ä¸Šå·çš„ç»´åº¦ï¼šæ™®é€šç»´åº¦è¡¨çš„å­é›†ï¼Œä¸ºäº†é¿å…å†²çªï¼Œè¿™ç§ç»´åº¦æ˜¯æ ¹æ®æ™®é€šç»´åº¦è¡¨åˆ›å»ºå’Œæ›´æ–°çš„ã€‚è¿™ç§ç»´åº¦é€‚ç”¨äºèšé›†çš„æ•°æ®ï¼Œä¾‹å¦‚åº•å±‚ä¿å­˜çš„æ˜¯æ¯å¤©çš„æ•°æ®ï¼Œèšé›†çš„æ•°æ®æ˜¯æŒ‰æœˆä¿å­˜çš„ã€‚é™æ€ç»´åº¦ï¼šé€šå¸¸æ˜¯å°çš„å­—å…¸è¡¨æˆ–å‚ç…§è¡¨ï¼Œè¿™ç±»è¡¨åœ¨æºç³»ç»Ÿä¸­æ²¡æœ‰å¯¹åº”çš„æ•°æ®ï¼Œå¦‚çŠ¶æ€ç¼–ç æè¿°æˆ–æ€§åˆ«ã€‚ç”¨æˆ·è‡ªå®šä¹‰ç»´åº¦ï¼šæºç³»ç»Ÿé‡Œæ²¡æœ‰çš„è€ŒæŠ¥è¡¨éœ€è¦çš„è‡ªå®šä¹‰çš„æè¿°ã€åˆ†ç»„å’Œå±‚æ¬¡ã€‚å¯ä»¥æ˜¯ä»»æ„çš„ç»´åº¦ã€‚å”¯ä¸€åŒºåˆ†å®ƒä»¬çš„å°±æ˜¯è¿™äº›ç»´åº¦æ˜¯é€šè¿‡ç”¨æˆ·æ¥ç»´æŠ¤çš„ï¼Œè€Œä¸æ˜¯é€šè¿‡æ•°æ®ä»“åº“å›¢é˜Ÿæˆ–ä¸€ä¸ªETLè¿‡ç¨‹ã€‚å­ç³»ç»Ÿ13ï¼šäº‹å®è¡¨åŠ è½½ï¼ˆäº‹åŠ¡ç²’åº¦ã€å‘¨æœŸå¿«ç…§ç²’åº¦ã€ç´¯ç§¯å¿«ç…§ç²’åº¦äº‹å®è¡¨çš„åŠ è½½ç³»ç»Ÿï¼‰åœ¨å¾€æ•°æ®ä»“åº“åŠ è½½äº‹å®è¡¨ä¹‹å‰ï¼Œéœ€è¦æŠŠæ•°æ®å‡†å¤‡å¥½ã€‚åŠ è½½äº‹å®è¡¨è¿‡ç¨‹å¹¶ä¸æ˜¯é‡ç‚¹ï¼Œä¹‹æ‰€ä»¥æŠŠåŠ è½½äº‹å®è¡¨å•ç‹¬ä½œä¸ºä¸€ä¸ªå­ç³»ç»Ÿåˆ†å‡ºæ¥ï¼Œä¸»è¦æ˜¯ä¸ºäº†å¼ºè°ƒå¦‚ä¸‹ä¸‰ç§ä¸åŒç±»å‹çš„äº‹å®è¡¨ã€‚äº‹åŠ¡ç²’åº¦äº‹å®è¡¨ï¼šä»¥æ¯ä¸€ä¸ªäº‹åŠ¡æˆ–äº‹ä»¶ä¸ºå•ä½ï¼Œä¾‹å¦‚ä¸€ä¸ªé”€å”®è®°å½•ã€ä¸€ä¸ªç”µè¯å‘¼å«è®°å½•ï¼Œä½œä¸ºäº‹å®è¡¨é‡Œçš„ä¸€è¡Œæ•°æ®ã€‚å‘¨æœŸå¿«ç…§äº‹å®è¡¨ï¼šäº‹å®è¡¨é‡Œå¹¶ä¸ä¿å­˜å…¨éƒ¨æ•°æ®ï¼Œåªä¿å­˜å›ºå®šæ—¶é—´é—´éš”çš„æ•°æ®ï¼Œä¾‹å¦‚æ¯å¤©æˆ–æ¯æœˆçš„åº“å­˜æ°´å¹³ï¼Œæˆ–æ¯æœˆçš„è´¦æˆ·ä½™é¢ã€‚ç´¯ç§¯å¿«ç…§äº‹å®è¡¨ï¼šå½“æœ‰æ–°çš„æ•°æ®æ—¶ï¼Œæ›´æ–°äº‹å®è¡¨é‡Œçš„è®°å½•ã€‚æ•°æ®ä»“åº“é‡Œæ€»æ˜¯ä¿å­˜æœ€æ–°çš„æ•°æ®ã€‚ä¾‹å¦‚è®¢å•è¿‡ç¨‹ï¼Œè®¢å•è¿‡ç¨‹é‡Œæœ‰å¾ˆå¤šç‹¬ç«‹çš„æ—¥æœŸï¼Œå¦‚è®¢å•æ—¥æœŸã€æœŸæœ›å‘è´§æ—¥æœŸã€å®é™…å‘è´§æ—¥æœŸã€æœŸæœ›æ”¶è´§æ—¥æœŸã€å®é™…æ”¶è´§æ—¥æœŸå’Œä»˜æ¬¾æ—¥æœŸã€‚å½“è¿™ä¸ªè¿‡ç¨‹è¿›è¡Œæ—¶ï¼Œéšç€ä¸Šé¢å„ç§æ—¶é—´çš„å‡ºç°ï¼Œäº‹å®è¡¨é‡Œçš„è®°å½•ä¹Ÿåœ¨ä¸æ–­æ›´æ–°ã€‚åŠ è½½äº‹å®è¡¨ï¼Œé€šå¸¸è¦åŠ è½½å‡ ç™¾ä¸‡è¡Œæ•°æ®ã€‚ä¸ºäº†å¿«é€ŸåŠ è½½ï¼Œå¤§å¤šæ•°æ•°æ®åº“ç³»ç»Ÿéƒ½æä¾›äº†æ‰¹é‡åŠ è½½æ–¹å¼ï¼Œæ‰¹é‡åŠ è½½æ–¹å¼é€šå¸¸è§„é¿äº†æ•°æ®åº“çš„äº‹åŠ¡å¼•æ“ï¼Œç›´æ¥æŠŠæ•°æ®å†™å…¥åˆ°ç›®æ ‡è¡¨ã€‚æœ‰æ—¶ä¸ºäº†æé«˜å¤„ç†æ•°æ®çš„é€Ÿåº¦ï¼Œè¦åˆ é™¤äº‹å®è¡¨ä¸Šçš„æ‰€æœ‰ç´¢å¼•ï¼Œåœ¨åŠ è½½å®Œåå†é‡å»ºç´¢å¼•ã€‚å­ç³»ç»Ÿ14ï¼šä»£ç†é”®ç®¡é“è¿™ä¸ªå­ç³»ç»Ÿè´Ÿè´£æŠ½å–æ­£ç¡®çš„ä»£ç†é”®ï¼Œç”¨äºåŠ è½½äº‹å®è¡¨ã€‚è¿™é‡Œç”¨â€œç®¡é“â€ä¸€è¯æ˜¯å› ä¸ºäº‹å®è¡¨çš„åŠ è½½çœ‹èµ·æ¥åƒä¸€ä¸ªå·¥åºï¼Œå·¥åºé‡Œçš„æ¯ä¸ªç¯èŠ‚éƒ½ä½¿ç”¨æ•°æ®çš„è‡ªç„¶é”®å»æŸ¥æ‰¾ç»´åº¦è¡¨é‡Œçš„ä»£ç†é”®ã€‚ä¸ºäº†è®©è¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹æ›´é«˜æ•ˆï¼Œæœ€å¥½æŠŠè¦æŸ¥è¯¢çš„ç»´åº¦æ•°æ®é¢„å…ˆè£…è½½åˆ°å†…å­˜é‡Œã€‚å­ç³»ç»Ÿ15ï¼šå¤šå€¼ç»´åº¦æ¡¥æ¥è¡¨ç”Ÿæˆç³»ç»Ÿå¤„ç†ä¸åŒæ·±åº¦çš„å±‚æ¬¡æ—¶éœ€è¦æ¡¥æ¥è¡¨ã€‚ä¾‹å¦‚ä¸€ä¸ªå®¢æˆ·ï¼Œæ˜¯ä¸€ä¸ªå…¬å¸ï¼Œå®ƒæœ‰å­å…¬å¸å’Œå­å­å…¬å¸ã€‚æ¯ä¸€çº§çš„å…¬å¸éƒ½å¯èƒ½å»è´­ä¹°å•†å“ï¼Œå¦‚æœæƒ³ä»æ¯å…¬å¸çš„è§’åº¦å»çœ‹ä¸€å…±è´­ä¹°äº†å¤šå°‘å•†å“ï¼Œå°±éœ€è¦ä½¿ç”¨æ¡¥æ¥è¡¨æ¥å®ç°ã€‚å½“æœ‰å¤šä¸ªç»´åº¦é¡¹å’Œäº‹å®è¡¨æˆ–å…¶ä»–ç»´åº¦è¡¨å…³è”æ—¶ï¼Œä¹Ÿè¦ä½¿ç”¨æ¡¥æ¥è¡¨ã€‚ä¾‹å¦‚ï¼šç”µå½±ç¥¨å’Œç”µå½±æ¼”å‘˜ï¼Œå¦‚æœæƒ³æ±‡æ€»ä¸€ä¸ªæ¼”å‘˜æœ‰å¤šå°‘ç”µå½±ç¥¨æ”¶å…¥ï¼Œå°±éœ€è¦åœ¨ç”µå½±å’Œç”µå½±æ¼”å‘˜ç»´åº¦ä¹‹é—´å»ºç«‹ä¸€ä¸ªæ¡¥æ¥è¡¨ï¼Œè¿™ä¸ªæ¡¥æ¥è¡¨æŠŠç”µå½±å’Œç”µå½±æ¼”å‘˜å…³è”èµ·æ¥ï¼Œæ¡¥æ¥è¡¨é‡Œè¿˜å¯ä»¥è®¾ç½®ç”µå½±æ¼”å‘˜çš„æƒé‡å› å­ã€‚å­ç³»ç»Ÿ16ï¼šè¿Ÿåˆ°æ•°æ®å¤„ç†åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„è®¨è®ºéƒ½æ˜¯åœ¨è¦å¤„ç†æ•°æ®åŒæ—¶åˆ°è¾¾çš„å‡è®¾å‰æä¸‹ã€‚ä½†åœ¨ä¸€äº›åœºåˆä¸‹ï¼Œå¹¶éå¦‚æ­¤ï¼šäº‹å®è¡¨æ•°æ®å’Œç»´åº¦è¡¨æ•°æ®éƒ½å¯èƒ½æ™šåˆ°ã€‚å¯¹äº‹å®è¡¨æ¥è¯´è¿™ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œå”¯ä¸€ä¸åŒçš„å°±æ˜¯è¦æ ¹æ®ç»´åº¦çš„æœ‰æ•ˆæ—¶é—´æŸ¥æ‰¾ä¸šåŠ¡å‘ç”Ÿæ—¶çš„ç»´åº¦ä»£ç†é”®ã€‚åªè¦åœ¨æŸ¥è¯¢æ¡ä»¶é‡Œå¢åŠ  valid_from å’Œ valid_to ä¸¤ä¸ªå­—æ®µå°±å¯ä»¥ã€‚â€œç»´åº¦æŸ¥è¯¢å’Œæ›´æ–°â€æ­¥éª¤é»˜è®¤å°±æœ‰è¿™ä¸¤ä¸ªå­—æ®µã€‚å¦‚æœç»´åº¦è¡¨æ•°æ®æ™šåˆ°ï¼Œæƒ…å†µå°±è¦éº»çƒ¦ä¸€äº›ã€‚å¦‚æœäº‹å®è¡¨å·²ç»åŠ è½½å®Œäº†ï¼Œä½†ç»´åº¦è¡¨çš„æ•°æ®ä¸æ˜¯æœ€æ–°çš„ã€‚å½“è¦æ›´æ–°çš„ç»´åº¦æ•°æ®è¿‡æ¥åï¼ŒæŒ‰ç…§SCD2ï¼Œä¼šåœ¨ç»´åº¦è¡¨é‡Œå¢åŠ ä¸€æ¡è®°å½•ï¼Œæ­¤æ—¶è¦ä½¿ç”¨æ–°åˆ›å»ºçš„ç»´åº¦çš„ä»£ç†é”®æ¥æ›´æ–°äº‹å®è¡¨é‡Œæœ‰ä¸Šä¸€ä¸ªä»£ç†é”®çš„æ•°æ®ã€‚å¦å¤–è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå½“äº‹å®æ•°æ®è¿‡æ¥ï¼Œä½†æ ¹æ®äº‹å®è¡¨é‡Œçš„ç»´åº¦è‡ªç„¶é”®ï¼Œä»ç»´åº¦è¡¨é‡Œæ‰¾ä¸åˆ°å¯¹åº”çš„ä»£ç†é”®ã€‚æ­¤æ—¶å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„ç»´åº¦è®°å½•ï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½è®¾ç½®æˆé»˜è®¤å€¼å’Œç©ºå€¼ï¼Œä½¿ç”¨è¿™æ¡è®°å½•çš„ä»£ç†é”®ã€‚ç„¶åå½“æ­£ç¡®çš„ç»´åº¦æ•°æ®ä»æºç³»ç»Ÿä¸­è¿‡æ¥æ—¶ï¼Œå†æ›´æ–°è¿™äº›é»˜è®¤å€¼å’Œç©ºå€¼ã€‚å­ç³»ç»Ÿ17ï¼šç»´åº¦ç®¡ç†ç³»ç»Ÿï¼ˆä¸­å¿ƒæ§åˆ¶ç³»ç»Ÿï¼‰â€œä¸­å¿ƒæ§åˆ¶ç³»ç»Ÿï¼Œç”¨æ¥å‡†å¤‡å’Œå‘æ•°æ®ä»“åº“å‘å¸ƒæ­£ç¡®çš„ç»´åº¦â€ã€‚ä¸­å¿ƒæ§åˆ¶ç³»ç»Ÿä¸åªæ˜¯ç»„ç»‡ï¼Œè¿˜è´Ÿè´£ç®¡ç†æ‰€æœ‰å’Œç»´åº¦ç›¸å…³çš„ä»»åŠ¡ã€‚å­ç³»ç»Ÿ18ï¼šäº‹å®è¡¨ç®¡ç†ç³»ç»Ÿè¿™ä¸ªå­ç³»ç»Ÿè´Ÿè´£ä»»ä½•åˆ›å»ºã€ç»„ç»‡ã€ç®¡ç†å’Œäº‹å®è¡¨ç›¸å…³çš„ä»»åŠ¡ã€‚å­ç³»ç»Ÿ17å’Œ18åœ¨ä¸€èµ·ç»“ä¼´å·¥ä½œï¼šäº‹å®è¡¨ç®¡ç†ç³»ç»Ÿè·å–åˆ°ç”±ç»´åº¦ç®¡ç†ç³»ç»Ÿç®¡ç†çš„ç»´åº¦ï¼Œå¹¶æŠŠè¿™äº›ç»´åº¦æ”¾åˆ°äº‹å®è¡¨ä¸­ã€‚å­ç³»ç»Ÿ19ï¼šèšé›†æ„å»ºå¦‚æœæ•°æ®åº“æ˜¯ç”¨äºåˆ†æçš„ï¼Œä¸€å®šä¼šæœ‰æ€§èƒ½æ–¹é¢çš„è¦æ±‚ã€‚è¿™ç§å¯¹é€Ÿåº¦çš„è¦æ±‚äº§ç”Ÿäº†å‡ ç§è§£å†³æ–¹æ¡ˆï¼Œåœ¨è¿™å‡ ç§æ–¹æ¡ˆé‡Œï¼Œèšé›†è¡¨å¯¹æ€§èƒ½çš„æå‡æœ€å¤§ã€‚å¦‚æœèƒ½æŠŠå¹³å‡30åˆ†é’Ÿçš„å“åº”æ—¶é—´é™ä½åˆ°å‡ æ¯«ç§’ï¼Œå®¢æˆ·ä¼šéå¸¸é«˜å…´ã€‚èšé›†è¡¨å°±å¯ä»¥è¾¾åˆ°è¿™æ ·çš„æ•ˆæœã€‚ä½†ä»…æœ‰èšé›†è¡¨æ˜¯ä¸è¡Œçš„ï¼Œè¿˜éœ€è¦ç»´æŠ¤èšé›†è¡¨ï¼Œæ•°æ®åº“è¿˜éœ€è¦çŸ¥é“èšé›†è¡¨çš„å­˜åœ¨ä»¥åˆ©ç”¨èšé›†è¡¨ã€‚è¿™ä¹Ÿå°±æ˜¯MySQLã€PostgreSQLã€Ingresè¿™äº›å¼€æºäº§å“å’ŒOracleï¼ŒSQLServeråŠDB2è¿™äº›å•†ä¸šäº§å“çš„å·®è·æ‰€åœ¨ï¼ˆè¿™äº›å•†ä¸šäº§å“éƒ½æœ‰è‡ªåŠ¨èšé›†å¯¼èˆªåŠŸèƒ½ï¼‰ã€‚æœ‰èšé›†è¡¨åŠŸèƒ½çš„å”¯ä¸€çš„ä¸€ä¸ªå¼€æºäº§å“æ˜¯Mondrianï¼Œä½†è¿™äº›èšé›†è¡¨è¿˜æ˜¯éœ€è¦ç”±Mondrianèšé›†è¡¨è®¾è®¡å™¨æ¥åˆ›å»ºå’Œç»´æŠ¤ã€‚å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç‰¹æ®Šçš„åˆ†æå‹æ•°æ®åº“ï¼Œå¦‚LucidDBã€InfoBrightã€MonetDBã€InfiniDBã€Ingres/Vectorwiseï¼Œæˆ–æŠŠåˆ†æå‹æ•°æ®åº“å¦‚LucidDBå’ŒPentahoèšé›†è¡¨è®¾è®¡å™¨ç»“åˆèµ·æ¥ã€‚ç”Ÿæˆå’ŒåŠ è½½èšé›†è¡¨æ•°æ®åªæ˜¯ä¸€æ¬¡æ€§çš„å·¥ä½œï¼Œä½†å½“æ•°æ®ä»“åº“çš„æ•°æ®å‘ç”Ÿå˜åŒ–åï¼ŒLucidDBå’ŒPentahoèšé›†è¡¨è®¾è®¡å™¨éƒ½ä¸ä¼šå»ç»´æŠ¤èšé›†è¡¨ã€‚å­ç³»ç»Ÿ20ï¼šOLAPCubeæ„å»ºç³»ç»ŸOLAPæ•°æ®åº“æœ‰ç‰¹æ®Šçš„å­˜å‚¨ç»“æ„ï¼Œå½“åŠ è½½çš„æ—¶å€™ï¼Œå¯ä»¥é¢„å…ˆèšé›†æ•°æ®ã€‚ä¸€äº›OLAPæ•°æ®åº“åªèƒ½å†™ä¸èƒ½æ›´æ–°ï¼Œæ‰€ä»¥ï¼Œåœ¨åšæ›´æ–°ä¹‹å‰è¦æŠŠæºæ•°æ®æ¸…é™¤ã€‚å…¶ä»–OLAPæ•°æ®åº“ï¼ˆå¦‚å¾®è½¯çš„åˆ†ææœåŠ¡å™¨ï¼‰å¯ä»¥æ›´æ–°äº‹å®è¡¨ï¼Œä½†æœ‰å®ƒè‡ªå·±çš„æ›´æ–°æœºåˆ¶ã€‚å­ç³»ç»Ÿ21ï¼šæ•°æ®æ•´åˆç®¡ç†ç³»ç»Ÿè¿™ä¸ªå­ç³»ç»Ÿç”¨æ¥ä»æ•°æ®ä»“åº“è·å–æ•°æ®ï¼Œå¹¶æŠŠæ•°æ®å‘é€åˆ°å…¶ä»–ç¯å¢ƒä¸­ï¼Œé€šå¸¸ç”¨äºç¦»çº¿æ•°æ®åˆ†ææˆ–è€…å…¶ä»–ç‰¹æ®Šç›®çš„ï¼Œå¦‚ç»™ç‰¹å®šå®¢æˆ·å‘é€æŠ¥è¡¨ã€‚ç®¡ç†ETLç¯å¢ƒåå°†ä»‹ç»14ä¸ªETLå­ç³»ç»Ÿï¼Œè¿™äº›å­ç³»ç»Ÿç”¨æ¥å®Œæˆç®¡ç†åŠŸèƒ½ã€‚å­ç³»ç»Ÿ22ï¼šä½œä¸šè°ƒåº¦ä»»åŠ¡çš„ETLä½œä¸šä»»åŠ¡éƒ½éœ€è¦è·‘èµ·æ¥ï¼Œè¿™æ—¶å°±éœ€è¦ä½œä¸šé«˜åº¦ç³»ç»Ÿæ¥ç®¡ç†è¿™äº›ä»»åŠ¡ã€‚å­ç³»ç»Ÿ23ï¼šå¤‡ä»½ç³»ç»Ÿå¤‡ä»½ETLè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸­é—´æ•°æ®ä¹Ÿåº”è¯¥æ˜¯ETLæ–¹æ¡ˆçš„ä¸€éƒ¨åˆ†ã€‚Ralph Kimballæ¨èåœ¨ETLæµç¨‹ä¸­çš„ä¸‰ä¸ªåœ°æ–¹ç¼“å­˜ï¼ˆå¤‡ä»½ï¼‰è¿™äº›æ•°æ®ï¼šä»æºç³»ç»Ÿä¸­æŠ½å–ä¹‹åï¼Œåšä»»ä½•æ”¹åŠ¨ä¹‹å‰ã€‚æ¸…æ´—ã€æ’é‡ã€æ›´æ­£ä¹‹åï¼Œæ­¤æ—¶å¯èƒ½è¿˜åœ¨æ–‡æœ¬æ–‡ä»¶ä¸­æˆ–ä½¿ç”¨æ­£è§„åŒ–çš„æ ¼å¼ã€‚å·²ç»åšå®Œæœ€åå¤„ç†ï¼Œå¯ä»¥å†™å…¥åˆ°æ•°æ®ä»“åº“ä¹‹å‰ã€‚å¤‡ä»½æ•°æ®ä»“åº“æœ¬èº«é€šå¸¸ä¸æ˜¯ETLå›¢é˜Ÿçš„å·¥ä½œï¼Œä½†ETLå›¢é˜Ÿå¯ä»¥å’ŒDBAç´§å¯†åˆä½œæ¥å®ç°é”™è¯¯æ¢å¤çš„æ–¹æ¡ˆã€‚å­ç³»ç»Ÿ24ï¼šæ¢å¤å’Œé‡æ–°å¯åŠ¨ç³»ç»ŸETLè®¾è®¡çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†å°±æ˜¯åœ¨ETLå¤±è´¥æ—¶ï¼Œå¯ä»¥é‡æ–°å¯åŠ¨ã€‚æˆ‘ä»¬è¦å°½é‡é¿å…ä¸¢å¤±æ•°æ®å’Œé‡å¤æ•°æ®çš„æƒ…å†µï¼Œæ‰€ä»¥è¿™ä¸ªå­ç³»ç»Ÿéå¸¸é‡è¦ã€‚éµç…§å‰é¢å­ç³»ç»Ÿæè¿°çš„ç­–ç•¥å¯ä»¥æ›´å®¹æ˜“é‡æ–°å¯åŠ¨ä¸€ä¸ªå¤±è´¥çš„ä½œä¸šã€‚å­ç³»ç»Ÿ25ï¼šç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼›å­ç³»ç»Ÿ26ï¼šä»å¼€å‘ç¯å¢ƒåˆ°æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒçš„ç‰ˆæœ¬ç§»æ¤ç³»ç»Ÿæœ‰å¾ˆå¤šç§æ–¹æ³•å¯ä»¥å®ç°ç‰ˆæœ¬æ§åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨Gitè¿™æ ·çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ¥ç®¡ç†ã€‚ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¹Ÿä¸åº”è¯¥æˆä¸ºä¸€ä¸ªäº‹åæ‰æƒ³åˆ°çš„é—®é¢˜ã€‚åœ¨è¿™é‡Œå¼•ç”¨Ralph Kimballå¯¹ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„è§‚ç‚¹ã€‚ä½ éœ€è¦ç»™ETLç³»ç»Ÿé‡Œçš„æ¯ä¸ªéƒ¨åˆ†éƒ½ç¡®å®šä¸€ä¸ªä¸»ç‰ˆæœ¬å·ï¼Œå¦å¤–ETLç³»ç»Ÿä½œä¸ºä¸€ä¸ªæ•´ä½“ä¹Ÿè¦æœ‰ä¸€ä¸ªä¸»ç‰ˆæœ¬å·ã€‚è¿™æ ·å¦‚æœä»Šå¤©å‘å¸ƒçš„ç‰ˆæœ¬å‘ç”Ÿä¸¥é‡çš„é”™è¯¯ï¼Œå¯ä»¥å¿«é€Ÿæ¢å¤åˆ°æ˜¨å¤©çš„ETLç‰ˆæœ¬ã€‚è¯¦ç»†è§ï¼šã€ŠThe Data Warehouse Lifecycle Toolkitï¼Œ2nd Editionã€‹ã€‚å­ç³»ç»Ÿ27ï¼šå·¥ä½œæµç›‘æ§æ˜¯å¦å°è¯•è¿‡ä¸ä½¿ç”¨è®¡æ—¶å™¨å’Œæ¸©åº¦æŒ‡ç¤ºå™¨æ¥çƒ¤è›‹ç³•ï¼Ÿéå¸¸éš¾å§ï¼ŸåŒæ ·è¿è¡Œä¸€ä¸ªETLä½œä¸šï¼Œè€Œä¸ä½¿ç”¨ä»»ä½•æ–¹æ³•å»ç›‘æ§è¿è¡Œè¿‡ç¨‹ï¼Œä¸æ˜¾ç¤ºæ‰§è¡Œä½œä¸šçš„æ‰§è¡Œç»†èŠ‚ï¼Œä¹Ÿä¼šä½¿è¿è¡ŒETLä½œä¸šéå¸¸å›°éš¾ã€‚å·²ç»å¤„ç†äº†å¤šå°‘è¡Œï¼Œå¤„ç†çš„é€Ÿåº¦æœ‰å¤šå¿«ï¼Ÿæ¶ˆè€—äº†å¤šå°‘å†…å­˜ï¼Ÿå“ªæ¡è®°å½•å‡ºé”™äº†ï¼Œä¸ºä»€ä¹ˆå‡ºé”™ï¼Ÿç›‘æ§è¿‡ç¨‹åº”è¯¥å¯ä»¥å›ç­”æ‰€æœ‰çš„è¿™äº›é—®é¢˜ï¼Œä¸€èˆ¬æ—¥å¿—æ¡†æ¶å°±æ˜¯ç›‘æ§è¿‡ç¨‹ã€‚å­ç³»ç»Ÿ28ï¼šæ’åºç³»ç»Ÿå¯¹äºä¸€äº›æ“ä½œï¼ˆå¦‚åˆ†ç»„ã€æ’åºåˆå¹¶æ“ä½œï¼‰ï¼Œæ•°æ®äº‹å…ˆè¦è¿›è¡Œæ’åºã€‚ä¸€èˆ¬è¿™ä¸ªæ­¥éª¤åœ¨å†…å­˜é‡Œæ“ä½œï¼Œä½†å¦‚æœæ•°æ®å¤ªå¤§äº†ä¼šåœ¨ç¡¬ç›˜ä¸Šåˆ†é¡µã€‚å¯¹äºéå¸¸å¤§çš„æ–‡ä»¶ï¼Œå¯ä»¥éœ€è¦ç‹¬ç«‹çš„æ’åºå·¥å…·ã€‚æˆ‘ä»¬ä¸è®¨è®ºè¿™äº›ä¸“ç”¨çš„æ’åºå·¥å…·è€Œåªæ˜¯ä½¿ç”¨æˆ‘ä»¬çš„â€œæ’åºâ€æ­¥éª¤æ¥å®Œæˆæˆ‘ä»¬çš„æ’åºå·¥ä½œã€‚å­ç³»ç»Ÿ29ï¼šè¡€ç»Ÿå’Œä¾èµ–åˆ†æETLç³»ç»Ÿåº”è¯¥åŒæ—¶æä¾›è¡€ç»Ÿåˆ†æå’Œå½±å“åˆ†æåŠŸèƒ½ã€‚è¡€ç»Ÿåˆ†æä»å¤„ç†åçš„æ•°æ®å¼€å§‹å‘åè¿½æº¯æŸ¥çœ‹è¿™ä¸ªæ•°æ®èµ·æºäºå“ªé‡Œï¼Œç„¶ååœ¨ä¸­é—´çš„ç¯èŠ‚å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œäº†å“ªäº›å¤„ç†ã€‚ä¾èµ–æˆ–å½±å“åˆ†æçš„æ–¹å‘å’Œè¡€ç»Ÿåˆ†æç›¸åï¼Œå³ä»æ•°æ®çš„èµ·æºå¼€å§‹ï¼ŒæŸ¥çœ‹å“ªäº›æ­¥éª¤æˆ–è½¬æ¢ä½¿ç”¨äº†è¿™ä¸ªæ•°æ®ï¼Œè¿™æ ·å¯ä»¥æ˜¾ç¤ºå‡ºå¦‚æœä¸€ä¸ªæ•°æ®æˆ–è¡¨å‘ç”Ÿäº†å˜åŒ–ä¼šå½±å“åˆ°ç³»ç»Ÿçš„å“ªäº›éƒ¨åˆ†ã€‚å­ç³»ç»Ÿ30ï¼šé—®é¢˜æŠ¥å‘Šç³»ç»Ÿä¸‡ä¸€è¿è¡Œä¸­å‡ºäº†é”™è¯¯ï¼ˆç›¸ä¿¡æˆ‘ä»¬ï¼Œè‚¯å®šä¼šå‡ºé”™çš„ï¼‰ï¼Œä½ éœ€è¦å°½å¿«çŸ¥é“è¿è¡Œä¸­å‘ç”Ÿäº†é”™è¯¯ã€‚å­ç³»ç»Ÿ31ï¼šå¹¶è¡Œ/ç®¡é“ç³»ç»Ÿä¸ºäº†èƒ½åœ¨çŸ­æ—¶é—´å†…å¤„ç†å¤§é‡æ•°æ®ï¼Œä»»åŠ¡åº”è¯¥å¯ä»¥å¹¶è¡Œè¿è¡Œï¼Œç”šè‡³åœ¨å¤šå°æœºå™¨ä¸ŠåŒæ—¶è¿è¡Œã€‚ç°åœ¨çš„Reactive Streamï¼ˆååº”å¼æµï¼‰è§„èŒƒæ˜¯æ•°æ®å¤„ç†å¾ˆå¥½çš„ä¸€ä¸ªæ–¹å¼ã€‚åœ¨äº‘è®¡ç®—ç¯å¢ƒä¸‹ï¼ˆå¦‚é˜¿é‡Œäº‘çš„ECSã€Amazonçš„EC2ï¼‰è¿è¡ŒETLä½œä¸šï¼Œå¯ä»¥é¿å…å¤§è§„æ¨¡çš„ç¡¬ä»¶æŠ•èµ„ï¼Œä»¥å¾ˆä½çš„è¿è¥æˆæœ¬å¸¦æ¥å¤§è§„æ¨¡çš„æŒ‰éœ€å¯æ‰©å±•çš„è®¡ç®—èƒ½åŠ›ã€‚å­ç³»ç»Ÿ32ï¼šå®‰å…¨ç³»ç»Ÿåœ¨ç°åœ¨çš„ITé¢†åŸŸï¼Œå®‰å…¨å’Œåˆè§„æ˜¯å¾ˆçƒ­é—¨çš„ä¸»é¢˜ã€‚æ•°æ®ä»“åº“é‡Œä¿å­˜äº†ä¼ä¸šæ‰€æœ‰çš„æ•°æ®ï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“äº§ç”Ÿé£é™©çš„åœ°æ–¹ã€‚å¦å¤–åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒETLè¿‡ç¨‹å¯ä»¥ç›´æ¥è®¿é—®åˆ°å¾ˆå¤šæºç³»ç»Ÿï¼Œæ‰€ä»¥ETLè§£å†³æ–¹æ¡ˆæœ¬èº«ä¹Ÿæ˜¯æ˜“è¢«æ”»å‡»çš„åœ°æ–¹ã€‚å­ç³»ç»Ÿ33ï¼šåˆè§„æŠ¥å‘Šç³»ç»Ÿç¡®ä¿ä¸€ä¸ªETLæµç¨‹éµç…§è§„ç« åˆ¶åº¦ï¼Œæ‰€éœ€è¦çš„å¤§å¤šæ•°æ–¹æ³•å·²ç»åœ¨å…¶ä»–å­ç³»ç»Ÿä¸­æ¶‰åŠåˆ°äº†ã€‚åˆè§„æ„å‘³ç€è¦å¯¹æ•°æ®è¿›è¡Œè¯¦ç»†çš„å®¡è®¡ï¼Œå®¡è®¡åŒ…æ‹¬æ•°æ®ä»å“ªé‡Œæ¥ï¼Œåœ¨æ•°æ®ä¸Šé¢æ‰§è¡Œäº†ä»€ä¹ˆæ“ä½œï¼ˆè¡€ç»Ÿï¼‰ï¼Œæ•°æ®åœ¨å†™å…¥åˆ°æ•°æ®ä»“åº“ä¹‹å‰æ˜¯ä»€ä¹ˆæ ·å­ï¼ˆåŸºäºæ—¶é—´æˆ³çš„å¤‡ä»½ï¼‰ï¼Œåœ¨æ¯ä¸ªæ—¶é—´ç‚¹çš„å€¼æ˜¯ä»€ä¹ˆï¼ˆå®¡è®¡è¡¨ï¼ŒSCD2ï¼‰ï¼Œè°è®¿é—®äº†æ•°æ®ï¼ˆæ—¥å¿—ï¼‰ã€‚Data Vaultæ˜¯ä¸€ç§æä¾›äº†å¾ˆå¥½å®¡è®¡åŠŸèƒ½çš„æ•°æ®æ¨¡å‹ã€‚å­ç³»ç»Ÿ34ï¼šå…ƒæ•°æ®èµ„æºåº“ç®¡ç†ç³»ç»Ÿè¿™ä¸ªå­ç³»ç»Ÿçš„ç›®æ ‡å°±æ˜¯æ•è·åˆ°å’ŒETLç›¸å…³çš„æ‰€æœ‰ä¸šåŠ¡ã€è¿‡ç¨‹å’ŒæŠ€æœ¯å…ƒæ•°æ®ã€‚è¿™ä¸ªå­ç³»ç»Ÿä¸­é‡è¦çš„ä¸€éƒ¨åˆ†å°±æ˜¯æŠŠç³»ç»Ÿæ–‡æ¡£åŒ–ï¼Œåœ¨ç¬¬11ç« ä»‹ç»ï¼Œå½“ç„¶Kettleçš„å…¨éƒ¨æ¶æ„ä¹Ÿæ˜¯å…ƒæ•°æ®é©±åŠ¨çš„ï¼Œæˆ‘ä»¬æ›¾ç»åœ¨ç¬¬2ç« è®¨è®ºè¿‡ã€‚æ€»ç»“ä»‹ç»å’Œè§£é‡Šäº†Ralphå®šä¹‰çš„34ç§ETLå­ç³»ç»Ÿã€‚è¿™äº›å­ç³»ç»Ÿçš„åˆ—è¡¨ä¹Ÿå¯çœ‹æˆæ˜¯ETLæ¶æ„çš„é€šç”¨çš„å®šä¹‰ï¼šå®ƒæè¿°äº†æ¯ä¸ªå­ç³»ç»Ÿåº”è¯¥å»åšé‚£äº›å·¥ä½œï¼Œè€Œä¸æ˜¯å¦‚ä½•å»åšæˆ–è€…æ‹¿ä»€ä¹ˆå·¥å…·å»åšã€‚è¿™34ç§å­ç³»ç»Ÿæ¶‰åŠçš„å››ä¸ªä¸»è¦æ–¹é¢å¦‚ä¸‹ã€‚æŠ½å–ï¼šä»ä¸åŒçš„æ•°æ®æºé‡Œè·å–æ•°æ®ã€‚æ¸…æ´—å’Œæ›´æ­£æ•°æ®ï¼šè½¬æ¢å’Œé›†æˆæ•°æ®ï¼Œä¸ºæ•°æ®è¿›æ•°æ®ä»“åº“ä¹‹å‰åšå‡†å¤‡ã€‚å‘å¸ƒæ•°æ®ï¼šåŠ è½½å’Œæ›´æ–°æ•°æ®ä»“åº“é‡Œçš„æ•°æ®ã€‚ç®¡ç†ç¯å¢ƒï¼šæ§åˆ¶å’Œç›‘æ§ETLè§£å†³æ–¹æ¡ˆæ‰€æœ‰ç»„ä»¶çš„å¤„ç†è¿‡ç¨‹ã€‚**è¡¥å……ï¼š**Data Vault2.0(DV2)æ˜¯ä¸€ä¸ªå•†ä¸šæ™ºèƒ½ç³»ç»Ÿï¼ŒåŒ…æ‹¬å»ºæ¨¡ã€æ–¹æ³•è®ºã€æ¶æ„å’Œå®æ–½è¿™å››ä¸ªæ–¹é¢çš„æœ€ä½³å®è·µï¼ŒåŒ…æ‹¬ä»¥ä¸‹å››ä¸ªç»„ä»¶ï¼ša. DV2å»ºæ¨¡ï¼ˆå¯¹æ¨¡å‹æ€§èƒ½å’Œå¯æ‰©å±•æ€§çš„æ›´æ”¹ï¼‰ï¼› b. DV2æ–¹æ³•è®ºï¼ˆéµå¾ªScrumå’Œæ•æ·æœ€ä½³å®è·µï¼‰ï¼› c. DV2æ¶æ„ï¼ˆåŒ…å«NoSQLç³»ç»Ÿå’Œå¤§æ•°æ®ç³»ç»Ÿï¼‰ï¼› d. DV2å®æ–½ï¼ˆåŸºäºæ¨¡å¼ã€è‡ªåŠ¨åŒ–ç”Ÿæˆèƒ½åŠ›æˆç†Ÿåº¦æ¨¡å‹é›†æˆï¼ˆCMMIï¼‰ç¬¬äº”å±‚çº§ï¼‰Data Vaultæ¨¡å‹æ˜¯ä¸€ç§ä¸­å¿ƒè¾å°„å¼æ¨¡å‹ï¼Œå…¶è®¾è®¡é‡ç‚¹å›´ç»•ç€ä¸šåŠ¡é”®çš„é›†æˆæ¨¡å¼ã€‚è¿™äº›ä¸šåŠ¡é”®æ˜¯å­˜å‚¨åœ¨å¤šä¸ªç³»ç»Ÿä¸­çš„ã€é’ˆå¯¹å„ç§ä¿¡æ¯çš„é”®ï¼ˆæœ€å¥½æ˜¯ä¸»å¯†é’¥ï¼‰ï¼Œç”¨äºå®šä½å’Œå”¯ä¸€æ ‡è¯†è®°å½•æˆ–æ•°æ®ã€‚æ¨¡å‹ä¸­æœ‰ä¸‰ç§åŸºæœ¬çš„å®ä½“ï¼ˆç»“æ„ï¼‰ï¼ša. ä¸­å¿ƒè¡¨ï¼šå”¯ä¸€ä¸šåŠ¡é”®çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºäº†ä»¥æ¨ªå‘æ–¹å¼è´¯ç©¿ä¼ä¸šçš„å®é™…ä¸šåŠ¡é”®æˆ–è€…ä¸»å¯†é’¥é›†åˆï¼› b. é“¾æ¥è¡¨ï¼šé”®ä¸é”®ä¹‹é—´å”¯ä¸€å…³ç³»çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºäº†ä¼ä¸šä¸­å­˜åœ¨äºä¸šåŠ¡é”®ä¹‹é—´çš„å…³ç³»å’Œè”ç³»ï¼›c. å«æ˜Ÿè¡¨ï¼šå†å²çš„æè¿°æ€§æ•°æ®ï¼ŒçœŸæ­£çš„æ•°æ®ä»“åº“ç»„ä»¶ï¼Œå­˜å‚¨äº†å²æ—¶é—´æ¨ç§»çš„éæ˜“å¤±æ•°æ®ã€‚Data Vaultå»ºæ¨¡çš„åŸºæœ¬è§„åˆ™ï¼ša. ä¸šåŠ¡é”®æ˜¯æŒ‰ç…§ç²’åº¦å’Œè¯­ä¹‰å†…æ¶µè¿›è¡Œåˆ†å‰²çš„ï¼› b. å…³ç³»ã€äº‹ä»¶å’Œè·¨ä¸¤ä¸ªæˆ–è€…å¤šä¸ªä¸šåŠ¡é”®çš„äº¤å‰å…³ç³»éƒ½è¦å­˜æ”¾åœ¨é“¾æ¥ç»“æ„ä¸­ï¼› c. é“¾æ¥ç»“æ„æ²¡æœ‰å¼€å§‹æˆ–è€…ç»“æŸæ—¥æœŸï¼Œä»–ä»¬åªæ˜¯å¯¹æ•°æ®åˆ°è¾¾æ•°æ®ä»“åº“é‚£ä¸€æ—¶åˆ»çš„å…³ç³»çš„ä¸€ç§è¡¨è¾¾ï¼› d. å«æ˜Ÿè¡¨æ˜¯æŒ‰ç…§æ•°æ®ç±»å‹ä»¥åŠå˜æ›´çš„ç±»åˆ«å’Œé€Ÿåº¦è¿›è¡Œåˆ†å‰²çš„ã€‚æ•°æ®ç±»å‹ä¸€èˆ¬éƒ½æ˜¯å•ä¸€çš„æºç³»ç»Ÿã€‚å¤šé“¾æ¥ç»“æ„æ˜¯ä¸ºäº†å…è®¸DataVaultæ¨¡å‹ä¸­çš„å…³ç³»éšæ—¶é—´ä¸æ–­æ‰©å±•ï¼Œå¦åˆ™æ•°æ®æ¨¡å‹å’ŒELT/ETLè£…è½½ç¨‹åºéƒ½éœ€è¦é‡æ–°æ„å»ºã€‚æ•£åˆ—é”®ä»£æ›¿é¡ºåºå·æ˜¯ä¸ºäº†åœ¨è£…è½½æ•°æ®æ—¶æ¶ˆé™¤ä¾èµ–æ€§ï¼Œé‡‡ç”¨é¡ºåºæ–¹å¼ä¼šè¿«ä½¿è´Ÿè½½å †å åˆ°ä¸€èµ·ï¼Œä¸ä»…å‡ç¼“äº†è£…è½½è¿‡ç¨‹ï¼Œè¿˜æ‰¼æ€äº†å¹¶è¡Œå¤„ç†çš„å¯èƒ½æ€§ï¼Œç”šè‡³åˆ‡æ–­äº†å‚ç…§å®Œæ•´æ€§ã€‚3. Data Vaultæ¶æ„ä»‹ç»DVåŸºäºä¸‰å±‚æ•°æ®ä»“åº“æ¶æ„ï¼šé›†ç»“åŒºï¼ˆç™»é™†åŒºï¼‰ã€æ•°æ®ä»“åº“å’Œä¿¡æ¯äº¤ä»˜å±‚ï¼ˆæˆ–æ•°æ®é›†å¸‚ï¼‰ã€‚å¤šå±‚ç»“æ„ä½¿å®ç°äººå‘˜å¯ä»¥å¯¹ä¼ä¸šæ•°æ®ä»“åº“å»è€¦åˆåŒ–ï¼Œå°†æ•°æ®æ¥æºå’Œè·å–åŠŸèƒ½ä¸ä¿¡æ¯äº¤ä»˜å’Œæ•°æ®ä¾›åº”åŠŸèƒ½åˆ†è§£å¼€æ¥ã€‚è½¬è½½è‡ªETLé‡Œçš„34ä¸ªå­ç³»ç»Ÿ","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"ETL","slug":"ETL","permalink":"cpeixin.cn/tags/ETL/"}]},{"title":"æ¯”ç‰¹å¸èµ°åŠ¿é¢„æµ‹","slug":"æ¯”ç‰¹å¸èµ°åŠ¿é¢„æµ‹","date":"2018-10-04T16:43:58.000Z","updated":"2020-05-01T14:21:22.500Z","comments":true,"path":"2018/10/05/æ¯”ç‰¹å¸èµ°åŠ¿é¢„æµ‹/","link":"","permalink":"cpeixin.cn/2018/10/05/%E6%AF%94%E7%89%B9%E5%B8%81%E8%B5%B0%E5%8A%BF%E9%A2%84%E6%B5%8B/","excerpt":"","text":"æˆ‘ä»¬ä¹‹å‰ä»‹ç»äº†æ•°æ®æŒ–æ˜ç®—æ³•ä¸­çš„åˆ†ç±»ã€èšç±»ã€å›å½’å’Œå…³è”åˆ†æç®—æ³•ï¼Œé‚£ä¹ˆå¯¹äºæ¯”ç‰¹å¸èµ°åŠ¿çš„é¢„æµ‹ï¼Œé‡‡ç”¨å“ªç§æ–¹æ³•æ¯”è¾ƒå¥½å‘¢ï¼Ÿå¯èƒ½æœ‰äº›äººä¼šè®¤ä¸ºé‡‡ç”¨å›å½’åˆ†æä¼šå¥½ä¸€äº›ï¼Œå› ä¸ºé¢„æµ‹çš„ç»“æœæ˜¯è¿ç»­çš„æ•°å€¼ç±»å‹ã€‚å®é™…ä¸Šï¼Œæ•°æ®æŒ–æ˜ç®—æ³•è¿˜æœ‰ä¸€ç§å«æ—¶é—´åºåˆ—åˆ†æçš„ç®—æ³•ï¼Œæ—¶é—´åºåˆ—åˆ†ææ¨¡å‹å»ºç«‹äº†è§‚å¯Ÿç»“æœä¸æ—¶é—´å˜åŒ–çš„å…³ç³»ï¼Œèƒ½å¸®æˆ‘ä»¬é¢„æµ‹æœªæ¥ä¸€æ®µæ—¶é—´å†…çš„ç»“æœå˜åŒ–æƒ…å†µã€‚é‚£ä¹ˆæ—¶é—´åºåˆ—åˆ†æå’Œå›å½’åˆ†ææœ‰å“ªäº›åŒºåˆ«å‘¢ï¼Ÿé¦–å…ˆï¼Œåœ¨é€‰æ‹©æ¨¡å‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šç»“æœä¸å˜é‡ä¹‹é—´çš„å…³ç³»ã€‚å›å½’åˆ†æè®­ç»ƒå¾—åˆ°çš„æ˜¯ç›®æ ‡å˜é‡ y ä¸è‡ªå˜é‡ xï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰çš„ç›¸å…³æ€§ï¼Œç„¶åé€šè¿‡æ–°çš„è‡ªå˜é‡ x æ¥é¢„æµ‹ç›®æ ‡å˜é‡ yã€‚è€Œæ—¶é—´åºåˆ—åˆ†æå¾—åˆ°çš„æ˜¯ç›®æ ‡å˜é‡ y ä¸æ—¶é—´çš„ç›¸å…³æ€§ã€‚å¦å¤–ï¼Œå›å½’åˆ†ææ“…é•¿çš„æ˜¯å¤šå˜é‡ä¸ç›®æ ‡ç»“æœä¹‹é—´çš„åˆ†æï¼Œå³ä¾¿æ˜¯å•ä¸€å˜é‡ï¼Œä¹Ÿå¾€å¾€ä¸æ—¶é—´æ— å…³ã€‚è€Œæ—¶é—´åºåˆ—åˆ†æå»ºç«‹åœ¨æ—¶é—´å˜åŒ–çš„åŸºç¡€ä¸Šï¼Œå®ƒä¼šåˆ†æç›®æ ‡å˜é‡çš„è¶‹åŠ¿ã€å‘¨æœŸã€æ—¶æœŸå’Œä¸ç¨³å®šå› ç´ ç­‰ã€‚è¿™äº›è¶‹åŠ¿å’Œå‘¨æœŸéƒ½æ˜¯åœ¨æ—¶é—´ç»´åº¦çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬è¦è§‚å¯Ÿçš„é‡è¦ç‰¹å¾ã€‚é‚£ä¹ˆé’ˆå¯¹ä»Šå¤©è¦è¿›è¡Œçš„é¢„æµ‹æ¯”ç‰¹å¸èµ°åŠ¿çš„é¡¹ç›®ï¼Œæˆ‘ä»¬éƒ½éœ€è¦æŒæ¡å“ªäº›ç›®æ ‡å‘¢ï¼Ÿäº†è§£æ—¶é—´åºåˆ—é¢„æµ‹çš„æ¦‚å¿µï¼Œä»¥åŠå¸¸ç”¨çš„æ¨¡å‹ç®—æ³•ï¼ŒåŒ…æ‹¬ ARã€MAã€ARMAã€ARIMA æ¨¡å‹ç­‰ï¼›æŒæ¡å¹¶ä½¿ç”¨ ARMA æ¨¡å‹å·¥å…·ï¼Œå¯¹ä¸€ä¸ªæ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œå»ºæ¨¡å’Œé¢„æµ‹ï¼›å¯¹æ¯”ç‰¹å¸çš„å†å²æ•°æ®è¿›è¡Œæ—¶é—´åºåˆ—å»ºæ¨¡ï¼Œå¹¶é¢„æµ‹æœªæ¥ 6 ä¸ªæœˆçš„èµ°åŠ¿ã€‚æ—¶é—´åºåˆ—é¢„æµ‹å…³äºæ—¶é—´åºåˆ—ï¼Œä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºæŒ‰ç…§æ—¶é—´é¡ºåºç»„æˆçš„æ•°å­—åºåˆ—ã€‚å®é™…ä¸Šåœ¨ä¸­å›½å¤ä»£çš„å†œä¸šç¤¾ä¼šä¸­ï¼Œäººä»¬å°±å°†ä¸€å¹´ä¸­ä¸åŒæ—¶é—´èŠ‚ç‚¹å’Œå¤©æ°”çš„è§„å¾‹æ€»ç»“äº†ä¸‹æ¥ï¼Œå½¢æˆäº†äºŒåå››èŠ‚æ°”ï¼Œä¹Ÿå°±æ˜¯ä»æ—¶é—´åºåˆ—ä¸­è§‚å¯Ÿå¤©æ°”å’Œå¤ªé˜³çš„è§„å¾‹ï¼ˆåªæ˜¯å½“æ—¶æ²¡æœ‰æ—¶é—´åºåˆ—æ¨¡å‹å’Œç›¸åº”å·¥å…·ï¼‰ï¼Œä»è€Œä½¿å¾—å†œä¸šå¾—åˆ°è¿…é€Ÿå‘å±•ã€‚åœ¨ç°ä»£ç¤¾ä¼šï¼Œæ—¶é—´åºåˆ—åœ¨é‡‘èã€ç»æµã€å•†ä¸šé¢†åŸŸæ‹¥æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚åœ¨æ—¶é—´åºåˆ—é¢„æµ‹æ¨¡å‹ä¸­ï¼Œæœ‰ä¸€äº›ç»å…¸çš„æ¨¡å‹ï¼ŒåŒ…æ‹¬ ARã€MAã€ARMAã€ARIMAã€‚æˆ‘æ¥ç»™ä½ ç®€å•ä»‹ç»ä¸€ä¸‹ã€‚AR çš„è‹±æ–‡å…¨ç§°å«åš Auto Regressiveï¼Œä¸­æ–‡å«è‡ªå›å½’æ¨¡å‹ã€‚è¿™ä¸ªç®—æ³•çš„æ€æƒ³æ¯”è¾ƒç®€å•ï¼Œå®ƒè®¤ä¸ºè¿‡å»è‹¥å¹²æ—¶åˆ»çš„ç‚¹é€šè¿‡çº¿æ€§ç»„åˆï¼Œå†åŠ ä¸Šç™½å™ªå£°å°±å¯ä»¥é¢„æµ‹æœªæ¥æŸä¸ªæ—¶åˆ»çš„ç‚¹ã€‚åœ¨æˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ç¯å¢ƒä¸­å°±å­˜åœ¨ç™½å™ªå£°ï¼Œåœ¨æ•°æ®æŒ–æ˜çš„è¿‡ç¨‹ä¸­ï¼Œä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªæœŸæœ›ä¸º 0ï¼Œæ–¹å·®ä¸ºå¸¸æ•°çš„çº¯éšæœºè¿‡ç¨‹ã€‚AR æ¨¡å‹è¿˜å­˜åœ¨ä¸€ä¸ªé˜¶æ•°ï¼Œç§°ä¸º ARï¼ˆpï¼‰æ¨¡å‹ï¼Œä¹Ÿå«ä½œ p é˜¶è‡ªå›å½’æ¨¡å‹ã€‚å®ƒæŒ‡çš„æ˜¯é€šè¿‡è¿™ä¸ªæ—¶åˆ»ç‚¹çš„å‰ p ä¸ªç‚¹ï¼Œé€šè¿‡çº¿æ€§ç»„åˆå†åŠ ä¸Šç™½å™ªå£°æ¥é¢„æµ‹å½“å‰æ—¶åˆ»ç‚¹çš„å€¼ã€‚MA çš„è‹±æ–‡å…¨ç§°å«åš Moving Averageï¼Œä¸­æ–‡å«åšæ»‘åŠ¨å¹³å‡æ¨¡å‹ã€‚å®ƒä¸ AR æ¨¡å‹å¤§åŒå°å¼‚ï¼ŒAR æ¨¡å‹æ˜¯å†å²æ—¶åºå€¼çš„çº¿æ€§ç»„åˆï¼ŒMA æ˜¯é€šè¿‡å†å²ç™½å™ªå£°è¿›è¡Œçº¿æ€§ç»„åˆæ¥å½±å“å½“å‰æ—¶åˆ»ç‚¹ã€‚AR æ¨¡å‹ä¸­çš„å†å²ç™½å™ªå£°æ˜¯é€šè¿‡å½±å“å†å²æ—¶åºå€¼ï¼Œä»è€Œé—´æ¥å½±å“åˆ°å½“å‰æ—¶åˆ»ç‚¹çš„é¢„æµ‹å€¼ã€‚åŒæ · MA æ¨¡å‹ä¹Ÿå­˜åœ¨ä¸€ä¸ªé˜¶æ•°ï¼Œç§°ä¸º MA(q) æ¨¡å‹ï¼Œä¹Ÿå«ä½œ q é˜¶ç§»åŠ¨å¹³å‡æ¨¡å‹ã€‚æˆ‘ä»¬èƒ½çœ‹åˆ° AR å’Œ MA æ¨¡å‹éƒ½å­˜åœ¨é˜¶æ•°ï¼Œåœ¨ AR æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬ç”¨ p è¡¨ç¤ºï¼Œåœ¨ MA æ¨¡å‹ä¸­æˆ‘ä»¬ç”¨ q è¡¨ç¤ºï¼Œè¿™ä¸¤ä¸ªæ¨¡å‹å¤§åŒå°å¼‚ï¼Œä¸ AR æ¨¡å‹ä¸åŒçš„æ˜¯ MA æ¨¡å‹æ˜¯å†å²ç™½å™ªå£°çš„çº¿æ€§ç»„åˆã€‚ARMA çš„è‹±æ–‡å…¨ç§°æ˜¯ Auto Regressive Moving Averageï¼Œä¸­æ–‡å«åšè‡ªå›å½’æ»‘åŠ¨å¹³å‡æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯ AR æ¨¡å‹å’Œ MA æ¨¡å‹çš„æ··åˆã€‚ç›¸æ¯” AR æ¨¡å‹å’Œ MA æ¨¡å‹ï¼Œå®ƒæœ‰æ›´å‡†ç¡®çš„ä¼°è®¡ã€‚åŒæ · ARMA æ¨¡å‹å­˜åœ¨ p å’Œ q ä¸¤ä¸ªé˜¶æ•°ï¼Œç§°ä¸º ARMA(p,q) æ¨¡å‹ã€‚ARIMA çš„è‹±æ–‡å…¨ç§°æ˜¯ Auto Regressive Integrated Moving Average æ¨¡å‹ï¼Œä¸­æ–‡å«å·®åˆ†è‡ªå›å½’æ»‘åŠ¨å¹³å‡æ¨¡å‹ï¼Œä¹Ÿå«æ±‚åˆè‡ªå›å½’æ»‘åŠ¨å¹³å‡æ¨¡å‹ã€‚ç›¸æ¯”äº ARMAï¼ŒARIMA å¤šäº†ä¸€ä¸ªå·®åˆ†çš„è¿‡ç¨‹ï¼Œä½œç”¨æ˜¯å¯¹ä¸å¹³ç¨³æ•°æ®è¿›è¡Œå·®åˆ†å¹³ç¨³ï¼Œåœ¨å·®åˆ†å¹³ç¨³åå†è¿›è¡Œå»ºæ¨¡ã€‚ARIMA çš„åŸç†å’ŒARMA æ¨¡å‹ä¸€æ ·ã€‚ç›¸æ¯”äº ARMA(p,q) çš„ä¸¤ä¸ªé˜¶æ•°ï¼ŒARIMA æ˜¯ä¸€ä¸ªä¸‰å…ƒç»„çš„é˜¶æ•° (p,d,q)ï¼Œç§°ä¸º ARIMA(p,d,q) æ¨¡å‹ã€‚å…¶ä¸­ d æ˜¯å·®åˆ†é˜¶æ•°ã€‚ARMA æ¨¡å‹å·¥å…·ä¸Šé¢ä»‹ç»çš„ ARï¼ŒMAï¼ŒARMAï¼ŒARIMA å››ç§æ¨¡å‹ï¼Œä½ åªéœ€è¦äº†è§£åŸºç¡€æ¦‚å¿µå³å¯ï¼Œä¸­é—´æ¶‰åŠåˆ°çš„ä¸€äº›æ•°å­¦å…¬å¼è¿™é‡Œä¸è¿›è¡Œå±•å¼€ã€‚åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬æ›´å¤šçš„æ˜¯ä½¿ç”¨å·¥å…·ï¼Œæˆ‘åœ¨è¿™é‡Œä¸»è¦è®²è§£ä¸‹å¦‚ä½•ä½¿ç”¨ ARMA æ¨¡å‹å·¥å…·ã€‚åœ¨ä½¿ç”¨ ARMA å·¥å…·å‰ï¼Œä½ éœ€è¦å…ˆå¼•ç”¨ç›¸å…³å·¥å…·åŒ…ï¼š1from statsmodels.tsa.arima_model import ARMAç„¶åé€šè¿‡ ARMA(endog,order,exog=None) åˆ›å»º ARMA ç±»ï¼Œè¿™é‡Œæœ‰ä¸€äº›ä¸»è¦çš„å‚æ•°ç®€å•è¯´æ˜ä¸‹ï¼šendogï¼šè‹±æ–‡æ˜¯ endogenous variableï¼Œä»£è¡¨å†…ç”Ÿå˜é‡ï¼Œåˆå«éæ”¿ç­–æ€§å˜é‡ï¼Œå®ƒæ˜¯ç”±æ¨¡å‹å†³å®šçš„ï¼Œä¸è¢«æ”¿ç­–å·¦å³ï¼Œå¯ä»¥è¯´æ˜¯æˆ‘ä»¬æƒ³è¦åˆ†æçš„å˜é‡ï¼Œæˆ–è€…è¯´æ˜¯æˆ‘ä»¬è¿™æ¬¡é¡¹ç›®ä¸­éœ€è¦ç”¨åˆ°çš„å˜é‡ã€‚orderï¼šä»£è¡¨æ˜¯ p å’Œ q çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ ARMA ä¸­çš„é˜¶æ•°ã€‚exogï¼šè‹±æ–‡æ˜¯ exogenous variablesï¼Œä»£è¡¨å¤–ç”Ÿå˜é‡ã€‚å¤–ç”Ÿå˜é‡å’Œå†…ç”Ÿå˜é‡ä¸€æ ·æ˜¯ç»æµæ¨¡å‹ä¸­çš„ä¸¤ä¸ªé‡è¦å˜é‡ã€‚ç›¸å¯¹äºå†…ç”Ÿå˜é‡è€Œè¨€ï¼Œå¤–ç”Ÿå˜é‡åˆç§°ä½œä¸ºæ”¿ç­–æ€§å˜é‡ï¼Œåœ¨ç»æµæœºåˆ¶å†…å—å¤–éƒ¨å› ç´ çš„å½±å“ï¼Œä¸æ˜¯æˆ‘ä»¬æ¨¡å‹è¦ç ”ç©¶çš„å˜é‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åˆ›å»º ARMA(7,0) æ¨¡å‹ï¼Œå¯ä»¥å†™æˆï¼šARMA(data,(7,0))ï¼Œå…¶ä¸­ data æ˜¯æˆ‘ä»¬æƒ³è¦è§‚å¯Ÿçš„å˜é‡ï¼Œ(7,0) ä»£è¡¨ (p,q) çš„é˜¶æ•°ã€‚åˆ›å»ºå¥½ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ fit å‡½æ•°è¿›è¡Œæ‹Ÿåˆï¼Œé€šè¿‡ predict(start, end) å‡½æ•°è¿›è¡Œé¢„æµ‹ï¼Œå…¶ä¸­ start ä¸ºé¢„æµ‹çš„èµ·å§‹æ—¶é—´ï¼Œend ä¸ºé¢„æµ‹çš„ç»ˆæ­¢æ—¶é—´ã€‚ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ ARMA æ¨¡å‹å¯¹ä¸€ç»„æ—¶é—´åºåˆ—åšå»ºæ¨¡ï¼Œä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526# coding:utf-8# ç”¨ARMAè¿›è¡Œæ—¶é—´åºåˆ—é¢„æµ‹import pandas as pdimport matplotlib.pyplot as pltimport statsmodels.api as smfrom statsmodels.tsa.arima_model import ARMAfrom statsmodels.graphics.api import qqplot# åˆ›å»ºæ•°æ®data = [5922, 5308, 5546, 5975, 2704, 1767, 4111, 5542, 4726, 5866, 6183, 3199, 1471, 1325, 6618, 6644, 5337, 7064, 2912, 1456, 4705, 4579, 4990, 4331, 4481, 1813, 1258, 4383, 5451, 5169, 5362, 6259, 3743, 2268, 5397, 5821, 6115, 6631, 6474, 4134, 2728, 5753, 7130, 7860, 6991, 7499, 5301, 2808, 6755, 6658, 7644, 6472, 8680, 6366, 5252, 8223, 8181, 10548, 11823, 14640, 9873, 6613, 14415, 13204, 14982, 9690, 10693, 8276, 4519, 7865, 8137, 10022, 7646, 8749, 5246, 4736, 9705, 7501, 9587, 10078, 9732, 6986, 4385, 8451, 9815, 10894, 10287, 9666, 6072, 5418]data=pd.Series(data)data_index = sm.tsa.datetools.dates_from_range('1901','1990')# ç»˜åˆ¶æ•°æ®å›¾data.index = pd.Index(data_index)data.plot(figsize=(12,8))plt.show()# åˆ›å»ºARMAæ¨¡å‹# åˆ›å»ºARMAæ¨¡å‹arma = ARMA(data,(7,0)).fit()print('AIC: %0.4lf' %arma.aic)# æ¨¡å‹é¢„æµ‹predict_y = arma.predict('1990', '2000')# é¢„æµ‹ç»“æœç»˜åˆ¶fig, ax = plt.subplots(figsize=(12, 8))ax = data.ix['1901':].plot(ax=ax)predict_y.plot(ax=ax)plt.show())æˆ‘åˆ›å»ºäº† 1901 å¹´ -1990 å¹´ä¹‹é—´çš„æ—¶é—´åºåˆ—æ•°æ® dataï¼Œç„¶ååˆ›å»º ARMA(7,0) æ¨¡å‹ï¼Œå¹¶ä¼ å…¥æ—¶é—´åºåˆ—æ•°æ® dataï¼Œä½¿ç”¨ fit å‡½æ•°æ‹Ÿåˆï¼Œç„¶åå¯¹ 1990 å¹´ -2000 å¹´ä¹‹é—´çš„æ•°æ®è¿›è¡Œé¢„æµ‹ï¼Œæœ€åç»˜åˆ¶é¢„æµ‹ç»“æœã€‚ä½ èƒ½çœ‹åˆ° ARMA å·¥å…·çš„ä½¿ç”¨è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œåªæ˜¯æˆ‘ä»¬éœ€è¦ p å’Œ q çš„å–å€¼ã€‚å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ p å’Œ q æŒ‡å®šä¸€ä¸ªèŒƒå›´ï¼Œè®© ARMA éƒ½è¿è¡Œä¸€ä¸‹ï¼Œç„¶åé€‰æ‹©æœ€é€‚åˆçš„æ¨¡å‹ã€‚ä½ å¯èƒ½ä¼šé—®ï¼Œæ€ä¹ˆåˆ¤æ–­ä¸€ä¸ªæ¨¡å‹æ˜¯å¦é€‚åˆï¼Ÿæˆ‘ä»¬éœ€è¦å¼•å…¥ AIC å‡†åˆ™ï¼Œä¹Ÿå«ä½œèµ¤æ± æ¶ˆæ¯å‡†åˆ™ï¼Œå®ƒæ˜¯è¡¡é‡ç»Ÿè®¡æ¨¡å‹æ‹Ÿåˆå¥½åçš„ä¸€ä¸ªæ ‡å‡†ï¼Œæ•°å€¼è¶Šå°ä»£è¡¨æ¨¡å‹æ‹Ÿåˆå¾—è¶Šå¥½ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ èƒ½çœ‹åˆ° ARMA(7,0) è¿™ä¸ªæ¨¡å‹æ‹Ÿåˆå‡ºæ¥çš„ AIC æ˜¯ 1619.6323ï¼ˆå¹¶ä¸ä¸€å®šæ˜¯æœ€ä¼˜ï¼‰ã€‚å¯¹æ¯”ç‰¹å¸èµ°åŠ¿è¿›è¡Œé¢„æµ‹æˆ‘ä»¬éƒ½çŸ¥é“æ¯”ç‰¹å¸çš„èµ°åŠ¿é™¤äº†å’Œå†å²æ•°æ®ä»¥å¤–ï¼Œè¿˜å’Œå¾ˆå¤šå¤–ç•Œå› ç´ ç›¸å…³ï¼Œæ¯”å¦‚ç”¨æˆ·çš„å…³æ³¨åº¦ï¼Œå„å›½çš„æ”¿ç­–ï¼Œå¸åœˆä¹‹é—´æ˜¯å¦æ‰“æ¶ç­‰ç­‰ã€‚å½“ç„¶è¿™äº›å¤–ç•Œçš„å› ç´ ä¸æ˜¯æˆ‘ä»¬è¿™èŠ‚è¯¾éœ€è¦è€ƒè™‘çš„å¯¹è±¡ã€‚å‡è®¾æˆ‘ä»¬åªè€ƒè™‘æ¯”ç‰¹å¸ä»¥å¾€çš„å†å²æ•°æ®ï¼Œç”¨ ARMA è¿™ä¸ªæ—¶é—´åºåˆ—æ¨¡å‹é¢„æµ‹æ¯”ç‰¹å¸çš„èµ°åŠ¿ã€‚æ¯”ç‰¹å¸å†å²æ•°æ®ï¼ˆä» 2012-01-01 åˆ° 2018-10-31ï¼‰å¯ä»¥ä» GitHub ä¸Šä¸‹è½½ï¼šhttps://github.com/cystanford/bitcoinã€‚ä½ èƒ½çœ‹åˆ°æ•°æ®ä¸€å…±åŒ…æ‹¬äº† 8 ä¸ªå­—æ®µï¼Œä»£è¡¨çš„å«ä¹‰å¦‚ä¸‹ï¼šæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ„é€  ARMA æ—¶é—´åºåˆ—æ¨¡å‹ï¼Œé¢„æµ‹æ¯”ç‰¹å¸ï¼ˆå¹³å‡ï¼‰ä»·æ ¼èµ°åŠ¿ã€‚p å’Œ q å‚æ•°å…·ä½“é€‰æ‹©å¤šå°‘å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªåŒºé—´èŒƒå›´ï¼Œç„¶åé€‰æ‹© AIC æœ€ä½çš„ ARMA æ¨¡å‹ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦åŠ è½½æ•°æ®ã€‚åœ¨å‡†å¤‡é˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ¢ç´¢æ•°æ®ï¼Œé‡‡ç”¨æ•°æ®å¯è§†åŒ–æ–¹å¼æŸ¥çœ‹æ¯”ç‰¹å¸çš„å†å²èµ°åŠ¿ã€‚æŒ‰ç…§ä¸åŒçš„æ—¶é—´å°ºåº¦ï¼ˆå¤©ï¼Œæœˆï¼Œå­£åº¦ï¼Œå¹´ï¼‰å¯ä»¥å°†æ•°æ®å‹ç¼©ï¼Œå¾—åˆ°ä¸åŒå°ºåº¦çš„æ•°æ®ï¼Œç„¶ååšå¯è§†åŒ–å‘ˆç°ã€‚è¿™ 4 ä¸ªæ—¶é—´å°ºåº¦ä¸Šï¼Œæˆ‘ä»¬é€‰æ‹©æœˆä½œä¸ºé¢„æµ‹æ¨¡å‹çš„æ—¶é—´å°ºåº¦ï¼Œç›¸åº”çš„ï¼Œæˆ‘ä»¬é€‰æ‹© Weighted_Price è¿™ä¸ªå­—æ®µçš„æ•°å€¼ä½œä¸ºè§‚å¯Ÿç»“æœï¼Œåœ¨åŸå§‹æ•°æ®ä¸­ï¼ŒWeighted_Price å¯¹åº”çš„æ˜¯æ¯”ç‰¹å¸æ¯å¤©çš„å¹³å‡ä»·æ ¼ï¼Œå½“æˆ‘ä»¬ä»¥â€œæœˆâ€ä¸ºå•ä½è¿›è¡Œå‹ç¼©çš„æ—¶å€™ï¼Œå¯¹åº”çš„ Weighted_Price å¾—åˆ°çš„å°±æ˜¯å½“æœˆçš„æ¯”ç‰¹å¸å¹³å‡ä»·æ ¼ã€‚å‹ç¼©ä»£ç å¦‚ä¸‹ï¼š1df_month = df.resample('M').mean()æœ€ååœ¨é¢„æµ‹é˜¶æ®µåˆ›å»º ARMA æ—¶é—´åºåˆ—æ¨¡å‹ã€‚æˆ‘ä»¬å¹¶ä¸çŸ¥é“ p å’Œ q å–ä»€ä¹ˆå€¼æ—¶ï¼Œæ¨¡å‹æœ€ä¼˜ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç»™å®ƒä»¬è®¾ç½®ä¸€ä¸ªåŒºé—´èŒƒå›´ï¼Œæ¯”å¦‚éƒ½æ˜¯ range(0,3)ï¼Œç„¶åè®¡ç®—ä¸åŒæ¨¡å‹çš„ AIC æ•°å€¼ï¼Œé€‰æ‹©æœ€å°çš„ AIC æ•°å€¼å¯¹åº”çš„é‚£ä¸ª ARMA æ¨¡å‹ã€‚æœ€åç”¨è¿™ä¸ªæœ€ä¼˜çš„ ARMA æ¨¡å‹é¢„æµ‹æœªæ¥ 8 ä¸ªæœˆçš„æ¯”ç‰¹å¸å¹³å‡ä»·æ ¼èµ°åŠ¿ï¼Œå¹¶å°†ç»“æœåšå¯è§†åŒ–å‘ˆç°ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879# -*- coding: utf-8 -*-# æ¯”ç‰¹å¸èµ°åŠ¿é¢„æµ‹ï¼Œä½¿ç”¨æ—¶é—´åºåˆ—ARMAimport numpy as npimport pandas as pdimport matplotlib.pyplot as pltfrom statsmodels.tsa.arima_model import ARMAimport warningsfrom itertools import productfrom datetime import datetimewarnings.filterwarnings('ignore')# æ•°æ®åŠ è½½df = pd.read_csv('./bitcoin_2012-01-01_to_2018-10-31.csv')# å°†æ—¶é—´ä½œä¸ºdfçš„ç´¢å¼•df.Timestamp = pd.to_datetime(df.Timestamp)df.index = df.Timestamp# æ•°æ®æ¢ç´¢print(df.head())# æŒ‰ç…§æœˆï¼Œå­£åº¦ï¼Œå¹´æ¥ç»Ÿè®¡df_month = df.resample('M').mean()df_Q = df.resample('Q-DEC').mean()df_year = df.resample('A-DEC').mean()# æŒ‰ç…§å¤©ï¼Œæœˆï¼Œå­£åº¦ï¼Œå¹´æ¥æ˜¾ç¤ºæ¯”ç‰¹å¸çš„èµ°åŠ¿fig = plt.figure(figsize=[15, 7])plt.rcParams['font.sans-serif']=['SimHei'] #ç”¨æ¥æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡æ ‡ç­¾plt.suptitle('æ¯”ç‰¹å¸é‡‘é¢ï¼ˆç¾é‡‘ï¼‰', fontsize=20)plt.subplot(221)plt.plot(df.Weighted_Price, '-', label='æŒ‰å¤©')plt.legend()plt.subplot(222)plt.plot(df_month.Weighted_Price, '-', label='æŒ‰æœˆ')plt.legend()plt.subplot(223)plt.plot(df_Q.Weighted_Price, '-', label='æŒ‰å­£åº¦')plt.legend()plt.subplot(224)plt.plot(df_year.Weighted_Price, '-', label='æŒ‰å¹´')plt.legend()plt.show()# è®¾ç½®å‚æ•°èŒƒå›´ps = range(0, 3)qs = range(0, 3)parameters = product(ps, qs)parameters_list = list(parameters)# å¯»æ‰¾æœ€ä¼˜ARMAæ¨¡å‹å‚æ•°ï¼Œå³best_aicæœ€å°results = []best_aic = float(\"inf\") # æ­£æ— ç©·for param in parameters_list: try: model = ARMA(df_month.Weighted_Price,order=(param[0], param[1])).fit() except ValueError: print('å‚æ•°é”™è¯¯:', param) continue aic = model.aic if aic &lt; best_aic: best_model = model best_aic = aic best_param = param results.append([param, model.aic])# è¾“å‡ºæœ€ä¼˜æ¨¡å‹result_table = pd.DataFrame(results)result_table.columns = ['parameters', 'aic']print('æœ€ä¼˜æ¨¡å‹: ', best_model.summary())# æ¯”ç‰¹å¸é¢„æµ‹df_month2 = df_month[['Weighted_Price']]date_list = [datetime(2018, 11, 30), datetime(2018, 12, 31), datetime(2019, 1, 31), datetime(2019, 2, 28), datetime(2019, 3, 31), datetime(2019, 4, 30), datetime(2019, 5, 31), datetime(2019, 6, 30)]future = pd.DataFrame(index=date_list, columns= df_month.columns)df_month2 = pd.concat([df_month2, future])df_month2['forecast'] = best_model.predict(start=0, end=91)# æ¯”ç‰¹å¸é¢„æµ‹ç»“æœæ˜¾ç¤ºplt.figure(figsize=(20,7))df_month2.Weighted_Price.plot(label='å®é™…é‡‘é¢')df_month2.forecast.plot(color='r', ls='--', label='é¢„æµ‹é‡‘é¢')plt.legend()plt.title('æ¯”ç‰¹å¸é‡‘é¢ï¼ˆæœˆï¼‰')plt.xlabel('æ—¶é—´')plt.ylabel('ç¾é‡‘')plt.show()ç»“æœï¼š))æˆ‘ä»¬é€šè¿‡ product å‡½æ•°åˆ›å»ºäº† (p,q) åœ¨ range(0,3) èŒƒå›´å†…çš„æ‰€æœ‰å¯èƒ½ç»„åˆï¼Œå¹¶å¯¹æ¯ä¸ª ARMA(p,q) æ¨¡å‹è¿›è¡Œäº† AIC æ•°å€¼è®¡ç®—ï¼Œä¿å­˜äº† AIC æ•°å€¼æœ€å°çš„æ¨¡å‹å‚æ•°ã€‚ç„¶åç”¨è¿™ä¸ªæ¨¡å‹å¯¹æ¯”ç‰¹å¸çš„æœªæ¥ 8 ä¸ªæœˆè¿›è¡Œäº†é¢„æµ‹ã€‚ä»ç»“æœä¸­ä½ èƒ½çœ‹åˆ°ï¼Œåœ¨ 2018 å¹´ 10 æœˆä¹‹å 8 ä¸ªæœˆçš„æ—¶é—´é‡Œï¼Œæ¯”ç‰¹å¸ä¼šè§¦åº•åˆ° 4000 ç¾é‡‘å·¦å³ï¼Œå®é™…ä¸Šæ¯”ç‰¹å¸åœ¨è¿™ä¸ªé˜¶æ®µç¡®å®é™ä½åˆ°äº† 4000 å…ƒç¾é‡‘ç”šè‡³æ›´ä½ã€‚åœ¨æ—¶é—´å°ºåº¦çš„é€‰æ‹©ä¸Šï¼Œæˆ‘ä»¬é€‰æ‹©äº†æœˆï¼Œè¿™æ ·å°±å¯¹æ•°æ®è¿›è¡Œäº†é™ç»´ï¼Œä¹ŸèŠ‚çº¦äº† ARMA çš„æ¨¡å‹è®­ç»ƒæ—¶é—´ã€‚ä½ èƒ½çœ‹åˆ°æ¯”ç‰¹å¸é‡‘é¢ï¼ˆç¾é‡‘ï¼‰è¿™å¼ å›¾ä¸­ï¼ŒæŒ‰æœˆåˆ’åˆ†çš„æ¯”ç‰¹å¸èµ°åŠ¿å’ŒæŒ‰å¤©åˆ’åˆ†çš„æ¯”ç‰¹å¸èµ°åŠ¿å·®åˆ«ä¸å¤§ï¼Œåœ¨å‡å°‘äº†å±€éƒ¨çš„æ³¢åŠ¨çš„åŒæ—¶ä¹Ÿèƒ½ä½“ç°å‡ºæ¯”ç‰¹å¸çš„è¶‹åŠ¿ï¼Œè¿™æ ·å°±èŠ‚çº¦äº† ARMA çš„æ¨¡å‹è®­ç»ƒæ—¶é—´ã€‚æ€»ç»“ä»Šå¤©æˆ‘ç»™ä½ è®²äº†ä¸€ä¸ªæ¯”ç‰¹å¸è¶‹åŠ¿é¢„æµ‹çš„å®æˆ˜é¡¹ç›®ã€‚é€šè¿‡è¿™ä¸ªé¡¹ç›®ä½ åº”è¯¥èƒ½ä½“ä¼šåˆ°ï¼Œå½“æˆ‘ä»¬å¯¹ä¸€ä¸ªæ•°å€¼è¿›è¡Œé¢„æµ‹çš„æ—¶å€™ï¼Œå¦‚æœè€ƒè™‘çš„æ˜¯å¤šä¸ªå˜é‡å’Œç»“æœä¹‹é—´çš„å…³ç³»ï¼Œå¯ä»¥é‡‡ç”¨å›å½’åˆ†æï¼Œå¦‚æœè€ƒè™‘å•ä¸ªæ—¶é—´ç»´åº¦ä¸ç»“æœçš„å…³ç³»ï¼Œå¯ä»¥ä½¿ç”¨æ—¶é—´åºåˆ—åˆ†æã€‚æ ¹æ®æ¯”ç‰¹å¸çš„å†å²æ•°æ®ï¼Œæˆ‘ä»¬ä½¿ç”¨ ARMA æ¨¡å‹å¯¹æ¯”ç‰¹å¸æœªæ¥ 8 ä¸ªæœˆçš„èµ°åŠ¿è¿›è¡Œäº†é¢„æµ‹ï¼Œå¹¶å¯¹ç»“æœè¿›è¡Œäº†å¯è§†åŒ–æ˜¾ç¤ºã€‚ä½ èƒ½çœ‹åˆ° ARMA å·¥å…·è¿˜æ˜¯å¾ˆå¥½ç”¨çš„ï¼Œè™½ç„¶æ¯”ç‰¹å¸çš„èµ°åŠ¿å—å¾ˆå¤šå¤–åœ¨å› ç´ å½±å“ï¼Œæ¯”å¦‚æ”¿ç­–ç¯å¢ƒã€‚ä¸è¿‡å½“æˆ‘ä»¬æŒæ¡äº†è¿™äº›å†å²æ•°æ®ï¼Œä¹Ÿä¸å¦¨ç”¨æ—¶é—´åºåˆ—æ¨¡å‹æ¥åˆ†æé¢„æµ‹ä¸€ä¸‹ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"æ—¶é—´åºåˆ—","slug":"æ—¶é—´åºåˆ—","permalink":"cpeixin.cn/tags/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97/"}]},{"title":"ä¿¡ç”¨å¡è¯ˆéª—åˆ†æ","slug":"ä¿¡ç”¨å¡è¯ˆéª—åˆ†æ","date":"2018-10-02T16:43:58.000Z","updated":"2020-05-01T14:20:36.160Z","comments":true,"path":"2018/10/03/ä¿¡ç”¨å¡è¯ˆéª—åˆ†æ/","link":"","permalink":"cpeixin.cn/2018/10/03/%E4%BF%A1%E7%94%A8%E5%8D%A1%E8%AF%88%E9%AA%97%E5%88%86%E6%9E%90/","excerpt":"","text":"ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç”¨éšæœºæ£®æ—ä»¥åŠä¹‹å‰è®²è¿‡çš„ SVMã€å†³ç­–æ ‘å’Œ KNN åˆ†ç±»å™¨å¯¹ä¿¡ç”¨å¡è¿çº¦æ•°æ®è¿›è¡Œäº†åˆ†æï¼Œè¿™èŠ‚è¯¾æˆ‘ä»¬æ¥ç ”ç©¶ä¸‹ä¿¡ç”¨å¡æ¬ºè¯ˆã€‚ç›¸æ¯”äºä¿¡ç”¨å¡è¿çº¦çš„æ¯”ä¾‹ï¼Œä¿¡ç”¨å¡æ¬ºè¯ˆçš„æ¯”ä¾‹æ›´å°ï¼Œä½†æ˜¯å±å®³æå¤§ã€‚å¦‚ä½•é€šè¿‡ä»¥å¾€çš„äº¤æ˜“æ•°æ®åˆ†æå‡ºæ¯ç¬”äº¤æ˜“æ˜¯å¦æ­£å¸¸ï¼Œæ˜¯å¦å­˜åœ¨ç›—åˆ·é£é™©æ˜¯æˆ‘ä»¬è¿™æ¬¡é¡¹ç›®çš„ç›®æ ‡ã€‚é€šè¿‡ä»Šå¤©çš„å­¦ä¹ ï¼Œä½ éœ€è¦æŒæ¡ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼šäº†è§£é€»è¾‘å›å½’åˆ†ç±»ï¼Œä»¥åŠå¦‚ä½•åœ¨ sklearn ä¸­ä½¿ç”¨å®ƒï¼›ä¿¡ç”¨å¡æ¬ºè¯ˆå±äºäºŒåˆ†ç±»é—®é¢˜ï¼Œæ¬ºè¯ˆäº¤æ˜“åœ¨æ‰€æœ‰äº¤æ˜“ä¸­çš„æ¯”ä¾‹å¾ˆå°ï¼Œå¯¹äºè¿™ç§æ•°æ®ä¸å¹³è¡¡çš„æƒ…å†µï¼Œåˆ°åº•é‡‡ç”¨ä»€ä¹ˆæ ·çš„æ¨¡å‹è¯„ä¼°æ ‡å‡†ä¼šæ›´å‡†ç¡®ï¼›å®Œæˆä¿¡ç”¨å¡æ¬ºè¯ˆåˆ†æçš„å®æˆ˜é¡¹ç›®ï¼Œå¹¶é€šè¿‡æ•°æ®å¯è§†åŒ–å¯¹æ•°æ®æ¢ç´¢å’Œæ¨¡å‹ç»“æœè¯„ä¼°è¿›ä¸€æ­¥åŠ å¼ºäº†è§£ã€‚æ„å»ºé€»è¾‘å›å½’åˆ†ç±»å™¨é€»è¾‘å›å½’è™½ç„¶ä¸åœ¨æˆ‘ä»¬è®²è§£çš„åå¤§ç»å…¸æ•°æ®æŒ–æ˜ç®—æ³•é‡Œé¢ï¼Œä½†ä¹Ÿæ˜¯å¸¸ç”¨çš„æ•°æ®æŒ–æ˜ç®—æ³•ã€‚é€»è¾‘å›å½’ï¼Œä¹Ÿå«ä½œ logistic å›å½’ã€‚è™½ç„¶åå­—ä¸­å¸¦æœ‰â€œå›å½’â€ï¼Œä½†å®ƒå®é™…ä¸Šæ˜¯åˆ†ç±»æ–¹æ³•ï¼Œä¸»è¦è§£å†³çš„æ˜¯äºŒåˆ†ç±»é—®é¢˜ï¼Œå½“ç„¶å®ƒä¹Ÿå¯ä»¥è§£å†³å¤šåˆ†ç±»é—®é¢˜ï¼Œåªæ˜¯äºŒåˆ†ç±»æ›´å¸¸è§ä¸€äº›ã€‚åœ¨é€»è¾‘å›å½’ä¸­ä½¿ç”¨äº† Logistic å‡½æ•°ï¼Œä¹Ÿç§°ä¸º Sigmoid å‡½æ•°ã€‚Sigmoid å‡½æ•°æ˜¯åœ¨æ·±åº¦å­¦ä¹ ä¸­ç»å¸¸ç”¨åˆ°çš„å‡½æ•°ä¹‹ä¸€ï¼Œå‡½æ•°å…¬å¼ä¸ºï¼šå‡½æ•°çš„å›¾å½¢å¦‚ä¸‹æ‰€ç¤ºï¼Œç±»ä¼¼ S çŠ¶ï¼šä½ èƒ½çœ‹å‡º g(z) çš„ç»“æœåœ¨ 0-1 ä¹‹é—´ï¼Œå½“ z è¶Šå¤§çš„æ—¶å€™ï¼Œg(z) è¶Šå¤§ï¼Œå½“ z è¶‹è¿‘äºæ— ç©·å¤§çš„æ—¶å€™ï¼Œg(z) è¶‹è¿‘äº 1ã€‚åŒæ ·å½“ z è¶‹è¿‘äºæ— ç©·å°çš„æ—¶å€™ï¼Œg(z) è¶‹è¿‘äº 0ã€‚åŒæ—¶ï¼Œå‡½æ•°å€¼ä»¥ 0.5 ä¸ºä¸­å¿ƒã€‚ä¸ºä»€ä¹ˆé€»è¾‘å›å½’ç®—æ³•æ˜¯åŸºäº Sigmoid å‡½æ•°å®ç°çš„å‘¢ï¼Ÿä½ å¯ä»¥è¿™æ ·ç†è§£ï¼šæˆ‘ä»¬è¦å®ç°ä¸€ä¸ªäºŒåˆ†ç±»ä»»åŠ¡ï¼Œ0 å³ä¸ºä¸å‘ç”Ÿï¼Œ1 å³ä¸ºå‘ç”Ÿã€‚æˆ‘ä»¬ç»™å®šä¸€äº›å†å²æ•°æ® X å’Œ yã€‚å…¶ä¸­ X ä»£è¡¨æ ·æœ¬çš„ n ä¸ªç‰¹å¾ï¼Œy ä»£è¡¨æ­£ä¾‹å’Œè´Ÿä¾‹ï¼Œä¹Ÿå°±æ˜¯ 0 æˆ– 1 çš„å–å€¼ã€‚é€šè¿‡å†å²æ ·æœ¬çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ¨¡å‹ï¼Œå½“ç»™å®šæ–°çš„ X çš„æ—¶å€™ï¼Œå¯ä»¥é¢„æµ‹å‡º yã€‚è¿™é‡Œæˆ‘ä»¬å¾—åˆ°çš„ y æ˜¯ä¸€ä¸ªé¢„æµ‹çš„æ¦‚ç‡ï¼Œé€šå¸¸ä¸æ˜¯ 0% å’Œ 100%ï¼Œè€Œæ˜¯ä¸­é—´çš„å–å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºæ¦‚ç‡å¤§äº 50% çš„æ—¶å€™ï¼Œå³ä¸ºå‘ç”Ÿï¼ˆæ­£ä¾‹ï¼‰ï¼Œæ¦‚ç‡å°äº 50% çš„æ—¶å€™ï¼Œå³ä¸ºä¸å‘ç”Ÿï¼ˆè´Ÿä¾‹ï¼‰ã€‚è¿™æ ·å°±å®Œæˆäº†äºŒåˆ†ç±»çš„é¢„æµ‹ã€‚é€»è¾‘å›å½’æ¨¡å‹çš„æ±‚è§£è¿™é‡Œä¸åšä»‹ç»ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•ä½¿ç”¨ sklearn ä¸­çš„é€»è¾‘å›å½’å·¥å…·ã€‚åœ¨ sklearn ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ LogisticRegression() å‡½æ•°æ„å»ºé€»è¾‘å›å½’åˆ†ç±»å™¨ï¼Œå‡½æ•°é‡Œæœ‰ä¸€äº›å¸¸ç”¨çš„æ„é€ å‚æ•°ï¼špenaltyï¼šæƒ©ç½šé¡¹ï¼Œå–å€¼ä¸º l1 æˆ– l2ï¼Œé»˜è®¤ä¸º l2ã€‚å½“æ¨¡å‹å‚æ•°æ»¡è¶³é«˜æ–¯åˆ†å¸ƒçš„æ—¶å€™ï¼Œä½¿ç”¨ l2ï¼Œå½“æ¨¡å‹å‚æ•°æ»¡è¶³æ‹‰æ™®æ‹‰æ–¯åˆ†å¸ƒçš„æ—¶å€™ï¼Œä½¿ç”¨ l1ï¼›solverï¼šä»£è¡¨çš„æ˜¯é€»è¾‘å›å½’æŸå¤±å‡½æ•°çš„ä¼˜åŒ–æ–¹æ³•ã€‚æœ‰ 5 ä¸ªå‚æ•°å¯é€‰ï¼Œåˆ†åˆ«ä¸º liblinearã€lbfgsã€newton-cgã€sag å’Œ sagaã€‚é»˜è®¤ä¸º liblinearï¼Œé€‚ç”¨äºæ•°æ®é‡å°çš„æ•°æ®é›†ï¼Œå½“æ•°æ®é‡å¤§çš„æ—¶å€™å¯ä»¥é€‰ç”¨ sag æˆ– saga æ–¹æ³•ã€‚max_iterï¼šç®—æ³•æ”¶æ•›çš„æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œé»˜è®¤ä¸º 10ã€‚n_jobsï¼šæ‹Ÿåˆå’Œé¢„æµ‹çš„æ—¶å€™ CPU çš„æ ¸æ•°ï¼Œé»˜è®¤æ˜¯ 1ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•´æ•°ï¼Œå¦‚æœæ˜¯ -1 åˆ™ä»£è¡¨ CPU çš„æ ¸æ•°ã€‚å½“æˆ‘ä»¬åˆ›å»ºå¥½ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨ fit å‡½æ•°æ‹Ÿåˆï¼Œä½¿ç”¨ predict å‡½æ•°é¢„æµ‹ã€‚æ¨¡å‹è¯„ä¼°æŒ‡æ ‡æˆ‘ä»¬ä¹‹å‰å¯¹æ¨¡å‹åšè¯„ä¼°æ—¶ï¼Œé€šå¸¸é‡‡ç”¨çš„æ˜¯å‡†ç¡®ç‡ (accuracy)ï¼Œå®ƒæŒ‡çš„æ˜¯åˆ†ç±»å™¨æ­£ç¡®åˆ†ç±»çš„æ ·æœ¬æ•°ä¸æ€»ä½“æ ·æœ¬æ•°ä¹‹é—´çš„æ¯”ä¾‹ã€‚è¿™ä¸ªæŒ‡æ ‡å¯¹å¤§éƒ¨åˆ†çš„åˆ†ç±»æƒ…å†µæ˜¯æœ‰æ•ˆçš„ï¼Œä¸è¿‡å½“åˆ†ç±»ç»“æœä¸¥é‡ä¸å¹³è¡¡çš„æ—¶å€™ï¼Œå‡†ç¡®ç‡å¾ˆéš¾ååº”æ¨¡å‹çš„å¥½åã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºæœºåœºå®‰æ£€ä¸­ææ€–åˆ†å­çš„åˆ¤æ–­ï¼Œå°±ä¸èƒ½é‡‡ç”¨å‡†ç¡®ç‡å¯¹æ¨¡å‹è¿›è¡Œè¯„ä¼°ã€‚æˆ‘ä»¬çŸ¥é“ææ€–åˆ†å­çš„æ¯”ä¾‹æ˜¯æä½çš„ï¼Œå› æ­¤å½“æˆ‘ä»¬ç”¨å‡†ç¡®ç‡åšåˆ¤æ–­æ—¶ï¼Œå¦‚æœå‡†ç¡®ç‡é«˜è¾¾ 99.999%ï¼Œå°±è¯´æ˜è¿™ä¸ªæ¨¡å‹ä¸€å®šå¥½ä¹ˆï¼Ÿå…¶å®æ­£å› ä¸ºç°å®ç”Ÿæ´»ä¸­ææ€–åˆ†å­çš„æ¯”ä¾‹æä½ï¼Œå°±ç®—æˆ‘ä»¬ä¸èƒ½è¯†åˆ«å‡ºä¸€ä¸ªææ€–åˆ†å­ï¼Œä¹Ÿä¼šå¾—åˆ°éå¸¸é«˜çš„å‡†ç¡®ç‡ã€‚å› ä¸ºå‡†ç¡®ç‡çš„è¯„åˆ¤æ ‡å‡†æ˜¯æ­£ç¡®åˆ†ç±»çš„æ ·æœ¬ä¸ªæ•°ä¸æ€»æ ·æœ¬æ•°ä¹‹é—´çš„æ¯”ä¾‹ã€‚å› æ­¤éææ€–åˆ†å­çš„æ¯”ä¾‹ä¼šå¾ˆé«˜ï¼Œå°±ç®—æˆ‘ä»¬è¯†åˆ«ä¸å‡ºæ¥ææ€–åˆ†å­ï¼Œæ­£ç¡®åˆ†ç±»çš„ä¸ªæ•°å æ€»æ ·æœ¬çš„æ¯”ä¾‹ä¹Ÿä¼šå¾ˆé«˜ï¼Œä¹Ÿå°±æ˜¯å‡†ç¡®ç‡é«˜ã€‚å®é™…ä¸Šæˆ‘ä»¬åº”è¯¥æ›´å…³æ³¨ææ€–åˆ†å­çš„è¯†åˆ«ï¼Œè¿™é‡Œå…ˆä»‹ç»ä¸‹æ•°æ®é¢„æµ‹çš„å››ç§æƒ…å†µï¼šTPã€FPã€TNã€FNã€‚æˆ‘ä»¬ç”¨ç¬¬äºŒä¸ªå­—æ¯ P æˆ– N ä»£è¡¨é¢„æµ‹ä¸ºæ­£ä¾‹è¿˜æ˜¯è´Ÿä¾‹ï¼ŒP ä¸ºæ­£ï¼ŒN ä¸ºè´Ÿã€‚ç¬¬ä¸€ä¸ªå­—æ¯ T æˆ– F ä»£è¡¨çš„æ˜¯é¢„æµ‹ç»“æœæ˜¯å¦æ­£ç¡®ï¼ŒT ä¸ºæ­£ç¡®ï¼ŒF ä¸ºé”™è¯¯ã€‚æ‰€ä»¥å››ç§æƒ…å†µåˆ†åˆ«ä¸ºï¼šTPï¼šé¢„æµ‹ä¸ºæ­£ï¼Œåˆ¤æ–­æ­£ç¡®ï¼›FPï¼šé¢„æµ‹ä¸ºæ­£ï¼Œåˆ¤æ–­é”™è¯¯ï¼›TNï¼šé¢„æµ‹ä¸ºè´Ÿï¼Œåˆ¤æ–­æ­£ç¡®ï¼›FNï¼šé¢„æµ‹ä¸ºè´Ÿï¼Œåˆ¤æ–­é”™è¯¯ã€‚æˆ‘ä»¬çŸ¥é“æ ·æœ¬æ€»æ•° =TP+FP+TN+FNï¼Œé¢„æµ‹æ­£ç¡®çš„æ ·æœ¬æ•°ä¸º TP+TNï¼Œå› æ­¤å‡†ç¡®ç‡ Accuracy = (TP+TN)/(TP+TN+FN+FP)ã€‚å®é™…ä¸Šï¼Œå¯¹äºåˆ†ç±»ä¸å¹³è¡¡çš„æƒ…å†µï¼Œæœ‰ä¸¤ä¸ªæŒ‡æ ‡éå¸¸é‡è¦ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ç²¾ç¡®åº¦å’Œå¬å›ç‡ã€‚ç²¾ç¡®ç‡ P = TP/ (TP+FP)ï¼Œå¯¹åº”ä¸Šé¢ææ€–åˆ†å­è¿™ä¸ªä¾‹å­ï¼Œåœ¨æ‰€æœ‰åˆ¤æ–­ä¸ºææ€–åˆ†å­çš„äººæ•°ä¸­ï¼ŒçœŸæ­£æ˜¯ææ€–åˆ†å­çš„æ¯”ä¾‹ã€‚å¬å›ç‡ R = TP/ (TP+FN)ï¼Œä¹Ÿç§°ä¸ºæŸ¥å…¨ç‡ã€‚ä»£è¡¨çš„æ˜¯ææ€–åˆ†å­è¢«æ­£ç¡®è¯†åˆ«å‡ºæ¥çš„ä¸ªæ•°ä¸ææ€–åˆ†å­æ€»æ•°çš„æ¯”ä¾‹ã€‚ä¸ºä»€ä¹ˆè¦ç»Ÿè®¡å¬å›ç‡å’Œç²¾ç¡®ç‡è¿™ä¸¤ä¸ªæŒ‡æ ‡å‘¢ï¼Ÿå‡è®¾æˆ‘ä»¬åªç»Ÿè®¡å¬å›ç‡ï¼Œå½“å¬å›ç‡ç­‰äº 100% çš„æ—¶å€™ï¼Œæ¨¡å‹æ˜¯å¦çœŸçš„å¥½å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æŠŠæœºåœºæ‰€æœ‰çš„äººéƒ½è®¤ä¸ºæ˜¯ææ€–åˆ†å­ï¼Œææ€–åˆ†å­éƒ½ä¼šè¢«æ­£ç¡®è¯†åˆ«ï¼Œè¿™ä¸ªæ•°å­—ä¸ææ€–åˆ†å­çš„æ€»æ•°æ¯”ä¾‹ç­‰äº 100%ï¼Œä½†æ˜¯è¿™ä¸ªç»“æœæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚å¦‚æœæˆ‘ä»¬è®¤ä¸ºæœºåœºé‡Œæ‰€æœ‰äººéƒ½æ˜¯ææ€–åˆ†å­çš„è¯ï¼Œé‚£ä¹ˆéææ€–åˆ†å­ï¼ˆæé«˜æ¯”ä¾‹ï¼‰éƒ½ä¼šè®¤ä¸ºæ˜¯ææ€–åˆ†å­ï¼Œè¯¯åˆ¤ç‡å¤ªé«˜äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ç»Ÿè®¡ç²¾ç¡®ç‡ä½œä¸ºå¬å›ç‡çš„è¡¥å……ã€‚å®é™…ä¸Šæœ‰ä¸€ä¸ªæŒ‡æ ‡ç»¼åˆäº†ç²¾ç¡®ç‡å’Œå¬å›ç‡ï¼Œå¯ä»¥æ›´å¥½åœ°è¯„ä¼°æ¨¡å‹çš„å¥½åã€‚è¿™ä¸ªæŒ‡æ ‡å«åš F1ï¼Œç”¨å…¬å¼è¡¨ç¤ºä¸ºï¼šF1 ä½œä¸ºç²¾ç¡®ç‡ P å’Œå¬å›ç‡ R çš„è°ƒå’Œå¹³å‡ï¼Œæ•°å€¼è¶Šå¤§ä»£è¡¨æ¨¡å‹çš„ç»“æœè¶Šå¥½ã€‚ä¿¡ç”¨å¡æ¬ºè¯ˆåˆ†ææˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¿¡ç”¨å¡æ¬ºè¯ˆåˆ†æçš„é¡¹ç›®ï¼Œè¿™ä¸ªæ•°æ®é›†ä½ å¯ä»¥ä»ç™¾åº¦ç½‘ç›˜ï¼ˆå› ä¸ºæ•°æ®é›†å¤§äº 100Mï¼Œæ‰€ä»¥é‡‡ç”¨äº†ç½‘ç›˜ï¼‰ä¸­ä¸‹è½½ï¼šé“¾æ¥ï¼šhttps://pan.baidu.com/s/14F8WuX0ZJntdB_r1EC08HA æå–ç ï¼š58gpæ•°æ®é›†åŒ…æ‹¬äº† 2013 å¹´ 9 æœˆä»½ä¸¤å¤©æ—¶é—´å†…çš„ä¿¡ç”¨å¡äº¤æ˜“æ•°æ®ï¼Œ284807 ç¬”äº¤æ˜“ä¸­ï¼Œä¸€å…±æœ‰ 492 ç¬”æ˜¯æ¬ºè¯ˆè¡Œä¸ºã€‚è¾“å…¥æ•°æ®ä¸€å…±åŒ…æ‹¬äº† 28 ä¸ªç‰¹å¾ V1ï¼ŒV2ï¼Œâ€¦â€¦V28 å¯¹åº”çš„å–å€¼ï¼Œä»¥åŠäº¤æ˜“æ—¶é—´ Time å’Œäº¤æ˜“é‡‘é¢ Amountã€‚ä¸ºäº†ä¿æŠ¤æ•°æ®éšç§ï¼Œæˆ‘ä»¬ä¸çŸ¥é“ V1 åˆ° V28 è¿™äº›ç‰¹å¾ä»£è¡¨çš„å…·ä½“å«ä¹‰ï¼ŒåªçŸ¥é“è¿™ 28 ä¸ªç‰¹å¾å€¼æ˜¯é€šè¿‡ PCA å˜æ¢å¾—åˆ°çš„ç»“æœã€‚å¦å¤–å­—æ®µ Class ä»£è¡¨è¯¥ç¬”äº¤æ˜“çš„åˆ†ç±»ï¼ŒClass=0 ä¸ºæ­£å¸¸ï¼ˆéæ¬ºè¯ˆï¼‰ï¼ŒClass=1 ä»£è¡¨æ¬ºè¯ˆã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯é’ˆå¯¹è¿™ä¸ªæ•°æ®é›†æ„å»ºä¸€ä¸ªä¿¡ç”¨å¡æ¬ºè¯ˆåˆ†æçš„åˆ†ç±»å™¨ï¼Œé‡‡ç”¨çš„æ˜¯é€»è¾‘å›å½’ã€‚ä»æ•°æ®ä¸­ä½ èƒ½çœ‹åˆ°æ¬ºè¯ˆè¡Œä¸ºåªå åˆ°äº† 492/284807=0.172%ï¼Œæ•°æ®åˆ†ç±»ç»“æœçš„åˆ†å¸ƒæ˜¯éå¸¸ä¸å¹³è¡¡çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨å‡†ç¡®ç‡è¯„ä¼°æ¨¡å‹çš„å¥½åï¼Œè€Œæ˜¯éœ€è¦ç»Ÿè®¡ F1 å€¼ï¼ˆç»¼åˆç²¾ç¡®ç‡å’Œå¬å›ç‡ï¼‰ã€‚æˆ‘ä»¬å…ˆæ¢³ç†ä¸‹æ•´ä¸ªé¡¹ç›®çš„æµç¨‹ï¼šåŠ è½½æ•°æ®ï¼›å‡†å¤‡é˜¶æ®µï¼šæˆ‘ä»¬éœ€è¦æ¢ç´¢æ•°æ®ï¼Œç”¨æ•°æ®å¯è§†åŒ–çš„æ–¹å¼æŸ¥çœ‹åˆ†ç±»ç»“æœçš„æƒ…å†µï¼Œä»¥åŠéšç€æ—¶é—´çš„å˜åŒ–ï¼Œæ¬ºè¯ˆäº¤æ˜“å’Œæ­£å¸¸äº¤æ˜“çš„åˆ†å¸ƒæƒ…å†µã€‚ä¸Šé¢å·²ç»æåˆ°è¿‡ï¼ŒV1-V28 çš„ç‰¹å¾å€¼éƒ½ç»è¿‡ PCA çš„å˜æ¢ï¼Œä½†æ˜¯å…¶ä½™çš„ä¸¤ä¸ªå­—æ®µï¼ŒTime å’Œ Amount è¿˜éœ€è¦è¿›è¡Œè§„èŒƒåŒ–ã€‚Time å­—æ®µå’Œäº¤æ˜“æœ¬èº«æ˜¯å¦ä¸ºæ¬ºè¯ˆäº¤æ˜“æ— å…³ï¼Œå› æ­¤æˆ‘ä»¬ä¸ä½œä¸ºç‰¹å¾é€‰æ‹©ï¼Œåªéœ€è¦å¯¹ Amount åšæ•°æ®è§„èŒƒåŒ–å°±è¡Œäº†ã€‚åŒæ—¶æ•°æ®é›†æ²¡æœ‰ä¸“é—¨çš„æµ‹è¯•é›†ï¼Œä½¿ç”¨ train_test_split å¯¹æ•°æ®é›†è¿›è¡Œåˆ’åˆ†ï¼›åˆ†ç±»é˜¶æ®µï¼šæˆ‘ä»¬éœ€è¦åˆ›å»ºé€»è¾‘å›å½’åˆ†ç±»å™¨ï¼Œç„¶åä¼ å…¥è®­ç»ƒé›†æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œå¹¶ä¼ å…¥æµ‹è¯•é›†é¢„æµ‹ç»“æœï¼Œå°†é¢„æµ‹ç»“æœä¸æµ‹è¯•é›†çš„ç»“æœè¿›è¡Œæ¯”å¯¹ã€‚è¿™é‡Œçš„æ¨¡å‹è¯„ä¼°æŒ‡æ ‡ç”¨åˆ°äº†ç²¾ç¡®ç‡ã€å¬å›ç‡å’Œ F1 å€¼ã€‚åŒæ—¶æˆ‘ä»¬å°†ç²¾ç¡®ç‡ - å¬å›ç‡è¿›è¡Œäº†å¯è§†åŒ–å‘ˆç°ã€‚åŸºäºä¸Šé¢çš„æµç¨‹ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109# -*- coding:utf-8 -*-# ä½¿ç”¨é€»è¾‘å›å½’å¯¹ä¿¡ç”¨å¡æ¬ºè¯ˆè¿›è¡Œåˆ†ç±»import pandas as pdimport numpy as npimport seaborn as snsimport matplotlib.pyplot as pltimport itertoolsfrom sklearn.linear_model import LogisticRegressionfrom sklearn.model_selection import train_test_splitfrom sklearn.metrics import confusion_matrix, precision_recall_curvefrom sklearn.preprocessing import StandardScalerimport warningswarnings.filterwarnings('ignore') # æ··æ·†çŸ©é˜µå¯è§†åŒ–def plot_confusion_matrix(cm, classes, normalize = False, title = 'Confusion matrix\"', cmap = plt.cm.Blues) : plt.figure() plt.imshow(cm, interpolation = 'nearest', cmap = cmap) plt.title(title) plt.colorbar() tick_marks = np.arange(len(classes)) plt.xticks(tick_marks, classes, rotation = 0) plt.yticks(tick_marks, classes) thresh = cm.max() / 2. for i, j in itertools.product(range(cm.shape[0]), range(cm.shape[1])) : plt.text(j, i, cm[i, j], horizontalalignment = 'center', color = 'white' if cm[i, j] &gt; thresh else 'black') plt.tight_layout() plt.ylabel('True label') plt.xlabel('Predicted label') plt.show() # æ˜¾ç¤ºæ¨¡å‹è¯„ä¼°ç»“æœdef show_metrics(): tp = cm[1,1] fn = cm[1,0] fp = cm[0,1] tn = cm[0,0] print('ç²¾ç¡®ç‡: &#123;:.3f&#125;'.format(tp/(tp+fp))) print('å¬å›ç‡: &#123;:.3f&#125;'.format(tp/(tp+fn))) print('F1å€¼: &#123;:.3f&#125;'.format(2*(((tp/(tp+fp))*(tp/(tp+fn)))/((tp/(tp+fp))+(tp/(tp+fn))))))# ç»˜åˆ¶ç²¾ç¡®ç‡-å¬å›ç‡æ›²çº¿def plot_precision_recall(): plt.step(recall, precision, color = 'b', alpha = 0.2, where = 'post') plt.fill_between(recall, precision, step ='post', alpha = 0.2, color = 'b') plt.plot(recall, precision, linewidth=2) plt.xlim([0.0,1]) plt.ylim([0.0,1.05]) plt.xlabel('å¬å›ç‡') plt.ylabel('ç²¾ç¡®ç‡') plt.title('ç²¾ç¡®ç‡-å¬å›ç‡ æ›²çº¿') plt.show(); # æ•°æ®åŠ è½½data = pd.read_csv('./creditcard.csv')# æ•°æ®æ¢ç´¢print(data.describe())# è®¾ç½®pltæ­£ç¡®æ˜¾ç¤ºä¸­æ–‡plt.rcParams['font.sans-serif'] = ['SimHei']# ç»˜åˆ¶ç±»åˆ«åˆ†å¸ƒplt.figure()ax = sns.countplot(x = 'Class', data = data)plt.title('ç±»åˆ«åˆ†å¸ƒ')plt.show()# æ˜¾ç¤ºäº¤æ˜“ç¬”æ•°ï¼Œæ¬ºè¯ˆäº¤æ˜“ç¬”æ•°num = len(data)num_fraud = len(data[data['Class']==1]) print('æ€»äº¤æ˜“ç¬”æ•°: ', num)print('è¯ˆéª—äº¤æ˜“ç¬”æ•°ï¼š', num_fraud)print('è¯ˆéª—äº¤æ˜“æ¯”ä¾‹ï¼š&#123;:.6f&#125;'.format(num_fraud/num))# æ¬ºè¯ˆå’Œæ­£å¸¸äº¤æ˜“å¯è§†åŒ–f, (ax1, ax2) = plt.subplots(2, 1, sharex=True, figsize=(15,8))bins = 50ax1.hist(data.Time[data.Class == 1], bins = bins, color = 'deeppink')ax1.set_title('è¯ˆéª—äº¤æ˜“')ax2.hist(data.Time[data.Class == 0], bins = bins, color = 'deepskyblue')ax2.set_title('æ­£å¸¸äº¤æ˜“')plt.xlabel('æ—¶é—´')plt.ylabel('äº¤æ˜“æ¬¡æ•°')plt.show()# å¯¹Amountè¿›è¡Œæ•°æ®è§„èŒƒåŒ–data['Amount_Norm'] = StandardScaler().fit_transform(data['Amount'].values.reshape(-1,1))# ç‰¹å¾é€‰æ‹©y = np.array(data.Class.tolist())data = data.drop(['Time','Amount','Class'],axis=1)X = np.array(data.as_matrix())# å‡†å¤‡è®­ç»ƒé›†å’Œæµ‹è¯•é›†train_x, test_x, train_y, test_y = train_test_split (X, y, test_size = 0.1, random_state = 33) # é€»è¾‘å›å½’åˆ†ç±»clf = LogisticRegression()clf.fit(train_x, train_y)predict_y = clf.predict(test_x)# é¢„æµ‹æ ·æœ¬çš„ç½®ä¿¡åˆ†æ•°score_y = clf.decision_function(test_x) # è®¡ç®—æ··æ·†çŸ©é˜µï¼Œå¹¶æ˜¾ç¤ºcm = confusion_matrix(test_y, predict_y)class_names = [0,1]# æ˜¾ç¤ºæ··æ·†çŸ©é˜µplot_confusion_matrix(cm, classes = class_names, title = 'é€»è¾‘å›å½’ æ··æ·†çŸ©é˜µ')# æ˜¾ç¤ºæ¨¡å‹è¯„ä¼°åˆ†æ•°show_metrics()# è®¡ç®—ç²¾ç¡®ç‡ï¼Œå¬å›ç‡ï¼Œé˜ˆå€¼ç”¨äºå¯è§†åŒ–precision, recall, thresholds = precision_recall_curve(test_y, score_y)plot_precision_recall()ç»“æœï¼š123456789101112 Time V1 ... Amount Classcount 284807.000000 2.848070e+05 ... 284807.000000 284807.000000mean 94813.859575 1.165980e-15 ... 88.349619 0.001727std 47488.145955 1.958696e+00 ... 250.120109 0.041527min 0.000000 -5.640751e+01 ... 0.000000 0.00000025% 54201.500000 -9.203734e-01 ... 5.600000 0.00000050% 84692.000000 1.810880e-02 ... 22.000000 0.00000075% 139320.500000 1.315642e+00 ... 77.165000 0.000000max 172792.000000 2.454930e+00 ... 25691.160000 1.000000[8 rows x 31 columns]1234æ€»äº¤æ˜“ç¬”æ•°: 284807è¯ˆéª—äº¤æ˜“ç¬”æ•°ï¼š 492è¯ˆéª—äº¤æ˜“æ¯”ä¾‹ï¼š0.001727)1234ç²¾ç¡®ç‡: 0.841å¬å›ç‡: 0.617F1å€¼: 0.712ä½ èƒ½çœ‹å‡ºæ¥æ¬ºè¯ˆäº¤æ˜“çš„ç¬”æ•°ä¸º 492 ç¬”ï¼Œå æ‰€æœ‰äº¤æ˜“çš„æ¯”ä¾‹æ˜¯å¾ˆä½çš„ï¼Œå³ 0.001727ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ•°æ®å¯è§†åŒ–çš„æ–¹å¼å¯¹æ¬ºè¯ˆäº¤æ˜“å’Œæ­£å¸¸äº¤æ˜“çš„åˆ†å¸ƒè¿›è¡Œå‘ˆç°ã€‚å¦å¤–é€šè¿‡å¯è§†åŒ–ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½çœ‹å‡ºç²¾ç¡®ç‡å’Œå¬å›ç‡ä¹‹é—´çš„å…³ç³»ï¼Œå½“ç²¾ç¡®ç‡é«˜çš„æ—¶å€™ï¼Œå¬å›ç‡å¾€å¾€å¾ˆä½ï¼Œå¬å›ç‡é«˜çš„æ—¶å€™ï¼Œç²¾ç¡®ç‡ä¼šæ¯”è¾ƒä½ã€‚ä»£ç æœ‰ä¸€äº›æ¨¡å—éœ€è¦è¯´æ˜ä¸‹ã€‚æˆ‘å®šä¹‰äº† plot_confusion_matrix å‡½æ•°å¯¹æ··æ·†çŸ©é˜µè¿›è¡Œå¯è§†åŒ–ã€‚ä»€ä¹ˆæ˜¯æ··æ·†çŸ©é˜µå‘¢ï¼Ÿæ··æ·†çŸ©é˜µä¹Ÿå«è¯¯å·®çŸ©é˜µï¼Œå®é™…ä¸Šå®ƒå°±æ˜¯ TPã€FPã€TNã€FN è¿™å››ä¸ªæ•°å€¼çš„çŸ©é˜µè¡¨ç¤ºï¼Œå¸®åŠ©æˆ‘ä»¬åˆ¤æ–­é¢„æµ‹å€¼å’Œå®é™…å€¼ç›¸æ¯”ï¼Œå¯¹äº†å¤šå°‘ã€‚ä»è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ èƒ½çœ‹å‡º TP=37ï¼ŒFP=7ï¼ŒFN=23ã€‚æ‰€ä»¥ç²¾ç¡®ç‡ P=TP/(TP+FP)=37/(37+7)=0.841ï¼Œå¬å›ç‡ R=TP/(TP+FN)=37/(37+23)=0.617ã€‚ç„¶åä½¿ç”¨äº† sklearn ä¸­çš„ precision_recall_curve å‡½æ•°ï¼Œé€šè¿‡é¢„æµ‹å€¼å’ŒçœŸå®å€¼æ¥è®¡ç®—ç²¾ç¡®ç‡ - å¬å›ç‡æ›²çº¿ã€‚precision_recall_curve å‡½æ•°ä¼šè®¡ç®—åœ¨ä¸åŒæ¦‚ç‡é˜ˆå€¼æƒ…å†µä¸‹çš„ç²¾ç¡®ç‡å’Œå¬å›ç‡ã€‚æœ€åå®šä¹‰ plot_precision_recall å‡½æ•°ï¼Œç»˜åˆ¶æ›²çº¿ã€‚æ€»ç»“ä»Šå¤©æˆ‘ç»™ä½ è®²äº†é€»è¾‘å›å½’çš„æ¦‚å¿µå’Œç›¸å…³å·¥å…·çš„ä½¿ç”¨ï¼Œå¦å¤–å­¦ä¹ äº†åœ¨æ•°æ®æ ·æœ¬ä¸å¹³è¡¡çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•è¯„ä¼°æ¨¡å‹ã€‚è¿™é‡Œä½ éœ€è¦äº†è§£ç²¾ç¡®ç‡ï¼Œå¬å›ç‡å’Œ F1 çš„æ¦‚å¿µå’Œè®¡ç®—æ–¹å¼ã€‚æœ€ååœ¨ä¿¡ç”¨å¡æ¬ºè¯ˆåˆ†æçš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†é€»è¾‘å›å½’å·¥å…·ï¼Œå¹¶å¯¹æ··æ·†çŸ©é˜µè¿›è¡Œäº†è®¡ç®—ï¼ŒåŒæ—¶åœ¨æ¨¡å‹ç»“æœè¯„ä¼°ä¸­ï¼Œä½¿ç”¨äº†ç²¾ç¡®ç‡ã€å¬å›ç‡å’Œ F1 å€¼ï¼Œæœ€åå¾—åˆ°ç²¾ç¡®ç‡ - å¬å›ç‡æ›²çº¿çš„å¯è§†åŒ–ç»“æœã€‚ä»è¿™ä¸ªé¡¹ç›®ä¸­ä½ èƒ½çœ‹å‡ºæ¥ï¼Œä¸æ˜¯æ‰€æœ‰çš„åˆ†ç±»éƒ½æ˜¯æ ·æœ¬å¹³è¡¡çš„æƒ…å†µï¼Œé’ˆå¯¹æ­£ä¾‹æ¯”ä¾‹æä½çš„æƒ…å†µï¼Œæ¯”å¦‚ä¿¡ç”¨å¡æ¬ºè¯ˆã€æŸäº›ç–¾ç—…çš„è¯†åˆ«ï¼Œæˆ–è€…æ˜¯ææ€–åˆ†å­çš„åˆ¤æ–­ç­‰ï¼Œéƒ½éœ€è¦é‡‡ç”¨ç²¾ç¡®ç‡ - å¬å›ç‡æ¥è¿›è¡Œç»Ÿè®¡ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"é€»è¾‘å›å½’","slug":"é€»è¾‘å›å½’","permalink":"cpeixin.cn/tags/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/"}]},{"title":"ä¿¡ç”¨å¡é£é™©è¯„ä¼°","slug":"ä¿¡ç”¨å¡é£é™©è¯„ä¼°","date":"2018-09-30T17:21:02.000Z","updated":"2020-05-01T14:20:47.150Z","comments":true,"path":"2018/10/01/ä¿¡ç”¨å¡é£é™©è¯„ä¼°/","link":"","permalink":"cpeixin.cn/2018/10/01/%E4%BF%A1%E7%94%A8%E5%8D%A1%E9%A3%8E%E9%99%A9%E8%AF%84%E4%BC%B0/","excerpt":"","text":"ä»Šå¤©æˆ‘æ¥å¸¦ä½ åšä¸€ä¸ªæ•°æ®æŒ–æ˜çš„é¡¹ç›®ã€‚åœ¨æ•°æ®æŒ–æ˜çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ï¼šå¦‚ä½•é€‰æ‹©å„ç§åˆ†ç±»å™¨ï¼Œåˆ°åº•é€‰æ‹©å“ªä¸ªåˆ†ç±»ç®—æ³•ï¼Œæ˜¯ SVMï¼Œå†³ç­–æ ‘ï¼Œè¿˜æ˜¯ KNNï¼Ÿå¦‚ä½•ä¼˜åŒ–åˆ†ç±»å™¨çš„å‚æ•°ï¼Œä»¥ä¾¿å¾—åˆ°æ›´å¥½çš„åˆ†ç±»å‡†ç¡®ç‡ï¼Ÿè¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæ˜¯æ•°æ®æŒ–æ˜æ ¸å¿ƒçš„é—®é¢˜ã€‚å½“ç„¶å¯¹äºä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œæˆ‘ä»¬è¿˜æœ‰å…¶ä»–çš„é—®é¢˜éœ€è¦äº†è§£ï¼Œæ¯”å¦‚æŒæ¡æ•°æ®æ¢ç´¢å’Œæ•°æ®å¯è§†åŒ–çš„æ–¹å¼ï¼Œè¿˜éœ€è¦å¯¹æ•°æ®çš„å®Œæ•´æ€§å’Œè´¨é‡åšè¯„ä¼°ã€‚è¿™äº›å†…å®¹æˆ‘åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­éƒ½æœ‰è®²åˆ°è¿‡ã€‚ä»Šå¤©çš„å­¦ä¹ ä¸»è¦å›´ç»•ä¸‹é¢çš„ä¸‰ä¸ªç›®æ ‡ï¼Œå¹¶é€šè¿‡å®ƒä»¬å®Œæˆä¿¡ç”¨å¡è¿çº¦ç‡é¡¹ç›®çš„å®æˆ˜è¿™ä¸‰ä¸ªç›®æ ‡åˆ†åˆ«æ˜¯ï¼šåˆ›å»ºå„ç§åˆ†ç±»å™¨ï¼ŒåŒ…æ‹¬å·²ç»æŒæ¡çš„ SVMã€å†³ç­–æ ‘ã€KNN åˆ†ç±»å™¨ï¼Œä»¥åŠéšæœºæ£®æ—åˆ†ç±»å™¨ï¼›æŒæ¡ GridSearchCV å·¥å…·ï¼Œä¼˜åŒ–ç®—æ³•æ¨¡å‹çš„å‚æ•°ï¼›ä½¿ç”¨ Pipeline ç®¡é“æœºåˆ¶è¿›è¡Œæµæ°´çº¿ä½œä¸šã€‚å› ä¸ºåœ¨åšåˆ†ç±»ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›å‡†å¤‡è¿‡ç¨‹ï¼Œæ¯”å¦‚æ•°æ®è§„èŒƒåŒ–ï¼Œæˆ–è€…æ•°æ®é™ç»´ç­‰ã€‚æ„å»ºéšæœºæ£®æ—åˆ†ç±»å™¨åœ¨ç®—æ³•ç¯‡ä¸­ï¼Œæˆ‘ä¸»è¦è®²äº†æ•°æ®æŒ–æ˜åå¤§ç»å…¸ç®—æ³•ã€‚å®é™…å·¥ä½œä¸­ï¼Œä½ ä¹Ÿå¯èƒ½ä¼šç”¨åˆ°éšæœºæ£®æ—ã€‚éšæœºæ£®æ—çš„è‹±æ–‡æ˜¯ Random Forestï¼Œè‹±æ–‡ç®€å†™æ˜¯ RFã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå†³ç­–æ ‘çš„åˆ†ç±»å™¨ï¼Œæ¯ä¸€ä¸ªå­åˆ†ç±»å™¨éƒ½æ˜¯ä¸€æ£µ CART åˆ†ç±»å›å½’æ ‘ã€‚æ‰€ä»¥éšæœºæ£®æ—æ—¢å¯ä»¥åšåˆ†ç±»ï¼Œåˆå¯ä»¥åšå›å½’ã€‚å½“å®ƒåšåˆ†ç±»çš„æ—¶å€™ï¼Œè¾“å‡ºç»“æœæ˜¯æ¯ä¸ªå­åˆ†ç±»å™¨çš„åˆ†ç±»ç»“æœä¸­æœ€å¤šçš„é‚£ä¸ªã€‚ä½ å¯ä»¥ç†è§£æ˜¯æ¯ä¸ªåˆ†ç±»å™¨éƒ½åšæŠ•ç¥¨ï¼Œå–æŠ•ç¥¨æœ€å¤šçš„é‚£ä¸ªç»“æœã€‚å½“å®ƒåšå›å½’çš„æ—¶å€™ï¼Œè¾“å‡ºç»“æœæ˜¯æ¯æ£µ CART æ ‘çš„å›å½’ç»“æœçš„å¹³å‡å€¼ã€‚åœ¨ sklearn ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ RandomForestClassifier() æ„é€ éšæœºæ£®æ—æ¨¡å‹ï¼Œå‡½æ•°é‡Œæœ‰ä¸€äº›å¸¸ç”¨çš„æ„é€ å‚æ•°ï¼šå½“æˆ‘ä»¬åˆ›å»ºå¥½ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨ fit å‡½æ•°æ‹Ÿåˆï¼Œä½¿ç”¨ predict å‡½æ•°é¢„æµ‹ã€‚ä½¿ç”¨ GridSearchCV å·¥å…·å¯¹æ¨¡å‹å‚æ•°è¿›è¡Œè°ƒä¼˜åœ¨åšåˆ†ç±»ç®—æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ç»å¸¸è°ƒèŠ‚ç½‘ç»œå‚æ•°ï¼ˆå¯¹åº”ä¸Šé¢çš„æ„é€ å‚æ•°ï¼‰ï¼Œç›®çš„æ˜¯å¾—åˆ°æ›´å¥½çš„åˆ†ç±»ç»“æœã€‚å®é™…ä¸Šä¸€ä¸ªåˆ†ç±»ç®—æ³•æœ‰å¾ˆå¤šå‚æ•°ï¼Œå–å€¼èŒƒå›´ä¹Ÿæ¯”è¾ƒå¹¿ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•è°ƒä¼˜å‘¢ï¼ŸPython ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¾ˆå¥½ç”¨çš„å·¥å…· GridSearchCVï¼Œå®ƒæ˜¯ Python çš„å‚æ•°è‡ªåŠ¨æœç´¢æ¨¡å—ã€‚æˆ‘ä»¬åªè¦å‘Šè¯‰å®ƒæƒ³è¦è°ƒä¼˜çš„å‚æ•°æœ‰å“ªäº›ä»¥åŠå‚æ•°çš„å–å€¼èŒƒå›´ï¼Œå®ƒå°±ä¼šæŠŠæ‰€æœ‰çš„æƒ…å†µéƒ½è·‘ä¸€éï¼Œç„¶åå‘Šè¯‰æˆ‘ä»¬å“ªä¸ªå‚æ•°æ˜¯æœ€ä¼˜çš„ï¼Œç»“æœå¦‚ä½•ã€‚ä½¿ç”¨ GridSearchCV æ¨¡å—éœ€è¦å…ˆå¼•ç”¨å·¥å…·åŒ…ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š1from sklearn.model_selection import GridSearchCVç„¶åæˆ‘ä»¬ä½¿ç”¨ GridSearchCV(estimator, param_grid, cv=None, scoring=None) æ„é€ å‚æ•°çš„è‡ªåŠ¨æœç´¢æ¨¡å—ï¼Œè¿™é‡Œæœ‰ä¸€äº›ä¸»è¦çš„å‚æ•°éœ€è¦è¯´æ˜ä¸‹ï¼šæ„é€ å®Œ GridSearchCV ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ fit å‡½æ•°æ‹Ÿåˆè®­ç»ƒï¼Œä½¿ç”¨ predict å‡½æ•°é¢„æµ‹ï¼Œè¿™æ—¶é¢„æµ‹é‡‡ç”¨çš„æ˜¯æœ€ä¼˜å‚æ•°æƒ…å†µä¸‹çš„åˆ†ç±»å™¨ã€‚è¿™é‡Œä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬ç”¨ sklearn è‡ªå¸¦çš„ IRIS æ•°æ®é›†ï¼Œé‡‡ç”¨éšæœºæ£®æ—å¯¹ IRIS æ•°æ®åˆ†ç±»ã€‚å‡è®¾æˆ‘ä»¬æƒ³çŸ¥é“ n_estimators åœ¨ 1-10 çš„èŒƒå›´å†…å–å“ªä¸ªå€¼çš„åˆ†ç±»ç»“æœæœ€å¥½ï¼Œå¯ä»¥ç¼–å†™ä»£ç ï¼š12345678910111213141516# -*- coding: utf-8 -*-# ä½¿ç”¨RandomForestå¯¹IRISæ•°æ®é›†è¿›è¡Œåˆ†ç±»# åˆ©ç”¨GridSearchCVå¯»æ‰¾æœ€ä¼˜å‚æ•°from sklearn.ensemble import RandomForestClassifierfrom sklearn.model_selection import GridSearchCVfrom sklearn.datasets import load_irisrf = RandomForestClassifier()parameters = &#123;\"n_estimators\": range(1,11)&#125;iris = load_iris()# ä½¿ç”¨GridSearchCVè¿›è¡Œå‚æ•°è°ƒä¼˜clf = GridSearchCV(estimator=rf, param_grid=parameters)# å¯¹irisæ•°æ®é›†è¿›è¡Œåˆ†ç±»clf.fit(iris.data, iris.target)print(\"æœ€ä¼˜åˆ†æ•°ï¼š %.4lf\" %clf.best_score_)print(\"æœ€ä¼˜å‚æ•°ï¼š\", clf.best_params_)123è¿è¡Œç»“æœå¦‚ä¸‹ï¼šæœ€ä¼˜åˆ†æ•°ï¼š 0.9667æœ€ä¼˜å‚æ•°ï¼š &#123;'n_estimators': 6&#125;ä½ èƒ½çœ‹åˆ°å½“æˆ‘ä»¬é‡‡ç”¨éšæœºæ£®æ—ä½œä¸ºåˆ†ç±»å™¨çš„æ—¶å€™ï¼Œæœ€ä¼˜å‡†ç¡®ç‡æ˜¯ 0.9667ï¼Œå½“ n_estimators=6 çš„æ—¶å€™ï¼Œæ˜¯æœ€ä¼˜å‚æ•°ï¼Œä¹Ÿå°±æ˜¯éšæœºæ£®æ—ä¸€å…±æœ‰ 6 ä¸ªå­å†³ç­–æ ‘ã€‚ä½¿ç”¨ Pipeline ç®¡é“æœºåˆ¶è¿›è¡Œæµæ°´çº¿ä½œä¸šåšåˆ†ç±»çš„æ—¶å€™å¾€å¾€éƒ½æ˜¯æœ‰æ­¥éª¤çš„ï¼Œæ¯”å¦‚å…ˆå¯¹æ•°æ®è¿›è¡Œè§„èŒƒåŒ–å¤„ç†ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ PCA æ–¹æ³•ï¼ˆä¸€ç§å¸¸ç”¨çš„é™ç»´æ–¹æ³•ï¼‰å¯¹æ•°æ®é™ç»´ï¼Œæœ€åä½¿ç”¨åˆ†ç±»å™¨åˆ†ç±»ã€‚Python æœ‰ä¸€ç§ Pipeline ç®¡é“æœºåˆ¶ã€‚ç®¡é“æœºåˆ¶å°±æ˜¯è®©æˆ‘ä»¬æŠŠæ¯ä¸€æ­¥éƒ½æŒ‰é¡ºåºåˆ—ä¸‹æ¥ï¼Œä»è€Œåˆ›å»º Pipeline æµæ°´çº¿ä½œä¸šã€‚æ¯ä¸€æ­¥éƒ½é‡‡ç”¨ (â€˜åç§°â€™, æ­¥éª¤) çš„æ–¹å¼æ¥è¡¨ç¤ºã€‚æˆ‘ä»¬éœ€è¦å…ˆé‡‡ç”¨ StandardScaler æ–¹æ³•å¯¹æ•°æ®è§„èŒƒåŒ–ï¼Œå³é‡‡ç”¨æ•°æ®è§„èŒƒåŒ–ä¸ºå‡å€¼ä¸º 0ï¼Œæ–¹å·®ä¸º 1 çš„æ­£æ€åˆ†å¸ƒï¼Œç„¶åé‡‡ç”¨ PCA æ–¹æ³•å¯¹æ•°æ®è¿›è¡Œé™ç»´ï¼Œæœ€åé‡‡ç”¨éšæœºæ£®æ—è¿›è¡Œåˆ†ç±»ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š1234567from sklearn.model_selection import GridSearchCVpipeline = Pipeline([ ('scaler', StandardScaler()), ('pca', PCA()), ('randomforestclassifier', RandomForestClassifier())])é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨é‡‡ç”¨ Pipeline ç®¡é“æœºåˆ¶ï¼Œç”¨éšæœºæ£®æ—å¯¹ IRIS æ•°æ®é›†åšä¸€ä¸‹åˆ†ç±»ã€‚å…ˆç”¨ StandardScaler æ–¹æ³•å¯¹æ•°æ®è§„èŒƒåŒ–ï¼Œç„¶åå†ç”¨éšæœºæ£®æ—åˆ†ç±»ï¼Œç¼–å†™ä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718192021# -*- coding: utf-8 -*-# ä½¿ç”¨RandomForestå¯¹IRISæ•°æ®é›†è¿›è¡Œåˆ†ç±»# åˆ©ç”¨GridSearchCVå¯»æ‰¾æœ€ä¼˜å‚æ•°,ä½¿ç”¨Pipelineè¿›è¡Œæµæ°´ä½œä¸šfrom sklearn.ensemble import RandomForestClassifierfrom sklearn.model_selection import GridSearchCVfrom sklearn.datasets import load_irisfrom sklearn.preprocessing import StandardScalerfrom sklearn.pipeline import Pipelinerf = RandomForestClassifier()parameters = &#123;\"randomforestclassifier__n_estimators\": range(1,11)&#125;iris = load_iris()pipeline = Pipeline([ ('scaler', StandardScaler()), ('randomforestclassifier', rf)])# ä½¿ç”¨GridSearchCVè¿›è¡Œå‚æ•°è°ƒä¼˜clf = GridSearchCV(estimator=pipeline, param_grid=parameters)# å¯¹irisæ•°æ®é›†è¿›è¡Œåˆ†ç±»clf.fit(iris.data, iris.target)print(\"æœ€ä¼˜åˆ†æ•°ï¼š %.4lf\" %clf.best_score_)print(\"æœ€ä¼˜å‚æ•°ï¼š\", clf.best_params_)123è¿è¡Œç»“æœï¼šæœ€ä¼˜åˆ†æ•°ï¼š 0.9667æœ€ä¼˜å‚æ•°ï¼š &#123;'randomforestclassifier__n_estimators': 9&#125;ä½ èƒ½çœ‹åˆ°æ˜¯å¦é‡‡ç”¨æ•°æ®è§„èŒƒåŒ–å¯¹ç»“æœè¿˜æ˜¯æœ‰ä¸€äº›å½±å“çš„ï¼Œæœ‰äº† GridSearchCV å’Œ Pipeline è¿™ä¸¤ä¸ªå·¥å…·ä¹‹åï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨åˆ†ç±»å™¨çš„æ—¶å€™å°±ä¼šæ–¹ä¾¿å¾ˆå¤šã€‚å¯¹ä¿¡ç”¨å¡è¿çº¦ç‡è¿›è¡Œåˆ†ææˆ‘ä»¬ç°åœ¨æ¥åšä¸€ä¸ªä¿¡ç”¨å¡è¿çº¦ç‡çš„é¡¹ç›®ï¼Œè¿™ä¸ªæ•°æ®é›†ä½ å¯ä»¥ä» GitHub ä¸Šä¸‹è½½ï¼šhttps://github.com/cystanford/credit_defaultã€‚è¿™ä¸ªæ•°æ®é›†æ˜¯å°æ¹¾æŸé“¶è¡Œ 2005 å¹´ 4 æœˆåˆ° 9 æœˆçš„ä¿¡ç”¨å¡æ•°æ®ï¼Œæ•°æ®é›†ä¸€å…±åŒ…æ‹¬ 25 ä¸ªå­—æ®µï¼Œå…·ä½“å«ä¹‰å¦‚ä¸‹ï¼šç°åœ¨æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è¦é’ˆå¯¹è¿™ä¸ªæ•°æ®é›†æ„å»ºä¸€ä¸ªåˆ†æä¿¡ç”¨å¡è¿çº¦ç‡çš„åˆ†ç±»å™¨ã€‚å…·ä½“é€‰æ‹©å“ªä¸ªåˆ†ç±»å™¨ï¼Œä»¥åŠåˆ†ç±»å™¨çš„å‚æ•°å¦‚ä½•ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ GridSearchCV è¿™ä¸ªå·¥å…·è·‘ä¸€éã€‚å…ˆæ¢³ç†ä¸‹æ•´ä¸ªé¡¹ç›®çš„æµç¨‹ï¼šåŠ è½½æ•°æ®ï¼›å‡†å¤‡é˜¶æ®µï¼šæ¢ç´¢æ•°æ®ï¼Œé‡‡ç”¨æ•°æ®å¯è§†åŒ–æ–¹å¼å¯ä»¥è®©æˆ‘ä»¬å¯¹æ•°æ®æœ‰æ›´ç›´è§‚çš„äº†è§£ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦äº†è§£ä¿¡ç”¨å¡è¿çº¦ç‡å’Œä¸è¿çº¦ç‡çš„äººæ•°ã€‚å› ä¸ºæ•°æ®é›†æ²¡æœ‰ä¸“é—¨çš„æµ‹è¯•é›†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨ train_test_split åˆ’åˆ†æ•°æ®é›†ã€‚åˆ†ç±»é˜¶æ®µï¼šä¹‹æ‰€ä»¥æŠŠæ•°æ®è§„èŒƒåŒ–æ”¾åˆ°è¿™ä¸ªé˜¶æ®µï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Pipeline ç®¡é“æœºåˆ¶ï¼Œå°†æ•°æ®è§„èŒƒåŒ–è®¾ç½®ä¸ºç¬¬ä¸€æ­¥ï¼Œåˆ†ç±»ä¸ºç¬¬äºŒæ­¥ã€‚å› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“é‡‡ç”¨å“ªä¸ªåˆ†ç±»å™¨æ•ˆæœå¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¤šç”¨å‡ ä¸ªåˆ†ç±»å™¨ï¼Œæ¯”å¦‚ SVMã€å†³ç­–æ ‘ã€éšæœºæ£®æ—å’Œ KNNã€‚ç„¶åé€šè¿‡ GridSearchCV å·¥å…·ï¼Œæ‰¾åˆ°æ¯ä¸ªåˆ†ç±»å™¨çš„æœ€ä¼˜å‚æ•°å’Œæœ€ä¼˜åˆ†æ•°ï¼Œæœ€ç»ˆæ‰¾åˆ°æœ€é€‚åˆè¿™ä¸ªé¡¹ç›®çš„åˆ†ç±»å™¨å’Œè¯¥åˆ†ç±»å™¨çš„å‚æ•°ã€‚åŸºäºä¸Šé¢çš„æµç¨‹ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108import matplotlibimport pandas as pdfrom matplotlib import pyplot as pltimport seaborn as snsfrom sklearn.ensemble import RandomForestClassifierfrom sklearn.metrics import accuracy_scorefrom sklearn.model_selection import train_test_split, GridSearchCV# æ„é€ å„ç§åˆ†ç±»å™¨from sklearn.neighbors import KNeighborsClassifierfrom sklearn.pipeline import Pipelinefrom sklearn.preprocessing import StandardScalerfrom sklearn.svm import SVCfrom sklearn.tree import DecisionTreeClassifierclassifiers = [ SVC(random_state = 1, kernel = 'rbf'), DecisionTreeClassifier(random_state = 1, criterion = 'gini'), RandomForestClassifier(random_state = 1, criterion = 'gini'), KNeighborsClassifier(metric = 'minkowski'),]# åˆ†ç±»å™¨åç§°classifier_names = [ 'svc', 'decisiontreeclassifier', 'randomforestclassifier', 'kneighborsclassifier',]# åˆ†ç±»å™¨å‚æ•°classifier_param_grid = [ &#123;'svc__C':[1], 'svc__gamma':[0.01]&#125;, &#123;'decisiontreeclassifier__max_depth':[6,9,11]&#125;, &#123;'randomforestclassifier__n_estimators':[3,5,6]&#125; , &#123;'kneighborsclassifier__n_neighbors':[4,6,8]&#125;,]# å¯¹å…·ä½“çš„åˆ†ç±»å™¨è¿›è¡ŒGridSearchCVå‚æ•°è°ƒä¼˜def GridSearchCV_work(pipeline, train_x, train_y, test_x, test_y, param_grid, score = 'accuracy'): response = &#123;&#125; gridsearch = GridSearchCV(estimator = pipeline, param_grid = param_grid, scoring = score) # å¯»æ‰¾æœ€ä¼˜çš„å‚æ•° å’Œæœ€ä¼˜çš„å‡†ç¡®ç‡åˆ†æ•° search = gridsearch.fit(train_x, train_y) print(\"GridSearchæœ€ä¼˜å‚æ•°ï¼š\", search.best_params_) print(\"GridSearchæœ€ä¼˜åˆ†æ•°ï¼š %0.4lf\" %search.best_score_) predict_y = gridsearch.predict(test_x) print(\"å‡†ç¡®ç‡ %0.4lf\" %accuracy_score(test_y, predict_y)) response['predict_y'] = predict_y response['accuracy_score'] = accuracy_score(test_y,predict_y) return responsedef get_data(): data = pd.read_csv('UCI_Credit_Card.csv') # æ•°æ®æ¡æ•°å’Œå­—æ®µæ•°é‡ print(data.shape) # æ•°æ®æ¢ç´¢ print(data.describe) return datadef show_data(data): # æŸ¥çœ‹ä¸‹ä¸€ä¸ªæœˆçš„è¿çº¦ç‡ next_month = data['default.payment.next.month'].value_counts() print(next_month) # ç»Ÿè®¡è¿çº¦ç‡ç»“æœ df = pd.DataFrame(&#123;'default.payment.next.month': next_month.index, 'values': next_month.values&#125;) print(df) # æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡æ ‡ç­¾ # plt.rcParams['font.sans-serif'] = ['FangSong'] # ç”¨æ¥æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡æ ‡ç­¾ plt.rcParams[\"font.family\"] = 'Arial Unicode MS' plt.figure(figsize=(6, 6)) plt.title('ä¿¡ç”¨å¡è¿çº¦ç‡å®¢æˆ· (è¿çº¦ï¼š1ï¼Œå®ˆçº¦ï¼š0)') sns.set_color_codes('pastel') sns.barplot(x='default.payment.next.month', y=\"values\", data=df) locs, labels = plt.xticks() plt.show()def get_feature(data): # ç‰¹å¾é€‰æ‹©ï¼Œå»æ‰IDå­—æ®µã€æœ€åä¸€ä¸ªç»“æœå­—æ®µå³å¯ data.drop(['ID'], inplace=True, axis=1) # IDè¿™ä¸ªå­—æ®µæ²¡æœ‰ç”¨ target = data['default.payment.next.month'].values columns = data.columns.tolist() columns.remove('default.payment.next.month') features = data[columns].values return features, targetdef main(): data = get_data() show_data(data) features, target = get_feature(data) # 30%ä½œä¸ºæµ‹è¯•é›†ï¼Œå…¶ä½™ä½œä¸ºè®­ç»ƒé›† train_x, test_x, train_y, test_y = train_test_split(features, target, test_size=0.30, stratify = target, random_state = 1) for model, model_name, model_param_grid in zip(classifiers, classifier_names, classifier_param_grid): pipeline = Pipeline([ ('scaler', StandardScaler()), (model_name, model) ]) result = GridSearchCV_work(pipeline, train_x, train_y, test_x, test_y, model_param_grid, score='accuracy')if __name__ == '__main__': main()ç»“æœï¼š1234567891011121314151617181920212223242526272829303132(30000, 25)&lt;bound method NDFrame.describe of ID LIMIT_BAL SEX ... PAY_AMT5 PAY_AMT6 default.payment.next.month0 1 20000.0 2 ... 0.0 0.0 11 2 120000.0 2 ... 0.0 2000.0 12 3 90000.0 2 ... 1000.0 5000.0 03 4 50000.0 2 ... 1069.0 1000.0 04 5 50000.0 1 ... 689.0 679.0 0 ... ... ... ... ... ... ...29995 29996 220000.0 1 ... 5000.0 1000.0 029996 29997 150000.0 1 ... 0.0 0.0 029997 29998 30000.0 1 ... 2000.0 3100.0 129998 29999 80000.0 1 ... 52964.0 1804.0 129999 30000 50000.0 1 ... 1000.0 1000.0 1[30000 rows x 25 columns]&gt;0 233641 6636Name: default.payment.next.month, dtype: int64 default.payment.next.month values0 0 233641 1 6636GridSearchæœ€ä¼˜å‚æ•°ï¼š &#123;'svc__C': 1, 'svc__gamma': 0.01&#125;GridSearchæœ€ä¼˜åˆ†æ•°ï¼š 0.8186å‡†ç¡®ç‡ 0.8172GridSearchæœ€ä¼˜å‚æ•°ï¼š &#123;'decisiontreeclassifier__max_depth': 6&#125;GridSearchæœ€ä¼˜åˆ†æ•°ï¼š 0.8208å‡†ç¡®ç‡ 0.8113GridSearchæœ€ä¼˜å‚æ•°ï¼š &#123;'randomforestclassifier__n_estimators': 6&#125;GridSearchæœ€ä¼˜åˆ†æ•°ï¼š 0.8004å‡†ç¡®ç‡ 0.7994GridSearchæœ€ä¼˜å‚æ•°ï¼š &#123;'kneighborsclassifier__n_neighbors': 8&#125;GridSearchæœ€ä¼˜åˆ†æ•°ï¼š 0.8040å‡†ç¡®ç‡ 0.8036ä»ç»“æœä¸­ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ° SVM åˆ†ç±»å™¨çš„å‡†ç¡®ç‡æœ€é«˜ï¼Œæµ‹è¯•å‡†ç¡®ç‡ä¸º 0.8172ã€‚åœ¨å†³ç­–æ ‘åˆ†ç±»ä¸­ï¼Œæˆ‘è®¾ç½®äº† 3 ç§æœ€å¤§æ·±åº¦ï¼Œå½“æœ€å¤§æ·±åº¦ =6 æ—¶ç»“æœæœ€ä¼˜ï¼Œæµ‹è¯•å‡†ç¡®ç‡ä¸º 0.8113ï¼›åœ¨éšæœºæ£®æ—åˆ†ç±»ä¸­ï¼Œæˆ‘è®¾ç½®äº† 3 ä¸ªå†³ç­–æ ‘ä¸ªæ•°çš„å–å€¼ï¼Œå–å€¼ä¸º 6 æ—¶ç»“æœæœ€ä¼˜ï¼Œæµ‹è¯•å‡†ç¡®ç‡ä¸º 0.7994ï¼›åœ¨ KNN åˆ†ç±»ä¸­ï¼Œæˆ‘è®¾ç½®äº† 3 ä¸ª n çš„å–å€¼ï¼Œå–å€¼ä¸º 8 æ—¶ç»“æœæœ€ä¼˜ï¼Œæµ‹è¯•å‡†ç¡®ç‡ä¸º 0.8036ã€‚æ€»ç»“ä»Šå¤©æˆ‘ç»™ä½ è®²äº†éšæœºæ£®æ—çš„æ¦‚å¿µåŠå·¥å…·çš„ä½¿ç”¨ï¼Œå¦å¤–é’ˆå¯¹æ•°æ®æŒ–æ˜ç®—æ³•ä¸­ç»å¸¸é‡‡ç”¨çš„å‚æ•°è°ƒä¼˜ï¼Œä¹Ÿä»‹ç»äº† GridSearchCV å·¥å…·è¿™ä¸ªåˆ©å™¨ã€‚å¹¶å°†è¿™ä¸¤è€…ç»“åˆèµ·æ¥ï¼Œåœ¨ä¿¡ç”¨å¡è¿çº¦åˆ†æè¿™ä¸ªé¡¹ç›®ä¸­è¿›è¡Œäº†ä½¿ç”¨ã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¸çŸ¥é“è¯¥é‡‡ç”¨å“ªç§åˆ†ç±»ç®—æ³•æ›´é€‚åˆã€‚å³ä¾¿æ˜¯å¯¹äºä¸€ç§åˆ†ç±»ç®—æ³•ï¼Œä¹Ÿæœ‰å¾ˆå¤šå‚æ•°å¯ä»¥è°ƒä¼˜ï¼Œæ¯ä¸ªå‚æ•°éƒ½æœ‰ä¸€å®šçš„å–å€¼èŒƒå›´ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæƒ³è¦é‡‡ç”¨çš„åˆ†ç±»å™¨ï¼Œä»¥åŠè¿™äº›å‚æ•°çš„å–å€¼èŒƒå›´éƒ½è®¾ç½®åˆ°æ•°ç»„é‡Œï¼Œç„¶åä½¿ç”¨ GridSearchCV å·¥å…·è¿›è¡Œè°ƒä¼˜ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Random Forest","slug":"Random-Forest","permalink":"cpeixin.cn/tags/Random-Forest/"}]},{"title":"æ•°æ®åˆ†æ - PageRank å®æˆ˜","slug":"æ•°æ®åˆ†æ - PageRank-å®æˆ˜","date":"2018-09-12T16:17:42.000Z","updated":"2020-05-01T14:20:06.568Z","comments":true,"path":"2018/09/13/æ•°æ®åˆ†æ - PageRank-å®æˆ˜/","link":"","permalink":"cpeixin.cn/2018/09/13/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%20-%20PageRank-%E5%AE%9E%E6%88%98/","excerpt":"","text":"ä¸Šæ–‡è®²äº† PageRank ç®—æ³•ç»å¸¸è¢«ç”¨åˆ°ç½‘ç»œå…³ç³»çš„åˆ†æä¸­ï¼Œæ¯”å¦‚åœ¨ç¤¾äº¤ç½‘ç»œä¸­è®¡ç®—ä¸ªäººçš„å½±å“åŠ›ï¼Œè®¡ç®—è®ºæ–‡çš„å½±å“åŠ›æˆ–è€…ç½‘ç«™çš„å½±å“åŠ›ç­‰ã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥åšä¸€ä¸ªå…³äº PageRank ç®—æ³•çš„å®æˆ˜ï¼Œåœ¨è¿™ä¹‹å‰ï¼Œä½ éœ€è¦æ€è€ƒä¸‰ä¸ªé—®é¢˜ï¼šå¦‚ä½•ä½¿ç”¨å·¥å…·å®Œæˆ PageRank ç®—æ³•ï¼ŒåŒ…æ‹¬ä½¿ç”¨å·¥å…·åˆ›å»ºç½‘ç»œå›¾ï¼Œè®¾ç½®èŠ‚ç‚¹ã€è¾¹ã€æƒé‡ç­‰ï¼Œå¹¶é€šè¿‡åˆ›å»ºå¥½çš„ç½‘ç»œå›¾è®¡ç®—èŠ‚ç‚¹çš„ PR å€¼ï¼›å¯¹äºä¸€ä¸ªå®é™…çš„é¡¹ç›®ï¼Œæ¯”å¦‚å¸Œæ‹‰é‡Œçš„ 9306 å°é‚®ä»¶ï¼ˆå·¥å…·åŒ…ä¸­é‚®ä»¶çš„æ•°é‡ï¼‰ï¼Œå¦‚ä½•ä½¿ç”¨ PageRank ç®—æ³•æŒ–æ˜å‡ºæœ‰å½±å“åŠ›çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”ç»˜åˆ¶ç½‘ç»œå›¾ï¼›å¦‚ä½•å¯¹åˆ›å»ºå¥½çš„ç½‘ç»œå›¾è¿›è¡Œå¯è§†åŒ–ï¼Œå¦‚æœç½‘ç»œä¸­çš„èŠ‚ç‚¹æ•°è¾ƒå¤šï¼Œå¦‚ä½•ç­›é€‰é‡è¦çš„èŠ‚ç‚¹è¿›è¡Œå¯è§†åŒ–ï¼Œä»è€Œå¾—åˆ°ç²¾ç®€çš„ç½‘ç»œå…³ç³»å›¾ã€‚å¦‚ä½•ä½¿ç”¨å·¥å…·å®ç° PageRank ç®—æ³•PageRank ç®—æ³•å·¥å…·åœ¨ sklearn ä¸­å¹¶ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ–°çš„å·¥å…·åŒ…ã€‚å®é™…ä¸Šæœ‰ä¸€ä¸ªå…³äºå›¾è®ºå’Œç½‘ç»œå»ºæ¨¡çš„å·¥å…·å« NetworkXï¼Œå®ƒæ˜¯ç”¨ Python è¯­è¨€å¼€å‘çš„å·¥å…·ï¼Œå†…ç½®äº†å¸¸ç”¨çš„å›¾ä¸ç½‘ç»œåˆ†æç®—æ³•ï¼Œå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œç½‘ç»œæ•°æ®åˆ†æã€‚ä¸ŠèŠ‚è¯¾ï¼Œæˆ‘ä¸¾äº†ä¸€ä¸ªç½‘é¡µæƒé‡çš„ä¾‹å­ï¼Œå‡è®¾ä¸€å…±æœ‰ 4 ä¸ªç½‘é¡µ Aã€Bã€Cã€Dï¼Œå®ƒä»¬ä¹‹é—´çš„é“¾æ¥ä¿¡æ¯å¦‚å›¾æ‰€ç¤ºï¼šé’ˆå¯¹è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çœ‹ä¸‹ç”¨ NetworkX å¦‚ä½•è®¡ç®— Aã€Bã€Cã€D å››ä¸ªç½‘é¡µçš„ PR å€¼ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š123456789import networkx as nx# åˆ›å»ºæœ‰å‘å›¾G = nx.DiGraph() # æœ‰å‘å›¾ä¹‹é—´è¾¹çš„å…³ç³»edges = [(\"A\", \"B\"), (\"A\", \"C\"), (\"A\", \"D\"), (\"B\", \"A\"), (\"B\", \"D\"), (\"C\", \"A\"), (\"D\", \"B\"), (\"D\", \"C\")]for edge in edges: G.add_edge(edge[0], edge[1])pagerank_list = nx.pagerank(G, alpha=1)print(\"pagerankå€¼æ˜¯ï¼š\", pagerank_list)ç»“æœï¼š1pagerankå€¼æ˜¯ï¼š &#123;&#39;A&#39;: 0.33333396911621094, &#39;B&#39;: 0.22222201029459634, &#39;C&#39;: 0.22222201029459634, &#39;D&#39;: 0.22222201029459634&#125;æˆ‘ä»¬é€šè¿‡ NetworkX åˆ›å»ºäº†ä¸€ä¸ªæœ‰å‘å›¾ä¹‹åï¼Œè®¾ç½®äº†èŠ‚ç‚¹ä¹‹é—´çš„è¾¹ï¼Œç„¶åä½¿ç”¨ PageRank å‡½æ•°å°±å¯ä»¥æ±‚å¾—èŠ‚ç‚¹çš„ PR å€¼ï¼Œç»“æœå’Œä¸ŠèŠ‚è¯¾ä¸­æˆ‘ä»¬äººå·¥æ¨¡æ‹Ÿçš„ç»“æœä¸€è‡´ã€‚å¥½äº†ï¼Œè¿è¡Œå®Œè¿™ä¸ªä¾‹å­ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ NetworkX å·¥å…·éƒ½æœ‰å“ªäº›å¸¸ç”¨çš„æ“ä½œã€‚1. å…³äºå›¾çš„åˆ›å»ºå›¾å¯ä»¥åˆ†ä¸ºæ— å‘å›¾å’Œæœ‰å‘å›¾ï¼Œåœ¨ NetworkX ä¸­åˆ†åˆ«é‡‡ç”¨ä¸åŒçš„å‡½æ•°è¿›è¡Œåˆ›å»ºã€‚æ— å‘å›¾æŒ‡çš„æ˜¯ä¸ç”¨èŠ‚ç‚¹ä¹‹é—´çš„è¾¹çš„æ–¹å‘ï¼Œä½¿ç”¨ nx.Graph() è¿›è¡Œåˆ›å»ºï¼›æœ‰å‘å›¾æŒ‡çš„æ˜¯èŠ‚ç‚¹ä¹‹é—´çš„è¾¹æ˜¯æœ‰æ–¹å‘çš„ï¼Œä½¿ç”¨ nx.DiGraph() æ¥åˆ›å»ºã€‚åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œå­˜åœ¨ Aâ†’D çš„è¾¹ï¼Œä½†ä¸å­˜åœ¨ Dâ†’A çš„è¾¹ã€‚2. å…³äºèŠ‚ç‚¹çš„å¢åŠ ã€åˆ é™¤å’ŒæŸ¥è¯¢å¦‚æœæƒ³åœ¨ç½‘ç»œä¸­å¢åŠ èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ G.add_node(â€˜Aâ€™) æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ G.add_nodes_from([â€˜Bâ€™,â€˜Câ€™,â€˜Dâ€™,â€˜Eâ€™]) æ·»åŠ èŠ‚ç‚¹é›†åˆã€‚å¦‚æœæƒ³è¦åˆ é™¤èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ G.remove_node(node) åˆ é™¤ä¸€ä¸ªæŒ‡å®šçš„èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ G.remove_nodes_from([â€˜Bâ€™,â€˜Câ€™,â€˜Dâ€™,â€˜Eâ€™]) åˆ é™¤é›†åˆä¸­çš„èŠ‚ç‚¹ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•æŸ¥è¯¢èŠ‚ç‚¹å‘¢ï¼Ÿå¦‚æœä½ æƒ³è¦å¾—åˆ°å›¾ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œå°±å¯ä»¥ä½¿ç”¨ G.nodes()ï¼Œä¹Ÿå¯ä»¥ç”¨ G.number_of_nodes() å¾—åˆ°å›¾ä¸­èŠ‚ç‚¹çš„ä¸ªæ•°ã€‚3. å…³äºè¾¹çš„å¢åŠ ã€åˆ é™¤ã€æŸ¥è¯¢å¢åŠ è¾¹ä¸æ·»åŠ èŠ‚ç‚¹çš„æ–¹å¼ç›¸åŒï¼Œä½¿ç”¨ G.add_edge(â€œAâ€, â€œBâ€) æ·»åŠ æŒ‡å®šçš„â€œä» A åˆ° Bâ€çš„è¾¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ add_edges_from å‡½æ•°ä»è¾¹é›†åˆä¸­æ·»åŠ ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åšä¸€ä¸ªåŠ æƒå›¾ï¼Œä¹Ÿå°±æ˜¯è¯´è¾¹æ˜¯å¸¦æœ‰æƒé‡çš„ï¼Œä½¿ç”¨ add_weighted_edges_from å‡½æ•°ä»å¸¦æœ‰æƒé‡çš„è¾¹çš„é›†åˆä¸­æ·»åŠ ã€‚åœ¨è¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¸­æ¥æ”¶çš„æ˜¯ 1 ä¸ªæˆ–å¤šä¸ªä¸‰å…ƒç»„[u,v,w]ä½œä¸ºå‚æ•°ï¼Œuã€vã€w åˆ†åˆ«ä»£è¡¨èµ·ç‚¹ã€ç»ˆç‚¹å’Œæƒé‡ã€‚å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ remove_edge å‡½æ•°å’Œ remove_edges_from å‡½æ•°åˆ é™¤æŒ‡å®šè¾¹å’Œä»è¾¹é›†åˆä¸­åˆ é™¤ã€‚å¦å¤–å¯ä»¥ä½¿ç”¨ edges() å‡½æ•°è®¿é—®å›¾ä¸­æ‰€æœ‰çš„è¾¹ï¼Œä½¿ç”¨ number_of_edges() å‡½æ•°å¾—åˆ°å›¾ä¸­è¾¹çš„ä¸ªæ•°ã€‚ä»¥ä¸Šæ˜¯å…³äºå›¾çš„åŸºæœ¬æ“ä½œï¼Œå¦‚æœæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå›¾ï¼Œå¹¶ä¸”å¯¹èŠ‚ç‚¹å’Œè¾¹è¿›è¡Œäº†è®¾ç½®ï¼Œå°±å¯ä»¥æ‰¾åˆ°å…¶ä¸­æœ‰å½±å“åŠ›çš„èŠ‚ç‚¹ï¼ŒåŸç†å°±æ˜¯é€šè¿‡ PageRank ç®—æ³•ï¼Œä½¿ç”¨ nx.pagerank(G) è¿™ä¸ªå‡½æ•°ï¼Œå‡½æ•°ä¸­çš„å‚æ•° G ä»£è¡¨åˆ›å»ºå¥½çš„å›¾ã€‚å¦‚ä½•ç”¨ PageRank æ­ç§˜å¸Œæ‹‰é‡Œé‚®ä»¶ä¸­çš„äººç‰©å…³ç³»äº†è§£äº† NetworkX å·¥å…·çš„åŸºç¡€ä½¿ç”¨ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®é™…çš„æ¡ˆä¾‹ï¼šå¸Œæ‹‰é‡Œé‚®ä»¶äººç‰©å…³ç³»åˆ†æã€‚å¸Œæ‹‰é‡Œé‚®ä»¶äº‹ä»¶ç›¸ä¿¡ä½ ä¹Ÿæœ‰è€³é—»ï¼Œå¯¹è¿™ä¸ªæ•°æ®çš„èƒŒæ™¯æˆ‘ä»¬å°±ä¸åšä»‹ç»äº†ã€‚ä½ å¯ä»¥ä» GitHub ä¸Šä¸‹è½½è¿™ä¸ªæ•°æ®é›†ï¼šhttps://github.com/cystanford/PageRankã€‚æ•´ä¸ªæ•°æ®é›†ç”±ä¸‰ä¸ªæ–‡ä»¶ç»„æˆï¼šAliases.csvï¼ŒEmails.csv å’Œ Persons.csvï¼Œå…¶ä¸­ Emails æ–‡ä»¶è®°å½•äº†æ‰€æœ‰å…¬å¼€é‚®ä»¶çš„å†…å®¹ï¼Œå‘é€è€…å’Œæ¥æ”¶è€…çš„ä¿¡æ¯ã€‚Persons è¿™ä¸ªæ–‡ä»¶ç»Ÿè®¡äº†é‚®ä»¶ä¸­æ‰€æœ‰äººç‰©çš„å§“ååŠå¯¹åº”çš„ IDã€‚å› ä¸ºå§“åå­˜åœ¨åˆ«åçš„æƒ…å†µï¼Œä¸ºäº†å°†é‚®ä»¶ä¸­çš„äººç‰©è¿›è¡Œç»Ÿä¸€ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç”¨ Aliases æ–‡ä»¶æ¥æŸ¥è¯¢åˆ«åå’Œäººç‰©çš„å¯¹åº”å…³ç³»ã€‚æ•´ä¸ªæ•°æ®é›†åŒ…æ‹¬äº† 9306 å°é‚®ä»¶å’Œ 513 ä¸ªäººåï¼Œæ•°æ®é›†è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ã€‚ä¸è¿‡è¿™ä¸€æ¬¡æˆ‘ä»¬ä¸éœ€è¦å¯¹é‚®ä»¶çš„å†…å®¹è¿›è¡Œåˆ†æï¼Œåªéœ€è¦é€šè¿‡é‚®ä»¶ä¸­çš„å‘é€è€…å’Œæ¥æ”¶è€…ï¼ˆå¯¹åº” Emails.csv æ–‡ä»¶ä¸­çš„ MetadataFrom å’Œ MetadataTo å­—æ®µï¼‰æ¥ç»˜åˆ¶æ•´ä¸ªå…³ç³»ç½‘ç»œã€‚å› ä¸ºæ¶‰åŠåˆ°çš„äººç‰©å¾ˆå¤šï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡ PageRank ç®—æ³•è®¡ç®—æ¯ä¸ªäººç‰©åœ¨é‚®ä»¶å…³ç³»ç½‘ç»œä¸­çš„æƒé‡ï¼Œæœ€åç­›é€‰å‡ºæ¥æœ€æœ‰ä»·å€¼çš„äººç‰©æ¥è¿›è¡Œå…³ç³»ç½‘ç»œå›¾çš„ç»˜åˆ¶ã€‚äº†è§£äº†æ•°æ®é›†å’Œé¡¹ç›®èƒŒæ™¯ä¹‹åï¼Œæˆ‘ä»¬æ¥è®¾è®¡åˆ°æ‰§è¡Œçš„æµç¨‹æ­¥éª¤ï¼šé¦–å…ˆæˆ‘ä»¬éœ€è¦åŠ è½½æ•°æ®æºï¼›åœ¨å‡†å¤‡é˜¶æ®µï¼šæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ¢ç´¢ï¼Œåœ¨æ•°æ®æ¸…æ´—è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºé‚®ä»¶ä¸­å­˜åœ¨åˆ«åçš„æƒ…å†µï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç»Ÿä¸€äººç‰©åç§°ã€‚å¦å¤–é‚®ä»¶çš„æ­£æ–‡å¹¶ä¸åœ¨æˆ‘ä»¬è€ƒè™‘çš„èŒƒå›´å†…ï¼Œåªç»Ÿè®¡é‚®ä»¶ä¸­çš„å‘é€è€…å’Œæ¥æ”¶è€…ï¼Œå› æ­¤æˆ‘ä»¬ç­›é€‰ MetadataFrom å’Œ MetadataTo è¿™ä¸¤ä¸ªå­—æ®µä½œä¸ºç‰¹å¾ã€‚åŒæ—¶ï¼Œå‘é€è€…å’Œæ¥æ”¶è€…å¯èƒ½å­˜åœ¨å¤šæ¬¡é‚®ä»¶å¾€æ¥ï¼Œéœ€è¦è®¾ç½®æƒé‡æ¥ç»Ÿè®¡ä¸¤äººé‚®ä»¶å¾€æ¥çš„æ¬¡æ•°ã€‚æ¬¡æ•°è¶Šå¤šä»£è¡¨è¿™ä¸ªè¾¹ï¼ˆä»å‘é€è€…åˆ°æ¥æ”¶è€…çš„è¾¹ï¼‰çš„æƒé‡è¶Šé«˜ï¼›åœ¨æŒ–æ˜é˜¶æ®µï¼šæˆ‘ä»¬ä¸»è¦æ˜¯å¯¹å·²ç»è®¾ç½®å¥½çš„ç½‘ç»œå›¾è¿›è¡Œ PR å€¼çš„è®¡ç®—ï¼Œä½†é‚®ä»¶ä¸­çš„äººç‰©æœ‰ 500 å¤šäººï¼Œæœ‰äº›äººçš„æƒé‡å¯èƒ½ä¸é«˜ï¼Œæˆ‘ä»¬éœ€è¦ç­›é€‰ PR å€¼é«˜çš„äººç‰©ï¼Œç»˜åˆ¶å‡ºä»–ä»¬ä¹‹é—´çš„å¾€æ¥å…³ç³»ã€‚åœ¨å¯è§†åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡èŠ‚ç‚¹çš„ PR å€¼æ¥ç»˜åˆ¶èŠ‚ç‚¹çš„å¤§å°ï¼ŒPR å€¼è¶Šå¤§ï¼ŒèŠ‚ç‚¹çš„ç»˜åˆ¶å°ºå¯¸è¶Šå¤§ã€‚è®¾ç½®å¥½æµç¨‹ä¹‹åï¼Œå®ç°çš„ä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283# -*- coding: utf-8 -*-# ç”¨ PageRank æŒ–æ˜å¸Œæ‹‰é‡Œé‚®ä»¶ä¸­çš„é‡è¦ä»»åŠ¡å…³ç³»import pandas as pdimport networkx as nximport numpy as npfrom collections import defaultdictimport matplotlib.pyplot as plt# æ•°æ®åŠ è½½emails = pd.read_csv(\"./input/Emails.csv\")# è¯»å–åˆ«åæ–‡ä»¶file = pd.read_csv(\"./input/Aliases.csv\")aliases = &#123;&#125;for index, row in file.iterrows(): aliases[row['Alias']] = row['PersonId']# è¯»å–äººåæ–‡ä»¶file = pd.read_csv(\"./input/Persons.csv\")persons = &#123;&#125;for index, row in file.iterrows(): persons[row['Id']] = row['Name']# é’ˆå¯¹åˆ«åè¿›è¡Œè½¬æ¢ def unify_name(name): # å§“åç»Ÿä¸€å°å†™ name = str(name).lower() # å»æ‰, å’Œ @åé¢çš„å†…å®¹ name = name.replace(\",\",\"\").split(\"@\")[0] # åˆ«åè½¬æ¢ if name in aliases.keys(): return persons[aliases[name]] return name# ç”»ç½‘ç»œå›¾def show_graph(graph, layout='spring_layout'): # ä½¿ç”¨ Spring Layout å¸ƒå±€ï¼Œç±»ä¼¼ä¸­å¿ƒæ”¾å°„çŠ¶ if layout == 'circular_layout': positions=nx.circular_layout(graph) else: positions=nx.spring_layout(graph) # è®¾ç½®ç½‘ç»œå›¾ä¸­çš„èŠ‚ç‚¹å¤§å°ï¼Œå¤§å°ä¸ pagerank å€¼ç›¸å…³ï¼Œå› ä¸º pagerank å€¼å¾ˆå°æ‰€ä»¥éœ€è¦ *20000 nodesize = [x['pagerank']*20000 for v,x in graph.nodes(data=True)] # è®¾ç½®ç½‘ç»œå›¾ä¸­çš„è¾¹é•¿åº¦ edgesize = [np.sqrt(e[2]['weight']) for e in graph.edges(data=True)] # ç»˜åˆ¶èŠ‚ç‚¹ nx.draw_networkx_nodes(graph, positions, node_size=nodesize, alpha=0.4) # ç»˜åˆ¶è¾¹ nx.draw_networkx_edges(graph, positions, edge_size=edgesize, alpha=0.2) # ç»˜åˆ¶èŠ‚ç‚¹çš„ label nx.draw_networkx_labels(graph, positions, font_size=10) # è¾“å‡ºå¸Œæ‹‰é‡Œé‚®ä»¶ä¸­çš„æ‰€æœ‰äººç‰©å…³ç³»å›¾ plt.show()# å°†å¯„ä»¶äººå’Œæ”¶ä»¶äººçš„å§“åè¿›è¡Œè§„èŒƒåŒ–emails.MetadataFrom = emails.MetadataFrom.apply(unify_name)emails.MetadataTo = emails.MetadataTo.apply(unify_name)# è®¾ç½®éçš„æƒé‡ç­‰äºå‘é‚®ä»¶çš„æ¬¡æ•°edges_weights_temp = defaultdict(list)for row in zip(emails.MetadataFrom, emails.MetadataTo, emails.RawText): temp = (row[0], row[1]) if temp not in edges_weights_temp: edges_weights_temp[temp] = 1 else: edges_weights_temp[temp] = edges_weights_temp[temp] + 1# è½¬åŒ–æ ¼å¼ (from, to), weight =&gt; from, to, weightedges_weights = [(key[0], key[1], val) for key, val in edges_weights_temp.items()]# åˆ›å»ºä¸€ä¸ªæœ‰å‘å›¾graph = nx.DiGraph()# è®¾ç½®æœ‰å‘å›¾ä¸­çš„è·¯å¾„åŠæƒé‡ (from, to, weight)graph.add_weighted_edges_from(edges_weights)# è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹ï¼ˆäººï¼‰çš„ PR å€¼ï¼Œå¹¶ä½œä¸ºèŠ‚ç‚¹çš„ pagerank å±æ€§pagerank = nx.pagerank(graph)# å°† pagerank æ•°å€¼ä½œä¸ºèŠ‚ç‚¹çš„å±æ€§nx.set_node_attributes(graph, name = 'pagerank', values=pagerank)# ç”»ç½‘ç»œå›¾show_graph(graph)# å°†å®Œæ•´çš„å›¾è°±è¿›è¡Œç²¾ç®€# è®¾ç½® PR å€¼çš„é˜ˆå€¼ï¼Œç­›é€‰å¤§äºé˜ˆå€¼çš„é‡è¦æ ¸å¿ƒèŠ‚ç‚¹pagerank_threshold = 0.005# å¤åˆ¶ä¸€ä»½è®¡ç®—å¥½çš„ç½‘ç»œå›¾small_graph = graph.copy()# å‰ªæ‰ PR å€¼å°äº pagerank_threshold çš„èŠ‚ç‚¹for n, p_rank in graph.nodes(data=True): if p_rank['pagerank'] &lt; pagerank_threshold: small_graph.remove_node(n)# ç”»ç½‘ç»œå›¾,é‡‡ç”¨circular_layoutå¸ƒå±€è®©ç­›é€‰å‡ºæ¥çš„ç‚¹ç»„æˆä¸€ä¸ªåœ†show_graph(small_graph, 'circular_layout')ç»“æœå¦‚ä¸‹ï¼šé’ˆå¯¹ä»£ç ä¸­çš„å‡ ä¸ªæ¨¡å—æˆ‘åšä¸ªç®€å•çš„è¯´æ˜ï¼š1. å‡½æ•°å®šä¹‰äººç‰©çš„åç§°éœ€è¦ç»Ÿä¸€ï¼Œå› æ­¤æˆ‘è®¾ç½®äº† unify_name å‡½æ•°ï¼ŒåŒæ—¶è®¾ç½®äº† show_graph å‡½æ•°å°†ç½‘ç»œå›¾å¯è§†åŒ–ã€‚NetworkX æä¾›äº†å¤šç§å¯è§†åŒ–å¸ƒå±€ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨ spring_layout å¸ƒå±€ï¼Œä¹Ÿå°±æ˜¯å‘ˆä¸­å¿ƒæ”¾å°„çŠ¶ã€‚é™¤äº† spring_layout å¤–ï¼ŒNetworkX è¿˜æœ‰å¦å¤–ä¸‰ç§å¯è§†åŒ–å¸ƒå±€ï¼Œcircular_layoutï¼ˆåœ¨ä¸€ä¸ªåœ†ç¯ä¸Šå‡åŒ€åˆ†å¸ƒèŠ‚ç‚¹ï¼‰ï¼Œrandom_layoutï¼ˆéšæœºåˆ†å¸ƒèŠ‚ç‚¹ ï¼‰ï¼Œshell_layoutï¼ˆèŠ‚ç‚¹éƒ½åœ¨åŒå¿ƒåœ†ä¸Šï¼‰ã€‚2. è®¡ç®—è¾¹æƒé‡é‚®ä»¶çš„å‘é€è€…å’Œæ¥æ”¶è€…çš„é‚®ä»¶å¾€æ¥å¯èƒ½ä¸æ­¢ä¸€æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ä¸¤è€…ä¹‹é—´é‚®ä»¶å¾€æ¥çš„æ¬¡æ•°è®¡ç®—è¿™ä¸¤è€…ä¹‹é—´è¾¹çš„æƒé‡ï¼Œæ‰€ä»¥æˆ‘ç”¨ edges_weights_temp æ•°ç»„å­˜å‚¨æƒé‡ã€‚è€Œä¸Šé¢ä»‹ç»è¿‡åœ¨ NetworkX ä¸­æ·»åŠ æƒé‡è¾¹ï¼ˆå³ä½¿ç”¨ add_weighted_edges_from å‡½æ•°ï¼‰çš„æ—¶å€™ï¼Œæ¥å—çš„æ˜¯ uã€vã€w çš„ä¸‰å…ƒæ•°ç»„ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦å¯¹æ ¼å¼è¿›è¡Œè½¬æ¢ï¼Œå…·ä½“è½¬æ¢æ–¹å¼è§ä»£ç ã€‚3.PR å€¼è®¡ç®—åŠç­›é€‰æˆ‘ä½¿ç”¨ nx.pagerank(graph) è®¡ç®—äº†èŠ‚ç‚¹çš„ PR å€¼ã€‚ç”±äºèŠ‚ç‚¹æ•°é‡å¾ˆå¤šï¼Œæˆ‘ä»¬è®¾ç½®äº† PR å€¼é˜ˆå€¼ï¼Œå³ pagerank_threshold=0.005ï¼Œç„¶åéå†èŠ‚ç‚¹ï¼Œåˆ é™¤å°äº PR å€¼é˜ˆå€¼çš„èŠ‚ç‚¹ï¼Œå½¢æˆæ–°çš„å›¾ small_graphï¼Œæœ€åå¯¹ small_graph è¿›è¡Œå¯è§†åŒ–ï¼ˆå¯¹åº”è¿è¡Œç»“æœçš„ç¬¬äºŒå¼ å›¾ï¼‰ã€‚æ€»ç»“æˆ‘ä»¬é€šè¿‡çŸ©é˜µä¹˜æ³•æ±‚å¾—ç½‘é¡µçš„æƒé‡ï¼Œè¿™æˆ‘ä»¬ä½¿ç”¨ NetworkX å¯ä»¥å¾—åˆ°ç›¸åŒçš„ç»“æœã€‚å¦å¤–æˆ‘å¸¦ä½ ç”¨ PageRank ç®—æ³•åšäº†ä¸€æ¬¡å®æˆ˜ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªå¤æ‚çš„ç½‘ç»œå›¾ï¼Œé€šè¿‡ PR å€¼çš„è®¡ç®—ã€ç­›é€‰ï¼Œæœ€ç»ˆå¾—åˆ°äº†ä¸€å¼ ç²¾ç®€çš„ç½‘ç»œå›¾ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬å­¦ä¹ äº† NetworkX å·¥å…·çš„ä½¿ç”¨ï¼ŒåŒ…æ‹¬åˆ›å»ºå›¾ã€èŠ‚ç‚¹ã€è¾¹åŠ PR å€¼çš„è®¡ç®—ã€‚å®é™…ä¸ŠæŒæ¡äº† PageRank çš„ç†è®ºä¹‹åï¼Œåœ¨å®æˆ˜ä¸­å¾€å¾€å°±æ˜¯ä¸€è¡Œä»£ç çš„äº‹ã€‚ä½†é¡¹ç›®ä¸ç†è®ºä¸åŒï¼Œé¡¹ç›®ä¸­æ¶‰åŠåˆ°çš„æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œä½ ä¼šèŠ± 80% çš„æ—¶é—´ï¼ˆæˆ– 80% çš„ä»£ç é‡ï¼‰åœ¨é¢„å¤„ç†è¿‡ç¨‹ä¸­ï¼Œæ¯”å¦‚ä»Šå¤©çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯¹åˆ«åè¿›è¡Œäº†ç»Ÿä¸€ï¼Œå¯¹è¾¹çš„æƒé‡è¿›è¡Œè®¡ç®—ï¼ŒåŒæ—¶è¿˜éœ€è¦æŠŠè®¡ç®—å¥½çš„ç»“æœä»¥å¯è§†åŒ–çš„æ–¹å¼å‘ˆç°ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"PageRank","slug":"PageRank","permalink":"cpeixin.cn/tags/PageRank/"}]},{"title":"PageRank åŸç†","slug":"æ•°æ®åˆ†æ - PageRank-åŸç†","date":"2018-09-10T14:37:25.000Z","updated":"2020-05-01T14:19:56.808Z","comments":true,"path":"2018/09/10/æ•°æ®åˆ†æ - PageRank-åŸç†/","link":"","permalink":"cpeixin.cn/2018/09/10/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%20-%20PageRank-%E5%8E%9F%E7%90%86/","excerpt":"","text":"äº’è”ç½‘å‘å±•åˆ°ç°åœ¨ï¼Œæœç´¢å¼•æ“å·²ç»éå¸¸å¥½ç”¨ï¼ŒåŸºæœ¬ä¸Šè¾“å…¥å…³é”®è¯ï¼Œéƒ½èƒ½æ‰¾åˆ°åŒ¹é…çš„å†…å®¹ï¼Œè´¨é‡è¿˜ä¸é”™ã€‚ä½†åœ¨ 1998 å¹´ä¹‹å‰ï¼Œæœç´¢å¼•æ“çš„ä½“éªŒå¹¶ä¸å¥½ã€‚æ—©æœŸçš„æœç´¢å¼•æ“ï¼Œä¼šé‡åˆ°ä¸‹é¢çš„ä¸¤ç±»é—®é¢˜ï¼šè¿”å›ç»“æœè´¨é‡ä¸é«˜ï¼šæœç´¢ç»“æœä¸è€ƒè™‘ç½‘é¡µçš„è´¨é‡ï¼Œè€Œæ˜¯é€šè¿‡æ—¶é—´é¡ºåºè¿›è¡Œæ£€ç´¢ï¼›å®¹æ˜“è¢«äººé’»ç©ºå­ï¼šæœç´¢å¼•æ“æ˜¯åŸºäºæ£€ç´¢è¯è¿›è¡Œæ£€ç´¢çš„ï¼Œé¡µé¢ä¸­æ£€ç´¢è¯å‡ºç°çš„é¢‘æ¬¡è¶Šé«˜ï¼ŒåŒ¹é…åº¦è¶Šé«˜ï¼Œè¿™æ ·å°±ä¼šå‡ºç°ç½‘é¡µä½œå¼Šçš„æƒ…å†µã€‚æœ‰äº›ç½‘é¡µä¸ºäº†å¢åŠ æœç´¢å¼•æ“çš„æ’åï¼Œæ•…æ„å¢åŠ æŸä¸ªæ£€ç´¢è¯çš„é¢‘ç‡ã€‚åŸºäºè¿™äº›ç¼ºé™·ï¼Œå½“æ—¶ Google çš„åˆ›å§‹äººæ‹‰é‡ŒÂ·ä½©å¥‡æå‡ºäº† PageRank ç®—æ³•ï¼Œç›®çš„å°±æ˜¯è¦æ‰¾åˆ°ä¼˜è´¨çš„ç½‘é¡µï¼Œè¿™æ · Google çš„æ’åºç»“æœä¸ä»…èƒ½æ‰¾åˆ°ç”¨æˆ·æƒ³è¦çš„å†…å®¹ï¼Œè€Œä¸”è¿˜ä¼šä»ä¼—å¤šç½‘é¡µä¸­ç­›é€‰å‡ºæƒé‡é«˜çš„å‘ˆç°ç»™ç”¨æˆ·ã€‚Google çš„ä¸¤ä½åˆ›å§‹äººéƒ½æ˜¯æ–¯å¦ç¦å¤§å­¦çš„åšå£«ç”Ÿï¼Œä»–ä»¬æå‡ºçš„ PageRank ç®—æ³•å—åˆ°äº†è®ºæ–‡å½±å“åŠ›å› å­çš„è¯„ä»·å¯å‘ã€‚å½“ä¸€ç¯‡è®ºæ–‡è¢«å¼•ç”¨çš„æ¬¡æ•°è¶Šå¤šï¼Œè¯æ˜è¿™ç¯‡è®ºæ–‡çš„å½±å“åŠ›è¶Šå¤§ã€‚æ­£æ˜¯è¿™ä¸ªæƒ³æ³•è§£å†³äº†å½“æ—¶ç½‘é¡µæ£€ç´¢è´¨é‡ä¸é«˜çš„é—®é¢˜ã€‚PageRank çš„ç®€åŒ–æ¨¡å‹æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ PageRank æ˜¯å¦‚ä½•è®¡ç®—çš„ã€‚æˆ‘å‡è®¾ä¸€å…±æœ‰ 4 ä¸ªç½‘é¡µ Aã€Bã€Cã€Dã€‚å®ƒä»¬ä¹‹é—´çš„é“¾æ¥ä¿¡æ¯å¦‚å›¾æ‰€ç¤ºï¼šè¿™é‡Œæœ‰ä¸¤ä¸ªæ¦‚å¿µä½ éœ€è¦äº†è§£ä¸€ä¸‹ã€‚å‡ºé“¾æŒ‡çš„æ˜¯é“¾æ¥å‡ºå»çš„é“¾æ¥ã€‚å…¥é“¾æŒ‡çš„æ˜¯é“¾æ¥è¿›æ¥çš„é“¾æ¥ã€‚æ¯”å¦‚å›¾ä¸­ A æœ‰ 2 ä¸ªå…¥é“¾ï¼Œ3 ä¸ªå‡ºé“¾ã€‚ç®€å•æ¥è¯´ï¼Œä¸€ä¸ªç½‘é¡µçš„å½±å“åŠ› = æ‰€æœ‰å…¥é“¾é›†åˆçš„é¡µé¢çš„åŠ æƒå½±å“åŠ›ä¹‹å’Œï¼Œç”¨å…¬å¼è¡¨ç¤ºä¸ºï¼šu ä¸ºå¾…è¯„ä¼°çš„é¡µé¢ï¼ŒBu ä¸ºé¡µé¢ u çš„å…¥é“¾é›†åˆã€‚é’ˆå¯¹å…¥é“¾é›†åˆä¸­çš„ä»»æ„é¡µé¢ vï¼Œå®ƒèƒ½ç»™ u å¸¦æ¥çš„å½±å“åŠ›æ˜¯å…¶è‡ªèº«çš„å½±å“åŠ› PR(v) é™¤ä»¥ v é¡µé¢çš„å‡ºé“¾æ•°é‡ï¼Œå³é¡µé¢ v æŠŠå½±å“åŠ› PR(v) å¹³å‡åˆ†é…ç»™äº†å®ƒçš„å‡ºé“¾ï¼Œè¿™æ ·ç»Ÿè®¡æ‰€æœ‰èƒ½ç»™ u å¸¦æ¥é“¾æ¥çš„é¡µé¢ vï¼Œå¾—åˆ°çš„æ€»å’Œå°±æ˜¯ç½‘é¡µ u çš„å½±å“åŠ›ï¼Œå³ä¸º PR(u)ã€‚æ‰€ä»¥ä½ èƒ½çœ‹åˆ°ï¼Œå‡ºé“¾ä¼šç»™è¢«é“¾æ¥çš„é¡µé¢èµ‹äºˆå½±å“åŠ›ï¼Œå½“æˆ‘ä»¬ç»Ÿè®¡äº†ä¸€ä¸ªç½‘é¡µé“¾å‡ºå»çš„æ•°é‡ï¼Œä¹Ÿå°±æ˜¯ç»Ÿè®¡äº†è¿™ä¸ªç½‘é¡µçš„è·³è½¬æ¦‚ç‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ èƒ½çœ‹åˆ° A æœ‰ä¸‰ä¸ªå‡ºé“¾åˆ†åˆ«é“¾æ¥åˆ°äº† Bã€Cã€D ä¸Šã€‚é‚£ä¹ˆå½“ç”¨æˆ·è®¿é—® A çš„æ—¶å€™ï¼Œå°±æœ‰è·³è½¬åˆ° Bã€C æˆ–è€… D çš„å¯èƒ½æ€§ï¼Œè·³è½¬æ¦‚ç‡å‡ä¸º 1/3ã€‚B æœ‰ä¸¤ä¸ªå‡ºé“¾ï¼Œé“¾æ¥åˆ°äº† A å’Œ D ä¸Šï¼Œè·³è½¬æ¦‚ç‡ä¸º 1/2ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° Aã€Bã€Cã€D è¿™å››ä¸ªç½‘é¡µçš„è½¬ç§»çŸ©é˜µ Mï¼šè½¬ç§»çŸ©é˜µè§£é‡Šï¼šç¬¬ä¸€åˆ—æ˜¯Açš„å‡ºé“¾çš„æ¦‚ç‡A-&gt;A: 0 A-&gt;B: 1/3 A-&gt;C: 1/3 A-&gt;D: 1/3ç¬¬äºŒåˆ—æ˜¯Bçš„çš„å‡ºé“¾çš„æ¦‚ç‡B-&gt;A: 1/2 B-&gt;B: 0 B-&gt;C:0 B-&gt;D: 1/2ç¬¬ä¸‰åˆ—æ˜¯Cçš„å‡ºé“¾æ¦‚ç‡C-&gt;A:1 C-&gt;B:0 C-&gt;C:0 C-&gt;D: 0ç¬¬å››åˆ—æ˜¯Dçš„å‡ºé“¾æ¦‚ç‡D-&gt;A: 0 D-&gt;B:1/2 D-&gt;C:1/2 D-&gt;D: 0æˆ‘ä»¬å‡è®¾ Aã€Bã€Cã€D å››ä¸ªé¡µé¢çš„åˆå§‹å½±å“åŠ›éƒ½æ˜¯ç›¸åŒçš„ï¼Œå³ï¼šå½“è¿›è¡Œç¬¬ä¸€æ¬¡è½¬ç§»ä¹‹åï¼Œå„é¡µé¢çš„å½±å“åŠ› w1 å˜ä¸ºï¼šç„¶åæˆ‘ä»¬å†ç”¨è½¬ç§»çŸ©é˜µä¹˜ä»¥ w1 å¾—åˆ° w2 ç»“æœï¼Œç›´åˆ°ç¬¬ n æ¬¡è¿­ä»£å wn å½±å“åŠ›ä¸å†å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥æ”¶æ•›åˆ° (0.3333ï¼Œ0.2222ï¼Œ0.2222ï¼Œ0.2222ï¼‰ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ç€ Aã€Bã€Cã€D å››ä¸ªé¡µé¢æœ€ç»ˆå¹³è¡¡çŠ¶æ€ä¸‹çš„å½±å“åŠ›ã€‚ä½ èƒ½çœ‹å‡º A é¡µé¢ç›¸æ¯”äºå…¶ä»–é¡µé¢æ¥è¯´æƒé‡æ›´å¤§ï¼Œä¹Ÿå°±æ˜¯ PR å€¼æ›´é«˜ã€‚è€Œ Bã€Cã€D é¡µé¢çš„ PR å€¼ç›¸ç­‰ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿäº†ä¸€ä¸ªç®€åŒ–çš„ PageRank çš„è®¡ç®—è¿‡ç¨‹ï¼Œå®é™…æƒ…å†µä¼šæ¯”è¿™ä¸ªå¤æ‚ï¼Œå¯èƒ½ä¼šé¢ä¸´ä¸¤ä¸ªé—®é¢˜ï¼š1. ç­‰çº§æ³„éœ²ï¼ˆRank Leakï¼‰ï¼šå¦‚æœä¸€ä¸ªç½‘é¡µæ²¡æœ‰å‡ºé“¾ï¼Œå°±åƒæ˜¯ä¸€ä¸ªé»‘æ´ä¸€æ ·ï¼Œå¸æ”¶äº†å…¶ä»–ç½‘é¡µçš„å½±å“åŠ›è€Œä¸é‡Šæ”¾ï¼Œæœ€ç»ˆä¼šå¯¼è‡´å…¶ä»–ç½‘é¡µçš„ PR å€¼ä¸º 0ã€‚2. ç­‰çº§æ²‰æ²¡ï¼ˆRank Sinkï¼‰ï¼šå¦‚æœä¸€ä¸ªç½‘é¡µåªæœ‰å‡ºé“¾ï¼Œæ²¡æœ‰å…¥é“¾ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ï¼Œè®¡ç®—çš„è¿‡ç¨‹è¿­ä»£ä¸‹æ¥ï¼Œä¼šå¯¼è‡´è¿™ä¸ªç½‘é¡µçš„ PR å€¼ä¸º 0ï¼ˆä¹Ÿå°±æ˜¯ä¸å­˜åœ¨å…¬å¼ä¸­çš„ Vï¼‰ã€‚é’ˆå¯¹ç­‰çº§æ³„éœ²å’Œç­‰çº§æ²‰æ²¡çš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦çµæ´»å¤„ç†ã€‚æ¯”å¦‚é’ˆå¯¹ç­‰çº§æ³„éœ²çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ²¡æœ‰å‡ºé“¾çš„èŠ‚ç‚¹ï¼Œå…ˆä»å›¾ä¸­å»æ‰ï¼Œç­‰è®¡ç®—å®Œæ‰€æœ‰èŠ‚ç‚¹çš„ PR å€¼ä¹‹åï¼Œå†åŠ ä¸Šè¯¥èŠ‚ç‚¹è¿›è¡Œè®¡ç®—ã€‚ä¸è¿‡è¿™ç§æ–¹æ³•ä¼šå¯¼è‡´æ–°çš„ç­‰çº§æ³„éœ²çš„èŠ‚ç‚¹çš„äº§ç”Ÿï¼Œæ‰€ä»¥å·¥ä½œé‡è¿˜æ˜¯å¾ˆå¤§çš„ã€‚æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥åŒæ—¶è§£å†³ç­‰çº§æ³„éœ²å’Œç­‰çº§æ²‰æ²¡è¿™ä¸¤ä¸ªé—®é¢˜å‘¢ï¼ŸPageRank çš„éšæœºæµè§ˆæ¨¡å‹ä¸ºäº†è§£å†³ç®€åŒ–æ¨¡å‹ä¸­å­˜åœ¨çš„ç­‰çº§æ³„éœ²å’Œç­‰çº§æ²‰æ²¡çš„é—®é¢˜ï¼Œæ‹‰é‡ŒÂ·ä½©å¥‡æå‡ºäº† PageRank çš„éšæœºæµè§ˆæ¨¡å‹ã€‚ä»–å‡è®¾äº†è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šç”¨æˆ·å¹¶ä¸éƒ½æ˜¯æŒ‰ç…§è·³è½¬é“¾æ¥çš„æ–¹å¼æ¥ä¸Šç½‘ï¼Œè¿˜æœ‰ä¸€ç§å¯èƒ½æ˜¯ä¸è®ºå½“å‰å¤„äºå“ªä¸ªé¡µé¢ï¼Œéƒ½æœ‰æ¦‚ç‡è®¿é—®åˆ°å…¶ä»–ä»»æ„çš„é¡µé¢ï¼Œæ¯”å¦‚è¯´ç”¨æˆ·å°±æ˜¯è¦ç›´æ¥è¾“å…¥ç½‘å€è®¿é—®å…¶ä»–é¡µé¢ï¼Œè™½ç„¶è¿™ä¸ªæ¦‚ç‡æ¯”è¾ƒå°ã€‚æ‰€ä»¥ä»–å®šä¹‰äº†é˜»å°¼å› å­ dï¼Œè¿™ä¸ªå› å­ä»£è¡¨äº†ç”¨æˆ·æŒ‰ç…§è·³è½¬é“¾æ¥æ¥ä¸Šç½‘çš„æ¦‚ç‡ï¼Œé€šå¸¸å¯ä»¥å–ä¸€ä¸ªå›ºå®šå€¼ 0.85ï¼Œè€Œ 1-d=0.15 åˆ™ä»£è¡¨äº†ç”¨æˆ·ä¸æ˜¯é€šè¿‡è·³è½¬é“¾æ¥çš„æ–¹å¼æ¥è®¿é—®ç½‘é¡µçš„ï¼Œæ¯”å¦‚ç›´æ¥è¾“å…¥ç½‘å€ã€‚å…¶ä¸­ N ä¸ºç½‘é¡µæ€»æ•°ï¼Œè¿™æ ·æˆ‘ä»¬åˆå¯ä»¥é‡æ–°è¿­ä»£ç½‘é¡µçš„æƒé‡è®¡ç®—äº†ï¼Œå› ä¸ºåŠ å…¥äº†é˜»å°¼å› å­ dï¼Œä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†ç­‰çº§æ³„éœ²å’Œç­‰çº§æ²‰æ²¡çš„é—®é¢˜ã€‚é€šè¿‡æ•°å­¦å®šç†ï¼ˆè¿™é‡Œä¸è¿›è¡Œè®²è§£ï¼‰ä¹Ÿå¯ä»¥è¯æ˜ï¼Œæœ€ç»ˆ PageRank éšæœºæµè§ˆæ¨¡å‹æ˜¯å¯ä»¥æ”¶æ•›çš„ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å¾—åˆ°ä¸€ä¸ªç¨³å®šæ­£å¸¸çš„ PR å€¼ã€‚PageRank åœ¨ç¤¾äº¤å½±å“åŠ›è¯„ä¼°ä¸­çš„åº”ç”¨ç½‘é¡µä¹‹é—´ä¼šå½¢æˆä¸€ä¸ªç½‘ç»œï¼Œæ˜¯æˆ‘ä»¬çš„äº’è”ç½‘ï¼Œè®ºæ–‡ä¹‹é—´ä¹Ÿå­˜åœ¨ç€ç›¸äº’å¼•ç”¨çš„å…³ç³»ï¼Œå¯ä»¥è¯´æˆ‘ä»¬æ‰€å¤„çš„ç¯å¢ƒå°±æ˜¯å„ç§ç½‘ç»œçš„é›†åˆã€‚åªè¦æ˜¯æœ‰ç½‘ç»œçš„åœ°æ–¹ï¼Œå°±å­˜åœ¨å‡ºé“¾å’Œå…¥é“¾ï¼Œå°±ä¼šæœ‰ PR æƒé‡çš„è®¡ç®—ï¼Œä¹Ÿå°±å¯ä»¥è¿ç”¨æˆ‘ä»¬ä»Šå¤©è®²çš„ PageRank ç®—æ³•ã€‚æˆ‘ä»¬å¯ä»¥æŠŠ PageRank ç®—æ³•å»¶å±•åˆ°ç¤¾äº¤ç½‘ç»œé¢†åŸŸä¸­ã€‚æ¯”å¦‚åœ¨å¾®åšä¸Šï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è®¡ç®—æŸä¸ªäººçš„å½±å“åŠ›ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿä¸€ä¸ªäººçš„å¾®åšç²‰ä¸æ•°å¹¶ä¸ä¸€å®šç­‰äºä»–çš„å®é™…å½±å“åŠ›ã€‚å¦‚æœæŒ‰ç…§ PageRank ç®—æ³•ï¼Œè¿˜éœ€è¦çœ‹è¿™äº›ç²‰ä¸çš„è´¨é‡å¦‚ä½•ã€‚å¦‚æœæœ‰å¾ˆå¤šæ˜æ˜Ÿæˆ–è€…å¤§ V å…³æ³¨ï¼Œé‚£ä¹ˆè¿™ä¸ªäººçš„å½±å“åŠ›ä¸€å®šå¾ˆé«˜ã€‚å¦‚æœç²‰ä¸æ˜¯é€šè¿‡è´­ä¹°åƒµå°¸ç²‰å¾—æ¥çš„ï¼Œé‚£ä¹ˆå³ä½¿ç²‰ä¸æ•°å†å¤šï¼Œå½±å“åŠ›ä¹Ÿä¸é«˜ã€‚åŒæ ·ï¼Œåœ¨å·¥ä½œåœºæ™¯ä¸­ï¼Œæ¯”å¦‚è¯´è„‰è„‰è¿™ä¸ªç¤¾äº¤è½¯ä»¶ï¼Œå®ƒè®¡ç®—çš„å°±æ˜¯ä¸ªäººåœ¨èŒåœºçš„å½±å“åŠ›ã€‚å¦‚æœä½ çš„å·¥ä½œå…³ç³»æ˜¯æå¼€å¤ã€æ±Ÿå—æ˜¥è¿™æ ·çš„åäººï¼Œé‚£ä¹ˆä½ çš„èŒåœºå½±å“åŠ›ä¸€å®šä¼šå¾ˆé«˜ã€‚åä¹‹ï¼Œå¦‚æœä½ æ˜¯ä¸ªå­¦ç”Ÿï¼Œåœ¨èŒåœºä¸Šè¢«é“¾å…¥çš„å…³ç³»æ¯”è¾ƒå°‘çš„è¯ï¼ŒèŒåœºå½±å“åŠ›å°±ä¼šæ¯”è¾ƒä½ã€‚åŒæ ·ï¼Œå¦‚æœä½ æƒ³è¦çœ‹ä¸€ä¸ªå…¬å¸çš„ç»è¥èƒ½åŠ›ï¼Œä¹Ÿå¯ä»¥çœ‹è¿™å®¶å…¬å¸éƒ½å’Œå“ªäº›å…¬å¸æœ‰åˆä½œã€‚å¦‚æœå®ƒåˆä½œçš„éƒ½æ˜¯ä¸–ç•Œ 500 å¼ºä¼ä¸šï¼Œé‚£ä¹ˆè¿™ä¸ªå…¬å¸åœ¨è¡Œä¸šå†…ä¸€å®šæ˜¯é¢†å¯¼è€…ï¼Œå¦‚æœè¿™ä¸ªå…¬å¸çš„å®¢æˆ·éƒ½æ˜¯å°å®¢æˆ·ï¼Œå³ä½¿æ•°é‡æ¯”è¾ƒå¤šï¼Œä¸šå†…å½±å“åŠ›ä¹Ÿä¸ä¸€å®šå¤§ã€‚é™¤éåƒæ·˜å®ä¸€æ ·ï¼Œæœ‰æµ·é‡çš„ä¸­å°å®¢æˆ·ï¼Œæœ€åå¤§å®¢æˆ·ä¹Ÿä¼šæ‰¾ä¸Šé—¨æ¥å¯»æ±‚åˆä½œã€‚æ‰€ä»¥æƒé‡é«˜çš„èŠ‚ç‚¹ï¼Œå¾€å¾€ä¼šæœ‰ä¸€äº›æƒé‡åŒæ ·å¾ˆé«˜çš„èŠ‚ç‚¹åœ¨è¿›è¡Œåˆä½œã€‚PageRank ç»™æˆ‘ä»¬å¸¦æ¥çš„å¯å‘PageRank å¯ä»¥è¯´æ˜¯ Google æœç´¢å¼•æ“é‡è¦çš„æŠ€æœ¯ä¹‹ä¸€ï¼Œåœ¨ 1998 å¹´å¸®åŠ© Google è·å¾—äº†æœç´¢å¼•æ“çš„é¢†å…ˆä¼˜åŠ¿ï¼Œç°åœ¨ PageRank å·²ç»æ¯”åŸæ¥å¤æ‚å¾ˆå¤šï¼Œä½†å®ƒçš„æ€æƒ³ä¾ç„¶èƒ½å¸¦ç»™æˆ‘ä»¬å¾ˆå¤šå¯å‘ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ æƒ³è¦è‡ªå·±çš„åª’ä½“å½±å“åŠ›æœ‰æ‰€æé«˜ï¼Œå°±å°½é‡è¦æ··åœ¨å¤§ V åœˆä¸­ï¼›å¦‚æœæƒ³æ‰¾åˆ°é«˜èŒä½çš„å·¥ä½œï¼Œå°±å°½é‡ç»“è¯†å…¬å¸é«˜å±‚ï¼Œæˆ–è€…è®¤è¯†æ›´å¤šçš„çŒå¤´ï¼Œå› ä¸ºçŒå¤´å’Œå¾ˆå¤šé«˜èŒä½çš„äººå‘˜éƒ½æœ‰é“¾æ¥å…³ç³»ã€‚åŒæ ·ï¼ŒPageRank ä¹Ÿå¯ä»¥å¸®æˆ‘ä»¬è¯†åˆ«é“¾æ¥å†œåœºã€‚é“¾æ¥å†œåœºæŒ‡çš„æ˜¯ç½‘é¡µä¸ºäº†é“¾æ¥è€Œé“¾æ¥ï¼Œå¡«å……äº†ä¸€äº›æ²¡æœ‰ç”¨çš„å†…å®¹ã€‚è¿™äº›é¡µé¢ç›¸äº’é“¾æ¥æˆ–è€…æŒ‡å‘äº†æŸä¸€ä¸ªç½‘é¡µï¼Œä»è€Œæƒ³è¦å¾—åˆ°æ›´é«˜çš„æƒé‡ã€‚æ€»ç»“ä»Šå¤©æˆ‘ç»™ä½ è®²äº† PageRank çš„ç®—æ³•åŸç†ï¼Œå¯¹ç®€åŒ–çš„ PageRank æ¨¡å‹è¿›è¡Œäº†æ¨¡æ‹Ÿã€‚é’ˆå¯¹ç®€åŒ–æ¨¡å‹ä¸­å­˜åœ¨çš„ç­‰çº§æ³„éœ²å’Œç­‰çº§æ²‰æ²¡è¿™ä¸¤ä¸ªé—®é¢˜ï¼ŒPageRank çš„éšæœºæµè§ˆæ¨¡å‹å¼•å…¥äº†é˜»å°¼å› å­ d æ¥è§£å†³ã€‚åŒæ ·ï¼ŒPageRank æœ‰å¾ˆå¹¿çš„åº”ç”¨é¢†åŸŸï¼Œåœ¨è®¸å¤šç½‘ç»œç»“æ„ä¸­éƒ½æœ‰åº”ç”¨ï¼Œæ¯”å¦‚è®¡ç®—ä¸€ä¸ªäººçš„å¾®åšå½±å“åŠ›ç­‰ã€‚å®ƒä¹Ÿå‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨ç¤¾äº¤ç½‘ç»œä¸­ï¼Œé“¾æ¥çš„è´¨é‡éå¸¸é‡è¦ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"PageRank","slug":"PageRank","permalink":"cpeixin.cn/tags/PageRank/"}]},{"title":"æ•°æ®åˆ†æ-å…³è”è§„åˆ™åŸç†","slug":"æ•°æ®åˆ†æ-å…³è”è§„åˆ™åŸç†","date":"2018-09-02T14:19:09.000Z","updated":"2020-05-01T14:19:31.444Z","comments":true,"path":"2018/09/02/æ•°æ®åˆ†æ-å…³è”è§„åˆ™åŸç†/","link":"","permalink":"cpeixin.cn/2018/09/02/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%E5%8E%9F%E7%90%86/","excerpt":"","text":"å…³è”è§„åˆ™è¿™ä¸ªæ¦‚å¿µï¼Œæœ€æ—©æ˜¯ç”± Agrawal ç­‰äººåœ¨ 1993 å¹´æå‡ºçš„ã€‚åœ¨ 1994 å¹´ Agrawal ç­‰äººåˆæå‡ºäº†åŸºäºå…³è”è§„åˆ™çš„ Apriori ç®—æ³•ï¼Œè‡³ä»Š Apriori ä»æ˜¯å…³è”è§„åˆ™æŒ–æ˜çš„é‡è¦ç®—æ³•ã€‚å…³è”è§„åˆ™æŒ–æ˜å¯ä»¥è®©æˆ‘ä»¬ä»æ•°æ®é›†ä¸­å‘ç°é¡¹ä¸é¡¹ï¼ˆitem ä¸ itemï¼‰ä¹‹é—´çš„å…³ç³»ï¼Œå®ƒåœ¨æˆ‘ä»¬çš„ç”Ÿæ´»ä¸­æœ‰å¾ˆå¤šåº”ç”¨åœºæ™¯ï¼Œâ€œè´­ç‰©ç¯®åˆ†æâ€å°±æ˜¯ä¸€ä¸ªå¸¸è§çš„åœºæ™¯ï¼Œè¿™ä¸ªåœºæ™¯å¯ä»¥ä»æ¶ˆè´¹è€…äº¤æ˜“è®°å½•ä¸­å‘æ˜å•†å“ä¸å•†å“ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œè¿›è€Œé€šè¿‡å•†å“æ†ç»‘é”€å”®æˆ–è€…ç›¸å…³æ¨èçš„æ–¹å¼å¸¦æ¥æ›´å¤šçš„é”€å”®é‡ã€‚æ‰€ä»¥è¯´ï¼Œå…³è”è§„åˆ™æŒ–æ˜æ˜¯ä¸ªéå¸¸æœ‰ç”¨çš„æŠ€æœ¯ã€‚åœ¨ä»Šå¤©çš„å†…å®¹ä¸­ï¼Œå¸Œæœ›ä½ èƒ½å¸¦ç€é—®é¢˜ï¼Œå’Œæˆ‘ä¸€èµ·æ¥ææ‡‚ä»¥ä¸‹å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼šææ‡‚å…³è”è§„åˆ™ä¸­çš„å‡ ä¸ªé‡è¦æ¦‚å¿µï¼šæ”¯æŒåº¦ã€ç½®ä¿¡åº¦ã€æå‡åº¦ï¼›Apriori ç®—æ³•çš„å·¥ä½œåŸç†ï¼›åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è¿›è¡Œå…³è”è§„åˆ™æŒ–æ˜ã€‚å…³è”è§„åˆ™æ¦‚å¿µææ‡‚å…³è”è§„åˆ™ä¸­çš„å‡ ä¸ªæ¦‚å¿µæˆ‘ä¸¾ä¸€ä¸ªè¶…å¸‚è´­ç‰©çš„ä¾‹å­ï¼Œä¸‹é¢æ˜¯å‡ åå®¢æˆ·è´­ä¹°çš„å•†å“åˆ—è¡¨ï¼šä»€ä¹ˆæ˜¯æ”¯æŒåº¦å‘¢ï¼Ÿæ”¯æŒåº¦æ˜¯ä¸ªç™¾åˆ†æ¯”ï¼Œå®ƒæŒ‡çš„æ˜¯æŸä¸ªå•†å“ç»„åˆå‡ºç°çš„æ¬¡æ•°ä¸æ€»æ¬¡æ•°ä¹‹é—´çš„æ¯”ä¾‹ã€‚æ”¯æŒåº¦è¶Šé«˜ï¼Œä»£è¡¨è¿™ä¸ªç»„åˆå‡ºç°çš„é¢‘ç‡è¶Šå¤§ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°â€œç‰›å¥¶â€å‡ºç°äº† 4 æ¬¡ï¼Œé‚£ä¹ˆè¿™ 5 ç¬”è®¢å•ä¸­â€œç‰›å¥¶â€çš„æ”¯æŒåº¦å°±æ˜¯ 4/5=0.8ã€‚åŒæ ·â€œç‰›å¥¶ + é¢åŒ…â€å‡ºç°äº† 3 æ¬¡ï¼Œé‚£ä¹ˆè¿™ 5 ç¬”è®¢å•ä¸­â€œç‰›å¥¶ + é¢åŒ…â€çš„æ”¯æŒåº¦å°±æ˜¯ 3/5=0.6ã€‚ä»€ä¹ˆæ˜¯ç½®ä¿¡åº¦å‘¢ï¼Ÿå®ƒæŒ‡çš„å°±æ˜¯å½“ä½ è´­ä¹°äº†å•†å“ Aï¼Œä¼šæœ‰å¤šå¤§çš„æ¦‚ç‡è´­ä¹°å•†å“ Bï¼Œåœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼šç½®ä¿¡åº¦ï¼ˆç‰›å¥¶â†’å•¤é…’ï¼‰=2/4=0.5ï¼Œä»£è¡¨å¦‚æœä½ è´­ä¹°äº†ç‰›å¥¶ï¼Œæœ‰å¤šå¤§çš„æ¦‚ç‡ä¼šè´­ä¹°å•¤é…’ï¼Ÿç½®ä¿¡åº¦ï¼ˆå•¤é…’â†’ç‰›å¥¶ï¼‰=2/3=0.67ï¼Œä»£è¡¨å¦‚æœä½ è´­ä¹°äº†å•¤é…’ï¼Œæœ‰å¤šå¤§çš„æ¦‚ç‡ä¼šè´­ä¹°ç‰›å¥¶ï¼Ÿæˆ‘ä»¬èƒ½çœ‹åˆ°ï¼Œåœ¨ 4 æ¬¡è´­ä¹°äº†ç‰›å¥¶çš„æƒ…å†µä¸‹ï¼Œæœ‰ 2 æ¬¡è´­ä¹°äº†å•¤é…’ï¼Œæ‰€ä»¥ç½®ä¿¡åº¦ (ç‰›å¥¶â†’å•¤é…’)=0.5ï¼Œè€Œåœ¨ 3 æ¬¡è´­ä¹°å•¤é…’çš„æƒ…å†µä¸‹ï¼Œæœ‰ 2 æ¬¡è´­ä¹°äº†ç‰›å¥¶ï¼Œæ‰€ä»¥ç½®ä¿¡åº¦ï¼ˆå•¤é…’â†’ç‰›å¥¶ï¼‰=0.67ã€‚æ‰€ä»¥è¯´ç½®ä¿¡åº¦æ˜¯ä¸ªæ¡ä»¶æ¦‚å¿µï¼Œå°±æ˜¯è¯´åœ¨ A å‘ç”Ÿçš„æƒ…å†µä¸‹ï¼ŒB å‘ç”Ÿçš„æ¦‚ç‡æ˜¯å¤šå°‘ã€‚ä»€ä¹ˆæ˜¯æå‡åº¦å‘¢ï¼Ÿæˆ‘ä»¬åœ¨åšå•†å“æ¨èçš„æ—¶å€™ï¼Œé‡ç‚¹è€ƒè™‘çš„æ˜¯æå‡åº¦ï¼Œå› ä¸ºæå‡åº¦ä»£è¡¨çš„æ˜¯â€œå•†å“ A çš„å‡ºç°ï¼Œå¯¹å•†å“ B çš„å‡ºç°æ¦‚ç‡æå‡çš„â€ç¨‹åº¦ã€‚è¿˜æ˜¯çœ‹ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬å•çº¯çœ‹ç½®ä¿¡åº¦ (å¯ä¹â†’å°¿å¸ƒ)=1ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä¹å‡ºç°çš„æ—¶å€™ï¼Œç”¨æˆ·éƒ½ä¼šè´­ä¹°å°¿å¸ƒï¼Œé‚£ä¹ˆå½“ç”¨æˆ·è´­ä¹°å¯ä¹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦æ¨èå°¿å¸ƒä¹ˆï¼Ÿå®é™…ä¸Šï¼Œå°±ç®—ç”¨æˆ·ä¸è´­ä¹°å¯ä¹ï¼Œä¹Ÿä¼šç›´æ¥è´­ä¹°å°¿å¸ƒçš„ï¼Œæ‰€ä»¥ç”¨æˆ·æ˜¯å¦è´­ä¹°å¯ä¹ï¼Œå¯¹å°¿å¸ƒçš„æå‡ä½œç”¨å¹¶ä¸å¤§ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„å…¬å¼æ¥è®¡ç®—å•†å“ A å¯¹å•†å“ B çš„æå‡åº¦ï¼šæå‡åº¦ (Aâ†’B)= ç½®ä¿¡åº¦ (Aâ†’B)/ æ”¯æŒåº¦ (B)è¿™ä¸ªå…¬å¼æ˜¯ç”¨æ¥è¡¡é‡ A å‡ºç°çš„æƒ…å†µä¸‹ï¼Œæ˜¯å¦ä¼šå¯¹ B å‡ºç°çš„æ¦‚ç‡æœ‰æ‰€æå‡ã€‚æ‰€ä»¥æå‡åº¦æœ‰ä¸‰ç§å¯èƒ½ï¼šæå‡åº¦ (Aâ†’B)&gt;1ï¼šä»£è¡¨æœ‰æå‡ï¼›æå‡åº¦ (Aâ†’B)=1ï¼šä»£è¡¨æœ‰æ²¡æœ‰æå‡ï¼Œä¹Ÿæ²¡æœ‰ä¸‹é™ï¼›æå‡åº¦ (Aâ†’B)&lt;1ï¼šä»£è¡¨æœ‰ä¸‹é™ã€‚æå‡åº¦ (ç‰›å¥¶â†’å•¤é…’)Apriori çš„å·¥ä½œåŸç†æ˜ç™½äº†å…³è”è§„åˆ™ä¸­æ”¯æŒåº¦ã€ç½®ä¿¡åº¦å’Œæå‡åº¦è¿™å‡ ä¸ªé‡è¦æ¦‚å¿µï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ Apriori ç®—æ³•æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚é¦–å…ˆæˆ‘ä»¬æŠŠä¸Šé¢æ¡ˆä¾‹ä¸­çš„å•†å“ç”¨ ID æ¥ä»£è¡¨ï¼Œç‰›å¥¶ã€é¢åŒ…ã€å°¿å¸ƒã€å¯ä¹ã€å•¤é…’ã€é¸¡è›‹çš„å•†å“ ID åˆ†åˆ«è®¾ç½®ä¸º 1-6ï¼Œä¸Šé¢çš„æ•°æ®è¡¨å¯ä»¥å˜ä¸ºï¼šApriori ç®—æ³•å…¶å®å°±æ˜¯æŸ¥æ‰¾é¢‘ç¹é¡¹é›† (frequent itemset) **çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥é¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰ä»€ä¹ˆæ˜¯é¢‘ç¹é¡¹é›†ã€‚é¢‘ç¹é¡¹é›†å°±æ˜¯æ”¯æŒåº¦å¤§äºç­‰äºæœ€å°æ”¯æŒåº¦ (Min Support) é˜ˆå€¼çš„é¡¹é›†**ï¼Œæ‰€ä»¥å°äºæœ€å°å€¼æ”¯æŒåº¦çš„é¡¹ç›®å°±æ˜¯éé¢‘ç¹é¡¹é›†ï¼Œè€Œå¤§äºç­‰äºæœ€å°æ”¯æŒåº¦çš„é¡¹é›†å°±æ˜¯é¢‘ç¹é¡¹é›†ã€‚é¡¹é›†è¿™ä¸ªæ¦‚å¿µï¼Œè‹±æ–‡å«åš itemsetï¼Œå®ƒå¯ä»¥æ˜¯å•ä¸ªçš„å•†å“ï¼Œä¹Ÿå¯ä»¥æ˜¯å•†å“çš„ç»„åˆã€‚æˆ‘ä»¬å†æ¥çœ‹ä¸‹è¿™ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘éšæœºæŒ‡å®šæœ€å°æ”¯æŒåº¦æ˜¯ 50%ï¼Œä¹Ÿå°±æ˜¯ 0.5ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹ Apriori ç®—æ³•æ˜¯å¦‚ä½•è¿ç®—çš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆè®¡ç®—å•ä¸ªå•†å“çš„æ”¯æŒåº¦ï¼Œä¹Ÿå°±æ˜¯å¾—åˆ° K=1 é¡¹çš„æ”¯æŒåº¦ï¼šå› ä¸ºæœ€å°æ”¯æŒåº¦æ˜¯ 0.5ï¼Œæ‰€ä»¥ä½ èƒ½çœ‹åˆ°å•†å“ 4ã€6 æ˜¯ä¸ç¬¦åˆæœ€å°æ”¯æŒåº¦çš„ï¼Œä¸å±äºé¢‘ç¹é¡¹é›†ï¼Œäºæ˜¯ç»è¿‡ç­›é€‰å•†å“çš„é¢‘ç¹é¡¹é›†å°±å˜æˆï¼šåœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å°†å•†å“ä¸¤ä¸¤ç»„åˆï¼Œ æ ¹æ®è®¢å•ç¼–å·å›¾ï¼Œå¾—åˆ° k=2 é¡¹çš„æ”¯æŒåº¦ï¼šæˆ‘ä»¬å†ç­›æ‰å°äºæœ€å°å€¼æ”¯æŒåº¦çš„å•†å“ç»„åˆï¼Œå¯ä»¥å¾—åˆ°ï¼šæˆ‘ä»¬å†å°†å•†å“è¿›è¡Œ K=3 é¡¹çš„å•†å“ç»„åˆï¼Œå¯ä»¥å¾—åˆ°ï¼šå•†å“é¡¹é›†æ”¯æŒåº¦1ï¼Œ2ï¼Œ33/51ï¼Œ2ï¼Œ51/51ï¼Œ3ï¼Œ52/52ï¼Œ3ï¼Œ52/5å†ç­›æ‰å°äºæœ€å°å€¼æ”¯æŒåº¦çš„å•†å“ç»„åˆï¼Œå¯ä»¥å¾—åˆ°ï¼šé€šè¿‡ä¸Šé¢è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° K=3 é¡¹çš„é¢‘ç¹é¡¹é›†{1,2,3}ï¼Œä¹Ÿå°±æ˜¯{ç‰›å¥¶ã€é¢åŒ…ã€å°¿å¸ƒ}çš„ç»„åˆã€‚åˆ°è¿™é‡Œï¼Œä½ å·²ç»å’Œæˆ‘æ¨¡æ‹Ÿäº†ä¸€éæ•´ä¸ª Apriori ç®—æ³•çš„æµç¨‹ï¼Œä¸‹é¢æˆ‘æ¥ç»™ä½ æ€»ç»“ä¸‹ Apriori ç®—æ³•çš„é€’å½’æµç¨‹ï¼šK=1ï¼Œè®¡ç®— K é¡¹é›†çš„æ”¯æŒåº¦ï¼›ç­›é€‰æ‰å°äºæœ€å°æ”¯æŒåº¦çš„é¡¹é›†ï¼›å¦‚æœé¡¹é›†ä¸ºç©ºï¼Œåˆ™å¯¹åº” K-1 é¡¹é›†çš„ç»“æœä¸ºæœ€ç»ˆç»“æœã€‚å¦åˆ™ K=K+1ï¼Œé‡å¤ 1-3 æ­¥ã€‚Apriori çš„æ”¹è¿›ç®—æ³•ï¼šFP-Growth ç®—æ³•æˆ‘ä»¬åˆšå®Œæˆäº† Apriori ç®—æ³•çš„æ¨¡æ‹Ÿï¼Œä½ èƒ½çœ‹åˆ° Apriori åœ¨è®¡ç®—çš„è¿‡ç¨‹ä¸­æœ‰ä»¥ä¸‹å‡ ä¸ªç¼ºç‚¹ï¼šå¯èƒ½äº§ç”Ÿå¤§é‡çš„å€™é€‰é›†ã€‚å› ä¸ºé‡‡ç”¨æ’åˆ—ç»„åˆçš„æ–¹å¼ï¼ŒæŠŠå¯èƒ½çš„é¡¹é›†éƒ½ç»„åˆå‡ºæ¥äº†ï¼›æ¯æ¬¡è®¡ç®—éƒ½éœ€è¦é‡æ–°æ‰«ææ•°æ®é›†ï¼Œæ¥è®¡ç®—æ¯ä¸ªé¡¹é›†çš„æ”¯æŒåº¦ã€‚æ‰€ä»¥ Apriori ç®—æ³•ä¼šæµªè´¹å¾ˆå¤šè®¡ç®—ç©ºé—´å’Œè®¡ç®—æ—¶é—´ï¼Œä¸ºæ­¤äººä»¬æå‡ºäº† FP-Growth ç®—æ³•ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼šåˆ›å»ºäº†ä¸€æ£µ FP æ ‘æ¥å­˜å‚¨é¢‘ç¹é¡¹é›†ã€‚åœ¨åˆ›å»ºå‰å¯¹ä¸æ»¡è¶³æœ€å°æ”¯æŒåº¦çš„é¡¹è¿›è¡Œåˆ é™¤ï¼Œå‡å°‘äº†å­˜å‚¨ç©ºé—´ã€‚æˆ‘ç¨åä¼šè®²è§£å¦‚ä½•æ„é€ ä¸€æ£µ FP æ ‘ï¼›æ•´ä¸ªç”Ÿæˆè¿‡ç¨‹åªéå†æ•°æ®é›† 2 æ¬¡ï¼Œå¤§å¤§å‡å°‘äº†è®¡ç®—é‡ã€‚æ‰€ä»¥åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨ FP-Growth æ¥åšé¢‘ç¹é¡¹é›†çš„æŒ–æ˜ï¼Œä¸‹é¢æˆ‘ç»™ä½ ç®€è¿°ä¸‹ FP-Growth çš„åŸç†ã€‚1. åˆ›å»ºé¡¹å¤´è¡¨ï¼ˆitem header tableï¼‰åˆ›å»ºé¡¹å¤´è¡¨çš„ä½œç”¨æ˜¯ä¸º FP æ„å»ºåŠé¢‘ç¹é¡¹é›†æŒ–æ˜æä¾›ç´¢å¼•ã€‚è¿™ä¸€æ­¥çš„æµç¨‹æ˜¯å…ˆæ‰«æä¸€éæ•°æ®é›†ï¼Œå¯¹äºæ»¡è¶³æœ€å°æ”¯æŒåº¦çš„å•ä¸ªé¡¹ï¼ˆK=1 é¡¹é›†ï¼‰æŒ‰ç…§æ”¯æŒåº¦ä»é«˜åˆ°ä½è¿›è¡Œæ’åºï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­åˆ é™¤äº†ä¸æ»¡è¶³æœ€å°æ”¯æŒåº¦çš„é¡¹ã€‚é¡¹å¤´è¡¨åŒ…æ‹¬äº†é¡¹ç›®ã€æ”¯æŒåº¦ï¼Œä»¥åŠè¯¥é¡¹åœ¨ FP æ ‘ä¸­çš„é“¾è¡¨ã€‚åˆå§‹çš„æ—¶å€™é“¾è¡¨ä¸ºç©ºã€‚2. æ„é€  FP æ ‘FP æ ‘çš„æ ¹èŠ‚ç‚¹è®°ä¸º NULL èŠ‚ç‚¹ã€‚æ•´ä¸ªæµç¨‹æ˜¯éœ€è¦å†æ¬¡æ‰«ææ•°æ®é›†ï¼Œå¯¹äºæ¯ä¸€æ¡æ•°æ®ï¼ŒæŒ‰ç…§æ”¯æŒåº¦ä»é«˜åˆ°ä½çš„é¡ºåºè¿›è¡Œåˆ›å»ºèŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€æ­¥ä¸­é¡¹å¤´è¡¨ä¸­çš„æ’åºç»“æœï¼‰ï¼ŒèŠ‚ç‚¹å¦‚æœå­˜åœ¨å°±å°†è®¡æ•° count+1ï¼Œå¦‚æœä¸å­˜åœ¨å°±è¿›è¡Œåˆ›å»ºã€‚åŒæ—¶åœ¨åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ›´æ–°é¡¹å¤´è¡¨çš„é“¾è¡¨ã€‚3. é€šè¿‡ FP æ ‘æŒ–æ˜é¢‘ç¹é¡¹é›†åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªå­˜å‚¨é¢‘ç¹é¡¹é›†çš„ FP æ ‘ï¼Œä»¥åŠä¸€ä¸ªé¡¹å¤´è¡¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é¡¹å¤´è¡¨æ¥æŒ–æ˜å‡ºæ¯ä¸ªé¢‘ç¹é¡¹é›†ã€‚å…·ä½“çš„æ“ä½œä¼šç”¨åˆ°ä¸€ä¸ªæ¦‚å¿µï¼Œå«â€œæ¡ä»¶æ¨¡å¼åŸºâ€ï¼Œå®ƒæŒ‡çš„æ˜¯ä»¥è¦æŒ–æ˜çš„èŠ‚ç‚¹ä¸ºå¶å­èŠ‚ç‚¹ï¼Œè‡ªåº•å‘ä¸Šæ±‚å‡º FP å­æ ‘ï¼Œç„¶åå°† FP å­æ ‘çš„ç¥–å…ˆèŠ‚ç‚¹è®¾ç½®ä¸ºå¶å­èŠ‚ç‚¹ä¹‹å’Œã€‚æˆ‘ä»¥â€œå•¤é…’â€çš„èŠ‚ç‚¹ä¸ºä¾‹ï¼Œä» FP æ ‘ä¸­å¯ä»¥å¾—åˆ°ä¸€æ£µ FP å­æ ‘ï¼Œå°†ç¥–å…ˆèŠ‚ç‚¹çš„æ”¯æŒåº¦è®°ä¸ºå¶å­èŠ‚ç‚¹ä¹‹å’Œï¼Œå¾—åˆ°ï¼šä½ èƒ½çœ‹å‡ºæ¥ï¼Œç›¸æ¯”äºåŸæ¥çš„ FP æ ‘ï¼Œå°¿å¸ƒå’Œç‰›å¥¶çš„é¢‘ç¹é¡¹é›†æ•°å‡å°‘äº†ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ±‚å¾—çš„æ˜¯ä»¥â€œå•¤é…’â€ä¸ºèŠ‚ç‚¹çš„ FP å­æ ‘ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨é¢‘ç¹é¡¹é›†ä¸­ä¸€å®šè¦å«æœ‰â€œå•¤é…’â€è¿™ä¸ªé¡¹ã€‚ä½ å¯ä»¥å†çœ‹ä¸‹åŸå§‹çš„æ•°æ®ï¼Œå…¶ä¸­è®¢å• 1{ç‰›å¥¶ã€é¢åŒ…ã€å°¿å¸ƒ}å’Œè®¢å• 5{ç‰›å¥¶ã€é¢åŒ…ã€å°¿å¸ƒã€å¯ä¹}å¹¶ä¸å­˜åœ¨â€œå•¤é…’â€è¿™ä¸ªé¡¹ï¼Œæ‰€ä»¥é’ˆå¯¹è®¢å• 1ï¼Œå°¿å¸ƒâ†’ç‰›å¥¶â†’é¢åŒ…è¿™ä¸ªé¡¹é›†å°±ä¼šä» FP æ ‘ä¸­å»æ‰ï¼Œé’ˆå¯¹è®¢å• 5 ä¹ŸåŒ…æ‹¬äº†å°¿å¸ƒâ†’ç‰›å¥¶â†’é¢åŒ…è¿™ä¸ªé¡¹é›†ä¹Ÿä¼šä» FP æ ‘ä¸­å»æ‰ï¼Œæ‰€ä»¥ä½ èƒ½çœ‹åˆ°ä»¥â€œå•¤é…’â€ä¸ºèŠ‚ç‚¹çš„ FP å­æ ‘ï¼Œå°¿å¸ƒã€ç‰›å¥¶ã€é¢åŒ…é¡¹é›†ä¸Šçš„è®¡æ•°æ¯”åŸæ¥å°‘äº† 2ã€‚æ¡ä»¶æ¨¡å¼åŸºä¸åŒ…æ‹¬â€œå•¤é…’â€èŠ‚ç‚¹ï¼Œè€Œä¸”ç¥–å…ˆèŠ‚ç‚¹å¦‚æœå°äºæœ€å°æ”¯æŒåº¦å°±ä¼šè¢«å‰ªæï¼Œæ‰€ä»¥â€œå•¤é…’â€çš„æ¡ä»¶æ¨¡å¼åŸºä¸ºç©ºã€‚åŒç†ï¼Œæˆ‘ä»¬å¯ä»¥æ±‚å¾—â€œé¢åŒ…â€çš„æ¡ä»¶æ¨¡å¼åŸºä¸ºï¼šæ‰€ä»¥å¯ä»¥æ±‚å¾—é¢åŒ…çš„é¢‘ç¹é¡¹é›†ä¸º{å°¿å¸ƒï¼Œé¢åŒ…}ï¼Œ{å°¿å¸ƒï¼Œç‰›å¥¶ï¼Œé¢åŒ…}ã€‚åŒæ ·ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ±‚å¾—ç‰›å¥¶ï¼Œå°¿å¸ƒçš„é¢‘ç¹é¡¹é›†ï¼Œè¿™é‡Œå°±ä¸å†è®¡ç®—å±•ç¤ºã€‚æ€»ç»“ä»Šå¤©æˆ‘ç»™ä½ è®²äº† Apriori ç®—æ³•ï¼Œå®ƒæ˜¯åœ¨â€œè´­ç‰©ç¯®åˆ†æâ€ä¸­å¸¸ç”¨çš„å…³è”è§„åˆ™æŒ–æ˜ç®—æ³•ï¼Œåœ¨ Apriori ç®—æ³•ä¸­ä½ æœ€ä¸»è¦æ˜¯éœ€è¦æ˜ç™½æ”¯æŒåº¦ã€ç½®ä¿¡åº¦ã€æå‡åº¦è¿™å‡ ä¸ªæ¦‚å¿µï¼Œä»¥åŠ Apriori è¿­ä»£è®¡ç®—é¢‘ç¹é¡¹é›†çš„å·¥ä½œæµç¨‹ã€‚Apriori ç®—æ³•åœ¨å®é™…å·¥ä½œä¸­éœ€è¦å¯¹æ•°æ®é›†æ‰«æå¤šæ¬¡ï¼Œä¼šæ¶ˆè€—å¤§é‡çš„è®¡ç®—æ—¶é—´ï¼Œæ‰€ä»¥åœ¨ 2000 å¹´ FP-Growth ç®—æ³•è¢«æå‡ºæ¥ï¼Œå®ƒåªéœ€è¦æ‰«æä¸¤æ¬¡æ•°æ®é›†å³å¯ä»¥å®Œæˆå…³è”è§„åˆ™çš„æŒ–æ˜ã€‚FP-Growth ç®—æ³•æœ€ä¸»è¦çš„è´¡çŒ®å°±æ˜¯æå‡ºäº† FP æ ‘å’Œé¡¹å¤´è¡¨ï¼Œé€šè¿‡ FP æ ‘å‡å°‘äº†é¢‘ç¹é¡¹é›†çš„å­˜å‚¨ä»¥åŠè®¡ç®—æ—¶é—´ã€‚å½“ç„¶ Apriori çš„æ”¹è¿›ç®—æ³•é™¤äº† FP-Growth ç®—æ³•ä»¥å¤–ï¼Œè¿˜æœ‰ CBA ç®—æ³•ã€GSP ç®—æ³•ï¼Œè¿™é‡Œå°±ä¸è¿›è¡Œä»‹ç»ã€‚ä½ èƒ½å‘ç°ä¸€ç§æ–°ç†è®ºçš„æå‡ºï¼Œå¾€å¾€æ˜¯å…ˆä»æœ€åŸå§‹çš„æ¦‚å¿µå‡ºå‘ï¼Œæå‡ºä¸€ç§æ–°çš„æ–¹æ³•ã€‚åŸå§‹æ¦‚å¿µæœ€æ¥è¿‘äººä»¬æ¨¡æ‹Ÿçš„è¿‡ç¨‹ï¼Œä½†å¾€å¾€ä¼šå­˜åœ¨ç©ºé—´å’Œæ—¶é—´å¤æ‚åº¦è¿‡é«˜çš„æƒ…å†µã€‚æ‰€ä»¥åé¢å…¶ä»–äººä¼šå¯¹è¿™ä¸ªæ–¹æ³•åšæ”¹è¿›å‹çš„åˆ›æ–°ï¼Œé‡ç‚¹æ˜¯åœ¨ç©ºé—´å’Œæ—¶é—´å¤æ‚åº¦ä¸Šè¿›è¡Œé™ç»´ï¼Œæ¯”å¦‚é‡‡ç”¨æ–°å‹çš„æ•°æ®ç»“æ„ã€‚ä½ èƒ½çœ‹å‡ºæ ‘åœ¨å­˜å‚¨å’Œæ£€ç´¢ä¸­æ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„æ•°æ®ç»“æ„ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Apriori","slug":"Apriori","permalink":"cpeixin.cn/tags/Apriori/"}]},{"title":"æ•°æ®åˆ†æ-å…³è”è§„åˆ™ å®æˆ˜","slug":"æ•°æ®åˆ†æ-å…³è”è§„åˆ™-å®æˆ˜","date":"2018-09-01T14:19:27.000Z","updated":"2020-05-01T14:19:45.546Z","comments":true,"path":"2018/09/01/æ•°æ®åˆ†æ-å…³è”è§„åˆ™-å®æˆ˜/","link":"","permalink":"cpeixin.cn/2018/09/01/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99-%E5%AE%9E%E6%88%98/","excerpt":"","text":"æ˜¨å¤©è®²è§£äº†å…³è”è§„åˆ™æŒ–æ˜çš„åŸç†ã€‚å…³è”è§„åˆ™æŒ–æ˜åœ¨ç”Ÿæ´»ä¸­æœ‰å¾ˆå¤šä½¿ç”¨åœºæ™¯ï¼Œä¸ä»…æ˜¯å•†å“çš„æ†ç»‘é”€å”®ï¼Œç”šè‡³åœ¨æŒ‘é€‰æ¼”å‘˜å†³ç­–ä¸Šï¼Œä½ ä¹Ÿèƒ½é€šè¿‡å…³è”è§„åˆ™æŒ–æ˜çœ‹å‡ºæ¥æŸä¸ªå¯¼æ¼”é€‰æ‹©æ¼”å‘˜çš„å€¾å‘ã€‚ä»Šå¤©æˆ‘æ¥å¸¦ä½ ç”¨ Apriori ç®—æ³•åšä¸€ä¸ªé¡¹ç›®å®æˆ˜ã€‚ä½ éœ€è¦æŒæ¡çš„æ˜¯ä»¥ä¸‹å‡ ç‚¹ï¼šç†Ÿæ‚‰ä¸ŠèŠ‚è¯¾è®²åˆ°çš„å‡ ä¸ªé‡è¦æ¦‚å¿µï¼šæ”¯æŒåº¦ã€ç½®ä¿¡åº¦å’Œæå‡åº¦ï¼›ç†Ÿæ‚‰ä¸æŒæ¡ Apriori å·¥å…·åŒ…çš„ä½¿ç”¨ï¼›åœ¨å®é™…é—®é¢˜ä¸­ï¼Œçµæ´»è¿ç”¨ã€‚åŒ…æ‹¬æ•°æ®é›†çš„å‡†å¤‡ç­‰ã€‚å¦‚ä½•ä½¿ç”¨ AprioriApriori è™½ç„¶æ˜¯åå¤§ç®—æ³•ä¹‹ä¸€ï¼Œä¸è¿‡åœ¨ sklearn å·¥å…·åŒ…ä¸­å¹¶æ²¡æœ‰å®ƒï¼Œä¹Ÿæ²¡æœ‰ FP-Growth ç®—æ³•ã€‚è¿™é‡Œæ•™ä½ ä¸ªæ–¹æ³•ï¼Œæ¥é€‰æ‹© Python ä¸­å¯ä»¥ä½¿ç”¨çš„å·¥å…·åŒ…ï¼Œä½ å¯ä»¥é€šè¿‡https://pypi.org/ æœç´¢å·¥å…·åŒ…ã€‚è¿™ä¸ªç½‘ç«™æä¾›çš„å·¥å…·åŒ…éƒ½æ˜¯ Python è¯­è¨€çš„ï¼Œä½ èƒ½æ‰¾åˆ° 8 ä¸ª Python è¯­è¨€çš„ Apriori å·¥å…·åŒ…ï¼Œå…·ä½“é€‰æ‹©å“ªä¸ªå‘¢ï¼Ÿå»ºè®®ä½ ä½¿ç”¨ç¬¬äºŒä¸ªå·¥å…·åŒ…ï¼Œå³ efficient-aprioriã€‚åé¢æˆ‘ä¼šè®²åˆ°ä¸ºä»€ä¹ˆæ¨èè¿™ä¸ªå·¥å…·åŒ…ã€‚é¦–å…ˆä½ éœ€è¦é€šè¿‡ pip install efficient-apriori å®‰è£…è¿™ä¸ªå·¥å…·åŒ…ã€‚ç„¶åçœ‹ä¸‹å¦‚ä½•ä½¿ç”¨å®ƒï¼Œæ ¸å¿ƒçš„ä»£ç å°±æ˜¯è¿™ä¸€è¡Œï¼š1itemsets, rules = apriori(data, min_support, min_confidence)å…¶ä¸­ data æ˜¯æˆ‘ä»¬è¦æä¾›çš„æ•°æ®é›†ï¼Œå®ƒæ˜¯ä¸€ä¸ª list æ•°ç»„ç±»å‹ã€‚min_support å‚æ•°ä¸ºæœ€å°æ”¯æŒåº¦ï¼Œåœ¨ efficient-apriori å·¥å…·åŒ…ä¸­ç”¨ 0 åˆ° 1 çš„æ•°å€¼ä»£è¡¨ç™¾åˆ†æ¯”ï¼Œæ¯”å¦‚ 0.5 ä»£è¡¨æœ€å°æ”¯æŒåº¦ä¸º 50%ã€‚min_confidence æ˜¯æœ€å°ç½®ä¿¡åº¦ï¼Œæ•°å€¼ä¹Ÿä»£è¡¨ç™¾åˆ†æ¯”ï¼Œæ¯”å¦‚ 1 ä»£è¡¨ 100%ã€‚ä¸€èˆ¬æ¥è¯´æœ€å°æ”¯æŒåº¦å¸¸è§çš„å–å€¼æœ‰0.5ï¼Œ0.1, 0.05ã€‚æœ€å°ç½®ä¿¡åº¦å¸¸è§çš„å–å€¼æœ‰1.0, 0.9, 0.8ã€‚å¯ä»¥é€šè¿‡å°è¯•ä¸€äº›å–å€¼ï¼Œç„¶åè§‚å¯Ÿå…³è”ç»“æœçš„æ–¹å¼æ¥è°ƒæ•´æœ€å°å€¼å°ºåº¦å’Œæœ€å°ç½®ä¿¡åº¦çš„å–å€¼ã€‚å…³äºæ”¯æŒåº¦ã€ç½®ä¿¡åº¦å’Œæå‡åº¦ï¼Œæˆ‘ä»¬å†æ¥ç®€å•å›å¿†ä¸‹ã€‚æ”¯æŒåº¦æŒ‡çš„æ˜¯æŸä¸ªå•†å“ç»„åˆå‡ºç°çš„æ¬¡æ•°ä¸æ€»æ¬¡æ•°ä¹‹é—´çš„æ¯”ä¾‹ã€‚æ”¯æŒåº¦è¶Šé«˜ï¼Œä»£è¡¨è¿™ä¸ªç»„åˆå‡ºç°çš„æ¦‚ç‡è¶Šå¤§ã€‚ç½®ä¿¡åº¦æ˜¯ä¸€ä¸ªæ¡ä»¶æ¦‚å¿µï¼Œå°±æ˜¯åœ¨ A å‘ç”Ÿçš„æƒ…å†µä¸‹ï¼ŒB å‘ç”Ÿçš„æ¦‚ç‡æ˜¯å¤šå°‘ã€‚æå‡åº¦ä»£è¡¨çš„æ˜¯â€œå•†å“ A çš„å‡ºç°ï¼Œå¯¹å•†å“ B çš„å‡ºç°æ¦‚ç‡æå‡äº†å¤šå°‘â€ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨è¿™ä¸ªå·¥å…·åŒ…ï¼Œè·‘ä¸€ä¸‹ä¸ŠèŠ‚è¯¾ä¸­è®²åˆ°çš„è¶…å¸‚è´­ç‰©çš„ä¾‹å­ã€‚ä¸‹é¢æ˜¯å®¢æˆ·è´­ä¹°çš„å•†å“åˆ—è¡¨ï¼šå…·ä½“å®ç°çš„ä»£ç å¦‚ä¸‹ï¼š123456789101112from efficient_apriori import apriori# è®¾ç½®æ•°æ®é›†data = [('ç‰›å¥¶','é¢åŒ…','å°¿å¸ƒ'), ('å¯ä¹','é¢åŒ…', 'å°¿å¸ƒ', 'å•¤é…’'), ('ç‰›å¥¶','å°¿å¸ƒ', 'å•¤é…’', 'é¸¡è›‹'), ('é¢åŒ…', 'ç‰›å¥¶', 'å°¿å¸ƒ', 'å•¤é…’'), ('é¢åŒ…', 'ç‰›å¥¶', 'å°¿å¸ƒ', 'å¯ä¹')]# æŒ–æ˜é¢‘ç¹é¡¹é›†å’Œé¢‘ç¹è§„åˆ™itemsets, rules = apriori(data, min_support=0.5, min_confidence=1)print(itemsets)print(rules)ç»“æœï¼š1234&#123;1: &#123;('å•¤é…’',): 3, ('å°¿å¸ƒ',): 5, ('ç‰›å¥¶',): 4, ('é¢åŒ…',): 4&#125;, 2: &#123;('å•¤é…’', 'å°¿å¸ƒ'): 3, ('å°¿å¸ƒ', 'ç‰›å¥¶'): 4, ('å°¿å¸ƒ', 'é¢åŒ…'): 4, ('ç‰›å¥¶', 'é¢åŒ…'): 3&#125;, 3: &#123;('å°¿å¸ƒ', 'ç‰›å¥¶', 'é¢åŒ…'): 3&#125;&#125;[&#123;å•¤é…’&#125; -&gt; &#123;å°¿å¸ƒ&#125;, &#123;ç‰›å¥¶&#125; -&gt; &#123;å°¿å¸ƒ&#125;, &#123;é¢åŒ…&#125; -&gt; &#123;å°¿å¸ƒ&#125;, &#123;ç‰›å¥¶, é¢åŒ…&#125; -&gt; &#123;å°¿å¸ƒ&#125;]ä½ èƒ½ä»ä»£ç ä¸­çœ‹å‡ºæ¥ï¼Œdata æ˜¯ä¸ª List æ•°ç»„ç±»å‹ï¼Œå…¶ä¸­æ¯ä¸ªå€¼éƒ½å¯ä»¥æ˜¯ä¸€ä¸ªé›†åˆã€‚å®é™…ä¸Šä½ ä¹Ÿå¯ä»¥æŠŠ data æ•°ç»„ä¸­çš„æ¯ä¸ªå€¼è®¾ç½®ä¸º List æ•°ç»„ç±»å‹ï¼Œæ¯”å¦‚ï¼š123456data = [['ç‰›å¥¶','é¢åŒ…','å°¿å¸ƒ'], ['å¯ä¹','é¢åŒ…', 'å°¿å¸ƒ', 'å•¤é…’'], ['ç‰›å¥¶','å°¿å¸ƒ', 'å•¤é…’', 'é¸¡è›‹'], ['é¢åŒ…', 'ç‰›å¥¶', 'å°¿å¸ƒ', 'å•¤é…’'], ['é¢åŒ…', 'ç‰›å¥¶', 'å°¿å¸ƒ', 'å¯ä¹']]ä¸¤è€…çš„è¿è¡Œç»“æœæ˜¯ä¸€æ ·çš„ï¼Œefficient-apriori å·¥å…·åŒ…æŠŠæ¯ä¸€æ¡æ•°æ®é›†é‡Œçš„é¡¹å¼éƒ½æ”¾åˆ°äº†ä¸€ä¸ªé›†åˆä¸­è¿›è¡Œè¿ç®—ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘å®ƒä»¬ä¹‹é—´çš„å…ˆåé¡ºåºã€‚å› ä¸ºå®é™…æƒ…å†µä¸‹ï¼ŒåŒä¸€ä¸ªè´­ç‰©ç¯®ä¸­çš„ç‰©å“ä¹Ÿä¸éœ€è¦è€ƒè™‘è´­ä¹°çš„å…ˆåé¡ºåºã€‚è€Œå…¶ä»–çš„ Apriori ç®—æ³•å¯èƒ½ä¼šå› ä¸ºè€ƒè™‘äº†å…ˆåé¡ºåºï¼Œå‡ºç°è®¡ç®—é¢‘ç¹é¡¹é›†ç»“æœä¸å¯¹çš„æƒ…å†µã€‚æ‰€ä»¥è¿™é‡Œé‡‡ç”¨çš„æ˜¯ efficient-apriori è¿™ä¸ªå·¥å…·åŒ…ã€‚**æŒ–æ˜-å¯¼æ¼”æ˜¯å¦‚ä½•é€‰æ‹©æ¼”å‘˜åœ¨å®é™…å·¥ä½œä¸­ï¼Œæ•°æ®é›†æ˜¯éœ€è¦è‡ªå·±æ¥å‡†å¤‡çš„ï¼Œæ¯”å¦‚ä»Šå¤©æˆ‘ä»¬è¦æŒ–æ˜å¯¼æ¼”æ˜¯å¦‚ä½•é€‰æ‹©æ¼”å‘˜çš„æ•°æ®æƒ…å†µï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å…¬å¼€çš„æ•°æ®é›†å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¹‹å‰è®²åˆ°çš„ Python çˆ¬è™«è¿›è¡Œæ•°æ®é‡‡é›†ã€‚ä¸åŒå¯¼æ¼”é€‰æ‹©æ¼”å‘˜çš„è§„åˆ™æ˜¯ä¸åŒçš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å…ˆæŒ‡å®šå¯¼æ¼”ã€‚æ•°æ®æºæˆ‘ä»¬é€‰ç”¨è±†ç“£ç”µå½±ã€‚å…ˆæ¥æ¢³ç†ä¸‹é‡‡é›†çš„å·¥ä½œæµç¨‹ã€‚é¦–å…ˆæˆ‘ä»¬å…ˆåœ¨https://movie.douban.comæœç´¢æ¡†ä¸­è¾“å…¥å¯¼æ¼”å§“åï¼Œæ¯”å¦‚â€œå®æµ©â€ã€‚é¡µé¢ä¼šå‘ˆç°å‡ºæ¥å¯¼æ¼”ä¹‹å‰çš„æ‰€æœ‰ç”µå½±ï¼Œç„¶åå¯¹é¡µé¢è¿›è¡Œè§‚å¯Ÿï¼Œä½ èƒ½è§‚å¯Ÿåˆ°ä»¥ä¸‹å‡ ä¸ªç°è±¡ï¼šé¡µé¢é»˜è®¤æ˜¯ 15 æ¡æ•°æ®åé¦ˆï¼Œç¬¬ä¸€é¡µä¼šè¿”å› 16 æ¡ã€‚å› ä¸ºç¬¬ä¸€æ¡æ•°æ®å®é™…ä¸Šè¿™ä¸ªå¯¼æ¼”çš„æ¦‚è§ˆï¼Œä½ å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€æ¡å¹¿å‘Šçš„æ’å…¥ï¼Œä¸‹é¢æ‰æ˜¯çœŸæ­£çš„è¿”å›ç»“æœã€‚æ¯æ¡æ•°æ®çš„æœ€åä¸€è¡Œæ˜¯ç”µå½±çš„æ¼”å‡ºäººå‘˜çš„ä¿¡æ¯ï¼Œç¬¬ä¸€ä¸ªäººå‘˜æ˜¯å¯¼æ¼”ï¼Œå…¶ä½™ä¸ºæ¼”å‘˜å§“åã€‚å§“åä¹‹é—´ç”¨â€œ/â€åˆ†å‰²ã€‚æœ‰äº†è¿™äº›è§‚å¯Ÿä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼–å†™æŠ“å–ç¨‹åºäº†ã€‚åœ¨ä»£ç è®²è§£ä¸­ä½ èƒ½çœ‹å‡ºè¿™ä¸¤ç‚¹è§‚å¯Ÿçš„ä½œç”¨ã€‚æŠ“å–ç¨‹åºçš„ç›®çš„æ˜¯ä¸ºäº†ç”Ÿæˆå®æµ©å¯¼æ¼”ï¼ˆä½ ä¹Ÿå¯ä»¥æŠ“å–å…¶ä»–å¯¼æ¼”ï¼‰çš„æ•°æ®é›†ï¼Œç»“æœä¼šä¿å­˜åœ¨ csv æ–‡ä»¶ä¸­ã€‚å®Œæ•´çš„æŠ“å–ä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566# -*- coding: utf-8 -*-# ä¸‹è½½æŸä¸ªå¯¼æ¼”çš„ç”µå½±æ•°æ®é›†from efficient_apriori import apriorifrom lxml import etreeimport timefrom selenium import webdriverimport csvdriver = webdriver.Chrome()# è®¾ç½®æƒ³è¦ä¸‹è½½çš„å¯¼æ¼” æ•°æ®é›†director = u'å®æµ©'# å†™CSVæ–‡ä»¶file_name = './' + director + '.csv'base_url = 'https://movie.douban.com/subject_search?search_text='+director+'&amp;cat=1002&amp;start='out = open(file_name,'w', newline='', encoding='utf-8-sig')csv_write = csv.writer(out, dialect='excel')flags=[]# ä¸‹è½½æŒ‡å®šé¡µé¢çš„æ•°æ®def download(request_url): driver.get(request_url) time.sleep(1) html = driver.find_element_by_xpath(\"//*\").get_attribute(\"outerHTML\") html = etree.HTML(html) # è®¾ç½®ç”µå½±åç§°ï¼Œå¯¼æ¼”æ¼”å‘˜ çš„XPATH movie_lists = html.xpath(\"/html/body/div[@id='wrapper']/div[@id='root']/div[1]//div[@class='item-root']/div[@class='detail']/div[@class='title']/a[@class='title-text']\") name_lists = html.xpath(\"/html/body/div[@id='wrapper']/div[@id='root']/div[1]//div[@class='item-root']/div[@class='detail']/div[@class='meta abstract_2']\") # è·å–è¿”å›çš„æ•°æ®ä¸ªæ•° num = len(movie_lists) if num &gt; 15: #ç¬¬ä¸€é¡µä¼šæœ‰16æ¡æ•°æ® # é»˜è®¤ç¬¬ä¸€ä¸ªä¸æ˜¯ï¼Œæ‰€ä»¥éœ€è¦å»æ‰ movie_lists = movie_lists[1:] name_lists = name_lists[1:] for (movie, name_list) in zip(movie_lists, name_lists): # ä¼šå­˜åœ¨æ•°æ®ä¸ºç©ºçš„æƒ…å†µ if name_list.text is None: continue # æ˜¾ç¤ºä¸‹æ¼”å‘˜åç§° print(name_list.text) names = name_list.text.split('/') # åˆ¤æ–­å¯¼æ¼”æ˜¯å¦ä¸ºæŒ‡å®šçš„director if names[0].strip() == director and movie.text not in flags: # å°†ç¬¬ä¸€ä¸ªå­—æ®µè®¾ç½®ä¸ºç”µå½±åç§° names[0] = movie.text flags.append(movie.text) csv_write.writerow(names) print('OK') # ä»£è¡¨è¿™é¡µæ•°æ®ä¸‹è½½æˆåŠŸ print(num) if num &gt;= 14: #æœ‰å¯èƒ½ä¸€é¡µä¼šæœ‰14ä¸ªç”µå½± # ç»§ç»­ä¸‹ä¸€é¡µ return True else: # æ²¡æœ‰ä¸‹ä¸€é¡µ return False# å¼€å§‹çš„IDä¸º0ï¼Œæ¯é¡µå¢åŠ 15start = 0while start&lt;10000: #æœ€å¤šæŠ½å–1ä¸‡éƒ¨ç”µå½± request_url = base_url + str(start) # ä¸‹è½½æ•°æ®ï¼Œå¹¶è¿”å›æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ flag = download(request_url) if flag: start = start + 15 else: breakout.close()print('finished')çˆ¬å–çš„ä»£ç åœ¨è¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œå…¶ä¸­æœ‰ä¸€ç‚¹å°±æ˜¯è¿™é‡Œç”¨åˆ°äº†seleniumæ¨¡æ‹Ÿæ‰“å¼€çª—å£çˆ¬å–ã€‚ä¸‹é¢æ˜¯çˆ¬å–ä¸‹æ¥çš„æ•°æ®ï¼šæˆ‘ä»¬ç”¨è·å–åˆ°çš„å°‘é‡å®æµ©æ•°æ®ï¼Œæ¥åšä¸€æ¬¡å…³è”è§„åˆ™åˆ†æï¼š12345678910111213141516171819# -*- coding: utf-8 -*-from efficient_apriori import aprioriimport csvdirector = u'å®æµ©'file_name = './'+director+'.csv'lists = csv.reader(open(file_name, 'r', encoding='utf-8-sig'))# æ•°æ®åŠ è½½data = []for names in lists: name_new = [] for name in names: # å»æ‰æ¼”å‘˜æ•°æ®ä¸­çš„ç©ºæ ¼ name_new.append(name.strip()) data.append(name_new[1:])# æŒ–æ˜é¢‘ç¹é¡¹é›†å’Œå…³è”è§„åˆ™itemsets, rules = apriori(data, min_support=0.5, min_confidence=1)print(itemsets)print(rules)ä»£ç ä¸­ä½¿ç”¨çš„ apriori æ–¹æ³•å’Œå¼€å¤´ä¸­ç”¨ Apriori è·å–è´­ç‰©ç¯®è§„å¾‹çš„æ–¹æ³•ç±»ä¼¼ï¼Œæ¯”å¦‚ä»£ç ä¸­éƒ½è®¾å®šäº†æœ€å°æ”¯æŒåº¦å’Œæœ€å°ç½®ä¿¡ç³»æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æ”¯æŒåº¦å¤§äº 50%ï¼Œç½®ä¿¡ç³»æ•°ä¸º 1 çš„é¢‘ç¹é¡¹é›†å’Œå…³è”è§„åˆ™ã€‚è¿™æ˜¯æœ€åçš„è¿è¡Œç»“æœï¼š123&#123;1: &#123;('å¾å³¥',): 5, ('é»„æ¸¤',): 6&#125;, 2: &#123;('å¾å³¥', 'é»„æ¸¤'): 5&#125;&#125;[&#123;å¾å³¥&#125; -&gt; &#123;é»„æ¸¤&#125;]ä½ èƒ½çœ‹å‡ºæ¥ï¼Œå®æµ©å¯¼æ¼”å–œæ¬¢ç”¨å¾å³¥å’Œé»„æ¸¤ï¼Œå¹¶ä¸”æœ‰å¾å³¥çš„æƒ…å†µä¸‹ï¼Œä¸€èˆ¬éƒ½ä¼šç”¨é»„æ¸¤ã€‚ä½ ä¹Ÿå¯ä»¥ç”¨ä¸Šé¢çš„ä»£ç æ¥æŒ–æ˜ä¸‹å…¶ä»–å¯¼æ¼”é€‰æ‹©æ¼”å‘˜çš„è§„å¾‹ã€‚æ€»ç»“Apriori ç®—æ³•çš„æ ¸å¿ƒå°±æ˜¯ç†è§£é¢‘ç¹é¡¹é›†å’Œå…³è”è§„åˆ™ã€‚åœ¨ç®—æ³•è¿ç®—çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜è¦é‡ç‚¹æŒæ¡å¯¹æ”¯æŒåº¦ã€ç½®ä¿¡åº¦å’Œæå‡åº¦çš„ç†è§£ã€‚åœ¨å·¥å…·ä½¿ç”¨ä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨ efficient-apriori è¿™ä¸ªå·¥å…·åŒ…ï¼Œå®ƒä¼šæŠŠæ¯ä¸€æ¡æ•°æ®ä¸­çš„é¡¹ï¼ˆitemï¼‰æ”¾åˆ°ä¸€ä¸ªé›†åˆï¼ˆç¯®å­ï¼‰é‡Œæ¥å¤„ç†ï¼Œä¸è€ƒè™‘é¡¹ï¼ˆitemï¼‰ä¹‹é—´çš„å…ˆåé¡ºåºã€‚åœ¨å®é™…è¿ç”¨ä¸­ä½ è¿˜éœ€è¦çµæ´»å¤„ç†ï¼Œæ¯”å¦‚å¯¼æ¼”å¦‚ä½•é€‰æ‹©æ¼”å‘˜è¿™ä¸ªæ¡ˆä¾‹ï¼Œè™½ç„¶å·¥å…·çš„ä½¿ç”¨ä¼šå¾ˆæ–¹ä¾¿ï¼Œä½†é‡è¦çš„è¿˜æ˜¯æ•°æ®æŒ–æ˜å‰çš„å‡†å¤‡è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯è·å–æŸä¸ªå¯¼æ¼”çš„ç”µå½±æ•°æ®é›†ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Apriori","slug":"Apriori","permalink":"cpeixin.cn/tags/Apriori/"}]},{"title":"æ•°æ®ä»“åº“ - å…ƒæ•°æ®ç®¡ç†","slug":"æ•°æ®ä»“åº“-å…ƒæ•°æ®ç®¡ç†","date":"2018-08-30T13:20:15.000Z","updated":"2020-08-02T13:25:23.733Z","comments":true,"path":"2018/08/30/æ•°æ®ä»“åº“-å…ƒæ•°æ®ç®¡ç†/","link":"","permalink":"cpeixin.cn/2018/08/30/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93-%E5%85%83%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/","excerpt":"","text":"å¥½æ–‡åˆ†äº«https://www.jianshu.com/p/9fe3ff2bbe99","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"æ•°æ®ä»“åº“","slug":"æ•°æ®ä»“åº“","permalink":"cpeixin.cn/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"}]},{"title":"æ•°æ®ä»“åº“ - æ•°æ®åˆ†å±‚","slug":"æ•°æ®ä»“åº“æ•°æ®åˆ†å±‚","date":"2018-08-25T15:26:15.000Z","updated":"2020-08-02T13:25:44.345Z","comments":true,"path":"2018/08/25/æ•°æ®ä»“åº“æ•°æ®åˆ†å±‚/","link":"","permalink":"cpeixin.cn/2018/08/25/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E6%95%B0%E6%8D%AE%E5%88%86%E5%B1%82/","excerpt":"","text":"ç®€è¿°åœ¨ä¸Šç¯‡åšå®¢â€˜æ•°æ®ä»“åº“å»ºæ¨¡æ–¹æ³•â€™ä¸­æˆ‘ä»¬æ¢è®¨è¿‡æ•°æ®æ¨¡å‹çš„ç›¸å…³é—®é¢˜ï¼Œå®é™…åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å›¢é˜Ÿåœ¨ç¡®å®šäº†æ•°æ®æ¨¡å‹ä½¿ç”¨ç»å…¸çš„æ˜Ÿå‹æ¨¡å‹å’Œ3NFä¹‹åï¼Œæ¥ä¸‹æ¥è¦è¿›è¡Œè®¨è®ºçš„é—®é¢˜åˆ™æ˜¯ï¼Œæ¯å¤©å¤§æ‰¹é‡çš„æ•°æ®ï¼Œåº”è¯¥æ€æ ·çš„æ”¾è¿›åº“ä¸­ï¼Œæ€ä¹ˆå­˜æ”¾åˆç†ã€‚åœ¨æ•°æ®å¯¹æ¥ä¸šåŠ¡ä¹‹å‰ï¼Œè¦ç»è¿‡å“ªäº›æç‚¼çš„è¿‡ç¨‹ï¼Œåœ¨æ•´ä¸ªæç‚¼çš„è¿‡ç¨‹ä¸­ï¼Œè¦åˆ†æˆå‡ ä¸ªæ­¥éª¤ï¼Œè¿˜æ˜¯ä¸€æ­¥åˆ°ä½çš„ç›´æ¥ä»åŸå§‹æ•°æ®ETLç»™ä¸šåŠ¡äººå‘˜ã€‚å…¶ä¸­æåˆ°çš„è¿™ä¸ªæç‚¼è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯æ•°æ®åˆ†å±‚çš„è¿‡ç¨‹ï¼Œåˆ†å±‚è®¾è®¡çš„å¥½ï¼Œæ•°æ®åˆ†å¸ƒåˆç†ï¼ŒèŠ‚çº¦è®¡ç®—èµ„æºï¼Œé¿å…å¤šä½™çš„æ•°æ®å¼€å‘ã€‚æ‰€ä»¥ï¼Œæ•°æ®åˆ†å±‚æ˜¯æ•°æ®ä»“åº“å»ºè®¾ä¸­ï¼Œé‡è¦çš„ä¸€ç¯ã€‚å„ç§é‡å¤è®¡ç®—ï¼Œä¸¥é‡æµªè´¹äº†è®¡ç®—èµ„æºï¼Œéœ€è¦ä¼˜åŒ–æ€§èƒ½ã€‚ä¸ºä»€ä¹ˆè¦æ•°æ®åˆ†å±‚æˆ‘ä»¬å¯¹æ•°æ®è¿›è¡Œåˆ†å±‚çš„ä¸€ä¸ªä¸»è¦åŸå› å°±æ˜¯å¸Œæœ›åœ¨ç®¡ç†æ•°æ®çš„æ—¶å€™ï¼Œèƒ½å¯¹æ•°æ®æœ‰ä¸€ä¸ªæ›´åŠ æ¸…æ™°çš„æŒæ§ï¼Œè¯¦ç»†æ¥è®²ï¼Œä¸»è¦æœ‰ä¸‹é¢å‡ ä¸ªåŸå› ï¼šæ¸…æ™°æ•°æ®ç»“æ„ï¼šæ¯ä¸€ä¸ªæ•°æ®åˆ†å±‚éƒ½æœ‰å®ƒçš„ä½œç”¨åŸŸï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ä½¿ç”¨è¡¨çš„æ—¶å€™èƒ½æ›´æ–¹ä¾¿åœ°å®šä½å’Œç†è§£ã€‚æ•°æ®è¡€ç¼˜è¿½è¸ªï¼šç®€å•æ¥è®²å¯ä»¥è¿™æ ·ç†è§£ï¼Œæˆ‘ä»¬æœ€ç»ˆç»™ä¸šåŠ¡è¯šä¿¡çš„æ˜¯ä¸€èƒ½ç›´æ¥ä½¿ç”¨çš„å¼ ä¸šåŠ¡è¡¨ï¼Œä½†æ˜¯å®ƒçš„æ¥æºæœ‰å¾ˆå¤šï¼Œå¦‚æœæœ‰ä¸€å¼ æ¥æºè¡¨å‡ºé—®é¢˜äº†ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå¿«é€Ÿå‡†ç¡®åœ°å®šä½åˆ°é—®é¢˜ï¼Œå¹¶æ¸…æ¥šå®ƒçš„å±å®³èŒƒå›´ã€‚å‡å°‘é‡å¤å¼€å‘ï¼šè§„èŒƒæ•°æ®åˆ†å±‚ï¼Œå¼€å‘ä¸€äº›é€šç”¨çš„ä¸­é—´å±‚æ•°æ®ï¼Œèƒ½å¤Ÿå‡å°‘æå¤§çš„é‡å¤è®¡ç®—ã€‚æŠŠå¤æ‚é—®é¢˜ç®€å•åŒ–ã€‚è®²ä¸€ä¸ªå¤æ‚çš„ä»»åŠ¡åˆ†è§£æˆå¤šä¸ªæ­¥éª¤æ¥å®Œæˆï¼Œæ¯ä¸€å±‚åªå¤„ç†å•ä¸€çš„æ­¥éª¤ï¼Œæ¯”è¾ƒç®€å•å’Œå®¹æ˜“ç†è§£ã€‚è€Œä¸”ä¾¿äºç»´æŠ¤æ•°æ®çš„å‡†ç¡®æ€§ï¼Œå½“æ•°æ®å‡ºç°é—®é¢˜ä¹‹åï¼Œå¯ä»¥ä¸ç”¨ä¿®å¤æ‰€æœ‰çš„æ•°æ®ï¼Œåªéœ€è¦ä»æœ‰é—®é¢˜çš„æ­¥éª¤å¼€å§‹ä¿®å¤ã€‚å±è”½åŸå§‹æ•°æ®çš„å¼‚å¸¸ã€‚å±è”½ä¸šåŠ¡çš„å½±å“ï¼Œä¸å¿…æ”¹ä¸€æ¬¡ä¸šåŠ¡å°±éœ€è¦é‡æ–°æ¥å…¥æ•°æ®ã€‚æ€ä¹ˆåˆ†å±‚åœ¨è¿™é‡Œï¼Œå°±æ‹¿æˆ‘ä»¬å›¢é˜Ÿå¯¹æˆ‘ä»¬å…¬å¸è®¾è®¡çš„æ•°æ®ä»“åº“æ¥ä¸¾ä¾‹ã€‚é¦–å…ˆå‘¢ï¼Œæˆ‘ä»¬å…¬å¸çš„æ•°æ®é‡çº§å’Œæ•°æ®ä¸»é¢˜å¤æ‚åº¦ï¼Œç›¸å½“äºä¸€ä¸ªäºŒçº¿äº’è”ç½‘å…¬å¸ï¼Œæ•°æ®ä¸»é¢˜ç›®å‰è¿™ä¸€ç‰ˆæ•°æ®ä»“åº“å¯ä»¥åˆ†ä¸ºç”¨æˆ·è¡Œä¸ºï¼Œè®¢å•ï¼Œæ¸¸æˆæ´»åŠ¨ç­‰7ä¸ªä¸»é¢˜æ•°æ®ï¼Œä¸šåŠ¡å¹¶ä¸æ˜¯å¾ˆå¤æ‚ã€‚æ‰€ä»¥åœ¨æ•°æ®åˆ†å±‚ä¸Šï¼Œæ€»å…±åˆ†æˆä¸‰å±‚ã€‚æºæ•°æ®å±‚ ï¼ˆdw = stagingï¼‰å®½è¡¨æ•°æ®å±‚ ï¼ˆdw = dwï¼‰æŒ‡æ ‡æ•°æ®å±‚ ï¼ˆdw = subjectNameï¼‰æºæ•°æ®å±‚æºæ•°æ®å±‚æ‹‰å–ä¸šåŠ¡è¡¨æœ‰20å¼ å·¦å³ï¼Œä½¿ç”¨sparkè¯»å–åº•å±‚RDBMSæ¥è·å–æ•°æ®ï¼Œå†™å…¥åˆ°Hiveä¸­ï¼Œåœ¨è¿™ä¸€å±‚ä¸­ï¼Œé™¤äº†é€‰æ‹©åˆé€‚çš„åˆ†åŒºå­—æ®µï¼Œæˆ‘ä»¬çš„åˆ†æä¸šåŠ¡ä¸­ï¼Œæ—¶é—´ç²’åº¦å¤šä¸ºå¤©ä¸ºå•ä½ï¼Œä¸šåŠ¡æ•°æ®æ¥æºäºå¤šä¸ªäº§å“çº¿ï¼Œæ‰€ä»¥è¿™ä¸€å±‚ï¼Œä¼šä»¥snapshot_dateï¼ˆâ€˜YYYY-MM-DDâ€™ï¼‰å’Œproduct_idä¸ºåˆ†åŒºå­—æ®µï¼Œå¯¹æ•°æ®è¡¨è¿›è¡Œåˆ†åŒºå¤–ï¼Œä¸åšä»»ä½•æ•°æ®å¤„ç†ï¼Œä¸åšè„æ•°æ®å¤„ç†ï¼Œä¸åšåˆå¹¶ï¼Œä¿æŒæ•°æ®çš„åŸå§‹æ€§ï¼Œéšæ—¶å¯ä»¥åšåˆ°è¿½æœ¬æº¯æºã€‚æˆ‘ä»¬å¯¹äºè¿‘æºæ•°æ®å±‚çš„å®šä½æ˜¯å¯ä»¥â€å¿«é€Ÿâ€çš„æ„å»ºåŸºç¡€æ•°æ®å¹³å°. ä¸åšä¸šåŠ¡ç›¸å…³çš„å¤„ç†å¯ä»¥è®©è¿™éƒ¨åˆ†çš„å·¥ä½œä¸“æ³¨åœ¨å¤§æ•°æ®æ¶æ„æ­£ç¡®æ€§å’Œç¨³å®šæ€§çš„é—®é¢˜ï¼Œè¿‘æºæ•°æ®å±‚å‡ºç°ä»¥å, å®é™…ä¸Šæˆ‘ä»¬å·²ç»å¯ä»¥å¼€å§‹ä¸»è¦çš„æ•°æ®åˆ†æå·¥ä½œäº†ã€‚å®½è¡¨æ•°æ®å±‚å®½è¡¨æ•°æ®å±‚çš„æ•°æ®æ˜¯ä»æºæ•°æ®å±‚ç»è¿‡ETLå­—æ®µæ¸…æ´—ï¼Œè®¡ç®—å¹¶ä¸”ç›¸å…³ä¸»é¢˜è¡¨ï¼Œç»´åº¦è¡¨è¿›è¡Œjoinè€Œæ¥çš„ã€‚ä¾‹å¦‚è®¢å•è¡¨ï¼šOrdersè¡¨order_*ä¸ºè®¢å•ä¸»é¢˜ï¼ˆorder_id,order_number,order_amount,create_dateâ€¦ï¼‰t_users_dim ç”¨æˆ·ç»´åº¦è¡¨(user_id,city,last_login_time,device_typeâ€¦)t_activity_dim æ´»åŠ¨ç»´åº¦è¡¨(activity_id,activity_name,create_dateâ€¦)t_promotion_dim ä¼˜æƒ ç»´åº¦è¡¨(promotion_id,promotion_name,promotion_typeâ€¦)t_deposit å……å€¼è¡¨(deposit_id,deposit_type,channal,deposit_timeâ€¦)ä»¥ä¸Šäº”å¼ è¡¨ç»è¿‡ç›¸å…³é”®joinå°±ç»„æˆäº†è®¢å•å®½è¡¨ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šæŒ‡æ ‡æ•°æ®å±‚æŒ‡æ ‡æ•°æ®å±‚æ˜¯ä»å®½è¡¨æ•°æ®å±‚è®¡ç®—è€Œæ¥ï¼Œè¿™ä¸€å±‚æˆ‘ä»¬é‡‡ç”¨çš„ç­–ç•¥æ˜¯ç”±æ€»åˆ°åˆ†ï¼Œå…³è”æ—¶é—´ç»´åº¦è¡¨ï¼Œç¼©å°æ—¶é—´ç²’åº¦åˆ°å°æ—¶çº§åˆ«ã€‚å¯ä»¥å¯¹è¿è¥äººå‘˜æä¾›å°æ—¶çº§åˆ«çš„æ•°æ®æŒ‡æ ‡ã€‚å¯¹äºä¸€äº›é‡‘é¢ç›¸å…³æ•°æ®è¡¨ï¼Œä¹Ÿä¼šç»è¿‡è®¡ç®—æ·»åŠ ä¸€äº›å¸¸ç”¨çš„æ•°æ®æ¨¡å‹ï¼Œä¾‹å¦‚æŸç”¨æˆ·è¿‘20æ¬¡å……å€¼çš„maxå€¼å’Œminå€¼ï¼Œä¸­ä½æ•°ï¼Œå››åˆ†ä½æ•°ç­‰å­—æ®µã€‚è¿™ä¸€å±‚ä¹Ÿæ˜¯æœ€ä¸ç¨³å®šçš„ä¸€å±‚ï¼Œç»å¸¸è¦æ ¹æ®ä¸šåŠ¡çš„å˜åŒ–å¢åŠ å­—æ®µæˆ–è€…æ–°åŠ æŒ‡æ ‡æ•°æ®è¡¨ã€‚ç”±äºçš„ä¾èµ–Hiveå»ºè®¾çš„æ•°æ®ä»“åº“ï¼Œé‚£ä¹ˆå¯¹äºå¢åŠ å­—æ®µçš„è¿™ä»¶äº‹ï¼Œè¦å°å¿ƒå¯¹æ•°æ®çš„å½±å“ï¼Œæ³¨æ„é€‰æ‹©åˆé€‚çš„Hiveè¡¨æ ¼å¼ã€‚è¿™å±‚å°±ä¸ç”»å›¾äº† æœ‰ç‚¹å›°äº† å›°äº†ï½ï½ï½ï½è¿™ç¯‡æ•°æ®ä»“åº“æ•°æ®åˆ†å±‚è®¾è®¡ï¼Œæ˜¯æ ¹æ®æˆ‘ä»¬å…¬å¸çš„ä¸šåŠ¡æ•°æ®å’Œä¸»é¢˜æ¥è®¾è®¡çš„ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¤§æ•°æ®å·¥ç¨‹å›¢é˜Ÿçš„è¿™å‡ ä¸ªæ¸£æ¸£å·¥ç¨‹å¸ˆå’Œæ¶æ„å¸ˆä¸€èµ·å•†è®¨çš„ç»“æœæ–¹æ¡ˆï¼Œå¯¹äºå…¶ä»–è¡Œä¸šå’Œå¤§è§„æ¨¡æµ·é‡æ•°æ®è‚¯å®šæ˜¯ä¸èƒ½å…¨éƒ¨é€‚ç”¨çš„ã€‚åœ¨å†™è¿™ç¯‡æ–‡ç« å‰ï¼Œæˆ‘æœ‰çœ‹è¿‡ç¾å›¢æŠ€æœ¯å›¢é˜Ÿç¾å›¢ç‚¹è¯„é…’æ—…æ•°æ®ä»“åº“å»ºè®¾å®è·µè¿™ç¯‡æ–‡ç« ï¼Œå‘ç°ä¸šåŠ¡å¤æ‚åº¦å’Œæ•°æ®è§„æ¨¡å¯¹æ•°æ®å»ºæ¨¡å’Œæ•°æ®åˆ†å±‚çš„å½±å“å¾ˆå¤§ï¼Œåƒæˆ‘ä»¬å…¬å¸çš„æ•°æ®é‡é‡çº§è¦å®Œå…¨æŒ‰ç…§ç¾å›¢æ•°ä»“å»åšï¼Œæ˜¯å®Œå…¨æ²¡æœ‰å¿…è¦çš„ï¼Œè€Œä¸”ä¼šå¼„çš„æ›´åŠ å¤æ‚ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæƒ³è¡¨æ˜çš„å°±æ˜¯ï¼Œå¯¹äºæ•°ä»“çš„å»ºè®¾ï¼Œè¦é€‰æ‹©é€‚åˆè‡ªå·±çš„ï¼Œå¯¹è‡ªå·±é‡èº«å®šåˆ¶ï¼Œç…§æ¬æŸä¸ªå…¬å¸çš„ï¼Œæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œåè€Œå¯èƒ½ä¼šå¢åŠ ä½¿ç”¨çš„éš¾åº¦ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"æ•°æ®ä»“åº“","slug":"æ•°æ®ä»“åº“","permalink":"cpeixin.cn/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"}]},{"title":"æ•°æ®ä»“åº“ - å»ºæ¨¡æ–¹æ³•","slug":"æ•°æ®ä»“åº“å»ºæ¨¡æ–¹æ³•","date":"2018-08-24T12:26:15.000Z","updated":"2020-08-02T13:24:33.547Z","comments":true,"path":"2018/08/24/æ•°æ®ä»“åº“å»ºæ¨¡æ–¹æ³•/","link":"","permalink":"cpeixin.cn/2018/08/24/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%BB%BA%E6%A8%A1%E6%96%B9%E6%B3%95/","excerpt":"","text":"èƒŒæ™¯æ¥ç€ä¸Šä¸ªæ–‡ç« æ•°æ®ä»“åº“æ¶æ„è®¾è®¡ï¼Œæƒ³å†™ä¸€ç¯‡æ•°æ®ä»“åº“å¸¸ç”¨æ¨¡å‹çš„æ–‡ç« ï¼Œä½†æ˜¯è‡ªå·±å¯¹æ•°æ®ä»“åº“æ¨¡å‹çš„ç†è§£ç¨‹åº¦å’Œå»ºè®¾æ¶æ„å¹¶æ²¡æœ‰ä¸‹é¢è¿™ä¸ªæŠ€æœ¯ä¸“å®¶ç†è§£çš„æ·±åˆ»ï¼Œå¹¶ä¸”è‡ªå·±å»ç»„ç»‡è¯­è¨€ï¼Œå¯èƒ½ä¼šæœ‰ä¸å‡†ç¡®çš„åœ°æ–¹ï¼Œæ€•å½±å“å¤§å®¶å¯¹æ•°æ®ä»“åº“å»ºæ¨¡çš„ç†è§£ï¼Œæ•°æ®ä»“åº“å±äºä¸€ä¸ªå·¥ç¨‹å­¦ç§‘ï¼Œåœ¨è®¾è®¡ä¸Šè¦ä½“éªŒå‡ºå·¥ç¨‹ä¸¥è°¨æ€§ï¼Œæ‰€ä»¥è¿™æ¬¡å‘å¤§å®¶æ¨èè¿™ç¯‡æ–‡ç« ï¼Œæ¯•ç«ŸIBMåœ¨æ•°æ®ä»“åº“å’Œæ•°æ®é›†å¸‚æ–¹é¢å·²ç»åšå¾—å¾ˆæˆç†Ÿäº†ï¼Œå·²ç»æœ‰æˆå‹çš„å•†ä¸šæ•°æ®ä»“åº“ç»„ä»¶ï¼Œè¿™ç¯‡æ–‡ç« å†™çš„å¾ˆå¥½ï¼Œå¯ä»¥è®©å¤§å®¶å¾ˆå¥½çš„ç†è§£æ•°æ®ä»“åº“ã€‚ç‰ˆæƒä½œè€… å‘¨ä¸‰ä¿(zhousb@cn.ibm.com) IBM è½¯ä»¶éƒ¨ä¿¡æ¯æŠ€æœ¯ä¸“å®¶.åŸæ–‡åœ°å€æœ¬æ–‡ä¸»è¦çš„ä¸»çº¿å°±æ˜¯å›ç­”ä¸‹é¢ä¸‰ä¸ªé—®é¢˜ï¼šä»€ä¹ˆæ˜¯æ•°æ®æ¨¡å‹ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®æ¨¡å‹å¦‚ä½•å»ºè®¾æ•°æ®æ¨¡å‹ä»€ä¹ˆæ˜¯æ•°æ®æ¨¡å‹æ•°æ®æ¨¡å‹æ˜¯æŠ½è±¡æè¿°ç°å®ä¸–ç•Œçš„ä¸€ç§å·¥å…·å’Œæ–¹æ³•ï¼Œæ˜¯é€šè¿‡æŠ½è±¡çš„å®ä½“åŠå®ä½“ä¹‹é—´è”ç³»çš„å½¢å¼ï¼Œæ¥è¡¨ç¤ºç°å®ä¸–ç•Œä¸­äº‹åŠ¡çš„ç›¸äº’å…³ç³»çš„ä¸€ç§æ˜ å°„ã€‚åœ¨è¿™é‡Œï¼Œæ•°æ®æ¨¡å‹è¡¨ç°çš„æŠ½è±¡çš„æ˜¯å®ä½“å’Œå®ä½“ä¹‹é—´çš„å…³ç³»ï¼Œé€šè¿‡å¯¹å®ä½“å’Œå®ä½“ä¹‹é—´å…³ç³»çš„å®šä¹‰å’Œæè¿°ï¼Œæ¥è¡¨è¾¾å®é™…çš„ä¸šåŠ¡ä¸­å…·ä½“çš„ä¸šåŠ¡å…³ç³»ã€‚æ•°æ®ä»“åº“æ¨¡å‹æ˜¯æ•°æ®æ¨¡å‹ä¸­é’ˆå¯¹ç‰¹å®šçš„æ•°æ®ä»“åº“åº”ç”¨ç³»ç»Ÿçš„ä¸€ç§ç‰¹å®šçš„æ•°æ®æ¨¡å‹ï¼Œä¸€èˆ¬çš„æ¥è¯´ï¼Œæˆ‘ä»¬æ•°æ®ä»“åº“æ¨¡å‹åˆ†ä¸ºå‡ ä¸‹å‡ ä¸ªå±‚æ¬¡ï¼Œå¦‚å›¾ 1 æ‰€ç¤ºã€‚é€šè¿‡ä¸Šé¢çš„å›¾å½¢ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¾ˆå®¹æ˜“çš„çœ‹å‡ºåœ¨æ•´ä¸ªæ•°æ®ä»“åº“å¾—å»ºæ¨¡è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç»å†ä¸€èˆ¬å››ä¸ªè¿‡ç¨‹ï¼šä¸šåŠ¡å»ºæ¨¡ï¼Œç”Ÿæˆä¸šåŠ¡æ¨¡å‹ï¼Œä¸»è¦è§£å†³ä¸šåŠ¡å±‚é¢çš„åˆ†è§£å’Œç¨‹åºåŒ–ã€‚é¢†åŸŸå»ºæ¨¡ï¼Œç”Ÿæˆé¢†åŸŸæ¨¡å‹ï¼Œä¸»è¦æ˜¯å¯¹ä¸šåŠ¡æ¨¡å‹è¿›è¡ŒæŠ½è±¡å¤„ç†ï¼Œç”Ÿæˆé¢†åŸŸæ¦‚å¿µæ¨¡å‹ã€‚é€»è¾‘å»ºæ¨¡ï¼Œç”Ÿæˆé€»è¾‘æ¨¡å‹ï¼Œä¸»è¦æ˜¯å°†é¢†åŸŸæ¨¡å‹çš„æ¦‚å¿µå®ä½“ä»¥åŠå®ä½“ä¹‹é—´çš„å…³ç³»è¿›è¡Œæ•°æ®åº“å±‚æ¬¡çš„é€»è¾‘åŒ–ã€‚ç‰©ç†å»ºæ¨¡ï¼Œç”Ÿæˆç‰©ç†æ¨¡å‹ï¼Œä¸»è¦è§£å†³ï¼Œé€»è¾‘æ¨¡å‹é’ˆå¯¹ä¸åŒå…³ç³»å‹æ•°æ®åº“çš„ç‰©ç†åŒ–ä»¥åŠæ€§èƒ½ç­‰ä¸€äº›å…·ä½“çš„æŠ€æœ¯é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨æ•´ä¸ªæ•°æ®ä»“åº“çš„æ¨¡å‹çš„è®¾è®¡å’Œæ¶æ„ä¸­ï¼Œæ—¢æ¶‰åŠåˆ°ä¸šåŠ¡çŸ¥è¯†ï¼Œä¹Ÿæ¶‰åŠåˆ°äº†å…·ä½“çš„æŠ€æœ¯ï¼Œæˆ‘ä»¬æ—¢éœ€è¦äº†è§£ä¸°å¯Œçš„è¡Œä¸šç»éªŒï¼ŒåŒæ—¶ï¼Œä¹Ÿéœ€è¦ä¸€å®šçš„ä¿¡æ¯æŠ€æœ¯æ¥å¸®åŠ©æˆ‘ä»¬å®ç°æˆ‘ä»¬çš„æ•°æ®æ¨¡å‹ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªéå¸¸é€‚ç”¨çš„æ–¹æ³•è®ºï¼Œæ¥æŒ‡å¯¼æˆ‘ä»¬è‡ªå·±é’ˆå¯¹æˆ‘ä»¬çš„ä¸šåŠ¡è¿›è¡ŒæŠ½è±¡ï¼Œå¤„ç†ï¼Œç”Ÿæˆå„ä¸ªé˜¶æ®µçš„æ¨¡å‹ã€‚ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®æ¨¡å‹åœ¨æ•°æ®ä»“åº“çš„å»ºè®¾ä¸­ï¼Œæˆ‘ä»¬ä¸€å†å¼ºè°ƒéœ€è¦æ•°æ®æ¨¡å‹ï¼Œé‚£ä¹ˆæ•°æ®æ¨¡å‹ç©¶ç«Ÿä¸ºä»€ä¹ˆè¿™ä¹ˆé‡è¦å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£æ•´ä¸ªæ•°æ®ä»“åº“çš„å»ºè®¾çš„å‘å±•å²ã€‚æ•°æ®ä»“åº“çš„å‘å±•å¤§è‡´ç»å†äº†è¿™æ ·çš„ä¸‰ä¸ªè¿‡ç¨‹ï¼šç®€å•æŠ¥è¡¨é˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µï¼Œç³»ç»Ÿçš„ä¸»è¦ç›®æ ‡æ˜¯è§£å†³ä¸€äº›æ—¥å¸¸çš„å·¥ä½œä¸­ä¸šåŠ¡äººå‘˜éœ€è¦çš„æŠ¥è¡¨ï¼Œä»¥åŠç”Ÿæˆä¸€äº›ç®€å•çš„èƒ½å¤Ÿå¸®åŠ©é¢†å¯¼è¿›è¡Œå†³ç­–æ‰€éœ€è¦çš„æ±‡æ€»æ•°æ®ã€‚è¿™ä¸ªé˜¶æ®µçš„å¤§éƒ¨åˆ†è¡¨ç°å½¢å¼ä¸ºæ•°æ®åº“å’Œå‰ç«¯æŠ¥è¡¨å·¥å…·ã€‚æ•°æ®é›†å¸‚é˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µï¼Œä¸»è¦æ˜¯æ ¹æ®æŸä¸ªä¸šåŠ¡éƒ¨é—¨çš„éœ€è¦ï¼Œè¿›è¡Œä¸€å®šçš„æ•°æ®çš„é‡‡é›†ï¼Œæ•´ç†ï¼ŒæŒ‰ç…§ä¸šåŠ¡äººå‘˜çš„éœ€è¦ï¼Œè¿›è¡Œå¤šç»´æŠ¥è¡¨çš„å±•ç°ï¼Œèƒ½å¤Ÿæä¾›å¯¹ç‰¹å®šä¸šåŠ¡æŒ‡å¯¼çš„æ•°æ®ï¼Œå¹¶ä¸”èƒ½å¤Ÿæä¾›ç‰¹å®šçš„é¢†å¯¼å†³ç­–æ•°æ®ã€‚æ•°æ®ä»“åº“é˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µï¼Œä¸»è¦æ˜¯æŒ‰ç…§ä¸€å®šçš„æ•°æ®æ¨¡å‹ï¼Œå¯¹æ•´ä¸ªä¼ä¸šçš„æ•°æ®è¿›è¡Œé‡‡é›†ï¼Œæ•´ç†ï¼Œå¹¶ä¸”èƒ½å¤ŸæŒ‰ç…§å„ä¸ªä¸šåŠ¡éƒ¨é—¨çš„éœ€è¦ï¼Œæä¾›è·¨éƒ¨é—¨çš„ï¼Œå®Œå…¨ä¸€è‡´çš„ä¸šåŠ¡æŠ¥è¡¨æ•°æ®ï¼Œèƒ½å¤Ÿé€šè¿‡æ•°æ®ä»“åº“ç”Ÿæˆå¯¹å¯¹ä¸šåŠ¡å…·æœ‰æŒ‡å¯¼æ€§çš„æ•°æ®ï¼ŒåŒæ—¶ï¼Œä¸ºé¢†å¯¼å†³ç­–æä¾›å…¨é¢çš„æ•°æ®æ”¯æŒã€‚é€šè¿‡æ•°æ®ä»“åº“å»ºè®¾çš„å‘å±•é˜¶æ®µï¼Œæˆ‘ä»¬èƒ½å¤Ÿçœ‹å‡ºï¼Œæ•°æ®ä»“åº“çš„å»ºè®¾å’Œæ•°æ®é›†å¸‚çš„å»ºè®¾çš„é‡è¦åŒºåˆ«å°±åœ¨äºæ•°æ®æ¨¡å‹çš„æ”¯æŒã€‚å› æ­¤ï¼Œæ•°æ®æ¨¡å‹çš„å»ºè®¾ï¼Œå¯¹äºæˆ‘ä»¬æ•°æ®ä»“åº“çš„å»ºè®¾ï¼Œæœ‰ç€å†³å®šæ€§çš„æ„ä¹‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®æ¨¡å‹çš„å»ºè®¾ä¸»è¦èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è§£å†³ä»¥ä¸‹çš„ä¸€äº›é—®é¢˜ï¼šè¿›è¡Œå…¨é¢çš„ä¸šåŠ¡æ¢³ç†ï¼Œæ”¹è¿›ä¸šåŠ¡æµç¨‹ã€‚åœ¨ä¸šåŠ¡æ¨¡å‹å»ºè®¾çš„é˜¶æ®µï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬çš„ä¼ä¸šæˆ–è€…æ˜¯ç®¡ç†æœºå…³å¯¹æœ¬å•ä½çš„ä¸šåŠ¡è¿›è¡Œå…¨é¢çš„æ¢³ç†ã€‚é€šè¿‡ä¸šåŠ¡æ¨¡å‹çš„å»ºè®¾ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿå…¨é¢äº†è§£è¯¥å•ä½çš„ä¸šåŠ¡æ¶æ„å›¾å’Œæ•´ä¸ªä¸šåŠ¡çš„è¿è¡Œæƒ…å†µï¼Œèƒ½å¤Ÿå°†ä¸šåŠ¡æŒ‰ç…§ç‰¹å®šçš„è§„å¾‹è¿›è¡Œåˆ†é—¨åˆ«ç±»å’Œç¨‹åºåŒ–ï¼ŒåŒæ—¶ï¼Œå¸®åŠ©æˆ‘ä»¬è¿›ä¸€æ­¥çš„æ”¹è¿›ä¸šåŠ¡çš„æµç¨‹ï¼Œæé«˜ä¸šåŠ¡æ•ˆç‡ï¼ŒæŒ‡å¯¼æˆ‘ä»¬çš„ä¸šåŠ¡éƒ¨é—¨çš„ç”Ÿäº§ã€‚å»ºç«‹å…¨æ–¹ä½çš„æ•°æ®è§†è§’ï¼Œæ¶ˆç­ä¿¡æ¯å­¤å²›å’Œæ•°æ®å·®å¼‚ã€‚é€šè¿‡æ•°æ®ä»“åº“çš„æ¨¡å‹å»ºè®¾ï¼Œèƒ½å¤Ÿä¸ºä¼ä¸šæä¾›ä¸€ä¸ªæ•´ä½“çš„æ•°æ®è§†è§’ï¼Œä¸å†æ˜¯å„ä¸ªéƒ¨é—¨åªæ˜¯å…³æ³¨è‡ªå·±çš„æ•°æ®ï¼Œè€Œä¸”é€šè¿‡æ¨¡å‹çš„å»ºè®¾ï¼Œå‹¾å‹’å‡ºäº†éƒ¨é—¨ä¹‹é—´å†…åœ¨çš„è”ç³»ï¼Œå¸®åŠ©æ¶ˆç­å„ä¸ªéƒ¨é—¨ä¹‹é—´çš„ä¿¡æ¯å­¤å²›çš„é—®é¢˜ï¼Œæ›´ä¸ºé‡è¦çš„æ˜¯ï¼Œé€šè¿‡æ•°æ®æ¨¡å‹çš„å»ºè®¾ï¼Œèƒ½å¤Ÿä¿è¯æ•´ä¸ªä¼ä¸šçš„æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå„ä¸ªéƒ¨é—¨ä¹‹é—´æ•°æ®çš„å·®å¼‚å°†ä¼šå¾—åˆ°æœ‰æ•ˆè§£å†³ã€‚è§£å†³ä¸šåŠ¡çš„å˜åŠ¨å’Œæ•°æ®ä»“åº“çš„çµæ´»æ€§ã€‚é€šè¿‡æ•°æ®æ¨¡å‹çš„å»ºè®¾ï¼Œèƒ½å¤Ÿå¾ˆå¥½çš„åˆ†ç¦»å‡ºåº•å±‚æŠ€æœ¯çš„å®ç°å’Œä¸Šå±‚ä¸šåŠ¡çš„å±•ç°ã€‚å½“ä¸Šå±‚ä¸šåŠ¡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šè¿‡æ•°æ®æ¨¡å‹ï¼Œåº•å±‚çš„æŠ€æœ¯å®ç°å¯ä»¥éå¸¸è½»æ¾çš„å®Œæˆä¸šåŠ¡çš„å˜åŠ¨ï¼Œä»è€Œè¾¾åˆ°æ•´ä¸ªæ•°æ®ä»“åº“ç³»ç»Ÿçš„çµæ´»æ€§ã€‚å¸®åŠ©æ•°æ®ä»“åº“ç³»ç»Ÿæœ¬èº«çš„å»ºè®¾ã€‚é€šè¿‡æ•°æ®ä»“åº“çš„æ¨¡å‹å»ºè®¾ï¼Œå¼€å‘äººå‘˜å’Œä¸šåŠ¡äººå‘˜èƒ½å¤Ÿå¾ˆå®¹æ˜“çš„è¾¾æˆç³»ç»Ÿå»ºè®¾èŒƒå›´çš„ç•Œå®šï¼Œä»¥åŠé•¿æœŸç›®æ ‡çš„è§„åˆ’ï¼Œä»è€Œèƒ½å¤Ÿä½¿æ•´ä¸ªé¡¹ç›®ç»„æ˜ç¡®å½“å‰çš„ä»»åŠ¡ï¼ŒåŠ å¿«æ•´ä¸ªç³»ç»Ÿå»ºè®¾çš„é€Ÿåº¦ã€‚å¦‚ä½•å»ºè®¾æ•°æ®æ¨¡å‹å»ºè®¾æ•°æ®æ¨¡å‹æ—¢ç„¶æ˜¯æ•´ä¸ªæ•°æ®ä»“åº“å»ºè®¾ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„å…³é”®éƒ¨åˆ†ï¼Œé‚£ä¹ˆï¼Œæ€ä¹ˆå»ºè®¾æˆ‘ä»¬çš„æ•°æ®ä»“åº“æ¨¡å‹å°±æ˜¯æˆ‘ä»¬éœ€è¦è§£å†³çš„ä¸€ä¸ªé—®é¢˜ã€‚è¿™é‡Œæˆ‘ä»¬å°†è¦è¯¦ç»†ä»‹ç»å¦‚ä½•åˆ›å»ºé€‚åˆè‡ªå·±çš„æ•°æ®æ¨¡å‹ã€‚æ•°æ®ä»“åº“æ•°æ®æ¨¡å‹æ¶æ„æ•°æ®ä»“åº“çš„æ•°æ®æ¨¡å‹çš„æ¶æ„å’Œæ•°æ®ä»“åº“çš„æ•´ä½“æ¶æ„æ˜¯ç´§å¯†å…³è”åœ¨ä¸€èµ·çš„ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥äº†è§£ä¸€ä¸‹æ•´ä¸ªæ•°æ®ä»“åº“çš„æ•°æ®æ¨¡å‹åº”è¯¥åŒ…å«çš„å‡ ä¸ªéƒ¨åˆ†ã€‚ä»ä¸‹å›¾æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°ï¼Œæ•´ä¸ªæ•°æ®æ¨¡å‹çš„æ¶æ„åˆ†æˆ 5 å¤§éƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†å…¶å®éƒ½æœ‰å…¶ç‹¬ç‰¹çš„åŠŸèƒ½ã€‚å›¾ 3. æ•°æ®ä»“åº“æ•°æ®æ¨¡å‹æ¶æ„ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ•´ä¸ªæ•°æ®ä»“åº“çš„æ•°æ®æ¨¡å‹å¯ä»¥åˆ†ä¸ºå¤§æ¦‚ 5 å¤§éƒ¨åˆ†ï¼šç³»ç»Ÿè®°å½•åŸŸï¼ˆSystem of Recordï¼‰ï¼šè¿™éƒ¨åˆ†æ˜¯ä¸»è¦çš„æ•°æ®ä»“åº“ä¸šåŠ¡æ•°æ®å­˜å‚¨åŒºï¼Œæ•°æ®æ¨¡å‹åœ¨è¿™é‡Œä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚å†…éƒ¨ç®¡ç†åŸŸï¼ˆHousekeepingï¼‰ï¼šè¿™éƒ¨åˆ†ä¸»è¦å­˜å‚¨æ•°æ®ä»“åº“ç”¨äºå†…éƒ¨ç®¡ç†çš„å…ƒæ•°æ®ï¼Œæ•°æ®æ¨¡å‹åœ¨è¿™é‡Œèƒ½å¤Ÿå¸®åŠ©è¿›è¡Œç»Ÿä¸€çš„å…ƒæ•°æ®çš„ç®¡ç†ã€‚æ±‡æ€»åŸŸï¼ˆSummary of Areaï¼‰ï¼šè¿™éƒ¨åˆ†æ•°æ®æ¥è‡ªäºç³»ç»Ÿè®°å½•åŸŸçš„æ±‡æ€»ï¼Œæ•°æ®æ¨¡å‹åœ¨è¿™é‡Œä¿è¯äº†åˆ†æåŸŸçš„ä¸»é¢˜åˆ†æçš„æ€§èƒ½ï¼Œæ»¡è¶³äº†éƒ¨åˆ†çš„æŠ¥è¡¨æŸ¥è¯¢ã€‚åˆ†æåŸŸï¼ˆAnalysis Areaï¼‰ï¼šè¿™éƒ¨åˆ†æ•°æ®æ¨¡å‹ä¸»è¦ç”¨äºå„ä¸ªä¸šåŠ¡éƒ¨åˆ†çš„å…·ä½“çš„ä¸»é¢˜ä¸šåŠ¡åˆ†æã€‚è¿™éƒ¨åˆ†æ•°æ®æ¨¡å‹å¯ä»¥å•ç‹¬å­˜å‚¨åœ¨ç›¸åº”çš„æ•°æ®é›†å¸‚ä¸­ã€‚åé¦ˆåŸŸï¼ˆFeedback Areaï¼‰ï¼šå¯é€‰é¡¹ï¼Œè¿™éƒ¨åˆ†æ•°æ®æ¨¡å‹ä¸»è¦ç”¨äºç›¸åº”å‰ç«¯çš„åé¦ˆæ•°æ®ï¼Œæ•°æ®ä»“åº“å¯ä»¥è§†ä¸šåŠ¡çš„éœ€è¦è®¾ç½®è¿™ä¸€åŒºåŸŸã€‚é€šè¿‡å¯¹æ•´ä¸ªæ•°æ®ä»“åº“æ¨¡å‹çš„æ•°æ®åŒºåŸŸçš„åˆ’åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼Œä¸€ä¸ªå¥½çš„æ•°æ®æ¨¡å‹ï¼Œä¸ä»…ä»…æ˜¯å¯¹ä¸šåŠ¡è¿›è¡ŒæŠ½è±¡åˆ’åˆ†ï¼Œè€Œä¸”å¯¹å®ç°æŠ€æœ¯ä¹Ÿè¿›è¡Œå…·ä½“çš„æŒ‡å¯¼ï¼Œå®ƒåº”è¯¥æ¶µç›–äº†ä»ä¸šåŠ¡åˆ°å®ç°æŠ€æœ¯çš„å„ä¸ªéƒ¨åˆ†ã€‚æ•°æ®ä»“åº“å»ºæ¨¡é˜¶æ®µåˆ’åˆ†æˆ‘ä»¬å‰é¢ä»‹ç»äº†æ•°æ®ä»“åº“æ¨¡å‹çš„å‡ ä¸ªå±‚æ¬¡ï¼Œä¸‹é¢æˆ‘ä»¬è®²ä¸€ä¸‹ï¼Œé’ˆå¯¹è¿™å‡ ä¸ªå±‚æ¬¡çš„ä¸åŒé˜¶æ®µçš„æ•°æ®å»ºæ¨¡çš„å·¥ä½œçš„ä¸»è¦å†…å®¹ï¼šå›¾ 4. æ•°æ®ä»“åº“å»ºæ¨¡é˜¶æ®µåˆ’åˆ†ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹å‡ºï¼Œæ•°æ®ä»“åº“çš„æ•°æ®å»ºæ¨¡å¤§è‡´åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼šä¸šåŠ¡å»ºæ¨¡ï¼Œè¿™éƒ¨åˆ†å»ºæ¨¡å·¥ä½œï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼šåˆ’åˆ†æ•´ä¸ªå•ä½çš„ä¸šåŠ¡ï¼Œä¸€èˆ¬æŒ‰ç…§ä¸šåŠ¡éƒ¨é—¨çš„åˆ’åˆ†ï¼Œè¿›è¡Œå„ä¸ªéƒ¨åˆ†ä¹‹é—´ä¸šåŠ¡å·¥ä½œçš„ç•Œå®šï¼Œç†æ¸…å„ä¸šåŠ¡éƒ¨é—¨ä¹‹é—´çš„å…³ç³»ã€‚æ·±å…¥äº†è§£å„ä¸ªä¸šåŠ¡éƒ¨é—¨çš„å†…å…·ä½“ä¸šåŠ¡æµç¨‹å¹¶å°†å…¶ç¨‹åºåŒ–ã€‚æå‡ºä¿®æ”¹å’Œæ”¹è¿›ä¸šåŠ¡éƒ¨é—¨å·¥ä½œæµç¨‹çš„æ–¹æ³•å¹¶ç¨‹åºåŒ–ã€‚æ•°æ®å»ºæ¨¡çš„èŒƒå›´ç•Œå®šï¼Œæ•´ä¸ªæ•°æ®ä»“åº“é¡¹ç›®çš„ç›®æ ‡å’Œé˜¶æ®µåˆ’åˆ†ã€‚é¢†åŸŸæ¦‚å¿µå»ºæ¨¡ï¼Œè¿™éƒ¨åˆ†å¾—å»ºæ¨¡å·¥ä½œï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼šæŠ½å–å…³é”®ä¸šåŠ¡æ¦‚å¿µï¼Œå¹¶å°†ä¹‹æŠ½è±¡åŒ–ã€‚å°†ä¸šåŠ¡æ¦‚å¿µåˆ†ç»„ï¼ŒæŒ‰ç…§ä¸šåŠ¡ä¸»çº¿èšåˆç±»ä¼¼çš„åˆ†ç»„æ¦‚å¿µã€‚ç»†åŒ–åˆ†ç»„æ¦‚å¿µï¼Œç†æ¸…åˆ†ç»„æ¦‚å¿µå†…çš„ä¸šåŠ¡æµç¨‹å¹¶æŠ½è±¡åŒ–ã€‚ç†æ¸…åˆ†ç»„æ¦‚å¿µä¹‹é—´çš„å…³è”ï¼Œå½¢æˆå®Œæ•´çš„é¢†åŸŸæ¦‚å¿µæ¨¡å‹ã€‚é€»è¾‘å»ºæ¨¡ï¼Œè¿™éƒ¨åˆ†çš„å»ºæ¨¡å·¥ä½œï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼šä¸šåŠ¡æ¦‚å¿µå®ä½“åŒ–ï¼Œå¹¶è€ƒè™‘å…¶å…·ä½“çš„å±æ€§äº‹ä»¶å®ä½“åŒ–ï¼Œå¹¶è€ƒè™‘å…¶å±æ€§å†…å®¹è¯´æ˜å®ä½“åŒ–ï¼Œå¹¶è€ƒè™‘å…¶å±æ€§å†…å®¹ç‰©ç†å»ºæ¨¡ï¼Œè¿™éƒ¨åˆ†å¾—å»ºæ¨¡å·¥ä½œï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼šé’ˆå¯¹ç‰¹å®šç‰©ç†åŒ–å¹³å°ï¼Œåšå‡ºç›¸åº”çš„æŠ€æœ¯è°ƒæ•´é’ˆå¯¹æ¨¡å‹çš„æ€§èƒ½è€ƒè™‘ï¼Œå¯¹ç‰¹å®šå¹³å°ä½œå‡ºç›¸åº”çš„è°ƒæ•´é’ˆå¯¹ç®¡ç†çš„éœ€è¦ï¼Œç»“åˆç‰¹å®šçš„å¹³å°ï¼Œåšå‡ºç›¸åº”çš„è°ƒæ•´ç”Ÿæˆæœ€åçš„æ‰§è¡Œè„šæœ¬ï¼Œå¹¶å®Œå–„ä¹‹ã€‚ä»æˆ‘ä»¬ä¸Šé¢å¯¹æ•°æ®ä»“åº“çš„æ•°æ®å»ºæ¨¡é˜¶æ®µçš„å„ä¸ªé˜¶æ®µçš„åˆ’åˆ†ï¼Œæˆ‘ä»¬èƒ½å¤Ÿäº†è§£åˆ°æ•´ä¸ªæ•°æ®ä»“åº“å»ºæ¨¡çš„ä¸»è¦å·¥ä½œå’Œå·¥ä½œé‡ï¼Œå¸Œæœ›èƒ½å¤Ÿå¯¹æˆ‘ä»¬åœ¨å®é™…çš„é¡¹ç›®å»ºè®¾èƒ½å¤Ÿæœ‰æ‰€å¸®åŠ©ã€‚æ•°æ®ä»“åº“å»ºæ¨¡æ–¹æ³•å¤§åƒä¸–ç•Œï¼Œè¡¨é¢çœ‹äº”å½©ç¼¤çº·ï¼Œå®è´¨ä¸Šï¼Œä¸‡ç‰©éƒ½éµå¾ªå…¶è‡ªæœ‰çš„æ³•åˆ™ã€‚æ•°æ®ä»“åº“å¾—å»ºæ¨¡æ–¹æ³•åŒæ ·ä¹Ÿæœ‰å¾ˆå¤šç§ï¼Œæ¯ä¸€ç§å»ºæ¨¡æ–¹æ³•å…¶å®ä»£è¡¨äº†å“²å­¦ä¸Šçš„ä¸€ä¸ªè§‚ç‚¹ï¼Œä»£è¡¨äº†ä¸€ç§å½’çº³ï¼Œæ¦‚æ‹¬ä¸–ç•Œçš„ä¸€ç§æ–¹æ³•ã€‚ç›®å‰ä¸šç•Œè¾ƒä¸ºæµè¡Œçš„æ•°æ®ä»“åº“çš„å»ºæ¨¡æ–¹æ³•éå¸¸å¤šï¼Œè¿™é‡Œä¸»è¦ä»‹ç»èŒƒå¼å»ºæ¨¡æ³•ï¼Œç»´åº¦å»ºæ¨¡æ³•ï¼Œå®ä½“å»ºæ¨¡æ³•ç­‰å‡ ç§æ–¹æ³•ï¼Œæ¯ç§æ–¹æ³•å…¶å®ä»æœ¬è´¨ä¸Šè®²å°±æ˜¯ä»ä¸åŒçš„è§’åº¦çœ‹æˆ‘ä»¬ä¸šåŠ¡ä¸­çš„é—®é¢˜ï¼Œä¸ç®¡ä»æŠ€æœ¯å±‚é¢è¿˜æ˜¯ä¸šåŠ¡å±‚é¢ï¼Œå…¶å®ä»£è¡¨çš„æ˜¯å“²å­¦ä¸Šçš„ä¸€ç§ä¸–ç•Œè§‚ã€‚æˆ‘ä»¬ä¸‹é¢ç»™å¤§å®¶è¯¦ç»†ä»‹ç»ä¸€ä¸‹è¿™äº›å»ºæ¨¡æ–¹æ³•ã€‚èŒƒå¼å»ºæ¨¡æ³•ï¼ˆThird Normal Formï¼Œ3NFï¼‰èŒƒå¼å»ºæ¨¡æ³•å…¶å®æ˜¯æˆ‘ä»¬åœ¨æ„å»ºæ•°æ®æ¨¡å‹å¸¸ç”¨çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä¸»è¦ç”± Inmon æ‰€æå€¡ï¼Œä¸»è¦è§£å†³å…³ç³»å‹æ•°æ®åº“å¾—æ•°æ®å­˜å‚¨ï¼Œåˆ©ç”¨çš„ä¸€ç§æŠ€æœ¯å±‚é¢ä¸Šçš„æ–¹æ³•ã€‚ç›®å‰ï¼Œæˆ‘ä»¬åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­çš„å»ºæ¨¡æ–¹æ³•ï¼Œå¤§éƒ¨åˆ†é‡‡ç”¨çš„æ˜¯ä¸‰èŒƒå¼å»ºæ¨¡æ³•ã€‚èŒƒå¼æ˜¯æ•°æ®åº“é€»è¾‘æ¨¡å‹è®¾è®¡çš„åŸºæœ¬ç†è®ºï¼Œä¸€ä¸ªå…³ç³»æ¨¡å‹å¯ä»¥ä»ç¬¬ä¸€èŒƒå¼åˆ°ç¬¬äº”èŒƒå¼è¿›è¡Œæ— æŸåˆ†è§£ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿå¯ç§°ä¸ºè§„èŒƒåŒ–ã€‚åœ¨æ•°æ®ä»“åº“çš„æ¨¡å‹è®¾è®¡ä¸­ç›®å‰ä¸€èˆ¬é‡‡ç”¨ç¬¬ä¸‰èŒƒå¼ï¼Œå®ƒæœ‰ç€ä¸¥æ ¼çš„æ•°å­¦å®šä¹‰ã€‚ä»å…¶è¡¨è¾¾çš„å«ä¹‰æ¥çœ‹ï¼Œä¸€ä¸ªç¬¦åˆç¬¬ä¸‰èŒƒå¼çš„å…³ç³»å¿…é¡»å…·æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ :æ¯ä¸ªå±æ€§å€¼å”¯ä¸€ï¼Œä¸å…·æœ‰å¤šä¹‰æ€§ ;æ¯ä¸ªéä¸»å±æ€§å¿…é¡»å®Œå…¨ä¾èµ–äºæ•´ä¸ªä¸»é”®ï¼Œè€Œéä¸»é”®çš„ä¸€éƒ¨åˆ† ;æ¯ä¸ªéä¸»å±æ€§ä¸èƒ½ä¾èµ–äºå…¶ä»–å…³ç³»ä¸­çš„å±æ€§ï¼Œå› ä¸ºè¿™æ ·çš„è¯ï¼Œè¿™ç§å±æ€§åº”è¯¥å½’åˆ°å…¶ä»–å…³ç³»ä¸­å»ã€‚ç”±äºèŒƒå¼æ˜¯åŸºäºæ•´ä¸ªå…³ç³»å‹æ•°æ®åº“çš„ç†è®ºåŸºç¡€ä¹‹ä¸Šå‘å±•è€Œæ¥çš„ï¼Œå› æ­¤ï¼Œæœ¬äººåœ¨è¿™é‡Œä¸å¤šåšä»‹ç»ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥é€šè¿‡é˜…è¯»ç›¸åº”çš„ææ–™æ¥è·å¾—è¿™æ–¹é¢çš„çŸ¥è¯†ã€‚æ ¹æ® Inmon çš„è§‚ç‚¹ï¼Œæ•°æ®ä»“åº“æ¨¡å‹å¾—å»ºè®¾æ–¹æ³•å’Œä¸šåŠ¡ç³»ç»Ÿçš„ä¼ä¸šæ•°æ®æ¨¡å‹ç±»ä¼¼ã€‚åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œä¼ä¸šæ•°æ®æ¨¡å‹å†³å®šäº†æ•°æ®çš„æ¥æºï¼Œè€Œä¼ä¸šæ•°æ®æ¨¡å‹ä¹Ÿåˆ†ä¸ºä¸¤ä¸ªå±‚æ¬¡ï¼Œå³ä¸»é¢˜åŸŸæ¨¡å‹å’Œé€»è¾‘æ¨¡å‹ã€‚åŒæ ·ï¼Œä¸»é¢˜åŸŸæ¨¡å‹å¯ä»¥çœ‹æˆæ˜¯ä¸šåŠ¡æ¨¡å‹çš„æ¦‚å¿µæ¨¡å‹ï¼Œè€Œé€»è¾‘æ¨¡å‹åˆ™æ˜¯åŸŸæ¨¡å‹åœ¨å…³ç³»å‹æ•°æ®åº“ä¸Šçš„å®ä¾‹è¯ã€‚ä»ä¸šåŠ¡æ•°æ®æ¨¡å‹è½¬å‘æ•°æ®ä»“åº“æ¨¡å‹æ—¶ï¼ŒåŒæ ·ä¹Ÿéœ€è¦æœ‰æ•°æ®ä»“åº“çš„åŸŸæ¨¡å‹ï¼Œå³æ¦‚å¿µæ¨¡å‹ï¼ŒåŒæ—¶ä¹Ÿå­˜åœ¨åŸŸæ¨¡å‹çš„é€»è¾‘æ¨¡å‹ã€‚è¿™é‡Œï¼Œä¸šåŠ¡æ¨¡å‹ä¸­çš„æ•°æ®æ¨¡å‹å’Œæ•°æ®ä»“åº“çš„æ¨¡å‹ç¨å¾®æœ‰ä¸€äº›ä¸åŒã€‚ä¸»è¦åŒºåˆ«åœ¨äºï¼šæ•°æ®ä»“åº“çš„åŸŸæ¨¡å‹åº”è¯¥åŒ…å«ä¼ä¸šæ•°æ®æ¨¡å‹å¾—åŸŸæ¨¡å‹ä¹‹é—´çš„å…³ç³»ï¼Œä»¥åŠå„ä¸»é¢˜åŸŸå®šä¹‰ã€‚æ•°æ®ä»“åº“çš„åŸŸæ¨¡å‹çš„æ¦‚å¿µåº”è¯¥æ¯”ä¸šåŠ¡ç³»ç»Ÿçš„ä¸»é¢˜åŸŸæ¨¡å‹èŒƒå›´æ›´åŠ å¹¿ã€‚åœ¨æ•°æ®ä»“åº“çš„é€»è¾‘æ¨¡å‹éœ€è¦ä»ä¸šåŠ¡ç³»ç»Ÿçš„æ•°æ®æ¨¡å‹ä¸­çš„é€»è¾‘æ¨¡å‹ä¸­æŠ½è±¡å®ä½“ï¼Œå®ä½“çš„å±æ€§ï¼Œå®ä½“çš„å­ç±»ï¼Œä»¥åŠå®ä½“çš„å…³ç³»ç­‰ã€‚ä»¥ç¬”è€…çš„è§‚ç‚¹æ¥çœ‹ï¼ŒInmon çš„èŒƒå¼å»ºæ¨¡æ³•çš„æœ€å¤§ä¼˜ç‚¹å°±æ˜¯ä»å…³ç³»å‹æ•°æ®åº“çš„è§’åº¦å‡ºå‘ï¼Œç»“åˆäº†ä¸šåŠ¡ç³»ç»Ÿçš„æ•°æ®æ¨¡å‹ï¼Œèƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿çš„å®ç°æ•°æ®ä»“åº“çš„å»ºæ¨¡ã€‚ä½†å…¶ç¼ºç‚¹ä¹Ÿæ˜¯æ˜æ˜¾çš„ï¼Œç”±äºå»ºæ¨¡æ–¹æ³•é™å®šåœ¨å…³ç³»å‹æ•°æ®åº“ä¹‹ä¸Šï¼Œåœ¨æŸäº›æ—¶å€™åè€Œé™åˆ¶äº†æ•´ä¸ªæ•°æ®ä»“åº“æ¨¡å‹çš„çµæ´»æ€§ï¼Œæ€§èƒ½ç­‰ï¼Œç‰¹åˆ«æ˜¯è€ƒè™‘åˆ°æ•°æ®ä»“åº“çš„åº•å±‚æ•°æ®å‘æ•°æ®é›†å¸‚çš„æ•°æ®è¿›è¡Œæ±‡æ€»æ—¶ï¼Œéœ€è¦è¿›è¡Œä¸€å®šçš„å˜é€šæ‰èƒ½æ»¡è¶³ç›¸åº”çš„éœ€æ±‚ã€‚å› æ­¤ï¼Œç¬”è€…å»ºè®®è¯»è€…ä»¬åœ¨å®é™…çš„ä½¿ç”¨ä¸­ï¼Œå‚è€ƒä½¿ç”¨è¿™ä¸€å»ºæ¨¡æ–¹å¼ã€‚ç»´åº¦å»ºæ¨¡æ³•ç»´åº¦å»ºæ¨¡æ³•ï¼ŒKimball æœ€å…ˆæå‡ºè¿™ä¸€æ¦‚å¿µã€‚å…¶æœ€ç®€å•çš„æè¿°å°±æ˜¯ï¼ŒæŒ‰ç…§äº‹å®è¡¨ï¼Œç»´è¡¨æ¥æ„å»ºæ•°æ®ä»“åº“ï¼Œæ•°æ®é›†å¸‚ã€‚è¿™ç§æ–¹æ³•çš„æœ€è¢«äººå¹¿æ³›çŸ¥æ™“çš„åå­—å°±æ˜¯æ˜Ÿå‹æ¨¡å‹ å’Œ é›ªèŠ±æ¨¡å‹ã€‚è¿™é‡Œåšä¸€ä¸‹ æ˜Ÿå‹æ¨¡å‹ å’Œ é›ªèŠ±æ¨¡å‹çš„æ‰©å……ï¼šæ˜Ÿå‹æ¨¡å‹æ˜Ÿå‹æ¨¡æ˜¯ä¸€ç§å¤šç»´çš„æ•°æ®å…³ç³»ï¼Œå®ƒç”±ä¸€ä¸ªäº‹å®è¡¨å’Œä¸€ç»„ç»´è¡¨ç»„æˆã€‚æ¯ä¸ªç»´è¡¨éƒ½æœ‰ä¸€ä¸ªç»´ä½œä¸ºä¸»é”®ï¼Œæ‰€æœ‰è¿™äº›ç»´çš„ä¸»é”®ç»„åˆæˆäº‹å®è¡¨çš„ä¸»é”®ã€‚å¼ºè°ƒçš„æ˜¯å¯¹ç»´åº¦è¿›è¡Œé¢„å¤„ç†ï¼Œå°†å¤šä¸ªç»´åº¦é›†åˆåˆ°ä¸€ä¸ªäº‹å®è¡¨ï¼Œå½¢æˆä¸€ä¸ªå®½è¡¨ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨hiveæ—¶ï¼Œç»å¸¸ä¼šçœ‹åˆ°ä¸€äº›å¤§å®½è¡¨çš„åŸå› ï¼Œå¤§å®½è¡¨ä¸€èˆ¬éƒ½æ˜¯äº‹å®è¡¨ï¼ŒåŒ…å«äº†ç»´åº¦å…³è”çš„ä¸»é”®å’Œä¸€äº›åº¦é‡ä¿¡æ¯ï¼Œè€Œç»´åº¦è¡¨åˆ™æ˜¯äº‹å®è¡¨é‡Œé¢ç»´åº¦çš„å…·ä½“ä¿¡æ¯ï¼Œä½¿ç”¨æ—¶å€™ä¸€èˆ¬é€šè¿‡joinæ¥ç»„åˆæ•°æ®ï¼Œç›¸å¯¹æ¥è¯´å¯¹OLAPçš„åˆ†ææ¯”è¾ƒæ–¹ä¾¿ã€‚é›ªèŠ±æ¨¡å‹å½“æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç»´è¡¨æ²¡æœ‰ç›´æ¥è¿æ¥åˆ°äº‹å®è¡¨ä¸Šï¼Œè€Œæ˜¯é€šè¿‡å…¶ä»–ç»´è¡¨è¿æ¥åˆ°äº‹å®è¡¨ä¸Šæ—¶ï¼Œå…¶å›¾è§£å°±åƒå¤šä¸ªé›ªèŠ±è¿æ¥åœ¨ä¸€èµ·ï¼Œæ•…ç§°é›ªèŠ±æ¨¡å‹ã€‚é›ªèŠ±æ¨¡å‹æ˜¯å¯¹æ˜Ÿå‹æ¨¡å‹çš„æ‰©å±•ã€‚å®ƒå¯¹æ˜Ÿå‹æ¨¡å‹çš„ç»´è¡¨è¿›ä¸€æ­¥å±‚æ¬¡åŒ–ï¼ŒåŸæœ‰çš„å„ç»´è¡¨å¯èƒ½è¢«æ‰©å±•ä¸ºå°çš„äº‹å®è¡¨ï¼Œå½¢æˆä¸€äº›å±€éƒ¨çš„ â€œå±‚æ¬¡ â€œ åŒºåŸŸï¼Œè¿™äº›è¢«åˆ†è§£çš„è¡¨éƒ½è¿æ¥åˆ°ä¸»ç»´åº¦è¡¨è€Œä¸æ˜¯äº‹å®è¡¨ã€‚é›ªèŠ±æ¨¡å‹æ›´åŠ ç¬¦åˆæ•°æ®åº“èŒƒå¼ï¼Œå‡å°‘æ•°æ®å†—ä½™ï¼Œä½†æ˜¯åœ¨åˆ†ææ•°æ®çš„æ—¶å€™ï¼Œæ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦joinçš„è¡¨æ¯”è¾ƒå¤šæ‰€ä»¥å…¶æ€§èƒ½å¹¶ä¸ä¸€å®šæ¯”æ˜Ÿå‹æ¨¡å‹é«˜ã€‚æ˜Ÿå‹æ¨¡å‹å’Œé›ªèŠ±æ¨¡å‹çš„ä¼˜åŠ£å¯¹æ¯”åº”ç”¨åœºæ™¯æ˜Ÿå‹æ¨¡å‹çš„è®¾è®¡æ–¹å¼ä¸»è¦å¸¦æ¥çš„å¥½å¤„æ˜¯èƒ½å¤Ÿæå‡æŸ¥è¯¢æ•ˆç‡ï¼Œå› ä¸ºç”Ÿæˆçš„äº‹å®è¡¨å·²ç»ç»è¿‡é¢„å¤„ç†ï¼Œä¸»è¦çš„æ•°æ®éƒ½åœ¨äº‹å®è¡¨é‡Œé¢ï¼Œæ‰€ä»¥åªè¦æ‰«æå®æ—¶è¡¨å°±èƒ½å¤Ÿè¿›è¡Œå¤§é‡çš„æŸ¥è¯¢ï¼Œè€Œä¸å¿…è¿›è¡Œå¤§é‡çš„joinï¼Œå…¶æ¬¡ç»´è¡¨æ•°æ®ä¸€èˆ¬æ¯”è¾ƒå°‘ï¼Œåœ¨joinå¯ç›´æ¥æ”¾å…¥å†…å­˜è¿›è¡Œjoinä»¥æå‡æ•ˆç‡ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæ˜Ÿå‹æ¨¡å‹çš„äº‹å®è¡¨å¯è¯»æ€§æ¯”è¾ƒå¥½ï¼Œä¸ç”¨å…³è”å¤šä¸ªè¡¨å°±èƒ½è·å–å¤§éƒ¨åˆ†æ ¸å¿ƒä¿¡æ¯ï¼Œè®¾è®¡ç»´æŠ¤ç›¸å¯¹æ¯”è¾ƒç®€ç­”ã€‚é›ªèŠ±æ¨¡å‹çš„è®¾è®¡æ–¹å¼æ˜¯æ¯”è¾ƒç¬¦åˆæ•°æ®åº“èŒƒå¼çš„ç†å¿µï¼Œè®¾è®¡æ–¹å¼æ¯”è¾ƒæ­£è§„ï¼Œæ•°æ®å†—ä½™å°‘ï¼Œä½†åœ¨æŸ¥è¯¢çš„æ—¶å€™å¯èƒ½éœ€è¦joinå¤šå¼ è¡¨ä»è€Œå¯¼è‡´æŸ¥è¯¢æ•ˆç‡ä¸‹é™ï¼Œæ­¤å¤–è§„èŒƒåŒ–æ“ä½œåœ¨åæœŸç»´æŠ¤æ¯”è¾ƒå¤æ‚ã€‚æ€»ç»“é€šè¿‡ä¸Šé¢çš„å¯¹æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æ•°æ®ä»“åº“å¤§å¤šæ•°æ—¶å€™æ˜¯æ¯”è¾ƒé€‚åˆä½¿ç”¨æ˜Ÿå‹æ¨¡å‹æ„å»ºåº•å±‚æ•°æ®Hiveè¡¨ï¼Œé€šè¿‡å¤§é‡çš„å†—ä½™æ¥æå‡æŸ¥è¯¢æ•ˆç‡ï¼Œæ˜Ÿå‹æ¨¡å‹å¯¹OLAPçš„åˆ†æå¼•æ“æ”¯æŒæ¯”è¾ƒå‹å¥½ï¼Œè¿™ä¸€ç‚¹åœ¨Kylinä¸­æ¯”è¾ƒèƒ½ä½“ç°ã€‚è€Œé›ªèŠ±æ¨¡å‹åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­å¦‚MySQLï¼ŒOracleä¸­éå¸¸å¸¸è§ï¼Œå°¤å…¶åƒç”µå•†çš„æ•°æ®åº“è¡¨ã€‚åœ¨æ•°æ®ä»“åº“ä¸­é›ªèŠ±æ¨¡å‹çš„åº”ç”¨åœºæ™¯æ¯”è¾ƒå°‘ï¼Œä½†ä¹Ÿä¸æ˜¯æ²¡æœ‰ï¼Œæ‰€ä»¥åœ¨å…·ä½“è®¾è®¡çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘æ˜¯ä¸æ˜¯èƒ½ç»“åˆä¸¤è€…çš„ä¼˜ç‚¹å‚ä¸è®¾è®¡ï¼Œä»¥æ­¤è¾¾åˆ°è®¾è®¡çš„æœ€ä¼˜åŒ–ç›®çš„ã€‚å›¾ 6. ç»´åº¦å»ºæ¨¡æ³•ä¸Šå›¾çš„è¿™ä¸ªæ¶æ„ä¸­æ˜¯å…¸å‹çš„æ˜Ÿå‹æ¶æ„ã€‚æ˜Ÿå‹æ¨¡å¼ä¹‹æ‰€ä»¥å¹¿æ³›è¢«ä½¿ç”¨ï¼Œåœ¨äºé’ˆå¯¹å„ä¸ªç»´ä½œäº†å¤§é‡çš„é¢„å¤„ç†ï¼Œå¦‚æŒ‰ç…§ç»´è¿›è¡Œé¢„å…ˆçš„ç»Ÿè®¡ã€åˆ†ç±»ã€æ’åºç­‰ã€‚é€šè¿‡è¿™äº›é¢„å¤„ç†ï¼Œèƒ½å¤Ÿæå¤§çš„æå‡æ•°æ®ä»“åº“çš„å¤„ç†èƒ½åŠ›ã€‚ç‰¹åˆ«æ˜¯é’ˆå¯¹ 3NF çš„å»ºæ¨¡æ–¹æ³•ï¼Œæ˜Ÿå‹æ¨¡å¼åœ¨æ€§èƒ½ä¸Šå æ®æ˜æ˜¾çš„ä¼˜åŠ¿ã€‚åŒæ—¶ï¼Œç»´åº¦å»ºæ¨¡æ³•çš„å¦å¤–ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œç»´åº¦å»ºæ¨¡éå¸¸ç›´è§‚ï¼Œç´§ç´§å›´ç»•ç€ä¸šåŠ¡æ¨¡å‹ï¼Œå¯ä»¥ç›´è§‚çš„åæ˜ å‡ºä¸šåŠ¡æ¨¡å‹ä¸­çš„ä¸šåŠ¡é—®é¢˜ã€‚ä¸éœ€è¦ç»è¿‡ç‰¹åˆ«çš„æŠ½è±¡å¤„ç†ï¼Œå³å¯ä»¥å®Œæˆç»´åº¦å»ºæ¨¡ã€‚è¿™ä¸€ç‚¹ä¹Ÿæ˜¯ç»´åº¦å»ºæ¨¡çš„ä¼˜åŠ¿ã€‚ä½†æ˜¯ï¼Œç»´åº¦å»ºæ¨¡æ³•çš„ç¼ºç‚¹ä¹Ÿæ˜¯éå¸¸æ˜æ˜¾çš„ï¼Œç”±äºåœ¨æ„å»ºæ˜Ÿå‹æ¨¡å¼ä¹‹å‰éœ€è¦è¿›è¡Œå¤§é‡çš„æ•°æ®é¢„å¤„ç†ï¼Œå› æ­¤ä¼šå¯¼è‡´å¤§é‡çš„æ•°æ®å¤„ç†å·¥ä½œã€‚è€Œä¸”ï¼Œå½“ä¸šåŠ¡å‘ç”Ÿå˜åŒ–ï¼Œéœ€è¦é‡æ–°è¿›è¡Œç»´åº¦çš„å®šä¹‰æ—¶ï¼Œå¾€å¾€éœ€è¦é‡æ–°è¿›è¡Œç»´åº¦æ•°æ®çš„é¢„å¤„ç†ã€‚è€Œåœ¨è¿™äº›ä¸å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€ä¼šå¯¼è‡´å¤§é‡çš„æ•°æ®å†—ä½™ã€‚å¦å¤–ä¸€ä¸ªç»´åº¦å»ºæ¨¡æ³•çš„ç¼ºç‚¹å°±æ˜¯ï¼Œå¦‚æœåªæ˜¯ä¾é å•çº¯çš„ç»´åº¦å»ºæ¨¡ï¼Œä¸èƒ½ä¿è¯æ•°æ®æ¥æºçš„ä¸€è‡´æ€§å’Œå‡†ç¡®æ€§ï¼Œè€Œä¸”åœ¨æ•°æ®ä»“åº“çš„åº•å±‚ï¼Œä¸æ˜¯ç‰¹åˆ«é€‚ç”¨äºç»´åº¦å»ºæ¨¡çš„æ–¹æ³•ã€‚å› æ­¤ä»¥ç¬”è€…çš„è§‚ç‚¹çœ‹ï¼Œç»´åº¦å»ºæ¨¡çš„é¢†åŸŸä¸»è¦é€‚ç”¨ä¸æ•°æ®é›†å¸‚å±‚ï¼Œå®ƒçš„æœ€å¤§çš„ä½œç”¨å…¶å®æ˜¯ä¸ºäº†è§£å†³æ•°æ®ä»“åº“å»ºæ¨¡ä¸­çš„æ€§èƒ½é—®é¢˜ã€‚ç»´åº¦å»ºæ¨¡å¾ˆéš¾èƒ½å¤Ÿæä¾›ä¸€ä¸ªå®Œæ•´åœ°æè¿°çœŸå®ä¸šåŠ¡å®ä½“ä¹‹é—´çš„å¤æ‚å…³ç³»çš„æŠ½è±¡æ–¹æ³•ã€‚å®ä½“å»ºæ¨¡æ³•å®ä½“å»ºæ¨¡æ³•å¹¶ä¸æ˜¯æ•°æ®ä»“åº“å»ºæ¨¡ä¸­å¸¸è§çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒæ¥æºäºå“²å­¦çš„ä¸€ä¸ªæµæ´¾ã€‚ä»å“²å­¦çš„æ„ä¹‰ä¸Šè¯´ï¼Œå®¢è§‚ä¸–ç•Œåº”è¯¥æ˜¯å¯ä»¥ç»†åˆ†çš„ï¼Œå®¢è§‚ä¸–ç•Œåº”è¯¥å¯ä»¥åˆ†æˆç”±ä¸€ä¸ªä¸ªå®ä½“ï¼Œä»¥åŠå®ä½“ä¸å®ä½“ä¹‹é—´çš„å…³ç³»ç»„æˆã€‚é‚£ä¹ˆæˆ‘ä»¬åœ¨æ•°æ®ä»“åº“çš„å»ºæ¨¡è¿‡ç¨‹ä¸­å®Œå…¨å¯ä»¥å¼•å…¥è¿™ä¸ªæŠ½è±¡çš„æ–¹æ³•ï¼Œå°†æ•´ä¸ªä¸šåŠ¡ä¹Ÿå¯ä»¥åˆ’åˆ†æˆä¸€ä¸ªä¸ªçš„å®ä½“ï¼Œè€Œæ¯ä¸ªå®ä½“ä¹‹é—´çš„å…³ç³»ï¼Œä»¥åŠé’ˆå¯¹è¿™äº›å…³ç³»çš„è¯´æ˜å°±æ˜¯æˆ‘ä»¬æ•°æ®å»ºæ¨¡éœ€è¦åšçš„å·¥ä½œã€‚è™½ç„¶å®ä½“æ³•ç²—çœ‹èµ·æ¥å¥½åƒæœ‰ä¸€äº›æŠ½è±¡ï¼Œå…¶å®ç†è§£èµ·æ¥å¾ˆå®¹æ˜“ã€‚å³æˆ‘ä»¬å¯ä»¥å°†ä»»ä½•ä¸€ä¸ªä¸šåŠ¡è¿‡ç¨‹åˆ’åˆ†æˆ 3 ä¸ªéƒ¨åˆ†ï¼Œå®ä½“ï¼Œäº‹ä»¶å’Œè¯´æ˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå›¾ 7. å®ä½“å»ºæ¨¡æ³•ä¸Šå›¾è¡¨è¿°çš„æ˜¯ä¸€ä¸ªæŠ½è±¡çš„å«ä¹‰ï¼Œå¦‚æœæˆ‘ä»¬æè¿°ä¸€ä¸ªç®€å•çš„äº‹å®ï¼šâ€œå°æ˜å¼€è½¦å»å­¦æ ¡ä¸Šå­¦â€ã€‚ä»¥è¿™ä¸ªä¸šåŠ¡äº‹å®ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠâ€œå°æ˜â€ï¼Œâ€œå­¦æ ¡â€çœ‹æˆæ˜¯ä¸€ä¸ªå®ä½“ï¼Œâ€œä¸Šå­¦â€æè¿°çš„æ˜¯ä¸€ä¸ªä¸šåŠ¡è¿‡ç¨‹ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå¯ä»¥æŠ½è±¡ä¸ºä¸€ä¸ªå…·ä½“â€œäº‹ä»¶â€ï¼Œè€Œâ€œå¼€è½¦å»â€åˆ™å¯ä»¥çœ‹æˆæ˜¯äº‹ä»¶â€œä¸Šå­¦â€çš„ä¸€ä¸ªè¯´æ˜ã€‚ä»ä¸Šé¢çš„ä¸¾ä¾‹æˆ‘ä»¬å¯ä»¥äº†è§£ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æŠ½è±¡å½’çº³æ–¹æ³•å…¶å®å¾ˆç®€å•ï¼Œä»»ä½•ä¸šåŠ¡å¯ä»¥çœ‹æˆ 3 ä¸ªéƒ¨åˆ†ï¼šå®ä½“ï¼Œä¸»è¦æŒ‡é¢†åŸŸæ¨¡å‹ä¸­ç‰¹å®šçš„æ¦‚å¿µä¸»ä½“ï¼ŒæŒ‡å‘ç”Ÿä¸šåŠ¡å…³ç³»çš„å¯¹è±¡ã€‚äº‹ä»¶ï¼Œä¸»è¦æŒ‡æ¦‚å¿µä¸»ä½“ä¹‹é—´å®Œæˆä¸€æ¬¡ä¸šåŠ¡æµç¨‹çš„è¿‡ç¨‹ï¼Œç‰¹æŒ‡ç‰¹å®šçš„ä¸šåŠ¡è¿‡ç¨‹ã€‚è¯´æ˜ï¼Œä¸»è¦æ˜¯é’ˆå¯¹å®ä½“å’Œäº‹ä»¶çš„ç‰¹æ®Šè¯´æ˜ã€‚ç”±äºå®ä½“å»ºæ¨¡æ³•ï¼Œèƒ½å¤Ÿå¾ˆè½»æ¾çš„å®ç°ä¸šåŠ¡æ¨¡å‹çš„åˆ’åˆ†ï¼Œå› æ­¤ï¼Œåœ¨ä¸šåŠ¡å»ºæ¨¡é˜¶æ®µå’Œé¢†åŸŸæ¦‚å¿µå»ºæ¨¡é˜¶æ®µï¼Œå®ä½“å»ºæ¨¡æ³•æœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚ä»ç¬”è€…çš„ç»éªŒæ¥çœ‹ï¼Œå†æ²¡æœ‰ç°æˆçš„è¡Œä¸šæ¨¡å‹çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨å®ä½“å»ºæ¨¡çš„æ–¹æ³•ï¼Œå’Œå®¢æˆ·ä¸€èµ·ç†æ¸…æ•´ä¸ªä¸šåŠ¡çš„æ¨¡å‹ï¼Œè¿›è¡Œé¢†åŸŸæ¦‚å¿µæ¨¡å‹çš„åˆ’åˆ†ï¼ŒæŠ½è±¡å‡ºå…·ä½“çš„ä¸šåŠ¡æ¦‚å¿µï¼Œç»“åˆå®¢æˆ·çš„ä½¿ç”¨ç‰¹ç‚¹ï¼Œå®Œå…¨å¯ä»¥åˆ›å»ºå‡ºä¸€ä¸ªç¬¦åˆè‡ªå·±éœ€è¦çš„æ•°æ®ä»“åº“æ¨¡å‹æ¥ã€‚ä½†æ˜¯ï¼Œå®ä½“å»ºæ¨¡æ³•ä¹Ÿæœ‰ç€è‡ªå·±å…ˆå¤©çš„ç¼ºé™·ï¼Œç”±äºå®ä½“è¯´æ˜æ³•åªæ˜¯ä¸€ç§æŠ½è±¡å®¢è§‚ä¸–ç•Œçš„æ–¹æ³•ï¼Œå› æ­¤ï¼Œæ³¨å®šäº†è¯¥å»ºæ¨¡æ–¹æ³•åªèƒ½å±€é™åœ¨ä¸šåŠ¡å»ºæ¨¡å’Œé¢†åŸŸæ¦‚å¿µå»ºæ¨¡é˜¶æ®µã€‚å› æ­¤ï¼Œåˆ°äº†é€»è¾‘å»ºæ¨¡é˜¶æ®µå’Œç‰©ç†å»ºæ¨¡é˜¶æ®µï¼Œåˆ™æ˜¯èŒƒå¼å»ºæ¨¡å’Œç»´åº¦å»ºæ¨¡å‘æŒ¥é•¿å¤„çš„é˜¶æ®µã€‚å› æ­¤ï¼Œç¬”è€…å»ºè®®è¯»è€…åœ¨åˆ›å»ºè‡ªå·±çš„æ•°æ®ä»“åº“æ¨¡å‹çš„æ—¶å€™ï¼Œå¯ä»¥å‚è€ƒä½¿ç”¨ä¸Šè¿°çš„ä¸‰ç§æ•°æ®ä»“åº“å¾—å»ºæ¨¡æ–¹æ³•ï¼Œåœ¨å„ä¸ªä¸åŒé˜¶æ®µé‡‡ç”¨ä¸åŒçš„æ–¹æ³•ï¼Œä»è€Œèƒ½å¤Ÿä¿è¯æ•´ä¸ªæ•°æ®ä»“åº“å»ºæ¨¡çš„è´¨é‡ã€‚æ•°æ®ä»“åº“æ•°æ®æ¨¡å‹ä¸ä¸šåŠ¡ç³»ç»Ÿæ•°æ®æ¨¡å‹è®¾è®¡çš„åŒºåˆ«æ•°æ®ä»“åº“å»ºæ¨¡æ ·ä¾‹ä¸Šé¢ä»‹ç»å¾—æ˜¯ä¸€äº›æŠ½è±¡å¾—å»ºæ¨¡æ–¹æ³•å’Œç†è®ºï¼Œå¯èƒ½ç†è§£èµ·æ¥ç›¸å¯¹æœ‰äº›éš¾åº¦ï¼Œå› æ­¤ï¼Œç¬”è€…åœ¨è¿™é‡Œä¸¾ä¸€ä¸ªä¾‹å­ï¼Œè¯»è€…å¯ä»¥è·Ÿç€æˆ‘ä»¬çš„è¿™ä¸ªæ ·ä¾‹ï¼Œæ¥åˆæ­¥äº†è§£æ•´ä¸ªæ•°æ®ä»“åº“å»ºæ¨¡çš„å¤§æ¦‚è¿‡ç¨‹ã€‚èƒŒæ™¯ä»‹ç»ç†Ÿæ‚‰ç¤¾ä¿è¡Œä¸šçš„è¯»è€…å¯ä»¥çŸ¥é“ï¼Œç›®å‰æˆ‘ä»¬å›½å®¶çš„ç¤¾ä¿ä¸»è¦åˆ†ä¸ºå…»è€ï¼Œå¤±ä¸šï¼Œå·¥ä¼¤ï¼Œç”Ÿè‚²ï¼ŒåŒ»ç–—ä¿é™©å’ŒåŠ³åŠ¨åŠ›å¸‚åœºè¿™ 6 å¤§å—ä¸»è¦ä¸šåŠ¡é¢†åŸŸã€‚åœ¨è¿™ 6 å¤§ä¸šåŠ¡é¢†åŸŸä¸­ï¼Œç›®å‰çš„çŠ¶å†µå…»è€å’Œäº‹ä¸šçš„ç³»ç»Ÿå·²ç»åŸºæœ¬å®Œå–„ï¼Œå·²ç»æœ‰ä¸€éƒ¨åˆ†æ•°æ®å¼€å§‹è”ç½‘æ£€æµ‹ã€‚è€Œï¼Œå¯¹äºå·¥ä¼¤ï¼Œç”Ÿè‚²ï¼ŒåŒ»ç–—å’ŒåŠ³åŠ¨åŠ›å¸‚åœºè¿™ä¸€å—ä¸šåŠ¡ï¼Œæœ‰äº›åœ°æ–¹å‘å±•çš„æ¯”è¾ƒæˆç†Ÿï¼Œè€Œæœ‰äº›åœ°æ–¹è¿˜ä¸å¤Ÿæˆç†Ÿã€‚1.ä¸šåŠ¡å»ºæ¨¡é˜¶æ®µåŸºäºä»¥ä¸Šçš„èƒŒæ™¯ä»‹ç»ï¼Œæˆ‘ä»¬åœ¨ä¸šåŠ¡å»ºæ¨¡é˜¶æ®µï¼Œå°±å¾ˆå®¹æ˜“æ¥åˆ’åˆ†ç›¸åº”çš„ä¸šåŠ¡ã€‚å› æ­¤ï¼Œåœ¨ä¸šåŠ¡å»ºæ¨¡é˜¶æ®µï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šç¡®å®šæˆ‘ä»¬æœ¬æ¬¡æ•°æ®ä»“åº“å»ºè®¾çš„ç›®æ ‡ï¼Œå»ºè®¾çš„æ–¹æ³•ï¼Œä»¥åŠé•¿è¿œè§„åˆ’ç­‰ã€‚å¦‚ä¸‹å›¾ï¼šå›¾ 8. ä¸šåŠ¡å»ºæ¨¡é˜¶æ®µåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†æ•´ä¸ªä¸šåŠ¡å¾ˆæ¸…æ¥šåœ°åˆ’åˆ†æˆäº†å‡ ä¸ªå¤§çš„ä¸šåŠ¡ä¸»çº¿ï¼Œä¾‹å¦‚ï¼šå…»è€ï¼Œå¤±ä¸šï¼Œå·¥ä¼¤ï¼Œç”Ÿè‚²ï¼ŒåŒ»ç–—ï¼ŒåŠ³åŠ¨åŠ›ç­‰ç€å‡ ä¸ªå¤§çš„éƒ¨åˆ†ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™äº›å¤§çš„æ¨¡å—ï¼Œåœ¨æ¯ä¸ªä¸šåŠ¡ä¸»çº¿å†…ï¼Œè€ƒè™‘å…·ä½“çš„ä¸šåŠ¡ä¸»çº¿å†…éœ€è¦åˆ†æçš„ä¸šåŠ¡ä¸»é¢˜ã€‚å› æ­¤ï¼Œä¸šåŠ¡å»ºæ¨¡é˜¶æ®µå…¶å®æ˜¯ä¸€æ¬¡å’Œä¸šåŠ¡äººå‘˜æ¢³ç†ä¸šåŠ¡çš„è¿‡ç¨‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸ä»…èƒ½å¸®åŠ©æˆ‘ä»¬æŠ€æœ¯äººå‘˜æ›´å¥½çš„ç†è§£ä¸šåŠ¡ï¼Œå¦ä¸€æ–¹é¢ï¼Œä¹Ÿèƒ½å¤Ÿå‘ç°ä¸šåŠ¡æµç¨‹ä¸­çš„ä¸€äº›ä¸åˆç†çš„ç¯èŠ‚ï¼ŒåŠ ä»¥æ”¹å–„å’Œæ”¹è¿›ã€‚åŒæ—¶ï¼Œä¸šåŠ¡å»ºæ¨¡é˜¶æ®µçš„å¦ä¸€ä¸ªé‡è¦å·¥ä½œå°±æ˜¯ç¡®å®šæˆ‘ä»¬æ•°æ®å»ºæ¨¡çš„èŒƒå›´ï¼Œä¾‹å¦‚ï¼šåœ¨æŸäº›æ•°æ®å‡†å¤‡ä¸å¤Ÿå……åˆ†çš„ä¸šåŠ¡æ¨¡å—å†…ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å…ˆä¸å»ºè®¾ç›¸åº”çš„æ•°æ®æ¨¡å‹ã€‚ç­‰åˆ°æ¡ä»¶å……åˆ†æˆç†Ÿçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¥è€ƒè™‘æ•°æ®å»ºæ¨¡çš„é—®é¢˜ã€‚é¢†åŸŸæ¦‚å¿µå»ºæ¨¡é˜¶æ®µé¢†åŸŸæ¦‚å¿µå»ºæ¨¡é˜¶æ®µæ˜¯æ•°æ®ä»“åº“æ•°æ®å»ºæ¨¡çš„ä¸€ä¸ªé‡è¦é˜¶æ®µï¼Œç”±äºæˆ‘ä»¬åœ¨ä¸šåŠ¡å»ºæ¨¡é˜¶æ®µå·²ç»å®Œå…¨ç†æ¸…ç›¸åº”çš„ä¸šåŠ¡èŒƒå›´å’Œæµç¨‹ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªé¢†åŸŸæ¦‚å¿µå»ºæ¨¡é˜¶æ®µçš„æœ€ä¸»è¦çš„å·¥ä½œå°±æ˜¯è¿›è¡Œæ¦‚å¿µçš„æŠ½è±¡ï¼Œæ•´ä¸ªé¢†åŸŸæ¦‚å¿µå»ºæ¨¡çš„å·¥ä½œå±‚æ¬¡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå›¾ 9. é¢†åŸŸæ¦‚å¿µå»ºæ¨¡é˜¶æ®µä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œé¢†åŸŸæ¦‚å¿µå»ºæ¨¡å°±æ˜¯è¿ç”¨äº†å®ä½“å»ºæ¨¡æ³•ï¼Œä»çº·ç¹çš„ä¸šåŠ¡è¡¨è±¡èƒŒåé€šè¿‡å®ä½“å»ºæ¨¡æ³•ï¼ŒæŠ½è±¡å‡ºå®ä½“ï¼Œäº‹ä»¶ï¼Œè¯´æ˜ç­‰æŠ½è±¡çš„å®ä½“ï¼Œä»è€Œæ‰¾å‡ºä¸šåŠ¡è¡¨è±¡åæŠ½è±¡å®ä½“é—´çš„ç›¸äº’çš„å…³è”æ€§ï¼Œä¿è¯äº†æˆ‘ä»¬æ•°æ®ä»“åº“æ•°æ®æŒ‰ç…§æ•°æ®æ¨¡å‹æ‰€èƒ½è¾¾åˆ°çš„ä¸€è‡´æ€§å’Œå…³è”æ€§ã€‚ä»å›¾ä¸Šçœ‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ•´ä¸ªæŠ½è±¡è¿‡ç¨‹åˆ†ä¸ºå››ä¸ªå±‚æ¬¡ï¼Œåˆ†åˆ«ä¸ºï¼šæŠ½è±¡æ–¹æ³•å±‚ï¼Œæ•´ä¸ªæ•°æ®æ¨¡å‹çš„æ ¸å¿ƒæ–¹æ³•ï¼Œé¢†åŸŸæ¦‚å¿µå»ºæ¨¡çš„å®ä½“çš„åˆ’åˆ†é€šè¿‡è¿™ç§æŠ½è±¡æ–¹æ³•æ¥å®ç°ã€‚é¢†åŸŸæ¦‚å¿µå±‚ï¼Œè¿™æ˜¯æˆ‘ä»¬æ•´ä¸ªæ•°æ®æ¨¡å‹çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå› ä¸ºä¸åŒç¨‹åº¦çš„æŠ½è±¡æ–¹æ³•ï¼Œå†³å®šäº†æˆ‘ä»¬é¢†åŸŸæ¦‚å¿µçš„ä¸åŒã€‚ä¾‹å¦‚ï¼šåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œå‚ä¸æ–¹â€è¿™ä¸ªæ¦‚å¿µï¼ŒåŒæ—¶ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠä»–åˆ†æˆä¸‰ä¸ªæ¦‚å¿µï¼šâ€œä¸ªäººâ€ï¼Œâ€œå…¬å¸â€ï¼Œå’Œâ€œç»åŠæœºæ„â€è¿™ä¸‰ä¸ªæ¦‚å¿µã€‚è€Œæˆ‘ä»¬åœ¨æ„å»ºè‡ªå·±çš„æ¨¡å‹çš„æ—¶å€™ï¼Œå¯ä»¥å‚è€ƒä¸šåŠ¡çš„çŠ¶å†µä»¥åŠæˆ‘ä»¬è‡ªå·±æ¨¡å‹çš„éœ€è¦ï¼Œé€‰æ‹©æŠ½è±¡ç¨‹åº¦é«˜çš„æ¦‚å¿µæˆ–è€…æ˜¯æŠ½è±¡ç¨‹åº¦ä½çš„æ¦‚å¿µã€‚ç›¸å¯¹æ¥è¯´ï¼ŒæŠ½è±¡ç¨‹åº¦é«˜çš„æ¦‚å¿µï¼Œç†è§£èµ·æ¥è¾ƒä¸ºå¤æ‚ï¼Œéœ€è¦ä¸“ä¸šçš„å»ºæ¨¡ä¸“å®¶æ‰èƒ½ç†è§£ï¼Œè€ŒæŠ½è±¡ç¨‹åº¦ä½çš„æ¦‚å¿µï¼Œè¾ƒé€‚åˆäºä¸€èˆ¬ä¸šåŠ¡äººå‘˜çš„ç†è§£ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ã€‚ç¬”è€…åœ¨è¿™é‡Œå»ºè®®è¯»è€…å¯ä»¥é€‰ç”¨æŠ½è±¡æ¦‚å¿µè¾ƒä½çš„å®ä½“ï¼Œä»¥æ–¹ä¾¿ä¸šåŠ¡äººå‘˜å’ŒæŠ€æœ¯äººå‘˜ä¹‹é—´çš„äº¤æµå’Œæ²Ÿé€šã€‚å…·ä½“ä¸šåŠ¡å±‚ï¼Œä¸»è¦æ˜¯è§£å†³å…·ä½“çš„ä¸šåŠ¡é—®é¢˜ï¼Œä»è¿™å¼ å›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå…·ä½“çš„ä¸šåŠ¡å±‚ï¼Œå…¶å®åªæ˜¯é¢†åŸŸæ¦‚å¿µæ¨¡å‹ä¸­å®ä½“ä¹‹é—´çš„ä¸€äº›ä¸åŒç»„åˆè€Œå·²ã€‚å› æ­¤ï¼Œå®Œæ•´çš„æ•°æ®ä»“åº“çš„æ•°æ®æ¨¡å‹åº”è¯¥èƒ½å¤Ÿç›¸åº”çµæ´»å¤šå˜çš„å‰ç«¯ä¸šåŠ¡çš„éœ€æ±‚ï¼Œè€Œå…¶æœ¬èº«çš„æ¨¡å‹æ¶æ„å…·æœ‰å¾ˆå¼ºçš„çµæ´»æ€§ã€‚è¿™ä¹Ÿæ˜¯æ•°æ®ä»“åº“æ¨¡å‹æ‰€å…·å¤‡çš„åŠŸèƒ½ä¹‹ä¸€ã€‚ä¸šåŠ¡ä¸»çº¿å±‚ï¼Œè¿™ä¸ªå±‚æ¬¡ä¸»è¦åˆ’åˆ†å¤§çš„ä¸šåŠ¡é¢†åŸŸï¼Œä¸€èˆ¬åœ¨ä¸šåŠ¡å»ºæ¨¡é˜¶æ®µå³å·²ç»å®Œæˆè¿™æ–¹é¢çš„åˆ’åˆ†ã€‚æˆ‘ä»¬ä¸€èˆ¬é€šè¿‡è¿™ç§å¤§çš„ä¸šåŠ¡ä¸»çº¿æ¥åˆ’åˆ†æ•´ä¸ªä¸šåŠ¡æ¨¡å‹å¤§çš„æ¡†æ¶ã€‚é€šè¿‡é¢†åŸŸæ¦‚å¿µå»ºæ¨¡ï¼Œæ•°æ®ä»“åº“çš„æ¨¡å‹å·²ç»è¢«æŠ½è±¡æˆä¸€ä¸ªä¸ªçš„å®ä½“ï¼Œæ¨¡å‹çš„æ¡†æ¶å·²ç»æ­å»ºå®Œæ¯•ï¼Œä¸‹é¢çš„å·¥ä½œå°±æ˜¯ç»™è¿™äº›æ¡†æ¶æ³¨å…¥æœ‰æ•ˆçš„è‚Œä½“ã€‚é€»è¾‘å»ºæ¨¡é˜¶æ®µé€šè¿‡é¢†åŸŸæ¦‚å¿µå»ºæ¨¡ä¹‹åï¼Œè™½ç„¶æ¨¡å‹çš„æ¡†æ¶å·²ç»å®Œæˆï¼Œä½†æ˜¯è¿˜æœ‰å¾ˆå¤šç»†è‡´çš„å·¥ä½œéœ€è¦å®Œæˆã€‚ä¸€èˆ¬åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬è¿˜éœ€è¦åšéå¸¸å¤šçš„å·¥ä½œï¼Œä¸»è¦åŒ…æ‹¬ï¼šå®ä¾‹è¯æ¯ä¸€ä¸ªæŠ½è±¡çš„å®ä½“ï¼Œä¾‹å¦‚ï¼šåœ¨ä¸Šé¢çš„æ¦‚å¿µæ¨¡å‹ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å¯¹â€œäººâ€å’Œâ€œå…¬å¸â€ç­‰è¿™äº›æŠ½è±¡å®ä½“è¿›è¡Œå®ä¾‹åŒ–ã€‚ä¸»è¦æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘â€œäººâ€çš„å±æ€§åŒ…æ‹¬é‚£äº›ï¼Œåœ¨ä¸šåŠ¡æ¨¡å—ä¸­ï¼Œç”¨åˆ°çš„æ‰€æœ‰è·Ÿâ€œäººâ€ç›¸å…³çš„å±æ€§æ˜¯å“ªäº›ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å°†è¿™äº›å±æ€§é™„ç€åœ¨æˆ‘ä»¬æ•°æ®æ¨¡å‹çš„â€œäººâ€è¿™ä¸ªå®ä½“ä¸Šï¼Œä¾‹å¦‚â€œäººâ€å¾—å¹´é¾„ï¼Œæ€§åˆ«ï¼Œå—æ•™è‚²ç¨‹åº¦ç­‰ç­‰ã€‚åŒç†ï¼Œæˆ‘ä»¬å¯¹å…¶ä»–å±æ€§åŒæ ·éœ€è¦åšè¿™ä¸ªå·¥ä½œã€‚æ‰¾å‡ºæŠ½è±¡å®ä½“é—´çš„è”ç³»ï¼Œå¹¶å°†å…¶å®ä¾‹è¯ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä¸»è¦è€ƒè™‘æ˜¯â€œäº‹ä»¶â€è¿™ä¸ªæŠ½è±¡æ¦‚å¿µçš„å®ä¾‹è¯ï¼Œä¾‹å¦‚ï¼šå¯¹äºå…»è€é‡‘å¾ç¼´è¿™ä¸ªâ€œäº‹ä»¶â€çš„å±æ€§å¾—è€ƒè™‘ï¼Œå¯¹äºå¤±ä¸šåŠ³åŠ¨è€…åŸ¹è®­è¿™ä¸ªâ€œäº‹ä»¶â€çš„å±æ€§å¾—è€ƒè™‘ç­‰ç­‰ã€‚æ‰¾å‡ºæŠ½è±¡äº‹ä»¶çš„å…³ç³»ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè¯´æ˜ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä¸»è¦æ˜¯è¦é’ˆå¯¹â€œäº‹ä»¶â€è¿›è¡Œå®Œå–„çš„â€œè¯´æ˜â€ã€‚ä¾‹å¦‚ï¼šå¯¹äºâ€œäº‹ä»¶â€ä¸­çš„åœ°åŸŸï¼Œäº‹ä»¶ç­‰å› ç´ çš„è€ƒé‡ç­‰ç­‰ã€‚æ€»è€Œè¨€ä¹‹ï¼Œåœ¨é€»è¾‘å»ºæ¨¡é˜¶æ®µï¼Œæˆ‘ä»¬ä¸»è¦è€ƒè™‘å¾—æ˜¯æŠ½è±¡å®ä½“çš„ä¸€äº›ç»†è‡´çš„å±æ€§ã€‚é€šè¿‡é€»è¾‘å»ºæ¨¡é˜¶æ®µï¼Œæˆ‘ä»¬æ‰èƒ½å¤Ÿå°†æ•´ä¸ªæ¦‚å¿µæ¨¡å‹å®Œæ•´ä¸²è”æˆä¸€ä¸ªæœ‰æœºçš„å®ä½“ï¼Œæ‰èƒ½å¤Ÿå®Œæ•´çš„è¡¨è¾¾å‡ºä¸šåŠ¡ä¹‹é—´çš„å…³è”æ€§ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œç¬”è€…å»ºè®®å¤§å®¶å¯ä»¥å‚è€ƒ 3NF çš„å»ºæ¨¡æ–¹æ³•ï¼Œè¡¨è¾¾å‡ºå®ä½“çš„å±æ€§ï¼Œä»¥åŠå®ä½“ä¸å®ä½“ä¹‹é—´çš„è”ç³»ã€‚ä¾‹å¦‚ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡‡ç”¨ ERWIN ç­‰å»ºæ¨¡å·¥å…·ç­‰ä½œå‡ºç¬¦åˆ 3NF çš„å…³ç³»å‹æ•°æ®æ¨¡å‹æ¥ã€‚ç‰©ç†å»ºæ¨¡é˜¶æ®µç‰©ç†å»ºæ¨¡é˜¶æ®µæ˜¯æ•´ä¸ªæ•°æ®å»ºæ¨¡çš„æœ€åä¸€ä¸ªè¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å…¶å®æ˜¯å°†å‰é¢çš„é€»è¾‘æ•°æ®æ¨¡å‹è½åœ°çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚è€ƒè™‘åˆ°æ•°æ®ä»“åº“å¹³å°çš„ä¸åŒï¼Œå› æ­¤ï¼Œæ•°æ®æ¨¡å‹å¾—ç‰©ç†å»ºæ¨¡è¿‡ç¨‹å¯èƒ½ä¼šç¨å¾®æœ‰ä¸€äº›ä¸åŒï¼Œåœ¨è¿™ä¸ªé˜¶æ®µæˆ‘ä»¬ä¸»è¦çš„å·¥ä½œæ˜¯ï¼šç”Ÿæˆåˆ›å»ºè¡¨çš„è„šæœ¬ã€‚ä¸åŒçš„æ•°æ®ä»“åº“å¹³å°å¯èƒ½ç”Ÿæˆä¸åŒçš„è„šæœ¬ã€‚é’ˆå¯¹ä¸åŒçš„æ•°æ®ä»“åº“å¹³å°ï¼Œè¿›è¡Œä¸€äº›ç›¸åº”çš„ä¼˜åŒ–å·¥ä½œï¼Œä¾‹å¦‚å¯¹äº DB2 æ•°æ®ä»“åº“æ¥è¯´ï¼Œåˆ›å»ºä¸€äº› MQT è¡¨ï¼Œæ¥åŠ é€ŸæŠ¥è¡¨çš„ç”Ÿæˆç­‰ç­‰ã€‚é’ˆå¯¹æ•°æ®é›†å¸‚çš„éœ€è¦ï¼ŒæŒ‰ç…§ç»´åº¦å»ºæ¨¡çš„æ–¹æ³•ï¼Œç”Ÿæˆä¸€äº›äº‹å®è¡¨ï¼Œç»´è¡¨ç­‰å·¥ä½œã€‚é’ˆå¯¹æ•°æ®ä»“åº“çš„ ETL è½¦å’Œå…ƒæ•°æ®ç®¡ç†çš„éœ€è¦ï¼Œç”Ÿæˆä¸€äº›æ•°æ®ä»“åº“ç»´æŠ¤çš„è¡¨ï¼Œä¾‹å¦‚ï¼šæ—¥å¿—è¡¨ç­‰ã€‚ç»è¿‡ç‰©ç†å»ºæ¨¡é˜¶æ®µï¼Œæ•´ä¸ªæ•°æ®ä»“åº“çš„æ¨¡å‹å·²ç»å…¨éƒ¨å®Œæˆï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§è‡ªå·±çš„è®¾è®¡æ¥é’ˆå¯¹å½“å‰çš„è¡Œä¸šåˆ›å»ºæ»¡è¶³è‡ªå·±éœ€è¦çš„æ•°æ®æ¨¡å‹æ¥ã€‚è¿™é‡Œï¼Œç¬”è€…é€šè¿‡ä¸€ä¸ªæ•°æ®å»ºæ¨¡çš„æ ·ä¾‹ï¼Œå¸Œæœ›èƒ½å¤Ÿç»™è¯»è€…ä¸€ä¸ªå…³äºæ•°æ®ä»“åº“å»ºæ¨¡çš„æ„Ÿæ€§çš„è®¤è¯†ã€‚å¸Œæœ›è¯»è€…åœ¨åˆ©ç”¨è¿™äº›æ•°æ®ä»“åº“å¾—å»ºæ¨¡æ–¹æ³•åˆ›å»ºè‡ªå·±çš„æ•°æ®æ¨¡å‹çš„æ—¶å€™ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡å®é™…çš„éœ€è¦å’Œè‡ªå·±å¯¹æŠ½è±¡èƒ½åŠ›çš„æŠŠæ¡æ¥åˆ›å»ºé€‚åˆè‡ªå·±çš„æ•°æ®æ¨¡å‹ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"æ•°æ®ä»“åº“","slug":"æ•°æ®ä»“åº“","permalink":"cpeixin.cn/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"}]},{"title":"æ•°æ®ä»“åº“ - æ¶æ„è®¾è®¡","slug":"æ•°æ®ä»“åº“æ¶æ„è®¾è®¡","date":"2018-08-22T15:26:15.000Z","updated":"2020-08-02T13:25:08.051Z","comments":true,"path":"2018/08/22/æ•°æ®ä»“åº“æ¶æ„è®¾è®¡/","link":"","permalink":"cpeixin.cn/2018/08/22/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/","excerpt":"","text":"ä¸šåŠ¡æ•°æ®èƒŒæ™¯æˆ‘æ‰€åœ¨çš„å…¬å¸å¤„ç†çš„æ•°æ®ä¸»è¦æ˜¯æ¸¸æˆè¿‡ç¨‹æ•°æ®ï¼Œç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œæ¸¸æˆå¸æ¶ˆè´¹æ•°æ®è¿˜æœ‰å…¶ä»–ä¸šåŠ¡éƒ¨é—¨ç»´æŠ¤çš„ä¾‹å¦‚ç”¨æˆ·ä¼˜æƒ æ•°æ®ï¼Œæ¸¸æˆæ´»åŠ¨ç­‰ä¸šåŠ¡æ•°æ®ã€‚å…¶ä¸­å¯¹äºä¸šåŠ¡ç³»ç»ŸDBMSä¸­çš„æ•°æ®ï¼ŒåŸºæœ¬æŒ‰ç…§â€œå¤©â€ä½œä¸ºæ—¶é—´ç²’åº¦æ¥é‡‡é›†åˆ°æ•°æ®ä»“åº“ä¸­ï¼Œå¯¹äºå®æ—¶æ€§è¦æ±‚è¾ƒå¼ºçš„æ¸¸æˆæ•°æ®ï¼Œåˆ™æ˜¯éœ€è¦é‡‡ç”¨åŸ‹ç‚¹å®æ—¶é‡‡é›†å’Œå¤„ç†çš„ã€‚éœ€æ±‚çš„å¤šæ ·åŒ–å’Œå¤æ‚æ€§ï¼Œè¿è¥äººå‘˜å¸Œæœ›åšåˆ°ç²¾ç»†åŒ–è¿è¥å’Œæ•°æ®æŒ‡æ ‡çš„å®æ—¶å“åº”, è¿™è¦æ±‚æ•°æ®ä»“åº“å…·æœ‰æä¾›é«˜æ•ˆæ˜ç»†æ•°æ®èƒ½åŠ›,ä¹Ÿèƒ½éšæ—¶æä¾›æœ€æ–°çš„æ•°æ®è°ƒå–ï¼Œä¸ºäº†æ»¡è¶³ä¸åŒå±‚æ¬¡çš„æ•°æ®æå‡ºå’Œåˆ†æ, å°±è¦æ±‚ç€æ•°æ®ä»“åº“åœ¨è®¾è®¡ä¹‹åˆï¼Œå°±è¦è€ƒè™‘åˆ°è¦åŒæ—¶æ”¯æŒç¦»çº¿å’Œå®æ—¶çš„æƒ…å†µã€‚æ•°æ®ä»“åº“æ¶æ„ç†å¿µè®¾è®¡æ•°æ®ä»“åº“æ¶æ„ä¹‹åˆï¼Œæˆ‘ä»¬å¤§æ•°æ®å·¥ç¨‹ç»„å›¢é˜Ÿå¼€ä¼šè®¨è®ºçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ï¼šWho is the User of Data in Data Warehouseï¼Ÿè¿™ä»¶äº‹æƒ…è¿˜æ˜¯å¾ˆé‡è¦çš„ï¼Œå¼„æ¸…æ¥šäº†è¿™ä»¶äº‹ï¼Œå¯¹äºæ¥ä¸‹æ¥æ¶æ„è®¾è®¡å’Œæ•°ä»“æ•°æ®ä¸»é¢˜çš„ç¡®å®šéƒ½æ˜¯æœ‰å½±å“çš„ï¼Œå…¶ä¸­å¯¹äºæ¶æ„è®¾è®¡æ¥è¯´ï¼Œè¿™å†³å®šäº†æˆ‘ä»¬æ¶æ„ä¸Šå±‚éœ€è¦æä¾›å“ªäº›æ¥å£ï¼Œå¯¹æ¥ä¸åŒçš„ä¸šåŠ¡ç³»ç»Ÿï¼Œæˆ‘ä»¬åº”è¯¥è®¾è®¡æ€æ ·çš„æŸ¥è¯¢å’Œç´¢å¼•ï¼Œä¸åŒçš„ä½¿ç”¨è€…ï¼Œèƒ½å¤Ÿæ¥å—çš„æ•°æ®ç²’åº¦æˆ–è€…æ˜¯æ•°æ®å“åº”æ—¶é—´ï¼Œæ•´ä¸ªæ•°æ®ä»“åº“çš„æ•°æ®æµå¤§è‡´åº”è¯¥æ€æ ·æµå‘ï¼Œè¿™éƒ½ä¸ä½¿ç”¨ç”¨æˆ·æœ‰å…³ã€‚åœ¨æ¶æ„è®¾è®¡æ–¹é¢ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ç”±ä¸‹åˆ°ä¸Šçš„å»è®¾è®¡ï¼Œä½†æ˜¯å‘¢ï¼Œä¹Ÿä¸å¦¨ä»ä¸Šå±‚éœ€æ±‚å¼€å§‹ï¼Œå‘ä¸‹å±‚å®ç°è®¾è®¡å¼€å§‹âœŒï¸æ¶æ„å›¾è¯ä¸å¤šè¯´ï¼Œpoå›¾ğŸ‘½æ¶æ„å±‚æ¬¡&amp;æŠ€æœ¯é€‰å‹æ•°æ®æºç”±äºå…¬å¸å„ä¸šåŠ¡éƒ¨é—¨çš„æ•°æ®éƒ½ç”±è¿ç»´DBAç»Ÿä¸€ç®¡ç†å’Œåšæƒé™æ§åˆ¶ï¼ŒRDBMSä¸­çš„æ•°æ®çš„é‡‡é›†ï¼Œéœ€è¦ç”±è¿ç»´éƒ¨é—¨ç»™å‡ºå¤‡åº“URLï¼Œé¿å…ç›´æ¥æ¥å–ä¸»åº“æ•°æ®ï¼Œå¯¹çº¿ä¸Šä¸šåŠ¡äº§ç”Ÿå½±å“ã€‚è¿™éƒ¨ä»½çš„æ•°æ®é‡‡é›†ï¼Œä¸»è¦æ¶‰åŠSqoopï¼ŒNIFIï¼ŒSpark è¿™ä¸‰ä¸ªå·¥å…·ã€‚Sqoopåœ¨ä¸Šä¸€ç‰ˆçš„æ•°æ®ä»“åº“ä¸­ï¼ŒSqoopæ˜¯ä½œä¸ºRDBMS -&gt; HDFSä¸­ä¸»è¦çš„æ¬è¿å·¥ã€‚ä¸»è¦åŸå› æ˜¯å¼€å‘æˆæœ¬å°ï¼Œæ•°æ®é‡å°ï¼Œä½¿ç”¨ç®€å•ã€‚ä½†æ˜¯éšç€æ•°ä»“åŸå§‹å±‚æ•°æ®é‡æ¿€å¢äº†åŸæ¥çš„ä¸‰å€ï¼ŒSqoopè®¡ç®—èƒ½åŠ›å°±æ‰è¥Ÿè§è‚˜äº†ï¼Œæ¯å¤©çš„ç¬¬ä¸€ä¸ªä»»åŠ¡å°±æ˜¯æ‹‰å–åŸå§‹å±‚æ•°æ®ï¼Œå¦‚æœç»§ç»­ä½¿ç”¨Sqoopï¼Œä¼šä¸¥é‡å½±å“æ¥ä¸‹æ¥å…¶ä»–ä¾‹è¡Œä»»åŠ¡çš„æŒ‰æ—¶è¿›è¡Œã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å†³å®šæŠ›å¼ƒè¿™ä¸ªä½¿ç”¨MapReduceä½œä¸ºè®¡ç®—æ¡†æ¶çš„æ•°æ®åŒæ­¥å·¥å…·ã€‚Sparkæå‡æ•°ä»“åŸå§‹æ•°æ®å±‚æ‹‰å–é€Ÿåº¦ï¼Œå°±è¦é€‰æ‹©åˆé€‚çš„æ‹‰å»å·¥å…·ã€‚é¢å¯¹æ‹‰å»åŸå§‹æ•°æ®ï¼ŒåŸºæœ¬ä¸Šä¸éœ€è¦å¯¹ä»»ä½•æ•°æ®å­—æ®µè¿›è¡Œæ¸…æ´—ï¼ŒåŸºæœ¬ä¸Šç›´æ¥ä¸‹ select columnså°±å¯ä»¥æ»¡è¶³è¦æ±‚ï¼Œ æ‰€ä»¥é€‰ç”¨Spark SQLï¼Œ read jdbc -&gt; dataframe -&gt; writeInto -&gt; Hiveã€‚è¿™æ ·è¿è¡Œçš„é€Ÿåº¦ç›¸å¯¹Sqoopæ¥è¯´ï¼Œæå‡äº†å››å€âœŒï¸NIFINIFIè¿™ä¸ªå·¥å…·ï¼Œå¹¶æ²¡æœ‰ä½œä¸ºä¸»è¦çš„æ•°æ®å·¥å…·æ¥ä½¿ç”¨ï¼Œèµ·åˆåªæ˜¯ä½œä¸ºå›¢é˜Ÿçš„æŠ€æœ¯è°ƒç ”å¯¹è±¡ï¼Œåœ¨å‡ æ¬¡çš„åˆ†äº«ä¼šä¸Šï¼Œå¤§å®¶å¯¹NIFIéƒ½æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œå¯èƒ½æ˜¯å¤§å®¶éƒ½æƒ³è§£æ”¾åŒæ‰‹ï¼Œç”¨æ‹–æ‹½çš„å½¢å¼æ¥æ‹’ç»å†™ä»£ç  å“ˆå“ˆå“ˆå“ˆã€‚å°±è¿™æ ·ï¼ŒNIFIä½œä¸ºä¸€ä¸ªæŠ€æœ¯å‚¨å¤‡ï¼Œæ‰¿æ‹…äº†teståº“ä¸­æµ‹è¯•æ•°æ®çš„åŒæ­¥ï¼Œç­‰ä»¥åå›¢é˜Ÿäººæ‰‹å……è¶³äº†ï¼Œæœ‰ç»´æŠ¤å¤šæ¡†æ¶çš„èƒ½åŠ›æ—¶å¯ä»¥è€ƒè™‘å‘æŒ¥NIFIçš„æ›´å¤šç”¨å¤„ã€‚å¦å¤–å¯¹äºåŸ‹ç‚¹æ•°æ®ï¼Œäº§å“æ–¹ä¼šå°†æ•°æ®æ‰“åˆ°è¿ç»´çš„kafkaä¸­ï¼Œéšåæˆ‘ä»¬ä¼šä½¿ç”¨fluentdå°†è¿ç»´kafkaä¸­çš„æ•°æ®å®æ—¶è½¬å‘åˆ°æˆ‘ä»¬å¤§æ•°æ®å¹³å°ä¸­çš„kafkaä¸­ï¼Œåšæ¥ä¸‹æ¥çš„å¤„ç†Fluentdè¿ç»´çš„kafkaä¸­ï¼Œä¼šæ”¶é›†è¿™æˆ‘ä»¬æƒ³è¦çš„æ—¥å¿—æ•°æ®å’ŒåŸ‹ç‚¹æ•°æ®ï¼ŒåŸ‹ç‚¹æ•°æ®ä¸€èˆ¬ä¸ºjsonæ ¼å¼ï¼Œå°†æ•°æ®è§£æå’Œæ‰“åˆ°å¤§æ•°æ®å¹³å°kafkaçš„è¿™ä¸€æ®µä¸­ï¼Œæˆ‘ä»¬åœ¨Logstash,Fluentdä¸¤ä¸ªå·¥å…·ä¸­è¿›è¡Œé€‰æ‹©ï¼ŒLogstashæ˜¯éå¸¸å‡ºåçš„ELKä¸­çš„ â€˜Lâ€™ , æˆç†Ÿåº¦å’Œç¨³å®šæ€§ä¸ç”¨è¯´ã€‚Fluentdåˆ™æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡æ¥è§¦ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰äº²è‡ªå¯¹Fluentdå’ŒLogstashè¿›è¡Œæ•ˆç‡å’Œèµ„æºæ¶ˆè€—ä¸Šåšæµ‹è¯•ï¼Œä½†æ˜¯æ ¹æ®ç½‘ä¸Šå‡ ç¯‡å¯¹æ¯”æµ‹è¯„æ–‡ç« ï¼ŒFluentdçš„æ”¯æŒåº¦è™½æ²¡æœ‰Logstashé‚£ä¹ˆå®Œæ•´ï¼Œä½†æ˜¯Fluentdä¸­çš„æ’ä»¶å®Œå…¨èƒ½æ»¡è¶³æˆ‘ä»¬çš„å¼€å‘éœ€æ±‚ï¼Œæœ€é‡è¦çš„ï¼ŒFluentdåœ¨CPUå’Œå†…å­˜ä¸Šçš„æ¶ˆè€—ï¼Œéƒ½è¦ä¼˜äºLogstashã€‚æ‰€ä»¥æœ€åæˆ‘ä»¬é€‰æ‹©äº†FluentdFlink &amp; Spark StreamingFlinkï¼ŒSpark Streamingè¿™ä¸¤ä¸ªå®æ—¶è®¡ç®—æ¡†æ¶å°±ä¸å¤šä»‹ç»äº†ï¼Œå®¶å–»æˆ·æ™“ã€‚åœ¨è¿™é‡Œè¯´ä¸€ä¸‹ï¼Œåœ¨å®æ—¶è®¡ç®—çš„è¿™ä¸€å±‚é¢ï¼Œå›¢é˜Ÿä¸ºä»€ä¹ˆé€‰æ‹©äº†ä¸¤ä¸ªè®¡ç®—æ¡†æ¶ã€‚ä¸»è¦æ˜¯å› ä¸ºå¯¹å¾…ä¸åŒçš„éœ€æ±‚ï¼Œä½¿ç”¨æ›´é€‚åˆçš„å·¥å…·ï¼Œå›¢é˜Ÿæˆå‘˜å¯¹Spark Streamingæ›´åŠ ç†Ÿæ‚‰ï¼Œåœ¨å¯¹å®æ—¶æ€§è¦æ±‚æ›´é«˜çš„é¡¹ç›®ä¸­ï¼Œä¾‹å¦‚æ¸¸æˆç›‘æ§ç³»ç»Ÿï¼Œå¯¹äºæ•°æ®çŠ¶æ€ç®¡ç†ï¼Œwatermarkçš„éœ€æ±‚éƒ½æ˜¯æœ‰è¦æ±‚çš„ï¼Œåœ¨è¿™æ–¹é¢ï¼ŒFlinkçš„å®ç°å°±æ˜¯è¦æ¯”Spark Streamingå¥½ã€‚æ•°æ®å­˜å‚¨å±‚æ•°æ®å­˜å‚¨å±‚åˆ†ä¸ºç¦»çº¿å’Œå®æ—¶HiveHiveæ˜¯Hadoopçš„ä¸€ä¸ªæ•°æ®ä»“åº“å·¥å…·ï¼Œåº•å±‚å­˜å‚¨ä¸ºHDFSï¼Œå¯ä»¥å°†æˆ‘ä»¬æŒ‰ç…§ä¸»é¢˜è®¾è®¡å¥½çš„ç»“æ„åŒ–æ•°æ®æ˜ å°„æˆè¡¨ï¼Œæä¾›SQLæ¥å£æ¥åˆ†ææ•°æ®ã€‚ä»å­˜å‚¨å±‚åˆ°å…±äº«å±‚ä¸­ï¼Œå¤§éƒ¨åˆ†çš„è®¡ç®—ä»»åŠ¡ï¼Œéƒ½æ˜¯åœ¨Hiveè¡¨ä¸­ï¼Œä½¿ç”¨Sparkä½œä¸ºè®¡ç®—æ¡†æ¶ï¼ŒETLå°†æ•°æ®æ¸…æ´—åˆ°HBase,MySQLç­‰ç»“æœåº“ä¸­ã€‚HBase&amp;Elasticsearch&amp;GrafanaHBaseHBaseçš„ç”¨é€”åŸºæœ¬ä¸Šæ˜¯å­˜å‚¨æµå¼ETLåçš„ç»“æœæ•°æ®ï¼Œæˆ–è€…æ˜¯ç›´æ¥å­˜å…¥åŸå§‹æ•°æ®ä½œä¸ºå¤‡ä»½ElasticsearchESçš„ç”¨é€”åŸºæœ¬ä¸Šæ˜¯æ­é…Fluentdå’ŒKibanaï¼Œç»„æˆEFKï¼Œåšæ•°æ®å±•ç¤ºï¼Œå¤šæ•°æƒ…å†µä¸‹ä¼šå­˜å‚¨æ—¥å¿—æ•°æ®ï¼Œåšè¯¦æƒ…çš„æ£€ç´¢ã€‚è¿˜æœ‰ä¸€ä¸ªå¸¸ç”¨çš„åŠŸèƒ½å°±æ˜¯ç»“åˆHBaseåšäºŒçº§ç´¢å¼•ï¼Œä¼šåœ¨ESç´¢å¼•é‡Œé¢å­˜å‚¨ä¸€ä¸ªhbaseçš„å…³é”®å­—rowkeyï¼Œæ ¹æ®æŸ¥è¯¢æ¡ä»¶å®šä½åˆ°æŸä¸ªrowkeyï¼Œç›´æ¥å»hbaseé‡Œé¢getæ•°æ®ï¼Œç§’çº§è¿”å›GrafanaGrafanaæ˜¯å›¢é˜ŸåæœŸå¼•å…¥çš„ï¼Œä¸»è¦æ˜¯è¢«Grafanaçš„UIæ‰€å¸å¼•ï¼ŒGrafanaå’ŒKibanaå¯¹æ¯”èµ·æ¥ï¼ŒUIå±•ç¤ºè¦å¼ºå¤§çš„å¾ˆå¤šï¼Œå¯¹äºGrafanaï¼Œæˆ‘ä»¬æ­£åœ¨è°ƒç ”ï¼Œä½¿ç”¨Grafanaæ¥åšæ•°æ®è´¨é‡çš„ç›‘æ§ï¼Œç­‰ä½¿ç”¨æˆç†Ÿäº†ï¼Œä¹Ÿä¼šåˆ†äº«å‡ºæ¥ã€‚æ•°æ®å…±äº«å±‚å…±äº«å±‚çš„æ•°æ®ï¼Œéƒ½æ˜¯ç»è¿‡ETLæ¸…æ´—çš„ï¼Œéƒ½æ˜¯å³æ‹¿å³ç”¨çš„ã€‚ä¸šåŠ¡ç³»ç»Ÿ ï¼Œå¯¹æ¥æ•°æ®ä»“åº“çš„ï¼Œéƒ½æ˜¯é€šè¿‡GoApiç»“æ„è¿›è¡Œè°ƒå–çš„ã€‚æŠ¥è¡¨æ•°æ® ï¼Œå·¥ç¨‹å¸ˆä¼šé€šè¿‡Sparkå†™æˆCSVæ–‡ä»¶ï¼Œæä¾›ç»™è¿è¥äººå‘˜å³å¸­æŸ¥è¯¢ ï¼Œæˆ‘ä»¬è¿˜å¼€æ”¾äº†Prestoæ¥å£ï¼ˆprestoçš„æŸ¥è¯¢é€Ÿåº¦æ¯”hiveå¿«5-10å€ï¼‰ï¼ŒåŒæ—¶å¯¹æ•°æ®ä»“åº“åšäº†ä»…æŸ¥æƒé™æ§åˆ¶ï¼Œå¸Œæœ›ä¸šåŠ¡åˆ†æäººå‘˜å¯ä»¥è‡ªä¸»çš„é€šè¿‡prestoè¿›è¡Œæ•°æ®è°ƒå–ï¼Œä½†æ˜¯ç†æƒ³æ˜¯ä¸°æ»¡çš„ï¼Œç°å®æ˜¯éª¨æ„Ÿçš„ã€‚æ ¹æœ¬æ²¡äººç”¨ å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆæ•°æ®åº”ç”¨å±‚ç•¥æ•°æ®ç”¨æˆ·å±‚ç•¥","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"æ•°æ®ä»“åº“","slug":"æ•°æ®ä»“åº“","permalink":"cpeixin.cn/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"}]},{"title":"æ•°æ®ä»“åº“ - å®é™…ä½œç”¨ä¸éœ€æ±‚","slug":"æ•°æ®ä»“åº“å®é™…ä½œç”¨ä¸éœ€æ±‚","date":"2018-08-20T15:26:15.000Z","updated":"2020-08-02T13:24:15.066Z","comments":true,"path":"2018/08/20/æ•°æ®ä»“åº“å®é™…ä½œç”¨ä¸éœ€æ±‚/","link":"","permalink":"cpeixin.cn/2018/08/20/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%AE%9E%E9%99%85%E4%BD%9C%E7%94%A8%E4%B8%8E%E9%9C%80%E6%B1%82/","excerpt":"","text":"æ•°æ®ä»“åº“çš„äº§ç”ŸèƒŒæ™¯æ•°æ®ä»“åº“çš„èµ·æºå¯ä»¥è¿½æº¯åˆ°è®¡ç®—æœºçš„å‘å±•åˆæœŸï¼Œå¹¶ä¸”æ•°æ®ä»“åº“æ˜¯ä¿¡æ¯æŠ€æœ¯é•¿æœŸå‘å±•çš„äº§ç‰©ï¼Œåœ¨ä»¥åä¹Ÿä¼šä¸€ç›´å‘å±•ã€‚ä»å·¥ç¨‹è§’åº¦æ¥è®²ï¼Œåœ¨è®¡ç®—æœºé¢†åŸŸå‡ºç°äº†å¤§å‹åœ¨çº¿äº‹åŠ¡å¤„ç†ç³»ç»Ÿåï¼Œå¯¹äºæ•°æ®ä¹‹é—´çš„äº¤äº’å’Œä½¿ç”¨å°±é€æ¸çš„å¤šäº†èµ·æ¥ã€‚éšåå‡ºç°çš„æŠ½å–ç¨‹åºï¼Œå¯ä»¥é€šè¿‡è®¾ç½®å‚æ•°ï¼Œåœ¨æ–‡ä»¶ä¸­æœç´¢æ»¡è¶³æ¡ä»¶çš„æ•°æ®ï¼Œç„¶åæŠŠè¿™äº›æ•°æ®ä¼ é€åˆ°å…¶ä»–æ–‡ä»¶æˆ–è€…æ•°æ®åº“ä¸­ã€‚æ…¢æ…¢çš„äººä»¬å‘ç°åœ¨æŠ½å–ç»“æœä¸­ï¼ŒåŠ ä¸Šä¸€äº›æ¡ä»¶é™åˆ¶å¯ä»¥æ›´æ–¹ä¾¿çš„å¾—åˆ°æƒ³è¦çš„æ•°æ®ï¼Œäºæ˜¯å°±å‡ºç°äº†åŸºäºæŠ½å–ä¹‹ä¸Šçš„æŠ½å–ã€‚è¿™æ ·å°±é€ æˆäº†å¦‚ä¸‹é—®é¢˜ï¼šæ— ä¼‘æ­¢çš„æŠ½å–å¸¦æ¥è¯¸å¤šé—®é¢˜ï¼ŒæŠ½å–ç¨‹åºè¿‡å¤šï¼ŒåŠŸèƒ½å•ä¸€ï¼Œä¸å¯å¤ç”¨ï¼Œæ— å…¬å…±ä½¿ç”¨æ•°æ®æºï¼Œæ•°æ®ä¹‹é—´ä¼šäº§ç”Ÿå·®å¼‚ç­‰ï¼Œæ‰€ä»¥å¼€å§‹æ€è€ƒæ˜¯å¦å¯ä»¥å»ºç«‹æˆä½“ç³»çš„æœºæ„åŒ–ç¯å¢ƒï¼Œä»¥å‡å°‘æ•°æ®çš„å·®å¼‚ã€‚è¿™ä¹Ÿå°±æ˜¯æ•°æ®ä»“åº“å‡ºç°çš„åŸå› ã€‚æ•°æ®ä»“åº“ä»æ“ä½œå‹æ•°æ®åº“ä¸­æŠ½å–æ•°æ®ï¼Œé€šè¿‡è§„èŒƒçš„åŠ å·¥è¿‡ç¨‹ï¼Œå¾—åˆ°ç²’åº¦åŒ–æ•°æ®ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®æ—¶é¢å‘ä¸»é¢˜ã€é›†æˆã€ä¸æ˜“å¤±ã€éšæ—¶é—´å˜åŒ–çš„ä»å•†ä¸šè§’åº¦æ¥è®²ï¼Œåœ¨ä¸€æ¬¡å¤§ä¼šä¸Šï¼Œé©¬äº‘çˆ¸çˆ¸è°ˆåˆ°å½“ä»Šæ—¶ä»£ï¼Œæ˜¯ITæ—¶ä»£åˆ°DTæ—¶ä»£çš„å˜é©ã€‚æ•°æ®èµ„æºæ˜¯æ¯”çŸ³æ²¹è¿˜è¦é‡è¦çš„èµ„æºï¼Œæ•°æ®å°±æ˜¯ç”Ÿäº§èµ„æ–™ã€‚éšç€ä¼ä¸šå¤šå¹´çš„ç»è¥ï¼Œä¸šåŠ¡æ•°æ®é‡çš„ä¸æ–­å¢å¤§ï¼Œå¦‚ä½•èƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨æ•°æ®ï¼Œå°†æ•°æ®è½¬åŒ–æˆå•†ä¸šä»·å€¼ï¼Œå·²ç»æˆä¸ºäººä»¬è¶Šæ¥è¶Šå…³å¿ƒçš„é—®é¢˜ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæ•°æ®åº“ç³»ç»Ÿå¯ä»¥å¾ˆå¥½åœ°è§£å†³äº‹åŠ¡å¤„ç†ï¼Œå®ç°å¯¹æ•°æ®çš„â€œå¢åˆ æ”¹æŸ¥â€ç­‰åŠŸèƒ½ï¼Œä½†æ˜¯å´ä¸èƒ½æä¾›å¾ˆå¥½çš„å†³ç­–åˆ†ææ”¯æŒã€‚å› ä¸ºäº‹åŠ¡å¤„ç†é¦–å…ˆè€ƒè™‘å“åº”çš„åŠæ—¶æ€§ï¼Œå¤šæ•°æƒ…å†µéƒ½æ˜¯åœ¨å¤„ç†å½“å‰æ•°æ®ï¼Œè€Œå†³ç­–åˆ†æéœ€è¦è€ƒè™‘çš„æ˜¯æ•°æ®çš„é›†æˆæ€§å’Œå†å²æ€§ï¼Œå¯èƒ½å¯¹åˆ†æå¤„ç†çš„æ—¶æ•ˆæ€§è¦æ±‚ä¸é«˜ã€‚æ‰€ä»¥ä¸ºäº†æé«˜å†³ç­–åˆ†æçš„æœ‰æ•ˆæ€§å’Œå®Œæ•´æ€§ï¼Œäººä»¬é€æ¸å°†ä¸€éƒ¨åˆ†æˆ–è€…å¤§éƒ¨åˆ†æ•°æ®ä»è”æœºäº‹ç‰©å¤„ç†ç³»ç»Ÿä¸­å‰¥ç¦»å‡ºæ¥ï¼Œå½¢æˆä»Šå¤©çš„æ•°æ®ä»“åº“ã€‚æ•°æ®å›¢é˜Ÿçœ¼ä¸­çš„æ•°æ®ä»“åº“ä»å®ä¹ å·¥ä½œï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘å‚ä¸äº†ä¸¤æ¬¡æ•°ä»“çš„å»ºè®¾ï¼Œå®ä¹ å…¬å¸å½“æ—¶å¤§æ•°æ®å›¢é˜Ÿåˆšåˆšæˆç«‹ï¼Œé‚£æ—¶å¹¶æ²¡æœ‰å»ºç«‹æ•°ä»“ï¼Œè€Œæ˜¯ä¾æ®å½“æ—¶çš„å„ä¸ªé¡¹ç›®éœ€æ±‚ï¼Œç›´æ¥å»ºç«‹æ•°æ®é›†å¸‚ï¼Œå°†æ¯ä¸ªå®¡è®¡å±€çš„ä¸šåŠ¡éœ€æ±‚ï¼Œåˆ†åˆ«å»ºç«‹ä¸åŒçš„ä¸šåŠ¡è¡¨ï¼Œæ•°æ®æ¥æºæœ‰æ¥è‡ªExcelæ–‡ä»¶çš„ï¼Œä¹Ÿæœ‰æ¥è‡ªOracleæ•°æ®åº“çš„ã€‚å†ä¸€ä¸ªå°±æ˜¯å½“å‰å…¬å¸ï¼Œè¿™æ¬¡çš„æ•°ä»“å»ºè®¾ï¼Œæ˜¯æˆ‘å®Œæ•´çš„ä¸€æ¬¡å‚ä¸æ•´ä½“æµç¨‹ï¼Œå»ºç«‹æ•°ä»“çš„ç›®çš„å°±æ˜¯æ¥åº”å¯¹å„ä¸ªäº§å“æ‰€ä¼šæå‡ºçš„å„ç§æ•°æ®éœ€æ±‚å’Œç»Ÿä¸€å„ä¸ªäº§å“çš„æ•°æ®æ ‡å‡†ï¼Œç°åœ¨çš„äº§å“æ–¹ï¼Œç¡®å®å…·æœ‰ä¸€å®šçš„æ•°æ®å¤´è„‘ï¼Œä¸å†åƒä»¥å‰åªè¿½æ±‚ç›ˆåˆ©ï¼Œä¸å»æ€è€ƒæ•°æ®èƒŒåçš„ä»·å€¼å’Œæ•°æ®æŒ‡æ ‡å¯¹ç»è¥å¸¦æ¥çš„å½±å“ã€‚æˆ‘æ‰€åœ¨çš„å¤§æ•°æ®å›¢é˜Ÿè´Ÿè´£å…¬å¸å±‚é¢å’Œä¸‹é¢8ä¸ªäº§å“çº¿çš„æ•°æ®é©±åŠ¨æœåŠ¡ï¼Œå…¬å¸å±‚é¢ç»å¸¸ä¼šè°ƒå–ç›ˆåˆ©ç›¸å…³æŒ‡æ ‡ï¼Œäº§å“æ–¹çš„éœ€æ±‚åˆ™æ˜¯å„ç§å„æ ·ï¼Œæ—¶é—´é•¿åº¦ä¹Ÿæ˜¯ä»å¹´åˆ°å¤©éƒ½æœ‰ã€‚å¯¹äºå…¬å¸å’Œäº§å“æ–¹ï¼Œä»–ä»¬å¹¶ä¸å…³å¿ƒæ•°æ®çš„æ¥æºå’Œæ•°ä»“çš„é‡è¦æ€§ï¼Œå› ä¸ºä»–ä»¬æ˜¯ä½¿ç”¨æ•°æ®ç»“æœçš„äººï¼Œä½†æ˜¯å¯¹äºå¤§æ•°æ®å›¢é˜Ÿï¼Œå»ºç«‹æ•°æ®ä»“åº“æ˜¯ä¸€ä¸ªå¿…è¦çš„äº‹æƒ…ï¼Œæ•°æ®ä»“åº“å¯¹ä¼ä¸šçš„ä»·å€¼æ•°æ®ä»“åº“å¯¹ä¼ä¸šå¸¦æ¥çš„ä»·å€¼æ˜¯å¾ˆéš¾ä¼°ç®—çš„ï¼Œä½†æ˜¯æ•°æ®ä»“åº“çš„æˆæœ¬å€’æ˜¯å¯ä»¥ä¼°ç®—å‡ºå¤§æ¦‚çš„ã€‚å°±æˆ‘ä»¬å…¬å¸è€Œè¨€ï¼Œæ•°æ®ä»“åº“æ•°æ®ä¸»é¢˜åˆ†æˆä¸¤ä¸ªå¤§ç±»æ¥è¯´ï¼Œå°±æ˜¯ç”¨æˆ·æ•°æ®ä¸ä¸šåŠ¡æ•°æ®ï¼Œé‚£ä¹ˆäº§å“æ–¹æœ€æƒ³çœ‹åˆ°çš„å°±æ˜¯ç”¨æˆ·æ•°æ®ä¸ä¸šåŠ¡æ•°æ®è”åˆèµ·æ¥ï¼Œè¿™å°±æ˜¯æ•°æ®ä»“åº“å¯¹å…¬å¸äº§å“è¿è¥æ–¹å¸¦æ¥çš„ä»·å€¼ã€‚æ•°æ®ä»“åº“å…·æœ‰å†å²æ€§ï¼Œå…¶ä¸­å­˜å‚¨çš„æ•°æ®å¤§å¤šæ˜¯ç»“æ„åŒ–æ•°æ®ï¼Œè¿™äº›æ•°æ®å¹¶éä¼ä¸šå…¨é‡æ•°æ®ï¼Œè€Œæ˜¯æ ¹æ®éœ€æ±‚é’ˆå¯¹æ€§æŠ½å–çš„ï¼Œå› æ­¤æ•°æ®ä»“åº“å¯¹äºä¸šåŠ¡çš„ä»·å€¼æ˜¯å„ç§å„æ ·çš„æŠ¥è¡¨ï¼Œä½†è¿™äº›æŠ¥è¡¨åˆæ— æ³•å®æ—¶äº§ç”Ÿã€‚æ•°æ®ä»“åº“æŠ¥è¡¨è™½ç„¶èƒ½å¤Ÿæä¾›éƒ¨åˆ†ä¸šåŠ¡ä»·å€¼ï¼Œä½†ä¸èƒ½ç›´æ¥å½±å“ä¸šåŠ¡ï¼Œéœ€è¦æ•°æ®å¼€å‘äººå‘˜å¯¹æ•°æ®ä»“åº“ä¸­çš„æ•°æ®è¿›è¡ŒETLå¼€å‘ï¼Œç»™å‡ºæŒ‡å¯¼æ€§çš„æ•°æ®åˆ†æç»“æœã€‚æ•°æ®ä»“åº“ä¸­æ•°æ®ä¸æ•°æ®åº“ä¸­æ•°æ®çš„ä¸åŒè¿™é‡Œå‘¢ï¼Œç®€å•çš„è¯´ï¼Œåº”è¯¥å°±æ˜¯OLTPå’ŒOLAPçš„åŒºåˆ«æ•°æ®ä»“åº“éœ€æ±‚åˆ†æé˜¶æ®µæ•°æ®ä»“åº“çš„éœ€æ±‚åˆ†æï¼Œåœ¨å¾ˆå¤šå…¬å¸ä¸­ï¼Œéƒ½æ˜¯ç”±æ•°æ®å›¢é˜Ÿæˆ–è€…æ•°æ®ä»“åº“å·¥ç¨‹å¸ˆå‡ ä¸ªæŠ€æœ¯äººå‘˜åå®šä¸‹æ¥çš„ã€‚ä½†æ˜¯ä¸€ä¸ªåˆæ ¼çš„æ•°æ®ä»“åº“ï¼Œåº”è¯¥æ˜¯ç”±ä¸šåŠ¡æ–¹ï¼Œäº§å“æ–¹ï¼Œè¿è¥æ–¹ï¼Œæ•°æ®å›¢é˜ŸæŠ€æœ¯æ–¹ä¸€åŒæ¥å•†å®šçš„ã€‚ä¸€ä¸ªå®Œæ•´çš„æµç¨‹åº”è¯¥æ˜¯å»äº†è§£æ•°æ®çš„èƒŒæ™¯ï¼Œç»†èŠ‚ï¼Œå»äº†è§£ç”¨æˆ·éœ€è¦ç”¨åˆ°å“ªäº›ä¸»é¢˜çš„æ•°æ®å’Œæ•°æ®ç²’åº¦çš„å¤§å°ï¼Œå»äº†è§£ä¸»é¢˜æ•°æ®ä¸­æ•°æ®çš„ç»´åº¦ï¼Œæœ€åæ‰æ˜¯æ•°æ®ä»“åº“è®¾è®¡äººå‘˜å¼€å§‹æ‹¿å‡ºæ•°æ®ä»“åº“çš„æ¶æ„æ–¹æ¡ˆå’ŒETLæ–¹æ¡ˆã€‚æ•°æ®ä»“åº“ä½œç”¨æ•´åˆå…¬å¸æ‰€æœ‰ä¸šåŠ¡æ•°æ®ï¼Œå»ºç«‹ç»Ÿä¸€çš„æ•°æ®ä¸­å¿ƒäº§ç”Ÿä¸šåŠ¡æŠ¥è¡¨ï¼Œç”¨äºä½œå‡ºå†³ç­–ä¸ºç½‘ç«™è¿è¥æä¾›è¿è¥ä¸Šçš„æ•°æ®æ”¯æŒå¯ä»¥ä½œä¸ºå„ä¸ªä¸šåŠ¡çš„æ•°æ®æºï¼Œå½¢æˆä¸šåŠ¡æ•°æ®äº’ç›¸åé¦ˆçš„è‰¯æ€§å¾ªç¯åˆ†æç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œé€šè¿‡æ•°æ®æŒ–æ˜æ¥é™ä½æŠ•å…¥æˆæœ¬ï¼Œæé«˜æŠ•å…¥æ•ˆæœå¼€å‘æ•°æ®äº§å“ï¼Œç›´æ¥æˆ–é—´æ¥åœ°ä¸ºå…¬å¸ç›ˆåˆ©","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"æ•°æ®ä»“åº“","slug":"æ•°æ®ä»“åº“","permalink":"cpeixin.cn/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"}]},{"title":"æ•°æ®ä»“åº“ - ç®€è¿°","slug":"æ•°æ®ä»“åº“ç®€è¿°","date":"2018-08-19T15:26:15.000Z","updated":"2020-08-02T13:24:52.139Z","comments":true,"path":"2018/08/19/æ•°æ®ä»“åº“ç®€è¿°/","link":"","permalink":"cpeixin.cn/2018/08/19/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E7%AE%80%E8%BF%B0/","excerpt":"","text":"å‰è¨€è¯´åˆ°æ•°æ®ä»“åº“ï¼Œåœ¨ä¸€å¹´å‰ï¼Œæˆ‘çš„ç­”æ¡ˆæ˜¯éå¸¸æ¨¡ç³Šçš„ï¼Œåœ¨ä¸¤å¹´å‰ï¼Œæˆ‘æ ¹æœ¬ä¸çŸ¥é“æ•°æ®ä»“åº“çš„å­˜åœ¨ã€‚ç›¸ä¿¡å¤§å¤šæ•°çš„äººéƒ½æ˜¯ç»å¸¸æ¥è§¦æ•°æ®åº“ï¼Œä¸Šå¤§å­¦çš„æ—¶å€™å­¦è¿‡Oracleï¼ŒMySQLè¿™ä¸¤ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼Œæ“ä½œç€å„ç§å¢åˆ æ”¹æŸ¥ï¼Œç°åœ¨äººä»¬å¯¹è¿™ç§ç±»å‹çš„æ•°æ®åº“éƒ½ç§°ä½œä¼ ç»Ÿæ•°æ®åº“ï¼Œæ•°æ®é‡åå°ï¼Œæ¯ä¸€å¼ è¡¨éƒ½æ˜¯ä¸ºäº†æŸä¸€ç³»ç»ŸåŠŸèƒ½è€Œè®¾è®¡çš„ã€‚åœ¨ä¹‹åä»äº‹å¤§æ•°æ®è¡Œä¸šäº†ï¼Œæ•°æ®ä»“åº“è¿™å‡ ä¸ªå­—ä¹Ÿå°±æ€»å‡ºç°åœ¨å„ç§åšå®¢ä¸­ï¼Œå„ç§æŠ€æœ¯æ–¹æ¡ˆä¸­ã€‚ç°åœ¨æ­£åœ¨å’ŒåŒäº‹ä¸»å¯¼å…¬å¸æ•°æ®ä»“åº“çš„è®¾è®¡å’Œæ­å»ºå·¥ä½œï¼Œæ‰€ä»¥å‡†å¤‡æŠŠæˆ‘è¿™æ®µå·¥ç¨‹ç»éªŒï¼Œæ‹¿å‡ºæ¥åˆ†äº«ä¸€ä¸‹ã€‚æ•°æ®åº“ä¸æ•°æ®ä»“åº“çš„åŒºåˆ«æ•°æ®åº“è¿™é‡Œæˆ‘ä»¬æ‰€æŒ‡çš„æ•°æ®åº“ï¼Œä¹Ÿå°±æ˜¯ä¸€ç³»åˆ—ç»å…¸çš„RDBMSï¼Œå¦‚Oracleï¼ŒMySQLï¼ŒSQL Serverç­‰å…³ç³»å‹æ•°æ®åº“ã€‚å…¶ä¸­çš„ä¸€äº›è®¾è®¡è¿‡ç¨‹å¦‚ ERå›¾çš„è®¾è®¡ï¼Œé€»è¾‘æ¨¡å‹çš„è®¾è®¡ï¼Œç‰©ç†æ¨¡å‹è®¾è®¡ï¼Œè¿˜æœ‰è§„èŒƒåŒ–è®¾è®¡ å¦‚ è‡³å°‘è¦ç¬¦åˆç¬¬ä¸€èŒƒå¼ï¼Œå°½å¯é‡çš„å»ç¬¦åˆç¬¬äºŒèŒƒå¼ï¼Œç¬¬ä¸‰èŒƒå¼ç­‰è®¾è®¡ç»†èŠ‚ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œä½†æ˜¯ä»¥ä¸Šæ‰€æåˆ°çš„éƒ½æ˜¯å…³ç³»å‹æ•°æ®åº“çš„ç²¾åã€‚å…³ç³»å‹æ•°æ®åº“çš„ç”¨é€”ï¼Œç°åœ¨ä¹Ÿä¼šè¢«åˆ†æˆä¸¤å¤§ç±»ï¼ˆ1ï¼‰æ“ä½œå‹æ•°æ®åº“ï¼Œä¸»è¦ç”¨äºä¸šåŠ¡æ”¯æ’‘ã€‚ä¸€ä¸ªå…¬å¸å¾€å¾€ä¼šä½¿ç”¨å¹¶ç»´æŠ¤è‹¥å¹²ä¸ªæ•°æ®åº“ï¼Œè¿™äº›æ•°æ®åº“ä¿å­˜ç€å…¬å¸çš„æ—¥å¸¸æ“ä½œæ•°æ®ï¼Œæ¯”å¦‚å•†å“è´­ä¹°ã€é…’åº—é¢„è®¢ã€å­¦ç”Ÿæˆç»©å½•å…¥ç­‰ï¼›ï¼ˆ2ï¼‰åˆ†æå‹æ•°æ®åº“ï¼Œä¸»è¦ç”¨äºå†å²æ•°æ®åˆ†æã€‚è¿™ç±»æ•°æ®åº“ä½œä¸ºå…¬å¸çš„å•ç‹¬æ•°æ®å­˜å‚¨ï¼Œè´Ÿè´£åˆ©ç”¨å†å²æ•°æ®å¯¹å…¬å¸å„ä¸»é¢˜åŸŸè¿›è¡Œç»Ÿè®¡åˆ†æï¼›æ•°æ®ä»“åº“æ¥ä¸‹æ¥å…ˆç»™å¤§å®¶çœ‹ç™¾åº¦ç™¾ç§‘ç»™å‡ºçš„æ•°æ®ä»“åº“æ¦‚å¿µæ•°æ®ä»“åº“ï¼Œè‹±æ–‡åç§°ä¸ºData Warehouseï¼Œå¯ç®€å†™ä¸ºDWæˆ–DWHã€‚æ•°æ®ä»“åº“ï¼Œæ˜¯ä¸ºä¼ä¸šæ‰€æœ‰çº§åˆ«çš„å†³ç­–åˆ¶å®šè¿‡ç¨‹ï¼Œæä¾›æ‰€æœ‰ç±»å‹æ•°æ®æ”¯æŒçš„æˆ˜ç•¥é›†åˆã€‚å®ƒæ˜¯å•ä¸ªæ•°æ®å­˜å‚¨ï¼Œå‡ºäºåˆ†ææ€§æŠ¥å‘Šå’Œå†³ç­–æ”¯æŒç›®çš„è€Œåˆ›å»ºã€‚ ä¸ºéœ€è¦ä¸šåŠ¡æ™ºèƒ½çš„ä¼ä¸šï¼Œæä¾›æŒ‡å¯¼ä¸šåŠ¡æµç¨‹æ”¹è¿›ã€ç›‘è§†æ—¶é—´ã€æˆæœ¬ã€è´¨é‡ä»¥åŠæ§åˆ¶ã€‚ä»ä¸Šé¢çš„å®šä¹‰æ¥çœ‹ï¼Œæ•°æ®ä»“åº“çš„ä¸»è¦åŠŸèƒ½æ˜¯ç”¨äºåšä¼ä¸šå„ä¸ªä¸šåŠ¡å±‚é¢çš„åˆ†æï¼Œä¼ä¸šå±‚é¢çš„æ•°æ®æ€»é›†ï¼Œæ›¾ç»çœ‹è¿‡ä¸€ä¸ªåšä¸»å¯¹æ•°æ®ä»“åº“çš„å®šä¹‰æ˜¯â€œé¢å‘åˆ†æçš„å­˜å‚¨ç³»ç»Ÿâ€ï¼Œè¿™ä¸ªå®šä¹‰æ˜¯å¾ˆæ¥åœ°æ°”çš„ï¼Œå¦‚æœæŒ‰ç…§è¿™ä¸ªæ€è·¯å¾€ä¸‹å»æ€è€ƒï¼Œæ•°æ®ä»“åº“å­˜å‚¨çš„æ•°æ®æ˜¯å¾ˆåºå¤§çš„ï¼Œä¸æ˜¯ä¸€ä¸ªå•ä¸€çš„ä¸šåŠ¡æ•°æ®é›†ï¼Œä¸ç”¨ç²¾å‡†åˆ°æ¯ä¸€æ¡æ•°æ®ï¼Œä¾‹å¦‚ï¼Œæ·˜å®åœ¨å­˜å‚¨æ¯ä¸€æ¡ä¸‹å•è®°å½•çš„æ—¶å€™ï¼Œåœ¨å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œè¿™æ¡è®°å½•æ˜¯ä¸ä¼šå­˜å‚¨åˆ°å…¶ä»–ä¸šåŠ¡è¡¨é‡Œé¢ï¼Œåªä¼šå­˜å‚¨åœ¨ä¸‹å•è®°å½•è¡¨é‡Œé¢ï¼Œå¹¶ä¸”ä¸‹å•è®°å½•è¡¨é‡Œé¢ä¸ä¼šå­˜å‚¨ä¸¤æ¡ç›¸åŒçš„è®¢å•æ•°æ®ï¼Œè¿™æ˜¯å› ä¸ºå…³ç³»å‹æ•°æ®åº“è¦ä¸¥æ ¼æ»¡è¶³å®Œæ•´æ€§/å‚ç…§æ€§çº¦æŸä»¥åŠèŒƒå¼è®¾è®¡è¦æ±‚ï¼Œä½†æ˜¯åœ¨æ•°æ®ä»“åº“ä¸­ï¼Œè¿™æ¡è®¢å•æ•°æ®å¯èƒ½ä¼šå­˜åœ¨ç”¨æˆ·è¡Œä¸ºè¡¨ä¸­ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨ä¸‹å•æ•°æ®è¡¨ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®ä»“åº“ä¸åº”è®©ä¼ ç»Ÿå…³ç³»æ•°æ®åº“æ¥å®ç°ï¼Œå› ä¸ºå…³ç³»æ•°æ®åº“æœ€å°‘ä¹Ÿè¦æ±‚æ»¡è¶³ç¬¬1èŒƒå¼ï¼Œè€Œæ•°æ®ä»“åº“é‡Œçš„å…³ç³»è¡¨å¯ä»¥ä¸æ»¡è¶³ç¬¬1èŒƒå¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒæ ·çš„è®°å½•åœ¨ä¸€ä¸ªå…³ç³»è¡¨é‡Œå¯ä»¥å‡ºç°Næ¬¡ã€‚ä½†ç”±äºå¤§å¤šæ•°æ•°æ®ä»“åº“å†…çš„è¡¨çš„ç»Ÿè®¡åˆ†æè¿˜æ˜¯ç”¨SQLï¼Œå› æ­¤å¾ˆå¤šäººæŠŠå®ƒå’Œå…³ç³»æ•°æ®åº“ææ··äº†ã€‚æ•°æ®ä»“åº“çš„ç‰¹ç‚¹é¢å‘ä¸»é¢˜é¢å‘ä¸»é¢˜ç‰¹æ€§æ˜¯æ•°æ®ä»“åº“å’Œæ“ä½œå‹æ•°æ®åº“çš„æ ¹æœ¬åŒºåˆ«ã€‚æ“ä½œå‹æ•°æ®åº“æ˜¯ä¸ºäº†æ”¯æ’‘å„ç§ä¸šåŠ¡è€Œå»ºç«‹ï¼Œè€Œåˆ†æå‹æ•°æ®åº“åˆ™æ˜¯ä¸ºäº†å¯¹ä»å„ç§ç¹æ‚ä¸šåŠ¡ä¸­æŠ½è±¡å‡ºæ¥çš„åˆ†æä¸»é¢˜(å¦‚ç”¨æˆ·ã€æˆæœ¬ã€å•†å“ç­‰)è¿›è¡Œåˆ†æè€Œå»ºç«‹ï¼›é›†æˆæ€§é›†æˆæ€§æ˜¯æŒ‡æ•°æ®ä»“åº“ä¼šå°†ä¸åŒæºæ•°æ®åº“ä¸­çš„æ•°æ®æ±‡æ€»åˆ°ä¸€èµ·ï¼›ä¼ä¸šèŒƒå›´æ•°æ®ä»“åº“å†…çš„æ•°æ®æ˜¯é¢å‘å…¬å¸å…¨å±€çš„ã€‚æ¯”å¦‚æŸä¸ªä¸»é¢˜åŸŸä¸ºæˆæœ¬ï¼Œåˆ™å…¨å…¬å¸å’Œæˆæœ¬æœ‰å…³çš„ä¿¡æ¯éƒ½ä¼šè¢«æ±‡é›†è¿›æ¥ï¼›å†å²æ€§è¾ƒä¹‹æ“ä½œå‹æ•°æ®åº“ï¼Œæ•°æ®ä»“åº“çš„æ—¶é—´è·¨åº¦é€šå¸¸æ¯”è¾ƒé•¿ã€‚å‰è€…é€šå¸¸ä¿å­˜å‡ ä¸ªæœˆï¼Œåè€…å¯èƒ½å‡ å¹´ç”šè‡³å‡ åå¹´ï¼›æ—¶å˜æ€§æ—¶å˜æ€§æ˜¯æŒ‡æ•°æ®ä»“åº“åŒ…å«æ¥è‡ªå…¶æ—¶é—´èŒƒå›´ä¸åŒæ—¶é—´æ®µçš„æ•°æ®å¿«ç…§ã€‚æœ‰äº†è¿™äº›æ•°æ®å¿«ç…§ä»¥åï¼Œç”¨æˆ·ä¾¿å¯å°†å…¶æ±‡æ€»ï¼Œç”Ÿæˆå„å†å²é˜¶æ®µçš„æ•°æ®åˆ†ææŠ¥å‘Šï¼›æ•°æ®ä»“åº“ç»„ä»¶æ•°æ®ä»“åº“çš„æ ¸å¿ƒç»„ä»¶æœ‰å››ä¸ªï¼šå„æºæ•°æ®åº“ï¼ŒETLï¼Œæ•°æ®ä»“åº“ï¼Œå‰ç«¯åº”ç”¨ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šä¸šåŠ¡ç³»ç»Ÿä¸šåŠ¡ç³»ç»ŸåŒ…å«å„ç§æºæ•°æ®åº“æˆ–è€…ç½‘ç«™å‰ç«¯åŸ‹ç‚¹å®æ—¶æ•°æ®ï¼Œæ•°æ®æºå¯ä»¥æ˜¯ç¦»çº¿çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å®æ—¶çš„ï¼ˆæ—¶é—´ç²’åº¦ä¸ºå°æ—¶ï¼‰ã€‚æ¯”å¦‚æˆ‘ä»¬æ•°æ®ä»“åº“ä¸­çš„ç¦»çº¿æ•°æ®æ¥æºæ˜¯å…¬å¸ä¸šåŠ¡ç³»ç»Ÿçš„Oracle,è¿™äº›æºæ•°æ®åº“æ—¢ä¸ºä¸šåŠ¡ç³»ç»Ÿæä¾›æ•°æ®æ”¯æ’‘ï¼ŒåŒæ—¶ä¹Ÿä½œä¸ºæ•°æ®ä»“åº“çš„æ•°æ®æºï¼Œéƒ¨åˆ†å®æ—¶æ•°æ®æ˜¯é€šè¿‡kafkaï¼Œflumeï¼ŒNIFIæ”¶é›†æ¥çš„åŸ‹ç‚¹æ•°æ®ã€‚ETLETLåˆ†åˆ«ä»£è¡¨ï¼šæå–extractionã€è½¬æ¢transformationã€åŠ è½½loadã€‚å…¶ä¸­æå–è¿‡ç¨‹è¡¨ç¤ºæ“ä½œå‹æ•°æ®åº“æœé›†æŒ‡å®šæ•°æ®ï¼Œè½¬æ¢è¿‡ç¨‹è¡¨ç¤ºå°†æ•°æ®è½¬åŒ–ä¸ºæŒ‡å®šæ ¼å¼å¹¶è¿›è¡Œæ•°æ®æ¸…æ´—ä¿è¯æ•°æ®è´¨é‡ï¼ŒåŠ è½½è¿‡ç¨‹è¡¨ç¤ºå°†è½¬æ¢è¿‡åæ»¡è¶³æŒ‡å®šæ ¼å¼çš„æ•°æ®åŠ è½½è¿›æ•°æ®ä»“åº“ã€‚æ•°æ®ä»“åº“ä¼šå‘¨æœŸä¸æ–­åœ°ä»æºæ•°æ®åº“æå–æ¸…æ´—å¥½äº†çš„æ•°æ®ã€‚ï¼ˆETLåº”è¯¥æ˜¯æ•°æ®å·¥ç¨‹å¸ˆå¿…ä¼šçš„æŠ€èƒ½ğŸ˜‚ï¼‰å‰ç«¯åº”ç”¨æ•°æ®ä»“åº“çš„æ•°æ®ï¼Œè‚¯å®šæ˜¯ä¸ºäº†å‰ç«¯åº”ç”¨è€Œå‡†å¤‡çš„ï¼Œå‰ç«¯åº”ç”¨åˆ™æ˜¯ä¸ºäº†ä½¿ç”¨æ•°æ®çš„ç”¨æˆ·è€Œå‡†å¤‡çš„ã€‚ç›®å‰æˆ‘æ­å»ºçš„æ•°ä»“ä¸€èˆ¬ä¸ä¼šç›´æ¥å¯¹æ¥å‰ç«¯åº”ç”¨ï¼Œè€Œæ˜¯å°†æ•°ä»“ä¸­çš„æ•°æ®ï¼ŒæŒ‰ç…§ç”¨æˆ·æ–¹éœ€æ±‚è¿›è¡Œè®¡ç®—èšåˆåˆ°HBaseæˆ–è€…ESä¸­ã€‚ä¸­é—´åŠ ä¸€å±‚API,APIå¯ä»¥æ˜¯Goæˆ–è€…Pythonå¼€å‘çš„ï¼Œè¿™æ ·å‰ç«¯åº”ç”¨ç›´æ¥è°ƒç”¨API,ä¹Ÿæœ‰ä¸€äº›ç‰¹æ®Šåœºæ™¯ï¼Œä¼šç›´æ¥è°ƒç”¨prestoæ¥è®¿é—®Hiveæ•°æ®é›†å¸‚æ•°æ®é›†å¸‚æ˜¯æ•°æ®ä»“åº“ä¸‹é¢è¡ç”Ÿå‡ºæ¥çš„æ¦‚å¿µï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä¸¾ä¸€ä¸ªä¾‹å­æ¥å¸®åŠ©å¤§å®¶ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ•°æ®ä»“åº“ç†è§£æˆä¸‡è¾¾è´­ç‰©ä¸­å¿ƒï¼Œå…¶ä¸­æ¯å±‚éƒ½å–ç€ä¸åŒç§ç±»çš„å•†å“ï¼Œå…¶ä¸­ï¼Œä¸€å±‚å–çš„æœè£…ï¼ŒäºŒå±‚ä¹°çš„å®¶ç”µâ€¦è¿™æ ·å°±å¯ä»¥åˆ†æˆä¸€å±‚æ˜¯ä¸€ä¸ªæœè£…ä¸»é¢˜çš„æ•°æ®é›†å¸‚ï¼ŒäºŒå±‚æ˜¯å®¶ç”µä¸»é¢˜çš„æ•°æ®é›†å¸‚ã€‚åŒæ—¶å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ç§â€å°å‹æ•°æ®ä»“åº“â€ï¼Œå®ƒåªåŒ…å«å•ä¸ªä¸»é¢˜ï¼Œä¸”å…³æ³¨èŒƒå›´ä¹Ÿéå…¨å±€ã€‚é›†å¸‚å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯ç‹¬ç«‹æ•°æ®é›†å¸‚(independent data mart)ï¼Œè¿™ç±»æ•°æ®é›†å¸‚æœ‰è‡ªå·±çš„æºæ•°æ®åº“å’ŒETLæ¶æ„ï¼›å¦ä¸€ç§æ˜¯éç‹¬ç«‹æ•°æ®é›†å¸‚(dependent data mart)ï¼Œè¿™ç§æ•°æ®é›†å¸‚æ²¡æœ‰è‡ªå·±çš„æºç³»ç»Ÿï¼Œå®ƒçš„æ•°æ®æ¥è‡ªæ•°æ®ä»“åº“ã€‚å½“ç”¨æˆ·æˆ–è€…åº”ç”¨ç¨‹åºä¸éœ€è¦/ä¸å¿…è¦/ä¸å…è®¸ç”¨åˆ°æ•´ä¸ªæ•°æ®ä»“åº“çš„æ•°æ®æ—¶ï¼Œéç‹¬ç«‹æ•°æ®é›†å¸‚å°±å¯ä»¥ç®€å•ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªæ•°æ®ä»“åº“çš„â€å­é›†â€ã€‚æ•°æ®ä»“åº“æ­å»ºæµç¨‹å¤§å®¶å…ˆçœ‹è¿™ä¸ªæµç¨‹å›¾ï¼Œå…¶ä¸­çš„å„ä¸ªæ­¥éª¤ï¼Œæˆ‘éƒ½ä¼šå»ä»‹ç»ï¼Œå…¶ä¸­ç€é‡ä»‹ç»çš„ä¼šæ˜¯æ•°æ®ä»“åº“å»ºæ¨¡å’ŒETLå·¥ç¨‹ï¼Œå› ä¸ºï¼Œå»ºæ¨¡æ˜¯æ•´ä¸ªæ•°æ®ä»“åº“çš„æ ¸å¿ƒï¼ŒETLå·¥ç¨‹å¸ˆæ•´ä¸ªæ•°æ®ä»“åº“ä¸­æœ€è€—æ—¶è€—åŠ›çš„ã€‚ä»Šå¤©å‘¢ï¼Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œé“ºå«ä¸€ä¸‹","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"æ•°æ®ä»“åº“","slug":"æ•°æ®ä»“åº“","permalink":"cpeixin.cn/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"}]},{"title":"æ•°æ®åˆ†æ - EMèšç±» å®æˆ˜","slug":"æ•°æ®åˆ†æ-EMèšç±»-å®æˆ˜","date":"2018-08-18T14:18:53.000Z","updated":"2020-05-01T14:16:07.111Z","comments":true,"path":"2018/08/18/æ•°æ®åˆ†æ-EMèšç±»-å®æˆ˜/","link":"","permalink":"cpeixin.cn/2018/08/18/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-EM%E8%81%9A%E7%B1%BB-%E5%AE%9E%E6%88%98/","excerpt":"","text":"ä»Šå¤©è¿›è¡Œ EM çš„å®æˆ˜ã€‚ä¸Šç¯‡è®²äº† EM ç®—æ³•çš„åŸç†ï¼ŒEM ç®—æ³•ç›¸å½“äºä¸€ä¸ªèšç±»æ¡†æ¶ï¼Œé‡Œé¢æœ‰ä¸åŒçš„èšç±»æ¨¡å‹ï¼Œæ¯”å¦‚ GMM é«˜æ–¯æ··åˆæ¨¡å‹ï¼Œæˆ–è€… HMM éšé©¬å°”ç§‘å¤«æ¨¡å‹ã€‚å…¶ä¸­ä½ éœ€è¦ç†è§£çš„æ˜¯ EM çš„ä¸¤ä¸ªæ­¥éª¤ï¼ŒE æ­¥å’Œ M æ­¥ï¼šE æ­¥ç›¸å½“äºé€šè¿‡åˆå§‹åŒ–çš„å‚æ•°æ¥ä¼°è®¡éšå«å˜é‡ï¼ŒM æ­¥æ˜¯é€šè¿‡éšå«å˜é‡æ¥åæ¨ä¼˜åŒ–å‚æ•°ã€‚æœ€åé€šè¿‡ EM æ­¥éª¤çš„è¿­ä»£å¾—åˆ°æœ€ç»ˆçš„æ¨¡å‹å‚æ•°ã€‚ä»Šå¤©æˆ‘ä»¬è¿›è¡Œ EM ç®—æ³•çš„å®æˆ˜ï¼Œä½ éœ€è¦æ€è€ƒçš„æ˜¯ï¼šå¦‚ä½•ä½¿ç”¨ EM ç®—æ³•å·¥å…·å®Œæˆèšç±»ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨èšç±»ç®—æ³•ï¼Ÿæˆ‘ä»¬ç”¨èšç±»ç®—æ³•çš„ä»»åŠ¡ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿé¢å¯¹ç‹è€…è£è€€çš„è‹±é›„æ•°æ®ï¼ŒEM ç®—æ³•èƒ½å¸®åŠ©æˆ‘ä»¬åˆ†æå‡ºä»€ä¹ˆï¼Ÿå¦‚ä½•ä½¿ç”¨ EM å·¥å…·åŒ…åœ¨ Python ä¸­æœ‰ç¬¬ä¸‰æ–¹çš„ EM ç®—æ³•å·¥å…·åŒ…ã€‚ç”±äº EM ç®—æ³•æ˜¯ä¸€ä¸ªèšç±»æ¡†æ¶ï¼Œæ‰€ä»¥ä½ éœ€è¦æ˜ç¡®ä½ è¦ç”¨çš„å…·ä½“ç®—æ³•ï¼Œæ¯”å¦‚æ˜¯é‡‡ç”¨ GMM é«˜æ–¯æ··åˆæ¨¡å‹ï¼Œè¿˜æ˜¯ HMM éšé©¬å°”ç§‘å¤«æ¨¡å‹ã€‚è¿™èŠ‚è¯¾æˆ‘ä»¬ä¸»è¦è®²è§£ GMM çš„ä½¿ç”¨ï¼Œåœ¨ä½¿ç”¨å‰ä½ éœ€è¦å¼•å…¥å·¥å…·åŒ…ï¼š1from sklearn.mixture import GaussianMixtureæˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•åœ¨ sklearn ä¸­åˆ›å»º GMM èšç±»ã€‚é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨ gmm = GaussianMixture(n_components=1, covariance_type=â€˜fullâ€™, max_iter=100) æ¥åˆ›å»º GMM èšç±»ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªæ¯”è¾ƒä¸»è¦çš„å‚æ•°ï¼ˆGMM ç±»çš„æ„é€ å‚æ•°æ¯”è¾ƒå¤šï¼Œæˆ‘ç­›é€‰äº†ä¸€äº›ä¸»è¦çš„è¿›è¡Œè®²è§£ï¼‰ï¼Œæˆ‘åˆ†åˆ«æ¥è®²è§£ä¸‹ï¼š1.n_componentsï¼šå³é«˜æ–¯æ··åˆæ¨¡å‹çš„ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦èšç±»çš„ä¸ªæ•°ï¼Œé»˜è®¤å€¼ä¸º 1ã€‚å¦‚æœä½ ä¸æŒ‡å®š n_componentsï¼Œæœ€ç»ˆçš„èšç±»ç»“æœéƒ½ä¼šä¸ºåŒä¸€ä¸ªå€¼ã€‚2.covariance_typeï¼šä»£è¡¨åæ–¹å·®ç±»å‹ã€‚ä¸€ä¸ªé«˜æ–¯æ··åˆæ¨¡å‹çš„åˆ†å¸ƒæ˜¯ç”±å‡å€¼å‘é‡å’Œåæ–¹å·®çŸ©é˜µå†³å®šçš„ï¼Œæ‰€ä»¥åæ–¹å·®çš„ç±»å‹ä¹Ÿä»£è¡¨äº†ä¸åŒçš„é«˜æ–¯æ··åˆæ¨¡å‹çš„ç‰¹å¾ã€‚åæ–¹å·®ç±»å‹æœ‰ 4 ç§å–å€¼ï¼šcovariance_type=fullï¼Œä»£è¡¨å®Œå…¨åæ–¹å·®ï¼Œä¹Ÿå°±æ˜¯å…ƒç´ éƒ½ä¸ä¸º 0ï¼›covariance_type=tiedï¼Œä»£è¡¨ç›¸åŒçš„å®Œå…¨åæ–¹å·®ï¼›covariance_type=diagï¼Œä»£è¡¨å¯¹è§’åæ–¹å·®ï¼Œä¹Ÿå°±æ˜¯å¯¹è§’ä¸ä¸º 0ï¼Œå…¶ä½™ä¸º 0ï¼›covariance_type=sphericalï¼Œä»£è¡¨çƒé¢åæ–¹å·®ï¼Œéå¯¹è§’ä¸º 0ï¼Œå¯¹è§’å®Œå…¨ç›¸åŒï¼Œå‘ˆç°çƒé¢çš„ç‰¹æ€§ã€‚3.max_iterï¼šä»£è¡¨æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼ŒEM ç®—æ³•æ˜¯ç”± E æ­¥å’Œ M æ­¥è¿­ä»£æ±‚å¾—æœ€ç»ˆçš„æ¨¡å‹å‚æ•°ï¼Œè¿™é‡Œå¯ä»¥æŒ‡å®šæœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œé»˜è®¤å€¼ä¸º 100ã€‚åˆ›å»ºå®Œ GMM èšç±»å™¨ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼ å…¥æ•°æ®è®©å®ƒè¿›è¡Œè¿­ä»£æ‹Ÿåˆã€‚æˆ‘ä»¬ä½¿ç”¨ fit å‡½æ•°ï¼Œä¼ å…¥æ ·æœ¬ç‰¹å¾çŸ©é˜µï¼Œæ¨¡å‹ä¼šè‡ªåŠ¨ç”Ÿæˆèšç±»å™¨ï¼Œç„¶åä½¿ç”¨ prediction=gmm.predict(data) æ¥å¯¹æ•°æ®è¿›è¡Œèšç±»ï¼Œä¼ å…¥ä½ æƒ³è¿›è¡Œèšç±»çš„æ•°æ®ï¼Œå¯ä»¥å¾—åˆ°èšç±»ç»“æœ predictionã€‚ä½ èƒ½çœ‹å‡ºæ¥æ‹Ÿåˆè®­ç»ƒå’Œé¢„æµ‹å¯ä»¥ä¼ å…¥ç›¸åŒçš„ç‰¹å¾çŸ©é˜µï¼Œè¿™æ˜¯å› ä¸ºèšç±»æ˜¯æ— ç›‘ç£å­¦ä¹ ï¼Œä½ ä¸éœ€è¦äº‹å…ˆæŒ‡å®šèšç±»çš„ç»“æœï¼Œä¹Ÿæ— æ³•åŸºäºå…ˆéªŒçš„ç»“æœç»éªŒæ¥è¿›è¡Œå­¦ä¹ ã€‚åªè¦åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¼ å…¥ç‰¹å¾å€¼çŸ©é˜µï¼Œæœºå™¨å°±ä¼šæŒ‰ç…§ç‰¹å¾å€¼çŸ©é˜µç”Ÿæˆèšç±»å™¨ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªèšç±»å™¨è¿›è¡Œèšç±»äº†ã€‚å¦‚ä½•ç”¨ EM ç®—æ³•å¯¹ç‹è€…è£è€€æ•°æ®è¿›è¡Œèšç±»äº†è§£äº† GMM èšç±»å·¥å…·ä¹‹åï¼Œæˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•å¯¹ç‹è€…è£è€€çš„è‹±é›„æ•°æ®è¿›è¡Œèšç±»ã€‚é¦–å…ˆæˆ‘ä»¬çŸ¥é“èšç±»çš„åŸç†æ˜¯â€œäººä»¥ç¾¤åˆ†ï¼Œç‰©ä»¥ç±»èšâ€ã€‚é€šè¿‡èšç±»ç®—æ³•æŠŠç‰¹å¾å€¼ç›¸è¿‘çš„æ•°æ®å½’ä¸ºä¸€ç±»ï¼Œä¸åŒç±»ä¹‹é—´çš„å·®å¼‚è¾ƒå¤§ï¼Œè¿™æ ·å°±å¯ä»¥å¯¹åŸå§‹æ•°æ®è¿›è¡Œé™ç»´ã€‚é€šè¿‡åˆ†æˆå‡ ä¸ªç»„ï¼ˆç°‡ï¼‰ï¼Œæ¥ç ”ç©¶æ¯ä¸ªç»„ä¹‹é—´çš„ç‰¹æ€§ã€‚æˆ–è€…æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠç»„ï¼ˆç°‡ï¼‰çš„æ•°é‡é€‚å½“æå‡ï¼Œè¿™æ ·å°±å¯ä»¥æ‰¾åˆ°å¯ä»¥äº’ç›¸æ›¿æ¢çš„è‹±é›„ï¼Œæ¯”å¦‚ä½ çš„å¯¹æ‰‹é€‰æ‹©äº†ä½ æ“…é•¿çš„è‹±é›„ä¹‹åï¼Œä½ å¯ä»¥é€‰æ‹©å¦ä¸€ä¸ªè‹±é›„ä½œä¸ºå¤‡é€‰ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸‹æ•°æ®é•¿ä»€ä¹ˆæ ·å­ï¼šè¿™é‡Œæˆ‘ä»¬æ”¶é›†äº† 69 åè‹±é›„çš„ 20 ä¸ªç‰¹å¾å±æ€§ï¼Œè¿™äº›å±æ€§åˆ†åˆ«æ˜¯æœ€å¤§ç”Ÿå‘½ã€ç”Ÿå‘½æˆé•¿ã€åˆå§‹ç”Ÿå‘½ã€æœ€å¤§æ³•åŠ›ã€æ³•åŠ›æˆé•¿ã€åˆå§‹æ³•åŠ›ã€æœ€é«˜ç‰©æ”»ã€ç‰©æ”»æˆé•¿ã€åˆå§‹ç‰©æ”»ã€æœ€å¤§ç‰©é˜²ã€ç‰©é˜²æˆé•¿ã€åˆå§‹ç‰©é˜²ã€æœ€å¤§æ¯ 5 ç§’å›è¡€ã€æ¯ 5 ç§’å›è¡€æˆé•¿ã€åˆå§‹æ¯ 5 ç§’å›è¡€ã€æœ€å¤§æ¯ 5 ç§’å›è“ã€æ¯ 5 ç§’å›è“æˆé•¿ã€åˆå§‹æ¯ 5 ç§’å›è“ã€æœ€å¤§æ”»é€Ÿå’Œæ”»å‡»èŒƒå›´ç­‰ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦å¯¹ç‹è€…è£è€€çš„è‹±é›„æ•°æ®è¿›è¡Œèšç±»ï¼Œæˆ‘ä»¬å…ˆè®¾å®šé¡¹ç›®çš„æ‰§è¡Œæµç¨‹ï¼šé¦–å…ˆæˆ‘ä»¬éœ€è¦åŠ è½½æ•°æ®æºï¼›åœ¨å‡†å¤‡é˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ¢ç´¢ï¼ŒåŒ…æ‹¬é‡‡ç”¨æ•°æ®å¯è§†åŒ–æŠ€æœ¯ï¼Œè®©æˆ‘ä»¬å¯¹è‹±é›„å±æ€§ä»¥åŠè¿™äº›å±æ€§ä¹‹é—´çš„å…³ç³»ç†è§£æ›´åŠ æ·±åˆ»ï¼Œç„¶åå¯¹æ•°æ®è´¨é‡è¿›è¡Œè¯„ä¼°ï¼Œæ˜¯å¦è¿›è¡Œæ•°æ®æ¸…æ´—ï¼Œæœ€åè¿›è¡Œç‰¹å¾é€‰æ‹©æ–¹ä¾¿åç»­çš„èšç±»ç®—æ³•ï¼›èšç±»é˜¶æ®µï¼šé€‰æ‹©é€‚åˆçš„èšç±»æ¨¡å‹ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ GMM é«˜æ–¯æ··åˆæ¨¡å‹è¿›è¡Œèšç±»ï¼Œå¹¶è¾“å‡ºèšç±»ç»“æœï¼Œå¯¹ç»“æœè¿›è¡Œåˆ†æã€‚æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬æ¥ç¼–å†™ä¸‹ä»£ç ã€‚å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142# -*- coding: utf-8 -*-import pandas as pdimport csvimport matplotlib.pyplot as pltimport seaborn as snsfrom sklearn.mixture import GaussianMixturefrom sklearn.preprocessing import StandardScaler # æ•°æ®åŠ è½½ï¼Œé¿å…ä¸­æ–‡ä¹±ç é—®é¢˜data_ori = pd.read_csv('./heros7.csv', encoding = 'gb18030')features = [u'æœ€å¤§ç”Ÿå‘½',u'ç”Ÿå‘½æˆé•¿',u'åˆå§‹ç”Ÿå‘½',u'æœ€å¤§æ³•åŠ›', u'æ³•åŠ›æˆé•¿',u'åˆå§‹æ³•åŠ›',u'æœ€é«˜ç‰©æ”»',u'ç‰©æ”»æˆé•¿',u'åˆå§‹ç‰©æ”»',u'æœ€å¤§ç‰©é˜²',u'ç‰©é˜²æˆé•¿',u'åˆå§‹ç‰©é˜²', u'æœ€å¤§æ¯5ç§’å›è¡€', u'æ¯5ç§’å›è¡€æˆé•¿', u'åˆå§‹æ¯5ç§’å›è¡€', u'æœ€å¤§æ¯5ç§’å›è“', u'æ¯5ç§’å›è“æˆé•¿', u'åˆå§‹æ¯5ç§’å›è“', u'æœ€å¤§æ”»é€Ÿ', u'æ”»å‡»èŒƒå›´']data = data_ori[features] # å¯¹è‹±é›„å±æ€§ä¹‹é—´çš„å…³ç³»è¿›è¡Œå¯è§†åŒ–åˆ†æ# è®¾ç½®pltæ­£ç¡®æ˜¾ç¤ºä¸­æ–‡plt.rcParams['font.sans-serif']=['SimHei'] #ç”¨æ¥æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡æ ‡ç­¾plt.rcParams['axes.unicode_minus']=False #ç”¨æ¥æ­£å¸¸æ˜¾ç¤ºè´Ÿå·# ç”¨çƒ­åŠ›å›¾å‘ˆç°features_meanå­—æ®µä¹‹é—´çš„ç›¸å…³æ€§corr = data[features].corr()plt.figure(figsize=(14,14))# annot=Trueæ˜¾ç¤ºæ¯ä¸ªæ–¹æ ¼çš„æ•°æ®sns.heatmap(corr, annot=True)plt.show() # ç›¸å…³æ€§å¤§çš„å±æ€§ä¿ç•™ä¸€ä¸ªï¼Œå› æ­¤å¯ä»¥å¯¹å±æ€§è¿›è¡Œé™ç»´features_remain = [u'æœ€å¤§ç”Ÿå‘½', u'åˆå§‹ç”Ÿå‘½', u'æœ€å¤§æ³•åŠ›', u'æœ€é«˜ç‰©æ”»', u'åˆå§‹ç‰©æ”»', u'æœ€å¤§ç‰©é˜²', u'åˆå§‹ç‰©é˜²', u'æœ€å¤§æ¯5ç§’å›è¡€', u'æœ€å¤§æ¯5ç§’å›è“', u'åˆå§‹æ¯5ç§’å›è“', u'æœ€å¤§æ”»é€Ÿ', u'æ”»å‡»èŒƒå›´']data = data_ori[features_remain]data[u'æœ€å¤§æ”»é€Ÿ'] = data[u'æœ€å¤§æ”»é€Ÿ'].apply(lambda x: float(x.strip('%'))/100)data[u'æ”»å‡»èŒƒå›´']=data[u'æ”»å‡»èŒƒå›´'].map(&#123;'è¿œç¨‹':1,'è¿‘æˆ˜':0&#125;)# é‡‡ç”¨Z-Scoreè§„èŒƒåŒ–æ•°æ®ï¼Œä¿è¯æ¯ä¸ªç‰¹å¾ç»´åº¦çš„æ•°æ®å‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º1ss = StandardScaler()data = ss.fit_transform(data)# æ„é€ GMMèšç±»gmm = GaussianMixture(n_components=30, covariance_type='full')gmm.fit(data)# è®­ç»ƒæ•°æ®prediction = gmm.predict(data)print(prediction)# å°†åˆ†ç»„ç»“æœè¾“å‡ºåˆ°CSVæ–‡ä»¶ä¸­data_ori.insert(0, 'åˆ†ç»„', prediction)data_ori.to_csv('./hero_out.csv', index=False, sep=',')1234[28 14 8 9 5 5 15 8 3 14 18 14 9 7 16 18 13 3 5 4 19 12 4 12 12 12 4 17 24 2 7 2 2 24 2 2 24 6 20 22 22 24 24 2 2 22 14 20 14 24 26 29 27 25 25 28 11 1 23 5 11 0 10 28 21 29 29 29 17]åŒæ—¶ä½ ä¹Ÿèƒ½çœ‹åˆ°è¾“å‡ºçš„èšç±»ç»“æœæ–‡ä»¶ hero_out.csvï¼ˆå®ƒä¿å­˜åœ¨ä½ æœ¬åœ°è¿è¡Œçš„æ–‡ä»¶å¤¹é‡Œï¼Œç¨‹åºä¼šè‡ªåŠ¨è¾“å‡ºè¿™ä¸ªæ–‡ä»¶ï¼Œä½ å¯ä»¥è‡ªå·±çœ‹ä¸‹ï¼‰ã€‚æˆ‘æ¥ç®€å•è®²è§£ä¸‹ç¨‹åºçš„å‡ ä¸ªæ¨¡å—ã€‚å…³äºå¼•ç”¨åŒ…é¦–å…ˆæˆ‘ä»¬ä¼šç”¨ DataFrame æ•°æ®ç»“æ„æ¥ä¿å­˜è¯»å–çš„æ•°æ®ï¼Œæœ€åçš„èšç±»ç»“æœä¼šå†™å…¥åˆ° CSV æ–‡ä»¶ä¸­ï¼Œå› æ­¤ä¼šç”¨åˆ° pandas å’Œ CSV å·¥å…·åŒ…ã€‚å¦å¤–æˆ‘ä»¬éœ€è¦å¯¹æ•°æ®è¿›è¡Œå¯è§†åŒ–ï¼Œé‡‡ç”¨çƒ­åŠ›å›¾å±•ç°å±æ€§ä¹‹é—´çš„ç›¸å…³æ€§ï¼Œè¿™é‡Œä¼šç”¨åˆ° matplotlib.pyplot å’Œ seaborn å·¥å…·åŒ…ã€‚åœ¨æ•°æ®è§„èŒƒåŒ–ä¸­æˆ‘ä»¬ä½¿ç”¨åˆ°äº† Z-Score è§„èŒƒåŒ–ï¼Œç”¨åˆ°äº† StandardScaler ç±»ï¼Œæœ€åæˆ‘ä»¬è¿˜ä¼šç”¨åˆ° sklearn ä¸­çš„ GaussianMixture ç±»è¿›è¡Œèšç±»ã€‚æ•°æ®å¯è§†åŒ–çš„æ¢ç´¢ä½ èƒ½çœ‹åˆ°æˆ‘ä»¬å°† 20 ä¸ªè‹±é›„å±æ€§ä¹‹é—´çš„å…³ç³»ç”¨çƒ­åŠ›å›¾å‘ˆç°äº†å‡ºæ¥ï¼Œä¸­é—´çš„æ•°å­—ä»£è¡¨ä¸¤ä¸ªå±æ€§ä¹‹é—´çš„å…³ç³»ç³»æ•°ï¼Œæœ€å¤§å€¼ä¸º 1ï¼Œä»£è¡¨å®Œå…¨æ­£ç›¸å…³ï¼Œå…³ç³»ç³»æ•°è¶Šå¤§ä»£è¡¨ç›¸å…³æ€§è¶Šå¤§ã€‚ä»å›¾ä¸­ä½ èƒ½çœ‹å‡ºæ¥â€œæœ€å¤§ç”Ÿå‘½â€â€œç”Ÿå‘½æˆé•¿â€å’Œâ€œåˆå§‹ç”Ÿå‘½â€è¿™ä¸‰ä¸ªå±æ€§çš„ç›¸å…³æ€§å¤§ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿ç•™ä¸€ä¸ªå±æ€§å³å¯ã€‚åŒç†æˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹å…¶ä»–ç›¸å…³æ€§å¤§çš„å±æ€§è¿›è¡Œç­›é€‰ï¼Œä¿ç•™ä¸€ä¸ªã€‚ä½ åœ¨ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ç”¨ features_remain æ•°ç»„ä¿ç•™äº†ç‰¹å¾é€‰æ‹©çš„å±æ€§ï¼Œè¿™æ ·å°±å°†åŸæœ¬çš„ 20 ä¸ªå±æ€§é™ç»´åˆ°äº† 13 ä¸ªå±æ€§ã€‚å…³äºæ•°æ®è§„èŒƒåŒ–æˆ‘ä»¬èƒ½çœ‹åˆ°â€œæœ€å¤§æ”»é€Ÿâ€è¿™ä¸ªå±æ€§å€¼æ˜¯ç™¾åˆ†æ•°ï¼Œä¸é€‚åˆåšçŸ©é˜µè¿ç®—ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†ç™¾åˆ†æ•°è½¬åŒ–ä¸ºå°æ•°ã€‚æˆ‘ä»¬ä¹Ÿçœ‹åˆ°â€œæ”»å‡»èŒƒå›´â€è¿™ä¸ªå­—æ®µçš„å–å€¼ä¸ºè¿œç¨‹æˆ–è€…è¿‘æˆ˜ï¼Œä¹Ÿä¸é€‚åˆçŸ©é˜µè¿ç®—ï¼Œæˆ‘ä»¬å°†å–å€¼åšä¸ªæ˜ å°„ï¼Œç”¨ 1 ä»£è¡¨è¿œç¨‹ï¼Œ0 ä»£è¡¨è¿‘æˆ˜ã€‚ç„¶åé‡‡ç”¨ Z-Score è§„èŒƒåŒ–ï¼Œå¯¹ç‰¹å¾çŸ©é˜µè¿›è¡Œè§„èŒƒåŒ–ã€‚åœ¨èšç±»é˜¶æ®µæˆ‘ä»¬é‡‡ç”¨äº† GMM é«˜æ–¯æ··åˆæ¨¡å‹ï¼Œå¹¶å°†ç»“æœè¾“å‡ºåˆ° CSV æ–‡ä»¶ä¸­ã€‚è¿™é‡Œæˆ‘å°†è¾“å‡ºçš„ç»“æœæˆªå–äº†ä¸€æ®µï¼ˆè®¾ç½®èšç±»ä¸ªæ•°ä¸º 30ï¼‰ï¼šç¬¬ä¸€åˆ—ä»£è¡¨çš„æ˜¯åˆ†ç»„ï¼ˆç°‡ï¼‰ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°å¼ é£ã€ç¨‹å’¬é‡‘åˆ†åˆ°äº†ä¸€ç»„ï¼Œç‰›é­”ã€ç™½èµ·æ˜¯ä¸€ç»„ï¼Œè€å¤«å­è‡ªå·±æ˜¯ä¸€ç»„ï¼Œè¾¾æ‘©ã€å…¸éŸ¦æ˜¯ä¸€ç»„ã€‚èšç±»çš„ç‰¹ç‚¹æ˜¯ç›¸åŒç±»åˆ«ä¹‹é—´çš„å±æ€§å€¼ç›¸è¿‘ï¼Œä¸åŒç±»åˆ«çš„å±æ€§å€¼å·®å¼‚å¤§ã€‚å› æ­¤å¦‚æœä½ æ“…é•¿ç”¨å…¸éŸ¦è¿™ä¸ªè‹±é›„ï¼Œä¸é˜²è¯•è¯•è¾¾æ‘©è¿™ä¸ªè‹±é›„ã€‚åŒæ ·ä½ ä¹Ÿå¯ä»¥åœ¨å¼ é£å’Œç¨‹å’¬é‡‘ä¸­è¿›è¡Œåˆ‡æ¢ã€‚è¿™æ ·å°±ç®—ä½ çš„è‹±é›„è¢«åˆ«äººé€‰ä¸­äº†ï¼Œä½ ä¾ç„¶å¯ä»¥æœ‰å¤‡é€‰çš„è‹±é›„å¯ä»¥ä½¿ç”¨ã€‚æ€»ç»“ä»Šå¤©æˆ‘å¸¦ä½ ä¸€èµ·åšäº† EM èšç±»çš„å®æˆ˜ï¼Œå…·ä½“ä½¿ç”¨çš„æ˜¯ GMM é«˜æ–¯æ··åˆæ¨¡å‹ã€‚ä»æ•´ä¸ªæµç¨‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬éœ€è¦ç»è¿‡æ•°æ®åŠ è½½ã€æ•°æ®æ¢ç´¢ã€æ•°æ®å¯è§†åŒ–ã€ç‰¹å¾é€‰æ‹©ã€GMM èšç±»å’Œç»“æœåˆ†æç­‰ç¯èŠ‚ã€‚èšç±»å’Œåˆ†ç±»ä¸ä¸€æ ·ï¼Œèšç±»æ˜¯æ— ç›‘ç£çš„å­¦ä¹ æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ²¡æœ‰å®é™…çš„ç»“æœå¯ä»¥è¿›è¡Œæ¯”å¯¹ï¼Œæ‰€ä»¥èšç±»çš„ç»“æœè¯„ä¼°ä¸åƒåˆ†ç±»å‡†ç¡®ç‡ä¸€æ ·ç›´è§‚ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰èšç±»ç»“æœçš„è¯„ä¼°æ–¹å¼å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ Calinski-Harabaz æŒ‡æ ‡ï¼Œä»£ç å¦‚ä¸‹ï¼š123from sklearn.metrics import calinski_harabaz_scoreprint(calinski_harabaz_score(data, prediction))æŒ‡æ ‡åˆ†æ•°è¶Šé«˜ï¼Œä»£è¡¨èšç±»æ•ˆæœè¶Šå¥½ï¼Œä¹Ÿå°±æ˜¯ç›¸åŒç±»ä¸­çš„å·®å¼‚æ€§å°ï¼Œä¸åŒç±»ä¹‹é—´çš„å·®å¼‚æ€§å¤§ã€‚å½“ç„¶å…·ä½“èšç±»çš„ç»“æœå«ä¹‰ï¼Œæˆ‘ä»¬éœ€è¦äººå·¥æ¥åˆ†æï¼Œä¹Ÿå°±æ˜¯å½“è¿™äº›æ•°æ®è¢«åˆ†æˆä¸åŒçš„ç±»åˆ«ä¹‹åï¼Œå…·ä½“æ¯ä¸ªç±»è¡¨ä»£è¡¨çš„å«ä¹‰ã€‚å¦å¤–èšç±»ç®—æ³•ä¹Ÿå¯ä»¥ä½œä¸ºå…¶ä»–æ•°æ®æŒ–æ˜ç®—æ³•çš„é¢„å¤„ç†é˜¶æ®µï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°†æ•°æ®è¿›è¡Œé™ç»´äº†ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"EM","slug":"EM","permalink":"cpeixin.cn/tags/EM/"}]},{"title":"æ•°æ®åˆ†æ-K-Means_1","slug":"æ•°æ®åˆ†æ-K-Means-1","date":"2018-08-01T15:26:13.000Z","updated":"2020-05-01T14:15:41.551Z","comments":true,"path":"2018/08/01/æ•°æ®åˆ†æ-K-Means-1/","link":"","permalink":"cpeixin.cn/2018/08/01/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-K-Means-1/","excerpt":"","text":"æ•°æ®åˆ†æ - K-Means åŸç†K-Means æ˜¯ä¸€ç§éç›‘ç£å­¦ä¹ ï¼Œè§£å†³çš„æ˜¯èšç±»é—®é¢˜ã€‚K ä»£è¡¨çš„æ˜¯ K ç±»ï¼ŒMeans ä»£è¡¨çš„æ˜¯ä¸­å¿ƒï¼Œä½ å¯ä»¥ç†è§£è¿™ä¸ªç®—æ³•çš„æœ¬è´¨æ˜¯ç¡®å®š K ç±»çš„ä¸­å¿ƒç‚¹ï¼Œå½“ä½ æ‰¾åˆ°äº†è¿™äº›ä¸­å¿ƒç‚¹ï¼Œä¹Ÿå°±å®Œæˆäº†èšç±»ã€‚é‚£ä¹ˆè¯·ä½ å’Œæˆ‘æ€è€ƒä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼šå¦‚ä½•ç¡®å®š K ç±»çš„ä¸­å¿ƒç‚¹ï¼Ÿå¦‚ä½•å°†å…¶ä»–ç‚¹åˆ’åˆ†åˆ° K ç±»ä¸­ï¼Ÿå¦‚ä½•åŒºåˆ† K-Means ä¸ KNNï¼Ÿå¦‚æœç†è§£äº†ä¸Šé¢è¿™ 3 ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆå¯¹ K-Means çš„åŸç†æŒæ¡å¾—ä¹Ÿå°±å·®ä¸å¤šäº†ã€‚å…ˆè¯·ä½ å’Œæˆ‘æ€è€ƒä¸€ä¸ªåœºæ™¯ï¼Œå‡è®¾æˆ‘æœ‰ 20 æ”¯äºšæ´²è¶³çƒé˜Ÿï¼Œæƒ³è¦å°†å®ƒä»¬æŒ‰ç…§æˆç»©åˆ’åˆ†æˆ 3 ä¸ªç­‰çº§ï¼Œå¯ä»¥æ€æ ·åˆ’åˆ†ï¼ŸK-Means çš„å·¥ä½œåŸç†å¯¹äºšæ´²è¶³çƒé˜Ÿçš„æ°´å¹³ï¼Œä½ å¯èƒ½ä¹Ÿæœ‰è‡ªå·±çš„åˆ¤æ–­ã€‚æ¯”å¦‚ä¸€æµçš„äºšæ´²çƒé˜Ÿæœ‰è°ï¼Ÿä½ å¯èƒ½ä¼šè¯´ä¼Šæœ—æˆ–éŸ©å›½ã€‚äºŒæµçš„äºšæ´²çƒé˜Ÿå‘¢ï¼Ÿä½ å¯èƒ½è¯´æ˜¯ä¸­å›½ã€‚ä¸‰æµçš„äºšæ´²çƒé˜Ÿå‘¢ï¼Ÿä½ å¯èƒ½ä¼šè¯´è¶Šå—ã€‚å…¶å®è¿™äº›éƒ½æ˜¯é æˆ‘ä»¬çš„ç»éªŒæ¥åˆ’åˆ†çš„ï¼Œé‚£ä¹ˆä¼Šæœ—ã€ä¸­å›½ã€è¶Šå—å¯ä»¥è¯´æ˜¯ä¸‰ä¸ªç­‰çº§çš„å…¸å‹ä»£è¡¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ¯ä¸ªç±»çš„ä¸­å¿ƒç‚¹ã€‚æ‰€ä»¥å›è¿‡å¤´æ¥ï¼Œå¦‚ä½•ç¡®å®š K ç±»çš„ä¸­å¿ƒç‚¹ï¼Ÿä¸€å¼€å§‹æˆ‘ä»¬æ˜¯å¯ä»¥éšæœºæŒ‡æ´¾çš„ï¼Œå½“ä½ ç¡®è®¤äº†ä¸­å¿ƒç‚¹åï¼Œå°±å¯ä»¥æŒ‰ç…§è·ç¦»å°†å…¶ä»–è¶³çƒé˜Ÿåˆ’åˆ†åˆ°ä¸åŒçš„ç±»åˆ«ä¸­ã€‚è¿™ä¹Ÿå°±æ˜¯ K-Means çš„ä¸­å¿ƒæ€æƒ³ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ç›´æ¥ã€‚ä½ å¯èƒ½ä¼šé—®ï¼šå¦‚æœä¸€å¼€å§‹ï¼Œé€‰æ‹©ä¸€æµçƒé˜Ÿæ˜¯ä¸­å›½ï¼ŒäºŒæµçƒé˜Ÿæ˜¯ä¼Šæœ—ï¼Œä¸‰æµçƒé˜Ÿæ˜¯éŸ©å›½ï¼Œä¸­å¿ƒç‚¹é€‰æ‹©é”™äº†æ€ä¹ˆåŠï¼Ÿå…¶å®ä¸ç”¨æ‹…å¿ƒï¼ŒK-Means æœ‰è‡ªæˆ‘çº æ­£æœºåˆ¶ï¼Œåœ¨ä¸æ–­çš„è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œä¼šçº æ­£ä¸­å¿ƒç‚¹ã€‚ä¸­å¿ƒç‚¹åœ¨æ•´ä¸ªè¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå¹¶ä¸æ˜¯å”¯ä¸€çš„ï¼Œåªæ˜¯ä½ éœ€è¦ä¸€ä¸ªåˆå§‹å€¼ï¼Œä¸€èˆ¬ç®—æ³•ä¼šéšæœºè®¾ç½®åˆå§‹çš„ä¸­å¿ƒç‚¹ã€‚å¥½äº†ï¼Œé‚£æˆ‘æ¥æŠŠ K-Means çš„å·¥ä½œåŸç†ç»™ä½ æ€»ç»“ä¸‹ï¼šé€‰å– K ä¸ªç‚¹ä½œä¸ºåˆå§‹çš„ç±»ä¸­å¿ƒç‚¹ï¼Œè¿™äº›ç‚¹ä¸€èˆ¬éƒ½æ˜¯ä»æ•°æ®é›†ä¸­éšæœºæŠ½å–çš„ï¼›å°†æ¯ä¸ªç‚¹åˆ†é…åˆ°æœ€è¿‘çš„ç±»ä¸­å¿ƒç‚¹ï¼Œè¿™æ ·å°±å½¢æˆäº† K ä¸ªç±»ï¼Œç„¶åé‡æ–°è®¡ç®—æ¯ä¸ªç±»çš„ä¸­å¿ƒç‚¹ï¼›é‡å¤ç¬¬äºŒæ­¥ï¼Œç›´åˆ°ç±»ä¸å‘ç”Ÿå˜åŒ–ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥è®¾ç½®æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œè¿™æ ·å³ä½¿ç±»ä¸­å¿ƒç‚¹å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯åªè¦è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°å°±ä¼šç»“æŸã€‚å¦‚ä½•ç»™äºšæ´²çƒé˜Ÿåšèšç±»å¯¹äºæœºå™¨æ¥è¯´éœ€è¦æ•°æ®æ‰èƒ½åˆ¤æ–­ç±»ä¸­å¿ƒç‚¹ï¼Œæ‰€ä»¥æˆ‘æ•´ç†äº† 2015-2019 å¹´äºšæ´²çƒé˜Ÿçš„æ’åï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚æˆ‘æ¥è¯´æ˜ä¸€ä¸‹æ•°æ®æ¦‚å†µã€‚å…¶ä¸­ 2019 å¹´å›½é™…è¶³è”çš„ä¸–ç•Œæ’åï¼Œ2015 å¹´äºšæ´²æ¯æ’åå‡ä¸ºå®é™…æ’åã€‚2018 å¹´ä¸–ç•Œæ¯ä¸­ï¼Œå¾ˆå¤šçƒé˜Ÿæ²¡æœ‰è¿›å…¥åˆ°å†³èµ›åœˆï¼Œæ‰€ä»¥åªæœ‰è¿›å…¥åˆ°å†³èµ›åœˆçš„çƒé˜Ÿæ‰æœ‰å®é™…çš„æ’åã€‚å¦‚æœæ˜¯äºšæ´²åŒºé¢„é€‰èµ› 12 å¼ºçš„çƒé˜Ÿï¼Œæ’åä¼šè®¾ç½®ä¸º 40ã€‚å¦‚æœæ²¡æœ‰è¿›å…¥äºšæ´²åŒºé¢„é€‰èµ› 12 å¼ºï¼Œçƒé˜Ÿæ’åä¼šè®¾ç½®ä¸º 50ã€‚é’ˆå¯¹ä¸Šé¢çš„æ’åï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åšçš„æ˜¯æ•°æ®è§„èŒƒåŒ–ã€‚ä½ å¯ä»¥æŠŠè¿™äº›å€¼åˆ’åˆ†åˆ°[0,1]æˆ–è€…æŒ‰ç…§å‡å€¼ä¸º 0ï¼Œæ–¹å·®ä¸º 1 çš„æ­£æ€åˆ†å¸ƒè¿›è¡Œè§„èŒƒåŒ–ã€‚æˆ‘å…ˆæŠŠæ•°å€¼éƒ½è§„èŒƒåŒ–åˆ°[0,1]çš„ç©ºé—´ä¸­ï¼Œå¾—åˆ°äº†ä»¥ä¸‹çš„æ•°å€¼è¡¨ï¼šå¦‚æœæˆ‘ä»¬éšæœºé€‰å–ä¸­å›½ã€æ—¥æœ¬ã€éŸ©å›½ä¸ºä¸‰ä¸ªç±»çš„ä¸­å¿ƒç‚¹ï¼Œæˆ‘ä»¬å°±éœ€è¦çœ‹ä¸‹è¿™äº›çƒé˜Ÿåˆ°ä¸­å¿ƒç‚¹çš„è·ç¦»ã€‚è·ç¦»æœ‰å¤šç§è®¡ç®—çš„æ–¹å¼ï¼Œæœ‰å…³è·ç¦»çš„è®¡ç®—æˆ‘åœ¨ KNN ç®—æ³•ä¸­ä¹Ÿè®²åˆ°è¿‡ï¼šæ¬§æ°è·ç¦»æ›¼å“ˆé¡¿è·ç¦»åˆ‡æ¯”é›ªå¤«è·ç¦»ä½™å¼¦è·ç¦»æ¬§æ°è·ç¦»æ˜¯æœ€å¸¸ç”¨çš„è·ç¦»è®¡ç®—æ–¹å¼ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©æ¬§æ°è·ç¦»ä½œä¸ºè·ç¦»çš„æ ‡å‡†ï¼Œè®¡ç®—æ¯ä¸ªé˜Ÿä¼åˆ†åˆ«åˆ°ä¸­å›½ã€æ—¥æœ¬ã€éŸ©å›½çš„è·ç¦»ï¼Œç„¶åæ ¹æ®è·ç¦»è¿œè¿‘æ¥åˆ’åˆ†ã€‚æˆ‘ä»¬çœ‹åˆ°å¤§éƒ¨åˆ†çš„é˜Ÿï¼Œä¼šå’Œä¸­å›½é˜Ÿèšç±»åˆ°ä¸€èµ·ã€‚è¿™é‡Œæˆ‘æ•´ç†äº†è·ç¦»çš„è®¡ç®—è¿‡ç¨‹ï¼Œæ¯”å¦‚ä¸­å›½å’Œä¸­å›½çš„æ¬§æ°è·ç¦»ä¸º 0ï¼Œä¸­å›½å’Œæ—¥æœ¬çš„æ¬§å¼è·ç¦»ä¸º 0.732003ã€‚å¦‚æœæŒ‰ç…§ä¸­å›½ã€æ—¥æœ¬ã€éŸ©å›½ä¸º 3 ä¸ªåˆ†ç±»çš„ä¸­å¿ƒç‚¹ï¼Œæ¬§æ°è·ç¦»çš„è®¡ç®—ç»“æœå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼šç„¶åæˆ‘ä»¬å†é‡æ–°è®¡ç®—è¿™ä¸‰ä¸ªç±»çš„ä¸­å¿ƒç‚¹ï¼Œå¦‚ä½•è®¡ç®—å‘¢ï¼Ÿæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å–å¹³å‡å€¼ï¼Œç„¶åæ ¹æ®æ–°çš„ä¸­å¿ƒç‚¹æŒ‰ç…§è·ç¦»è¿œè¿‘é‡æ–°åˆ†é…çƒé˜Ÿçš„åˆ†ç±»ï¼Œå†æ ¹æ®çƒé˜Ÿçš„åˆ†ç±»æ›´æ–°ä¸­å¿ƒç‚¹çš„ä½ç½®ã€‚è®¡ç®—è¿‡ç¨‹è¿™é‡Œä¸å±•å¼€ï¼Œæœ€åä¸€ç›´è¿­ä»£ï¼ˆé‡å¤ä¸Šè¿°çš„è®¡ç®—è¿‡ç¨‹ï¼šè®¡ç®—ä¸­å¿ƒç‚¹å’Œåˆ’åˆ†åˆ†ç±»ï¼‰åˆ°åˆ†ç±»ä¸å†å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥å¾—åˆ°ä»¥ä¸‹çš„åˆ†ç±»ç»“æœï¼šæ‰€ä»¥æˆ‘ä»¬èƒ½çœ‹å‡ºæ¥ç¬¬ä¸€æ¢¯é˜Ÿæœ‰æ—¥æœ¬ã€éŸ©å›½ã€ä¼Šæœ—ã€æ²™ç‰¹ã€æ¾³æ´²ï¼›ç¬¬äºŒæ¢¯é˜Ÿæœ‰ä¸­å›½ã€ä¼Šæ‹‰å…‹ã€é˜¿è”é…‹ã€ä¹Œå…¹åˆ«å…‹æ–¯å¦ï¼›ç¬¬ä¸‰æ¢¯é˜Ÿæœ‰å¡å¡”å°”ã€æ³°å›½ã€è¶Šå—ã€é˜¿æ›¼ã€å·´æ—ã€æœé²œã€å°å°¼ã€å™åˆ©äºšã€çº¦æ—¦ã€ç§‘å¨ç‰¹å’Œå·´å‹’æ–¯å¦ã€‚å¦‚ä½•ä½¿ç”¨ sklearn ä¸­çš„ K-Means ç®—æ³•sklearn æ˜¯ Python çš„æœºå™¨å­¦ä¹ å·¥å…·åº“ï¼Œå¦‚æœä»åŠŸèƒ½ä¸Šæ¥åˆ’åˆ†ï¼Œsklearn å¯ä»¥å®ç°åˆ†ç±»ã€èšç±»ã€å›å½’ã€é™ç»´ã€æ¨¡å‹é€‰æ‹©å’Œé¢„å¤„ç†ç­‰åŠŸèƒ½ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ sklearn çš„èšç±»å‡½æ•°åº“ï¼Œå› æ­¤éœ€è¦å¼•ç”¨å·¥å…·åŒ…ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š1from sklearn.cluster import KMeanså½“ç„¶ K-Means åªæ˜¯ sklearn.cluster ä¸­çš„ä¸€ä¸ªèšç±»åº“ï¼Œå®é™…ä¸ŠåŒ…æ‹¬ K-Means åœ¨å†…ï¼Œsklearn.cluster ä¸€å…±æä¾›äº† 9 ç§èšç±»æ–¹æ³•ï¼Œæ¯”å¦‚ Mean-shiftï¼ŒDBSCANï¼ŒSpectral clusteringï¼ˆè°±èšç±»ï¼‰ç­‰ã€‚è¿™äº›èšç±»æ–¹æ³•çš„åŸç†å’Œ K-Means ä¸åŒï¼Œè¿™é‡Œä¸åšä»‹ç»ã€‚æˆ‘ä»¬çœ‹ä¸‹ K-Means å¦‚ä½•åˆ›å»ºï¼š1KMeans(n_clusters=8, init='k-means++', n_init=10, max_iter=300, tol=0.0001, precompute_distances='auto', verbose=0, random_state=None, copy_x=True, n_jobs=1, algorithm='auto')æˆ‘ä»¬èƒ½çœ‹åˆ°åœ¨ K-Means ç±»åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€äº›ä¸»è¦çš„å‚æ•°ï¼šn_clusters: å³ K å€¼ï¼Œä¸€èˆ¬éœ€è¦å¤šè¯•ä¸€äº› K å€¼æ¥ä¿è¯æ›´å¥½çš„èšç±»æ•ˆæœã€‚ä½ å¯ä»¥éšæœºè®¾ç½®ä¸€äº› K å€¼ï¼Œç„¶åé€‰æ‹©èšç±»æ•ˆæœæœ€å¥½çš„ä½œä¸ºæœ€ç»ˆçš„ K å€¼ï¼›max_iterï¼š æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œå¦‚æœèšç±»å¾ˆéš¾æ”¶æ•›çš„è¯ï¼Œè®¾ç½®æœ€å¤§è¿­ä»£æ¬¡æ•°å¯ä»¥è®©æˆ‘ä»¬åŠæ—¶å¾—åˆ°åé¦ˆç»“æœï¼Œå¦åˆ™ç¨‹åºè¿è¡Œæ—¶é—´ä¼šéå¸¸é•¿ï¼›n_initï¼šåˆå§‹åŒ–ä¸­å¿ƒç‚¹çš„è¿ç®—æ¬¡æ•°ï¼Œé»˜è®¤æ˜¯ 10ã€‚ç¨‹åºæ˜¯å¦èƒ½å¿«é€Ÿæ”¶æ•›å’Œä¸­å¿ƒç‚¹çš„é€‰æ‹©å…³ç³»éå¸¸å¤§ï¼Œæ‰€ä»¥åœ¨ä¸­å¿ƒç‚¹é€‰æ‹©ä¸Šå¤šèŠ±ä¸€äº›æ—¶é—´ï¼Œæ¥äº‰å–æ•´ä½“æ—¶é—´ä¸Šçš„å¿«é€Ÿæ”¶æ•›è¿˜æ˜¯éå¸¸å€¼å¾—çš„ã€‚ç”±äºæ¯ä¸€æ¬¡ä¸­å¿ƒç‚¹éƒ½æ˜¯éšæœºç”Ÿæˆçš„ï¼Œè¿™æ ·å¾—åˆ°çš„ç»“æœå°±æœ‰å¥½æœ‰åï¼Œéå¸¸ä¸ç¡®å®šï¼Œæ‰€ä»¥è¦è¿è¡Œ n_init æ¬¡, å–å…¶ä¸­æœ€å¥½çš„ä½œä¸ºåˆå§‹çš„ä¸­å¿ƒç‚¹ã€‚å¦‚æœ K å€¼æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œä½ å¯ä»¥é€‚å½“å¢å¤§ n_init è¿™ä¸ªå€¼ï¼›initï¼š å³åˆå§‹å€¼é€‰æ‹©çš„æ–¹å¼ï¼Œé»˜è®¤æ˜¯é‡‡ç”¨ä¼˜åŒ–è¿‡çš„ k-means++ æ–¹å¼ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®šä¸­å¿ƒç‚¹ï¼Œæˆ–è€…é‡‡ç”¨ random å®Œå…¨éšæœºçš„æ–¹å¼ã€‚è‡ªå·±è®¾ç½®ä¸­å¿ƒç‚¹ä¸€èˆ¬æ˜¯å¯¹äºä¸ªæ€§åŒ–çš„æ•°æ®è¿›è¡Œè®¾ç½®ï¼Œå¾ˆå°‘é‡‡ç”¨ã€‚random çš„æ–¹å¼åˆ™æ˜¯å®Œå…¨éšæœºçš„æ–¹å¼ï¼Œä¸€èˆ¬æ¨èé‡‡ç”¨ä¼˜åŒ–è¿‡çš„ k-means++ æ–¹å¼ï¼›algorithmï¼šk-means çš„å®ç°ç®—æ³•ï¼Œæœ‰â€œautoâ€ â€œfullâ€â€œelkanâ€ä¸‰ç§ã€‚ä¸€èˆ¬æ¥è¯´å»ºè®®ç›´æ¥ç”¨é»˜è®¤çš„â€autoâ€ã€‚ç®€å•è¯´ä¸‹è¿™ä¸‰ä¸ªå–å€¼çš„åŒºåˆ«ï¼Œå¦‚æœä½ é€‰æ‹©â€fullâ€é‡‡ç”¨çš„æ˜¯ä¼ ç»Ÿçš„ K-Means ç®—æ³•ï¼Œâ€œautoâ€ä¼šæ ¹æ®æ•°æ®çš„ç‰¹ç‚¹è‡ªåŠ¨é€‰æ‹©æ˜¯é€‰æ‹©â€œfullâ€è¿˜æ˜¯â€œelkanâ€ã€‚æˆ‘ä»¬ä¸€èˆ¬é€‰æ‹©é»˜è®¤çš„å–å€¼ï¼Œå³â€œautoâ€ ã€‚åœ¨åˆ›å»ºå¥½ K-Means ç±»ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨å®ƒçš„æ–¹æ³•ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ fit å’Œ predict è¿™ä¸ªä¸¤ä¸ªå‡½æ•°ã€‚ä½ å¯ä»¥å•ç‹¬ä½¿ç”¨ fit å‡½æ•°å’Œ predict å‡½æ•°ï¼Œä¹Ÿå¯ä»¥åˆå¹¶ä½¿ç”¨ fit_predict å‡½æ•°ã€‚å…¶ä¸­ fit(data) å¯ä»¥å¯¹ data æ•°æ®è¿›è¡Œ k-Means èšç±»ã€‚ predict(data) å¯ä»¥é’ˆå¯¹ data ä¸­çš„æ¯ä¸ªæ ·æœ¬ï¼Œè®¡ç®—æœ€è¿‘çš„ç±»ã€‚ç°åœ¨æˆ‘ä»¬è¦å®Œæ•´åœ°è·‘ä¸€é 20 æ”¯äºšæ´²çƒé˜Ÿçš„èšç±»é—®é¢˜ã€‚1234567891011121314151617181920212223# coding: utf-8from sklearn.cluster import KMeansfrom sklearn import preprocessingimport pandas as pdimport numpy as np# è¾“å…¥æ•°æ®data = pd.read_csv('data.csv', encoding='gbk')train_x = data[[\"2019å¹´å›½é™…æ’å\",\"2018ä¸–ç•Œæ¯\",\"2015äºšæ´²æ¯\"]]df = pd.DataFrame(train_x)# kmeans = KMeans(n_clusters=3)kmeans = KMeans(n_clusters=3, init='k-means++', n_init=10, max_iter=300, tol=0.0001, precompute_distances='auto', verbose=0, random_state=None, copy_x=True, n_jobs=1, algorithm='auto')# è§„èŒƒåŒ–åˆ°[0,1]ç©ºé—´min_max_scaler=preprocessing.MinMaxScaler()train_x=min_max_scaler.fit_transform(train_x)# kmeansç®—æ³•kmeans.fit(train_x)predict_y = kmeans.predict(train_x)# åˆå¹¶èšç±»ç»“æœï¼Œæ’å…¥åˆ°åŸæ•°æ®ä¸­result = pd.concat((data,pd.DataFrame(predict_y)),axis=1)result.rename(&#123;0:u'èšç±»'&#125;,axis=1,inplace=True)print(result)ç»“æœï¼š123456789101112131415161718192021 å›½å®¶ 2019å¹´å›½é™…æ’å 2018ä¸–ç•Œæ¯ 2015äºšæ´²æ¯ èšç±»0 ä¸­å›½ 73 40 7 21 æ—¥æœ¬ 60 15 5 02 éŸ©å›½ 61 19 2 03 ä¼Šæœ— 34 18 6 04 æ²™ç‰¹ 67 26 10 05 ä¼Šæ‹‰å…‹ 91 40 4 26 å¡å¡”å°” 101 40 13 17 é˜¿è”é…‹ 81 40 6 28 ä¹Œå…¹åˆ«å…‹æ–¯å¦ 88 40 8 29 æ³°å›½ 122 40 17 110 è¶Šå— 102 50 17 111 é˜¿æ›¼ 87 50 12 112 å·´æ— 116 50 11 113 æœé²œ 110 50 14 114 å°å°¼ 164 50 17 115 æ¾³æ´² 40 30 1 016 å™åˆ©äºš 76 40 17 117 çº¦æ—¦ 118 50 9 118 ç§‘å¨ç‰¹ 160 50 15 119 å·´å‹’æ–¯å¦ 96 50 16 1æ€»ç»“å¦‚ä½•ç¡®å®š K ç±»çš„ä¸­å¿ƒç‚¹ï¼Ÿå…¶ä¸­åŒ…æ‹¬äº†åˆå§‹çš„è®¾ç½®ï¼Œä»¥åŠä¸­é—´è¿­ä»£è¿‡ç¨‹ä¸­ä¸­å¿ƒç‚¹çš„è®¡ç®—ã€‚åœ¨åˆå§‹è®¾ç½®ä¸­ï¼Œä¼šè¿›è¡Œ n_init æ¬¡çš„é€‰æ‹©ï¼Œç„¶åé€‰æ‹©åˆå§‹ä¸­å¿ƒç‚¹æ•ˆæœæœ€å¥½çš„ä¸ºåˆå§‹å€¼ã€‚åœ¨æ¯æ¬¡åˆ†ç±»æ›´æ–°åï¼Œä½ éƒ½éœ€è¦é‡æ–°ç¡®è®¤æ¯ä¸€ç±»çš„ä¸­å¿ƒç‚¹ï¼Œä¸€èˆ¬é‡‡ç”¨å‡å€¼çš„æ–¹å¼è¿›è¡Œç¡®è®¤ã€‚å¦‚ä½•å°†å…¶ä»–ç‚¹åˆ’åˆ†åˆ° K ç±»ä¸­ï¼Ÿè¿™é‡Œå®é™…ä¸Šæ˜¯å…³äºè·ç¦»çš„å®šä¹‰ï¼Œæˆ‘ä»¬çŸ¥é“è·ç¦»æœ‰å¤šç§å®šä¹‰çš„æ–¹å¼ï¼Œåœ¨ K-Means å’Œ KNN ä¸­ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥é‡‡ç”¨æ¬§æ°è·ç¦»ã€æ›¼å“ˆé¡¿è·ç¦»ã€åˆ‡æ¯”é›ªå¤«è·ç¦»ã€ä½™å¼¦è·ç¦»ç­‰ã€‚å¯¹äºç‚¹çš„åˆ’åˆ†ï¼Œå°±çœ‹å®ƒç¦»å“ªä¸ªç±»çš„ä¸­å¿ƒç‚¹çš„è·ç¦»æœ€è¿‘ï¼Œå°±å±äºå“ªä¸€ç±»ã€‚å¦‚ä½•åŒºåˆ† K-Means å’Œ KNN è¿™ä¸¤ç§ç®—æ³•å‘¢ï¼Ÿåˆšå­¦è¿‡ K-Means å’Œ KNN ç®—æ³•çš„åŒå­¦åº”è¯¥èƒ½çŸ¥é“ä¸¤è€…çš„åŒºåˆ«ï¼Œä½†å¾€å¾€è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œå°±å®¹æ˜“æ··æ·†ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»ä¸‰ä¸ªç»´åº¦æ¥åŒºåˆ† K-Means å’Œ KNN è¿™ä¸¤ä¸ªç®—æ³•ï¼šé¦–å…ˆï¼Œè¿™ä¸¤ä¸ªç®—æ³•è§£å†³æ•°æ®æŒ–æ˜çš„ä¸¤ç±»é—®é¢˜ã€‚K-Means æ˜¯èšç±»ç®—æ³•ï¼ŒKNN æ˜¯åˆ†ç±»ç®—æ³•ã€‚è¿™ä¸¤ä¸ªç®—æ³•åˆ†åˆ«æ˜¯ä¸¤ç§ä¸åŒçš„å­¦ä¹ æ–¹å¼ã€‚K-Means æ˜¯éç›‘ç£å­¦ä¹ ï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦äº‹å…ˆç»™å‡ºåˆ†ç±»æ ‡ç­¾ï¼Œè€Œ KNN æ˜¯æœ‰ç›‘ç£å­¦ä¹ ï¼Œéœ€è¦æˆ‘ä»¬ç»™å‡ºè®­ç»ƒæ•°æ®çš„åˆ†ç±»æ ‡è¯†ã€‚æœ€åï¼ŒK å€¼çš„å«ä¹‰ä¸åŒã€‚K-Means ä¸­çš„ K å€¼ä»£è¡¨ K ç±»ã€‚KNN ä¸­çš„ K å€¼ä»£è¡¨ K ä¸ªæœ€æ¥è¿‘çš„é‚»å±…ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"K-Means","slug":"K-Means","permalink":"cpeixin.cn/tags/K-Means/"}]},{"title":"æ•°æ®åˆ†æ-KNN_2","slug":"æ•°æ®åˆ†æ-KNN-2","date":"2018-07-26T16:14:49.000Z","updated":"2020-05-01T14:14:37.744Z","comments":true,"path":"2018/07/27/æ•°æ®åˆ†æ-KNN-2/","link":"","permalink":"cpeixin.cn/2018/07/27/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-KNN-2/","excerpt":"","text":"é€šè¿‡ sklearn ä¸­è‡ªå¸¦çš„æ‰‹å†™æ•°å­—æ•°æ®é›†æ¥è¿›è¡Œå®æˆ˜ã€‚å¦‚ä½•åœ¨ sklearn ä¸­ä½¿ç”¨ KNNåœ¨ Python çš„ sklearn å·¥å…·åŒ…ä¸­æœ‰ KNN ç®—æ³•ã€‚KNN æ—¢å¯ä»¥åšåˆ†ç±»å™¨ï¼Œä¹Ÿå¯ä»¥åšå›å½’ã€‚å¦‚æœæ˜¯åšåˆ†ç±»ï¼Œä½ éœ€è¦å¼•ç”¨ï¼š1from sklearn.neighbors import KNeighborsClassifierå¦‚æœæ˜¯åšå›å½’ï¼Œä½ éœ€è¦å¼•ç”¨ï¼š1from sklearn.neighbors import KNeighborsRegressorä»åå­—ä¸Šä½ ä¹Ÿèƒ½çœ‹å‡ºæ¥ Classifier å¯¹åº”çš„æ˜¯åˆ†ç±»ï¼ŒRegressor å¯¹åº”çš„æ˜¯å›å½’ã€‚ä¸€èˆ¬æ¥è¯´å¦‚æœä¸€ä¸ªç®—æ³•æœ‰ Classifier ç±»ï¼Œéƒ½èƒ½æ‰¾åˆ°ç›¸åº”çš„ Regressor ç±»ã€‚æ¯”å¦‚åœ¨å†³ç­–æ ‘åˆ†ç±»ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ DecisionTreeClassifierï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å†³ç­–æ ‘æ¥åšå›å½’ DecisionTreeRegressorã€‚å¥½äº†ï¼Œæˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•åœ¨ sklearn ä¸­åˆ›å»º KNN åˆ†ç±»å™¨ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨æ„é€ å‡½æ•°1KNeighborsClassifier(n_neighbors=5, weights=â€˜uniformâ€™, algorithm=â€˜autoâ€™, leaf_size=30)è¿™é‡Œæœ‰å‡ ä¸ªæ¯”è¾ƒä¸»è¦çš„å‚æ•°ï¼Œæˆ‘åˆ†åˆ«æ¥è®²è§£ä¸‹ï¼š1.n_neighborsï¼šå³ KNN ä¸­çš„ K å€¼ï¼Œä»£è¡¨çš„æ˜¯é‚»å±…çš„æ•°é‡ã€‚K å€¼å¦‚æœæ¯”è¾ƒå°ï¼Œä¼šé€ æˆè¿‡æ‹Ÿåˆã€‚å¦‚æœ K å€¼æ¯”è¾ƒå¤§ï¼Œæ— æ³•å°†æœªçŸ¥ç‰©ä½“åˆ†ç±»å‡ºæ¥ã€‚ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨é»˜è®¤å€¼ 5ã€‚2.weightsï¼šæ˜¯ç”¨æ¥ç¡®å®šé‚»å±…çš„æƒé‡ï¼Œæœ‰ä¸‰ç§æ–¹å¼ï¼šweights=uniformï¼Œä»£è¡¨æ‰€æœ‰é‚»å±…çš„æƒé‡ç›¸åŒï¼›weights=distanceï¼Œä»£è¡¨æƒé‡æ˜¯è·ç¦»çš„å€’æ•°ï¼Œå³ä¸è·ç¦»æˆåæ¯”ï¼›è‡ªå®šä¹‰å‡½æ•°ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰ä¸åŒè·ç¦»æ‰€å¯¹åº”çš„æƒé‡ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸éœ€è¦è‡ªå·±å®šä¹‰å‡½æ•°ã€‚3.algorithmï¼šç”¨æ¥è§„å®šè®¡ç®—é‚»å±…çš„æ–¹æ³•ï¼Œå®ƒæœ‰å››ç§æ–¹å¼ï¼šalgorithm=autoï¼Œæ ¹æ®æ•°æ®çš„æƒ…å†µè‡ªåŠ¨é€‰æ‹©é€‚åˆçš„ç®—æ³•ï¼Œé»˜è®¤æƒ…å†µé€‰æ‹© autoï¼›algorithm=kd_treeï¼Œä¹Ÿå«ä½œ KD æ ‘ï¼Œæ˜¯å¤šç»´ç©ºé—´çš„æ•°æ®ç»“æ„ï¼Œæ–¹ä¾¿å¯¹å…³é”®æ•°æ®è¿›è¡Œæ£€ç´¢ï¼Œä¸è¿‡ KD æ ‘é€‚ç”¨äºç»´åº¦å°‘çš„æƒ…å†µï¼Œä¸€èˆ¬ç»´æ•°ä¸è¶…è¿‡ 20ï¼Œå¦‚æœç»´æ•°å¤§äº 20 ä¹‹åï¼Œæ•ˆç‡åè€Œä¼šä¸‹é™ï¼›algorithm=ball_treeï¼Œä¹Ÿå«ä½œçƒæ ‘ï¼Œå®ƒå’Œ KD æ ‘ä¸€æ ·éƒ½æ˜¯å¤šç»´ç©ºé—´çš„æ•°æ®ç»“æœï¼Œä¸åŒäº KD æ ‘ï¼Œçƒæ ‘æ›´é€‚ç”¨äºç»´åº¦å¤§çš„æƒ…å†µï¼›algorithm=bruteï¼Œä¹Ÿå«ä½œæš´åŠ›æœç´¢ï¼Œå®ƒå’Œ KD æ ‘ä¸åŒçš„åœ°æ–¹æ˜¯åœ¨äºé‡‡ç”¨çš„æ˜¯çº¿æ€§æ‰«æï¼Œè€Œä¸æ˜¯é€šè¿‡æ„é€ æ ‘ç»“æ„è¿›è¡Œå¿«é€Ÿæ£€ç´¢ã€‚å½“è®­ç»ƒé›†å¤§çš„æ—¶å€™ï¼Œæ•ˆç‡å¾ˆä½ã€‚4.leaf_sizeï¼šä»£è¡¨æ„é€  KD æ ‘æˆ–çƒæ ‘æ—¶çš„å¶å­æ•°ï¼Œé»˜è®¤æ˜¯ 30ï¼Œè°ƒæ•´ leaf_size ä¼šå½±å“åˆ°æ ‘çš„æ„é€ å’Œæœç´¢é€Ÿåº¦ã€‚åˆ›å»ºå®Œ KNN åˆ†ç±»å™¨ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¾“å…¥è®­ç»ƒé›†å¯¹å®ƒè¿›è¡Œè®­ç»ƒï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ fit() å‡½æ•°ï¼Œä¼ å…¥è®­ç»ƒé›†ä¸­çš„æ ·æœ¬ç‰¹å¾çŸ©é˜µå’Œåˆ†ç±»æ ‡è¯†ï¼Œä¼šè‡ªåŠ¨å¾—åˆ°è®­ç»ƒå¥½çš„ KNN åˆ†ç±»å™¨ã€‚ç„¶åå¯ä»¥ä½¿ç”¨ predict() å‡½æ•°æ¥å¯¹ç»“æœè¿›è¡Œé¢„æµ‹ï¼Œè¿™é‡Œä¼ å…¥æµ‹è¯•é›†çš„ç‰¹å¾çŸ©é˜µï¼Œå¯ä»¥å¾—åˆ°æµ‹è¯•é›†çš„é¢„æµ‹åˆ†ç±»ç»“æœã€‚å¦‚ä½•ç”¨ KNN å¯¹æ‰‹å†™æ•°å­—è¿›è¡Œè¯†åˆ«åˆ†ç±»æ‰‹å†™æ•°å­—æ•°æ®é›†æ˜¯ä¸ªéå¸¸æœ‰åçš„ç”¨äºå›¾åƒè¯†åˆ«çš„æ•°æ®é›†ã€‚æ•°å­—è¯†åˆ«çš„è¿‡ç¨‹å°±æ˜¯å°†è¿™äº›å›¾ç‰‡ä¸åˆ†ç±»ç»“æœ 0-9 ä¸€ä¸€å¯¹åº”èµ·æ¥ã€‚å®Œæ•´çš„æ‰‹å†™æ•°å­—æ•°æ®é›† MNIST é‡Œé¢åŒ…æ‹¬äº† 60000 ä¸ªè®­ç»ƒæ ·æœ¬ï¼Œä»¥åŠ 10000 ä¸ªæµ‹è¯•æ ·æœ¬ã€‚å¦‚æœä½ å­¦ä¹ æ·±åº¦å­¦ä¹ çš„è¯ï¼ŒMNIST åŸºæœ¬ä¸Šæ˜¯ä½ æ¥è§¦çš„ç¬¬ä¸€ä¸ªæ•°æ®é›†ã€‚ä»Šå¤©æˆ‘ä»¬ç”¨ sklearn è‡ªå¸¦çš„æ‰‹å†™æ•°å­—æ•°æ®é›†åš KNN åˆ†ç±»ï¼Œä½ å¯ä»¥æŠŠè¿™ä¸ªæ•°æ®é›†ç†è§£æˆä¸€ä¸ªç®€ç‰ˆçš„ MNIST æ•°æ®é›†ï¼Œå®ƒåªåŒ…æ‹¬äº† 1797 å¹…æ•°å­—å›¾åƒï¼Œæ¯å¹…å›¾åƒå¤§å°æ˜¯ 8*8 åƒç´ ã€‚å¥½äº†ï¼Œæˆ‘ä»¬å…ˆæ¥è§„åˆ’ä¸‹æ•´ä¸ª KNN åˆ†ç±»çš„æµç¨‹ï¼šæ•´ä¸ªè®­ç»ƒè¿‡ç¨‹åŸºæœ¬ä¸Šéƒ½ä¼šåŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µï¼šæ•°æ®åŠ è½½ï¼šæˆ‘ä»¬å¯ä»¥ç›´æ¥ä» sklearn ä¸­åŠ è½½è‡ªå¸¦çš„æ‰‹å†™æ•°å­—æ•°æ®é›†ï¼›å‡†å¤‡é˜¶æ®µï¼šåœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®é›†æœ‰ä¸ªåˆæ­¥çš„äº†è§£ï¼Œæ¯”å¦‚æ ·æœ¬çš„ä¸ªæ•°ã€å›¾åƒé•¿ä»€ä¹ˆæ ·ã€è¯†åˆ«ç»“æœæ˜¯æ€æ ·çš„ã€‚ä½ å¯ä»¥é€šè¿‡å¯è§†åŒ–çš„æ–¹å¼æ¥æŸ¥çœ‹å›¾åƒçš„å‘ˆç°ã€‚é€šè¿‡æ•°æ®è§„èŒƒåŒ–å¯ä»¥è®©æ•°æ®éƒ½åœ¨åŒä¸€ä¸ªæ•°é‡çº§çš„ç»´åº¦ã€‚å¦å¤–ï¼Œå› ä¸ºè®­ç»ƒé›†æ˜¯å›¾åƒï¼Œæ¯å¹…å›¾åƒæ˜¯ä¸ª 8*8 çš„çŸ©é˜µï¼Œæˆ‘ä»¬ä¸éœ€è¦å¯¹å®ƒè¿›è¡Œç‰¹å¾é€‰æ‹©ï¼Œå°†å…¨éƒ¨çš„å›¾åƒæ•°æ®ä½œä¸ºç‰¹å¾å€¼çŸ©é˜µå³å¯ï¼›åˆ†ç±»é˜¶æ®µï¼šé€šè¿‡è®­ç»ƒå¯ä»¥å¾—åˆ°åˆ†ç±»å™¨ï¼Œç„¶åç”¨æµ‹è¯•é›†è¿›è¡Œå‡†ç¡®ç‡çš„è®¡ç®—ã€‚å¥½äº†ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥å®ç°ä¸‹è¿™ä¸ªé¡¹ç›®ã€‚é¦–å…ˆæ˜¯åŠ è½½æ•°æ®å’Œå¯¹æ•°æ®çš„æ¢ç´¢ï¼š1234567891011121314# åŠ è½½æ•°æ®digits = load_digits()data = digits.data# æ•°æ®æ¢ç´¢print(data.shape)# æŸ¥çœ‹ç¬¬5å¹…å›¾åƒprint(digits.images[4])# ç¬¬5å¹…å›¾åƒä»£è¡¨çš„æ•°å­—å«ä¹‰print(digits.target[4])# å°†ç¬¬5å¹…å›¾åƒæ˜¾ç¤ºå‡ºæ¥plt.gray()plt.imshow(digits.images[4])plt.show()ç»“æœï¼š12345678910(1797, 64)[[ 0. 0. 0. 1. 11. 0. 0. 0.] [ 0. 0. 0. 7. 8. 0. 0. 0.] [ 0. 0. 1. 13. 6. 2. 2. 0.] [ 0. 0. 7. 15. 0. 9. 8. 0.] [ 0. 5. 16. 10. 0. 16. 6. 0.] [ 0. 4. 15. 16. 13. 16. 1. 0.] [ 0. 0. 0. 3. 15. 10. 0. 0.] [ 0. 0. 0. 2. 16. 4. 0. 0.]]4å¯¹åº”çš„æ‰‹å†™å›¾åƒæ•°æ®ï¼šæˆ‘ä»¬å¯¹åŸå§‹æ•°æ®é›†ä¸­çš„ç¬¬ä¸€å¹…è¿›è¡Œæ•°æ®å¯è§†åŒ–ï¼Œå¯ä»¥çœ‹åˆ°å›¾åƒæ˜¯ä¸ª 88 çš„åƒç´ çŸ©é˜µï¼Œä¸Šé¢è¿™å¹…å›¾åƒæ˜¯ä¸€ä¸ªâ€œ4â€ï¼Œä»è®­ç»ƒé›†çš„åˆ†ç±»æ ‡æ³¨ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°åˆ†ç±»æ ‡æ³¨ä¸ºâ€œ4â€ã€‚sklearn è‡ªå¸¦çš„æ‰‹å†™æ•°å­—æ•°æ®é›†ä¸€å…±åŒ…æ‹¬äº† 1797 ä¸ªæ ·æœ¬ï¼Œæ¯å¹…å›¾åƒéƒ½æ˜¯ 88 åƒç´ çš„çŸ©é˜µã€‚å› ä¸ºå¹¶æ²¡æœ‰ä¸“é—¨çš„æµ‹è¯•é›†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹æ•°æ®é›†åšåˆ’åˆ†ï¼Œåˆ’åˆ†æˆè®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚å› ä¸º KNN ç®—æ³•å’Œè·ç¦»å®šä¹‰ç›¸å…³ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®è¿›è¡Œè§„èŒƒåŒ–å¤„ç†ï¼Œé‡‡ç”¨ Z-Score è§„èŒƒåŒ–ï¼Œä»£ç å¦‚ä¸‹ï¼š1234567# åˆ†å‰²æ•°æ®ï¼Œå°†25%çš„æ•°æ®ä½œä¸ºæµ‹è¯•é›†ï¼Œå…¶ä½™ä½œä¸ºè®­ç»ƒé›†ï¼ˆä½ ä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–æ¯”ä¾‹çš„æ•°æ®ä½œä¸ºè®­ç»ƒé›†ï¼‰train_x, test_x, train_y, test_y = train_test_split(data, digits.target, test_size=0.25, random_state=33)# é‡‡ç”¨Z-Scoreè§„èŒƒåŒ–ss = preprocessing.StandardScaler()train_ss_x = ss.fit_transform(train_x)test_ss_x = ss.transform(test_x)æ³¨ï¼šä¸Šé¢ä»£ç ä¸­ï¼Œåœ¨trainçš„æ—¶å€™ç”¨åˆ°äº†ï¼štrain_ss_x = ss.fit_transform(train_x)å®é™…ä¸Šï¼šfit_transformæ˜¯fitå’Œtransformä¸¤ä¸ªå‡½æ•°éƒ½æ‰§è¡Œä¸€æ¬¡ã€‚æ‰€ä»¥ssæ˜¯è¿›è¡Œäº†fitæ‹Ÿåˆçš„ã€‚åªæœ‰åœ¨fitæ‹Ÿåˆä¹‹åï¼Œæ‰èƒ½è¿›è¡Œtransformï¼Œåœ¨è¿›è¡Œtestçš„æ—¶å€™ï¼Œæˆ‘ä»¬å·²ç»åœ¨trainçš„æ—¶å€™fitè¿‡äº†ï¼Œæ‰€ä»¥ç›´æ¥transformå³å¯ã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰fitï¼Œç›´æ¥è¿›è¡Œtransformä¼šæŠ¥é”™ï¼Œå› ä¸ºéœ€è¦å…ˆfitæ‹Ÿåˆï¼Œæ‰å¯ä»¥è¿›è¡Œtransformã€‚ç„¶åæˆ‘ä»¬æ„é€ ä¸€ä¸ª KNN åˆ†ç±»å™¨ knnï¼ŒæŠŠè®­ç»ƒé›†çš„æ•°æ®ä¼ å…¥æ„é€ å¥½çš„ knnï¼Œå¹¶é€šè¿‡æµ‹è¯•é›†è¿›è¡Œç»“æœé¢„æµ‹ï¼Œä¸æµ‹è¯•é›†çš„ç»“æœè¿›è¡Œå¯¹æ¯”ï¼Œå¾—åˆ° KNN åˆ†ç±»å™¨å‡†ç¡®ç‡ï¼Œä»£ç å¦‚ä¸‹ï¼š123456# åˆ›å»ºKNNåˆ†ç±»å™¨knn = KNeighborsClassifier() knn.fit(train_ss_x, train_y) predict_y = knn.predict(test_ss_x) print(\"KNNå‡†ç¡®ç‡: %.4lf\" % accuracy_score(test_y, predict_y))è¿è¡Œç»“æœï¼š12KNNå‡†ç¡®ç‡: 0.9756å¥½äº†ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ„é€ å¥½äº†ä¸€ä¸ª KNN åˆ†ç±»å™¨ã€‚ä¹‹å‰æˆ‘ä»¬è¿˜è®²è¿‡ SVMã€æœ´ç´ è´å¶æ–¯å’Œå†³ç­–æ ‘åˆ†ç±»ã€‚æˆ‘ä»¬ç”¨æ‰‹å†™æ•°å­—æ•°æ®é›†ä¸€èµ·æ¥è®­ç»ƒä¸‹è¿™äº›åˆ†ç±»å™¨ï¼Œç„¶åå¯¹æ¯”ä¸‹å“ªä¸ªåˆ†ç±»å™¨çš„æ•ˆæœæ›´å¥½ã€‚ä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617181920# åˆ›å»ºSVMåˆ†ç±»å™¨svm = SVC()svm.fit(train_ss_x, train_y)predict_y=svm.predict(test_ss_x)print('SVMå‡†ç¡®ç‡: %0.4lf' % accuracy_score(test_y, predict_y))# é‡‡ç”¨Min-Maxè§„èŒƒåŒ–mm = preprocessing.MinMaxScaler()train_mm_x = mm.fit_transform(train_x)test_mm_x = mm.transform(test_x)# åˆ›å»ºNaive Bayesåˆ†ç±»å™¨mnb = MultinomialNB()mnb.fit(train_mm_x, train_y) predict_y = mnb.predict(test_mm_x) print(\"å¤šé¡¹å¼æœ´ç´ è´å¶æ–¯å‡†ç¡®ç‡: %.4lf\" % accuracy_score(test_y, predict_y))# åˆ›å»ºCARTå†³ç­–æ ‘åˆ†ç±»å™¨dtc = DecisionTreeClassifier()dtc.fit(train_mm_x, train_y) predict_y = dtc.predict(test_mm_x) print(\"CARTå†³ç­–æ ‘å‡†ç¡®ç‡: %.4lf\" % accuracy_score(test_y, predict_y))ç»“æœï¼š1234SVMå‡†ç¡®ç‡: 0.9867å¤šé¡¹å¼æœ´ç´ è´å¶æ–¯å‡†ç¡®ç‡: 0.8844CARTå†³ç­–æ ‘å‡†ç¡®ç‡: 0.8556è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨åšå¤šé¡¹å¼æœ´ç´ è´å¶æ–¯åˆ†ç±»çš„æ—¶å€™ï¼Œä¼ å…¥çš„æ•°æ®ä¸èƒ½æœ‰è´Ÿæ•°ã€‚å› ä¸º Z-Score ä¼šå°†æ•°å€¼è§„èŒƒåŒ–ä¸ºä¸€ä¸ªæ ‡å‡†çš„æ­£æ€åˆ†å¸ƒï¼Œå³å‡å€¼ä¸º 0ï¼Œæ–¹å·®ä¸º 1ï¼Œæ•°å€¼ä¼šåŒ…å«è´Ÿæ•°ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦é‡‡ç”¨ Min-Max è§„èŒƒåŒ–ï¼Œå°†æ•°æ®è§„èŒƒåŒ–åˆ°[0,1]èŒƒå›´å†…ã€‚ä½ èƒ½çœ‹å‡ºæ¥ KNN çš„å‡†ç¡®ç‡è¿˜æ˜¯ä¸é”™çš„ï¼Œå’Œ SVM ä¸ç›¸ä¸Šä¸‹ã€‚å®Œæ•´ä»£ç ï¼š123456789101112131415161718192021222324252627282930313233343536373839# -*- coding: utf-8 -*-# æ‰‹å†™æ•°å­—åˆ†ç±»from sklearn.model_selection import train_test_splitfrom sklearn import preprocessingfrom sklearn.metrics import accuracy_scorefrom sklearn.datasets import load_digitsfrom sklearn.neighbors import KNeighborsClassifierfrom sklearn.svm import SVCfrom sklearn.naive_bayes import MultinomialNBfrom sklearn.tree import DecisionTreeClassifierimport matplotlib.pyplot as plt# åŠ è½½æ•°æ®digits = load_digits()data = digits.data# æ•°æ®æ¢ç´¢print(data.shape)# æŸ¥çœ‹ç¬¬ä¸€å¹…å›¾åƒprint(digits.images[0])# ç¬¬ä¸€å¹…å›¾åƒä»£è¡¨çš„æ•°å­—å«ä¹‰print(digits.target[0])# å°†ç¬¬ä¸€å¹…å›¾åƒæ˜¾ç¤ºå‡ºæ¥plt.gray()plt.imshow(digits.images[0])plt.show()# åˆ†å‰²æ•°æ®ï¼Œå°†25%çš„æ•°æ®ä½œä¸ºæµ‹è¯•é›†ï¼Œå…¶ä½™ä½œä¸ºè®­ç»ƒé›†train_x, test_x, train_y, test_y = train_test_split(data, digits.target, test_size=0.25, random_state=33)# é‡‡ç”¨Z-Scoreè§„èŒƒåŒ–ss = preprocessing.StandardScaler()train_ss_x = ss.fit_transform(train_x)test_ss_x = ss.transform(test_x)# åˆ›å»ºKNNåˆ†ç±»å™¨knn = KNeighborsClassifier()knn.fit(train_ss_x, train_y) predict_y = knn.predict(test_ss_x) print(\"KNNå‡†ç¡®ç‡: %.4lf\" % accuracy_score(test_y, predict_y))æ€»ç»“æ‰‹å†™æ•°å­—åˆ†ç±»è¯†åˆ«çš„å®æˆ˜ï¼Œåˆ†åˆ«ç”¨ KNNã€SVMã€æœ´ç´ è´å¶æ–¯å’Œå†³ç­–æ ‘åšåˆ†ç±»å™¨ï¼Œå¹¶ç»Ÿè®¡äº†å››ä¸ªåˆ†ç±»å™¨çš„å‡†ç¡®ç‡ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä½ åº”è¯¥å¯¹æ•°æ®æ¢ç´¢ã€æ•°æ®å¯è§†åŒ–ã€æ•°æ®è§„èŒƒåŒ–ã€æ¨¡å‹è®­ç»ƒå’Œç»“æœè¯„ä¼°çš„ä½¿ç”¨è¿‡ç¨‹æœ‰äº†ä¸€å®šçš„ä½“ä¼šã€‚åœ¨æ•°æ®é‡ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ sklearn è¿˜æ˜¯æ–¹ä¾¿çš„ã€‚å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œæ¯”å¦‚ MNIST æ•°æ®é›†ä¸­çš„ 6 ä¸‡ä¸ªè®­ç»ƒæ•°æ®å’Œ 1 ä¸‡ä¸ªæµ‹è¯•æ•°æ®ï¼Œé‚£ä¹ˆé‡‡ç”¨æ·±åº¦å­¦ä¹  +GPU è¿ç®—çš„æ–¹å¼ä¼šæ›´é€‚åˆã€‚å› ä¸ºæ·±åº¦å­¦ä¹ çš„ç‰¹ç‚¹å°±æ˜¯éœ€è¦å¤§é‡å¹¶è¡Œçš„é‡å¤è®¡ç®—ï¼ŒGPU æœ€æ“…é•¿çš„å°±æ˜¯åšå¤§é‡çš„å¹¶è¡Œè®¡ç®—ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"KNN","slug":"KNN","permalink":"cpeixin.cn/tags/KNN/"}]},{"title":"æ•°æ®åˆ†æ-KNN_1","slug":"æ•°æ®åˆ†æ-KNN-1","date":"2018-07-25T16:14:49.000Z","updated":"2020-05-01T14:14:47.958Z","comments":true,"path":"2018/07/26/æ•°æ®åˆ†æ-KNN-1/","link":"","permalink":"cpeixin.cn/2018/07/26/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-KNN-1/","excerpt":"","text":"æ•°æ®åˆ†æ - KNN åŸç†KNN çš„è‹±æ–‡å« K-Nearest Neighborï¼Œåº”è¯¥ç®—æ˜¯æ•°æ®æŒ–æ˜ç®—æ³•ä¸­æœ€ç®€å•çš„ä¸€ç§ã€‚æˆ‘ä»¬å…ˆç”¨ä¸€ä¸ªä¾‹å­ä½“ä¼šä¸‹ã€‚å‡è®¾ï¼Œæˆ‘ä»¬æƒ³å¯¹ç”µå½±çš„ç±»å‹è¿›è¡Œåˆ†ç±»ï¼Œç»Ÿè®¡äº†ç”µå½±ä¸­æ‰“æ–—æ¬¡æ•°ã€æ¥å»æ¬¡æ•°ï¼Œå½“ç„¶è¿˜æœ‰å…¶ä»–çš„æŒ‡æ ‡ä¹Ÿå¯ä»¥è¢«ç»Ÿè®¡åˆ°ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“ç†è§£ã€Šæˆ˜ç‹¼ã€‹ã€Šçº¢æµ·è¡ŒåŠ¨ã€‹ã€Šç¢Ÿä¸­è° 6ã€‹æ˜¯åŠ¨ä½œç‰‡ï¼Œã€Šå‰ä»» 3ã€‹ã€Šæ˜¥å¨‡æ•‘å¿—æ˜ã€‹ã€Šæ³°å¦å°¼å…‹å·ã€‹æ˜¯çˆ±æƒ…ç‰‡ï¼Œä½†æ˜¯æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•è®©æœºå™¨ä¹Ÿå¯ä»¥æŒæ¡è¿™ä¸ªåˆ†ç±»çš„è§„åˆ™ï¼Œå½“æœ‰ä¸€éƒ¨æ–°ç”µå½±çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥å¯¹å®ƒçš„ç±»å‹è‡ªåŠ¨åˆ†ç±»å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠæ‰“æ–—æ¬¡æ•°çœ‹æˆ X è½´ï¼Œæ¥å»æ¬¡æ•°çœ‹æˆ Y è½´ï¼Œç„¶ååœ¨äºŒç»´çš„åæ ‡è½´ä¸Šï¼Œå¯¹è¿™å‡ éƒ¨ç”µå½±è¿›è¡Œæ ‡è®°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å¯¹äºæœªçŸ¥çš„ç”µå½± Aï¼Œåæ ‡ä¸º (x,y)ï¼Œæˆ‘ä»¬éœ€è¦çœ‹ä¸‹ç¦»ç”µå½± A æœ€è¿‘çš„éƒ½æœ‰å“ªäº›ç”µå½±ï¼Œè¿™äº›ç”µå½±ä¸­çš„å¤§å¤šæ•°å±äºå“ªä¸ªåˆ†ç±»ï¼Œé‚£ä¹ˆç”µå½± A å°±å±äºå“ªä¸ªåˆ†ç±»ã€‚å®é™…æ“ä½œä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç¡®å®šä¸€ä¸ª K å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦è§‚å¯Ÿç¦»ç”µå½± A æœ€è¿‘çš„ç”µå½±æœ‰å¤šå°‘ä¸ªã€‚KNN çš„å·¥ä½œåŸç†â€œè¿‘æœ±è€…èµ¤ï¼Œè¿‘å¢¨è€…é»‘â€å¯ä»¥è¯´æ˜¯ KNN çš„å·¥ä½œåŸç†ã€‚æ•´ä¸ªè®¡ç®—è¿‡ç¨‹åˆ†ä¸ºä¸‰æ­¥ï¼šè®¡ç®—å¾…åˆ†ç±»ç‰©ä½“ä¸å…¶ä»–ç‰©ä½“ä¹‹é—´çš„è·ç¦»ï¼›ç»Ÿè®¡è·ç¦»æœ€è¿‘çš„ K ä¸ªé‚»å±…ï¼›å¯¹äº K ä¸ªæœ€è¿‘çš„é‚»å±…ï¼Œå®ƒä»¬å±äºå“ªä¸ªåˆ†ç±»æœ€å¤šï¼Œå¾…åˆ†ç±»ç‰©ä½“å°±å±äºå“ªä¸€ç±»ã€‚K å€¼å¦‚ä½•é€‰æ‹©ä½ èƒ½çœ‹å‡ºæ•´ä¸ª KNN çš„åˆ†ç±»è¿‡ç¨‹ï¼ŒK å€¼çš„é€‰æ‹©è¿˜æ˜¯å¾ˆé‡è¦çš„ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒK å€¼é€‰æ‹©å¤šå°‘æ˜¯é€‚åˆçš„å‘¢ï¼Ÿå¦‚æœ K å€¼æ¯”è¾ƒå°ï¼Œå°±ç›¸å½“äºæœªåˆ†ç±»ç‰©ä½“ä¸å®ƒçš„é‚»å±…éå¸¸æ¥è¿‘æ‰è¡Œã€‚è¿™æ ·äº§ç”Ÿçš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå¦‚æœé‚»å±…ç‚¹æ˜¯ä¸ªå™ªå£°ç‚¹ï¼Œé‚£ä¹ˆæœªåˆ†ç±»ç‰©ä½“çš„åˆ†ç±»ä¹Ÿä¼šäº§ç”Ÿè¯¯å·®ï¼Œè¿™æ · KNN åˆ†ç±»å°±ä¼šäº§ç”Ÿè¿‡æ‹Ÿåˆã€‚å¦‚æœ K å€¼æ¯”è¾ƒå¤§ï¼Œç›¸å½“äºè·ç¦»è¿‡è¿œçš„ç‚¹ä¹Ÿä¼šå¯¹æœªçŸ¥ç‰©ä½“çš„åˆ†ç±»äº§ç”Ÿå½±å“ï¼Œè™½ç„¶è¿™ç§æƒ…å†µçš„å¥½å¤„æ˜¯é²æ£’æ€§å¼ºï¼Œä½†æ˜¯ä¸è¶³ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œä¼šäº§ç”Ÿæ¬ æ‹Ÿåˆæƒ…å†µï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æŠŠæœªåˆ†ç±»ç‰©ä½“çœŸæ­£åˆ†ç±»å‡ºæ¥ã€‚æ‰€ä»¥ K å€¼åº”è¯¥æ˜¯ä¸ªå®è·µå‡ºæ¥çš„ç»“æœï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬äº‹å…ˆè€Œå®šçš„ã€‚åœ¨å·¥ç¨‹ä¸Šï¼Œæˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨äº¤å‰éªŒè¯çš„æ–¹å¼é€‰å– K å€¼ã€‚äº¤å‰éªŒè¯çš„æ€è·¯å°±æ˜¯ï¼ŒæŠŠæ ·æœ¬é›†ä¸­çš„å¤§éƒ¨åˆ†æ ·æœ¬ä½œä¸ºè®­ç»ƒé›†ï¼Œå‰©ä½™çš„å°éƒ¨åˆ†æ ·æœ¬ç”¨äºé¢„æµ‹ï¼Œæ¥éªŒè¯åˆ†ç±»æ¨¡å‹çš„å‡†ç¡®æ€§ã€‚æ‰€ä»¥åœ¨ KNN ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠ K å€¼é€‰å–åœ¨è¾ƒå°çš„èŒƒå›´å†…ï¼ŒåŒæ—¶åœ¨éªŒè¯é›†ä¸Šå‡†ç¡®ç‡æœ€é«˜çš„é‚£ä¸€ä¸ªæœ€ç»ˆç¡®å®šä½œä¸º K å€¼ã€‚è·ç¦»å¦‚ä½•è®¡ç®—åœ¨ KNNç®—æ³•ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„è®¡ç®—å°±æ˜¯å…³äºè·ç¦»çš„åº¦é‡ã€‚ä¸¤ä¸ªæ ·æœ¬ç‚¹ä¹‹é—´çš„è·ç¦»ä»£è¡¨äº†è¿™ä¸¤ä¸ªæ ·æœ¬ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚è·ç¦»è¶Šå¤§ï¼Œå·®å¼‚æ€§è¶Šå¤§ï¼›è·ç¦»è¶Šå°ï¼Œç›¸ä¼¼åº¦è¶Šå¤§ã€‚å…³äºè·ç¦»çš„è®¡ç®—æ–¹å¼æœ‰ä¸‹é¢äº”ç§æ–¹å¼ï¼šæ¬§æ°è·ç¦»ï¼›æ›¼å“ˆé¡¿è·ç¦»ï¼›é—µå¯å¤«æ–¯åŸºè·ç¦»ï¼›åˆ‡æ¯”é›ªå¤«è·ç¦»ï¼›ä½™å¼¦è·ç¦»ã€‚å…¶ä¸­å‰ä¸‰ç§è·ç¦»æ˜¯ KNN ä¸­æœ€å¸¸ç”¨çš„è·ç¦»ï¼Œæˆ‘ç»™ä½ åˆ†åˆ«è®²è§£ä¸‹ã€‚æ¬§æ°è·ç¦»æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„è·ç¦»å…¬å¼ï¼Œä¹Ÿå«åšæ¬§å‡ é‡Œå¾—è·ç¦»ã€‚åœ¨äºŒç»´ç©ºé—´ä¸­ï¼Œä¸¤ç‚¹çš„æ¬§å¼è·ç¦»å°±æ˜¯ï¼šåŒç†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ±‚å¾—ä¸¤ç‚¹åœ¨ n ç»´ç©ºé—´ä¸­çš„è·ç¦»ï¼šæ›¼å“ˆé¡¿è·ç¦»åœ¨å‡ ä½•ç©ºé—´ä¸­ç”¨çš„æ¯”è¾ƒå¤šã€‚ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼Œç»¿è‰²çš„ç›´çº¿ä»£è¡¨ä¸¤ç‚¹ä¹‹é—´çš„æ¬§å¼è·ç¦»ï¼Œè€Œçº¢è‰²å’Œé»„è‰²çš„çº¿ä¸ºä¸¤ç‚¹çš„æ›¼å“ˆé¡¿è·ç¦»ã€‚æ‰€ä»¥æ›¼å“ˆé¡¿è·ç¦»ç­‰äºä¸¤ä¸ªç‚¹åœ¨åæ ‡ç³»ä¸Šç»å¯¹è½´è·æ€»å’Œã€‚ç”¨å…¬å¼è¡¨ç¤ºå°±æ˜¯ï¼šé—µå¯å¤«æ–¯åŸºè·ç¦»ä¸æ˜¯ä¸€ä¸ªè·ç¦»ï¼Œè€Œæ˜¯ä¸€ç»„è·ç¦»çš„å®šä¹‰ã€‚å¯¹äº n ç»´ç©ºé—´ä¸­çš„ä¸¤ä¸ªç‚¹ x(x1,x2,â€¦,xn) å’Œ y(y1,y2,â€¦,yn) ï¼Œ x å’Œ y ä¸¤ç‚¹ä¹‹é—´çš„é—µå¯å¤«æ–¯åŸºè·ç¦»ä¸ºï¼šå…¶ä¸­ p ä»£è¡¨ç©ºé—´çš„ç»´æ•°ï¼Œå½“ p=1 æ—¶ï¼Œå°±æ˜¯æ›¼å“ˆé¡¿è·ç¦»ï¼›å½“ p=2 æ—¶ï¼Œå°±æ˜¯æ¬§æ°è·ç¦»ï¼›å½“ pâ†’âˆæ—¶ï¼Œå°±æ˜¯åˆ‡æ¯”é›ªå¤«è·ç¦»ã€‚é‚£ä¹ˆåˆ‡æ¯”é›ªå¤«è·ç¦»æ€ä¹ˆè®¡ç®—å‘¢ï¼ŸäºŒä¸ªç‚¹ä¹‹é—´çš„åˆ‡æ¯”é›ªå¤«è·ç¦»å°±æ˜¯è¿™ä¸¤ä¸ªç‚¹åæ ‡æ•°å€¼å·®çš„ç»å¯¹å€¼çš„æœ€å¤§å€¼ï¼Œç”¨æ•°å­¦è¡¨ç¤ºå°±æ˜¯ï¼šmax(|x1-y1|,|x2-y2|)ã€‚å…¶å…¬å¼ä¸ºpä¸ºæé™æ— ç©·çš„æƒ…å†µï¼šä½™å¼¦è·ç¦»å®é™…ä¸Šè®¡ç®—çš„æ˜¯ä¸¤ä¸ªå‘é‡çš„å¤¹è§’ï¼Œæ˜¯åœ¨æ–¹å‘ä¸Šè®¡ç®—ä¸¤è€…ä¹‹é—´çš„å·®å¼‚ï¼Œå¯¹ç»å¯¹æ•°å€¼ä¸æ•æ„Ÿã€‚åœ¨å…´è¶£ç›¸å…³æ€§æ¯”è¾ƒä¸Šï¼Œè§’åº¦å…³ç³»æ¯”è·ç¦»çš„ç»å¯¹å€¼æ›´é‡è¦ï¼Œå› æ­¤ä½™å¼¦è·ç¦»å¯ä»¥ç”¨äºè¡¡é‡ç”¨æˆ·å¯¹å†…å®¹å…´è¶£çš„åŒºåˆ†åº¦ã€‚æ¯”å¦‚æˆ‘ä»¬ç”¨æœç´¢å¼•æ“æœç´¢æŸä¸ªå…³é”®è¯ï¼Œå®ƒè¿˜ä¼šç»™ä½ æ¨èå…¶ä»–çš„ç›¸å…³æœç´¢ï¼Œè¿™äº›æ¨èçš„å…³é”®è¯å°±æ˜¯é‡‡ç”¨ä½™å¼¦è·ç¦»è®¡ç®—å¾—å‡ºçš„ã€‚KD æ ‘å…¶å®ä»ä¸Šæ–‡ä½ ä¹Ÿèƒ½çœ‹å‡ºæ¥ï¼ŒKNN çš„è®¡ç®—è¿‡ç¨‹æ˜¯å¤§é‡è®¡ç®—æ ·æœ¬ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚ä¸ºäº†å‡å°‘è®¡ç®—è·ç¦»æ¬¡æ•°ï¼Œæå‡ KNN çš„æœç´¢æ•ˆç‡ï¼Œäººä»¬æå‡ºäº† KD æ ‘ï¼ˆK-Dimensional çš„ç¼©å†™ï¼‰ã€‚KD æ ‘æ˜¯å¯¹æ•°æ®ç‚¹åœ¨ K ç»´ç©ºé—´ä¸­åˆ’åˆ†çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚åœ¨ KD æ ‘çš„æ„é€ ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ k ç»´æ•°å€¼ç‚¹çš„äºŒå‰æ ‘ã€‚æ—¢ç„¶æ˜¯äºŒå‰æ ‘ï¼Œå°±å¯ä»¥é‡‡ç”¨äºŒå‰æ ‘çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œè¿™æ ·å°±å¤§å¤§æå‡äº†æœç´¢æ•ˆç‡ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸éœ€è¦å¯¹ KD æ ‘çš„æ•°å­¦åŸç†äº†è§£å¤ªå¤šï¼Œä½ åªéœ€è¦çŸ¥é“å®ƒæ˜¯ä¸€ä¸ªäºŒå‰æ ‘çš„æ•°æ®ç»“æ„ï¼Œæ–¹ä¾¿å­˜å‚¨ K ç»´ç©ºé—´çš„æ•°æ®å°±å¯ä»¥äº†ã€‚è€Œä¸”åœ¨ sklearn ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥å¯ä»¥è°ƒç”¨ KD æ ‘ï¼Œå¾ˆæ–¹ä¾¿ã€‚ç”¨ KNN åšå›å½’KNN ä¸ä»…å¯ä»¥åšåˆ†ç±»ï¼Œè¿˜å¯ä»¥åšå›å½’ã€‚é¦–å…ˆè®²ä¸‹ä»€ä¹ˆæ˜¯å›å½’ã€‚åœ¨å¼€å¤´ç”µå½±è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œå¦‚æœæƒ³è¦å¯¹æœªçŸ¥ç”µå½±è¿›è¡Œç±»å‹åˆ’åˆ†ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆ†ç±»é—®é¢˜ã€‚é¦–å…ˆçœ‹ä¸€ä¸‹è¦åˆ†ç±»çš„æœªçŸ¥ç”µå½±ï¼Œç¦»å®ƒæœ€è¿‘çš„ K éƒ¨ç”µå½±å¤§å¤šæ•°å±äºå“ªä¸ªåˆ†ç±»ï¼Œè¿™éƒ¨ç”µå½±å°±å±äºå“ªä¸ªåˆ†ç±»ã€‚å¦‚æœæ˜¯ä¸€éƒ¨æ–°ç”µå½±ï¼Œå·²çŸ¥å®ƒæ˜¯çˆ±æƒ…ç‰‡ï¼Œæƒ³è¦çŸ¥é“å®ƒçš„æ‰“æ–—æ¬¡æ•°ã€æ¥å»æ¬¡æ•°å¯èƒ½æ˜¯å¤šå°‘ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå›å½’é—®é¢˜ã€‚é‚£ä¹ˆ KNN å¦‚ä½•åšå›å½’å‘¢ï¼Ÿå¯¹äºä¸€ä¸ªæ–°ç”µå½± Xï¼Œæˆ‘ä»¬è¦é¢„æµ‹å®ƒçš„æŸä¸ªå±æ€§å€¼ï¼Œæ¯”å¦‚æ‰“æ–—æ¬¡æ•°ï¼Œå…·ä½“ç‰¹å¾å±æ€§å’Œæ•°å€¼å¦‚ä¸‹æ‰€ç¤ºã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬ä¼šå…ˆè®¡ç®—å¾…æµ‹ç‚¹ï¼ˆæ–°ç”µå½± Xï¼‰åˆ°å·²çŸ¥ç‚¹çš„è·ç¦»ï¼Œé€‰æ‹©è·ç¦»æœ€è¿‘çš„ K ä¸ªç‚¹ã€‚å‡è®¾ K=3ï¼Œæ­¤æ—¶æœ€è¿‘çš„ 3 ä¸ªç‚¹ï¼ˆç”µå½±ï¼‰åˆ†åˆ«æ˜¯ã€Šæˆ˜ç‹¼ã€‹ï¼Œã€Šçº¢æµ·è¡ŒåŠ¨ã€‹å’Œã€Šç¢Ÿä¸­è° 6ã€‹ï¼Œé‚£ä¹ˆå®ƒçš„æ‰“æ–—æ¬¡æ•°å°±æ˜¯è¿™ 3 ä¸ªç‚¹çš„è¯¥å±æ€§å€¼çš„å¹³å‡å€¼ï¼Œå³ (100+95+105)/3=100 æ¬¡ã€‚æ€»ç»“ä»Šå¤©æˆ‘ç»™ä½ è®²äº† KNN çš„åŸç†ï¼Œä»¥åŠ KNN ä¸­çš„å‡ ä¸ªå…³é”®å› ç´ ã€‚æ¯”å¦‚é’ˆå¯¹ K å€¼çš„é€‰æ‹©ï¼Œæˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨äº¤å‰éªŒè¯çš„æ–¹å¼å¾—å‡ºã€‚é’ˆå¯¹æ ·æœ¬ç‚¹ä¹‹é—´çš„è·ç¦»çš„å®šä¹‰ï¼Œå¸¸ç”¨çš„æœ‰ 5 ç§è¡¨è¾¾æ–¹å¼ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±æ¥å®šä¹‰ä¸¤ä¸ªæ ·æœ¬ä¹‹é—´çš„è·ç¦»å…¬å¼ã€‚ä¸åŒçš„å®šä¹‰ï¼Œé€‚ç”¨çš„åœºæ™¯ä¸åŒã€‚æ¯”å¦‚åœ¨æœç´¢å…³é”®è¯æ¨èä¸­ï¼Œä½™å¼¦è·ç¦»æ˜¯æ›´ä¸ºå¸¸ç”¨çš„ã€‚å¦å¤–ä½ ä¹Ÿå¯ä»¥ç”¨ KNN è¿›è¡Œå›å½’ï¼Œé€šè¿‡ K ä¸ªé‚»å±…å¯¹æ–°çš„ç‚¹çš„å±æ€§è¿›è¡Œå€¼çš„é¢„æµ‹ã€‚KNN çš„ç†è®ºç®€å•ç›´æ¥ï¼Œé’ˆå¯¹ KNN ä¸­çš„æœç´¢ä¹Ÿæœ‰ç›¸åº”çš„ KD æ ‘è¿™ä¸ªæ•°æ®ç»“æ„ã€‚KNN çš„ç†è®ºæˆç†Ÿï¼Œå¯ä»¥åº”ç”¨åˆ°çº¿æ€§å’Œéçº¿æ€§çš„åˆ†ç±»é—®é¢˜ä¸­ï¼Œä¹Ÿå¯ä»¥ç”¨äºå›å½’åˆ†æã€‚ä¸è¿‡ KNN éœ€è¦è®¡ç®—æµ‹è¯•ç‚¹ä¸æ ·æœ¬ç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œå½“æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œè®¡ç®—é‡æ˜¯éå¸¸åºå¤§çš„ï¼Œéœ€è¦å¤§é‡çš„å­˜å‚¨ç©ºé—´å’Œè®¡ç®—æ—¶é—´ã€‚å¦å¤–å¦‚æœæ ·æœ¬åˆ†ç±»ä¸å‡è¡¡ï¼Œæ¯”å¦‚æœ‰äº›åˆ†ç±»çš„æ ·æœ¬éå¸¸å°‘ï¼Œé‚£ä¹ˆè¯¥ç±»åˆ«çš„åˆ†ç±»å‡†ç¡®ç‡å°±ä¼šä½å¾ˆå¤šã€‚å½“ç„¶åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘åˆ°å„ç§å¯èƒ½å­˜åœ¨çš„æƒ…å†µï¼Œæ¯”å¦‚é’ˆå¯¹æŸç±»æ ·æœ¬å°‘çš„æƒ…å†µï¼Œå¯ä»¥å¢åŠ è¯¥ç±»åˆ«çš„æƒé‡ã€‚åŒæ · KNN ä¹Ÿå¯ä»¥ç”¨äºæ¨èç®—æ³•ï¼Œè™½ç„¶ç°åœ¨å¾ˆå¤šæ¨èç³»ç»Ÿçš„ç®—æ³•ä¼šä½¿ç”¨ TD-IDFã€ååŒè¿‡æ»¤ã€Apriori ç®—æ³•ï¼Œä¸è¿‡é’ˆå¯¹æ•°æ®é‡ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œé‡‡ç”¨ KNN ä½œä¸ºæ¨èç®—æ³•ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"KNN","slug":"KNN","permalink":"cpeixin.cn/tags/KNN/"}]},{"title":"æ•°æ®åˆ†æ-SVM_2","slug":"æ•°æ®åˆ†æ-SVM-2","date":"2018-07-25T12:27:13.000Z","updated":"2020-05-01T14:14:15.085Z","comments":true,"path":"2018/07/25/æ•°æ®åˆ†æ-SVM-2/","link":"","permalink":"cpeixin.cn/2018/07/25/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-SVM-2/","excerpt":"","text":"SVM æ˜¯æœ‰ç›‘ç£çš„å­¦ä¹ æ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦äº‹å…ˆå¯¹æ•°æ®æ‰“ä¸Šåˆ†ç±»æ ‡ç­¾ï¼Œé€šè¿‡æ±‚è§£æœ€å¤§åˆ†ç±»é—´éš”æ¥æ±‚è§£äºŒåˆ†ç±»é—®é¢˜ã€‚å¦‚æœè¦æ±‚è§£å¤šåˆ†ç±»é—®é¢˜ï¼Œå¯ä»¥å°†å¤šä¸ªäºŒåˆ†ç±»å™¨ç»„åˆèµ·æ¥å½¢æˆä¸€ä¸ªå¤šåˆ†ç±»å™¨ã€‚sklearn ä¸­ä½¿ç”¨ SVMåœ¨ Python çš„ sklearn å·¥å…·åŒ…ä¸­æœ‰ SVM ç®—æ³•ï¼Œé¦–å…ˆéœ€è¦å¼•ç”¨å·¥å…·åŒ…ï¼š1from sklearn import svmSVM æ—¢å¯ä»¥åšå›å½’ï¼Œä¹Ÿå¯ä»¥åšåˆ†ç±»å™¨ã€‚å½“ç”¨ SVM åšå›å½’çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SVR æˆ– LinearSVRã€‚SVR çš„è‹±æ–‡æ˜¯ Support Vector Regressionã€‚è¿™ç¯‡æ–‡ç« åªè®²åˆ†ç±»ï¼Œè¿™é‡Œåªæ˜¯ç®€å•åœ°æä¸€ä¸‹ã€‚å½“åšåˆ†ç±»å™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ SVC æˆ–è€… LinearSVCã€‚SVC çš„è‹±æ–‡æ˜¯ Support Vector Classificationã€‚æˆ‘ç®€å•è¯´ä¸€ä¸‹è¿™ä¸¤è€…ä¹‹å‰çš„å·®åˆ«ã€‚ä»åå­—ä¸Šä½ èƒ½çœ‹å‡º LinearSVC æ˜¯ä¸ªçº¿æ€§åˆ†ç±»å™¨ï¼Œç”¨äºå¤„ç†çº¿æ€§å¯åˆ†çš„æ•°æ®ï¼Œåªèƒ½ä½¿ç”¨çº¿æ€§æ ¸å‡½æ•°ã€‚ä¸Šä¸€èŠ‚ï¼Œæˆ‘è®²åˆ° SVM æ˜¯é€šè¿‡æ ¸å‡½æ•°å°†æ ·æœ¬ä»åŸå§‹ç©ºé—´æ˜ å°„åˆ°ä¸€ä¸ªæ›´é«˜ç»´çš„ç‰¹è´¨ç©ºé—´ä¸­ï¼Œè¿™æ ·å°±ä½¿å¾—æ ·æœ¬åœ¨æ–°çš„ç©ºé—´ä¸­çº¿æ€§å¯åˆ†ã€‚å¦‚æœæ˜¯é’ˆå¯¹éçº¿æ€§çš„æ•°æ®ï¼Œéœ€è¦ç”¨åˆ° SVCã€‚åœ¨ SVC ä¸­ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥ä½¿ç”¨åˆ°çº¿æ€§æ ¸å‡½æ•°ï¼ˆè¿›è¡Œçº¿æ€§åˆ’åˆ†ï¼‰ï¼Œä¹Ÿèƒ½ä½¿ç”¨é«˜ç»´çš„æ ¸å‡½æ•°ï¼ˆè¿›è¡Œéçº¿æ€§åˆ’åˆ†ï¼‰ã€‚åˆ›å»ºä¸€ä¸ª SVM åˆ†ç±»å™¨æˆ‘ä»¬é¦–å…ˆä½¿ç”¨ SVC çš„æ„é€ å‡½æ•°ï¼š1model = svm.SVC(kernel=â€˜rbfâ€™, C=1.0, gamma=â€˜autoâ€™)è¿™é‡Œæœ‰ä¸‰ä¸ªé‡è¦çš„å‚æ•° kernelã€C å’Œ gammaã€‚kernel ä»£è¡¨æ ¸å‡½æ•°çš„é€‰æ‹©ï¼Œå®ƒæœ‰å››ç§é€‰æ‹©ï¼Œåªä¸è¿‡é»˜è®¤æ˜¯ rbfï¼Œå³é«˜æ–¯æ ¸å‡½æ•°ã€‚linearï¼šçº¿æ€§æ ¸å‡½æ•°polyï¼šå¤šé¡¹å¼æ ¸å‡½æ•°rbfï¼šé«˜æ–¯æ ¸å‡½æ•°ï¼ˆé»˜è®¤ï¼‰sigmoidï¼šsigmoid æ ¸å‡½æ•°è¿™å››ç§å‡½æ•°ä»£è¡¨ä¸åŒçš„æ˜ å°„æ–¹å¼ï¼Œä½ å¯èƒ½ä¼šé—®ï¼Œåœ¨å®é™…å·¥ä½œä¸­ï¼Œå¦‚ä½•é€‰æ‹©è¿™ 4 ç§æ ¸å‡½æ•°å‘¢ï¼Ÿæˆ‘æ¥ç»™ä½ è§£é‡Šä¸€ä¸‹ï¼šçº¿æ€§æ ¸å‡½æ•°ï¼Œæ˜¯åœ¨æ•°æ®çº¿æ€§å¯åˆ†çš„æƒ…å†µä¸‹ä½¿ç”¨çš„ï¼Œè¿ç®—é€Ÿåº¦å¿«ï¼Œæ•ˆæœå¥½ã€‚ä¸è¶³åœ¨äºå®ƒä¸èƒ½å¤„ç†çº¿æ€§ä¸å¯åˆ†çš„æ•°æ®ã€‚å¤šé¡¹å¼æ ¸å‡½æ•°å¯ä»¥å°†æ•°æ®ä»ä½ç»´ç©ºé—´æ˜ å°„åˆ°é«˜ç»´ç©ºé—´ï¼Œä½†å‚æ•°æ¯”è¾ƒå¤šï¼Œè®¡ç®—é‡å¤§ã€‚é«˜æ–¯æ ¸å‡½æ•°åŒæ ·å¯ä»¥å°†æ ·æœ¬æ˜ å°„åˆ°é«˜ç»´ç©ºé—´ï¼Œä½†ç›¸æ¯”äºå¤šé¡¹å¼æ ¸å‡½æ•°æ¥è¯´æ‰€éœ€çš„å‚æ•°æ¯”è¾ƒå°‘ï¼Œé€šå¸¸æ€§èƒ½ä¸é”™ï¼Œæ‰€ä»¥æ˜¯é»˜è®¤ä½¿ç”¨çš„æ ¸å‡½æ•°ã€‚äº†è§£æ·±åº¦å­¦ä¹ çš„åŒå­¦åº”è¯¥çŸ¥é“ sigmoid ç»å¸¸ç”¨åœ¨ç¥ç»ç½‘ç»œçš„æ˜ å°„ä¸­ã€‚å› æ­¤å½“é€‰ç”¨ sigmoid æ ¸å‡½æ•°æ—¶ï¼ŒSVM å®ç°çš„æ˜¯å¤šå±‚ç¥ç»ç½‘ç»œã€‚ä¸Šé¢ä»‹ç»çš„ 4 ç§æ ¸å‡½æ•°ï¼Œé™¤äº†ç¬¬ä¸€ç§çº¿æ€§æ ¸å‡½æ•°å¤–ï¼Œå…¶ä½™ 3 ç§éƒ½å¯ä»¥å¤„ç†çº¿æ€§ä¸å¯åˆ†çš„æ•°æ®ã€‚å‚æ•° C ä»£è¡¨ç›®æ ‡å‡½æ•°çš„æƒ©ç½šç³»æ•°ï¼Œæƒ©ç½šç³»æ•°æŒ‡çš„æ˜¯åˆ†é”™æ ·æœ¬æ—¶çš„æƒ©ç½šç¨‹åº¦ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸º 1.0ã€‚å½“ C è¶Šå¤§çš„æ—¶å€™ï¼Œåˆ†ç±»å™¨çš„å‡†ç¡®æ€§è¶Šé«˜ï¼Œä½†åŒæ ·å®¹é”™ç‡ä¼šè¶Šä½ï¼Œæ³›åŒ–èƒ½åŠ›ä¼šå˜å·®ã€‚ç›¸åï¼ŒC è¶Šå°ï¼Œæ³›åŒ–èƒ½åŠ›è¶Šå¼ºï¼Œä½†æ˜¯å‡†ç¡®æ€§ä¼šé™ä½ã€‚å‚æ•° gamma ä»£è¡¨æ ¸å‡½æ•°çš„ç³»æ•°ï¼Œé»˜è®¤ä¸ºæ ·æœ¬ç‰¹å¾æ•°çš„å€’æ•°ï¼Œå³ gamma = 1 / n_featuresã€‚åœ¨åˆ›å»º SVM åˆ†ç±»å™¨ä¹‹åï¼Œå°±å¯ä»¥è¾“å…¥è®­ç»ƒé›†å¯¹å®ƒè¿›è¡Œè®­ç»ƒã€‚æˆ‘ä»¬ä½¿ç”¨ model.fit(train_X,train_y)ï¼Œä¼ å…¥è®­ç»ƒé›†ä¸­çš„ç‰¹å¾å€¼çŸ©é˜µ train_X å’Œåˆ†ç±»æ ‡è¯† train_yã€‚ç‰¹å¾å€¼çŸ©é˜µå°±æ˜¯æˆ‘ä»¬åœ¨ç‰¹å¾é€‰æ‹©åæŠ½å–çš„ç‰¹å¾å€¼çŸ©é˜µï¼ˆå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨å…¨éƒ¨æ•°æ®ä½œä¸ºç‰¹å¾å€¼çŸ©é˜µï¼‰ï¼›åˆ†ç±»æ ‡è¯†å°±æ˜¯äººå·¥äº‹å…ˆé’ˆå¯¹æ¯ä¸ªæ ·æœ¬æ ‡è¯†çš„åˆ†ç±»ç»“æœã€‚è¿™æ ·æ¨¡å‹ä¼šè‡ªåŠ¨è¿›è¡Œåˆ†ç±»å™¨çš„è®­ç»ƒã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ prediction=model.predict(test_X) æ¥å¯¹ç»“æœè¿›è¡Œé¢„æµ‹ï¼Œä¼ å…¥æµ‹è¯•é›†ä¸­çš„æ ·æœ¬ç‰¹å¾çŸ©é˜µ test_Xï¼Œå¯ä»¥å¾—åˆ°æµ‹è¯•é›†çš„é¢„æµ‹åˆ†ç±»ç»“æœ predictionã€‚åŒæ ·æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºçº¿æ€§ SVM åˆ†ç±»å™¨ï¼Œä½¿ç”¨ model=svm.LinearSVC()ã€‚åœ¨ LinearSVC ä¸­æ²¡æœ‰ kernel è¿™ä¸ªå‚æ•°ï¼Œé™åˆ¶æˆ‘ä»¬åªèƒ½ä½¿ç”¨çº¿æ€§æ ¸å‡½æ•°ã€‚ç”±äº LinearSVC å¯¹çº¿æ€§åˆ†ç±»åšäº†ä¼˜åŒ–ï¼Œå¯¹äºæ•°æ®é‡å¤§çš„çº¿æ€§å¯åˆ†é—®é¢˜ï¼Œä½¿ç”¨ LinearSVC çš„æ•ˆç‡è¦é«˜äº SVCã€‚å¦‚æœä½ ä¸çŸ¥é“æ•°æ®é›†æ˜¯å¦ä¸ºçº¿æ€§ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ SVC ç±»åˆ›å»º SVM åˆ†ç±»å™¨ã€‚åœ¨è®­ç»ƒå’Œé¢„æµ‹ä¸­ï¼ŒLinearSVC å’Œ SVC ä¸€æ ·ï¼Œéƒ½æ˜¯ä½¿ç”¨ model.fit(train_X,train_y) å’Œ model.predict(test_X)ã€‚SVM è¿›è¡Œä¹³è…ºç™Œæ£€æµ‹åœ¨äº†è§£äº†å¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨ SVM åˆ†ç±»å™¨åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®é™…çš„é¡¹ç›®ï¼Œæ•°æ®é›†æ¥è‡ªç¾å›½å¨æ–¯åº·æ˜Ÿå·çš„ä¹³è…ºç™Œè¯Šæ–­æ•°æ®é›†ï¼Œç‚¹å‡»è¿™é‡Œè¿›è¡Œä¸‹è½½ https://github.com/cystanford/breast_cancer_data/blob/master/data.csvã€‚åŒ»ç–—äººå‘˜é‡‡é›†äº†æ‚£è€…ä¹³è…ºè‚¿å—ç»è¿‡ç»†é’ˆç©¿åˆº (FNA) åçš„æ•°å­—åŒ–å›¾åƒï¼Œå¹¶ä¸”å¯¹è¿™äº›æ•°å­—å›¾åƒè¿›è¡Œäº†ç‰¹å¾æå–ï¼Œè¿™äº›ç‰¹å¾å¯ä»¥æè¿°å›¾åƒä¸­çš„ç»†èƒæ ¸å‘ˆç°ã€‚è‚¿ç˜¤å¯ä»¥åˆ†æˆè‰¯æ€§å’Œæ¶æ€§ã€‚éƒ¨åˆ†æ•°æ®æˆªå±å¦‚ä¸‹æ‰€ç¤ºï¼šæ•°æ®è¡¨ä¸€å…±åŒ…æ‹¬äº† 32 ä¸ªå­—æ®µï¼Œä»£è¡¨çš„å«ä¹‰å¦‚ä¸‹ï¼šä¸Šé¢çš„è¡¨æ ¼ä¸­ï¼Œmean ä»£è¡¨å¹³å‡å€¼ï¼Œse ä»£è¡¨æ ‡å‡†å·®ï¼Œworst ä»£è¡¨æœ€å¤§å€¼ï¼ˆ3 ä¸ªæœ€å¤§å€¼çš„å¹³å‡å€¼ï¼‰ã€‚æ¯å¼ å›¾åƒéƒ½è®¡ç®—äº†ç›¸åº”çš„ç‰¹å¾ï¼Œå¾—å‡ºäº†è¿™ 30 ä¸ªç‰¹å¾å€¼ï¼ˆä¸åŒ…æ‹¬ ID å­—æ®µå’Œåˆ†ç±»æ ‡è¯†ç»“æœå­—æ®µ diagnosisï¼‰ï¼Œå®é™…ä¸Šæ˜¯ 10 ä¸ªç‰¹å¾å€¼ï¼ˆradiusã€textureã€perimeterã€areaã€smoothnessã€compactnessã€concavityã€concave pointsã€symmetry å’Œ fractal_dimension_meanï¼‰çš„ 3 ä¸ªç»´åº¦ï¼Œå¹³å‡ã€æ ‡å‡†å·®å’Œæœ€å¤§å€¼ã€‚è¿™äº›ç‰¹å¾å€¼éƒ½ä¿ç•™äº† 4 ä½æ•°å­—ã€‚å­—æ®µä¸­æ²¡æœ‰ç¼ºå¤±çš„å€¼ã€‚åœ¨ 569 ä¸ªæ‚£è€…ä¸­ï¼Œä¸€å…±æœ‰ 357 ä¸ªæ˜¯è‰¯æ€§ï¼Œ212 ä¸ªæ˜¯æ¶æ€§ã€‚å¥½äº†ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç”Ÿæˆä¸€ä¸ªä¹³è…ºç™Œè¯Šæ–­çš„ SVM åˆ†ç±»å™¨ï¼Œå¹¶è®¡ç®—è¿™ä¸ªåˆ†ç±»å™¨çš„å‡†ç¡®ç‡ã€‚é¦–å…ˆè®¾å®šé¡¹ç›®çš„æ‰§è¡Œæµç¨‹ï¼šé¦–å…ˆæˆ‘ä»¬éœ€è¦åŠ è½½æ•°æ®æºï¼›åœ¨å‡†å¤‡é˜¶æ®µï¼Œéœ€è¦å¯¹åŠ è½½çš„æ•°æ®æºè¿›è¡Œæ¢ç´¢ï¼ŒæŸ¥çœ‹æ ·æœ¬ç‰¹å¾å’Œç‰¹å¾å€¼ï¼Œè¿™ä¸ªè¿‡ç¨‹ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°æ®å¯è§†åŒ–ï¼Œå®ƒå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬å¯¹æ•°æ®åŠæ•°æ®ä¹‹é—´çš„å…³ç³»è¿›ä¸€æ­¥åŠ æ·±äº†è§£ã€‚ç„¶åæŒ‰ç…§â€œå®Œå…¨åˆä¸€â€çš„å‡†åˆ™æ¥è¯„ä¼°æ•°æ®çš„è´¨é‡ï¼Œå¦‚æœæ•°æ®è´¨é‡ä¸é«˜å°±éœ€è¦åšæ•°æ®æ¸…æ´—ã€‚æ•°æ®æ¸…æ´—ä¹‹åï¼Œä½ å¯ä»¥åšç‰¹å¾é€‰æ‹©ï¼Œæ–¹ä¾¿åç»­çš„æ¨¡å‹è®­ç»ƒï¼›åœ¨åˆ†ç±»é˜¶æ®µï¼Œé€‰æ‹©æ ¸å‡½æ•°è¿›è¡Œè®­ç»ƒï¼Œå¦‚æœä¸çŸ¥é“æ•°æ®æ˜¯å¦ä¸ºçº¿æ€§ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ SVC(kernel=â€˜rbfâ€™) ï¼Œä¹Ÿå°±æ˜¯é«˜æ–¯æ ¸å‡½æ•°çš„ SVM åˆ†ç±»å™¨ã€‚ç„¶åå¯¹è®­ç»ƒå¥½çš„æ¨¡å‹ç”¨æµ‹è¯•é›†è¿›è¡Œè¯„ä¼°ã€‚æŒ‰ç…§ä¸Šé¢çš„æµç¨‹ï¼Œæˆ‘ä»¬æ¥ç¼–å†™ä¸‹ä»£ç ï¼ŒåŠ è½½æ•°æ®å¹¶å¯¹æ•°æ®åšéƒ¨åˆ†çš„æ¢ç´¢ï¼š123456789# åŠ è½½æ•°æ®é›†ï¼Œä½ éœ€è¦æŠŠæ•°æ®æ”¾åˆ°ç›®å½•ä¸­data = pd.read_csv(\"./data.csv\")# æ•°æ®æ¢ç´¢# å› ä¸ºæ•°æ®é›†ä¸­åˆ—æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬éœ€è¦æŠŠdataframeä¸­çš„åˆ—å…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥pd.set_option('display.max_columns', None)print(data.columns)print(data.head(5))print(data.describe())è¿è¡Œç»“æœä¸­ï¼Œä½ èƒ½çœ‹åˆ° 32 ä¸ªå­—æ®µé‡Œï¼Œid æ˜¯æ²¡æœ‰å®é™…å«ä¹‰çš„ï¼Œå¯ä»¥å»æ‰ã€‚diagnosis å­—æ®µçš„å–å€¼ä¸º B æˆ–è€… Mï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ 0 å’Œ 1 æ¥æ›¿ä»£ã€‚å¦å¤–å…¶ä½™çš„ 30 ä¸ªå­—æ®µï¼Œå…¶å®å¯ä»¥åˆ†æˆä¸‰ç»„å­—æ®µï¼Œä¸‹åˆ’çº¿åé¢çš„ meanã€se å’Œ worst ä»£è¡¨äº†æ¯ç»„å­—æ®µä¸åŒçš„åº¦é‡æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯å¹³å‡å€¼ã€æ ‡å‡†å·®å’Œæœ€å¤§å€¼ã€‚12345678910# å°†ç‰¹å¾å­—æ®µåˆ†æˆ3ç»„features_mean= list(data.columns[2:12])features_se= list(data.columns[12:22])features_worst=list(data.columns[22:32])# æ•°æ®æ¸…æ´—# IDåˆ—æ²¡æœ‰ç”¨ï¼Œåˆ é™¤è¯¥åˆ—data.drop(\"id\",axis=1,inplace=True)# å°†Bè‰¯æ€§æ›¿æ¢ä¸º0ï¼ŒMæ¶æ€§æ›¿æ¢ä¸º1data['diagnosis']=data['diagnosis'].map(&#123;'M':1,'B':0&#125;)ç„¶åæˆ‘ä»¬è¦åšç‰¹å¾å­—æ®µçš„ç­›é€‰ï¼Œé¦–å…ˆéœ€è¦è§‚å¯Ÿä¸‹ features_mean å„å˜é‡ä¹‹é—´çš„å…³ç³»ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ DataFrame çš„ corr() å‡½æ•°ï¼Œç„¶åç”¨çƒ­åŠ›å›¾å¸®æˆ‘ä»¬å¯è§†åŒ–å‘ˆç°ã€‚åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿä¼šçœ‹æ•´ä½“è‰¯æ€§ã€æ¶æ€§è‚¿ç˜¤çš„è¯Šæ–­æƒ…å†µã€‚12345678910# å°†è‚¿ç˜¤è¯Šæ–­ç»“æœå¯è§†åŒ–sns.countplot(data['diagnosis'],label=\"Count\")plt.show()# ç”¨çƒ­åŠ›å›¾å‘ˆç°features_meanå­—æ®µä¹‹é—´çš„ç›¸å…³æ€§corr = data[features_mean].corr()plt.figure(figsize=(14,14))# annot=Trueæ˜¾ç¤ºæ¯ä¸ªæ–¹æ ¼çš„æ•°æ®sns.heatmap(corr, annot=True)plt.show()å›¾è¡¨å±•ç¤ºï¼šçƒ­åŠ›å›¾ä¸­å¯¹è§’çº¿ä¸Šçš„ä¸ºå•å˜é‡è‡ªèº«çš„ç›¸å…³ç³»æ•°æ˜¯ 1ã€‚é¢œè‰²è¶Šæµ…ä»£è¡¨ç›¸å…³æ€§è¶Šå¤§ã€‚æ‰€ä»¥ä½ èƒ½çœ‹å‡ºæ¥ radius_meanã€perimeter_mean å’Œ area_mean ç›¸å…³æ€§éå¸¸å¤§ï¼Œcompactness_meanã€concavity_meanã€concave_points_mean è¿™ä¸‰ä¸ªå­—æ®µä¹Ÿæ˜¯ç›¸å…³çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å–å…¶ä¸­çš„ä¸€ä¸ªä½œä¸ºä»£è¡¨ã€‚é‚£ä¹ˆå¦‚ä½•è¿›è¡Œç‰¹å¾é€‰æ‹©å‘¢ï¼Ÿç‰¹å¾é€‰æ‹©çš„ç›®çš„æ˜¯é™ç»´ï¼Œç”¨å°‘é‡çš„ç‰¹å¾ä»£è¡¨æ•°æ®çš„ç‰¹æ€§ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å¢å¼ºåˆ†ç±»å™¨çš„æ³›åŒ–èƒ½åŠ›ï¼Œé¿å…æ•°æ®è¿‡æ‹Ÿåˆã€‚æˆ‘ä»¬èƒ½çœ‹åˆ° meanã€se å’Œ worst è¿™ä¸‰ç»„ç‰¹å¾æ˜¯å¯¹åŒä¸€ç»„å†…å®¹çš„ä¸åŒåº¦é‡æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¿ç•™ mean è¿™ç»„ç‰¹å¾ï¼Œåœ¨ç‰¹å¾é€‰æ‹©ä¸­å¿½ç•¥æ‰ se å’Œ worstã€‚åŒæ—¶æˆ‘ä»¬èƒ½çœ‹åˆ° mean è¿™ç»„ç‰¹å¾ä¸­ï¼Œradius_meanã€perimeter_meanã€area_mean è¿™ä¸‰ä¸ªå±æ€§ç›¸å…³æ€§å¤§ï¼Œcompactness_meanã€daconcavity_meanã€concave points_mean è¿™ä¸‰ä¸ªå±æ€§ç›¸å…³æ€§å¤§ã€‚æˆ‘ä»¬åˆ†åˆ«ä»è¿™ 2 ç±»ä¸­é€‰æ‹© 1 ä¸ªå±æ€§ä½œä¸ºä»£è¡¨ï¼Œæ¯”å¦‚ radius_mean å’Œ compactness_meanã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŠŠåŸæ¥çš„ 10 ä¸ªå±æ€§ç¼©å‡ä¸º 6 ä¸ªå±æ€§ï¼Œä»£ç å¦‚ä¸‹ï¼š123# ç‰¹å¾é€‰æ‹©features_remain = ['radius_mean','texture_mean', 'smoothness_mean','compactness_mean', 'symmetry_mean', 'fractal_dimension_mean']å¯¹ç‰¹å¾è¿›è¡Œé€‰æ‹©ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å‡†å¤‡è®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼š12345678# æŠ½å–30%çš„æ•°æ®ä½œä¸ºæµ‹è¯•é›†ï¼Œå…¶ä½™ä½œä¸ºè®­ç»ƒé›†train, test = train_test_split(data, test_size = 0.3)# in this our main data is splitted into train and test# æŠ½å–ç‰¹å¾é€‰æ‹©çš„æ•°å€¼ä½œä¸ºè®­ç»ƒå’Œæµ‹è¯•æ•°æ®train_X = train[features_remain]train_y=train['diagnosis']test_X= test[features_remain]test_y =test['diagnosis']åœ¨è®­ç»ƒä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®è¿›è¡Œè§„èŒƒåŒ–ï¼Œè¿™æ ·è®©æ•°æ®åŒåœ¨åŒä¸€ä¸ªé‡çº§ä¸Šï¼Œé¿å…å› ä¸ºç»´åº¦é—®é¢˜é€ æˆæ•°æ®è¯¯å·®ï¼š12345# é‡‡ç”¨Z-Scoreè§„èŒƒåŒ–æ•°æ®ï¼Œä¿è¯æ¯ä¸ªç‰¹å¾ç»´åº¦çš„æ•°æ®å‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º1ss = StandardScaler()train_X = ss.fit_transform(train_X)test_X = ss.transform(test_X)æœ€åæˆ‘ä»¬å¯ä»¥è®© SVM åšè®­ç»ƒå’Œé¢„æµ‹äº†ï¼š12345678# åˆ›å»ºSVMåˆ†ç±»å™¨model = svm.SVC()# ç”¨è®­ç»ƒé›†åšè®­ç»ƒmodel.fit(train_X,train_y)# ç”¨æµ‹è¯•é›†åšé¢„æµ‹prediction=model.predict(test_X)print('å‡†ç¡®ç‡: ', metrics.accuracy_score(prediction,test_y))è¿è¡Œç»“æœï¼š12å‡†ç¡®ç‡: 0.9181286549707602ä¹³è…ºç™Œè¯Šæ–­åˆ†ç±»çš„ SVM å®æˆ˜ï¼Œä»è¿™ä¸ªè¿‡ç¨‹ä¸­æ•´ä¸ªæ‰§è¡Œçš„æµç¨‹ï¼ŒåŒ…æ‹¬æ•°æ®åŠ è½½ã€æ•°æ®æ¢ç´¢ã€æ•°æ®æ¸…æ´—ã€ç‰¹å¾é€‰æ‹©ã€SVM è®­ç»ƒå’Œç»“æœè¯„ä¼°ç­‰ç¯èŠ‚ã€‚sklearn å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¥½çš„å·¥å…·ï¼Œå¯¹ä¸ŠèŠ‚è¯¾ä¸­è®²åˆ°çš„ SVM çš„åˆ›å»ºå’Œè®­ç»ƒéƒ½è¿›è¡Œäº†å°è£…ï¼Œè®©æˆ‘ä»¬æ— éœ€å…³å¿ƒä¸­é—´çš„è¿ç®—ç»†èŠ‚ã€‚ä½†æ­£å› ä¸ºè¿™æ ·ï¼Œæˆ‘ä»¬æ›´éœ€è¦å¯¹æ¯ä¸ªæµç¨‹ç†Ÿç»ƒæŒæ¡ï¼Œé€šè¿‡å®æˆ˜é¡¹ç›®è®­ç»ƒæ•°æ®åŒ–æ€ç»´å’Œå¯¹æ•°æ®çš„æ•æ„Ÿåº¦ã€‚å…¨éƒ¨ä»£ç ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263import pandasimport matplotlib.pyplot as pltfrom sklearn import svm, metricsimport seaborn as snsfrom sklearn.model_selection import train_test_splitfrom sklearn.preprocessing import StandardScalerdata = pandas.read_csv(\"data.csv\")pandas.set_option('display.max_columns', None)# å°†ç‰¹å¾å­—æ®µåˆ†æˆ3ç»„features_mean= list(data.columns[2:12])features_se= list(data.columns[12:22])features_worst=list(data.columns[22:32])# æ•°æ®æ¸…æ´—# IDåˆ—æ²¡æœ‰ç”¨ï¼Œåˆ é™¤è¯¥åˆ—data.drop(\"id\",axis=1,inplace=True)# å°†Bè‰¯æ€§æ›¿æ¢ä¸º0ï¼ŒMæ¶æ€§æ›¿æ¢ä¸º1data['diagnosis']=data['diagnosis'].map(&#123;'M':1,'B':0&#125;)# # å°†è‚¿ç˜¤è¯Šæ–­ç»“æœå¯è§†åŒ–# sns.countplot(data['diagnosis'],label=\"Count\")# plt.show()# # ç”¨çƒ­åŠ›å›¾å‘ˆç°features_meanå­—æ®µä¹‹é—´çš„ç›¸å…³æ€§# corr = data[features_mean].corr()# plt.figure(figsize=(14,14))# # annot=Trueæ˜¾ç¤ºæ¯ä¸ªæ–¹æ ¼çš„æ•°æ®# sns.heatmap(corr, annot=True)# plt.show()# ç‰¹å¾é€‰æ‹©features_remain = ['radius_mean','texture_mean', 'smoothness_mean','compactness_mean','symmetry_mean', 'fractal_dimension_mean']# æŠ½å–30%çš„æ•°æ®ä½œä¸ºæµ‹è¯•é›†ï¼Œå…¶ä½™ä½œä¸ºè®­ç»ƒé›†train, test = train_test_split(data, test_size = 0.3)# in this our main data is splitted into train and test# æŠ½å–ç‰¹å¾é€‰æ‹©çš„æ•°å€¼ä½œä¸ºè®­ç»ƒå’Œæµ‹è¯•æ•°æ®train_X = train[features_remain]train_y=train['diagnosis']test_X= test[features_remain]test_y =test['diagnosis']# é‡‡ç”¨Z-Scoreè§„èŒƒåŒ–æ•°æ®ï¼Œä¿è¯æ¯ä¸ªç‰¹å¾ç»´åº¦çš„æ•°æ®å‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º1ss = StandardScaler()train_X = ss.fit_transform(train_X)test_X = ss.transform(test_X)# åˆ›å»ºSVMåˆ†ç±»å™¨model = svm.SVC()# ç”¨è®­ç»ƒé›†åšè®­ç»ƒmodel.fit(train_X,train_y)# ç”¨æµ‹è¯•é›†åšé¢„æµ‹prediction=model.predict(test_X)print('å‡†ç¡®ç‡: ', metrics.accuracy_score(prediction,test_y))","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"SVM","slug":"SVM","permalink":"cpeixin.cn/tags/SVM/"}]},{"title":"æ•°æ®åˆ†æ-SVM_1","slug":"æ•°æ®åˆ†æ-SVM-1","date":"2018-07-24T14:27:13.000Z","updated":"2020-05-01T14:14:27.095Z","comments":true,"path":"2018/07/24/æ•°æ®åˆ†æ-SVM-1/","link":"","permalink":"cpeixin.cn/2018/07/24/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-SVM-1/","excerpt":"","text":"SVM æ”¯æŒå‘é‡æœºSVM çš„è‹±æ–‡å« Support Vector Machineï¼Œä¸­æ–‡åä¸ºæ”¯æŒå‘é‡æœºã€‚å®ƒæ˜¯å¸¸è§çš„ä¸€ç§åˆ†ç±»æ–¹æ³•ï¼Œåœ¨æœºå™¨å­¦ä¹ ä¸­ï¼ŒSVM æ˜¯æœ‰ç›‘ç£çš„å­¦ä¹ æ¨¡å‹ã€‚ä»€ä¹ˆæ˜¯æœ‰ç›‘ç£çš„å­¦ä¹ æ¨¡å‹å‘¢ï¼Ÿå®ƒæŒ‡çš„æ˜¯æˆ‘ä»¬éœ€è¦äº‹å…ˆå¯¹æ•°æ®æ‰“ä¸Šåˆ†ç±»æ ‡ç­¾ï¼Œè¿™æ ·æœºå™¨å°±çŸ¥é“è¿™ä¸ªæ•°æ®å±äºå“ªä¸ªåˆ†ç±»ã€‚åŒæ ·æ— ç›‘ç£å­¦ä¹ ï¼Œå°±æ˜¯æ•°æ®æ²¡æœ‰è¢«æ‰“ä¸Šåˆ†ç±»æ ‡ç­¾ï¼Œè¿™å¯èƒ½æ˜¯å› ä¸ºæˆ‘ä»¬ä¸å…·å¤‡å…ˆéªŒçš„çŸ¥è¯†ï¼Œæˆ–è€…æ‰“æ ‡ç­¾çš„æˆæœ¬å¾ˆé«˜ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æœºå™¨ä»£æˆ‘ä»¬éƒ¨åˆ†å®Œæˆè¿™ä¸ªå·¥ä½œï¼Œæ¯”å¦‚å°†æ•°æ®è¿›è¡Œèšç±»ï¼Œæ–¹ä¾¿åç»­äººå·¥å¯¹æ¯ä¸ªç±»è¿›è¡Œåˆ†æã€‚SVM ä½œä¸ºæœ‰ç›‘ç£çš„å­¦ä¹ æ¨¡å‹ï¼Œé€šå¸¸å¯ä»¥å¸®æˆ‘ä»¬æ¨¡å¼è¯†åˆ«ã€åˆ†ç±»ä»¥åŠå›å½’åˆ†æã€‚æ¡Œå­ä¸Šæˆ‘æ”¾äº†çº¢è‰²å’Œè“è‰²ä¸¤ç§çƒï¼Œè¯·ä½ ç”¨ä¸€æ ¹æ£å­å°†è¿™ä¸¤ç§é¢œè‰²çš„çƒåˆ†å¼€ã€‚ä½ å¯ä»¥å¾ˆå¿«æƒ³åˆ°è§£å†³æ–¹æ¡ˆï¼Œåœ¨çº¢è‰²å’Œè“è‰²çƒä¹‹é—´ç”»æ¡ç›´çº¿å°±å¥½äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šè¿™æ¬¡éš¾åº¦å‡çº§ï¼Œæ¡Œå­ä¸Šä¾ç„¶æ”¾ç€çº¢è‰²ã€è“è‰²ä¸¤ç§çƒï¼Œä½†æ˜¯å®ƒä»¬çš„æ‘†æ”¾ä¸è§„å¾‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å¦‚ä½•ç”¨ä¸€æ ¹æ£å­æŠŠè¿™ä¸¤ç§é¢œè‰²åˆ†å¼€å‘¢ï¼Ÿä½ å¯èƒ½æƒ³äº†æƒ³ï¼Œè®¤ä¸ºä¸€æ ¹æ£å­æ˜¯åˆ†ä¸å¼€çš„ã€‚é™¤éæŠŠæ£å­å¼¯æ›²ï¼Œåƒä¸‹é¢è¿™æ ·ï¼šæ‰€ä»¥è¿™é‡Œç›´çº¿å˜æˆäº†æ›²çº¿ã€‚å¦‚æœåœ¨åŒä¸€ä¸ªå¹³é¢ä¸Šæ¥çœ‹ï¼Œçº¢è“ä¸¤ç§é¢œè‰²çš„çƒæ˜¯å¾ˆéš¾åˆ†å¼€çš„ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥è®©å®ƒä»¬è‡ªç„¶åœ°åˆ†å¼€å‘¢ï¼Ÿè¿™é‡Œä½ å¯èƒ½ä¼šçµæœºä¸€åŠ¨ï¼ŒçŒ›æ‹ä¸€ä¸‹æ¡Œå­ï¼Œè¿™äº›å°çƒç¬é—´è…¾ç©ºè€Œèµ·ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚åœ¨è…¾èµ·çš„é‚£ä¸€åˆ¹é‚£ï¼Œå‡ºç°äº†ä¸€ä¸ªæ°´å¹³åˆ‡é¢ï¼Œæ°å¥½æŠŠçº¢ã€è“ä¸¤ç§é¢œè‰²çš„çƒåˆ†å¼€ã€‚åœ¨è¿™é‡Œï¼ŒäºŒç»´å¹³é¢å˜æˆäº†ä¸‰ç»´ç©ºé—´ã€‚åŸæ¥çš„æ›²çº¿å˜æˆäº†ä¸€ä¸ªå¹³é¢ã€‚è¿™ä¸ªå¹³é¢ï¼Œæˆ‘ä»¬å°±å«åšè¶…å¹³é¢ã€‚SVM çš„å·¥ä½œåŸç†ç”¨SVM è®¡ç®—çš„è¿‡ç¨‹å°±æ˜¯å¸®æˆ‘ä»¬æ‰¾åˆ°é‚£ä¸ªè¶…å¹³é¢çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¶…å¹³é¢å°±æ˜¯æˆ‘ä»¬çš„ SVM åˆ†ç±»å™¨ã€‚æˆ‘ä»¬å†è¿‡å¤´æ¥çœ‹æœ€ç®€å•çš„ç»ƒä¹  1ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥æœ‰å¤šç§ç›´çº¿çš„åˆ’åˆ†ï¼Œæ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ç›´çº¿ Aã€ç›´çº¿ B å’Œç›´çº¿ Cï¼Œç©¶ç«Ÿå“ªç§æ‰æ˜¯æ›´å¥½çš„åˆ’åˆ†å‘¢ï¼Ÿå¾ˆæ˜æ˜¾å›¾ä¸­çš„ç›´çº¿ B æ›´é è¿‘è“è‰²çƒï¼Œä½†æ˜¯åœ¨çœŸå®ç¯å¢ƒä¸‹ï¼Œçƒå†å¤šä¸€äº›çš„è¯ï¼Œè“è‰²çƒå¯èƒ½å°±è¢«åˆ’åˆ†åˆ°äº†ç›´çº¿ B çš„å³ä¾§ï¼Œè¢«è®¤ä¸ºæ˜¯çº¢è‰²çƒã€‚åŒæ ·ç›´çº¿ A æ›´é è¿‘çº¢è‰²çƒï¼Œåœ¨çœŸå®ç¯å¢ƒä¸‹ï¼Œå¦‚æœçº¢è‰²çƒå†å¤šä¸€äº›ï¼Œä¹Ÿå¯èƒ½ä¼šè¢«è¯¯è®¤ä¸ºæ˜¯è“è‰²çƒã€‚æ‰€ä»¥ç›¸æ¯”äºç›´çº¿ A å’Œç›´çº¿ Bï¼Œç›´çº¿ C çš„åˆ’åˆ†æ›´ä¼˜ï¼Œå› ä¸ºå®ƒçš„é²æ£’æ€§æ›´å¼ºã€‚é‚£æ€æ ·æ‰èƒ½å¯»æ‰¾åˆ°ç›´çº¿ C è¿™ä¸ªæ›´ä¼˜çš„ç­”æ¡ˆå‘¢ï¼Ÿè¿™é‡Œï¼Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ª SVM ç‰¹æœ‰çš„æ¦‚å¿µï¼šåˆ†ç±»é—´éš”ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬çš„åˆ†ç±»ç¯å¢ƒä¸æ˜¯åœ¨äºŒç»´å¹³é¢ä¸­çš„ï¼Œè€Œæ˜¯åœ¨å¤šç»´ç©ºé—´ä¸­ï¼Œè¿™æ ·ç›´çº¿ C å°±å˜æˆäº†å†³ç­–é¢ Cã€‚åœ¨ä¿è¯å†³ç­–é¢ä¸å˜ï¼Œä¸”åˆ†ç±»ä¸äº§ç”Ÿé”™è¯¯çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç§»åŠ¨å†³ç­–é¢ Cï¼Œç›´åˆ°äº§ç”Ÿä¸¤ä¸ªæé™çš„ä½ç½®ï¼šå¦‚å›¾ä¸­çš„å†³ç­–é¢ A å’Œå†³ç­–é¢ Bã€‚æé™çš„ä½ç½®æ˜¯æŒ‡ï¼Œå¦‚æœè¶Šè¿‡äº†è¿™ä¸ªä½ç½®ï¼Œå°±ä¼šäº§ç”Ÿåˆ†ç±»é”™è¯¯ã€‚è¿™æ ·çš„è¯ï¼Œä¸¤ä¸ªæé™ä½ç½® A å’Œ B ä¹‹é—´çš„åˆ†ç•Œçº¿ C å°±æ˜¯æœ€ä¼˜å†³ç­–é¢ã€‚æé™ä½ç½®åˆ°æœ€ä¼˜å†³ç­–é¢ C ä¹‹é—´çš„è·ç¦»ï¼Œå°±æ˜¯â€œåˆ†ç±»é—´éš”â€ï¼Œè‹±æ–‡å«åš marginã€‚å¦‚æœæˆ‘ä»¬è½¬åŠ¨è¿™ä¸ªæœ€ä¼˜å†³ç­–é¢ï¼Œä½ ä¼šå‘ç°å¯èƒ½å­˜åœ¨å¤šä¸ªæœ€ä¼˜å†³ç­–é¢ï¼Œå®ƒä»¬éƒ½èƒ½æŠŠæ•°æ®é›†æ­£ç¡®åˆ†å¼€ï¼Œè¿™äº›æœ€ä¼˜å†³ç­–é¢çš„åˆ†ç±»é—´éš”å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œè€Œé‚£ä¸ªæ‹¥æœ‰â€œæœ€å¤§é—´éš”â€ï¼ˆmax marginï¼‰çš„å†³ç­–é¢å°±æ˜¯ SVM è¦æ‰¾çš„æœ€ä¼˜è§£ã€‚ç‚¹åˆ°è¶…å¹³é¢çš„è·ç¦»å…¬å¼**åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æŠŠçº¢è“ä¸¤ç§é¢œè‰²çš„çƒæ”¾åˆ°ä¸€ä¸ªä¸‰ç»´ç©ºé—´é‡Œï¼Œä½ å‘ç°å†³ç­–é¢å°±å˜æˆäº†ä¸€ä¸ªå¹³é¢ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨çº¿æ€§å‡½æ•°æ¥è¡¨ç¤ºï¼Œå¦‚æœåœ¨ä¸€ç»´ç©ºé—´é‡Œå°±è¡¨ç¤ºä¸€ä¸ªç‚¹ï¼Œåœ¨äºŒç»´ç©ºé—´é‡Œè¡¨ç¤ºä¸€æ¡ç›´çº¿ï¼Œåœ¨ä¸‰ç»´ç©ºé—´ä¸­ä»£è¡¨ä¸€ä¸ªå¹³é¢ï¼Œå½“ç„¶ç©ºé—´ç»´æ•°è¿˜å¯ä»¥æ›´å¤šï¼Œè¿™æ ·æˆ‘ä»¬ç»™è¿™ä¸ªçº¿æ€§å‡½æ•°èµ·ä¸ªåç§°å«åšâ€œè¶…å¹³é¢â€ã€‚è¶…å¹³é¢çš„æ•°å­¦è¡¨è¾¾å¯ä»¥å†™æˆï¼šåœ¨è¿™ä¸ªå…¬å¼é‡Œï¼Œwã€x æ˜¯ n ç»´ç©ºé—´é‡Œçš„å‘é‡ï¼Œå…¶ä¸­ x æ˜¯å‡½æ•°å˜é‡ï¼›w æ˜¯æ³•å‘é‡ã€‚æ³•å‘é‡è¿™é‡ŒæŒ‡çš„æ˜¯å‚ç›´äºå¹³é¢çš„ç›´çº¿æ‰€è¡¨ç¤ºçš„å‘é‡ï¼Œå®ƒå†³å®šäº†è¶…å¹³é¢çš„æ–¹å‘ã€‚SVM å°±æ˜¯å¸®æˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªè¶…å¹³é¢ï¼Œè¿™ä¸ªè¶…å¹³é¢èƒ½å°†ä¸åŒçš„æ ·æœ¬åˆ’åˆ†å¼€ï¼ŒåŒæ—¶ä½¿å¾—æ ·æœ¬é›†ä¸­çš„ç‚¹åˆ°è¿™ä¸ªåˆ†ç±»è¶…å¹³é¢çš„æœ€å°è·ç¦»ï¼ˆå³åˆ†ç±»é—´éš”ï¼‰æœ€å¤§åŒ–ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ”¯æŒå‘é‡å°±æ˜¯ç¦»åˆ†ç±»è¶…å¹³é¢æœ€è¿‘çš„æ ·æœ¬ç‚¹ï¼Œå®é™…ä¸Šå¦‚æœç¡®å®šäº†æ”¯æŒå‘é‡ä¹Ÿå°±ç¡®å®šäº†è¿™ä¸ªè¶…å¹³é¢ã€‚æ‰€ä»¥æ”¯æŒå‘é‡å†³å®šäº†åˆ†ç±»é—´éš”åˆ°åº•æ˜¯å¤šå°‘ï¼Œè€Œåœ¨æœ€å¤§é—´éš”ä»¥å¤–çš„æ ·æœ¬ç‚¹ï¼Œå…¶å®å¯¹åˆ†ç±»éƒ½æ²¡æœ‰æ„ä¹‰ã€‚æ‰€ä»¥è¯´ï¼Œ SVM å°±æ˜¯æ±‚è§£æœ€å¤§åˆ†ç±»é—´éš”çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹åˆ†ç±»é—´éš”çš„å¤§å°è¿›è¡Œå®šä¹‰ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰æŸç±»æ ·æœ¬é›†åˆ°è¶…å¹³é¢çš„è·ç¦»æ˜¯è¿™ä¸ªæ ·æœ¬é›†åˆå†…çš„æ ·æœ¬åˆ°è¶…å¹³é¢çš„æœ€çŸ­è·ç¦»ã€‚æˆ‘ä»¬ç”¨ di ä»£è¡¨ç‚¹ xi åˆ°è¶…å¹³é¢ wxi+b=0 çš„æ¬§æ°è·ç¦»ã€‚å› æ­¤æˆ‘ä»¬è¦æ±‚ di çš„æœ€å°å€¼ï¼Œç”¨å®ƒæ¥ä»£è¡¨è¿™ä¸ªæ ·æœ¬åˆ°è¶…å¹³é¢çš„æœ€çŸ­è·ç¦»ã€‚di å¯ä»¥ç”¨å…¬å¼è®¡ç®—å¾—å‡ºï¼šå…¶ä¸­||w||ä¸ºè¶…å¹³é¢çš„èŒƒæ•°ï¼Œdi çš„å…¬å¼å¯ä»¥ç”¨è§£æå‡ ä½•çŸ¥è¯†è¿›è¡Œæ¨å¯¼æœ€å¤§é—´éš”çš„ä¼˜åŒ–æ¨¡å‹æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æ‰¾å‡ºæ‰€æœ‰åˆ†ç±»é—´éš”ä¸­æœ€å¤§çš„é‚£ä¸ªå€¼å¯¹åº”çš„è¶…å¹³é¢ã€‚åœ¨æ•°å­¦ä¸Šï¼Œè¿™æ˜¯ä¸€ä¸ªå‡¸ä¼˜åŒ–é—®é¢˜ï¼ˆå‡¸ä¼˜åŒ–å°±æ˜¯å…³äºæ±‚å‡¸é›†ä¸­çš„å‡¸å‡½æ•°æœ€å°åŒ–çš„é—®é¢˜ï¼Œè¿™é‡Œä¸å…·ä½“å±•å¼€ï¼‰ã€‚é€šè¿‡å‡¸ä¼˜åŒ–é—®é¢˜ï¼Œæœ€åå¯ä»¥æ±‚å‡ºæœ€ä¼˜çš„ w å’Œ bï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æƒ³è¦æ‰¾çš„æœ€ä¼˜è¶…å¹³é¢ã€‚ä¸­é—´æ±‚è§£çš„è¿‡ç¨‹ä¼šç”¨åˆ°æ‹‰æ ¼æœ—æ—¥ä¹˜å­ï¼Œå’Œ KKTï¼ˆKarush-Kuhn-Tuckerï¼‰æ¡ä»¶ã€‚æ•°å­¦å…¬å¼æ¯”è¾ƒå¤šï¼Œè¿™é‡Œä¸è¿›è¡Œå±•å¼€ã€‚ç¡¬é—´éš”ã€è½¯é—´éš”å’Œéçº¿æ€§ SVMå‡å¦‚æ•°æ®æ˜¯å®Œå…¨çš„çº¿æ€§å¯åˆ†çš„ï¼Œé‚£ä¹ˆå­¦ä¹ åˆ°çš„æ¨¡å‹å¯ä»¥ç§°ä¸ºç¡¬é—´éš”æ”¯æŒå‘é‡æœºã€‚æ¢ä¸ªè¯´æ³•ï¼Œç¡¬é—´éš”æŒ‡çš„å°±æ˜¯å®Œå…¨åˆ†ç±»å‡†ç¡®ï¼Œä¸èƒ½å­˜åœ¨åˆ†ç±»é”™è¯¯çš„æƒ…å†µã€‚è½¯é—´éš”ï¼Œå°±æ˜¯å…è®¸ä¸€å®šé‡çš„æ ·æœ¬åˆ†ç±»é”™è¯¯ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå®é™…å·¥ä½œä¸­çš„æ•°æ®æ²¡æœ‰é‚£ä¹ˆâ€œå¹²å‡€â€ï¼Œæˆ–å¤šæˆ–å°‘éƒ½ä¼šå­˜åœ¨ä¸€äº›å™ªç‚¹ã€‚æ‰€ä»¥çº¿æ€§å¯åˆ†æ˜¯ä¸ªç†æƒ³æƒ…å†µã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ°è½¯é—´éš” SVMï¼ˆè¿‘ä¼¼çº¿æ€§å¯åˆ†ï¼‰ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µï¼šå¦å¤–è¿˜å­˜åœ¨ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯éçº¿æ€§æ”¯æŒå‘é‡æœºã€‚æ¯”å¦‚ä¸‹é¢çš„æ ·æœ¬é›†å°±æ˜¯ä¸ªéçº¿æ€§çš„æ•°æ®ã€‚å›¾ä¸­çš„ä¸¤ç±»æ•°æ®ï¼Œåˆ†åˆ«åˆ†å¸ƒä¸ºä¸¤ä¸ªåœ†åœˆçš„å½¢çŠ¶ã€‚é‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼Œä¸è®ºæ˜¯å¤šé«˜çº§çš„åˆ†ç±»å™¨ï¼Œåªè¦æ˜ å°„å‡½æ•°æ˜¯çº¿æ€§çš„ï¼Œå°±æ²¡æ³•å¤„ç†ï¼ŒSVM ä¹Ÿå¤„ç†ä¸äº†ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼šæ ¸å‡½æ•°ã€‚å®ƒå¯ä»¥å°†æ ·æœ¬ä»åŸå§‹ç©ºé—´æ˜ å°„åˆ°ä¸€ä¸ªæ›´é«˜ç»´çš„ç‰¹è´¨ç©ºé—´ä¸­ï¼Œä½¿å¾—æ ·æœ¬åœ¨æ–°çš„ç©ºé—´ä¸­çº¿æ€§å¯åˆ†ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨åŸæ¥çš„æ¨å¯¼æ¥è¿›è¡Œè®¡ç®—ï¼Œåªæ˜¯æ‰€æœ‰çš„æ¨å¯¼æ˜¯åœ¨æ–°çš„ç©ºé—´ï¼Œè€Œä¸æ˜¯åœ¨åŸæ¥çš„ç©ºé—´ä¸­è¿›è¡Œã€‚ç”¨ SVM å¦‚ä½•è§£å†³å¤šåˆ†ç±»é—®é¢˜SVM æœ¬èº«æ˜¯ä¸€ä¸ªäºŒå€¼åˆ†ç±»å™¨ï¼Œæœ€åˆæ˜¯ä¸ºäºŒåˆ†ç±»é—®é¢˜è®¾è®¡çš„ï¼Œä¹Ÿå°±æ˜¯å›ç­” Yes æˆ–è€…æ˜¯ Noã€‚è€Œå®é™…ä¸Šæˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜ï¼Œå¯èƒ½æ˜¯å¤šåˆ†ç±»çš„æƒ…å†µï¼Œæ¯”å¦‚å¯¹æ–‡æœ¬è¿›è¡Œåˆ†ç±»ï¼Œæˆ–è€…å¯¹å›¾åƒè¿›è¡Œè¯†åˆ«ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å°†å¤šä¸ªäºŒåˆ†ç±»å™¨ç»„åˆèµ·æ¥å½¢æˆä¸€ä¸ªå¤šåˆ†ç±»å™¨ï¼Œå¸¸è§çš„æ–¹æ³•æœ‰â€œä¸€å¯¹å¤šæ³•â€å’Œâ€œä¸€å¯¹ä¸€æ³•â€ä¸¤ç§ã€‚ä¸€å¯¹å¤šæ³•å‡è®¾æˆ‘ä»¬è¦æŠŠç‰©ä½“åˆ†æˆ Aã€Bã€Cã€D å››ç§åˆ†ç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…ˆæŠŠå…¶ä¸­çš„ä¸€ç±»ä½œä¸ºåˆ†ç±» 1ï¼Œå…¶ä»–ç±»ç»Ÿä¸€å½’ä¸ºåˆ†ç±» 2ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥æ„é€  4 ç§ SVMï¼Œåˆ†åˆ«ä¸ºä»¥ä¸‹çš„æƒ…å†µï¼šï¼ˆ1ï¼‰æ ·æœ¬ A ä½œä¸ºæ­£é›†ï¼ŒBï¼ŒCï¼ŒD ä½œä¸ºè´Ÿé›†ï¼›ï¼ˆ2ï¼‰æ ·æœ¬ B ä½œä¸ºæ­£é›†ï¼ŒAï¼ŒCï¼ŒD ä½œä¸ºè´Ÿé›†ï¼›ï¼ˆ3ï¼‰æ ·æœ¬ C ä½œä¸ºæ­£é›†ï¼ŒAï¼ŒBï¼ŒD ä½œä¸ºè´Ÿé›†ï¼›ï¼ˆ4ï¼‰æ ·æœ¬ D ä½œä¸ºæ­£é›†ï¼ŒAï¼ŒBï¼ŒC ä½œä¸ºè´Ÿé›†ã€‚è¿™ç§æ–¹æ³•ï¼Œé’ˆå¯¹ K ä¸ªåˆ†ç±»ï¼Œéœ€è¦è®­ç»ƒ K ä¸ªåˆ†ç±»å™¨ï¼Œåˆ†ç±»é€Ÿåº¦è¾ƒå¿«ï¼Œä½†è®­ç»ƒé€Ÿåº¦è¾ƒæ…¢ï¼Œå› ä¸ºæ¯ä¸ªåˆ†ç±»å™¨éƒ½éœ€è¦å¯¹å…¨éƒ¨æ ·æœ¬è¿›è¡Œè®­ç»ƒï¼Œè€Œä¸”è´Ÿæ ·æœ¬æ•°é‡è¿œå¤§äºæ­£æ ·æœ¬æ•°é‡ï¼Œä¼šé€ æˆæ ·æœ¬ä¸å¯¹ç§°çš„æƒ…å†µï¼Œè€Œä¸”å½“å¢åŠ æ–°çš„åˆ†ç±»ï¼Œæ¯”å¦‚ç¬¬ K+1 ç±»æ—¶ï¼Œéœ€è¦é‡æ–°å¯¹åˆ†ç±»å™¨è¿›è¡Œæ„é€ ã€‚2. ä¸€å¯¹ä¸€æ³•ä¸€å¯¹ä¸€æ³•çš„åˆè¡·æ˜¯æƒ³åœ¨è®­ç»ƒçš„æ—¶å€™æ›´åŠ çµæ´»ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„ä¸¤ç±»æ ·æœ¬ä¹‹é—´æ„é€ ä¸€ä¸ª SVMï¼Œè¿™æ ·é’ˆå¯¹ K ç±»çš„æ ·æœ¬ï¼Œå°±ä¼šæœ‰ C(k,2) ç±»åˆ†ç±»å™¨ã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³è¦åˆ’åˆ† Aã€Bã€C ä¸‰ä¸ªç±»ï¼Œå¯ä»¥æ„é€  3 ä¸ªåˆ†ç±»å™¨ï¼šï¼ˆ1ï¼‰åˆ†ç±»å™¨ 1ï¼šAã€Bï¼›ï¼ˆ2ï¼‰åˆ†ç±»å™¨ 2ï¼šAã€Cï¼›ï¼ˆ3ï¼‰åˆ†ç±»å™¨ 3ï¼šBã€Cã€‚å½“å¯¹ä¸€ä¸ªæœªçŸ¥æ ·æœ¬è¿›è¡Œåˆ†ç±»æ—¶ï¼Œæ¯ä¸€ä¸ªåˆ†ç±»å™¨éƒ½ä¼šæœ‰ä¸€ä¸ªåˆ†ç±»ç»“æœï¼Œå³ä¸º 1 ç¥¨ï¼Œæœ€ç»ˆå¾—ç¥¨æœ€å¤šçš„ç±»åˆ«å°±æ˜¯æ•´ä¸ªæœªçŸ¥æ ·æœ¬çš„ç±»åˆ«ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå¦‚æœæ–°å¢ä¸€ç±»ï¼Œä¸éœ€è¦é‡æ–°è®­ç»ƒæ‰€æœ‰çš„ SVMï¼Œåªéœ€è¦è®­ç»ƒå’Œæ–°å¢è¿™ä¸€ç±»æ ·æœ¬çš„åˆ†ç±»å™¨ã€‚è€Œä¸”è¿™ç§æ–¹å¼åœ¨è®­ç»ƒå•ä¸ª SVM æ¨¡å‹çš„æ—¶å€™ï¼Œè®­ç»ƒé€Ÿåº¦å¿«ã€‚ä½†è¿™ç§æ–¹æ³•çš„ä¸è¶³åœ¨äºï¼Œåˆ†ç±»å™¨çš„ä¸ªæ•°ä¸ K çš„å¹³æ–¹æˆæ­£æ¯”ï¼Œæ‰€ä»¥å½“ K è¾ƒå¤§æ—¶ï¼Œè®­ç»ƒå’Œæµ‹è¯•çš„æ—¶é—´ä¼šæ¯”è¾ƒæ…¢ã€‚æ€»ç»“SVM åˆ†ç±»å™¨ï¼Œå®ƒåœ¨æ–‡æœ¬åˆ†ç±»å°¤å…¶æ˜¯é’ˆå¯¹äºŒåˆ†ç±»ä»»åŠ¡æ€§èƒ½å“è¶Šã€‚åŒæ ·ï¼Œé’ˆå¯¹å¤šåˆ†ç±»çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸€å¯¹å¤šï¼Œæˆ–è€…ä¸€å¯¹ä¸€çš„æ–¹æ³•ï¼Œå¤šä¸ªäºŒå€¼åˆ†ç±»å™¨ç»„åˆæˆä¸€ä¸ªå¤šåˆ†ç±»å™¨ã€‚å¦å¤–å…³äº SVM åˆ†ç±»å™¨çš„æ¦‚å¿µï¼Œæˆ‘å¸Œæœ›ä½ èƒ½æŒæ¡ä»¥ä¸‹çš„ä¸‰ä¸ªç¨‹åº¦ï¼šå®Œå…¨çº¿æ€§å¯åˆ†æƒ…å†µä¸‹çš„çº¿æ€§åˆ†ç±»å™¨ï¼Œä¹Ÿå°±æ˜¯çº¿æ€§å¯åˆ†çš„æƒ…å†µï¼Œæ˜¯æœ€åŸå§‹çš„ SVMï¼Œå®ƒæœ€æ ¸å¿ƒçš„æ€æƒ³å°±æ˜¯æ‰¾åˆ°æœ€å¤§çš„åˆ†ç±»é—´éš”ï¼›å¤§éƒ¨åˆ†çº¿æ€§å¯åˆ†æƒ…å†µä¸‹çš„çº¿æ€§åˆ†ç±»å™¨ï¼Œå¼•å…¥äº†è½¯é—´éš”çš„æ¦‚å¿µã€‚è½¯é—´éš”ï¼Œå°±æ˜¯å…è®¸ä¸€å®šé‡çš„æ ·æœ¬åˆ†ç±»é”™è¯¯ï¼›çº¿æ€§ä¸å¯åˆ†æƒ…å†µä¸‹çš„éçº¿æ€§åˆ†ç±»å™¨ï¼Œå¼•å…¥äº†æ ¸å‡½æ•°ã€‚å®ƒè®©åŸæœ‰çš„æ ·æœ¬ç©ºé—´é€šè¿‡æ ¸å‡½æ•°æŠ•å°„åˆ°äº†ä¸€ä¸ªé«˜ç»´çš„ç©ºé—´ä¸­ï¼Œä»è€Œå˜å¾—çº¿æ€§å¯åˆ†ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"SVM","slug":"SVM","permalink":"cpeixin.cn/tags/SVM/"}]},{"title":"æ•°æ®åˆ†æ-æœ´ç´ è´å¶æ–¯ï¼ˆä¸‹ï¼‰","slug":"æ•°æ®åˆ†æ-æœ´ç´ è´å¶æ–¯ï¼ˆä¸‹ï¼‰","date":"2018-07-21T02:34:38.000Z","updated":"2020-05-01T14:18:06.830Z","comments":true,"path":"2018/07/21/æ•°æ®åˆ†æ-æœ´ç´ è´å¶æ–¯ï¼ˆä¸‹ï¼‰/","link":"","permalink":"cpeixin.cn/2018/07/21/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%EF%BC%88%E4%B8%8B%EF%BC%89/","excerpt":"","text":"æœ´ç´ è´å¶æ–¯åˆ†ç±»æœ€é€‚åˆçš„åœºæ™¯å°±æ˜¯æ–‡æœ¬åˆ†ç±»ã€æƒ…æ„Ÿåˆ†æå’Œåƒåœ¾é‚®ä»¶è¯†åˆ«ã€‚å…¶ä¸­æƒ…æ„Ÿåˆ†æå’Œåƒåœ¾é‚®ä»¶è¯†åˆ«éƒ½æ˜¯é€šè¿‡æ–‡æœ¬æ¥è¿›è¡Œåˆ¤æ–­ã€‚ä»è¿™é‡Œä½ èƒ½çœ‹å‡ºæ¥ï¼Œè¿™ä¸‰ä¸ªåœºæ™¯æœ¬è´¨ä¸Šéƒ½æ˜¯æ–‡æœ¬åˆ†ç±»ï¼Œè¿™ä¹Ÿæ˜¯æœ´ç´ è´å¶æ–¯æœ€æ“…é•¿çš„åœ°æ–¹ã€‚æ‰€ä»¥æœ´ç´ è´å¶æ–¯ä¹Ÿå¸¸ç”¨äºè‡ªç„¶è¯­è¨€å¤„ç† NLP çš„å·¥å…·ã€‚ä»Šå¤©æˆ‘å¸¦ä½ ä¸€èµ·ä½¿ç”¨æœ´ç´ è´å¶æ–¯åšä¸‹æ–‡æ¡£åˆ†ç±»çš„é¡¹ç›®ï¼Œæœ€é‡è¦çš„å·¥å…·å°±æ˜¯ sklearn è¿™ä¸ªæœºå™¨å­¦ä¹ ç¥å™¨ã€‚sklearnæœºå™¨å­¦ä¹ åŒ…sklearn çš„å…¨ç§°å« Scikit-learnï¼Œå®ƒç»™æˆ‘ä»¬æä¾›äº† 3 ä¸ªæœ´ç´ è´å¶æ–¯åˆ†ç±»ç®—æ³•ï¼Œåˆ†åˆ«æ˜¯é«˜æ–¯æœ´ç´ è´å¶æ–¯ï¼ˆGaussianNBï¼‰ã€å¤šé¡¹å¼æœ´ç´ è´å¶æ–¯ï¼ˆMultinomialNBï¼‰å’Œä¼¯åŠªåˆ©æœ´ç´ è´å¶æ–¯ï¼ˆBernoulliNBï¼‰ã€‚è¿™ä¸‰ç§ç®—æ³•é€‚åˆåº”ç”¨åœ¨ä¸åŒçš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥æ ¹æ®ç‰¹å¾å˜é‡çš„ä¸åŒé€‰æ‹©ä¸åŒçš„ç®—æ³•ï¼šé«˜æ–¯æœ´ç´ è´å¶æ–¯ï¼šç‰¹å¾å˜é‡æ˜¯è¿ç»­å˜é‡ï¼Œç¬¦åˆé«˜æ–¯åˆ†å¸ƒï¼Œæ¯”å¦‚è¯´äººçš„èº«é«˜ï¼Œç‰©ä½“çš„é•¿åº¦ã€‚å¤šé¡¹å¼æœ´ç´ è´å¶æ–¯ï¼šç‰¹å¾å˜é‡æ˜¯ç¦»æ•£å˜é‡ï¼Œç¬¦åˆå¤šé¡¹åˆ†å¸ƒï¼Œåœ¨æ–‡æ¡£åˆ†ç±»ä¸­ç‰¹å¾å˜é‡ä½“ç°åœ¨ä¸€ä¸ªå•è¯å‡ºç°çš„æ¬¡æ•°ï¼Œæˆ–è€…æ˜¯å•è¯çš„ TF-IDF å€¼ç­‰ã€‚ä¼¯åŠªåˆ©æœ´ç´ è´å¶æ–¯ï¼šç‰¹å¾å˜é‡æ˜¯å¸ƒå°”å˜é‡ï¼Œç¬¦åˆ 0/1 åˆ†å¸ƒï¼Œåœ¨æ–‡æ¡£åˆ†ç±»ä¸­ç‰¹å¾æ˜¯å•è¯æ˜¯å¦å‡ºç°ã€‚ä¼¯åŠªåˆ©æœ´ç´ è´å¶æ–¯æ˜¯ä»¥æ–‡ä»¶ä¸ºç²’åº¦ï¼Œå¦‚æœè¯¥å•è¯åœ¨æŸæ–‡ä»¶ä¸­å‡ºç°äº†å³ä¸º 1ï¼Œå¦åˆ™ä¸º 0ã€‚è€Œå¤šé¡¹å¼æœ´ç´ è´å¶æ–¯æ˜¯ä»¥å•è¯ä¸ºç²’åº¦ï¼Œä¼šè®¡ç®—åœ¨æŸä¸ªæ–‡ä»¶ä¸­çš„å…·ä½“æ¬¡æ•°ã€‚è€Œé«˜æ–¯æœ´ç´ è´å¶æ–¯é€‚åˆå¤„ç†ç‰¹å¾å˜é‡æ˜¯è¿ç»­å˜é‡ï¼Œä¸”ç¬¦åˆæ­£æ€åˆ†å¸ƒï¼ˆé«˜æ–¯åˆ†å¸ƒï¼‰çš„æƒ…å†µã€‚æ¯”å¦‚èº«é«˜ã€ä½“é‡è¿™ç§è‡ªç„¶ç•Œçš„ç°è±¡å°±æ¯”è¾ƒé€‚åˆç”¨é«˜æ–¯æœ´ç´ è´å¶æ–¯æ¥å¤„ç†ã€‚è€Œæ–‡æœ¬åˆ†ç±»æ˜¯ä½¿ç”¨å¤šé¡¹å¼æœ´ç´ è´å¶æ–¯æˆ–è€…ä¼¯åŠªåˆ©æœ´ç´ è´å¶æ–¯ã€‚TF-IDF å€¼æˆ‘åœ¨å¤šé¡¹å¼æœ´ç´ è´å¶æ–¯ä¸­æåˆ°äº†â€œè¯çš„ TF-IDF å€¼â€ï¼Œå¦‚ä½•ç†è§£è¿™ä¸ªæ¦‚å¿µå‘¢ï¼ŸTF-IDF æ˜¯ä¸€ä¸ªç»Ÿè®¡æ–¹æ³•ï¼Œç”¨æ¥è¯„ä¼°æŸä¸ªè¯è¯­å¯¹äºä¸€ä¸ªæ–‡ä»¶é›†æˆ–æ–‡æ¡£åº“ä¸­çš„å…¶ä¸­ä¸€ä»½æ–‡ä»¶çš„é‡è¦ç¨‹åº¦ã€‚TF-IDF å®é™…ä¸Šæ˜¯ä¸¤ä¸ªè¯ç»„ Term Frequency å’Œ Inverse Document Frequency çš„æ€»ç§°ï¼Œä¸¤è€…ç¼©å†™ä¸º TF å’Œ IDFï¼Œåˆ†åˆ«ä»£è¡¨äº†è¯é¢‘å’Œé€†å‘æ–‡æ¡£é¢‘ç‡ã€‚è¯é¢‘ TF è®¡ç®—äº†ä¸€ä¸ªå•è¯åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°ï¼Œå®ƒè®¤ä¸ºä¸€ä¸ªå•è¯çš„é‡è¦æ€§å’Œå®ƒåœ¨æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°å‘ˆæ­£æ¯”ã€‚é€†å‘æ–‡æ¡£é¢‘ç‡ IDFï¼Œæ˜¯æŒ‡ä¸€ä¸ªå•è¯åœ¨æ–‡æ¡£ä¸­çš„åŒºåˆ†åº¦ã€‚å®ƒè®¤ä¸ºä¸€ä¸ªå•è¯å‡ºç°åœ¨çš„æ–‡æ¡£æ•°è¶Šå°‘ï¼Œå°±è¶Šèƒ½é€šè¿‡è¿™ä¸ªå•è¯æŠŠè¯¥æ–‡æ¡£å’Œå…¶ä»–æ–‡æ¡£åŒºåˆ†å¼€ã€‚IDF è¶Šå¤§å°±ä»£è¡¨è¯¥å•è¯çš„åŒºåˆ†åº¦è¶Šå¤§ã€‚æ‰€ä»¥ TF-IDF å®é™…ä¸Šæ˜¯è¯é¢‘ TF å’Œé€†å‘æ–‡æ¡£é¢‘ç‡ IDF çš„ä¹˜ç§¯ã€‚è¿™æ ·æˆ‘ä»¬å€¾å‘äºæ‰¾åˆ° TF å’Œ IDF å–å€¼éƒ½é«˜çš„å•è¯ä½œä¸ºåŒºåˆ†ï¼Œå³è¿™ä¸ªå•è¯åœ¨ä¸€ä¸ªæ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°å¤šï¼ŒåŒæ—¶åˆå¾ˆå°‘å‡ºç°åœ¨å…¶ä»–æ–‡æ¡£ä¸­ã€‚è¿™æ ·çš„å•è¯é€‚åˆç”¨äºåˆ†ç±»ã€‚TF-IDF å¦‚ä½•è®¡ç®—é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹è¯é¢‘ TF å’Œé€†å‘æ–‡æ¡£æ¦‚ç‡ IDF çš„å…¬å¼ã€‚ä¸ºä»€ä¹ˆ IDF çš„åˆ†æ¯ä¸­ï¼Œå•è¯å‡ºç°çš„æ–‡æ¡£æ•°è¦åŠ  1 å‘¢ï¼Ÿå› ä¸ºæœ‰äº›å•è¯å¯èƒ½ä¸ä¼šå­˜åœ¨æ–‡æ¡£ä¸­ï¼Œä¸ºäº†é¿å…åˆ†æ¯ä¸º 0ï¼Œç»Ÿä¸€ç»™å•è¯å‡ºç°çš„æ–‡æ¡£æ•°éƒ½åŠ  1ã€‚TF-IDF=TF*IDFä½ å¯ä»¥çœ‹åˆ°ï¼ŒTF-IDF å€¼å°±æ˜¯ TF ä¸ IDF çš„ä¹˜ç§¯, è¿™æ ·å¯ä»¥æ›´å‡†ç¡®åœ°å¯¹æ–‡æ¡£è¿›è¡Œåˆ†ç±»ã€‚æ¯”å¦‚â€œæˆ‘â€è¿™æ ·çš„é«˜é¢‘å•è¯ï¼Œè™½ç„¶ TF è¯é¢‘é«˜ï¼Œä½†æ˜¯ IDF å€¼å¾ˆä½ï¼Œæ•´ä½“çš„ TF-IDF ä¹Ÿä¸é«˜ã€‚æˆ‘åœ¨è¿™é‡Œä¸¾ä¸ªä¾‹å­ã€‚å‡è®¾ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œä¸€å…±æœ‰ 10 ç¯‡æ–‡æ¡£ï¼Œå…¶ä¸­ä¸€ç¯‡æ–‡æ¡£æœ‰ 1000 ä¸ªå•è¯ï¼Œâ€œthisâ€è¿™ä¸ªå•è¯å‡ºç° 20 æ¬¡ï¼Œâ€œbayesâ€å‡ºç°äº† 5 æ¬¡ã€‚â€œthisâ€åœ¨æ‰€æœ‰æ–‡æ¡£ä¸­å‡å‡ºç°è¿‡ï¼Œè€Œâ€œbayesâ€åªåœ¨ 2 ç¯‡æ–‡æ¡£ä¸­å‡ºç°è¿‡ã€‚æˆ‘ä»¬æ¥è®¡ç®—ä¸€ä¸‹è¿™ä¸¤ä¸ªè¯è¯­çš„ TF-IDF å€¼ã€‚é’ˆå¯¹â€œthisâ€ï¼Œè®¡ç®— TF-IDF å€¼ï¼šæ‰€ä»¥ TF-IDF=0.02(-0.0414)=-8.28e-4ã€‚é’ˆå¯¹â€œbayesâ€ï¼Œè®¡ç®— TF-IDF å€¼ï¼šTF-IDF=0.0050.5229=2.61e-3ã€‚å¾ˆæ˜æ˜¾â€œbayesâ€çš„ TF-IDF å€¼è¦å¤§äºâ€œthisâ€çš„ TF-IDF å€¼ã€‚è¿™å°±è¯´æ˜ç”¨â€œbayesâ€è¿™ä¸ªå•è¯åšåŒºåˆ†æ¯”å•è¯â€œthisâ€è¦å¥½ã€‚å¦‚ä½•æ±‚ TF-IDFåœ¨ sklearn ä¸­æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ TfidfVectorizer ç±»ï¼Œå®ƒå¯ä»¥å¸®æˆ‘ä»¬è®¡ç®—å•è¯ TF-IDF å‘é‡çš„å€¼ã€‚åœ¨è¿™ä¸ªç±»ä¸­ï¼Œå– sklearn è®¡ç®—çš„å¯¹æ•° log æ—¶ï¼Œåº•æ•°æ˜¯ eï¼Œä¸æ˜¯ 10ã€‚ä¸‹é¢æˆ‘æ¥è®²ä¸‹å¦‚ä½•åˆ›å»º TfidfVectorizer ç±»ã€‚åˆ›å»º TfidfVectorizer çš„æ–¹æ³•æ˜¯ï¼š1TfidfVectorizer(stop_words=stop_words, token_pattern=token_pattern)æˆ‘ä»¬åœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œæœ‰ä¸¤ä¸ªæ„é€ å‚æ•°ï¼Œå¯ä»¥è‡ªå®šä¹‰åœç”¨è¯ stop_words å’Œè§„å¾‹è§„åˆ™ token_patternã€‚éœ€è¦æ³¨æ„çš„æ˜¯ä¼ é€’çš„æ•°æ®ç»“æ„ï¼Œåœç”¨è¯ stop_words æ˜¯ä¸€ä¸ªåˆ—è¡¨ List ç±»å‹ï¼Œè€Œè¿‡æ»¤è§„åˆ™ token_pattern æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚ä»€ä¹ˆæ˜¯åœç”¨è¯ï¼Ÿåœç”¨è¯å°±æ˜¯åœ¨åˆ†ç±»ä¸­æ²¡æœ‰ç”¨çš„è¯ï¼Œè¿™äº›è¯ä¸€èˆ¬è¯é¢‘ TF é«˜ï¼Œä½†æ˜¯ IDF å¾ˆä½ï¼Œèµ·ä¸åˆ°åˆ†ç±»çš„ä½œç”¨ã€‚ä¸ºäº†èŠ‚çœç©ºé—´å’Œè®¡ç®—æ—¶é—´ï¼Œæˆ‘ä»¬æŠŠè¿™äº›è¯ä½œä¸ºåœç”¨è¯ stop wordsï¼Œå‘Šè¯‰æœºå™¨è¿™äº›è¯ä¸éœ€è¦å¸®æˆ‘è®¡ç®—ã€‚å½“æˆ‘ä»¬åˆ›å»ºå¥½ TF-IDF å‘é‡ç±»å‹æ—¶ï¼Œå¯ä»¥ç”¨ fit_transform å¸®æˆ‘ä»¬è®¡ç®—ï¼Œè¿”å›ç»™æˆ‘ä»¬æ–‡æœ¬çŸ©é˜µï¼Œè¯¥çŸ©é˜µè¡¨ç¤ºäº†æ¯ä¸ªå•è¯åœ¨æ¯ä¸ªæ–‡æ¡£ä¸­çš„ TF-IDF å€¼ã€‚åœ¨æˆ‘ä»¬è¿›è¡Œ fit_transform æ‹Ÿåˆæ¨¡å‹åï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æ›´å¤šçš„ TF-IDF å‘é‡å±æ€§ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°è¯æ±‡çš„å¯¹åº”å…³ç³»ï¼ˆå­—å…¸ç±»å‹ï¼‰å’Œå‘é‡çš„ IDF å€¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è·å–è®¾ç½®çš„åœç”¨è¯ stop_wordsã€‚å¦‚ä½•å¯¹æ–‡æ¡£è¿›è¡Œåˆ†ç±»å¦‚æœæˆ‘ä»¬è¦å¯¹æ–‡æ¡£è¿›è¡Œåˆ†ç±»ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„é˜¶æ®µï¼šåŸºäºåˆ†è¯çš„æ•°æ®å‡†å¤‡ï¼ŒåŒ…æ‹¬åˆ†è¯ã€å•è¯æƒé‡è®¡ç®—ã€å»æ‰åœç”¨è¯ï¼›åº”ç”¨æœ´ç´ è´å¶æ–¯åˆ†ç±»è¿›è¡Œåˆ†ç±»ï¼Œé¦–å…ˆé€šè¿‡è®­ç»ƒé›†å¾—åˆ°æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ï¼Œç„¶åå°†åˆ†ç±»å™¨åº”ç”¨äºæµ‹è¯•é›†ï¼Œå¹¶ä¸å®é™…ç»“æœåšå¯¹æ¯”ï¼Œæœ€ç»ˆå¾—åˆ°æµ‹è¯•é›†çš„åˆ†ç±»å‡†ç¡®ç‡ã€‚æ•´ä¸ªæµç¨‹å°†åˆ†æˆä¸‹é¢å‡ ä¸ªæ¨¡å—ï¼šæ¨¡å— 1ï¼šå¯¹æ–‡æ¡£è¿›è¡Œåˆ†è¯åœ¨å‡†å¤‡é˜¶æ®µé‡Œï¼Œæœ€é‡è¦çš„å°±æ˜¯åˆ†è¯ã€‚é‚£ä¹ˆå¦‚æœç»™æ–‡æ¡£è¿›è¡Œåˆ†è¯å‘¢ï¼Ÿè‹±æ–‡æ–‡æ¡£å’Œä¸­æ–‡æ–‡æ¡£æ‰€ä½¿ç”¨çš„åˆ†è¯å·¥å…·ä¸åŒã€‚åœ¨è‹±æ–‡æ–‡æ¡£ä¸­ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ NTLK åŒ…ã€‚NTLK åŒ…ä¸­åŒ…å«äº†è‹±æ–‡çš„åœç”¨è¯ stop wordsã€åˆ†è¯å’Œæ ‡æ³¨æ–¹æ³•ã€‚1234import nltkword_list = nltk.word_tokenize(text) #åˆ†è¯nltk.pos_tag(word_list) #æ ‡æ³¨å•è¯çš„è¯æ€§åœ¨ä¸­æ–‡æ–‡æ¡£ä¸­ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ jieba åŒ…ã€‚jieba åŒ…ä¸­åŒ…å«äº†ä¸­æ–‡çš„åœç”¨è¯ stop words å’Œåˆ†è¯æ–¹æ³•ã€‚123import jiebaword_list = jieba.cut (text) #ä¸­æ–‡åˆ†è¯æ¨¡å— 2ï¼šåŠ è½½åœç”¨è¯è¡¨æˆ‘ä»¬éœ€è¦è‡ªå·±è¯»å–åœç”¨è¯è¡¨æ–‡ä»¶ï¼Œä»ç½‘ä¸Šå¯ä»¥æ‰¾åˆ°ä¸­æ–‡å¸¸ç”¨çš„åœç”¨è¯ä¿å­˜åœ¨ stop_words.txtï¼Œç„¶ååˆ©ç”¨ Python çš„æ–‡ä»¶è¯»å–å‡½æ•°è¯»å–æ–‡ä»¶ï¼Œä¿å­˜åœ¨ stop_words æ•°ç»„ä¸­ã€‚1stop_words = [line.strip().decode('utf-8') for line in io.open('stop_words.txt').readlines()]æ¨¡å— 3ï¼šè®¡ç®—å•è¯çš„æƒé‡è¿™é‡Œæˆ‘ä»¬ç”¨åˆ° sklearn é‡Œçš„ TfidfVectorizer ç±»ï¼Œä¸Šé¢æˆ‘ä»¬ä»‹ç»è¿‡å®ƒä½¿ç”¨çš„æ–¹æ³•ã€‚ç›´æ¥åˆ›å»º TfidfVectorizer ç±»ï¼Œç„¶åä½¿ç”¨ fit_transform æ–¹æ³•è¿›è¡Œæ‹Ÿåˆï¼Œå¾—åˆ° TF-IDF ç‰¹å¾ç©ºé—´ featuresï¼Œä½ å¯ä»¥ç†è§£ä¸ºé€‰å‡ºæ¥çš„åˆ†è¯å°±æ˜¯ç‰¹å¾ã€‚æˆ‘ä»¬è®¡ç®—è¿™äº›ç‰¹å¾åœ¨æ–‡æ¡£ä¸Šçš„ç‰¹å¾å‘é‡ï¼Œå¾—åˆ°ç‰¹å¾ç©ºé—´ featuresã€‚123tf = TfidfVectorizer(stop_words=stop_words, max_df=0.5)features = tf.fit_transform(train_contents)è¿™é‡Œ max_df å‚æ•°ç”¨æ¥æè¿°å•è¯åœ¨æ–‡æ¡£ä¸­çš„æœ€é«˜å‡ºç°ç‡ã€‚å‡è®¾ max_df=0.5ï¼Œä»£è¡¨ä¸€ä¸ªå•è¯åœ¨ 50% çš„æ–‡æ¡£ä¸­éƒ½å‡ºç°è¿‡äº†ï¼Œé‚£ä¹ˆå®ƒåªæºå¸¦äº†éå¸¸å°‘çš„ä¿¡æ¯ï¼Œå› æ­¤å°±ä¸ä½œä¸ºåˆ†è¯ç»Ÿè®¡ã€‚ä¸€èˆ¬å¾ˆå°‘è®¾ç½® min_dfï¼Œå› ä¸º min_df é€šå¸¸éƒ½ä¼šå¾ˆå°ã€‚æ¨¡å— 4ï¼šç”Ÿæˆæœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨æˆ‘ä»¬å°†ç‰¹å¾è®­ç»ƒé›†çš„ç‰¹å¾ç©ºé—´ train_featuresï¼Œä»¥åŠè®­ç»ƒé›†å¯¹åº”çš„åˆ†ç±» train_labels ä¼ é€’ç»™è´å¶æ–¯åˆ†ç±»å™¨ clfï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç¬¦åˆç‰¹å¾ç©ºé—´å’Œå¯¹åº”åˆ†ç±»çš„åˆ†ç±»å™¨ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯å¤šé¡¹å¼è´å¶æ–¯åˆ†ç±»å™¨ï¼Œå…¶ä¸­ alpha ä¸ºå¹³æ»‘å‚æ•°ã€‚ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¹³æ»‘å‘¢ï¼Ÿå› ä¸ºå¦‚æœä¸€ä¸ªå•è¯åœ¨è®­ç»ƒæ ·æœ¬ä¸­æ²¡æœ‰å‡ºç°ï¼Œè¿™ä¸ªå•è¯çš„æ¦‚ç‡å°±ä¼šè¢«è®¡ç®—ä¸º 0ã€‚ä½†è®­ç»ƒé›†æ ·æœ¬åªæ˜¯æ•´ä½“çš„æŠ½æ ·æƒ…å†µï¼Œæˆ‘ä»¬ä¸èƒ½å› ä¸ºä¸€ä¸ªäº‹ä»¶æ²¡æœ‰è§‚å¯Ÿåˆ°ï¼Œå°±è®¤ä¸ºæ•´ä¸ªäº‹ä»¶çš„æ¦‚ç‡ä¸º 0ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åšå¹³æ»‘å¤„ç†ã€‚å½“ alpha=1 æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ Laplace å¹³æ»‘ã€‚Laplace å¹³æ»‘å°±æ˜¯é‡‡ç”¨åŠ  1 çš„æ–¹å¼ï¼Œæ¥ç»Ÿè®¡æ²¡æœ‰å‡ºç°è¿‡çš„å•è¯çš„æ¦‚ç‡ã€‚è¿™æ ·å½“è®­ç»ƒæ ·æœ¬å¾ˆå¤§çš„æ—¶å€™ï¼ŒåŠ  1 å¾—åˆ°çš„æ¦‚ç‡å˜åŒ–å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œä¹ŸåŒæ—¶é¿å…äº†é›¶æ¦‚ç‡çš„é—®é¢˜ã€‚å½“ 0&lt; alpha &lt;1 æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ Lidstone å¹³æ»‘ã€‚å¯¹äº Lidstone å¹³æ»‘æ¥è¯´ï¼Œalpha è¶Šå°ï¼Œè¿­ä»£æ¬¡æ•°è¶Šå¤šï¼Œç²¾åº¦è¶Šé«˜ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½® alpha ä¸º 0.001ã€‚1234# å¤šé¡¹å¼è´å¶æ–¯åˆ†ç±»å™¨from sklearn.naive_bayes import MultinomialNB clf = MultinomialNB(alpha=0.001).fit(train_features, train_labels)æ¨¡å— 5ï¼šä½¿ç”¨ç”Ÿæˆçš„åˆ†ç±»å™¨åšé¢„æµ‹é¦–å…ˆæˆ‘ä»¬éœ€è¦å¾—åˆ°æµ‹è¯•é›†çš„ç‰¹å¾çŸ©é˜µã€‚æ–¹æ³•æ˜¯ç”¨è®­ç»ƒé›†çš„åˆ†è¯åˆ›å»ºä¸€ä¸ª TfidfVectorizer ç±»ï¼Œä½¿ç”¨åŒæ ·çš„ stop_words å’Œ max_dfï¼Œç„¶åç”¨è¿™ä¸ª TfidfVectorizer ç±»å¯¹æµ‹è¯•é›†çš„å†…å®¹è¿›è¡Œ fit_transform æ‹Ÿåˆï¼Œå¾—åˆ°æµ‹è¯•é›†çš„ç‰¹å¾çŸ©é˜µ test_featuresã€‚123test_tf = TfidfVectorizer(stop_words=stop_words, max_df=0.5, vocabulary=train_vocabulary)test_features=test_tf.fit_transform(test_contents)ç„¶åæˆ‘ä»¬ç”¨è®­ç»ƒå¥½çš„åˆ†ç±»å™¨å¯¹æ–°æ•°æ®åšé¢„æµ‹ã€‚æ–¹æ³•æ˜¯ä½¿ç”¨ predict å‡½æ•°ï¼Œä¼ å…¥æµ‹è¯•é›†çš„ç‰¹å¾çŸ©é˜µ test_featuresï¼Œå¾—åˆ°åˆ†ç±»ç»“æœ predicted_labelsã€‚predict å‡½æ•°åšçš„å·¥ä½œå°±æ˜¯æ±‚è§£æ‰€æœ‰åéªŒæ¦‚ç‡å¹¶æ‰¾å‡ºæœ€å¤§çš„é‚£ä¸ªã€‚12predicted_labels=clf.predict(test_features)æ¨¡å— 6ï¼šè®¡ç®—å‡†ç¡®ç‡è®¡ç®—å‡†ç¡®ç‡å®é™…ä¸Šæ˜¯å¯¹åˆ†ç±»æ¨¡å‹çš„è¯„ä¼°ã€‚æˆ‘ä»¬å¯ä»¥è°ƒç”¨ sklearn ä¸­çš„ metrics åŒ…ï¼Œåœ¨ metrics ä¸­æä¾›äº† accuracy_score å‡½æ•°ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹å®é™…ç»“æœå’Œé¢„æµ‹çš„ç»“æœåšå¯¹æ¯”ï¼Œç»™å‡ºæ¨¡å‹çš„å‡†ç¡®ç‡ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š123from sklearn import metricsprint metrics.accuracy_score(test_labels, predicted_labels)æ•°æ®æŒ–æ˜ç¥å™¨ sklearnä»æ•°æ®æŒ–æ˜çš„æµç¨‹æ¥çœ‹ï¼Œä¸€èˆ¬åŒ…æ‹¬äº†è·å–æ•°æ®ã€æ•°æ®æ¸…æ´—ã€æ¨¡å‹è®­ç»ƒã€æ¨¡å‹è¯„ä¼°å’Œæ¨¡å‹éƒ¨ç½²è¿™å‡ ä¸ªè¿‡ç¨‹ã€‚sklearn ä¸­åŒ…å«äº†å¤§é‡çš„æ•°æ®æŒ–æ˜ç®—æ³•ï¼Œæ¯”å¦‚ä¸‰ç§æœ´ç´ è´å¶æ–¯ç®—æ³•ï¼Œæˆ‘ä»¬åªéœ€è¦äº†è§£ä¸åŒç®—æ³•çš„é€‚ç”¨æ¡ä»¶ï¼Œä»¥åŠåˆ›å»ºæ—¶æ‰€éœ€çš„å‚æ•°ï¼Œå°±å¯ä»¥ç”¨æ¨¡å‹å¸®æˆ‘ä»¬è¿›è¡Œè®­ç»ƒã€‚åœ¨æ¨¡å‹è¯„ä¼°ä¸­ï¼Œsklearn æä¾›äº† metrics åŒ…ï¼Œå¸®æˆ‘ä»¬å¯¹é¢„æµ‹ç»“æœä¸å®é™…ç»“æœè¿›è¡Œè¯„ä¼°ã€‚åœ¨æ–‡æ¡£åˆ†ç±»çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é’ˆå¯¹æ–‡æ¡£çš„ç‰¹ç‚¹ï¼Œç»™å‡ºäº†åŸºäºåˆ†è¯çš„å‡†å¤‡æµç¨‹ã€‚ä¸€èˆ¬æ¥è¯´ NTLK åŒ…é€‚ç”¨äºè‹±æ–‡æ–‡æ¡£ï¼Œè€Œ jieba é€‚ç”¨äºä¸­æ–‡æ–‡æ¡£ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®æ–‡æ¡£é€‰æ‹©ä¸åŒçš„åŒ…ï¼Œå¯¹æ–‡æ¡£æå–åˆ†è¯ã€‚è¿™äº›åˆ†è¯å°±æ˜¯è´å¶æ–¯åˆ†ç±»ä¸­æœ€é‡è¦çš„ç‰¹å¾å±æ€§ã€‚åŸºäºè¿™äº›åˆ†è¯ï¼Œæˆ‘ä»¬å¾—åˆ°åˆ†è¯çš„æƒé‡ï¼Œå³ç‰¹å¾çŸ©é˜µã€‚é€šè¿‡ç‰¹å¾çŸ©é˜µä¸åˆ†ç±»ç»“æœï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºå‡ºæœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ï¼Œç„¶åç”¨åˆ†ç±»å™¨è¿›è¡Œé¢„æµ‹ï¼Œæœ€åé¢„æµ‹ç»“æœä¸å®é™…ç»“æœåšå¯¹æ¯”å³å¯ä»¥å¾—åˆ°åˆ†ç±»å™¨åœ¨æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡ã€‚å®æˆ˜æ–‡æ¡£å…±æœ‰ 4 ç§ç±»å‹ï¼šå¥³æ€§ã€ä½“è‚²ã€æ–‡å­¦ã€æ ¡å›­æ ¹æ®ä¸‹é¢ç»™å®šçš„è®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®è¿›è¡Œ æœ´ç´ è´å¶æ–¯æ–‡æœ¬åˆ†ç±»å®æˆ˜ã€‚æ•°æ®åœ°å€ï¼šhttps://github.com/cystanford/text_classification/tree/master/text classification12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182# coding: utf-8# ä¸­æ–‡æ–‡æœ¬åˆ†ç±»import osimport jiebaimport warningsfrom sklearn.feature_extraction.text import TfidfVectorizerfrom sklearn.naive_bayes import MultinomialNBfrom sklearn import metricswarnings.filterwarnings('ignore')def cut_words(file_path): \"\"\" å¯¹æ–‡æœ¬è¿›è¡Œåˆ‡è¯ :param file_path: txtæ–‡æœ¬è·¯å¾„ :return: ç”¨ç©ºæ ¼åˆ†è¯çš„å­—ç¬¦ä¸² \"\"\" text_with_spaces = '' with open(file_path, 'r', encoding='gb18030', errors='ignore') as f: text = f.read() textcut = jieba.cut(text) for word in textcut: text_with_spaces += word + ' ' return text_with_spacestext_category = ['å¥³æ€§', 'ä½“è‚²', 'æ–‡å­¦', 'æ ¡å›­']def loadfile(data_path): \"\"\" å°†è·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åŠ è½½ :param file_dir: ä¿å­˜txtæ–‡ä»¶ç›®å½• :param label: æ–‡æ¡£æ ‡ç­¾ :return: åˆ†è¯åçš„æ–‡æ¡£åˆ—è¡¨å’Œæ ‡ç­¾ \"\"\" words_list = [] labels = [] for category in text_category: file_path = data_path + category + '/' file_list = os.listdir(file_path) for file in file_list: words_list.append(cut_words(file_path+file)) labels.append(category) return words_list, labelsdef get_stop_words(stop_words_path): stop_words = open(stop_words_path, 'r', encoding='utf-8').read() stop_words = stop_words.encode('utf-8').decode('utf-8-sig') # åˆ—è¡¨å¤´éƒ¨\\ufeffå¤„ç† stop_words = stop_words.split('\\n') # æ ¹æ®åˆ†éš”ç¬¦åˆ†éš” return stop_wordsif __name__ == '__main__': train_data_path = 'train' + '/' test_data_path = 'test' + '/' stop_words_path = 'stop/stopword.txt' train_words_list, train_labels = loadfile(train_data_path) test_words_list, test_labels = loadfile(test_data_path) stop_words = get_stop_words(stop_words_path) tf = TfidfVectorizer(stop_words=stop_words, max_df=0.5) train_features = tf.fit_transform(train_words_list) # ä¸Šé¢fitè¿‡äº†ï¼Œè¿™é‡Œtransform test_features = tf.transform(test_words_list) # å¤šé¡¹å¼è´å¶æ–¯åˆ†ç±»å™¨ from sklearn.naive_bayes import MultinomialNB clf = MultinomialNB(alpha=0.001).fit(train_features, train_labels) predicted_labels = clf.predict(test_features) # è®¡ç®—å‡†ç¡®ç‡ print('å‡†ç¡®ç‡ä¸ºï¼š', metrics.accuracy_score(test_labels, predicted_labels))","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Naive Bayes","slug":"Naive-Bayes","permalink":"cpeixin.cn/tags/Naive-Bayes/"}]},{"title":"æ•°æ®åˆ†æ-æœ´ç´ è´å¶æ–¯ï¼ˆä¸Šï¼‰","slug":"æ•°æ®åˆ†æ-æœ´ç´ è´å¶æ–¯ï¼ˆä¸Šï¼‰","date":"2018-07-20T15:19:16.000Z","updated":"2020-05-01T14:18:19.882Z","comments":true,"path":"2018/07/20/æ•°æ®åˆ†æ-æœ´ç´ è´å¶æ–¯ï¼ˆä¸Šï¼‰/","link":"","permalink":"cpeixin.cn/2018/07/20/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%EF%BC%88%E4%B8%8A%EF%BC%89/","excerpt":"","text":"è´å¶æ–¯åŸç†è´å¶æ–¯åŸç†æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿè´å¶æ–¯ä¸ºäº†è§£å†³ä¸€ä¸ªå«â€œé€†å‘æ¦‚ç‡â€é—®é¢˜å†™äº†ä¸€ç¯‡æ–‡ç« ï¼Œå°è¯•è§£ç­”åœ¨æ²¡æœ‰å¤ªå¤šå¯é è¯æ®çš„æƒ…å†µä¸‹ï¼Œæ€æ ·åšå‡ºæ›´ç¬¦åˆæ•°å­¦é€»è¾‘çš„æ¨æµ‹ã€‚ä»€ä¹ˆæ˜¯â€œé€†å‘æ¦‚ç‡â€å‘¢ï¼Ÿæ‰€è°“â€œé€†å‘æ¦‚ç‡â€æ˜¯ç›¸å¯¹â€œæ­£å‘æ¦‚ç‡â€è€Œè¨€ã€‚æ­£å‘æ¦‚ç‡çš„é—®é¢˜å¾ˆå®¹æ˜“ç†è§£ï¼Œæ¯”å¦‚æˆ‘ä»¬å·²ç»çŸ¥é“è¢‹å­é‡Œé¢æœ‰ N ä¸ªçƒï¼Œä¸æ˜¯é»‘çƒå°±æ˜¯ç™½çƒï¼Œå…¶ä¸­ M ä¸ªæ˜¯é»‘çƒï¼Œé‚£ä¹ˆæŠŠæ‰‹ä¼¸è¿›å»æ‘¸ä¸€ä¸ªçƒï¼Œå°±èƒ½çŸ¥é“æ‘¸å‡ºé»‘çƒçš„æ¦‚ç‡æ˜¯å¤šå°‘ã€‚ä½†è¿™ç§æƒ…å†µå¾€å¾€æ˜¯ä¸Šå¸è§†è§’ï¼Œå³äº†è§£äº†äº‹æƒ…çš„å…¨è²Œå†åšåˆ¤æ–­ã€‚åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬å¾ˆéš¾çŸ¥é“äº‹æƒ…çš„å…¨è²Œã€‚è´å¶æ–¯åˆ™ä»å®é™…åœºæ™¯å‡ºå‘ï¼Œæäº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæˆ‘ä»¬äº‹å…ˆä¸çŸ¥é“è¢‹å­é‡Œé¢é»‘çƒå’Œç™½çƒçš„æ¯”ä¾‹ï¼Œè€Œæ˜¯é€šè¿‡æˆ‘ä»¬æ‘¸å‡ºæ¥çš„çƒçš„é¢œè‰²ï¼Œèƒ½åˆ¤æ–­å‡ºè¢‹å­é‡Œé¢é»‘ç™½çƒçš„æ¯”ä¾‹ä¹ˆï¼Ÿæ­£æ˜¯è¿™æ ·çš„ä¸€ä¸ªé—®é¢˜ï¼Œå½±å“äº†æ¥ä¸‹æ¥è¿‘ 200 å¹´çš„ç»Ÿè®¡å­¦ç†è®ºã€‚è¿™æ˜¯å› ä¸ºï¼Œè´å¶æ–¯åŸç†ä¸å…¶ä»–ç»Ÿè®¡å­¦æ¨æ–­æ–¹æ³•æˆªç„¶ä¸åŒï¼Œå®ƒæ˜¯å»ºç«‹åœ¨ä¸»è§‚åˆ¤æ–­çš„åŸºç¡€ä¸Šï¼šåœ¨æˆ‘ä»¬ä¸äº†è§£æ‰€æœ‰å®¢è§‚äº‹å®çš„æƒ…å†µä¸‹ï¼ŒåŒæ ·å¯ä»¥å…ˆä¼°è®¡ä¸€ä¸ªå€¼ï¼Œç„¶åæ ¹æ®å®é™…ç»“æœä¸æ–­è¿›è¡Œä¿®æ­£ã€‚æˆ‘ä»¬ç”¨ä¸€ä¸ªé¢˜ç›®æ¥ä½“ä¼šä¸‹ï¼šå‡è®¾æœ‰ä¸€ç§ç—…å«åšâ€œè´å¶æ­»â€ï¼Œå®ƒçš„å‘ç—…ç‡æ˜¯ä¸‡åˆ†ä¹‹ä¸€ï¼Œå³ 10000 äººä¸­ä¼šæœ‰ 1 ä¸ªäººå¾—ç—…ã€‚ç°æœ‰ä¸€ç§æµ‹è¯•å¯ä»¥æ£€éªŒä¸€ä¸ªäººæ˜¯å¦å¾—ç—…çš„å‡†ç¡®ç‡æ˜¯ 99.9%ï¼Œå®ƒçš„è¯¯æŠ¥ç‡æ˜¯ 0.1%ï¼Œé‚£ä¹ˆç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœä¸€ä¸ªäººè¢«æŸ¥å‡ºæ¥æ‚£æœ‰â€œå¶è´æ­»â€ï¼Œå®é™…ä¸Šæ‚£æœ‰çš„å¯èƒ½æ€§æœ‰å¤šå¤§ï¼Ÿä½ å¯èƒ½ä¼šæƒ³è¯´ï¼Œæ—¢ç„¶æŸ¥å‡ºæ‚£æœ‰â€œè´å¶æ­»â€çš„å‡†ç¡®ç‡æ˜¯ 99.9%ï¼Œé‚£æ˜¯ä¸æ˜¯å®é™…ä¸Šæ‚£â€œè´å¶æ­»â€çš„æ¦‚ç‡ä¹Ÿæ˜¯ 99.9% å‘¢ï¼Ÿå®é™…ä¸Šä¸æ˜¯çš„ã€‚ä½ è‡ªå·±æƒ³æƒ³ï¼Œåœ¨ 10000 ä¸ªäººä¸­ï¼Œè¿˜å­˜åœ¨ 0.1% çš„è¯¯æŸ¥çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯ 10 ä¸ªäººæ²¡æœ‰æ‚£ç—…ä½†æ˜¯è¢«è¯Šæ–­æˆé˜³æ€§ã€‚å½“ç„¶ 10000 ä¸ªäººä¸­ï¼Œä¹Ÿç¡®å®å­˜åœ¨ä¸€ä¸ªæ‚£æœ‰è´å¶æ­»çš„äººï¼Œä»–æœ‰ 99.9% çš„æ¦‚ç‡è¢«æ£€æŸ¥å‡ºæ¥ã€‚æ‰€ä»¥ä½ å¯ä»¥ç²—ç®—ä¸‹ï¼Œæ‚£ç—…çš„è¿™ä¸ªäººå®é™…ä¸Šæ˜¯è¿™ 11 ä¸ªäººé‡Œé¢çš„ä¸€å‘˜ï¼Œå³å®é™…æ‚£ç—…æ¯”ä¾‹æ˜¯ 1/11â‰ˆ9%ã€‚ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®é™…ä¸Šæ¶‰åŠåˆ°äº†è´å¶æ–¯åŸç†ä¸­çš„å‡ ä¸ªæ¦‚å¿µï¼šå…ˆéªŒæ¦‚ç‡ï¼šé€šè¿‡ç»éªŒæ¥åˆ¤æ–­äº‹æƒ…å‘ç”Ÿçš„æ¦‚ç‡ï¼Œæ¯”å¦‚è¯´â€œè´å¶æ­»â€çš„å‘ç—…ç‡æ˜¯ä¸‡åˆ†ä¹‹ä¸€ï¼Œå°±æ˜¯å…ˆéªŒæ¦‚ç‡ã€‚å†æ¯”å¦‚å—æ–¹çš„æ¢…é›¨å­£æ˜¯ 6-7 æœˆï¼Œå°±æ˜¯é€šè¿‡å¾€å¹´çš„æ°”å€™æ€»ç»“å‡ºæ¥çš„ç»éªŒï¼Œè¿™ä¸ªæ—¶å€™ä¸‹é›¨çš„æ¦‚ç‡å°±æ¯”å…¶ä»–æ—¶é—´é«˜å‡ºå¾ˆå¤šã€‚åéªŒæ¦‚ç‡ï¼šåéªŒæ¦‚ç‡å°±æ˜¯å‘ç”Ÿç»“æœä¹‹åï¼Œæ¨æµ‹åŸå› çš„æ¦‚ç‡ã€‚æ¯”å¦‚è¯´æŸäººæŸ¥å‡ºæ¥äº†æ‚£æœ‰â€œè´å¶æ­»â€ï¼Œé‚£ä¹ˆæ‚£ç—…çš„åŸå› å¯èƒ½æ˜¯ Aã€B æˆ– Cã€‚æ‚£æœ‰â€œè´å¶æ­»â€æ˜¯å› ä¸ºåŸå›  A çš„æ¦‚ç‡å°±æ˜¯åéªŒæ¦‚ç‡ã€‚å®ƒæ˜¯å±äºæ¡ä»¶æ¦‚ç‡çš„ä¸€ç§ã€‚æ¡ä»¶æ¦‚ç‡ï¼šäº‹ä»¶ A åœ¨å¦å¤–ä¸€ä¸ªäº‹ä»¶ B å·²ç»å‘ç”Ÿæ¡ä»¶ä¸‹çš„å‘ç”Ÿæ¦‚ç‡ï¼Œè¡¨ç¤ºä¸º P(A|B)ï¼Œè¯»ä½œâ€œåœ¨ B å‘ç”Ÿçš„æ¡ä»¶ä¸‹ A å‘ç”Ÿçš„æ¦‚ç‡â€ã€‚æ¯”å¦‚åŸå›  A çš„æ¡ä»¶ä¸‹ï¼Œæ‚£æœ‰â€œè´å¶æ­»â€çš„æ¦‚ç‡ï¼Œå°±æ˜¯æ¡ä»¶æ¦‚ç‡ã€‚ä¼¼ç„¶å‡½æ•°ï¼ˆlikelihood functionï¼‰ï¼šä½ å¯ä»¥æŠŠæ¦‚ç‡æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ç†è§£ä¸ºæ±‚å‚æ•°ä¼°è®¡çš„è¿‡ç¨‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä¸€ä¸ªç¡¬å¸åœ¨ 10 æ¬¡æŠ›è½ä¸­æ­£é¢å‡æœä¸Šã€‚é‚£ä¹ˆä½ è‚¯å®šåœ¨æƒ³ï¼Œè¿™ä¸ªç¡¬å¸æ˜¯å‡åŒ€çš„å¯èƒ½æ€§æ˜¯å¤šå°‘ï¼Ÿè¿™é‡Œç¡¬å¸å‡åŒ€å°±æ˜¯ä¸ªå‚æ•°ï¼Œä¼¼ç„¶å‡½æ•°å°±æ˜¯ç”¨æ¥è¡¡é‡è¿™ä¸ªæ¨¡å‹çš„å‚æ•°ã€‚ä¼¼ç„¶åœ¨è¿™é‡Œå°±æ˜¯å¯èƒ½æ€§çš„æ„æ€ï¼Œå®ƒæ˜¯å…³äºç»Ÿè®¡å‚æ•°çš„å‡½æ•°ã€‚ä»‹ç»å®Œè´å¶æ–¯åŸç†ä¸­çš„è¿™å‡ ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹è´å¶æ–¯åŸç†ï¼Œå®é™…ä¸Šè´å¶æ–¯åŸç†å°±æ˜¯æ±‚è§£åéªŒæ¦‚ç‡ï¼Œæˆ‘ä»¬å‡è®¾ï¼šA è¡¨ç¤ºäº‹ä»¶ â€œæµ‹å‡ºä¸ºé˜³æ€§â€, ç”¨ B1 è¡¨ç¤ºâ€œæ‚£æœ‰è´å¶æ­»â€, B2 è¡¨ç¤ºâ€œæ²¡æœ‰æ‚£è´å¶æ­»â€ã€‚æ ¹æ®ä¸Šé¢é‚£é“é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸‹é¢çš„ä¿¡æ¯ã€‚æ‚£æœ‰è´å¶æ­»çš„æƒ…å†µä¸‹ï¼Œæµ‹å‡ºä¸ºé˜³æ€§çš„æ¦‚ç‡ä¸º P(A|B1)=99.9%ï¼Œæ²¡æœ‰æ‚£è´å¶æ­»ï¼Œä½†æµ‹å‡ºä¸ºé˜³æ€§çš„æ¦‚ç‡ä¸º P(A|B2)=0.1%ã€‚å¦å¤–æ‚£æœ‰è´å¶æ­»çš„æ¦‚ç‡ä¸º P(B1)=0.01%ï¼Œæ²¡æœ‰æ‚£è´å¶æ­»çš„æ¦‚ç‡ P(B2)=99.99%ã€‚é‚£ä¹ˆæˆ‘ä»¬æ£€æµ‹å‡ºæ¥ä¸ºé˜³æ€§ï¼Œè€Œä¸”æ˜¯è´å¶æ­»çš„æ¦‚ç‡ P(B1ï¼ŒAï¼‰=P(B1)_P(A|B1)=0.01%_99.9%=0.00999%ã€‚è¿™é‡Œ P(B1,A) ä»£è¡¨çš„æ˜¯è”åˆæ¦‚ç‡ï¼ŒåŒæ ·æˆ‘ä»¬å¯ä»¥æ±‚å¾— P(B2,A)=P(B2)_P(A|B2)=99.99%_0.1%=0.09999%ã€‚ç„¶åæˆ‘ä»¬æƒ³æ±‚å¾—æ˜¯æ£€æŸ¥ä¸ºé˜³æ€§çš„æƒ…å†µä¸‹ï¼Œæ‚£æœ‰è´å¶æ­»çš„æ¦‚ç‡ï¼Œä¹Ÿå³æ˜¯ P(B1|A)ã€‚æ‰€ä»¥æ£€æŸ¥å‡ºé˜³æ€§ï¼Œä¸”æ‚£æœ‰è´å¶æ­»çš„æ¦‚ç‡ä¸ºï¼šæ£€æŸ¥å‡ºæ˜¯é˜³æ€§ï¼Œä½†æ²¡æœ‰æ‚£æœ‰è´å¶æ­»çš„æ¦‚ç‡ä¸ºï¼šè¿™é‡Œæˆ‘ä»¬èƒ½çœ‹å‡ºæ¥ 0.01%+0.1% å‡å‡ºç°åœ¨äº† P(B1|A) å’Œ P(B2|A) çš„è®¡ç®—ä¸­ä½œä¸ºåˆ†æ¯ã€‚æˆ‘ä»¬æŠŠå®ƒç§°ä¹‹ä¸ºè®ºæ®å› å­ï¼Œä¹Ÿç›¸å½“äºä¸€ä¸ªæƒå€¼å› å­ã€‚å…¶ä¸­ P(B1ï¼‰ã€P(B2) å°±æ˜¯å…ˆéªŒæ¦‚ç‡ï¼Œæˆ‘ä»¬ç°åœ¨çŸ¥é“äº†è§‚æµ‹å€¼ï¼Œå°±æ˜¯è¢«æ£€æµ‹å‡ºæ¥æ˜¯é˜³æ€§ï¼Œæ¥æ±‚æ‚£è´å¶æ­»çš„æ¦‚ç‡ï¼Œä¹Ÿå°±æ˜¯æ±‚åéªŒæ¦‚ç‡ã€‚æ±‚åéªŒæ¦‚ç‡å°±æ˜¯è´å¶æ–¯åŸç†è¦æ±‚çš„ï¼ŒåŸºäºåˆšæ‰æ±‚å¾—çš„ P(B1|A)ï¼ŒP(B2|A)ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºè´å¶æ–¯å…¬å¼ä¸ºï¼šç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºé€šç”¨çš„è´å¶æ–¯å…¬å¼ï¼šæœ´ç´ è´å¶æ–¯è®²å®Œè´å¶æ–¯åŸç†ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹ä»Šå¤©é‡ç‚¹è¦è®²çš„ç®—æ³•ï¼Œæœ´ç´ è´å¶æ–¯ã€‚å®ƒæ˜¯ä¸€ç§ç®€å•ä½†æä¸ºå¼ºå¤§çš„é¢„æµ‹å»ºæ¨¡ç®—æ³•ã€‚ä¹‹æ‰€ä»¥ç§°ä¸ºæœ´ç´ è´å¶æ–¯ï¼Œæ˜¯å› ä¸ºå®ƒå‡è®¾æ¯ä¸ªè¾“å…¥å˜é‡æ˜¯ç‹¬ç«‹çš„ã€‚è¿™æ˜¯ä¸€ä¸ªå¼ºç¡¬çš„å‡è®¾ï¼Œå®é™…æƒ…å†µå¹¶ä¸ä¸€å®šï¼Œä½†æ˜¯è¿™é¡¹æŠ€æœ¯å¯¹äºç»å¤§éƒ¨åˆ†çš„å¤æ‚é—®é¢˜ä»ç„¶éå¸¸æœ‰æ•ˆã€‚æœ´ç´ è´å¶æ–¯æ¨¡å‹ç”±ä¸¤ç§ç±»å‹çš„æ¦‚ç‡ç»„æˆï¼šæ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡P(Cj)ï¼›æ¯ä¸ªå±æ€§çš„æ¡ä»¶æ¦‚ç‡P(Ai|Cj)ã€‚æˆ‘æ¥ä¸¾ä¸ªä¾‹å­è¯´æ˜ä¸‹ä»€ä¹ˆæ˜¯ç±»åˆ«æ¦‚ç‡å’Œæ¡ä»¶æ¦‚ç‡ã€‚å‡è®¾æˆ‘æœ‰ 7 ä¸ªæ£‹å­ï¼Œå…¶ä¸­ 3 ä¸ªæ˜¯ç™½è‰²çš„ï¼Œ4 ä¸ªæ˜¯é»‘è‰²çš„ã€‚é‚£ä¹ˆæ£‹å­æ˜¯ç™½è‰²çš„æ¦‚ç‡å°±æ˜¯ 3/7ï¼Œé»‘è‰²çš„æ¦‚ç‡å°±æ˜¯ 4/7ï¼Œè¿™ä¸ªå°±æ˜¯ç±»åˆ«æ¦‚ç‡ã€‚å‡è®¾æˆ‘æŠŠè¿™ 7 ä¸ªæ£‹å­æ”¾åˆ°äº†ä¸¤ä¸ªç›’å­é‡Œï¼Œå…¶ä¸­ç›’å­ A é‡Œé¢æœ‰ 2 ä¸ªç™½æ£‹ï¼Œ2 ä¸ªé»‘æ£‹ï¼›ç›’å­ B é‡Œé¢æœ‰ 1 ä¸ªç™½æ£‹ï¼Œ2 ä¸ªé»‘æ£‹ã€‚é‚£ä¹ˆåœ¨ç›’å­ A ä¸­æŠ“åˆ°ç™½æ£‹çš„æ¦‚ç‡å°±æ˜¯ 1/2ï¼ŒæŠ“åˆ°é»‘æ£‹çš„æ¦‚ç‡ä¹Ÿæ˜¯ 1/2ï¼Œè¿™ä¸ªå°±æ˜¯æ¡ä»¶æ¦‚ç‡ï¼Œä¹Ÿå°±æ˜¯åœ¨æŸä¸ªæ¡ä»¶ï¼ˆæ¯”å¦‚åœ¨ç›’å­ A ä¸­ï¼‰ä¸‹çš„æ¦‚ç‡ã€‚åœ¨æœ´ç´ è´å¶æ–¯ä¸­ï¼Œæˆ‘ä»¬è¦ç»Ÿè®¡çš„æ˜¯å±æ€§çš„æ¡ä»¶æ¦‚ç‡ï¼Œä¹Ÿå°±æ˜¯å‡è®¾å–å‡ºæ¥çš„æ˜¯ç™½è‰²çš„æ£‹å­ï¼Œé‚£ä¹ˆå®ƒå±äºç›’å­ A çš„æ¦‚ç‡æ˜¯ 2/3ã€‚ä¸ºäº†è®­ç»ƒæœ´ç´ è´å¶æ–¯æ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç»™å‡ºè®­ç»ƒæ•°æ®ï¼Œä»¥åŠè¿™äº›æ•°æ®å¯¹åº”çš„åˆ†ç±»ã€‚é‚£ä¹ˆä¸Šé¢è¿™ä¸¤ä¸ªæ¦‚ç‡ï¼Œä¹Ÿå°±æ˜¯ç±»åˆ«æ¦‚ç‡å’Œæ¡ä»¶æ¦‚ç‡ã€‚ä»–ä»¬éƒ½å¯ä»¥ä»ç»™å‡ºçš„è®­ç»ƒæ•°æ®ä¸­è®¡ç®—å‡ºæ¥ã€‚ä¸€æ—¦è®¡ç®—å‡ºæ¥ï¼Œæ¦‚ç‡æ¨¡å‹å°±å¯ä»¥ä½¿ç”¨è´å¶æ–¯åŸç†å¯¹æ–°æ•°æ®è¿›è¡Œé¢„æµ‹ã€‚å¦å¤–æˆ‘æƒ³å‘Šè¯‰ä½ çš„æ˜¯ï¼Œè´å¶æ–¯åŸç†ã€è´å¶æ–¯åˆ†ç±»å’Œæœ´ç´ è´å¶æ–¯è¿™ä¸‰è€…ä¹‹é—´æ˜¯æœ‰åŒºåˆ«çš„ã€‚è´å¶æ–¯åŸç†æ˜¯æœ€å¤§çš„æ¦‚å¿µï¼Œå®ƒè§£å†³äº†æ¦‚ç‡è®ºä¸­â€œé€†å‘æ¦‚ç‡â€çš„é—®é¢˜ï¼Œåœ¨è¿™ä¸ªç†è®ºåŸºç¡€ä¸Šï¼Œäººä»¬è®¾è®¡å‡ºäº†è´å¶æ–¯åˆ†ç±»å™¨ï¼Œæœ´ç´ è´å¶æ–¯åˆ†ç±»æ˜¯è´å¶æ–¯åˆ†ç±»å™¨ä¸­çš„ä¸€ç§ï¼Œä¹Ÿæ˜¯æœ€ç®€å•ï¼Œæœ€å¸¸ç”¨çš„åˆ†ç±»å™¨ã€‚æœ´ç´ è´å¶æ–¯ä¹‹æ‰€ä»¥æœ´ç´ æ˜¯å› ä¸ºå®ƒå‡è®¾å±æ€§æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå› æ­¤å¯¹å®é™…æƒ…å†µæœ‰æ‰€çº¦æŸï¼Œå¦‚æœå±æ€§ä¹‹é—´å­˜åœ¨å…³è”ï¼Œåˆ†ç±»å‡†ç¡®ç‡ä¼šé™ä½ã€‚ä¸è¿‡å¥½åœ¨å¯¹äºå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæœ´ç´ è´å¶æ–¯çš„åˆ†ç±»æ•ˆæœéƒ½ä¸é”™ã€‚æœ´ç´ è´å¶æ–¯åˆ†ç±»å·¥ä½œåŸç†æœ´ç´ è´å¶æ–¯åˆ†ç±»æ˜¯å¸¸ç”¨çš„è´å¶æ–¯åˆ†ç±»æ–¹æ³•ã€‚æˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­çœ‹åˆ°ä¸€ä¸ªé™Œç”Ÿäººï¼Œè¦åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯åˆ¤æ–­ TA çš„æ€§åˆ«ï¼Œåˆ¤æ–­æ€§åˆ«çš„è¿‡ç¨‹å°±æ˜¯ä¸€ä¸ªåˆ†ç±»çš„è¿‡ç¨‹ã€‚æ ¹æ®ä»¥å¾€çš„ç»éªŒï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä»èº«é«˜ã€ä½“é‡ã€é‹ç ã€å¤´å‘é•¿çŸ­ã€æœé¥°ã€å£°éŸ³ç­‰è§’åº¦è¿›è¡Œåˆ¤æ–­ã€‚è¿™é‡Œçš„â€œç»éªŒâ€å°±æ˜¯ä¸€ä¸ªè®­ç»ƒå¥½çš„å…³äºæ€§åˆ«åˆ¤æ–­çš„æ¨¡å‹ï¼Œå…¶è®­ç»ƒæ•°æ®æ˜¯æ—¥å¸¸ä¸­é‡åˆ°çš„å„å¼å„æ ·çš„äººï¼Œä»¥åŠè¿™äº›äººå®é™…çš„æ€§åˆ«æ•°æ®ã€‚ç¦»æ•£æ•°æ®æ¡ˆä¾‹æˆ‘ä»¬é‡åˆ°çš„æ•°æ®å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯ç¦»æ•£æ•°æ®ï¼Œå¦ä¸€ç§æ˜¯è¿ç»­æ•°æ®ã€‚é‚£ä»€ä¹ˆæ˜¯ç¦»æ•£æ•°æ®å‘¢ï¼Ÿç¦»æ•£å°±æ˜¯ä¸è¿ç»­çš„æ„æ€ï¼Œæœ‰æ˜ç¡®çš„è¾¹ç•Œï¼Œæ¯”å¦‚æ•´æ•° 1ï¼Œ2ï¼Œ3 å°±æ˜¯ç¦»æ•£æ•°æ®ï¼Œè€Œ 1 åˆ° 3 ä¹‹é—´çš„ä»»ä½•æ•°ï¼Œå°±æ˜¯è¿ç»­æ•°æ®ï¼Œå®ƒå¯ä»¥å–åœ¨è¿™ä¸ªåŒºé—´é‡Œçš„ä»»ä½•æ•°å€¼ã€‚æˆ‘ä»¥ä¸‹é¢çš„æ•°æ®ä¸ºä¾‹ï¼Œè¿™äº›æ˜¯æ ¹æ®ä½ ä¹‹å‰çš„ç»éªŒæ‰€è·å¾—çš„æ•°æ®ã€‚ç„¶åç»™ä½ ä¸€ä¸ªæ–°çš„æ•°æ®ï¼šèº«é«˜â€œé«˜â€ã€ä½“é‡â€œä¸­â€ï¼Œé‹ç â€œä¸­â€ï¼Œè¯·é—®è¿™ä¸ªäººæ˜¯ç”·è¿˜æ˜¯å¥³ï¼Ÿé’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å…ˆç¡®å®šä¸€å…±æœ‰ 3 ä¸ªå±æ€§ï¼Œå‡è®¾æˆ‘ä»¬ç”¨ A ä»£è¡¨å±æ€§ï¼Œç”¨ A1, A2, A3 åˆ†åˆ«ä¸ºèº«é«˜ = é«˜ã€ä½“é‡ = ä¸­ã€é‹ç  = ä¸­ã€‚ä¸€å…±æœ‰ä¸¤ä¸ªç±»åˆ«ï¼Œå‡è®¾ç”¨ C ä»£è¡¨ç±»åˆ«ï¼Œé‚£ä¹ˆ C1,C2 åˆ†åˆ«æ˜¯ï¼šç”·ã€å¥³ï¼Œåœ¨æœªçŸ¥çš„æƒ…å†µä¸‹æˆ‘ä»¬ç”¨ Cj è¡¨ç¤ºã€‚é‚£ä¹ˆæˆ‘ä»¬æƒ³æ±‚åœ¨ A1ã€A2ã€A3 å±æ€§ä¸‹ï¼ŒCj çš„æ¦‚ç‡ï¼Œç”¨æ¡ä»¶æ¦‚ç‡è¡¨ç¤ºå°±æ˜¯ P(Cj|A1A2A3)ã€‚æ ¹æ®ä¸Šé¢è®²çš„è´å¶æ–¯çš„å…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼šå› ä¸ºä¸€å…±æœ‰ 2 ä¸ªç±»åˆ«ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ±‚å¾— P(C1|A1A2A3) å’Œ P(C2|A1A2A3) çš„æ¦‚ç‡å³å¯ï¼Œç„¶åæ¯”è¾ƒä¸‹å“ªä¸ªåˆ†ç±»çš„å¯èƒ½æ€§å¤§ï¼Œå°±æ˜¯å“ªä¸ªåˆ†ç±»ç»“æœã€‚åœ¨è¿™ä¸ªå…¬å¼é‡Œï¼Œå› ä¸º P(A1A2A3) éƒ½æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬æƒ³è¦å¯»æ‰¾ä½¿å¾— P(Cj|A1A2A3) çš„æœ€å¤§å€¼ï¼Œå°±ç­‰ä»·äºæ±‚ P(A1A2A3|Cj)P(Cj) æœ€å¤§å€¼ã€‚æˆ‘ä»¬å‡å®š Ai ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆï¼šP(A1A2A3|Cj)=P(A1|Cj)P(A2|Cj)P(A3|Cj)ç„¶åæˆ‘ä»¬éœ€è¦ä» Ai å’Œ Cj ä¸­è®¡ç®—å‡º P(Ai|Cj) çš„æ¦‚ç‡ï¼Œå¸¦å…¥åˆ°ä¸Šé¢çš„å…¬å¼å¾—å‡º P(A1A2A3|Cj)ï¼Œæœ€åæ‰¾åˆ°ä½¿å¾— P(A1A2A3|Cj) æœ€å¤§çš„ç±»åˆ« Cjã€‚æˆ‘åˆ†åˆ«æ±‚ä¸‹è¿™äº›æ¡ä»¶ä¸‹çš„æ¦‚ç‡ï¼šP(A1|C1)=1/2, P(A2|C1)=1/2, P(A3|C1)=1/4ï¼ŒP(A1|C2)=0, P(A2|C2)=1/2, P(A3|C2)=1/2ï¼Œæ‰€ä»¥ P(A1A2A3|C1)=1/16, P(A1A2A3|C2)=0ã€‚å› ä¸º P(A1A2A3|C1)P(C1)&gt;P(A1A2A3|C2)P(C2)ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯ C1 ç±»åˆ«ï¼Œå³ç”·æ€§ã€‚è¿ç»­æ•°æ®æ¡ˆä¾‹æˆ‘ä»¬åšäº†ä¸€ä¸ªç¦»æ•£çš„æ•°æ®æ¡ˆä¾‹ï¼Œå®é™…ç”Ÿæ´»ä¸­æˆ‘ä»¬å¾—åˆ°çš„æ˜¯è¿ç»­çš„æ•°å€¼ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç»„æ•°æ®ï¼šé‚£ä¹ˆå¦‚æœç»™ä½ ä¸€ä¸ªæ–°çš„æ•°æ®ï¼Œèº«é«˜ 180ã€ä½“é‡ 120ï¼Œé‹ç  41ï¼Œè¯·é—®è¯¥äººæ˜¯ç”·æ˜¯å¥³å‘¢ï¼Ÿå…¬å¼è¿˜æ˜¯ä¸Šé¢çš„å…¬å¼ï¼Œè¿™é‡Œçš„å›°éš¾åœ¨äºï¼Œç”±äºèº«é«˜ã€ä½“é‡ã€é‹ç éƒ½æ˜¯è¿ç»­å˜é‡ï¼Œä¸èƒ½é‡‡ç”¨ç¦»æ•£å˜é‡çš„æ–¹æ³•è®¡ç®—æ¦‚ç‡ã€‚è€Œä¸”ç”±äºæ ·æœ¬å¤ªå°‘ï¼Œæ‰€ä»¥ä¹Ÿæ— æ³•åˆ†æˆåŒºé—´è®¡ç®—ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™æ—¶ï¼Œå¯ä»¥å‡è®¾ç”·æ€§å’Œå¥³æ€§çš„èº«é«˜ã€ä½“é‡ã€é‹ç éƒ½æ˜¯æ­£æ€åˆ†å¸ƒï¼Œé€šè¿‡æ ·æœ¬è®¡ç®—å‡ºå‡å€¼å’Œæ–¹å·®ï¼Œä¹Ÿå°±æ˜¯å¾—åˆ°æ­£æ€åˆ†å¸ƒçš„å¯†åº¦å‡½æ•°ã€‚æœ‰äº†å¯†åº¦å‡½æ•°ï¼Œå°±å¯ä»¥æŠŠå€¼ä»£å…¥ï¼Œç®—å‡ºæŸä¸€ç‚¹çš„å¯†åº¦å‡½æ•°çš„å€¼ã€‚æ¯”å¦‚ï¼Œç”·æ€§çš„èº«é«˜æ˜¯å‡å€¼ 179.5ã€æ ‡å‡†å·®ä¸º 3.697 çš„æ­£æ€åˆ†å¸ƒã€‚æ‰€ä»¥ç”·æ€§çš„èº«é«˜ä¸º 180 çš„æ¦‚ç‡ä¸º 0.1069ã€‚æ€ä¹ˆè®¡ç®—å¾—å‡ºçš„å‘¢? ä½ å¯ä»¥ä½¿ç”¨ EXCEL çš„ NORMDIST(x,mean,standard_dev,cumulative) å‡½æ•°ï¼Œä¸€å…±æœ‰ 4 ä¸ªå‚æ•°ï¼šxï¼šæ­£æ€åˆ†å¸ƒä¸­ï¼Œéœ€è¦è®¡ç®—çš„æ•°å€¼ï¼›Meanï¼šæ­£æ€åˆ†å¸ƒçš„å¹³å‡å€¼ï¼›Standard_devï¼šæ­£æ€åˆ†å¸ƒçš„æ ‡å‡†å·®ï¼›Cumulativeï¼šå–å€¼ä¸ºé€»è¾‘å€¼ï¼Œå³ False æˆ– Trueã€‚å®ƒå†³å®šäº†å‡½æ•°çš„å½¢å¼ã€‚å½“ä¸º TRUE æ—¶ï¼Œå‡½æ•°ç»“æœä¸ºç´¯ç§¯åˆ†å¸ƒï¼›ä¸º False æ—¶ï¼Œå‡½æ•°ç»“æœä¸ºæ¦‚ç‡å¯†åº¦ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ NORMDIST(180,179.5,3.697,0)=0.1069ã€‚åŒç†æˆ‘ä»¬å¯ä»¥è®¡ç®—å¾—å‡ºç”·æ€§ä½“é‡ä¸º 120 çš„æ¦‚ç‡ä¸º 0.000382324ï¼Œç”·æ€§é‹ç ä¸º 41 å·çš„æ¦‚ç‡ä¸º 0.120304111ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¡ç®—å¾—å‡ºï¼šP(A1A2A3|C1)=P(A1|C1)P(A2|C1)P(A3|C1)=0.10690.0003823240.120304111=4.9169e-6åŒç†æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¡ç®—å‡ºæ¥è¯¥äººä¸ºå¥³çš„å¯èƒ½æ€§ï¼šP(A1A2A3|C2)=P(A1|C2)P(A2|C2)P(A3|C2)=0.000001474890.0153541440.120306074=2.7244e-9å¾ˆæ˜æ˜¾è¿™ç»„æ•°æ®åˆ†ç±»ä¸ºç”·çš„æ¦‚ç‡å¤§äºåˆ†ç±»ä¸ºå¥³çš„æ¦‚ç‡ã€‚å½“ç„¶åœ¨ Python ä¸­ï¼Œæœ‰ç¬¬ä¸‰æ–¹åº“å¯ä»¥ç›´æ¥å¸®æˆ‘ä»¬è¿›è¡Œä¸Šé¢çš„æ“ä½œï¼Œè¿™ä¸ªæˆ‘ä»¬ä¼šåœ¨ä¸‹èŠ‚è¯¾ä¸­ä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯ç»™ä½ è®²è§£ä¸‹å…·ä½“çš„è¿ç®—åŸç†ã€‚æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨å·¥ä½œæµç¨‹æœ´ç´ è´å¶æ–¯åˆ†ç±»å¸¸ç”¨äºæ–‡æœ¬åˆ†ç±»ï¼Œå°¤å…¶æ˜¯å¯¹äºè‹±æ–‡ç­‰è¯­è¨€æ¥è¯´ï¼Œåˆ†ç±»æ•ˆæœå¾ˆå¥½ã€‚å®ƒå¸¸ç”¨äºåƒåœ¾æ–‡æœ¬è¿‡æ»¤ã€æƒ…æ„Ÿé¢„æµ‹ã€æ¨èç³»ç»Ÿç­‰ã€‚æµç¨‹å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼šä»å›¾ç‰‡ä½ ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œæœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨éœ€è¦ä¸‰ä¸ªæµç¨‹ï¼Œæˆ‘æ¥ç»™ä½ ä¸€ä¸€è®²è§£ä¸‹è¿™å‡ ä¸ªæµç¨‹ã€‚ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡é˜¶æ®µåœ¨è¿™ä¸ªé˜¶æ®µæˆ‘ä»¬éœ€è¦ç¡®å®šç‰¹å¾å±æ€§ï¼Œæ¯”å¦‚ä¸Šé¢æ¡ˆä¾‹ä¸­çš„â€œèº«é«˜â€ã€â€œä½“é‡â€ã€â€œé‹ç â€ç­‰ï¼Œå¹¶å¯¹æ¯ä¸ªç‰¹å¾å±æ€§è¿›è¡Œé€‚å½“åˆ’åˆ†ï¼Œç„¶åç”±äººå·¥å¯¹ä¸€éƒ¨åˆ†æ•°æ®è¿›è¡Œåˆ†ç±»ï¼Œå½¢æˆè®­ç»ƒæ ·æœ¬ã€‚è¿™ä¸€é˜¶æ®µæ˜¯æ•´ä¸ªæœ´ç´ è´å¶æ–¯åˆ†ç±»ä¸­å”¯ä¸€éœ€è¦äººå·¥å®Œæˆçš„é˜¶æ®µï¼Œå…¶è´¨é‡å¯¹æ•´ä¸ªè¿‡ç¨‹å°†æœ‰é‡è¦å½±å“ï¼Œåˆ†ç±»å™¨çš„è´¨é‡å¾ˆå¤§ç¨‹åº¦ä¸Šç”±ç‰¹å¾å±æ€§ã€ç‰¹å¾å±æ€§åˆ’åˆ†åŠè®­ç»ƒæ ·æœ¬è´¨é‡å†³å®šã€‚ç¬¬äºŒé˜¶æ®µï¼šè®­ç»ƒé˜¶æ®µè¿™ä¸ªé˜¶æ®µå°±æ˜¯ç”Ÿæˆåˆ†ç±»å™¨ï¼Œä¸»è¦å·¥ä½œæ˜¯è®¡ç®—æ¯ä¸ªç±»åˆ«åœ¨è®­ç»ƒæ ·æœ¬ä¸­çš„å‡ºç°é¢‘ç‡åŠæ¯ä¸ªç‰¹å¾å±æ€§åˆ’åˆ†å¯¹æ¯ä¸ªç±»åˆ«çš„æ¡ä»¶æ¦‚ç‡ã€‚è¾“å…¥æ˜¯ç‰¹å¾å±æ€§å’Œè®­ç»ƒæ ·æœ¬ï¼Œè¾“å‡ºæ˜¯åˆ†ç±»å™¨ã€‚ç¬¬ä¸‰é˜¶æ®µï¼šåº”ç”¨é˜¶æ®µè¿™ä¸ªé˜¶æ®µæ˜¯ä½¿ç”¨åˆ†ç±»å™¨å¯¹æ–°æ•°æ®è¿›è¡Œåˆ†ç±»ã€‚è¾“å…¥æ˜¯åˆ†ç±»å™¨å’Œæ–°æ•°æ®ï¼Œè¾“å‡ºæ˜¯æ–°æ•°æ®çš„åˆ†ç±»ç»“æœã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Naive Bayes","slug":"Naive-Bayes","permalink":"cpeixin.cn/tags/Naive-Bayes/"}]},{"title":"æ•°æ®åˆ†æ - EMèšç±»","slug":"æ•°æ®åˆ†æ-EMèšç±»","date":"2018-07-15T14:18:39.000Z","updated":"2020-05-01T14:15:10.136Z","comments":true,"path":"2018/07/15/æ•°æ®åˆ†æ-EMèšç±»/","link":"","permalink":"cpeixin.cn/2018/07/15/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-EM%E8%81%9A%E7%B1%BB/","excerpt":"","text":"ä»Šå¤©è¦æ¥å­¦ä¹  EM èšç±»ã€‚EM çš„è‹±æ–‡æ˜¯ Expectation Maximizationï¼Œæ‰€ä»¥ EM ç®—æ³•ä¹Ÿå«æœ€å¤§æœŸæœ›ç®—æ³•ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼šå‡è®¾ä½ ç‚’äº†ä¸€ä»½èœï¼Œæƒ³è¦æŠŠå®ƒå¹³å‡åˆ†åˆ°ä¸¤ä¸ªç¢Ÿå­é‡Œï¼Œè¯¥æ€ä¹ˆåˆ†ï¼Ÿå¾ˆå°‘æœ‰äººç”¨ç§°å¯¹èœè¿›è¡Œç§°é‡ï¼Œå†è®¡ç®—ä¸€åŠçš„åˆ†é‡è¿›è¡Œå¹³åˆ†ã€‚å¤§éƒ¨åˆ†äººçš„æ–¹æ³•æ˜¯å…ˆåˆ†ä¸€éƒ¨åˆ†åˆ°ç¢Ÿå­ A ä¸­ï¼Œç„¶åå†æŠŠå‰©ä½™çš„åˆ†åˆ°ç¢Ÿå­ B ä¸­ï¼Œå†æ¥è§‚å¯Ÿç¢Ÿå­ A å’Œ B é‡Œçš„èœæ˜¯å¦ä¸€æ ·å¤šï¼Œå“ªä¸ªå¤šå°±åŒ€ä¸€äº›åˆ°å°‘çš„é‚£ä¸ªç¢Ÿå­é‡Œï¼Œç„¶åå†è§‚å¯Ÿç¢Ÿå­ A å’Œ B é‡Œçš„æ˜¯å¦ä¸€æ ·å¤šâ€¦â€¦æ•´ä¸ªè¿‡ç¨‹ä¸€ç›´é‡å¤ä¸‹å»ï¼Œç›´åˆ°ä»½é‡ä¸å‘ç”Ÿå˜åŒ–ä¸ºæ­¢ã€‚ä½ èƒ½ä»è¿™ä¸ªä¾‹å­ä¸­çœ‹åˆ°ä¸‰ä¸ªä¸»è¦çš„æ­¥éª¤ï¼šåˆå§‹åŒ–å‚æ•°ã€è§‚å¯Ÿé¢„æœŸã€é‡æ–°ä¼°è®¡ã€‚é¦–å…ˆæ˜¯å…ˆç»™æ¯ä¸ªç¢Ÿå­åˆå§‹åŒ–ä¸€äº›èœé‡ï¼Œç„¶åå†è§‚å¯Ÿé¢„æœŸï¼Œè¿™ä¸¤ä¸ªæ­¥éª¤å®é™…ä¸Šå°±æ˜¯æœŸæœ›æ­¥éª¤ï¼ˆExpectationï¼‰ã€‚å¦‚æœç»“æœå­˜åœ¨åå·®å°±éœ€è¦é‡æ–°ä¼°è®¡å‚æ•°ï¼Œè¿™ä¸ªå°±æ˜¯æœ€å¤§åŒ–æ­¥éª¤ï¼ˆMaximizationï¼‰ã€‚è¿™ä¸¤ä¸ªæ­¥éª¤åŠ èµ·æ¥ä¹Ÿå°±æ˜¯ EM ç®—æ³•çš„è¿‡ç¨‹ã€‚EM ç®—æ³•çš„å·¥ä½œåŸç†è¯´åˆ° EM ç®—æ³•ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªæ¦‚å¿µâ€œæœ€å¤§ä¼¼ç„¶â€ï¼Œè‹±æ–‡æ˜¯ Maximum Likelihoodï¼ŒLikelihood ä»£è¡¨å¯èƒ½æ€§ï¼Œæ‰€ä»¥æœ€å¤§ä¼¼ç„¶ä¹Ÿå°±æ˜¯æœ€å¤§å¯èƒ½æ€§çš„æ„æ€ã€‚ä»€ä¹ˆæ˜¯æœ€å¤§ä¼¼ç„¶å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œæœ‰ä¸€ç”·ä¸€å¥³ä¸¤ä¸ªåŒå­¦ï¼Œç°åœ¨è¦å¯¹ä»–ä¿©è¿›è¡Œèº«é«˜çš„æ¯”è¾ƒï¼Œè°ä¼šæ›´é«˜å‘¢ï¼Ÿæ ¹æ®æˆ‘ä»¬çš„ç»éªŒï¼Œç›¸åŒå¹´é¾„ä¸‹ç”·æ€§çš„å¹³å‡èº«é«˜æ¯”å¥³æ€§çš„é«˜ä¸€äº›ï¼Œæ‰€ä»¥ç”·åŒå­¦é«˜çš„å¯èƒ½æ€§ä¼šå¾ˆå¤§ã€‚è¿™é‡Œè¿ç”¨çš„å°±æ˜¯æœ€å¤§ä¼¼ç„¶çš„æ¦‚å¿µã€‚æœ€å¤§ä¼¼ç„¶ä¼°è®¡æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒæŒ‡çš„å°±æ˜¯ä¸€ä»¶äº‹æƒ…å·²ç»å‘ç”Ÿäº†ï¼Œç„¶ååæ¨æ›´æœ‰å¯èƒ½æ˜¯ä»€ä¹ˆå› ç´ é€ æˆçš„ã€‚è¿˜æ˜¯ç”¨ä¸€ç”·ä¸€å¥³æ¯”è¾ƒèº«é«˜ä¸ºä¾‹ï¼Œå‡è®¾æœ‰ä¸€ä¸ªäººæ¯”å¦ä¸€ä¸ªäººé«˜ï¼Œåæ¨ä»–å¯èƒ½æ˜¯ç”·æ€§ã€‚æœ€å¤§ä¼¼ç„¶ä¼°è®¡æ˜¯ä¸€ç§é€šè¿‡å·²çŸ¥ç»“æœï¼Œä¼°è®¡å‚æ•°çš„æ–¹æ³•ã€‚é‚£ä¹ˆ EM ç®—æ³•æ˜¯ä»€ä¹ˆï¼Ÿå®ƒå’Œæœ€å¤§ä¼¼ç„¶ä¼°è®¡åˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼ŸEM ç®—æ³•æ˜¯ä¸€ç§æ±‚è§£æœ€å¤§ä¼¼ç„¶ä¼°è®¡çš„æ–¹æ³•ï¼Œé€šè¿‡è§‚æµ‹æ ·æœ¬ï¼Œæ¥æ‰¾å‡ºæ ·æœ¬çš„æ¨¡å‹å‚æ•°ã€‚å†å›è¿‡æ¥çœ‹ä¸‹å¼€å¤´æˆ‘ç»™ä½ ä¸¾çš„åˆ†èœçš„è¿™ä¸ªä¾‹å­ï¼Œå®é™…ä¸Šæœ€ç»ˆæˆ‘ä»¬æƒ³è¦çš„æ˜¯ç¢Ÿå­ A å’Œç¢Ÿå­ B ä¸­èœçš„ä»½é‡ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬ç†è§£ä¸ºæƒ³è¦æ±‚å¾—çš„æ¨¡å‹å‚æ•°ã€‚ç„¶åæˆ‘ä»¬é€šè¿‡ EM ç®—æ³•ä¸­çš„ E æ­¥æ¥è¿›è¡Œè§‚å¯Ÿï¼Œç„¶åé€šè¿‡ M æ­¥æ¥è¿›è¡Œè°ƒæ•´ A å’Œ B çš„å‚æ•°ï¼Œæœ€åè®©ç¢Ÿå­ A å’Œç¢Ÿå­ B çš„å‚æ•°ä¸å†å‘ç”Ÿå˜åŒ–ä¸ºæ­¢ã€‚å®é™…æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜ï¼Œæ¯”åˆ†èœå¤æ‚ã€‚æˆ‘å†ç»™ä½ ä¸¾ä¸ªä¸€ä¸ªæŠ•æ·ç¡¬å¸çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ A å’Œ B ä¸¤æšç¡¬å¸ï¼Œæˆ‘ä»¬åšäº† 5 ç»„å®éªŒï¼Œæ¯ç»„å®éªŒæŠ•æ· 10 æ¬¡ï¼Œç„¶åç»Ÿè®¡å‡ºç°æ­£é¢çš„æ¬¡æ•°ï¼Œå®éªŒç»“æœå¦‚ä¸‹ï¼šæŠ•æ·ç¡¬å¸è¿™ä¸ªè¿‡ç¨‹ä¸­å­˜åœ¨éšå«çš„æ•°æ®ï¼Œå³æˆ‘ä»¬äº‹å…ˆå¹¶ä¸çŸ¥é“æ¯æ¬¡æŠ•æ·çš„ç¡¬å¸æ˜¯ A è¿˜æ˜¯ Bã€‚å‡è®¾æˆ‘ä»¬çŸ¥é“è¿™ä¸ªéšå«çš„æ•°æ®ï¼Œå¹¶å°†å®ƒå®Œå–„ï¼Œå¯ä»¥å¾—åˆ°ä¸‹é¢çš„ç»“æœï¼šæˆ‘ä»¬ç°åœ¨æƒ³è¦æ±‚å¾—ç¡¬å¸ A å’Œ B å‡ºç°æ­£é¢æ¬¡æ•°çš„æ¦‚ç‡ï¼Œå¯ä»¥ç›´æ¥æ±‚å¾—ï¼šè€Œå®é™…æƒ…å†µæ˜¯æˆ‘ä¸çŸ¥é“æ¯æ¬¡æŠ•æ·çš„ç¡¬å¸æ˜¯ A è¿˜æ˜¯ Bï¼Œé‚£ä¹ˆå¦‚ä½•æ±‚å¾—ç¡¬å¸ A å’Œç¡¬å¸ B å‡ºç°æ­£é¢çš„æ¦‚ç‡å‘¢ï¼Ÿè¿™é‡Œå°±éœ€è¦é‡‡ç”¨ EM ç®—æ³•çš„æ€æƒ³ã€‚1. åˆå§‹åŒ–å‚æ•°ã€‚æˆ‘ä»¬å‡è®¾ç¡¬å¸ A å’Œ B çš„æ­£é¢æ¦‚ç‡ï¼ˆéšæœºæŒ‡å®šï¼‰æ˜¯Î¸A=0.5 å’ŒÎ¸B=0.9ã€‚2. è®¡ç®—æœŸæœ›å€¼ã€‚å‡è®¾å®éªŒ 1 æŠ•æ·çš„æ˜¯ç¡¬å¸ Aï¼Œé‚£ä¹ˆæ­£é¢æ¬¡æ•°ä¸º 5 çš„æ¦‚ç‡ä¸ºï¼šæ‰€ä»¥å®éªŒ 1 æ›´æœ‰å¯èƒ½æŠ•æ·çš„æ˜¯ç¡¬å¸ Aã€‚ç„¶åæˆ‘ä»¬å¯¹å®éªŒ 2~5 é‡å¤ä¸Šé¢çš„è®¡ç®—è¿‡ç¨‹ï¼Œå¯ä»¥æ¨ç†å‡ºæ¥ç¡¬å¸é¡ºåºåº”è¯¥æ˜¯{Aï¼ŒAï¼ŒBï¼ŒBï¼ŒA}ã€‚è¿™ä¸ªè¿‡ç¨‹å®é™…ä¸Šæ˜¯é€šè¿‡å‡è®¾çš„å‚æ•°æ¥ä¼°è®¡æœªçŸ¥å‚æ•°ï¼Œå³â€œæ¯æ¬¡æŠ•æ·æ˜¯å“ªæšç¡¬å¸â€ã€‚3. é€šè¿‡çŒœæµ‹çš„ç»“æœ{A, A, B, B, A}æ¥å®Œå–„åˆå§‹åŒ–çš„å‚æ•°Î¸A å’ŒÎ¸Bã€‚ç„¶åä¸€ç›´é‡å¤ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥ï¼Œç›´åˆ°å‚æ•°ä¸å†å‘ç”Ÿå˜åŒ–ã€‚ç®€å•æ€»ç»“ä¸‹ä¸Šé¢çš„æ­¥éª¤ï¼Œä½ èƒ½çœ‹å‡º EM ç®—æ³•ä¸­çš„ E æ­¥éª¤å°±æ˜¯é€šè¿‡æ—§çš„å‚æ•°æ¥è®¡ç®—éšè—å˜é‡ã€‚ç„¶ååœ¨ M æ­¥éª¤ä¸­ï¼Œé€šè¿‡å¾—åˆ°çš„éšè—å˜é‡çš„ç»“æœæ¥é‡æ–°ä¼°è®¡å‚æ•°ã€‚ç›´åˆ°å‚æ•°ä¸å†å‘ç”Ÿå˜åŒ–ï¼Œå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚EM èšç±»çš„å·¥ä½œåŸç†ä¸Šé¢ä½ èƒ½çœ‹åˆ° EM ç®—æ³•æœ€ç›´æ¥çš„åº”ç”¨å°±æ˜¯æ±‚å‚æ•°ä¼°è®¡ã€‚å¦‚æœæˆ‘ä»¬æŠŠæ½œåœ¨ç±»åˆ«å½“åšéšè—å˜é‡ï¼Œæ ·æœ¬çœ‹åšè§‚å¯Ÿå€¼ï¼Œå°±å¯ä»¥æŠŠèšç±»é—®é¢˜è½¬åŒ–ä¸ºå‚æ•°ä¼°è®¡é—®é¢˜ã€‚è¿™ä¹Ÿå°±æ˜¯ EM èšç±»çš„åŸç†ã€‚ç›¸æ¯”äº K-Means ç®—æ³•ï¼ŒEM èšç±»æ›´åŠ çµæ´»ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸¤ç§æƒ…å†µï¼ŒK-Means ä¼šå¾—åˆ°ä¸‹é¢çš„èšç±»ç»“æœã€‚å› ä¸º K-Means æ˜¯é€šè¿‡è·ç¦»æ¥åŒºåˆ†æ ·æœ¬ä¹‹é—´çš„å·®åˆ«çš„ï¼Œä¸”æ¯ä¸ªæ ·æœ¬åœ¨è®¡ç®—çš„æ—¶å€™åªèƒ½å±äºä¸€ä¸ªåˆ†ç±»ï¼Œç§°ä¹‹ä¸ºæ˜¯ç¡¬èšç±»ç®—æ³•ã€‚è€Œ EM èšç±»åœ¨æ±‚è§£çš„è¿‡ç¨‹ä¸­ï¼Œå®é™…ä¸Šæ¯ä¸ªæ ·æœ¬éƒ½æœ‰ä¸€å®šçš„æ¦‚ç‡å’Œæ¯ä¸ªèšç±»ç›¸å…³ï¼Œå«åšè½¯èšç±»ç®—æ³•ã€‚ä½ å¯ä»¥æŠŠ EM ç®—æ³•ç†è§£æˆä¸ºæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œåœ¨è¿™ä¸ªæ¡†æ¶ä¸­å¯ä»¥é‡‡ç”¨ä¸åŒçš„æ¨¡å‹æ¥ç”¨ EM è¿›è¡Œæ±‚è§£ã€‚å¸¸ç”¨çš„ EM èšç±»æœ‰ GMM é«˜æ–¯æ··åˆæ¨¡å‹å’Œ HMM éšé©¬å°”ç§‘å¤«æ¨¡å‹ã€‚GMMï¼ˆé«˜æ–¯æ··åˆæ¨¡å‹ï¼‰èšç±»å°±æ˜¯ EM èšç±»çš„ä¸€ç§ã€‚æ¯”å¦‚ä¸Šé¢è¿™ä¸¤ä¸ªå›¾ï¼Œå¯ä»¥é‡‡ç”¨ GMM æ¥è¿›è¡Œèšç±»ã€‚å’Œ K-Means ä¸€æ ·ï¼Œæˆ‘ä»¬äº‹å…ˆçŸ¥é“èšç±»çš„ä¸ªæ•°ï¼Œä½†æ˜¯ä¸çŸ¥é“æ¯ä¸ªæ ·æœ¬åˆ†åˆ«å±äºå“ªä¸€ç±»ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾æ ·æœ¬æ˜¯ç¬¦åˆé«˜æ–¯åˆ†å¸ƒçš„ï¼ˆä¹Ÿå°±æ˜¯æ­£æ€åˆ†å¸ƒï¼‰ã€‚æ¯ä¸ªé«˜æ–¯åˆ†å¸ƒéƒ½å±äºè¿™ä¸ªæ¨¡å‹çš„ç»„æˆéƒ¨åˆ†ï¼ˆcomponentï¼‰ï¼Œè¦åˆ†æˆ K ç±»å°±ç›¸å½“äºæ˜¯ K ä¸ªç»„æˆéƒ¨åˆ†ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥å…ˆåˆå§‹åŒ–æ¯ä¸ªç»„æˆéƒ¨åˆ†çš„é«˜æ–¯åˆ†å¸ƒçš„å‚æ•°ï¼Œç„¶åå†çœ‹æ¥æ¯ä¸ªæ ·æœ¬æ˜¯å±äºå“ªä¸ªç»„æˆéƒ¨åˆ†ã€‚è¿™ä¹Ÿå°±æ˜¯ E æ­¥éª¤ã€‚å†é€šè¿‡å¾—åˆ°çš„è¿™äº›éšå«å˜é‡ç»“æœï¼Œåè¿‡æ¥æ±‚æ¯ä¸ªç»„æˆéƒ¨åˆ†é«˜æ–¯åˆ†å¸ƒçš„å‚æ•°ï¼Œå³ M æ­¥éª¤ã€‚åå¤ EM æ­¥éª¤ï¼Œç›´åˆ°æ¯ä¸ªç»„æˆéƒ¨åˆ†çš„é«˜æ–¯åˆ†å¸ƒå‚æ•°ä¸å˜ä¸ºæ­¢ã€‚è¿™æ ·ä¹Ÿå°±ç›¸å½“äºå°†æ ·æœ¬æŒ‰ç…§ GMM æ¨¡å‹è¿›è¡Œäº† EM èšç±»ã€‚æ€»ç»“EM ç®—æ³•ç›¸å½“äºä¸€ä¸ªæ¡†æ¶ï¼Œä½ å¯ä»¥é‡‡ç”¨ä¸åŒçš„æ¨¡å‹æ¥è¿›è¡Œèšç±»ï¼Œæ¯”å¦‚ GMMï¼ˆé«˜æ–¯æ··åˆæ¨¡å‹ï¼‰ï¼Œæˆ–è€… HMMï¼ˆéšé©¬å°”ç§‘å¤«æ¨¡å‹ï¼‰æ¥è¿›è¡Œèšç±»ã€‚GMM æ˜¯é€šè¿‡æ¦‚ç‡å¯†åº¦æ¥è¿›è¡Œèšç±»ï¼Œèšæˆçš„ç±»ç¬¦åˆé«˜æ–¯åˆ†å¸ƒï¼ˆæ­£æ€åˆ†å¸ƒï¼‰ã€‚è€Œ HMM ç”¨åˆ°äº†é©¬å°”å¯å¤«è¿‡ç¨‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡çŠ¶æ€è½¬ç§»çŸ©é˜µæ¥è®¡ç®—çŠ¶æ€è½¬ç§»çš„æ¦‚ç‡ã€‚HMM åœ¨è‡ªç„¶è¯­è¨€å¤„ç†å’Œè¯­éŸ³è¯†åˆ«é¢†åŸŸä¸­æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚åœ¨ EM è¿™ä¸ªæ¡†æ¶ä¸­ï¼ŒE æ­¥éª¤ç›¸å½“äºæ˜¯é€šè¿‡åˆå§‹åŒ–çš„å‚æ•°æ¥ä¼°è®¡éšå«å˜é‡ã€‚M æ­¥éª¤å°±æ˜¯é€šè¿‡éšå«å˜é‡åæ¨æ¥ä¼˜åŒ–å‚æ•°ã€‚æœ€åé€šè¿‡ EM æ­¥éª¤çš„è¿­ä»£å¾—åˆ°æ¨¡å‹å‚æ•°ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹é‡Œç”¨åˆ°çš„ä¸€äº›æ•°å­¦å…¬å¼è¿™èŠ‚è¯¾ä¸è¿›è¡Œå±•å¼€ã€‚ä½ éœ€è¦é‡ç‚¹ç†è§£ EM ç®—æ³•çš„åŸç†ã€‚é€šè¿‡ä¸Šé¢ä¸¾çš„ç‚’èœçš„ä¾‹å­ï¼Œä½ å¯ä»¥çŸ¥é“ EM ç®—æ³•æ˜¯ä¸€ä¸ªä¸æ–­è§‚å¯Ÿå’Œè°ƒæ•´çš„è¿‡ç¨‹ã€‚é€šè¿‡æ±‚ç¡¬å¸æ­£é¢æ¦‚ç‡çš„ä¾‹å­ï¼Œä½ å¯ä»¥ç†è§£å¦‚ä½•é€šè¿‡åˆå§‹åŒ–å‚æ•°æ¥æ±‚éšå«æ•°æ®çš„è¿‡ç¨‹ï¼Œä»¥åŠå†é€šè¿‡æ±‚å¾—çš„éšå«æ•°æ®æ¥ä¼˜åŒ–å‚æ•°ã€‚é€šè¿‡ä¸Šé¢ GMM å›¾åƒèšç±»çš„ä¾‹å­ï¼Œä½ å¯ä»¥çŸ¥é“å¾ˆå¤š K-Means è§£å†³ä¸äº†çš„é—®é¢˜ï¼ŒEM èšç±»æ˜¯å¯ä»¥è§£å†³çš„ã€‚åœ¨ EM æ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬å°†æ½œåœ¨ç±»åˆ«å½“åšéšè—å˜é‡ï¼Œæ ·æœ¬çœ‹åšè§‚å¯Ÿå€¼ï¼ŒæŠŠèšç±»é—®é¢˜è½¬åŒ–ä¸ºå‚æ•°ä¼°è®¡é—®é¢˜ï¼Œæœ€ç»ˆæŠŠæ ·æœ¬è¿›è¡Œèšç±»ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"EM","slug":"EM","permalink":"cpeixin.cn/tags/EM/"}]},{"title":"æ•°æ®åˆ†æ-å†³ç­–æ ‘å®æˆ˜-æ³°å¦å°¼å…‹å·ä¹˜å®¢ç”Ÿå­˜é¢„æµ‹","slug":"æ•°æ®åˆ†æ-å†³ç­–æ ‘å®æˆ˜-æ³°å¦å°¼å…‹å·ä¹˜å®¢ç”Ÿå­˜é¢„æµ‹","date":"2018-07-15T14:12:49.000Z","updated":"2020-05-01T14:18:39.272Z","comments":true,"path":"2018/07/15/æ•°æ®åˆ†æ-å†³ç­–æ ‘å®æˆ˜-æ³°å¦å°¼å…‹å·ä¹˜å®¢ç”Ÿå­˜é¢„æµ‹/","link":"","permalink":"cpeixin.cn/2018/07/15/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E5%86%B3%E7%AD%96%E6%A0%91%E5%AE%9E%E6%88%98-%E6%B3%B0%E5%9D%A6%E5%B0%BC%E5%85%8B%E5%8F%B7%E4%B9%98%E5%AE%A2%E7%94%9F%E5%AD%98%E9%A2%84%E6%B5%8B/","excerpt":"","text":"åœ¨å‰é¢çš„ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ç»™ä½ è®²äº†å†³ç­–æ ‘ç®—æ³•ã€‚å†³ç­–æ ‘ç®—æ³•æ˜¯ç»å¸¸ä½¿ç”¨çš„æ•°æ®æŒ–æ˜ç®—æ³•ï¼Œè¿™æ˜¯å› ä¸ºå†³ç­–æ ‘å°±åƒä¸€ä¸ªäººè„‘ä¸­çš„å†³ç­–æ¨¡å‹ä¸€æ ·ï¼Œå‘ˆç°å‡ºæ¥éå¸¸ç›´è§‚ã€‚åŸºäºå†³ç­–æ ‘è¿˜è¯ç”Ÿäº†å¾ˆå¤šæ•°æ®æŒ–æ˜ç®—æ³•ï¼Œæ¯”å¦‚éšæœºæ£®æ—ï¼ˆRandom forestï¼‰ã€‚ä»Šå¤©æˆ‘æ¥å¸¦ä½ ç”¨å†³ç­–æ ‘è¿›è¡Œé¡¹ç›®çš„å®æˆ˜ã€‚å†³ç­–æ ‘åˆ†ç±»çš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œåœ¨å„è¡Œå„ä¸šéƒ½æœ‰åº”ç”¨ï¼Œæ¯”å¦‚åœ¨é‡‘èè¡Œä¸šå¯ä»¥ç”¨å†³ç­–æ ‘åšè´·æ¬¾é£é™©è¯„ä¼°ï¼ŒåŒ»ç–—è¡Œä¸šå¯ä»¥ç”¨å†³ç­–æ ‘ç”Ÿæˆè¾…åŠ©è¯Šæ–­ï¼Œç”µå•†è¡Œä¸šå¯ä»¥ç”¨å†³ç­–æ ‘å¯¹é”€å”®é¢è¿›è¡Œé¢„æµ‹ç­‰ã€‚åœ¨äº†è§£å†³ç­–æ ‘çš„åŸç†åï¼Œä»Šå¤©æˆ‘ä»¬ç”¨ sklearn å·¥å…·è§£å†³ä¸€ä¸ªå®é™…çš„é—®é¢˜ï¼šæ³°å¦å°¼å…‹å·ä¹˜å®¢çš„ç”Ÿå­˜é¢„æµ‹ã€‚sklearn ä¸­çš„å†³ç­–æ ‘æ¨¡å‹é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æŒæ¡ sklearn ä¸­è‡ªå¸¦çš„å†³ç­–æ ‘åˆ†ç±»å™¨ DecisionTreeClassifierï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š1clf = DecisionTreeClassifier(criterion='entropy')åˆ°ç›®å‰ä¸ºæ­¢ï¼Œsklearn ä¸­åªå®ç°äº† ID3 ä¸ CART å†³ç­–æ ‘ï¼Œæ‰€ä»¥æˆ‘ä»¬æš‚æ—¶åªèƒ½ä½¿ç”¨è¿™ä¸¤ç§å†³ç­–æ ‘ï¼Œåœ¨æ„é€  DecisionTreeClassifier ç±»æ—¶ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå‚æ•°æ˜¯ criterionï¼Œæ„ä¸ºæ ‡å‡†ã€‚å®ƒå†³å®šäº†æ„é€ çš„åˆ†ç±»æ ‘æ˜¯é‡‡ç”¨ ID3 åˆ†ç±»æ ‘ï¼Œè¿˜æ˜¯ CART åˆ†ç±»æ ‘ï¼Œå¯¹åº”çš„å–å€¼åˆ†åˆ«æ˜¯ entropy æˆ–è€… ginientropy: åŸºäºä¿¡æ¯ç†µï¼Œä¹Ÿå°±æ˜¯ ID3 ç®—æ³•ï¼Œå®é™…ç»“æœä¸ C4.5 ç›¸å·®ä¸å¤§ï¼›giniï¼šé»˜è®¤å‚æ•°ï¼ŒåŸºäºåŸºå°¼ç³»æ•°ã€‚CART ç®—æ³•æ˜¯åŸºäºåŸºå°¼ç³»æ•°åšå±æ€§åˆ’åˆ†çš„ï¼Œæ‰€ä»¥ criterion=gini æ—¶ï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯ CART ç®—æ³•ã€‚æˆ‘ä»¬é€šè¿‡è®¾ç½® criterion=â€™entropyâ€™å¯ä»¥åˆ›å»ºä¸€ä¸ª ID3 å†³ç­–æ ‘åˆ†ç±»å™¨ï¼Œç„¶åæ‰“å°ä¸‹ clfï¼Œçœ‹ä¸‹å†³ç­–æ ‘åœ¨ sklearn ä¸­æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿ123456DecisionTreeClassifier(class_weight=None, criterion='entropy', max_depth=None, max_features=None, max_leaf_nodes=None, min_impurity_decrease=0.0, min_impurity_split=None, min_samples_leaf=1, min_samples_split=2, min_weight_fraction_leaf=0.0, presort=False, random_state=None, splitter='best')è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°äº†å¾ˆå¤šå‚æ•°ï¼Œé™¤äº†è®¾ç½® criterion é‡‡ç”¨ä¸åŒçš„å†³ç­–æ ‘ç®—æ³•å¤–ï¼Œä¸€èˆ¬å»ºè®®ä½¿ç”¨é»˜è®¤çš„å‚æ•°ï¼Œé»˜è®¤å‚æ•°ä¸ä¼šé™åˆ¶å†³ç­–æ ‘çš„æœ€å¤§æ·±åº¦ï¼Œä¸é™åˆ¶å¶å­èŠ‚ç‚¹æ•°ï¼Œè®¤ä¸ºæ‰€æœ‰åˆ†ç±»çš„æƒé‡éƒ½ç›¸ç­‰ç­‰ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥è°ƒæ•´è¿™äº›å‚æ•°ï¼Œæ¥åˆ›å»ºä¸åŒçš„å†³ç­–æ ‘æ¨¡å‹ã€‚æˆ‘æ•´ç†äº†è¿™äº›å‚æ•°ä»£è¡¨çš„å«ä¹‰ï¼š![1585397401268-c9ea5ebf-53aa-44e0-8588-13582a240b5d.png](https://cdn.nlark.com/yuque/0/2020/png/1072113/1586919851176-2a57ac36-49da-475d-adc2-dc6f3f2434b3.png#align=left&display=inline&height=930&margin=%5Bobject%20Object%5D&name=1585397401268-c9ea5ebf-53aa-44e0-8588-13582a240b5d.png&originHeight=930&originWidth=620&size=366558&status=done&style=none&width=620)åœ¨æ„é€ å†³ç­–æ ‘åˆ†ç±»å™¨åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ fit æ–¹æ³•è®©åˆ†ç±»å™¨è¿›è¡Œæ‹Ÿåˆï¼Œä½¿ç”¨ predict æ–¹æ³•å¯¹æ–°æ•°æ®è¿›è¡Œé¢„æµ‹ï¼Œå¾—åˆ°é¢„æµ‹çš„åˆ†ç±»ç»“æœï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ score æ–¹æ³•å¾—åˆ°åˆ†ç±»å™¨çš„å‡†ç¡®ç‡ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ˜¯ fit æ–¹æ³•ã€predict æ–¹æ³•å’Œ score æ–¹æ³•çš„ä½œç”¨:![1585397402135-ed1fff6c-1bee-49f9-bf07-9fb87d83e0f3.png](https://cdn.nlark.com/yuque/0/2020/png/1072113/1586919851152-b2b5be44-9293-4e4d-998f-d1acd73a33da.png#align=left&display=inline&height=158&margin=%5Bobject%20Object%5D&name=1585397402135-ed1fff6c-1bee-49f9-bf07-9fb87d83e0f3.png&originHeight=158&originWidth=468&size=27331&status=done&style=none&width=468) ### Titanic ä¹˜å®¢ç”Ÿå­˜é¢„æµ‹ #### é—®é¢˜æè¿° æ³°å¦å°¼å…‹æµ·éš¾æ˜¯è‘—åçš„åå¤§ç¾éš¾ä¹‹ä¸€ï¼Œç©¶ç«Ÿå¤šå°‘äººé‡éš¾ï¼Œå„æ–¹ç»Ÿè®¡çš„ç»“æœä¸ä¸€ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥å¾—åˆ°éƒ¨åˆ†çš„æ•°æ®ï¼Œå…·ä½“æ•°æ®ä½ å¯ä»¥ä» GitHub ä¸Šä¸‹è½½ï¼š[ç‚¹æˆ‘](https://github.com/cystanford/Titanic_Data)å…¶ä¸­æ•°æ®é›†æ ¼å¼ä¸º csvï¼Œä¸€å…±æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼štrain.csv æ˜¯è®­ç»ƒæ•°æ®é›†ï¼ŒåŒ…å«ç‰¹å¾ä¿¡æ¯å’Œå­˜æ´»ä¸å¦çš„æ ‡ç­¾ï¼›test.csv: æµ‹è¯•æ•°æ®é›†ï¼ŒåªåŒ…å«ç‰¹å¾ä¿¡æ¯ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦ç”¨å†³ç­–æ ‘åˆ†ç±»å¯¹è®­ç»ƒé›†è¿›è¡Œè®­ç»ƒï¼Œé’ˆå¯¹æµ‹è¯•é›†ä¸­çš„ä¹˜å®¢è¿›è¡Œç”Ÿå­˜é¢„æµ‹ï¼Œå¹¶å‘ŠçŸ¥åˆ†ç±»å™¨çš„å‡†ç¡®ç‡ã€‚åœ¨è®­ç»ƒé›†ä¸­ï¼ŒåŒ…æ‹¬äº†ä»¥ä¸‹å­—æ®µï¼Œå®ƒä»¬å…·ä½“ä¸ºï¼š![1585397401155-e052cf89-fe96-49b3-b3fe-37539d7a67ae.png](https://cdn.nlark.com/yuque/0/2020/png/1072113/1586919895980-6bd3d51e-cf8d-4a92-a444-f540fcba423a.png#align=left&display=inline&height=370&margin=%5Bobject%20Object%5D&name=1585397401155-e052cf89-fe96-49b3-b3fe-37539d7a67ae.png&originHeight=370&originWidth=466&size=41457&status=done&style=none&width=466) #### ç”Ÿå­˜é¢„æµ‹çš„å…³é”®æµç¨‹ æˆ‘ä»¬è¦å¯¹è®­ç»ƒé›†ä¸­ä¹˜å®¢çš„ç”Ÿå­˜è¿›è¡Œé¢„æµ‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥åˆ’åˆ†ä¸ºä¸¤ä¸ªé‡è¦çš„é˜¶æ®µï¼š![](https://cdn.nlark.com/yuque/0/2020/png/1072113/1585397402088-8ce15112-7300-4b68-b34c-0bc6a0c960c0.png#align=left&display=inline&height=1470&margin=%5Bobject%20Object%5D&originHeight=1470&originWidth=3202&size=0&status=done&style=none&width=3202)**å‡†å¤‡é˜¶æ®µ**ï¼šæˆ‘ä»¬é¦–å…ˆéœ€è¦å¯¹è®­ç»ƒé›†ã€æµ‹è¯•é›†çš„æ•°æ®è¿›è¡Œæ¢ç´¢ï¼Œåˆ†ææ•°æ®è´¨é‡ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ï¼Œç„¶åé€šè¿‡ç‰¹å¾é€‰æ‹©å¯¹æ•°æ®è¿›è¡Œé™ç»´ï¼Œæ–¹ä¾¿åç»­åˆ†ç±»è¿ç®—ï¼›**åˆ†ç±»é˜¶æ®µ**ï¼šé¦–å…ˆé€šè¿‡è®­ç»ƒé›†çš„ç‰¹å¾çŸ©é˜µã€åˆ†ç±»ç»“æœå¾—åˆ°å†³ç­–æ ‘åˆ†ç±»å™¨ï¼Œç„¶åå°†åˆ†ç±»å™¨åº”ç”¨äºæµ‹è¯•é›†ã€‚ç„¶åæˆ‘ä»¬å¯¹å†³ç­–æ ‘åˆ†ç±»å™¨çš„å‡†ç¡®æ€§è¿›è¡Œåˆ†æï¼Œå¹¶å¯¹å†³ç­–æ ‘æ¨¡å‹è¿›è¡Œå¯è§†åŒ–ã€‚ä¸‹é¢ï¼Œæˆ‘åˆ†åˆ«å¯¹è¿™äº›æ¨¡å—è¿›è¡Œä»‹ç»ã€‚**æ¨¡å— 1**ï¼šæ•°æ®æ¢ç´¢æ•°æ®æ¢ç´¢è¿™éƒ¨åˆ†è™½ç„¶å¯¹åˆ†ç±»å™¨æ²¡æœ‰å®è´¨ä½œç”¨ï¼Œä½†æ˜¯ä¸å¯å¿½ç•¥ã€‚æˆ‘ä»¬åªæœ‰è¶³å¤Ÿäº†è§£è¿™äº›æ•°æ®çš„ç‰¹æ€§ï¼Œæ‰èƒ½å¸®åŠ©æˆ‘ä»¬åšæ•°æ®æ¸…æ´—ã€ç‰¹å¾é€‰æ‹©ã€‚é‚£ä¹ˆå¦‚ä½•è¿›è¡Œæ•°æ®æ¢ç´¢å‘¢ï¼Ÿè¿™é‡Œæœ‰ä¸€äº›å‡½æ•°ä½ éœ€è¦äº†è§£ï¼šä½¿ç”¨ info() äº†è§£æ•°æ®è¡¨çš„åŸºæœ¬æƒ…å†µï¼šè¡Œæ•°ã€åˆ—æ•°ã€æ¯åˆ—çš„æ•°æ®ç±»å‹ã€æ•°æ®å®Œæ•´åº¦ï¼›ä½¿ç”¨ describe() äº†è§£æ•°æ®è¡¨çš„ç»Ÿè®¡æƒ…å†µï¼šæ€»æ•°ã€å¹³å‡å€¼ã€æ ‡å‡†å·®ã€æœ€å°å€¼ã€æœ€å¤§å€¼ç­‰ï¼›ä½¿ç”¨ describe(include=[â€˜Oâ€™]) æŸ¥çœ‹å­—ç¬¦ä¸²ç±»å‹ï¼ˆéæ•°å­—ï¼‰çš„æ•´ä½“æƒ…å†µï¼›ä½¿ç”¨ head æŸ¥çœ‹å‰å‡ è¡Œæ•°æ®ï¼ˆé»˜è®¤æ˜¯å‰ 5 è¡Œï¼‰ï¼›ä½¿ç”¨ tail æŸ¥çœ‹åå‡ è¡Œæ•°æ®ï¼ˆé»˜è®¤æ˜¯æœ€å 5 è¡Œï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Pandas ä¾¿æ·åœ°å¤„ç†è¿™äº›é—®é¢˜ï¼š1234567891011121314151617181920import pandas as pdtrain_data = pd.read_csv('train.csv')print(train_data.info())print(\"===========================================\")print(train_data.describe())print(\"===========================================\")print(train_data.describe(include=['O']))print(\"===========================================\")print(train_data.head())print(\"===========================================\")print(train_data.tail())è¿è¡Œç»“æœï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354&lt;class 'pandas.core.frame.DataFrame'&gt;RangeIndex: 891 entries, 0 to 890Data columns (total 12 columns):PassengerId 891 non-null int64Survived 891 non-null int64Pclass 891 non-null int64Name 891 non-null objectSex 891 non-null objectAge 714 non-null float64SibSp 891 non-null int64Parch 891 non-null int64Ticket 891 non-null objectFare 891 non-null float64Cabin 204 non-null objectEmbarked 889 non-null objectdtypes: float64(2), int64(5), object(5)memory usage: 83.7+ KBNone=========================================== PassengerId Survived Pclass ... SibSp Parch Farecount 891.000000 891.000000 891.000000 ... 891.000000 891.000000 891.000000mean 446.000000 0.383838 2.308642 ... 0.523008 0.381594 32.204208std 257.353842 0.486592 0.836071 ... 1.102743 0.806057 49.693429min 1.000000 0.000000 1.000000 ... 0.000000 0.000000 0.00000025% 223.500000 0.000000 2.000000 ... 0.000000 0.000000 7.91040050% 446.000000 0.000000 3.000000 ... 0.000000 0.000000 14.45420075% 668.500000 1.000000 3.000000 ... 1.000000 0.000000 31.000000max 891.000000 1.000000 3.000000 ... 8.000000 6.000000 512.329200[8 rows x 7 columns]=========================================== Name Sex Ticket Cabin Embarkedcount 891 891 891 204 889unique 891 2 681 147 3top Wick, Miss. Mary Natalie male 347082 B96 B98 Sfreq 1 577 7 4 644=========================================== PassengerId Survived Pclass ... Fare Cabin Embarked0 1 0 3 ... 7.2500 NaN S1 2 1 1 ... 71.2833 C85 C2 3 1 3 ... 7.9250 NaN S3 4 1 1 ... 53.1000 C123 S4 5 0 3 ... 8.0500 NaN S[5 rows x 12 columns]=========================================== PassengerId Survived Pclass ... Fare Cabin Embarked886 887 0 2 ... 13.00 NaN S887 888 1 1 ... 30.00 B42 S888 889 0 3 ... 23.45 NaN S889 890 1 1 ... 30.00 C148 C890 891 0 3 ... 7.75 NaN Q[5 rows x 12 columns]æ¨¡å— 2ï¼šæ•°æ®æ¸…æ´—é€šè¿‡æ•°æ®æ¢ç´¢ï¼Œæˆ‘ä»¬å‘ç° Age å’Œ Cabin è¿™ä¸‰ä¸ªå­—æ®µçš„æ•°æ®æœ‰æ‰€ç¼ºå¤±ã€‚å…¶ä¸­ Age ä¸ºå¹´é¾„å­—æ®µï¼Œæ˜¯æ•°å€¼å‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¹³å‡å€¼è¿›è¡Œè¡¥é½ï¼›å…·ä½“å®ç°çš„ä»£ç å¦‚ä¸‹ï¼š12train_data['Age'].fillna(train_data['Age'].mean(), inplace=True)test_data['Age'].fillna(test_data['Age'].mean(),inplace=True)Cabin ä¸ºèˆ¹èˆ±ï¼Œæœ‰å¤§é‡çš„ç¼ºå¤±å€¼ã€‚åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­çš„ç¼ºå¤±ç‡åˆ†åˆ«ä¸º 77% å’Œ 78%ï¼Œæ— æ³•è¡¥é½ï¼›Embarked ä¸ºç™»é™†æ¸¯å£ï¼Œæœ‰å°‘é‡çš„ç¼ºå¤±å€¼ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç¼ºå¤±å€¼è¡¥é½ã€‚é¦–å…ˆè§‚å¯Ÿä¸‹ Embarked å­—æ®µçš„å–å€¼ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼šé¦–å…ˆè§‚å¯Ÿä¸‹ Embarked å­—æ®µçš„å–å€¼ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š1print(train_data['Embarked'].value_counts())ç»“æœå¦‚ä¸‹ï¼š123S 644C 168Q 77æˆ‘ä»¬å‘ç°ä¸€å…±å°± 3 ä¸ªç™»é™†æ¸¯å£ï¼Œå…¶ä¸­ S æ¸¯å£äººæ•°æœ€å¤šï¼Œå åˆ°äº† 72%ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶ä½™ç¼ºå¤±çš„ Embarked æ•°å€¼å‡è®¾ç½®ä¸º Sï¼š1train_data['Embarked'].fillna('S', inplace=True)æ¨¡å— 3ï¼šç‰¹å¾é€‰æ‹©ç‰¹å¾é€‰æ‹©æ˜¯åˆ†ç±»å™¨çš„å…³é”®ã€‚ç‰¹å¾é€‰æ‹©ä¸åŒï¼Œå¾—åˆ°çš„åˆ†ç±»å™¨ä¹Ÿä¸åŒã€‚é‚£ä¹ˆæˆ‘ä»¬è¯¥é€‰æ‹©å“ªäº›ç‰¹å¾åšç”Ÿå­˜çš„é¢„æµ‹å‘¢ï¼Ÿé€šè¿‡æ•°æ®æ¢ç´¢æˆ‘ä»¬å‘ç°ï¼ŒPassengerId ä¸ºä¹˜å®¢ç¼–å·ï¼Œå¯¹åˆ†ç±»æ²¡æœ‰ä½œç”¨ï¼Œå¯ä»¥æ”¾å¼ƒï¼›Name ä¸ºä¹˜å®¢å§“åï¼Œå¯¹åˆ†ç±»æ²¡æœ‰ä½œç”¨ï¼Œå¯ä»¥æ”¾å¼ƒï¼›Cabin å­—æ®µç¼ºå¤±å€¼å¤ªå¤šï¼Œå¯ä»¥æ”¾å¼ƒï¼› Ticket å­—æ®µä¸ºèˆ¹ç¥¨å·ç ï¼Œæ‚ä¹±æ— ç« ä¸”æ— è§„å¾‹ï¼Œå¯ä»¥æ”¾å¼ƒã€‚å…¶ä½™çš„å­—æ®µåŒ…æ‹¬ï¼šPclassã€Sexã€Ageã€SibSpã€Parch å’Œ Fareï¼Œè¿™äº›å±æ€§åˆ†åˆ«è¡¨ç¤ºäº†ä¹˜å®¢çš„èˆ¹ç¥¨ç­‰çº§ã€æ€§åˆ«ã€å¹´é¾„ã€äº²æˆšæ•°é‡ä»¥åŠèˆ¹ç¥¨ä»·æ ¼ï¼Œå¯èƒ½ä¼šå’Œä¹˜å®¢çš„ç”Ÿå­˜é¢„æµ‹åˆ†ç±»æœ‰å…³ç³»ã€‚å…·ä½“æ˜¯ä»€ä¹ˆå…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥äº¤ç»™åˆ†ç±»å™¨æ¥å¤„ç†ã€‚å› æ­¤æˆ‘ä»¬å…ˆå°† Pclassã€Sexã€Age ç­‰è¿™äº›å…¶ä½™çš„å­—æ®µä½œç‰¹å¾ï¼Œæ”¾åˆ°ç‰¹å¾å‘é‡ features é‡Œã€‚12345# ç‰¹å¾é€‰æ‹©features = ['Pclass', 'Sex', 'Age', 'SibSp', 'Parch', 'Fare', 'Embarked']train_features = train_data[features]train_labels = train_data['Survived']test_features = test_data[features]ç‰¹å¾å€¼é‡Œæœ‰ä¸€äº›æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™æ ·ä¸æ–¹ä¾¿åç»­çš„è¿ç®—ï¼Œéœ€è¦è½¬æˆæ•°å€¼ç±»å‹ï¼Œæ¯”å¦‚ Sex å­—æ®µï¼Œæœ‰ male å’Œ female ä¸¤ç§å–å€¼ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒå˜æˆ Sex=male å’Œ Sex=female ä¸¤ä¸ªå­—æ®µï¼Œæ•°å€¼ç”¨ 0 æˆ– 1 æ¥è¡¨ç¤ºã€‚åŒç† Embarked æœ‰ Sã€Cã€Q ä¸‰ç§å¯èƒ½ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ”¹æˆ Embarked=Sã€Embarked=C å’Œ Embarked=Q ä¸‰ä¸ªå­—æ®µï¼Œæ•°å€¼ç”¨ 0 æˆ– 1 æ¥è¡¨ç¤ºã€‚é‚£è¯¥å¦‚ä½•æ“ä½œå‘¢?æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ sklearn ç‰¹å¾é€‰æ‹©ä¸­çš„ DictVectorizer ç±»ï¼Œç”¨å®ƒå°†å¯ä»¥å¤„ç†ç¬¦å·åŒ–çš„å¯¹è±¡ï¼Œå°†ç¬¦å·è½¬æˆæ•°å­— 0/1 è¿›è¡Œè¡¨ç¤ºã€‚å…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼š123from sklearn.feature_extraction import DictVectorizerdvec=DictVectorizer(sparse=False)train_features=dvec.fit_transform(train_features.to_dict(orient='record'))ä½ ä¼šçœ‹åˆ°ä»£ç ä¸­ä½¿ç”¨äº† fit_transform è¿™ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥å°†ç‰¹å¾å‘é‡è½¬åŒ–ä¸ºç‰¹å¾å€¼çŸ©é˜µã€‚ç„¶åæˆ‘ä»¬çœ‹ä¸‹ dvec åœ¨è½¬åŒ–åçš„ç‰¹å¾å±æ€§æ˜¯æ€æ ·çš„ï¼Œå³æŸ¥çœ‹ dvec çš„ feature_names_ å±æ€§å€¼ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š12print(dvec.feature_names_)['Age', 'Embarked=C', 'Embarked=Q', 'Embarked=S', 'Fare', 'Parch', 'Pclass', 'Sex=female', 'Sex=male', 'SibSp']ä½ å¯ä»¥çœ‹åˆ°åŸæœ¬æ˜¯ä¸€åˆ—çš„ Embarkedï¼Œå˜æˆäº†â€œEmbarked=Câ€â€œEmbarked=Qâ€â€œEmbarked=Sâ€ä¸‰åˆ—ã€‚Sex åˆ—å˜æˆäº†â€œSex=femaleâ€â€œSex=maleâ€ä¸¤åˆ—ã€‚è¿™æ · train_features ç‰¹å¾çŸ©é˜µå°±åŒ…æ‹¬ 10 ä¸ªç‰¹å¾å€¼ï¼ˆåˆ—ï¼‰ï¼Œä»¥åŠ 891 ä¸ªæ ·æœ¬ï¼ˆè¡Œï¼‰ï¼Œå³ 891 è¡Œï¼Œ10 åˆ—çš„ç‰¹å¾çŸ©é˜µã€‚æ¨¡å— 4ï¼šå†³ç­–æ ‘æ¨¡å‹åˆšæ‰æˆ‘ä»¬å·²ç»è®²äº†å¦‚ä½•ä½¿ç”¨ sklearn ä¸­çš„å†³ç­–æ ‘æ¨¡å‹ã€‚ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ ID3 ç®—æ³•ï¼Œå³åœ¨åˆ›å»º DecisionTreeClassifier æ—¶ï¼Œè®¾ç½® criterion=â€˜entropyâ€™ï¼Œç„¶åä½¿ç”¨ fit è¿›è¡Œè®­ç»ƒï¼Œå°†ç‰¹å¾å€¼çŸ©é˜µå’Œåˆ†ç±»æ ‡è¯†ç»“æœä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œå¾—åˆ°å†³ç­–æ ‘åˆ†ç±»å™¨ã€‚12345from sklearn.tree import DecisionTreeClassifier# æ„é€ ID3å†³ç­–æ ‘clf = DecisionTreeClassifier(criterion='entropy')# å†³ç­–æ ‘è®­ç»ƒclf.fit(train_features, train_labels)æ¨¡å— 5ï¼šæ¨¡å‹é¢„æµ‹ &amp; è¯„ä¼°åœ¨é¢„æµ‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å¾—åˆ°æµ‹è¯•é›†çš„ç‰¹å¾å€¼çŸ©é˜µï¼Œç„¶åä½¿ç”¨è®­ç»ƒå¥½çš„å†³ç­–æ ‘ clf è¿›è¡Œé¢„æµ‹ï¼Œå¾—åˆ°é¢„æµ‹ç»“æœ pred_labelsï¼š123test_features=dvec.transform(test_features.to_dict(orient='record'))# å†³ç­–æ ‘é¢„æµ‹pred_labels = clf.predict(test_features)åœ¨æ¨¡å‹è¯„ä¼°ä¸­ï¼Œå†³ç­–æ ‘æä¾›äº† score å‡½æ•°å¯ä»¥ç›´æ¥å¾—åˆ°å‡†ç¡®ç‡ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸çŸ¥é“çœŸå®çš„é¢„æµ‹ç»“æœï¼Œæ‰€ä»¥æ— æ³•ç”¨é¢„æµ‹å€¼å’ŒçœŸå®çš„é¢„æµ‹ç»“æœåšæ¯”è¾ƒã€‚æˆ‘ä»¬åªèƒ½ä½¿ç”¨è®­ç»ƒé›†ä¸­çš„æ•°æ®è¿›è¡Œæ¨¡å‹è¯„ä¼°ï¼Œå¯ä»¥ä½¿ç”¨å†³ç­–æ ‘è‡ªå¸¦çš„ score å‡½æ•°è®¡ç®—ä¸‹å¾—åˆ°çš„ç»“æœï¼š123# å¾—åˆ°å†³ç­–æ ‘å‡†ç¡®ç‡acc_decision_tree = round(clf.score(train_features, train_labels), 6)print(u'scoreå‡†ç¡®ç‡ä¸º %.4lf' % acc_decision_tree)è¿è¡Œç»“æœï¼š1scoreå‡†ç¡®ç‡ä¸º 0.9820ä½ ä¼šå‘ç°ä½ åˆšç”¨è®­ç»ƒé›†åšè®­ç»ƒï¼Œå†ç”¨è®­ç»ƒé›†è‡ªèº«åšå‡†ç¡®ç‡è¯„ä¼°è‡ªç„¶ä¼šå¾ˆé«˜ã€‚ä½†è¿™æ ·å¾—å‡ºçš„å‡†ç¡®ç‡å¹¶ä¸èƒ½ä»£è¡¨å†³ç­–æ ‘åˆ†ç±»å™¨çš„å‡†ç¡®ç‡ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬æ²¡æœ‰æµ‹è¯•é›†çš„å®é™…ç»“æœï¼Œå› æ­¤æ— æ³•ç”¨æµ‹è¯•é›†çš„é¢„æµ‹ç»“æœä¸å®é™…ç»“æœåšå¯¹æ¯”(test.csvæ•°æ®ä¸­æ²¡æœ‰Survived)ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ score å‡½æ•°å¯¹è®­ç»ƒé›†çš„å‡†ç¡®ç‡è¿›è¡Œç»Ÿè®¡ï¼Œæ­£ç¡®ç‡ä¼šæ¥è¿‘äº 100%ï¼ˆå¦‚ä¸Šç»“æœä¸º 98.2%ï¼‰ï¼Œæ— æ³•å¯¹åˆ†ç±»å™¨çš„åœ¨å®é™…ç¯å¢ƒä¸‹åšå‡†ç¡®ç‡çš„è¯„ä¼°ã€‚é‚£ä¹ˆæœ‰ä»€ä¹ˆåŠæ³•ï¼Œæ¥ç»Ÿè®¡å†³ç­–æ ‘åˆ†ç±»å™¨çš„å‡†ç¡®ç‡å‘¢ï¼Ÿè¿™é‡Œå¯ä»¥ä½¿ç”¨ K æŠ˜äº¤å‰éªŒè¯çš„æ–¹å¼ï¼Œäº¤å‰éªŒè¯æ˜¯ä¸€ç§å¸¸ç”¨çš„éªŒè¯åˆ†ç±»å‡†ç¡®ç‡çš„æ–¹æ³•ï¼ŒåŸç†æ˜¯æ‹¿å‡ºå¤§éƒ¨åˆ†æ ·æœ¬è¿›è¡Œè®­ç»ƒï¼Œå°‘é‡çš„ç”¨äºåˆ†ç±»å™¨çš„éªŒè¯ã€‚K æŠ˜äº¤å‰éªŒè¯ï¼Œå°±æ˜¯åš K æ¬¡äº¤å‰éªŒè¯ï¼Œæ¯æ¬¡é€‰å– K åˆ†ä¹‹ä¸€çš„æ•°æ®ä½œä¸ºéªŒè¯ï¼Œå…¶ä½™ä½œä¸ºè®­ç»ƒã€‚è½®æµ K æ¬¡ï¼Œå–å¹³å‡å€¼ã€‚K æŠ˜äº¤å‰éªŒè¯çš„åŸç†æ˜¯è¿™æ ·çš„ï¼šå°†æ•°æ®é›†å¹³å‡åˆ†å‰²æˆ K ä¸ªç­‰ä»½ï¼›ä½¿ç”¨ 1 ä»½æ•°æ®ä½œä¸ºæµ‹è¯•æ•°æ®ï¼Œå…¶ä½™ä½œä¸ºè®­ç»ƒæ•°æ®ï¼›è®¡ç®—æµ‹è¯•å‡†ç¡®ç‡ï¼›ä½¿ç”¨ä¸åŒçš„æµ‹è¯•é›†ï¼Œé‡å¤ 2ã€3 æ­¥éª¤ã€‚åœ¨ sklearn çš„ model_selection æ¨¡å‹é€‰æ‹©ä¸­æä¾›äº† cross_val_score å‡½æ•°ã€‚cross_val_score å‡½æ•°ä¸­çš„å‚æ•° cv ä»£è¡¨å¯¹åŸå§‹æ•°æ®åˆ’åˆ†æˆå¤šå°‘ä»½ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ K å€¼ï¼Œä¸€èˆ¬å»ºè®® K å€¼å– 10ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è®¾ç½® CV=10ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯”ä¸‹ score å’Œ cross_val_score ä¸¤ç§å‡½æ•°çš„æ­£ç¡®ç‡çš„è¯„ä¼°ç»“æœï¼š1234import numpy as npfrom sklearn.model_selection import cross_val_score# ä½¿ç”¨KæŠ˜äº¤å‰éªŒè¯ ç»Ÿè®¡å†³ç­–æ ‘å‡†ç¡®ç‡print(u'cross_val_scoreå‡†ç¡®ç‡ä¸º %.4lf' % np.mean(cross_val_score(clf, train_features, train_labels, cv=10)))1cross_val_scoreå‡†ç¡®ç‡ä¸º 0.7835ä½ å¯ä»¥çœ‹åˆ°ï¼Œscore å‡½æ•°çš„å‡†ç¡®ç‡ä¸º 0.9820ï¼Œcross_val_score å‡†ç¡®ç‡ä¸º 0.7835ã€‚è¿™é‡Œå¾ˆæ˜æ˜¾ï¼Œå¯¹äºä¸çŸ¥é“æµ‹è¯•é›†å®é™…ç»“æœçš„ï¼Œè¦ä½¿ç”¨ K æŠ˜äº¤å‰éªŒè¯æ‰èƒ½çŸ¥é“æ¨¡å‹çš„å‡†ç¡®ç‡ã€‚æ¨¡å— 6ï¼šå†³ç­–æ ‘å¯è§†åŒ–sklearn çš„å†³ç­–æ ‘æ¨¡å‹å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œè¿˜æ˜¯æ¯”è¾ƒæŠ½è±¡çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Graphviz å¯è§†åŒ–å·¥å…·å¸®æˆ‘ä»¬æŠŠå†³ç­–æ ‘å‘ˆç°å‡ºæ¥ã€‚å®‰è£… Graphviz åº“éœ€è¦ä¸‹é¢çš„å‡ æ­¥ï¼šå®‰è£… graphviz å·¥å…·ï¼Œè¿™é‡Œæ˜¯å®ƒçš„ä¸‹è½½åœ°å€ï¼›http://www.graphviz.org/download/å°† Graphviz æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ PATH ä¸­ï¼›éœ€è¦ Graphviz åº“ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥ä½¿ç”¨ pip install graphviz è¿›è¡Œå®‰è£…ã€‚è¿™æ ·ä½ å°±å¯ä»¥åœ¨ç¨‹åºé‡Œé¢ä½¿ç”¨ Graphviz å¯¹å†³ç­–æ ‘æ¨¡å‹è¿›è¡Œå‘ˆç°ï¼Œæœ€åå¾—åˆ°ä¸€ä¸ªå†³ç­–æ ‘å¯è§†åŒ–çš„ PDF æ–‡ä»¶ï¼Œå¯è§†åŒ–ç»“æœæ–‡ä»¶ Source.gv.pdf ä½ å¯ä»¥åœ¨ GitHub ä¸Šä¸‹è½½ï¼šhttps://github.com/cystanford/Titanic_Dataå†³ç­–æ ‘æ¨¡å‹ä½¿ç”¨æŠ€å·§æ€»ç»“ä»Šå¤©æˆ‘ç”¨æ³°å¦å°¼å…‹ä¹˜å®¢ç”Ÿå­˜é¢„æµ‹æ¡ˆä¾‹æŠŠå†³ç­–æ ‘æ¨¡å‹çš„æµç¨‹è·‘äº†ä¸€éã€‚åœ¨å®æˆ˜ä¸­ï¼Œä½ éœ€è¦æ³¨æ„ä¸€ä¸‹å‡ ç‚¹ï¼šç‰¹å¾é€‰æ‹©æ˜¯åˆ†ç±»æ¨¡å‹å¥½åçš„å…³é”®ã€‚é€‰æ‹©ä»€ä¹ˆæ ·çš„ç‰¹å¾ï¼Œä»¥åŠå¯¹åº”çš„ç‰¹å¾å€¼çŸ©é˜µï¼Œå†³å®šäº†åˆ†ç±»æ¨¡å‹çš„å¥½åã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œç‰¹å¾å€¼ä¸éƒ½æ˜¯æ•°å€¼ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ DictVectorizer ç±»è¿›è¡Œè½¬åŒ–ï¼›æ¨¡å‹å‡†ç¡®ç‡éœ€è¦è€ƒè™‘æ˜¯å¦æœ‰æµ‹è¯•é›†çš„å®é™…ç»“æœå¯ä»¥åšå¯¹æ¯”ï¼Œå½“æµ‹è¯•é›†æ²¡æœ‰çœŸå®ç»“æœå¯ä»¥å¯¹æ¯”æ—¶ï¼Œéœ€è¦ä½¿ç”¨ K æŠ˜äº¤å‰éªŒè¯ cross_val_scoreï¼›Graphviz å¯è§†åŒ–å·¥å…·å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†å†³ç­–æ¨¡å‹å‘ˆç°å‡ºæ¥ï¼Œå¸®åŠ©ä½ æ›´å¥½ç†è§£å†³ç­–æ ‘çš„æ„å»ºã€‚æˆ‘ä¸Šé¢è®²äº†æ³°å¦å°¼å…‹ä¹˜å®¢ç”Ÿå­˜é¢„æµ‹çš„å…­ä¸ªå…³é”®æ¨¡å—ï¼Œè¯·ä½ ç”¨ sklearn ä¸­çš„å†³ç­–æ ‘æ¨¡å‹ç‹¬ç«‹å®Œæˆè¿™ä¸ªé¡¹ç›®ï¼Œå¯¹æµ‹è¯•é›†ä¸­çš„ä¹˜å®¢æ˜¯å¦ç”Ÿå­˜è¿›è¡Œé¢„æµ‹ï¼Œå¹¶ç»™å‡ºæ¨¡å‹å‡†ç¡®ç‡è¯„ä¼°ã€‚æ•°æ®ä» GitHub ä¸Šä¸‹è½½å³å¯ã€‚æœ€åç»™ä½ ç•™ä¸€ä¸ªæ€è€ƒé¢˜å§ï¼Œæˆ‘åœ¨æ„é€ ç‰¹å¾å‘é‡æ—¶ä½¿ç”¨äº† DictVectorizer ç±»ï¼Œä½¿ç”¨ fit_transform å‡½æ•°å°†ç‰¹å¾å‘é‡è½¬åŒ–ä¸ºç‰¹å¾å€¼çŸ©é˜µã€‚DictVectorizer ç±»åŒæ—¶ä¹Ÿæä¾› transform å‡½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå‡½æ•°æœ‰ä»€ä¹ˆåŒºåˆ«?é¡¹ç›®å®Œæ•´ä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546import pandas as pdfrom sklearn.tree import DecisionTreeClassifierfrom sklearn.feature_extraction import DictVectorizertrain_data = pd.read_csv('train.csv')test_data = pd.read_csv('test.csv')train_data['Age'].fillna(train_data['Age'].mean(), inplace=True)test_data['Age'].fillna(test_data['Age'].mean(), inplace=True)test_data['Fare'].fillna(test_data['Fare'].mean(), inplace=True)\"\"\"å°†ç©ºå€¼ç”¨æ­¤åˆ—æœ€å¤šå€¼æ¥è¡¥é½index è·å–ç´¢å¼•å€¼ã€‚ [num] ä¸‹æ ‡è·å–è¿”å›å€¼ ï¼Œascending=True é™åºæ’åˆ—\"\"\"train_data['Embarked'].fillna(train_data['Embarked'].value_counts().index[0], inplace=True)test_data['Embarked'].fillna(test_data['Embarked'].value_counts().index[0], inplace=True)features = ['Pclass', 'Sex', 'Age', 'SibSp', 'Parch', 'Fare', 'Embarked']train_features = train_data[features]train_labels = train_data['Survived']test_features = test_data[features]dvec=DictVectorizer(sparse=False)train_features=dvec.fit_transform(train_features.to_dict(orient='record'))# æ„é€ ID3å†³ç­–æ ‘clf = DecisionTreeClassifier(criterion='entropy')# å†³ç­–æ ‘è®­ç»ƒclf.fit(train_features, train_labels)test_features=dvec.transform(test_features.to_dict(orient='record'))# å†³ç­–æ ‘é¢„æµ‹# pred_labels = clf.predict(test_features)# # å¾—åˆ°å†³ç­–æ ‘å‡†ç¡®ç‡# acc_decision_tree = round(clf.score(train_features, train_labels), 6)# print(u'scoreå‡†ç¡®ç‡ä¸º %.4lf' % acc_decision_tree)import numpy as npfrom sklearn.model_selection import cross_val_score# ä½¿ç”¨KæŠ˜äº¤å‰éªŒè¯ ç»Ÿè®¡å†³ç­–æ ‘å‡†ç¡®ç‡print(u'cross_val_scoreå‡†ç¡®ç‡ä¸º %.4lf' % np.mean(cross_val_score(clf, train_features, train_labels, cv=10)))","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Decision Tree","slug":"Decision-Tree","permalink":"cpeixin.cn/tags/Decision-Tree/"}]},{"title":"æ•°æ®åˆ†æ-å†³ç­–æ ‘é¡¹ç›®-ç”¨æˆ·æµå¤±é¢„è­¦","slug":"æ•°æ®åˆ†æ-å†³ç­–æ ‘é¡¹ç›®-ç”¨æˆ·æµå¤±é¢„è­¦","date":"2018-07-14T11:19:49.000Z","updated":"2020-05-01T14:18:27.501Z","comments":true,"path":"2018/07/14/æ•°æ®åˆ†æ-å†³ç­–æ ‘é¡¹ç›®-ç”¨æˆ·æµå¤±é¢„è­¦/","link":"","permalink":"cpeixin.cn/2018/07/14/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E5%86%B3%E7%AD%96%E6%A0%91%E9%A1%B9%E7%9B%AE-%E7%94%A8%E6%88%B7%E6%B5%81%E5%A4%B1%E9%A2%84%E8%AD%A6/","excerpt":"","text":"https://www.zhihu.com/question/340500005https://zhuanlan.zhihu.com/p/26332219https://zhuanlan.zhihu.com/p/45435103éŸ³ä¹ç½‘ç«™ç”¨æˆ·æµå¤± ** https://zhuanlan.zhihu.com/p/29598241","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Decision Tree","slug":"Decision-Tree","permalink":"cpeixin.cn/tags/Decision-Tree/"}]},{"title":"æ•°æ®åˆ†æ-å†³ç­–æ ‘åˆ†ç±»ç®—æ³•-CART","slug":"æ•°æ®åˆ†æ-å†³ç­–æ ‘åˆ†ç±»ç®—æ³•-CART","date":"2018-07-13T15:12:49.000Z","updated":"2020-05-01T14:18:55.201Z","comments":true,"path":"2018/07/13/æ•°æ®åˆ†æ-å†³ç­–æ ‘åˆ†ç±»ç®—æ³•-CART/","link":"","permalink":"cpeixin.cn/2018/07/13/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E5%86%B3%E7%AD%96%E6%A0%91%E5%88%86%E7%B1%BB%E7%AE%97%E6%B3%95-CART/","excerpt":"","text":"CARTç®—æ³•ä¸ŠèŠ‚è¯¾æˆ‘ä»¬è®²äº†å†³ç­–æ ‘ï¼ŒåŸºäºä¿¡æ¯åº¦é‡çš„ä¸åŒæ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå†³ç­–æ ‘åˆ†ä¸º ID3 ç®—æ³•ã€C4.5 ç®—æ³•å’Œ CART ç®—æ³•ã€‚ä»Šå¤©æˆ‘æ¥å¸¦ä½ å­¦ä¹  CART ç®—æ³•ã€‚CART ç®—æ³•ï¼Œè‹±æ–‡å…¨ç§°å«åš Classification And Regression Treeï¼Œä¸­æ–‡å«åšåˆ†ç±»å›å½’æ ‘ã€‚ID3 å’Œ C4.5 ç®—æ³•å¯ä»¥ç”ŸæˆäºŒå‰æ ‘æˆ–å¤šå‰æ ‘ï¼Œè€Œ CART åªæ”¯æŒäºŒå‰æ ‘ã€‚åŒæ—¶ CART å†³ç­–æ ‘æ¯”è¾ƒç‰¹æ®Šï¼Œæ—¢å¯ä»¥ä½œåˆ†ç±»æ ‘ï¼Œåˆå¯ä»¥ä½œå›å½’æ ‘ã€‚é‚£ä¹ˆä½ é¦–å…ˆéœ€è¦äº†è§£çš„æ˜¯ï¼Œä»€ä¹ˆæ˜¯åˆ†ç±»æ ‘ï¼Œä»€ä¹ˆæ˜¯å›å½’æ ‘å‘¢ï¼Ÿæˆ‘ç”¨ä¸‹é¢çš„è®­ç»ƒæ•°æ®ä¸¾ä¸ªä¾‹å­ï¼Œä½ èƒ½çœ‹åˆ°ä¸åŒèŒä¸šçš„äººï¼Œä»–ä»¬çš„å¹´é¾„ä¸åŒï¼Œå­¦ä¹ æ—¶é—´ä¹Ÿä¸åŒã€‚å¦‚æœæˆ‘æ„é€ äº†ä¸€æ£µå†³ç­–æ ‘ï¼Œæƒ³è¦åŸºäºæ•°æ®åˆ¤æ–­è¿™ä¸ªäººçš„èŒä¸šèº«ä»½ï¼Œè¿™ä¸ªå°±å±äºåˆ†ç±»æ ‘ï¼Œå› ä¸ºæ˜¯ä»å‡ ä¸ªåˆ†ç±»ä¸­æ¥åšé€‰æ‹©ã€‚å¦‚æœæ˜¯ç»™å®šäº†æ•°æ®ï¼Œæƒ³è¦é¢„æµ‹è¿™ä¸ªäººçš„å¹´é¾„ï¼Œé‚£å°±å±äºå›å½’æ ‘ã€‚ä¸ç®¡æ˜¯åˆ†ç±»ï¼Œè¿˜æ˜¯å›å½’ï¼Œå…¶æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å¯¹è¾“å…¥åšå‡ºé¢„æµ‹ï¼Œå¹¶ä¸”éƒ½æ˜¯ç›‘ç£å­¦ä¹ ã€‚è¯´ç™½äº†ï¼Œå°±æ˜¯æ ¹æ®ç‰¹å¾ï¼Œåˆ†æè¾“å…¥çš„å†…å®¹ï¼Œåˆ¤æ–­å®ƒçš„ç±»åˆ«ï¼Œæˆ–è€…é¢„æµ‹å…¶å€¼ã€‚åˆ†ç±»é—®é¢˜è¾“å‡ºçš„æ˜¯ç‰©ä½“æ‰€å±çš„ç±»åˆ«ï¼Œå›å½’é—®é¢˜è¾“å‡ºçš„æ˜¯ç‰©ä½“çš„å€¼åˆ†ç±»æ ‘å¯ä»¥å¤„ç†ç¦»æ•£æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ•°æ®ç§ç±»æœ‰é™çš„æ•°æ®ï¼Œå®ƒè¾“å‡ºçš„æ˜¯æ ·æœ¬çš„ç±»åˆ«ï¼Œè€Œå›å½’æ ‘å¯ä»¥å¯¹è¿ç»­å‹çš„æ•°å€¼è¿›è¡Œé¢„æµ‹ï¼Œä¹Ÿå°±æ˜¯æ•°æ®åœ¨æŸä¸ªåŒºé—´å†…éƒ½æœ‰å–å€¼çš„å¯èƒ½ï¼Œå®ƒè¾“å‡ºçš„æ˜¯ä¸€ä¸ªæ•°å€¼ã€‚CART åˆ†ç±»æ ‘çš„å·¥ä½œæµç¨‹é€šè¿‡ä¸Šä¸€è®²ï¼Œæˆ‘ä»¬çŸ¥é“å†³ç­–æ ‘çš„æ ¸å¿ƒå°±æ˜¯å¯»æ‰¾çº¯å‡€çš„åˆ’åˆ†ï¼Œå› æ­¤å¼•å…¥äº†çº¯åº¦çš„æ¦‚å¿µã€‚åœ¨å±æ€§é€‰æ‹©ä¸Šï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ç»Ÿè®¡â€œä¸çº¯åº¦â€æ¥åšåˆ¤æ–­çš„ï¼ŒID3 æ˜¯åŸºäºä¿¡æ¯å¢ç›Šåšåˆ¤æ–­ï¼ŒC4.5 åœ¨ ID3 çš„åŸºç¡€ä¸Šåšäº†æ”¹è¿›ï¼Œæå‡ºäº†ä¿¡æ¯å¢ç›Šç‡çš„æ¦‚å¿µã€‚å®é™…ä¸Š CART åˆ†ç±»æ ‘ä¸ C4.5 ç®—æ³•ç±»ä¼¼ï¼Œåªæ˜¯å±æ€§é€‰æ‹©çš„æŒ‡æ ‡é‡‡ç”¨çš„æ˜¯åŸºå°¼ç³»æ•°ã€‚ä½ å¯èƒ½åœ¨ç»æµå­¦ä¸­å¬è¿‡è¯´åŸºå°¼ç³»æ•°ï¼Œå®ƒæ˜¯ç”¨æ¥è¡¡é‡ä¸€ä¸ªå›½å®¶æ”¶å…¥å·®è·çš„å¸¸ç”¨æŒ‡æ ‡ã€‚å½“åŸºå°¼ç³»æ•°å¤§äº 0.4 çš„æ—¶å€™ï¼Œè¯´æ˜è´¢å¯Œå·®å¼‚æ‚¬æ®Šã€‚åŸºå°¼ç³»æ•°åœ¨ 0.2-0.4 ä¹‹é—´è¯´æ˜åˆ†é…åˆç†ï¼Œè´¢å¯Œå·®è·ä¸å¤§ã€‚åŸºå°¼ç³»æ•°æœ¬èº«ååº”äº†æ ·æœ¬çš„ä¸ç¡®å®šåº¦ã€‚å½“åŸºå°¼ç³»æ•°è¶Šå°çš„æ—¶å€™ï¼Œè¯´æ˜æ ·æœ¬ä¹‹é—´çš„å·®å¼‚æ€§å°ï¼Œä¸ç¡®å®šç¨‹åº¦ä½ã€‚åˆ†ç±»çš„è¿‡ç¨‹æœ¬èº«æ˜¯ä¸€ä¸ªä¸ç¡®å®šåº¦é™ä½çš„è¿‡ç¨‹ï¼Œå³çº¯åº¦çš„æå‡è¿‡ç¨‹ã€‚æ‰€ä»¥ CART ç®—æ³•åœ¨æ„é€ åˆ†ç±»æ ‘çš„æ—¶å€™ï¼Œä¼šé€‰æ‹©åŸºå°¼ç³»æ•°æœ€å°çš„å±æ€§ä½œä¸ºå±æ€§çš„åˆ’åˆ†ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥è¯¦è§£äº†è§£ä¸€ä¸‹åŸºå°¼ç³»æ•°ã€‚åŸºå°¼ç³»æ•°ä¸å¥½æ‡‚ï¼Œä½ æœ€å¥½è·Ÿç€ä¾‹å­ä¸€èµ·æ‰‹åŠ¨è®¡ç®—ä¸‹ã€‚å‡è®¾ t ä¸ºèŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹çš„ GINI ç³»æ•°çš„è®¡ç®—å…¬å¼ä¸ºï¼šè¿™é‡Œ p(Ck|t) è¡¨ç¤ºèŠ‚ç‚¹ t å±äºç±»åˆ« Ck çš„æ¦‚ç‡ï¼ŒèŠ‚ç‚¹ t çš„åŸºå°¼ç³»æ•°ä¸º 1 å‡å»å„ç±»åˆ« Ck æ¦‚ç‡å¹³æ–¹å’Œã€‚é€šè¿‡ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è®¡ç®—ä¸€ä¸‹ä¸¤ä¸ªé›†åˆçš„åŸºå°¼ç³»æ•°åˆ†åˆ«ä¸ºå¤šå°‘ï¼šé›†åˆ 1ï¼š6 ä¸ªéƒ½å»æ‰“ç¯®çƒï¼›é›†åˆ 2ï¼š3 ä¸ªå»æ‰“ç¯®çƒï¼Œ3 ä¸ªä¸å»æ‰“ç¯®çƒã€‚é’ˆå¯¹é›†åˆ 1ï¼Œæ‰€æœ‰äººéƒ½å»æ‰“ç¯®çƒï¼Œæ‰€ä»¥ p(Ck|t)=1ï¼Œå› æ­¤ GINI(t)=1-1=0ã€‚é’ˆå¯¹é›†åˆ 2ï¼Œæœ‰ä¸€åŠäººå»æ‰“ç¯®çƒï¼Œè€Œå¦ä¸€åŠä¸å»æ‰“ç¯®çƒï¼Œæ‰€ä»¥ï¼Œp(C1|t)=0.5ï¼Œp(C2|t)=0.5ï¼ŒGINI(t)=1-ï¼ˆ0.5_0.5+0.5_0.5ï¼‰=0.5ã€‚é€šè¿‡ä¸¤ä¸ªåŸºå°¼ç³»æ•°ä½ å¯ä»¥çœ‹å‡ºï¼Œé›†åˆ 1 çš„åŸºå°¼ç³»æ•°æœ€å°ï¼Œä¹Ÿè¯æ˜æ ·æœ¬æœ€ç¨³å®šï¼Œè€Œé›†åˆ 2 çš„æ ·æœ¬ä¸ç¨³å®šæ€§æ›´å¤§ã€‚åœ¨ CART ç®—æ³•ä¸­ï¼ŒåŸºäºåŸºå°¼ç³»æ•°å¯¹ç‰¹å¾å±æ€§è¿›è¡ŒäºŒå…ƒåˆ†è£‚ï¼Œå‡è®¾å±æ€§ A å°†èŠ‚ç‚¹ D åˆ’åˆ†æˆäº† D1 å’Œ D2ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šèŠ‚ç‚¹ D çš„åŸºå°¼ç³»æ•°ç­‰äºå­èŠ‚ç‚¹ D1 å’Œ D2 çš„å½’ä¸€åŒ–åŸºå°¼ç³»æ•°ä¹‹å’Œï¼Œç”¨å…¬å¼è¡¨ç¤ºä¸ºï¼šå½’ä¸€åŒ–åŸºå°¼ç³»æ•°ä»£è¡¨çš„æ˜¯æ¯ä¸ªå­èŠ‚ç‚¹çš„åŸºå°¼ç³»æ•°ä¹˜ä»¥è¯¥èŠ‚ç‚¹å æ•´ä½“çˆ¶äº²èŠ‚ç‚¹ D ä¸­çš„æ¯”ä¾‹ã€‚ä¸Šé¢æˆ‘ä»¬å·²ç»è®¡ç®—äº†é›†åˆ D1 å’Œé›†åˆ D2 çš„ GINI ç³»æ•°ï¼Œå¾—åˆ°ï¼šæ‰€ä»¥åœ¨å±æ€§ A çš„åˆ’åˆ†ä¸‹ï¼ŒèŠ‚ç‚¹ D çš„åŸºå°¼ç³»æ•°ä¸ºï¼šèŠ‚ç‚¹ D è¢«å±æ€§ A åˆ’åˆ†åçš„åŸºå°¼ç³»æ•°è¶Šå¤§ï¼Œæ ·æœ¬é›†åˆçš„ä¸ç¡®å®šæ€§è¶Šå¤§ï¼Œä¹Ÿå°±æ˜¯ä¸çº¯åº¦è¶Šé«˜ã€‚å¦‚ä½•ä½¿ç”¨ CART ç®—æ³•æ¥åˆ›å»ºåˆ†ç±»æ ‘é€šè¿‡ä¸Šé¢çš„è®²è§£ä½ å¯ä»¥çŸ¥é“ï¼ŒCART åˆ†ç±»æ ‘å®é™…ä¸Šæ˜¯åŸºäºåŸºå°¼ç³»æ•°æ¥åšå±æ€§åˆ’åˆ†çš„ã€‚åœ¨ Python çš„ sklearn ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åˆ›å»º CART åˆ†ç±»æ ‘ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ DecisionTreeClassifier è¿™ä¸ªç±»ã€‚åˆ›å»ºè¿™ä¸ªç±»çš„æ—¶å€™ï¼Œé»˜è®¤æƒ…å†µä¸‹ criterion è¿™ä¸ªå‚æ•°ç­‰äº giniï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§åŸºå°¼ç³»æ•°æ¥é€‰æ‹©å±æ€§åˆ’åˆ†ï¼Œå³é»˜è®¤é‡‡ç”¨çš„æ˜¯ CART åˆ†ç±»æ ‘ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥ç”¨ CART åˆ†ç±»æ ‘ï¼Œç»™ iris æ•°æ®é›†æ„é€ ä¸€æ£µåˆ†ç±»å†³ç­–æ ‘ã€‚iris è¿™ä¸ªæ•°æ®é›†ï¼Œæˆ‘åœ¨ Python å¯è§†åŒ–ä¸­è®²åˆ°è¿‡ï¼Œå®é™…ä¸Šåœ¨ sklearn ä¸­ä¹Ÿè‡ªå¸¦äº†è¿™ä¸ªæ•°æ®é›†ã€‚åŸºäº iris æ•°æ®é›†ï¼Œæ„é€  CART åˆ†ç±»æ ‘çš„ä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617181920212223# encoding=utf-8from sklearn.model_selection import train_test_splitfrom sklearn.metrics import accuracy_scorefrom sklearn.tree import DecisionTreeClassifierfrom sklearn.datasets import load_iris# å‡†å¤‡æ•°æ®é›†iris=load_iris()# è·å–ç‰¹å¾é›†å’Œåˆ†ç±»æ ‡è¯†features = iris.datalabels = iris.target# éšæœºæŠ½å–33%çš„æ•°æ®ä½œä¸ºæµ‹è¯•é›†ï¼Œå…¶ä½™ä¸ºè®­ç»ƒé›†train_features, test_features, train_labels, test_labels = train_test_split(features, labels, test_size=0.33, random_state=0)# åˆ›å»ºCARTåˆ†ç±»æ ‘clf = DecisionTreeClassifier(criterion='gini')# æ‹Ÿåˆæ„é€ CARTåˆ†ç±»æ ‘clf = clf.fit(train_features, train_labels)# ç”¨CARTåˆ†ç±»æ ‘åšé¢„æµ‹test_predict = clf.predict(test_features)# é¢„æµ‹ç»“æœä¸æµ‹è¯•é›†ç»“æœä½œæ¯”å¯¹score = accuracy_score(test_labels, test_predict)print(\"CARTåˆ†ç±»æ ‘å‡†ç¡®ç‡ %.4lf\" % score)CARTåˆ†ç±»æ ‘å‡†ç¡®ç‡ 0.9600å¦‚æœæˆ‘ä»¬æŠŠå†³ç­–æ ‘ç”»å‡ºæ¥ï¼Œå¯ä»¥å¾—åˆ°ä¸‹é¢çš„å›¾ç¤ºï¼šé¦–å…ˆ train_test_split å¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠæ•°æ®é›†æŠ½å–ä¸€éƒ¨åˆ†ä½œä¸ºæµ‹è¯•é›†ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°è®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚ä½¿ç”¨ clf = DecisionTreeClassifier(criterion=â€˜giniâ€™) åˆå§‹åŒ–ä¸€æ£µ CART åˆ†ç±»æ ‘ã€‚è¿™æ ·ä½ å°±å¯ä»¥å¯¹ CART åˆ†ç±»æ ‘è¿›è¡Œè®­ç»ƒã€‚ä½¿ç”¨ clf.fit(train_features, train_labels) å‡½æ•°ï¼Œå°†è®­ç»ƒé›†çš„ç‰¹å¾å€¼å’Œåˆ†ç±»æ ‡è¯†ä½œä¸ºå‚æ•°è¿›è¡Œæ‹Ÿåˆï¼Œå¾—åˆ° CART åˆ†ç±»æ ‘ã€‚ä½¿ç”¨ clf.predict(test_features) å‡½æ•°è¿›è¡Œé¢„æµ‹ï¼Œä¼ å…¥æµ‹è¯•é›†çš„ç‰¹å¾å€¼ï¼Œå¯ä»¥å¾—åˆ°æµ‹è¯•ç»“æœ test_predictã€‚æœ€åä½¿ç”¨ accuracy_score(test_labels, test_predict) å‡½æ•°ï¼Œä¼ å…¥æµ‹è¯•é›†çš„é¢„æµ‹ç»“æœä¸å®é™…çš„ç»“æœä½œä¸ºå‚æ•°ï¼Œå¾—åˆ°å‡†ç¡®ç‡ scoreã€‚æˆ‘ä»¬èƒ½çœ‹åˆ° sklearn å¸®æˆ‘ä»¬åšäº† CART åˆ†ç±»æ ‘çš„ä½¿ç”¨å°è£…ï¼Œä½¿ç”¨èµ·æ¥è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚CART å›å½’æ ‘çš„å·¥ä½œæµç¨‹CART å›å½’æ ‘åˆ’åˆ†æ•°æ®é›†çš„è¿‡ç¨‹å’Œåˆ†ç±»æ ‘çš„è¿‡ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å›å½’æ ‘å¾—åˆ°çš„é¢„æµ‹ç»“æœæ˜¯è¿ç»­å€¼ï¼Œè€Œä¸”è¯„åˆ¤â€œä¸çº¯åº¦â€çš„æŒ‡æ ‡ä¸åŒã€‚åœ¨ CART åˆ†ç±»æ ‘ä¸­é‡‡ç”¨çš„æ˜¯åŸºå°¼ç³»æ•°ä½œä¸ºæ ‡å‡†ï¼Œé‚£ä¹ˆåœ¨ CART å›å½’æ ‘ä¸­ï¼Œå¦‚ä½•è¯„ä»·â€œä¸çº¯åº¦â€å‘¢ï¼Ÿå®é™…ä¸Šæˆ‘ä»¬è¦æ ¹æ®æ ·æœ¬çš„æ··ä¹±ç¨‹åº¦ï¼Œä¹Ÿå°±æ˜¯æ ·æœ¬çš„ç¦»æ•£ç¨‹åº¦æ¥è¯„ä»·â€œä¸çº¯åº¦â€ã€‚æ ·æœ¬çš„ç¦»æ•£ç¨‹åº¦å…·ä½“çš„è®¡ç®—æ–¹å¼æ˜¯ï¼Œå…ˆè®¡ç®—æ‰€æœ‰æ ·æœ¬çš„å‡å€¼ï¼Œç„¶åè®¡ç®—æ¯ä¸ªæ ·æœ¬å€¼åˆ°å‡å€¼çš„å·®å€¼ã€‚æˆ‘ä»¬å‡è®¾ x ä¸ºæ ·æœ¬çš„ä¸ªä½“ï¼Œå‡å€¼ä¸º uã€‚ä¸ºäº†ç»Ÿè®¡æ ·æœ¬çš„ç¦»æ•£ç¨‹åº¦ï¼Œæˆ‘ä»¬å¯ä»¥å–å·®å€¼çš„ç»å¯¹å€¼ï¼Œæˆ–è€…æ–¹å·®ã€‚å…¶ä¸­å·®å€¼çš„ç»å¯¹å€¼ä¸ºæ ·æœ¬å€¼å‡å»æ ·æœ¬å‡å€¼çš„ç»å¯¹å€¼ï¼šæ–¹å·®ä¸ºæ¯ä¸ªæ ·æœ¬å€¼å‡å»æ ·æœ¬å‡å€¼çš„å¹³æ–¹å’Œé™¤ä»¥æ ·æœ¬ä¸ªæ•°ï¼šæ‰€ä»¥è¿™ä¸¤ç§èŠ‚ç‚¹åˆ’åˆ†çš„æ ‡å‡†ï¼Œåˆ†åˆ«å¯¹åº”ç€ä¸¤ç§ç›®æ ‡å‡½æ•°æœ€ä¼˜åŒ–çš„æ ‡å‡†ï¼Œå³ç”¨æœ€å°ç»å¯¹åå·®ï¼ˆLADï¼‰ï¼Œæˆ–è€…ä½¿ç”¨æœ€å°äºŒä¹˜åå·®ï¼ˆLSDï¼‰ã€‚è¿™ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥è®©æˆ‘ä»¬æ‰¾åˆ°èŠ‚ç‚¹åˆ’åˆ†çš„æ–¹æ³•ï¼Œé€šå¸¸ä½¿ç”¨æœ€å°äºŒä¹˜åå·®çš„æƒ…å†µæ›´å¸¸è§ä¸€äº›ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥çœ‹ä¸‹å¦‚ä½•åˆ›å»ºä¸€æ£µ CART å›å½’æ ‘æ¥åšé¢„æµ‹ã€‚å¦‚ä½•ä½¿ç”¨ CART å›å½’æ ‘åšé¢„æµ‹è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åˆ° sklearn è‡ªå¸¦çš„æ³¢å£«é¡¿æˆ¿ä»·æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†ç»™å‡ºäº†å½±å“æˆ¿ä»·çš„ä¸€äº›æŒ‡æ ‡ï¼Œæ¯”å¦‚çŠ¯ç½ªç‡ï¼Œæˆ¿äº§ç¨ç­‰ï¼Œæœ€åç»™å‡ºäº†æˆ¿ä»·ã€‚æ ¹æ®è¿™äº›æŒ‡æ ‡ï¼Œæˆ‘ä»¬ä½¿ç”¨ CART å›å½’æ ‘å¯¹æ³¢å£«é¡¿æˆ¿ä»·è¿›è¡Œé¢„æµ‹ï¼Œä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718192021222324# encoding=utf-8from sklearn.metrics import mean_squared_errorfrom sklearn.model_selection import train_test_splitfrom sklearn.datasets import load_bostonfrom sklearn.metrics import r2_score,mean_absolute_error,mean_squared_errorfrom sklearn.tree import DecisionTreeRegressor# å‡†å¤‡æ•°æ®é›†boston=load_boston()# æ¢ç´¢æ•°æ®print(boston.feature_names)# è·å–ç‰¹å¾é›†å’Œæˆ¿ä»·features = boston.dataprices = boston.target# éšæœºæŠ½å–33%çš„æ•°æ®ä½œä¸ºæµ‹è¯•é›†ï¼Œå…¶ä½™ä¸ºè®­ç»ƒé›†train_features, test_features, train_price, test_price = train_test_split(features, prices, test_size=0.33)# åˆ›å»ºCARTå›å½’æ ‘dtr=DecisionTreeRegressor()# æ‹Ÿåˆæ„é€ CARTå›å½’æ ‘dtr.fit(train_features, train_price)# é¢„æµ‹æµ‹è¯•é›†ä¸­çš„æˆ¿ä»·predict_price = dtr.predict(test_features)# æµ‹è¯•é›†çš„ç»“æœè¯„ä»·print('å›å½’æ ‘äºŒä¹˜åå·®å‡å€¼:', mean_squared_error(test_price, predict_price))print('å›å½’æ ‘ç»å¯¹å€¼åå·®å‡å€¼:', mean_absolute_error(test_price, predict_price))è¿è¡Œç»“æœï¼ˆæ¯æ¬¡è¿è¡Œç»“æœå¯èƒ½ä¼šæœ‰ä¸åŒï¼‰ï¼š[â€˜CRIMâ€™ â€˜ZNâ€™ â€˜INDUSâ€™ â€˜CHASâ€™ â€˜NOXâ€™ â€˜RMâ€™ â€˜AGEâ€™ â€˜DISâ€™ â€˜RADâ€™ â€˜TAXâ€™ â€˜PTRATIOâ€™ â€˜Bâ€™ â€˜LSTATâ€™]å›å½’æ ‘äºŒä¹˜åå·®å‡å€¼: 23.80784431137724å›å½’æ ‘ç»å¯¹å€¼åå·®å‡å€¼: 3.040119760479042å¦‚æœæŠŠå›å½’æ ‘ç”»å‡ºæ¥ï¼Œå¯ä»¥å¾—åˆ°ä¸‹é¢çš„å›¾ç¤ºï¼ˆæ³¢å£«é¡¿æˆ¿ä»·æ•°æ®é›†çš„æŒ‡æ ‡æœ‰äº›å¤šï¼Œæ‰€ä»¥æ ‘æ¯”è¾ƒå¤§ï¼‰ï¼šæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªä¾‹å­ï¼Œé¦–å…ˆåŠ è½½äº†æ³¢å£«é¡¿æˆ¿ä»·æ•°æ®é›†ï¼Œå¾—åˆ°ç‰¹å¾é›†å’Œæˆ¿ä»·ã€‚ç„¶åé€šè¿‡ train_test_split å¸®åŠ©æˆ‘ä»¬æŠŠæ•°æ®é›†æŠ½å–ä¸€éƒ¨åˆ†ä½œä¸ºæµ‹è¯•é›†ï¼Œå…¶ä½™ä½œä¸ºè®­ç»ƒé›†ã€‚ä½¿ç”¨ dtr=DecisionTreeRegressor() åˆå§‹åŒ–ä¸€æ£µ CART å›å½’æ ‘ã€‚ä½¿ç”¨ dtr.fit(train_features, train_price) å‡½æ•°ï¼Œå°†è®­ç»ƒé›†çš„ç‰¹å¾å€¼å’Œç»“æœä½œä¸ºå‚æ•°è¿›è¡Œæ‹Ÿåˆï¼Œå¾—åˆ° CART å›å½’æ ‘ã€‚ä½¿ç”¨ dtr.predict(test_features) å‡½æ•°è¿›è¡Œé¢„æµ‹ï¼Œä¼ å…¥æµ‹è¯•é›†çš„ç‰¹å¾å€¼ï¼Œå¯ä»¥å¾—åˆ°é¢„æµ‹ç»“æœ predict_priceã€‚æœ€åæˆ‘ä»¬å¯ä»¥æ±‚å¾—è¿™æ£µå›å½’æ ‘çš„äºŒä¹˜åå·®å‡å€¼ï¼Œä»¥åŠç»å¯¹å€¼åå·®å‡å€¼ã€‚æˆ‘ä»¬èƒ½çœ‹åˆ° CART å›å½’æ ‘çš„ä½¿ç”¨å’Œåˆ†ç±»æ ‘ç±»ä¼¼ï¼Œåªæ˜¯æœ€åæ±‚å¾—çš„é¢„æµ‹å€¼æ˜¯ä¸ªè¿ç»­å€¼ã€‚CART å†³ç­–æ ‘çš„å‰ªæCART å†³ç­–æ ‘çš„å‰ªæä¸»è¦é‡‡ç”¨çš„æ˜¯ CCP æ–¹æ³•ï¼Œå®ƒæ˜¯ä¸€ç§åå‰ªæçš„æ–¹æ³•ï¼Œè‹±æ–‡å…¨ç§°å«åš cost-complexity pruneï¼Œä¸­æ–‡å«åšä»£ä»·å¤æ‚åº¦ã€‚è¿™ç§å‰ªææ–¹å¼ç”¨åˆ°ä¸€ä¸ªæŒ‡æ ‡å«åšèŠ‚ç‚¹çš„è¡¨é¢è¯¯å·®ç‡å¢ç›Šå€¼ï¼Œä»¥æ­¤ä½œä¸ºå‰ªæå‰åè¯¯å·®çš„å®šä¹‰ã€‚ç”¨å…¬å¼è¡¨ç¤ºåˆ™æ˜¯ï¼šå…¶ä¸­ Tt ä»£è¡¨ä»¥ t ä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘ï¼ŒC(Tt) è¡¨ç¤ºèŠ‚ç‚¹ t çš„å­æ ‘æ²¡è¢«è£å‰ªæ—¶å­æ ‘ Tt çš„è¯¯å·®ï¼ŒC(t) è¡¨ç¤ºèŠ‚ç‚¹ t çš„å­æ ‘è¢«å‰ªæåèŠ‚ç‚¹ t çš„è¯¯å·®ï¼Œ|Tt|ä»£å­æ ‘ Tt çš„å¶å­æ•°ï¼Œå‰ªæåï¼ŒT çš„å¶å­æ•°å‡å°‘äº†|Tt|-1ã€‚æ‰€ä»¥èŠ‚ç‚¹çš„è¡¨é¢è¯¯å·®ç‡å¢ç›Šå€¼ç­‰äºèŠ‚ç‚¹ t çš„å­æ ‘è¢«å‰ªæåçš„è¯¯å·®å˜åŒ–é™¤ä»¥å‰ªæ‰çš„å¶å­æ•°é‡ã€‚å› ä¸ºæˆ‘ä»¬å¸Œæœ›å‰ªæå‰åè¯¯å·®æœ€å°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¯»æ‰¾çš„å°±æ˜¯æœ€å°Î±å€¼å¯¹åº”çš„èŠ‚ç‚¹ï¼ŒæŠŠå®ƒå‰ªæ‰ã€‚è¿™æ—¶å€™ç”Ÿæˆäº†ç¬¬ä¸€ä¸ªå­æ ‘ã€‚é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ï¼Œç»§ç»­å‰ªæï¼Œç›´åˆ°æœ€ååªå‰©ä¸‹æ ¹èŠ‚ç‚¹ï¼Œå³ä¸ºæœ€åä¸€ä¸ªå­æ ‘ã€‚å¾—åˆ°äº†å‰ªæåçš„å­æ ‘é›†åˆåï¼Œæˆ‘ä»¬éœ€è¦ç”¨éªŒè¯é›†å¯¹æ‰€æœ‰å­æ ‘çš„è¯¯å·®è®¡ç®—ä¸€éã€‚å¯ä»¥é€šè¿‡è®¡ç®—æ¯ä¸ªå­æ ‘çš„åŸºå°¼æŒ‡æ•°æˆ–è€…å¹³æ–¹è¯¯å·®ï¼Œå–è¯¯å·®æœ€å°çš„é‚£ä¸ªæ ‘ï¼Œå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚æ€»ç»“ä»Šå¤©æˆ‘ç»™ä½ è®²äº† CART å†³ç­–æ ‘ï¼Œå®ƒæ˜¯ä¸€æ£µå†³ç­–äºŒå‰æ ‘ï¼Œæ—¢å¯ä»¥åšåˆ†ç±»æ ‘ï¼Œä¹Ÿå¯ä»¥åšå›å½’æ ‘ã€‚ä½ éœ€è¦è®°ä½çš„æ˜¯ï¼Œä½œä¸ºåˆ†ç±»æ ‘ï¼ŒCART é‡‡ç”¨åŸºå°¼ç³»æ•°ä½œä¸ºèŠ‚ç‚¹åˆ’åˆ†çš„ä¾æ®ï¼Œå¾—åˆ°çš„æ˜¯ç¦»æ•£çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯åˆ†ç±»ç»“æœï¼›ä½œä¸ºå›å½’æ ‘ï¼ŒCART å¯ä»¥é‡‡ç”¨æœ€å°ç»å¯¹åå·®ï¼ˆLADï¼‰ï¼Œæˆ–è€…æœ€å°äºŒä¹˜åå·®ï¼ˆLSDï¼‰ä½œä¸ºèŠ‚ç‚¹åˆ’åˆ†çš„ä¾æ®ï¼Œå¾—åˆ°çš„æ˜¯è¿ç»­å€¼ï¼Œå³å›å½’é¢„æµ‹ç»“æœã€‚æœ€åæˆ‘ä»¬æ¥æ•´ç†ä¸‹ä¸‰ç§å†³ç­–æ ‘ä¹‹é—´åœ¨å±æ€§é€‰æ‹©æ ‡å‡†ä¸Šçš„å·®å¼‚ï¼šID3 ç®—æ³•ï¼ŒåŸºäºä¿¡æ¯å¢ç›Šåšåˆ¤æ–­ï¼›C4.5 ç®—æ³•ï¼ŒåŸºäºä¿¡æ¯å¢ç›Šç‡åšåˆ¤æ–­ï¼›CART ç®—æ³•ï¼Œåˆ†ç±»æ ‘æ˜¯åŸºäºåŸºå°¼ç³»æ•°åšåˆ¤æ–­ã€‚å›å½’æ ‘æ˜¯åŸºäºåå·®åšåˆ¤æ–­ã€‚å®é™…ä¸Šè¿™ä¸‰ä¸ªæŒ‡æ ‡ä¹Ÿæ˜¯è®¡ç®—â€œä¸çº¯åº¦â€çš„ä¸‰ç§è®¡ç®—æ–¹å¼ã€‚åœ¨å·¥å…·ä½¿ç”¨ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ sklearn ä¸­çš„ DecisionTreeClassifier åˆ›å»º CART åˆ†ç±»æ ‘ï¼Œé€šè¿‡ DecisionTreeRegressor åˆ›å»º CART å›å½’æ ‘ã€‚ä½ å¯ä»¥ç”¨ä»£ç è‡ªå·±è·‘ä¸€éæˆ‘åœ¨æ–‡ç¨¿ä¸­ä¸¾åˆ°çš„ä¾‹å­ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Decision Tree","slug":"Decision-Tree","permalink":"cpeixin.cn/tags/Decision-Tree/"}]},{"title":"æ•°æ®åˆ†æ-å†³ç­–æ ‘åˆ†ç±»ç®—æ³•-C4.5","slug":"æ•°æ®åˆ†æ-å†³ç­–æ ‘åˆ†ç±»ç®—æ³•-C4.5","date":"2018-07-12T06:12:39.000Z","updated":"2020-05-01T14:19:02.521Z","comments":true,"path":"2018/07/12/æ•°æ®åˆ†æ-å†³ç­–æ ‘åˆ†ç±»ç®—æ³•-C4.5/","link":"","permalink":"cpeixin.cn/2018/07/12/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E5%86%B3%E7%AD%96%E6%A0%91%E5%88%86%E7%B1%BB%E7%AE%97%E6%B3%95-C4.5/","excerpt":"","text":"åœ¨ ID3 ç®—æ³•ä¸Šè¿›è¡Œæ”¹è¿›çš„ C4.5 ç®—æ³•é‚£ä¹ˆ C4.5 éƒ½åœ¨å“ªäº›æ–¹é¢æ”¹è¿›äº† ID3 å‘¢ï¼Ÿé‡‡ç”¨ä¿¡æ¯å¢ç›Šç‡å› ä¸º ID3 åœ¨è®¡ç®—çš„æ—¶å€™ï¼Œå€¾å‘äºé€‰æ‹©å–å€¼å¤šçš„å±æ€§ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼ŒC4.5 é‡‡ç”¨ä¿¡æ¯å¢ç›Šç‡çš„æ–¹å¼æ¥é€‰æ‹©å±æ€§ã€‚ä¿¡æ¯å¢ç›Šç‡ = ä¿¡æ¯å¢ç›Š / å±æ€§ç†µå½“å±æ€§æœ‰å¾ˆå¤šå€¼çš„æ—¶å€™ï¼Œç›¸å½“äºè¢«åˆ’åˆ†æˆäº†è®¸å¤šä»½ï¼Œè™½ç„¶ä¿¡æ¯å¢ç›Šå˜å¤§äº†ï¼Œä½†æ˜¯å¯¹äº C4.5 æ¥è¯´ï¼Œå±æ€§ç†µä¹Ÿä¼šå˜å¤§ï¼Œæ‰€ä»¥æ•´ä½“çš„ä¿¡æ¯å¢ç›Šç‡å¹¶ä¸å¤§ã€‚é‡‡ç”¨æ‚²è§‚å‰ªæID3æ„é€ å†³ç­–æ ‘çš„æ—¶å€™ï¼Œå®¹æ˜“äº§ç”Ÿè¿‡æ‹Ÿåˆçš„æƒ…å†µã€‚åœ¨ C4.5 ä¸­ï¼Œä¼šåœ¨å†³ç­–æ ‘æ„é€ ä¹‹åé‡‡ç”¨æ‚²è§‚å‰ªæï¼ˆPEPï¼‰ï¼Œè¿™æ ·å¯ä»¥æå‡å†³ç­–æ ‘çš„æ³›åŒ–èƒ½åŠ›ã€‚æ‚²è§‚å‰ªææ˜¯åå‰ªææŠ€æœ¯ä¸­çš„ä¸€ç§ï¼Œé€šè¿‡é€’å½’ä¼°ç®—æ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹çš„åˆ†ç±»é”™è¯¯ç‡ï¼Œæ¯”è¾ƒå‰ªæå‰åè¿™ä¸ªèŠ‚ç‚¹çš„åˆ†ç±»é”™è¯¯ç‡æ¥å†³å®šæ˜¯å¦å¯¹å…¶è¿›è¡Œå‰ªæã€‚è¿™ç§å‰ªææ–¹æ³•ä¸å†éœ€è¦ä¸€ä¸ªå•ç‹¬çš„æµ‹è¯•æ•°æ®é›†ã€‚ç¦»æ•£åŒ–å¤„ç†è¿ç»­å±æ€§C4.5å¯ä»¥å¤„ç†è¿ç»­å±æ€§çš„æƒ…å†µï¼Œå¯¹è¿ç»­çš„å±æ€§è¿›è¡Œç¦»æ•£åŒ–çš„å¤„ç†ã€‚æ¯”å¦‚æ‰“ç¯®çƒå­˜åœ¨çš„â€œæ¹¿åº¦â€å±æ€§ï¼Œä¸æŒ‰ç…§â€œé«˜ã€ä¸­â€åˆ’åˆ†ï¼Œè€Œæ˜¯æŒ‰ç…§æ¹¿åº¦å€¼è¿›è¡Œè®¡ç®—ï¼Œé‚£ä¹ˆæ¹¿åº¦å–ä»€ä¹ˆå€¼éƒ½æœ‰å¯èƒ½ã€‚è¯¥æ€ä¹ˆé€‰æ‹©è¿™ä¸ªé˜ˆå€¼å‘¢ï¼ŒC4.5 é€‰æ‹©å…·æœ‰æœ€é«˜ä¿¡æ¯å¢ç›Šçš„åˆ’åˆ†æ‰€å¯¹åº”çš„é˜ˆå€¼ã€‚å¤„ç†ç¼ºå¤±å€¼é’ˆå¯¹æ•°æ®é›†ä¸å®Œæ•´çš„æƒ…å†µï¼ŒC4.5 ä¹Ÿå¯ä»¥è¿›è¡Œå¤„ç†ã€‚å‡å¦‚æˆ‘ä»¬å¾—åˆ°çš„æ˜¯å¦‚ä¸‹çš„æ•°æ®ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªæ•°æ®ä¸­å­˜åœ¨ä¸¤ç‚¹é—®é¢˜ã€‚ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæ•°æ®é›†ä¸­å­˜åœ¨æ•°å€¼ç¼ºå¤±çš„æƒ…å†µï¼Œå¦‚ä½•è¿›è¡Œå±æ€§é€‰æ‹©ï¼Ÿç¬¬äºŒä¸ªé—®é¢˜æ˜¯ï¼Œå‡è®¾å·²ç»åšäº†å±æ€§åˆ’åˆ†ï¼Œä½†æ˜¯æ ·æœ¬åœ¨è¿™ä¸ªå±æ€§ä¸Šæœ‰ç¼ºå¤±å€¼ï¼Œè¯¥å¦‚ä½•å¯¹æ ·æœ¬è¿›è¡Œåˆ’åˆ†ï¼Ÿæˆ‘ä»¬ä¸è€ƒè™‘ç¼ºå¤±çš„æ•°å€¼ï¼Œå¯ä»¥å¾—åˆ°æ¸©åº¦ D={2-,3+,4+,5-,6+,7-}ã€‚æ¸©åº¦ = é«˜ï¼šD1={2-,3+,4+} ï¼›æ¸©åº¦ = ä¸­ï¼šD2={6+,7-}ï¼›æ¸©åº¦ = ä½ï¼šD3={5-} ã€‚è¿™é‡Œ + å·ä»£è¡¨æ‰“ç¯®çƒï¼Œ- å·ä»£è¡¨ä¸æ‰“ç¯®çƒã€‚æ¯”å¦‚ ID=2 æ—¶ï¼Œå†³ç­–æ˜¯ä¸æ‰“ç¯®çƒï¼Œæˆ‘ä»¬å¯ä»¥è®°å½•ä¸º 2-ã€‚é’ˆå¯¹å°†å±æ€§é€‰æ‹©ä¸ºæ¸©åº¦çš„ä¿¡æ¯å¢ç›Šä¸ºï¼šGain(Dâ€², æ¸©åº¦)=Ent(Dâ€²)-0.792=1.0-0.792=0.208å±æ€§ç†µ =1.459, ä¿¡æ¯å¢ç›Šç‡ Gain_ratio(Dâ€², æ¸©åº¦)=0.208/1.459=0.1426ã€‚ä¸‹å›¾æ˜¯è®¡ç®—è¿‡ç¨‹ï¼šDâ€²çš„æ ·æœ¬ä¸ªæ•°ä¸º 6ï¼Œè€Œ D çš„æ ·æœ¬ä¸ªæ•°ä¸º 7ï¼Œæ‰€ä»¥æ‰€å æƒé‡æ¯”ä¾‹ä¸º 6/7ï¼Œæ‰€ä»¥ Gain(Dâ€²ï¼Œæ¸©åº¦) æ‰€å æƒé‡æ¯”ä¾‹ä¸º 6/7ï¼Œæ‰€ä»¥ï¼šGain_ratio(D, æ¸©åº¦)=6/7*0.1426=0.122ã€‚è¿™æ ·å³ä½¿åœ¨æ¸©åº¦å±æ€§çš„æ•°å€¼æœ‰ç¼ºå¤±çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥è®¡ç®—ä¿¡æ¯å¢ç›Šï¼Œå¹¶å¯¹å±æ€§è¿›è¡Œé€‰æ‹©ã€‚Cart ç®—æ³•åœ¨è¿™é‡Œä¸åšä»‹ç»ï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€è®²ç»™ä½ è®²è§£è¿™ä¸ªç®—æ³•ã€‚ç°åœ¨æˆ‘ä»¬æ€»ç»“ä¸‹ ID3 å’Œ C4.5 ç®—æ³•ã€‚é¦–å…ˆ ID3 ç®—æ³•çš„ä¼˜ç‚¹æ˜¯æ–¹æ³•ç®€å•ï¼Œç¼ºç‚¹æ˜¯å¯¹å™ªå£°æ•æ„Ÿã€‚è®­ç»ƒæ•°æ®å¦‚æœæœ‰å°‘é‡é”™è¯¯ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå†³ç­–æ ‘åˆ†ç±»é”™è¯¯ã€‚C4.5 åœ¨ ID3 çš„åŸºç¡€ä¸Šï¼Œç”¨ä¿¡æ¯å¢ç›Šç‡ä»£æ›¿äº†ä¿¡æ¯å¢ç›Šï¼Œè§£å†³äº†å™ªå£°æ•æ„Ÿçš„é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥å¯¹æ„é€ æ ‘è¿›è¡Œå‰ªæã€å¤„ç†è¿ç»­æ•°å€¼ä»¥åŠæ•°å€¼ç¼ºå¤±ç­‰æƒ…å†µï¼Œä½†æ˜¯ç”±äº C4.5 éœ€è¦å¯¹æ•°æ®é›†è¿›è¡Œå¤šæ¬¡æ‰«æï¼Œç®—æ³•æ•ˆç‡ç›¸å¯¹è¾ƒä½ã€‚æ€»ç»“å‰é¢æˆ‘ä»¬è®²äº†ä¸¤ç§å†³ç­–æ ‘åˆ†ç±»ç®—æ³• ID3 å’Œ C4.5ï¼Œäº†è§£äº†å®ƒä»¬çš„æ•°å­¦åŸç†ã€‚ä½ å¯èƒ½ä¼šé—®ï¼Œå…¬å¼è¿™ä¹ˆå¤šï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›æ•°æ®æŒ–æ˜å·¥å…·ä½¿ç”¨å®ƒä»¬ï¼Œæ¯”å¦‚ Python çš„ sklearnï¼Œæˆ–è€…æ˜¯ Wekaï¼ˆä¸€ä¸ªå…è´¹çš„æ•°æ®æŒ–æ˜å·¥ä½œå¹³å°ï¼‰ï¼Œå®ƒä»¬å·²ç»é›†æˆäº†è¿™ä¸¤ç§ç®—æ³•ã€‚åªæ˜¯æˆ‘ä»¬åœ¨äº†è§£äº†è¿™ä¸¤ç§ç®—æ³•ä¹‹åï¼Œæ‰èƒ½æ›´åŠ æ¸…æ¥šè¿™ä¸¤ç§ç®—æ³•çš„ä¼˜ç¼ºç‚¹ã€‚æˆ‘ä»¬æ€»ç»“ä¸‹ï¼Œè¿™æ¬¡éƒ½è®²åˆ°äº†å“ªäº›çŸ¥è¯†ç‚¹å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬é‡‡ç”¨å†³ç­–æ ‘åˆ†ç±»ï¼Œéœ€è¦äº†è§£å®ƒçš„åŸç†ï¼ŒåŒ…æ‹¬å®ƒçš„æ„é€ åŸç†ã€å‰ªæåŸç†ã€‚å¦å¤–åœ¨ä¿¡æ¯åº¦é‡ä¸Šï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¿¡æ¯åº¦é‡ä¸­çš„çº¯åº¦å’Œä¿¡æ¯ç†µçš„æ¦‚å¿µã€‚åœ¨å†³ç­–æ ‘çš„æ„é€ ä¸­ï¼Œä¸€ä¸ªå†³ç­–æ ‘åŒ…æ‹¬æ ¹èŠ‚ç‚¹ã€å­èŠ‚ç‚¹ã€å¶å­èŠ‚ç‚¹ã€‚åœ¨å±æ€§é€‰æ‹©çš„æ ‡å‡†ä¸Šï¼Œåº¦é‡æ–¹æ³•åŒ…æ‹¬äº†ä¿¡æ¯å¢ç›Šå’Œä¿¡æ¯å¢ç›Šç‡ã€‚åœ¨ç®—æ³•ä¸Šï¼Œæˆ‘è®²è§£äº†ä¸¤ç§ç®—æ³•ï¼šID3 å’Œ C4.5ï¼Œå…¶ä¸­ ID3 æ˜¯åŸºç¡€çš„å†³ç­–æ ‘ç®—æ³•ï¼ŒC4.5 åœ¨å®ƒçš„åŸºç¡€ä¸Šè¿›è¡Œäº†æ”¹è¿›ï¼Œä¹Ÿæ˜¯ç›®å‰å†³ç­–æ ‘ä¸­åº”ç”¨å¹¿æ³›çš„ç®—æ³•ã€‚ç„¶ååœ¨äº†è§£è¿™äº›æ¦‚å¿µå’ŒåŸç†åï¼Œå¼ºçƒˆæ¨èä½ ä½¿ç”¨å·¥å…·ï¼Œå…·ä½“å·¥å…·çš„ä½¿ç”¨æˆ‘ä¼šåœ¨åé¢è¿›è¡Œä»‹ç»ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Decision Tree","slug":"Decision-Tree","permalink":"cpeixin.cn/tags/Decision-Tree/"}]},{"title":"æ•°æ®åˆ†æ-å†³ç­–æ ‘åˆ†ç±»ç®—æ³•-ID3","slug":"æ•°æ®åˆ†æ-å†³ç­–æ ‘åˆ†ç±»ç®—æ³•-ID3","date":"2018-07-11T11:12:49.000Z","updated":"2020-05-01T14:18:48.874Z","comments":true,"path":"2018/07/11/æ•°æ®åˆ†æ-å†³ç­–æ ‘åˆ†ç±»ç®—æ³•-ID3/","link":"","permalink":"cpeixin.cn/2018/07/11/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E5%86%B3%E7%AD%96%E6%A0%91%E5%88%86%E7%B1%BB%E7%AE%97%E6%B3%95-ID3/","excerpt":"","text":"åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°å„ç§é€‰æ‹©ï¼Œä¸è®ºæ˜¯é€‰æ‹©ç”·å¥³æœ‹å‹ï¼Œè¿˜æ˜¯æŒ‘é€‰æ°´æœï¼Œéƒ½æ˜¯åŸºäºä»¥å¾€çš„ç»éªŒæ¥åšåˆ¤æ–­ã€‚å¦‚æœæŠŠåˆ¤æ–­èƒŒåçš„é€»è¾‘æ•´ç†æˆä¸€ä¸ªç»“æ„å›¾ï¼Œä½ ä¼šå‘ç°å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ ‘çŠ¶å›¾ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦è®²çš„å†³ç­–æ ‘å†³ç­–æ ‘çš„å·¥ä½œåŸç†å†³ç­–æ ‘åŸºæœ¬ä¸Šå°±æ˜¯æŠŠæˆ‘ä»¬ä»¥å‰çš„ç»éªŒæ€»ç»“å‡ºæ¥ã€‚æˆ‘ç»™ä½ å‡†å¤‡äº†ä¸€ä¸ªæ‰“ç¯®çƒçš„è®­ç»ƒé›†ã€‚å¦‚æœæˆ‘ä»¬è¦å‡ºé—¨æ‰“ç¯®çƒï¼Œä¸€èˆ¬ä¼šæ ¹æ®â€œå¤©æ°”â€ã€â€œæ¸©åº¦â€ã€â€œæ¹¿åº¦â€ã€â€œåˆ®é£â€è¿™å‡ ä¸ªæ¡ä»¶æ¥åˆ¤æ–­ï¼Œæœ€åå¾—åˆ°ç»“æœï¼šå»æ‰“ç¯®çƒï¼Ÿè¿˜æ˜¯ä¸å»ï¼Ÿä¸Šé¢è¿™ä¸ªå›¾å°±æ˜¯ä¸€æ£µå…¸å‹çš„å†³ç­–æ ‘ã€‚æˆ‘ä»¬åœ¨åšå†³ç­–æ ‘çš„æ—¶å€™ï¼Œä¼šç»å†ä¸¤ä¸ªé˜¶æ®µï¼šæ„é€ å’Œå‰ªæã€‚æ„é€ ä»€ä¹ˆæ˜¯æ„é€ å‘¢ï¼Ÿæ„é€ å°±æ˜¯ç”Ÿæˆä¸€æ£µå®Œæ•´çš„å†³ç­–æ ‘ã€‚ç®€å•æ¥è¯´ï¼Œæ„é€ çš„è¿‡ç¨‹å°±æ˜¯é€‰æ‹©ä»€ä¹ˆå±æ€§ä½œä¸ºèŠ‚ç‚¹çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆåœ¨æ„é€ è¿‡ç¨‹ä¸­ï¼Œä¼šå­˜åœ¨ä¸‰ç§èŠ‚ç‚¹ï¼šæ ¹èŠ‚ç‚¹ï¼šå°±æ˜¯æ ‘çš„æœ€é¡¶ç«¯ï¼Œæœ€å¼€å§‹çš„é‚£ä¸ªèŠ‚ç‚¹ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œâ€œå¤©æ°”â€å°±æ˜¯ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼›å†…éƒ¨èŠ‚ç‚¹ï¼šå°±æ˜¯æ ‘ä¸­é—´çš„é‚£äº›èŠ‚ç‚¹ï¼Œæ¯”å¦‚è¯´â€œæ¸©åº¦â€ã€â€œæ¹¿åº¦â€ã€â€œåˆ®é£â€ï¼›å¶èŠ‚ç‚¹ï¼šå°±æ˜¯æ ‘æœ€åº•éƒ¨çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯å†³ç­–ç»“æœã€‚èŠ‚ç‚¹ä¹‹é—´å­˜åœ¨çˆ¶å­å…³ç³»ã€‚æ¯”å¦‚æ ¹èŠ‚ç‚¹ä¼šæœ‰å­èŠ‚ç‚¹ï¼Œå­èŠ‚ç‚¹ä¼šæœ‰å­å­èŠ‚ç‚¹ï¼Œä½†æ˜¯åˆ°äº†å¶èŠ‚ç‚¹å°±åœæ­¢äº†ï¼Œå¶èŠ‚ç‚¹ä¸å­˜åœ¨å­èŠ‚ç‚¹ã€‚é‚£ä¹ˆåœ¨æ„é€ è¿‡ç¨‹ä¸­ï¼Œä½ è¦è§£å†³ä¸‰ä¸ªé‡è¦çš„é—®é¢˜ï¼šé€‰æ‹©å“ªä¸ªå±æ€§ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼›é€‰æ‹©å“ªäº›å±æ€§ä½œä¸ºå­èŠ‚ç‚¹ï¼›ä»€ä¹ˆæ—¶å€™åœæ­¢å¹¶å¾—åˆ°ç›®æ ‡çŠ¶æ€ï¼Œå³å¶èŠ‚ç‚¹ã€‚å‰ªæå†³ç­–æ ‘æ„é€ å‡ºæ¥ä¹‹åæ˜¯ä¸æ˜¯å°±ä¸‡äº‹å¤§å‰äº†å‘¢ï¼Ÿä¹Ÿä¸å°½ç„¶ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦å¯¹å†³ç­–æ ‘è¿›è¡Œå‰ªæã€‚å‰ªæå°±æ˜¯ç»™å†³ç­–æ ‘ç˜¦èº«ï¼Œè¿™ä¸€æ­¥æƒ³å®ç°çš„ç›®æ ‡å°±æ˜¯ï¼Œä¸éœ€è¦å¤ªå¤šçš„åˆ¤æ–­ï¼ŒåŒæ ·å¯ä»¥å¾—åˆ°ä¸é”™çš„ç»“æœã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆåšï¼Œæ˜¯ä¸ºäº†é˜²æ­¢â€œè¿‡æ‹Ÿåˆâ€ï¼ˆOverfittingï¼‰ç°è±¡çš„å‘ç”Ÿã€‚â€œè¿‡æ‹Ÿåˆâ€è¿™ä¸ªæ¦‚å¿µä½ ä¸€å®šè¦ç†è§£ï¼Œå®ƒæŒ‡çš„å°±æ˜¯æ¨¡å‹çš„è®­ç»ƒç»“æœâ€œå¤ªå¥½äº†â€ï¼Œä»¥è‡³äºåœ¨å®é™…åº”ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå­˜åœ¨â€œæ­»æ¿â€çš„æƒ…å†µï¼Œå¯¼è‡´åˆ†ç±»é”™è¯¯ã€‚æ¬ æ‹Ÿåˆï¼Œå’Œè¿‡æ‹Ÿåˆå°±å¥½æ¯”æ˜¯ä¸‹é¢è¿™å¼ å›¾ä¸­çš„ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªæƒ…å†µä¸€æ ·ï¼Œè®­ç»ƒçš„ç»“æœâ€œå¤ªå¥½â€œï¼Œåè€Œåœ¨å®é™…åº”ç”¨è¿‡ç¨‹ä¸­ä¼šå¯¼è‡´åˆ†ç±»é”™è¯¯ã€‚é€ æˆè¿‡æ‹Ÿåˆçš„åŸå› ä¹‹ä¸€å°±æ˜¯å› ä¸ºè®­ç»ƒé›†ä¸­æ ·æœ¬é‡è¾ƒå°ã€‚å¦‚æœå†³ç­–æ ‘é€‰æ‹©çš„å±æ€§è¿‡å¤šï¼Œæ„é€ å‡ºæ¥çš„å†³ç­–æ ‘ä¸€å®šèƒ½å¤Ÿâ€œå®Œç¾â€åœ°æŠŠè®­ç»ƒé›†ä¸­çš„æ ·æœ¬åˆ†ç±»ï¼Œä½†æ˜¯è¿™æ ·å°±ä¼šæŠŠè®­ç»ƒé›†ä¸­ä¸€äº›æ•°æ®çš„ç‰¹ç‚¹å½“æˆæ‰€æœ‰æ•°æ®çš„ç‰¹ç‚¹ï¼Œä½†è¿™ä¸ªç‰¹ç‚¹ä¸ä¸€å®šæ˜¯å…¨éƒ¨æ•°æ®çš„ç‰¹ç‚¹ï¼Œè¿™å°±ä½¿å¾—è¿™ä¸ªå†³ç­–æ ‘åœ¨çœŸå®çš„æ•°æ®åˆ†ç±»ä¸­å‡ºç°é”™è¯¯ï¼Œä¹Ÿå°±æ˜¯æ¨¡å‹çš„â€œæ³›åŒ–èƒ½åŠ›â€å·®ã€‚fitting:æ‹Ÿåˆï¼Œå°±æ˜¯è¯´è¿™ä¸ªæ›²çº¿èƒ½ä¸èƒ½å¾ˆå¥½çš„æè¿°è¿™ä¸ªæ ·æœ¬ï¼Œæœ‰æ¯”è¾ƒå¥½çš„æ³›åŒ–èƒ½åŠ›è¿‡æ‹Ÿåˆï¼ˆOverFititingï¼‰ï¼šå¤ªè¿‡è´´è¿‘äºè®­ç»ƒæ•°æ®çš„ç‰¹å¾äº†ï¼Œåœ¨è®­ç»ƒé›†ä¸Šè¡¨ç°éå¸¸ä¼˜ç§€ï¼Œè¿‘ä¹å®Œç¾çš„é¢„æµ‹/åŒºåˆ†äº†æ‰€æœ‰çš„æ•°æ®ï¼Œä½†æ˜¯åœ¨æ–°çš„æµ‹è¯•é›†ä¸Šå´è¡¨ç°å¹³å¹³ã€‚æ¬ æ‹Ÿåˆ(UnderFitting)ï¼šæ ·æœ¬ä¸å¤Ÿæˆ–è€…ç®—æ³•ä¸ç²¾ç¡®ï¼Œæµ‹è¯•æ ·æœ¬ç‰¹æ€§æ²¡æœ‰å­¦åˆ°ï¼Œä¸å…·æ³›åŒ–æ€§ï¼Œæ‹¿åˆ°æ–°æ ·æœ¬åæ²¡æœ‰åŠæ³•å»å‡†ç¡®çš„åˆ¤æ–­æ³›åŒ–èƒ½åŠ›æŒ‡çš„åˆ†ç±»å™¨æ˜¯é€šè¿‡è®­ç»ƒé›†æŠ½è±¡å‡ºæ¥çš„åˆ†ç±»èƒ½åŠ›ï¼Œä½ ä¹Ÿå¯ä»¥ç†è§£æ˜¯ä¸¾ä¸€åä¸‰çš„èƒ½åŠ›ã€‚å¦‚æœæˆ‘ä»¬å¤ªä¾èµ–äºè®­ç»ƒé›†çš„æ•°æ®ï¼Œé‚£ä¹ˆå¾—åˆ°çš„å†³ç­–æ ‘å®¹é”™ç‡å°±ä¼šæ¯”è¾ƒä½ï¼Œæ³›åŒ–èƒ½åŠ›å·®ã€‚å› ä¸ºè®­ç»ƒé›†åªæ˜¯å…¨éƒ¨æ•°æ®çš„æŠ½æ ·ï¼Œå¹¶ä¸èƒ½ä½“ç°å…¨éƒ¨æ•°æ®çš„ç‰¹ç‚¹ã€‚æ—¢ç„¶è¦å¯¹å†³ç­–æ ‘è¿›è¡Œå‰ªæï¼Œå…·ä½“æœ‰å“ªäº›æ–¹æ³•å‘¢ï¼Ÿä¸€èˆ¬æ¥è¯´ï¼Œå‰ªæå¯ä»¥åˆ†ä¸ºâ€œé¢„å‰ªæâ€ï¼ˆPre-Pruningï¼‰å’Œâ€œåå‰ªæâ€ï¼ˆPost-Pruningï¼‰**ã€‚é¢„å‰ªææ˜¯åœ¨å†³ç­–æ ‘æ„é€ æ—¶å°±è¿›è¡Œå‰ªæã€‚æ–¹æ³•æ˜¯åœ¨æ„é€ çš„è¿‡ç¨‹ä¸­å¯¹èŠ‚ç‚¹è¿›è¡Œè¯„ä¼°ï¼Œå¦‚æœå¯¹æŸä¸ªèŠ‚ç‚¹è¿›è¡Œåˆ’åˆ†ï¼Œåœ¨éªŒè¯é›†ä¸­ä¸èƒ½å¸¦æ¥å‡†ç¡®æ€§çš„æå‡ï¼Œé‚£ä¹ˆå¯¹è¿™ä¸ªèŠ‚ç‚¹è¿›è¡Œåˆ’åˆ†å°±æ²¡æœ‰æ„ä¹‰ï¼Œè¿™æ—¶å°±ä¼šæŠŠå½“å‰èŠ‚ç‚¹ä½œä¸ºå¶èŠ‚ç‚¹ï¼Œä¸å¯¹å…¶è¿›è¡Œåˆ’åˆ†ã€‚åå‰ªæå°±æ˜¯åœ¨ç”Ÿæˆå†³ç­–æ ‘ä¹‹åå†è¿›è¡Œå‰ªæï¼Œé€šå¸¸ä¼šä»å†³ç­–æ ‘çš„å¶èŠ‚ç‚¹å¼€å§‹ï¼Œé€å±‚å‘ä¸Šå¯¹æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œè¯„ä¼°ã€‚å¦‚æœå‰ªæ‰è¿™ä¸ªèŠ‚ç‚¹å­æ ‘ï¼Œä¸ä¿ç•™è¯¥èŠ‚ç‚¹å­æ ‘åœ¨åˆ†ç±»å‡†ç¡®æ€§ä¸Šå·®åˆ«ä¸å¤§ï¼Œæˆ–è€…å‰ªæ‰è¯¥èŠ‚ç‚¹å­æ ‘ï¼Œèƒ½åœ¨éªŒè¯é›†ä¸­å¸¦æ¥å‡†ç¡®æ€§çš„æå‡ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠè¯¥èŠ‚ç‚¹å­æ ‘è¿›è¡Œå‰ªæã€‚æ–¹æ³•æ˜¯ï¼šç”¨è¿™ä¸ªèŠ‚ç‚¹å­æ ‘çš„å¶å­èŠ‚ç‚¹æ¥æ›¿ä»£è¯¥èŠ‚ç‚¹ï¼Œç±»æ ‡è®°ä¸ºè¿™ä¸ªèŠ‚ç‚¹å­æ ‘ä¸­æœ€é¢‘ç¹çš„é‚£ä¸ªç±»ã€‚å¦‚ä½•åˆ¤æ–­è¦ä¸è¦å»æ‰“ç¯®çƒï¼Ÿæˆ‘ç»™ä½ å‡†å¤‡äº†æ‰“ç¯®çƒçš„æ•°æ®é›†ï¼Œè®­ç»ƒæ•°æ®å¦‚ä¸‹ï¼šæˆ‘ä»¬è¯¥å¦‚ä½•æ„é€ ä¸€ä¸ªåˆ¤æ–­æ˜¯å¦å»æ‰“ç¯®çƒçš„å†³ç­–æ ‘å‘¢ï¼Ÿå†å›é¡¾ä¸€ä¸‹å†³ç­–æ ‘çš„æ„é€ åŸç†ï¼Œåœ¨å†³ç­–è¿‡ç¨‹ä¸­æœ‰ä¸‰ä¸ªé‡è¦çš„é—®é¢˜ï¼šå°†å“ªä¸ªå±æ€§ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼Ÿé€‰æ‹©å“ªäº›å±æ€§ä½œä¸ºåç»§èŠ‚ç‚¹ï¼Ÿä»€ä¹ˆæ—¶å€™åœæ­¢å¹¶å¾—åˆ°ç›®æ ‡å€¼ï¼Ÿæ˜¾ç„¶å°†å“ªä¸ªå±æ€§ï¼ˆå¤©æ°”ã€æ¸©åº¦ã€æ¹¿åº¦ã€åˆ®é£ï¼‰ä½œä¸ºæ ¹èŠ‚ç‚¹æ˜¯ä¸ªå…³é”®é—®é¢˜ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å…ˆä»‹ç»ä¸¤ä¸ªæŒ‡æ ‡ï¼šçº¯åº¦å’Œä¿¡æ¯ç†µã€‚å…ˆæ¥è¯´ä¸€ä¸‹çº¯åº¦ã€‚ä½ å¯ä»¥æŠŠå†³ç­–æ ‘çš„æ„é€ è¿‡ç¨‹ç†è§£æˆä¸ºå¯»æ‰¾çº¯å‡€åˆ’åˆ†çš„è¿‡ç¨‹ã€‚æ•°å­¦ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç”¨çº¯åº¦æ¥è¡¨ç¤ºï¼Œçº¯åº¦æ¢ä¸€ç§æ–¹å¼æ¥è§£é‡Šå°±æ˜¯è®©ç›®æ ‡å˜é‡çš„åˆ†æ­§æœ€å°ã€‚æˆ‘åœ¨è¿™é‡Œä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ 3 ä¸ªé›†åˆï¼šé›†åˆ 1ï¼š6 æ¬¡éƒ½å»æ‰“ç¯®çƒï¼›é›†åˆ 2ï¼š4 æ¬¡å»æ‰“ç¯®çƒï¼Œ2 æ¬¡ä¸å»æ‰“ç¯®çƒï¼›é›†åˆ 3ï¼š3 æ¬¡å»æ‰“ç¯®çƒï¼Œ3 æ¬¡ä¸å»æ‰“ç¯®çƒã€‚æŒ‰ç…§çº¯åº¦æŒ‡æ ‡æ¥è¯´ï¼Œé›†åˆ 1&gt; é›†åˆ 2&gt; é›†åˆ 3ã€‚å› ä¸ºé›†åˆ 1 çš„åˆ†æ­§æœ€å°ï¼Œé›†åˆ 3 çš„åˆ†æ­§æœ€å¤§ã€‚ç„¶åæˆ‘ä»¬å†æ¥ä»‹ç»ä¿¡æ¯ç†µï¼ˆentropyï¼‰çš„æ¦‚å¿µï¼Œå®ƒè¡¨ç¤ºäº†ä¿¡æ¯çš„ä¸ç¡®å®šåº¦**åœ¨ä¿¡æ¯è®ºä¸­ï¼Œéšæœºç¦»æ•£äº‹ä»¶å‡ºç°çš„æ¦‚ç‡å­˜åœ¨ç€ä¸ç¡®å®šæ€§ã€‚ä¸ºäº†è¡¡é‡è¿™ç§ä¿¡æ¯çš„ä¸ç¡®å®šæ€§ï¼Œä¿¡æ¯å­¦ä¹‹çˆ¶é¦™å†œå¼•å…¥äº†ä¿¡æ¯ç†µçš„æ¦‚å¿µï¼Œå¹¶ç»™å‡ºäº†è®¡ç®—ä¿¡æ¯ç†µçš„æ•°å­¦å…¬å¼ï¼šå¤§å†™Î£ç”¨äºæ•°å­¦ä¸Šçš„æ€»å’Œç¬¦å·ï¼Œæ¯”å¦‚ï¼šâˆ‘Piï¼Œå…¶ä¸­i=1,2,â€¦,Tï¼Œå³ä¸ºæ±‚P1 + P2 + â€¦ + PTçš„å’Œã€‚å°å†™Ïƒç”¨äºç»Ÿè®¡å­¦ä¸Šçš„æ ‡å‡†å·®ã€‚è¿™ç§å†™æ³•è¡¨ç¤ºçš„å°±æ˜¯âˆ‘j=1+2+3+â€¦+nã€‚ä¸‹å›¾ï¼šå…¶ä¸­iè¡¨ç¤ºä¸‹ç•Œï¼Œnè¡¨ç¤ºä¸Šç•Œï¼Œ kä»iå¼€å§‹å–æ•°ï¼Œä¸€ç›´å–åˆ°n,å…¨éƒ¨åŠ èµ·æ¥ã€‚p(i|t) ä»£è¡¨äº†èŠ‚ç‚¹ t ä¸ºåˆ†ç±» i çš„æ¦‚ç‡ï¼Œå…¶ä¸­ log2 ä¸ºå–ä»¥ 2 ä¸ºåº•çš„å¯¹æ•°ã€‚è¿™é‡Œæˆ‘ä»¬ä¸æ˜¯æ¥ä»‹ç»å…¬å¼çš„ï¼Œè€Œæ˜¯è¯´å­˜åœ¨ä¸€ç§åº¦é‡ï¼Œå®ƒèƒ½å¸®æˆ‘ä»¬åæ˜ å‡ºæ¥è¿™ä¸ªä¿¡æ¯çš„ä¸ç¡®å®šåº¦ã€‚å½“ä¸ç¡®å®šæ€§è¶Šå¤§æ—¶ï¼Œå®ƒæ‰€åŒ…å«çš„ä¿¡æ¯é‡ä¹Ÿå°±è¶Šå¤§ï¼Œä¿¡æ¯ç†µä¹Ÿå°±è¶Šé«˜ã€‚æˆ‘ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡è®¾æœ‰ 2 ä¸ªé›†åˆé›†åˆ 1ï¼š5 æ¬¡å»æ‰“ç¯®çƒï¼Œ1 æ¬¡ä¸å»æ‰“ç¯®çƒï¼›é›†åˆ 2ï¼š3 æ¬¡å»æ‰“ç¯®çƒï¼Œ3 æ¬¡ä¸å»æ‰“ç¯®çƒã€‚åœ¨é›†åˆ 1 ä¸­ï¼Œæœ‰ 6 æ¬¡å†³ç­–ï¼Œå…¶ä¸­æ‰“ç¯®çƒæ˜¯ 5 æ¬¡ï¼Œä¸æ‰“ç¯®çƒæ˜¯ 1 æ¬¡ã€‚é‚£ä¹ˆå‡è®¾ï¼šç±»åˆ« 1 ä¸ºâ€œæ‰“ç¯®çƒâ€ï¼Œå³æ¬¡æ•°ä¸º 5ï¼›ç±»åˆ« 2 ä¸ºâ€œä¸æ‰“ç¯®çƒâ€ï¼Œå³æ¬¡æ•°ä¸º 1ã€‚é‚£ä¹ˆèŠ‚ç‚¹åˆ’åˆ†ä¸ºç±»åˆ« 1 çš„æ¦‚ç‡æ˜¯ 5/6ï¼Œä¸ºç±»åˆ« 2 çš„æ¦‚ç‡æ˜¯ 1/6ï¼Œå¸¦å…¥ä¸Šè¿°ä¿¡æ¯ç†µå…¬å¼å¯ä»¥è®¡ç®—å¾—å‡ºï¼šåŒæ ·ï¼Œé›†åˆ 2 ä¸­ï¼Œä¹Ÿæ˜¯ä¸€å…± 6 æ¬¡å†³ç­–ï¼Œå…¶ä¸­ç±»åˆ« 1 ä¸­â€œæ‰“ç¯®çƒâ€çš„æ¬¡æ•°æ˜¯ 3ï¼Œç±»åˆ« 2â€œä¸æ‰“ç¯®çƒâ€çš„æ¬¡æ•°ä¹Ÿæ˜¯ 3ï¼Œé‚£ä¹ˆä¿¡æ¯ç†µä¸ºå¤šå°‘å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è®¡ç®—å¾—å‡ºï¼šä»ä¸Šé¢çš„è®¡ç®—ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œä¿¡æ¯ç†µè¶Šå¤§ï¼Œçº¯åº¦è¶Šä½ã€‚å½“é›†åˆä¸­çš„æ‰€æœ‰æ ·æœ¬å‡åŒ€æ··åˆæ—¶ï¼Œä¿¡æ¯ç†µæœ€å¤§ï¼Œçº¯åº¦æœ€ä½ã€‚æˆ‘ä»¬åœ¨æ„é€ å†³ç­–æ ‘çš„æ—¶å€™ï¼Œä¼šåŸºäºçº¯åº¦æ¥æ„å»ºã€‚è€Œç»å…¸çš„ â€œä¸çº¯åº¦â€çš„æŒ‡æ ‡æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯ä¿¡æ¯å¢ç›Šï¼ˆID3 ç®—æ³•ï¼‰ã€ä¿¡æ¯å¢ç›Šç‡ï¼ˆC4.5 ç®—æ³•ï¼‰ä»¥åŠåŸºå°¼æŒ‡æ•°ï¼ˆCart ç®—æ³•ï¼‰ã€‚ID3ç®—æ³•æˆ‘ä»¬å…ˆçœ‹ä¸‹ ID3 ç®—æ³•ã€‚ID3 ç®—æ³•è®¡ç®—çš„æ˜¯ä¿¡æ¯å¢ç›Šï¼Œä¿¡æ¯å¢ç›ŠæŒ‡çš„å°±æ˜¯åˆ’åˆ†å¯ä»¥å¸¦æ¥çº¯åº¦çš„æé«˜ï¼Œä¿¡æ¯ç†µçš„ä¸‹é™ã€‚å®ƒçš„è®¡ç®—å…¬å¼ï¼Œæ˜¯çˆ¶äº²èŠ‚ç‚¹çš„ä¿¡æ¯ç†µå‡å»æ‰€æœ‰å­èŠ‚ç‚¹çš„ä¿¡æ¯ç†µã€‚åœ¨è®¡ç®—çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šè®¡ç®—æ¯ä¸ªå­èŠ‚ç‚¹çš„å½’ä¸€åŒ–ä¿¡æ¯ç†µï¼Œå³æŒ‰ç…§æ¯ä¸ªå­èŠ‚ç‚¹åœ¨çˆ¶èŠ‚ç‚¹ä¸­å‡ºç°çš„æ¦‚ç‡ï¼Œæ¥è®¡ç®—è¿™äº›å­èŠ‚ç‚¹çš„ä¿¡æ¯ç†µã€‚æ‰€ä»¥ä¿¡æ¯å¢ç›Šçš„å…¬å¼å¯ä»¥è¡¨ç¤ºä¸ºï¼šå…¬å¼ä¸­ D æ˜¯çˆ¶äº²èŠ‚ç‚¹ï¼ŒDi æ˜¯å­èŠ‚ç‚¹ï¼ŒGain(D,a) ä¸­çš„ a ä½œä¸º D èŠ‚ç‚¹çš„å±æ€§é€‰æ‹©ã€‚å…¬å¼ä¸­ D æ˜¯çˆ¶äº²èŠ‚ç‚¹ï¼ŒDi æ˜¯å­èŠ‚ç‚¹ï¼ŒGain(D,a) ä¸­çš„ a ä½œä¸º D èŠ‚ç‚¹çš„å±æ€§é€‰æ‹©ã€‚å‡è®¾å¤©æ°” = æ™´çš„æ—¶å€™ï¼Œä¼šæœ‰ 5 æ¬¡å»æ‰“ç¯®çƒï¼Œ5 æ¬¡ä¸æ‰“ç¯®çƒã€‚å…¶ä¸­ D1 åˆ®é£ = æ˜¯ï¼Œæœ‰ 2 æ¬¡æ‰“ç¯®çƒï¼Œ1 æ¬¡ä¸æ‰“ç¯®çƒã€‚D2 åˆ®é£ = å¦ï¼Œæœ‰ 3 æ¬¡æ‰“ç¯®çƒï¼Œ4 æ¬¡ä¸æ‰“ç¯®çƒã€‚é‚£ä¹ˆ a ä»£è¡¨èŠ‚ç‚¹çš„å±æ€§ï¼Œå³å¤©æ°” = æ™´ã€‚ä½ å¯ä»¥åœ¨ä¸‹é¢çš„å›¾ä¾‹ä¸­ç›´è§‚åœ°äº†è§£è¿™å‡ ä¸ªæ¦‚å¿µã€‚æ¯”å¦‚é’ˆå¯¹å›¾ä¸Šè¿™ä¸ªä¾‹å­ï¼ŒD ä½œä¸ºèŠ‚ç‚¹çš„ä¿¡æ¯å¢ç›Šä¸ºï¼šä¹Ÿå°±æ˜¯ D èŠ‚ç‚¹çš„ä¿¡æ¯ç†µ -2 ä¸ªå­èŠ‚ç‚¹çš„å½’ä¸€åŒ–ä¿¡æ¯ç†µã€‚2 ä¸ªå­èŠ‚ç‚¹å½’ä¸€åŒ–ä¿¡æ¯ç†µ =3/10 çš„ D1 ä¿¡æ¯ç†µ +7/10 çš„ D2 ä¿¡æ¯ç†µã€‚æˆ‘ä»¬åŸºäº ID3 çš„ç®—æ³•è§„åˆ™ï¼Œå®Œæ•´åœ°è®¡ç®—ä¸‹æˆ‘ä»¬çš„è®­ç»ƒé›†ï¼Œè®­ç»ƒé›†ä¸­ä¸€å…±æœ‰ 7 æ¡æ•°æ®ï¼Œ3 ä¸ªæ‰“ç¯®çƒï¼Œ4 ä¸ªä¸æ‰“ç¯®çƒï¼Œæ‰€ä»¥æ ¹èŠ‚ç‚¹çš„ä¿¡æ¯ç†µæ˜¯ï¼šå¦‚æœä½ å°†å¤©æ°”ä½œä¸ºå±æ€§çš„åˆ’åˆ†ï¼Œä¼šæœ‰ä¸‰ä¸ªå¶å­èŠ‚ç‚¹ D1ã€D2 å’Œ D3ï¼Œåˆ†åˆ«å¯¹åº”çš„æ˜¯æ™´å¤©ã€é˜´å¤©å’Œå°é›¨ã€‚æˆ‘ä»¬ç”¨ + ä»£è¡¨å»æ‰“ç¯®çƒï¼Œ- ä»£è¡¨ä¸å»æ‰“ç¯®çƒã€‚é‚£ä¹ˆç¬¬ä¸€æ¡è®°å½•ï¼Œæ™´å¤©ä¸å»æ‰“ç¯®çƒï¼Œå¯ä»¥è®°ä¸º 1-ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼æ¥è®°å½• D1ï¼ŒD2ï¼ŒD3ï¼šD1(å¤©æ°” = æ™´å¤©)={1-,2-,6+}D2(å¤©æ°” = é˜´å¤©)={3+,7-}D3(å¤©æ°” = å°é›¨)={4+,5-}æˆ‘ä»¬å…ˆåˆ†åˆ«è®¡ç®—ä¸‰ä¸ªå¶å­èŠ‚ç‚¹çš„ä¿¡æ¯ç†µï¼šå› ä¸º D1 æœ‰ 3 ä¸ªè®°å½•ï¼ŒD2 æœ‰ 2 ä¸ªè®°å½•ï¼ŒD3 æœ‰ 2 ä¸ªè®°å½•ï¼Œæ‰€ä»¥ D ä¸­çš„è®°å½•ä¸€å…±æ˜¯ 3+2+2=7ï¼Œå³æ€»æ•°ä¸º 7ã€‚æ‰€ä»¥ D1 åœ¨ Dï¼ˆçˆ¶èŠ‚ç‚¹ï¼‰ä¸­çš„æ¦‚ç‡æ˜¯ 3/7ï¼ŒD2 åœ¨çˆ¶èŠ‚ç‚¹çš„æ¦‚ç‡æ˜¯ 2/7ï¼ŒD3 åœ¨çˆ¶èŠ‚ç‚¹çš„æ¦‚ç‡æ˜¯ 2/7ã€‚é‚£ä¹ˆä½œä¸ºå­èŠ‚ç‚¹çš„å½’ä¸€åŒ–ä¿¡æ¯ç†µ = 3/70.918+2/71.0+2/7*1.0=0.965ã€‚å› ä¸ºæˆ‘ä»¬ç”¨ ID3 ä¸­çš„ä¿¡æ¯å¢ç›Šæ¥æ„é€ å†³ç­–æ ‘ï¼Œæ‰€ä»¥è¦è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯å¢ç›Šã€‚å¤©æ°”ä½œä¸ºå±æ€§èŠ‚ç‚¹çš„ä¿¡æ¯å¢ç›Šä¸ºï¼ŒGain(D , å¤©æ°”)=0.985-0.965=0.020ã€‚åŒç†æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºå…¶ä»–å±æ€§ä½œä¸ºæ ¹èŠ‚ç‚¹çš„ä¿¡æ¯å¢ç›Šï¼Œå®ƒä»¬åˆ†åˆ«ä¸º ï¼šGain(D , æ¸©åº¦)=0.128Gain(D , æ¹¿åº¦)=0.020Gain(D , åˆ®é£)=0.020ä¸‹å›¾ä¸ºè®¡ç®—Gain(D , æ¸©åº¦)è¿‡ç¨‹ï¼šæˆ‘ä»¬èƒ½çœ‹å‡ºæ¥æ¸©åº¦ä½œä¸ºå±æ€§çš„ä¿¡æ¯å¢ç›Šæœ€å¤§ã€‚å› ä¸º ID3 å°±æ˜¯è¦å°†ä¿¡æ¯å¢ç›Šæœ€å¤§çš„èŠ‚ç‚¹ä½œä¸ºçˆ¶èŠ‚ç‚¹ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°çº¯åº¦é«˜çš„å†³ç­–æ ‘ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æ¸©åº¦ä½œä¸ºæ ¹èŠ‚ç‚¹ã€‚å…¶å†³ç­–æ ‘çŠ¶å›¾åˆ†è£‚ä¸ºä¸‹å›¾æ‰€ç¤ºï¼šç„¶åæˆ‘ä»¬è¦å°†ä¸Šå›¾ä¸­ç¬¬ä¸€ä¸ªå¶èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ D1={1-,2-,3+,4+}è¿›ä¸€æ­¥è¿›è¡Œåˆ†è£‚ï¼Œå¾€ä¸‹åˆ’åˆ†ï¼Œè®¡ç®—å…¶ä¸åŒå±æ€§ï¼ˆå¤©æ°”ã€æ¹¿åº¦ã€åˆ®é£ï¼‰ä½œä¸ºèŠ‚ç‚¹çš„ä¿¡æ¯å¢ç›Šï¼Œå¯ä»¥å¾—åˆ°ï¼šGain(D , æ¹¿åº¦)=1Gain(D , å¤©æ°”)=1Gain(D , åˆ®é£)=0.3115æˆ‘ä»¬èƒ½çœ‹åˆ°æ¹¿åº¦ï¼Œæˆ–è€…å¤©æ°”ä¸º D1 çš„èŠ‚ç‚¹éƒ½å¯ä»¥å¾—åˆ°æœ€å¤§çš„ä¿¡æ¯å¢ç›Šï¼Œè¿™é‡Œæˆ‘ä»¬é€‰å–æ¹¿åº¦ä½œä¸ºèŠ‚ç‚¹çš„å±æ€§åˆ’åˆ†ã€‚åŒç†ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä¸Šé¢çš„è®¡ç®—æ­¥éª¤å¾—åˆ°å®Œæ•´çš„å†³ç­–æ ‘ï¼Œç»“æœå¦‚ä¸‹ï¼šäºæ˜¯æˆ‘ä»¬é€šè¿‡ ID3 ç®—æ³•å¾—åˆ°äº†ä¸€æ£µå†³ç­–æ ‘ã€‚ID3 çš„ç®—æ³•è§„åˆ™ç›¸å¯¹ç®€å•ï¼Œå¯è§£é‡Šæ€§å¼ºã€‚åŒæ ·ä¹Ÿå­˜åœ¨ç¼ºé™·ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¼šå‘ç° ID3 ç®—æ³•å€¾å‘äºé€‰æ‹©å–å€¼æ¯”è¾ƒå¤šçš„å±æ€§ã€‚è¿™æ ·ï¼Œå¦‚æœæˆ‘ä»¬æŠŠâ€œç¼–å·â€ä½œä¸ºä¸€ä¸ªå±æ€§ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šè¿™ä¹ˆåšï¼Œè¿™é‡Œåªæ˜¯ä¸¾ä¸ªä¾‹å­ï¼‰ï¼Œé‚£ä¹ˆâ€œç¼–å·â€å°†ä¼šè¢«é€‰ä¸ºæœ€ä¼˜å±æ€§ ã€‚ä½†å®é™…ä¸Šâ€œç¼–å·â€æ˜¯æ— å…³å±æ€§çš„ï¼Œå®ƒå¯¹â€œæ‰“ç¯®çƒâ€çš„åˆ†ç±»å¹¶æ²¡æœ‰å¤ªå¤§ä½œç”¨ã€‚æ‰€ä»¥ ID3 æœ‰ä¸€ä¸ªç¼ºé™·å°±æ˜¯ï¼Œæœ‰äº›å±æ€§å¯èƒ½å¯¹åˆ†ç±»ä»»åŠ¡æ²¡æœ‰å¤ªå¤§ä½œç”¨ï¼Œä½†æ˜¯ä»–ä»¬ä»ç„¶å¯èƒ½ä¼šè¢«é€‰ä¸ºæœ€ä¼˜å±æ€§ã€‚è¿™ç§ç¼ºé™·ä¸æ˜¯æ¯æ¬¡éƒ½ä¼šå‘ç”Ÿï¼Œåªæ˜¯å­˜åœ¨ä¸€å®šçš„æ¦‚ç‡ã€‚åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒID3 éƒ½èƒ½ç”Ÿæˆä¸é”™çš„å†³ç­–æ ‘åˆ†ç±»ã€‚é’ˆå¯¹å¯èƒ½å‘ç”Ÿçš„ç¼ºé™·ï¼Œåäººæå‡ºäº†æ–°çš„ç®—æ³•è¿›è¡Œæ”¹è¿›ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Decision Tree","slug":"Decision-Tree","permalink":"cpeixin.cn/tags/Decision-Tree/"}]},{"title":"æ•°æ®åˆ†æ-ä½¿ç”¨sklearnä¼˜é›…åœ°è¿›è¡Œæ•°æ®æŒ–æ˜","slug":"æ•°æ®åˆ†æ-ä½¿ç”¨sklearnä¼˜é›…åœ°è¿›è¡Œæ•°æ®æŒ–æ˜","date":"2018-07-10T11:12:49.000Z","updated":"2020-05-01T14:17:46.353Z","comments":true,"path":"2018/07/10/æ•°æ®åˆ†æ-ä½¿ç”¨sklearnä¼˜é›…åœ°è¿›è¡Œæ•°æ®æŒ–æ˜/","link":"","permalink":"cpeixin.cn/2018/07/10/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E4%BD%BF%E7%94%A8sklearn%E4%BC%98%E9%9B%85%E5%9C%B0%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/","excerpt":"","text":"https://www.cnblogs.com/jasonfreak/p/5448462.html","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"sklearn","slug":"sklearn","permalink":"cpeixin.cn/tags/sklearn/"}]},{"title":"æ•°æ®åˆ†æ-ç‰¹å¾é€‰æ‹©","slug":"æ•°æ®åˆ†æ-ç‰¹å¾é€‰æ‹©","date":"2018-07-09T15:12:49.000Z","updated":"2020-05-01T14:17:11.676Z","comments":true,"path":"2018/07/09/æ•°æ®åˆ†æ-ç‰¹å¾é€‰æ‹©/","link":"","permalink":"cpeixin.cn/2018/07/09/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E7%89%B9%E5%BE%81%E9%80%89%E6%8B%A9/","excerpt":"","text":"æ•°æ®åˆ†æ-ç‰¹å¾é€‰æ‹©ç‰¹å¾é€‰æ‹©å½“æ•°æ®é¢„å¤„ç†å®Œæˆåï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©æœ‰æ„ä¹‰çš„ç‰¹å¾è¾“å…¥æœºå™¨å­¦ä¹ çš„ç®—æ³•å’Œæ¨¡å‹è¿›è¡Œè®­ç»ƒã€‚é€šå¸¸æ¥è¯´ï¼Œä»ä¸¤ä¸ªæ–¹é¢è€ƒè™‘æ¥é€‰æ‹©ç‰¹å¾ï¼šç‰¹å¾æ˜¯å¦å‘æ•£ï¼šå¦‚æœä¸€ä¸ªç‰¹å¾ä¸å‘æ•£ï¼Œä¾‹å¦‚æ–¹å·®æ¥è¿‘äº0ï¼Œä¹Ÿå°±æ˜¯è¯´æ ·æœ¬åœ¨è¿™ä¸ªç‰¹å¾ä¸ŠåŸºæœ¬ä¸Šæ²¡æœ‰å·®å¼‚ï¼Œè¿™ä¸ªç‰¹å¾å¯¹äºæ ·æœ¬çš„åŒºåˆ†å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ã€‚ç‰¹å¾ä¸ç›®æ ‡çš„ç›¸å…³æ€§ï¼šè¿™ç‚¹æ¯”è¾ƒæ˜¾è§ï¼Œä¸ç›®æ ‡ç›¸å…³æ€§é«˜çš„ç‰¹å¾ï¼Œåº”å½“ä¼˜é€‰é€‰æ‹©ã€‚é™¤æ–¹å·®æ³•å¤–ï¼Œæœ¬æ–‡ä»‹ç»çš„å…¶ä»–æ–¹æ³•å‡ä»ç›¸å…³æ€§è€ƒè™‘ã€‚æ ¹æ®ç‰¹å¾é€‰æ‹©çš„å½¢å¼åˆå¯ä»¥å°†ç‰¹å¾é€‰æ‹©æ–¹æ³•åˆ†ä¸º3ç§ï¼šFilterï¼šè¿‡æ»¤æ³•ï¼ŒæŒ‰ç…§å‘æ•£æ€§æˆ–è€…ç›¸å…³æ€§å¯¹å„ä¸ªç‰¹å¾è¿›è¡Œè¯„åˆ†ï¼Œè®¾å®šé˜ˆå€¼æˆ–è€…å¾…é€‰æ‹©é˜ˆå€¼çš„ä¸ªæ•°ï¼Œé€‰æ‹©ç‰¹å¾ã€‚Wrapperï¼šåŒ…è£…æ³•ï¼Œæ ¹æ®ç›®æ ‡å‡½æ•°ï¼ˆé€šå¸¸æ˜¯é¢„æµ‹æ•ˆæœè¯„åˆ†ï¼‰ï¼Œæ¯æ¬¡é€‰æ‹©è‹¥å¹²ç‰¹å¾ï¼Œæˆ–è€…æ’é™¤è‹¥å¹²ç‰¹å¾ã€‚Embeddedï¼šé›†æˆæ³•ï¼Œå…ˆä½¿ç”¨æŸäº›æœºå™¨å­¦ä¹ çš„ç®—æ³•å’Œæ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œå¾—åˆ°å„ä¸ªç‰¹å¾çš„æƒå€¼ç³»æ•°ï¼Œæ ¹æ®ç³»æ•°ä»å¤§åˆ°å°é€‰æ‹©ç‰¹å¾ã€‚ç±»ä¼¼äºFilteræ–¹æ³•ï¼Œä½†æ˜¯æ˜¯é€šè¿‡è®­ç»ƒæ¥ç¡®å®šç‰¹å¾çš„ä¼˜åŠ£ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨sklearnä¸­çš„feature_selectionåº“æ¥è¿›è¡Œç‰¹å¾é€‰æ‹©ã€‚Filteræ–¹å·®é€‰æ‹©æ³•ä½¿ç”¨æ–¹å·®é€‰æ‹©æ³•ï¼Œå…ˆè¦è®¡ç®—å„ä¸ªç‰¹å¾çš„æ–¹å·®ï¼Œç„¶åæ ¹æ®é˜ˆå€¼ï¼Œé€‰æ‹©æ–¹å·®å¤§äºé˜ˆå€¼çš„ç‰¹å¾ã€‚ä½¿ç”¨feature_selectionåº“çš„VarianceThresholdç±»æ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š12345from sklearn.feature_selection import VarianceThreshold#æ–¹å·®é€‰æ‹©æ³•ï¼Œè¿”å›å€¼ä¸ºç‰¹å¾é€‰æ‹©åçš„æ•°æ®#å‚æ•°thresholdä¸ºæ–¹å·®çš„é˜ˆå€¼VarianceThreshold(threshold=3).fit_transform(iris.data)ç›¸å…³ç³»æ•°æ³•ä½¿ç”¨ç›¸å…³ç³»æ•°æ³•ï¼Œå…ˆè¦è®¡ç®—å„ä¸ªç‰¹å¾å¯¹ç›®æ ‡å€¼çš„ç›¸å…³ç³»æ•°ä»¥åŠç›¸å…³ç³»æ•°çš„På€¼ã€‚ç”¨feature_selectionåº“çš„SelectKBestç±»ç»“åˆç›¸å…³ç³»æ•°æ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š1234567from sklearn.feature_selection import SelectKBestfrom scipy.stats import pearsonr#é€‰æ‹©Kä¸ªæœ€å¥½çš„ç‰¹å¾ï¼Œè¿”å›é€‰æ‹©ç‰¹å¾åçš„æ•°æ®#ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè®¡ç®—è¯„ä¼°ç‰¹å¾æ˜¯å¦å¥½çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°è¾“å…¥ç‰¹å¾çŸ©é˜µå’Œç›®æ ‡å‘é‡ï¼Œè¾“å‡ºäºŒå…ƒç»„ï¼ˆè¯„åˆ†ï¼ŒPå€¼ï¼‰çš„æ•°ç»„ï¼Œæ•°ç»„ç¬¬ié¡¹ä¸ºç¬¬iä¸ªç‰¹å¾çš„è¯„åˆ†å’ŒPå€¼ã€‚åœ¨æ­¤å®šä¹‰ä¸ºè®¡ç®—ç›¸å…³ç³»æ•°#å‚æ•°kä¸ºé€‰æ‹©çš„ç‰¹å¾ä¸ªæ•°SelectKBest(lambda X, Y: array(map(lambda x:pearsonr(x, Y), X.T)).T, k=2).fit_transform(iris.data, iris.target)å¡æ–¹æ£€éªŒç»å…¸çš„å¡æ–¹æ£€éªŒæ˜¯æ£€éªŒå®šæ€§è‡ªå˜é‡å¯¹å®šæ€§å› å˜é‡çš„ç›¸å…³æ€§ã€‚å‡è®¾è‡ªå˜é‡æœ‰Nç§å–å€¼ï¼Œå› å˜é‡æœ‰Mç§å–å€¼ï¼Œè€ƒè™‘è‡ªå˜é‡ç­‰äºiä¸”å› å˜é‡ç­‰äºjçš„æ ·æœ¬é¢‘æ•°çš„è§‚å¯Ÿå€¼ä¸æœŸæœ›çš„å·®è·ï¼Œæ„å»ºç»Ÿè®¡é‡ï¼šä¸éš¾å‘ç°ï¼Œè¿™ä¸ªç»Ÿè®¡é‡çš„å«ä¹‰ç®€è€Œè¨€ä¹‹å°±æ˜¯è‡ªå˜é‡å¯¹å› å˜é‡çš„ç›¸å…³æ€§ã€‚ç”¨feature_selectionåº“çš„SelectKBestç±»ç»“åˆå¡æ–¹æ£€éªŒæ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š12345from sklearn.feature_selection import SelectKBestfrom sklearn.feature_selection import chi2#é€‰æ‹©Kä¸ªæœ€å¥½çš„ç‰¹å¾ï¼Œè¿”å›é€‰æ‹©ç‰¹å¾åçš„æ•°æ®SelectKBest(chi2, k=2).fit_transform(iris.data, iris.target)äº’ä¿¡æ¯æ³•ç»å…¸çš„äº’ä¿¡æ¯ä¹Ÿæ˜¯è¯„ä»·å®šæ€§è‡ªå˜é‡å¯¹å®šæ€§å› å˜é‡çš„ç›¸å…³æ€§çš„ï¼Œäº’ä¿¡æ¯è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼šä¸ºäº†å¤„ç†å®šé‡æ•°æ®ï¼Œæœ€å¤§ä¿¡æ¯ç³»æ•°æ³•è¢«æå‡ºï¼Œä½¿ç”¨feature_selectionåº“çš„SelectKBestç±»ç»“åˆæœ€å¤§ä¿¡æ¯ç³»æ•°æ³•æ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š123456789101112from sklearn.feature_selection import SelectKBestfrom minepy import MINE #ç”±äºMINEçš„è®¾è®¡ä¸æ˜¯å‡½æ•°å¼çš„ï¼Œå®šä¹‰micæ–¹æ³•å°†å…¶ä¸ºå‡½æ•°å¼çš„ï¼Œè¿”å›ä¸€ä¸ªäºŒå…ƒç»„ï¼ŒäºŒå…ƒç»„çš„ç¬¬2é¡¹è®¾ç½®æˆå›ºå®šçš„På€¼0.5 def mic(x, y): m = MINE() m.compute_score(x, y) return (m.mic(), 0.5)#é€‰æ‹©Kä¸ªæœ€å¥½çš„ç‰¹å¾ï¼Œè¿”å›ç‰¹å¾é€‰æ‹©åçš„æ•°æ®SelectKBest(lambda X, Y: array(map(lambda x:mic(x, Y), X.T)).T, k=2).fit_transform(iris.data, iris.target)WrapperWrapperé€’å½’ç‰¹å¾æ¶ˆé™¤æ³•é€’å½’æ¶ˆé™¤ç‰¹å¾æ³•ä½¿ç”¨ä¸€ä¸ªåŸºæ¨¡å‹æ¥è¿›è¡Œå¤šè½®è®­ç»ƒï¼Œæ¯è½®è®­ç»ƒåï¼Œæ¶ˆé™¤è‹¥å¹²æƒå€¼ç³»æ•°çš„ç‰¹å¾ï¼Œå†åŸºäºæ–°çš„ç‰¹å¾é›†è¿›è¡Œä¸‹ä¸€è½®è®­ç»ƒã€‚ä½¿ç”¨feature_selectionåº“çš„RFEç±»æ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š1234567from sklearn.feature_selection import RFEfrom sklearn.linear_model import LogisticRegression#é€’å½’ç‰¹å¾æ¶ˆé™¤æ³•ï¼Œè¿”å›ç‰¹å¾é€‰æ‹©åçš„æ•°æ®#å‚æ•°estimatorä¸ºåŸºæ¨¡å‹#å‚æ•°n_features_to_selectä¸ºé€‰æ‹©çš„ç‰¹å¾ä¸ªæ•°RFE(estimator=LogisticRegression(), n_features_to_select=2).fit_transform(iris.data, iris.target)EmbeddedåŸºäºæƒ©ç½šé¡¹çš„ç‰¹å¾é€‰æ‹©æ³•ä½¿ç”¨å¸¦æƒ©ç½šé¡¹çš„åŸºæ¨¡å‹ï¼Œé™¤äº†ç­›é€‰å‡ºç‰¹å¾å¤–ï¼ŒåŒæ—¶ä¹Ÿè¿›è¡Œäº†é™ç»´ã€‚ä½¿ç”¨feature_selectionåº“çš„SelectFromModelç±»ç»“åˆå¸¦L1æƒ©ç½šé¡¹çš„é€»è¾‘å›å½’æ¨¡å‹ï¼Œæ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š12345from sklearn.feature_selection import SelectFromModelfrom sklearn.linear_model import LogisticRegression#å¸¦L1æƒ©ç½šé¡¹çš„é€»è¾‘å›å½’ä½œä¸ºåŸºæ¨¡å‹çš„ç‰¹å¾é€‰æ‹©SelectFromModel(LogisticRegression(penalty=\"l1\", C=0.1)).fit_transform(iris.data, iris.target)å®é™…ä¸Šï¼ŒL1æƒ©ç½šé¡¹é™ç»´çš„åŸç†åœ¨äºä¿ç•™å¤šä¸ªå¯¹ç›®æ ‡å€¼å…·æœ‰åŒç­‰ç›¸å…³æ€§çš„ç‰¹å¾ä¸­çš„ä¸€ä¸ªï¼Œæ‰€ä»¥æ²¡é€‰åˆ°çš„ç‰¹å¾ä¸ä»£è¡¨ä¸é‡è¦ã€‚æ•…ï¼Œå¯ç»“åˆL2æƒ©ç½šé¡¹æ¥ä¼˜åŒ–ã€‚å…·ä½“æ“ä½œä¸ºï¼šè‹¥ä¸€ä¸ªç‰¹å¾åœ¨L1ä¸­çš„æƒå€¼ä¸º1ï¼Œé€‰æ‹©åœ¨L2ä¸­æƒå€¼å·®åˆ«ä¸å¤§ä¸”åœ¨L1ä¸­æƒå€¼ä¸º0çš„ç‰¹å¾æ„æˆåŒç±»é›†åˆï¼Œå°†è¿™ä¸€é›†åˆä¸­çš„ç‰¹å¾å¹³åˆ†L1ä¸­çš„æƒå€¼ï¼Œæ•…éœ€è¦æ„å»ºä¸€ä¸ªæ–°çš„é€»è¾‘å›å½’æ¨¡å‹ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647from sklearn.linear_model import LogisticRegressionclass LR(LogisticRegression): def __init__(self, threshold=0.01, dual=False, tol=1e-4, C=1.0, fit_intercept=True, intercept_scaling=1, class_weight=None, random_state=None, solver='liblinear', max_iter=100, multi_class='ovr', verbose=0, warm_start=False, n_jobs=1): #æƒå€¼ç›¸è¿‘çš„é˜ˆå€¼ self.threshold = threshold LogisticRegression.__init__(self, penalty='l1', dual=dual, tol=tol, C=C, fit_intercept=fit_intercept, intercept_scaling=intercept_scaling, class_weight=class_weight, random_state=random_state, solver=solver, max_iter=max_iter, multi_class=multi_class, verbose=verbose, warm_start=warm_start, n_jobs=n_jobs) #ä½¿ç”¨åŒæ ·çš„å‚æ•°åˆ›å»ºL2é€»è¾‘å›å½’ self.l2 = LogisticRegression(penalty='l2', dual=dual, tol=tol, C=C, fit_intercept=fit_intercept, intercept_scaling=intercept_scaling, class_weight = class_weight, random_state=random_state, solver=solver, max_iter=max_iter, multi_class=multi_class, verbose=verbose, warm_start=warm_start, n_jobs=n_jobs) def fit(self, X, y, sample_weight=None): #è®­ç»ƒL1é€»è¾‘å›å½’ super(LR, self).fit(X, y, sample_weight=sample_weight) self.coef_old_ = self.coef_.copy() #è®­ç»ƒL2é€»è¾‘å›å½’ self.l2.fit(X, y, sample_weight=sample_weight) cntOfRow, cntOfCol = self.coef_.shape #æƒå€¼ç³»æ•°çŸ©é˜µçš„è¡Œæ•°å¯¹åº”ç›®æ ‡å€¼çš„ç§ç±»æ•°ç›® for i in range(cntOfRow): for j in range(cntOfCol): coef = self.coef_[i][j] #L1é€»è¾‘å›å½’çš„æƒå€¼ç³»æ•°ä¸ä¸º0 if coef != 0: idx = [j] #å¯¹åº”åœ¨L2é€»è¾‘å›å½’ä¸­çš„æƒå€¼ç³»æ•° coef1 = self.l2.coef_[i][j] for k in range(cntOfCol): coef2 = self.l2.coef_[i][k] #åœ¨L2é€»è¾‘å›å½’ä¸­ï¼Œæƒå€¼ç³»æ•°ä¹‹å·®å°äºè®¾å®šçš„é˜ˆå€¼ï¼Œä¸”åœ¨L1ä¸­å¯¹åº”çš„æƒå€¼ä¸º0 if abs(coef1-coef2) &lt; self.threshold and j != k and self.coef_[i][k] == 0: idx.append(k) #è®¡ç®—è¿™ä¸€ç±»ç‰¹å¾çš„æƒå€¼ç³»æ•°å‡å€¼ mean = coef / len(idx) self.coef_[i][idx] = mean return self ä½¿ç”¨feature_selectionåº“çš„SelectFromModelç±»ç»“åˆå¸¦L1ä»¥åŠL2æƒ©ç½šé¡¹çš„é€»è¾‘å›å½’æ¨¡å‹ï¼Œæ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼šfrom sklearn.feature_selection import SelectFromModel #å¸¦L1å’ŒL2æƒ©ç½šé¡¹çš„é€»è¾‘å›å½’ä½œä¸ºåŸºæ¨¡å‹çš„ç‰¹å¾é€‰æ‹©#å‚æ•°thresholdä¸ºæƒå€¼ç³»æ•°ä¹‹å·®çš„é˜ˆå€¼SelectFromModel(LR(threshold=0.5, C=0.1)).fit_transform(iris.data, iris.target)åŸºäºæ ‘æ¨¡å‹çš„ç‰¹å¾é€‰æ‹©æ³•æ ‘æ¨¡å‹ä¸­GBDTä¹Ÿå¯ç”¨æ¥ä½œä¸ºåŸºæ¨¡å‹è¿›è¡Œç‰¹å¾é€‰æ‹©ï¼Œä½¿ç”¨feature_selectionåº“çš„SelectFromModelç±»ç»“åˆGBDTæ¨¡å‹ï¼Œæ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š123456from sklearn.feature_selection import SelectFromModelfrom sklearn.ensemble import GradientBoostingClassifier#GBDTä½œä¸ºåŸºæ¨¡å‹çš„ç‰¹å¾é€‰æ‹©SelectFromModel(GradientBoostingClassifier()).fit_transform(iris.data, iris.target)é™ç»´å½“ç‰¹å¾é€‰æ‹©å®Œæˆåï¼Œå¯ä»¥ç›´æ¥è®­ç»ƒæ¨¡å‹äº†ï¼Œä½†æ˜¯å¯èƒ½ç”±äºç‰¹å¾çŸ©é˜µè¿‡å¤§ï¼Œå¯¼è‡´è®¡ç®—é‡å¤§ï¼Œè®­ç»ƒæ—¶é—´é•¿çš„é—®é¢˜ï¼Œå› æ­¤é™ä½ç‰¹å¾çŸ©é˜µç»´åº¦ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ã€‚å¸¸è§çš„é™ç»´æ–¹æ³•é™¤äº†ä»¥ä¸Šæåˆ°çš„åŸºäºL1æƒ©ç½šé¡¹çš„æ¨¡å‹ä»¥å¤–ï¼Œå¦å¤–è¿˜æœ‰ä¸»æˆåˆ†åˆ†ææ³•ï¼ˆPCAï¼‰å’Œçº¿æ€§åˆ¤åˆ«åˆ†æï¼ˆLDAï¼‰ï¼Œçº¿æ€§åˆ¤åˆ«åˆ†ææœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªåˆ†ç±»æ¨¡å‹ã€‚PCAå’ŒLDAæœ‰å¾ˆå¤šçš„ç›¸ä¼¼ç‚¹ï¼Œå…¶æœ¬è´¨æ˜¯è¦å°†åŸå§‹çš„æ ·æœ¬æ˜ å°„åˆ°ç»´åº¦æ›´ä½çš„æ ·æœ¬ç©ºé—´ä¸­ï¼Œä½†æ˜¯PCAå’ŒLDAçš„æ˜ å°„ç›®æ ‡ä¸ä¸€æ ·ï¼šPCAæ˜¯ä¸ºäº†è®©æ˜ å°„åçš„æ ·æœ¬å…·æœ‰æœ€å¤§çš„å‘æ•£æ€§ï¼›è€ŒLDAæ˜¯ä¸ºäº†è®©æ˜ å°„åçš„æ ·æœ¬æœ‰æœ€å¥½çš„åˆ†ç±»æ€§èƒ½ã€‚æ‰€ä»¥è¯´PCAæ˜¯ä¸€ç§æ— ç›‘ç£çš„é™ç»´æ–¹æ³•ï¼Œè€ŒLDAæ˜¯ä¸€ç§æœ‰ç›‘ç£çš„é™ç»´æ–¹æ³•ã€‚ä¸»æˆåˆ†åˆ†ææ³•ï¼ˆPCAï¼‰ä½¿ç”¨decompositionåº“çš„PCAç±»é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š12345from sklearn.decomposition import PCA#ä¸»æˆåˆ†åˆ†ææ³•ï¼Œè¿”å›é™ç»´åçš„æ•°æ®#å‚æ•°n_componentsä¸ºä¸»æˆåˆ†æ•°ç›®PCA(n_components=2).fit_transform(iris.data)çº¿æ€§åˆ¤åˆ«åˆ†ææ³•ï¼ˆLDAï¼‰ä½¿ç”¨ldaåº“çš„LDAç±»é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š12345from sklearn.lda import LDA#çº¿æ€§åˆ¤åˆ«åˆ†ææ³•ï¼Œè¿”å›é™ç»´åçš„æ•°æ®#å‚æ•°n_componentsä¸ºé™ç»´åçš„ç»´æ•°LDA(n_components=2).fit_transform(iris.data, iris.target)æ€»ç»“å†è®©æˆ‘ä»¬å›å½’ä¸€ä¸‹æœ¬æ–‡å¼€å§‹çš„ç‰¹å¾å·¥ç¨‹çš„æ€ç»´å¯¼å›¾ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨sklearnå®Œæˆå‡ ä¹æ‰€æœ‰ç‰¹å¾å¤„ç†çš„å·¥ä½œï¼Œè€Œä¸”ä¸ç®¡æ˜¯æ•°æ®é¢„å¤„ç†ï¼Œè¿˜æ˜¯ç‰¹å¾é€‰æ‹©ï¼ŒæŠ‘æˆ–é™ç»´ï¼Œå®ƒä»¬éƒ½æ˜¯é€šè¿‡æŸä¸ªç±»çš„æ–¹æ³•fit_transformå®Œæˆ","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"ç‰¹å¾å·¥ç¨‹","slug":"ç‰¹å¾å·¥ç¨‹","permalink":"cpeixin.cn/tags/%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/"}]},{"title":"æ•°æ®åˆ†æ-ç‰¹å¾é¢„å¤„ç†","slug":"æ•°æ®åˆ†æ-ç‰¹å¾é¢„å¤„ç†","date":"2018-07-08T12:12:49.000Z","updated":"2020-05-01T14:17:03.540Z","comments":true,"path":"2018/07/08/æ•°æ®åˆ†æ-ç‰¹å¾é¢„å¤„ç†/","link":"","permalink":"cpeixin.cn/2018/07/08/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E7%89%B9%E5%BE%81%E9%A2%84%E5%A4%84%E7%90%86/","excerpt":"","text":"ç‰¹å¾å·¥ç¨‹åç››é¡¿å¤§å­¦æ•™æˆã€ã€Šç»ˆæç®—æ³•ã€‹ï¼ˆThe Master Algorithmï¼‰çš„ä½œè€…ä½©å¾·ç½—Â·å¤šæ˜æˆˆæ–¯æ›¾åœ¨ Communications of The ACM ç¬¬ 55 å·ç¬¬ 10 æœŸä¸Šå‘è¡¨äº†ä¸€ç¯‡åä¸ºã€Šæœºå™¨å­¦ä¹ ä½ ä¸å¾—ä¸çŸ¥çš„é‚£äº›äº‹ã€‹ï¼ˆA Few Useful Things to Know about Machine Learningï¼‰çš„å°æ–‡ï¼Œä»‹ç»äº† 12 æ¡æœºå™¨å­¦ä¹ ä¸­çš„â€œé‡‘ç§‘ç‰å¾‹â€ï¼Œå…¶ä¸­çš„ 7/8 ä¸¤æ¡è¯´çš„å°±æ˜¯å¯¹æ•°æ®çš„ä½œç”¨çš„è®¤è¯†ã€‚å¤šæ˜æˆˆæ–¯çš„è§‚ç‚¹æ˜¯ï¼šæ•°æ®é‡æ¯”ç®—æ³•æ›´é‡è¦ã€‚å³ä½¿ç®—æ³•æœ¬èº«å¹¶æ²¡æœ‰ä»€ä¹ˆç²¾å·§çš„è®¾è®¡ï¼Œä½†ä½¿ç”¨å¤§é‡æ•°æ®è¿›è¡Œè®­ç»ƒä¹Ÿèƒ½èµ·åˆ°å¡«é¸­çš„æ•ˆæœï¼Œè·å¾—æ¯”ç”¨å°‘é‡æ•°æ®è®­ç»ƒå‡ºæ¥çš„èªæ˜ç®—æ³•æ›´å¥½çš„æ€§èƒ½ã€‚è¿™ä¹Ÿåº”äº†é‚£å¥è€è¯ï¼šæ•°æ®å†³å®šäº†æœºå™¨å­¦ä¹ çš„ä¸Šé™ï¼Œè€Œç®—æ³•åªæ˜¯å°½å¯èƒ½é€¼è¿‘è¿™ä¸ªä¸Šé™ã€‚ä½†å¤šæ˜æˆˆæ–¯å˜´é‡Œçš„æ•°æ®å¯ä¸æ˜¯ç¡¬ä»¶é‡‡é›†æˆ–è€…è½¯ä»¶æŠ“å–çš„åŸå§‹æ•°æ®ï¼Œè€Œæ˜¯ç»è¿‡ç‰¹å¾å·¥ç¨‹å¤„ç†ä¹‹åçš„ç²¾ä¿®æ•°æ®ï¼Œåœ¨ä»–çœ‹æ¥ï¼Œç‰¹å¾å·¥ç¨‹ï¼ˆfeature engineeringï¼‰æ‰æ˜¯æœºå™¨å­¦ä¹ çš„å…³é”®**ã€‚é€šå¸¸æ¥è¯´ï¼ŒåŸå§‹æ•°æ®å¹¶ä¸ç›´æ¥é€‚ç”¨äºå­¦ä¹ ï¼Œè€Œæ˜¯ç‰¹å¾ç­›é€‰ã€æ„é€ å’Œç”Ÿæˆçš„åŸºç¡€ã€‚ä¸€ä¸ªå¥½çš„é¢„æµ‹æ¨¡å‹ä¸é«˜æ•ˆçš„ç‰¹å¾æå–å’Œæ˜ç¡®çš„ç‰¹å¾è¡¨ç¤ºæ¯æ¯ç›¸å…³ï¼Œå¦‚æœé€šè¿‡ç‰¹å¾å·¥ç¨‹å¾—åˆ°å¾ˆå¤šç‹¬ç«‹çš„ä¸”ä¸æ‰€å±ç±»åˆ«ç›¸å…³çš„ç‰¹å¾ï¼Œé‚£å­¦ä¹ è¿‡ç¨‹å°±å˜æˆå°èœä¸€ç¢Ÿã€‚ç‰¹å¾çš„æœ¬è´¨æ˜¯ç”¨äºé¢„æµ‹åˆ†ç±»ç»“æœçš„ä¿¡æ¯ï¼Œç‰¹å¾å·¥ç¨‹å®é™…ä¸Šå°±æ˜¯å¯¹è¿™äº›ä¿¡æ¯çš„ç¼–ç ã€‚æœºå™¨å­¦ä¹ ä¸­çš„å¾ˆå¤šå…·ä½“ç®—æ³•éƒ½å¯ä»¥å½’çº³åˆ°ç‰¹å¾å·¥ç¨‹çš„èŒƒç•´ä¹‹ä¸­ï¼Œæ¯”å¦‚ä½¿ç”¨ L1 æ­£åˆ™åŒ–é¡¹çš„ LASSO å›å½’ï¼Œå°±æ˜¯é€šè¿‡å°†æŸäº›ç‰¹å¾çš„æƒé‡ç³»æ•°ç¼©å°åˆ° 0 æ¥å®ç°ç‰¹å¾çš„è¿‡æ»¤ï¼›å†æ¯”å¦‚ä¸»æˆåˆ†åˆ†æï¼Œå°†å…·æœ‰ç›¸å…³æ€§çš„ä¸€ç»„ç‰¹å¾å˜æ¢ä¸ºå¦ä¸€ç»„çº¿æ€§æ— å…³çš„ç‰¹å¾ã€‚è¿™äº›æ–¹æ³•æœ¬è´¨ä¸Šå®Œæˆçš„éƒ½æ˜¯ç‰¹å¾å·¥ç¨‹çš„ä»»åŠ¡ã€‚æœ¬è´¨ä¸Šè®²ï¼Œç‰¹å¾å·¥ç¨‹æ˜¯ä¸€ä¸ªè¡¨ç¤ºå’Œå±•ç°æ•°æ®çš„è¿‡ç¨‹ï¼›å®é™…å·¥ä½œä¸­ï¼Œç‰¹å¾å·¥ç¨‹çš„ç›®çš„æ˜¯å»é™¤åŸå§‹æ•°æ®ä¸­çš„æ‚è´¨å’Œå†—ä½™ï¼Œè®¾è®¡æ›´é«˜æ•ˆçš„ç‰¹å¾ä»¥åˆ»ç”»æ±‚è§£çš„é—®é¢˜ä¸é¢„æµ‹æ¨¡å‹ä¹‹é—´çš„å…³ç³»ã€‚ç‰¹å¾å·¥ç¨‹çš„é‡è¦æ€§æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼šç‰¹å¾è¶Šå¥½ï¼Œçµæ´»æ€§è¶Šå¼ºã€‚å¥½çš„ç‰¹å¾çš„çµæ´»æ€§åœ¨äºå®ƒå…è®¸ä½ é€‰æ‹©ä¸å¤æ‚çš„æ¨¡å‹ï¼ŒåŒæ—¶è¿è¡Œé€Ÿåº¦ä¹Ÿæ›´å¿«ï¼Œä¹Ÿæ›´å®¹æ˜“å’Œç»´æŠ¤ã€‚ç‰¹å¾è¶Šå¥½ï¼Œæ„å»ºçš„æ¨¡å‹è¶Šç®€å•ã€‚å¥½çš„ç‰¹å¾å¯ä»¥åœ¨å‚æ•°ä¸æ˜¯æœ€ä¼˜çš„æƒ…å†µï¼Œä¾ç„¶å¾—åˆ°å¾ˆå¥½çš„æ€§èƒ½ï¼Œå‡å°‘è°ƒå‚çš„å·¥ä½œé‡å’Œæ—¶é—´ï¼Œä¹Ÿå°±å¯ä»¥å¤§å¤§é™ä½æ¨¡å‹å¤æ‚åº¦ã€‚ç‰¹å¾è¶Šå¥½ï¼Œæ¨¡å‹çš„æ€§èƒ½è¶Šå‡ºè‰²ã€‚ç‰¹å¾å·¥ç¨‹çš„ç›®çš„æœ¬æ¥å°±æ˜¯ä¸ºäº†æå‡æ¨¡å‹çš„æ€§èƒ½ã€‚ä½†æ˜¯ä»Šå¤©ï¼Œæˆ‘å°†ä¸ä¼šè®¨è®ºè¿™äº›ï¼Œè€Œæ˜¯æŠŠå…³æ³¨ç‚¹æ”¾åœ¨ç®—æ³•ä¹‹å¤–ï¼Œçœ‹ä¸€çœ‹åœ¨ç‰¹å¾å·¥ç¨‹ä¹‹å‰ï¼Œæ•°æ®çš„ç‰¹å¾éœ€è¦ç»è¿‡å“ªäº›å¿…è¦çš„é¢„å¤„ç†ï¼ˆpreprocessingï¼‰ã€‚ç‰¹å¾é¢„å¤„ç†é€šè¿‡ç‰¹å¾æå–ï¼Œæˆ‘ä»¬èƒ½å¾—åˆ°æœªç»å¤„ç†çš„ç‰¹å¾ï¼Œè¿™æ—¶çš„ç‰¹å¾å¯èƒ½æœ‰ä»¥ä¸‹é—®é¢˜ï¼šä¸å±äºåŒä¸€é‡çº²å³ç‰¹å¾çš„è§„æ ¼ä¸ä¸€æ ·ï¼Œä¸èƒ½å¤Ÿæ”¾åœ¨ä¸€èµ·æ¯”è¾ƒã€‚æ— é‡çº²åŒ–å¯ä»¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚ä¿¡æ¯å†—ä½™å¯¹äºæŸäº›å®šé‡ç‰¹å¾ï¼Œå…¶åŒ…å«çš„æœ‰æ•ˆä¿¡æ¯ä¸ºåŒºé—´åˆ’åˆ†ï¼Œä¾‹å¦‚å­¦ä¹ æˆç»©ï¼Œå‡è‹¥åªå…³å¿ƒâ€œåŠæ ¼â€æˆ–ä¸â€œåŠæ ¼â€ï¼Œé‚£ä¹ˆéœ€è¦å°†å®šé‡çš„è€ƒåˆ†ï¼Œè½¬æ¢æˆâ€œ1â€å’Œâ€œ0â€è¡¨ç¤ºåŠæ ¼å’ŒæœªåŠæ ¼ã€‚äºŒå€¼åŒ–å¯ä»¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚å®šæ€§ç‰¹å¾ä¸èƒ½ç›´æ¥ä½¿ç”¨æŸäº›æœºå™¨å­¦ä¹ ç®—æ³•å’Œæ¨¡å‹åªèƒ½æ¥å—å®šé‡ç‰¹å¾çš„è¾“å…¥ï¼Œé‚£ä¹ˆéœ€è¦å°†å®šæ€§ç‰¹å¾è½¬æ¢ä¸ºå®šé‡ç‰¹å¾ã€‚æœ€ç®€å•çš„æ–¹å¼æ˜¯ä¸ºæ¯ä¸€ç§å®šæ€§å€¼æŒ‡å®šä¸€ä¸ªå®šé‡å€¼ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼è¿‡äºçµæ´»ï¼Œå¢åŠ äº†è°ƒå‚çš„å·¥ä½œã€‚é€šå¸¸ä½¿ç”¨å“‘ç¼–ç çš„æ–¹å¼å°†å®šæ€§ç‰¹å¾è½¬æ¢ä¸ºå®šé‡ç‰¹å¾ï¼šå‡è®¾æœ‰Nç§å®šæ€§å€¼ï¼Œåˆ™å°†è¿™ä¸€ä¸ªç‰¹å¾æ‰©å±•ä¸ºNç§ç‰¹å¾ï¼Œå½“åŸå§‹ç‰¹å¾å€¼ä¸ºç¬¬iç§å®šæ€§å€¼æ—¶ï¼Œç¬¬iä¸ªæ‰©å±•ç‰¹å¾èµ‹å€¼ä¸º1ï¼Œå…¶ä»–æ‰©å±•ç‰¹å¾èµ‹å€¼ä¸º0ã€‚å“‘ç¼–ç çš„æ–¹å¼ç›¸æ¯”ç›´æ¥æŒ‡å®šçš„æ–¹å¼ï¼Œä¸ç”¨å¢åŠ è°ƒå‚çš„å·¥ä½œï¼Œå¯¹äºçº¿æ€§æ¨¡å‹æ¥è¯´ï¼Œä½¿ç”¨å“‘ç¼–ç åçš„ç‰¹å¾å¯è¾¾åˆ°éçº¿æ€§çš„æ•ˆæœã€‚å­˜åœ¨ç¼ºå¤±å€¼ï¼šç¼ºå¤±å€¼éœ€è¦è¡¥å……ã€‚ä¿¡æ¯åˆ©ç”¨ç‡ä½ï¼šä¸åŒçš„æœºå™¨å­¦ä¹ ç®—æ³•å’Œæ¨¡å‹å¯¹æ•°æ®ä¸­ä¿¡æ¯çš„åˆ©ç”¨æ˜¯ä¸åŒçš„ï¼Œä¹‹å‰æåˆ°åœ¨çº¿æ€§æ¨¡å‹ä¸­ï¼Œä½¿ç”¨å¯¹å®šæ€§ç‰¹å¾å“‘ç¼–ç å¯ä»¥è¾¾åˆ°éçº¿æ€§çš„æ•ˆæœã€‚ç±»ä¼¼åœ°ï¼Œå¯¹å®šé‡å˜é‡å¤šé¡¹å¼åŒ–ï¼Œæˆ–è€…è¿›è¡Œå…¶ä»–çš„è½¬æ¢ï¼Œéƒ½èƒ½è¾¾åˆ°éçº¿æ€§çš„æ•ˆæœã€‚æˆ‘ä»¬ä½¿ç”¨sklearnä¸­çš„preproccessingåº“æ¥è¿›è¡Œæ•°æ®é¢„å¤„ç†ï¼Œå¯ä»¥è¦†ç›–ä»¥ä¸Šé—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚é¦–å…ˆä»‹ç»æ•°æ®é¢„å¤„ç†ä¸­ï¼Œæ¯”è¾ƒç®€å•çš„éƒ¨åˆ†ï¼šå¤„ç†ç¼ºå¤±å€¼æ•°æ®çš„ç¼ºå¤±ä¸»è¦åŒ…æ‹¬è®°å½•çš„ç¼ºå¤±å’Œè®°å½•ä¸­æŸä¸ªå­—æ®µä¿¡æ¯çš„ç¼ºå¤±ï¼Œä¸¤è€…éƒ½ä¼šé€ æˆåˆ†æç»“æœçš„ä¸å‡†ç¡®ã€‚ç¼ºå¤±å€¼äº§ç”Ÿçš„åŸå› ä¿¡æ¯æš‚æ—¶æ— æ³•è·å–ï¼Œæˆ–è€…è·å–ä¿¡æ¯çš„ä»£ä»·å¤ªå¤§ã€‚ä¿¡æ¯è¢«é—æ¼ï¼Œäººä¸ºçš„è¾“å…¥é—æ¼æˆ–è€…æ•°æ®é‡‡é›†è®¾å¤‡çš„é—æ¼ã€‚å±æ€§ä¸å­˜åœ¨ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç¼ºå¤±å€¼å¹¶ä¸æ„å‘³ç€æ•°æ®æœ‰é”™è¯¯ï¼Œå¯¹ä¸€äº›å¯¹è±¡æ¥è¯´æŸäº›å±æ€§å€¼æ˜¯ä¸å­˜åœ¨çš„ï¼Œå¦‚æœªå©šè€…çš„é…å¶å§“åã€å„¿ç«¥çš„å›ºå®šæ”¶å…¥ç­‰ã€‚ç¼ºå¤±å€¼çš„å½±å“æ•°æ®æŒ–æ˜å»ºæ¨¡å°†ä¸¢å¤±å¤§é‡çš„æœ‰ç”¨ä¿¡æ¯ã€‚æ•°æ®æŒ–æ˜æ¨¡å‹æ‰€è¡¨ç°å‡ºçš„ä¸ç¡®å®šæ€§æ›´åŠ æ˜¾è‘—ï¼Œæ¨¡å‹ä¸­è•´å«çš„è§„å¾‹æ›´éš¾æŠŠæ¡ã€‚åŒ…å«ç©ºå€¼çš„æ•°æ®ä¼šä½¿å»ºæ¨¡è¿‡ç¨‹é™·å…¥æ··ä¹±ï¼Œå¯¼è‡´ä¸å¯é çš„è¾“å‡ºã€‚ç¼ºå¤±å€¼çš„å¤„ç†æ–¹æ³•ç›´æ¥ä½¿ç”¨å«æœ‰ç¼ºå¤±å€¼çš„ç‰¹å¾ï¼šå½“ä»…æœ‰å°‘é‡æ ·æœ¬ç¼ºå¤±è¯¥ç‰¹å¾çš„æ—¶å€™å¯ä»¥å°è¯•ä½¿ç”¨ï¼›åˆ é™¤å«æœ‰ç¼ºå¤±å€¼çš„ç‰¹å¾ï¼šè¿™ä¸ªæ–¹æ³•ä¸€èˆ¬é€‚ç”¨äºå¤§å¤šæ•°æ ·æœ¬éƒ½ç¼ºå°‘è¯¥ç‰¹å¾ï¼Œä¸”ä»…åŒ…å«å°‘é‡æœ‰æ•ˆå€¼æ˜¯æœ‰æ•ˆçš„ï¼›æ’å€¼è¡¥å…¨ç¼ºå¤±å€¼æ’å€¼è¡¥å…¨ç¼ºå¤±å€¼æœ€å¸¸ä½¿ç”¨çš„è¿˜æ˜¯ç¬¬ä¸‰ç§æ’å€¼è¡¥å…¨ç¼ºå¤±å€¼çš„åšæ³•ï¼Œè¿™ç§åšæ³•åˆå¯ä»¥æœ‰å¤šç§è¡¥å…¨æ–¹æ³•ã€‚å‡å€¼/ä¸­ä½æ•°/ä¼—æ•°è¡¥å…¨å¦‚æœæ ·æœ¬å±æ€§çš„è·ç¦»æ˜¯å¯åº¦é‡çš„ï¼Œåˆ™ä½¿ç”¨è¯¥å±æ€§æœ‰æ•ˆå€¼çš„å¹³å‡å€¼æ¥è¡¥å…¨ï¼›å¦‚æœæ ·æœ¬å±æ€§çš„è·ç¦»ä¸å¯åº¦é‡ï¼Œåˆ™å¯ä»¥é‡‡ç”¨ä¼—æ•°æˆ–è€…ä¸­ä½æ•°æ¥è¡¥å…¨ã€‚åŒç±»å‡å€¼/ä¸­ä½æ•°/ä¼—æ•°è¡¥å…¨å¯¹æ ·æœ¬è¿›è¡Œåˆ†ç±»åï¼Œæ ¹æ®åŒç±»å…¶ä»–æ ·æœ¬è¯¥å±æ€§çš„å‡å€¼è¡¥å…¨ç¼ºå¤±å€¼ï¼Œå½“ç„¶åŒç¬¬ä¸€ç§æ–¹æ³•ç±»ä¼¼ï¼Œå¦‚æœå‡å€¼ä¸å¯è¡Œï¼Œå¯ä»¥å°è¯•ä¼—æ•°æˆ–è€…ä¸­ä½æ•°ç­‰ç»Ÿè®¡æ•°æ®æ¥è¡¥å…¨ã€‚å›ºå®šå€¼è¡¥å…¨åˆ©ç”¨å›ºå®šçš„æ•°å€¼è¡¥å…¨ç¼ºå¤±çš„å±æ€§å€¼ã€‚å»ºæ¨¡é¢„æµ‹åˆ©ç”¨æœºå™¨å­¦ä¹ æ–¹æ³•ï¼Œå°†ç¼ºå¤±å±æ€§ä½œä¸ºé¢„æµ‹ç›®æ ‡è¿›è¡Œé¢„æµ‹ï¼Œå…·ä½“ä¸ºå°†æ ·æœ¬æ ¹æ®æ˜¯å¦ç¼ºå°‘è¯¥å±æ€§åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œç„¶åé‡‡ç”¨å¦‚å›å½’ã€å†³ç­–æ ‘ç­‰æœºå™¨å­¦ä¹ ç®—æ³•è®­ç»ƒæ¨¡å‹ï¼Œå†åˆ©ç”¨è®­ç»ƒå¾—åˆ°çš„æ¨¡å‹é¢„æµ‹æµ‹è¯•é›†ä¸­æ ·æœ¬çš„è¯¥å±æ€§çš„æ•°å€¼ã€‚è¿™ä¸ªæ–¹æ³•æ ¹æœ¬çš„ç¼ºé™·æ˜¯å¦‚æœå…¶ä»–å±æ€§å’Œç¼ºå¤±å±æ€§æ— å…³ï¼Œåˆ™é¢„æµ‹çš„ç»“æœæ¯«æ— æ„ä¹‰ï¼›ä½†æ˜¯è‹¥é¢„æµ‹ç»“æœç›¸å½“å‡†ç¡®ï¼Œåˆ™è¯´æ˜è¿™ä¸ªç¼ºå¤±å±æ€§æ˜¯æ²¡å¿…è¦çº³å…¥æ•°æ®é›†ä¸­çš„ï¼›ä¸€èˆ¬çš„æƒ…å†µæ˜¯ä»‹äºä¸¤è€…ä¹‹é—´ã€‚é«˜ç»´æ˜ å°„å°†å±æ€§æ˜ å°„åˆ°é«˜ç»´ç©ºé—´ï¼Œé‡‡ç”¨ç‹¬çƒ­ç ç¼–ç ï¼ˆone-hotï¼‰æŠ€æœ¯ã€‚å°†åŒ…å« K ä¸ªç¦»æ•£å–å€¼èŒƒå›´çš„å±æ€§å€¼æ‰©å±•ä¸º K+1 ä¸ªå±æ€§å€¼ï¼Œè‹¥è¯¥å±æ€§å€¼ç¼ºå¤±ï¼Œåˆ™æ‰©å±•åçš„ç¬¬ K+1 ä¸ªå±æ€§å€¼ç½®ä¸º 1ã€‚è¿™ç§åšæ³•æ˜¯æœ€ç²¾ç¡®çš„åšæ³•ï¼Œä¿ç•™äº†æ‰€æœ‰çš„ä¿¡æ¯ï¼Œä¹Ÿæœªæ·»åŠ ä»»ä½•é¢å¤–ä¿¡æ¯ï¼Œè‹¥é¢„å¤„ç†æ—¶æŠŠæ‰€æœ‰çš„å˜é‡éƒ½è¿™æ ·å¤„ç†ï¼Œä¼šå¤§å¤§å¢åŠ æ•°æ®çš„ç»´åº¦ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å®Œæ•´ä¿ç•™äº†åŸå§‹æ•°æ®çš„å…¨éƒ¨ä¿¡æ¯ã€ä¸ç”¨è€ƒè™‘ç¼ºå¤±å€¼ï¼›ç¼ºç‚¹æ˜¯è®¡ç®—é‡å¤§å¤§æå‡ï¼Œä¸”åªæœ‰åœ¨æ ·æœ¬é‡éå¸¸å¤§çš„æ—¶å€™æ•ˆæœæ‰å¥½ã€‚å¤šé‡æ’è¡¥å¤šé‡æ’è¡¥è®¤ä¸ºå¾…æ’è¡¥çš„å€¼æ˜¯éšæœºçš„ï¼Œå®è·µä¸Šé€šå¸¸æ˜¯ä¼°è®¡å‡ºå¾…æ’è¡¥çš„å€¼ï¼Œå†åŠ ä¸Šä¸åŒçš„å™ªå£°ï¼Œå½¢æˆå¤šç»„å¯é€‰æ’è¡¥å€¼ï¼Œæ ¹æ®æŸç§é€‰æ‹©ä¾æ®ï¼Œé€‰å–æœ€åˆé€‚çš„æ’è¡¥å€¼ã€‚å‹ç¼©æ„ŸçŸ¥å’ŒçŸ©é˜µè¡¥å…¨å‹ç¼©æ„ŸçŸ¥é€šè¿‡åˆ©ç”¨ä¿¡å·æœ¬èº«æ‰€å…·æœ‰çš„ç¨€ç–æ€§ï¼Œä»éƒ¨åˆ†è§‚æµ‹æ ·æœ¬ä¸­å›å¤åŸä¿¡å·ã€‚å‹ç¼©æ„ŸçŸ¥åˆ†ä¸ºæ„ŸçŸ¥æµ‹é‡å’Œé‡æ„æ¢å¤ä¸¤ä¸ªé˜¶æ®µã€‚æ„ŸçŸ¥æµ‹é‡ï¼šæ­¤é˜¶æ®µå¯¹åŸå§‹ä¿¡å·è¿›è¡Œå¤„ç†ä»¥è·å¾—ç¨€ç–æ ·æœ¬è¡¨ç¤ºã€‚å¸¸ç”¨çš„æ‰‹æ®µæ˜¯å‚…é‡Œå¶å˜æ¢ã€å°æ³¢å˜æ¢ã€å­—å…¸å­¦ä¹ ã€ç¨€ç–ç¼–ç ç­‰é‡æ„æ¢å¤ï¼šæ­¤é˜¶æ®µåŸºäºç¨€ç–æ€§ä»å°‘é‡è§‚æµ‹ä¸­æ¢å¤åŸä¿¡å·ã€‚è¿™æ˜¯å‹ç¼©æ„ŸçŸ¥çš„æ ¸å¿ƒçŸ©é˜µè¡¥å…¨å¯ä»¥æŸ¥çœ‹çŸ¥ä¹ä¸Šçš„é—®é¢˜æ‰‹åŠ¨è¡¥å…¨é™¤äº†æ‰‹åŠ¨è¡¥å…¨æ–¹æ³•ï¼Œå…¶ä»–æ’å€¼è¡¥å…¨æ–¹æ³•åªæ˜¯å°†æœªçŸ¥å€¼è¡¥ä»¥æˆ‘ä»¬çš„ä¸»è§‚ä¼°è®¡å€¼ï¼Œä¸ä¸€å®šå®Œå…¨ç¬¦åˆå®¢è§‚äº‹å®ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæ ¹æ®å¯¹æ‰€åœ¨é¢†åŸŸçš„ç†è§£ï¼Œæ‰‹åŠ¨å¯¹ç¼ºå¤±å€¼è¿›è¡Œæ’è¡¥çš„æ•ˆæœä¼šæ›´å¥½ã€‚ä½†è¿™ç§æ–¹æ³•éœ€è¦å¯¹é—®é¢˜é¢†åŸŸæœ‰å¾ˆé«˜çš„è®¤è¯†å’Œç†è§£ï¼Œè¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¦‚æœç¼ºå¤±æ•°æ®è¾ƒå¤šï¼Œä¼šæ¯”è¾ƒè´¹æ—¶è´¹åŠ›ã€‚æœ€è¿‘é‚»è¡¥å…¨å¯»æ‰¾ä¸è¯¥æ ·æœ¬æœ€æ¥è¿‘çš„æ ·æœ¬ï¼Œä½¿ç”¨å…¶è¯¥å±æ€§æ•°å€¼æ¥è¡¥å…¨ã€‚å¤„ç†å¼‚å¸¸å€¼å¼‚å¸¸å€¼åˆ†ææ˜¯æ£€éªŒæ•°æ®æ˜¯å¦æœ‰å½•å…¥é”™è¯¯ä»¥åŠå«æœ‰ä¸åˆå¸¸ç†çš„æ•°æ®ã€‚å¿½è§†å¼‚å¸¸å€¼çš„å­˜åœ¨æ˜¯ååˆ†å±é™©çš„ï¼Œä¸åŠ å‰”é™¤åœ°æŠŠå¼‚å¸¸å€¼åŒ…æ‹¬è¿›æ•°æ®çš„è®¡ç®—åˆ†æè¿‡ç¨‹ä¸­ï¼Œå¯¹ç»“æœä¼šäº§ç”Ÿä¸è‰¯å½±å“ã€‚å¼‚å¸¸å€¼æ˜¯æŒ‡æ ·æœ¬ä¸­çš„ä¸ªåˆ«å€¼ï¼Œå…¶æ•°å€¼æ˜æ˜¾åç¦»å…¶ä½™çš„è§‚æµ‹å€¼ã€‚å¼‚å¸¸å€¼ä¹Ÿç§°ä¸ºç¦»ç¾¤ç‚¹ï¼Œå¼‚å¸¸å€¼åˆ†æä¹Ÿç§°ä¸ºç¦»ç¾¤ç‚¹åˆ†æã€‚å¼‚å¸¸å€¼æ£€æµ‹ç®€å•ç»Ÿè®¡æ¯”å¦‚åˆ©ç”¨pandasåº“çš„describe()æ–¹æ³•è§‚å¯Ÿæ•°æ®çš„ç»Ÿè®¡æ€§æè¿°ï¼Œæˆ–è€…ç®€å•ä½¿ç”¨æ•£ç‚¹å›¾ä¹Ÿèƒ½è§‚å¯Ÿåˆ°å¼‚å¸¸å€¼çš„å­˜åœ¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š3âˆ‚åŸåˆ™è¿™ä¸ªåŸåˆ™æœ‰ä¸ªæ¡ä»¶ï¼šæ•°æ®éœ€è¦æœä»æ­£æ€åˆ†å¸ƒã€‚åœ¨ 3âˆ‚ åŸåˆ™ä¸‹ï¼Œå¼‚å¸¸å€¼å¦‚è¶…è¿‡ 3 å€æ ‡å‡†å·®ï¼Œé‚£ä¹ˆå¯ä»¥å°†å…¶è§†ä¸ºå¼‚å¸¸å€¼ã€‚æ­£è´Ÿ3âˆ‚ çš„æ¦‚ç‡æ˜¯ 99.7%ï¼Œé‚£ä¹ˆè·ç¦»å¹³å‡å€¼ 3âˆ‚ ä¹‹å¤–çš„å€¼å‡ºç°çš„æ¦‚ç‡ä¸ºP(|x-u| &gt; 3âˆ‚) &lt;= 0.003ï¼Œå±äºæä¸ªåˆ«çš„å°æ¦‚ç‡äº‹ä»¶ã€‚å¦‚æœæ•°æ®ä¸æœä»æ­£æ€åˆ†å¸ƒï¼Œä¹Ÿå¯ä»¥ç”¨è¿œç¦»å¹³å‡å€¼çš„å¤šå°‘å€æ ‡å‡†å·®æ¥æè¿°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šç®±å‹å›¾è¿™ç§æ–¹æ³•æ˜¯åˆ©ç”¨ç®±å‹å›¾çš„å››åˆ†ä½è·ï¼ˆIQRï¼‰å¯¹å¼‚å¸¸å€¼è¿›è¡Œæ£€æµ‹ï¼Œä¹Ÿå«Tukeyâ€˜s testã€‚ç®±å‹å›¾çš„å®šä¹‰å¦‚ä¸‹ï¼šå››åˆ†ä½è·(IQR)å°±æ˜¯ä¸Šå››åˆ†ä½ä¸ä¸‹å››åˆ†ä½çš„å·®å€¼ã€‚è€Œæˆ‘ä»¬é€šè¿‡IQRçš„1.5å€ä¸ºæ ‡å‡†ï¼Œè§„å®šï¼šè¶…è¿‡ä¸Šå››åˆ†ä½+1.5å€IQRè·ç¦»ï¼Œæˆ–è€…ä¸‹å››åˆ†ä½-1.5å€IQRè·ç¦»çš„ç‚¹ä¸ºå¼‚å¸¸å€¼ã€‚ä¸‹é¢æ˜¯Pythonä¸­çš„ä»£ç å®ç°ï¼Œä¸»è¦ä½¿ç”¨äº†numpyçš„percentileæ–¹æ³•ã€‚1234Percentile = np.percentile(df['length'],[0,25,50,75,100])IQR = Percentile[3] - Percentile[1]UpLimit = Percentile[3]+ageIQR*1.5DownLimit = Percentile[1]-ageIQR*1.5ä¹Ÿå¯ä»¥ä½¿ç”¨seabornçš„å¯è§†åŒ–æ–¹æ³•boxplotæ¥å®ç°ï¼š123f,ax=plt.subplots(figsize=(10,8))sns.boxplot(y='length',data=df,ax=ax)plt.show()ä¸Šé¢ä¸‰ç§æ–¹æ³•æ˜¯æ¯”è¾ƒç®€å•çš„å¼‚å¸¸å€¼æ£€æµ‹æ–¹æ³•ï¼Œæ¥ä¸‹æ¥æ˜¯ä¸€äº›è¾ƒå¤æ‚çš„å¼‚å¸¸å€¼æ£€æµ‹æ–¹æ³•ï¼Œå› æ­¤è¿™é‡Œç®€å•ä»‹ç»ä¸‹è¿™äº›æ–¹æ³•çš„åŸºæœ¬æ¦‚å¿µã€‚åŸºäºæ¨¡å‹é¢„æµ‹é¡¾åæ€ä¹‰ï¼Œè¯¥æ–¹æ³•ä¼šæ„å»ºä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒæ¨¡å‹ï¼Œå¹¶è®¡ç®—å¯¹è±¡ç¬¦åˆè¯¥æ¨¡å‹çš„æ¦‚ç‡ï¼Œå°†ä½æ¦‚ç‡çš„å¯¹è±¡è§†ä¸ºå¼‚å¸¸ç‚¹ã€‚å¦‚æœæ¨¡å‹æ˜¯ç°‡çš„ç»„åˆï¼Œåˆ™å¼‚å¸¸ç‚¹æ˜¯ä¸åœ¨ä»»ä½•ç°‡çš„å¯¹è±¡ï¼›å¦‚æœæ¨¡å‹æ˜¯å›å½’ï¼Œå¼‚å¸¸ç‚¹æ˜¯è¿œç¦»é¢„æµ‹å€¼çš„å¯¹è±¡(å°±æ˜¯ç¬¬ä¸€ä¸ªæ–¹æ³•çš„å›¾ç¤ºä¾‹å­)ã€‚ä¼˜ç¼ºç‚¹ï¼šæœ‰åšå®çš„ç»Ÿè®¡å­¦ç†è®ºåŸºç¡€ï¼Œå½“å­˜åœ¨å……åˆ†çš„æ•°æ®å’Œæ‰€ç”¨çš„æ£€éªŒç±»å‹çš„çŸ¥è¯†æ—¶ï¼Œè¿™äº›æ£€éªŒå¯èƒ½éå¸¸æœ‰æ•ˆï¼›å¯¹äºå¤šå…ƒæ•°æ®ï¼Œå¯ç”¨çš„é€‰æ‹©å°‘ä¸€äº›ï¼Œå¹¶ä¸”å¯¹äºé«˜ç»´æ•°æ®ï¼Œè¿™äº›æ£€æµ‹å¯èƒ½æ€§å¾ˆå·®ã€‚åŸºäºè¿‘é‚»åº¦çš„ç¦»ç¾¤ç‚¹æ£€æµ‹ä¸€ä¸ªå¯¹è±¡çš„ç¦»ç¾¤ç‚¹å¾—åˆ†ç”±åˆ°å®ƒçš„ k-æœ€è¿‘é‚»ï¼ˆKNNï¼‰çš„è·ç¦»ç»™å®šã€‚è¿™é‡Œéœ€è¦æ³¨æ„ k å€¼çš„å–å€¼ä¼šå½±å“ç¦»ç¾¤ç‚¹å¾—åˆ†ï¼Œå¦‚æœ k å¤ªå°ï¼Œåˆ™å°‘é‡çš„é‚»è¿‘ç¦»ç¾¤ç‚¹å¯èƒ½ä¼šå¯¼è‡´è¾ƒä½çš„ç¦»ç¾¤ç‚¹å¾—åˆ†ï¼›å¦‚æœ k å¤ªå¤§ï¼Œåˆ™ç‚¹æ•°å°‘äº k çš„ç°‡ä¸­æ‰€æœ‰çš„å¯¹è±¡å¯èƒ½éƒ½æˆäº†ç¦»ç¾¤ç‚¹ã€‚ä¸ºäº†å¢å¼ºé²æ£’æ€§ï¼Œå¯ä»¥é‡‡ç”¨ k ä¸ªæœ€è¿‘é‚»çš„å¹³å‡è·ç¦»ã€‚ä¼˜ç¼ºç‚¹ï¼šç®€å•;åŸºäºé‚»è¿‘åº¦çš„æ–¹æ³•éœ€è¦ O(m2) æ—¶é—´ï¼Œå¤§æ•°æ®é›†ä¸é€‚ç”¨ï¼›k å€¼çš„å–å€¼å¯¼è‡´è¯¥æ–¹æ³•å¯¹å‚æ•°çš„é€‰æ‹©ä¹Ÿæ˜¯æ•æ„Ÿçš„ï¼›ä¸èƒ½å¤„ç†å…·æœ‰ä¸åŒå¯†åº¦åŒºåŸŸçš„æ•°æ®é›†ï¼Œå› ä¸ºå®ƒä½¿ç”¨å…¨å±€é˜ˆå€¼ï¼Œä¸èƒ½è€ƒè™‘è¿™ç§å¯†åº¦çš„å˜åŒ–ã€‚åŸºäºå¯†åº¦çš„ç¦»ç¾¤ç‚¹æ£€æµ‹ä¸€ç§å¸¸ç”¨çš„å®šä¹‰å¯†åº¦çš„æ–¹æ³•æ˜¯ï¼Œå®šä¹‰å¯†åº¦ä¸ºåˆ°kä¸ªæœ€è¿‘é‚»çš„å¹³å‡è·ç¦»çš„å€’æ•°ã€‚å¦‚æœè¯¥è·ç¦»å°ï¼Œåˆ™å¯†åº¦é«˜ï¼Œåä¹‹äº¦ç„¶ã€‚å¦ä¸€ç§å¯†åº¦å®šä¹‰æ˜¯ä½¿ç”¨ DBSCAN èšç±»ç®—æ³•ä½¿ç”¨çš„å¯†åº¦å®šä¹‰ï¼Œå³ä¸€ä¸ªå¯¹è±¡å‘¨å›´çš„å¯†åº¦ç­‰äºè¯¥å¯¹è±¡æŒ‡å®šè·ç¦» d å†…å¯¹è±¡çš„ä¸ªæ•°ã€‚ä¼˜ç¼ºç‚¹ï¼šç»™å‡ºäº†å¯¹è±¡æ˜¯ç¦»ç¾¤ç‚¹çš„å®šé‡åº¦é‡ï¼Œå¹¶ä¸”å³ä½¿æ•°æ®å…·æœ‰ä¸åŒçš„åŒºåŸŸä¹Ÿèƒ½å¤Ÿå¾ˆå¥½çš„å¤„ç†ï¼›ä¸åŸºäºè·ç¦»çš„æ–¹æ³•ä¸€æ ·ï¼Œè¿™äº›æ–¹æ³•å¿…ç„¶å…·æœ‰ O(m2) çš„æ—¶é—´å¤æ‚åº¦ã€‚å¯¹äºä½ç»´æ•°æ®ä½¿ç”¨ç‰¹å®šçš„æ•°æ®ç»“æ„å¯ä»¥è¾¾åˆ° O(mlogm) ï¼›å‚æ•°é€‰æ‹©æ˜¯å›°éš¾çš„ã€‚è™½ç„¶ LOF ç®—æ³•é€šè¿‡è§‚å¯Ÿä¸åŒçš„ k å€¼ï¼Œç„¶åå–å¾—æœ€å¤§ç¦»ç¾¤ç‚¹å¾—åˆ†æ¥å¤„ç†è¯¥é—®é¢˜ï¼Œä½†æ˜¯ï¼Œä»ç„¶éœ€è¦é€‰æ‹©è¿™äº›å€¼çš„ä¸Šä¸‹ç•Œã€‚åŸºäºèšç±»çš„ç¦»ç¾¤ç‚¹æ£€æµ‹ä¸€ä¸ªå¯¹è±¡æ˜¯åŸºäºèšç±»çš„ç¦»ç¾¤ç‚¹ï¼Œå¦‚æœè¯¥å¯¹è±¡ä¸å¼ºå±äºä»»ä½•ç°‡ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å±äºç¦»ç¾¤ç‚¹ã€‚ç¦»ç¾¤ç‚¹å¯¹åˆå§‹èšç±»çš„å½±å“ï¼šå¦‚æœé€šè¿‡èšç±»æ£€æµ‹ç¦»ç¾¤ç‚¹ï¼Œåˆ™ç”±äºç¦»ç¾¤ç‚¹å½±å“èšç±»ï¼Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šç»“æ„æ˜¯å¦æœ‰æ•ˆã€‚è¿™ä¹Ÿæ˜¯ k-means ç®—æ³•çš„ç¼ºç‚¹ï¼Œå¯¹ç¦»ç¾¤ç‚¹æ•æ„Ÿã€‚ä¸ºäº†å¤„ç†è¯¥é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼šå¯¹è±¡èšç±»ï¼Œåˆ é™¤ç¦»ç¾¤ç‚¹ï¼Œå¯¹è±¡å†æ¬¡èšç±»ï¼ˆè¿™ä¸ªä¸èƒ½ä¿è¯äº§ç”Ÿæœ€ä¼˜ç»“æœï¼‰ã€‚ä¼˜ç¼ºç‚¹ï¼šåŸºäºçº¿æ€§å’Œæ¥è¿‘çº¿æ€§å¤æ‚åº¦ï¼ˆkå‡å€¼ï¼‰çš„èšç±»æŠ€æœ¯æ¥å‘ç°ç¦»ç¾¤ç‚¹å¯èƒ½æ˜¯é«˜åº¦æœ‰æ•ˆçš„ï¼›ç°‡çš„å®šä¹‰é€šå¸¸æ˜¯ç¦»ç¾¤ç‚¹çš„è¡¥é›†ï¼Œå› æ­¤å¯èƒ½åŒæ—¶å‘ç°ç°‡å’Œç¦»ç¾¤ç‚¹ï¼›äº§ç”Ÿçš„ç¦»ç¾¤ç‚¹é›†å’Œå®ƒä»¬çš„å¾—åˆ†å¯èƒ½éå¸¸ä¾èµ–æ‰€ç”¨çš„ç°‡çš„ä¸ªæ•°å’Œæ•°æ®ä¸­ç¦»ç¾¤ç‚¹çš„å­˜åœ¨æ€§ï¼›èšç±»ç®—æ³•äº§ç”Ÿçš„ç°‡çš„è´¨é‡å¯¹è¯¥ç®—æ³•äº§ç”Ÿçš„ç¦»ç¾¤ç‚¹çš„è´¨é‡å½±å“éå¸¸å¤§ã€‚ä¸“é—¨çš„ç¦»ç¾¤ç‚¹æ£€æµ‹é™¤äº†ä»¥ä¸ŠæåŠçš„æ–¹æ³•ï¼Œè¿˜æœ‰ä¸¤ä¸ªä¸“é—¨ç”¨äºæ£€æµ‹å¼‚å¸¸ç‚¹çš„æ–¹æ³•æ¯”è¾ƒå¸¸ç”¨ï¼šOne Class SVMå’ŒIsolation Forestå¼‚å¸¸å€¼å¤„ç†åˆ é™¤å«æœ‰å¼‚å¸¸å€¼çš„è®°å½•ï¼šç›´æ¥å°†å«æœ‰å¼‚å¸¸å€¼çš„è®°å½•åˆ é™¤ï¼›è§†ä¸ºç¼ºå¤±å€¼ï¼šå°†å¼‚å¸¸å€¼è§†ä¸ºç¼ºå¤±å€¼ï¼Œåˆ©ç”¨ç¼ºå¤±å€¼å¤„ç†çš„æ–¹æ³•è¿›è¡Œå¤„ç†ï¼›å¹³å‡å€¼ä¿®æ­£ï¼šå¯ç”¨å‰åä¸¤ä¸ªè§‚æµ‹å€¼çš„å¹³å‡å€¼ä¿®æ­£è¯¥å¼‚å¸¸å€¼ï¼›ä¸å¤„ç†ï¼šç›´æ¥åœ¨å…·æœ‰å¼‚å¸¸å€¼çš„æ•°æ®é›†ä¸Šè¿›è¡Œæ•°æ®æŒ–æ˜ï¼›å°†å«æœ‰å¼‚å¸¸å€¼çš„è®°å½•ç›´æ¥åˆ é™¤çš„æ–¹æ³•ç®€å•æ˜“è¡Œï¼Œä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œåœ¨è§‚æµ‹å€¼å¾ˆå°‘çš„æƒ…å†µä¸‹ï¼Œè¿™ç§åˆ é™¤ä¼šé€ æˆæ ·æœ¬é‡ä¸è¶³ï¼Œå¯èƒ½ä¼šæ”¹å˜å˜é‡çš„åŸæœ‰åˆ†å¸ƒï¼Œä»è€Œé€ æˆåˆ†æç»“æœçš„ä¸å‡†ç¡®ã€‚è§†ä¸ºç¼ºå¤±å€¼å¤„ç†çš„å¥½å¤„æ˜¯å¯ä»¥åˆ©ç”¨ç°æœ‰å˜é‡çš„ä¿¡æ¯ï¼Œå¯¹å¼‚å¸¸å€¼ï¼ˆç¼ºå¤±å€¼ï¼‰è¿›è¡Œå¡«è¡¥ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œè¦å…ˆåˆ†æå¼‚å¸¸å€¼å‡ºç°çš„å¯èƒ½åŸå› ï¼Œåœ¨åˆ¤æ–­å¼‚å¸¸å€¼æ˜¯å¦åº”è¯¥èˆå¼ƒï¼Œå¦‚æœæ˜¯æ­£ç¡®çš„æ•°æ®ï¼Œå¯ä»¥ç›´æ¥åœ¨å…·æœ‰å¼‚å¸¸å€¼çš„æ•°æ®é›†ä¸Šè¿›è¡ŒæŒ–æ˜å»ºæ¨¡ã€‚å¤„ç†ç±»åˆ«ä¸å¹³è¡¡é—®é¢˜ä»€ä¹ˆæ˜¯ç±»åˆ«ä¸å¹³è¡¡å‘¢ï¼Ÿå®ƒæ˜¯æŒ‡åˆ†ç±»ä»»åŠ¡ä¸­å­˜åœ¨æŸä¸ªæˆ–è€…æŸäº›ç±»åˆ«çš„æ ·æœ¬æ•°é‡è¿œå¤šäºå…¶ä»–ç±»åˆ«çš„æ ·æœ¬æ•°é‡çš„æƒ…å†µã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªååˆ†ç±»é—®é¢˜ï¼Œæ€»å…±æœ‰ 10000 ä¸ªæ ·æœ¬ï¼Œä½†æ˜¯ç±»åˆ« 1 åˆ° 4 åˆ†åˆ«åŒ…å« 2000 ä¸ªæ ·æœ¬ï¼Œå‰©ä½™ 6 ä¸ªç±»åˆ«çš„æ ·æœ¬æ•°é‡åŠ èµ·æ¥åˆšåˆš 2000 ä¸ªï¼Œå³è¿™å…­ä¸ªç±»åˆ«å„è‡ªåŒ…å«çš„æ ·æœ¬å¹³å‡æ•°é‡å¤§çº¦æ˜¯ 333 ä¸ªï¼Œç›¸æ¯”å‰å››ä¸ªç±»åˆ«æ˜¯ç›¸å·®äº† 6 å€å·¦å³çš„æ•°é‡ã€‚è¿™ç§æƒ…å†µå°±æ˜¯ç±»åˆ«ä¸å¹³è¡¡äº†ã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³ç±»åˆ«ä¸å¹³è¡¡é—®é¢˜å‘¢ï¼Ÿè¿™é‡Œä»‹ç»å…«å¤§è§£å†³åŠæ³•ã€‚æ‰©å……æ•°æ®é›†é¦–å…ˆåº”è¯¥è€ƒè™‘æ•°æ®é›†çš„æ‰©å……ï¼Œåœ¨åˆšåˆšå›¾ç‰‡æ•°æ®é›†æ‰©å……ä¸€èŠ‚ä»‹ç»äº†å¤šç§æ•°æ®æ‰©å……çš„åŠæ³•ï¼Œè€Œä¸”æ•°æ®è¶Šå¤šï¼Œç»™æ¨¡å‹æä¾›çš„ä¿¡æ¯ä¹Ÿè¶Šå¤§ï¼Œæ›´æœ‰åˆ©äºè®­ç»ƒå‡ºä¸€ä¸ªæ€§èƒ½æ›´å¥½çš„æ¨¡å‹ã€‚å¦‚æœåœ¨å¢åŠ å°ç±»æ ·æœ¬æ•°é‡çš„åŒæ—¶ï¼Œåˆå¢åŠ äº†å¤§ç±»æ ·æœ¬æ•°æ®ï¼Œå¯ä»¥è€ƒè™‘æ”¾å¼ƒéƒ¨åˆ†å¤§ç±»æ•°æ®ï¼ˆé€šè¿‡å¯¹å…¶è¿›è¡Œæ¬ é‡‡æ ·æ–¹æ³•ï¼‰ã€‚å°è¯•å…¶ä»–è¯„ä»·æŒ‡æ ‡ä¸€èˆ¬åˆ†ç±»ä»»åŠ¡æœ€å¸¸ä½¿ç”¨çš„è¯„ä»·æŒ‡æ ‡å°±æ˜¯å‡†ç¡®åº¦äº†ï¼Œä½†å®ƒåœ¨ç±»åˆ«ä¸å¹³è¡¡çš„åˆ†ç±»ä»»åŠ¡ä¸­å¹¶ä¸èƒ½åæ˜ å®é™…æƒ…å†µï¼ŒåŸå› å°±æ˜¯å³ä¾¿åˆ†ç±»å™¨å°†æ‰€æœ‰ç±»åˆ«éƒ½åˆ†ä¸ºå¤§ç±»ï¼Œå‡†ç¡®åº¦ä¹Ÿä¸ä¼šå·®ï¼Œå› ä¸ºå¤§ç±»åŒ…å«çš„æ•°é‡è¿œè¿œå¤šäºå°ç±»çš„æ•°é‡ï¼Œæ‰€ä»¥è¿™ä¸ªè¯„ä»·æŒ‡æ ‡ä¼šåå‘äºå¤§ç±»ç±»åˆ«çš„æ•°æ®ã€‚å…¶ä»–å¯ä»¥æ¨èçš„è¯„ä»·æŒ‡æ ‡æœ‰ä»¥ä¸‹å‡ ç§æ··æ·†çŸ©é˜µï¼šå®é™…ä¸Šè¿™ä¸ªä¹Ÿæ˜¯åœ¨åˆ†ç±»ä»»åŠ¡ä¼šé‡‡ç”¨çš„ä¸€ä¸ªæŒ‡æ ‡ï¼Œå¯ä»¥æŸ¥çœ‹åˆ†ç±»å™¨å¯¹æ¯ä¸ªç±»åˆ«é¢„æµ‹çš„æƒ…å†µï¼Œå…¶å¯¹è§’çº¿æ•°å€¼è¡¨ç¤ºé¢„æµ‹æ­£ç¡®çš„æ•°é‡ï¼›ç²¾ç¡®åº¦(Precision)ï¼šè¡¨ç¤ºå®é™…é¢„æµ‹æ­£ç¡®çš„ç»“æœå æ‰€æœ‰è¢«é¢„æµ‹æ­£ç¡®çš„ç»“æœçš„æ¯”ä¾‹ï¼ŒP=TP / (TP+FP)å¬å›ç‡(Recall)ï¼šè¡¨ç¤ºå®é™…é¢„æµ‹æ­£ç¡®çš„ç»“æœå æ‰€æœ‰çœŸæ­£æ­£ç¡®çš„ç»“æœçš„æ¯”ä¾‹ï¼ŒR = TP / (TP+FN)F1 å¾—åˆ†(F1 Score)ï¼šç²¾ç¡®åº¦å’Œå¬å›ç‡çš„åŠ æƒå¹³å‡ï¼ŒF1=2PR / (P+R)Kappa (Cohen kappa)ROC æ›²çº¿(ROC Curves):å¸¸è¢«ç”¨äºè¯„ä»·ä¸€ä¸ªäºŒå€¼åˆ†ç±»å™¨çš„ä¼˜åŠ£ï¼Œè€Œä¸”å¯¹äºæ­£è´Ÿæ ·æœ¬åˆ†å¸ƒå˜åŒ–çš„æ—¶å€™ï¼ŒROC æ›²çº¿å¯ä»¥ä¿æŒä¸å˜ï¼Œå³ä¸å—ç±»åˆ«ä¸å¹³è¡¡çš„å½±å“ã€‚å…¶ä¸­ TPã€FPã€TNã€FN åˆ†åˆ«è¡¨ç¤ºæ­£ç¡®é¢„æµ‹çš„æ­£ç±»ã€é”™è¯¯é¢„æµ‹çš„æ­£ç±»ã€é¢„æµ‹æ­£ç¡®çš„è´Ÿç±»ä»¥åŠé”™è¯¯é¢„æµ‹çš„è´Ÿç±»ã€‚å›¾ä¾‹å¦‚ä¸‹ï¼šå¯¹æ•°æ®é›†è¿›è¡Œé‡é‡‡æ ·å¯ä»¥ä½¿ç”¨ä¸€äº›ç­–ç•¥è¯¥å‡è½»æ•°æ®çš„ä¸å¹³è¡¡ç¨‹åº¦ã€‚è¯¥ç­–ç•¥ä¾¿æ˜¯é‡‡æ ·(sampling)ï¼Œä¸»è¦æœ‰ä¸¤ç§é‡‡æ ·æ–¹æ³•æ¥é™ä½æ•°æ®çš„ä¸å¹³è¡¡æ€§ã€‚å¯¹å°ç±»çš„æ•°æ®æ ·æœ¬è¿›è¡Œé‡‡æ ·æ¥å¢åŠ å°ç±»çš„æ•°æ®æ ·æœ¬ä¸ªæ•°ï¼Œå³è¿‡é‡‡æ ·ï¼ˆover-sampling ï¼Œé‡‡æ ·çš„ä¸ªæ•°å¤§äºè¯¥ç±»æ ·æœ¬çš„ä¸ªæ•°ï¼‰ã€‚å¯¹å¤§ç±»çš„æ•°æ®æ ·æœ¬è¿›è¡Œé‡‡æ ·æ¥å‡å°‘è¯¥ç±»æ•°æ®æ ·æœ¬çš„ä¸ªæ•°ï¼Œå³æ¬ é‡‡æ ·ï¼ˆunder-samplingï¼Œé‡‡æ ·çš„æ¬¡æ•°å°‘äºè¯¥ç±»æ ·æœ¬çš„ä¸ªç´ ï¼‰ã€‚é‡‡æ ·ç®—æ³•å¾€å¾€å¾ˆå®¹æ˜“å®ç°ï¼Œå¹¶ä¸”å…¶è¿è¡Œé€Ÿåº¦å¿«ï¼Œå¹¶ä¸”æ•ˆæœä¹Ÿä¸é”™ã€‚ ä¸€äº›ç»éªŒæ³•åˆ™ï¼šè€ƒè™‘å¯¹å¤§ç±»ä¸‹çš„æ ·æœ¬ï¼ˆè¶…è¿‡ 1 ä¸‡ã€åä¸‡ç”šè‡³æ›´å¤šï¼‰è¿›è¡Œæ¬ é‡‡æ ·ï¼Œå³åˆ é™¤éƒ¨åˆ†æ ·æœ¬ï¼›è€ƒè™‘å¯¹å°ç±»ä¸‹çš„æ ·æœ¬ï¼ˆä¸è¶³ 1ä¸‡ç”šè‡³æ›´å°‘ï¼‰è¿›è¡Œè¿‡é‡‡æ ·ï¼Œå³æ·»åŠ éƒ¨åˆ†æ ·æœ¬çš„å‰¯æœ¬ï¼›è€ƒè™‘å°è¯•éšæœºé‡‡æ ·ä¸ééšæœºé‡‡æ ·ä¸¤ç§é‡‡æ ·æ–¹æ³•ï¼›è€ƒè™‘å¯¹å„ç±»åˆ«å°è¯•ä¸åŒçš„é‡‡æ ·æ¯”ä¾‹ï¼Œæ¯”ä¸€å®šæ˜¯ 1:1ï¼Œæœ‰æ—¶å€™ 1:1 åè€Œä¸å¥½ï¼Œå› ä¸ºä¸ç°å®æƒ…å†µç›¸å·®ç”šè¿œï¼›è€ƒè™‘åŒæ—¶ä½¿ç”¨è¿‡é‡‡æ ·ä¸æ¬ é‡‡æ ·ã€‚å°è¯•äººå·¥ç”Ÿæˆæ•°æ®æ ·æœ¬ä¸€ç§ç®€å•çš„äººå·¥æ ·æœ¬æ•°æ®äº§ç”Ÿçš„æ–¹æ³•ä¾¿æ˜¯ï¼Œå¯¹è¯¥ç±»ä¸‹çš„æ‰€æœ‰æ ·æœ¬æ¯ä¸ªå±æ€§ç‰¹å¾çš„å–å€¼ç©ºé—´ä¸­éšæœºé€‰å–ä¸€ä¸ªç»„æˆæ–°çš„æ ·æœ¬ï¼Œå³å±æ€§å€¼éšæœºé‡‡æ ·ã€‚ä½ å¯ä»¥ä½¿ç”¨åŸºäºç»éªŒå¯¹å±æ€§å€¼è¿›è¡Œéšæœºé‡‡æ ·è€Œæ„é€ æ–°çš„äººå·¥æ ·æœ¬ï¼Œæˆ–è€…ä½¿ç”¨ç±»ä¼¼æœ´ç´ è´å¶æ–¯æ–¹æ³•å‡è®¾å„å±æ€§ä¹‹é—´äº’ç›¸ç‹¬ç«‹è¿›è¡Œé‡‡æ ·ï¼Œè¿™æ ·ä¾¿å¯å¾—åˆ°æ›´å¤šçš„æ•°æ®ï¼Œä½†æ˜¯æ— æ³•ä¿è¯å±æ€§ä¹‹å‰çš„çº¿æ€§å…³ç³»ï¼ˆå¦‚æœæœ¬èº«æ˜¯å­˜åœ¨çš„ï¼‰ã€‚æœ‰ä¸€ä¸ªç³»ç»Ÿçš„æ„é€ äººå·¥æ•°æ®æ ·æœ¬çš„æ–¹æ³• SMOTE(Synthetic Minority Over-sampling Technique)ã€‚SMOTE æ˜¯ä¸€ç§è¿‡é‡‡æ ·ç®—æ³•ï¼Œå®ƒæ„é€ æ–°çš„å°ç±»æ ·æœ¬è€Œä¸æ˜¯äº§ç”Ÿå°ç±»ä¸­å·²æœ‰çš„æ ·æœ¬çš„å‰¯æœ¬ï¼Œå³è¯¥ç®—æ³•æ„é€ çš„æ•°æ®æ˜¯æ–°æ ·æœ¬ï¼ŒåŸæ•°æ®é›†ä¸­ä¸å­˜åœ¨çš„ã€‚å®ƒåŸºäºè·ç¦»åº¦é‡é€‰æ‹©å°ç±»åˆ«ä¸‹ä¸¤ä¸ªæˆ–è€…æ›´å¤šçš„ç›¸ä¼¼æ ·æœ¬ï¼Œç„¶åé€‰æ‹©å…¶ä¸­ä¸€ä¸ªæ ·æœ¬ï¼Œå¹¶éšæœºé€‰æ‹©ä¸€å®šæ•°é‡çš„é‚»å±…æ ·æœ¬ï¼Œç„¶åå¯¹é€‰æ‹©çš„é‚£ä¸ªæ ·æœ¬çš„ä¸€ä¸ªå±æ€§å¢åŠ å™ªå£°ï¼Œæ¯æ¬¡å¤„ç†ä¸€ä¸ªå±æ€§ã€‚è¿™æ ·å°±æ„é€ äº†æ›´å¤šçš„æ–°ç”Ÿæ•°æ®ã€‚python å®ç°çš„ SMOTE ç®—æ³•ä»£ç åœ°å€å¦‚ä¸‹ï¼Œå®ƒæä¾›äº†å¤šç§ä¸åŒå®ç°ç‰ˆæœ¬ï¼Œä»¥åŠå¤šä¸ªé‡é‡‡æ ·ç®—æ³•ã€‚https://github.com/scikit-learn-contrib/imbalanced-learnå°è¯•ä¸åŒåˆ†ç±»ç®—æ³•å¼ºçƒˆå»ºè®®ä¸è¦å¯¹å¾…æ¯ä¸€ä¸ªåˆ†ç±»éƒ½ä½¿ç”¨è‡ªå·±å–œæ¬¢è€Œç†Ÿæ‚‰çš„åˆ†ç±»ç®—æ³•ã€‚åº”è¯¥ä½¿ç”¨ä¸åŒçš„ç®—æ³•å¯¹å…¶è¿›è¡Œæ¯”è¾ƒï¼Œå› ä¸ºä¸åŒçš„ç®—æ³•é€‚ç”¨äºä¸åŒçš„ä»»åŠ¡ä¸æ•°æ®ã€‚å†³ç­–æ ‘å¾€å¾€åœ¨ç±»åˆ«ä¸å‡è¡¡æ•°æ®ä¸Šè¡¨ç°ä¸é”™ã€‚å®ƒä½¿ç”¨åŸºäºç±»å˜é‡çš„åˆ’åˆ†è§„åˆ™å»åˆ›å»ºåˆ†ç±»æ ‘ï¼Œå› æ­¤å¯ä»¥å¼ºåˆ¶åœ°å°†ä¸åŒç±»åˆ«çš„æ ·æœ¬åˆ†å¼€ã€‚ç›®å‰æµè¡Œçš„å†³ç­–æ ‘ç®—æ³•æœ‰ï¼šC4.5ã€C5.0ã€CARTå’ŒRandom Forestç­‰ã€‚å°è¯•å¯¹æ¨¡å‹è¿›è¡Œæƒ©ç½šä½ å¯ä»¥ä½¿ç”¨ç›¸åŒçš„åˆ†ç±»ç®—æ³•ï¼Œä½†ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„è§’åº¦ï¼Œæ¯”å¦‚ä½ çš„åˆ†ç±»ä»»åŠ¡æ˜¯è¯†åˆ«é‚£äº›å°ç±»ï¼Œé‚£ä¹ˆå¯ä»¥å¯¹åˆ†ç±»å™¨çš„å°ç±»æ ·æœ¬æ•°æ®å¢åŠ æƒå€¼ï¼Œé™ä½å¤§ç±»æ ·æœ¬çš„æƒå€¼ï¼ˆè¿™ç§æ–¹æ³•å…¶å®æ˜¯äº§ç”Ÿäº†æ–°çš„æ•°æ®åˆ†å¸ƒï¼Œå³äº§ç”Ÿäº†æ–°çš„æ•°æ®é›†ï¼‰ï¼Œä»è€Œä½¿å¾—åˆ†ç±»å™¨å°†é‡ç‚¹é›†ä¸­åœ¨å°ç±»æ ·æœ¬èº«ä¸Šã€‚ä¸€ä¸ªå…·ä½“åšæ³•å°±æ˜¯ï¼Œåœ¨è®­ç»ƒåˆ†ç±»å™¨æ—¶ï¼Œè‹¥åˆ†ç±»å™¨å°†å°ç±»æ ·æœ¬åˆ†é”™æ—¶é¢å¤–å¢åŠ åˆ†ç±»å™¨ä¸€ä¸ªå°ç±»æ ·æœ¬åˆ†é”™ä»£ä»·ï¼Œè¿™ä¸ªé¢å¤–çš„ä»£ä»·å¯ä»¥ä½¿å¾—åˆ†ç±»å™¨æ›´åŠ â€œå…³å¿ƒâ€å°ç±»æ ·æœ¬ã€‚å¦‚ penalized-SVM å’Œ penalized-LDA ç®—æ³•ã€‚å¦‚æœä½ é”å®šä¸€ä¸ªå…·ä½“çš„ç®—æ³•æ—¶ï¼Œå¹¶ä¸”æ— æ³•é€šè¿‡ä½¿ç”¨é‡é‡‡æ ·æ¥è§£å†³ä¸å‡è¡¡æ€§é—®é¢˜è€Œå¾—åˆ°è¾ƒå·®çš„åˆ†ç±»ç»“æœã€‚è¿™æ ·ä½ ä¾¿å¯ä»¥ä½¿ç”¨æƒ©ç½šæ¨¡å‹æ¥è§£å†³ä¸å¹³è¡¡æ€§é—®é¢˜ã€‚ä½†æ˜¯ï¼Œè®¾ç½®æƒ©ç½šçŸ©é˜µæ˜¯ä¸€ä¸ªå¤æ‚çš„äº‹ï¼Œå› æ­¤ä½ éœ€è¦æ ¹æ®ä½ çš„ä»»åŠ¡å°è¯•ä¸åŒçš„æƒ©ç½šçŸ©é˜µï¼Œå¹¶é€‰å–ä¸€ä¸ªè¾ƒå¥½çš„æƒ©ç½šçŸ©é˜µã€‚å°è¯•ä¸€ä¸ªæ–°çš„è§’åº¦ç†è§£é—®é¢˜ä»ä¸€ä¸ªæ–°çš„è§’åº¦æ¥ç†è§£é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥å°†å°ç±»çš„æ ·æœ¬ä½œä¸ºå¼‚å¸¸ç‚¹ï¼Œé‚£ä¹ˆé—®é¢˜å°±å˜æˆå¼‚å¸¸ç‚¹æ£€æµ‹ä¸å˜åŒ–è¶‹åŠ¿æ£€æµ‹é—®é¢˜ã€‚å¼‚å¸¸ç‚¹æ£€æµ‹ï¼šå³æ˜¯å¯¹é‚£äº›ç½•è§äº‹ä»¶è¿›è¡Œè¯†åˆ«ã€‚å¦‚é€šè¿‡æœºå™¨çš„éƒ¨ä»¶çš„æŒ¯åŠ¨è¯†åˆ«æœºå™¨æ•…éšœï¼Œåˆå¦‚é€šè¿‡ç³»ç»Ÿè°ƒç”¨åºåˆ—è¯†åˆ«æ¶æ„ç¨‹åºã€‚è¿™äº›äº‹ä»¶ç›¸å¯¹äºæ­£å¸¸æƒ…å†µæ˜¯å¾ˆå°‘è§çš„ã€‚å˜åŒ–è¶‹åŠ¿æ£€æµ‹ï¼šç±»ä¼¼äºå¼‚å¸¸ç‚¹æ£€æµ‹ï¼Œä¸åŒåœ¨äºå…¶é€šè¿‡æ£€æµ‹ä¸å¯»å¸¸çš„å˜åŒ–è¶‹åŠ¿æ¥è¯†åˆ«ã€‚å¦‚é€šè¿‡è§‚å¯Ÿç”¨æˆ·æ¨¡å¼æˆ–é“¶è¡Œäº¤æ˜“æ¥æ£€æµ‹ç”¨æˆ·è¡Œä¸ºçš„ä¸å¯»å¸¸æ”¹å˜ã€‚å°†å°ç±»æ ·æœ¬ä½œä¸ºå¼‚å¸¸ç‚¹è¿™ç§æ€ç»´çš„è½¬å˜ï¼Œå¯ä»¥å¸®åŠ©è€ƒè™‘æ–°çš„æ–¹æ³•å»åˆ†ç¦»æˆ–åˆ†ç±»æ ·æœ¬ã€‚è¿™ä¸¤ç§æ–¹æ³•ä»ä¸åŒçš„è§’åº¦å»æ€è€ƒï¼Œè®©ä½ å°è¯•æ–°çš„æ–¹æ³•å»è§£å†³é—®é¢˜ã€‚å°è¯•åˆ›æ–°ä»”ç»†å¯¹é—®é¢˜è¿›è¡Œåˆ†æå’ŒæŒ–æ˜ï¼Œæ˜¯å¦å¯ä»¥å°†é—®é¢˜åˆ’åˆ†ä¸ºå¤šä¸ªæ›´å°çš„é—®é¢˜ï¼Œå¯ä»¥å°è¯•å¦‚ä¸‹æ–¹æ³•ï¼šå°†ä½ çš„å¤§ç±»å‹ç¼©æˆå°ç±»ï¼›ä½¿ç”¨ One Class åˆ†ç±»å™¨ï¼ˆå°†å°ç±»ä½œä¸ºå¼‚å¸¸ç‚¹ï¼‰ï¼›ä½¿ç”¨é›†æˆæ–¹å¼ï¼Œè®­ç»ƒå¤šä¸ªåˆ†ç±»å™¨ï¼Œç„¶åè”åˆè¿™äº›åˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»ï¼›å¯¹äºç±»åˆ«ä¸å¹³è¡¡é—®é¢˜ï¼Œè¿˜æ˜¯éœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼Œå¦‚æœæœ‰å…ˆéªŒçŸ¥è¯†å¯ä»¥å¿«é€ŸæŒ‘é€‰åˆé€‚çš„æ–¹æ³•æ¥è§£å†³ï¼Œå¦åˆ™æœ€å¥½å°±æ˜¯é€ä¸€æµ‹è¯•æ¯ä¸€ç§æ–¹æ³•ï¼Œç„¶åæŒ‘é€‰æœ€å¥½çš„ç®—æ³•ã€‚æœ€é‡è¦çš„è¿˜æ˜¯å¤šåšé¡¹ç›®ï¼Œå¤šç§¯ç´¯ç»éªŒï¼Œè¿™æ ·é‡åˆ°ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œä¹Ÿå¯ä»¥å¿«é€Ÿæ‰¾åˆ°åˆé€‚çš„è§£å†³æ–¹æ³•ã€‚ä»¥ä¸Šé’ˆå¯¹å¼‚å¸¸å€¼ï¼Œç¼ºå¤±æ•°æ®ï¼Œåˆ†ç±»ä¸å‡é—®é¢˜åšäº†è¯¦ç»†çš„æè¿°ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œå°±è¦è½¬åŒ–æ•°æ®ï¼Œä½¿ä¹‹æˆä¸ºæœ‰æ•ˆçš„ç‰¹å¾ã€‚å¸¸ç”¨çš„æ–¹æ³•æ˜¯æ ‡å‡†åŒ–ï¼Œå½’ä¸€åŒ–ï¼Œç‰¹å¾çš„ç¦»æ•£åŒ–ç­‰ã€‚æ— é‡çº²åŒ–é‡çº²ï¼šå°±æ˜¯å•ä½ï¼Œç‰¹å¾çš„å•ä½ä¸ä¸€è‡´ï¼Œç‰¹å¾å°±ä¸èƒ½æ”¾åœ¨ä¸€èµ·æ¯”è¾ƒã€‚æ— é‡çº²åŒ–ä½¿ä¸åŒè§„æ ¼çš„æ•°æ®è½¬æ¢åˆ°åŒä¸€è§„æ ¼ã€‚å¸¸è§çš„æ— é‡çº²åŒ–æ–¹æ³•æœ‰æ ‡å‡†åŒ–å’ŒåŒºé—´ç¼©æ”¾æ³•ã€‚æ ‡å‡†åŒ–çš„å‰ææ˜¯ç‰¹å¾å€¼æœä»æ­£æ€åˆ†å¸ƒï¼Œæ ‡å‡†åŒ–åï¼Œå…¶è½¬æ¢æˆæ ‡å‡†æ­£æ€åˆ†å¸ƒã€‚åŒºé—´ç¼©æ”¾æ³•åˆ©ç”¨äº†è¾¹ç•Œå€¼ä¿¡æ¯ï¼Œå°†ç‰¹å¾çš„å–å€¼åŒºé—´ç¼©æ”¾åˆ°æŸä¸ªç‰¹ç‚¹çš„èŒƒå›´ï¼Œä¾‹å¦‚[0, 1]ç­‰ã€‚æ ‡å‡†åŒ–æ¯”æ–¹è¯´æœ‰ä¸€äº›æ•°å­—çš„å•ä½æ˜¯åƒå…‹ï¼Œæœ‰ä¸€äº›æ•°å­—çš„å•ä½æ˜¯å…‹ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦ç»Ÿä¸€å•ä½ã€‚å¦‚æœæ²¡æœ‰æ ‡å‡†åŒ–ï¼Œä¸¤ä¸ªå˜é‡æ··åœ¨ä¸€èµ·æï¼Œé‚£ä¹ˆè‚¯å®šå°±ä¼šä¸åˆé€‚ã€‚0-1æ ‡å‡†åŒ–æ˜¯å¯¹åŸå§‹æ•°æ®è¿›è¡Œçº¿æ€§å˜æ¢ï¼Œå°†ç‰¹å¾å€¼æ˜ å°„æˆåŒºé—´ä¸ºï¼»0ï¼Œ1ï¼½çš„æ ‡å‡†å€¼ä¸­ï¼šZæ ‡å‡†åŒ–åŸºäºç‰¹å¾å€¼çš„å‡å€¼ï¼ˆmeanï¼‰å’Œæ ‡å‡†å·®ï¼ˆstandard deviationï¼‰è¿›è¡Œæ•°æ®çš„æ ‡å‡†åŒ–ã€‚å®ƒçš„è®¡ç®—å…¬å¼ä¸ºï¼šæ ‡å‡†åŒ–çš„ä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718import pandasdata = pandas.read_csv('è·¯å¾„.csv')#ï¼ˆä¸€ï¼‰Min-Max æ ‡å‡†åŒ–from sklearn.preprocessing import MinMaxScaler#åˆå§‹åŒ–ä¸€ä¸ªscalerå¯¹è±¡scaler = MinMaxScaler()#è°ƒç”¨scalerçš„fit_transformæ–¹æ³•ï¼ŒæŠŠæˆ‘ä»¬è¦å¤„ç†çš„åˆ—ä½œä¸ºå‚æ•°ä¼ è¿›å»data['æ ‡å‡†åŒ–åçš„Aåˆ—æ•°æ®'] = scaler.fit_transform(data['Aåˆ—æ•°æ®'])data['æ ‡å‡†åŒ–åçš„Båˆ—æ•°æ®'] = scaler.fit_transform(data['Båˆ—æ•°æ®'])#ï¼ˆäºŒï¼‰Z-Scoreæ ‡å‡†åŒ– ï¼ˆå¯åœ¨scaleä¸­ç›´æ¥å®ç°ï¼‰from sklearn.preprocessing import scaledata['æ ‡å‡†åŒ–åçš„Aåˆ—æ•°æ®'] = scale(data['Aåˆ—æ•°æ®'])data['æ ‡å‡†åŒ–åçš„Båˆ—æ•°æ®'] = scale(data['Båˆ—æ•°æ®'])åŒºé—´ç¼©æ”¾æ³•åŒºé—´ç¼©æ”¾æ³•çš„æ€è·¯æœ‰å¤šç§ï¼Œå¸¸è§çš„ä¸€ç§ä¸ºåˆ©ç”¨ä¸¤ä¸ªæœ€å€¼è¿›è¡Œç¼©æ”¾ï¼Œå…¬å¼è¡¨è¾¾ä¸ºï¼šä½¿ç”¨preproccessingåº“çš„MinMaxScalerç±»å¯¹æ•°æ®è¿›è¡ŒåŒºé—´ç¼©æ”¾çš„ä»£ç å¦‚ä¸‹ï¼š1234from sklearn.preprocessing import MinMaxScaler#åŒºé—´ç¼©æ”¾ï¼Œè¿”å›å€¼ä¸ºç¼©æ”¾åˆ°[0, 1]åŒºé—´çš„æ•°æ®MinMaxScaler().fit_transform(iris.data)å½’ä¸€åŒ–å½’ä¸€åŒ–æ˜¯å› ä¸ºåœ¨ç‰¹å¾ä¼šåœ¨ä¸åŒçš„å°ºåº¦ä¸‹æœ‰ä¸åŒçš„è¡¨ç°å½¢å¼ï¼Œå½’ä¸€åŒ–ä¼šä½¿å¾—å„ä¸ªç‰¹å¾èƒ½å¤ŸåŒæ—¶ä»¥æ°å½“çš„æ–¹å¼è¡¨ç°ã€‚æ¯”æ–¹è¯´æŸä¸ªä¸“è¾‘çš„ç‚¹å‡»æ’­æ”¾ç‡ä¸€èˆ¬ä¸ä¼šè¶…è¿‡0.2ï¼Œä½†æ˜¯ä¸“è¾‘çš„æ’­æ”¾æ¬¡æ•°å¯èƒ½ä¼šè¾¾åˆ°å‡ åƒæ¬¡ï¼Œæ‰€ä»¥è¯´ä¸ºäº†èƒ½å¤Ÿåœ¨æ¨¡å‹é‡Œé¢å¾—åˆ°æ›´åˆé€‚ç»“æœï¼Œéœ€è¦å…ˆæŠŠä¸€äº›ç‰¹å¾åœ¨å°ºåº¦ä¸Šè¿›è¡Œå½’ä¸€åŒ–ï¼Œç„¶åè¿›è¡Œæ¨¡å‹è®­ç»ƒã€‚ä¸æ ‡å‡†åŒ–çš„åŒºåˆ«ï¼Œç®€å•æ¥è¯´ï¼Œæ ‡å‡†åŒ–æ˜¯ä¾ç…§ç‰¹å¾çŸ©é˜µçš„åˆ—å¤„ç†æ•°æ®ï¼Œå…¶é€šè¿‡æ±‚z-scoreçš„æ–¹æ³•ï¼Œå°†æ ·æœ¬çš„ç‰¹å¾å€¼è½¬æ¢åˆ°åŒä¸€é‡çº²ä¸‹ã€‚å½’ä¸€åŒ–æ˜¯ä¾ç…§ç‰¹å¾çŸ©é˜µçš„è¡Œå¤„ç†æ•°æ®ï¼Œå…¶ç›®çš„åœ¨äºæ ·æœ¬å‘é‡åœ¨ç‚¹ä¹˜è¿ç®—æˆ–å…¶ä»–æ ¸å‡½æ•°è®¡ç®—ç›¸ä¼¼æ€§æ—¶ï¼Œæ‹¥æœ‰ç»Ÿä¸€çš„æ ‡å‡†ï¼Œä¹Ÿå°±æ˜¯è¯´éƒ½è½¬åŒ–ä¸ºâ€œå•ä½å‘é‡â€ã€‚è§„åˆ™ä¸ºl2çš„å½’ä¸€åŒ–å…¬å¼å¦‚ä¸‹ï¼šä½¿ç”¨preproccessingåº“çš„Normalizerç±»å¯¹æ•°æ®è¿›è¡Œå½’ä¸€åŒ–çš„ä»£ç å¦‚ä¸‹ï¼š12345from sklearn.preprocessing import Normalizerscaler = Normalizer()#å½’ä¸€åŒ–å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªåˆ—ï¼Œæ‰€ä»¥[0]ç¬¬ä¸€ä¸ªè¿›è¡Œèµ‹å€¼data['å½’ä¸€åŒ–åçš„Aåˆ—æ•°æ®'] = scaler.fit_transform(data['Aåˆ—æ•°æ®'])[0]data['å½’ä¸€åŒ–åçš„Båˆ—æ•°æ®'] = scaler.fit_transform(data['Båˆ—æ•°æ®'])[0]å¯¹å®šé‡ç‰¹å¾äºŒå€¼åŒ–å®šé‡ç‰¹å¾äºŒå€¼åŒ–çš„æ ¸å¿ƒåœ¨äºè®¾å®šä¸€ä¸ªé˜ˆå€¼ï¼Œå¤§äºé˜ˆå€¼çš„èµ‹å€¼ä¸º1ï¼Œå°äºç­‰äºé˜ˆå€¼çš„èµ‹å€¼ä¸º0ï¼Œå…¬å¼è¡¨è¾¾å¦‚ä¸‹ï¼šä½¿ç”¨preproccessingåº“çš„Binarizerç±»å¯¹æ•°æ®è¿›è¡ŒäºŒå€¼åŒ–çš„ä»£ç å¦‚ä¸‹ï¼š1234from sklearn.preprocessing import Binarizer#äºŒå€¼åŒ–ï¼Œé˜ˆå€¼è®¾ç½®ä¸º3ï¼Œè¿”å›å€¼ä¸ºäºŒå€¼åŒ–åçš„æ•°æ®Binarizer(threshold=3).fit_transform(iris.data)ç‰¹å¾çš„ç¦»æ•£åŒ–åœ¨è¿›è¡Œå»ºæ¨¡æ—¶ï¼Œå˜é‡ä¸­ç»å¸¸ä¼šæœ‰ä¸€äº›å˜é‡ä¸ºç¦»æ•£å‹å˜é‡ï¼Œä¾‹å¦‚æ€§åˆ«ã€‚è¿™äº›å˜é‡æˆ‘ä»¬ä¸€èˆ¬æ— æ³•ç›´æ¥æ”¾åˆ°æ¨¡å‹ä¸­å»è®­ç»ƒæ¨¡å‹ã€‚å› æ­¤åœ¨ä½¿ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šå¯¹æ­¤ç±»å˜é‡è¿›è¡Œå¤„ç†ã€‚ä¸€èˆ¬æ˜¯å¯¹ç¦»æ•£å˜é‡è¿›è¡Œone-hotç¼–ç ã€‚ä¸‹é¢å…·ä½“ä»‹ç»é€šè¿‡pythonå¯¹ç¦»æ•£å˜é‡è¿›è¡Œone-hotçš„æ–¹æ³•ã€‚ç¦»æ•£åŒ–æ˜¯æŠŠè¿ç»­å‹çš„æ•°å€¼å‹ç‰¹å¾åˆ†æ®µï¼Œæ¯ä¸€æ®µå†…çš„æ•°æ®éƒ½å¯ä»¥å½“åšæˆä¸€ä¸ªæ–°çš„ç‰¹å¾ã€‚å…·ä½“åˆå¯åˆ†ä¸ºç­‰æ­¥é•¿æ–¹å¼ç¦»æ•£åŒ–å’Œç­‰é¢‘ç‡çš„æ–¹å¼ç¦»æ•£åŒ–ï¼Œç­‰æ­¥é•¿çš„æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œç­‰é¢‘ç‡çš„æ–¹å¼æ›´åŠ ç²¾å‡†ï¼Œä¼šè·Ÿæ•°æ®åˆ†å¸ƒæœ‰å¾ˆå¤§çš„å…³ç³»ã€‚ ä»£ç å±‚é¢ï¼Œå¯ä»¥ç”¨pandasä¸­çš„cutæ–¹æ³•è¿›è¡Œåˆ‡åˆ†ã€‚æ€»ä¹‹ï¼Œç¦»æ•£åŒ–çš„ç‰¹å¾èƒ½å¤Ÿæé«˜æ¨¡å‹çš„è¿è¡Œé€Ÿåº¦ä»¥åŠå‡†ç¡®ç‡ã€‚æ¯”æ–¹è¯´å¹´é¾„ç‰¹å¾æ˜¯ä¸€ä¸ªè¿ç»­çš„ç‰¹å¾ï¼Œä½†æ˜¯æŠŠå¹´é¾„å±‚åˆ†æˆ5ï¼18å²ï¼ˆä¸­å°å­¦ç”Ÿï¼‰ï¼Œ19ï¼23å²ï¼ˆå¤§å­¦ç”Ÿï¼‰ï¼Œ24ï¼29å²ï¼ˆå·¥ä½œå‰å‡ å¹´ï¼‰ï¼Œ30ï¼40å²ï¼ˆæˆå®¶ç«‹ä¸šï¼‰ï¼Œ40ï¼60å²ï¼ˆä¸­å¹´äººï¼‰ä»æŸäº›å±‚é¢æ¥è¯´æ¯”è¿ç»­çš„å¹´é¾„æ•°æ®ï¼ˆæ¯”å¦‚è¯´æŸäººå¹´é¾„æ˜¯20å²1æœˆ3æ—¥ä¹‹ç±»çš„ï¼‰æ›´å®¹æ˜“ç†è§£ä¸åŒå¹´é¾„å±‚äººçš„ç‰¹æ€§ã€‚å…¸å‹çš„ç¦»æ•£åŒ–æ­¥éª¤ï¼šå¯¹ç‰¹å¾åšæ’åºï¼&gt; é€‰æ‹©åˆé€‚çš„åˆ†å‰²ç‚¹ï¼&gt; ä½œå‡ºåŒºé—´çš„åˆ†å‰² ï¼&gt; ä½œå‡ºåŒºé—´åˆ†å‰²ï¼&gt; æŸ¥çœ‹æ˜¯å¦èƒ½å¤Ÿè¾¾åˆ°åœæ­¢æ¡ä»¶ã€‚åˆ†æ¡¶1.ç¦»æ•£åŒ–çš„å¸¸ç”¨æ–¹æ³•æ˜¯åˆ†æ¡¶ï¼š2.åˆ†æ¡¶çš„æ•°é‡å’Œè¾¹ç•Œé€šå¸¸éœ€è¦äººå·¥æŒ‡å®šã€‚ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•ï¼šæ ¹æ®ä¸šåŠ¡é¢†åŸŸçš„ç»éªŒæ¥æŒ‡å®šã€‚å¦‚ï¼šå¯¹å¹´æ”¶å…¥è¿›è¡Œåˆ†æ¡¶æ—¶ï¼Œæ ¹æ® 2017 å¹´å…¨å›½å±…æ°‘äººå‡å¯æ”¯é…æ”¶å…¥çº¦ä¸º 2.6 ä¸‡å…ƒï¼Œå¯ä»¥é€‰æ‹©æ¡¶çš„æ•°é‡ä¸º5ã€‚å…¶ä¸­ï¼šæ”¶å…¥å°äº 1.3 ä¸‡å…ƒï¼ˆäººå‡çš„ 0.5 å€ï¼‰ï¼Œåˆ™ä¸ºåˆ†æ¡¶ 0 ã€‚å¹´æ”¶å…¥åœ¨ 1.3 ä¸‡å…ƒ ï½5.2 ä¸‡å…ƒï¼ˆäººå‡çš„ 0.5ï½2 å€ï¼‰ï¼Œåˆ™ä¸ºåˆ†æ¡¶ 1 ã€‚å¹´æ”¶å…¥åœ¨ 5.3 ä¸‡å…ƒï½26 ä¸‡å…ƒï¼ˆäººå‡çš„ 2 å€ï½10 å€ï¼‰ï¼Œåˆ™ä¸ºåˆ†æ¡¶ 2 ã€‚å¹´æ”¶å…¥åœ¨ 26 ä¸‡å…ƒï½260 ä¸‡å…ƒï¼ˆäººå‡çš„ 10 å€ï½100 å€ï¼‰ï¼Œåˆ™ä¸ºåˆ†æ¡¶ 3 ã€‚å¹´æ”¶å…¥è¶…è¿‡ 260 ä¸‡å…ƒï¼Œåˆ™ä¸ºåˆ†æ¡¶ 4 ã€‚æ ¹æ®æ¨¡å‹æŒ‡å®šã€‚æ ¹æ®å…·ä½“ä»»åŠ¡æ¥è®­ç»ƒåˆ†æ¡¶ä¹‹åçš„æ•°æ®é›†ï¼Œé€šè¿‡è¶…å‚æ•°æœç´¢æ¥ç¡®å®šæœ€ä¼˜çš„åˆ†æ¡¶æ•°é‡å’Œåˆ†æ¡¶è¾¹ç•Œã€‚3.é€‰æ‹©åˆ†æ¡¶å¤§å°æ—¶ï¼Œæœ‰ä¸€äº›ç»éªŒæŒ‡å¯¼ï¼šåˆ†æ¡¶å¤§å°å¿…é¡»è¶³å¤Ÿå°ï¼Œä½¿å¾—æ¡¶å†…çš„å±æ€§å–å€¼å˜åŒ–å¯¹æ ·æœ¬æ ‡è®°çš„å½±å“åŸºæœ¬åœ¨ä¸€ä¸ªä¸å¤§çš„èŒƒå›´ã€‚å³ä¸èƒ½å‡ºç°è¿™æ ·çš„æƒ…å†µï¼šå•ä¸ªåˆ†æ¡¶çš„å†…éƒ¨ï¼Œæ ·æœ¬æ ‡è®°è¾“å‡ºå˜åŒ–å¾ˆå¤§ã€‚åˆ†æ¡¶å¤§å°å¿…é¡»è¶³å¤Ÿå¤§ï¼Œä½¿æ¯ä¸ªæ¡¶å†…éƒ½æœ‰è¶³å¤Ÿçš„æ ·æœ¬ã€‚å¦‚æœæ¡¶å†…æ ·æœ¬å¤ªå°‘ï¼Œåˆ™éšæœºæ€§å¤ªå¤§ï¼Œä¸å…·æœ‰ç»Ÿè®¡æ„ä¹‰ä¸Šçš„è¯´æœåŠ›ã€‚æ¯ä¸ªæ¡¶å†…çš„æ ·æœ¬å°½é‡åˆ†å¸ƒå‡åŒ€ã€‚ç¦»æ•£ç‰¹å¾çš„ä¸¤ç§æ•°æ®ç±»å‹ç¦»æ•£ç‰¹å¾çš„å–å€¼ä¹‹é—´æœ‰å¤§å°çš„æ„ä¹‰ï¼šä¾‹å¦‚ï¼šå°ºå¯¸ï¼ˆLã€XLã€XXLï¼‰ç¦»æ•£ç‰¹å¾çš„å–å€¼ä¹‹é—´æ²¡æœ‰å¤§å°çš„æ„ä¹‰ï¼šä¾‹å¦‚ï¼šé¢œè‰²ï¼ˆRedã€Blueã€Greenï¼‰ç¦»æ•£ç‰¹å¾å€¼æœ‰å¤§å°æ„ä¹‰çš„è™šæ‹Ÿå˜é‡å¤„ç†ç¦»æ•£ç‰¹å¾çš„å–å€¼ä¹‹é—´æœ‰å¤§å°æ„ä¹‰çš„å¤„ç†å‡½æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠå¤§å°å€¼ä»¥å­—å…¸çš„æ–¹å¼ï¼Œä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥å³å¯ï¼›(1) dictæ˜ å°„çš„å­—å…¸pandas.Series.map(dict)ç¦»æ•£ç‰¹å¾å€¼æ²¡æœ‰å¤§å°æ„ä¹‰çš„è™šæ‹Ÿå˜é‡å¤„ç†ç¦»æ•£ç‰¹å¾çš„å–å€¼ä¹‹é—´æ²¡æœ‰å¤§å°æ„ä¹‰çš„å¤„ç†æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨get_dummiesæ–¹æ³•å¤„ç†ï¼Œå®ƒæœ‰6ä¸ªå¸¸ç”¨çš„å‚æ•°(1) data è¦å¤„ç†çš„DataFrame(2) prefix åˆ—åçš„å‰ç¼€ï¼Œåœ¨å¤šä¸ªåˆ—æœ‰ç›¸åŒçš„ç¦»æ•£é¡¹æ—¶å€™ä½¿ç”¨(3) prefix_sep å‰ç¼€å’Œç¦»æ•£å€¼çš„åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºä¸‹åˆ’çº¿ï¼Œé»˜è®¤å³å¯(4) dummy_na æ˜¯å¦æŠŠNAå€¼ï¼Œä½œä¸ºä¸€ä¸ªç¦»æ•£å€¼è¿›è¡Œå¤„ç†ï¼Œé»˜è®¤ä¸å¤„ç†(5) columns è¦å¤„ç†çš„åˆ—åï¼Œå¦‚æœä¸æŒ‡å®šè¯¥åˆ—ï¼Œé‚£ä¹ˆé»˜è®¤å¤„ç†æ‰€æœ‰åˆ—(6) drop_first æ˜¯å¦ä»å¤‡é€‰é¡¹ä¸­åˆ ç¬¬ä¸€ä¸ªï¼Œå»ºæ¨¡çš„æ—¶å€™ä¸ºé¿å…å…±çº¿æ€§ä½¿ç”¨pandas.getdummies(data,prefix=None,prefix_sep=â€™â€˜,dummy_na=False,columns=None,drop_first=False)ä¸¾ä¾‹ï¼š123456import pandas#æœ‰äº›æœ‹å‹ä¹Ÿå¯èƒ½æ˜¯encoding='utf8'æˆ–å…¶ä»–data=pandas.read_csv('file:///Users/apple/Desktop/jacky_1.csv',encoding='GBK')print(data)å…¶å®ï¼Œè™šæ‹Ÿå˜é‡çš„å®è´¨å°±æ˜¯è¦æŠŠç¦»æ•£å‹çš„æ•°æ®è½¬åŒ–ä¸ºè¿ç»­å‹çš„æ•°æ®ï¼Œå› ä¸ºç¬¬1åˆ—å¹´é¾„å·²ç»æ˜¯è¿ç»­å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸éœ€è¦å¤„ç†äº†ã€‚æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å¤„ç†å­¦å†å’Œæ€§åˆ«ï¼Ÿå› ä¸ºä¸åŒå­¦å†ä¹‹é—´æ˜¯æœ‰é«˜ä½ä¹‹åˆ†çš„ï¼Œå› æ­¤æˆ‘ä»¬è¦ä½¿ç”¨Mapæ–¹æ³•æ¥å¤„ç†è¿™ç§ç±»å‹çš„ç¦»æ•£å‹æ•°æ®ï¼›ç¬¬1æ­¥ï¼š é¦–å…ˆæˆ‘ä»¬è¦å¤„ç†ä¸åŒå­¦å†ä¹‹é—´çš„å¤§å°å€¼æˆ‘ä»¬ä½¿ç”¨drop_duplicatesæ–¹æ³•ï¼Œæ¥çœ‹çœ‹æ•°æ®åˆ—éƒ½æœ‰å“ªäº›å­¦å†12#æŸ¥çœ‹å­¦å†å»é‡ä¹‹åçš„æƒ…å†µdata['å­¦å†'].drop_duplicates()ç¬¬2æ­¥ï¼šç†è§£æ•°æ®å€¼èƒŒåçš„æ„ä¹‰ï¼Œä½œå‡ºæˆ‘ä»¬è‡ªå·±çš„è§£æï¼Œå¯¹æ¯ä¸ªå­¦å†è¿›è¡Œè¯„åˆ†#æ„å»ºå­¦å†å­—å…¸123educationLevelDict=&#123;'åšå£«':4,'ç¡•å£«':3,'å¤§å­¦':2,'å¤§ä¸“':1&#125;#è°ƒç”¨Mapæ–¹æ³•è¿›è¡Œè™šæ‹Ÿå˜é‡çš„è½¬æ¢data['Education Level Map']=data['Education Level'].map(educationLevelDict)ç¬¬3æ­¥ å¯¹äºæ€§åˆ«è¿™ç§æ²¡æœ‰å¤§å°æ¯”è¾ƒçš„ç¦»æ•£å˜é‡ï¼Œæˆ‘ä»¬ä½¿ç”¨get_dummiesæ–¹æ³•ï¼Œæ¥è¿›è¡Œè°ƒç”¨å¤„ç†å³å¯ï¼›1234567dummies=pandas.get_dummies(data,columns=['æ€§åˆ«'],prefix=['æ€§åˆ«'],prefix_sep='_',dummy_na=False,drop_first=False)sklearn å¤„ç†ç¦»æ•£å˜é‡preprocessing.LabelEncoderï¼šç”¨äºæ ‡ç­¾ï¼Œå°†åˆ†ç±»è½¬æ¢ä¸ºåˆ†ç±»æ•°å€¼ ä¸€èˆ¬å°±æ˜¯ä¸€ç»´çš„preprocessing.OrdinalEncoder ï¼šç‰¹å¾ä¸“ç”¨ï¼Œè¦æ±‚è‡³å°‘ä¸ºäºŒç»´çŸ©é˜µpreprocessing.OneHotEncoderè™½ç„¶ä¸Šé¢å·²ç»å°†æ–‡å­—ç±»å‹è½¬æ¢æˆäº†æ•°å€¼ç±»å‹ï¼Œä½†æ˜¯è€ƒè™‘ä¸‹èˆ±é—¨è¿™ç‰¹å¾Embarkedï¼ˆS,C,Qï¼‰ï¼Œè¡¨ç¤ºæˆäº†[0,1,2]è¿™æ ·åˆé€‚å—?è¿™ä¸‰ä¸ªæ•°å­—åœ¨ç®—æ³•çœ‹æ¥ï¼Œæ˜¯è¿ç»­ä¸”å¯ä»¥è®¡ç®—çš„ï¼Œè¿™ä¸‰ä¸ªæ•°å­—ç›¸äº’ä¸ç­‰ï¼Œæœ‰å¤§å°ï¼Œå¹¶ä¸”æœ‰ç€å¯ä»¥ç›¸åŠ ç›¸ä¹˜çš„è”ç³»ã€‚æ‰€ä»¥ç®—æ³•ä¼šæŠŠèˆ±é—¨ï¼Œå­¦å†è¿™æ ·çš„åˆ†ç±»ç‰¹å¾ï¼Œéƒ½è¯¯ä¼šæˆæ˜¯ä½“é‡è¿™æ ·çš„åˆ†ç±»ç‰¹å¾ã€‚è¿™æ˜¯è¯´ï¼Œæˆ‘ä»¬æŠŠåˆ†ç±»è½¬æ¢æˆæ•°å­—çš„æ—¶å€™ï¼Œå¿½ç•¥äº†æ•°å­—ä¸­è‡ªå¸¦çš„æ•°å­¦æ€§è´¨ï¼Œæ‰€ä»¥ç»™ç®—æ³•ä¼ è¾¾äº†ä¸€äº›ä¸å‡†ç¡®çš„ä¿¡æ¯ï¼Œè€Œè¿™ä¼šå½±å“æˆ‘ä»¬çš„å»ºæ¨¡ã€‚ç±»åˆ«OrdinalEncoderå¯ä»¥ç”¨æ¥å¤„ç†æœ‰åºå˜é‡ï¼Œä½†å¯¹äºåä¹‰å˜é‡ï¼Œæˆ‘ä»¬åªæœ‰ä½¿ç”¨å“‘å˜é‡çš„æ–¹å¼æ¥å¤„ç†ï¼Œæ‰èƒ½å¤Ÿå°½é‡å‘ç®—æ³•ä¼ è¾¾æœ€å‡†ç¡®çš„ä¿¡æ¯ï¼š1234567#ç‹¬çƒ­ç¼–ç  åˆ›å»ºå“‘å˜é‡from sklearn.preprocessing import OneHotEncoderdata_ = data.copy()encoder=OneHotEncoder()encoder.fit(data_.iloc[:,1:-1])res=encoder.transform(data_.iloc[:,1:-1]).toarray()#è¿™é‡Œè¦è½¬æ¢æˆæ•°ç»„ï¼Œå¦åˆ™å¾—åˆ°çš„æ˜¯ä¸€ä¸ªå¯¹è±¡resscikit DictVectorizer çƒ­ç¼–ç ï¼ˆåªå¤„ç†ç±»åˆ«å‹å˜é‡ï¼‰123456789101112# æ•°æ®é¢„å¤„ç†df.transpose().to_dict().values()feature = df.iloc[:, :-1]feature# çƒ­ç¼–ç from sklearn.feature_extraction import DictVectorizerdvec = DictVectorizer(sparse=False)X = dvec.fit_transform(feature.transpose().to_dict().values())pd.DataFrame(X, columns=dvec.get_feature_names())å“‘ç¼–ç æˆ‘ä»¬é’ˆå¯¹ç±»åˆ«å‹çš„ç‰¹å¾ï¼Œé€šå¸¸é‡‡ç”¨å“‘ç¼–ç ï¼ˆOne_Hot Encodinï¼‰çš„æ–¹å¼ã€‚æ‰€è°“çš„å“‘ç¼–ç ï¼Œç›´è§‚çš„è®²å°±æ˜¯ç”¨Nä¸ªç»´åº¦æ¥å¯¹Nä¸ªç±»åˆ«è¿›è¡Œç¼–ç ï¼Œå¹¶ä¸”å¯¹äºæ¯ä¸ªç±»åˆ«ï¼Œåªæœ‰ä¸€ä¸ªç»´åº¦æœ‰æ•ˆï¼Œè®°ä½œæ•°å­—1 ï¼›å…¶å®ƒç»´åº¦å‡è®°ä½œæ•°å­—0ã€‚ä½†æœ‰æ—¶ä½¿ç”¨å“‘ç¼–ç çš„æ–¹å¼ï¼Œå¯èƒ½ä¼šé€ æˆç»´åº¦çš„ç¾éš¾ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬åœ¨åšå“‘ç¼–ç ä¹‹å‰ï¼Œä¼šå…ˆå¯¹ç‰¹å¾è¿›è¡ŒHashå¤„ç†ï¼ŒæŠŠæ¯ä¸ªç»´åº¦çš„ç‰¹å¾ç¼–ç æˆè¯å‘é‡ã€‚ä»¥ä¸Šä¸ºå¤§å®¶ä»‹ç»äº†å‡ ç§è¾ƒä¸ºå¸¸è§ã€é€šç”¨çš„æ•°æ®é¢„å¤„ç†æ–¹å¼ï¼Œä½†åªæ˜¯æµ©å¤§ç‰¹å¾å·¥ç¨‹ä¸­çš„å†°å±±ä¸€è§’ã€‚å¾€å¾€å¾ˆå¤šç‰¹å¾å·¥ç¨‹çš„æ–¹æ³•éœ€è¦æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä¸æ–­å»æ€»ç»“ç§¯ç´¯æ¯”å¦‚ï¼šé’ˆå¯¹ç¼ºå¤±å€¼çš„å¤„ç†ï¼Œåœ¨ä¸åŒçš„æ•°æ®é›†ä¸­ï¼Œç”¨å‡å€¼å¡«å……ã€ä¸­ä½æ•°å¡«å……ã€å‰åå€¼å¡«å……çš„æ•ˆæœæ˜¯ä¸ä¸€æ ·çš„ï¼›å¯¹äºç±»åˆ«å‹çš„å˜é‡ï¼Œæœ‰æ—¶æˆ‘ä»¬ä¸éœ€è¦å¯¹å…¨éƒ¨çš„æ•°æ®éƒ½è¿›è¡Œå“‘ç¼–ç å¤„ç†ï¼›å¯¹äºæ—¶é—´å‹çš„å˜é‡æœ‰æ—¶æˆ‘ä»¬æœ‰æ—¶ä¼šæŠŠå®ƒå½“ä½œæ˜¯ç¦»æ•£å€¼ï¼Œæœ‰æ—¶ä¼šå½“æˆè¿ç»­å€¼å¤„ç†ç­‰ã€‚æ‰€ä»¥å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¦æ ¹æ®å®é™…é—®é¢˜ï¼Œè¿›è¡Œä¸åŒçš„æ•°æ®é¢„å¤„ç†ã€‚å‚è€ƒï¼šhttps://mp.weixin.qq.com/s/BnTXjzHSb5-4s0O0WuZYlg","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"ç‰¹å¾å·¥ç¨‹","slug":"ç‰¹å¾å·¥ç¨‹","permalink":"cpeixin.cn/tags/%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/"}]},{"title":"æ•°æ®åˆ†æ-ç‰¹å¾æå–","slug":"æ•°æ®åˆ†æ-ç‰¹å¾æå–","date":"2018-07-07T14:07:12.000Z","updated":"2020-05-01T14:17:20.871Z","comments":true,"path":"2018/07/07/æ•°æ®åˆ†æ-ç‰¹å¾æå–/","link":"","permalink":"cpeixin.cn/2018/07/07/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96/","excerpt":"","text":"ç‰¹å¾å·¥ç¨‹å½“æ•°æ®é¢„å¤„ç†å®Œæˆåï¼Œæˆ‘ä»¬å°±è¦å¼€å§‹è¿›è¡Œç‰¹å¾å·¥ç¨‹äº†ã€‚ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼šç‰¹å¾æå–ç‰¹å¾åˆ›é€ ç‰¹å¾é€‰æ‹©ç‰¹å¾æå–å’Œç‰¹å¾é€‰æ‹©çš„åŒºåˆ«ç‰¹å¾æå–ä¸ç‰¹å¾é€‰æ‹©éƒ½æ˜¯ä¸ºäº†ä»åŸå§‹ç‰¹å¾ä¸­æ‰¾å‡ºæœ€æœ‰æ•ˆçš„ç‰¹å¾ã€‚å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯ç‰¹å¾æå–å¼ºè°ƒé€šè¿‡ç‰¹å¾è½¬æ¢çš„æ–¹å¼å¾—åˆ°ä¸€ç»„å…·æœ‰æ˜æ˜¾ç‰©ç†æˆ–ç»Ÿè®¡æ„ä¹‰çš„ç‰¹å¾ï¼›è€Œç‰¹å¾é€‰æ‹©æ˜¯ä»ç‰¹å¾é›†åˆä¸­æŒ‘é€‰ä¸€ç»„å…·æœ‰æ˜æ˜¾ç‰©ç†æˆ–ç»Ÿè®¡æ„ä¹‰çš„ç‰¹å¾å­é›†ã€‚ä¸¤è€…éƒ½èƒ½å¸®åŠ©å‡å°‘ç‰¹å¾çš„ç»´åº¦ã€æ•°æ®å†—ä½™ï¼Œç‰¹å¾æå–æœ‰æ—¶èƒ½å‘ç°æ›´æœ‰æ„ä¹‰çš„ç‰¹å¾å±æ€§ï¼Œç‰¹å¾é€‰æ‹©çš„è¿‡ç¨‹ç»å¸¸èƒ½è¡¨ç¤ºå‡ºæ¯ä¸ªç‰¹å¾çš„é‡è¦æ€§å¯¹äºæ¨¡å‹æ„å»ºçš„é‡è¦æ€§ã€‚ç‰¹å¾åˆ†ç±»ä¸‹å›¾å°±æ˜¯å°†æˆ‘ä»¬æ‰€èƒ½é‡åˆ°çš„ç‰¹å¾æ•°æ®è¿›è¡Œä¸€ä¸ªåˆ†ç±»ï¼šé¦–å…ˆæ˜¯åŸºæœ¬ç‰¹å¾ï¼Œè€Œåç»Ÿè®¡å’Œå¤æ‚ç‰¹å¾å±‚å±‚é€’è¿›ã€‚å…¶ä¸­é’ˆå¯¹å›¾åƒè¯­éŸ³ç­‰æŠ½æç‰¹å¾æœ‰ä¸“ç”¨çš„çŸ¥è¯†æ–¹æ³•æŒæ¡äº†è¿™å¥—ç‰¹å¾è®¾è®¡çš„æ€è·¯ï¼Œåœ¨å¤æ‚æ•°æ®ä¸Šå‡ ä¹å¯ä»¥è®¾è®¡å‡ºæ— ç©·æ— å°½çš„ç‰¹å¾ã€‚è€Œæ€ä¹ˆåœ¨æœ€çŸ­çš„æ—¶é—´å†…ï¼ŒæŠŠæ•°æ®ä¸­æœ€æœ‰ä»·å€¼çš„ç‰¹å¾æç‚¼å‡ºæ¥ï¼Œå°±è¦è€ƒéªŒæ•°æ®æŒ–æ˜å·¥ç¨‹å¸ˆçš„åŠŸåº•ã€‚ç‰¹å¾æå–ç‰¹å¾æŠ½å–æˆ–è€…ç‰¹å¾æå–å¤§æ¦‚å¯ä»¥åˆ†ä¸ºï¼›å­—å…¸ç‰¹å¾æŠ½å–ï¼Œåº”ç”¨DiceVectorizerå®ç°å¯¹ç±»åˆ«ç‰¹å¾è¿›è¡Œæ•°å€¼åŒ–ã€ç¦»æ•£åŒ–æ–‡æœ¬ç‰¹å¾æŠ½å–ï¼Œåº”ç”¨CounterVertorize/TfIdfVectorizeå®ç°å¯¹æ–‡æœ¬ç‰¹å¾æ•°å€¼åŒ–å›¾åƒç‰¹å¾æŠ½å–(æ·±åº¦å­¦ä¹ )å¯¹äºä»¥ä¸Šä¸åŒç±»åˆ«æ•°æ®çš„ç‰¹å¾æå–ï¼Œè¿™é‡Œä¸ä¸€ä¸€ä»‹ç»ï¼Œç­‰ä»¥åé‡åˆ°äº†å¯¹åº”é—®é¢˜ï¼Œå†è¯¦ç»†çš„ä¸¾ä¾‹ç”¨å“ªäº›ç›¸åº”çš„ç®—æ³•æ¥å¤„ç†ã€‚ç‰¹å¾æå–ä¹Ÿå¯ä»¥è¯´æ˜¯å°†ä»»æ„æ•°æ®ï¼ˆæ–‡æœ¬æˆ–è€…å›¾åƒï¼‰è½¬åŒ–æˆé€‚ç”¨äºæœºå™¨å­¦ä¹ çš„æ•°å­—ç‰¹å¾åº”ç”¨ sklearn.feature_extractionå¯ä»¥è½»æ¾å®Œæˆä¸Šè¿°ä»»åŠ¡","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"ç‰¹å¾å·¥ç¨‹","slug":"ç‰¹å¾å·¥ç¨‹","permalink":"cpeixin.cn/tags/%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/"}]},{"title":"æ•°æ®åˆ†æ-æ•°æ®è½¬æ¢","slug":"æ•°æ®åˆ†æ-æ•°æ®è½¬æ¢","date":"2018-07-06T15:26:15.000Z","updated":"2020-05-01T14:17:29.058Z","comments":true,"path":"2018/07/06/æ•°æ®åˆ†æ-æ•°æ®è½¬æ¢/","link":"","permalink":"cpeixin.cn/2018/07/06/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2/","excerpt":"","text":"æ•°æ®å˜æ¢ã€‚å¦‚æœä¸€ä¸ªäººåœ¨ç™¾åˆ†åˆ¶çš„è€ƒè¯•ä¸­å¾—äº† 95 åˆ†ï¼Œä½ è‚¯å®šä¼šè®¤ä¸ºä»–å­¦ä¹ æˆç»©å¾ˆå¥½ï¼Œå¦‚æœå¾—äº† 65 åˆ†ï¼Œå°±ä¼šè§‰å¾—ä»–æˆç»©ä¸å¥½ã€‚å¦‚æœå¾—äº† 80 åˆ†å‘¢ï¼Ÿä½ ä¼šè§‰å¾—ä»–æˆç»©ä¸­ç­‰ï¼Œå› ä¸ºåœ¨ç­çº§é‡Œè¿™å±äºå¤§éƒ¨åˆ†äººçš„æƒ…å†µã€‚ä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„è®¤çŸ¥å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä»å°åˆ°å¤§çš„è€ƒè¯•æˆç»©åŸºæœ¬ä¸Šéƒ½ä¼šæ»¡è¶³æ­£æ€åˆ†å¸ƒçš„æƒ…å†µã€‚ä»€ä¹ˆæ˜¯æ­£æ€åˆ†å¸ƒå‘¢ï¼Ÿæ­£æ€åˆ†å¸ƒä¹Ÿå«ä½œå¸¸æ€åˆ†å¸ƒï¼Œå°±æ˜¯æ­£å¸¸çš„çŠ¶æ€ä¸‹ï¼Œå‘ˆç°çš„åˆ†å¸ƒæƒ…å†µã€‚æ¯”å¦‚ä½ å¯èƒ½ä¼šé—®ç­é‡Œçš„è€ƒè¯•æˆç»©æ˜¯æ€æ ·çš„ï¼Ÿè¿™é‡Œå…¶å®æŒ‡çš„æ˜¯å¤§éƒ¨åˆ†åŒå­¦çš„æˆç»©å¦‚ä½•ã€‚ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼Œåœ¨æ­£æ€åˆ†å¸ƒä¸­ï¼Œå¤§éƒ¨åˆ†äººçš„æˆç»©ä¼šé›†ä¸­åœ¨ä¸­é—´çš„åŒºåŸŸï¼Œå°‘éƒ¨åˆ†äººå¤„äºä¸¤å¤´çš„ä½ç½®ã€‚æ­£æ€åˆ†å¸ƒçš„å¦ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼Œå¦‚æœä½ çŸ¥é“äº†è‡ªå·±çš„æˆç»©ï¼Œå’Œæ•´ä½“çš„æ­£æ€åˆ†å¸ƒæƒ…å†µï¼Œå°±å¯ä»¥çŸ¥é“è‡ªå·±çš„æˆç»©åœ¨å…¨ç­ä¸­çš„ä½ç½®ã€‚å¦ä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯ï¼Œç¾å›½ SAT è€ƒè¯•æˆç»©ä¹Ÿç¬¦åˆæ­£æ€åˆ†å¸ƒã€‚è€Œä¸”ç¾å›½æœ¬ç§‘çš„ç”³è¯·ï¼Œéœ€è¦ä¸­å›½é«˜ä¸­ç”Ÿçš„ GPA åœ¨ 80 åˆ†ä»¥ä¸Šï¼ˆç™¾åˆ†åˆ¶çš„æˆç»©ï¼‰ï¼ŒèƒŒåçš„ç†ç”±ä¹Ÿæ˜¯é»˜è®¤è€ƒè¯•æˆç»©å±äºæ­£æ€åˆ†å¸ƒçš„æƒ…å†µã€‚ä¸ºäº†è®©æˆç»©ç¬¦åˆæ­£æ€åˆ†å¸ƒï¼Œå‡ºé¢˜è€å¸ˆæ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿä»–ä»¬é€šå¸¸å¯ä»¥æŠŠè€ƒé¢˜åˆ†æˆä¸‰ç±»ï¼šç¬¬ä¸€ç±»ï¼šåŸºç¡€é¢˜ï¼Œå æ€»åˆ† 70%ï¼ŒåŸºæœ¬ä¸Šå±äºé€åˆ†é¢˜ï¼›ç¬¬äºŒç±»ï¼šçµæ´»é¢˜ï¼ŒåŸºç¡€èŒƒå›´å†… + ä¸€å®šçš„çµæ´»æ€§ï¼Œå  20%ï¼›ç¬¬ä¸‰ç±»ï¼šéš¾é¢˜ï¼Œæ¶‰åŠçŸ¥è¯†é¢è¾ƒå¹¿çš„éš¾é¢˜ï¼Œå  10%ï¼›é‚£ä¹ˆï¼Œä½ æƒ³ä¸‹ï¼Œå¦‚æœä¸€ä¸ªå‡ºé¢˜è€å¸ˆæ²¡æœ‰æŒ‰ç…§ä¸Šé¢çš„æ ‡å‡†æ¥å‡ºé¢˜ï¼Œè€Œæ˜¯å°†ç¬¬ä¸‰ç±»éš¾é¢˜æ¯”é‡å åˆ°äº† 70%ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„â€œè¶…çº²â€ï¼Œç»“æœä¼šæ˜¯æ€æ ·å‘¢ï¼Ÿä½ ä¼šå‘ç°ï¼Œå¤§éƒ¨åˆ†äººæˆç»©éƒ½â€œä¸åŠæ ¼â€ï¼Œæœ€ååœ¨å¤§å®¶æ¿€çƒˆçš„è®¨è®ºå£°ä¸­ï¼Œè€å¸ˆä¼šå°†è€ƒè¯•æˆç»©åšè§„èŒƒåŒ–å¤„ç†ï¼Œä»è€Œè®©æˆç»©æ»¡è¶³æ­£æ€åˆ†å¸ƒçš„æƒ…å†µã€‚å› ä¸ºåªæœ‰è¿™æ ·ï¼Œæˆç»©æ‰æ›´å…·æœ‰æ¯”è¾ƒæ€§ã€‚æ‰€ä»¥æ­£æ€åˆ†å¸ƒçš„æˆç»©ï¼Œä¸ä»…å¯ä»¥è®©ä½ äº†è§£å…¨ç­æ•´ä½“çš„æƒ…å†µï¼Œè¿˜èƒ½äº†è§£æ¯ä¸ªäººçš„æˆç»©åœ¨å…¨ç­ä¸­çš„ä½ç½®ã€‚æ•°æ®å˜æ¢åœ¨æ•°æ®åˆ†æä¸­çš„è§’è‰²æˆ‘ä»¬å†æ¥ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ A è€ƒäº† 80 åˆ†ï¼ŒB ä¹Ÿè€ƒäº† 80 åˆ†ï¼Œä½†å‰è€…æ˜¯ç™¾åˆ†åˆ¶ï¼Œåè€… 500 åˆ†æ˜¯æ»¡åˆ†ï¼Œå¦‚æœæˆ‘ä»¬æŠŠä»è¿™ä¸¤ä¸ªæ¸ é“æ”¶é›†ä¸Šæ¥çš„æ•°æ®è¿›è¡Œé›†æˆã€æŒ–æ˜ï¼Œå°±ç®—ä½¿ç”¨æ•ˆç‡å†é«˜çš„ç®—æ³•ï¼Œç»“æœä¹Ÿä¸æ˜¯æ­£ç¡®çš„ã€‚å› ä¸ºè¿™ä¸¤ä¸ªæ¸ é“çš„åˆ†æ•°ä»£è¡¨çš„å«ä¹‰å®Œå…¨ä¸åŒã€‚æ‰€ä»¥è¯´ï¼Œæœ‰æ—¶å€™æ•°æ®å˜æ¢æ¯”ç®—æ³•é€‰æ‹©æ›´é‡è¦ï¼Œæ•°æ®é”™äº†ï¼Œç®—æ³•å†æ­£ç¡®ä¹Ÿæ˜¯é”™çš„ã€‚ä½ ç°åœ¨å¯ä»¥ç†è§£ä¸ºä»€ä¹ˆ 80% çš„å·¥ä½œæ—¶é—´ä¼šèŠ±åœ¨å‰æœŸçš„æ•°æ®å‡†å¤‡ä¸Šäº†å§ã€‚é‚£ä¹ˆå¦‚ä½•è®©ä¸åŒæ¸ é“çš„æ•°æ®ç»Ÿä¸€åˆ°ä¸€ä¸ªç›®æ ‡æ•°æ®åº“é‡Œå‘¢ï¼Ÿè¿™æ ·å°±ç”¨åˆ°äº†æ•°æ®å˜æ¢ã€‚åœ¨æ•°æ®å˜æ¢å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯¹å­—æ®µè¿›è¡Œç­›é€‰ï¼Œç„¶åå¯¹æ•°æ®è¿›è¡Œæ¢ç´¢å’Œç›¸å…³æ€§åˆ†æï¼Œæ¥ç€æ˜¯é€‰æ‹©ç®—æ³•æ¨¡å‹ï¼ˆè¿™é‡Œæš‚æ—¶ä¸éœ€è¦è¿›è¡Œæ¨¡å‹è®¡ç®—ï¼‰ï¼Œç„¶åé’ˆå¯¹ç®—æ³•æ¨¡å‹å¯¹æ•°æ®çš„éœ€æ±‚è¿›è¡Œæ•°æ®å˜æ¢ï¼Œä»è€Œå®Œæˆæ•°æ®æŒ–æ˜å‰çš„å‡†å¤‡å·¥ä½œã€‚æ‰€ä»¥ä½ ä»æ•´ä¸ªæµç¨‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ•°æ®å˜æ¢æ˜¯æ•°æ®å‡†å¤‡çš„é‡è¦ç¯èŠ‚ï¼Œå®ƒé€šè¿‡æ•°æ®å¹³æ»‘ã€æ•°æ®èšé›†ã€æ•°æ®æ¦‚åŒ–å’Œè§„èŒƒåŒ–ç­‰æ–¹å¼å°†æ•°æ®è½¬æ¢æˆé€‚ç”¨äºæ•°æ®æŒ–æ˜çš„å½¢å¼ã€‚æˆ‘æ¥ä»‹ç»ä¸‹è¿™äº›å¸¸è§çš„å˜æ¢æ–¹æ³•ï¼šæ•°æ®å¹³æ»‘ï¼šå»é™¤æ•°æ®ä¸­çš„å™ªå£°ï¼Œå°†è¿ç»­æ•°æ®ç¦»æ•£åŒ–ã€‚è¿™é‡Œå¯ä»¥é‡‡ç”¨åˆ†ç®±ã€èšç±»å’Œå›å½’çš„æ–¹å¼è¿›è¡Œæ•°æ®å¹³æ»‘ï¼Œæˆ‘ä¼šåœ¨åé¢ç»™ä½ è®²è§£èšç±»å’Œå›å½’è¿™ä¸¤ä¸ªç®—æ³•ï¼›æ•°æ®èšé›†ï¼šå¯¹æ•°æ®è¿›è¡Œæ±‡æ€»ï¼Œåœ¨ SQL ä¸­æœ‰ä¸€äº›èšé›†å‡½æ•°å¯ä»¥ä¾›æˆ‘ä»¬æ“ä½œï¼Œæ¯”å¦‚ Max() åé¦ˆæŸä¸ªå­—æ®µçš„æ•°å€¼æœ€å¤§å€¼ï¼ŒSum() è¿”å›æŸä¸ªå­—æ®µçš„æ•°å€¼æ€»å’Œï¼›æ•°æ®æ¦‚åŒ–ï¼šå°†æ•°æ®ç”±è¾ƒä½çš„æ¦‚å¿µæŠ½è±¡æˆä¸ºè¾ƒé«˜çš„æ¦‚å¿µï¼Œå‡å°‘æ•°æ®å¤æ‚åº¦ï¼Œå³ç”¨æ›´é«˜çš„æ¦‚å¿µæ›¿ä»£æ›´ä½çš„æ¦‚å¿µã€‚æ¯”å¦‚è¯´ä¸Šæµ·ã€æ­å·ã€æ·±åœ³ã€åŒ—äº¬å¯ä»¥æ¦‚åŒ–ä¸ºä¸­å›½ã€‚æ•°æ®è§„èŒƒåŒ–ï¼šä½¿å±æ€§æ•°æ®æŒ‰æ¯”ä¾‹ç¼©æ”¾ï¼Œè¿™æ ·å°±å°†åŸæ¥çš„æ•°å€¼æ˜ å°„åˆ°ä¸€ä¸ªæ–°çš„ç‰¹å®šåŒºåŸŸä¸­ã€‚å¸¸ç”¨çš„æ–¹æ³•æœ‰æœ€å°â€”æœ€å¤§è§„èŒƒåŒ–ã€Zâ€”score è§„èŒƒåŒ–ã€æŒ‰å°æ•°å®šæ ‡è§„èŒƒåŒ–ç­‰ï¼Œæˆ‘ä¼šåœ¨åé¢ç»™ä½ è®²åˆ°è¿™äº›æ–¹æ³•çš„ä½¿ç”¨ï¼›å±æ€§æ„é€ ï¼šæ„é€ å‡ºæ–°çš„å±æ€§å¹¶æ·»åŠ åˆ°å±æ€§é›†ä¸­ã€‚è¿™é‡Œä¼šç”¨åˆ°ç‰¹å¾å·¥ç¨‹çš„çŸ¥è¯†ï¼Œå› ä¸ºé€šè¿‡å±æ€§ä¸å±æ€§çš„è¿æ¥æ„é€ æ–°çš„å±æ€§ï¼Œå…¶å®å°±æ˜¯ç‰¹å¾å·¥ç¨‹ã€‚æ¯”å¦‚è¯´ï¼Œæ•°æ®è¡¨ä¸­ç»Ÿè®¡æ¯ä¸ªäººçš„è‹±è¯­ã€è¯­æ–‡å’Œæ•°å­¦æˆç»©ï¼Œä½ å¯ä»¥æ„é€ ä¸€ä¸ªâ€œæ€»å’Œâ€è¿™ä¸ªå±æ€§ï¼Œæ¥ä½œä¸ºæ–°å±æ€§ã€‚è¿™æ ·â€œæ€»å’Œâ€è¿™ä¸ªå±æ€§å°±å¯ä»¥ç”¨åˆ°åç»­çš„æ•°æ®æŒ–æ˜è®¡ç®—ä¸­ã€‚åœ¨è¿™äº›å˜æ¢æ–¹æ³•ä¸­ï¼Œæœ€ç®€å•æ˜“ç”¨çš„å°±æ˜¯å¯¹æ•°æ®è¿›è¡Œè§„èŒƒåŒ–å¤„ç†ã€‚ä¸‹é¢æˆ‘æ¥ç»™ä½ è®²ä¸‹å¦‚ä½•å¯¹æ•°æ®è¿›è¡Œè§„èŒƒåŒ–å¤„ç†ã€‚æ•°æ®è§„èŒƒåŒ–çš„å‡ ç§æ–¹æ³•Min-max è§„èŒƒåŒ–Min-max è§„èŒƒåŒ–æ–¹æ³•æ˜¯å°†åŸå§‹æ•°æ®å˜æ¢åˆ°[0,1]çš„ç©ºé—´ä¸­ã€‚ç”¨å…¬å¼è¡¨ç¤ºå°±æ˜¯ï¼šæ–°æ•°å€¼ =ï¼ˆåŸæ•°å€¼ - æå°å€¼ï¼‰/ï¼ˆæå¤§å€¼ - æå°å€¼ï¼‰ã€‚Z-Score è§„èŒƒåŒ–å‡è®¾ A ä¸ B çš„è€ƒè¯•æˆç»©éƒ½ä¸º 80 åˆ†ï¼ŒA çš„è€ƒå·æ»¡åˆ†æ˜¯ 100 åˆ†ï¼ˆåŠæ ¼ 60 åˆ†ï¼‰ï¼ŒB çš„è€ƒå·æ»¡åˆ†æ˜¯ 500 åˆ†ï¼ˆåŠæ ¼ 300 åˆ†ï¼‰ã€‚è™½ç„¶ä¸¤ä¸ªäººéƒ½è€ƒäº† 80 åˆ†ï¼Œä½†æ˜¯ A çš„ 80 åˆ†ä¸ B çš„ 80 åˆ†ä»£è¡¨å®Œå…¨ä¸åŒçš„å«ä¹‰ã€‚é‚£ä¹ˆå¦‚ä½•ç”¨ç›¸åŒçš„æ ‡å‡†æ¥æ¯”è¾ƒ A ä¸ B çš„æˆç»©å‘¢ï¼ŸZ-Score å°±æ˜¯ç”¨æ¥å¯ä»¥è§£å†³è¿™ä¸€é—®é¢˜çš„ã€‚æˆ‘ä»¬å®šä¹‰ï¼šæ–°æ•°å€¼ =ï¼ˆåŸæ•°å€¼ - å‡å€¼ï¼‰/ æ ‡å‡†å·®ã€‚å‡è®¾ A æ‰€åœ¨çš„ç­çº§å¹³å‡åˆ†ä¸º 80ï¼Œæ ‡å‡†å·®ä¸º 10ã€‚B æ‰€åœ¨çš„ç­çº§å¹³å‡åˆ†ä¸º 400ï¼Œæ ‡å‡†å·®ä¸º 100ã€‚é‚£ä¹ˆ A çš„æ–°æ•°å€¼ =(80-80)/10=0ï¼ŒB çš„æ–°æ•°å€¼ =(80-400)/100=-3.2ã€‚é‚£ä¹ˆåœ¨ Z-Score æ ‡å‡†ä¸‹ï¼ŒA çš„æˆç»©ä¼šæ¯” B çš„æˆç»©å¥½ã€‚æˆ‘ä»¬èƒ½çœ‹åˆ° Z-Score çš„ä¼˜ç‚¹æ˜¯ç®—æ³•ç®€å•ï¼Œä¸å—æ•°æ®é‡çº§å½±å“ï¼Œç»“æœæ˜“äºæ¯”è¾ƒã€‚ä¸è¶³åœ¨äºï¼Œå®ƒéœ€è¦æ•°æ®æ•´ä½“çš„å¹³å‡å€¼å’Œæ–¹å·®ï¼Œè€Œä¸”ç»“æœæ²¡æœ‰å®é™…æ„ä¹‰ï¼Œåªæ˜¯ç”¨äºæ¯”è¾ƒã€‚å°æ•°å®šæ ‡è§„èŒƒåŒ–å°æ•°å®šæ ‡è§„èŒƒåŒ–å°±æ˜¯é€šè¿‡ç§»åŠ¨å°æ•°ç‚¹çš„ä½ç½®æ¥è¿›è¡Œè§„èŒƒåŒ–ã€‚å°æ•°ç‚¹ç§»åŠ¨å¤šå°‘ä½å–å†³äºå±æ€§ A çš„å–å€¼ä¸­çš„æœ€å¤§ç»å¯¹å€¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚å±æ€§ A çš„å–å€¼èŒƒå›´æ˜¯ -999 åˆ° 88ï¼Œé‚£ä¹ˆæœ€å¤§ç»å¯¹å€¼ä¸º 999ï¼Œå°æ•°ç‚¹å°±ä¼šç§»åŠ¨ 3 ä½ï¼Œå³æ–°æ•°å€¼ = åŸæ•°å€¼ /1000ã€‚é‚£ä¹ˆ A çš„å–å€¼èŒƒå›´å°±è¢«è§„èŒƒåŒ–ä¸º -0.999 åˆ° 0.088ã€‚ä¸Šé¢è¿™ä¸‰ç§æ˜¯æ•°å€¼è§„èŒƒåŒ–ä¸­å¸¸ç”¨çš„å‡ ç§æ–¹å¼ã€‚Pythonçš„SciKit-Learnåº“ä½¿ç”¨SciKit-Learn æ˜¯ Python çš„é‡è¦æœºå™¨å­¦ä¹ åº“ï¼Œå®ƒå¸®æˆ‘ä»¬å°è£…äº†å¤§é‡çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œæ¯”å¦‚åˆ†ç±»ã€èšç±»ã€å›å½’ã€é™ç»´ç­‰ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜åŒ…æ‹¬äº†æ•°æ®å˜æ¢æ¨¡å—ã€‚æˆ‘ç°åœ¨æ¥è®²ä¸‹å¦‚ä½•ä½¿ç”¨ SciKit-Learn è¿›è¡Œæ•°æ®è§„èŒƒåŒ–ã€‚Min-max è§„èŒƒåŒ–æˆ‘ä»¬å¯ä»¥è®©åŸå§‹æ•°æ®æŠ•å°„åˆ°æŒ‡å®šçš„ç©ºé—´[min, max]ï¼Œåœ¨ SciKit-Learn é‡Œæœ‰ä¸ªå‡½æ•° MinMaxScaler æ˜¯ä¸“é—¨åšè¿™ä¸ªçš„ï¼Œå®ƒå…è®¸æˆ‘ä»¬ç»™å®šä¸€ä¸ªæœ€å¤§å€¼ä¸æœ€å°å€¼ï¼Œç„¶åå°†åŸæ•°æ®æŠ•å°„åˆ°[min, max]ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹[min,max]æ˜¯[0,1]ï¼Œä¹Ÿå°±æ˜¯æŠŠåŸå§‹æ•°æ®æŠ•æ”¾åˆ°[0,1]èŒƒå›´å†…ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š123456789101112# coding:utf-8from sklearn import preprocessingimport numpy as np# åˆå§‹åŒ–æ•°æ®ï¼Œæ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªæ ·æœ¬ï¼Œæ¯ä¸€åˆ—è¡¨ç¤ºä¸€ä¸ªç‰¹å¾x = np.array([[ 0., -3., 1.], [ 3., 1., 2.], [ 0., 1., -1.]])# å°†æ•°æ®è¿›è¡Œ[0,1]è§„èŒƒåŒ–min_max_scaler = preprocessing.MinMaxScaler()minmax_x = min_max_scaler.fit_transform(x)print minmax_xç»“æœï¼š1234[[0. 0. 0.66666667] [1. 1. 1. ] [0. 1. 0. ]]Z-Score è§„èŒƒåŒ–åœ¨ SciKit-Learn åº“ä¸­ä½¿ç”¨ preprocessing.scale() å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥å°†ç»™å®šæ•°æ®è¿›è¡Œ Z-Score è§„èŒƒåŒ–ã€‚12345678910from sklearn import preprocessingimport numpy as np# åˆå§‹åŒ–æ•°æ®x = np.array([[ 0., -3., 1.], [ 3., 1., 2.], [ 0., 1., -1.]])# å°†æ•°æ®è¿›è¡ŒZ-Scoreè§„èŒƒåŒ–scaled_x = preprocessing.scale(x)print scaled_xç»“æœï¼š1234[[-0.70710678 -1.41421356 0.26726124] [ 1.41421356 0.70710678 1.06904497] [-0.70710678 0.70710678 -1.33630621]]1è¿™ä¸ªç»“æœå®é™…ä¸Šå°±æ˜¯å°†æ¯è¡Œæ¯åˆ—çš„å€¼å‡å»äº†å¹³å‡å€¼ï¼Œå†é™¤ä»¥æ–¹å·®çš„ç»“æœã€‚æˆ‘ä»¬çœ‹åˆ° Z-Score è§„èŒƒåŒ–å°†æ•°æ®é›†è¿›è¡Œäº†è§„èŒƒåŒ–ï¼Œæ•°å€¼éƒ½ç¬¦åˆå‡å€¼ä¸º 0ï¼Œæ–¹å·®ä¸º 1 çš„æ­£æ€åˆ†å¸ƒã€‚å°æ•°å®šæ ‡è§„èŒƒåŒ–æˆ‘ä»¬éœ€è¦ç”¨ NumPy åº“æ¥è®¡ç®—å°æ•°ç‚¹çš„ä½æ•°ã€‚NumPy åº“æˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡ã€‚è¿™é‡Œæˆ‘ä»¬çœ‹ä¸‹è¿è¡Œä»£ç ï¼š123456789101112# coding:utf-8from sklearn import preprocessingimport numpy as np# åˆå§‹åŒ–æ•°æ®x = np.array([[ 0., -3., 1.], [ 3., 1., 2.], [ 0., 1., -1.]])# å°æ•°å®šæ ‡è§„èŒƒåŒ–j = np.ceil(np.log10(np.max(abs(x))))scaled_x = x/(10**j)print scaled_xç»“æœï¼š1234[[ 0. -0.3 0.1] [ 0.3 0.1 0.2] [ 0. 0.1 -0.1]]æ•°æ®æŒ–æ˜ä¸­æ•°æ®å˜æ¢æ¯”ç®—æ³•é€‰æ‹©æ›´é‡è¦åœ¨è€ƒè¯•æˆç»©ä¸­ï¼Œæˆ‘ä»¬éƒ½éœ€è¦è®©æ•°æ®æ»¡è¶³ä¸€å®šçš„è§„å¾‹ï¼Œè¾¾åˆ°è§„èŒƒæ€§çš„è¦æ±‚ï¼Œä¾¿äºè¿›è¡ŒæŒ–æ˜ã€‚è¿™å°±æ˜¯æ•°æ®å˜æ¢çš„ä½œç”¨ã€‚å¦‚æœä¸è¿›è¡Œå˜æ¢çš„è¯ï¼Œè¦ä¸å°±æ˜¯ç»´æ•°è¿‡å¤šï¼Œå¢åŠ äº†è®¡ç®—çš„æˆæœ¬ï¼Œè¦ä¸å°±æ˜¯æ•°æ®è¿‡äºé›†ä¸­ï¼Œå¾ˆéš¾æ‰¾åˆ°æ•°æ®ä¹‹é—´çš„ç‰¹å¾ã€‚åœ¨æ•°æ®å˜æ¢ä¸­ï¼Œé‡ç‚¹æ˜¯å¦‚ä½•å°†æ•°å€¼è¿›è¡Œè§„èŒƒåŒ–ï¼Œæœ‰ä¸‰ç§å¸¸ç”¨çš„è§„èŒƒæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ Min-Max è§„èŒƒåŒ–ã€Z-Score è§„èŒƒåŒ–ã€å°æ•°å®šæ ‡è§„èŒƒåŒ–ã€‚å…¶ä¸­ Z-Score è§„èŒƒåŒ–å¯ä»¥ç›´æ¥å°†æ•°æ®è½¬åŒ–ä¸ºæ­£æ€åˆ†å¸ƒçš„æƒ…å†µï¼Œå½“ç„¶ä¸æ˜¯æ‰€æœ‰è‡ªç„¶ç•Œçš„æ•°æ®éƒ½éœ€è¦æ­£æ€åˆ†å¸ƒï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®å®é™…çš„æƒ…å†µè¿›è¡Œè®¾è®¡ï¼Œæ¯”å¦‚å–å¯¹æ•° logï¼Œæˆ–è€…ç¥ç»ç½‘ç»œé‡Œé‡‡ç”¨çš„æ¿€åŠ±å‡½æ•°ç­‰ã€‚åœ¨æœ€åæˆ‘ç»™å¤§å®¶æ¨èäº† Python çš„ sklearn åº“ï¼Œå®ƒå’Œ NumPy, Pandas éƒ½æ˜¯éå¸¸æœ‰åçš„ Python åº“ï¼Œåœ¨æ•°æ®ç»Ÿè®¡å·¥ä½œä¸­èµ·äº†å¾ˆå¤§çš„ä½œç”¨ã€‚SciKit-Learn ä¸ä»…å¯ä»¥ç”¨äºæ•°æ®å˜æ¢ï¼Œå®ƒè¿˜æä¾›äº†åˆ†ç±»ã€èšç±»ã€é¢„æµ‹ç­‰æ•°æ®æŒ–æ˜ç®—æ³•çš„ API å°è£…ã€‚åé¢æˆ‘ä¼šè¯¦ç»†ç»™ä½ è®²è§£è¿™äº›ç®—æ³•ï¼Œä¹Ÿä¼šæ•™ä½ å¦‚ä½•ä½¿ç”¨ SciKit-Learn å·¥å…·æ¥å®Œæˆæ•°æ®æŒ–æ˜ç®—æ³•çš„å·¥ä½œã€‚Q&amp;Aæ•°æ®è§„èŒƒåŒ–ã€å½’ä¸€åŒ–ã€æ ‡å‡†åŒ–æ˜¯åŒä¸€ä¸ªæ¦‚å¿µä¹ˆï¼Ÿæ•°æ®è§„èŒƒåŒ–æ˜¯æ›´å¤§çš„æ¦‚å¿µï¼Œå®ƒæŒ‡çš„æ˜¯å°†ä¸åŒæ¸ é“çš„æ•°æ®ï¼Œéƒ½æŒ‰ç…§åŒä¸€ç§å°ºåº¦æ¥è¿›è¡Œåº¦é‡ï¼Œè¿™æ ·åšæœ‰ä¸¤ä¸ªå¥½å¤„ï¼Œä¸€æ˜¯è®©æ•°æ®ä¹‹é—´å…·æœ‰å¯æ¯”è¾ƒæ€§ï¼›å¦ä¸€ä¸ªå¥½å¤„å°±æ˜¯æ–¹ä¾¿åç»­è¿ç®—ï¼Œå› ä¸ºæ•°æ®åœ¨åŒä¸€ä¸ªæ•°é‡çº§ä¸Šè§„æ•´äº†ï¼Œåœ¨æœºå™¨å­¦ä¹ è¿­ä»£çš„æ—¶å€™ï¼Œä¹Ÿä¼šåŠ å¿«æ”¶æ•›æ•ˆç‡ã€‚æ•°æ®å½’ä¸€åŒ–å’Œæ•°æ®æ ‡å‡†åŒ–éƒ½æ˜¯æ•°æ®è§„èŒƒåŒ–çš„æ–¹å¼ã€‚ä¸åŒç‚¹åœ¨äºæ•°æ®å½’ä¸€åŒ–ä¼šè®©æ•°æ®åœ¨ä¸€ä¸ª[0,1]æˆ–è€…[-1,1]çš„åŒºé—´èŒƒå›´å†…ã€‚è€Œæ•°æ®æ ‡å‡†åŒ–ä¼šè®©è§„èŒƒåŒ–çš„æ•°æ®å‘ˆç°æ­£æ€åˆ†å¸ƒçš„æƒ…å†µï¼Œæ‰€ä»¥ä½ å¯ä»¥è¿™ä¹ˆè®°ï¼šå½’ä¸€åŒ–çš„â€œä¸€â€ï¼Œæ˜¯è®©æ•°æ®åœ¨[0,1]çš„èŒƒå›´å†…ã€‚è€Œæ ‡å‡†åŒ–ï¼Œç›®æ ‡æ˜¯è®©æ•°æ®å‘ˆç°æ ‡å‡†çš„æ­£æ€åˆ†å¸ƒã€‚ä»€ä¹ˆæ—¶å€™ä¼šç”¨åˆ°æ•°æ®è§„èŒƒåŒ–ï¼ˆMin-maxã€Z-Score å’Œå°æ•°å®šæ ‡ï¼‰ï¼Ÿåˆšæ‰æåˆ°äº†ï¼Œè¿›è¡Œæ•°æ®è§„èŒƒåŒ–æœ‰ä¸¤ä¸ªä½œç”¨ï¼šä¸€æ˜¯è®©æ•°æ®ä¹‹é—´å…·æœ‰å¯æ¯”è¾ƒæ€§ï¼ŒäºŒæ˜¯åŠ å¿«åç»­ç®—æ³•çš„è¿­ä»£æ”¶æ•›é€Ÿåº¦ã€‚å®é™…ä¸Šä½ èƒ½çœ‹åˆ° Min-maxã€Z-Score å’Œå°æ•°å®šæ ‡è§„èŒƒåŒ–éƒ½æ˜¯ä¸€ç§çº¿æ€§æ˜ å°„çš„å…³ç³»ï¼Œå°†åŸæ¥çš„æ•°å€¼æŠ•å°„åˆ°æ–°çš„ç©ºé—´ä¸­ã€‚è¿™æ ·å˜æ¢çš„å¥½å¤„å°±æ˜¯å¯ä»¥çœ‹åˆ°åœ¨ç‰¹å®šç©ºé—´å†…çš„æ•°å€¼åˆ†å¸ƒæƒ…å†µï¼Œæ¯”å¦‚é€šè¿‡ Min-max å¯ä»¥çœ‹åˆ°æ•°æ®åœ¨[0,1]ä¹‹é—´çš„åˆ†å¸ƒæƒ…å†µï¼ŒZ-Score å¯ä»¥çœ‹åˆ°æ•°å€¼çš„æ­£æ€åˆ†å¸ƒæƒ…å†µç­‰ã€‚ä¸è®ºæ˜¯é‡‡ç”¨å“ªç§æ•°æ®è§„èŒƒåŒ–æ–¹æ³•ï¼Œè§„èŒƒåŒ–åçš„æ•°å€¼éƒ½ä¼šåœ¨åŒä¸€ä¸ªæ•°é‡çš„çº§åˆ«ä¸Šï¼Œè¿™æ ·æ–¹ä¾¿åç»­è¿›è¡Œè¿ç®—ã€‚é‚£ä¹ˆå›è¿‡å¤´æ¥çœ‹ï¼Œåœ¨æ•°æ®æŒ–æ˜ç®—æ³•ä¸­ï¼Œæ˜¯å¦éƒ½éœ€è¦è¿›è¡Œæ•°æ®è§„èŒƒåŒ–å‘¢ï¼Ÿä¸€èˆ¬æƒ…å†µä¸‹æ˜¯éœ€è¦çš„ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹è·ç¦»ç›¸å…³çš„è¿ç®—ï¼Œæ¯”å¦‚åœ¨ K-Meansã€KNN ä»¥åŠèšç±»ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æœ‰å¯¹è·ç¦»çš„å®šä¹‰ï¼Œæ‰€ä»¥åœ¨åšè¿™äº›ç®—æ³•å‰ï¼Œéœ€è¦å¯¹æ•°æ®è¿›è¡Œè§„èŒƒåŒ–ã€‚å¦å¤–è¿˜æœ‰ä¸€äº›ç®—æ³•ç”¨åˆ°äº†æ¢¯åº¦ä¸‹é™ä½œä¸ºä¼˜åŒ–å™¨ï¼Œè¿™æ˜¯ä¸ºäº†æé«˜è¿­ä»£æ”¶æ•›çš„æ•ˆç‡ï¼Œä¹Ÿå°±æ˜¯æå‡æ‰¾åˆ°ç›®æ ‡å‡½æ•°æœ€ä¼˜è§£çš„æ•ˆç‡ã€‚æˆ‘ä»¬ä¹Ÿéœ€è¦è¿›è¡Œæ•°æ®è§„èŒƒåŒ–ï¼Œæ¯”å¦‚é€»è¾‘å›å½’ã€SVM å’Œç¥ç»ç½‘ç»œç®—æ³•ã€‚åœ¨è¿™äº›ç®—æ³•ä¸­éƒ½æœ‰ç›®æ ‡å‡½æ•°ï¼Œéœ€è¦å¯¹ç›®æ ‡å‡½æ•°è¿›è¡Œæ±‚è§£ã€‚æ¢¯åº¦ä¸‹é™çš„ç›®æ ‡æ˜¯å¯»æ‰¾åˆ°ç›®æ ‡å‡½æ•°çš„æœ€ä¼˜è§£ï¼Œè€Œæ¢¯åº¦çš„æ–¹æ³•åˆ™æŒ‡æ˜äº†æœ€ä¼˜è§£çš„æ–¹å‘ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å½“ç„¶ä¸æ˜¯æ‰€æœ‰çš„ç®—æ³•éƒ½éœ€è¦è¿›è¡Œæ•°æ®è§„èŒƒåŒ–ã€‚åœ¨æ„é€ å†³ç­–æ ‘çš„æ—¶å€™ï¼Œå¯ä»¥ä¸ç”¨æå‰åšæ•°æ®è§„èŒƒåŒ–ï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒç‰¹å¾å€¼çš„å¤§å°ç»´åº¦ï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨åˆ°æ¢¯åº¦ä¸‹é™æ¥åšä¼˜åŒ–ï¼Œæ‰€ä»¥æ•°æ®è§„èŒƒåŒ–å¯¹å†³ç­–æ ‘çš„æ„é€ ç»“æœå’Œæ„é€ æ•ˆç‡å½±å“ä¸å¤§ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æ˜¯å»ºè®®ä½ åœ¨åšæ•°æ®æŒ–æ˜ç®—æ³•å‰è¿›è¡Œæ•°æ®è§„èŒƒåŒ–ã€‚å¦‚ä½•ä½¿ç”¨ Z-Score è§„èŒƒåŒ–ï¼Œå°†åˆ†æ•°å˜æˆæ­£æ€åˆ†å¸ƒï¼Ÿå‡è®¾ A ä¸ B çš„è€ƒè¯•æˆç»©éƒ½ä¸º 80 åˆ†ï¼ŒA çš„è€ƒå·æ»¡åˆ†æ˜¯ 100 åˆ†ï¼ˆåŠæ ¼ 60 åˆ†ï¼‰ï¼ŒB çš„è€ƒå·æ»¡åˆ†æ˜¯ 500 åˆ†ï¼ˆåŠæ ¼ 300 åˆ†ï¼‰ã€‚è¿™é‡Œå‡è®¾ A å’Œ B çš„è€ƒè¯•æˆç»©éƒ½æ˜¯æˆæ­£æ€åˆ†å¸ƒï¼Œå¯ä»¥ç›´æ¥é‡‡ç”¨ Z-Score çš„çº¿æ€§åŒ–è§„èŒƒåŒ–æ–¹æ³•ã€‚åœ¨ä¸“æ çš„è®¨è®ºåŒºä¸­ï¼Œæœ‰ä¸ªåŒå­¦æå‡ºäº†â€œZ-Scoreâ€çš„éçº¿æ€§è®¡ç®—æ–¹å¼ï¼Œå¤§å®¶å¯ä»¥ä¸€èµ·äº†è§£ä¸‹ï¼šå…ˆæŒ‰å…¬å¼è®¡ç®—å‡ºç™¾åˆ†ç­‰çº§ã€‚ç™¾åˆ†ç­‰çº§ï¼ˆå¹´çº§ï¼‰=100-(100x å¹´çº§åæ¬¡ -50)/ æœ‰æ•ˆå‚åŠ è€ƒè¯•äººæ•°ã€‚è¿™é‡Œç™¾åˆ†ç­‰çº§æ˜¯æ¯ä¸ªå­¦ç”Ÿåœ¨è¯¥æ‰¹å­¦ç”Ÿä¸­çš„ç›¸å¯¹ä½ç½®ï¼Œå…¶ä¸­ç™¾åˆ†ç­‰çº§æ˜¯æŒ‰ç…§æ­£æ€åˆ†å¸ƒå›¾çš„æ‰€å é¢ç§¯æ¯”ä¾‹æ±‚å¾—çš„ï¼›æŒ‰ç…§ç™¾åˆ†ç­‰çº§æ•°å»æ ‡å‡†æ­£æ€åˆ†å¸ƒè¡¨ä¸­æŸ¥è¯¢å¾—å‡º Z-Score å€¼ï¼Œè¿™æ ·æœ€ç»ˆå¾—å‡ºçš„ Z åˆ†ä¾¿æ˜¯æ ‡å‡†çš„æ­£æ€åˆ†å¸ƒï¼Œèƒ½å¤Ÿå°†åæ€è½¬åŒ–æˆæ ‡å‡†æ­£æ€ã€‚å› ä¸ºåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ•°å€¼å¦‚æœä¸æ˜¯æ­£æ€åˆ†å¸ƒï¼Œè€Œæ˜¯åæ€åˆ†å¸ƒï¼Œç›´æ¥ä½¿ç”¨ Z-Score çš„çº¿æ€§è®¡ç®—æ–¹å¼æ— æ³•å°†åˆ†æ•°è½¬åŒ–æˆæ­£æ€åˆ†å¸ƒã€‚é‡‡ç”¨ä»¥ä¸Šçš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸€ä¸ªé—®é¢˜ï¼Œå¤§å®¶å¯ä»¥äº†è§£ä¸‹ã€‚è¿™é‡Œåæ€åˆ†å¸ƒæŒ‡çš„æ˜¯éå¯¹ç§°åˆ†å¸ƒçš„åæ–œçŠ¶æ€ï¼ŒåŒ…æ‹¬äº†è´Ÿåæ€ï¼Œä¹Ÿå°±æ˜¯å·¦åæ€åˆ†å¸ƒï¼Œä»¥åŠæ­£åæ€ï¼Œä¹Ÿå°±æ˜¯å³åæ€åˆ†å¸ƒã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"ç‰¹å¾å·¥ç¨‹","slug":"ç‰¹å¾å·¥ç¨‹","permalink":"cpeixin.cn/tags/%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/"}]},{"title":"æ•°æ®åˆ†æ-æ•°æ®æ¸…æ´—","slug":"æ•°æ®åˆ†æ-æ•°æ®æ¸…æ´—","date":"2018-07-05T15:53:22.000Z","updated":"2020-05-01T14:17:36.976Z","comments":true,"path":"2018/07/05/æ•°æ®åˆ†æ-æ•°æ®æ¸…æ´—/","link":"","permalink":"cpeixin.cn/2018/07/05/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97/","excerpt":"","text":"æ•°æ®åˆ†æ80%æ—¶é—´éƒ½èŠ±è´¹åœ¨äº†æ•°æ®æ¸…æ´—ä»»åŠ¡ä¸Šï¼Ÿåšå®Œæ•°æ®é‡‡é›†å°±å¯ä»¥ç›´æ¥è¿›è¡ŒæŒ–æ˜äº†å—ï¼Ÿè‚¯å®šä¸æ˜¯çš„ã€‚å°±æ‹¿åšé¥­æ‰“ä¸ªæ¯”æ–¹å§ï¼Œå¯¹äºå¾ˆå¤šäººæ¥è¯´ï¼Œçƒ­æ²¹ä¸‹é”…ã€æŒå‹ºç¿»ç‚’ä¸€å®šæ˜¯åšé¥­ä¸­æœ€è¿‡ç˜¾çš„ç¯èŠ‚ï¼Œä½†å®é™…ä¸Šç‚’èœè¿™ä¸ªè¿‡ç¨‹åªå åšé¥­æ—¶é—´çš„ 20%ï¼Œå‰©ä¸‹ 80% çš„æ—¶é—´éƒ½æ˜¯åœ¨åšå‡†å¤‡ï¼Œæ¯”å¦‚ä¹°èœã€æ‹©èœã€æ´—èœç­‰ç­‰ã€‚åœ¨æ•°æ®æŒ–æ˜ä¸­ï¼Œæ•°æ®æ¸…æ´—å°±æ˜¯è¿™æ ·çš„å‰æœŸå‡†å¤‡å·¥ä½œã€‚å¯¹äºæ•°æ®ç§‘å­¦å®¶æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°å„ç§å„æ ·çš„æ•°æ®ï¼Œåœ¨åˆ†æå‰ï¼Œè¦æŠ•å…¥å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›æŠŠæ•°æ®â€œæ•´ç†è£å‰ªâ€æˆè‡ªå·±æƒ³è¦æˆ–éœ€è¦çš„æ ·å­ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬é‡‡é›†åˆ°çš„æ•°æ®å¾€å¾€æœ‰å¾ˆå¤šé—®é¢˜ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾è€æ¿ç»™ä½ ä»¥ä¸‹çš„æ•°æ®ï¼Œè®©ä½ åšæ•°æ®åˆ†æï¼Œä½ çœ‹åˆ°è¿™ä¸ªæ•°æ®åæœ‰ä»€ä¹ˆæ„Ÿè§‰å‘¢ï¼Ÿä½ åˆšçœ‹åˆ°è¿™äº›æ•°æ®å¯èƒ½ä¼šæ¯”è¾ƒæ‡µï¼Œå› ä¸ºè¿™äº›æ•°æ®ç¼ºå°‘æ ‡æ³¨ã€‚æˆ‘ä»¬åœ¨æ”¶é›†æ•´ç†æ•°æ®çš„æ—¶å€™ï¼Œä¸€å®šè¦å¯¹æ•°æ®åšæ ‡æ³¨ï¼Œæ•°æ®è¡¨å¤´å¾ˆé‡è¦ã€‚æ¯”å¦‚è¿™ä»½æ•°æ®è¡¨ï¼Œå°±ç¼ºå°‘åˆ—åçš„æ ‡æ³¨ï¼Œè¿™æ ·ä¸€æ¥æˆ‘ä»¬å°±ä¸çŸ¥é“æ¯åˆ—æ•°æ®æ‰€ä»£è¡¨çš„å«ä¹‰ï¼Œæ— æ³•ä»ä¸šåŠ¡ä¸­ç†è§£è¿™äº›æ•°å€¼çš„ä½œç”¨ï¼Œä»¥åŠè¿™äº›æ•°å€¼æ˜¯å¦æ­£ç¡®ã€‚æˆ‘ç®€å•è§£é‡Šä¸‹ä¸Šå›¾è¿™äº›æ•°æ®ä»£è¡¨çš„å«ä¹‰ã€‚è¿™æ˜¯ä¸€å®¶æœè£…åº—ç»Ÿè®¡çš„ä¼šå‘˜æ•°æ®ã€‚æœ€ä¸Šé¢çš„ä¸€è¡Œæ˜¯åˆ—åæ ‡ï¼Œæœ€å·¦ä¾§ä¸€åˆ—æ˜¯è¡Œåæ ‡ã€‚åˆ—åæ ‡ä¸­ï¼Œç¬¬ 0 åˆ—ä»£è¡¨çš„æ˜¯åºå·ï¼Œç¬¬ 1 åˆ—ä»£è¡¨çš„ä¼šå‘˜çš„å§“åï¼Œç¬¬ 2 åˆ—ä»£è¡¨å¹´é¾„ï¼Œç¬¬ 3 åˆ—ä»£è¡¨ä½“é‡ï¼Œç¬¬ 46 åˆ—ä»£è¡¨ç”·æ€§ä¼šå‘˜çš„ä¸‰å›´å°ºå¯¸ï¼Œç¬¬ 79 åˆ—ä»£è¡¨å¥³æ€§ä¼šå‘˜çš„ä¸‰å›´å°ºå¯¸ã€‚äº†è§£å«ä¹‰ä»¥åï¼Œæˆ‘ä»¬å†çœ‹ä¸‹ä¸­é—´éƒ¨åˆ†å…·ä½“çš„æ•°æ®ï¼Œä½ å¯èƒ½ä¼šæƒ³ï¼Œè¿™äº›æ•°æ®æ€ä¹ˆè¿™ä¹ˆâ€œè„ä¹±å·®â€å•Šï¼Œæœ‰å¾ˆå¤šå€¼æ˜¯ç©ºçš„ï¼ˆNaNï¼‰ï¼Œè¿˜æœ‰ç©ºè¡Œçš„æƒ…å†µã€‚æ˜¯çš„ï¼Œè¿™è¿˜ä»…ä»…æ˜¯ä¸€å®¶å•†åº—çš„éƒ¨åˆ†ä¼šå‘˜æ•°æ®ï¼Œæˆ‘ä»¬ä¸€çœ¼çœ‹è¿‡å»å°±èƒ½å‘ç°ä¸€äº›é—®é¢˜ã€‚æ—¥å¸¸å·¥ä½œä¸­çš„æ•°æ®ä¸šåŠ¡ä¼šå¤æ‚å¾ˆå¤šï¼Œé€šå¸¸æˆ‘ä»¬è¦ç»Ÿè®¡æ›´å¤šçš„æ•°æ®ç»´åº¦ï¼Œæ¯”å¦‚ 100 ä¸ªæŒ‡æ ‡ï¼Œæ•°æ®é‡é€šå¸¸éƒ½æ˜¯è¶…è¿‡ TBã€EB çº§åˆ«çš„ï¼Œæ‰€ä»¥æ•´ä¸ªæ•°æ®åˆ†æçš„å¤„ç†éš¾åº¦æ˜¯å‘ˆæŒ‡æ•°çº§å¢åŠ çš„ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä»…ä»…é€šè¿‡è‚‰çœ¼å°±å¾ˆéš¾æ‰¾åˆ°é—®é¢˜æ‰€åœ¨äº†ã€‚æˆ‘ä¸¾äº†è¿™æ ·ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¸¦ä½ ç†è§£åœ¨æ•°æ®åˆ†æä¹‹å‰ä¸ºä»€ä¹ˆè¦æœ‰æ•°æ®æ¸…æ´—è¿™ä¸ªé‡è¦çš„å‡†å¤‡å·¥ä½œã€‚æœ‰ç»éªŒçš„æ•°æ®åˆ†æå¸ˆéƒ½çŸ¥é“ï¼Œå¥½çš„æ•°æ®åˆ†æå¸ˆå¿…å®šæ˜¯ä¸€åæ•°æ®æ¸…æ´—é«˜æ‰‹ï¼Œè¦çŸ¥é“åœ¨æ•´ä¸ªæ•°æ®åˆ†æè¿‡ç¨‹ä¸­ï¼Œä¸è®ºæ˜¯åœ¨æ—¶é—´è¿˜æ˜¯åŠŸå¤«ä¸Šï¼Œæ•°æ®æ¸…æ´—å¤§æ¦‚éƒ½å åˆ°äº† 80%ã€‚ä½†åœ¨å®é™…å·¥ä½œä¸­ï¼Œä¹Ÿå¯èƒ½åƒè¿™ä¸ªæ¡ˆä¾‹ä¸€æ ·ï¼Œæ•°æ®æ˜¯ç¼ºå°‘æ ‡æ³¨çš„ã€‚ä½†æ˜¯å¤§å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œæ•°æ®è¡¨å¤´éƒ½æ˜¯å­˜åœ¨çš„ï¼Œå³ä½¿ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¹Ÿä¼šé¦–å…ˆçš„æƒ³å€’è¦å»å¤„ç†è¡¨å¤´ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šå¦‚æœæ•°æ®æ¥æºæ˜¯pythonçˆ¬è™«è·å–çš„ï¼Œé‚£ä¹ˆåœ¨çˆ¬å–ä¹‹å‰ï¼Œæˆ‘ä»¬å°±ä¼šå®šä¹‰å¥½ï¼Œè§£æè·å¾—åˆ°çš„æ¯ä¸ªå­—æ®µæ˜¯ä»€ä¹ˆæ„æ€ã€‚å¦‚æœæ•°æ®æºæ˜¯æ—¥å¿—é‡‡é›†è€Œæ¥çš„ï¼Œé‚£ä¹ˆåœ¨æˆ‘ä»¬æ¥æ”¶åˆ°å‰ç«¯ä¼ è¾“è¿‡æ¥æ•°æ®æµï¼Œä¸€èˆ¬éƒ½æ˜¯å¸¦æœ‰å­—æ®µä¿¡æ¯çš„ï¼Œä¾‹å¦‚ï¼Œå‰ç«¯åŸ‹ç‚¹æ•°æ®æ‰“åˆ° kafkaæ¶ˆæ¯é˜Ÿ åˆ—ä¸­ï¼Œæ˜¯jsonæ ¼å¼ï¼Œé‚£ä¹ˆå­—æ®µä¿¡æ¯åˆ™ä¸ºkeyå€¼ï¼Œå¦‚æœåŸ‹ç‚¹æ•°æ®å¹¶ä¸æ˜¯æ ‡å‡†çš„jsonæ ¼å¼ï¼Œé‚£ä¹ˆå‰ç«¯äººå‘˜ä¹Ÿæ˜¯ä¼šç»™ä¸€ä»½æ•°æ®å­—å…¸ä¸ä¹‹å¯¹åº”çš„ã€‚æ•°æ®æºæ¥è‡ªæŸä¸ªä¸šåŠ¡æ•°æ®åº“ï¼Œé‚£ä¹ˆï¼Œæ•°æ®è¡¨å¤´ä¿¡æ¯åˆ™æ˜¯æ•°æ®åº“ä¸­æ•°æ®çš„åˆ—åã€‚æ•°æ®è´¨é‡çš„å‡†åˆ™åœ¨ä¸Šé¢è¿™ä¸ªæœè£…åº—ä¼šå‘˜æ•°æ®çš„æ¡ˆä¾‹ä¸­ï¼Œä¸€çœ‹åˆ°è¿™äº›æ•°æ®ï¼Œä½ è‚¯å®šèƒ½å‘ç°å‡ ä¸ªé—®é¢˜ã€‚ä½ æ˜¯ä¸æ˜¯æƒ³çŸ¥é“ï¼Œæœ‰æ²¡æœ‰ä¸€äº›å‡†åˆ™æ¥è§„èŒƒè¿™äº›æ•°æ®çš„è´¨é‡å‘¢ï¼Ÿå‡†åˆ™è‚¯å®šæ˜¯æœ‰çš„ã€‚ä¸è¿‡å¦‚æœæ•°æ®å­˜åœ¨ä¸ƒå…«ç§ç”šè‡³æ›´å¤šçš„é—®é¢˜ï¼Œæˆ‘ä»¬å¾ˆéš¾å°†è¿™äº›è§„åˆ™éƒ½è®°ä½ã€‚æœ‰ç ”ç©¶è¯´ä¸€ä¸ªäººçš„çŸ­æœŸè®°å¿†ï¼Œæœ€å¤šå¯ä»¥è®°ä½ 7 æ¡å†…å®¹æˆ–ä¿¡æ¯ï¼Œè¶…è¿‡ 7 æ¡å°±è®°ä¸ä½äº†ã€‚è€Œæ•°æ®æ¸…æ´—è¦è§£å†³çš„é—®é¢˜ï¼Œè¿œä¸æ­¢ 7 æ¡ï¼Œæˆ‘ä»¬ä¸‡ä¸€æ¼æ‰ä¸€é¡¹è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è®°ä½ï¼Œåˆèƒ½ä¿è¯æˆ‘ä»¬çš„æ•°æ®å¾—åˆ°å¾ˆå¥½çš„æ¸…æ´—ï¼Œæå‡æ•°æ®è´¨é‡å‘¢ï¼Ÿåœ¨è¿™é‡Œï¼Œæˆ‘å°†æ•°æ®æ¸…æ´—è§„åˆ™æ€»ç»“ä¸ºä»¥ä¸‹ 4 ä¸ªå…³é”®ç‚¹ï¼Œç»Ÿä¸€èµ·æ¥å«â€œå®Œå…¨åˆä¸€â€ï¼Œä¸‹é¢æˆ‘æ¥è§£é‡Šä¸‹ã€‚å®Œæ•´æ€§ï¼šå•æ¡æ•°æ®æ˜¯å¦å­˜åœ¨ç©ºå€¼ï¼Œç»Ÿè®¡çš„å­—æ®µæ˜¯å¦å®Œå–„ã€‚å…¨é¢æ€§ï¼šè§‚å¯ŸæŸä¸€åˆ—çš„å…¨éƒ¨æ•°å€¼ï¼Œæ¯”å¦‚åœ¨ Excel è¡¨ä¸­ï¼Œæˆ‘ä»¬é€‰ä¸­ä¸€åˆ—ï¼Œå¯ä»¥çœ‹åˆ°è¯¥åˆ—çš„å¹³å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å¸¸è¯†æ¥åˆ¤æ–­è¯¥åˆ—æ˜¯å¦æœ‰é—®é¢˜ï¼Œæ¯”å¦‚ï¼šæ•°æ®å®šä¹‰ã€å•ä½æ ‡è¯†ã€æ•°å€¼æœ¬èº«ã€‚åˆæ³•æ€§ï¼šæ•°æ®çš„ç±»å‹ã€å†…å®¹ã€å¤§å°çš„åˆæ³•æ€§ã€‚æ¯”å¦‚æ•°æ®ä¸­å­˜åœ¨é ASCII å­—ç¬¦ï¼Œæ€§åˆ«å­˜åœ¨äº†æœªçŸ¥ï¼Œå¹´é¾„è¶…è¿‡äº† 150 å²ç­‰ã€‚å”¯ä¸€æ€§ï¼šæ•°æ®æ˜¯å¦å­˜åœ¨é‡å¤è®°å½•ï¼Œå› ä¸ºæ•°æ®é€šå¸¸æ¥è‡ªä¸åŒæ¸ é“çš„æ±‡æ€»ï¼Œé‡å¤çš„æƒ…å†µæ˜¯å¸¸è§çš„ã€‚è¡Œæ•°æ®ã€åˆ—æ•°æ®éƒ½éœ€è¦æ˜¯å”¯ä¸€çš„ï¼Œæ¯”å¦‚ä¸€ä¸ªäººä¸èƒ½é‡å¤è®°å½•å¤šæ¬¡ï¼Œä¸”ä¸€ä¸ªäººçš„ä½“é‡ä¹Ÿä¸èƒ½åœ¨åˆ—æŒ‡æ ‡ä¸­é‡å¤è®°å½•å¤šæ¬¡ã€‚æ‹¿æ¥è§¦è¿‡çš„å®é™…é¡¹ç›®ä¸¾ä¾‹ï¼Œæ£€æŸ¥æ•°æ®è´¨é‡æ˜¯æœ‰å¤šä¹ˆçš„é‡è¦ï¼Œå·¥ä½œåˆæœŸï¼Œç»å¸¸ä¼šä½¿ç”¨hiveï¼Œsparkåšä¸€äº›æ•°æ®æŠ¥è¡¨ï¼Œé¢å¯¹å‡ ç™¾GBçš„æ•°æ®ï¼Œç»å¸¸æ˜¯ç›´æ¥å¿½ç•¥è¿‡æ•°æ®è´¨é‡å®¡æŸ¥çš„è¿™ä¸€æ­¥éª¤ï¼Œæ‰€ä»¥å¯¼è‡´çš„ç»“æœå°±æ˜¯ï¼Œåœ¨ç¨‹åºè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œä¼šå‡ºç°å¾ˆå¯¹å…³äºæ•°å€¼çš„é”™è¯¯å¼‚å¸¸ï¼Œè¿˜æœ‰ç©ºå€¼å¼‚å¸¸ï¼Œæå¤§å¼‚å¸¸å€¼ç­‰ï¼Œä¾‹å¦‚ å‰ç«¯ç”Ÿæ—¥æ ä½å‡ºç°bug,ç”¨æˆ·è‡ªå®šä¹‰è¾“å…¥ç”Ÿæ—¥å¯ä»¥ä¸ºâ€˜3000-14-03â€™,ç”¨æˆ·æ€§åˆ«å€¼ï¼Œå‰ç«¯å±…ç„¶ç»™äº†â€˜æœªçŸ¥é€‰é¡¹â€™ç­‰ç­‰è®©äººå“­ç¬‘ä¸å¾—çš„æ•°å€¼é”™è¯¯ï¼Œåè€Œå°±æ˜¯å› ä¸ºæ²¡æœ‰å»æ£€æŸ¥æ•°æ®è´¨é‡ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´åœ¨åé¢çš„ç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œè¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´å»DEBUGï¼Œå»å†™æ›´å¤šçš„å®¹é”™é€»è¾‘ã€‚åœ¨å¾ˆå¤šæ•°æ®æŒ–æ˜çš„æ•™å­¦ä¸­ï¼Œæ•°æ®å‡†åˆ™é€šå¸¸ä¼šåˆ—å‡ºæ¥ 7~8 é¡¹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å½’ç±»æˆäº†â€œå®Œå…¨åˆä¸€â€ 4 é¡¹å‡†åˆ™ï¼ŒæŒ‰ç…§ä»¥ä¸Šçš„åŸåˆ™ï¼Œæˆ‘ä»¬èƒ½è§£å†³æ•°æ®æ¸…ç†ä¸­é‡åˆ°çš„å¤§éƒ¨åˆ†é—®é¢˜ï¼Œä½¿å¾—æ•°æ®æ ‡å‡†ã€å¹²å‡€ã€è¿ç»­ï¼Œä¸ºåç»­æ•°æ®ç»Ÿè®¡ã€æ•°æ®æŒ–æ˜åšå¥½å‡†å¤‡ã€‚å¦‚æœæƒ³è¦è¿›ä¸€æ­¥ä¼˜åŒ–æ•°æ®è´¨é‡ï¼Œè¿˜éœ€è¦åœ¨å®é™…æ¡ˆä¾‹ä¸­çµæ´»ä½¿ç”¨ã€‚æ¸…æ´—æ•°æ®ä¸€ä¸€å‡»ç ´äº†è§£äº†æ•°æ®è´¨é‡å‡†åˆ™ä¹‹åï¼Œæˆ‘ä»¬é’ˆå¯¹ä¸Šé¢æœè£…åº—ä¼šå‘˜æ•°æ®æ¡ˆä¾‹ä¸­çš„é—®é¢˜è¿›è¡Œä¸€ä¸€å‡»ç ´ã€‚è¿™é‡Œä½ å°±éœ€è¦ Python çš„ Pandas å·¥å…·äº†ã€‚è¿™ä¸ªå·¥å…·æˆ‘ä»¬ä¹‹å‰ä»‹ç»è¿‡ã€‚å®ƒæ˜¯åŸºäº NumPy çš„å·¥å…·ï¼Œä¸“é—¨ä¸ºè§£å†³æ•°æ®åˆ†æä»»åŠ¡è€Œåˆ›å»ºã€‚Pandas çº³å…¥äº†å¤§é‡åº“ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›åº“é«˜æ•ˆåœ°è¿›è¡Œæ•°æ®æ¸…ç†å·¥ä½œã€‚è¿™é‡Œæˆ‘è¡¥å……è¯´æ˜ä¸€ä¸‹ï¼Œå¦‚æœä½ å¯¹ Python è¿˜ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä½†æ˜¯å¾ˆæƒ³ä»äº‹æ•°æ®æŒ–æ˜ã€æ•°æ®åˆ†æç›¸å…³çš„å·¥ä½œï¼Œé‚£ä¹ˆèŠ±ä¸€äº›æ—¶é—´å’Œç²¾åŠ›æ¥å­¦ä¹ ä¸€ä¸‹ Python æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚Python æ‹¥æœ‰ä¸°å¯Œçš„åº“ï¼Œå ªç§°æ•°æ®æŒ–æ˜åˆ©å™¨ã€‚å½“ç„¶äº†ï¼Œæ•°æ®æ¸…æ´—çš„å·¥å…·ä¹Ÿè¿˜æœ‰å¾ˆå¤šï¼Œè¿™é‡Œæˆ‘ä»¬åªæ˜¯ä»¥ Pandas ä¸ºä¾‹ï¼Œå¸®ä½ åº”ç”¨æ•°æ®æ¸…æ´—å‡†åˆ™ï¼Œå¸¦ä½ æ›´åŠ ç›´è§‚åœ°äº†è§£æ•°æ®æ¸…æ´—åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å„¿ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°±ä¾ç…§â€œå®Œå…¨åˆä¸€â€çš„å‡†åˆ™ï¼Œä½¿ç”¨ Pandas æ¥è¿›è¡Œæ¸…æ´—ã€‚å®Œæ•´æ€§é—®é¢˜ 1ï¼šç¼ºå¤±å€¼åœ¨æ•°æ®ä¸­æœ‰äº›å¹´é¾„ã€ä½“é‡æ•°å€¼æ˜¯ç¼ºå¤±çš„ï¼Œè¿™å¾€å¾€æ˜¯å› ä¸ºæ•°æ®é‡è¾ƒå¤§ï¼Œåœ¨è¿‡ç¨‹ä¸­ï¼Œæœ‰äº›æ•°å€¼æ²¡æœ‰é‡‡é›†åˆ°ã€‚é€šå¸¸æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ï¼šåˆ é™¤ï¼šåˆ é™¤æ•°æ®ç¼ºå¤±çš„è®°å½•ï¼›å‡å€¼ï¼šä½¿ç”¨å½“å‰åˆ—çš„å‡å€¼ï¼›é«˜é¢‘ï¼šä½¿ç”¨å½“å‰åˆ—å‡ºç°é¢‘ç‡æœ€é«˜çš„æ•°æ®ã€‚é—®é¢˜ 2ï¼šç©ºè¡Œæˆ‘ä»¬å‘ç°æ•°æ®ä¸­æœ‰ä¸€ä¸ªç©ºè¡Œï¼Œé™¤äº† index ä¹‹å¤–ï¼Œå…¨éƒ¨çš„å€¼éƒ½æ˜¯ NaNã€‚Pandas çš„ read_csv() å¹¶æ²¡æœ‰å¯é€‰å‚æ•°æ¥å¿½ç•¥ç©ºè¡Œï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨æ•°æ®è¢«è¯»å…¥ä¹‹åå†ä½¿ç”¨ dropna() è¿›è¡Œå¤„ç†ï¼Œåˆ é™¤ç©ºè¡Œã€‚å…¨é¢æ€§é—®é¢˜ï¼šåˆ—æ•°æ®çš„å•ä½ä¸ç»Ÿä¸€è§‚å¯Ÿ weight åˆ—çš„æ•°å€¼ï¼Œæˆ‘ä»¬èƒ½å‘ç° weight åˆ—çš„å•ä½ä¸ç»Ÿä¸€ã€‚æœ‰çš„å•ä½æ˜¯åƒå…‹ï¼ˆkgsï¼‰ï¼Œæœ‰çš„å•ä½æ˜¯ç£…ï¼ˆlbsï¼‰ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨åƒå…‹ä½œä¸ºç»Ÿä¸€çš„åº¦é‡å•ä½ï¼Œå°†ç£…ï¼ˆlbsï¼‰è½¬åŒ–ä¸ºåƒå…‹ï¼ˆkgsï¼‰åˆç†æ€§é—®é¢˜ï¼šé ASCII å­—ç¬¦æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨æ•°æ®é›†ä¸­ Firstname å’Œ Lastname æœ‰ä¸€äº›é ASCII çš„å­—ç¬¦ã€‚æˆ‘ä»¬å¯ä»¥é‡‡ç”¨åˆ é™¤æˆ–è€…æ›¿æ¢çš„æ–¹å¼æ¥è§£å†³é ASCII é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åˆ é™¤æ–¹æ³•å”¯ä¸€æ€§é—®é¢˜ 1ï¼šä¸€åˆ—æœ‰å¤šä¸ªå‚æ•°åœ¨æ•°æ®ä¸­ä¸éš¾å‘ç°ï¼Œå§“ååˆ—ï¼ˆNameï¼‰åŒ…å«äº†ä¸¤ä¸ªå‚æ•° Firstname å’Œ Lastnameã€‚ä¸ºäº†è¾¾åˆ°æ•°æ®æ•´æ´ç›®çš„ï¼Œæˆ‘ä»¬å°† Name åˆ—æ‹†åˆ†æˆ Firstname å’Œ Lastname ä¸¤ä¸ªå­—æ®µã€‚æˆ‘ä»¬ä½¿ç”¨ Python çš„ split æ–¹æ³•ï¼Œstr.split(expand=True)ï¼Œå°†åˆ—è¡¨æ‹†æˆæ–°çš„åˆ—ï¼Œå†å°†åŸæ¥çš„ Name åˆ—åˆ é™¤ã€‚é—®é¢˜ 2ï¼šé‡å¤æ•°æ®æˆ‘ä»¬æ ¡éªŒä¸€ä¸‹æ•°æ®ä¸­æ˜¯å¦å­˜åœ¨é‡å¤è®°å½•ã€‚å¦‚æœå­˜åœ¨é‡å¤è®°å½•ï¼Œå°±ä½¿ç”¨ Pandas æä¾›çš„ drop_duplicates() æ¥åˆ é™¤é‡å¤æ•°æ®ã€‚å…»æˆæ•°æ®å®¡æ ¸çš„ä¹ æƒ¯ç°åœ¨ï¼Œä½ æ˜¯ä¸æ˜¯èƒ½æ„Ÿå—åˆ°æ•°æ®é—®é¢˜ä¸æ˜¯å°äº‹ï¼Œä¸Šé¢è¿™ä¸ªç®€å•çš„ä¾‹å­é‡Œéƒ½æœ‰ 6 å¤„é”™è¯¯ã€‚æ‰€ä»¥æˆ‘ä»¬å¸¸è¯´ï¼Œç°å®ä¸–ç•Œçš„æ•°æ®æ˜¯â€œè„çš„â€ï¼Œéœ€è¦æ¸…æ´—ã€‚ç¬¬ä¸‰æ–¹çš„æ•°æ®è¦æ¸…æ´—ï¼Œè‡ªæœ‰äº§å“çš„æ•°æ®ï¼Œä¹Ÿéœ€è¦æ•°æ®æ¸…æ´—ã€‚æ¯”å¦‚ç¾å›¢è‡ªèº«åšæ•°æ®æŒ–æ˜çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦å»é™¤çˆ¬è™«æŠ“å–ï¼Œä½œå¼Šæ•°æ®ç­‰ã€‚å¯ä»¥è¯´æ²¡æœ‰é«˜è´¨é‡çš„æ•°æ®ï¼Œå°±æ²¡æœ‰é«˜è´¨é‡çš„æ•°æ®æŒ–æ˜ï¼Œè€Œæ•°æ®æ¸…æ´—æ˜¯é«˜è´¨é‡æ•°æ®çš„ä¸€é“ä¿éšœã€‚å½“ä½ ä»äº‹è¿™æ–¹é¢å·¥ä½œçš„æ—¶å€™ï¼Œä½ ä¼šå‘ç°å…»æˆæ•°æ®å®¡æ ¸çš„ä¹ æƒ¯éå¸¸é‡è¦ã€‚è€Œä¸”è¶Šæ˜¯ä¼˜ç§€çš„æ•°æ®æŒ–æ˜äººå‘˜ï¼Œè¶Šä¼šæœ‰â€œæ•°æ®å®¡æ ¸â€çš„â€œèŒä¸šç—…â€ã€‚è¿™å°±å¥½æ¯”ç¼–è¾‘éå¸¸åœ¨æ„æ–‡ç« ä¸­çš„é”™åˆ«å­—ã€è¯­æ³•ä¸€æ ·ã€‚æ•°æ®çš„è§„èŒƒæ€§ï¼Œå°±åƒæ˜¯ä½ çš„ä½œå“ä¸€æ ·ï¼Œé€šè¿‡æ¸…æ´—ä¹‹åï¼Œä¼šå˜å¾—éå¸¸å¹²å‡€ã€æ ‡å‡†ã€‚å½“ç„¶äº†ï¼Œè¿™ä¹Ÿæ˜¯ä¸€é—¨éœ€è¦ä¸æ–­ä¿®ç‚¼çš„åŠŸå¤«ã€‚ç»ˆæœ‰ä¸€å¤©ï¼Œä½ ä¼šè¿›å…¥è¿™æ ·ä¸€ç§å¢ƒç•Œï¼šçœ‹ä¸€çœ¼æ•°æ®ï¼Œå·®ä¸å¤š 7 ç§’é’Ÿçš„æ—¶é—´ï¼Œå°±èƒ½çŸ¥é“è¿™ä¸ªæ•°æ®æ˜¯å¦å­˜åœ¨é—®é¢˜ã€‚ä¸ºäº†è¿™ä¸€çœ¼çš„åŠŸåŠ›ï¼Œæˆ‘ä»¬è¦åšå¾ˆå¤šç»ƒä¹ ã€‚åˆšå¼€å§‹æ¥è§¦æ•°æ®ç§‘å­¦å·¥ä½œçš„æ—¶å€™ï¼Œä¸€å®šä¼šè§‰å¾—æ•°æ®æŒ–æ˜æ˜¯ä»¶å¾ˆé…·ã€å¾ˆæœ‰ä»·å€¼çš„äº‹ã€‚ç¡®å®å¦‚æ­¤ï¼Œä¸è¿‡ä»Šå¤©æˆ‘è¿˜è¦å‘Šè¯‰ä½ ï¼Œå†é…·ç‚«çš„äº‹ä¹Ÿç¦»ä¸å¼€åŸºç¡€æ€§çš„å·¥ä½œï¼Œå°±åƒæˆ‘ä»¬ä»Šå¤©è®²çš„æ•°æ®æ¸…æ´—å·¥ä½œã€‚å¯¹äºè¿™äº›åŸºç¡€æ€§çš„å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦è€ä¸‹æ€§å­ï¼Œä¸€ä¸ªå‘ä¸€ä¸ªå‘åœ°å»è§£å†³ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"æ•°æ®æ¸…æ´—","slug":"æ•°æ®æ¸…æ´—","permalink":"cpeixin.cn/tags/%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97/"}]},{"title":"æ•°æ®åˆ†æ-å¦‚ä½•é‡‡é›†æ•°æ®","slug":"æ•°æ®åˆ†æ-å¦‚ä½•é‡‡é›†æ•°æ®","date":"2018-07-04T15:12:49.000Z","updated":"2020-05-01T14:17:54.345Z","comments":true,"path":"2018/07/04/æ•°æ®åˆ†æ-å¦‚ä½•é‡‡é›†æ•°æ®/","link":"","permalink":"cpeixin.cn/2018/07/04/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E5%A6%82%E4%BD%95%E9%87%87%E9%9B%86%E6%95%B0%E6%8D%AE/","excerpt":"","text":"å¦‚ä½•å¯¹ç”¨æˆ·ç”»åƒå»ºæ¨¡ï¼Œè€Œå»ºæ¨¡ä¹‹å‰æˆ‘ä»¬éƒ½è¦è¿›è¡Œæ•°æ®é‡‡é›†ã€‚æ•°æ®é‡‡é›†æ˜¯æ•°æ®æŒ–æ˜çš„åŸºç¡€ï¼Œæ²¡æœ‰æ•°æ®ï¼Œä¹Ÿæ²¡æœ‰ä¸‹ä¸€é˜¶æ®µçš„æ•°æ®æŒ–æ˜ã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬æ‹¥æœ‰å¤šå°‘æ•°æ®æºï¼Œå¤šå°‘æ•°æ®é‡ï¼Œä»¥åŠæ•°æ®è´¨é‡å¦‚ä½•ï¼Œå°†å†³å®šæˆ‘ä»¬æŒ–æ˜äº§å‡ºçš„æˆæœä¼šæ€æ ·ã€‚æœ‰ä¸€å¥è¯ åƒåœ¾è¿›ï¼Œåƒåœ¾å‡ºï¼Œ æŒ‡çš„å°±æ˜¯ä½ åˆ©ç”¨ä¸€æ‰¹åƒåœ¾æ•°æ®ï¼Œé‚£ä¹ˆæŒ–æ˜å‡ºæ¥çš„ç»“è®ºï¼Œä¹Ÿæ˜¯å¦‚åŒåƒåœ¾ä¸€æ ·ï¼Œæ¯«æ— ä»·å€¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ åšé‡åŒ–æŠ•èµ„ï¼ŒåŸºäºå¤§æ•°æ®é¢„æµ‹æœªæ¥è‚¡ç¥¨çš„æ³¢åŠ¨ï¼Œæ ¹æ®è¿™ä¸ªé¢„æµ‹ç»“æœè¿›è¡Œä¹°å–ã€‚ä½ å½“å‰èƒ½å¤Ÿæ‹¿åˆ°ä»¥å¾€è‚¡ç¥¨çš„æ‰€æœ‰å†å²æ•°æ®ï¼Œæ˜¯å¦å¯ä»¥æ ¹æ®è¿™äº›æ•°æ®åšå‡ºä¸€ä¸ªé¢„æµ‹ç‡é«˜çš„æ•°æ®åˆ†æç³»ç»Ÿå‘¢ï¼Ÿå®é™…ä¸Šï¼Œå¦‚æœä½ åªæœ‰è‚¡ç¥¨å†å²æ•°æ®ï¼Œä½ ä»ç„¶æ— æ³•ç†è§£è‚¡ç¥¨ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå¤§å¹…çš„æ³¢åŠ¨ã€‚æ¯”å¦‚ï¼Œå½“æ—¶å¯èƒ½æ˜¯çˆ†å‘äº† SARS ç–«æƒ…ï¼Œæˆ–è€…æŸåœ°åŒºå‘ç”Ÿäº†æˆ˜äº‰ç­‰ã€‚è¿™äº›é‡å¤§çš„ç¤¾ä¼šäº‹ä»¶å¯¹è‚¡ç¥¨çš„å½±å“ä¹Ÿæ˜¯å·¨å¤§çš„ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦è€ƒè™‘åˆ°ï¼Œä¸€ä¸ªæ•°æ®çš„èµ°åŠ¿ï¼Œæ˜¯ç”±å¤šä¸ªç»´åº¦å½±å“çš„ã€‚æˆ‘ä»¬éœ€è¦é€šè¿‡å¤šæºçš„æ•°æ®é‡‡é›†ï¼Œæ”¶é›†åˆ°å°½å¯èƒ½å¤šçš„æ•°æ®ç»´åº¦ï¼ŒåŒæ—¶ä¿è¯æ•°æ®çš„è´¨é‡ï¼Œè¿™æ ·æ‰èƒ½å¾—åˆ°é«˜è´¨é‡çš„æ•°æ®æŒ–æ˜ç»“æœã€‚æ•°æ®æºåˆ†ç±»é‚£ä¹ˆï¼Œä»æ•°æ®é‡‡é›†è§’åº¦æ¥è¯´ï¼Œéƒ½æœ‰å“ªäº›æ•°æ®æºå‘¢ï¼Ÿæˆ‘å°†æ•°æ®æºåˆ†æˆäº†ä»¥ä¸‹çš„å››ç±»è¿™å››ç±»æ•°æ®æºåŒ…æ‹¬äº†ï¼šå¼€æ”¾æ•°æ®æºã€çˆ¬è™«æŠ“å–ã€ä¼ æ„Ÿå™¨å’Œæ—¥å¿—é‡‡é›†ã€‚å¼€æ”¾æ•°æ®æºä¸€èˆ¬æ˜¯é’ˆå¯¹è¡Œä¸šçš„æ•°æ®åº“ã€‚æ¯”å¦‚ç¾å›½äººå£è°ƒæŸ¥å±€å¼€æ”¾äº†ç¾å›½çš„äººå£ä¿¡æ¯ã€åœ°åŒºåˆ†å¸ƒå’Œæ•™è‚²æƒ…å†µæ•°æ®ã€‚é™¤äº†æ”¿åºœå¤–ï¼Œä¼ä¸šå’Œé«˜æ ¡ä¹Ÿä¼šå¼€æ”¾ç›¸åº”çš„å¤§æ•°æ®ï¼Œè¿™æ–¹é¢åŒ—ç¾ç›¸å¯¹æ¥è¯´åšå¾—å¥½ä¸€äº›ã€‚å›½å†…ï¼Œè´µå·åšäº†ä¸å°‘å¤§èƒ†å°è¯•ï¼Œæ­å»ºäº†äº‘å¹³å°ï¼Œé€å¹´å¼€æ”¾äº†æ—…æ¸¸ã€äº¤é€šã€å•†åŠ¡ç­‰é¢†åŸŸçš„æ•°æ®é‡ã€‚è¦çŸ¥é“å¾ˆå¤šç ”ç©¶éƒ½æ˜¯åŸºäºå¼€æ”¾æ•°æ®æºè¿›è¡Œçš„ï¼Œå¦åˆ™æ¯å¹´ä¸ä¼šæœ‰é‚£ä¹ˆå¤šè®ºæ–‡å‘è¡¨ï¼Œå¤§å®¶éœ€è¦ç›¸åŒçš„æ•°æ®é›†æ‰èƒ½å¯¹æ¯”å‡ºç®—æ³•çš„å¥½åã€‚çˆ¬è™«æŠ“å–ï¼Œä¸€èˆ¬æ˜¯é’ˆå¯¹ç‰¹å®šçš„ç½‘ç«™æˆ– Appã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦æŠ“å–æŒ‡å®šçš„ç½‘ç«™æ•°æ®ï¼Œæ¯”å¦‚è´­ç‰©ç½‘ç«™ä¸Šçš„è´­ç‰©è¯„ä»·, ä»¥åŠå¾®åšå®æ—¶çƒ­ç‚¹ç­‰ï¼Œå°±éœ€è¦æˆ‘ä»¬åšç‰¹å®šçš„çˆ¬è™«æŠ“å–ã€‚ç¬¬ä¸‰ç±»æ•°æ®æºæ˜¯ä¼ æ„Ÿå™¨ï¼Œä¹Ÿå°±æ˜¯ç›®å‰æ¯”è¾ƒç«çš„IOTï¼Œ ä¾‹å¦‚å°ç±³æ™ºèƒ½æ‰‹ç¯ï¼Œæ™ºèƒ½ä½“é‡ç§¤ï¼Œè¡—è¾¹æ‘„åƒå¤´å½•ä¸‹æ¥çš„å½•åƒï¼Œå®ƒåŸºæœ¬ä¸Šé‡‡é›†çš„æ˜¯ç‰©ç†ä¿¡æ¯ã€‚æœ€åæ˜¯æ—¥å¿—é‡‡é›†ï¼Œè¿™ä¸ªæ˜¯ç»Ÿè®¡ç”¨æˆ·çš„æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥åœ¨å‰ç«¯è¿›è¡ŒåŸ‹ç‚¹ï¼Œåœ¨åç«¯è¿›è¡Œè„šæœ¬æ”¶é›†ã€ç»Ÿè®¡ï¼Œæ¥åˆ†æç½‘ç«™çš„è®¿é—®æƒ…å†µï¼Œä»¥åŠä½¿ç”¨ç“¶é¢ˆç­‰ã€‚æ•°æ®é‡‡é›†çŸ¥é“äº†æœ‰å››ç±»æ•°æ®æºï¼Œé‚£å¦‚ä½•é‡‡é›†åˆ°è¿™äº›æ•°æ®å‘¢ï¼Ÿæ”¶é›†å¼€æºæ•°æ®æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹å¼€æ”¾æ•°æ®æºï¼Œæ•™ä½ ä¸ªæ–¹æ³•ï¼Œå¼€æ”¾æ•°æ®æºå¯ä»¥ä»ä¸¤ä¸ªç»´åº¦æ¥è€ƒè™‘ï¼Œä¸€ä¸ªæ˜¯å•ä½çš„ç»´åº¦ï¼Œæ¯”å¦‚æ”¿åºœã€ä¼ä¸šã€é«˜æ ¡ï¼›ä¸€ä¸ªå°±æ˜¯è¡Œä¸šç»´åº¦ï¼Œæ¯”å¦‚äº¤é€šã€é‡‘èã€èƒ½æºç­‰é¢†åŸŸã€‚è¿™æ–¹é¢ï¼Œå›½å¤–çš„å¼€æ”¾æ•°æ®æºæ¯”å›½å†…åšå¾—å¥½ä¸€äº›ï¼Œå½“ç„¶è¿‘äº›å¹´å›½å†…çš„æ”¿åºœå’Œé«˜æ ¡åšå¼€æ”¾æ•°æ®æºçš„ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚ä¸€æ–¹é¢æœåŠ¡ç¤¾ä¼šï¼Œå¦ä¸€æ–¹é¢è‡ªå·±çš„å½±å“åŠ›ä¹Ÿä¼šè¶Šæ¥è¶Šå¤§ã€‚æ¯”å¦‚ï¼Œä¸‹é¢è¿™å¼ è¡¨æ ¼åˆ—ä¸¾çš„å°±æ˜¯å•ä½ç»´åº¦çš„æ•°æ®æºã€‚æ‰€ä»¥å¦‚æœä½ æƒ³æ‰¾æŸä¸ªé¢†åŸŸçš„æ•°æ®æºï¼Œæ¯”å¦‚é‡‘èé¢†åŸŸï¼Œä½ åŸºæœ¬ä¸Šå¯ä»¥çœ‹ä¸‹æ”¿åºœã€é«˜æ ¡ã€ä¼ä¸šæ˜¯å¦æœ‰å¼€æ”¾çš„æ•°æ®æºã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥æœç´¢é‡‘èå¼€æ”¾æ•°æ®æºã€‚çˆ¬è™«é‡‡é›†ä½¿ç”¨çˆ¬è™«åšæŠ“å–çˆ¬è™«æŠ“å–åº”è¯¥å±äºæœ€å¸¸è§çš„éœ€æ±‚ï¼Œä¹Ÿæ˜¯æˆ‘æœ€å¸¸ç”¨çš„è·å–æ•°æ®çš„æ–¹å¼ã€‚æ¯”å¦‚ä½ æƒ³è¦é¤å…çš„è¯„ä»·æ•°æ®ã€‚å½“ç„¶è¿™é‡Œè¦æ³¨é‡ç‰ˆæƒé—®é¢˜ï¼Œè€Œä¸”å¾ˆå¤šç½‘ç«™ä¹Ÿæ˜¯æœ‰åçˆ¬æœºåˆ¶çš„ã€‚æœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ Python ç¼–å†™çˆ¬è™«ä»£ç ï¼Œå½“ç„¶å‰ææ˜¯ä½ éœ€è¦ä¼š Python çš„åŸºæœ¬è¯­æ³•ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒPHP ä¹Ÿå¯ä»¥åšçˆ¬è™«ï¼Œåªæ˜¯åŠŸèƒ½ä¸å¦‚ Python å®Œå–„ï¼Œå°¤å…¶æ˜¯æ¶‰åŠåˆ°å¤šçº¿ç¨‹çš„æ“ä½œã€‚åœ¨ Python çˆ¬è™«ä¸­ï¼ŒåŸºæœ¬ä¸Šä¼šç»å†ä¸‰ä¸ªè¿‡ç¨‹ã€‚å‘è¯·æ±‚ï¼Œè·å–å†…å®¹ã€‚ä½¿ç”¨ Requests çˆ¬å–å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Requests åº“æ¥æŠ“å–ç½‘é¡µä¿¡æ¯ã€‚Requests åº“å¯ä»¥è¯´æ˜¯ Python çˆ¬è™«çš„åˆ©å™¨ï¼Œä¹Ÿå°±æ˜¯ Python çš„ HTTP åº“ï¼Œé€šè¿‡è¿™ä¸ªåº“çˆ¬å–ç½‘é¡µä¸­çš„æ•°æ®ï¼Œéå¸¸æ–¹ä¾¿ï¼Œå¯ä»¥å¸®æˆ‘ä»¬èŠ‚çº¦å¤§é‡çš„æ—¶é—´ã€‚åŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨ç›®å‰æ¯”è¾ƒæˆç†Ÿçš„çˆ¬è™«æ¡†æ¶ scrapy æ¥è¿›è¡Œæ•°æ®çˆ¬å–ã€‚è§£æå†…å®¹BeautifulSoup æ˜¯çˆ¬è™«å¿…å­¦çš„æŠ€èƒ½ã€‚BeautifulSoupæœ€ä¸»è¦çš„åŠŸèƒ½æ˜¯ä»ç½‘é¡µè§£ææ•°æ®,å…¶æ¬¡è¿˜å¯ä»¥ä½¿ç”¨ XPath è§£æå†…å®¹ã€‚XPath æ˜¯ XML Path çš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯ XML è·¯å¾„è¯­è¨€ã€‚å®ƒæ˜¯ä¸€ç§ç”¨æ¥ç¡®å®š XML æ–‡æ¡£ä¸­æŸéƒ¨åˆ†ä½ç½®çš„è¯­è¨€ï¼Œåœ¨å¼€å‘ä¸­ç»å¸¸ç”¨æ¥å½“ä½œå°å‹æŸ¥è¯¢è¯­è¨€ã€‚XPath å¯ä»¥é€šè¿‡å…ƒç´ å’Œå±æ€§è¿›è¡Œä½ç½®ç´¢å¼•ã€‚ä¿å­˜æ•°æ®æ ¹æ®ä½ æ‰€çˆ¬å–çš„æ•°æ®é‡ï¼Œå¯ä»¥é€‰æ‹©ä¸åŒçš„å­˜å‚¨æ–¹å¼ã€‚å¦‚æœä½ çˆ¬å–çš„åªæ˜¯å•æ¬¡å°å‹æ•°æ®é›†ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥å­˜å‚¨åˆ°txt,csvç­‰æ–‡ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨åˆ°ï¼Œmysqlæ•°æ®åº“ä¸­ï¼Œæ–¹ä¾¿ä»¥ååˆ†æä½¿ç”¨ã€‚å¦‚æœä½ çˆ¬å–çš„æ˜¯å¤§å‹æ•°æ®é›†ï¼Œå¯ä»¥ä½¿ç”¨ Pandas ä¿å­˜æ•°æ®ã€‚Pandas æ˜¯è®©æ•°æ®åˆ†æå·¥ä½œå˜å¾—æ›´åŠ ç®€å•çš„é«˜çº§æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ Pandas ä¿å­˜çˆ¬å–çš„æ•°æ®ã€‚æœ€åé€šè¿‡ Pandas å†å†™å…¥åˆ° XLS æˆ–è€… MySQL ç­‰æ•°æ®åº“ä¸­ã€‚å¦‚æœä½ çš„çˆ¬è™«ä»»åŠ¡æ˜¯é•¿æœŸæ‰§è¡Œçš„ï¼Œé‚£ä¹ˆä½ å°±è¦è€ƒè™‘å¥½ä½ è¦ç”¨ä»€ä¹ˆå­˜å‚¨å·¥å…·æ¥å­˜å‚¨æ•°æ®äº† ï¼ˆeg: mongoDB??? elasticsearch ????ï¼‰å½“ç„¶åš Python çˆ¬è™«è¿˜æœ‰å¾ˆå¤šåˆ©å™¨ï¼Œæ¯”å¦‚ Seleniumï¼ŒPhantomJSï¼Œæˆ–è€…ç”¨ Puppteteer è¿™ç§æ— å¤´æ¨¡å¼, ä»¥ä¸Šæ‰€è¯´çš„ä¸‰ä¸ªå·¥å…·ï¼Œéƒ½æ˜¯å¯¹ä»˜é‚£äº›åçˆ¬è™«æ¯”è¾ƒå¤æ‚çš„æ•°æ®æºã€‚æ—¥å¿—é‡‡é›†ä¸ºä»€ä¹ˆè¦åšæ—¥å¿—é‡‡é›†å‘¢ï¼Ÿæ—¥å¿—é‡‡é›†æœ€å¤§çš„ä½œç”¨ï¼Œå°±æ˜¯é€šè¿‡åˆ†æç”¨æˆ·è®¿é—®æƒ…å†µï¼Œæå‡ç³»ç»Ÿçš„æ€§èƒ½ï¼Œä»è€Œæé«˜ç³»ç»Ÿæ‰¿è½½é‡ã€‚åŠæ—¶å‘ç°ç³»ç»Ÿæ‰¿è½½ç“¶é¢ˆï¼Œä¹Ÿå¯ä»¥æ–¹ä¾¿æŠ€æœ¯äººå‘˜åŸºäºç”¨æˆ·å®é™…çš„è®¿é—®æƒ…å†µè¿›è¡Œä¼˜åŒ–ã€‚æ—¥å¿—é‡‡é›†ä¹Ÿæ˜¯è¿ç»´äººå‘˜çš„é‡è¦å·¥ä½œä¹‹ä¸€ï¼Œé‚£ä¹ˆæ—¥å¿—éƒ½åŒ…æ‹¬å“ªäº›å‘¢ï¼Œåˆè¯¥å¦‚ä½•å¯¹æ—¥å¿—è¿›è¡Œé‡‡é›†å‘¢ï¼Ÿæ—¥å¿—å°±æ˜¯æ—¥è®°çš„æ„æ€ï¼Œå®ƒè®°å½•äº†ç”¨æˆ·è®¿é—®ç½‘ç«™çš„å…¨è¿‡ç¨‹ï¼šå“ªäº›äººåœ¨ä»€ä¹ˆæ—¶é—´ï¼Œé€šè¿‡ä»€ä¹ˆæ¸ é“ï¼ˆæ¯”å¦‚æœç´¢å¼•æ“ã€ç½‘å€è¾“å…¥ï¼‰æ¥è¿‡ï¼Œéƒ½æ‰§è¡Œäº†å“ªäº›æ“ä½œï¼›ç³»ç»Ÿæ˜¯å¦äº§ç”Ÿäº†é”™è¯¯ï¼›ç”šè‡³åŒ…æ‹¬ç”¨æˆ·çš„ IPã€HTTP è¯·æ±‚çš„æ—¶é—´ï¼Œç”¨æˆ·ä»£ç†ç­‰ã€‚è¿™äº›æ—¥å¿—æ•°æ®å¯ä»¥è¢«å†™åœ¨ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥åˆ†æˆä¸åŒçš„æ—¥å¿—æ–‡ä»¶ï¼Œæ¯”å¦‚è®¿é—®æ—¥å¿—ã€é”™è¯¯æ—¥å¿—ç­‰ã€‚æ—¥å¿—é‡‡é›†å¯ä»¥åˆ†ä¸¤ç§å½¢å¼é€šè¿‡ Web æœåŠ¡å™¨é‡‡é›†ï¼Œä¾‹å¦‚ httpdã€Nginxã€Tomcat éƒ½è‡ªå¸¦æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚åŒæ—¶å¾ˆå¤šäº’è”ç½‘ä¼ä¸šéƒ½æœ‰è‡ªå·±çš„æµ·é‡æ•°æ®é‡‡é›†å·¥å…·ï¼Œå¤šç”¨äºç³»ç»Ÿæ—¥å¿—é‡‡é›†ï¼Œå¦‚ Hadoop çš„ Chukwaã€Cloudera çš„ Flumeã€Facebook çš„ Scribe ç­‰ï¼Œè¿™äº›å·¥å…·å‡é‡‡ç”¨åˆ†å¸ƒå¼æ¶æ„ï¼Œèƒ½å¤Ÿæ»¡è¶³æ¯ç§’æ•°ç™¾ MB çš„æ—¥å¿—æ•°æ®é‡‡é›†å’Œä¼ è¾“éœ€æ±‚ã€‚è‡ªå®šä¹‰é‡‡é›†ç”¨æˆ·è¡Œä¸ºï¼Œä¾‹å¦‚ç”¨ JavaScript ä»£ç ç›‘å¬ç”¨æˆ·çš„è¡Œä¸ºã€AJAX å¼‚æ­¥è¯·æ±‚åå°è®°å½•æ—¥å¿—ç­‰ã€‚åŸ‹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿï¼ŸåŸ‹ç‚¹æ˜¯æ—¥å¿—é‡‡é›†çš„å…³é”®æ­¥éª¤ï¼Œé‚£ä»€ä¹ˆæ˜¯åŸ‹ç‚¹å‘¢ï¼ŸåŸ‹ç‚¹å°±æ˜¯åœ¨æœ‰éœ€è¦çš„ä½ç½®é‡‡é›†ç›¸åº”çš„ä¿¡æ¯ï¼Œè¿›è¡Œä¸ŠæŠ¥ã€‚æ¯”å¦‚æŸé¡µé¢çš„è®¿é—®æƒ…å†µï¼ŒåŒ…æ‹¬ç”¨æˆ·ä¿¡æ¯ã€è®¾å¤‡ä¿¡æ¯ï¼›æˆ–è€…ç”¨æˆ·åœ¨é¡µé¢ä¸Šçš„æ“ä½œè¡Œä¸ºï¼ŒåŒ…æ‹¬æ—¶é—´é•¿çŸ­ç­‰ã€‚è¿™å°±æ˜¯åŸ‹ç‚¹ï¼Œæ¯ä¸€ä¸ªåŸ‹ç‚¹å°±åƒä¸€å°æ‘„åƒå¤´ï¼Œé‡‡é›†ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œå°†æ•°æ®è¿›è¡Œå¤šç»´åº¦çš„äº¤å‰åˆ†æï¼Œå¯çœŸå®è¿˜åŸå‡ºç”¨æˆ·ä½¿ç”¨åœºæ™¯ï¼Œå’Œç”¨æˆ·ä½¿ç”¨éœ€æ±‚ã€‚é‚£æˆ‘ä»¬è¦å¦‚ä½•è¿›è¡ŒåŸ‹ç‚¹å‘¢ï¼ŸåŸ‹ç‚¹å°±æ˜¯åœ¨ä½ éœ€è¦ç»Ÿè®¡æ•°æ®çš„åœ°æ–¹æ¤å…¥ç»Ÿè®¡ä»£ç ï¼Œå½“ç„¶æ¤å…¥ä»£ç å¯ä»¥è‡ªå·±å†™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹ç»Ÿè®¡å·¥å…·ã€‚æˆ‘ä¹‹å‰è®²åˆ°â€œä¸é‡å¤é€ è½®å­â€çš„åŸåˆ™ï¼Œä¸€èˆ¬æ¥è¯´éœ€è¦è‡ªå·±å†™çš„ä»£ç ï¼Œä¸€èˆ¬æ˜¯ä¸»è¥æ ¸å¿ƒä¸šåŠ¡ï¼Œå¯¹äºåŸ‹ç‚¹è¿™ç±»ç›‘æµ‹æ€§çš„å·¥å…·ï¼Œå¸‚åœºä¸Šå·²ç»æ¯”è¾ƒæˆç†Ÿï¼Œè¿™é‡Œæ¨èä½ ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„å·¥å…·ï¼Œæ¯”å¦‚å‹ç›Ÿã€Google Analysisã€Talkingdata ç­‰ã€‚ä»–ä»¬éƒ½æ˜¯é‡‡ç”¨å‰ç«¯åŸ‹ç‚¹çš„æ–¹å¼ï¼Œç„¶ååœ¨ç¬¬ä¸‰æ–¹å·¥å…·é‡Œå°±å¯ä»¥çœ‹åˆ°ç”¨æˆ·çš„è¡Œä¸ºæ•°æ®ã€‚ä½†å¦‚æœæˆ‘ä»¬æƒ³è¦çœ‹åˆ°æ›´æ·±å±‚çš„ç”¨æˆ·æ“ä½œè¡Œä¸ºï¼Œå°±éœ€è¦è¿›è¡Œè‡ªå®šä¹‰åŸ‹ç‚¹ã€‚æ€»ç»“ä¸€ä¸‹ï¼Œæ—¥å¿—é‡‡é›†æœ‰åŠ©äºæˆ‘ä»¬äº†è§£ç”¨æˆ·çš„æ“ä½œæ•°æ®ï¼Œé€‚ç”¨äºè¿ç»´ç›‘æ§ã€å®‰å…¨å®¡è®¡ã€ä¸šåŠ¡æ•°æ®åˆ†æç­‰åœºæ™¯ã€‚ä¸€èˆ¬ Web æœåŠ¡å™¨ä¼šè‡ªå¸¦æ—¥å¿—åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Flume ä»ä¸åŒçš„æœåŠ¡å™¨é›†ç¾¤ä¸­é‡‡é›†ã€æ±‡æ€»å’Œä¼ è¾“å¤§å®¹é‡çš„æ—¥å¿—æ•°æ®ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ç»Ÿè®¡å·¥å…·æˆ–è‡ªå®šä¹‰åŸ‹ç‚¹å¾—åˆ°è‡ªå·±æƒ³è¦çš„ç»Ÿè®¡å†…å®¹ã€‚ä¼ æ„Ÿå™¨é‡‡é›†åŸºæœ¬ä¸Šæ˜¯åŸºäºç‰¹å®šçš„è®¾å¤‡ï¼Œå°†è®¾å¤‡é‡‡é›†çš„ä¿¡æ¯é€šè¿‡è¿›è¡Œæ”¶é›†å³å¯æ€»ç»“æ•°æ®é‡‡é›†æ˜¯æ•°æ®åˆ†æçš„å…³é”®ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¼šæƒ³åˆ° Python ç½‘ç»œçˆ¬è™«ï¼Œå®é™…ä¸Šæ•°æ®é‡‡é›†çš„æ–¹æ³•ã€æ¸ é“å¾ˆå¹¿ï¼Œæœ‰äº›å¯ä»¥ç›´æ¥ä½¿ç”¨å¼€æ”¾çš„æ•°æ®æºï¼Œæ¯”å¦‚æƒ³è·å–æ¯”ç‰¹å¸å†å²çš„ä»·æ ¼åŠäº¤æ˜“æ•°æ®ï¼Œå¯ä»¥ç›´æ¥ä» Kaggle ä¸Šä¸‹è½½ï¼Œä¸éœ€è¦è‡ªå·±çˆ¬å–ã€‚å¦ä¸€æ–¹é¢æ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚ï¼Œéœ€è¦é‡‡é›†çš„æ•°æ®ä¹Ÿä¸åŒï¼Œæ¯”å¦‚äº¤é€šè¡Œä¸šï¼Œæ•°æ®é‡‡é›†ä¼šå’Œæ‘„åƒå¤´æˆ–è€…æµ‹é€Ÿä»ªæœ‰å…³ã€‚å¯¹äºè¿ç»´äººå‘˜ï¼Œæ—¥å¿—é‡‡é›†å’Œåˆ†æåˆ™æ˜¯å…³é”®ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦é’ˆå¯¹ç‰¹å®šçš„ä¸šåŠ¡åœºæ™¯ï¼Œé€‰æ‹©é€‚åˆçš„é‡‡é›†å·¥å…·ã€‚ä»Šå¤©æˆ‘è®²äº†æ•°æ®é‡‡é›†çš„ä¸åŒæ¸ é“ä»¥åŠç›¸å…³çš„å·¥å…·ã€‚ç»™ä½ ç•™ä¸€ä¸ªæ€è€ƒé¢˜ï¼Œå‡å¦‚ä½ æƒ³é¢„æµ‹æ¯”ç‰¹å¸çš„æœªæ¥èµ°åŠ¿ï¼Œéƒ½éœ€è¦å“ªäº›ç»´åº¦çš„æ•°æ®æºå‘¢ï¼Ÿæ€æ ·æ”¶é›†åˆ°å®ƒä»¬å‘¢ï¼Ÿ","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"æ•°æ®é‡‡é›†","slug":"æ•°æ®é‡‡é›†","permalink":"cpeixin.cn/tags/%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/"}]},{"title":"æ•°æ®åˆ†æ-ç”¨æˆ·ç”»åƒé¡¹ç›®","slug":"æ•°æ®åˆ†æ-ç”¨æˆ·ç”»åƒé¡¹ç›®","date":"2018-07-03T14:32:06.000Z","updated":"2020-05-01T14:16:35.499Z","comments":true,"path":"2018/07/03/æ•°æ®åˆ†æ-ç”¨æˆ·ç”»åƒé¡¹ç›®/","link":"","permalink":"cpeixin.cn/2018/07/03/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E7%94%A8%E6%88%B7%E7%94%BB%E5%83%8F%E9%A1%B9%E7%9B%AE/","excerpt":"","text":"ç”¨æˆ·æ ‡ç­¾ï¼š æ€§åˆ«ï¼Œå¹´é¾„ï¼ŒèŒä¸šï¼Œæ˜Ÿåº§ï¼Œç”Ÿæ´»åŸå¸‚ï¼Œå®¶ä¹¡ï¼Œç”¨æˆ·æ³¨å†Œæ¸ é“ï¼Œé‚€è¯·ç æ¶ˆè´¹æ ‡ç­¾ï¼š å­˜æ¬¾ï¼Œé¢†å–ä¼˜æƒ é‡‘é¢ï¼Œå‚ä¸æ´»åŠ¨ï¼Œä¼šå‘˜æ˜Ÿçº§ï¼Œä½¿ç”¨ä¿¡ç”¨å¡æ¬¡æ•°ï¼Œå‚¨è“„å¡ä½¿ç”¨æ¬¡æ•°ï¼Œ æ•°å­—è´§å¸ä½¿ç”¨æ¬¡æ•°ï¼Œè´­ä¹°è£…å¤‡é‡‘é¢è¡Œä¸ºæ ‡ç­¾ï¼š ç™»å½•æ¬¡æ•°ï¼Œæ¸¸æˆæ¬¡æ•°ï¼Œåœ¨çº¿æ—¶é•¿ï¼Œæ¸¸æˆæ—¶é•¿ï¼Œè¡Œä¸ºè·¯å¾„ï¼Œç”¨æˆ·ç‚¹å‡»çƒ­ç‚¹ï¼Œï¼ˆæœç´¢è¡¥å……ï¼‰å†…å®¹æ ‡ç­¾ï¼š è®ºå›ç•™è¨€ï¼Œæµè§ˆä¼˜æƒ æ´»åŠ¨æŸ¥çœ‹ï¼Œæ¸¸æˆèŠå¤©ï¼ˆæœç´¢è¡¥å……ï¼‰é’ˆå¯¹å•ä¸ªç”¨æˆ·çš„ç”»åƒåˆ†æã€‚é’ˆå¯¹æŸä¸€å±æ€§ç¾¤ä½“çš„ç”»åƒåˆ†æã€‚å¹³å‡å€¼ï¼Œæœ€å¤§å€¼ï¼Œæœ€å°å€¼ï¼Œä¼—æ•°ï¼Œä¸­ä½æ•°ï¼Œå››åˆ†ä¹‹ä¸‰ä½æ•°ï¼Œå…­åˆ†ä¹‹ä¸€ä½æ•° ç­‰æ•°å€¼åœ¨åœ¨å®é™…ä¸­ä»£è¡¨çš„æ„ä¹‰ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"ç”¨æˆ·ç”»åƒ","slug":"ç”¨æˆ·ç”»åƒ","permalink":"cpeixin.cn/tags/%E7%94%A8%E6%88%B7%E7%94%BB%E5%83%8F/"}]},{"title":"æ•°æ®åˆ†æ-ç”¨æˆ·ç”»åƒæ ‡ç­¾","slug":"æ•°æ®åˆ†æ-ç”¨æˆ·ç”»åƒæ ‡ç­¾","date":"2018-07-02T14:31:58.000Z","updated":"2020-05-01T14:16:55.619Z","comments":true,"path":"2018/07/02/æ•°æ®åˆ†æ-ç”¨æˆ·ç”»åƒæ ‡ç­¾/","link":"","permalink":"cpeixin.cn/2018/07/02/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E7%94%A8%E6%88%B7%E7%94%BB%E5%83%8F%E6%A0%87%E7%AD%BE/","excerpt":"","text":"ç‹å…´è¯´è¿‡ï¼Œæˆ‘ä»¬å·²ç»è¿›å…¥åˆ°äº’è”ç½‘çš„ä¸‹åŠåœºã€‚åœ¨ä¸ŠåŠåœºï¼Œä¹Ÿå°±æ˜¯æ—©æœŸçš„äº’è”ç½‘æ—¶ä»£ï¼Œä½ æ°¸è¿œä¸çŸ¥é“åœ¨å¯¹é¢åçš„æ˜¯ä»€ä¹ˆæ ·çš„äººã€‚é‚£ä¸ªå¹´ä»£å¤§éƒ¨åˆ†äººè¿˜æ˜¯ QQ çš„æ—©æœŸç”¨æˆ·ã€‚åœ¨ä¸‹åŠåœºï¼Œäº’è”ç½‘å…¬å¸å·²ç»ä¸æ–°é²œäº†ï¼Œå¤§éƒ¨åˆ†å…¬å¸å·²ç»äº’è”ç½‘åŒ–ã€‚ä»–ä»¬å·²ç»åœ¨ç”¨ç½‘ç»œè¿›è¡Œäº§å“å®£ä¼ ï¼Œä½¿ç”¨ç”µå•†é”€å”®è‡ªå·±çš„å•†å“ã€‚è¿™ä¸¤å¹´å¼•é¢†ä¸‹åŠåœºå‘å±•çš„æ˜¯é‚£äº›åœ¨è®² â€œå¤§æ•°æ®â€â€œèµ‹èƒ½â€çš„ä¼ä¸šï¼Œä»–ä»¬æœ‰æ•°æ®ï¼Œæœ‰ç”¨æˆ·ã€‚é€šè¿‡å¤§æ•°æ®å‘Šè¯‰æ”¿åºœè¯¥å¦‚ä½•æ™ºæ…§åœ°ç®¡ç†äº¤é€šï¼ŒåšåŸå¸‚è§„åˆ’ã€‚é€šè¿‡æ¶ˆè´¹æ•°æ®åˆ†æï¼Œå‘Šè¯‰ä¼ä¸šè¯¥åœ¨ä»€ä¹ˆæ—¶é—´ç”Ÿäº§ä»€ä¹ˆäº§å“ï¼Œä»¥æœ€å¤§åŒ–åœ°æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚é€šè¿‡ç”Ÿæ´»å¤§æ•°æ®å‘Šè¯‰æˆ‘ä»¬é¤é¥®ä¼ä¸šï¼Œç”šè‡³æˆ¿åœ°äº§ä¼ä¸šè¯¥å¦‚ä½•é€‰å€ã€‚å¦‚æœè¯´äº’è”ç½‘çš„ä¸ŠåŠåœºæ˜¯ç²—ç‹‚è¿è¥ï¼Œå› ä¸ºæœ‰æµé‡çº¢åˆ©ä¸éœ€è¦è€ƒè™‘ç»†èŠ‚ã€‚é‚£ä¹ˆåœ¨ä¸‹åŠåœºï¼Œç²¾ç»†åŒ–è¿è¥å°†æ˜¯é•¿ä¹…çš„ä¸»é¢˜ã€‚æœ‰æ•°æ®ï¼Œæœ‰æ•°æ®åˆ†æèƒ½åŠ›æ‰èƒ½è®©ç”¨æˆ·å¾—åˆ°æ›´å¥½çš„ä½“éªŒã€‚æ‰€ä»¥ï¼Œç”¨æˆ·æ˜¯æ ¹æœ¬ï¼Œä¹Ÿæ˜¯æ•°æ®åˆ†æçš„å‡ºå‘ç‚¹ã€‚å‡å¦‚ä½ è¿›å…¥åˆ°ä¸€å®¶å–ç¾Šè‚‰ä¸²çš„é¤é¥®å…¬å¸ï¼Œè€æ¿è¯´ç°åœ¨ç«äº‰è¶Šæ¥è¶Šæ¿€çƒˆï¼Œè¦æƒ³åšå¾—å¥½å°±è¦æ˜ç™½é¡¾å®¢å–œæ¬¢ä»€ä¹ˆã€‚äºæ˜¯ä¸Šç­ç¬¬ä¸€å¤©ï¼Œè€æ¿é—®ä½ ï¼šâ€œä½ èƒ½ä¸èƒ½åˆ†æä¸‹ç”¨æˆ·æ•°æ®ï¼Œç»™å’±ä»¬å…¬å¸çš„ä¸šåŠ¡åšä¸ªèµ‹èƒ½å•Šï¼Ÿâ€å¬åˆ°è¿™ï¼Œä½ ä¼šæ€ä¹ˆæƒ³ï¼Ÿä½ è¯´ï¼šâ€œè€æ¿å•Šï¼Œå’±ä»¬æ˜¯å–ç¾Šè‚‰ä¸²çš„ï¼Œåšæ•°æ®æŒ–æ˜æ²¡ç”¨å•Šã€‚â€ä¼°è®¡è€æ¿å¬åï¼Œæ™šä¸Šå°±æŠŠä½ ç»™å¼€äº†ã€‚é‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå¦‚æœä½ æ„Ÿè§‰ä¸€å¤´æ‡µï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä»¬ä»Šå¤©å°±æ¥è®²è®²æ€ä¹ˆä¸€æ­¥æ­¥åˆ†æç”¨æˆ·æ•°æ®ã€‚ç”¨æˆ·ç”»åƒçš„å‡†åˆ™é¦–å…ˆå°±æ˜¯å°†è‡ªå·±ä¼ä¸šçš„ç”¨æˆ·ç”»åƒåšä¸ªç™½æï¼Œå‘Šè¯‰ä»–è¿™äº›ç”¨æˆ·â€œéƒ½æ˜¯è°â€â€œä»å“ªæ¥â€â€œè¦å»å“ªâ€ã€‚ä½ å¯ä»¥è¿™ä¹ˆå’Œè€æ¿è¯´ï¼šâ€œè€æ¿å•Šï¼Œç”¨æˆ·ç”»åƒå»ºæ¨¡æ˜¯ä¸ªç³»ç»Ÿçš„å·¥ç¨‹ï¼Œæˆ‘ä»¬è¦è§£å†³ä¸‰ä¸ªé—®é¢˜ã€‚ç¬¬ä¸€å‘¢ï¼Œå°±æ˜¯ç”¨æˆ·ä»å“ªé‡Œæ¥ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦ç»Ÿä¸€æ ‡è¯†ç”¨æˆ· IDï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹ç”¨æˆ·åç»­è¡Œä¸ºè¿›è¡Œè·Ÿè¸ªã€‚æˆ‘ä»¬è¦äº†è§£è¿™äº›ç¾Šè‚‰ä¸²çš„ç”¨æˆ·ä»å“ªé‡Œæ¥ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ç”¨æˆ·æ¥æºæ¸ é“ã€‚ä»–ä»¬æ˜¯ä¸ºäº†èšé¤ï¼Œè¿˜æ˜¯è‡ªå·±åƒå®µå¤œï¼Œè¿™äº›åœºæ™¯æˆ‘ä»¬éƒ½è¦åšç»Ÿè®¡åˆ†æã€‚ç¬¬äºŒå‘¢ï¼Œè¿™äº›ç”¨æˆ·æ˜¯è°ï¼Ÿè¿™é‡ŒæŒ‡çš„æ˜¯ ç”¨æˆ·ç”Ÿæ—¥ï¼ŒèŒä¸šï¼Œæ€§åˆ«ï¼Œå¹´é¾„ï¼Œæ”¶å…¥ç­‰åŸºæœ¬ä¿¡æ¯ï¼Œ æˆ‘ä»¬éœ€è¦å¯¹è¿™äº›ç”¨æˆ·è¿›è¡Œæ ‡ç­¾åŒ–ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹ç”¨æˆ·è¡Œä¸ºè¿›è¡Œç†è§£ã€‚ç¬¬ä¸‰å‘¢ï¼Œå°±æ˜¯ç”¨æˆ·è¦åˆ°å“ªé‡Œå»ï¼Ÿæˆ‘ä»¬è¦å°†è¿™äº›ç”¨æˆ·ç”»åƒä¸æˆ‘ä»¬çš„ä¸šåŠ¡ç›¸å…³è”ï¼Œæå‡æˆ‘ä»¬çš„è½¬åŒ–ç‡ï¼Œæˆ–è€…é™ä½æˆ‘ä»¬çš„æµå¤±ç‡ã€‚â€å¬åˆ°è¿™ï¼Œè€æ¿ç»™ä½ ç«–èµ·äº†å¤§æ‹‡æŒ‡ï¼Œè¯´ï¼šâ€œä¸é”™ï¼Œéƒ½éœ€è¦ä»€ä¹ˆèµ„æºï¼Œéšæ—¶æ‰¾æˆ‘å°±è¡Œã€‚â€åˆšæ‰è¯´çš„è¿™ä¸‰ä¸ªæ­¥éª¤ï¼Œä¸‹é¢æˆ‘ä¸€ä¸€ç»™ä½ åšä¸ªæ¢³ç†ã€‚é¦–å…ˆï¼Œä¸ºä»€ä¹ˆè¦è®¾è®¡å”¯ä¸€æ ‡è¯†ï¼Ÿç”¨æˆ·å”¯ä¸€æ ‡è¯†æ˜¯æ•´ä¸ªç”¨æˆ·ç”»åƒçš„æ ¸å¿ƒã€‚æˆ‘ä»¬ä»¥ä¸€ä¸ª App ä¸ºä¾‹ï¼Œå®ƒæŠŠâ€œä»ç”¨æˆ·å¼€å§‹ä½¿ç”¨ APP åˆ°ä¸‹å•åˆ°å”®åæ•´ä¸ªæ‰€æœ‰çš„ç”¨æˆ·è¡Œä¸ºâ€è¿›è¡Œä¸²è”ï¼Œå› ä¸ºä¸€ä¸ªç”¨æˆ·åœ¨è¿™ä¸ªAPPä¸­æ²¡æ“ä½œä¸€é¡¹ï¼Œéƒ½å¯èƒ½ä¼šäº§ç”Ÿä¸€æ¡å•ç‹¬çš„æ•°æ®ï¼Œæ‰€ä»¥åœ¨åç»­çš„åˆ†æè¿‡ç¨‹ä¸­ï¼Œéœ€è¦åˆ©ç”¨ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†å»æŠ“æ•°æ®ï¼Œç»Ÿè®¡æ•°æ®ã€‚è¿™æ ·å°±å¯ä»¥æ›´å¥½åœ°å»è·Ÿè¸ªå’Œåˆ†æä¸€ä¸ªç”¨æˆ·çš„ç‰¹å¾ã€‚è®¾è®¡å”¯ä¸€æ ‡è¯†å¯ä»¥ä»è¿™äº›é¡¹ä¸­é€‰æ‹©ï¼šç”¨æˆ·åã€æ³¨å†Œæ‰‹æœºå·ã€è”ç³»äººæ‰‹æœºå·ã€é‚®ç®±ã€è®¾å¤‡å·ã€CookieID ç­‰ã€‚å…¶æ¬¡ï¼Œç»™ç”¨æˆ·æ‰“æ ‡ç­¾ã€‚ä½ å¯èƒ½ä¼šæƒ³ï¼Œæ ‡ç­¾æœ‰å¾ˆå¤šï¼Œä¸”ä¸åŒçš„äº§å“ï¼Œæ ‡ç­¾çš„é€‰æ‹©èŒƒå›´ä¹Ÿä¸åŒï¼Œè¿™ä¹ˆå¤šçš„æ ‡ç­¾ï¼Œæ€æ ·åˆ’åˆ†æ‰èƒ½æ—¢æ–¹ä¾¿è®°å¿†ï¼Œåˆèƒ½ä¿è¯ç”¨æˆ·ç”»åƒçš„å…¨é¢æ€§å‘¢ï¼Ÿè¿™é‡Œæˆ‘æ€»ç»“äº†å…«ä¸ªå­—ï¼Œå«â€œç”¨æˆ·æ¶ˆè´¹è¡Œä¸ºåˆ†æâ€ã€‚æˆ‘ä»¬å¯ä»¥ä»è¿™ 4 ä¸ªç»´åº¦æ¥è¿›è¡Œæ ‡ç­¾åˆ’åˆ†ã€‚ç”¨æˆ·æ ‡ç­¾ï¼šå®ƒåŒ…æ‹¬äº†æ€§åˆ«ã€å¹´é¾„ã€åœ°åŸŸã€æ”¶å…¥ã€å­¦å†ã€èŒä¸šç­‰ã€‚è¿™äº›åŒ…æ‹¬äº†ç”¨æˆ·çš„åŸºç¡€å±æ€§ã€‚æ¶ˆè´¹æ ‡ç­¾ï¼šæ¶ˆè´¹ä¹ æƒ¯ã€è´­ä¹°æ„å‘ã€æ˜¯å¦å¯¹ä¿ƒé”€æ•æ„Ÿã€‚è¿™äº›ç»Ÿè®¡åˆ†æç”¨æˆ·çš„æ¶ˆè´¹ä¹ æƒ¯ã€‚è¡Œä¸ºæ ‡ç­¾ï¼šæ—¶é—´æ®µã€é¢‘æ¬¡ã€æ—¶é•¿ã€è®¿é—®è·¯å¾„ã€‚è¿™äº›æ˜¯é€šè¿‡åˆ†æç”¨æˆ·è¡Œä¸ºï¼Œæ¥å¾—åˆ°ä»–ä»¬ä½¿ç”¨ App çš„ä¹ æƒ¯ã€‚å†…å®¹åˆ†æï¼šå¯¹ç”¨æˆ·å¹³æ—¶æµè§ˆçš„å†…å®¹ï¼Œå°¤å…¶æ˜¯åœç•™æ—¶é—´é•¿ã€æµè§ˆæ¬¡æ•°å¤šçš„å†…å®¹è¿›è¡Œåˆ†æï¼Œåˆ†æå‡ºç”¨æˆ·å¯¹å“ªäº›å†…å®¹æ„Ÿå…´è¶£ï¼Œæ¯”å¦‚ï¼Œé‡‘èã€å¨±ä¹ã€æ•™è‚²ã€ä½“è‚²ã€æ—¶å°šã€ç§‘æŠ€ç­‰ã€‚å¯ä»¥è¯´ï¼Œç”¨æˆ·ç”»åƒæ˜¯ç°å®ä¸–ç•Œä¸­çš„ç”¨æˆ·çš„æ•°å­¦å»ºæ¨¡ï¼Œæˆ‘ä»¬æ­£æ˜¯å°†æµ·é‡æ•°æ®è¿›è¡Œæ ‡ç­¾åŒ–ï¼Œæ¥å¾—åˆ°ç²¾å‡†çš„ç”¨æˆ·ç”»åƒï¼Œä»è€Œä¸ºä¼ä¸šæ›´ç²¾å‡†åœ°è§£å†³é—®é¢˜ã€‚æœ€åï¼Œå½“ä½ æœ‰äº†ç”¨æˆ·ç”»åƒï¼Œå¯ä»¥ä¸ºä¼ä¸šå¸¦æ¥ä»€ä¹ˆä¸šåŠ¡ä»·å€¼å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä»ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸçš„ä¸‰ä¸ªé˜¶æ®µæ¥åˆ’åˆ†ä¸šåŠ¡ä»·å€¼ï¼ŒåŒ…æ‹¬ï¼šæ‹‰æ–°ã€ç”¨æˆ·ç²˜åº¦å’Œç•™å­˜ï¼šå¦‚ä½•è¿›è¡Œæ‹‰æ–°ï¼Œé€šè¿‡æ›´ç²¾å‡†çš„è¥é”€è·å–å®¢æˆ·ã€‚ç”¨æˆ·ç²˜åº¦ï¼šä¸ªæ€§åŒ–æ¨èï¼Œæœç´¢æ’åºï¼Œåœºæ™¯è¿è¥ç­‰ã€‚ç•™å­˜ï¼šæµå¤±ç‡é¢„æµ‹ï¼Œåˆ†æå…³é”®èŠ‚ç‚¹é™ä½æµå¤±ç‡ã€‚å¦‚æœæŒ‰ç…§æ•°æ®æµå¤„ç†çš„é˜¶æ®µæ¥åˆ’åˆ†ç”¨æˆ·ç”»åƒå»ºæ¨¡çš„è¿‡ç¨‹ï¼Œå¯ä»¥åˆ†ä¸ºæ•°æ®å±‚ã€ç®—æ³•å±‚å’Œä¸šåŠ¡å±‚ã€‚ä½ ä¼šå‘ç°åœ¨ä¸åŒçš„å±‚ï¼Œéƒ½éœ€è¦æ‰“ä¸Šä¸åŒçš„æ ‡ç­¾ã€‚æ•°æ®å±‚æŒ‡çš„æ˜¯ç”¨æˆ·æ¶ˆè´¹è¡Œä¸ºé‡Œçš„æ ‡ç­¾ã€‚æˆ‘ä»¬å¯ä»¥æ‰“ä¸Šâ€œäº‹å®æ ‡ç­¾â€ï¼Œä½œä¸ºæ•°æ®å®¢è§‚çš„è®°å½•ã€‚ç®—æ³•å±‚æŒ‡çš„æ˜¯é€è¿‡è¿™äº›è¡Œä¸ºç®—å‡ºçš„ç”¨æˆ·å»ºæ¨¡ã€‚æˆ‘ä»¬å¯ä»¥æ‰“ä¸Šâ€œæ¨¡å‹æ ‡ç­¾â€ï¼Œä½œä¸ºç”¨æˆ·ç”»åƒçš„åˆ†ç±»æ ‡è¯†ã€‚ä¸šåŠ¡å±‚æŒ‡çš„æ˜¯è·å®¢ã€ç²˜å®¢ã€ç•™å®¢çš„æ‰‹æ®µã€‚æˆ‘ä»¬å¯ä»¥æ‰“ä¸Šâ€œé¢„æµ‹æ ‡ç­¾â€ï¼Œä½œä¸ºä¸šåŠ¡å…³è”çš„ç»“æœã€‚æ‰€ä»¥è¿™ä¸ªæ ‡ç­¾åŒ–çš„æµç¨‹ï¼Œå°±æ˜¯é€šè¿‡æ•°æ®å±‚çš„â€œäº‹å®æ ‡ç­¾â€ï¼Œåœ¨ç®—æ³•å±‚è¿›è¡Œè®¡ç®—ï¼Œæ‰“ä¸Šâ€œæ¨¡å‹æ ‡ç­¾â€çš„åˆ†ç±»ç»“æœï¼Œæœ€åæŒ‡å¯¼ä¸šåŠ¡å±‚ï¼Œå¾—å‡ºâ€œé¢„æµ‹æ ‡ç­¾â€ã€‚ç¾å›¢å¤–å–çš„ç”¨æˆ·ç”»åƒè¯¥è®¾è®¡åˆšæ‰è®²çš„æ˜¯ç”¨æˆ·ç”»åƒçš„ä¸‰ä¸ªé˜¶æ®µï¼Œä»¥åŠæ¯ä¸ªé˜¶æ®µçš„å‡†åˆ™ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥ä½¿ç”¨è¿™äº›å‡†åˆ™åšä¸ªç»ƒä¹ ã€‚å¦‚æœä½ æ˜¯ç¾å›¢å¤–å–çš„æ•°æ®åˆ†æå¸ˆï¼Œä½ è¯¥å¦‚ä½•åˆ¶å®šç”¨æˆ·æ ‡è¯† IDï¼Œåˆ¶å®šç”¨æˆ·ç”»åƒï¼Œä»¥åŠåŸºäºç”¨æˆ·ç”»åƒå¯ä»¥åšå“ªäº›ä¸šåŠ¡å…³è”ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸‹ç¾å›¢å¤–å–çš„äº§å“èƒŒæ™¯ã€‚ç¾å›¢å·²ç»å’Œå¤§ä¼—ç‚¹è¯„è¿›è¡Œäº†åˆå¹¶ï¼Œå› æ­¤åœ¨å¤§ä¼—ç‚¹è¯„å’Œç¾å›¢å¤–å–ä¸Šéƒ½å¯ä»¥è¿›è¡Œå¤–å–ä¸‹å•ã€‚å¦å¤–ç¾å›¢å¤–å–é’ˆå¯¹çš„æ˜¯é«˜é¢‘ O2O çš„åœºæ™¯ï¼Œç¾å›¢å¤–å–æ˜¯ç¾å›¢çš„æ ¸å¿ƒäº§å“ï¼ŒåŸºæœ¬ä¸Šæœ‰ä¸€åŠçš„å¸‚å€¼éƒ½æ˜¯ç”±å¤–å–æ’‘èµ·æ¥çš„ã€‚åŸºäºç”¨æˆ·ç”»åƒå®æ–½çš„ä¸‰ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç»Ÿä¸€ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ï¼Œé‚£ä¹ˆç©¶ç«Ÿå“ªä¸ªå­—æ®µå¯ä»¥ä½œä¸ºç”¨æˆ·æ ‡è¯†å‘¢ï¼Ÿæˆ‘ä»¬å…ˆçœ‹ä¸‹ç¾å›¢å’Œå¤§ä¼—ç‚¹è¯„éƒ½æ˜¯é€šè¿‡å“ªäº›æ–¹å¼ç™»å½•çš„ã€‚æˆ‘ä»¬çœ‹åˆ°ï¼Œç¾å›¢é‡‡ç”¨çš„æ˜¯æ‰‹æœºå·ã€å¾®ä¿¡ã€å¾®åšã€ç¾å›¢è´¦å·çš„ç™»å½•æ–¹å¼ã€‚å¤§ä¼—ç‚¹è¯„é‡‡ç”¨çš„æ˜¯æ‰‹æœºå·ã€å¾®ä¿¡ã€QQã€å¾®åšçš„ç™»å½•æ–¹å¼ã€‚è¿™é‡Œé¢ä¸¤ä¸ª APP å…±åŒçš„ç™»å½•æ–¹å¼éƒ½æ˜¯æ‰‹æœºå·ã€å¾®ä¿¡å’Œå¾®åšã€‚é‚£ä¹ˆç©¶ç«Ÿå“ªä¸ªå¯ä»¥ä½œä¸ºç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†å‘¢ï¼Ÿå½“ç„¶ä¸»è¦æ˜¯ä»¥ç”¨æˆ·çš„æ³¨å†Œæ‰‹æœºå·ä¸ºæ ‡å‡†ã€‚è¿™æ ·ç¾å›¢å’Œå¤§ä¼—ç‚¹è¯„çš„è´¦å·ä½“ç³»å°±å¯ä»¥ç›¸é€šã€‚å½“ç„¶ï¼Œå¤§å®¶çŸ¥é“åœ¨é›†å›¢å†…éƒ¨ï¼Œå„éƒ¨é—¨ä¹‹é—´çš„åä½œï¼Œå°¤å…¶æ˜¯ç”¨æˆ·æ•°æ®æ‰“é€šæ˜¯éå¸¸å›°éš¾çš„ï¼Œå°¤å…¶æ˜¯å¤šæ¡äº§å“çº¿ï¼Œåœ¨æ•°æ®æ•´åˆçš„è¿‡ç¨‹ä¸­ï¼Œä¼šå‡ºç°å„ç§å„æ ·çš„æ•°æ®æ ¼å¼é—®é¢˜ï¼Œæ•°æ®ç²¾åº¦ï¼Œæ•°æ®çš„ç©ºå€¼å¤„ç†ç­‰ã€‚æ‰€ä»¥è¿™é‡Œå»ºè®®ï¼Œå¦‚æœå¸Œæœ›å¤§æ•°æ®å¯¹å„ä¸ªéƒ¨é—¨éƒ½èƒ½èµ‹èƒ½ï¼Œä¸€å®šè¦åœ¨é›†å›¢çš„æˆ˜ç•¥é«˜åº¦ä¸Šï¼Œå°½æ—©å°±åœ¨æœ€å¼€å§‹çš„é¡¶å±‚æ¶æ„ä¸Šï¼Œå°†ç”¨æˆ·æ ‡è¯†è¿›è¡Œç»Ÿä¸€ï¼Œè¿™æ ·åœ¨åç»­è¿‡ç¨‹ä¸­æ‰èƒ½å®ç°ç”¨æˆ·æ•°æ®çš„æ‰“é€šã€‚ç„¶åæˆ‘ä»¬æ€è€ƒä¸‹ï¼Œæœ‰äº†ç”¨æˆ·ï¼Œç”¨æˆ·ç”»åƒéƒ½å¯ä»¥ç»Ÿè®¡åˆ°å“ªäº›æ ‡ç­¾ã€‚æˆ‘ä»¬æŒ‰ç…§â€œç”¨æˆ·æ¶ˆè´¹è¡Œä¸ºåˆ†æâ€çš„å‡†åˆ™æ¥è¿›è¡Œè®¾è®¡ã€‚ç”¨æˆ·æ ‡ç­¾ï¼šæ€§åˆ«ã€å¹´é¾„ã€å®¶ä¹¡ã€å±…ä½åœ°ã€æ”¶è´§åœ°å€ã€å©šå§»ã€å®å®ä¿¡æ¯ã€é€šè¿‡ä½•ç§æ¸ é“è¿›è¡Œçš„æ³¨å†Œã€‚æ¶ˆè´¹æ ‡ç­¾ï¼šé¤é¥®å£å‘³ã€æ¶ˆè´¹å‡ä»·ã€å›¢è´­ç­‰çº§ã€é¢„å®šä½¿ç”¨ç­‰çº§ã€æ’é˜Ÿä½¿ç”¨ç­‰çº§ã€å¤–å–ç­‰çº§ã€‚è¡Œä¸ºæ ‡ç­¾ï¼šç‚¹å¤–å–æ—¶é—´æ®µã€ä½¿ç”¨é¢‘æ¬¡ã€å¹³å‡ç‚¹é¤ç”¨æ—¶ã€è®¿é—®è·¯å¾„ã€‚å†…å®¹åˆ†æï¼šåŸºäºç”¨æˆ·å¹³æ—¶æµè§ˆçš„å†…å®¹è¿›è¡Œç»Ÿè®¡ï¼ŒåŒ…æ‹¬é¤é¥®å£å‘³ã€ä¼˜æƒ æ•æ„Ÿåº¦ç­‰ã€‚å½“ä½ æœ‰äº†â€œç”¨æˆ·æ¶ˆè´¹è¡Œä¸ºåˆ†æâ€çš„æ ‡ç­¾ä¹‹åï¼Œä½ å°±å¯ä»¥æ›´å¥½åœ°ç†è§£ä¸šåŠ¡äº†ã€‚æ¯”å¦‚ä¸€ä¸ªç»å¸¸ä¹°æ²™æ‹‰çš„äººï¼Œä¸€èˆ¬å¾ˆå°‘åƒå¤œå®µã€‚åŒæ ·ï¼Œä¸€ä¸ªç»å¸¸åƒå¤œå®µçš„äººï¼Œåƒå°é¾™è™¾çš„æ¦‚ç‡å¯èƒ½è¿œé«˜äºå…¶ä»–äººã€‚è¿™äº›ç»“æœéƒ½æ˜¯é€šè¿‡æ•°æ®æŒ–æ˜ä¸­çš„å…³è”åˆ†æå¾—å‡ºçš„ã€‚æœ‰äº†è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬å°±å¯ä»¥é¢„æµ‹ç”¨æˆ·çš„è¡Œä¸ºã€‚æ¯”å¦‚ä¸€ä¸ªç”¨æˆ·è´­ä¹°äº†â€œæœˆå­é¤â€åï¼Œæ›´æœ‰å¯èƒ½è´­ä¹°å©´å„¿æ°´ï¼ŒåŒæ ·å©´å„¿ç›¸å…³çš„äº§å“æ¯”å¦‚å©´å„¿æ¹¿å·¾ç­‰çš„è´­ä¹°æ¦‚ç‡ä¹Ÿä¼šå¢å¤§ã€‚å…·ä½“åœ¨ä¸šåŠ¡å±‚ä¸Šï¼Œæˆ‘ä»¬éƒ½å¯ä»¥åŸºäºæ ‡ç­¾äº§ç”Ÿå“ªäº›ä¸šåŠ¡ä»·å€¼å‘¢ï¼Ÿåœ¨æ‹‰æ–°ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¼˜åŠ¿çš„å®£ä¼ æ¸ é“ï¼Œå¦‚ä½•é€šè¿‡ä¸ªæ€§åŒ–çš„å®£ä¼ æ‰‹æ®µï¼Œå¸å¼•æœ‰æ½œåœ¨éœ€æ±‚çš„ç”¨æˆ·ï¼Œå¹¶åˆºæ¿€å…¶è½¬åŒ–ã€‚åœ¨ç”¨æˆ·ç²˜åº¦ä¸Šï¼Œå¦‚ä½•æå‡ç”¨æˆ·çš„å•ä»·å’Œæ¶ˆè´¹é¢‘æ¬¡ï¼Œæ–¹æ³•å¯ä»¥åŒ…æ‹¬è´­ä¹°åçš„ä¸ªæ€§åŒ–æ¨èã€é’ˆå¯¹ä¼˜è´¨ç”¨æˆ·è¿›è¡Œä¼˜è´¨é«˜ä»·å•†å“çš„æ¨èã€ä»¥åŠé‡å¤è´­ä¹°ï¼Œæ¯”å¦‚é€šè¿‡çº¢åŒ…ã€ä¼˜æƒ ç­‰æ–¹å¼æ¿€åŠ±å¯¹ä¼˜æƒ æ•æ„Ÿçš„äººç¾¤ï¼Œæå‡è´­ä¹°é¢‘æ¬¡ã€‚åœ¨ç•™å­˜ä¸Šï¼Œé¢„æµ‹ç”¨æˆ·æ˜¯å¦å¯èƒ½ä¼šä»å¹³å°ä¸Šæµå¤±ã€‚åœ¨è¥é”€é¢†åŸŸï¼Œå…³äºç”¨æˆ·ç•™å­˜æœ‰ä¸€ä¸ªè§‚ç‚¹â€”â€”å¦‚æœå°†é¡¾å®¢æµå¤±ç‡é™ä½ 5%ï¼Œå…¬å¸åˆ©æ¶¦å°†æå‡ 25%~85%ã€‚å¯ä»¥çœ‹å‡ºç•™å­˜ç‡æ˜¯å¤šä¹ˆçš„é‡è¦ã€‚ç”¨æˆ·æµå¤±å¯èƒ½ä¼šåŒ…æ‹¬å¤šç§æƒ…å†µï¼Œæ¯”å¦‚ç”¨æˆ·ä½“éªŒã€ç«äº‰å¯¹æ‰‹ã€éœ€æ±‚å˜åŒ–ç­‰ï¼Œé€šè¿‡é¢„æµ‹ç”¨æˆ·çš„æµå¤±ç‡å¯ä»¥å¤§å¹…é™ä½ç”¨æˆ·ç•™å­˜çš„è¿è¥æˆæœ¬ã€‚é”»ç‚¼è‡ªå·±çš„æŠ½è±¡èƒ½åŠ›ï¼Œå°†ç¹æ‚çš„äº‹åŠ¡ç®€å•åŒ–ä¸Šé¢æˆ‘ä»¬è®²åˆ°çš„â€œç”¨æˆ·æ¶ˆè´¹è¡Œä¸ºæ ‡ç­¾â€éƒ½æ˜¯åŸºäºä¸€èˆ¬æƒ…å†µè€ƒè™‘çš„ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œç”¨æˆ·çš„è¡Œä¸ºä¹Ÿä¼šéšç€è¥é”€çš„èŠ‚å¥äº§ç”Ÿå¼‚å¸¸å€¼ï¼Œæ¯”å¦‚åŒåä¸€çš„æ—¶å€™ï¼Œå¦‚æœå•†å®¶éƒ½åœ¨ä¿ƒé”€å°±ä¼šäº§ç”Ÿçªå‘çš„å¤§é‡è®¢å•ã€‚å› æ­¤åœ¨åšç”¨æˆ·ç”»åƒçš„æ—¶å€™ï¼Œè¿˜è¦è€ƒè™‘åˆ°å¼‚å¸¸å€¼çš„å¤„ç†ã€‚æ€»ä¹‹ï¼Œæ•°æ®é‡æ˜¯åºå¤§çš„ï¼Œä¼šå­˜åœ¨å„ç§å„æ ·çš„ä½¿ç”¨æƒ…å†µã€‚å…‰æ˜¯åˆ†æ EB çº§åˆ«çš„å¤§æ•°æ®ï¼Œæˆ‘ä»¬å°±è¦èŠ±å¾ˆé•¿çš„æ—¶é—´ã€‚ä½†æˆ‘ä»¬çš„æœ€ç»ˆç›®çš„ä¸æ˜¯å¤„ç†è¿™äº›æ•°æ®ï¼Œè€Œæ˜¯ç†è§£ã€ä½¿ç”¨è¿™äº›æ•°æ®æŒ–æ˜çš„ç»“æœã€‚å¯¹æ•°æ®çš„æ ‡ç­¾åŒ–èƒ½è®©æˆ‘ä»¬å¿«é€Ÿç†è§£ä¸€ä¸ªç”¨æˆ·ï¼Œä¸€ä¸ªå•†å“ï¼Œä¹ƒè‡³ä¸€ä¸ªè§†é¢‘å†…å®¹çš„ç‰¹å¾ï¼Œä»è€Œæ–¹ä¾¿æˆ‘ä»¬å»ç†è§£å’Œä½¿ç”¨æ•°æ®ã€‚å¯¹æ•°æ®çš„æ ‡ç­¾åŒ–å…¶å®è€ƒéªŒçš„æ˜¯æˆ‘ä»¬çš„æŠ½è±¡èƒ½åŠ›ï¼Œåœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¹Ÿè¦é”»ç‚¼è‡ªå·±çš„æŠ½è±¡èƒ½åŠ›ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬å¾ˆå¿«åœ°å°†ä¸€ä¸ªç¹æ‚çš„äº‹ç‰©ç®€å•åŒ–ï¼Œä¸ä»…æ–¹ä¾¿ç†è§£ï¼Œè¿˜æœ‰ç›Šåç»­çš„ä½¿ç”¨ã€‚æˆ‘ä»¬ä»Šå¤©è®²äº†ç”¨æˆ·ç”»åƒçš„æµç¨‹ï¼Œå…¶ä¸­å¾ˆé‡è¦çš„ä¸€ä¸ªæ­¥éª¤å°±æ˜¯ç»™ç”¨æˆ·æ‰“æ ‡ç­¾ï¼Œé‚£ä¹ˆä½ ä¸å¦¨æƒ³æƒ³ï¼Œå¦‚æœç»™ç¾Šè‚‰ä¸²è¿é”åº—è¿›è¡Œç”¨æˆ·ç”»åƒåˆ†æï¼Œéƒ½å¯ä»¥ä»å“ªäº›è§’åº¦è¿›è¡Œæ ‡ç­¾åŒ–ï¼Ÿæœ€åï¼Œæˆ‘ä»¬ä»ç°å®ç”Ÿæ´»ä¸­å‡ºå‘ï¼Œæ‰“å¼€ä½ çš„æ‰‹æœºï¼Œç¿»ç¿»çœ‹ä½ çš„å¾®ä¿¡é€šè®¯å½•ï¼Œåˆ†æä¸‹ä½ çš„æœ‹å‹åœˆï¼Œéƒ½æœ‰å“ªäº›ç”¨æˆ·ç”»åƒï¼Ÿå¦‚æœä½ æ¥ç»™å®ƒè®¾è®¡æ ‡ç­¾ï¼Œéƒ½æœ‰å“ªäº›ç§ç±»éœ€è¦ç»Ÿè®¡å‘¢ã€‚ä¸ºäº†æ–¹ä¾¿åç»­ä½¿ç”¨ï¼Œä½ æ˜¯å¦‚ä½•å°†ä»–ä»¬å½’ç±»åˆ†ç»„çš„ï¼Ÿå…³äºæœ‹å‹åœˆçš„ç”¨æˆ·ç”»åƒï¼Œæˆ‘ä»¬æŒ‰ç…§ â€œç”¨æˆ·æ¶ˆè´¹è¡Œä¸ºä¹ æƒ¯â€ æ¥è®¾å®šæ ‡ç­¾çš„è¯ï¼Œå¤§ä½“å¯ä»¥å‚è€ƒå¦‚ä¸‹ï¼šç”¨æˆ·æ ‡ç­¾:ç”¨æˆ·æ€§åˆ«ã€ç”¨æˆ·å¹´é¾„ã€ç”¨æˆ·æ‰€å¤„ä½ç½®ã€ç”¨æˆ·å®¶ä¹¡ã€ç”¨æˆ·å­¦å†ã€ç”¨æˆ·è§’è‰²ã€ç”¨æˆ·æ¥æºæ¸ é“æ¶ˆè´¹æ ‡ç­¾ï¼šæœ‹å‹åœˆå¹¿å‘Šç‚¹å‡»æƒ…å†µã€ç”¨æˆ·å‚ä¸æ´»åŠ¨ã€ä½¿ç”¨å°ç¨‹åºçš„ç±»å‹è¡Œä¸ºæ ‡ç­¾ï¼šæœ‹å‹åœˆå‘å¸ƒé¢‘æ¬¡ã€æœ‹å‹åœˆå¯è§è®¾ç½®ã€æœ‹å‹åœˆç‚¹èµæ¬¡æ•°ã€æœ‹å‹åœˆè¯„è®ºæ¬¡æ•°ã€æœ‹å‹åœˆæ–‡å­—æµè§ˆæ¬¡æ•°ã€æœ‹å‹åœˆæƒé™è®¾ç½®å†…å®¹åˆ†æï¼šæµè§ˆæ–‡å­—ç±»å‹ã€æ–‡å­—è½¬å‘ç±»å‹","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"ç”¨æˆ·ç”»åƒ","slug":"ç”¨æˆ·ç”»åƒ","permalink":"cpeixin.cn/tags/%E7%94%A8%E6%88%B7%E7%94%BB%E5%83%8F/"}]},{"title":"æ•°æ®åˆ†æ-åŸºæœ¬æ¦‚å¿µ","slug":"æ•°æ®åˆ†æ-åŸºæœ¬æ¦‚å¿µ","date":"2018-07-01T14:31:58.000Z","updated":"2020-05-01T14:19:10.225Z","comments":true,"path":"2018/07/01/æ•°æ®åˆ†æ-åŸºæœ¬æ¦‚å¿µ/","link":"","permalink":"cpeixin.cn/2018/07/01/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/","excerpt":"","text":"å‰è¨€ç¾å›½æ˜å°¼è‹è¾¾å·ä¸€å®¶ Target ç™¾è´§è¢«å®¢æˆ·æŠ•è¯‰ï¼Œè¿™åå®¢æˆ·æŒ‡æ§ Target å°†å©´å„¿äº§å“ä¼˜æƒ åˆ¸å¯„ç»™ä»–çš„å¥³å„¿ï¼Œè€Œä»–å¥³å„¿è¿˜æ˜¯ä¸€åé«˜ä¸­ç”Ÿã€‚ä½†æ²¡å¤šä¹…è¿™åå®¢æˆ·å°±æ¥ç”µé“æ­‰ï¼Œå› ä¸ºå¥³å„¿ç»ä»–é€¼é—®åå¦æ‰¿è‡ªå·±çœŸçš„æ€€å­•äº†ã€‚Target ç™¾è´§å¯„é€å©´å„¿äº§å“ä¼˜æƒ åˆ¸ç»éå¶ç„¶ä¹‹ä¸¾ï¼Œä»–ä»¬å‘ç°å¦‡å¥³åœ¨æ€€å­•çš„æƒ…å†µä¸‹ï¼Œè´­ä¹°çš„ç‰©å“ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ¯”å¦‚æŠ¤æ‰‹éœœä¼šä»æœ‰é¦™å‘³çš„æ”¹æˆæ— å‘³çš„ï¼Œæ­¤å¤–è¿˜ä¼šè´­ä¹°å¤§é‡ç»´ç”Ÿç´ ç­‰ä¿å¥å“ã€‚é€šè¿‡ç±»ä¼¼çš„å…³è”åˆ†æï¼ŒTarget æ„å»ºäº†ä¸€ä¸ªâ€œæ€€å­•é¢„æµ‹æŒ‡æ•°â€ï¼Œé€šè¿‡è¿™ä¸ªæŒ‡æ•°é¢„æµ‹åˆ°äº†é¡¾å®¢å·²ç»æ€€å­•çš„æƒ…å†µï¼Œå¹¶æŠŠä¼˜æƒ åˆ¸å¯„é€ç»™å¥¹ã€‚é‚£ä¹ˆé¡¾å®¢æ€€å­•ä¸å•†å“ä¹‹é—´çš„å…³è”å…³ç³»æ˜¯å¦‚ä½•è¢«å‘ç°çš„å‘¢ï¼Ÿå®é™…ä¸Šä»–ä»¬éƒ½æ˜¯ç”¨çš„ Apriori ç®—æ³•ï¼Œè¯¥ç®—æ³•æ˜¯ç”±ç¾å›½å­¦è€… Agrawal åœ¨ 1994 å¹´æå‡ºçš„ã€‚ä»–é€šè¿‡åˆ†æè´­ç‰©ç¯®ä¸­çš„å•†å“é›†åˆï¼Œæ‰¾å‡ºå•†å“ä¹‹é—´çš„å…³è”å…³ç³»ã€‚åˆ©ç”¨è¿™ç§éšæ€§å…³è”å…³ç³»ï¼Œå•†å®¶å°±å¯ä»¥å¼ºåŒ–è¿™ç±»è´­ä¹°è¡Œä¸ºï¼Œä»è€Œæå‡é”€å”®é¢ã€‚è¿™å°±æ˜¯æ•°æ®åˆ†æçš„åŠ›é‡ï¼Œäººä»¬æ€»æ˜¯ä»æ•°æ®åˆ†æä¸­å¾—åˆ°æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œå•¤é…’å’Œå°¿å¸ƒçš„æ•…äº‹ä¹Ÿæ˜¯ä¸ªç»å…¸çš„æ¡ˆä¾‹ã€‚å¦‚ä»Šåœ¨è¶…å¸‚ä¸­ï¼Œæˆ‘ä»¬è¿˜èƒ½çœ‹åˆ°ä¸å°‘ç»„åˆçš„å¥—è£…æ‰“åŒ…åœ¨ä¸€èµ·å–ï¼Œæ¯”å¦‚å®æ´çš„äº§å“ï¼šé£˜æŸ”æ´—å‘æ°´ + ç‰å…°æ²¹æ²æµ´éœ²ã€æµ·é£ä¸æ´—å‘æ°´ + èˆ’è‚¤ä½³æ²æµ´éœ²ç­‰ç­‰ã€‚å•†å“çš„æ†ç»‘é”€å”®æ˜¯ä¸ªå¾ˆæœ‰ç”¨çš„è¥é”€æ–¹å¼ï¼ŒèƒŒåéƒ½æ˜¯æ•°æ®åˆ†æåœ¨å‘æŒ¥ä½œç”¨ã€‚å•†ä¸šæ™ºèƒ½ BIã€æ•°æ®ä»“åº“ DWã€æ•°æ®æŒ–æ˜ DM ä¸‰è€…ä¹‹é—´çš„å…³ç³»å¼€å¤´ä¸­çš„ç™¾è´§å•†åº—åˆ©ç”¨æ•°æ®é¢„æµ‹ç”¨æˆ·è´­ç‰©è¡Œä¸ºå±äºå•†ä¸šæ™ºèƒ½ï¼Œä»–ä»¬ç§¯ç´¯çš„é¡¾å®¢çš„æ¶ˆè´¹è¡Œä¸ºä¹ æƒ¯ä¼šå­˜å‚¨åœ¨æ•°æ®ä»“åº“ä¸­ï¼Œé€šè¿‡å¯¹ä¸ªä½“è¿›è¡Œæ¶ˆè´¹è¡Œä¸ºåˆ†ææ€»ç»“å‡ºæ¥çš„è§„å¾‹å±äºæ•°æ®æŒ–æ˜ã€‚æ‰€ä»¥æˆ‘ä»¬èƒ½åœ¨è¿™ä¸ªåœºæ™¯é‡Œçœ‹åˆ°ä¸‰ä¸ªé‡è¦çš„æ¦‚å¿µï¼šå•†ä¸šæ™ºèƒ½ã€æ•°æ®ä»“åº“å’Œæ•°æ®æŒ–æ˜ã€‚å•†ä¸šæ™ºèƒ½çš„è‹±æ–‡æ˜¯ Business Intelligenceï¼Œç¼©å†™æ˜¯ BIã€‚ç›¸æ¯”äºæ•°æ®ä»“åº“ã€æ•°æ®æŒ–æ˜ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ›´å¤§çš„æ¦‚å¿µã€‚å•†ä¸šæ™ºèƒ½å¯ä»¥è¯´æ˜¯åŸºäºæ•°æ®ä»“åº“ï¼Œç»è¿‡äº†æ•°æ®æŒ–æ˜åï¼Œå¾—åˆ°äº†å•†ä¸šä»·å€¼çš„è¿‡ç¨‹ã€‚æ‰€ä»¥è¯´æ•°æ®ä»“åº“æ˜¯ä¸ªé‡‘çŸ¿ï¼Œæ•°æ®æŒ–æ˜æ˜¯ç‚¼é‡‘æœ¯ï¼Œè€Œå•†ä¸šæŠ¥å‘Šåˆ™æ˜¯é»„é‡‘ã€‚æ•°æ®ä»“åº“çš„è‹±æ–‡æ˜¯ Data Warehouseï¼Œç¼©å†™æ˜¯ DWã€‚å®ƒå¯ä»¥è¯´æ˜¯ BI è¿™ä¸ªæˆ¿å­çš„åœ°åŸºï¼Œæ­å»ºå¥½ DW è¿™ä¸ªåœ°åŸºä¹‹åï¼Œæ‰èƒ½è¿›è¡Œåˆ†æä½¿ç”¨ï¼Œæœ€åäº§ç”Ÿä»·å€¼ã€‚æ•°æ®ä»“åº“å¯ä»¥è¯´æ˜¯æ•°æ®åº“çš„å‡çº§æ¦‚å¿µã€‚æ•°æ®ä»“åº“æ˜¯ä¼ä¸šçº§åˆ«çš„ï¼Œè€Œæ•°æ®åº“åˆ™æ˜¯ä¸šåŠ¡ç³»ç»Ÿå’Œå•ä¸ªé¡¹ç›®ä¸­æ‰€åº”ç”¨åˆ°çš„æŠ€æœ¯ï¼Œä»é€»è¾‘ä¸Šç†è§£ï¼Œæ•°æ®åº“å’Œæ•°æ®ä»“åº“æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œéƒ½æ˜¯é€šè¿‡æ•°æ®åº“æŠ€æœ¯æ¥å­˜å‚¨æ•°æ®çš„ã€‚ä¸è¿‡ä»æ•°é‡ä¸Šæ¥è®²ï¼Œæ•°æ®ä»“åº“çš„é‡æ›´åºå¤§ï¼Œé€‚ç”¨äºæ•°æ®æŒ–æ˜å’Œæ•°æ®åˆ†æã€‚æ•°æ®åº“å¯ä»¥ç†è§£æ˜¯ä¸€é¡¹æŠ€æœ¯ã€‚æ•°æ®ä»“åº“å°†åŸæœ‰çš„å¤šä¸ªæ•°æ®æ¥æºä¸­çš„æ•°æ®è¿›è¡Œæ±‡æ€»ã€æ•´ç†è€Œå¾—ã€‚æ•°æ®è¿›å…¥æ•°æ®ä»“åº“å‰ï¼Œå¿…é¡»æ¶ˆé™¤æ•°æ®ä¸­çš„ä¸ä¸€è‡´æ€§ï¼Œæ–¹ä¾¿åç»­è¿›è¡Œæ•°æ®åˆ†æå’ŒæŒ–æ˜ã€‚æ•°æ®æŒ–æ˜çš„è‹±æ–‡æ˜¯ Data Miningï¼Œç¼©å†™æ˜¯ DMã€‚åœ¨å•†ä¸šæ™ºèƒ½ BI ä¸­ç»å¸¸ä¼šä½¿ç”¨åˆ°æ•°æ®æŒ–æ˜æŠ€æœ¯ã€‚æ•°æ®æŒ–æ˜çš„æ ¸å¿ƒåŒ…æ‹¬åˆ†ç±»ã€èšç±»ã€é¢„æµ‹ã€å…³è”åˆ†æç­‰ä»»åŠ¡ï¼Œé€šè¿‡è¿™äº›ç‚¼é‡‘æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ•°æ®ä»“åº“ä¸­å¾—åˆ°å®è—ï¼Œæ¯”å¦‚å•†ä¸šæŠ¥å‘Šã€‚å¾ˆå¤šæ—¶å€™ï¼Œä¼ä¸šè€æ¿æ€»æ˜¯ä»¥ç»“æœä¸ºå¯¼å‘ï¼Œä»–ä»¬è®¤ä¸ºå•†ä¸šæŠ¥å‘Šæ‰æ˜¯ä»–ä»¬æƒ³è¦çš„ï¼Œä½†æ˜¯è¿™ä¹Ÿæ˜¯éœ€è¦ç»è¿‡åœ°åŸº DWã€æ¬è¿å·¥ ETLã€ç§‘å­¦å®¶ DM ç­‰å…±åŒçš„åŠªåŠ›æ‰å¾—åˆ°çš„ã€‚å…ƒæ•°æ® VS æ•°æ®å…ƒæˆ‘ä»¬å‰é¢æåˆ°äº†æ•°æ®ä»“åº“ï¼Œåœ¨æ•°æ®ä»“åº“ä¸­ï¼Œè¿˜æœ‰ä¸€ç±»é‡è¦çš„æ•°æ®æ˜¯å…ƒæ•°æ®ï¼Œé‚£ä¹ˆå®ƒå’Œæ•°æ®å…ƒæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿå…ƒæ•°æ®ï¼ˆMetaDataï¼‰ï¼šæè¿°å…¶å®ƒæ•°æ®çš„æ•°æ®ï¼Œä¹Ÿç§°ä¸ºâ€œä¸­ä»‹æ•°æ®â€ã€‚æ•°æ®å…ƒï¼ˆData Elementï¼‰ï¼šå°±æ˜¯æœ€å°æ•°æ®å•å…ƒã€‚åœ¨ç”Ÿæ´»ä¸­ï¼Œåªè¦æœ‰ä¸€ç±»äº‹ç‰©ï¼Œå°±å¯ä»¥å®šä¹‰ä¸€å¥—å…ƒæ•°æ®ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä¸€æœ¬å›¾ä¹¦çš„ä¿¡æ¯åŒ…æ‹¬äº†ä¹¦åã€ä½œè€…ã€å‡ºç‰ˆç¤¾ã€ISBNã€å‡ºç‰ˆæ—¶é—´ã€é¡µæ•°å’Œå®šä»·ç­‰å¤šä¸ªå±æ€§çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠè¿™äº›å±æ€§å®šä¹‰æˆä¸€å¥—å›¾ä¹¦çš„å…ƒæ•°æ®ã€‚åœ¨å›¾ä¹¦è¿™ä¸ªå…ƒæ•°æ®ä¸­ï¼Œä¹¦åã€ä½œè€…ã€å‡ºç‰ˆç¤¾å°±æ˜¯æ•°æ®å…ƒã€‚ä½ å¯ä»¥ç†è§£æ˜¯æœ€å°çš„æ•°æ®å•å…ƒã€‚å…ƒæ•°æ®æœ€å¤§çš„å¥½å¤„æ˜¯ä½¿ä¿¡æ¯çš„æè¿°å’Œåˆ†ç±»å®ç°äº†ç»“æ„åŒ–ï¼Œè®©æœºå™¨å¤„ç†èµ·æ¥å¾ˆæ–¹ä¾¿ã€‚å…ƒæ•°æ®å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åº”ç”¨äºæ•°æ®ä»“åº“ã€‚æ¯”å¦‚æ•°æ®ä»“åº“ä¸­æœ‰æ•°æ®å’Œæ•°æ®ä¹‹é—´çš„å„ç§å¤æ‚å…³ç³»ï¼Œä¸ºäº†æè¿°è¿™äº›å…³ç³»ï¼Œå…ƒæ•°æ®å¯ä»¥å¯¹æ•°æ®ä»“åº“çš„æ•°æ®è¿›è¡Œå®šä¹‰ï¼Œåˆ»ç”»æ•°æ®çš„æŠ½å–å’Œè½¬æ¢è§„åˆ™ï¼Œå­˜å‚¨ä¸æ•°æ®ä»“åº“ä¸»é¢˜æœ‰å…³çš„å„ç§ä¿¡æ¯ã€‚è€Œä¸”æ•´ä¸ªæ•°æ®ä»“åº“çš„è¿è¡Œéƒ½æ˜¯åŸºäºå…ƒæ•°æ®çš„ï¼Œæ¯”å¦‚æŠ½å–è°ƒåº¦æ•°æ®ã€è·å–å†å²æ•°æ®ç­‰ã€‚é€šè¿‡å…ƒæ•°æ®ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¸®åŠ©æˆ‘ä»¬ç®¡ç†æ•°æ®ä»“åº“ã€‚æ•°æ®æŒ–æ˜çš„æµç¨‹èŠå®Œäº†æ•°æ®ä»“åº“ï¼Œæˆ‘ä»¬å†æ¥è°ˆè°ˆæ•°æ®æŒ–æ˜ã€‚æ•°æ®æŒ–æ˜ä¸æ˜¯å‡­ç©ºäº§ç”Ÿçš„ï¼Œå®ƒä¸æ•°æ®åº“æŠ€æœ¯çš„å‘å±•åˆ†ä¸å¼€ã€‚æ•°æ®æŒ–æ˜çš„ä¸€ä¸ªè‹±æ–‡è§£é‡Šå« Knowledge Discovery in Databaseï¼Œç®€ç§° KDDï¼Œä¹Ÿå°±æ˜¯æ•°æ®åº“ä¸­çš„çŸ¥è¯†å‘ç°ã€‚åœ¨æ•°æ®æŒ–æ˜ä¸­ï¼Œæœ‰å‡ ä¸ªéå¸¸é‡è¦çš„ä»»åŠ¡ï¼Œå°±æ˜¯åˆ†ç±»ã€èšç±»ã€é¢„æµ‹å’Œå…³è”åˆ†æã€‚æˆ‘æ¥è§£é‡Šä¸‹è¿™äº›æ¦‚å¿µã€‚åˆ†ç±»å°±æ˜¯é€šè¿‡è®­ç»ƒé›†å¾—åˆ°ä¸€ä¸ªåˆ†ç±»æ¨¡å‹ï¼Œç„¶åç”¨è¿™ä¸ªæ¨¡å‹å¯ä»¥å¯¹å…¶ä»–æ•°æ®è¿›è¡Œåˆ†ç±»ã€‚è¿™é‡Œéœ€è¦è¯´æ˜ä¸‹è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ¦‚å¿µã€‚ä¸€èˆ¬æ¥è¯´æ•°æ®å¯ä»¥åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚è®­ç»ƒé›†æ˜¯ç”¨æ¥ç»™æœºå™¨åšè®­ç»ƒçš„ï¼Œé€šå¸¸æ˜¯äººä»¬æ•´ç†å¥½è®­ç»ƒæ•°æ®ï¼Œä»¥åŠè¿™äº›æ•°æ®å¯¹åº”çš„åˆ†ç±»æ ‡è¯†ã€‚é€šè¿‡è®­ç»ƒï¼Œæœºå™¨å°±äº§ç”Ÿäº†è‡ªæˆ‘åˆ†ç±»çš„æ¨¡å‹ï¼Œç„¶åæœºå™¨å°±å¯ä»¥æ‹¿ç€è¿™ä¸ªåˆ†ç±»æ¨¡å‹ï¼Œå¯¹æµ‹è¯•é›†ä¸­çš„æ•°æ®è¿›è¡Œåˆ†ç±»é¢„æµ‹ã€‚åŒæ ·å¦‚æœæµ‹è¯•é›†ä¸­ï¼Œäººä»¬å·²ç»ç»™å‡ºäº†æµ‹è¯•ç»“æœï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨æµ‹è¯•ç»“æœæ¥åšéªŒè¯ï¼Œä»è€Œäº†è§£åˆ†ç±»å™¨åœ¨æµ‹è¯•ç¯å¢ƒä¸‹çš„è¡¨ç°ã€‚èšç±»äººä»¥ç¾¤åˆ†ï¼Œç‰©ä»¥ç±»èšã€‚èšç±»å°±æ˜¯å°†æ•°æ®è‡ªåŠ¨èšç±»æˆå‡ ä¸ªç±»åˆ«ï¼Œèšåˆ°ä¸€èµ·çš„ç›¸ä¼¼åº¦å¤§ï¼Œä¸åœ¨ä¸€èµ·çš„å·®å¼‚æ€§å¤§ã€‚æˆ‘ä»¬å¾€å¾€åˆ©ç”¨èšç±»æ¥åšæ•°æ®åˆ’åˆ†ã€‚é¢„æµ‹é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é€šè¿‡å½“å‰å’Œå†å²æ•°æ®æ¥é¢„æµ‹æœªæ¥è¶‹åŠ¿ï¼Œå®ƒå¯ä»¥æ›´å¥½åœ°å¸®åŠ©æˆ‘ä»¬è¯†åˆ«æœºé‡å’Œé£é™©ã€‚å…³è”åˆ†æå°±æ˜¯å‘ç°æ•°æ®ä¸­çš„å…³è”è§„åˆ™ï¼Œå®ƒè¢«å¹¿æ³›åº”ç”¨åœ¨è´­ç‰©ç¯®åˆ†æï¼Œæˆ–äº‹åŠ¡æ•°æ®åˆ†æä¸­ã€‚æ¯”å¦‚æˆ‘ä»¬å¼€å¤´æåˆ°çš„é‚£ä¸ªæ¡ˆä¾‹ã€‚æ•°æ®æŒ–æ˜è¦æ€ä¹ˆå®Œæˆè¿™äº›ä»»åŠ¡å®ƒéœ€è¦å°†æ•°æ®åº“ä¸­çš„æ•°æ®ç»è¿‡ä¸€ç³»åˆ—çš„åŠ å·¥è®¡ç®—ï¼Œæœ€ç»ˆå¾—å‡ºæœ‰ç”¨çš„ä¿¡æ¯ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨ä»¥ä¸‹æ­¥éª¤æ¥æè¿°ã€‚é¦–å…ˆï¼Œè¾“å…¥æˆ‘ä»¬æ”¶é›†åˆ°çš„æ•°æ®ï¼Œç„¶åå¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚é¢„å¤„ç†é€šå¸¸æ˜¯å°†æ•°æ®è½¬åŒ–æˆæˆ‘ä»¬æƒ³è¦çš„æ ¼å¼ï¼Œç„¶åæˆ‘ä»¬å†å¯¹æ•°æ®è¿›è¡ŒæŒ–æ˜ï¼Œæœ€åé€šè¿‡åå¤„ç†å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ã€‚é‚£ä½ å¯èƒ½æƒ³é—®ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥è¿›è¡Œæ•°æ®æŒ–æ˜ï¼Œè¿˜è¦è¿›è¡Œæ•°æ®é¢„å¤„ç†å‘¢ï¼Ÿå› ä¸ºåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¾“å…¥çš„æ•°æ®é€šå¸¸æ˜¯ä»ä¸åŒæ¸ é“é‡‡é›†è€Œæ¥çš„ï¼Œæ‰€ä»¥æ•°æ®çš„æ ¼å¼ä»¥åŠè´¨é‡æ˜¯å‚å·®ä¸é½çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚æ•°æ®é¢„å¤„ç†ä¸­ï¼Œæˆ‘ä»¬ä¼šå¯¹æ•°æ®è¿›è¡Œå‡ ä¸ªå¤„ç†æ­¥éª¤ï¼šæ•°æ®æ¸…æ´—ï¼Œæ•°æ®é›†æˆï¼Œä»¥åŠæ•°æ®å˜æ¢ã€‚æ•°æ®æ¸…æ´—ä¸»è¦æ˜¯ä¸ºäº†å»é™¤é‡å¤æ•°æ®ï¼Œå»å™ªå£°ï¼ˆå³å¹²æ‰°æ•°æ®ï¼‰ä»¥åŠå¡«å……ç¼ºå¤±å€¼ã€‚æ•°æ®é›†æˆæ˜¯å°†å¤šä¸ªæ•°æ®æºä¸­çš„æ•°æ®å­˜æ”¾åœ¨ä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®å­˜å‚¨ä¸­ã€‚æ•°æ®å˜æ¢å°±æ˜¯å°†æ•°æ®è½¬æ¢æˆé€‚åˆæ•°æ®æŒ–æ˜çš„å½¢å¼ã€‚æ¯”å¦‚ï¼Œé€šè¿‡å½’ä¸€åŒ–å°†å±æ€§æ•°æ®æŒ‰ç…§æ¯”ä¾‹ç¼©æ”¾ï¼Œè¿™æ ·å°±å¯ä»¥å°†æ•°å€¼è½å…¥ä¸€ä¸ªç‰¹å®šçš„åŒºé—´å†…ï¼Œæ¯”å¦‚ 01 ä¹‹é—´ã€‚æˆ‘ä¼šåœ¨åé¢çš„å‡ èŠ‚è¯¾ç»™ä½ è®²è§£å¦‚ä½•å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚æ•°æ®åå¤„ç†æ˜¯å°†æ¨¡å‹é¢„æµ‹çš„ç»“æœè¿›ä¸€æ­¥å¤„ç†åï¼Œå†å¯¼å‡ºã€‚æ¯”å¦‚åœ¨äºŒåˆ†ç±»é—®é¢˜ä¸­ï¼Œä¸€èˆ¬èƒ½å¾—åˆ°çš„æ˜¯ 01 ä¹‹é—´çš„æ¦‚ç‡å€¼ï¼Œæ­¤æ—¶æŠŠæ•°æ®ä»¥ 0.5 ä¸ºç•Œé™è¿›è¡Œå››èˆäº”å…¥å°±å¯ä»¥å®ç°åå¤„ç†ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[]},{"title":"NLP word vector - word2vec","slug":"NLP-word-vector-word2vec","date":"2018-06-25T14:07:35.000Z","updated":"2020-04-04T11:05:38.947Z","comments":true,"path":"2018/06/25/NLP-word-vector-word2vec/","link":"","permalink":"cpeixin.cn/2018/06/25/NLP-word-vector-word2vec/","excerpt":"","text":"word vectorFirstly, in recent years, word vector is the basic knowledge of NLP, which is also very important.Among them, words or phrases from vocabulary are mapped to vectors of real Numbers, which is to translate human language symbols into Numbers that can be calculated by machines, which can improve the quality of machine translation.For example, word_1 is expressed as a vector [0,0,1] in articles and statements. There are many models or tools for word-to-vector transformation. Eg: one-hot, n-gram, word2vecword2vecWord2vec is a toolWord2vec contains two models skp-gram and CBOW, as well as two efficient training methods negative sampling and hiearchical softmax. Why introduce word2vec separately, because it can well express the similarity and analogy between different wordsé¡ºä¾¿è¯´è¯´è¿™ä¸¤ä¸ªè¯­è¨€æ¨¡å‹ã€‚ç»Ÿè®¡è¯­è¨€æ¨¡å‹statistical language modelå°±æ˜¯ç»™ä½ å‡ ä¸ªè¯ï¼Œåœ¨è¿™å‡ ä¸ªè¯å‡ºç°çš„å‰æä¸‹æ¥è®¡ç®—æŸä¸ªè¯å‡ºç°çš„ï¼ˆäº‹åï¼‰æ¦‚ç‡ã€‚CBOWä¹Ÿæ˜¯ç»Ÿè®¡è¯­è¨€æ¨¡å‹çš„ä¸€ç§ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æ ¹æ®æŸä¸ªè¯å‰é¢çš„Cä¸ªè¯æˆ–è€…å‰åCä¸ªè¿ç»­çš„è¯ï¼Œæ¥è®¡ç®—æŸä¸ªè¯å‡ºç°çš„æ¦‚ç‡ã€‚Skip-Gram Modelç›¸åï¼Œæ˜¯æ ¹æ®æŸä¸ªè¯ï¼Œç„¶ååˆ†åˆ«è®¡ç®—å®ƒå‰åå‡ºç°æŸå‡ ä¸ªè¯çš„å„ä¸ªæ¦‚ç‡ã€‚ä»¥â€œæˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨â€è¿™å¥è¯ä¸ºä¾‹ã€‚å‡è®¾æˆ‘ä»¬ç°åœ¨å…³æ³¨çš„è¯æ˜¯â€œçˆ±â€ï¼ŒCï¼2æ—¶å®ƒçš„ä¸Šä¸‹æ–‡åˆ†åˆ«æ˜¯â€œæˆ‘â€ï¼Œâ€œåŒ—äº¬å¤©å®‰é—¨â€ã€‚CBOWæ¨¡å‹å°±æ˜¯æŠŠâ€œæˆ‘â€ â€œåŒ—äº¬å¤©å®‰é—¨â€ çš„one hotè¡¨ç¤ºæ–¹å¼ä½œä¸ºè¾“å…¥ï¼Œä¹Ÿå°±æ˜¯Cä¸ª1xVçš„å‘é‡ï¼Œåˆ†åˆ«è·ŸåŒä¸€ä¸ªVxNçš„å¤§å°çš„ç³»æ•°çŸ©é˜µW1ç›¸ä¹˜å¾—åˆ°Cä¸ª1xNçš„éšè—å±‚hidden layerï¼Œç„¶åCä¸ªå–å¹³å‡æ‰€ä»¥åªç®—ä¸€ä¸ªéšè—å±‚ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿè¢«ç§°ä¸ºçº¿æ€§æ¿€æ´»å‡½æ•°(è¿™ä¹Ÿç®—æ¿€æ´»å‡½æ•°ï¼Ÿåˆ†æ˜å°±æ˜¯æ²¡æœ‰æ¿€æ´»å‡½æ•°äº†)ã€‚ç„¶åå†è·Ÿå¦ä¸€ä¸ªNxVå¤§å°çš„ç³»æ•°çŸ©é˜µW2ç›¸ä¹˜å¾—åˆ°1xVçš„è¾“å‡ºå±‚ï¼Œè¿™ä¸ªè¾“å‡ºå±‚æ¯ä¸ªå…ƒç´ ä»£è¡¨çš„å°±æ˜¯è¯åº“é‡Œæ¯ä¸ªè¯çš„äº‹åæ¦‚ç‡ã€‚è¾“å‡ºå±‚éœ€è¦è·Ÿground truthä¹Ÿå°±æ˜¯â€œçˆ±â€çš„one hotå½¢å¼åšæ¯”è¾ƒè®¡ç®—lossã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„å°±æ˜¯Vé€šå¸¸æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°æ¯”å¦‚å‡ ç™¾ä¸‡ï¼Œè®¡ç®—èµ·æ¥ç›¸å½“è´¹æ—¶é—´ï¼Œé™¤äº†â€œçˆ±â€é‚£ä¸ªä½ç½®çš„å…ƒç´ è‚¯å®šè¦ç®—åœ¨lossé‡Œé¢ï¼Œword2vecå°±ç”¨åŸºäºhuffmanç¼–ç çš„Hierarchical softmaxç­›é€‰æ‰äº†ä¸€éƒ¨åˆ†ä¸å¯èƒ½çš„è¯ï¼Œç„¶ååˆç”¨nagetive sampingå†å»æ‰äº†ä¸€äº›è´Ÿæ ·æœ¬çš„è¯æ‰€ä»¥æ—¶é—´å¤æ‚åº¦å°±ä»O(V)å˜æˆäº†O(logV)ã€‚Skip gramè®­ç»ƒè¿‡ç¨‹ç±»ä¼¼ï¼Œåªä¸è¿‡è¾“å…¥è¾“å‡ºåˆšå¥½ç›¸åã€‚","categories":[{"name":"NLP","slug":"NLP","permalink":"cpeixin.cn/categories/NLP/"}],"tags":[{"name":"è¯å‘é‡","slug":"è¯å‘é‡","permalink":"cpeixin.cn/tags/%E8%AF%8D%E5%90%91%E9%87%8F/"}]},{"title":"Flink SQL","slug":"Flink-SQL","date":"2018-06-07T16:56:14.000Z","updated":"2020-06-07T16:57:53.543Z","comments":true,"path":"2018/06/08/Flink-SQL/","link":"","permalink":"cpeixin.cn/2018/06/08/Flink-SQL/","excerpt":"","text":"Flink SQLè¿™é‡Œå†…å®¹è¾ƒå°‘ï¼Œå¹¶ä¸”é™¤äº†çª—å£å®šä¹‰ä¸Šå’Œå…¶ä»–æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œå…¶ä½™çš„éƒ½æ˜¯å¤§å®¶ç†Ÿæ‚‰çš„SQLè¯­å¥ï¼Œæˆ–è€…æ˜¯ç†Ÿæ‚‰çš„ç®—å­ã€‚è¿™é‡Œç›´æ¥å†™å‡ºä¸¤ä¸ªå®ä¾‹ï¼Œè¿˜æ˜¯å’Œä»¥å‰çš„éœ€æ±‚ä¸€æ ·ï¼Œæ±‚æ»šåŠ¨çª—å£æˆ–è€…æ»‘åŠ¨çª—å£ï¼Œç”¨æˆ·å¯¹åº”çš„æ¸¸æˆæ€»å¾—åˆ†ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364package SQLimport org.apache.flink.streaming.api.TimeCharacteristicimport org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractorimport org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment, _&#125;import org.apache.flink.streaming.api.windowing.time.Timeimport org.apache.flink.table.api.scala.StreamTableEnvironmentimport org.apache.flink.table.api.&#123;EnvironmentSettings, Table, Tumble&#125;import org.apache.flink.types.Rowobject sql_stream_window &#123; case class GameData(user_id: String, game_id: String, game_time: Long, game_score: Int) def main(args: Array[String]): Unit = &#123; val stream_env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment stream_env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime) val settings: EnvironmentSettings = EnvironmentSettings.newInstance().useOldPlanner().inStreamingMode().build() val table_env: StreamTableEnvironment = StreamTableEnvironment.create(stream_env, settings) stream_env.setParallelism(1) val socketStream: DataStream[String] = stream_env.socketTextStream(\"localhost\", 8888) val gameStream: DataStream[GameData] = socketStream.map((line: String) =&gt; &#123; val array_data: Array[String] = line.split(\",\") GameData(array_data(0), array_data(1), array_data(2).toLong, array_data(3).toInt) &#125;).assignTimestampsAndWatermarks(new BoundedOutOfOrdernessTimestampExtractor[GameData](Time.seconds(3)) &#123; override def extractTimestamp(element: GameData): Long = &#123; element.game_time &#125; &#125;) import org.apache.flink.table.api.scala._ table_env.registerDataStream(\"t_game_detail\", gameStream, 'user_id, 'game_id, 'game_time.rowtime, 'game_score) //æ»šåŠ¨çª—å£ // val game_score_sum: Table = table_env // .sqlQuery(\"select user_id, \" + // \"sum(game_score) \" + // \"from t_game_detail \" + // \"group by tumble(game_time, interval '5' second), user_id\") // æ»‘åŠ¨çª—å£ // val game_score_sum: Table = table_env.sqlQuery(\"select user_id, \" + // \"sum(game_score) \" + // \"from t_game_detail \" + // \"group by hop(game_time, interval '5' second, interval '10' second), user_id\") // æ»‘åŠ¨çª—å£ï¼Œæ‰“å°çª—å£æ—¶é—´ val game_score_sum: Table = table_env.sqlQuery(\"select user_id, \" + \"hop_start(game_time, interval '5' second, interval '10' second),\" + \"hop_end(game_time, interval '5' second, interval '10' second),\" + \"sum(game_score) \" + \"from t_game_detail \" + \"group by hop(game_time, interval '5' second, interval '10' second), user_id\") table_env .toRetractStream[Row](game_score_sum) .filter((_: (Boolean, Row))._1 == true) .print(\"user_sum_score\") table_env.execute(\"user_sum_scoreâ€”â€”job\") &#125;&#125;","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Flink Table API  windowæ“ä½œ","slug":"Flink-Table-API-windowæ“ä½œ","date":"2018-06-07T09:13:04.000Z","updated":"2020-06-07T09:14:24.656Z","comments":true,"path":"2018/06/07/Flink-Table-API-windowæ“ä½œ/","link":"","permalink":"cpeixin.cn/2018/06/07/Flink-Table-API-window%E6%93%8D%E4%BD%9C/","excerpt":"","text":"Table APIæ˜¯ç”¨äºæµå’Œæ‰¹å¤„ç†çš„ç»Ÿä¸€çš„å…³ç³»APIã€‚Table APIæŸ¥è¯¢å¯ä»¥ç›´æ¥åœ¨æ‰¹å¤„ç†æˆ–æµè¾“å…¥ä¸Šè¿è¡Œè€Œæ— éœ€ä¿®æ”¹ã€‚Table APIæ˜¯SQLè¯­è¨€çš„è¶…é›†ï¼Œæ˜¯ä¸“é—¨ä¸ºä¸Apache Flinké…åˆä½¿ç”¨è€Œè®¾è®¡çš„ã€‚Table APIæ˜¯ç”¨äºScalaå’ŒJavaçš„è¯­è¨€é›†æˆçš„APIã€‚Table APIæŸ¥è¯¢ä¸æ˜¯å°†æŸ¥è¯¢æŒ‡å®šä¸ºSQLï¼Œè€Œæ˜¯ä»¥Javaæˆ–Scalaä¸­çš„è¯­è¨€åµŒå…¥æ ·å¼å®šä¹‰ï¼Œå¹¶å…·æœ‰IDEæ”¯æŒï¼Œä¾‹å¦‚è‡ªåŠ¨å®Œæˆå’Œè¯­æ³•éªŒè¯ã€‚Table APIä¸Flinkçš„SQLé›†æˆå…±äº«å…¶APIçš„è®¸å¤šæ¦‚å¿µå’Œéƒ¨åˆ†ã€‚çœ‹ä¸€ä¸‹Common Conceptsï¼†APIï¼Œäº†è§£å¦‚ä½•æ³¨å†Œè¡¨æˆ–åˆ›å»ºTableå¯¹è±¡ã€‚â€œ æµæ¦‚å¿µâ€é¡µé¢è®¨è®ºäº†æµçš„ç‰¹å®šæ¦‚å¿µï¼Œä¾‹å¦‚åŠ¨æ€è¡¨å’Œæ—¶é—´å±æ€§ã€‚ä¸‹é¢æˆ‘ä»¬å°†è¿›è¡ŒTable APIåœ¨æµå¼å¤„ç†ä¸­çš„æ“ä½œï¼Œåœ¨å®é™…çš„å·¥ä½œä¸­ï¼ŒFlinkä¹Ÿæ˜¯å¤§å¤šæ•°åœºæ™¯éƒ½æ˜¯åœ¨æµè®¡ç®—ä¸­ä½¿ç”¨ã€‚Group Windowsâ€œGroupâ€çª—å£æ ¹æ®æ—¶é—´æˆ–è¡Œè®¡æ•°é—´éš”å°†ç»„è¡Œèšåˆä¸ºæœ‰é™çš„ç»„ï¼Œå¹¶æ¯ç»„è¯„ä¼°ä¸€æ¬¡èšåˆå‡½æ•°ã€‚å¯¹äºæ‰¹å¤„ç†è¡¨ï¼Œçª—å£æ˜¯æŒ‰æ—¶é—´é—´éš”å¯¹è®°å½•è¿›è¡Œåˆ†ç»„çš„ä¾¿æ·å¿«æ·æ–¹å¼ã€‚Windowsæ˜¯ä½¿ç”¨è¯¥window(w: GroupWindow)å­å¥å®šä¹‰çš„ï¼Œå¹¶ä¸”éœ€è¦ä½¿ç”¨è¯¥aså­å¥æŒ‡å®šçš„åˆ«åã€‚ä¸ºäº†æŒ‰çª—å£å¯¹è¡¨è¿›è¡Œåˆ†ç»„ï¼Œå¿…é¡»åœ¨groupBy(â€¦)å­å¥ä¸­åƒå¸¸è§„åˆ†ç»„å±æ€§ä¸€æ ·å¼•ç”¨çª—å£åˆ«åã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨è¡¨ä¸Šå®šä¹‰çª—å£èšåˆã€‚1234val table = input .window([w: GroupWindow] as 'w) // define window with alias w .groupBy('w) // group the table by window w .select('b.sum) // aggregateåœ¨æµç¯å¢ƒä¸­ï¼Œå¦‚æœçª—å£èšåˆé™¤å¯¹çª—å£ä»¥å¤–çš„ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§è¿›è¡Œåˆ†ç»„ï¼Œåˆ™åªèƒ½å¹¶è¡Œè®¡ç®—çª—å£èšåˆï¼Œå³ï¼ŒgroupBy(â€¦)å­å¥å¼•ç”¨äº†çª—å£åˆ«åå’Œè‡³å°‘ä¸€ä¸ªå…¶ä»–å±æ€§ã€‚groupBy(â€¦)å­å¥ä»…å¼•ç”¨ä¸€ä¸ªçª—å£åˆ«åï¼ˆå¦‚åœ¨ä¸Šé¢çš„ä¾‹å­ï¼‰åªèƒ½ç”±ä¸€ä¸ªå•ä¸€çš„ï¼Œéå¹³è¡Œçš„ä»»åŠ¡è¿›è¡Œè¯„ä¼°ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä½¿ç”¨å…¶ä»–åˆ†ç»„å±æ€§å®šä¹‰çª—å£èšåˆã€‚1234val table = input .window([w: GroupWindow] as 'w) // define window with alias w .groupBy('w, 'a) // group the table by attribute a and window w .select('a, 'b.sum) // aggregateçª—å£å±æ€§è¯¸å¦‚å¼€å§‹ï¼Œç»“æŸï¼Œæˆ–ä¸€ä¸ªæ—¶é—´çª—å£çš„rowtimeæ—¶é—´æˆ³å¯ä»¥åœ¨é€‰æ‹©è¯­å¥è¢«æ·»åŠ ä¸ºçª—å£åˆ«åä½œä¸ºçš„ä¸€ä¸ªå±æ€§w.startï¼Œw.endä»¥åŠw.rowtimeåˆ†åˆ«ã€‚çª—å£å¼€å§‹å’Œè¡Œæ—¶é—´æ—¶é—´æˆ³æ˜¯åŒ…å«çª—å£çš„ä¸Šä¸‹è¾¹ç•Œã€‚ç›¸åï¼Œçª—å£ç»“æŸæ—¶é—´æˆ³æ˜¯å”¯ä¸€çš„çª—å£ä¸Šè¾¹ç•Œã€‚ä¾‹å¦‚ï¼Œä»ä¸‹åˆ2ç‚¹å¼€å§‹çš„30åˆ†é’Ÿæ»šåŠ¨çª—å£å°†å…·æœ‰14:00:00.000å¼€å§‹æ—¶é—´æˆ³è®°ï¼Œ14:29:59.999è¡Œæ—¶é—´æ—¶é—´æˆ³è®°å’Œ14:30:00.000ç»“æŸæ—¶é—´æˆ³è®°ã€‚1234val table = input .window([w: GroupWindow] as 'w) // define window with alias w .groupBy('w, 'a) // group the table by attribute a and window w .select('a, 'w.start, 'w.end, 'w.rowtime, 'b.count) // aggregate and add window start, end, and rowtime timestampsè¯¥Windowå‚æ•°å®šä¹‰è¡Œå¦‚ä½•æ˜ å°„åˆ°çª—å£ã€‚Windowä¸æ˜¯ç”¨æˆ·å¯ä»¥å®ç°çš„æ¥å£ã€‚ç›¸åï¼ŒTable APIæä¾›äº†ä¸€ç»„Windowå…·æœ‰ç‰¹å®šè¯­ä¹‰çš„é¢„å®šä¹‰ç±»ï¼Œè¿™äº›é¢„å®šä¹‰ç±»è¢«è½¬æ¢ä¸ºåŸºç¡€DataStreamæˆ–DataSetæ“ä½œã€‚æ”¯æŒçš„çª—å£å®šä¹‰åœ¨ä¸‹é¢åˆ—å‡ºã€‚Tumbling Windowsæ»šåŠ¨çª—å£å°†è¡Œåˆ†é…ç»™å›ºå®šé•¿åº¦çš„éé‡å è¿ç»­çª—å£ã€‚ä¾‹å¦‚ï¼Œ5åˆ†é’Ÿçš„æ»šåŠ¨çª—å£ä»¥5åˆ†é’Ÿä¸ºé—´éš”å¯¹è¡Œè¿›è¡Œåˆ†ç»„ã€‚å¯ä»¥åœ¨äº‹ä»¶æ—¶é—´ï¼Œå¤„ç†æ—¶é—´æˆ–è¡Œæ•°ä¸Šå®šä¹‰æ»šåŠ¨çª—å£ã€‚æ»šåŠ¨çª—å£æ˜¯ä½¿ç”¨ä»¥ä¸‹Tumbleç±»å®šä¹‰çš„ï¼šæ–¹æ³•æè¿°overå°†çª—å£çš„é•¿åº¦å®šä¹‰ä¸ºæ—¶é—´æˆ–è¡Œè®¡æ•°é—´éš”ã€‚onç”¨äºåˆ†ç»„ï¼ˆæ—¶é—´é—´éš”ï¼‰æˆ–æ’åºï¼ˆè¡Œè®¡æ•°ï¼‰çš„æ—¶é—´å±æ€§ã€‚å¯¹äºæ‰¹æŸ¥è¯¢ï¼Œå®ƒå¯ä»¥æ˜¯ä»»ä½•Longæˆ–Timestampå±æ€§ã€‚å¯¹äºæµæŸ¥è¯¢ï¼Œå®ƒå¿…é¡»æ˜¯å£°æ˜çš„event-timeæˆ–processing-time timeå±æ€§ã€‚asä¸ºçª—å£åˆ†é…åˆ«åã€‚åˆ«åç”¨äºåœ¨ä»¥ä¸‹groupBy()å­å¥ä¸­å¼•ç”¨çª—å£ï¼Œå¹¶å¯ä»¥é€‰æ‹©åœ¨å­å¥ä¸­é€‰æ‹©çª—å£å±æ€§ï¼Œä¾‹å¦‚çª—å£å¼€å§‹ï¼Œç»“æŸæˆ–è¡Œæ—¶é—´æ—¶é—´æˆ³select()ã€‚123456&#x2F;&#x2F; Tumbling Event-time Window.window(Tumble over 10.minutes on &#39;rowtime as &#39;w)&#x2F;&#x2F; Tumbling Processing-time Window (assuming a processing-time attribute &quot;proctime&quot;).window(Tumble over 10.minutes on &#39;proctime as &#39;w)&#x2F;&#x2F; Tumbling Row-count Window (assuming a processing-time attribute &quot;proctime&quot;).window(Tumble over 10.rows on &#39;proctime as &#39;w)Sliding Windowsæ»‘åŠ¨çª—å£çš„å¤§å°å›ºå®šï¼Œå¹¶ä»¥æŒ‡å®šçš„æ»‘åŠ¨é—´éš”æ»‘åŠ¨ã€‚å¦‚æœæ»‘åŠ¨é—´éš”å°äºçª—å£å¤§å°ï¼Œåˆ™æ»‘åŠ¨çª—å£é‡å ã€‚å› æ­¤ï¼Œå¯ä»¥å°†è¡Œåˆ†é…ç»™å¤šä¸ªçª—å£ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª15åˆ†é’Ÿå¤§å°çš„æ»‘åŠ¨çª—å£å’Œ5åˆ†é’Ÿçš„æ»‘åŠ¨é—´éš”å°†æ¯è¡Œåˆ†é…ç»™3ä¸ª15åˆ†é’Ÿå¤§å°çš„ä¸åŒçª—å£ï¼Œè¿™äº›çª—å£ä»¥5åˆ†é’Ÿçš„é—´éš”è¿›è¡Œè¯„ä¼°ã€‚å¯ä»¥åœ¨äº‹ä»¶æ—¶é—´ï¼Œå¤„ç†æ—¶é—´æˆ–è¡Œæ•°ä¸Šå®šä¹‰æ»‘åŠ¨çª—å£ã€‚æ»‘åŠ¨çª—å£æ˜¯é€šè¿‡ä½¿ç”¨ä»¥ä¸‹Slideç±»æ¥å®šä¹‰çš„ï¼šæ–¹æ³•æè¿°overå°†çª—å£çš„é•¿åº¦å®šä¹‰ä¸ºæ—¶é—´æˆ–è¡Œè®¡æ•°é—´éš”ã€‚everyå°†å¹»ç¯ç‰‡é—´éš”å®šä¹‰ä¸ºæ—¶é—´é—´éš”æˆ–è¡Œè®¡æ•°é—´éš”ã€‚æ»‘åŠ¨é—´éš”å¿…é¡»ä¸å°ºå¯¸é—´éš”å…·æœ‰ç›¸åŒçš„ç±»å‹ã€‚onç”¨äºåˆ†ç»„ï¼ˆæ—¶é—´é—´éš”ï¼‰æˆ–æ’åºï¼ˆè¡Œè®¡æ•°ï¼‰çš„æ—¶é—´å±æ€§ã€‚å¯¹äºæ‰¹æŸ¥è¯¢ï¼Œå®ƒå¯ä»¥æ˜¯ä»»ä½•Longæˆ–Timestampå±æ€§ã€‚å¯¹äºæµæŸ¥è¯¢ï¼Œå®ƒå¿…é¡»æ˜¯å£°æ˜çš„event-timeæˆ–processing-time timeå±æ€§ã€‚asä¸ºçª—å£åˆ†é…åˆ«åã€‚åˆ«åç”¨äºåœ¨ä»¥ä¸‹groupBy()å­å¥ä¸­å¼•ç”¨çª—å£ï¼Œå¹¶å¯ä»¥é€‰æ‹©åœ¨å­å¥ä¸­é€‰æ‹©çª—å£å±æ€§ï¼Œä¾‹å¦‚çª—å£å¼€å§‹ï¼Œç»“æŸæˆ–è¡Œæ—¶é—´æ—¶é—´æˆ³select()ã€‚123456// Sliding Event-time Window.window(Slide over 10.minutes every 5.minutes on 'rowtime as 'w)// Sliding Processing-time window (assuming a processing-time attribute \"proctime\").window(Slide over 10.minutes every 5.minutes on 'proctime as 'w)// Sliding Row-count window (assuming a processing-time attribute \"proctime\").window(Slide over 10.rows every 5.rows on 'proctime as 'w)Session Windowsä¼šè¯çª—å£æ²¡æœ‰å›ºå®šçš„å¤§å°ï¼Œä½†æ˜¯å…¶è¾¹ç•Œç”±ä¸æ´»åŠ¨çš„æ—¶é—´é—´éš”å®šä¹‰ï¼Œå³ï¼Œå¦‚æœåœ¨å®šä¹‰çš„é—´éš”æ—¶é—´æ®µå†…æœªå‡ºç°ä»»ä½•äº‹ä»¶ï¼Œåˆ™ä¼šè¯çª—å£å…³é—­ã€‚ä¾‹å¦‚ï¼Œé—´éš”30åˆ†é’Ÿçš„ä¼šè¯çª—å£åœ¨30åˆ†é’Ÿä¸æ´»åŠ¨åè§‚å¯Ÿåˆ°ä¸€è¡Œæ—¶å¼€å§‹ï¼ˆå¦åˆ™è¯¥è¡Œå°†è¢«æ·»åŠ åˆ°ç°æœ‰çª—å£ï¼‰ï¼Œå¦‚æœåœ¨30åˆ†é’Ÿå†…æœªæ·»åŠ ä»»ä½•è¡Œï¼Œåˆ™å…³é—­è¯¥çª—å£ã€‚ä¼šè¯çª—å£å¯ä»¥åœ¨äº‹ä»¶æ—¶é—´æˆ–å¤„ç†æ—¶é—´å·¥ä½œã€‚é€šè¿‡ä½¿ç”¨ä»¥ä¸‹Sessionç±»å®šä¹‰ä¼šè¯çª—å£ï¼šæ–¹æ³•æè¿°withGapå°†ä¸¤ä¸ªçª—å£ä¹‹é—´çš„é—´éš”å®šä¹‰ä¸ºæ—¶é—´é—´éš”ã€‚onç”¨äºåˆ†ç»„ï¼ˆæ—¶é—´é—´éš”ï¼‰æˆ–æ’åºï¼ˆè¡Œè®¡æ•°ï¼‰çš„æ—¶é—´å±æ€§ã€‚å¯¹äºæ‰¹æŸ¥è¯¢ï¼Œå®ƒå¯ä»¥æ˜¯ä»»ä½•Longæˆ–Timestampå±æ€§ã€‚å¯¹äºæµæŸ¥è¯¢ï¼Œå®ƒå¿…é¡»æ˜¯å£°æ˜çš„event-timeæˆ–processing-time timeå±æ€§ã€‚asä¸ºçª—å£åˆ†é…åˆ«åã€‚åˆ«åç”¨äºåœ¨ä»¥ä¸‹groupBy()å­å¥ä¸­å¼•ç”¨çª—å£ï¼Œå¹¶å¯ä»¥é€‰æ‹©åœ¨å­å¥ä¸­é€‰æ‹©çª—å£å±æ€§ï¼Œä¾‹å¦‚çª—å£å¼€å§‹ï¼Œç»“æŸæˆ–è¡Œæ—¶é—´æ—¶é—´æˆ³select()ã€‚1234// Session Event-time Window.window(Session withGap 10.minutes on 'rowtime as 'w)// Session Processing-time Window (assuming a processing-time attribute \"proctime\").window(Session withGap 10.minutes on 'proctime as 'w)Over Windowsçª—å£èšåˆæ˜¯æ ‡å‡†SQLï¼ˆOVERå­å¥ï¼‰ä¸­å·²çŸ¥çš„ï¼Œå¹¶åœ¨SELECTæŸ¥è¯¢çš„å­å¥ä¸­å®šä¹‰ã€‚ä¸åœ¨GROUP BYå­å¥ä¸­æŒ‡å®šçš„ç»„çª—å£ä¸åŒï¼Œåœ¨çª—å£ä¸Šæ–¹ä¸ä¼šæŠ˜å è¡Œã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œåœ¨çª—å£èšåˆä¸­ï¼Œä¸ºæ¯ä¸ªè¾“å…¥è¡Œåœ¨å…¶ç›¸é‚»è¡Œçš„èŒƒå›´å†…è®¡ç®—ä¸€ä¸ªèšåˆã€‚çª—å£æ˜¯ä½¿ç”¨window(w: OverWindow)å­å¥ï¼ˆover_window(OverWindow)åœ¨Python APIä¸­ä½¿ç”¨ï¼‰å®šä¹‰çš„ï¼Œå¹¶é€šè¿‡select()æ–¹æ³•ä¸­çš„åˆ«åè¿›è¡Œå¼•ç”¨ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨è¡¨ä¸Šå®šä¹‰çª—å£èšåˆ123val table = input .window([w: OverWindow] as 'w) // define over window with alias w .select('a, 'b.sum over 'w, 'c.min over 'w) // aggregate over the over window wOverWindowåœ¨é™å®šèŒƒå›´å†…çš„æ•°æ®å¯¹å…¶è¿›è¡Œèšåˆè®¡ç®—ã€‚OverWindowä¸æ˜¯ç”¨æˆ·å¯ä»¥å®ç°çš„æ¥å£ã€‚ç›¸åï¼ŒTable APIæä¾›äº†Overç”¨äºé…ç½®ä¸Šæ–¹çª—å£å±æ€§çš„ç±»ã€‚å¯ä»¥åœ¨äº‹ä»¶æ—¶é—´æˆ–å¤„ç†æ—¶é—´ä»¥åŠæŒ‡å®šä¸ºæ—¶é—´é—´éš”æˆ–è¡Œè®¡æ•°çš„èŒƒå›´ä¸Šå®šä¹‰çª—å£ä¸Šæ–¹ã€‚å—æ”¯æŒçš„overçª—å£å®šä¹‰ä½œä¸ºOverï¼ˆå’Œå…¶ä»–ç±»ï¼‰ä¸Šçš„æ–¹æ³•å…¬å¼€ï¼Œå¹¶åœ¨ä¸‹é¢åˆ—å‡ºï¼šæ–¹æ³•éœ€è¦æè¿°partitionByå¯é€‰çš„åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§ä¸Šå®šä¹‰è¾“å…¥çš„åˆ†åŒºã€‚æ¯ä¸ªåˆ†åŒºéƒ½ç»è¿‡å•ç‹¬æ’åºï¼Œå¹¶ä¸”èšåˆå‡½æ•°åˆ†åˆ«åº”ç”¨äºæ¯ä¸ªåˆ†åŒºã€‚æ³¨æ„ï¼šåœ¨æµç¯å¢ƒä¸­ï¼Œä»…å½“çª—å£åŒ…å«partition byå­å¥æ—¶ï¼Œæ‰å¯ä»¥å¹¶è¡Œè®¡ç®—æ•´ä¸ªçª—å£èšåˆã€‚å¦‚æœæ²¡æœ‰partitionBy(...)æµï¼Œåˆ™ç”±å•ä¸ªéå¹¶è¡Œä»»åŠ¡å¤„ç†ã€‚orderByéœ€è¦å®šä¹‰æ¯ä¸ªåˆ†åŒºå†…çš„è¡Œé¡ºåºï¼Œä»è€Œå®šä¹‰å°†èšåˆå‡½æ•°åº”ç”¨äºè¡Œçš„é¡ºåºã€‚æ³¨æ„ï¼šå¯¹äºæµæŸ¥è¯¢ï¼Œå®ƒå¿…é¡»æ˜¯å£°æ˜çš„event-timeæˆ–processing-time timeå±æ€§ã€‚å½“å‰ï¼Œä»…æ”¯æŒå•ä¸ªsortå±æ€§ã€‚precedingå¯é€‰çš„å®šä¹‰çª—å£ä¸­åŒ…å«çš„å¹¶åœ¨å½“å‰è¡Œä¹‹å‰çš„è¡Œçš„é—´éš”ã€‚è¯¥é—´éš”å¯ä»¥æŒ‡å®šä¸ºæ—¶é—´é—´éš”æˆ–è¡Œè®¡æ•°é—´éš”ã€‚ç”¨æ—¶é—´é—´éš”çš„å¤§å°ï¼ˆä¾‹å¦‚ï¼Œ10.minutesæ—¶é—´é—´éš”æˆ–10.rowsè¡Œè®¡æ•°é—´éš”ï¼‰æŒ‡å®šçª—å£è¾¹ç•Œã€‚çª—å£ä¸Šçš„æ— è¾¹ç•Œæ˜¯ä½¿ç”¨å¸¸é‡æŒ‡å®šçš„ï¼Œå³UNBOUNDED_RANGEç”¨äºæ—¶é—´é—´éš”æˆ–UNBOUNDED_ROWç”¨äºè¡Œè®¡æ•°é—´éš”ã€‚Windowsä¸Šçš„æ— è¾¹ç•Œä»åˆ†åŒºçš„ç¬¬ä¸€è¡Œå¼€å§‹ã€‚å¦‚æœprecedingæ¡æ¬¾è¢«çœç•¥ï¼ŒUNBOUNDED_RANGEå¹¶ä¸”CURRENT_RANGEè¢«ç”¨ä½œé»˜è®¤precedingå’Œfollowingç”¨äºè¯¥çª—å£ã€‚followingå¯é€‰çš„å®šä¹‰çª—å£ä¸­åŒ…å«å¹¶ç´§éšå½“å‰è¡Œçš„è¡Œçš„çª—å£é—´éš”ã€‚è¯¥é—´éš”å¿…é¡»ä¸å‰é¢çš„é—´éš”ï¼ˆæ—¶é—´æˆ–è¡Œè®¡æ•°ï¼‰ä»¥ç›¸åŒçš„å•ä½æŒ‡å®šã€‚ç›®å‰ï¼Œä¸æ”¯æŒå…·æœ‰å½“å‰è¡Œä¹‹åçš„è¡Œçš„çª—å£ã€‚ç›¸åï¼Œæ‚¨å¯ä»¥æŒ‡å®šä¸¤ä¸ªå¸¸é‡ä¹‹ä¸€ï¼š- CURRENT_ROW å°†çª—å£çš„ä¸Šé™è®¾ç½®ä¸ºå½“å‰è¡Œã€‚- CURRENT_RANGE å°†çª—å£çš„ä¸Šé™è®¾ç½®ä¸ºå½“å‰è¡Œçš„æ’åºé”®ï¼Œå³ï¼Œä¸å½“å‰è¡Œå…·æœ‰ç›¸åŒæ’åºé”®çš„æ‰€æœ‰è¡Œéƒ½åŒ…å«åœ¨çª—å£ä¸­ã€‚å¦‚æœfollowingçœç•¥è¯¥å­å¥ï¼Œåˆ™æ—¶é—´é—´éš”çª—å£CURRENT_RANGEçš„ä¸Šé™å®šä¹‰ä¸ºï¼Œè¡Œè®¡æ•°é—´éš”çª—å£çš„ä¸Šé™å®šä¹‰ä¸ºCURRENT_ROWã€‚aséœ€è¦ä¸ºä¸Šæ–¹çª—å£åˆ†é…åˆ«åã€‚åˆ«åç”¨äºå¼•ç”¨ä»¥ä¸‹select()å­å¥ä¸­çš„overçª—å£ã€‚æ³¨æ„ï¼š**å½“å‰ï¼Œselect()å¿…é¡»åœ¨ç›¸åŒçš„çª—å£å†…è®¡ç®—åŒä¸€è°ƒç”¨ä¸­çš„æ‰€æœ‰èšåˆå‡½æ•°ã€‚Unbounded Over Windows123456789// Unbounded Event-time over window (assuming an event-time attribute \"rowtime\").window(Over partitionBy 'a orderBy 'rowtime preceding UNBOUNDED_RANGE as 'w)// Unbounded Processing-time over window (assuming a processing-time attribute \"proctime\").window(Over partitionBy 'a orderBy 'proctime preceding UNBOUNDED_RANGE as 'w)// Unbounded Event-time Row-count over window (assuming an event-time attribute \"rowtime\").window(Over partitionBy 'a orderBy 'rowtime preceding UNBOUNDED_ROW as 'w) // Unbounded Processing-time Row-count over window (assuming a processing-time attribute \"proctime\").window(Over partitionBy 'a orderBy 'proctime preceding UNBOUNDED_ROW as 'w)bounded Over Windows123456789// Bounded Event-time over window (assuming an event-time attribute \"rowtime\").window(Over partitionBy 'a orderBy 'rowtime preceding 1.minutes as 'w)// Bounded Processing-time over window (assuming a processing-time attribute \"proctime\").window(Over partitionBy 'a orderBy 'proctime preceding 1.minutes as 'w)// Bounded Event-time Row-count over window (assuming an event-time attribute \"rowtime\").window(Over partitionBy 'a orderBy 'rowtime preceding 10.rows as 'w) // Bounded Processing-time Row-count over window (assuming a processing-time attribute \"proctime\").window(Over partitionBy 'a orderBy 'proctime preceding 10.rows as 'w)åŸºäºè¡Œçš„æ“ä½œåŸºäºè¡Œçš„æ“ä½œç”Ÿæˆå…·æœ‰å¤šåˆ—çš„è¾“å‡ºã€‚ç®—å­æè¿°MapBatch\\Streamingä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„æ ‡é‡å‡½æ•°æˆ–å†…ç½®æ ‡é‡å‡½æ•°æ‰§è¡Œæ˜ å°„æ“ä½œã€‚å¦‚æœè¾“å‡ºç±»å‹æ˜¯å¤åˆç±»å‹ï¼Œåˆ™è¾“å‡ºå°†è¢«å±•å¹³ã€‚```class MyMapFunction extends ScalarFunction {def eval(a: String): Row = {Row.of(a, â€œpre-â€œ + a)}override def getResultType(signature: Array[Class[_]]): TypeInformation[_] =Types.ROW(Types.STRING, Types.STRING)}val func = new MyMapFunction()val table = input.map(func(â€˜c)).as(â€˜a, â€˜b)12 || **FlatMap**&lt;br &#x2F;&gt;Batch\\Streaming | ä½¿ç”¨è¡¨å‡½æ•°æ‰§è¡ŒflatMapæ“ä½œã€‚class MyFlatMapFunction extends TableFunction[Row] {def eval(str: String): Unit = {if (str.contains(â€œ#â€)) {str.split(â€œ#â€).foreach({ s =&gt;val row = new Row(2)row.setField(0, s)row.setField(1, s.length)collect(row)})}}override def getResultType: TypeInformation[Row] = {Types.ROW(Types.STRING, Types.INT)}}val func = new MyFlatMapFunctionval table = input.flatMap(func(â€˜c)).as(â€˜a, â€˜b)123 || **Aggregate**&lt;br &#x2F;&gt;Batch\\Streaming&lt;br &#x2F;&gt;**Result Updating** | ä½¿ç”¨èšåˆå‡½æ•°æ‰§è¡Œèšåˆæ“ä½œã€‚æ‚¨å¿…é¡»ä½¿ç”¨selectè¯­å¥å…³é—­â€œèšåˆâ€ï¼Œå¹¶ä¸”selectè¯­å¥ä¸æ”¯æŒèšåˆåŠŸèƒ½ã€‚å¦‚æœè¾“å‡ºç±»å‹æ˜¯å¤åˆç±»å‹ï¼Œåˆ™èšåˆçš„è¾“å‡ºå°†è¢«å±•å¹³ã€‚&lt;br &#x2F;&gt;case class MyMinMaxAcc(var min: Int, var max: Int)&lt;br &#x2F;&gt;class MyMinMax extends AggregateFunction[Row, MyMinMaxAcc] &#123;&lt;br &#x2F;&gt; def accumulate(acc: MyMinMaxAcc, value: Int): Unit &#x3D; &#123;&lt;br &#x2F;&gt; if (value &lt; acc.min) &#123;&lt;br &#x2F;&gt; acc.min &#x3D; value&lt;br &#x2F;&gt; &#125;&lt;br &#x2F;&gt; if (value &gt; acc.max) &#123;&lt;br &#x2F;&gt; acc.max &#x3D; value&lt;br &#x2F;&gt; &#125;&lt;br &#x2F;&gt; &#125;&lt;br &#x2F;&gt; override def createAccumulator(): MyMinMaxAcc &#x3D; MyMinMaxAcc(0, 0)&lt;br &#x2F;&gt; &lt;br &#x2F;&gt; def resetAccumulator(acc: MyMinMaxAcc): Unit &#x3D; &#123;&lt;br &#x2F;&gt; acc.min &#x3D; 0&lt;br &#x2F;&gt; acc.max &#x3D; 0&lt;br &#x2F;&gt; &#125;&lt;br &#x2F;&gt; override def getValue(acc: MyMinMaxAcc): Row &#x3D; &#123;&lt;br &#x2F;&gt; Row.of(Integer.valueOf(acc.min), Integer.valueOf(acc.max))&lt;br &#x2F;&gt; &#125;&lt;br &#x2F;&gt; override def getResultType: TypeInformation[Row] &#x3D; &#123;&lt;br &#x2F;&gt; new RowTypeInfo(Types.INT, Types.INT)&lt;br &#x2F;&gt; &#125;&lt;br &#x2F;&gt;&#125;&lt;br &#x2F;&gt;val myAggFunc &#x3D; new MyMinMax&lt;br &#x2F;&gt;val table &#x3D; input&lt;br &#x2F;&gt; .groupBy(&#39;key)&lt;br &#x2F;&gt; .aggregate(myAggFunc(&#39;a) as (&#39;x, &#39;y))&lt;br &#x2F;&gt; .select(&#39;key, &#39;x, &#39;y) || **ç»„çª—å£èšåˆ**&lt;br &#x2F;&gt;Batch\\Streaming | åœ¨[ç»„çª—å£](https:&#x2F;&#x2F;ci.apache.org&#x2F;projects&#x2F;flink&#x2F;flink-docs-release-1.10&#x2F;dev&#x2F;table&#x2F;tableApi.html#group-windows)å’Œå¯èƒ½çš„ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç»„é”®ä¸Šå¯¹è¡¨è¿›è¡Œåˆ†ç»„å’Œèšé›†ã€‚æ‚¨å¿…é¡»ä½¿ç”¨selectè¯­å¥å…³é—­â€œèšåˆâ€ã€‚å¹¶ä¸”selectè¯­å¥ä¸æ”¯æŒâ€œ *â€æˆ–èšåˆå‡½æ•°ã€‚val myAggFunc = new MyMinMaxval table = input.window(Tumble over 5.minutes on â€˜rowtime as â€˜w) // define window.groupBy(â€˜key, â€˜w) // group by key and window.aggregate(myAggFunc(â€˜a) as (â€˜x, â€˜y)).select(â€˜key, â€˜x, â€˜y, â€˜w.start, â€˜w.end) // access window properties and aggregate results1234 || **FlatAggregate**Streaming&lt;br &#x2F;&gt;**Result Updating** | ç±»ä¼¼äº**GroupByèšåˆ**ã€‚ä½¿ç”¨ä»¥ä¸‹è¿è¡Œè¡¨èšåˆè¿ç®—ç¬¦å°†åˆ†ç»„é”®ä¸Šçš„è¡Œåˆ†ç»„ï¼Œä»¥é€è¡Œèšåˆè¡Œã€‚ä¸AggregateFunctionçš„åŒºåˆ«åœ¨äºTableAggregateFunctionå¯ä»¥ä¸ºä¸€ä¸ªç»„è¿”å›0ä¸ªæˆ–æ›´å¤šè®°å½•ã€‚æ‚¨å¿…é¡»ä½¿ç”¨selectè¯­å¥å…³é—­â€œ flatAggregateâ€ã€‚å¹¶ä¸”selectè¯­å¥ä¸æ”¯æŒèšåˆå‡½æ•°ã€‚&lt;br &#x2F;&gt;é™¤äº†ä½¿ç”¨&#96;emitValue&#96;è¾“å‡ºç»“æœï¼Œè¿˜å¯ä»¥ä½¿ç”¨&#96;emitUpdateWithRetract&#96;æ–¹æ³•ã€‚ä¸ä¸åŒ&#96;emitValue&#96;ï¼Œ&#96;emitUpdateWithRetract&#96;ç”¨äºå‘å‡ºå·²æ›´æ–°çš„å€¼ã€‚æ­¤æ–¹æ³•ä»¥ç¼©å›æ¨¡å¼å¢é‡è¾“å‡ºæ•°æ®ï¼Œå³ï¼Œä¸€æ—¦æœ‰æ›´æ–°ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆç¼©å›æ—§è®°å½•ï¼Œç„¶åå†å‘é€æ–°çš„æ›´æ–°è®°å½•ã€‚å¦‚æœåœ¨è¡¨èšåˆå‡½æ•°ä¸­å®šä¹‰äº†è¿™ä¸¤ç§æ–¹æ³•ï¼Œåˆ™è¯¥&#96;emitUpdateWithRetract&#96;æ–¹æ³•å°†ä¼˜å…ˆäºè¯¥&#96;emitValue&#96;æ–¹æ³•ä½¿ç”¨ï¼Œå› ä¸ºè¿™è¢«è®¤ä¸ºæ¯”è¯¥æ–¹æ³•æ›´æœ‰æ•ˆï¼Œ&#96;emitValue&#96;å› ä¸ºå®ƒå¯ä»¥é€’å¢åœ°è¾“å‡ºå€¼ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·[å‚è§è¡¨èšåˆå‡½æ•°](https:&#x2F;&#x2F;ci.apache.org&#x2F;projects&#x2F;flink&#x2F;flink-docs-release-1.10&#x2F;dev&#x2F;table&#x2F;functions&#x2F;udfs.html#table-aggregation-functions)ã€‚import java.lang.{Integer =&gt; JInteger}import org.apache.flink.table.api.Typesimport org.apache.flink.table.functions.TableAggregateFunction/*** Accumulator for top2.*/class Top2Accum {var first: JInteger = _var second: JInteger = _}/*** The top2 user-defined table aggregate function.*/class Top2 extends TableAggregateFunction[JTuple2[JInteger, JInteger], Top2Accum] {override def createAccumulator(): Top2Accum = {val acc = new Top2Accumacc.first = Int.MinValueacc.second = Int.MinValueacc}def accumulate(acc: Top2Accum, v: Int) {if (v &gt; acc.first) {acc.second = acc.firstacc.first = v} else if (v &gt; acc.second) {acc.second = v}}def merge(acc: Top2Accum, its: JIterable[Top2Accum]): Unit = {val iter = its.iterator()while (iter.hasNext) {val top2 = iter.next()accumulate(acc, top2.first)accumulate(acc, top2.second)}}def emitValue(acc: Top2Accum, out: Collector[JTuple2[JInteger, JInteger]]): Unit = {// emit the value and rankif (acc.first != Int.MinValue) {out.collect(JTuple2.of(acc.first, 1))}if (acc.second != Int.MinValue) {out.collect(JTuple2.of(acc.second, 2))}}}val top2 = new Top2val orders: Table = tableEnv.from(â€œOrdersâ€)val result = orders.groupBy(â€˜key).flatAggregate(top2(â€˜a) as (â€˜v, â€˜rank)).select(â€˜key, â€˜v, â€˜rank)12**æ³¨æ„ï¼š**å¯¹äºæµå¼æŸ¥è¯¢ï¼Œæ ¹æ®èšåˆç±»å‹å’Œä¸åŒåˆ†ç»„å…³é”®å­—çš„æ•°é‡ï¼Œè®¡ç®—æŸ¥è¯¢ç»“æœæ‰€éœ€çš„çŠ¶æ€å¯èƒ½ä¼šæ— é™å¢é•¿ã€‚è¯·æä¾›å…·æœ‰æœ‰æ•ˆä¿ç•™é—´éš”çš„æŸ¥è¯¢é…ç½®ï¼Œä»¥é˜²æ­¢å‡ºç°è¿‡å¤šçš„çŠ¶æ€ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§[æŸ¥è¯¢é…ç½®](https:&#x2F;&#x2F;ci.apache.org&#x2F;projects&#x2F;flink&#x2F;flink-docs-release-1.10&#x2F;dev&#x2F;table&#x2F;streaming&#x2F;query_configuration.html)ã€‚ || **Group Window FlatAggregate**&lt;br &#x2F;&gt;**Streaming** | åœ¨[ç»„çª—å£](https:&#x2F;&#x2F;ci.apache.org&#x2F;projects&#x2F;flink&#x2F;flink-docs-release-1.10&#x2F;dev&#x2F;table&#x2F;tableApi.html#group-windows)å’Œå¯èƒ½çš„ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç»„é”®ä¸Šå¯¹è¡¨è¿›è¡Œåˆ†ç»„å’Œèšé›†ã€‚æ‚¨å¿…é¡»ä½¿ç”¨selectè¯­å¥å…³é—­â€œ flatAggregateâ€ã€‚å¹¶ä¸”selectè¯­å¥ä¸æ”¯æŒèšåˆå‡½æ•°ã€‚val top2 = new Top2val orders: Table = tableEnv.from(â€œOrdersâ€)val result = orders.window(Tumble over 5.minutes on â€˜rowtime as â€˜w) // define window.groupBy(â€˜a, â€˜w) // group by key and window.flatAggregate(top2(â€˜b) as (â€˜v, â€˜rank)).select(â€˜a, w.start, â€˜w.end, â€˜w.rowtime, â€˜v, â€˜rank) // access window properties and aggregate results1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162 |&lt;br &#x2F;&gt;&lt;br &#x2F;&gt;ä¸‹é¢æ˜¯æ ¹æ®ä¸Šé¢æ‰€è®²åˆ°çš„æ“ä½œï¼Œæ‰€å†™çš„å°å®ä¾‹ï¼Œæ¯äº”ç§’ç»Ÿè®¡ä¸€æ¬¡æ¯ä¸ªç”¨æˆ·ç›®å‰çš„æ¸¸æˆå¾—åˆ†æƒ…å†µ&#96;&#96;&#96;scalapackage tableAPIimport org.apache.flink.streaming.api.TimeCharacteristicimport org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractorimport org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment&#125;import org.apache.flink.streaming.api.windowing.time.Timeimport org.apache.flink.table.api.&#123;EnvironmentSettings, Slide, Table, Tumble&#125;import org.apache.flink.table.api.scala.StreamTableEnvironmentimport org.apache.flink.types.Rowimport org.apache.flink.streaming.api.scala._object table_stream_window &#123; case class GameData(user_id: String, game_id: String, game_time: Long, game_score: Int) def main(args: Array[String]): Unit &#x3D; &#123; val stream_env: StreamExecutionEnvironment &#x3D; StreamExecutionEnvironment.getExecutionEnvironment stream_env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime) val settings: EnvironmentSettings &#x3D; EnvironmentSettings.newInstance().useOldPlanner().inStreamingMode().build() val table_env: StreamTableEnvironment &#x3D; StreamTableEnvironment.create(stream_env, settings) stream_env.setParallelism(1) val socketStream: DataStream[String] &#x3D; stream_env.socketTextStream(&quot;localhost&quot;, 8888) val gameStream: DataStream[GameData] &#x3D; socketStream.map((line: String) &#x3D;&gt; &#123; val array_data: Array[String] &#x3D; line.split(&quot;,&quot;) GameData(array_data(0), array_data(1), array_data(2).toLong, array_data(3).toInt) &#125;).assignTimestampsAndWatermarks(new BoundedOutOfOrdernessTimestampExtractor[GameData](Time.seconds(3))&#123; override def extractTimestamp(element: GameData): Long &#x3D; &#123; element.game_time &#125; &#125;) &#x2F;&#x2F;åˆ†ç»„èšåˆæ“ä½œ import org.apache.flink.table.api.scala._ &#x2F;&#x2F;åˆ›å»ºåŠ¨æ€Table,å¹¶ä¸”æŒ‡å®ševent time val game_table: Table &#x3D; table_env.fromDataStream(gameStream,&#39;user_id,&#39;game_id,&#39;game_time.rowtime,&#39;game_score) &#x2F;&#x2F;å¼€å¯çª—å£,æ»‘åŠ¨çª—å£&#x2F;&#x2F; game_table.window(Slide.over(&quot;10.second&quot;).every(&quot;5.second&quot;).on(&quot;game_time&quot;).as(&quot;window&quot;)) &#x2F;&#x2F;å¼€å¯çª—å£,æ»šåŠ¨çª—å£&#x2F;&#x2F; val game_score_sum: Table &#x3D; game_table.window(Tumble.over(&quot;5.second&quot;).on(&quot;game_time&quot;).as(&quot;window&quot;)) val game_score_sum: Table &#x3D; game_table.window(Tumble over 5.second on &#39;game_time as &#39;window) .groupBy(&#39;window, &#39;user_id) &#x2F;&#x2F;å¿…é¡»æŒ‡å®šçª—å£å­—æ®µ .select(&#39;user_id, &#39;game_score.sum, &#39;window.start, &#39;window.end) table_env .toRetractStream[Row](game_score_sum) .filter((_: (Boolean, Row))._1&#x3D;&#x3D;true) .print(&quot;user_sum_score&quot;) table_env.execute(&quot;user_sum_scoreâ€”â€”job&quot;) &#125;&#125;","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Flink Table API & SQL","slug":"Flink-Table-API-SQL","date":"2018-06-05T06:24:45.000Z","updated":"2020-06-07T07:16:24.589Z","comments":true,"path":"2018/06/05/Flink-Table-API-SQL/","link":"","permalink":"cpeixin.cn/2018/06/05/Flink-Table-API-SQL/","excerpt":"","text":"ç®€ä»‹Apache Flinkå…·æœ‰ä¸¤ä¸ªæœ‰å…³è”çš„APIï¼šTable APIå’ŒSQLï¼Œç”¨äºç»Ÿä¸€æµå’Œæ‰¹å¤„ç†ï¼ˆæ‰¹æµä¸€ä½“ï¼‰ã€‚Table APIæ˜¯ç”±Scalaå’ŒJavaè¯­è¨€é›†æˆçš„æŸ¥è¯¢APIï¼Œå®ƒå…è®¸ä»¥éå¸¸ç›´è§‚çš„æ–¹å¼ï¼Œç»„åˆæ¥è‡ªå…³ç³»è¿ç®—ç¬¦ï¼ˆä¾‹å¦‚filterï¼Œjoinï¼‰çš„æŸ¥è¯¢ã€‚Flinkçš„SQLæ”¯æŒåŸºäºå®ç°SQLæ ‡å‡†çš„Apache Calciteã€‚æ— è®ºè¾“å…¥æ˜¯æ‰¹å¤„ç†è¾“å…¥ï¼ˆDataSetï¼‰è¿˜æ˜¯æµè¾“å…¥ï¼ˆDataStreamï¼‰ï¼Œåœ¨ä¸¤ä¸ªæ¥å£ä¸­æŒ‡å®šçš„æŸ¥è¯¢éƒ½å…·æœ‰ç›¸åŒçš„è¯­ä¹‰å¹¶æŒ‡å®šç›¸åŒçš„ç»“æœã€‚Table APIå’ŒSQLæ¥å£ä»¥åŠFlinkçš„DataStreamå’ŒDataSet APIç´§å¯†é›†æˆåœ¨ä¸€èµ·ã€‚æ‚¨å¯ä»¥è½»æ¾åœ°åœ¨æ‰€æœ‰APIå’ŒåŸºäºAPIçš„åº“ä¹‹é—´åˆ‡æ¢ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨CEPåº“ä»DataStreamä¸­æå–æ¨¡å¼ï¼Œç„¶åå†ä½¿ç”¨Table APIåˆ†ææ¨¡å¼ï¼Œæˆ–è€…æ‚¨å¯ä»¥åœ¨é¢„å¤„ç†ç¨‹åºä¸Šè¿è¡ŒGellyå›¾ç®—æ³•ä¹‹å‰ï¼Œä½¿ç”¨SQLæŸ¥è¯¢æ‰«æï¼Œè¿‡æ»¤å’Œèšåˆæ‰¹å¤„ç†è¡¨ã€‚è¯·æ³¨æ„ï¼ŒTable APIå’ŒSQLå°šæœªå®ŒæˆåŠŸèƒ½ï¼Œæ­£åœ¨ç§¯æå¼€å‘ä¸­ã€‚[Table APIï¼ŒSQL]å’Œ[streamï¼Œbatch]è¾“å…¥çš„æ¯ç§ç»„åˆéƒ½ä¸æ”¯æŒæ‰€æœ‰æ“ä½œã€‚**ç¨‹åºä¾èµ–ä»Flink 1.9å¼€å§‹ï¼ŒFlinkæä¾›äº†ä¸¤ç§ä¸åŒçš„è®¡åˆ’ç¨‹åºå®ç°æ¥è¯„ä¼°Tableï¼†SQL APIç¨‹åºï¼šBlinkè®¡åˆ’ç¨‹åºå’ŒFlink 1.9ä¹‹å‰å¯ç”¨çš„æ—§è®¡åˆ’ç¨‹åºã€‚è®¡åˆ’äººå‘˜è´Ÿè´£å°†å…³ç³»è¿ç®—ç¬¦è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„ï¼Œä¼˜åŒ–çš„Flinkä½œä¸šã€‚ä¸¤ä½è®¡åˆ’è€…éƒ½å¸¦æœ‰ä¸åŒçš„ä¼˜åŒ–è§„åˆ™å’Œè¿è¡Œæ—¶ç±»ã€‚å®ƒä»¬åœ¨æ”¯æŒçš„åŠŸèƒ½æ–¹é¢ä¹Ÿå¯èƒ½æœ‰æ‰€ä¸åŒã€‚æ³¨æ„**å¯¹äºç”Ÿäº§ç”¨ä¾‹ï¼Œå»ºè®®ä½¿ç”¨Flink 1.9ä¹‹å‰çš„æ—§è®¡åˆ’å™¨ã€‚æ‰€æœ‰Table APIå’ŒSQLç»„ä»¶éƒ½æ†ç»‘åœ¨flink-tableæˆ–flink-table-blinkMavenæ„ä»¶ä¸­ã€‚ä»¥ä¸‹ä¾èµ–å…³ç³»ä¸å¤§å¤šæ•°é¡¹ç›®æœ‰å…³ï¼šflink-table-commonï¼šç”¨äºé€šè¿‡è‡ªå®šä¹‰åŠŸèƒ½ï¼Œæ ¼å¼ç­‰æ‰©å±•è¡¨ç”Ÿæ€ç³»ç»Ÿçš„é€šç”¨æ¨¡å—ã€‚flink-table-api-javaï¼šé€‚ç”¨äºä½¿ç”¨Javaç¼–ç¨‹è¯­è¨€çš„çº¯è¡¨ç¨‹åºçš„Tableï¼†SQL APIï¼ˆå¤„äºå¼€å‘åˆæœŸï¼Œä¸å»ºè®®ä½¿ç”¨ï¼ï¼‰ã€‚flink-table-api-scalaï¼šä½¿ç”¨Scalaç¼–ç¨‹è¯­è¨€çš„çº¯è¡¨ç¨‹åºçš„Tableï¼†SQL APIï¼ˆå¤„äºå¼€å‘åˆæœŸï¼Œä¸å»ºè®®ä½¿ç”¨ï¼ï¼‰ã€‚flink-table-api-java-bridgeï¼šä½¿ç”¨Javaç¼–ç¨‹è¯­è¨€æ”¯æŒå¸¦æœ‰DataStream / DataSet APIçš„Tableï¼†SQL APIã€‚flink-table-api-scala-bridgeï¼šä½¿ç”¨Scalaç¼–ç¨‹è¯­è¨€æ”¯æŒå¸¦æœ‰DataStream / DataSet APIçš„Tableï¼†SQL APIã€‚flink-table-plannerï¼šè¡¨ç¨‹åºè®¡åˆ’ç¨‹åºå’Œè¿è¡Œæ—¶ã€‚è¿™æ˜¯1.9ç‰ˆæœ¬ä¹‹å‰Flinkçš„å”¯ä¸€è®¡åˆ’è€…ã€‚ä»ç„¶æ˜¯æ¨èçš„ä¸€ç§ã€‚flink-table-planner-blinkï¼šæ–°çš„Blinkè®¡åˆ’å™¨ã€‚flink-table-runtime-blinkï¼šæ–°çš„Blinkè¿è¡Œæ—¶ã€‚flink-table-uberï¼šå°†ä¸Šè¿°APIæ¨¡å—ä»¥åŠæ—§çš„è®¡åˆ’å™¨æ‰“åŒ…åˆ°å¤§å¤šæ•°Tableï¼†SQL APIç”¨ä¾‹çš„åˆ†å‘ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¶…çº§JARæ–‡ä»¶flink-table-*.jarä½äº/libFlinkç‰ˆæœ¬çš„ç›®å½•ä¸­ã€‚flink-table-uber-blinkï¼šå°†ä¸Šè¿°APIæ¨¡å—ä»¥åŠç‰¹å®šäºBlinkçš„æ¨¡å—æ‰“åŒ…åˆ°å¤§å¤šæ•°Tableï¼†SQL APIç”¨ä¾‹çš„åˆ†å‘ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¶…çº§JARæ–‡ä»¶flink-table-blink-*.jarä½äº/libFlinkç‰ˆæœ¬çš„ç›®å½•ä¸­ã€‚æœ‰å…³å¦‚ä½•åœ¨è¡¨ç¨‹åºä¸­çš„æ–°æ—§Blinkè§„åˆ’å™¨ä¹‹é—´è¿›è¡Œåˆ‡æ¢çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§é€šç”¨APIé¡µé¢ã€‚è¡¨ç¨‹åºä¾èµ–æ€§æ ¹æ®ç›®æ ‡ç¼–ç¨‹è¯­è¨€ï¼Œæ‚¨éœ€è¦å°†Javaæˆ–Scala APIæ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œä»¥ä¾¿ä½¿ç”¨Table APIå’ŒSQLå®šä¹‰ç®¡é“ï¼š1234567891011121314&lt;!-- Either... --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt; &lt;artifactId&gt;flink-table-api-java-bridge_2.11&lt;&#x2F;artifactId&gt; &lt;version&gt;1.10.0&lt;&#x2F;version&gt; &lt;scope&gt;provided&lt;&#x2F;scope&gt;&lt;&#x2F;dependency&gt;&lt;!-- or... --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt; &lt;artifactId&gt;flink-table-api-scala-bridge_2.11&lt;&#x2F;artifactId&gt; &lt;version&gt;1.10.0&lt;&#x2F;version&gt; &lt;scope&gt;provided&lt;&#x2F;scope&gt;&lt;&#x2F;dependency&gt;æ­¤å¤–ï¼Œå¦‚æœè¦åœ¨IDEä¸­æœ¬åœ°è¿è¡ŒTable APIå’ŒSQLç¨‹åºï¼Œåˆ™å¿…é¡»æ·»åŠ ä»¥ä¸‹ä¸€ç»„æ¨¡å—ä¹‹ä¸€ï¼Œå…·ä½“å–å†³äºè¦ä½¿ç”¨çš„è®¡åˆ’ç¨‹åºï¼š1234567891011121314&lt;!-- Either... (for the old planner that was available before Flink 1.9) --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt; &lt;artifactId&gt;flink-table-planner_2.11&lt;&#x2F;artifactId&gt; &lt;version&gt;1.10.0&lt;&#x2F;version&gt; &lt;scope&gt;provided&lt;&#x2F;scope&gt;&lt;&#x2F;dependency&gt;&lt;!-- or.. (for the new Blink planner) --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt; &lt;artifactId&gt;flink-table-planner-blink_2.11&lt;&#x2F;artifactId&gt; &lt;version&gt;1.10.0&lt;&#x2F;version&gt; &lt;scope&gt;provided&lt;&#x2F;scope&gt;&lt;&#x2F;dependency&gt;åœ¨å†…éƒ¨ï¼Œè¡¨ç”Ÿæ€ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†åœ¨Scalaä¸­å®ç°ã€‚å› æ­¤ï¼Œè¯·ç¡®ä¿ä¸ºæ‰¹å¤„ç†å’Œæµåº”ç”¨ç¨‹åºéƒ½æ·»åŠ ä»¥ä¸‹ä¾èµ–é¡¹ï¼š123456&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt; &lt;artifactId&gt;flink-streaming-scala_2.11&lt;&#x2F;artifactId&gt; &lt;version&gt;1.10.0&lt;&#x2F;version&gt; &lt;scope&gt;provided&lt;&#x2F;scope&gt;&lt;&#x2F;dependency&gt;æ‰©å±•ä¾èµ–å¦‚æœè¦å®ç°ä¸Kafkaæˆ–ä¸€ç»„ç”¨æˆ·å®šä¹‰çš„å‡½æ•°è¿›è¡Œäº¤äº’çš„è‡ªå®šä¹‰æ ¼å¼ï¼Œåˆ™ä»¥ä¸‹ä¾èµ–å…³ç³»å°±è¶³å¤Ÿäº†ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºSQL Clientçš„JARæ–‡ä»¶ï¼š123456&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;&#x2F;groupId&gt; &lt;artifactId&gt;flink-table-common&lt;&#x2F;artifactId&gt; &lt;version&gt;1.10.0&lt;&#x2F;version&gt; &lt;scope&gt;provided&lt;&#x2F;scope&gt;&lt;&#x2F;dependency&gt;å½“å‰ï¼Œè¯¥æ¨¡å—åŒ…æ‹¬ä»¥ä¸‹æ‰©å±•ç‚¹ï¼šSerializationSchemaFactoryDeserializationSchemaFactoryScalarFunctionTableFunctionAggregateFunctionä¸¤ä¸ªPlannerä¹‹é—´ä¸»è¦çš„ä¸åŒBlinkå°†æ‰¹å¤„ç†ä½œä¸šè§†ä¸ºæµçš„ç‰¹æ®Šæƒ…å†µã€‚å› æ­¤ï¼Œè¿˜ä¸æ”¯æŒTableå’ŒDataSetä¹‹é—´çš„è½¬æ¢ï¼Œå¹¶ä¸”æ‰¹å¤„ç†ä½œä¸šä¸ä¼šè½¬æ¢æˆDateSetç¨‹åºï¼Œåˆ™è¿˜æ˜¯å’ŒDataStreamç¨‹åºä¸€æ ·ã€‚Blink planner ä¸æ”¯æŒBatchTableSourceï¼Œè€Œæ˜¯ä½¿ç”¨StreamTableSource ä»£æ›¿ã€‚Blink planner ç¨‹åºä»…æ”¯æŒå…¨æ–°çš„Catalogï¼Œä¸æ”¯æŒExternalCatalogï¼ŒExternalCatalogä¸æ¨èä½¿ç”¨ã€‚ä½¿ç”¨FilterableTableSourceåœ¨**old plannerå’ŒBlink plannerä¸­æ˜¯ä¸ç›¸å®¹çš„ã€‚old plannerä¼šå°†PlannerExpressions æŒ‰ä¸‹FilterableTableSourceï¼Œè€ŒBlink planner**çš„è®¡åˆ’ç¨‹åºå°†Expressions æŒ‰ä¸‹ã€‚åŸºäºå­—ç¬¦ä¸²çš„é”®å€¼é…ç½®é€‰é¡¹ï¼ˆæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æœ‰å…³é…ç½®çš„æ–‡æ¡£ï¼‰ä»…ç”¨äºBlinkè®¡åˆ’å™¨ã€‚ä¸¤ä¸ªplannerå®ç°ï¼ˆCalciteConfigï¼‰PlannerConfigä¸åŒã€‚Blink plannerä¼šå°†å¤šä¸ªæ¥æ”¶å™¨ä¼˜åŒ–ä¸ºä¸€ä¸ªDAGï¼ˆä»…åœ¨ä¸Šæ”¯æŒTableEnvironmentï¼Œè€Œä¸åœ¨ä¸Šæ”¯æŒStreamTableEnvironmentï¼‰ã€‚old plannerå°†å§‹ç»ˆå°†æ¯ä¸ªæ¥æ”¶å™¨ä¼˜åŒ–ä¸ºä¸€ä¸ªæ–°çš„DAGï¼Œå…¶ä¸­æ‰€æœ‰DAGå½¼æ­¤ç‹¬ç«‹ã€‚old plannerç¨‹åºç°åœ¨ä¸æ”¯æŒç›®å½•ç»Ÿè®¡ä¿¡æ¯ï¼Œè€ŒBlinkè®¡åˆ’ç¨‹åºåˆ™æ”¯æŒã€‚Table API &amp; SQLç¨‹åºæ¡†æ¶ç”¨äºæ‰¹å¤„ç†å’Œæµå¼ä¼ è¾“çš„æ‰€æœ‰Table APIå’ŒSQLç¨‹åºéƒ½éµå¾ªç›¸åŒçš„æ¨¡å¼ã€‚ä»¥ä¸‹ä»£ç ç¤ºä¾‹æ˜¾ç¤ºäº†Table APIå’ŒSQLç¨‹åºçš„é€šç”¨ç»“æ„ã€‚12345678910111213141516171819// create a TableEnvironment for specific planner batch or streamingval tableEnv = ... // see \"Create a TableEnvironment\" section// create a TabletableEnv.connect(...).createTemporaryTable(\"table1\")// register an output TabletableEnv.connect(...).createTemporaryTable(\"outputTable\")// create a Table from a Table API queryval tapiResult = tableEnv.from(\"table1\").select(...)// create a Table from a SQL queryval sqlResult = tableEnv.sqlQuery(\"SELECT ... FROM table1 ...\")// emit a Table API result Table to a TableSink, same for SQL resulttapiResult.insertInto(\"outputTable\")// executetableEnv.execute(\"scala_job\")åˆ›å»ºTableEnvironmentè¿™TableEnvironmentæ˜¯Table APIå’ŒSQLé›†æˆçš„ä¸­å¿ƒæ¦‚å¿µã€‚å®ƒè´Ÿè´£ï¼šåœ¨å†…éƒ¨catalogä¸­æ³¨å†ŒTableæ³¨å†ŒcatalogåŠ è½½å¯æ’æ‹”æ¨¡å—æ‰§è¡ŒSQLæŸ¥è¯¢æ³¨å†Œç”¨æˆ·å®šä¹‰çš„UDFå‡½æ•°å°†DataStreamæˆ–DataSetè½¬æ¢ä¸ºTableæŒæœ‰å¯¹ExecutionEnvironmentæˆ–çš„å¼•ç”¨StreamExecutionEnvironmentä¸€å¼ è¡¨å§‹ç»ˆç»‘å®šåˆ°ç‰¹å®šçš„TableEnvironmentã€‚ä¸å¯èƒ½åœ¨åŒä¸€æŸ¥è¯¢ä¸­ç»„åˆä¸åŒTableEnvironmentsçš„è¡¨ï¼Œä¾‹å¦‚ï¼Œå°†å®ƒä»¬joinæˆ–unionã€‚ä»¥ä¸‹æ˜¯å››ç§ä¸åŒç±»å‹çš„å®šä¹‰ï¼š12345678910111213141516171819202122232425262728293031323334353637// **********************// FLINK STREAMING QUERY// **********************import org.apache.flink.streaming.api.scala.StreamExecutionEnvironmentimport org.apache.flink.table.api.EnvironmentSettingsimport org.apache.flink.table.api.scala.StreamTableEnvironmentval fsSettings = EnvironmentSettings.newInstance().useOldPlanner().inStreamingMode().build()val fsEnv = StreamExecutionEnvironment.getExecutionEnvironmentval fsTableEnv = StreamTableEnvironment.create(fsEnv, fsSettings)// or val fsTableEnv = TableEnvironment.create(fsSettings)// ******************// FLINK BATCH QUERY// ******************import org.apache.flink.api.scala.ExecutionEnvironmentimport org.apache.flink.table.api.scala.BatchTableEnvironmentval fbEnv = ExecutionEnvironment.getExecutionEnvironmentval fbTableEnv = BatchTableEnvironment.create(fbEnv)// **********************// BLINK STREAMING QUERY// **********************import org.apache.flink.streaming.api.scala.StreamExecutionEnvironmentimport org.apache.flink.table.api.EnvironmentSettingsimport org.apache.flink.table.api.scala.StreamTableEnvironmentval bsEnv = StreamExecutionEnvironment.getExecutionEnvironmentval bsSettings = EnvironmentSettings.newInstance().useBlinkPlanner().inStreamingMode().build()val bsTableEnv = StreamTableEnvironment.create(bsEnv, bsSettings)// or val bsTableEnv = TableEnvironment.create(bsSettings)// ******************// BLINK BATCH QUERY// ******************import org.apache.flink.table.api.&#123;EnvironmentSettings, TableEnvironment&#125;val bbSettings = EnvironmentSettings.newInstance().useBlinkPlanner().inBatchMode().build()val bbTableEnv = TableEnvironment.create(bbSettings)æ³¨æ„ï¼šå¦‚æœ/libç›®å½•ä¸­åªæœ‰ä¸€ä¸ªè®¡åˆ’å™¨jar ï¼Œåˆ™å¯ä»¥ä½¿ç”¨useAnyPlannerï¼ˆuse_any_plannerå¯¹äºpythonï¼‰åˆ›å»ºspecific EnvironmentSettingsã€‚åœ¨Catalogä¸­åˆ›å»ºè¡¨TableEnvironmentç»´æŠ¤ä½¿ç”¨æ ‡è¯†ç¬¦åˆ›å»ºçš„è¡¨ç›®å½•çš„æ˜ å°„ã€‚æ¯ä¸ªæ ‡è¯†ç¬¦ç”±3éƒ¨åˆ†ç»„æˆï¼šç›®å½•åç§°ï¼Œæ•°æ®åº“åç§°å’Œå¯¹è±¡åç§°ã€‚å¦‚æœæœªæŒ‡å®šç›®å½•æˆ–æ•°æ®åº“ï¼Œåˆ™å°†ä½¿ç”¨å½“å‰é»˜è®¤å€¼ï¼ˆè¯·å‚é˜…è¡¨æ ‡è¯†ç¬¦æ‰©å±•éƒ¨åˆ†ä¸­çš„ç¤ºä¾‹ï¼‰ã€‚è¡¨å¯ä»¥æ˜¯è™šæ‹Ÿï¼ˆVIEWSï¼‰è§†å›¾æˆ–å¸¸è§„ï¼ˆTABLESï¼‰ã€‚VIEWSå¯ä»¥ä»ç°æœ‰Tableå¯¹è±¡åˆ›å»ºï¼Œé€šå¸¸æ˜¯Table APIæˆ–SQLæŸ¥è¯¢çš„ç»“æœã€‚TABLESæè¿°å¤–éƒ¨æ•°æ®ï¼Œä¾‹å¦‚æ–‡ä»¶ï¼Œæ•°æ®åº“è¡¨æˆ–æ¶ˆæ¯é˜Ÿåˆ—ã€‚ä¸´æ—¶è¡¨ä¸æ°¸ä¹…è¡¨è¡¨å¯ä»¥æ˜¯ä¸´æ—¶çš„ï¼Œå¹¶ä¸å•ä¸ªFlinkä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸç›¸å…³ï¼Œä¹Ÿå¯ä»¥æ˜¯æ°¸ä¹…çš„ï¼Œå¹¶ä¸”åœ¨å¤šä¸ªFlinkä¼šè¯å’Œç¾¤é›†ä¸­å¯è§ã€‚æ°¸ä¹…è¡¨éœ€è¦ä¸€ä¸ªç›®å½•ï¼ˆä¾‹å¦‚Hive Metastoreï¼‰æ¥ç»´æŠ¤æœ‰å…³è¡¨çš„å…ƒæ•°æ®ã€‚åˆ›å»ºæ°¸ä¹…è¡¨åï¼Œè¿æ¥åˆ°ç›®å½•çš„ä»»ä½•Flinkä¼šè¯éƒ½å¯ä»¥çœ‹åˆ°è¯¥è¡¨ï¼Œå¹¶ä¸”è¯¥è¡¨å°†ä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°æ˜ç¡®åˆ é™¤è¯¥è¡¨ä¸ºæ­¢ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸´æ—¶è¡¨å§‹ç»ˆå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¸”ä»…åœ¨å®ƒä»¬åœ¨å…¶ä¸­åˆ›å»ºçš„Flinkä¼šè¯æœŸé—´å­˜åœ¨ã€‚è¿™äº›è¡¨å¯¹å…¶ä»–ä¼šè¯ä¸å¯è§ã€‚å®ƒä»¬æœªç»‘å®šåˆ°ä»»ä½•ç›®å½•æˆ–æ•°æ®åº“ï¼Œä½†å¯ä»¥åœ¨ä¸€ä¸ªç›®å½•æˆ–æ•°æ®åº“çš„åç§°ç©ºé—´ä¸­åˆ›å»ºã€‚å¦‚æœåˆ é™¤äº†ä¸´æ—¶è¡¨çš„ç›¸åº”æ•°æ®åº“ï¼Œåˆ™ä¸ä¼šåˆ é™¤è¿™äº›ä¸´æ—¶è¡¨ã€‚é®è”½å¯ä»¥ä½¿ç”¨ä¸ç°æœ‰æ°¸ä¹…è¡¨ç›¸åŒçš„æ ‡è¯†ç¬¦æ³¨å†Œä¸€ä¸ªä¸´æ—¶è¡¨ã€‚åªè¦å­˜åœ¨ä¸´æ—¶è¡¨ï¼Œè¯¥ä¸´æ—¶è¡¨å°±ä¼šè¦†ç›–è¯¥æ°¸ä¹…è¡¨ï¼Œå¹¶ä½¿è¯¥æ°¸ä¹…è¡¨ä¸å¯è®¿é—®ã€‚å…·æœ‰è¯¥æ ‡è¯†ç¬¦çš„æ‰€æœ‰æŸ¥è¯¢å°†é’ˆå¯¹ä¸´æ—¶è¡¨æ‰§è¡Œã€‚è¿™å¯èƒ½å¯¹å®éªŒæœ‰ç”¨ã€‚å®ƒå…è®¸é¦–å…ˆå¯¹ä¸´æ—¶è¡¨è¿è¡Œå®Œå…¨ç›¸åŒçš„æŸ¥è¯¢ï¼Œè¯¥ä¸´æ—¶è¡¨ä¾‹å¦‚ä»…å…·æœ‰æ•°æ®çš„ä¸€ä¸ªå­é›†ï¼Œæˆ–è€…å¯¹æ•°æ®è¿›è¡Œæ··æ·†ã€‚ä¸€æ—¦éªŒè¯æŸ¥è¯¢æ­£ç¡®æ— è¯¯ï¼Œå°±å¯ä»¥é’ˆå¯¹å®é™…ç”Ÿäº§è¡¨è¿è¡Œè¯¥æŸ¥è¯¢ã€‚åˆ›å»ºTableVirtual TablesTableAPIå¯¹è±¡å¯¹åº”äºVIEWï¼ˆè™šæ‹Ÿè¡¨ï¼‰æ˜¯ä¸€ä¸ªSQLæœ¯è¯­ã€‚å®ƒå°è£…äº†é€»è¾‘æŸ¥è¯¢è®¡åˆ’ã€‚å¯ä»¥åœ¨ç›®å½•ä¸­åˆ›å»ºå®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š12345678// get a TableEnvironmentval tableEnv = ... // see \"Create a TableEnvironment\" section// table is the result of a simple projection query val projTable: Table = tableEnv.from(\"X\").select(...)// register the Table projTable as table \"projectedTable\"tableEnv.createTemporaryView(\"projectedTable\", projTable)æ³¨æ„ï¼š Tableå¯¹è±¡ç±»ä¼¼äºVIEWå…³ç³»æ•°æ®åº“ç³»ç»Ÿä¸­çš„å¯¹è±¡ï¼Œå³ï¼Œå®šä¹‰çš„æŸ¥è¯¢Tableæœªç»è¿‡ä¼˜åŒ–ï¼Œä½†æ˜¯å½“å¦ä¸€ä¸ªæŸ¥è¯¢å¼•ç”¨å·²æ³¨å†Œæ—¶å°†å†…è”Tableã€‚å¦‚æœå¤šä¸ªæŸ¥è¯¢å¼•ç”¨åŒä¸€ä¸ªå·²æ³¨å†Œçš„æŸ¥è¯¢Tableï¼Œåˆ™å°†ä¸ºæ¯ä¸ªå¼•ç”¨æŸ¥è¯¢å†…è”è¯¥æŸ¥è¯¢å¹¶æ‰§è¡Œå¤šæ¬¡ï¼Œå³ï¼ŒTableå°†ä¸ä¼šå…±äº«å·²æ³¨å†Œçš„ç»“æœã€‚Connector Tablesä¹Ÿå¯ä»¥ä»å…³ç³»æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªTABLE ã€‚è¿æ¥å™¨æè¿°äº†å­˜å‚¨è¡¨æ•°æ®çš„å¤–éƒ¨ç³»ç»Ÿã€‚å¯ä»¥åœ¨æ­¤å¤„å£°æ˜è¯¸å¦‚Apacha Kafkaä¹‹ç±»çš„å­˜å‚¨ç³»ç»Ÿæˆ–å¸¸è§„æ–‡ä»¶ç³»ç»Ÿã€‚123456tableEnvironment .connect(...) .withFormat(...) .withSchema(...) .inAppendMode() .createTemporaryTable(\"MyTable\")æŸ¥è¯¢è¡¨Table APITable APIæ˜¯ç”¨äºScalaå’ŒJavaçš„è¯­è¨€é›†æˆæŸ¥è¯¢APIã€‚ä¸SQLç›¸åï¼ŒæŸ¥è¯¢æœªæŒ‡å®šä¸ºSQLå­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä»¥ç¼–ç¨‹è¯­è¨€ç®—å­é€æ­¥æ„æˆã€‚APIåŸºäºTableä»£è¡¨è¡¨ï¼ˆæµæˆ–æ‰¹å¤„ç†ï¼‰çš„ç±»ï¼Œå¹¶æä¾›åº”ç”¨å…³ç³»æ“ä½œçš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°Tableå¯¹è±¡ï¼Œè¯¥å¯¹è±¡è¡¨ç¤ºåœ¨inputä¸Šåº”ç”¨å…³ç³»è¿ç®—çš„ç»“æœTableã€‚ä¸€äº›å…³ç³»æ“ä½œç”±å¤šä¸ªæ–¹æ³•è°ƒç”¨ç»„æˆï¼Œä¾‹å¦‚table.groupBy(â€¦).select()ï¼Œå…¶ä¸­groupBy(â€¦)æŒ‡å®šçš„åˆ†ç»„tableå’Œselect(â€¦)å¯¹åˆ†ç»„çš„æŠ•å½±tableã€‚è¯¥Table APIæ–‡æ¡£ä»‹ç»äº†æ”¯æŒæµåª’ä½“å’Œæ‰¹æ¬¡è¡¨ä¸­çš„æ‰€æœ‰è¡¨APIæ“ä½œã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ªç®€å•çš„Table APIèšåˆæŸ¥è¯¢ï¼š1234567891011121314// get a TableEnvironmentval tableEnv = ... // see \"Create a TableEnvironment\" section// register Orders table// scan registered Orders tableval orders = tableEnv.from(\"Orders\")// compute revenue for all customers from Franceval revenue = orders .filter('cCountry === \"FRANCE\") .groupBy('cID, 'cName) .select('cID, 'cName, 'revenue.sum AS 'revSum)// emit or convert Table// execute queryæ³¨æ„ï¼š** Scala Table APIä½¿ç”¨Scalaç¬¦å·ï¼Œè¿™äº›ç¬¦å·ä»¥å•ä¸ªè®°å·ï¼ˆâ€™ï¼‰å¼€å¤´æ¥å¼•ç”¨çš„å±æ€§Tableã€‚Table APIä½¿ç”¨Scalaéšå¼ã€‚ç¡®ä¿å¯¼å…¥ï¼Œorg.apache.flink.api.scala._ç„¶åorg.apache.flink.table.api.scala._ä½¿ç”¨Scalaéšå¼è½¬æ¢ã€‚SQLFlinkçš„SQLé›†æˆåŸºäºå®ç°SQLæ ‡å‡†çš„Apache Calciteã€‚SQLæŸ¥è¯¢è¢«æŒ‡å®šä¸ºå¸¸è§„å­—ç¬¦ä¸²ã€‚è¯¥SQLæ–‡ä»¶æè¿°å¼—æ—å…‹çš„æµåª’ä½“å’Œæ‰¹é‡è¡¨çš„SQLæ”¯æŒã€‚ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜å¦‚ä½•æŒ‡å®šæŸ¥è¯¢å¹¶ä»¥è¿”å›ç»“æœTableã€‚123456789101112// get a TableEnvironmentval tableEnv = ... // see \"Create a TableEnvironment\" section// register Orders table// compute revenue for all customers from Franceval revenue = tableEnv.sqlQuery(\"\"\" |SELECT cID, cName, SUM(revenue) AS revSum |FROM Orders |WHERE cCountry = 'FRANCE' |GROUP BY cID, cName \"\"\".stripMargin)// emit or convert Table// execute queryä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•æŒ‡å®šå°†æŸ¥è¯¢ç»“æœæ’å…¥å·²æ³¨å†Œè¡¨çš„æ›´æ–°æŸ¥è¯¢ã€‚12345678910111213// get a TableEnvironmentval tableEnv = ... // see \"Create a TableEnvironment\" section// register \"Orders\" table// register \"RevenueFrance\" output table// compute revenue for all customers from France and emit to \"RevenueFrance\"tableEnv.sqlUpdate(\"\"\" |INSERT INTO RevenueFrance |SELECT cID, cName, SUM(revenue) AS revSum |FROM Orders |WHERE cCountry = 'FRANCE' |GROUP BY cID, cName \"\"\".stripMargin)// execute queryæ··åˆTable APIå’ŒSQLè¡¨APIå’ŒSQLæŸ¥è¯¢å¯ä»¥è½»æ¾æ··åˆï¼Œå› ä¸ºå®ƒä»¬éƒ½è¿”å›Tableå¯¹è±¡ï¼šå¯ä»¥åœ¨TableSQLæŸ¥è¯¢è¿”å›çš„å¯¹è±¡ä¸Šå®šä¹‰Table API æŸ¥è¯¢ã€‚å¯ä»¥é€šè¿‡åœ¨Table APIæŸ¥è¯¢çš„ç»“æœä¸Šå®šä¹‰SQLæŸ¥è¯¢ï¼Œæ–¹æ³•æ˜¯åœ¨ä¸­æ³¨å†Œç»“æœè¡¨ï¼ŒTableEnvironmentç„¶ååœ¨FROMSQLæŸ¥è¯¢çš„å­å¥ä¸­å¼•ç”¨è¯¥è¡¨ã€‚ä¸DataStreamå’ŒDataSet APIé›†æˆè®¡åˆ’ä¸­çš„ä¸¤ä¸ªplanneréƒ½å¯ä»¥ä¸DataStreamAPI é›†æˆã€‚åªæœ‰old plannerç¨‹åºå¯ä»¥ä¸DataSet APIé›†æˆï¼Œåœ¨æ‰¹é‡å¤„ç†æƒ…å†µä¸‹çš„Blink plannerä¸èƒ½ä¸ä¸¤è€…ç»“åˆä½¿ç”¨ã€‚ æ³¨æ„ï¼šä¸‹é¢DataSetè®¨è®ºçš„APIä»…ä¸æ‰¹é‡ä½¿ç”¨çš„old plannerç¨‹åºæœ‰å…³ã€‚Table APIå’ŒSQLæŸ¥è¯¢å¯ä»¥è½»æ¾åœ°ä¸DataStreamå’ŒDataSetç¨‹åºé›†æˆå¹¶åµŒå…¥å…¶ä¸­ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æŸ¥è¯¢å¤–éƒ¨è¡¨ï¼ˆä¾‹å¦‚ä»RDBMSï¼‰ï¼Œè¿›è¡Œä¸€äº›é¢„å¤„ç†ï¼Œä¾‹å¦‚è¿‡æ»¤ï¼ŒæŠ•å½±ï¼Œèšåˆæˆ–ä¸å…ƒæ•°æ®è”æ¥ï¼Œç„¶åä½¿ç”¨DataStreamæˆ–DataSet APIï¼ˆä»¥åŠåœ¨è¿™äº›APIä¹‹ä¸Šæ„å»ºçš„ä»»ä½•åº“ï¼Œä¾‹å¦‚CEPæˆ–Gellyï¼‰ã€‚ç›¸åï¼Œä¹Ÿå¯ä»¥å°†Table APIæˆ–SQLæŸ¥è¯¢åº”ç”¨äºDataStreamæˆ–DataSetç¨‹åºçš„ç»“æœã€‚Scalaçš„éšå¼è½¬æ¢scala Table APIåŠŸèƒ½çš„éšå¼è½¬æ¢DataSetï¼ŒDataStreamä»¥åŠTableç±»ã€‚org.apache.flink.table.api.scala._é™¤äº†å¯¼å…¥org.apache.flink.api.scala._Scala DataStream API çš„åŒ…å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å¯¼å…¥åŒ…æ¥å¯ç”¨è¿™äº›è½¬æ¢ã€‚ä»DataStreamæˆ–DataSetåˆ›å»ºè§†å›¾ä¸€ä¸ªDataStreamæˆ–DataSetå¯åœ¨æ³¨å†ŒTableEnvironmentä¸ºè§†å›¾ã€‚ç»“æœè§†å›¾çš„æ¨¡å¼å–å†³äºæ³¨å†Œçš„DataStreamæˆ–çš„æ•°æ®ç±»å‹DataSetã€‚è¯·æ£€æŸ¥æœ‰å…³å°†æ•°æ®ç±»å‹æ˜ å°„åˆ°è¡¨æ¨¡å¼çš„éƒ¨åˆ†ï¼Œä»¥è·å–è¯¦ç»†ä¿¡æ¯ã€‚æ³¨æ„ï¼šä»DataStreamæˆ–åˆ›å»ºçš„DataSetè§†å›¾åªèƒ½æ³¨å†Œä¸ºä¸´æ—¶è§†å›¾ã€‚1234567891011// get TableEnvironment // registration of a DataSet is equivalentval tableEnv: StreamTableEnvironment = ... // see \"Create a TableEnvironment\" sectionval stream: DataStream[(Long, String)] = ...// register the DataStream as View \"myTable\" with fields \"f0\", \"f1\"tableEnv.createTemporaryView(\"myTable\", stream)// register the DataStream as View \"myTable2\" with fields \"myLong\", \"myString\"tableEnv.createTemporaryView(\"myTable2\", stream, 'myLong, 'myString)å°†DataStreamæˆ–DataSetè½¬æ¢ä¸ºè¡¨è¿˜å¯ä»¥å°†DataStreamæˆ–DataSetinç›´æ¥è½¬æ¢ä¸ºaTableã€‚å¦‚æœè¦åœ¨Table APIæŸ¥è¯¢ä¸­ä½¿ç”¨Tableï¼Œè¿™å°†å¾ˆæ–¹ä¾¿ã€‚12345678// get TableEnvironment// registration of a DataSet is equivalentval tableEnv = ... // see \"Create a TableEnvironment\" sectionval stream: DataStream[(Long, String)] = ...// convert the DataStream into a Table with default fields '_1, '_2val table1: Table = tableEnv.fromDataStream(stream)// convert the DataStream into a Table with fields 'myLong, 'myStringval table2: Table = tableEnv.fromDataStream(stream, 'myLong, 'myString)å°†è¡¨è½¬æ¢ä¸ºDataStreamæˆ–DataSetTableå¯ä»¥è½¬æ¢ä¸ºDataStreamæˆ–DataSetã€‚è¿™æ ·ï¼Œå¯ä»¥åœ¨Table APIæˆ–SQLæŸ¥è¯¢çš„ç»“æœä¸Šè¿è¡Œè‡ªå®šä¹‰DataStreamæˆ–DataSetç¨‹åºã€‚å°†Tableè½¬æ¢ä¸ºDataStreamoræ—¶DataSetï¼Œæ‚¨éœ€è¦æŒ‡å®šç»“æœDataStreamor DataSetçš„æ•°æ®ç±»å‹ï¼Œå³ï¼Œå°†Tableè½¬æ¢ä¸ºçš„æ•°æ®ç±»å‹ã€‚æœ€æ–¹ä¾¿çš„è½¬æ¢ç±»å‹é€šå¸¸æ˜¯Rowã€‚ä»¥ä¸‹åˆ—è¡¨æ¦‚è¿°äº†ä¸åŒé€‰é¡¹çš„åŠŸèƒ½ï¼šRowï¼šå­—æ®µæŒ‰ä½ç½®ï¼Œä»»æ„æ•°é‡çš„å­—æ®µï¼Œå¯¹nullå€¼çš„æ”¯æŒï¼Œæ²¡æœ‰ç±»å‹å®‰å…¨çš„è®¿é—®è¿›è¡Œæ˜ å°„ã€‚POJOï¼šå­—æ®µæŒ‰åç§°æ˜ å°„ï¼ˆPOJOå­—æ®µå¿…é¡»å‘½åä¸ºTableå­—æ®µï¼‰ï¼Œä»»æ„æ•°é‡çš„å­—æ®µï¼Œæ”¯æŒnullå€¼ï¼Œç±»å‹å®‰å…¨è®¿é—®ã€‚æ¡ˆä¾‹ç±»ï¼šå­—æ®µæŒ‰ä½ç½®æ˜ å°„ï¼Œä¸æ”¯æŒnullå€¼ï¼Œç±»å‹å®‰å…¨è®¿é—®ã€‚å…ƒç»„ï¼šæŒ‰ä½ç½®æ˜ å°„å­—æ®µï¼Œé™åˆ¶ä¸º22ï¼ˆScalaï¼‰æˆ–25ï¼ˆJavaï¼‰å­—æ®µï¼Œä¸æ”¯æŒnullå€¼ï¼Œç±»å‹å®‰å…¨è®¿é—®ã€‚åŸå­ç±»å‹ï¼šTableå¿…é¡»å…·æœ‰å•ä¸ªå­—æ®µï¼Œä¸æ”¯æŒnullå€¼ï¼Œç±»å‹å®‰å…¨è®¿é—®ã€‚å°†Tableè½¬æ¢ä¸ºStreamå¯¹Tableæ•°æ®è¿›è¡ŒæŸ¥è¯¢ï¼Œæ•°æ®æµå°†åŠ¨æ€æ›´æ–°ï¼Œéšç€æ–°è®°å½•åˆ°è¾¾æŸ¥è¯¢çš„è¾“å…¥æµï¼Œå®ƒä¼šå‘ç”Ÿå˜åŒ–ã€‚å› æ­¤ï¼Œå°†DataStreamè¿™ç§åŠ¨æ€æŸ¥è¯¢è½¬æ¢å†…å®¹ï¼Œéœ€è¦å¯¹è¡¨çš„æ›´æ–°è¿›è¡Œç¼–ç ã€‚æœ‰ä¸¤ç§å°†Tableè½¬åŒ–æˆDataStreamçš„æ¨¡å¼ï¼šAppend Mode: ä»…ä»…åœ¨å¯¹Tableè¿›è¡ŒInsertåŠ¨æ€æ“ä½œçš„æƒ…å†µä¸‹æ‰èƒ½ä½¿ç”¨æ­¤æ¨¡å¼ï¼Œå³ä»…è¿½åŠ çš„æƒ…å†µï¼Œå¹¶ä¸”ä»¥å‰çš„ç»“æœä¸ä¼šæ›´æ–°ã€‚Retract Mode: å§‹ç»ˆå¯ä»¥ä½¿ç”¨æ­¤æ¨¡å¼ã€‚å®ƒä½¿ç”¨æ ‡å¿—è¿›è¡Œç¼–ç INSERTå’ŒDELETEæ›´æ”¹booleanã€‚123456789101112131415161718// get TableEnvironment. // registration of a DataSet is equivalentval tableEnv: StreamTableEnvironment = ... // see \"Create a TableEnvironment\" section// Table with two fields (String name, Integer age)val table: Table = ...// convert the Table into an append DataStream of Rowval dsRow: DataStream[Row] = tableEnv.toAppendStream[Row](table)// convert the Table into an append DataStream of Tuple2[String, Int]val dsTuple: DataStream[(String, Int)] dsTuple = tableEnv.toAppendStream[(String, Int)](table)// convert the Table into a retract DataStream of Row.// A retract stream of type X is a DataStream[(Boolean, X)]. // The boolean field indicates the type of the change. // True is INSERT, false is DELETE.val retractStream: DataStream[(Boolean, Row)] = tableEnv.toRetractStream[Row](table)æ³¨æ„ï¼šæœ‰å…³åŠ¨æ€è¡¨åŠå…¶å±æ€§çš„è¯¦ç»†è®¨è®ºï¼Œè¯·å‚è§â€œ åŠ¨æ€è¡¨â€æ–‡æ¡£ã€‚å°†Tableè½¬æ¢ä¸ºDataSetTableè½¬æ¢ä¸ºDataSetå¦‚ä¸‹ï¼š123456789101112// get TableEnvironment // registration of a DataSet is equivalentval tableEnv = BatchTableEnvironment.create(env)// Table with two fields (String name, Integer age)val table: Table = ...// convert the Table into a DataSet of Rowval dsRow: DataSet[Row] = tableEnv.toDataSet[Row](table)// convert the Table into a DataSet of Tuple2[String, Int]val dsTuple: DataSet[(String, Int)] = tableEnv.toDataSet[(String, Int)](table)**Table API DataStreamæ¼”ç¤º**12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758package tableAPIimport org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment&#125;import org.apache.flink.table.api.&#123;EnvironmentSettings, Table&#125;import org.apache.flink.table.api.scala.StreamTableEnvironmentimport org.apache.flink.streaming.api.scala._import org.apache.flink.types.Rowobject table_stream &#123; case class GameData(user_id: String, game_id: String, game_time: Long, game_score: Int) def main(args: Array[String]): Unit = &#123; val stream_env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment val settings: EnvironmentSettings = EnvironmentSettings.newInstance().useOldPlanner().inStreamingMode().build() val table_env: StreamTableEnvironment = StreamTableEnvironment.create(stream_env, settings)// stream_env.setParallelism(1) val socketStream: DataStream[String] = stream_env.socketTextStream(\"localhost\", 8888) val gameStream: DataStream[GameData] = socketStream.map((line: String) =&gt; &#123; val array_data: Array[String] = line.split(\",\") GameData(array_data(0), array_data(1), array_data(2).toLong, array_data(3).toInt) &#125;) // æ‰“å°è¡¨ç»“æ„ // table_env.registerDataStream(\"t_game_detail\", gameStream) // val t_game_detail: Table = table_env.scan(\"t_game_detail\") // t_game_detail.printSchema() //æŸ¥è¯¢,å»é‡æ“ä½œ //è¿™é‡Œéœ€æ³¨æ„ï¼Œä½¿ç”¨å»é‡æ“ä½œæ—¶ï¼Œä¸èƒ½ä½¿ç”¨toAppendStreamã€‚ //val t_game_detail: Table = table_env.fromDataStream(gameStream).select(\"user_id\").distinct() //è¿‡æ»¤æ“ä½œ //val t_game_detail: Table = table_env.fromDataStream(gameStream).filter(\"game_score&gt;500\") //åˆ†ç»„èšåˆæ“ä½œ import org.apache.flink.table.api.scala._ val t_game_detail: Table = table_env.fromDataStream(gameStream).groupBy('user_id).select('user_id, 'user_id.count as 'count)//.select('user_id, 'game_score.sum as 'sum_game_score) //.groupBy('user_id).select('user_id, 'game_score.avg as 'avg_game_score) // è¿™é‡Œå¦‚æœå¯¹åŸå§‹æ•°æ®æ²¡æœ‰åšå­—æ®µçš„æ·»åŠ ï¼Œä¿®æ”¹ï¼Œåˆ é™¤ç­‰ï¼ŒtoAppendStreamçš„ç±»å‹å¯ä»¥ä¸ºcase classç±»å‹ // å¦‚æœå¯¹å­—æ®µè¿›è¡Œä¿®æ”¹äº†ï¼Œå¯ä»¥è®¾ç½®ä¸ºRowç±»å‹ï¼Œä¼šç®€åŒ–æ“ä½œ val result: DataStream[(Boolean, Row)] = table_env.toRetractStream[Row](t_game_detail).filter((_: (Boolean, Row))._1 == true) result.print(\"t_game_detail\") stream_env.execute(\"stream table\") &#125;&#125;","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Flink Allowed Lateness","slug":"Flink-Allowed-Lateness","date":"2018-06-03T14:36:27.000Z","updated":"2020-06-03T14:37:42.057Z","comments":true,"path":"2018/06/03/Flink-Allowed-Lateness/","link":"","permalink":"cpeixin.cn/2018/06/03/Flink-Allowed-Lateness/","excerpt":"","text":"åœ¨ä¹‹å‰çš„åšæ–‡ä¸­ï¼Œæˆ‘ä»¬è®²åˆ°äº†Flink WaterMarkæœºåˆ¶æ¥é’ˆå¯¹ä¹±åºæ•°æ®çš„å¤„ç†ï¼Œå¹¶ä¸”è®¾ç½®äº†ä¸€ä¸ªæ•°å€¼è¾ƒå°çš„å»¶è¿Ÿæ—¶é—´maxOutOfOrdernessï¼Œé€šå¸¸è¿™ä¸ªå…è®¸çš„å»¶è¿Ÿæ—¶é—´æ˜¯æˆ‘ä»¬æ ¹æ®å…·ä½“ä¸šåŠ¡æ•°æ®è§‚å¯Ÿè€Œæ¥çš„ï¼Œä¾‹å¦‚é€šè¿‡è§‚å¯Ÿï¼Œæˆ‘å¸çš„æ¸¸æˆæ•°æ®å¤§æ¦‚ä¼šå»¶è¿Ÿ2ï½3ç§’åˆ°è¾¾ï¼Œæ‰€ä»¥é’ˆå¯¹æˆ‘å¸çš„ä¸šåŠ¡ï¼ŒmaxOutOfOrdernesså¯ä»¥è®¾ç½®ä¸º2ç§’ã€‚ä½†æ˜¯é’ˆå¯¹ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µï¼Œæ¸¸æˆç½‘å…³ä¼šæœ‰é˜»å¡ï¼Œå‘é€å‡ºæ¥çš„æ•°æ®ä¼šæœ‰è¾ƒå¤§çš„å»¶è¿Ÿæƒ…å†µï¼Œä¾‹å¦‚æŸäº›æ•°æ®ä¼šè¿Ÿåˆ°20åˆ†é’Ÿåˆ°è¾¾ï¼Œå¹¶ä¸”æ•°æ®ä¸èƒ½è¢«æŠ›å¼ƒï¼Œå¦‚æœè¿™æ—¶æˆ‘ä»¬æŠŠmaxOutOfOrdernessè®¾ç½®ä¸º20åˆ†é’Ÿï¼Œé‚£æ˜¾ç„¶æ˜¯ä¸åˆé€‚çš„ï¼Œæ¯ä¸ªçª—å£çš„å‘¨æœŸä¼šå˜å¾—è¶…é•¿ï¼Œå¹¶ä¸”åœ¨å†…å­˜ä¸­ç¼“å­˜äº†å¤ªå¤šçš„æ•°æ®ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒFlinkç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯Allowed Latenessåœ¨allowedLateness()ä¸­ä¼šè®¾ç½®ä¸€ä¸ªTimeå€¼ï¼Œä¸»è¦æ˜¯ä¸ºäº†ç­‰å¾…è¿Ÿåˆ°çš„æ•°æ®ï¼Œåœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…ï¼Œå¦‚æœå±äºè¯¥çª—å£çš„æ•°æ®åˆ°æ¥ï¼Œä»ä¼šè¿›è¡Œè®¡ç®—ï¼Œåé¢ä¼šå¯¹è®¡ç®—æ–¹å¼ä»”ç»†è¯´æ˜æ³¨æ„ï¼šè¯¥æ–¹æ³•åªé’ˆå¯¹äºåŸºäºevent-timeçš„çª—å£ï¼Œå¦‚æœæ˜¯åŸºäºprocessing-timeï¼Œå¹¶ä¸”æŒ‡å®šäº†éé›¶çš„timeå€¼åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸é»˜è®¤æƒ…å†µä¸‹ï¼Œå…è®¸çš„å»¶è¿Ÿè®¾ç½®ä¸º 0ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ°è¾¾æ°´å°åçš„å…ƒç´ å°†è¢«ä¸¢å¼ƒã€‚è·å–æœ€æ–°æ•°æ®ä½œä¸ºä¾§é¢è¾“å‡ºä½¿ç”¨Flinkçš„ä¾§é¢è¾“å‡ºæµåŠŸèƒ½ï¼Œæ‚¨å¯ä»¥è·å–æœ€è¿‘è¢«ä¸¢å¼ƒçš„æ•°æ®æµã€‚é¦–å…ˆï¼Œæ‚¨éœ€è¦æŒ‡å®šè¦sideOutputLateData(OutputTag)åœ¨çª—å£æµä¸Šä½¿ç”¨çš„è¾ƒæ™šæ•°æ®ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥æ ¹æ®çª—å£åŒ–æ“ä½œçš„ç»“æœè·å–ä¾§é¢è¾“å‡ºæµï¼Œè·å–åˆ°çš„ä¾§è¾“å‡ºæµï¼Œä½ å¯ä»¥å¯¹å†å²æ•°æ®è¿›è¡Œæ›´æ–°æ“ä½œï¼š123456789101112val lateOutputTag = OutputTag[T](\"late-data\")val input: DataStream[T] = ...val result = input .keyBy(&lt;key selector&gt;) .window(&lt;window assigner&gt;) .allowedLateness(&lt;time&gt;) .sideOutputLateData(lateOutputTag) .&lt;windowed transformation&gt;(&lt;window function&gt;)val lateStream = result.getSideOutput(lateOutputTag)ä¸‹é¢ç»™å‡ºä¸€ä¸ªå®Œæ•´çš„å®ä¾‹ï¼Œéœ€æ±‚èƒŒæ™¯ï¼Œæ¯5ç§’ç»Ÿè®¡ä¸€æ¬¡è¿‘10ç§’æ—¶é—´å†…ï¼Œç”¨æˆ·åœ¨å„ä¸ªæ¸¸æˆçš„å¾—åˆ†åˆ—è¡¨ï¼Œä¹±åºæ•°æ®å…è®¸2ç§’çš„å»¶è¿Ÿï¼Œå¯¹äºæ™šæœŸæ•°æ®åˆ°è¾¾ï¼ŒallowedLatenesså…è®¸20ç§’çš„å»¶è¿Ÿï¼Œå¹¶ä¸”å¯¹æ™šæœŸæ•°æ®è¿›è¡Œæ”¶é›†ï¼Œåç»­å’Œç›´æ¥å¯¹æ¥æ•°æ®åº“æ›´æ–°ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091package data_stream.watermarkimport org.apache.flink.streaming.api.TimeCharacteristicimport org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractorimport org.apache.flink.streaming.api.scala.function.&#123;ProcessWindowFunction, WindowFunction&#125;import org.apache.flink.streaming.api.scala.&#123;DataStream, OutputTag, StreamExecutionEnvironment, _&#125;import org.apache.flink.streaming.api.windowing.time.Timeimport org.apache.flink.streaming.api.windowing.windows.TimeWindowimport org.apache.flink.util.Collectorimport scala.collection.mutable.ListBufferobject watermark_allowedLateness &#123; case class GameData(user_id: String, game_id: String, game_time: Long, game_score: Int) def main(args: Array[String]): Unit = &#123; val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment env.setParallelism(1) env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime) env.getConfig.setAutoWatermarkInterval(100L) //watermarkå‘¨æœŸ val socketStream: DataStream[String] = env.socketTextStream(\"localhost\", 8888) val gameStream: DataStream[GameData] = socketStream.map((line: String) =&gt; &#123; val array_data: Array[String] = line.split(\",\") GameData(array_data(0), array_data(1), array_data(2).toLong, array_data(3).toInt) &#125;) .assignTimestampsAndWatermarks(new BoundedOutOfOrdernessTimestampExtractor[GameData](Time.seconds(2)) &#123; override def extractTimestamp(element: GameData) = &#123; element.game_time &#125; &#125;) var gameLateData = new OutputTag[GameData](\"late\") val windowStream: DataStream[(String, List[Int])] = gameStream .keyBy((_: GameData).user_id) .timeWindow(Time.seconds(10), Time.seconds(5)) // æ•°æ®å»¶è¿Ÿè¶…è¿‡2ç§’ï¼Œäº¤ç»™allowedLatenessæ¥å¤„ç† .allowedLateness(Time.seconds(20)) .sideOutputLateData(gameLateData) // æ¥ä¸‹é‡Œä¼šå‘ç”Ÿä¸‰ç§æƒ…å†µï¼š // 1.æ²¡æœ‰å»¶è¿Ÿæˆ–è€…å»¶è¿Ÿå°äº2ç§’çš„æ•°æ®ï¼Œwatermarkä¿è¯çª—å£çš„è§¦å‘ï¼Œæ­£å¸¸è¿›å…¥çª—å£ä¸­è®¡ç®— // 2.æ•°æ®å»¶è¿Ÿåœ¨2ç§’-20ç§’ä¹‹é—´çš„æ•°æ®ï¼Œwatermark+allowedLatenessæœºåˆ¶ï¼Œwatermark &lt; window_end_time + allowedLateness_timeæ—¶è§¦å‘çª—å£ // 3.æ•°æ®å»¶è¿Ÿå¤§äº20ç§’çš„æ•°æ®ï¼Œåˆ™è¾“å…¥åˆ°ä¾§è¾“å‡ºæµå¤„ç†sideOutputLateData //ç¬¬ä¸€ç§æ–¹æ³• // .process(new ProcessWindowFunction[GameData, (String, List[Int]), String, TimeWindow] &#123; // override def process(key: String, context: Context, elements: Iterable[GameData], out: Collector[(String, List[Int])]): Unit = &#123; // val scoreList: ListBuffer[Int] = ListBuffer[Int]() // val scoreiterator: Iterator[GameData] = elements.iterator // while (scoreiterator.hasNext) &#123; // val data: GameData = scoreiterator.next() // scoreList += data.game_score // &#125; // out.collect((key, scoreList.toList)) // &#125; // &#125;) //ç¬¬äºŒç§æ–¹æ³• .apply(new WindowFunction[GameData, (String, List[Int]), String, TimeWindow] &#123; override def apply(key: String, window: TimeWindow, input: Iterable[GameData], out: Collector[(String, List[Int])]): Unit = &#123; val scoreList: ListBuffer[Int] = ListBuffer[Int]() val scoreiterator: Iterator[GameData] = input.iterator while (scoreiterator.hasNext) &#123; val data: GameData = scoreiterator.next() scoreList += data.game_score &#125; println(s\"$&#123;window.getStart&#125;=====$&#123;window.getEnd&#125;\") out.collect((key, scoreList.toList)) &#125; &#125;) windowStream.print(\"window data\") val late: DataStream[GameData] = windowStream.getSideOutput(gameLateData) late.print(\"è¿Ÿåˆ°çš„æ•°æ®:\") env.execute(this.getClass.getName) &#125;&#125;è¾“å…¥æµ‹è¯•æ•°æ®ï¼š12345678910111213141516171819202122232425262728293031user_001,g1,1591016001000,100user_001,g2,1591016002000,200user_001,g4,1591016004000,400user_001,g1,1591016005000,500user_001,g2,1591016006000,600user_001,g2,1591016007000,700user_001,g4,1591016009000,400user_001,g1,1591016010000,100user_001,g2,1591016011000,1100user_001,g4,1591016014000,1400user_001,g8,1591016008000,800ï¼ˆè¿Ÿåˆ°æ²¡è¶…20ç§’ï¼Œè§¦å‘ï¼‰user_001,g8,1591016003000,300ï¼ˆè¿Ÿåˆ°æ²¡è¶…20ç§’ï¼Œè§¦å‘ï¼‰user_001,g17,1591016017000,1700user_001,g43,1591016043000,4300user_001,g22,1591016022000,2200user_001,g21,1591016021000,2100user_001,g21,1591016019000,1900user_001,g1,1591016001000,100ï¼ˆè¿Ÿåˆ°è¶…20ç§’ï¼Œæ²¡æœ‰è§¦å‘ï¼‰è¾“å‡ºç»“æœï¼š1234567891011121314151617181920212223242526271591015995000&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;1591016005000window data&gt; (user_001,List(100, 200, 400))1591016000000&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;1591016010000window data&gt; (user_001,List(100, 200, 400, 500, 600, 700, 400))1591016000000&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;1591016010000window data&gt; (user_001,List(100, 200, 400, 500, 600, 700, 400, 800))1591016000000&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;1591016010000window data&gt; (user_001,List(100, 200, 400, 500, 600, 700, 400, 800, 300))1591015995000&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;1591016005000window data&gt; (user_001,List(100, 200, 400, 300))1591016005000&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;1591016015000window data&gt; (user_001,List(500, 600, 700, 400, 100, 1100, 1400, 800))1591016010000&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;1591016020000window data&gt; (user_001,List(100, 1100, 1400, 1700))1591016015000&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;1591016025000window data&gt; (user_001,List(1700))1591016020000&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;1591016030000window data&gt; (user_001,List(2200))1591016015000&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;1591016025000window data&gt; (user_001,List(1700, 2200))1591016020000&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;1591016030000window data&gt; (user_001,List(2200, 2100))1591016015000&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;1591016025000window data&gt; (user_001,List(1700, 2200, 2100))1591016015000&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;1591016025000window data&gt; (user_001,List(1700, 2200, 2100, 1900))è¿Ÿåˆ°çš„æ•°æ®:&gt; GameData(user_001,g1,1591016001000,100)","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Flink Watermark","slug":"Flink-Watermark","date":"2018-05-27T09:03:48.000Z","updated":"2020-06-02T09:05:14.696Z","comments":true,"path":"2018/05/27/Flink-Watermark/","link":"","permalink":"cpeixin.cn/2018/05/27/Flink-Watermark/","excerpt":"","text":"å¦‚æœæ‚¨æ­£åœ¨æ„å»ºå®æ—¶æµåª’ä½“åº”ç”¨ç¨‹åºï¼Œåˆ™äº‹ä»¶æ—¶é—´å¤„ç†æ˜¯æ‚¨å¿…é¡»è¿Ÿæ—©ä½¿ç”¨çš„åŠŸèƒ½ä¹‹ä¸€ã€‚ç”±äºåœ¨å¤§å¤šæ•°ç°å®ä¸–ç•Œçš„ç”¨ä¾‹ä¸­ï¼Œæ¶ˆæ¯åˆ°è¾¾æ— åºï¼Œåº”è¯¥æœ‰ä¸€äº›æ–¹æ³•ï¼Œæ‚¨å»ºç«‹çš„ç³»ç»Ÿäº†è§£æ¶ˆæ¯å¯èƒ½è¿Ÿåˆ°å¹¶ä¸”ç›¸åº”åœ°å¤„ç†çš„äº‹å®ã€‚åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦äº‹ä»¶æ—¶é—´å¤„ç†ï¼Œä»¥åŠæˆ‘ä»¬å¦‚ä½•åœ¨ApacheFlinkä¸­å¯ç”¨å®ƒã€‚EventTimeæ˜¯äº‹ä»¶åœ¨ç°å®ä¸–ç•Œä¸­å‘ç”Ÿçš„æ—¶é—´ï¼ŒProcessingTimeæ˜¯Flinkç³»ç»Ÿå¤„ç†è¯¥äº‹ä»¶çš„æ—¶é—´ã€‚è¦äº†è§£äº‹ä»¶æ—¶é—´å¤„ç†çš„é‡è¦æ€§ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å»ºç«‹ä¸€ä¸ªåŸºäºProcess Timeçš„ç³»ç»Ÿï¼Œçœ‹çœ‹å®ƒçš„ç¼ºç‚¹ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º10ç§’çš„SlidingWindowï¼Œæ¯5ç§’æ»‘åŠ¨ä¸€æ¬¡ï¼Œåœ¨çª—å£ç»“æŸæ—¶ï¼Œç³»ç»Ÿå°†å‘å‡ºåœ¨æ­¤æœŸé—´æ”¶åˆ°çš„æ¶ˆæ¯æ•°ã€‚ä¸€æ—¦äº†è§£EventTimeå¤„ç†å¦‚ä½•ä¸SlidingWindowç›¸å…³çš„å·¥ä½œï¼Œé‚£ä¹ˆäº†è§£å¦‚ä½•åœ¨TumblingWindowä¸­å·¥ä½œä¹Ÿä¸éš¾ã€‚æ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹å§ã€‚åŸºäºå¤„ç†æ—¶é—´çš„ç³»ç»Ÿå¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çš„æ¶ˆæ¯æ ¼å¼æ˜¯ valueï¼Œtimestampï¼Œå…¶ä¸­valueæ˜¯æ¶ˆæ¯ï¼Œtimestampæ˜¯åœ¨æºç”Ÿæˆæ­¤æ¶ˆæ¯çš„æ—¶é—´ã€‚ç”±äºæˆ‘ä»¬æ­£åœ¨æ„å»ºåŸºäºProcess Timeçš„ç³»ç»Ÿï¼Œå› æ­¤ä»¥ä¸‹ä»£ç å¿½ç•¥äº†æ—¶é—´æˆ³éƒ¨åˆ†ã€‚äº†è§£æ¶ˆæ¯åº”åŒ…å«ç”Ÿæˆæ—¶é—´çš„ä¿¡æ¯æ˜¯ä¸€ä¸ªé‡è¦çš„æ–¹é¢ã€‚Flinkæˆ–ä»»ä½•å…¶ä»–ç³»ç»Ÿä¸æ˜¯ä¸€ä¸ªé­”æœ¯ç›’ï¼Œå¯ä»¥ä»¥æŸç§æ–¹å¼è‡ªå·±å½¢æˆè¿™ä¸ªã€‚ç¨åæˆ‘ä»¬å°†çœ‹åˆ°ï¼Œäº‹ä»¶æ—¶é—´å¤„ç†æå–æ­¤æ—¶é—´æˆ³ä¿¡æ¯ä»¥å¤„ç†è¾ƒæ™šçš„æ¶ˆæ¯ã€‚æ”¯æŒäº‹ä»¶æ—¶é—´çš„æµå¤„ç†å™¨éœ€è¦ä¸€ç§æµ‹é‡äº‹ä»¶æ—¶é—´è¿›åº¦çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå½“äº‹ä»¶æ—¶é—´è¶…è¿‡ä¸€ä¸ªå°æ—¶ç»“æŸæ—¶ï¼Œéœ€è¦é€šçŸ¥æ„å»ºæ¯å°æ—¶çª—å£çš„çª—å£ç®—å­ï¼Œä»¥ä¾¿è¯¥çª—å£ç®—å­å¯ä»¥å…³é—­æ­£åœ¨è¿›è¡Œçš„çª—å£ã€‚Event Timeå¯ä»¥ç‹¬ç«‹äºProcess Timeè¿›è¡Œã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç¨‹åºä¸­ï¼Œçª—å£ç®—å­çš„å½“å‰äº‹ä»¶æ—¶é—´å¯èƒ½ä¼šç¨å¾®è½åäºå¤„ç†æ—¶é—´ ï¼ˆè€ƒè™‘åˆ°äº‹ä»¶æ¥æ”¶çš„å»¶è¿Ÿï¼‰ï¼Œè€Œä¸¤è€…å‡ä»¥ç›¸åŒçš„é€Ÿåº¦è¿›è¡Œã€‚å¦ä¸€æ–¹é¢ï¼Œå¦ä¸€ä¸ªæµåª’ä½“ç¨‹åºå¯ä»¥é€šè¿‡å¿«é€Ÿè½¬å‘å·²ç»åœ¨Kafkaä¸»é¢˜ï¼ˆæˆ–å¦ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ä¸­ç¼“å­˜çš„ä¸€äº›å†å²æ•°æ®æ¥åœ¨æ•°å‘¨çš„äº‹ä»¶æ—¶é—´å†…è¿›è¡Œå¤„ç†ï¼Œè€Œå¤„ç†æ—¶é—´ä»…ä¸ºå‡ ç§’é’Ÿã€‚æƒ…å†µ1æ¶ˆæ¯åˆ°è¾¾ä¸é—´æ–­å‡è®¾æºåˆ†åˆ«åœ¨æ—¶é—´13ç§’ç”Ÿäº§ä¸¤æ¡æ¶ˆæ¯å’Œç¬¬16ç§’äº§ç”Ÿä¸€æ¡ï¼Œç±»å‹ä¸ºaçš„ä¸‰ä¸ªæ¶ˆæ¯ã€‚ï¼ˆå°æ—¶å’Œåˆ†é’Ÿä¸é‡è¦ï¼Œå› ä¸ºçª—å£å¤§å°åªæœ‰10ç§’ï¼‰ã€‚è¿™äº›æ¶ˆæ¯å°†è½å…¥Windowsä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚åœ¨ç¬¬13ç§’äº§ç”Ÿçš„å‰ä¸¤ä¸ªæ¶ˆæ¯å°†è½å…¥window1 [5s-15s]å’Œwindow2 [10s-20s]ï¼Œç¬¬16ä¸ªæ—¶é—´ç”Ÿæˆçš„ç¬¬ä¸‰ä¸ªæ¶ˆæ¯å°†è½å…¥window2 [ 10s-20s]å’Œwindow3 [15s-25s] ]ã€‚æ¯ä¸ªwindowå‘å‡ºçš„æœ€ç»ˆè®¡æ•°åˆ†åˆ«ä¸ºï¼ˆaï¼Œ2ï¼‰ï¼Œï¼ˆaï¼Œ3ï¼‰å’Œï¼ˆaï¼Œ1ï¼‰ã€‚è¯¥è¾“å‡ºå¯ä»¥è¢«è®¤ä¸ºæ˜¯é¢„æœŸçš„è¡Œä¸ºã€‚ç°åœ¨æˆ‘ä»¬å°†çœ‹çœ‹å½“ä¸€ä¸ªæ¶ˆæ¯åˆ°è¾¾ç³»ç»Ÿçš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆã€‚æƒ…å†µ2æ¶ˆæ¯åˆ°è¾¾å»¶è¿Ÿç°åœ¨å‡è®¾å…¶ä¸­ä¸€æ¡æ¶ˆæ¯ï¼ˆåœ¨ç¬¬13ç§’ç”Ÿæˆï¼‰åˆ°è¾¾å»¶è¿Ÿ6ç§’ï¼ˆå³ç¬¬19ç§’æ‰åˆ°è¾¾ï¼‰ï¼Œå¯èƒ½æ˜¯ç”±äºæŸäº›ç½‘ç»œæ‹¥å¡ã€‚ä½ èƒ½çŒœæµ‹è¿™ä¸ªæ¶ˆæ¯ä¼šè½å…¥å“ªä¸ªwindowï¼Ÿå»¶è¿Ÿçš„æ¶ˆæ¯è½å…¥window2å’Œwindow3ï¼Œå› ä¸º19ç§’åœ¨10-20å’Œ15-25ä¹‹é—´ã€‚åœ¨window2ä¸­è®¡ç®—æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼ˆå› ä¸ºæ¶ˆæ¯åº”è¯¥è½å…¥è¯¥çª—å£ï¼‰ï¼Œä½†æ˜¯å®ƒå½±å“äº†window1å’Œwindow3çš„ç»“æœã€‚æˆ‘ä»¬ç°åœ¨å°†å°è¯•ä½¿ç”¨EventTimeå¤„ç†æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åŸºäºEventTimeçš„ç³»ç»Ÿè¦å¯ç”¨EventTimeå¤„ç†ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ—¶é—´æˆ³æå–å™¨ï¼Œä»è¾“å…¥çš„æ•°æ®ä¸­æå–Event Timeä¿¡æ¯ã€‚è¯·è®°ä½ï¼Œæ•°æ®çš„æ ¼å¼æ˜¯Valueï¼ŒTimestampã€‚è¯¥extractTimestampæ–¹æ³•è·å–Timestampéƒ¨åˆ†ï¼Œå¹¶ä»¥Longå‹è¿›è¡Œè¿”å›ã€‚ç°åœ¨å¿½ç•¥getCurrentWatermarkæ–¹æ³•ï¼Œæˆ‘ä»¬ç¨åå†å›æ¥ã€‚12345678class TimestampExtractor extends AssignerWithPeriodicWatermarks[String] with Serializable &#123; override def extractTimestamp(e: String, prevElementTimestamp: Long) = &#123; e.split(\",\")(1).toLong &#125; override def getCurrentWatermark(): Watermark = &#123; new Watermark(System.currentTimeMillis) &#125;&#125;æˆ‘ä»¬ç°åœ¨éœ€è¦è®¾ç½®è¿™ä¸ªæ—¶é—´æˆ³æå–å™¨ï¼Œå¹¶å°†TimeCharactersisticè®¾ç½®ä¸ºEventTimeã€‚å…¶ä½™çš„ä»£ç ä¸ProcessingTimeçš„æƒ…å†µä¿æŒä¸€è‡´ã€‚123456789senv.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)val text = senv.socketTextStream(\"localhost\", 9999) .assignTimestampsAndWatermarks(new TimestampExtractor) val counts = text.map &#123;(m: String) =&gt; (m.split(\",\")(0), 1) &#125; .keyBy(0) .timeWindow(Time.seconds(10), Time.seconds(5)) .sum(1)counts.printsenv.execute(\"EventTime processing example\")è¿è¡Œä¸Šè¿°ä»£ç çš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ç»“æœçœ‹èµ·æ¥å¥½ä¸€äº›ï¼Œwindow 2å’Œwindow 3ç°åœ¨å¾—åˆ°äº†æ­£ç¡®çš„ç»“æœï¼Œä½†æ˜¯window 1ä»ç„¶æ˜¯é”™è¯¯çš„ã€‚Flinkæ²¡æœ‰å°†å»¶è¿Ÿçš„æ¶ˆæ¯åˆ†é…ç»™window 3ï¼Œå› ä¸ºå®ƒç°åœ¨æ£€æŸ¥äº†æ¶ˆæ¯çš„äº‹ä»¶æ—¶é—´ï¼Œå¹¶ä¸”ç†è§£å®ƒä¸åœ¨è¯¥çª—å£ä¸­ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆæ²¡æœ‰å°†æ¶ˆæ¯åˆ†é…ç»™window 1 å‘¢ï¼ŸåŸå› æ˜¯åœ¨å»¶è¿Ÿçš„ä¿¡æ¯åˆ°è¾¾ç³»ç»Ÿæ—¶ï¼ˆç¬¬19ç§’ï¼‰ï¼Œwindow 1çš„çª—å£è®¡ç®—å·²ç»å®Œæˆäº†ï¼ˆç¬¬15ç§’ï¼‰ã€‚ç°åœ¨è®©æˆ‘ä»¬å°è¯•é€šè¿‡ä½¿ç”¨watermarkæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ps:è¯·æ³¨æ„ï¼Œåœ¨window 2ä¸­ï¼Œå»¶è¿Ÿçš„æ¶ˆæ¯ä»ç„¶ä½äºç¬¬19ç§’ï¼Œè€Œä¸æ˜¯ç¬¬13ç§’ï¼ˆäº‹ä»¶æ—¶é—´ï¼‰ã€‚è¯¥å›¾ä¸­çš„æè¿°æ˜¯æ•…æ„è¡¨ç¤ºçª—å£ä¸­çš„æ¶ˆæ¯ä¸ä¼šæ ¹æ®äº‹ä»¶æ—¶é—´è¿›è¡Œæ’åºã€‚ï¼ˆè¿™å¯èƒ½ä¼šåœ¨å°†æ¥æ”¹å˜ï¼‰WaterMarkwatermarkæ˜¯ä¸€ä¸ªéå¸¸é‡è¦å’Œæœ‰è¶£çš„æƒ³æ³•ï¼Œwatermarkæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ—¶é—´æˆ³ã€‚å½“Flinkä¸­çš„è¿ç®—ç¬¦æ¥æ”¶åˆ°watermarkæ—¶ï¼Œå®ƒæ˜ç™½ï¼ˆå‡è®¾ï¼‰å®ƒä¸ä¼šçœ‹åˆ°æ¯”è¯¥æ—¶é—´æˆ³æ›´æ—©çš„æ¶ˆæ¯ã€‚ï¼ˆ åŸæ–‡ï¼šA Watermark is essentially a timestamp. When an Operator in Flink receives a watermark, it understands(assumes) that it is not going to see any message older than that timestamp.æˆ‘è¿™é‡Œç†è§£æ˜¯ç¿»è¯‘ä¸ºæ›´æ—©çš„ä¿¡æ¯æˆ–è€…æ›´æ™šçš„ä¿¡æ¯éƒ½å¯ä»¥ï¼Œå› ä¸ºä»æ—¶é—´ä¸Šæ¥è¯´ï¼Œ1990å¹´æ¯”1994å¹´è¦è€ï¼Œä½†æ˜¯1990å¹´æ¯”1994å¹´ä¹Ÿæ˜¯å¯ä»¥è¯´æ˜¯æ—©çš„ï¼Œé‚£ä¹ˆå°±æ˜¯å®ƒçœ‹ä¸åˆ°æ›´æ—©/è€çš„ä¿¡æ¯ï¼‰å› æ­¤ï¼Œåœ¨â€œEventTimeâ€ä¸­ï¼Œwatermarkä¹Ÿå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ç§å‘Šè¯‰Flinkå®ƒæœ‰å¤šè¿œçš„ä¸€ç§æ–¹å¼ã€‚Flinkä¸­è¡¡é‡Event Timeè¿›åº¦çš„æœºåˆ¶æ˜¯watermarkæ°´å°ã€‚watermarkç®€å•çš„æ¥è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªå»¶è¿Ÿè§¦å‘æœºåˆ¶ï¼Œwatermarkä¼´éšç€æ¯ä¸€æ¡æ•°æ®ï¼Œä½œä¸ºæ•°æ®æµçš„ä¸€éƒ¨åˆ†æµåŠ¨ï¼Œå¹¶å¸¦æœ‰æ—¶é—´æˆ³_tï¼Œ_å…¶å€¼ä¸ºå½“å‰å·²æµå…¥æ•°æ®ä¸­æœ€å¤§çš„Event Time-æœ€å¤§å»¶è¿Ÿæ—¶é—´ maxEventTime(ç¨‹åºä¸­è‡ªå®šä¹‰)ï¼Œå½“watermarkçš„å€¼å¤§äºç­‰äºæŸä¸ªçª—å£çš„ç»“æŸæ—¶é—´ï¼Œåˆ™é‚£ä¸ªçª—å£ç«‹å³è§¦å‘æ‰§è¡Œã€‚è¿™ä¸ªä¾‹å­çš„ç›®çš„ï¼ŒæŠŠå®ƒçœ‹ä½œæ˜¯ä¸€ç§å‘Šè¯‰Flinkä¸€ä¸ªæ¶ˆæ¯ä¼šå»¶è¿Ÿå¤šå°‘çš„æ–¹å¼ã€‚åœ¨ä¸Šä¸€æ¬¡å°è¯•ä¸­ï¼Œæˆ‘ä»¬å°†watermarkè®¾ç½®ä¸ºå½“å‰ç³»ç»Ÿæ—¶é—´ã€‚å› æ­¤ï¼Œä¸è¦æŒ‡æœ›ä»»ä½•å»¶è¿Ÿçš„æ¶ˆæ¯ã€‚æˆ‘ä»¬ç°åœ¨å°†æ°´å°è®¾ç½®ä¸ºå½“å‰æ—¶é—´-5ç§’ï¼Œè¿™å‘Šè¯‰Flinkå¸Œæœ›æ¶ˆæ¯æœ€å¤šæœ‰5sçš„å»¶è¿Ÿï¼Œè¿™æ˜¯å› ä¸ºæ¯ä¸ªçª—å£ä»…åœ¨æ°´å°é€šè¿‡æ—¶è¢«è¯„ä¼°ã€‚ç”±äºæˆ‘ä»¬çš„æ°´å°æ˜¯å½“å‰æ—¶é—´-5ç§’ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªçª—å£[5s-15s]å°†ä»…åœ¨ç¬¬20ç§’è¢«è¯„ä¼°ã€‚ç±»ä¼¼åœ°ï¼Œçª—å£[10s-20s]å°†åœ¨ç¬¬25ç§’è¿›è¡Œè¯„ä¼°ï¼Œä¾æ­¤ç±»æ¨ã€‚123override def getCurrentWatermark(): Watermark &#x3D; &#123; new Watermark(System.currentTimeMillis - 5000) &#125;é€šå¸¸æœ€å¥½ä¿æŒæ¥æ”¶åˆ°çš„æœ€å¤§æ—¶é—´æˆ³ï¼Œå¹¶åˆ›å»ºå…·æœ‰æœ€å¤§é¢„æœŸå»¶è¿Ÿçš„æ°´å°ï¼Œè€Œä¸æ˜¯ä»å½“å‰ç³»ç»Ÿæ—¶é—´å‡å»ã€‚è¿›è¡Œä¸Šè¿°æ›´æ”¹åè¿è¡Œä»£ç çš„ç»“æœæ˜¯ï¼šæœ€åæˆ‘ä»¬å¾—åˆ°äº†æ­£ç¡®çš„ç»“æœï¼Œæ‰€æœ‰è¿™ä¸‰ä¸ªçª—å£ç°åœ¨éƒ½æŒ‰ç…§é¢„æœŸçš„æ–¹å¼å‘å°„è®¡æ•°ï¼Œè¿™æ˜¯ï¼ˆaï¼Œ2ï¼‰ï¼Œï¼ˆaï¼Œ3ï¼‰å’Œï¼ˆaï¼Œ1ï¼‰ã€‚æ³¨æ„ï¼šæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨AllowedLatenessåŠŸèƒ½è®¾ç½®æ¶ˆæ¯çš„æœ€å¤§å…è®¸æ—¶é—´æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªåé¢æˆ‘ä»¬å†è®²Watermarks in Parallel Streamså¹¶è¡Œæµä¸­çš„æ°´å°watermarkåœ¨æºå‡½æ•°å¤„æˆ–æºå‡½æ•°ä¹‹åç›´æ¥ç”Ÿæˆã€‚æºå‡½æ•°çš„æ¯ä¸ªå¹¶è¡Œå­ä»»åŠ¡é€šå¸¸ç‹¬ç«‹ç”Ÿæˆå…¶æ°´å°ã€‚è¿™äº›æ°´å°å®šä¹‰äº†è¯¥å¹¶è¡Œæºå¤„çš„event timeã€‚éšç€watermarkåœ¨æµå¼ä¼ è¾“ç¨‹åºä¸­çš„æµåŠ¨ï¼Œå®ƒä»¬å¯èƒ½ä¼šæ¯”operatorså¤„çš„äº‹ä»¶æ—¶é—´æå‰åˆ°è¾¾ã€‚æ¯å½“ä¸€ä¸ªoperatorsæå‰å®ƒçš„äº‹ä»¶æ—¶é—´ï¼Œå®ƒä¸ºå®ƒçš„åç»§æ“ä½œç¬¦äº§ç”Ÿä¸€ä¸ªæ–°çš„ä¸‹æ¸¸æ°´å°ã€‚ä¸€äº›ç®—å­å°†æ¶ˆè€—å¤šä¸ªè¾“å…¥æµï¼›ä¾‹å¦‚ï¼Œå¹¶é›†ï¼ŒkeyByï¼ˆï¼‰æˆ–partitionï¼ˆï¼‰å‡½æ•°çš„è¿ç®—ç¬¦ã€‚è¯¥operatorçš„å½“å‰äº‹ä»¶æ—¶é—´æ˜¯å…¶è¾“å…¥æµçš„äº‹ä»¶æ—¶é—´ä¸­çš„æœ€å°å€¼ã€‚éšç€å…¶è¾“å…¥æµæ›´æ–°å…¶äº‹ä»¶æ—¶é—´ï¼Œoperatorä¹Ÿå°†æ›´æ–°ã€‚ä¹Ÿå°±æ˜¯operatorä¼šåœ¨å„ä¸ªåˆ°è¾¾çš„event timeä¸­ï¼Œé€‰æ‹©æœ€å°çš„event timeè¿›è¡Œâ€œå¯¹é½â€ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†æµè¿‡å¹¶è¡Œæµçš„äº‹ä»¶å’Œæ°´å°çš„ç¤ºä¾‹ï¼Œæ“ä½œå‘˜è·Ÿè¸ªäº‹ä»¶æ—¶é—´ã€‚è¯·æ³¨æ„ï¼ŒKafkaæºæ”¯æŒæŒ‰åˆ†åŒºæ·»åŠ æ°´å°ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤å¤„é˜…è¯»æ›´å¤šä¿¡æ¯ã€‚Late Elementsè¿Ÿåˆ°å…ƒç´ **æŸäº›å…ƒç´ å¯èƒ½ä¼šè¿åæ°´å°æ¡ä»¶ï¼Œè¿™æ„å‘³ç€åœ¨_æ°´å°ï¼ˆtï¼‰_ä¹‹åå‘ç”Ÿï¼Œä¹Ÿä¼šå‡ºç°æ›´å¤šæ—¶é—´æˆ³ä¸º_tâ€™&lt;= tçš„_å…ƒç´ ã€‚å®é™…ä¸Šï¼Œåœ¨è®¸å¤šç°å®ä¸–ç•Œçš„è®¾ç½®ä¸­ï¼ŒæŸäº›å…ƒç´ å¯ä»¥ä»»æ„å»¶è¿Ÿï¼Œè¿™ä½¿å¾—ä¸å¯èƒ½æŒ‡å®šæŸä¸ªäº‹ä»¶æ—¶é—´æˆ³çš„æ‰€æœ‰å…ƒç´ å‘ç”Ÿçš„æ—¶é—´ã€‚æ­¤å¤–ï¼Œå³ä½¿å¯ä»¥é™åˆ¶å»¶è¿Ÿï¼Œé€šå¸¸ä¹Ÿä¸å¸Œæœ›å°†æ°´å°å»¶è¿Ÿå¤ªå¤šï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´äº‹ä»¶æ—¶é—´çª—çš„è¯„ä¼°å»¶è¿Ÿè¿‡å¤šã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œæµå¼ä¼ è¾“ç¨‹åºå¯èƒ½ä¼šæ˜ç¡®æœŸæœ›æŸäº›_åæœŸ_å…ƒç´ ã€‚å»¶è¿Ÿå…ƒç´ æ˜¯åœ¨ç³»ç»Ÿçš„äº‹ä»¶æ—¶é—´æ—¶é’Ÿï¼ˆç”±æ°´å°æŒ‡ç¤ºï¼‰å·²ç»ç»è¿‡å»¶è¿Ÿå…ƒç´ æ—¶é—´æˆ³çš„æ—¶é—´ä¹‹ååˆ°è¾¾çš„å…ƒç´ ã€‚æœ‰å…³å¦‚ä½•åœ¨äº‹ä»¶æ—¶é—´çª—å£ä¸­ä½¿ç”¨å»¶è¿Ÿå…ƒç´ çš„æ›´å¤šä¿¡æ¯è¯·å‚è§å…è®¸å»¶è¿Ÿã€‚ç”Ÿæˆæ—¶é—´æˆ³/æ°´å°æœ¬èŠ‚ä¸åœ¨event timeè¿è¡Œçš„ç¨‹åºæœ‰å…³ã€‚æœ‰å…³äº‹ä»¶æ—¶é—´ï¼Œ å¤„ç†æ—¶é—´å’Œæ‘„å–æ—¶é—´çš„ç®€ä»‹ï¼Œè¯·å‚é˜…äº‹ä»¶æ—¶é—´çš„ç®€ä»‹ã€‚ä¸ºäº†å¤„ç†**äº‹ä»¶æ—¶é—´ï¼Œæµå¼ä¼ è¾“ç¨‹åºéœ€è¦ç›¸åº”åœ°è®¾ç½®æ—¶é—´ç‰¹å¾**ã€‚12val env = StreamExecutionEnvironment.getExecutionEnvironmentenv.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)åˆ†é…æ—¶é—´æˆ³ä¸ºäº†ä½¿ç”¨äº‹ä»¶æ—¶é—´ï¼ŒFlinkéœ€è¦çŸ¥é“äº‹ä»¶çš„æ—¶é—´æˆ³ï¼Œè¿™æ„å‘³ç€æµä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½éœ€è¦åˆ†é…å…¶äº‹ä»¶æ—¶é—´æˆ³ã€‚è¿™é€šå¸¸æ˜¯é€šè¿‡ä»å…ƒç´ çš„æŸä¸ªå­—æ®µè®¿é—®/æå–æ—¶é—´æˆ³æ¥å®Œæˆçš„ã€‚æ—¶é—´æˆ³åˆ†é…ä¸ç”Ÿæˆæ°´å°é½å¤´å¹¶è¿›ï¼Œæ°´å°å‘Šè¯‰ç³»ç»Ÿäº‹ä»¶æ—¶é—´çš„è¿›å±•ã€‚æœ‰ä¸¤ç§åˆ†é…æ—¶é—´æˆ³å’Œç”Ÿæˆæ°´å°çš„æ–¹æ³•ï¼šç›´æ¥åœ¨æ•°æ®æµæºä¸­é€šè¿‡æ—¶é—´æˆ³åˆ†é…å™¨/æ°´å°ç”Ÿæˆå™¨ï¼šåœ¨Flinkä¸­ï¼Œæ—¶é—´æˆ³åˆ†é…å™¨è¿˜å®šä¹‰è¦å‘é€çš„æ°´å°æ³¨æ„**è‡ª1970å¹´1æœˆ1æ—¥T00ï¼š00ï¼š00Zçš„Javaæ—¶ä»£ä»¥æ¥ï¼Œæ—¶é—´æˆ³å’Œæ°´å°éƒ½æŒ‡å®šä¸ºæ¯«ç§’ã€‚å¸¦æœ‰æ—¶é—´æˆ³å’Œæ°´å°çš„æºå‡½æ•°æµæºå¯ä»¥å°†æ—¶é—´æˆ³ç›´æ¥åˆ†é…ç»™å®ƒä»¬äº§ç”Ÿçš„å…ƒç´ ï¼Œå¹¶ä¸”å®ƒä»¬è¿˜å¯ä»¥å‘å‡ºæ°´å°ã€‚å®Œæˆæ­¤æ“ä½œåï¼Œæ— éœ€æ—¶é—´æˆ³åˆ†é…å™¨ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨æ—¶é—´æˆ³åˆ†é…å™¨ï¼Œåˆ™æºæ‰€æä¾›çš„ä»»ä½•æ—¶é—´æˆ³å’Œæ°´å°éƒ½å°†è¢«è¦†ç›–ã€‚è¦å°†æ—¶é—´æˆ³ç›´æ¥åˆ†é…ç»™æºä¸­çš„å…ƒç´ ï¼Œæºå¿…é¡»ä½¿ç”¨ä¸Šçš„collectWithTimestamp() æ–¹æ³•SourceContextã€‚è¦ç”Ÿæˆæ°´å°ï¼Œæºå¿…é¡»è°ƒç”¨è¯¥emitWatermark(Watermark)å‡½æ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼ˆéæ£€æŸ¥ç‚¹ï¼‰æºï¼Œè¯¥æºåˆ†é…æ—¶é—´æˆ³å¹¶ç”Ÿæˆæ°´å°ï¼š12345678910override def run(ctx: SourceContext[MyType]): Unit &#x3D; &#123; while (&#x2F;* condition *&#x2F;) &#123; val next: MyType &#x3D; getNext() ctx.collectWithTimestamp(next, next.eventTimestamp) if (next.hasWatermarkTime) &#123; ctx.emitWatermark(new Watermark(next.getWatermarkTime)) &#125; &#125;&#125;**å¸¦æœ‰å®šæœŸæ°´å°AssignerWithPeriodicWatermarks åˆ†é…æ—¶é—´æˆ³å¹¶å®šæœŸç”Ÿæˆæ°´å°ã€‚é€šè¿‡å®šä¹‰ç”Ÿæˆæ°´å°çš„é—´éš”ï¼ˆæ¯næ¯«ç§’ï¼‰ ExecutionConfig.setAutoWatermarkInterval()ã€‚åˆ†é…å™¨çš„getCurrentWatermark()æ–¹æ³•æ¯æ¬¡éƒ½ä¼šè¢«è°ƒç”¨ï¼Œå¦‚æœè¿”å›çš„æ°´å°éç©ºä¸”å¤§äºå‰ä¸€ä¸ªæ°´å°ï¼Œåˆ™å°†å‘å‡ºæ–°çš„æ°´å°ã€‚Flinkæä¾›äº†æŠ½è±¡ï¼Œå…è®¸ç¨‹åºå‘˜åˆ†é…è‡ªå·±çš„æ—¶é—´æˆ³å¹¶å‘å‡ºè‡ªå·±çš„æ°´å°ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œæ ¹æ®ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥é€šè¿‡å®ç°AssignerWithPeriodicWatermarkså’ŒAssignerWithPunctuatedWatermarksæ¥å£ä¹‹ä¸€æ¥å®ç°ã€‚ç®€è€Œè¨€ä¹‹ï¼Œç¬¬ä¸€ä¸ªå°†å®šæœŸå‘å‡ºæ°´å°ï¼Œè€Œç¬¬äºŒä¸ªåˆ™æ ¹æ®ä¼ å…¥è®°å½•çš„æŸäº›å±æ€§å‘å‡ºæ°´å°ï¼Œä¾‹å¦‚ï¼Œæ¯å½“æµä¸­é‡åˆ°ç‰¹æ®Šå…ƒç´ æ—¶ã€‚ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–æ­¤ç±»ä»»åŠ¡çš„ç¼–ç¨‹å·¥ä½œï¼ŒFlinké™„å¸¦äº†ä¸€äº›é¢„å…ˆå®ç°çš„æ—¶é—´æˆ³åˆ†é…å™¨ã€‚æœ¬èŠ‚æä¾›äº†å®ƒä»¬çš„åˆ—è¡¨ã€‚é™¤äº†å¼€ç®±å³ç”¨çš„åŠŸèƒ½å¤–ï¼Œå®ƒä»¬çš„å®ç°è¿˜å¯ä»¥ä½œä¸ºè‡ªå®šä¹‰å®ç°çš„ç¤ºä¾‹ã€‚**æ—¶é—´æˆ³é€’å¢çš„åˆ†é…è€…_å®šæœŸç”Ÿæˆæ°´å°çš„æœ€ç®€å•çš„ç‰¹æ®Šæƒ…å†µæ˜¯ç»™å®šæºä»»åŠ¡çœ‹åˆ°çš„æ—¶é—´æˆ³ä»¥å‡åºå‡ºç°çš„æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å‰æ—¶é—´æˆ³å§‹ç»ˆå¯ä»¥å……å½“æ°´å°ï¼Œå› ä¸ºæ²¡æœ‰æ›´æ—©çš„æ—¶é—´æˆ³ä¼šåˆ°è¾¾ã€‚è¯·æ³¨æ„ï¼Œæ¯ä¸ªå¹¶è¡Œæ•°æ®æºä»»åŠ¡åªéœ€è¦å¢åŠ æ—¶é—´æˆ³è®°å³å¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨ä¸€ä¸ªç‰¹å®šçš„è®¾ç½®ä¸­ä¸€ä¸ªå¹¶è¡Œæ•°æ®æºå®ä¾‹è¯»å–ä¸€ä¸ªKafkaåˆ†åŒºï¼Œåˆ™ä»…åœ¨æ¯ä¸ªKafkaåˆ†åŒºå†…å°†æ—¶é—´æˆ³è®°é€’å¢æ˜¯å¿…è¦çš„ã€‚æ¯å½“å¯¹å¹¶è¡Œæµè¿›è¡Œæ··æ´—ï¼Œåˆå¹¶ï¼Œè¿æ¥æˆ–åˆå¹¶æ—¶ï¼ŒFlinkçš„æ°´å°åˆå¹¶æœºåˆ¶éƒ½ä¼šç”Ÿæˆæ­£ç¡®çš„æ°´å°ã€‚12val stream: DataStream[MyEvent] = ...val withTimestampsAndWatermarks = stream.assignAscendingTimestamps( _.getCreationTime )**åˆ†é…å™¨å…è®¸å›ºå®šçš„å»¶è¿Ÿæ—¶é—´å‘¨æœŸæ€§æ°´å°ç”Ÿæˆçš„å¦ä¸€ä¸ªç¤ºä¾‹æ˜¯æ°´å°åœ¨æµä¸­çœ‹åˆ°çš„æœ€å¤§ï¼ˆäº‹ä»¶æ—¶é—´ï¼‰æ—¶é—´æˆ³è½åå›ºå®šæ—¶é—´é‡çš„æƒ…å†µã€‚è¿™ç§æƒ…å†µæ¶µç›–äº†é¢„å…ˆçŸ¥é“æµä¸­å¯èƒ½é‡åˆ°çš„æœ€å¤§å»¶è¿Ÿçš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼Œå½“åˆ›å»ºåŒ…å«æ—¶é—´æˆ³çš„å…ƒç´ çš„è‡ªå®šä¹‰æºæ—¶ï¼Œè¯¥æ—¶é—´æˆ³åœ¨å›ºå®šæ—¶é—´æ®µå†…ä¼ æ’­ä»¥è¿›è¡Œæµ‹è¯•ã€‚å¯¹äºè¿™äº›æƒ…å†µï¼ŒFlinkæä¾›äº†BoundedOutOfOrdernessTimestampExtractorï¼Œå°†ç”¨ä½œå‚æ•°maxOutOfOrdernessï¼Œå³åœ¨è®¡ç®—ç»™å®šçª—å£çš„æœ€ç»ˆç»“æœæ—¶å…è®¸å…ƒç´ å»¶è¿Ÿåˆ°è¢«å¿½ç•¥ä¹‹å‰çš„æœ€é•¿æ—¶é—´ã€‚å»¶è¿Ÿå¯¹åº”äºçš„ç»“æœt - t_wï¼Œå…¶ä¸­tå…ƒç´ çš„ï¼ˆäº‹ä»¶æ—¶é—´ï¼‰æ—¶é—´æˆ³å’Œt_wå‰ä¸€ä¸ªæ°´å°çš„æ—¶é—´æˆ³ã€‚å¦‚æœlateness &gt; 0é‚£ä¹ˆè¯¥å…ƒç´ å°†è¢«è®¤ä¸ºæ˜¯è¾ƒæ™šçš„å…ƒç´ ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ä¸ºå…¶ç›¸åº”çª—å£è®¡ç®—ä½œä¸šç»“æœæ—¶å°†å…¶å¿½ç•¥ã€‚æœ‰å…³ ä½¿ç”¨å»¶è¿Ÿå…ƒç´ çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§æœ‰å…³å…è®¸å»¶è¿Ÿçš„æ–‡æ¡£ã€‚12val stream: DataStream[MyEvent] = ...val withTimestampsAndWatermarks = stream.assignTimestampsAndWatermarks(new BoundedOutOfOrdernessTimestampExtractor[MyEvent](Time.seconds(10))( _.getCreationTime ))**å¸¦æ ‡ç‚¹çš„æ°´å°**è¦åœ¨ç‰¹å®šäº‹ä»¶è¡¨æ˜å¯èƒ½ä¼šç”Ÿæˆæ–°çš„æ°´å°æ—¶ç”Ÿæˆæ°´å°ï¼Œè¯·ä½¿ç”¨ AssignerWithPunctuatedWatermarksã€‚å¯¹äºæ­¤ç±»ï¼ŒFlinkå°†é¦–å…ˆè°ƒç”¨è¯¥extractTimestamp()æ–¹æ³•ä¸ºå…ƒç´ åˆ†é…æ—¶é—´æˆ³ï¼Œç„¶åç«‹å³checkAndGetNextWatermark()åœ¨è¯¥å…ƒç´ ä¸Šè°ƒç”¨è¯¥ æ–¹æ³•ã€‚è¯¥checkAndGetNextWatermark()æ–¹æ³•ä¼šä¼ é€’è¯¥æ–¹æ³•ä¸­åˆ†é…çš„æ—¶é—´æˆ³extractTimestamp() ï¼Œå¹¶å¯ä»¥å†³å®šæ˜¯å¦è¦ç”Ÿæˆæ°´å°ã€‚æ¯å½“è¯¥checkAndGetNextWatermark() æ–¹æ³•è¿”å›ä¸€ä¸ªéç©ºæ°´å°ï¼Œå¹¶ä¸”è¯¥æ°´å°å¤§äºæœ€æ–°çš„å…ˆå‰æ°´å°æ—¶ï¼Œå°±ä¼šå‘å‡ºæ–°çš„æ°´å°ã€‚12345678910class PunctuatedAssigner extends AssignerWithPunctuatedWatermarks[MyEvent] &#123; override def extractTimestamp(element: MyEvent, previousElementTimestamp: Long): Long = &#123; element.getCreationTime &#125; override def checkAndGetNextWatermark(lastElement: MyEvent, extractedTimestamp: Long): Watermark = &#123; if (lastElement.hasWatermarkMarker()) new Watermark(extractedTimestamp) else null &#125;&#125;_æ³¨æ„ï¼š_å¯ä»¥åœ¨æ¯ä¸ªäº‹ä»¶ä¸Šç”Ÿæˆæ°´å°ã€‚ä½†æ˜¯ï¼Œç”±äºæ¯ä¸ªæ°´å°éƒ½ä¼šåœ¨ä¸‹æ¸¸å¼•èµ·ä¸€äº›è®¡ç®—ï¼Œå› æ­¤è¿‡å¤šçš„æ°´å°ä¼šé™ä½æ€§èƒ½ã€‚æ¯ä¸ªKafkaåˆ†åŒºçš„æ—¶é—´æˆ³å½“ä½¿ç”¨Apache Kafkaä½œä¸ºæ•°æ®æºæ—¶ï¼Œæ¯ä¸ªKafkaåˆ†åŒºå¯èƒ½éƒ½æœ‰ä¸€ä¸ªç®€å•çš„äº‹ä»¶æ—¶é—´æ¨¡å¼ï¼ˆæ—¶é—´æˆ³å‡åºæˆ–æœ‰ç•Œä¹±åºï¼‰ã€‚ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨æ¥è‡ªKafkaçš„æµæ—¶ï¼Œé€šå¸¸ä¼šå¹¶è¡Œä½¿ç”¨å¤šä¸ªåˆ†åŒºï¼Œä»è€Œäº¤é”™æ’å…¥åˆ†åŒºä¸­çš„äº‹ä»¶å¹¶ç ´åæ¯ä¸ªåˆ†åŒºçš„æ¨¡å¼ï¼ˆè¿™æ˜¯Kafkaçš„å®¢æˆ·å®¢æˆ·ç«¯å·¥ä½œæ–¹å¼æ‰€å›ºæœ‰çš„ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Flinkçš„Kafkaåˆ†åŒºæ„ŸçŸ¥æ°´å°ç”Ÿæˆã€‚ä½¿ç”¨è¯¥åŠŸèƒ½ï¼Œå°†åœ¨Kafkaä½¿ç”¨è€…å†…éƒ¨é’ˆå¯¹æ¯ä¸ªKafkaåˆ†åŒºç”Ÿæˆæ°´å°ï¼Œå¹¶ä¸”æŒ‰ä¸åˆå¹¶æ°´å°åœ¨æµshuffleä¸Šç›¸åŒçš„æ–¹å¼åˆå¹¶æ¯ä¸ªåˆ†åŒºçš„æ°´å°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœäº‹ä»¶æ—¶é—´æˆ³ä¸¥æ ¼æŒ‰ç…§æ¯ä¸ªKafkaåˆ†åŒºé€’å¢ï¼Œåˆ™ä½¿ç”¨é€’å¢æ—¶é—´æˆ³æ°´å°ç”Ÿæˆå™¨ç”ŸæˆæŒ‰åˆ†åŒºçš„æ°´å° å°†äº§ç”Ÿå®Œç¾çš„æ•´ä½“æ°´å°ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨æŒ‰kafkaåˆ†åŒºçš„æ°´å°ç”Ÿæˆï¼Œä»¥åŠåœ¨è¿™ç§æƒ…å†µä¸‹æ°´å°å¦‚ä½•é€šè¿‡æµæ•°æ®æµä¼ æ’­ã€‚123456val kafkaSource = new FlinkKafkaConsumer09[MyType](\"myTopic\", schema, props)kafkaSource.assignTimestampsAndWatermarks(new AscendingTimestampExtractor[MyType] &#123; def extractAscendingTimestamp(element: MyType): Long = element.eventTimestamp&#125;)val stream: DataStream[MyType] = env.addSource(kafkaSource)é¢„å®šä¹‰çš„æ—¶é—´æˆ³æå–å™¨/æ°´å°å‘å°„å™¨å¦‚æ—¶é—´æˆ³å’Œæ°´å°å¤„ç†ä¸­æ‰€è¿°ï¼ŒFlinkæä¾›äº†æŠ½è±¡ï¼Œå…è®¸ç¨‹åºå‘˜åˆ†é…è‡ªå·±çš„æ—¶é—´æˆ³å¹¶å‘å‡ºè‡ªå·±çš„æ°´å°ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œæ ¹æ®ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥é€šè¿‡å®ç°AssignerWithPeriodicWatermarkså’ŒAssignerWithPunctuatedWatermarksæ¥å£ä¹‹ä¸€æ¥å®ç°ã€‚ç®€è€Œè¨€ä¹‹ï¼Œç¬¬ä¸€ä¸ªå°†å®šæœŸå‘å‡ºæ°´å°ï¼Œè€Œç¬¬äºŒä¸ªåˆ™æ ¹æ®ä¼ å…¥è®°å½•çš„æŸäº›å±æ€§å‘å‡ºæ°´å°ï¼Œä¾‹å¦‚ï¼Œæ¯å½“æµä¸­é‡åˆ°ç‰¹æ®Šå…ƒç´ æ—¶ã€‚ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–æ­¤ç±»ä»»åŠ¡çš„ç¼–ç¨‹å·¥ä½œï¼ŒFlinké™„å¸¦äº†ä¸€äº›é¢„å…ˆå®ç°çš„æ—¶é—´æˆ³åˆ†é…å™¨ã€‚æœ¬èŠ‚æä¾›äº†å®ƒä»¬çš„åˆ—è¡¨ã€‚é™¤äº†å¼€ç®±å³ç”¨çš„åŠŸèƒ½å¤–ï¼Œå®ƒä»¬çš„å®ç°è¿˜å¯ä»¥ä½œä¸ºè‡ªå®šä¹‰å®ç°çš„ç¤ºä¾‹ã€‚åœ¨ Flink watermarkè¿™ä¸€æ¨¡å—ï¼Œç›¸å¯¹äºSpark Streamingæ¥è¯´ï¼Œç¡®å®æœ‰äº›æ™¦æ¶©éš¾æ‡‚ï¼Œåœ¨å‰é¢çš„ä¸€äº›ç« èŠ‚ä¸­ï¼ŒFlinkç¨‹åºä¸¾ä¾‹æˆ‘éƒ½æ˜¯ç›´æ¥å¯¹æ¥kafkaè¯»å–æ•°æ®è¿›è¡Œå¤„ç†ï¼Œä½†æ˜¯åœ¨watermarkæ¨¡å—ä¸­ï¼Œè¿˜æ˜¯ä½¿ç”¨socketå‘é€æ•°æ®ï¼Œå¯ä»¥æ›´æ¸…æ™°çš„çœ‹å‡ºFlink watermarkæœºåˆ¶ä¸‹çª—å£çš„è§¦å‘ã€‚ä¸‹é¢å°±æ˜¯é’ˆå¯¹watermarkè¿›è¡Œçš„ç¨‹åºå®ä¾‹ã€‚åŸºäºæœ‰åºæ•°æ®çš„watermarkï¼Œä»¥ä¸‹ä»£ç éœ€æ±‚åœºæ™¯ï¼Œæˆ‘æ ¹æ®å…¬å¸æ¸¸æˆç›‘æ§é¡¹ç›®çš„æœ€åŸºæœ¬çš„åŸç†ï¼Œä½¿ç”¨ç®€æ´çš„æ•°æ®è¿›è¡Œæ¼”ç¤ºï¼Œæ¯5ç§’è®¡ç®—è¿‘10ç§’ä¸­ï¼Œç½‘å…³ä¼ é€’æ•°æ®å»¶è¿Ÿæ—¶é—´æœ€å¤§çš„æ­¥éª¤ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758package data_stream.watermarkimport java.text.SimpleDateFormatimport java.util.Dateimport org.apache.flink.api.common.functions.ReduceFunctionimport org.apache.flink.streaming.api.scala._import org.apache.flink.streaming.api.TimeCharacteristicimport org.apache.flink.streaming.api.scala.function.WindowFunctionimport org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment&#125;import org.apache.flink.streaming.api.windowing.time.Timeimport org.apache.flink.streaming.api.windowing.windows.TimeWindowimport org.apache.flink.util.Collectorobject watermark_orderness &#123; case class game_gateway_data(user_id: String, step_num: String, gateway_time: Long, gateway_name: String, delay_time: Int) def main(args: Array[String]): Unit = &#123; val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment env.setParallelism(1) env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime) val socketStream: DataStream[String] = env.socketTextStream(\"localhost\",8888) val gameGatewayStream: DataStream[game_gateway_data] = socketStream.map((line: String) =&gt; &#123; val array_data: Array[String] = line.split(\",\") game_gateway_data(array_data(0), array_data(1), array_data(2).toLong, array_data(3), array_data(4).toInt) &#125;) //è®¾ç½®æ—¶é—´è¯­ä¹‰ .assignAscendingTimestamps((_: game_gateway_data).gateway_time) gameGatewayStream .keyBy((_: game_gateway_data).user_id) .timeWindow(Time.seconds(10), Time.seconds(5)) .reduce(new MyReduceFunction, new stepTimeWindowFunction) .print(\"====&gt;\") env.execute(\"orderness case\") &#125; class MyReduceFunction extends ReduceFunction[game_gateway_data]&#123; override def reduce(t: game_gateway_data, t1: game_gateway_data): game_gateway_data = &#123; if (t.delay_time &gt;= t1.delay_time) t else t1 &#125; &#125; class stepTimeWindowFunction extends WindowFunction[game_gateway_data, game_gateway_data, String, TimeWindow]&#123; // åœ¨çª—å£ç»“æŸæ—¶è°ƒç”¨ override def apply(key: String, window: TimeWindow, input: Iterable[game_gateway_data], out: Collector[game_gateway_data]): Unit = &#123; // inputä¸­åªæœ‰ä¸€æ¡æ•°æ® println(s\"$&#123;window.getStart&#125;===$&#123;window.getEnd&#125;\") val result: game_gateway_data = input.iterator.next() out.collect(result) &#125; &#125;&#125;ä¸‹é¢éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œä¹Ÿå¯ä»¥åƒæˆ‘ä¸€æ ·ä½¿ç”¨ncæ¥è°ƒè¯•çª—å£æ‰“å°ï¼Œå¯ä»¥æ¸…æ¥šçš„äº†è§£çª—å£ä¹‹é—´çš„å…³ç³»ï¼Œé¦–å…ˆï¼Œæˆ‘ä¾æ¬¡åœ¨æ§åˆ¶å°è¾“å…¥ä»¥ä¸‹æ•°æ®ï¼Œä¸€å…±äº”ä¸ªæ‰¹æ¬¡çš„æ•°æ®ï¼Œæ¯æ¡æ•°æ®æœ€åä¸€ä¸ªå­—æ®µæ˜¯â€œdelay_time å»¶è¿Ÿæ—¶é—´â€ï¼š1234567891011121314151617user_001,1,1591016077123,visitor_gateway,2user_001,2,1591016078123,login_gateway,3user_001,3,1591016080123,userCenter_gateway,3user_001,4,1591016081123,gameCenter_gateway,4user_001,5,1591016085123,payCenter_gateway,5user_001,6,1591016087123,exitCenter_gateway,6user_001,10,1591016090123,exitCenter_gateway,10user_001,11,1591016095123,exitCenter_gateway,11user_001,12,1591016100123,exitCenter_gateway,12ä¾æ¬¡æ‰“å°ä»¥ä¸‹äº”ä¸ªçª—å£ç»“æœï¼Œä»”ç»†è§‚å¯Ÿå„ä¸ªçª—å£çš„åˆ’åˆ†ï¼Œå…¶ä¸­æˆ‘ä»¬æ¥çœ‹ç¬¬ä¸‰ä¸ªæ‰¹æ¬¡æ•°æ®ï¼Œå½“æˆ‘è¾“å…¥å»¶è¿Ÿæ—¶é—´åˆ†åˆ«ä¸º6ï¼Œ10çš„æ—¶å€™ï¼Œ1591016080000===1591016090000çª—å£è§¦å‘ï¼Œè¿”å›å½“å‰çª—å£å»¶è¿Ÿæ—¶é—´æœ€å¤§çš„è®°å½•ä¸º6ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯10å‘¢ï¼Ÿï¼Ÿ è¿™æ˜¯å› ä¸ºçª—å£è®¡ç®—ä¸­ï¼Œæ¯ä¸ªçª—å£çš„æ•°æ®ï¼Œå·¦é—­å³å¼€ï¼Œä¹Ÿå°±æ˜¯å»¶è¿Ÿæ—¶é—´ä¸º10çš„è¿™æ¡æ•°æ®ä¸åŠ å…¥1591016080000===1591016090000çª—å£çš„è®¡ç®—ï¼š12345678910111213141591016070000&#x3D;&#x3D;&#x3D;1591016080000&#x3D;&#x3D;&#x3D;&#x3D;&gt;&gt; game_gateway_data(user_001,2,1591016078123,login_gateway,3)1591016075000&#x3D;&#x3D;&#x3D;1591016085000&#x3D;&#x3D;&#x3D;&#x3D;&gt;&gt; game_gateway_data(user_001,4,1591016081123,gameCenter_gateway,4)1591016080000&#x3D;&#x3D;&#x3D;1591016090000&#x3D;&#x3D;&#x3D;&#x3D;&gt;&gt; game_gateway_data(user_001,6,1591016087123,exitCenter_gateway,6)1591016085000&#x3D;&#x3D;&#x3D;1591016095000&#x3D;&#x3D;&#x3D;&#x3D;&gt;&gt; game_gateway_data(user_001,10,1591016090123,exitCenter_gateway,10)1591016090000&#x3D;&#x3D;&#x3D;1591016100000&#x3D;&#x3D;&#x3D;&#x3D;&gt;&gt; game_gateway_data(user_001,11,1591016095123,exitCenter_gateway,11)ä»¥ä¸‹æ˜¯çª—å£åˆ’åˆ†çš„æºç ï¼šåŸºäºä¹±åºæ•°æ®ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687package data_stream.watermarkimport org.apache.flink.api.common.functions.ReduceFunctionimport org.apache.flink.streaming.api.TimeCharacteristicimport org.apache.flink.streaming.api.functions.AssignerWithPeriodicWatermarksimport org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractorimport org.apache.flink.streaming.api.scala.function.WindowFunctionimport org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment, _&#125;import org.apache.flink.streaming.api.watermark.Watermarkimport org.apache.flink.streaming.api.windowing.assigners.SlidingEventTimeWindowsimport org.apache.flink.streaming.api.windowing.time.Timeimport org.apache.flink.streaming.api.windowing.windows.TimeWindowimport org.apache.flink.util.Collectorobject watermark_outoforderness &#123; case class game_gateway_data(user_id: String, step_num: String, gateway_time: Long, gateway_name: String, delay_time: Int) def main(args: Array[String]): Unit = &#123; val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment env.setParallelism(1) env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime) env.getConfig.setAutoWatermarkInterval(100L) //watermarkå‘¨æœŸ val socketStream: DataStream[String] = env.socketTextStream(\"localhost\", 8888) val gameGatewayStream: DataStream[game_gateway_data] = socketStream.map((line: String) =&gt; &#123; val array_data: Array[String] = line.split(\",\") game_gateway_data(array_data(0), array_data(1), array_data(2).toLong, array_data(3), array_data(4).toInt) &#125;) //ä¹±åºæ•°æ®å¤„ç†ï¼Œé‡‡ç”¨å‘¨æœŸæ€§watermark,è®¾ç½®å»¶è¿Ÿæ—¶é—´ä¸º5ç§’ //ç¬¬ä¸€ç§å†™æ³•ï¼Œé‡‡ç”¨AssignerWithPeriodicWatermarks .assignTimestampsAndWatermarks(new BoundedOutOfOrdernessTimestampExtractor[game_gateway_data](Time.seconds(3)) &#123; \"\"\"æŠ½å–æ—¶é—´æˆ³ï¼Œè®¾ç½®event time\"\"\" override def extractTimestamp(element: game_gateway_data): Long = &#123; element.gateway_time &#125; &#125;) //ç¬¬äºŒç§å†™æ³•ï¼Œè‡ªå·±å®šä¹‰å®ç°ç±» // .assignTimestampsAndWatermarks(new AssignerWithPeriodicWatermarks[game_gateway_data] &#123; // var maxEventTime: Long = _ // // //å‘¨æœŸæ€§ç”Ÿæˆwatermark // override def getCurrentWatermark = &#123; // new Watermark(maxEventTime - 3000L) // &#125; // // //è®¾å®ševent time // override def extractTimestamp(element: game_gateway_data, previousElementTimestamp: Long) = &#123; // //è®¾ç½®maxEventTime // maxEventTime = maxEventTime.max(element.gateway_time) // element.gateway_time // &#125; // &#125;) gameGatewayStream .keyBy((_: game_gateway_data).user_id) .window(SlidingEventTimeWindows.of(Time.seconds(10), Time.seconds(5))) .reduce(new MyReduceFunction, new stepTimeWindowFunction) .print(\"====&gt;\") env.execute(\"orderness case\") &#125; class MyReduceFunction extends ReduceFunction[game_gateway_data] &#123; override def reduce(t: game_gateway_data, t1: game_gateway_data): game_gateway_data = &#123; if (t.delay_time &gt;= t1.delay_time) t else t1 &#125; &#125; class stepTimeWindowFunction extends WindowFunction[game_gateway_data, game_gateway_data, String, TimeWindow] &#123; // åœ¨çª—å£ç»“æŸæ—¶è°ƒç”¨ override def apply(key: String, window: TimeWindow, input: Iterable[game_gateway_data], out: Collector[game_gateway_data]): Unit = &#123; // inputä¸­åªæœ‰ä¸€æ¡æ•°æ® println(s\"$&#123;window.getStart&#125;===$&#123;window.getEnd&#125;\") val result: game_gateway_data = input.iterator.next() out.collect(result) &#125; &#125;&#125;æˆ‘ä¾æ¬¡åœ¨æ§åˆ¶å°è¾“å…¥ä»¥ä¸‹æ•°æ®ï¼Œè¯·æ³¨æ„ï¼Œçª—å£å¯¹äºå»¶è¿Ÿæ•°æ®ï¼Œæ˜¯æ€æ ·å¤„ç†çš„123456789101112131415161718192021222324252627282930313233343570-80ï¼ˆçª—å£èŒƒå›´ï¼Œæ­¤æ¡æ— éœ€è¾“å…¥ï¼‰user_001,1,1591016077123,visitor_gateway,2user_001,2,1591016078123,login_gateway,3user_001,3,1591016080123,userCenter_gateway,3user_001,4,1591016083123,gameCenter_gateway,475-85ï¼ˆçª—å£èŒƒå›´ï¼Œæ­¤æ¡æ— éœ€è¾“å…¥ï¼‰user_001,4,1591016081123,gameCenter_gateway,4user_001,5,1591016085123,payCenter_gateway,5user_001,6,1591016088123,exitCenter_gateway,680-90ï¼ˆçª—å£èŒƒå›´ï¼Œæ­¤æ¡æ— éœ€è¾“å…¥ï¼‰user_001,6,1591016079123,exitCenter_gateway,20user_001,6,1591016080123,exitCenter_gateway,40user_001,10,1591016093123,exitCenter_gateway,1085-95ï¼ˆçª—å£èŒƒå›´ï¼Œæ­¤æ¡æ— éœ€è¾“å…¥ï¼‰user_001,6,1591016084123,exitCenter_gateway,84user_001,10,1591016098123,exitCenter_gateway,1090-100ï¼ˆçª—å£èŒƒå›´ï¼Œæ­¤æ¡æ— éœ€è¾“å…¥ï¼‰user_001,10,1591016090123,exitCenter_gateway,90user_001,10,1591016094123,exitCenter_gateway,94user_001,10,1591016091123,exitCenter_gateway,91user_001,10,1591016092123,exitCenter_gateway,92user_001,10,1591016098123,exitCenter_gateway,98user_001,10,1591016099123,exitCenter_gateway,99user_001,10,1591016095123,exitCenter_gateway,95user_001,10,1591016096123,exitCenter_gateway,96user_001,10,15910160100123,exitCenter_gateway,100ç»“æœå¦‚ä¸‹ï¼Œæ ¹æ®ä¸‹é¢çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒåŸºäºå»¶è¿Ÿæœºåˆ¶watermarkå¹¶ä¸”æ™šäºçª—å£è§¦å‘åˆ°è¾¾çš„æ•°æ®ï¼Œå°†ä¼šè¢«æŠ›å¼ƒ1234567891011121591016070000&#x3D;&#x3D;&#x3D;1591016080000&#x3D;&#x3D;&#x3D;&#x3D;&gt;&gt; game_gateway_data(user_001,2,1591016078123,login_gateway,3)1591016075000&#x3D;&#x3D;&#x3D;1591016085000&#x3D;&#x3D;&#x3D;&#x3D;&gt;&gt; game_gateway_data(user_001,4,1591016083123,gameCenter_gateway,4)1591016080000&#x3D;&#x3D;&#x3D;1591016090000&#x3D;&#x3D;&#x3D;&#x3D;&gt;&gt; game_gateway_data(user_001,6,1591016080123,exitCenter_gateway,40)1591016085000&#x3D;&#x3D;&#x3D;1591016095000&#x3D;&#x3D;&#x3D;&#x3D;&gt;&gt; game_gateway_data(user_001,10,1591016093123,exitCenter_gateway,10)1591016090000&#x3D;&#x3D;&#x3D;1591016100000&#x3D;&#x3D;&#x3D;&#x3D;&gt;&gt; game_gateway_data(user_001,10,1591016099123,exitCenter_gateway,99)1591016095000&#x3D;&#x3D;&#x3D;1591016105000&#x3D;&#x3D;&#x3D;&#x3D;&gt;&gt; game_gateway_data(user_001,10,1591016099123,exitCenter_gateway,99)å®æ—¶æµå¤„ç†ç³»ç»Ÿçš„é‡è¦æ€§æ—¥ç›Šå¢é•¿ï¼Œå¿…é¡»å¤„ç†å»¶è¿Ÿçš„æ¶ˆæ¯æ˜¯æ‚¨æ„å»ºçš„ä»»ä½•æ­¤ç±»ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°åˆ°è¾¾çš„æ¶ˆæ¯è¿Ÿåˆ°ä¼šå½±å“ç³»ç»Ÿçš„ç»“æœï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ApacheFlinkçš„äº‹ä»¶æ—¶é—´å¤„ç†åŠŸèƒ½æ¥è§£å†³å®ƒä»¬ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"python - ä¼˜é›…çš„ç¨‹åºè®¾è®¡","slug":"ä¼˜é›…çš„ç¨‹åºè®¾è®¡-pythonã€Œå·¥åŒ ã€","date":"2018-05-24T15:01:20.000Z","updated":"2020-04-04T12:00:22.701Z","comments":true,"path":"2018/05/24/ä¼˜é›…çš„ç¨‹åºè®¾è®¡-pythonã€Œå·¥åŒ ã€/","link":"","permalink":"cpeixin.cn/2018/05/24/%E4%BC%98%E9%9B%85%E7%9A%84%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1-python%E3%80%8C%E5%B7%A5%E5%8C%A0%E3%80%8D/","excerpt":"","text":"ä»Šå¤©æ˜¯ä¼˜ç§€åšå®¢çš„æ¬è¿å·¥ğŸ˜‚è®°å½•ä¸¤ç¯‡çœ‹å®Œå¾ˆçˆ½çš„æ–‡ç« ï¼Œç¼–ç¨‹ä¹Ÿæ˜¯ä¸€é—¨æ‰‹è‰ºï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œç¼–ç¨‹çš„äººè¦æŠŠè‡ªå·±å½“æˆå·¥åŒ ï¼Œå¯¹è‡ªå·±çš„ä½œå“ä¸æ–­çš„æ‰“ç£¨ï¼Œæ‰“ç£¨æˆä¸€ä¸ªå¯ä»¥ä¾›äººè§‚èµçš„è‰ºæœ¯å“ã€‚Python å·¥åŒ ï¼šå–„ç”¨å˜é‡æ¥æ”¹å–„ä»£ç è´¨é‡Python å·¥åŒ ï¼šç¼–å†™æ¡ä»¶åˆ†æ”¯ä»£ç çš„æŠ€å·§","categories":[{"name":"python","slug":"python","permalink":"cpeixin.cn/categories/python/"}],"tags":[{"name":"python","slug":"python","permalink":"cpeixin.cn/tags/python/"}]},{"title":"Flink DataStream æ—¶é—´è¯­ä¹‰","slug":"Flink-DataStream-æ—¶é—´è¯­ä¹‰","date":"2018-05-22T09:44:42.000Z","updated":"2020-05-29T09:45:59.376Z","comments":true,"path":"2018/05/22/Flink-DataStream-æ—¶é—´è¯­ä¹‰/","link":"","permalink":"cpeixin.cn/2018/05/22/Flink-DataStream-%E6%97%B6%E9%97%B4%E8%AF%AD%E4%B9%89/","excerpt":"","text":"Event Time - Processing Time - Ingestion TimeFlink åœ¨æµå¼ä¼ è¾“ç¨‹åºä¸­æ”¯æŒä¸åŒçš„_æ—¶é—´_æ¦‚å¿µã€‚å¤„ç†æ—¶é—´(Processing Time)ï¼šç®€å•çš„ç†è§£ï¼Œå°±æ˜¯æ•°æ®åœ¨çª—å£ä¸­ï¼Œè¢«å¤„ç†æ‰§è¡Œçš„æ—¶é—´ã€‚ä¸‹é¢æ˜¯å®˜æ–¹çš„é‡Šä¹‰ï¼šå¤„ç†æ—¶é—´æ˜¯æŒ‡æ‰§è¡Œç›¸åº”æ“ä½œçš„æœºå™¨çš„ç³»ç»Ÿæ—¶é—´ã€‚å½“æµå¼ç¨‹åºæŒ‰å¤„ç†æ—¶é—´è¿è¡Œæ—¶ï¼Œæ‰€æœ‰åŸºäºæ—¶é—´çš„æ“ä½œï¼ˆå¦‚æ—¶é—´çª—å£ï¼‰éƒ½å°†ä½¿ç”¨è¿è¡Œç›¸åº”æ“ä½œå‘˜çš„è®¡ç®—æœºçš„ç³»ç»Ÿæ—¶é’Ÿã€‚æ¯å°æ—¶å¤„ç†æ—¶é—´çª—å£å°†åŒ…æ‹¬ç³»ç»Ÿæ—¶é’ŸæŒ‡ç¤ºæ•´å°æ—¶çš„æ—¶é—´ä¹‹é—´åˆ°è¾¾ç‰¹å®šæ“ä½œå‘˜çš„æ‰€æœ‰è®°å½•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨ç¨‹åºåœ¨9:15 amå¼€å§‹è¿è¡Œï¼Œåˆ™ç¬¬ä¸€ä¸ªæ¯å°æ—¶å¤„ç†æ—¶é—´çª—å£å°†åŒ…æ‹¬åœ¨9:15 amå’Œ10:00 amä¹‹é—´å¤„ç†çš„äº‹ä»¶ï¼Œä¸‹ä¸€ä¸ªçª—å£å°†åŒ…æ‹¬åœ¨10:00 amå’Œ11:00 amä¹‹é—´å¤„ç†çš„äº‹ä»¶ï¼Œä¾æ­¤ç±»æ¨ã€‚å¤„ç†æ—¶é—´æ˜¯æœ€ç®€å•çš„æ—¶é—´æ¦‚å¿µï¼Œä¸éœ€è¦æµå’Œæœºå™¨ä¹‹é—´çš„åè°ƒã€‚å®ƒæä¾›äº†æœ€ä½³çš„æ€§èƒ½å’Œæœ€ä½çš„å»¶è¿Ÿã€‚ä½†æ˜¯ï¼Œåœ¨åˆ†å¸ƒå¼å’Œå¼‚æ­¥ç¯å¢ƒä¸­ï¼Œå¤„ç†æ—¶é—´ä¸èƒ½æä¾›ç¡®å®šæ€§ï¼Œå› ä¸ºå®ƒå®¹æ˜“å—åˆ°è®°å½•åˆ°è¾¾ç³»ç»Ÿï¼ˆä¾‹å¦‚ä»æ¶ˆæ¯é˜Ÿåˆ—ï¼‰åˆ°è¾¾ç³»ç»Ÿçš„é€Ÿåº¦ï¼Œè®°å½•åœ¨ç³»ç»Ÿå†…éƒ¨æ“ä½œå‘˜ä¹‹é—´æµåŠ¨çš„é€Ÿåº¦çš„å½±å“ã€‚ ä»¥åŠä¸­æ–­ï¼ˆè®¡åˆ’çš„æˆ–å…¶ä»–æ–¹å¼ï¼‰ã€‚äº‹ä»¶æ—¶é—´(Event time)ï¼šç®€å•çš„ç†è§£ï¼Œå°±æ˜¯æ•°æ®åœ¨äº§ç”Ÿçš„æ—¶é—´ï¼Œä¾‹å¦‚ç”¨æˆ·Aåœ¨xæ—¶é—´ï¼Œç‚¹å‡»äº†Bå•†å“ï¼Œæ­¤æ—¶æ‰€äº§ç”Ÿçš„æ•°æ®çš„æ—¶é—´æ—¶é—´å°±æ˜¯xã€‚ä¸‹é¢æ˜¯å®˜æ–¹é‡Šä¹‰ï¼šäº‹ä»¶æ—¶é—´æ˜¯æ¯ä¸ªäº‹ä»¶åœ¨å…¶ç”Ÿäº§è®¾å¤‡ä¸Šå‘ç”Ÿçš„æ—¶é—´ã€‚è¯¥æ—¶é—´é€šå¸¸åœ¨å®ƒä»¬è¿›å…¥Flinkä¹‹å‰åµŒå…¥åˆ°è®°å½•ä¸­ï¼Œå¹¶ä¸” å¯ä»¥ä»æ¯ä¸ªè®°å½•ä¸­æå–_äº‹ä»¶æ—¶é—´æˆ³_ã€‚åœ¨äº‹ä»¶æ—¶é—´ä¸­ï¼Œæ—¶é—´çš„è¿›åº¦å–å†³äºæ•°æ®ï¼Œè€Œä¸å–å†³äºä»»ä½•æŒ‚é’Ÿã€‚äº‹ä»¶æ—¶é—´ç¨‹åºå¿…é¡»æŒ‡å®šå¦‚ä½•ç”Ÿæˆâ€œ _äº‹ä»¶æ—¶é—´æ°´å°â€_ï¼Œè¿™æ˜¯ä¸€ç§è¡¨ç¤ºäº‹ä»¶æ—¶é—´è¿›å±•çš„æœºåˆ¶ã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œäº‹ä»¶æ—¶é—´å¤„ç†å°†äº§ç”Ÿå®Œå…¨ä¸€è‡´ä¸”ç¡®å®šçš„ç»“æœï¼Œè€Œä¸ç®¡äº‹ä»¶ä½•æ—¶åˆ°è¾¾æˆ–å®ƒä»¬çš„é¡ºåºå¦‚ä½•ã€‚ä½†æ˜¯ï¼Œé™¤éå·²çŸ¥äº‹ä»¶æ˜¯æŒ‰æ—¶é—´æˆ³ï¼ˆæŒ‰æ—¶é—´æˆ³ï¼‰åˆ°è¾¾çš„ï¼Œå¦åˆ™äº‹ä»¶æ—¶é—´å¤„ç†ä¼šåœ¨ç­‰å¾…æ— åºäº‹ä»¶æ—¶äº§ç”Ÿä¸€å®šçš„å»¶è¿Ÿã€‚ç”±äºåªèƒ½ç­‰å¾…æœ‰é™çš„æ—¶é—´ï¼Œå› æ­¤è¿™é™åˆ¶äº†ç¡®å®šæ€§äº‹ä»¶æ—¶é—´åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§ã€‚å‡è®¾æ‰€æœ‰æ•°æ®éƒ½å·²åˆ°è¾¾ï¼Œäº‹ä»¶æ—¶é—´æ“ä½œå°†æŒ‰é¢„æœŸæ–¹å¼è¿è¡Œï¼Œå³ä½¿åœ¨å¤„ç†æ— åºæˆ–è¿Ÿåˆ°çš„äº‹ä»¶æˆ–é‡æ–°å¤„ç†å†å²æ•°æ®æ—¶ï¼Œä¹Ÿä¼šäº§ç”Ÿæ­£ç¡®ä¸”ä¸€è‡´çš„ç»“æœã€‚ä¾‹å¦‚ï¼Œæ¯å°æ—¶äº‹ä»¶æ—¶é—´çª—å£å°†åŒ…å«æ‰€æœ‰å¸¦æœ‰è½å…¥è¯¥å°æ—¶äº‹ä»¶æ—¶é—´æˆ³çš„è®°å½•ï¼Œæ— è®ºå®ƒä»¬åˆ°è¾¾çš„é¡ºåºæˆ–å¤„ç†çš„æ—¶é—´ã€‚è¯·æ³¨æ„ï¼Œæœ‰æ—¶å½“äº‹ä»¶æ—¶é—´ç¨‹åºå®æ—¶å¤„ç†å®æ—¶æ•°æ®æ—¶ï¼Œå®ƒä»¬å°†ä½¿ç”¨ä¸€äº›_å¤„ç†æ—¶é—´_æ“ä½œï¼Œä»¥ç¡®ä¿å®ƒä»¬åŠæ—¶è¿›è¡Œã€‚æ‘„å…¥æ—¶é—´(Ingestion Time)ï¼šæ‘„å–æ—¶é—´æ˜¯äº‹ä»¶è¿›å…¥Flinkçš„æ—¶é—´ã€‚åœ¨æºæ“ä½œå‘˜å¤„ï¼Œæ¯ä¸ªè®°å½•éƒ½å°†æºçš„å½“å‰æ—¶é—´ä½œä¸ºæ—¶é—´æˆ³è®°ï¼Œå¹¶ä¸”åŸºäºæ—¶é—´çš„æ“ä½œï¼ˆå¦‚æ—¶é—´çª—å£ï¼‰å¼•ç”¨è¯¥æ—¶é—´æˆ³è®°ã€‚_æ‘„å–æ—¶é—´_ä»æ¦‚å¿µä¸Šè®²ä»‹äº_äº‹ä»¶æ—¶é—´å’Œå¤„ç†æ—¶é—´ä¹‹é—´_ã€‚ä¸_å¤„ç†æ—¶é—´_ç›¸æ¯” ï¼Œå®ƒç¨å¾®è´µä¸€äº›ï¼Œä½†ç»“æœå´æ›´å¯é¢„æµ‹ã€‚ç”±äº _æ‘„å–æ—¶é—´_ä½¿ç”¨ç¨³å®šçš„æ—¶é—´æˆ³ï¼ˆåœ¨æºå¤„åˆ†é…äº†ä¸€æ¬¡ï¼‰ï¼Œå› æ­¤å¯¹è®°å½•çš„ä¸åŒçª—å£æ“ä½œå°†å¼•ç”¨ç›¸åŒçš„æ—¶é—´æˆ³ï¼Œè€Œåœ¨_å¤„ç†æ—¶é—´ä¸­ï¼Œ_æ¯ä¸ªçª—å£æ“ä½œå‘˜éƒ½å¯ä»¥å°†è®°å½•åˆ†é…ç»™ä¸åŒçš„çª—å£ï¼ˆåŸºäºæœ¬åœ°ç³»ç»Ÿæ—¶é’Ÿå’Œä»»ä½•è¿è¾“å»¶è¯¯ï¼‰ã€‚ä¸_äº‹ä»¶æ—¶é—´_ç›¸æ¯”ï¼Œ_æå–æ—¶é—´_ç¨‹åºæ— æ³•å¤„ç†ä»»ä½•ä¹±åºäº‹ä»¶æˆ–è¿Ÿåˆ°çš„æ•°æ®ï¼Œä½†æ˜¯ç¨‹åºä¸å¿…æŒ‡å®šå¦‚ä½•ç”Ÿæˆ_æ°´å°_ã€‚åœ¨å†…éƒ¨ï¼Œ_æ‘„å–æ—¶é—´ä¸äº‹ä»¶æ—¶é—´_éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯å…·æœ‰è‡ªåŠ¨æ—¶é—´æˆ³åˆ†é…å’Œè‡ªåŠ¨æ°´å°ç”ŸæˆåŠŸèƒ½ã€‚åœ¨å®é™…å·¥ä½œä¸­ï¼ŒIngestion Timeä½¿ç”¨çš„åœºæ™¯è¾ƒå°‘ã€‚å¹¶ä¸”æ˜¯ä¸è®¾ç½®æ—¶é—´è¯­ä¹‰æ˜¯ï¼Œé»˜è®¤ä½¿ç”¨process timeè®¾ç½®æ—¶é—´ç‰¹å¾ï¼ˆSetting a Time Characteristicï¼‰Flink DataStreamç¨‹åºçš„ç¬¬ä¸€éƒ¨åˆ†é€šå¸¸è®¾ç½®åŸºå‡†_æ—¶é—´ç‰¹å¾_ã€‚è¯¥è®¾ç½®å®šä¹‰äº†æ•°æ®æµæºçš„è¡Œä¸ºæ–¹å¼ï¼ˆä¾‹å¦‚ï¼Œæ˜¯å¦åˆ†é…æ—¶é—´æˆ³ï¼‰ï¼Œä»¥åŠè¯¸å¦‚çš„çª—å£æ“ä½œåº”ä½¿ç”¨ä»€ä¹ˆæ—¶é—´æ¦‚å¿µKeyedStream.timeWindow(Time.seconds(30))ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ªFlinkç¨‹åºï¼Œè¯¥ç¨‹åºåœ¨æ¯å°æ—¶çš„æ—¶é—´çª—å£ä¸­æ±‡æ€»äº‹ä»¶ã€‚çª—å£çš„è¡Œä¸ºä¸æ—¶é—´ç‰¹å¾ç›¸é€‚åº”ã€‚123456789101112val env = StreamExecutionEnvironment.getExecutionEnvironment//é»˜è®¤ä¸ºprocess timeï¼Œæ‰€ä»¥å¦‚æœé€‰æ‹©ProcessingTimeï¼Œä¹Ÿå¯ä»¥ä¸è¿›è¡Œæ­¤æ­¥çš„è®¾ç½®env.setStreamTimeCharacteristic(TimeCharacteristic.ProcessingTime)// env.setStreamTimeCharacteristic(TimeCharacteristic.IngestionTime)// env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)val stream: DataStream[MyEvent] = env.addSource(new FlinkKafkaConsumer09[MyEvent](topic, schema, props))stream .keyBy( _.getUser ) .timeWindow(Time.hours(1)) .reduce( (a, b) =&gt; a.add(b) ) .addSink(...)è¯·æ³¨æ„ï¼Œä¸ºäº†åœ¨äº‹ä»¶æ—¶é—´ä¸­è¿è¡Œæ­¤ç¤ºä¾‹ï¼Œç¨‹åºéœ€è¦ä½¿ç”¨ç›´æ¥ä¸ºæ•°æ®å®šä¹‰äº‹ä»¶æ—¶é—´å¹¶è‡ªå·±å‘å‡ºæ°´å°çš„æºï¼Œæˆ–è€…ç¨‹åºå¿…é¡»åœ¨æºä¹‹åæ³¨å…¥Timestamp Assignerï¼†Watermark Generatorã€‚è¿™äº›åŠŸèƒ½æè¿°äº†å¦‚ä½•è®¿é—®äº‹ä»¶æ—¶é—´æˆ³ï¼Œä»¥åŠäº‹ä»¶æµå‘ˆç°å‡ºä½•ç§ç¨‹åº¦çš„ä¹±åºã€‚ç°å®ä¸–ç•Œä¸­çš„æ—¶é—´æ˜¯ä¸ä¸€è‡´çš„ï¼Œåœ¨ flink ä¸­è¢«åˆ’åˆ†ä¸ºäº‹ä»¶æ—¶é—´ï¼Œæ‘„å…¥æ—¶é—´ï¼Œå¤„ç†æ—¶é—´ä¸‰ç§ã€‚å¦‚æœä»¥ EventTime ä¸ºåŸºå‡†æ¥å®šä¹‰æ—¶é—´çª—å£é‚£å°†å½¢æˆ EventTimeWindow,*è¦æ±‚æ¶ˆæ¯æœ¬èº«å°±åº”è¯¥æºå¸¦ EventTime *å¦‚æœä»¥ IngesingtTime ä¸ºåŸºå‡†æ¥å®šä¹‰æ—¶é—´çª—å£é‚£å°†å½¢æˆ IngestingTimeWindow,ä»¥ source çš„ systemTime ä¸ºå‡†ã€‚ å¦‚æœä»¥ ProcessingTime åŸºå‡†æ¥å®šä¹‰æ—¶é—´çª—å£é‚£å°†å½¢æˆ ProcessingTimeWindowï¼Œä»¥ operator çš„ systemTime ä¸ºå‡†ã€‚ä»¥ä¸Šä¸‰ç§é€‰æ‹©æ˜¯éœ€è¦æ ¹æ®ä¸åŒä¸šåŠ¡éœ€æ±‚è¿›è¡Œé€‰æ‹©çš„ï¼Œä¾‹å¦‚ï¼Œåœ¨æ•°æ®è®¡ç®—çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è€ƒè™‘åˆ°ç½‘ç»œå»¶è¿Ÿçš„åŸå› ï¼Œé‚£ä¹ˆå°±åº”è¯¥é€‰æ‹©setStreamTimeCharacteristic(TimeCharacteristic.EventTime)ï¼Œç›¸åï¼Œä¸éœ€è¦è€ƒè™‘å»¶è¿ŸåŸå› çš„è¯ï¼Œåªè€ƒè™‘å¤„ç†æ•°æ®çš„æ—¶é—´ï¼Œåˆ™å¯ä»¥é€‰æ‹©å¦ä¸¤ä¸ªã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Flink windowçª—å£æ“ä½œ","slug":"Flink-windowçª—å£æ“ä½œ","date":"2018-05-17T13:10:54.000Z","updated":"2020-05-27T13:13:00.356Z","comments":true,"path":"2018/05/17/Flink-windowçª—å£æ“ä½œ/","link":"","permalink":"cpeixin.cn/2018/05/17/Flink-window%E7%AA%97%E5%8F%A3%E6%93%8D%E4%BD%9C/","excerpt":"","text":"å‰è¨€Flinkä¸­çš„windowçª—å£æ¦‚å¿µå’ŒSpark Streamingä¸­çš„windowæ˜¯ä¸€æ ·çš„ã€‚å¯¹ä¸€ç›´æµåŠ¨çš„æ•°æ®åˆ’å®šä¸€ä¸ªå›ºå®šçš„çª—å£ã€‚ä»¥äº¤é€šä¼ æ„Ÿå™¨ä¸ºä¾‹ï¼Œè¯¥ä¼ æ„Ÿå™¨æ¯15ç§’ç»Ÿè®¡é€šè¿‡æŸä¸ªä½ç½®çš„è½¦è¾†æ•°é‡ã€‚ç»“æœæµçœ‹èµ·æ¥åƒï¼šå¦‚æœæ‚¨æƒ³çŸ¥é“æœ‰å¤šå°‘è¾†è½¦ç»è¿‡è¯¥ä½ç½®ï¼Œæ‚¨åªéœ€å°†å„ä¸ªè®¡æ•°ç›¸åŠ å³å¯ã€‚ä½†æ˜¯ï¼Œä¼ æ„Ÿå™¨æµçš„æœ¬è´¨æ˜¯å®ƒè¿ç»­äº§ç”Ÿæ•°æ®ã€‚è¿™æ ·çš„æµæ°¸è¿œä¸ä¼šç»“æŸï¼Œå¹¶ä¸”ä¸å¯èƒ½è®¡ç®—å¯ä»¥è¿”å›çš„æœ€ç»ˆå’Œã€‚ç›¸åï¼Œå¯ä»¥è®¡ç®—æ»šåŠ¨æ€»å’Œï¼Œå³ä¸ºæ¯ä¸ªè¾“å…¥äº‹ä»¶è¿”å›æ›´æ–°çš„æ€»å’Œè®°å½•ã€‚è¿™å°†äº§ç”Ÿæ–°çš„éƒ¨åˆ†å’Œæµã€‚ä½†æ˜¯ï¼Œéƒ¨åˆ†æ±‚å’Œæµå¯èƒ½ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå› ä¸ºå®ƒä¼šä¸æ–­æ›´æ–°è®¡æ•°ï¼Œæ›´é‡è¦çš„æ˜¯ï¼ŒæŸäº›ä¿¡æ¯ï¼ˆä¾‹å¦‚éšæ—¶é—´å˜åŒ–ï¼‰ä¼šä¸¢å¤±ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„é—®é¢˜ï¼Œå¹¶è¯¢é—®æ¯åˆ†é’Ÿé€šè¿‡è¯¥ä½ç½®çš„æ±½è½¦æ•°é‡ã€‚è¿™è¦æ±‚æˆ‘ä»¬å°†æµçš„å…ƒç´ åˆ†ç»„ä¸ºæœ‰é™çš„é›†åˆï¼Œæ¯ä¸ªé›†åˆå¯¹åº”äº60ç§’ã€‚æ­¤æ“ä½œç§°ä¸º_æ»šåŠ¨Windows_æ“ä½œã€‚ï¼ˆä¸é‡å ï¼‰æ»šåŠ¨çª—å£å°†æµç¦»æ•£åŒ–ä¸ºä¸é‡å çš„çª—å£ã€‚å¯¹äºæŸäº›åº”ç”¨ç¨‹åºï¼Œé‡è¦çš„æ˜¯çª—å£ä¸å¯åˆ†ç¦»ï¼Œå› ä¸ºåº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦å¹³æ»‘çš„èšåˆã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ¯30ç§’è®¡ç®—æœ€åä¸€åˆ†é’Ÿé€šè¿‡çš„æ±½è½¦æ•°é‡ã€‚è¿™ç§çª—æˆ·ç§°ä¸º_æ»‘åŠ¨çª—æˆ·_ã€‚ï¼ˆé‡å ï¼‰å¦‚å‰æ‰€è¿°ï¼Œåœ¨æ•°æ®æµä¸Šå®šä¹‰çª—å£æ˜¯éå¹¶è¡Œæ“ä½œã€‚è¿™æ˜¯å› ä¸ºæµçš„æ¯ä¸ªå…ƒç´ å¿…é¡»ç”±å†³å®šè¯¥å…ƒç´ åº”æ·»åŠ åˆ°å“ªä¸ªçª—å£çš„åŒä¸€çª—å£è¿ç®—ç¬¦å¤„ç†ã€‚å®Œæ•´æµä¸­çš„Windows åœ¨Flink ä¸­ç§°ä¸º_AllWindows_ã€‚å¯¹äºè®¸å¤šåº”ç”¨ç¨‹åºï¼Œæ•°æ®æµéœ€è¦åˆ†ç»„ä¸ºå¤šä¸ªé€»è¾‘æµï¼Œæ¯ä¸ªé€»è¾‘æµéƒ½å¯ä»¥åº”ç”¨çª—å£è¿ç®—ç¬¦ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘æ¥è‡ªå¤šä¸ªäº¤é€šä¼ æ„Ÿå™¨ï¼ˆè€Œä¸æ˜¯åƒå‰é¢çš„ç¤ºä¾‹ä¸­çš„ä¸€ä¸ªä¼ æ„Ÿå™¨ï¼‰çš„è½¦è¾†è®¡æ•°æµï¼Œå…¶ä¸­æ¯ä¸ªä¼ æ„Ÿå™¨ç›‘è§†ä¸€ä¸ªä¸åŒçš„ä½ç½®ã€‚é€šè¿‡æŒ‰ä¼ æ„Ÿå™¨IDå¯¹æµè¿›è¡Œåˆ†ç»„ï¼Œæˆ‘ä»¬å¯ä»¥å¹¶è¡Œè®¡ç®—æ¯ä¸ªä½ç½®çš„çª—å£æµé‡ç»Ÿè®¡ä¿¡æ¯ã€‚åœ¨Flinkä¸­ï¼Œæˆ‘ä»¬ç§°æ­¤ç±»åˆ†åŒºçª—å£ä¸º_Windows_ï¼Œå› ä¸ºå®ƒä»¬æ˜¯åˆ†å¸ƒå¼æµçš„å¸¸è§æƒ…å†µã€‚ä¸‹å›¾æ˜¾ç¤ºäº†ç¿»è½¬çª—å£ï¼Œè¯¥çª—å£æ”¶é›†äº†(sensorId, count)æˆå¯¹å…ƒç´ æµä¸­çš„ä¸¤ä¸ªå…ƒç´ ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œçª—å£åœ¨æ— ç•Œæµä¸Šå®šä¹‰äº†ä¸€ç»„æœ‰é™çš„å…ƒç´ ã€‚è¯¥é›†åˆå¯ä»¥åŸºäºæ—¶é—´ï¼ˆå¦‚æˆ‘ä»¬å‰é¢çš„ç¤ºä¾‹ä¸­æ‰€ç¤ºï¼‰ï¼Œå…ƒç´ è®¡æ•°ï¼Œè®¡æ•°å’Œæ—¶é—´çš„ç»„åˆï¼Œæˆ–ä¸€äº›å°†å…ƒç´ åˆ†é…ç»™çª—å£çš„è‡ªå®šä¹‰é€»è¾‘ã€‚Flinkçš„DataStream APIä¸ºæœ€å¸¸è§çš„çª—å£æ“ä½œæä¾›äº†ç®€æ´çš„è¿ç®—ç¬¦ï¼Œå¹¶æä¾›äº†ä¸€ç§é€šç”¨çš„çª—å£æœºåˆ¶ï¼Œè¯¥æœºåˆ¶å…è®¸ç”¨æˆ·å®šä¹‰éå¸¸è‡ªå®šä¹‰çš„çª—å£é€»è¾‘ã€‚åœ¨ä¸‹é¢çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»Flinkçš„æ—¶é—´å’Œè®¡æ•°çª—å£ï¼Œç„¶åå†è¯¦ç»†è®¨è®ºå…¶çª—å£æœºåˆ¶ã€‚WindowWindowsæ˜¯å¤„ç†æ— é™æµçš„æ ¸å¿ƒã€‚Windowså°†æµåˆ†æˆæœ‰é™å¤§å°çš„â€œbucketsâ€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸Šåº”ç”¨è®¡ç®—ã€‚Flink windowçª—å£ç¨‹åºçš„ä¸€èˆ¬ç»“æ„å¦‚ä¸‹æ‰€ç¤ºã€‚ç¬¬ä¸€æ®µæŒ‡çš„æ˜¯KeyedStream[T]æµï¼Œç¬¬äºŒæ®µæŒ‡çš„æ˜¯non-keyed**DataStream[T]æµã€‚ä»¥ä¸‹ä¸¤æ®µä»£ç å¯¹æ¯”ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯æ•°æ®æµstreamç»è¿‡keyBy(â€¦)åï¼Œéœ€è¦è°ƒç”¨window(â€¦)æ¥åˆ›å»ºçª—å£ï¼Œè€Œnon-keyed streamåˆ™éœ€è¦è°ƒç”¨windowAll(â€¦)åˆ›å»ºçª—å£ã€‚Keyed window**123456789stream .keyBy(...) &lt;- keyed versus non-keyed windows .window(...) &lt;- required: \"assigner\" [.trigger(...)] &lt;- optional: \"trigger\" (else default trigger) [.evictor(...)] &lt;- optional: \"evictor\" (else no evictor) [.allowedLateness(...)] &lt;- optional: \"lateness\" (else zero) [.sideOutputLateData(...)] &lt;- optional: \"output tag\" (else no side output for late data) .reduce/aggregate/fold/apply() &lt;- required: \"function\" [.getSideOutput(...)] &lt;- optional: \"output tag\"Non-Keyed Windows**12345678stream .windowAll(...) &lt;- required: \"assigner\" [.trigger(...)] &lt;- optional: \"trigger\" (else default trigger) [.evictor(...)] &lt;- optional: \"evictor\" (else no evictor) [.allowedLateness(...)] &lt;- optional: \"lateness\" (else zero) [.sideOutputLateData(...)] &lt;- optional: \"output tag\" (else no side output for late data) .reduce/aggregate/fold/apply() &lt;- required: \"function\" [.getSideOutput(...)] &lt;- optional: \"output tag\"åœ¨ä¸Šé¢ï¼Œæ–¹æ‹¬å·ï¼ˆ[â€¦]ï¼‰ä¸­çš„å‘½ä»¤æ˜¯å¯é€‰çš„ã€‚è¿™è¡¨æ˜Flinkå…è®¸æ‚¨ä»¥å¤šç§ä¸åŒæ–¹å¼è‡ªå®šä¹‰çª—å£é€»è¾‘ï¼Œä»è€Œä½¿å…¶æœ€é€‚åˆæ‚¨çš„éœ€æ±‚ã€‚windowç”Ÿå‘½å‘¨æœŸç®€è€Œè¨€ä¹‹ï¼Œä¸€æ—¦åº”å±äºè¯¥çª—å£çš„ç¬¬ä¸€ä¸ªå…ƒç´ åˆ°è¾¾ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªçª—å£ï¼Œå¹¶ä¸”å½“æ—¶é—´ï¼ˆevent or processing timeï¼‰è¶…è¿‡å…¶ç»“æŸæ—¶é—´æˆ³åŠ ä¸Šç”¨æˆ·æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´ï¼Œè¯¥çª—å£å°†è¢«å®Œå…¨åˆ é™¤ã€‚Flinkä¿è¯åªåˆ é™¤åŸºäºæ—¶é—´ï¼ˆtime-based windowsï¼‰çš„çª—å£ï¼Œè€Œä¸ä¿è¯å…¶ä»–ç±»å‹ï¼ˆ_ä¾‹å¦‚ _global windowsï¼‰çš„åˆ é™¤ã€‚ä¾‹å¦‚ï¼Œé‡‡ç”¨åŸºäºevent timeçš„çª—å£åŒ–ç­–ç•¥ï¼Œè¯¥ç­–ç•¥æ¯5åˆ†é’Ÿåˆ›å»ºä¸€æ¬¡ä¸é‡å çš„æ»šåŠ¨çª—å£ï¼Œå¹¶å…è®¸å»¶è¿Ÿ1åˆ†é’Ÿï¼Œå› æ­¤Flinkå°†ä¼šåˆ›å»ºä¸€ä¸ªæ—¶é—´åœ¨12:00ï½12:05ä¹‹é—´çš„ä¸²å£ï¼Œå½“å¸¦æœ‰æ—¶é—´æˆ³çš„ç¬¬ä¸€ä¸ªå…ƒç´ è½å…¥æ­¤é—´éš”æ—¶ï¼Œå½“æ°´å°é€šè¿‡12:06 æ—¶é—´æˆ³æ—¶ï¼Œå®ƒå°†åˆ é™¤å®ƒã€‚æ­¤å¤–ï¼Œæ¯ä¸ªçª—å£å°†å…·æœ‰Triggerè§¦å‘å™¨ å’Œä¸€ä¸ªå‡½æ•°ï¼ˆProcessWindowFunctionï¼ŒReduceFunctionï¼Œ AggregateFunctionæˆ–FoldFunctionç­‰çª—å£åŠŸèƒ½ã€‚è¯¥å‡½æ•°å°†åŒ…å«è¦åº”ç”¨äºçª—å£å†…å®¹çš„è®¡ç®—ï¼Œè€Œåˆ™TriggeræŒ‡å®šäº†åœ¨ä»€ä¹ˆæ¡ä»¶ä¸‹å¯ä»¥å°†çª—å£è§†ä¸ºè¦åº”ç”¨è¯¥å‡½æ•°çš„æ¡ä»¶ã€‚è§¦å‘ç­–ç•¥å¯èƒ½ç±»ä¼¼äºâ€œå½“çª—å£ä¸­çš„å…ƒç´ æ•°å¤§äº4æ—¶â€æˆ–â€œå½“watermarkæ°´å°é€šè¿‡çª—å£æœ«å°¾æ—¶â€ã€‚è§¦å‘å™¨è¿˜å¯ä»¥å†³å®šåœ¨åˆ›å»ºå’Œåˆ é™¤çª—å£ä¹‹é—´çš„ä»»ä½•æ—¶é—´æ¸…é™¤çª—å£çš„å†…å®¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¸…é™¤ä»…æ˜¯æŒ‡çª—å£ä¸­çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯çª—å£å…ƒæ•°æ®ã€‚è¿™æ„å‘³ç€ä»å¯ä»¥å°†æ–°æ•°æ®æ·»åŠ åˆ°è¯¥çª—å£ã€‚é™¤ä¸Šè¿°å†…å®¹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥æŒ‡å®šä¸€ä¸ªEvictorï¼ˆè¯·å‚é˜…Evictorsï¼‰ï¼Œå®ƒå°†åœ¨è§¦å‘è§¦å‘å™¨åä»¥åŠåº”ç”¨æ­¤åŠŸèƒ½ä¹‹å‰å’Œ/æˆ–ä¹‹åä»çª—å£ä¸­åˆ é™¤å…ƒç´ ã€‚åœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å¯¹ä¸Šè¿°æ¯ä¸ªç»„ä»¶è¿›è¡Œæ›´è¯¦ç»†çš„ä»‹ç»ã€‚æˆ‘ä»¬å…ˆä»ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­çš„å¿…éœ€éƒ¨åˆ†å¼€å§‹ï¼ˆè¯·å‚è§Keyed vs Non- Keyed Windowsï¼ŒWindow Assignerå’Œ Window Functionï¼‰ã€‚Keyed vs Non-Keyed Windowsåœ¨æˆ‘ä»¬æ¥å…¥æµæ•°æ®åï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯æˆ‘ä»¬è¦åœ¨å®šä¹‰windowå‡½æ•°å‰ï¼Œéœ€è¦å†³å®šä½ çš„æ•°æ®æµæ˜¯å¦éœ€è¦è¿›è¡Œ keyedã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†keyBy()ï¼Œé‚£ä¹ˆè¾“å…¥çš„æ•°æ®æµå°†ä¼šè¢«åˆ‡åˆ†æˆlogical keyed streamsï¼Œå¦åˆ™ï¼Œå°†ä¸ä¼šå¯¹æ•°æ®æµè¿›è¡Œåˆ‡åˆ†ï¼Œåœ¨ä½¿ç”¨ keyed streamsçš„æƒ…å†µä¸‹ï¼Œä¼ å…¥äº‹ä»¶çš„ä»»ä½•å±æ€§éƒ½å¯ä»¥ç”¨ä½œkeyã€‚æ‹¥æœ‰keyed streamså°†ä½¿æ‚¨çš„çª—å£åŒ–è®¡ç®—å¯ä»¥ç”±å¤šä¸ªä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œå› ä¸ºlogical keyed streamséƒ½å¯ä»¥ç‹¬ç«‹äºå…¶ä½™logical keyed streamsè¿›è¡Œå¤„ç†ã€‚å¼•ç”¨åŒä¸€é”®çš„æ‰€æœ‰å…ƒç´ å°†è¢«å‘é€åˆ°åŒä¸€å¹¶è¡Œä»»åŠ¡taskä¸­ã€‚å¯¹äºnon-keyed streamsï¼Œæ‚¨çš„åŸå§‹æµå°†ä¸ä¼šæ‹†åˆ†ä¸ºå¤šä¸ªé€»è¾‘æµï¼Œå¹¶ä¸”æ‰€æœ‰çª—å£é€»è¾‘å°†ç”±å•ä¸ªä»»åŠ¡æ‰§è¡Œï¼Œå³å¹¶è¡Œåº¦ä¸º1ã€‚Window Assignersçª—å£åˆ†é…å™¨åœ¨å†³å®šæ˜¯å¦è¦å¯¹æ•°æ®æµkeyedåï¼Œä¸‹ä¸€æ­¥åˆ™æ˜¯å®šä¹‰window assignersçª—å£åˆ†é…å™¨ï¼Œwindow assignerså®šä¹‰äº†æ•°æ®æµå…ƒç´ æ€æ ·é€šè¿‡çª—å£ï¼Œè¿™å®Œå…¨å–å†³äºä½ çš„window assignersçš„é€‰æ‹©ï¼Œwindow()è¿˜æ˜¯windowAll()WindowAssignerè´Ÿè´£å°†æ¯ä¸ªä¼ å…¥å…ƒç´ åˆ†é…ç»™ä¸€ä¸ªæˆ–å¤šä¸ªçª—å£ã€‚Flinkå¸¦æœ‰é’ˆå¯¹æœ€å¸¸è§ç”¨ä¾‹çš„é¢„å®šä¹‰çª—å£åˆ†é…å™¨ï¼Œå³tumbling windows,æ»šåŠ¨çª—å£ï¼Œ sliding windowsæ»‘åŠ¨çª—å£ï¼Œsession windowsä¼šè¯çª—å£å’Œglobal windowså…¨å±€çª—å£ ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡æ‰©å±•WindowAssignerç±»æ¥å®ç°è‡ªå®šä¹‰çª—å£åˆ†é…å™¨ã€‚æ‰€æœ‰å†…ç½®çª—å£åˆ†é…å™¨ï¼ˆglobal windows**å…¨å±€çª—å£é™¤å¤–**ï¼‰å‡åŸºäºæ—¶é—´å°†å…ƒç´ åˆ†é…ç»™çª—å£ï¼Œæ—¶é—´å¯ä»¥æ˜¯process timeï¼Œä¹Ÿå¯ä»¥æ˜¯event timeã€‚process timeå’Œevent timeä¹‹é—´çš„å·®å¼‚ä»¥åŠtimestampså’Œwatermarksçš„ç”Ÿæˆæ–¹å¼ç¨åå†è®²ã€‚åŸºäºæ—¶é—´çš„çª—å£å…·æœ‰å¼€å§‹æ—¶é—´æˆ³ï¼ˆåŒ…æ‹¬ç«¯ç‚¹ï¼‰å’Œç»“æŸæ—¶é—´æˆ³ï¼ˆåŒ…æ‹¬ç«¯ç‚¹ï¼‰ï¼Œå®ƒä»¬å…±åŒæè¿°äº†çª—å£çš„å¤§å°ã€‚åœ¨ä»£ç ä¸­ï¼ŒFlinkåœ¨ä½¿ç”¨TimeWindowåŸºäºæ—¶é—´çš„çª—å£æ—¶ä½¿ç”¨ï¼Œè¯¥æ–¹æ³•å…·æœ‰æŸ¥è¯¢å¼€å§‹å’Œç»“æŸæ—¶é—´æˆ³è®°çš„æ–¹æ³•maxTimestamp()ï¼Œè¿˜å…·æœ‰è¿”å›ç»™å®šçª—å£å…è®¸çš„æœ€å¤§æ—¶é—´æˆ³çš„é™„åŠ æ–¹æ³•ã€‚åœ¨ä¸‹é¢ï¼Œæˆ‘ä»¬å±•ç¤ºFlinkçš„é¢„å®šä¹‰çª—å£åˆ†é…å™¨å¦‚ä½•å·¥ä½œä»¥åŠå¦‚ä½•åœ¨DataStreamç¨‹åºä¸­ä½¿ç”¨å®ƒä»¬ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†æ¯ä¸ªåˆ†é…å™¨çš„å·¥ä½œæƒ…å†µã€‚ç´«è‰²åœ†åœˆè¡¨ç¤ºæµçš„å…ƒç´ ï¼Œè¿™äº›å…ƒç´ ç”±æŸä¸ªé”®ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ä¸ºç”¨æˆ·1ï¼Œç”¨æˆ·2å’Œç”¨æˆ·3ï¼‰åˆ’åˆ†ã€‚xè½´æ˜¾ç¤ºæ—¶é—´è¿›åº¦ã€‚Tumbling Windowsæ»šåŠ¨çª—å£æ»šåŠ¨_çª—å£_åˆ†é…å™¨åˆ†é…æ¯ä¸ªå…ƒç´ åˆ°æŒ‡å®š_çª—å£å¤§å°_çš„çª—å£ã€‚æ»šåŠ¨çª—å£å…·æœ‰å›ºå®šçš„å¤§å°ï¼Œå¹¶ä¸”ä¸é‡å ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æŒ‡å®šå¤§å°ä¸º5åˆ†é’Ÿçš„æ»šåŠ¨çª—å£ï¼Œåˆ™å°†è¯„ä¼°å½“å‰çª—å£ï¼Œå¹¶ä¸”æ¯äº”åˆ†é’Ÿå°†å¯åŠ¨ä¸€ä¸ªæ–°çª—å£ã€‚é‚£ä¹ˆåœ¨æ»šåŠ¨çª—å£ä¸Šçš„å®ç°ï¼ŒSpark Stremingå’ŒFlinkæœ‰æ˜æ˜¾çš„ä¸åŒï¼Œæœ€å¤§çš„åŒºåˆ«æ˜¯spark streamingåœ¨ä¸€å¼€å§‹ä¾¿æŒ‡å®šäº†åˆ‡åˆ†æµæ•°æ®çš„æ–¹å¼val ssc = new StreamingContext(conf, Seconds(10)) å³10ç§’åˆ‡åˆ†ä¸€æ¬¡ï¼Œç„¶åå¯¹è¿™ä¸€æ‰¹è¿›è¡Œå¤„ç†ã€‚è€ŒFlinkæ˜¯åé¢è‡ªå·±é€šè¿‡Windowç®—å­timeWindow(Time.seconds(10))æ¥æŒ‡å®šæ¯10ç§’ä½œä¸ºä¸€ä¸ªæ•°æ®çª—å£è¿›è¡Œå¤„ç†ã€‚ä»¥ä¸Šå¯ä»¥çœ‹å‡ºSpark Streamingçš„åº•å±‚ä¸ºmicro batchå¤„ç†æ–¹å¼ï¼ŒFlinkä¸ºæµå¤„ç†æ–¹å¼ã€‚Flinkæ»šåŠ¨çª—å£å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä¸ºäº†æ›´å¥½çš„æ¼”ç¤ºFlinkçš„å„ç§çª—å£æ“ä½œï¼Œæˆ‘èŠ±äº†ä¸€ç‚¹æ—¶é—´ç”¨pythonå†™äº†ä¸€ä¸ªæ¨¡æ‹Ÿå®æ—¶äº§ç”Ÿç”¨æˆ·æ•°æ®çš„ç¨‹åºï¼Œéšåå°†äº§ç”Ÿçš„æ•°æ®å†™å…¥kafkaä¸­ï¼Œé¡ºä¾¿æä¸€ä¸‹Fakerè¿™ä¸ªpythonä¸­çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ¨¡æ‹Ÿæ•°æ®å¾ˆå¥½ç”¨ï¼Œä»¥å‰åªåœ¨çˆ¬è™«ç¨‹åºä¸­ï¼Œç”¨è¿‡æ¨¡æ‹Ÿæµè§ˆå™¨ä¿¡æ¯ã€‚Flink tumbling window ä»£ç ç»“æ„12345678910111213141516171819val input: DataStream[T] = ...// tumbling event-time windowsinput .keyBy(&lt;key selector&gt;) .window(TumblingEventTimeWindows.of(Time.seconds(5))) .&lt;windowed transformation&gt;(&lt;window function&gt;)// tumbling processing-time windowsinput .keyBy(&lt;key selector&gt;) .window(TumblingProcessingTimeWindows.of(Time.seconds(5))) .&lt;windowed transformation&gt;(&lt;window function&gt;)// daily tumbling event-time windows offset by -8 hours.input .keyBy(&lt;key selector&gt;) .window(TumblingEventTimeWindows.of(Time.days(1), Time.hours(-8))) .&lt;windowed transformation&gt;(&lt;window function&gt;)çª—å£å‡½æ•°ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨timeWindow(Time.seconds(5))ï¼Œæ—¶é—´é—´éš”å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸€ä¸ªæŒ‡å®šTime.milliseconds(x)ï¼ŒTime.seconds(x)ï¼Œ Time.minutes(x)ï¼Œç­‰ç­‰ã€‚å¦‚æœ€åä¸€ä¸ªç¤ºä¾‹æ‰€ç¤ºï¼Œæ»šåŠ¨çª—å£åˆ†é…å™¨è¿˜é‡‡ç”¨ä¸€ä¸ªå¯é€‰offset å‚æ•°ï¼Œè¯¥å‚æ•°å¯ç”¨äºæ›´æ”¹çª—å£çš„å¯¹é½æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ²¡æœ‰åç§»ï¼Œåˆ™æ¯å°æ—¶æ»šåŠ¨çª—å£ä¸epochå¯¹é½ï¼Œå³æ‚¨å°†è·å¾—è¯¸å¦‚çš„çª—å£ 1:00:00.000 - 1:59:59.999ï¼Œ2:00:00.000 - 2:59:59.999ä¾æ­¤ç±»æ¨ã€‚å¦‚æœè¦æ›´æ”¹ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªåç§»é‡ã€‚éšç€15åˆ†é’Ÿçš„åç§»é‡ï¼Œä½ ä¼šï¼Œä¾‹å¦‚ï¼Œæ‹¿ 1:15:00.000 - 2:14:59.999ï¼Œ2:15:00.000 - 3:14:59.999ç­‰ã€‚ä¸€ä¸ªé‡è¦çš„ç”¨ä¾‹çš„åç§»æ˜¯çª—å£è°ƒæ•´åˆ°æ¯”UTC-0æ—¶åŒºç­‰ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸­å›½ï¼Œæ‚¨å¿…é¡»æŒ‡å®šçš„åç§»é‡Time.hours(-8)ã€‚Sliding Windows_æ»‘åŠ¨çª—å£_è¿™ä¸ªæ»‘åŠ¨çª—å£æ¦‚å¿µå’ŒSpark Streamingä¸­çš„ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œåœ¨Spark Streamingä¸­æ˜¯è¿™æ ·å®ç°çš„1val window_dstream: DStream[(String, Int)] = wordcount_dstream.reduceByKeyAndWindow((x: Int,y: Int)=&gt;x+y,Seconds(30), Seconds(10))_æ»‘åŠ¨çª—å£_åˆ†é…å™¨è®©å…ƒç´ ä»¥å›ºå®šé•¿åº¦çš„çª—å£é€šè¿‡ã€‚ç±»ä¼¼äºæ»šåŠ¨çª—å£åˆ†é…å™¨ï¼Œ_çª—å£çš„å¤§å°ç”±çª—å£å¤§å°_å‚æ•°é…ç½®ã€‚é™„åŠ çš„_çª—å£æ»‘åŠ¨_å‚æ•°æ§åˆ¶æ»‘åŠ¨çª—å£å¯åŠ¨çš„é¢‘ç‡ã€‚å› æ­¤ï¼Œå¦‚æœæ»‘åŠ¨å‚æ•°å°äºçª—å£å¤§å°ï¼Œåˆ™æ»‘åŠ¨çª—å£ä¼šé‡å ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…ƒç´ è¢«åˆ†é…ç»™å¤šä¸ªçª—å£ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†å¤§å°ä¸º10åˆ†é’Ÿçš„çª—å£æ»‘åŠ¨5åˆ†é’Ÿã€‚è¿™æ ·ï¼Œæ‚¨æ¯éš”5åˆ†é’Ÿå°±ä¼šå¾—åˆ°ä¸€ä¸ªçª—å£ï¼Œå…¶ä¸­åŒ…å«æœ€è¿‘10åˆ†é’Ÿå†…åˆ°è¾¾çš„äº‹ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚sliding windowsæ»‘åŠ¨çª—å£ä»£ç ç»“æ„**12345678910111213141516val input: DataStream[T] = ...// sliding event-time windowsinput .keyBy(&lt;key selector&gt;) .window(SlidingEventTimeWindows.of(Time.seconds(10), Time.seconds(5))) .&lt;windowed transformation&gt;(&lt;window function&gt;)// sliding processing-time windowsinput .keyBy(&lt;key selector&gt;) .window(SlidingProcessingTimeWindows.of(Time.seconds(10), Time.seconds(5))) .&lt;windowed transformation&gt;(&lt;window function&gt;)// sliding processing-time windows offset by -8 hoursinput .keyBy(&lt;key selector&gt;) .window(SlidingProcessingTimeWindows.of(Time.hours(12), Time.hours(1), Time.hours(-8))) .&lt;windowed transformation&gt;(&lt;window function&gt;)çª—å£å‡½æ•°ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨timeWindow(Time.seconds(10), Time.seconds(5))ï¼Œæ—¶é—´é—´éš”å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸€ä¸ªæŒ‡å®šTime.milliseconds(x)ï¼ŒTime.seconds(x)ï¼Œ Time.minutes(x)ï¼Œç­‰ç­‰ã€‚å¦‚æœ€åä¸€ä¸ªç¤ºä¾‹æ‰€ç¤ºï¼Œæ»‘åŠ¨çª—å£åˆ†é…å™¨è¿˜é‡‡ç”¨ä¸€ä¸ªå¯é€‰offsetå‚æ•°ï¼Œè¯¥å‚æ•°å¯ç”¨äºæ›´æ”¹çª—å£çš„å¯¹é½æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨æ²¡æœ‰åç§»çš„æƒ…å†µä¸‹ï¼Œæ¯å°æ—¶æ»‘åŠ¨30åˆ†é’Ÿçš„çª—å£å°†ä¸epochå¯¹é½ï¼Œå³æ‚¨å°†è·å¾—è¯¸å¦‚çš„çª—å£ 1:00:00.000 - 1:59:59.999ï¼Œ1:30:00.000 - 2:29:59.999ä¾æ­¤ç±»æ¨ã€‚å¦‚æœè¦æ›´æ”¹ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªåç§»é‡ã€‚éšç€15åˆ†é’Ÿçš„åç§»é‡ï¼Œä½ ä¼šï¼Œä¾‹å¦‚ï¼Œæ‹¿ 1:15:00.000 - 2:14:59.999ï¼Œ1:45:00.000 - 2:44:59.999ç­‰ä¸€ä¸ªé‡è¦çš„ç”¨ä¾‹çš„åç§»æ˜¯çª—å£è°ƒæ•´åˆ°æ¯”UTC-0æ—¶åŒºç­‰ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸­å›½ï¼Œæ‚¨å¿…é¡»æŒ‡å®šçš„åç§»é‡Time.hours(-8)ã€‚Session Windowsä¼šè¯çª—å£ä¼šè¯çª—å£ä¸­çš„å…ƒç´ æ˜¯æ­£åœ¨æ´»è·ƒçš„ä¼šè¯äº§ç”Ÿçš„æ•°æ®ã€‚ä¸æ»šåŠ¨çª—å£å’Œæ»‘åŠ¨çª—å£ç›¸æ¯”ï¼Œä¼šè¯çª—å£ä¸é‡å ä¸”æ²¡æœ‰å›ºå®šçš„çª—å£å¼€å§‹å’Œç»“æŸæ—¶é—´ã€‚ç›¸åï¼Œå½“ä¼šè¯çª—å£åœ¨ä¸€å®šæ—¶é—´æ®µå†…æœªæ”¶åˆ°å…ƒç´ æ—¶ï¼ˆå³ä¸å‘ç”Ÿæ´»åŠ¨æ•°æ®é—´éš™æ—¶ï¼‰ï¼Œå®ƒå°†å…³é—­ã€‚ä¼šè¯çª—å£åˆ†é…å™¨é…ç½®é™æ€ä¼šè¯é—´éš”ï¼Œå…¶é™å®šå½“ä¼šè¯ä¸æ´»åŠ¨å‘¨æœŸæœ‰å¤šé•¿ã€‚å½“æ­¤æ—¶é—´æ®µåˆ°æœŸæ—¶ï¼Œå½“å‰ä¼šè¯å°†å…³é—­ï¼Œéšåçš„å…ƒç´ å°†åˆ†é…ç»™æ–°çš„ä¼šè¯çª—å£ã€‚åœ¨ç°å®ä¸­çš„æ„ä¹‰å°±æ˜¯ï¼Œå½“æ•°æ®å¤„äºè¿ç»­æ´»è·ƒçš„çŠ¶æ€ä¸‹ï¼Œå¹¶ä¸åˆ’åˆ†çª—å£ï¼Œä½†æ˜¯å½“æ•°æ®å¤„äºä¸æ´»è·ƒçš„çŠ¶æ€ï¼Œç›¸é‚»æ•°æ®çš„æ—¶é—´è¶…è¿‡äº†è®¾å®šçš„gapï¼Œåˆ™åˆ’å®šä¸€ä¸ªæ–°çª—å£ã€‚12345678910111213141516171819202122232425262728293031323334val input: DataStream[T] = ...// event-time session windows with static gapinput .keyBy(&lt;key selector&gt;) .window(EventTimeSessionWindows.withGap(Time.minutes(10))) .&lt;windowed transformation&gt;(&lt;window function&gt;)// event-time session windows with dynamic gapinput .keyBy(&lt;key selector&gt;) .window(EventTimeSessionWindows.withDynamicGap(new SessionWindowTimeGapExtractor[String] &#123; override def extract(element: String): Long = &#123; // determine and return session gap &#125; &#125;)) .&lt;windowed transformation&gt;(&lt;window function&gt;)// processing-time session windows with static gapinput .keyBy(&lt;key selector&gt;) .window(ProcessingTimeSessionWindows.withGap(Time.minutes(10))) .&lt;windowed transformation&gt;(&lt;window function&gt;)// processing-time session windows with dynamic gapinput .keyBy(&lt;key selector&gt;) .window(DynamicProcessingTimeSessionWindows.withDynamicGap(new SessionWindowTimeGapExtractor[String] &#123; override def extract(element: String): Long = &#123; // determine and return session gap &#125; &#125;)) .&lt;windowed transformation&gt;(&lt;window function&gt;)é™æ€é—´éš™å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸­çš„ä¸€ä¸ªæ¥æŒ‡å®šTime.milliseconds(x)ï¼ŒTime.seconds(x)ï¼Œ Time.minutes(x)ã€‚åŠ¨æ€é—´éš™æ˜¯é€šè¿‡å®ç°SessionWindowTimeGapExtractoræ¥å£æŒ‡å®šçš„ã€‚ç”±äºä¼šè¯çª—å£æ²¡æœ‰å›ºå®šçš„å¼€å§‹å’Œç»“æŸï¼Œå› æ­¤å¯¹å®ƒä»¬çš„è¯„ä¼°ä¸åŒäºæ»šåŠ¨çª—å£å’Œæ»‘åŠ¨çª—å£ã€‚åœ¨å†…éƒ¨ï¼Œä¼šè¯çª—å£è¿ç®—ç¬¦ä¼šä¸ºæ¯ä¸ªåˆ°è¾¾çš„è®°å½•åˆ›å»ºä¸€ä¸ªæ–°çª—å£ï¼Œå¦‚æœçª—å£å½¼æ­¤ä¹‹é—´çš„è·ç¦»æ¯”å·²å®šä¹‰çš„é—´éš”å°ï¼Œåˆ™å°†å®ƒä»¬åˆå¹¶åœ¨ä¸€èµ·ã€‚ä¸ºäº†å¯ä»¥å°†æ•°æ®åˆå¹¶ï¼Œä¼šè¯çª—å£éœ€è¦ä¸€ä¸ªåˆå¹¶è§¦å‘å™¨ä»¥åŠåˆå¹¶çª—å£å‡½æ•°ï¼Œå¦‚ReduceFunctionï¼ŒAggregateFunctionï¼Œæˆ–ProcessWindowFunction ï¼ˆFoldFunctionä¸èƒ½åˆå¹¶ã€‚ï¼‰æ¥ä¸‹æ¥ï¼Œæ‰€æœ‰çš„çª—å£å‡½æ•°æ“ä½œçš„æ•°æ®ï¼Œéƒ½æ˜¯åŸºäºä¸‹é¢æˆ‘ç”¨pythonä¸‹çš„æ¨¡æ‹Ÿç”Ÿäº§ç”¨æˆ·æ•°æ®ã€‚pythonæ¨¡æ‹Ÿæ•°æ®ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263import randomimport timefrom datetime import datetimefrom faker import Fakerfrom kafka import KafkaProducerimport json# åˆå§‹åŒ–fake = Faker(locale='zh_CN')producer = KafkaProducer(value_serializer=lambda v: json.dumps(v).encode('utf-8'),bootstrap_servers=['localhost:9092'])\"\"\"ç”Ÿæˆéšæœºæ—¶é—´ï¼ˆæ³¨å†Œæ—¶é—´å’Œæœ€è¿‘ç™»é™†æ—¶é—´ï¼‰\"\"\"register_start = '2017-06-02 12:12:12'register_end = '2017-11-01 00:00:00'login_start = '2018-05-01 12:12:12'login_end = '2018-12-01 00:00:00'def strTimeProp(start, end, prop, frmt): stime = time.mktime(time.strptime(start, frmt)) etime = time.mktime(time.strptime(end, frmt)) ptime = stime + prop * (etime - stime) return int(ptime)def register_randomDate(register_start, register_end, frmt='%Y-%m-%d %H:%M:%S'): register_time = time.strftime(frmt, time.localtime(strTimeProp(register_start, register_end, random.random(), frmt))) return register_timedef login_randomDate(login_start, login_end, frmt='%Y-%m-%d %H:%M:%S'): login_time = time.strftime(frmt, time.localtime(strTimeProp(login_start, login_end, random.random(), frmt))) return login_time\"\"\"ç”Ÿæˆæ¸ é“ï¼Œè®¾å¤‡\"\"\"def get_device(): web_devices = ['Chrome', '360_browser', 'QQ_browser', 'Firefox', 'Opera', 'UC_browser'] app_devices = ['xiaomi', 'iphone', 'Samsung', 'meizu', '1+', 'huawei','vivo', 'oppo'] pc_devices = ['Windows','Mac'] channels = &#123;'web':web_devices, 'app': app_devices, 'pc': pc_devices&#125; channel = random.choice(list(channels.keys())) device = random.choice(channels[channel]) return channel, devicedef main(): sex_list = ['male', 'female'] while True: channel, device = get_device() register_date_time = register_randomDate(register_start, register_end, frmt='%Y-%m-%d %H:%M:%S') last_login_time = login_randomDate(login_start, login_end, frmt='%Y-%m-%d %H:%M:%S') real_name, user_name, age, sex, phone_number, province, email, ip_address, company, channel, device, register_date_time, last_login_time = fake.name(), fake.user_name(), random.choice(range(18,65)) ,random.choice(sex_list), fake.phone_number(), fake.province(), fake.ascii_free_email(), fake.ipv4(), fake.company(), channel, device, register_date_time, last_login_time raw_data = &#123;'real_name': real_name, 'user_name': user_name, 'age':age, 'sex':sex, 'phone_number':phone_number,'province':province, 'email':email, 'ip_address':ip_address, 'company':company, 'channel':channel, 'device':device, 'register_date_time':register_date_time, 'last_login_time':last_login_time&#125; print(raw_data) producer.send('user_information', raw_data) time.sleep(0.5)if __name__ == '__main__': main()æ•°æ®æ ·å¼ReduceFunctionReduceFunctionæŒ‡å®šå¦‚ä½•å°†è¾“å…¥ä¸­çš„ä¸¤ä¸ªå…ƒç´ ç»„åˆåœ¨ä¸€èµ·ä»¥äº§ç”Ÿç›¸åŒç±»å‹çš„è¾“å‡ºå…ƒç´ ã€‚Flinkä½¿ç”¨a ReduceFunctionæ¥é€æ­¥å¢é‡çš„èšåˆçª—å£å…ƒç´ ã€‚ReduceFunctionçš„æºç ï¼š123456789101112131415161718/** * Applies a reduce function to the window. The window function is called for each evaluation * of the window for each key individually. The output of the reduce function is interpreted * as a regular non-windowed stream. * * This window will try and pre-aggregate data as much as the window policies permit. For example, * tumbling time windows can perfectly pre-aggregate the data, meaning that only one element per * key is stored. Sliding time windows will pre-aggregate on the granularity of the slide * interval, so a few elements are stored per key (one per slide interval). * Custom windows may not be able to pre-aggregate, or may need to store extra values in an * aggregation tree. * * @param function The reduce function. * @return The data stream that is the result of applying the reduce function to the window. */def reduce(function: ReduceFunction[T]): DataStream[T] = &#123; asScalaStream(javaStream.reduce(clean(function)))&#125;åˆ©ç”¨tumbling windowä¸¾ä¾‹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283package data_stream.windowimport java.util.Propertiesimport com.alibaba.fastjson.&#123;JSON, JSONObject&#125;import org.apache.flink.streaming.api.scala._import org.apache.flink.runtime.state.filesystem.FsStateBackendimport org.apache.flink.streaming.api.CheckpointingModeimport org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment&#125;import org.apache.flink.streaming.api.windowing.time.Timeimport org.apache.flink.streaming.api.windowing.windows.TimeWindowimport org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumerBaseimport utils.KafkaUtil/** * reduce Function * å¢é‡ç´¯åŠ  * è¾“å…¥è¾“å‡ºç±»å‹è¦ä¸€è‡´ */object window_function_reduce &#123; case class UserLogData(real_name: String, user_name: String, age: Int, sex: String, phone_number: String, province: String, email: String, ip_address: String, company: String, channel: String, device: String, register_date_time: String, last_login_time: String) private val KAFKA_TOPIC: String = \"user_information\" def main(args: Array[String]) &#123; val properties: Properties = new Properties() properties.setProperty(\"bootstrap.servers\", \"localhost:9092\") properties.setProperty(\"group.id\", \"kafka_consumer\") val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment // exactly-once è¯­ä¹‰ä¿è¯æ•´ä¸ªåº”ç”¨å†…ç«¯åˆ°ç«¯çš„æ•°æ®ä¸€è‡´æ€§ env.getCheckpointConfig.setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE) // å¼€å¯æ£€æŸ¥ç‚¹å¹¶æŒ‡å®šæ£€æŸ¥ç‚¹æ—¶é—´é—´éš”ä¸º5s env.enableCheckpointing(5000) // checkpoint every 5000 msecs // è®¾ç½®StateBackendï¼Œå¹¶æŒ‡å®šçŠ¶æ€æ•°æ®å­˜å‚¨ä½ç½® env.setStateBackend(new FsStateBackend(\"file:///Users/cpeixin/IdeaProjects/code_warehouse/data/KafkaSource/tumbling\")) val kafkaSource: FlinkKafkaConsumerBase[String] = KafkaUtil.getKafkaSource(KAFKA_TOPIC) //è®¡ç®—çª—å£å†…5ç§’çš„æ•°æ® val original_stream: DataStream[String] = env.addSource(kafkaSource) \"\"\" |original_stream&gt; UserLogData(çºªæ·‘å…°,ehao,37,female,18529008264,è¾½å®çœ,apeng@gmail.com,110.75.179.140,æ˜“åŠ¨åŠ›ç§‘æŠ€æœ‰é™å…¬å¸,app,xiaomi,2017-08-18 12:29:29,2018-09-02 05:05:56) |original_stream&gt; UserLogData(åˆ˜ç‰è‹±,caojing,42,male,15647635274,é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº,houwei@hotmail.com,50.188.173.136,åŒå…´ä¸‡ç‚¹ä¼ åª’æœ‰é™å…¬å¸,web,Firefox,2017-10-27 12:20:20,2018-10-11 09:26:20) |original_stream&gt; UserLogData(è–›è,leizhong,32,male,18928404956,äº‘å—çœ,xxiao@yahoo.com,115.123.146.193,ç½‘æ–°æ’å¤©ä¼ åª’æœ‰é™å…¬å¸,web,360_browser,2017-06-17 16:42:24,2018-09-19 19:36:39) \"\"\".stripMargin /** * è¿™é‡Œæˆ‘ä»¬è®¾å®šä¸€ä¸ªå…·ä½“çš„éœ€æ±‚ï¼Œç»Ÿè®¡è¿‡å»çš„5ç§’å†…ï¼Œå„çœä»½è®¿é—®çš„ç”¨æˆ·æ•°é‡ç»Ÿè®¡ * ä¸‹é¢ç¬¬äºŒæ¬¡mapæ“ä½œ=ã€‹(String, Int)ï¼Œæ˜¯å› ä¸ºæ¥ä¸‹æ¥è¦ä½¿ç”¨reduceå‡½æ•° * reduceå‡½æ•°èšåˆæ˜¯è¦æ±‚è¾“å…¥å’Œè¾“å‡ºæ ¼å¼ç›¸åŒçš„ã€‚ * * ä»¥ä¸‹çš„è½¬æ¢æ­¥éª¤å¯ä»¥ä¸²è”çš„å†™åœ¨ä¸€èµ·ï¼Œä½†æ˜¯åœ¨è¿™é‡Œåˆ†å¼€å†™æ˜¯æƒ³æ¸…æ™°çš„å±•ç¤ºæ¯ä¸€æ­¥è½¬æ¢åï¼ŒStreamçš„ç±»å‹å˜æ¢ */ val original_format_stream: DataStream[(String, Int)] = original_stream .map(match_data(_: String)) .map((raw: UserLogData) =&gt;(raw.province, 1)) val province_window_stream: WindowedStream[(String, Int), String, TimeWindow] = original_format_stream .keyBy((_: (String, Int))._1) .timeWindow(Time.seconds(5)) val result_stream: DataStream[(String, Int)] = province_window_stream .reduce((p1: (String, Int), p2: (String, Int)) =&gt; (p1._1, p1._2 + p2._2)) result_stream.print(\"province_count\").setParallelism(1) env.execute(\"province count stream\") &#125; def match_data(original_str: String): UserLogData = &#123; val original_json: JSONObject = JSON.parseObject(original_str) UserLogData(original_json.getString(\"real_name\"), original_json.getString(\"user_name\"), original_json.getInteger(\"age\"), original_json.getString(\"sex\"), original_json.getString(\"phone_number\"), original_json.getString(\"province\"), original_json.getString(\"email\"), original_json.getString(\"ip_address\"), original_json.getString(\"company\"), original_json.getString(\"channel\"), original_json.getString(\"device\"), original_json.getString(\"register_date_time\"), original_json.getString(\"last_login_time\")) &#125;&#125;123456789101112131415161718192021222324province_count&gt; (å®‰å¾½çœ,2)province_count&gt; (è´µå·çœ,1)province_count&gt; (æ±Ÿè‹çœ,2)province_count&gt; (åŒ—äº¬å¸‚,1)province_count&gt; (é‡åº†å¸‚,1)province_count&gt; (æ¹–å—çœ,1)province_count&gt; (æµ·å—çœ,2)province_count&gt; (ç”˜è‚ƒçœ,2)province_count&gt; (æ²³å—çœ,2)province_count&gt; (é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº,4)province_count&gt; (å››å·çœ,2)province_count&gt; (äº‘å—çœ,2)province_count&gt; (è¾½å®çœ,2)province_count&gt; (é’æµ·çœ,3)province_count&gt; (æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº,1)province_count&gt; (å¤©æ´¥å¸‚,1)province_count&gt; (æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº,1)province_count&gt; (æ²³åŒ—çœ,2)province_count&gt; (å‰æ—çœ,1)province_count&gt; (å®å¤å›æ—è‡ªæ²»åŒº,1)province_count&gt; (æ±Ÿè¥¿çœ,1)province_count&gt; (é»‘é¾™æ±Ÿçœ,1)province_count&gt; (å±±è¥¿çœ,5)province_count&gt; (è¥¿è—è‡ªæ²»åŒº,1)AggregateFunctionAggregateFunctionæ˜¯ä¸€ä¸ªæ™®é€šç‰ˆæœ¬ReduceFunctionï¼Œå…¶å…·æœ‰ä¸‰ç§ç±»å‹ï¼šè¾“å…¥ç±»å‹ï¼ˆINï¼‰ï¼Œç´¯åŠ å™¨ç±»å‹ï¼ˆACCï¼‰ï¼Œå’Œä¸€ä¸ªè¾“å‡ºç±»å‹ï¼ˆOUTï¼‰ã€‚è¾“å…¥ç±»å‹æ˜¯è¾“å…¥æµä¸­æ•°æ®çš„ç±»å‹ï¼Œå¹¶ä¸”AggregateFunctionå…·æœ‰å°†ä¸€ä¸ªè¾“å…¥å…ƒç´ æ·»åŠ åˆ°ç´¯åŠ å™¨çš„æ–¹æ³•ã€‚è¯¥æ¥å£è¿˜å…·æœ‰åˆ›å»ºåˆå§‹ç´¯åŠ å™¨ï¼Œå°†ä¸¤ä¸ªç´¯åŠ å™¨åˆå¹¶ä¸ºä¸€ä¸ªç´¯åŠ å™¨ä»¥åŠOUTä»ç´¯åŠ å™¨æå–è¾“å‡ºï¼ˆç±»å‹ï¼‰çš„æ–¹æ³•ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å…¶å·¥ä½œåŸç†ã€‚ä¸ReduceFunctionä¸€æ ·ï¼ŒFlinkå°†åœ¨çª—å£è¾“å…¥å…ƒç´ åˆ°è¾¾æ—¶é€æ­¥å¢é‡çš„èšåˆå®ƒä»¬ã€‚ä¸€ä¸ªAggregateFunctionå¯ä»¥è¢«è¿™æ ·å®šä¹‰å¹¶ä½¿ç”¨ï¼š12345678910111213141516171819202122/** * The accumulator is used to keep a running sum and a count. The [getResult] method * computes the average. */class AverageAggregate extends AggregateFunction[(String, Long), (Long, Long), Double] &#123; override def createAccumulator() = (0L, 0L) override def add(value: (String, Long), accumulator: (Long, Long)) = (accumulator._1 + value._2, accumulator._2 + 1L) override def getResult(accumulator: (Long, Long)) = accumulator._1 / accumulator._2 override def merge(a: (Long, Long), b: (Long, Long)) = (a._1 + b._1, a._2 + b._2)&#125;val input: DataStream[(String, Long)] = ...input .keyBy(&lt;key selector&gt;) .window(&lt;window assigner&gt;) .aggregate(new AverageAggregate)åˆ©ç”¨sliding windowä¸¾ä¾‹aggregate()æ–¹æ³•ä¸­ä¸èƒ½åƒreduce(function: (T, T) =&gt; T)ä¸€æ ·ä½¿ç”¨åŒ¿åå‡½æ•°ï¼Œè€Œæ˜¯éœ€è¦è‡ªå®šä¹‰ç»§æ‰¿äº†AggregateFunctionçš„å¯¹è±¡ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106package data_stream.windowimport java.util.Propertiesimport com.alibaba.fastjson.&#123;JSON, JSONObject&#125;import org.apache.flink.streaming.api.scala._import org.apache.flink.api.common.functions.AggregateFunctionimport org.apache.flink.runtime.state.filesystem.FsStateBackendimport org.apache.flink.streaming.api.CheckpointingModeimport org.apache.flink.streaming.api.scala.function.WindowFunctionimport org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment, WindowedStream&#125;import org.apache.flink.streaming.api.windowing.assigners.SlidingProcessingTimeWindowsimport org.apache.flink.streaming.api.windowing.time.Timeimport org.apache.flink.streaming.api.windowing.windows.TimeWindowimport org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumerBaseimport org.apache.flink.util.Collectorimport utils.KafkaUtilobject window_function_aggregate &#123; /** * å¢é‡å¤„ç†ï¼Œæ¥ä¸€æ¡æ•°æ®å¤„ç†ä¸€æ¡ã€‚ */ class aggregate_channel_devices extends AggregateFunction[((String,String), Int),Long, Long]&#123; // æ•°æ®ç´¯åŠ é€»è¾‘ override def add(in: ((String, String), Int), acc: Long): Long = acc + in._2 // ç´¯åŠ å™¨åˆå§‹åŒ– override def createAccumulator(): Long = 0L // ç´¯åŠ å™¨è®¡ç®—çš„ç»“æœ override def getResult(acc: Long): Long = acc // ä¸åŒåˆ†åŒºä¹‹é—´ï¼Œç´¯åŠ å™¨çš„å€¼ç›¸åŠ  override def merge(acc: Long, acc1: Long): Long = acc + acc1 &#125; /** * ä½œç”¨ä¸çª—å£å†…ï¼Œaggregateåæ•°æ®çš„å‡½æ•°ï¼Œçª—å£ç»“æŸæ—¶è¿è¡Œ * åŸºäºæ¥å£WindowFunction[IN, OUT, KEY, W &lt;: Window] * IN ï¼šè¾“å…¥å‚æ•°ï¼Œä¸º AggregateFunctionçš„è¾“å‡º * OUTï¼šè¾“å‡ºå‚æ•° * */ class channel_devices_windowFuction extends WindowFunction[Long, ((String, String), Long), (String, String), TimeWindow]&#123; override def apply(key: (String, String), window: TimeWindow, input: Iterable[Long], out: Collector[((String, String), Long)]): Unit = &#123; out.collect((key, input.iterator.next())) &#125; &#125; case class UserLogData(real_name: String, user_name: String, age: Int, sex: String, phone_number: String, province: String, email: String, ip_address: String, company: String, channel: String, device: String, register_date_time: String, last_login_time: String) private val KAFKA_TOPIC: String = \"user_information\" def main(args: Array[String]) &#123; val properties: Properties = new Properties() properties.setProperty(\"bootstrap.servers\", \"localhost:9092\") properties.setProperty(\"group.id\", \"kafka_consumer\") val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment // exactly-once è¯­ä¹‰ä¿è¯æ•´ä¸ªåº”ç”¨å†…ç«¯åˆ°ç«¯çš„æ•°æ®ä¸€è‡´æ€§ env.getCheckpointConfig.setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE) // å¼€å¯æ£€æŸ¥ç‚¹å¹¶æŒ‡å®šæ£€æŸ¥ç‚¹æ—¶é—´é—´éš”ä¸º5s env.enableCheckpointing(5000) // checkpoint every 5000 msecs // è®¾ç½®StateBackendï¼Œå¹¶æŒ‡å®šçŠ¶æ€æ•°æ®å­˜å‚¨ä½ç½® env.setStateBackend(new FsStateBackend(\"file:///Users/cpeixin/IdeaProjects/code_warehouse/data/KafkaSource/tumbling\")) val kafkaSource: FlinkKafkaConsumerBase[String] = KafkaUtil.getKafkaSource(KAFKA_TOPIC) //è®¡ç®—çª—å£å†…5ç§’çš„æ•°æ® val original_stream: DataStream[String] = env.addSource(kafkaSource) \"\"\" |original_stream&gt; UserLogData(çºªæ·‘å…°,ehao,37,female,18529008264,è¾½å®çœ,apeng@gmail.com,110.75.179.140,æ˜“åŠ¨åŠ›ç§‘æŠ€æœ‰é™å…¬å¸,app,xiaomi,2017-08-18 12:29:29,2018-09-02 05:05:56) |original_stream&gt; UserLogData(åˆ˜ç‰è‹±,caojing,42,male,15647635274,é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº,houwei@hotmail.com,50.188.173.136,åŒå…´ä¸‡ç‚¹ä¼ åª’æœ‰é™å…¬å¸,web,Firefox,2017-10-27 12:20:20,2018-10-11 09:26:20) |original_stream&gt; UserLogData(è–›è,leizhong,32,male,18928404956,äº‘å—çœ,xxiao@yahoo.com,115.123.146.193,ç½‘æ–°æ’å¤©ä¼ åª’æœ‰é™å…¬å¸,web,360_browser,2017-06-17 16:42:24,2018-09-19 19:36:39) \"\"\".stripMargin /** * è¿™é‡Œæˆ‘ä»¬è®¾å®šä¸€ä¸ªå…·ä½“çš„éœ€æ±‚ï¼Œæ¯5ç§’ç»Ÿè®¡è¿‡å»10ç§’ä¸­ï¼Œç”¨æˆ·æ¸ é“æ¥æºä»¥åŠä½¿ç”¨è®¾å¤‡çš„æ’è¡Œ */ val original_format_stream: DataStream[((String, String),Int)] = original_stream .map(match_data(_: String)) .map((raw: UserLogData) =&gt; ((raw.channel, raw.device), 1)) original_format_stream .keyBy((_: ((String, String), Int))._1) .window(SlidingProcessingTimeWindows.of(Time.seconds(10),Time.seconds(5))) .aggregate(new aggregate_channel_devices, new channel_devices_windowFuction) .print(\"channel_device\") env.execute(\"channel_device stream\") &#125; def match_data(original_str: String): UserLogData = &#123; val original_json: JSONObject = JSON.parseObject(original_str) UserLogData(original_json.getString(\"real_name\"), original_json.getString(\"user_name\"), original_json.getInteger(\"age\"), original_json.getString(\"sex\"), original_json.getString(\"phone_number\"), original_json.getString(\"province\"), original_json.getString(\"email\"), original_json.getString(\"ip_address\"), original_json.getString(\"company\"), original_json.getString(\"channel\"), original_json.getString(\"device\"), original_json.getString(\"register_date_time\"), original_json.getString(\"last_login_time\")) &#125;&#125;1234567891011121314channel_device:1&gt; ((app,Samsung),27)channel_device:2&gt; ((app,vivo),20)channel_device:3&gt; ((app,1+),19)channel_device:8&gt; ((pc,Mac),84)channel_device:4&gt; ((web,Chrome),26)channel_device:6&gt; ((app,meizu),22)channel_device:4&gt; ((app,oppo),21)channel_device:8&gt; ((pc,Windows),90)channel_device:3&gt; ((web,360_browser),25)channel_device:1&gt; ((web,QQ_browser),32)channel_device:2&gt; ((web,Opera),26)channel_device:3&gt; ((web,Firefox),34)channel_device:8&gt; ((web,UC_browser),25)channel_device:3&gt; ((app,huawei),19)ProcessWindowFunctionProcessWindowFunctionæ˜¯å¤„ç†çª—å£å‡½æ•°ä¸­ï¼Œåº•å±‚çš„å¤„ç†æ•°æ®APIï¼Œè·å–ä¸€ä¸ªIterableï¼Œè¯¥IterableåŒ…å«çª—å£çš„æ‰€æœ‰å…ƒç´ ï¼Œä»¥åŠä¸€ä¸ªContextå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥è®¿é—®æ—¶é—´å’ŒçŠ¶æ€ä¿¡æ¯ï¼Œä»è€Œä½¿å…¶æ¯”å…¶ä»–çª—å£å‡½æ•°æ›´å…·çµæ´»æ€§ã€‚è¿™æ˜¯ä»¥æ€§èƒ½å’Œèµ„æºæ¶ˆè€—ä¸ºä»£ä»·çš„ï¼Œå› ä¸ºæ— æ³•å¢é‡èšåˆå…ƒç´ ï¼Œè€Œæ˜¯éœ€è¦åœ¨å†…éƒ¨å¯¹å…¶è¿›è¡Œç¼“å†²ï¼Œç›´åˆ°å°†çª—å£è§†ä¸ºå·²å‡†å¤‡å¥½è¿›è¡Œå¤„ç†ä¸ºæ­¢ã€‚ProcessWindowFunctionlook çš„æŠ½è±¡ç±»å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748abstract class ProcessWindowFunction[IN, OUT, KEY, W &lt;: Window] extends Function &#123; /** * Evaluates the window and outputs none or several elements. * * @param key The key for which this window is evaluated. * @param context The context in which the window is being evaluated. * @param elements The elements in the window being evaluated. * @param out A collector for emitting elements. * @throws Exception The function may throw exceptions to fail the program and trigger recovery. */ def process( key: KEY, context: Context, elements: Iterable[IN], out: Collector[OUT]) /** * The context holding window metadata */ abstract class Context &#123; /** * Returns the window that is being evaluated. */ def window: W /** * Returns the current processing time. */ def currentProcessingTime: Long /** * Returns the current event-time watermark. */ def currentWatermark: Long /** * State accessor for per-key and per-window state. */ def windowState: KeyedStateStore /** * State accessor for per-key global state. */ def globalState: KeyedStateStore &#125;&#125;Sliding Window ä¸¾ä¾‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990package data_stream.windowimport java.text.SimpleDateFormatimport java.util.&#123;Date, Properties&#125;import com.alibaba.fastjson.&#123;JSON, JSONObject&#125;import org.apache.flink.streaming.api.scala._import org.apache.flink.runtime.state.filesystem.FsStateBackendimport org.apache.flink.streaming.api.CheckpointingModeimport org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment&#125;import org.apache.flink.streaming.api.scala.function.ProcessWindowFunctionimport org.apache.flink.streaming.api.windowing.time.Timeimport org.apache.flink.streaming.api.windowing.windows.TimeWindowimport org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumerBaseimport org.apache.flink.util.Collectorimport utils.KafkaUtilobject window_function_process &#123; case class UserLogData(real_name: String, user_name: String, age: Int, sex: String, phone_number: String, province: String, email: String, ip_address: String, company: String, channel: String, device: String, register_date_time: String, last_login_time: String) private val KAFKA_TOPIC: String = \"user_information\" def main(args: Array[String]) &#123; val properties: Properties = new Properties() properties.setProperty(\"bootstrap.servers\", \"localhost:9092\") properties.setProperty(\"group.id\", \"kafka_consumer\") val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment env.setParallelism(1) // exactly-once è¯­ä¹‰ä¿è¯æ•´ä¸ªåº”ç”¨å†…ç«¯åˆ°ç«¯çš„æ•°æ®ä¸€è‡´æ€§ env.getCheckpointConfig.setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE) // å¼€å¯æ£€æŸ¥ç‚¹å¹¶æŒ‡å®šæ£€æŸ¥ç‚¹æ—¶é—´é—´éš”ä¸º5s env.enableCheckpointing(5000) // checkpoint every 5000 msecs // è®¾ç½®StateBackendï¼Œå¹¶æŒ‡å®šçŠ¶æ€æ•°æ®å­˜å‚¨ä½ç½® env.setStateBackend(new FsStateBackend(\"file:///Users/cpeixin/IdeaProjects/code_warehouse/data/KafkaSource/tumbling\")) val kafkaSource: FlinkKafkaConsumerBase[String] = KafkaUtil.getKafkaSource(KAFKA_TOPIC) //è®¡ç®—çª—å£å†…5ç§’çš„æ•°æ® val original_stream: DataStream[String] = env.addSource(kafkaSource) \"\"\" |original_stream&gt; UserLogData(çºªæ·‘å…°,ehao,37,female,18529008264,è¾½å®çœ,apeng@gmail.com,110.75.179.140,æ˜“åŠ¨åŠ›ç§‘æŠ€æœ‰é™å…¬å¸,app,xiaomi,2017-08-18 12:29:29,2018-09-02 05:05:56) |original_stream&gt; UserLogData(åˆ˜ç‰è‹±,caojing,42,male,15647635274,é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº,houwei@hotmail.com,50.188.173.136,åŒå…´ä¸‡ç‚¹ä¼ åª’æœ‰é™å…¬å¸,web,Firefox,2017-10-27 12:20:20,2018-10-11 09:26:20) |original_stream&gt; UserLogData(è–›è,leizhong,32,male,18928404956,äº‘å—çœ,xxiao@yahoo.com,115.123.146.193,ç½‘æ–°æ’å¤©ä¼ åª’æœ‰é™å…¬å¸,web,360_browser,2017-06-17 16:42:24,2018-09-19 19:36:39) \"\"\".stripMargin /** * è¿™é‡Œæˆ‘ä»¬è®¾å®šä¸€ä¸ªå…·ä½“çš„éœ€æ±‚ï¼Œæ¯5ç§’ç»Ÿè®¡è¿‡å»10ç§’ä¸­ï¼Œç”¨æˆ·æ¸ é“æ¥æºä»¥åŠä½¿ç”¨è®¾å¤‡çš„æ’è¡Œ * è¿™é‡Œæ˜¯ä½¿ç”¨ProcessWindowFunctionåº•å±‚å‡½æ•°æ¥åšå¤„ç† * ä¸ºäº†æ¸…æ¥šçš„æ˜¾ç¤ºï¼Œåœ¨æ¯ä¸ªçª—å£ä¸Šæ‰“å°äº†æ—¶é—´ã€‚ */ val original_format_stream: DataStream[((String, String), Int)] = original_stream .map(match_data(_: String)) .map((raw: UserLogData) =&gt; ((raw.channel, raw.device), 1)) original_format_stream .keyBy((_: ((String, String), Int))._1) .timeWindow(Time.seconds(10), Time.seconds(5)) .process(new ProcessWindowFunction[((String, String), Int), ((String, String), Long), (String, String), TimeWindow] &#123; override def process(key: (String, String), context: Context, elements: Iterable[((String, String), Int)], out: Collector[((String, String), Long)]): Unit = &#123; val process_time: String = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\").format(new Date) println(s\"=========$process_time=============\") out.collect((key, elements.size)) &#125; &#125;).print(\"processFunctionWindow\") env.execute(\"process function stream\") &#125; def match_data(original_str: String): UserLogData = &#123; val original_json: JSONObject = JSON.parseObject(original_str) UserLogData(original_json.getString(\"real_name\"), original_json.getString(\"user_name\"), original_json.getInteger(\"age\"), original_json.getString(\"sex\"), original_json.getString(\"phone_number\"), original_json.getString(\"province\"), original_json.getString(\"email\"), original_json.getString(\"ip_address\"), original_json.getString(\"company\"), original_json.getString(\"channel\"), original_json.getString(\"device\"), original_json.getString(\"register_date_time\"), original_json.getString(\"last_login_time\")) &#125;&#125;ç»“æœæ‰“å°12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182=========2018-05-17 19:29:15=============processFunctionWindow&gt; ((web,QQ_browser),76)=========2018-05-17 19:29:15=============processFunctionWindow&gt; ((pc,Mac),217)=========2018-05-17 19:29:15=============processFunctionWindow&gt; ((app,oppo),50)=========2018-05-17 19:29:15=============processFunctionWindow&gt; ((app,Samsung),58)=========2018-05-17 19:29:15=============processFunctionWindow&gt; ((app,huawei),54)=========2018-05-17 19:29:15=============processFunctionWindow&gt; ((web,UC_browser),54)=========2018-05-17 19:29:15=============processFunctionWindow&gt; ((web,Firefox),63)=========2018-05-17 19:29:15=============processFunctionWindow&gt; ((web,360_browser),66)=========2018-05-17 19:29:15=============processFunctionWindow&gt; ((app,meizu),56)=========2018-05-17 19:29:15=============processFunctionWindow&gt; ((app,xiaomi),53)=========2018-05-17 19:29:15=============processFunctionWindow&gt; ((app,vivo),49)=========2018-05-17 19:29:15=============processFunctionWindow&gt; ((app,iphone),61)=========2018-05-17 19:29:15=============processFunctionWindow&gt; ((web,Chrome),57)=========2018-05-17 19:29:15=============processFunctionWindow&gt; ((pc,Windows),230)=========2018-05-17 19:29:15=============processFunctionWindow&gt; ((web,Opera),73)=========2018-05-17 19:29:15=============processFunctionWindow&gt; ((app,1+),50)=========2018-05-17 19:29:20=============processFunctionWindow&gt; ((web,UC_browser),55)=========2018-05-17 19:29:20=============processFunctionWindow&gt; ((web,Chrome),60)=========2018-05-17 19:29:20=============processFunctionWindow&gt; ((app,1+),50)=========2018-05-17 19:29:20=============processFunctionWindow&gt; ((app,huawei),54)=========2018-05-17 19:29:20=============processFunctionWindow&gt; ((web,QQ_browser),76)=========2018-05-17 19:29:20=============processFunctionWindow&gt; ((app,Samsung),58)=========2018-05-17 19:29:20=============processFunctionWindow&gt; ((pc,Windows),231)=========2018-05-17 19:29:20=============processFunctionWindow&gt; ((app,oppo),51)=========2018-05-17 19:29:20=============processFunctionWindow&gt; ((web,Opera),74)=========2018-05-17 19:29:20=============processFunctionWindow&gt; ((web,Firefox),64)=========2018-05-17 19:29:20=============processFunctionWindow&gt; ((app,vivo),49)=========2018-05-17 19:29:20=============processFunctionWindow&gt; ((app,xiaomi),53)=========2018-05-17 19:29:20=============processFunctionWindow&gt; ((app,meizu),57)=========2018-05-17 19:29:20=============processFunctionWindow&gt; ((pc,Mac),218)=========2018-05-17 19:29:20=============processFunctionWindow&gt; ((app,iphone),61)=========2018-05-17 19:29:20=============processFunctionWindow&gt; ((web,360_browser),66)=========2018-05-17 19:29:25=============processFunctionWindow&gt; ((web,Opera),3)=========2018-05-17 19:29:25=============processFunctionWindow&gt; ((web,Chrome),3)=========2018-05-17 19:29:25=============processFunctionWindow&gt; ((app,meizu),1)=========2018-05-17 19:29:25=============processFunctionWindow&gt; ((web,Firefox),5)=========2018-05-17 19:29:25=============processFunctionWindow&gt; ((pc,Mac),2)=========2018-05-17 19:29:25=============processFunctionWindow&gt; ((app,oppo),1)=========2018-05-17 19:29:25=============processFunctionWindow&gt; ((pc,Windows),1)=========2018-05-17 19:29:25=============processFunctionWindow&gt; ((web,UC_browser),3)=========2018-05-17 19:29:25=============processFunctionWindow&gt; ((app,huawei),1)","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Flink æ•°æ®è¾“å‡º Sink","slug":"Flink-æ•°æ®è¾“å‡º-Sink","date":"2018-05-09T18:07:42.000Z","updated":"2020-05-22T15:23:46.924Z","comments":true,"path":"2018/05/10/Flink-æ•°æ®è¾“å‡º-Sink/","link":"","permalink":"cpeixin.cn/2018/05/10/Flink-%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA-Sink/","excerpt":"","text":"åœ¨Flinkä¸­ï¼Œä¸»è¦åˆ†ä¸ºsourceï¼Œtransformï¼Œsinkä¸‰ä¸ªéƒ¨åˆ†ï¼Œå‰é¢æˆ‘ä»¬ä½¿ç”¨Flinkåˆ©ç”¨å°è£…å¥½çš„æ–¹æ³•å¯¹æ¥Kafkaï¼Œå°±æ˜¯å±äºsourceéƒ¨åˆ†ï¼Œé‚£ä¹ˆåœ¨sinké˜¶æ®µä¹Ÿæ˜¯ä¸€æ ·ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡å®šä¹‰å¥½çš„sinkæ–¹æ³•ï¼Œå°†æ•°æ®è½åœ°åˆ°æˆ‘ä»¬æƒ³å­˜å‚¨çš„åœ°æ–¹ï¼Œè¿™é‡Œè™½çœ‹çœ‹èµ·æ¥æ²¡æœ‰Sparké‚£ä¹ˆçµæ´»ï¼Œè¦ä¹ˆforeachRDDï¼ŒforeachPartitionéå†è¾“å‡ºï¼Œæˆ–è€…æ˜¯ç¬¬ä¸‰æ–¹ç»„ä»¶æ–¹æ³•è¿›è¡Œè¾“å‡ºï¼Œä½†æ˜¯Flinkè¿™æ ·è®¾è®¡æ›´æœ‰åˆ©äºå·¥ç¨‹å¸ˆé™ä½ä»£ç å¤æ‚åº¦ï¼Œæ›´å¤šç²¾åŠ›å»å…³å¿ƒä¸šåŠ¡å¼€å‘å°±å¯ä»¥ã€‚ä¸€äº›æ¯”è¾ƒåŸºæœ¬çš„ Sink å·²ç»å†…ç½®åœ¨ Flink é‡Œã€‚æ•°æ®æ¥æ”¶å™¨ä½¿ç”¨DataStreamï¼Œå¹¶å°†å…¶è½¬å‘åˆ°æ–‡ä»¶ï¼Œå¥—æ¥å­—ï¼Œå¤–éƒ¨ç³»ç»Ÿæˆ–æ‰“å°å®ƒä»¬ã€‚Flinkå¸¦æœ‰å„ç§å†…ç½®çš„è¾“å‡ºæ ¼å¼ï¼Œè¿™äº›æ ¼å¼å°è£…åœ¨DataStreamçš„æ“ä½œåé¢ï¼šwriteAsText()/ TextOutputFormat-å°†å…ƒç´ æŒ‰è¡Œå†™ä¸ºå­—ç¬¦ä¸²ã€‚é€šè¿‡è°ƒç”¨æ¯ä¸ªå…ƒç´ çš„toStringï¼ˆï¼‰æ–¹æ³•è·å¾—å­—ç¬¦ä¸²ã€‚writeAsCsv(â€¦)/ CsvOutputFormat-å°†å…ƒç»„å†™ä¸ºé€—å·åˆ†éš”çš„å€¼æ–‡ä»¶ã€‚è¡Œå’Œå­—æ®µå®šç•Œç¬¦æ˜¯å¯é…ç½®çš„ã€‚æ¯ä¸ªå­—æ®µçš„å€¼æ¥è‡ªå¯¹è±¡çš„toStringï¼ˆï¼‰æ–¹æ³•ã€‚print()/ printToErr() - åœ¨æ ‡å‡†è¾“å‡º/æ ‡å‡†é”™è¯¯æµä¸Šæ‰“å°æ¯ä¸ªå…ƒç´ çš„toStringï¼ˆï¼‰å€¼ã€‚å¯é€‰åœ°ï¼Œå¯ä»¥æä¾›å‰ç¼€ï¼ˆmsgï¼‰ï¼Œè¯¥å‰ç¼€åœ¨è¾“å‡ºä¹‹å‰ã€‚è¿™å¯ä»¥å¸®åŠ©åŒºåˆ†ä¸åŒçš„æ‰“å°è°ƒç”¨ã€‚å¦‚æœå¹¶è¡Œåº¦å¤§äº1ï¼Œåˆ™è¾“å‡ºä¹‹å‰è¿˜å°†å¸¦æœ‰äº§ç”Ÿè¾“å‡ºçš„ä»»åŠ¡çš„æ ‡è¯†ç¬¦ã€‚writeUsingOutputFormat()/ FileOutputFormat-è‡ªå®šä¹‰æ–‡ä»¶è¾“å‡ºçš„æ–¹æ³•å’ŒåŸºç±»ã€‚æ”¯æŒè‡ªå®šä¹‰å¯¹è±¡åˆ°å­—èŠ‚çš„è½¬æ¢ã€‚writeToSocket -æ ¹æ®ä»¥ä¸‹å†…å®¹å°†å…ƒç´ å†™å…¥å¥—æ¥å­— SerializationSchemaaddSink-è°ƒç”¨è‡ªå®šä¹‰æ¥æ”¶å™¨åŠŸèƒ½ã€‚Flinkæ†ç»‘æœ‰è¿æ¥åˆ°å…¶ä»–ç³»ç»Ÿï¼ˆä¾‹å¦‚Apache Kafkaï¼‰çš„è¿æ¥å™¨ï¼Œè¿™äº›è¿æ¥å™¨å®ç°ä¸ºæ¥æ”¶å™¨åŠŸèƒ½ã€‚è¯·æ³¨æ„ï¼Œä¸Šçš„write*()æ–¹æ³•DataStreamä¸»è¦ç”¨äºè°ƒè¯•ç›®çš„ã€‚å®ƒä»¬ä¸å‚ä¸Flinkçš„æ£€æŸ¥ç‚¹ï¼Œè¿™æ„å‘³ç€è¿™äº›åŠŸèƒ½é€šå¸¸å…·æœ‰è‡³å°‘ä¸€æ¬¡çš„è¯­ä¹‰ã€‚åˆ·æ–°åˆ°ç›®æ ‡ç³»ç»Ÿçš„æ•°æ®å–å†³äºOutputFormatçš„å®ç°ã€‚è¿™æ„å‘³ç€å¹¶éæ‰€æœ‰å‘é€åˆ°OutputFormatçš„å…ƒç´ éƒ½ç«‹å³æ˜¾ç¤ºåœ¨ç›®æ ‡ç³»ç»Ÿä¸­ã€‚åŒæ ·ï¼Œåœ¨å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œè¿™äº›è®°å½•å¯èƒ½ä¼šä¸¢å¤±ã€‚ä¸ºäº†å°†æµå¯é ï¼Œå‡†ç¡®åœ°ä¸€æ¬¡ä¼ è¾“åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè¯·ä½¿ç”¨flink-connector-filesystemã€‚åŒæ ·ï¼Œé€šè¿‡è¯¥.addSink(â€¦)æ–¹æ³•çš„è‡ªå®šä¹‰å®ç°å¯ä»¥å‚ä¸Flinkä¸€æ¬¡ç²¾ç¡®è¯­ä¹‰çš„æ£€æŸ¥ç‚¹ã€‚SinkåŸç†SinkFunction æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç±»ä¼¼äºSourceFunctionæ¥å£ã€‚SinkFunctionä¸­ä¸»è¦åŒ…å«ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£å°±æ˜¯ç”¨äºæ•°æ®è¾“å‡ºçš„invoke æ–¹æ³•,æ¯æ¡è®°å½•éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡invokeæ–¹æ³•ï¼Œç”¨äºæ‰§è¡Œè¾“å‡ºæ“ä½œã€‚123456789101112131415// Writes the given value to the sink. This function is called for every record.default void invoke(IN value) throws Exception default void invoke(IN value, Context context) throws Exception // Contextæ¥å£ä¸­è¿”å›å…³äºæ—¶é—´çš„ä¿¡æ¯interface Context&lt;T&gt; &#123; /** Returns the current processing time. */ long currentProcessingTime(); /** Returns the current event-time watermark. */ long currentWatermark(); /** * Returns the timestamp of the current input record or &#123;@code null&#125; if the element does not * have an assigned timestamp. */ Long timestamp(); &#125;æˆ‘ä»¬ä¸€èˆ¬è‡ªå®šä¹‰Sinkçš„æ—¶å€™ï¼Œéƒ½æ˜¯ç»§æ‰¿AbstractRichFunctionï¼Œä»–æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ç°äº†RichFunctionæ¥å£ã€‚1public abstract class AbstractRichFunction implements RichFunction, Serializableå¹¶ä¸”æä¾›äº†å…³äºRuntimContextçš„æ“ä½œå’Œopenï¼Œcloneæ–¹æ³•ã€‚AbstractRichFunction æœ‰å¾ˆå¤šå®ç°ç±»ï¼Œæ¯”å¦‚å…³äºmsyqlæ“ä½œçš„JDBCSinkFunctionï¼Œæ¯”å¦‚ç›´æ¥è¾“å‡ºç»“æœçš„ PrintSinkFunctionï¼Œåœ¨æˆ‘ä»¬å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿›ç¨‹ç”¨printè¯­å¥æ¥æ‰“å°ç»“æœï¼Œä½†æ˜¯printå‡½æ•°ä¸­å°±æ˜¯è®²PrintSinkFunctionç±»ä¼ é€’åˆ°addSinkæ–¹æ³•ä¸­ã€‚1234public DataStreamSink&lt;T&gt; print() &#123; PrintSinkFunction&lt;T&gt; printFunction = new PrintSinkFunction&lt;&gt;(); return addSink(printFunction).name(\"Print to Std. Out\");&#125;PrintSinkFunctionæˆ‘ä»¬è¿™é‡Œåˆ†æä¸€ä¸‹PrintSinkFunctionè¿™ä¸ªç±»ï¼Œè¿™ä¸ªç±»å°±æ˜¯å°†æ²¡ä¸ªå…ƒç´ è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºæˆ–è€…æ˜¯æ ‡å‡†é”™è¯¯è¾“å‡ºæµä¸­ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041public class PrintSinkFunction&lt;IN&gt; extends RichSinkFunction&lt;IN&gt; &#123; private static final long serialVersionUID = 1L; private final PrintSinkOutputWriter&lt;IN&gt; writer; /** * Instantiates a print sink function that prints to standard out. */ public PrintSinkFunction() &#123; writer = new PrintSinkOutputWriter&lt;&gt;(false); &#125; /** * Instantiates a print sink function that prints to standard out. * * @param stdErr True, if the format should print to standard error instead of standard out. */ public PrintSinkFunction(final boolean stdErr) &#123; writer = new PrintSinkOutputWriter&lt;&gt;(stdErr); &#125; /** * Instantiates a print sink function that prints to standard out and gives a sink identifier. * * @param stdErr True, if the format should print to standard error instead of standard out. * @param sinkIdentifier Message that identify sink and is prefixed to the output of the value */ public PrintSinkFunction(final String sinkIdentifier, final boolean stdErr) &#123; writer = new PrintSinkOutputWriter&lt;&gt;(sinkIdentifier, stdErr); &#125; @Override public void open(Configuration parameters) throws Exception &#123; super.open(parameters); StreamingRuntimeContext context = (StreamingRuntimeContext) getRuntimeContext(); writer.open(context.getIndexOfThisSubtask(), context.getNumberOfParallelSubtasks()); &#125; @Override public void invoke(IN record) &#123; writer.write(record); &#125; @Override public String toString() &#123; return writer.toString(); &#125;&#125;åˆ†æï¼š1ã€è°ƒç”¨æ„é€ å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªPrintSinkOutputWriter2ã€è°ƒç”¨openæ–¹æ³•ä¸­åœ¨è°ƒç”¨PrintSinkOutputWriter çš„openæ–¹æ³•ï¼Œè¿›è¡Œåˆå§‹åŒ–3ã€è°ƒç”¨invokeæ–¹æ³•ï¼Œé€šè¿‡PrintSinkOutputWriter çš„writeræ–¹æ³•å§recordè¾“å‡ºç¬¬ä¸‰æ–¹Sinkä¸‹é¢æˆ‘ä»¬å°†ä½¿ç”¨ Elasticsearch Connector ä½œä¸ºSink ä¸ºä¾‹ç¤ºèŒƒSinkçš„ä½¿ç”¨ã€‚Elasticsearch Connector æä¾›äº† *at least once *è¯­ä¹‰æ”¯æŒï¼Œat lease once æ”¯æŒéœ€è¦ç”¨åˆ°Flinkçš„checkpoint æœºåˆ¶ã€‚è¦ä½¿ç”¨Elasticsearch Connector éœ€è¦æ ¹æ®Elasticsearch ç‰ˆæœ¬æ·»åŠ ä¾èµ–ï¼Œç‰ˆæœ¬å‚è€ƒ12345&lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-elasticsearch6_2.11&lt;/artifactId&gt; &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;&lt;/dependency&gt;ESç‰ˆæœ¬6.7ï¼Œ å†™å…¥ç¤ºä¾‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102package data_streamimport java.net.&#123;InetAddress, InetSocketAddress&#125;import java.utilimport java.util.Propertiesimport com.alibaba.fastjson.&#123;JSON, JSONObject&#125;import org.apache.flink.api.common.functions.RuntimeContextimport org.apache.flink.runtime.state.filesystem.FsStateBackendimport org.apache.flink.streaming.api.CheckpointingModeimport org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment, _&#125;import org.apache.flink.streaming.connectors.elasticsearch.util.IgnoringFailureHandlerimport org.apache.flink.streaming.connectors.elasticsearch.&#123;ActionRequestFailureHandler, ElasticsearchSinkFunction, RequestIndexer&#125;import org.apache.flink.streaming.connectors.elasticsearch6.ElasticsearchSinkimport org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumerBaseimport org.apache.flink.util.ExceptionUtilsimport org.apache.http.HttpHostimport org.elasticsearch.ElasticsearchParseExceptionimport org.elasticsearch.action.ActionRequestimport org.elasticsearch.action.index.IndexRequestimport org.elasticsearch.client.Requestsimport org.elasticsearch.common.util.concurrent.EsRejectedExecutionExceptionimport utils.KafkaUtilobject datastream_2_es_HandFail &#123; case class Raw(date_time: String, keywordList: String) private val KAFKA_TOPIC: String = \"weibo_keyword\" def main(args: Array[String]) &#123; val properties: Properties = new Properties() properties.setProperty(\"bootstrap.servers\", \"localhost:9092\") properties.setProperty(\"group.id\", \"kafka_consumer\") val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment // exactly-once è¯­ä¹‰ä¿è¯æ•´ä¸ªåº”ç”¨å†…ç«¯åˆ°ç«¯çš„æ•°æ®ä¸€è‡´æ€§ env.getCheckpointConfig.setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE) // å¼€å¯æ£€æŸ¥ç‚¹å¹¶æŒ‡å®šæ£€æŸ¥ç‚¹æ—¶é—´é—´éš”ä¸º5s env.enableCheckpointing(5000) // checkpoint every 5000 msecs // è®¾ç½®StateBackendï¼Œå¹¶æŒ‡å®šçŠ¶æ€æ•°æ®å­˜å‚¨ä½ç½® env.setStateBackend(new FsStateBackend(\"file:///Users/cpeixin/IdeaProjects/code_warehouse/data/KafkaSource\")) val topic: String = \"weibo_keyword\" val kafkaSource: FlinkKafkaConsumerBase[String] = KafkaUtil.getKafkaSource(topic) val word_stream: DataStream[Raw] = env.addSource(kafkaSource) .map((x: String) =&gt; &#123; val date_time: String = get_value(x)._1 val keywordList: String = get_value(x)._2 Raw(date_time, keywordList) &#125;) val httpHosts = new java.util.ArrayList[HttpHost] httpHosts.add(new HttpHost(\"127.0.0.1\", 9200, \"http\")) val esSinkBuilder = new ElasticsearchSink.Builder[Raw] ( httpHosts, new ElasticsearchSinkFunction[Raw] &#123; override def process(data: Raw, runtimeContext: RuntimeContext, requestIndexer: RequestIndexer): Unit = &#123; print(\"saving data\" + data) //åŒ…è£…æˆä¸€ä¸ªMapæˆ–è€…JsonObject val hashMap = new util.HashMap[String, String]() hashMap.put(\"date_time\", data.date_time) hashMap.put(\"keyword_list\", data.keywordList) hashMap.put(\"rowkey\", \"i am rowkey haha\") //åˆ›å»ºindex request,å‡†å¤‡å‘é€æ•°æ® val indexRequest: IndexRequest = Requests.indexRequest().index(\"weibo_keyword-2018-04-30\").`type`(\"default\").source(hashMap) //å‘é€è¯·æ±‚,å†™å…¥æ•°æ® requestIndexer.add(indexRequest) println(\"data saved successfully\") &#125; &#125; ) esSinkBuilder.setBulkFlushMaxActions(2) esSinkBuilder.setBulkFlushInterval(1000L) // è‡ªå®šä¹‰å¼‚å¸¸å¤„ç† esSinkBuilder.setFailureHandler(new ActionRequestFailureHandler &#123; override def onFailure(actionRequest: ActionRequest, throwable: Throwable, i: Int, requestIndexer: RequestIndexer): Unit = &#123; println(\"@@@@@@@On failure from ElasticsearchSink:--&gt;\" + throwable.getMessage) &#125; &#125;) word_stream.addSink(esSinkBuilder.build()) env.execute(\"Flink Streamingâ€”â€”â€”â€”â€”es sink\") &#125; def get_value(string_data: String): (String, String) = &#123; val json_data: JSONObject = JSON.parseObject(string_data) val date_time: String = json_data.get(\"datetime\").toString val keywordList: String = json_data.get(\"keywordList\").toString (date_time, keywordList) &#125;&#125;è‡ªå®šä¹‰Sinkmysqlåœ¨å‘MySQLä¸­å†™æ•°æ®çš„æ—¶å€™ï¼Œåƒä¸‡ä¸è¦å¿˜è®°å¼•å…¥é©±åŠ¨ä¾èµ–ï¼š12345&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;8.0.15&lt;/version&gt;&lt;/dependency&gt;ç¤ºä¾‹ä»£ç ï¼šè‡ªå®šä¹‰Sink123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354import java.sql.&#123;Connection, DriverManager, PreparedStatement, SQLException&#125;import data_stream.datastream_2_mysql.Rawimport org.apache.flink.configuration.Configurationimport org.apache.flink.streaming.api.functions.sink.&#123;RichSinkFunction, SinkFunction&#125;import org.slf4j.&#123;Logger, LoggerFactory&#125;class MysqlSink_v2 extends RichSinkFunction[Raw] &#123; val logger: Logger = LoggerFactory.getLogger(\"MysqlSink\") var conn: Connection = _ var ps: PreparedStatement = _ val jdbcUrl = \"jdbc:mysql://localhost:3306?useSSL=false&amp;allowPublicKeyRetrieval=true\" val username = \"root\" val password = \"password\" val driverName = \"com.mysql.jdbc.Driver\" override def open(parameters: Configuration): Unit = &#123; Class.forName(driverName) try &#123; Class.forName(driverName) conn = DriverManager.getConnection(jdbcUrl, username, password) // close auto commit conn.setAutoCommit(false) &#125; catch &#123; case e@(_: ClassNotFoundException | _: SQLException) =&gt; logger.error(\"init mysql error\") e.printStackTrace() System.exit(-1); &#125; &#125; /** * ååé‡ä¸å¤Ÿè¯ï¼Œå¯ä»¥å°†æ•°æ®æš‚å­˜åœ¨çŠ¶æ€ä¸­ï¼Œæ‰¹é‡æäº¤çš„æ–¹å¼æé«˜ååé‡ï¼ˆå¦‚æœoomï¼Œå¯èƒ½å°±æ˜¯æ•°æ®é‡å¤ªå¤§ï¼Œèµ„æºæ²¡æœ‰åŠæ—¶é‡Šæ”¾å¯¼è‡´çš„ï¼‰ * @param raw * @param context */ override def invoke(raw: Raw, context: SinkFunction.Context[_]): Unit = &#123; println(\"data : \" + raw.toString) ps = conn.prepareStatement(\"insert into test.t_weibo_keyword(date_time,keywordList) values(?,?)\") ps.setString(1, raw.date_time) ps.setString(2, raw.keywordList) ps.execute() conn.commit() &#125; override def close(): Unit = &#123; if (conn != null)&#123; conn.commit() conn.close() &#125; &#125;&#125;ä¸»ç¨‹åº1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package data_streamimport java.util.Propertiesimport com.alibaba.fastjson.&#123;JSON, JSONObject&#125;import org.apache.flink.runtime.state.filesystem.FsStateBackendimport org.apache.flink.streaming.api.CheckpointingModeimport org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment, _&#125;import org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumerBaseimport utils.KafkaUtilobject datastream_2_mysql &#123; case class Raw(date_time: String, keywordList: String) private val KAFKA_TOPIC: String = \"weibo_keyword\" def main(args: Array[String]) &#123; val properties: Properties = new Properties() properties.setProperty(\"bootstrap.servers\", \"localhost:9092\") properties.setProperty(\"group.id\", \"kafka_consumer\") val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment // exactly-once è¯­ä¹‰ä¿è¯æ•´ä¸ªåº”ç”¨å†…ç«¯åˆ°ç«¯çš„æ•°æ®ä¸€è‡´æ€§ env.getCheckpointConfig.setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE) // å¼€å¯æ£€æŸ¥ç‚¹å¹¶æŒ‡å®šæ£€æŸ¥ç‚¹æ—¶é—´é—´éš”ä¸º5s env.enableCheckpointing(5000) // checkpoint every 5000 msecs // è®¾ç½®StateBackendï¼Œå¹¶æŒ‡å®šçŠ¶æ€æ•°æ®å­˜å‚¨ä½ç½® env.setStateBackend(new FsStateBackend(\"file:///Users/cpeixin/IdeaProjects/code_warehouse/data/KafkaSource\")) val topic: String = \"weibo_keyword\" val kafkaSource: FlinkKafkaConsumerBase[String] = KafkaUtil.getKafkaSource(topic) val word_stream: DataStream[Raw] = env.addSource(kafkaSource) .map((x: String) =&gt; &#123; val date_time: String = get_value(x)._1 val keywordList: String = get_value(x)._2 Raw(date_time, keywordList) &#125;) val sink = new MysqlSink_v2() word_stream.addSink(sink) env.execute(\"Flink Streamingâ€”â€”â€”â€”â€”mysql sink\") &#125; def get_value(string_data: String): (String, String) = &#123; val json_data: JSONObject = JSON.parseObject(string_data) val date_time: String = json_data.get(\"datetime\").toString val keywordList: String = json_data.get(\"keywordList\").toString (date_time, keywordList) &#125;&#125;HBaseè‡ªå®šä¹‰sink1234567891011121314151617181920212223242526272829303132333435363738package data_streamimport data_stream.datastream_2_hbase.Rawimport org.apache.flink.configuration.Configurationimport org.apache.flink.streaming.api.functions.sink.&#123;RichSinkFunction, SinkFunction&#125;import org.apache.hadoop.hbase.&#123;HBaseConfiguration, HConstants, TableName&#125;import org.apache.hadoop.hbase.client._import org.apache.hadoop.hbase.util.Bytesclass HBaseSink_v4(tableName: String, family: String) extends RichSinkFunction[Raw] &#123; var conn: Connection = _ override def open(parameters: Configuration): Unit = &#123; super.open(parameters) val conf = HBaseConfiguration.create() conf.set(HConstants.ZOOKEEPER_QUORUM, \"localhost:2181\") conn = ConnectionFactory.createConnection(conf) &#125; override def invoke(value: Raw, context: SinkFunction.Context[_]): Unit = &#123; println(value) val t: Table = conn.getTable(TableName.valueOf(tableName)) val put: Put = new Put(Bytes.toBytes(value.date_time)) put.addColumn(Bytes.toBytes(family), Bytes.toBytes(\"name\"), Bytes.toBytes(value.date_time.toString)) put.addColumn(Bytes.toBytes(family), Bytes.toBytes(\"id_no\"), Bytes.toBytes(value.keywordList.toString)) t.put(put) t.close() &#125; override def close(): Unit = &#123; super.close() conn.close() &#125;&#125;ä¸»ç¨‹åº12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455package data_streamimport java.util.Propertiesimport com.alibaba.fastjson.&#123;JSON, JSONObject&#125;import org.apache.flink.runtime.state.filesystem.FsStateBackendimport org.apache.flink.streaming.api.CheckpointingModeimport org.apache.flink.streaming.api.datastream.DataStreamSinkimport org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment, _&#125;import org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumerBaseimport utils.KafkaUtilobject datastream_2_hbase &#123; case class Raw(date_time: String, keywordList: String) private val KAFKA_TOPIC: String = \"weibo_keyword\" def main(args: Array[String]) &#123; val properties: Properties = new Properties() properties.setProperty(\"bootstrap.servers\", \"localhost:9092\") properties.setProperty(\"group.id\", \"kafka_consumer_hbase\") val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment env.getCheckpointConfig.setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE) env.enableCheckpointing(5000) env.setStateBackend(new FsStateBackend(\"file:///Users/cpeixin/IdeaProjects/code_warehouse/data/KafkaSource/hbase\")) val topic: String = \"weibo_keyword\" val kafkaSource: FlinkKafkaConsumerBase[String] = KafkaUtil.getKafkaSource(topic).setStartFromLatest() val word_stream: DataStream[Raw] = env.addSource(kafkaSource) .map((x: String) =&gt; &#123; val date_time: String = get_value(x)._1 val keywordList: String = get_value(x)._2 Raw(date_time, keywordList) &#125;) val value: DataStreamSink[Raw] = word_stream.addSink(new HBaseSink_v4(\"t_weibo_keyword_2\",\"cf1\")).name(\"write_2_hbase\") env.execute(\"Flink Streamingâ€”â€”â€”â€”â€”hbase sink\") &#125; def get_value(string_data: String): (String, String) = &#123; val json_data: JSONObject = JSON.parseObject(string_data) val date_time: String = json_data.get(\"datetime\").toString val keywordList: String = json_data.get(\"keywordList\").toString (date_time, keywordList) &#125;&#125;Redis12345&lt;dependency&gt; &lt;groupId&gt;org.apache.bahir&lt;/groupId&gt; &lt;artifactId&gt;flink-connector-redis_2.11&lt;/artifactId&gt; &lt;version&gt;1.0&lt;/version&gt;&lt;/dependency&gt;åˆ›å»ºSinkå·¥å…·ç±»123456789101112131415161718192021222324package utilsimport data_stream.datastream_2_redis.Rawimport org.apache.flink.streaming.connectors.redis.RedisSinkimport org.apache.flink.streaming.connectors.redis.common.config.FlinkJedisPoolConfigimport org.apache.flink.streaming.connectors.redis.common.mapper.&#123;RedisCommand, RedisCommandDescription, RedisMapper&#125;object RedisUtil &#123; private val config: FlinkJedisPoolConfig = new FlinkJedisPoolConfig.Builder().setHost(\"127.0.0.1\").setPort(6379).build() def getRedisSink(): RedisSink[Raw] = &#123; new RedisSink[Raw](config, new MyRedisMapper) &#125; class MyRedisMapper extends RedisMapper[Raw] &#123; override def getCommandDescription: RedisCommandDescription = &#123; new RedisCommandDescription(RedisCommand.HSET, \"weibo_keyword\") &#125; // value override def getValueFromData(t: Raw): String = t.keywordList //key override def getKeyFromData(t: Raw): String = t.date_time &#125;&#125;ä¸»ç¨‹åº1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859package data_streamimport java.util.Propertiesimport com.alibaba.fastjson.&#123;JSON, JSONObject&#125;import org.apache.flink.runtime.state.filesystem.FsStateBackendimport org.apache.flink.streaming.api.CheckpointingModeimport org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment, _&#125;import org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumerBaseimport org.apache.flink.streaming.connectors.redis.RedisSinkimport utils.&#123;KafkaUtil, RedisUtil&#125;object datastream_2_redis &#123; case class Raw(date_time: String, keywordList: String) private val KAFKA_TOPIC: String = \"weibo_keyword\" def main(args: Array[String]) &#123; val properties: Properties = new Properties() properties.setProperty(\"bootstrap.servers\", \"localhost:9092\") properties.setProperty(\"group.id\", \"kafka_consumer\") val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment // exactly-once è¯­ä¹‰ä¿è¯æ•´ä¸ªåº”ç”¨å†…ç«¯åˆ°ç«¯çš„æ•°æ®ä¸€è‡´æ€§ env.getCheckpointConfig.setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE) // å¼€å¯æ£€æŸ¥ç‚¹å¹¶æŒ‡å®šæ£€æŸ¥ç‚¹æ—¶é—´é—´éš”ä¸º5s env.enableCheckpointing(5000) // checkpoint every 5000 msecs // è®¾ç½®StateBackendï¼Œå¹¶æŒ‡å®šçŠ¶æ€æ•°æ®å­˜å‚¨ä½ç½® env.setStateBackend(new FsStateBackend(\"file:///Users/cpeixin/IdeaProjects/code_warehouse/data/KafkaSource\")) val topic: String = \"weibo_keyword\" val kafkaSource: FlinkKafkaConsumerBase[String] = KafkaUtil.getKafkaSource(topic) val word_stream: DataStream[Raw] = env.addSource(kafkaSource) .map((x: String) =&gt; &#123; val date_time: String = get_value(x)._1 val keywordList: String = get_value(x)._2 Raw(date_time, keywordList) &#125;) word_stream.print(\"2_redis\").setParallelism(1) val redis_sink: RedisSink[Raw] = RedisUtil.getRedisSink() word_stream.addSink(redis_sink).name(\"write_2_redis\") env.execute(\"Flink Streamingâ€”â€”â€”â€”â€”redis sink\") &#125; def get_value(string_data: String): (String, String) = &#123; val json_data: JSONObject = JSON.parseObject(string_data) val date_time: String = json_data.get(\"datetime\").toString val keywordList: String = json_data.get(\"keywordList\").toString (date_time, keywordList) &#125;&#125;","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Mac å®‰è£… redis","slug":"Mac-å®‰è£…-redis","date":"2018-04-30T13:53:24.000Z","updated":"2020-05-22T15:22:30.207Z","comments":true,"path":"2018/04/30/Mac-å®‰è£…-redis/","link":"","permalink":"cpeixin.cn/2018/04/30/Mac-%E5%AE%89%E8%A3%85-redis/","excerpt":"","text":"Rediså®‰è£…ä¸‹è½½è½¯ä»¶åŒ…è®¿é—® https://redis.io/download ä¸‹è½½ Stable ç‰ˆæœ¬æˆ–è€…1wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-6.0.3.tar.gzè§£å‹è½¯ä»¶åŒ…1tar -zxvf redis-6.0.3.tar.gzç§»åŠ¨åˆ°æŒ‡å®šç›®å½•1sudo mv redis-6.0.3 &#x2F;usr&#x2F;local&#x2F;ç¼–è¯‘redis1sudo makeç¼–è¯‘test1sudo make testå®‰è£…1sudo make installè¿è¡Œ1redis-serveré…ç½®åå°å¯åŠ¨æ‰¾åˆ°redis.conf å¹¶ä¿®æ”¹ daemonize no ä¸º daemonize yes ï¼Œè¿™æ ·å°±å¯ä»¥é»˜è®¤å¯åŠ¨å°±åå°è¿è¡Œ1redis-server &#x2F;usr&#x2F;local&#x2F;redis-6.0.3&#x2F;redis.confRedis Desktop Managerå®‰è£…ä¸‹è½½ Redis Desktop Managerå¯ä»¥å»å®˜ç½‘ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥å»RedisDesktopManagerä¸‹è½½å…è´¹taråŒ…è‡ªå·±ç¼–è¯‘ï¼Œè€Œæˆ‘é€‰æ‹©äº†ç™¾åº¦ç½‘ç›˜ä¸‹è½½ğŸ˜„https://pan.baidu.com/s/1tpnvkE9R63U9VVMfw5xodQæå–ç ï¼šzd7y","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"redis","slug":"redis","permalink":"cpeixin.cn/tags/redis/"}]},{"title":"Flink åˆå¹¶æµ connect & union","slug":"Flink-åˆå¹¶æµ-connect-union","date":"2018-04-25T13:30:11.000Z","updated":"2020-05-17T05:17:59.071Z","comments":true,"path":"2018/04/25/Flink-åˆå¹¶æµ-connect-union/","link":"","permalink":"cpeixin.cn/2018/04/25/Flink-%E5%90%88%E5%B9%B6%E6%B5%81-connect-union/","excerpt":"","text":"Flink åˆå¹¶æµ connect &amp; union* connect &amp; union(åˆå¹¶æµ)**connectä¹‹åç”ŸæˆConnectedStreamsï¼Œä¼šå¯¹ä¸¤ä¸ªæµçš„æ•°æ®åº”ç”¨ä¸åŒçš„å¤„ç†æ–¹æ³•ï¼Œå¹¶ä¸”åŒæµ ä¹‹é—´å¯ä»¥å…±äº«çŠ¶æ€(æ¯”å¦‚è®¡æ•°)ã€‚è¿™åœ¨ç¬¬ä¸€ä¸ªæµçš„è¾“å…¥ä¼šå½±å“ç¬¬äºŒä¸ªæµæ—¶, ä¼šéå¸¸æœ‰ç”¨;union åˆå¹¶å¤šä¸ªæµï¼Œæ–°çš„æµåŒ…å«æ‰€æœ‰æµçš„æ•°æ®ã€‚unionæ˜¯DataStream â†’ DataStreamã€‚connectæ˜¯DataStream* â†’ ConnectedStreamsã€‚connectåªèƒ½è¿æ¥ä¸¤ä¸ªæµï¼Œè€Œunionå¯ä»¥è¿æ¥å¤šäºä¸¤ä¸ªæµ ã€‚connectè¿æ¥çš„ä¸¤ä¸ªæµç±»å‹å¯ä»¥ä¸ä¸€è‡´ï¼Œä½†æ˜¯åˆå¹¶æ•°æ®çš„æ•°æ®ç±»å‹è¦ä¸€è‡´ï¼Œè€Œunionè¿æ¥çš„æµçš„ç±»å‹å¿…é¡»ä¸€è‡´ã€‚connectç®—å­åé¢è·Ÿçš„map å’Œ flatMapå’Œæ™®é€šçš„map, flatmapç±»ä¼¼ï¼Œåªä¸è¿‡ä½œç”¨åœ¨ConnectedStreamsä¸Šä¼šæ”¹å˜æµçš„ç±»å‹ï¼Œç”±ConnectedStreams â†’ DataStreamä¸‹é¢çš„å®ä¾‹ï¼Œæ˜¯ä»¥sideoutputé‚£ç¯‡æ–‡ç« çš„åŸºç¡€ä¸Šï¼Œå¯¹ä¸»æ•°æ®æµå’Œä¾§å‡ºæµè¿›è¡Œconnectï¼Œä»£ç ä¸­ä¹Ÿç»™å‡ºäº†unionåˆå¹¶æµæ–¹æ³•ï¼Œuninoæ–¹æ³•ä½¿ç”¨èµ·æ¥åˆ™å¾ˆç®€å•ï¼Œå¹¶ä¸”å’Œspark streamingä¸­unionçš„ç”¨æ³•æ˜¯ä¸€æ ·çš„1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586package data_streamimport java.util.Propertiesimport com.alibaba.fastjson.&#123;JSON, JSONObject&#125;import org.apache.flink.runtime.state.filesystem.FsStateBackendimport org.apache.flink.streaming.api.CheckpointingModeimport org.apache.flink.streaming.api.datastream.DataStreamSinkimport org.apache.flink.streaming.api.functions.ProcessFunctionimport org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment, _&#125;import org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumerBaseimport org.apache.flink.util.Collectorimport utils.KafkaUtilobject connect_datastream &#123; case class Raw(date_time: String, keywordList: String) private val KAFKA_TOPIC: String = \"weibo_keyword\" def main(args: Array[String]) &#123; val properties: Properties = new Properties() properties.setProperty(\"bootstrap.servers\", \"localhost:9092\") properties.setProperty(\"group.id\", \"kafka_consumer\") val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment // exactly-once è¯­ä¹‰ä¿è¯æ•´ä¸ªåº”ç”¨å†…ç«¯åˆ°ç«¯çš„æ•°æ®ä¸€è‡´æ€§ env.getCheckpointConfig.setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE) // å¼€å¯æ£€æŸ¥ç‚¹å¹¶æŒ‡å®šæ£€æŸ¥ç‚¹æ—¶é—´é—´éš”ä¸º5s env.enableCheckpointing(5000) // checkpoint every 5000 msecs // è®¾ç½®StateBackendï¼Œå¹¶æŒ‡å®šçŠ¶æ€æ•°æ®å­˜å‚¨ä½ç½® env.setStateBackend(new FsStateBackend(\"file:///Users/cpeixin/IdeaProjects/code_warehouse/data/KafkaSource\")) val topic: String = \"weibo_keyword\" val kafkaSource: FlinkKafkaConsumerBase[String] = KafkaUtil.getKafkaSource(topic) val word_stream: DataStream[Raw] = env.addSource(kafkaSource) .map((x: String) =&gt; &#123; val date_time: String = get_value(x)._1 val keywordList: String = get_value(x)._2 Raw(date_time, keywordList) &#125;) val processStream: DataStream[Raw] = word_stream.process(new SideOutput()) val dirty_stream: DataStream[Raw] = processStream.getSideOutput(new OutputTag[Raw](\"dirty_data\"))// val connect_datastream: DataStream[String] = processStream.connect(dirty_stream)// .map(// (originalRaw: Raw) =&gt; originalRaw.keywordList,// (dirtyRaw: Raw) =&gt; dirtyRaw.keywordList// )//// connect_datastream.print(\"ALL \") val union_datastream: DataStream[Raw] = processStream.union(dirty_stream) union_datastream.print(\"union_datastream \") env.execute(\"connect stream test\") &#125; def get_value(string_data: String): (String, String) = &#123; val json_data: JSONObject = JSON.parseObject(string_data) val date_time: String = json_data.get(\"datetime\").toString val keywordList: String = json_data.get(\"keywordList\").toString (date_time, keywordList) &#125; class SideOutput() extends ProcessFunction[Raw, Raw] &#123; //å®šä¹‰ä¸€ä¸ªä¾§è¾“å‡ºæµæ ‡ç­¾ lazy val dirty_data: OutputTag[Raw] = new OutputTag[Raw](\"dirty_data\") override def processElement(value: Raw, ctx: ProcessFunction[Raw, Raw]#Context, out: Collector[Raw]): Unit = &#123; if (value.keywordList == \"dirty_data\") &#123; ctx.output(dirty_data, value) &#125; else &#123; out.collect(value) &#125; &#125; &#125;&#125;æ‰“å°ç»“æœï¼š1234567891011121314151617181920212223242526ALL :8&gt; dirty_dataALL :7&gt; ç½‘è´­ç¿»è½¦çš„ç»å†,ç»å†ALL :1&gt; å½­æ˜±ç•…çš„è‡ªæ‹å’Œä»–æ‹,å½­æ˜±ç•…ALL :7&gt; dirty_dataALL :1&gt; å½­æ˜±ç•…çš„è‡ªæ‹å’Œä»–æ‹,å½­æ˜±ç•…ALL :7&gt; dirty_dataALL :1&gt; ç½‘è´­ç¿»è½¦çš„ç»å†,ç»å†ALL :7&gt; dirty_dataALL :1&gt; ç½‘è´­ç¿»è½¦çš„ç»å†,ç»å†ALL :8&gt; dirty_dataALL :7&gt; ç—›ä»°æ¼”å”±ä¼š,æ¼”å”±ä¼šALL :1&gt; ç—›ä»°æ¼”å”±ä¼š,æ¼”å”±ä¼šALL :8&gt; dirty_dataALL :1&gt; dirty_dataALL :7&gt; dirty_dataALL :1&gt; ç—›ä»°æ¼”å”±ä¼š,æ¼”å”±ä¼šALL :1&gt; dirty_dataALL :8&gt; dirty_dataALL :7&gt; ç—›ä»°æ¼”å”±ä¼š,æ¼”å”±ä¼šALL :8&gt; dirty_dataALL :1&gt; ç—›ä»°æ¼”å”±ä¼š,æ¼”å”±ä¼šALL :8&gt; dirty_dataALL :1&gt; dirty_dataALL :7&gt; dirty_dataALL :1&gt; å¹¸ç¦è§¦æ‰‹å¯åŠç‰‡èŠ±,ç‰‡èŠ±ALL :7&gt; å¹¸ç¦è§¦æ‰‹å¯åŠç‰‡èŠ±,ç‰‡èŠ±","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Flink ä¾§è¾“å‡ºæµSideOutput","slug":"Flink-ä¾§è¾“å‡ºæµSideOutput","date":"2018-04-20T13:30:11.000Z","updated":"2020-05-15T15:51:24.179Z","comments":true,"path":"2018/04/20/Flink-ä¾§è¾“å‡ºæµSideOutput/","link":"","permalink":"cpeixin.cn/2018/04/20/Flink-%E4%BE%A7%E8%BE%93%E5%87%BA%E6%B5%81SideOutput/","excerpt":"","text":"åœ¨Sparkå’ŒFlinkçš„æµå¼å¤„ç†æ–¹é¢ï¼Œæœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œä¾‹å¦‚map()ï¼Œflatmap()ç­‰ç®—å­ä½¿ç”¨æ–¹æ³•éƒ½æ˜¯ç›¸ä¼¼çš„ã€‚é‚£è¿™é‡Œæˆ‘ä¸¾å‡ºä¸€ä¸ªåœ¨Spark Streamingä¸­æ²¡æœ‰çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œä¾§å‡ºæµSideOutputã€‚åœ¨Flinkä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæ˜¯ä½¿ç”¨split()ç®—å­æ¥å®ç°è¿™ä¸ªåŠŸèƒ½çš„ï¼Œä½†æ˜¯ç›®å‰1.4å®˜æ–¹ä¸æ¨èä½¿ç”¨ï¼Œåœ¨ç¼–è¯‘å™¨ä¸­ä¹Ÿè¢«æ ‡ç¤ºè¿‡æ—¶æ–¹æ³•ï¼Œæ¨èä½¿ç”¨sideoutputã€‚å…·ä½“èƒ½å®ç°çš„åŠŸèƒ½æ˜¯å°†ä¸€ä¸ªæµæ•°æ®ï¼ŒæŒ‰ç…§ä½ è‡ªå®šä¹‰çš„è§„åˆ™ï¼Œåœ¨æµæ•°æ®å†…éƒ¨æ¥åˆ†æˆä¸€ä¸ªæˆ–è€…å¤šä¸ªæµï¼Œå¹¶ä¸”åŒæ—¶è¾“å‡ºç»™ä½ ã€‚åœ¨Spark Streamingä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å¯¹ä¸€ä¸ªæµæ•°æ®è¿›è¡Œåˆ†å‰²ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¸€ä¸ªæµæ•°æ®åˆ†åˆ«åšä¸¤æ¬¡filterç®—å­ï¼Œè¿™æ ·å°±ä¼šè¿›è¡Œæ•°æ®å¤åˆ¶ï¼Œç›¸å¯¹æ¥è¯´è€—ç”¨èµ„æºæ›´é«˜ä¸€äº›ã€‚flinkä¸­çš„ä¾§è¾“å‡ºå°±æ˜¯å°†æ•°æ®æµè¿›è¡Œåˆ†å‰²ï¼Œè€Œä¸å¯¹æµè¿›è¡Œå¤åˆ¶çš„ä¸€ç§åˆ†æµæœºåˆ¶ã€‚flinkçš„ä¾§è¾“å‡ºçš„å¦ä¸€ä¸ªä½œç”¨å°±æ˜¯å¯¹å»¶æ—¶è¿Ÿåˆ°çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·å°±å¯ä»¥ä¸å¿…ä¸¢å¼ƒè¿Ÿåˆ°çš„æ•°æ®ã€‚å®ä¾‹ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879package data_streamimport java.util.Propertiesimport org.apache.flink.streaming.api.scala._import com.alibaba.fastjson.&#123;JSON, JSONObject&#125;import org.apache.flink.runtime.state.filesystem.FsStateBackendimport org.apache.flink.streaming.api.CheckpointingModeimport org.apache.flink.streaming.api.functions.ProcessFunctionimport org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment&#125;import org.apache.flink.streaming.api.windowing.time.Timeimport org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumerBaseimport org.apache.flink.util.Collectorimport utils.KafkaUtilobject sideoutput_datastream &#123; case class Raw(date_time: String, keywordList: String) private val KAFKA_TOPIC: String = \"weibo_keyword\" def main(args: Array[String]) &#123; val properties: Properties = new Properties() properties.setProperty(\"bootstrap.servers\", \"localhost:9092\") properties.setProperty(\"group.id\", \"kafka_consumer\") val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment // exactly-once è¯­ä¹‰ä¿è¯æ•´ä¸ªåº”ç”¨å†…ç«¯åˆ°ç«¯çš„æ•°æ®ä¸€è‡´æ€§ env.getCheckpointConfig.setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE) // å¼€å¯æ£€æŸ¥ç‚¹å¹¶æŒ‡å®šæ£€æŸ¥ç‚¹æ—¶é—´é—´éš”ä¸º5s env.enableCheckpointing(5000) // checkpoint every 5000 msecs // è®¾ç½®StateBackendï¼Œå¹¶æŒ‡å®šçŠ¶æ€æ•°æ®å­˜å‚¨ä½ç½® env.setStateBackend(new FsStateBackend(\"file:///Users/cpeixin/IdeaProjects/code_warehouse/data/KafkaSource\")) val topic: String = \"weibo_keyword\" val kafkaSource: FlinkKafkaConsumerBase[String] = KafkaUtil.getKafkaSource(topic) val word_stream: DataStream[Raw] = env.addSource(kafkaSource) .map((x: String) =&gt; &#123; val date_time: String = get_value(x)._1 val keywordList: String = get_value(x)._2 Raw(date_time, keywordList) &#125;) val processStream: DataStream[Raw] = word_stream.process(new SideOutput()) processStream.print(\"original data\") //é€šè¿‡getSideOutputè·å–ä¾§è¾“å‡ºæµï¼Œå¹¶æ‰“å°è¾“å‡º processStream.getSideOutput(new OutputTag[String](\"dirty_data\")).print(\"side output data\") env.execute(\"side output test\") &#125; def get_value(string_data: String): (String, String) = &#123; val json_data: JSONObject = JSON.parseObject(string_data) val date_time: String = json_data.get(\"datetime\").toString val keywordList: String = json_data.get(\"keywordList\").toString (date_time, keywordList) &#125; class SideOutput() extends ProcessFunction[Raw, Raw] &#123; //å®šä¹‰ä¸€ä¸ªä¾§è¾“å‡ºæµæ ‡ç­¾ lazy val dirty_data: OutputTag[String] = new OutputTag[String](\"dirty_data\") override def processElement(value: Raw, ctx: ProcessFunction[Raw, Raw]#Context, out: Collector[Raw]): Unit = &#123; if (value.keywordList == \"dirty_data\") &#123; ctx.output(dirty_data, s\"$&#123;value.date_time&#125;+$&#123;value.keywordList&#125; is dirty data\") &#125; else &#123; out.collect(value) &#125; &#125; &#125;&#125;ç»“æœè¾“å‡º","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Hive æ•°æ®å€¾æ–œ&ä¼˜åŒ–","slug":"Hive-æ•°æ®å€¾æ–œ-ä¼˜åŒ–","date":"2018-04-15T14:29:56.000Z","updated":"2020-06-15T14:32:25.992Z","comments":true,"path":"2018/04/15/Hive-æ•°æ®å€¾æ–œ-ä¼˜åŒ–/","link":"","permalink":"cpeixin.cn/2018/04/15/Hive-%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C-%E4%BC%98%E5%8C%96/","excerpt":"","text":"æ•°æ®å€¾æ–œçš„åŸå› æ³¨æ„çš„SQLæ“ä½œå…³é”®è¯æƒ…å½¢åæœJoinå…¶ä¸­ä¸€ä¸ªè¡¨è¾ƒå°ï¼Œä½†æ˜¯keyé›†ä¸­åˆ†å‘åˆ°æŸä¸€ä¸ªæˆ–å‡ ä¸ªReduceä¸Šçš„æ•°æ®è¿œé«˜äºå¹³å‡å€¼å¤§è¡¨ä¸å¤§è¡¨ï¼Œä½†æ˜¯åˆ†æ¡¶çš„åˆ¤æ–­å­—æ®µ0å€¼æˆ–ç©ºå€¼è¿‡å¤šè¿™äº›ç©ºå€¼éƒ½ç”±ä¸€ä¸ªreduceå¤„ç†ï¼Œç°å¸¸æ…¢group bygroup by ç»´åº¦è¿‡å°ï¼ŒæŸå€¼çš„æ•°é‡è¿‡å¤šå¤„ç†æŸå€¼çš„reduceç°å¸¸è€—æ—¶Count DistinctæŸç‰¹æ®Šå€¼è¿‡å¤šå¤„ç†æ­¤ç‰¹æ®Šå€¼çš„reduceè€—æ—¶åŸå› 1)ã€keyåˆ†å¸ƒä¸å‡åŒ€2)ã€ä¸šåŠ¡æ•°æ®æœ¬èº«çš„ç‰¹æ€§3)ã€å»ºè¡¨æ—¶è€ƒè™‘ä¸å‘¨4)ã€æŸäº›SQLè¯­å¥æœ¬èº«å°±æœ‰æ•°æ®å€¾æ–œè¡¨ç°ä»»åŠ¡è¿›åº¦é•¿æ—¶é—´ç»´æŒåœ¨99%ï¼ˆæˆ–100%ï¼‰ï¼ŒæŸ¥çœ‹ä»»åŠ¡ç›‘æ§é¡µé¢ï¼Œå‘ç°åªæœ‰å°‘é‡ï¼ˆ1ä¸ªæˆ–å‡ ä¸ªï¼‰reduceå­ä»»åŠ¡æœªå®Œæˆã€‚å› ä¸ºå…¶å¤„ç†çš„æ•°æ®é‡å’Œå…¶ä»–reduceå·®å¼‚è¿‡å¤§ã€‚å•ä¸€reduceçš„è®°å½•æ•°ä¸å¹³å‡è®°å½•æ•°å·®å¼‚è¿‡å¤§ï¼Œé€šå¸¸å¯èƒ½è¾¾åˆ°3å€ç”šè‡³æ›´å¤šã€‚ æœ€é•¿æ—¶é•¿è¿œå¤§äºå¹³å‡æ—¶é•¿ã€‚æ•°æ®å€¾æ–œçš„è§£å†³æ–¹æ¡ˆå‚æ•°è°ƒèŠ‚1hive.map.aggr=trueMap ç«¯éƒ¨åˆ†èšåˆï¼Œç›¸å½“äºCombiner1hive.groupby.skewindata=trueæœ‰æ•°æ®å€¾æ–œçš„æ—¶å€™è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå½“é€‰é¡¹è®¾å®šä¸º trueï¼Œç”Ÿæˆçš„æŸ¥è¯¢è®¡åˆ’ä¼šæœ‰ä¸¤ä¸ª MR Jobã€‚ç¬¬ä¸€ä¸ª MR Job ä¸­ï¼ŒMap çš„è¾“å‡ºç»“æœé›†åˆä¼šéšæœºåˆ†å¸ƒåˆ° Reduce ä¸­ï¼Œæ¯ä¸ª Reduce åšéƒ¨åˆ†èšåˆæ“ä½œï¼Œå¹¶è¾“å‡ºç»“æœï¼Œè¿™æ ·å¤„ç†çš„ç»“æœæ˜¯ç›¸åŒçš„ Group By Key æœ‰å¯èƒ½è¢«åˆ†å‘åˆ°ä¸åŒçš„ Reduce ä¸­ï¼Œä»è€Œè¾¾åˆ°è´Ÿè½½å‡è¡¡çš„ç›®çš„ï¼›ç¬¬äºŒä¸ª MR Job å†æ ¹æ®é¢„å¤„ç†çš„æ•°æ®ç»“æœæŒ‰ç…§ Group By Key åˆ†å¸ƒåˆ° Reduce ä¸­ï¼ˆè¿™ä¸ªè¿‡ç¨‹å¯ä»¥ä¿è¯ç›¸åŒçš„ Group By Key è¢«åˆ†å¸ƒåˆ°åŒä¸€ä¸ª Reduce ä¸­ï¼‰ï¼Œæœ€åå®Œæˆæœ€ç»ˆçš„èšåˆæ“ä½œã€‚SQLè¯­å¥è°ƒèŠ‚å¦‚ä½•Joinå…³äºé©±åŠ¨è¡¨çš„é€‰å–ï¼Œé€‰ç”¨join keyåˆ†å¸ƒæœ€å‡åŒ€çš„è¡¨ä½œä¸ºé©±åŠ¨è¡¨åšå¥½åˆ—è£å‰ªå’Œfilteræ“ä½œï¼Œä»¥è¾¾åˆ°ä¸¤è¡¨åšjoinçš„æ—¶å€™ï¼Œæ•°æ®é‡ç›¸å¯¹å˜å°çš„æ•ˆæœã€‚å¤§å°è¡¨Joinä½¿ç”¨map joinè®©å°çš„ç»´åº¦è¡¨ï¼ˆ1000æ¡ä»¥ä¸‹çš„è®°å½•æ¡æ•°ï¼‰ å…ˆè¿›å†…å­˜ã€‚åœ¨mapç«¯å®Œæˆreduce.å¤§è¡¨Joinå¤§è¡¨æŠŠç©ºå€¼çš„keyå˜æˆä¸€ä¸ªå­—ç¬¦ä¸²åŠ ä¸Šéšæœºæ•°ï¼ŒæŠŠå€¾æ–œçš„æ•°æ®åˆ†åˆ°ä¸åŒçš„reduceä¸Šï¼Œç”±äºnullå€¼å…³è”ä¸ä¸Šï¼Œå¤„ç†åå¹¶ä¸å½±å“æœ€ç»ˆç»“æœã€‚count distinctå¤§é‡ç›¸åŒç‰¹æ®Šå€¼count distinctæ—¶ï¼Œå°†å€¼ä¸ºç©ºçš„æƒ…å†µå•ç‹¬å¤„ç†ï¼Œå¦‚æœæ˜¯è®¡ç®—count distinctï¼Œå¯ä»¥ä¸ç”¨å¤„ç†ï¼Œç›´æ¥è¿‡æ»¤ï¼Œåœ¨æœ€åç»“æœä¸­åŠ 1ã€‚å¦‚æœè¿˜æœ‰å…¶ä»–è®¡ç®—ï¼Œéœ€è¦è¿›è¡Œgroup byï¼Œå¯ä»¥å…ˆå°†å€¼ä¸ºç©ºçš„è®°å½•å•ç‹¬å¤„ç†ï¼Œå†å’Œå…¶ä»–è®¡ç®—ç»“æœè¿›è¡Œunionã€‚group byç»´åº¦è¿‡å°é‡‡ç”¨sum() group byçš„æ–¹å¼æ¥æ›¿æ¢count(distinct)å®Œæˆè®¡ç®—ã€‚ç‰¹æ®Šæƒ…å†µç‰¹æ®Šå¤„ç†**åœ¨ä¸šåŠ¡é€»è¾‘ä¼˜åŒ–æ•ˆæœçš„ä¸å¤§æƒ…å†µä¸‹ï¼Œæœ‰äº›æ—¶å€™æ˜¯å¯ä»¥å°†å€¾æ–œçš„æ•°æ®å•ç‹¬æ‹¿å‡ºæ¥å¤„ç†ã€‚æœ€åunionå›å»ã€‚å…¸å‹çš„ä¸šåŠ¡åœºæ™¯ç©ºå€¼äº§ç”Ÿçš„æ•°æ®å€¾æ–œåœºæ™¯ï¼šå¦‚æ—¥å¿—ä¸­ï¼Œå¸¸ä¼šæœ‰ä¿¡æ¯ä¸¢å¤±çš„é—®é¢˜ï¼Œæ¯”å¦‚æ—¥å¿—ä¸­çš„ user_idï¼Œå¦‚æœå–å…¶ä¸­çš„ user_id å’Œ ç”¨æˆ·è¡¨ä¸­çš„user_id å…³è”ï¼Œä¼šç¢°åˆ°æ•°æ®å€¾æ–œçš„é—®é¢˜ã€‚è§£å†³æ–¹æ³•1ï¼š** user_idä¸ºç©ºçš„ä¸å‚ä¸å…³è”ï¼ˆçº¢è‰²å­—ä½“ä¸ºä¿®æ”¹åï¼‰1234567select * from log a join users b on a.user_id is not null and a.user_id = b.user_idunion allselect * from log a where a.user_id is null;è§£å†³æ–¹æ³•2 ï¼šèµ‹ä¸ç©ºå€¼åˆ†æ–°çš„keyå€¼1234select * from log a left outer join users b on case when a.user_id is null then concat(â€˜hiveâ€™,rand() ) else a.user_id end = b.user_id;ç»“è®ºï¼šæ–¹æ³•2æ¯”æ–¹æ³•1æ•ˆç‡æ›´å¥½ï¼Œä¸ä½†ioå°‘äº†ï¼Œè€Œä¸”ä½œä¸šæ•°ä¹Ÿå°‘äº†ã€‚è§£å†³æ–¹æ³•1ä¸­ logè¯»å–ä¸¤æ¬¡ï¼Œjobsæ˜¯2ã€‚è§£å†³æ–¹æ³•2 jobæ•°æ˜¯1 ã€‚è¿™ä¸ªä¼˜åŒ–é€‚åˆæ— æ•ˆ id (æ¯”å¦‚ -99 , â€™â€™, null ç­‰) äº§ç”Ÿçš„å€¾æ–œé—®é¢˜ã€‚æŠŠç©ºå€¼çš„ key å˜æˆä¸€ä¸ªå­—ç¬¦ä¸²åŠ ä¸Šéšæœºæ•°ï¼Œå°±èƒ½æŠŠå€¾æ–œçš„æ•°æ®åˆ†åˆ°ä¸åŒçš„reduceä¸Š ,è§£å†³æ•°æ®å€¾æ–œé—®é¢˜ã€‚**ä¸åŒæ•°æ®ç±»å‹å…³è”äº§ç”Ÿæ•°æ®å€¾æ–œåœºæ™¯ï¼šç”¨æˆ·è¡¨ä¸­user_idå­—æ®µä¸ºintï¼Œlogè¡¨ä¸­user_idå­—æ®µæ—¢æœ‰stringç±»å‹ä¹Ÿæœ‰intç±»å‹ã€‚å½“æŒ‰ç…§user_idè¿›è¡Œä¸¤ä¸ªè¡¨çš„Joinæ“ä½œæ—¶ï¼Œé»˜è®¤çš„Hashæ“ä½œä¼šæŒ‰intå‹çš„idæ¥è¿›è¡Œåˆ†é…ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ‰€æœ‰stringç±»å‹idçš„è®°å½•éƒ½åˆ†é…åˆ°ä¸€ä¸ªReducerä¸­ã€‚è§£å†³æ–¹æ³•ï¼šæŠŠæ•°å­—ç±»å‹è½¬æ¢æˆå­—ç¬¦ä¸²ç±»å‹123select * from users a left outer join logs b on a.usr_id = cast(b.user_id as string)**å°è¡¨ä¸å°ä¸å¤§ï¼Œæ€ä¹ˆç”¨ map join è§£å†³å€¾æ–œé—®é¢˜ä½¿ç”¨ map join è§£å†³å°è¡¨(è®°å½•æ•°å°‘)å…³è”å¤§è¡¨çš„æ•°æ®å€¾æ–œé—®é¢˜ï¼Œè¿™ä¸ªæ–¹æ³•ä½¿ç”¨çš„é¢‘ç‡éå¸¸é«˜ï¼Œä½†å¦‚æœå°è¡¨å¾ˆå¤§ï¼Œå¤§åˆ°map joinä¼šå‡ºç°bugæˆ–å¼‚å¸¸ï¼Œè¿™æ—¶å°±éœ€è¦ç‰¹åˆ«çš„å¤„ç†ã€‚ ä»¥ä¸‹ä¾‹å­:123select * from log a left outer join users b on a.user_id = b.user_id;users è¡¨æœ‰ 600w+ çš„è®°å½•ï¼ŒæŠŠ users åˆ†å‘åˆ°æ‰€æœ‰çš„ map ä¸Šä¹Ÿæ˜¯ä¸ªä¸å°çš„å¼€é”€ï¼Œè€Œä¸” map join ä¸æ”¯æŒè¿™ä¹ˆå¤§çš„å°è¡¨ã€‚å¦‚æœç”¨æ™®é€šçš„ joinï¼Œåˆä¼šç¢°åˆ°æ•°æ®å€¾æ–œçš„é—®é¢˜ã€‚è§£å†³æ–¹æ³•ï¼š12345678select /*+mapjoin(x)*/* from log a left outer join ( select /*+mapjoin(c)*/d.* from ( select distinct user_id from log ) c join users d on c.user_id = d.user_id ) x on a.user_id = b.user_id;å‡å¦‚ï¼Œlogé‡Œuser_idæœ‰ä¸Šç™¾ä¸‡ä¸ªï¼Œè¿™å°±åˆå›åˆ°åŸæ¥map joiné—®é¢˜ã€‚æ‰€å¹¸ï¼Œæ¯æ—¥çš„ä¼šå‘˜uvä¸ä¼šå¤ªå¤šï¼Œæœ‰äº¤æ˜“çš„ä¼šå‘˜ä¸ä¼šå¤ªå¤šï¼Œæœ‰ç‚¹å‡»çš„ä¼šå‘˜ä¸ä¼šå¤ªå¤šï¼Œæœ‰ä½£é‡‘çš„ä¼šå‘˜ä¸ä¼šå¤ªå¤šç­‰ç­‰ã€‚æ‰€ä»¥è¿™ä¸ªæ–¹æ³•èƒ½è§£å†³å¾ˆå¤šåœºæ™¯ä¸‹çš„æ•°æ®å€¾æ–œé—®é¢˜ã€‚GROUP BYæ›¿ä»£COUNT(DISTINCT)è¾¾åˆ°ä¼˜åŒ–æ•ˆæœè®¡ç®— uv çš„æ—¶å€™ï¼Œç»å¸¸ä¼šç”¨åˆ° COUNT(DISTINCT)ï¼Œä½†åœ¨æ•°æ®æ¯”è¾ƒå€¾æ–œçš„æ—¶å€™ COUNT(DISTINCT) ä¼šæ¯”è¾ƒæ…¢ã€‚è¿™æ—¶å¯ä»¥å°è¯•ç”¨ GROUP BY æ”¹å†™ä»£ç è®¡ç®— uvã€‚12INSERT OVERWRITE TABLE s_dw_tanx_adzone_uv PARTITION (ds=20120329) SELECT 20120329 AS thedate,adzoneid,COUNT(DISTINCT acookie) AS uv FROM s_ods_log_tanx_pv t WHERE t.ds=20120329 GROUP BY adzoneidå…³äºCOUNT(DISTINCT)çš„æ•°æ®å€¾æ–œé—®é¢˜ä¸èƒ½ä¸€æ¦‚è€Œè®ºï¼Œè¦ä¾æƒ…å†µè€Œå®šï¼Œä¸‹é¢æ˜¯æˆ‘æµ‹è¯•çš„ä¸€ç»„æ•°æ®ï¼šæµ‹è¯•æ•°æ®ï¼š169857æ¡*ç»Ÿè®¡æ¯æ—¥IP *12CREATE TABLE ip_2014_12_29 AS SELECT COUNT(DISTINCT ip) AS IP FROM logdfs WHERE logdate='2014_12_29'; è€—æ—¶ï¼š24.805 seconds*ç»Ÿè®¡æ¯æ—¥IPï¼ˆæ”¹é€ ï¼‰ *12CREATE TABLE ip_2014_12_29 AS SELECT COUNT(1) AS IP FROM (SELECT DISTINCT ip from logdfs WHERE logdate='2014_12_29') tmp; è€—æ—¶ï¼š46.833 secondsæµ‹è¯•ç»“æœè¡¨åï¼šæ˜æ˜¾æ”¹é€ åçš„è¯­å¥æ¯”ä¹‹å‰è€—æ—¶ï¼Œè¿™æ˜¯å› ä¸ºæ”¹é€ åçš„è¯­å¥æœ‰2ä¸ªSELECTï¼Œå¤šäº†ä¸€ä¸ªjobï¼Œè¿™æ ·åœ¨æ•°æ®é‡å°çš„æ—¶å€™ï¼Œæ•°æ®ä¸ä¼šå­˜åœ¨å€¾æ–œé—®é¢˜ã€‚è§£å†³Hiveå¯¹UNION ALLä¼˜åŒ–çš„çŸ­æ¿Hive å¯¹ union all çš„ä¼˜åŒ–çš„ç‰¹æ€§ï¼šå¯¹ union all ä¼˜åŒ–åªå±€é™äºéåµŒå¥—æŸ¥è¯¢ã€‚æ¶ˆç­å­æŸ¥è¯¢å†…çš„ group byç¤ºä¾‹ 1ï¼šå­æŸ¥è¯¢å†…æœ‰ group by123SELECT * FROM (SELECT * FROM t1 GROUP BY c1,c2,c3 UNION ALL SELECT * FROM t2 GROUP BY c1,c2,c3)t3 GROUP BY c1,c2,c3ä»ä¸šåŠ¡é€»è¾‘ä¸Šè¯´ï¼Œå­æŸ¥è¯¢å†…çš„ GROUP BY æ€ä¹ˆéƒ½çœ‹æ˜¾å¾—å¤šä½™ï¼ˆåŠŸèƒ½ä¸Šçš„å¤šä½™ï¼Œé™¤éæœ‰ COUNT(DISTINCT)ï¼‰ï¼Œå¦‚æœä¸æ˜¯å› ä¸º Hive Bug æˆ–è€…æ€§èƒ½ä¸Šçš„è€ƒé‡ï¼ˆæ›¾ç»å‡ºç°å¦‚æœä¸æ‰§è¡Œå­æŸ¥è¯¢ GROUP BYï¼Œæ•°æ®å¾—ä¸åˆ°æ­£ç¡®çš„ç»“æœçš„ Hive Bugï¼‰ã€‚æ‰€ä»¥è¿™ä¸ª Hive æŒ‰ç»éªŒè½¬æ¢æˆå¦‚ä¸‹æ‰€ç¤ºï¼š1SELECT * FROM (SELECT * FROM t1 UNION ALL SELECT * FROM t2)t3 GROUP BY c1,c2,c3è°ƒä¼˜ç»“æœï¼šç»è¿‡æµ‹è¯•ï¼Œå¹¶æœªå‡ºç° union all çš„ Hive Bugï¼Œæ•°æ®æ˜¯ä¸€è‡´çš„ã€‚MapReduce çš„ ä½œä¸šæ•°ç”± 3 å‡å°‘åˆ° 1ã€‚t1 ç›¸å½“äºä¸€ä¸ªç›®å½•ï¼Œt2 ç›¸å½“äºä¸€ä¸ªç›®å½•ï¼Œå¯¹ Map/Reduce ç¨‹åºæ¥è¯´ï¼Œt1ï¼Œt2 å¯ä»¥ä½œä¸º Map/Reduce ä½œä¸šçš„ mutli inputsã€‚è¿™å¯ä»¥é€šè¿‡ä¸€ä¸ª Map/Reduce æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚Hadoop çš„ è®¡ç®—æ¡†æ¶ï¼Œä¸æ€•æ•°æ®å¤šï¼Œå°±æ€•ä½œä¸šæ•°å¤šã€‚ä½†å¦‚æœæ¢æˆæ˜¯å…¶ä»–è®¡ç®—å¹³å°å¦‚ Oracleï¼Œé‚£å°±ä¸ä¸€å®šäº†ï¼Œå› ä¸ºæŠŠå¤§çš„è¾“å…¥æ‹†æˆä¸¤ä¸ªè¾“å…¥ï¼Œ åˆ†åˆ«æ’åºæ±‡æ€»å mergeï¼ˆå‡å¦‚ä¸¤ä¸ªå­æ’åºæ˜¯å¹¶è¡Œçš„è¯ï¼‰ï¼Œæ˜¯æœ‰å¯èƒ½æ€§èƒ½æ›´ä¼˜çš„ï¼ˆæ¯”å¦‚å¸Œå°”æ’ åºæ¯”å†’æ³¡æ’åºçš„æ€§èƒ½æ›´ä¼˜ï¼‰ã€‚æ¶ˆç­å­æŸ¥è¯¢å†…çš„ COUNT(DISTINCT)ï¼ŒMAXï¼ŒMIN1234SELECT * FROM (SELECT * FROM t1 UNION ALL SELECT c1,c2,c3 COUNT(DISTINCT c4) FROM t2 GROUP BY c1,c2,c3) t3 GROUP BY c1,c2,c3;ç”±äºå­æŸ¥è¯¢é‡Œå¤´æœ‰ COUNT(DISTINCT)æ“ä½œï¼Œç›´æ¥å» GROUP BY å°†è¾¾ä¸åˆ°ä¸šåŠ¡ç›®æ ‡ã€‚è¿™æ—¶é‡‡ç”¨ ä¸´æ—¶è¡¨æ¶ˆç­ COUNT(DISTINCT)ä½œä¸šä¸ä½†èƒ½è§£å†³å€¾æ–œé—®é¢˜ï¼Œè¿˜èƒ½æœ‰æ•ˆå‡å°‘ jobsã€‚123456INSERT t4 SELECT c1,c2,c3,c4 FROM t2 GROUP BY c1,c2,c3; SELECT c1,c2,c3,SUM(income),SUM(uv) FROM (SELECT c1,c2,c3,income,0 AS uv FROM t1 UNION ALL SELECT c1,c2,c3,0 AS income,1 AS uv FROM t2) t3 GROUP BY c1,c2,c3;job æ•°æ˜¯ 2ï¼Œå‡å°‘ä¸€åŠï¼Œè€Œä¸”ä¸¤æ¬¡ Map/Reduce æ¯” COUNT(DISTINCT)æ•ˆç‡æ›´é«˜ã€‚è°ƒä¼˜ç»“æœï¼šåƒä¸‡çº§åˆ«çš„ç±»ç›®è¡¨ï¼Œmember è¡¨ï¼Œä¸ 10 äº¿çº§å¾—å•†å“è¡¨å…³è”ã€‚åŸå…ˆ 1963s çš„ä»»åŠ¡ç»è¿‡è°ƒæ•´ï¼Œ1152s å³å®Œæˆã€‚æ¶ˆç­å­æŸ¥è¯¢å†…çš„ JOIN123SELECT * FROM (SELECT * FROM t1 UNION ALL SELECT * FROM t4 UNION ALL SELECT * FROM t2 JOIN t3 ON t2.id=t3.id) x GROUP BY c1,c2;ä¸Šé¢ä»£ç è¿è¡Œä¼šæœ‰ 5 ä¸ª jobsã€‚åŠ å…¥å…ˆ JOIN ç”Ÿå­˜ä¸´æ—¶è¡¨çš„è¯ t5ï¼Œç„¶å UNION ALLï¼Œä¼šå˜æˆ 2 ä¸ª jobsã€‚123INSERT OVERWRITE TABLE t5 SELECT * FROM t2 JOIN t3 ON t2.id=t3.id; SELECT * FROM (t1 UNION ALL t4 UNION ALL t5);è°ƒä¼˜ç»“æœæ˜¾ç¤ºï¼šé’ˆå¯¹åƒä¸‡çº§åˆ«çš„å¹¿å‘Šä½è¡¨ï¼Œç”±åŸå…ˆ 5 ä¸ª Job å…± 15 åˆ†é’Ÿï¼Œåˆ†è§£ä¸º 2 ä¸ª job ä¸€ä¸ª 8-10 åˆ†é’Ÿï¼Œä¸€ä¸ª3åˆ†é’Ÿã€‚æ€»ç»“ä½¿mapçš„è¾“å‡ºæ•°æ®æ›´å‡åŒ€çš„åˆ†å¸ƒåˆ°reduceä¸­å»ï¼Œæ˜¯æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡ã€‚ç”±äºHashç®—æ³•çš„å±€é™æ€§ï¼ŒæŒ‰key Hashä¼šæˆ–å¤šæˆ–å°‘çš„é€ æˆæ•°æ®å€¾æ–œã€‚å¤§é‡ç»éªŒè¡¨æ˜æ•°æ®å€¾æ–œçš„åŸå› æ˜¯äººä¸ºçš„å»ºè¡¨ç–å¿½æˆ–ä¸šåŠ¡é€»è¾‘å¯ä»¥è§„é¿çš„ã€‚åœ¨æ­¤ç»™å‡ºè¾ƒä¸ºé€šç”¨çš„æ­¥éª¤ï¼š1ã€é‡‡æ ·logè¡¨ï¼Œå“ªäº›user_idæ¯”è¾ƒå€¾æ–œï¼Œå¾—åˆ°ä¸€ä¸ªç»“æœè¡¨tmp1ã€‚ç”±äºå¯¹è®¡ç®—æ¡†æ¶æ¥è¯´ï¼Œæ‰€æœ‰çš„æ•°æ®è¿‡æ¥ï¼Œä»–éƒ½æ˜¯ä¸çŸ¥é“æ•°æ®åˆ†å¸ƒæƒ…å†µçš„ï¼Œæ‰€ä»¥é‡‡æ ·æ˜¯å¹¶ä¸å¯å°‘çš„ã€‚2ã€æ•°æ®çš„åˆ†å¸ƒç¬¦åˆç¤¾ä¼šå­¦ç»Ÿè®¡è§„åˆ™ï¼Œè´«å¯Œä¸å‡ã€‚å€¾æ–œçš„keyä¸ä¼šå¤ªå¤šï¼Œå°±åƒä¸€ä¸ªç¤¾ä¼šçš„å¯Œäººä¸å¤šï¼Œå¥‡ç‰¹çš„äººä¸å¤šä¸€æ ·ã€‚æ‰€ä»¥tmp1è®°å½•æ•°ä¼šå¾ˆå°‘ã€‚æŠŠtmp1å’Œusersåšmap joinç”Ÿæˆtmp2,æŠŠtmp2è¯»åˆ°distribute file cacheã€‚è¿™æ˜¯ä¸€ä¸ªmapè¿‡ç¨‹ã€‚3ã€mapè¯»å…¥userså’Œlogï¼Œå‡å¦‚è®°å½•æ¥è‡ªlog,åˆ™æ£€æŸ¥user_idæ˜¯å¦åœ¨tmp2é‡Œï¼Œå¦‚æœæ˜¯ï¼Œè¾“å‡ºåˆ°æœ¬åœ°æ–‡ä»¶a,å¦åˆ™ç”Ÿæˆ&lt;user_id,value&gt;çš„key,valueå¯¹ï¼Œå‡å¦‚è®°å½•æ¥è‡ªmember,ç”Ÿæˆ&lt;user_id,value&gt;çš„key,valueå¯¹ï¼Œè¿›å…¥reduceé˜¶æ®µã€‚4ã€æœ€ç»ˆæŠŠaæ–‡ä»¶ï¼ŒæŠŠStage3 reduceé˜¶æ®µè¾“å‡ºçš„æ–‡ä»¶åˆå¹¶èµ·å†™åˆ°hdfsã€‚å¦‚æœç¡®è®¤ä¸šåŠ¡éœ€è¦è¿™æ ·å€¾æ–œçš„é€»è¾‘ï¼Œè€ƒè™‘ä»¥ä¸‹çš„ä¼˜åŒ–æ–¹æ¡ˆï¼š1ã€å¯¹äºjoinï¼Œåœ¨åˆ¤æ–­å°è¡¨ä¸å¤§äº1Gçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨map join2ã€å¯¹äºgroup byæˆ–distinctï¼Œè®¾å®š hive.groupby.skewindata=true3ã€å°½é‡ä½¿ç”¨ä¸Šè¿°çš„SQLè¯­å¥è°ƒèŠ‚è¿›è¡Œä¼˜åŒ–hadoopå¤„ç†æ•°æ®çš„è¿‡ç¨‹ï¼Œæœ‰å‡ ä¸ªæ˜¾è‘—çš„ç‰¹å¾:ä¸æ€•æ•°æ®å¤šï¼Œå°±æ€•æ•°æ®å€¾æ–œã€‚å¯¹jobsæ•°æ¯”è¾ƒå¤šçš„ä½œä¸šè¿è¡Œæ•ˆç‡ç›¸å¯¹æ¯”è¾ƒä½ï¼Œæ¯”å¦‚å³ä½¿æœ‰å‡ ç™¾è¡Œçš„è¡¨ï¼Œå¦‚æœå¤šæ¬¡å…³è”å¤šæ¬¡æ±‡æ€»ï¼Œäº§ç”Ÿåå‡ ä¸ªjobsï¼Œæ²¡åŠå°æ—¶æ˜¯è·‘ä¸å®Œçš„ã€‚map reduceä½œä¸šåˆå§‹åŒ–çš„æ—¶é—´æ˜¯æ¯”è¾ƒé•¿çš„ã€‚å¯¹sumï¼Œcountæ¥è¯´ï¼Œä¸å­˜åœ¨æ•°æ®å€¾æ–œé—®é¢˜ã€‚å¯¹count(distinct ),æ•ˆç‡è¾ƒä½ï¼Œæ•°æ®é‡ä¸€å¤šï¼Œå‡†å‡ºé—®é¢˜ï¼Œå¦‚æœæ˜¯å¤šcount(distinct )æ•ˆç‡æ›´ä½ã€‚ä¼˜åŒ–å¯ä»¥ä»å‡ ä¸ªæ–¹é¢ç€æ‰‹å¥½çš„æ¨¡å‹è®¾è®¡äº‹åŠåŠŸå€ã€‚è§£å†³æ•°æ®å€¾æ–œé—®é¢˜ã€‚å‡å°‘jobæ•°ã€‚è®¾ç½®åˆç†çš„map reduceçš„taskæ•°ï¼Œèƒ½æœ‰æ•ˆæå‡æ€§èƒ½ã€‚(æ¯”å¦‚ï¼Œ10w+çº§åˆ«çš„è®¡ç®—ï¼Œç”¨160ä¸ªreduceï¼Œé‚£æ˜¯ç›¸å½“çš„æµªè´¹ï¼Œ1ä¸ªè¶³å¤Ÿ)ã€‚è‡ªå·±åŠ¨æ‰‹å†™sqlè§£å†³æ•°æ®å€¾æ–œé—®é¢˜æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚set hive.groupby.skewindata=true;è¿™æ˜¯é€šç”¨çš„ç®—æ³•ä¼˜åŒ–ï¼Œä½†ç®—æ³•ä¼˜åŒ–æ€»æ˜¯æ¼ è§†ä¸šåŠ¡ï¼Œä¹ æƒ¯æ€§æä¾›é€šç”¨çš„è§£å†³æ–¹æ³•ã€‚ Etlå¼€å‘äººå‘˜æ›´äº†è§£ä¸šåŠ¡ï¼Œæ›´äº†è§£æ•°æ®ï¼Œæ‰€ä»¥é€šè¿‡ä¸šåŠ¡é€»è¾‘è§£å†³å€¾æ–œçš„æ–¹æ³•å¾€å¾€æ›´ç²¾ç¡®ï¼Œæ›´æœ‰æ•ˆã€‚å¯¹count(distinct)é‡‡å–æ¼ è§†çš„æ–¹æ³•ï¼Œå°¤å…¶æ•°æ®å¤§çš„æ—¶å€™å¾ˆå®¹æ˜“äº§ç”Ÿå€¾æ–œé—®é¢˜ï¼Œä¸æŠ±ä¾¥å¹¸å¿ƒç†ã€‚è‡ªå·±åŠ¨æ‰‹ï¼Œä¸°è¡£è¶³é£Ÿã€‚å¯¹å°æ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œæ˜¯è¡Œè‡³æœ‰æ•ˆçš„æé«˜è°ƒåº¦æ•ˆç‡çš„æ–¹æ³•ï¼Œå‡å¦‚æˆ‘ä»¬çš„ä½œä¸šè®¾ç½®åˆç†çš„æ–‡ä»¶æ•°ï¼Œå¯¹äº‘æ¢¯çš„æ•´ä½“è°ƒåº¦æ•ˆç‡ä¹Ÿä¼šäº§ç”Ÿç§¯æçš„å½±å“ã€‚ä¼˜åŒ–æ—¶æŠŠæ¡æ•´ä½“ï¼Œå•ä¸ªä½œä¸šæœ€ä¼˜ä¸å¦‚æ•´ä½“æœ€ä¼˜ã€‚ç»†èŠ‚ä¸Šå°±æ˜¯**å»é™¤æŸ¥è¯¢ä¸­ä¸éœ€è¦çš„columnWhereæ¡ä»¶åˆ¤æ–­ç­‰åœ¨TableScané˜¶æ®µå°±è¿›è¡Œè¿‡æ»¤åˆ©ç”¨Partitionä¿¡æ¯ï¼Œåªè¯»å–ç¬¦åˆæ¡ä»¶çš„PartitionMapç«¯joinï¼Œä»¥å¤§è¡¨ä½œé©±åŠ¨ï¼Œå°è¡¨è½½å…¥æ‰€æœ‰mapperå†…å­˜ä¸­è°ƒæ•´Joiné¡ºåºï¼Œç¡®ä¿ä»¥å¤§è¡¨ä½œä¸ºé©±åŠ¨è¡¨å¯¹äºæ•°æ®åˆ†å¸ƒä¸å‡è¡¡çš„è¡¨Group byæ—¶ï¼Œä¸ºé¿å…æ•°æ®é›†ä¸­åˆ°å°‘æ•°çš„reducerä¸Šï¼Œåˆ†æˆä¸¤ä¸ªmap-reduceé˜¶æ®µã€‚ç¬¬ä¸€ä¸ªé˜¶æ®µå…ˆç”¨Distinctåˆ—è¿›è¡Œshuffleï¼Œç„¶ååœ¨reduceç«¯éƒ¨åˆ†èšåˆï¼Œå‡å°æ•°æ®è§„æ¨¡ï¼Œç¬¬äºŒä¸ªmap-reduceé˜¶æ®µå†æŒ‰group-byåˆ—èšåˆã€‚åœ¨mapç«¯ç”¨hashè¿›è¡Œéƒ¨åˆ†èšåˆï¼Œå‡å°reduceç«¯æ•°æ®å¤„ç†è§„æ¨¡ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"hive","slug":"hive","permalink":"cpeixin.cn/tags/hive/"}]},{"title":"OLTPä¸OLAPï¼šæœ‰ä½•åŒºåˆ«ï¼Ÿ","slug":"OLTPä¸OLAPï¼šæœ‰ä½•åŒºåˆ«ï¼Ÿ","date":"2018-04-10T14:25:18.000Z","updated":"2020-05-11T05:14:44.588Z","comments":true,"path":"2018/04/10/OLTPä¸OLAPï¼šæœ‰ä½•åŒºåˆ«ï¼Ÿ/","link":"","permalink":"cpeixin.cn/2018/04/10/OLTP%E4%B8%8EOLAP%EF%BC%9A%E6%9C%89%E4%BD%95%E5%8C%BA%E5%88%AB%EF%BC%9F/","excerpt":"","text":"ä»€ä¹ˆæ˜¯OLAPï¼Ÿè”æœºåˆ†æå¤„ç†ï¼Œä¸€ç±»è½¯ä»¶å·¥å…·ï¼Œå¯ä¸ºä¸šåŠ¡å†³ç­–æä¾›æ•°æ®åˆ†æã€‚OLAPç³»ç»Ÿå…è®¸ç”¨æˆ·ä¸€æ¬¡åˆ†ææ¥è‡ªå¤šä¸ªæ•°æ®åº“ç³»ç»Ÿçš„æ•°æ®åº“ä¿¡æ¯ã€‚ä¸»è¦ç›®æ ‡æ˜¯æ•°æ®åˆ†æè€Œä¸æ˜¯æ•°æ®å¤„ç†ã€‚ä»€ä¹ˆæ˜¯OLTPï¼Ÿåœ¨çº¿äº‹åŠ¡å¤„ç†ï¼ˆç®€ç§°OLTPï¼‰åœ¨3å±‚ä½“ç³»ç»“æ„ä¸­æ”¯æŒé¢å‘äº‹åŠ¡çš„åº”ç”¨ç¨‹åºã€‚OLTPç®¡ç†ç»„ç»‡çš„æ—¥å¸¸äº‹åŠ¡ã€‚ä¸»è¦ç›®æ ‡æ˜¯æ•°æ®å¤„ç†è€Œä¸æ˜¯æ•°æ®åˆ†æOLAPç¤ºä¾‹ä»»ä½•æ•°æ®ä»“åº“ç³»ç»Ÿéƒ½æ˜¯OLAPç³»ç»Ÿã€‚OLAPçš„ç”¨é€”å¦‚ä¸‹å…¬å¸å¯èƒ½ä¼šå°†9æœˆçš„æ‰‹æœºé”€å”®ä¸10æœˆçš„é”€å”®è¿›è¡Œæ¯”è¾ƒï¼Œç„¶åå°†è¿™äº›ç»“æœä¸å¯èƒ½å­˜å‚¨åœ¨æ­£ç¡®æ•°æ®åº“ä¸­çš„å¦ä¸€ä¸ªä½ç½®è¿›è¡Œæ¯”è¾ƒã€‚äºšé©¬é€Šåˆ†æå…¶å®¢æˆ·çš„è´­ä¹°æƒ…å†µï¼Œä»¥æä¾›ä¸ªæ€§åŒ–çš„ä¸»é¡µï¼Œå…¶ä¸­åŒ…å«å…¶å®¢æˆ·å¯èƒ½æ„Ÿå…´è¶£çš„äº§å“ã€‚OLTPç³»ç»Ÿç¤ºä¾‹OLTPç³»ç»Ÿçš„ä¸€ä¸ªç¤ºä¾‹æ˜¯ATMä¸­å¿ƒã€‚å‡è®¾ä¸€å¯¹å¤«å¦‡åœ¨é“¶è¡Œæœ‰ä¸€ä¸ªè”åè´¦æˆ·ã€‚ä¸€å¤©ï¼Œä¸¤è€…éƒ½åŒæ—¶åœ¨ç²¾ç¡®çš„åŒä¸€æ—¶é—´åˆ°è¾¾ä¸åŒçš„ATMä¸­å¿ƒï¼Œå¹¶å¸Œæœ›æå–å…¶é“¶è¡Œå¸æˆ·ä¸­çš„æ€»é‡‘é¢ã€‚ä½†æ˜¯ï¼Œé¦–å…ˆå®Œæˆèº«ä»½éªŒè¯è¿‡ç¨‹çš„äººå°†èƒ½å¤Ÿèµšé’±ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒOLTPç³»ç»Ÿç¡®ä¿ææ¬¾é‡‘é¢æ°¸è¿œä¸ä¼šè¶…è¿‡é“¶è¡Œä¸­å­˜åœ¨çš„é‡‘é¢ã€‚è¿™é‡Œè¦æ³¨æ„çš„å…³é”®æ˜¯OLTPç³»ç»Ÿé’ˆå¯¹äº‹åŠ¡ä¼˜åŠ¿è¿›è¡Œäº†ä¼˜åŒ–ï¼Œè€Œä¸æ˜¯æ•°æ®åˆ†æã€‚OLTPç³»ç»Ÿçš„å…¶ä»–ç¤ºä¾‹æ˜¯ï¼šç½‘ä¸Šé“¶è¡Œä¸šåŠ¡ç½‘ä¸Šæœºç¥¨é¢„è®¢å‘é€çŸ­ä¿¡è®¢å•è¾“å…¥å°†ä¹¦æ·»åŠ åˆ°è´­ç‰©è½¦ä½¿ç”¨OLAPæœåŠ¡çš„å¥½å¤„OLAPä¸ºæ‰€æœ‰ç±»å‹çš„ä¸šåŠ¡åˆ†æéœ€æ±‚ï¼ˆåŒ…æ‹¬è®¡åˆ’ï¼Œé¢„ç®—ï¼Œé¢„æµ‹å’Œåˆ†æï¼‰åˆ›å»ºä¸€ä¸ªå¹³å°ã€‚OLAPçš„ä¸»è¦å¥½å¤„æ˜¯ä¿¡æ¯å’Œè®¡ç®—çš„ä¸€è‡´æ€§ã€‚è½»æ¾å¯¹ç”¨æˆ·å’Œå¯¹è±¡æ–½åŠ å®‰å…¨é™åˆ¶ï¼Œä»¥ç¬¦åˆæ³•è§„å¹¶ä¿æŠ¤æ•æ„Ÿæ•°æ®ã€‚OLTPæ–¹æ³•çš„å¥½å¤„å®ƒç®¡ç†ç»„ç»‡çš„æ—¥å¸¸äº¤æ˜“ã€‚OLTPé€šè¿‡ç®€åŒ–å•ä¸ªæµç¨‹æ¥æ‰©å¤§ç»„ç»‡çš„å®¢æˆ·åŸºç¡€ã€‚OLAPæœåŠ¡çš„ç¼ºç‚¹å®æ–½å’Œç»´æŠ¤ä¾èµ–äºITä¸“ä¸šäººå‘˜ï¼Œå› ä¸ºä¼ ç»Ÿçš„OLAPå·¥å…·éœ€è¦å¤æ‚çš„å»ºæ¨¡è¿‡ç¨‹ã€‚OLAPå·¥å…·éœ€è¦å„ä¸ªéƒ¨é—¨äººå‘˜ä¹‹é—´çš„åˆä½œæ‰èƒ½æœ‰æ•ˆï¼Œè€Œè¿™é€šå¸¸æ˜¯ä¸å¯èƒ½çš„ã€‚OLTPæ–¹æ³•çš„ç¼ºç‚¹å¦‚æœOLTPç³»ç»Ÿé¢ä¸´ç¡¬ä»¶æ•…éšœï¼Œåˆ™åœ¨çº¿äº¤æ˜“ä¼šå—åˆ°ä¸¥é‡å½±å“ã€‚OLTPç³»ç»Ÿå…è®¸å¤šä¸ªç”¨æˆ·åŒæ—¶è®¿é—®å’Œæ›´æ”¹åŒä¸€æ•°æ®ï¼Œè¿™å¤šæ¬¡åˆ›é€ äº†å‰æ‰€æœªæœ‰çš„å±€é¢ã€‚OLTPå’ŒOLAPä¹‹é—´çš„åŒºåˆ«å‚é‡OLTPOLAPå¤„ç†è¿™æ˜¯ä¸€ä¸ªåœ¨çº¿äº¤æ˜“ç³»ç»Ÿã€‚å®ƒç®¡ç†æ•°æ®åº“ä¿®æ”¹ã€‚OLAPæ˜¯ä¸€ä¸ªåœ¨çº¿åˆ†æå’Œæ•°æ®æ£€ç´¢è¿‡ç¨‹ã€‚ç‰¹æ€§å®ƒçš„ç‰¹ç‚¹æ˜¯å¤§é‡çš„çŸ­æœŸåœ¨çº¿äº¤æ˜“ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯æ•°æ®é‡å¤§ã€‚åŠŸèƒ½æ€§OLTPæ˜¯ä¸€ä¸ªåœ¨çº¿æ•°æ®åº“ä¿®æ”¹ç³»ç»Ÿã€‚OLAPæ˜¯ä¸€ä¸ªåœ¨çº¿æ•°æ®åº“æŸ¥è¯¢ç®¡ç†ç³»ç»Ÿã€‚æ–¹æ³•OLTPä½¿ç”¨ä¼ ç»Ÿçš„DBMSã€‚OLAPä½¿ç”¨æ•°æ®ä»“åº“ã€‚è¯¢é—®ä»æ•°æ®åº“ä¸­æ’å…¥ï¼Œæ›´æ–°å’Œåˆ é™¤ä¿¡æ¯ã€‚ä¸»è¦æ˜¯é€‰æ‹©æ“ä½œè¡¨OLTPæ•°æ®åº“ä¸­çš„è¡¨å·²æ ‡å‡†åŒ–ã€‚OLAPæ•°æ®åº“ä¸­çš„è¡¨æœªè§„èŒƒåŒ–ã€‚èµ„æºOLTPåŠå…¶äº‹åŠ¡æ˜¯æ•°æ®æºã€‚ä¸åŒçš„OLTPæ•°æ®åº“æˆä¸ºOLAPçš„æ•°æ®æºã€‚æ•°æ®çš„å®Œæ•´æ€§OLTPæ•°æ®åº“å¿…é¡»ç»´æŠ¤æ•°æ®å®Œæ•´æ€§çº¦æŸã€‚OLAPæ•°æ®åº“ä¸ä¼šç»å¸¸ä¿®æ”¹ã€‚å› æ­¤ï¼Œæ•°æ®å®Œæ•´æ€§ä¸æ˜¯é—®é¢˜ã€‚å“åº”æ—¶é—´å®ƒçš„å“åº”æ—¶é—´ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚å“åº”æ—¶é—´ä»¥ç§’ä¸ºå•ä½ã€‚èµ„æ–™å“è´¨OLTPæ•°æ®åº“ä¸­çš„æ•°æ®å§‹ç»ˆæ˜¯è¯¦ç»†å’Œç»„ç»‡çš„ã€‚OLAPæµç¨‹ä¸­çš„æ•°æ®å¯èƒ½æ²¡æœ‰ç»„ç»‡ã€‚æœ‰ç”¨æ€§å®ƒæœ‰åŠ©äºæ§åˆ¶å’Œè¿è¡ŒåŸºæœ¬ä¸šåŠ¡ä»»åŠ¡ã€‚å®ƒæœ‰åŠ©äºè®¡åˆ’ï¼Œé—®é¢˜è§£å†³å’Œå†³ç­–æ”¯æŒã€‚è¿ä½œæ–¹å¼å…è®¸è¯»/å†™æ“ä½œã€‚åªè¯»ï¼Œå¾ˆå°‘å†™ã€‚å¬ä¼—è¿™æ˜¯ä¸€ä¸ªé¢å‘å¸‚åœºçš„è¿‡ç¨‹ã€‚è¿™æ˜¯ä¸€ä¸ªä»¥å®¢æˆ·ä¸ºå¯¼å‘çš„è¿‡ç¨‹ã€‚æŸ¥è¯¢ç±»å‹æ­¤è¿‡ç¨‹ä¸­çš„æŸ¥è¯¢æ˜¯æ ‡å‡†åŒ–ä¸”ç®€å•çš„ã€‚æ¶‰åŠèšåˆçš„å¤æ‚æŸ¥è¯¢ã€‚åå¤‡å®Œæ•´çš„æ•°æ®å¤‡ä»½ä¸å¢é‡å¤‡ä»½ç›¸ç»“åˆã€‚OLAPä»…éœ€è¦ä¸æ—¶å¤‡ä»½ã€‚ä¸OLTPç›¸æ¯”ï¼Œå¤‡ä»½å¹¶ä¸é‡è¦è®¾è®¡æ•°æ®åº“è®¾è®¡æ˜¯é¢å‘åº”ç”¨ç¨‹åºçš„ã€‚ç¤ºä¾‹ï¼šæ•°æ®åº“è®¾è®¡éšé›¶å”®ï¼Œèˆªç©ºå…¬å¸ï¼Œé“¶è¡Œç­‰è¡Œä¸šçš„å˜åŒ–è€Œå˜åŒ–æ•°æ®åº“è®¾è®¡æ˜¯é¢å‘ä¸»é¢˜çš„ã€‚ç¤ºä¾‹ï¼šæ•°æ®åº“è®¾è®¡éšé”€å”®ï¼Œå¸‚åœºè¥é”€ï¼Œé‡‡è´­ç­‰ä¸»é¢˜è€Œå˜åŒ–ã€‚ç”¨æˆ·ç±»å‹æ•°æ®å…³é”®ç”¨æˆ·ï¼ˆå¦‚ä¸šåŠ¡å‘˜ï¼ŒDBAå’Œæ•°æ®åº“ä¸“ä¸šäººå‘˜ï¼‰ä½¿ç”¨å®ƒã€‚ç”±æ•°æ®çŸ¥è¯†ç”¨æˆ·ï¼ˆä¾‹å¦‚å·¥äººï¼Œç»ç†å’ŒCEOï¼‰ä½¿ç”¨ã€‚ç›®çš„ä¸“ä¸ºå®æ—¶ä¸šåŠ¡è¿è¥è€Œè®¾è®¡ã€‚è®¾è®¡ç”¨äºæŒ‰ç±»åˆ«å’Œå±æ€§åˆ†æä¸šåŠ¡åº¦é‡ã€‚ç»©æ•ˆæŒ‡æ ‡äº‹åŠ¡ååé‡æ˜¯æ€§èƒ½æŒ‡æ ‡æŸ¥è¯¢ååé‡æ˜¯æ€§èƒ½æŒ‡æ ‡ã€‚ç”¨æˆ·æ•°è¿™ç§æ•°æ®åº“ç”¨æˆ·å…è®¸æˆåƒä¸Šä¸‡çš„ç”¨æˆ·ã€‚è¿™ç§æ•°æ®åº“ä»…å…è®¸æ•°ç™¾ä¸ªç”¨æˆ·ã€‚ç”Ÿäº§ç‡å®ƒæœ‰åŠ©äºæé«˜ç”¨æˆ·çš„è‡ªåŠ©æœåŠ¡å’Œç”Ÿäº§ç‡å¸®åŠ©æé«˜ä¸šåŠ¡åˆ†æå¸ˆçš„ç”Ÿäº§ç‡ã€‚æŒ‘æˆ˜ä»å†å²ä¸Šçœ‹ï¼Œæ•°æ®ä»“åº“ä¸€ç›´æ˜¯ä¸€ä¸ªå¼€å‘é¡¹ç›®ï¼Œå¯èƒ½è¯æ˜æ„å»ºæˆæœ¬å¾ˆé«˜ã€‚OLAPå¤šç»´æ•°æ®é›†ä¸æ˜¯å¼€æ”¾çš„SQL Serveræ•°æ®ä»“åº“ã€‚å› æ­¤ï¼ŒæŠ€æœ¯çŸ¥è¯†å’Œç»éªŒå¯¹äºç®¡ç†OLAPæœåŠ¡å™¨è‡³å…³é‡è¦ã€‚å¤„ç†å®ƒä¸ºæ—¥å¸¸ä½¿ç”¨çš„æ•°æ®æä¾›äº†å¿«é€Ÿçš„ç»“æœã€‚å®ƒç¡®ä¿å¯¹æŸ¥è¯¢çš„å“åº”æ›´å¿«ï¼Œæ›´ä¸€è‡´ã€‚ç‰¹æ€§å®ƒæ˜“äºåˆ›å»ºå’Œç»´æŠ¤ã€‚å®ƒä½¿ç”¨æˆ·å¯ä»¥åœ¨ç”µå­è¡¨æ ¼çš„å¸®åŠ©ä¸‹åˆ›å»ºè§†å›¾ã€‚æ ·å¼OLTPè¢«è®¾è®¡ä¸ºå…·æœ‰å¿«é€Ÿå“åº”æ—¶é—´ï¼Œä½æ•°æ®å†—ä½™å¹¶å·²æ ‡å‡†åŒ–ã€‚æ•°æ®ä»“åº“æ˜¯å”¯ä¸€åˆ›å»ºçš„ï¼Œå› æ­¤å®ƒå¯ä»¥é›†æˆä¸åŒçš„æ•°æ®æºä»¥æ„å»ºç»Ÿä¸€çš„æ•°æ®åº“å…³é”®åŒºåˆ«åœ¨çº¿åˆ†æå¤„ç†ï¼ˆOLAPï¼‰æ˜¯ä¸€ç±»è½¯ä»¶å·¥å…·ï¼Œå¯ä»¥åˆ†æå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œè€Œåœ¨çº¿äº‹åŠ¡å¤„ç†ï¼ˆOLTPï¼‰æ”¯æŒ3å±‚ä½“ç³»ç»“æ„ä¸­é¢å‘äº‹åŠ¡çš„åº”ç”¨ç¨‹åºã€‚OLAPä¸ºæ‰€æœ‰ç±»å‹çš„ä¸šåŠ¡åˆ†æéœ€æ±‚ï¼ˆåŒ…æ‹¬è®¡åˆ’ï¼Œé¢„ç®—ï¼Œé¢„æµ‹å’Œåˆ†æï¼‰åˆ›å»ºä¸€ä¸ªå¹³å°ï¼Œè€ŒOLTPå¯¹ç®¡ç†ç»„ç»‡çš„æ—¥å¸¸äº‹åŠ¡å¾ˆæœ‰ç”¨ã€‚OLAPçš„ç‰¹ç‚¹æ˜¯æ•°æ®é‡å¤§ï¼Œè€ŒOLTPçš„ç‰¹ç‚¹æ˜¯å¤§é‡çš„çŸ­æ—¶é—´åœ¨çº¿äº¤æ˜“ã€‚åœ¨OLAPä¸­ï¼Œæ•°æ®ä»“åº“æ˜¯å”¯ä¸€åˆ›å»ºçš„ï¼Œå› æ­¤å®ƒå¯ä»¥é›†æˆä¸åŒçš„æ•°æ®æºä»¥æ„å»ºç»Ÿä¸€çš„æ•°æ®åº“ï¼Œè€ŒOLTPä½¿ç”¨ä¼ ç»Ÿçš„DBMSã€‚","categories":[{"name":"DataBase","slug":"DataBase","permalink":"cpeixin.cn/categories/DataBase/"}],"tags":[{"name":"OLAP","slug":"OLAP","permalink":"cpeixin.cn/tags/OLAP/"}]},{"title":"Flink æ•°æ®æµå®¹é”™","slug":"Flink-æ•°æ®æµå®¹é”™","date":"2018-03-30T10:09:11.000Z","updated":"2020-05-13T13:30:19.746Z","comments":true,"path":"2018/03/30/Flink-æ•°æ®æµå®¹é”™/","link":"","permalink":"cpeixin.cn/2018/03/30/Flink-%E6%95%B0%E6%8D%AE%E6%B5%81%E5%AE%B9%E9%94%99/","excerpt":"","text":"ä»‹ç»Apache Flinkæä¾›äº†ä¸€ç§å®¹é”™æœºåˆ¶ï¼Œå¯ä»¥ä¸€è‡´åœ°æ¢å¤æ•°æ®æµåº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚è¯¥æœºåˆ¶ç¡®ä¿å³ä½¿åœ¨å‡ºç°æ•…éšœçš„æƒ…å†µä¸‹ï¼Œç¨‹åºçš„çŠ¶æ€æœ€ç»ˆä¹Ÿå°†exactly onceåæ˜ å‡ºæ•°æ®æµä¸­çš„æ¯ä¸ªè®°å½•ã€‚è¯·æ³¨æ„ï¼Œæœ‰ä¸€ä¸ªå¼€å…³å¯ä»¥è‡³å°‘_å°†æ‹…ä¿_é™çº§ä¸€æ¬¡å®¹é”™æœºåˆ¶è¿ç»­ç»˜åˆ¶åˆ†å¸ƒå¼æµæ•°æ®æµçš„å¿«ç…§ã€‚å¯¹äºçŠ¶æ€å°çš„æµåº”ç”¨ç¨‹åºï¼Œè¿™äº›å¿«ç…§éå¸¸è½»å·§ï¼Œå¯ä»¥åœ¨ä¸å½±å“æ€§èƒ½çš„æƒ…å†µä¸‹é¢‘ç¹ç»˜åˆ¶ã€‚æµåº”ç”¨ç¨‹åºçš„çŠ¶æ€å­˜å‚¨åœ¨å¯é…ç½®çš„ä½ç½®ï¼ˆä¾‹å¦‚ä¸»èŠ‚ç‚¹æˆ–HDFSï¼‰ã€‚å¦‚æœå‘ç”Ÿç¨‹åºæ•…éšœï¼ˆç”±äºæœºå™¨ï¼Œç½‘ç»œæˆ–è½¯ä»¶æ•…éšœï¼‰ï¼ŒFlinkå°†åœæ­¢åˆ†å¸ƒå¼æµæ•°æ®æµã€‚ç„¶åï¼Œç³»ç»Ÿé‡æ–°å¯åŠ¨operatorsï¼Œå¹¶å°†å…¶é‡ç½®ä¸ºæœ€æ–°çš„æˆåŠŸæ£€æŸ¥ç‚¹ã€‚è¾“å…¥æµå°†é‡ç½®ä¸ºçŠ¶æ€å¿«ç…§çš„ç‚¹ã€‚ç¡®ä¿ä½œä¸ºé‡æ–°å¯åŠ¨çš„å¹¶è¡Œæ•°æ®æµçš„ä¸€éƒ¨åˆ†å¤„ç†çš„ä»»ä½•è®°å½•éƒ½ä¸å±äºå…ˆå‰çš„æ£€æŸ¥ç‚¹çŠ¶æ€ã€‚_æ³¨æ„ï¼š_é»˜è®¤æƒ…å†µä¸‹ï¼Œæ£€æŸ¥ç‚¹æ˜¯ç¦ç”¨çš„ã€‚æœ‰å…³å¦‚ä½•å¯ç”¨å’Œé…ç½®æ£€æŸ¥ç‚¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§æ£€æŸ¥ç‚¹ã€‚_æ³¨æ„ï¼š_ä¸ºäº†ä½¿è¯¥æœºåˆ¶å®ç°å…¶å…¨éƒ¨ä¿è¯ï¼Œæ•°æ®æºï¼ˆä¾‹å¦‚æ¶ˆæ¯é˜Ÿåˆ—æˆ–ä»£ç†ï¼‰å¿…é¡»èƒ½å¤Ÿå°†æµåé€€åˆ°å®šä¹‰çš„æœ€è¿‘ç‚¹ã€‚Apache Kafkaå…·æœ‰æ­¤åŠŸèƒ½(kafka 0.11ç‰ˆæœ¬åæ”¯æŒ)ï¼ŒFlinkä¸Kafkaçš„è¿æ¥å™¨åˆ©ç”¨äº†æ­¤åŠŸèƒ½ã€‚æœ‰å…³Flinkè¿æ¥å™¨æä¾›çš„ä¿è¯çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§æ•°æ®æºå’Œæ¥æ”¶å™¨çš„å®¹é”™ä¿è¯ã€‚_æ³¨æ„ï¼š_ç”±äºFlinkçš„checkpointsæ˜¯é€šè¿‡åˆ†å¸ƒå¼å¿«ç…§å®ç°çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥äº¤æ›¿ä½¿ç”¨_snapshot_å’Œcheckpointä¸€è¯ã€‚CheckpointFlinkå®¹é”™æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†æ˜¯ç»˜åˆ¶åˆ†å¸ƒå¼æ•°æ®æµå’Œoperator stateçš„ä¸€è‡´å¿«ç…§ã€‚è¿™äº›å¿«ç…§å……å½“ä¸€è‡´çš„æ£€æŸ¥ç‚¹ï¼Œå¦‚æœå‘ç”Ÿæ•…éšœï¼Œç³»ç»Ÿå¯ä»¥å›é€€åˆ°è¿™äº›æ£€æŸ¥ç‚¹ã€‚Flinkç»˜åˆ¶è¿™äº›å¿«ç…§çš„æœºåˆ¶åœ¨â€œ åˆ†å¸ƒå¼æ•°æ®æµçš„è½»é‡çº§å¼‚æ­¥å¿«ç…§ â€ä¸­è¿›è¡Œäº†ä»‹ç»ã€‚å®ƒå—ç”¨äºåˆ†å¸ƒå¼å¿«ç…§çš„æ ‡å‡†Chandy-Lamportç®—æ³•çš„å¯å‘ï¼Œå¹¶ä¸”ä¸“é—¨é’ˆå¯¹Flinkçš„æ‰§è¡Œæ¨¡å‹è¿›è¡Œäº†é‡èº«å®šåˆ¶ã€‚Barriersæµå±éšœ(barriers)æ˜¯Flinkåˆ†å¸ƒå¼å¿«ç…§ä¸­çš„æ ¸å¿ƒå…ƒç´ ã€‚è¿™äº›barrierså°†æ³¨å…¥åˆ°æ•°æ®æµä¸­ï¼Œå¹¶ä¸è®°å½•ä¸€èµ·ä½œä¸ºæ•°æ®æµçš„ä¸€éƒ¨åˆ†æµåŠ¨ã€‚å£å’ä»ä¸è¶…è¶Šè®°å½•ï¼Œå®ƒä»¬ä¸¥æ ¼æŒ‰ç…§é¡ºåºæ’åˆ—ã€‚å±éšœå°†æ•°æ®æµä¸­çš„è®°å½•åˆ†ä¸ºè¿›å…¥å½“å‰å¿«ç…§çš„è®°å½•é›†å’Œè¿›å…¥ä¸‹ä¸€ä¸ªå¿«ç…§çš„è®°å½•é›†ã€‚æ¯ä¸ªå±éšœéƒ½å¸¦æœ‰å¿«ç…§çš„IDï¼Œå¿«ç…§çš„è®°å½•å·²æ¨é€åˆ°å¿«ç…§çš„å‰é¢ã€‚å±éšœä¸ä¼šä¸­æ–­æµçš„æµåŠ¨ï¼Œå› æ­¤éå¸¸è½»ä¾¿ã€‚æ¥è‡ªä¸åŒå¿«ç…§çš„å¤šä¸ªéšœç¢å¯ä»¥åŒæ—¶å‡ºç°åœ¨æµä¸­ï¼Œè¿™æ„å‘³ç€å„ç§å¿«ç…§å¯èƒ½åŒæ—¶å‘ç”Ÿã€‚_æµå±éšœ(barriers)åœ¨æµæºå¤„æ³¨å…¥å¹¶è¡Œæ•°æ®æµä¸­ã€‚å¿«ç…§nçš„å±éšœè¢«æ³¨å…¥çš„ç‚¹ï¼ˆæˆ‘ä»¬ç§°å…¶ä¸º_S _ï¼‰æ˜¯å¿«ç…§ä¸­è¦†ç›–æ•°æ®çš„æºæµä¸­çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼Œåœ¨Apache Kafkaä¸­ï¼Œæ­¤ä½ç½®å°†æ˜¯åˆ†åŒºä¸­æœ€åä¸€æ¡è®°å½•çš„åç§»é‡ã€‚è¯¥ä½ç½®_S _è¢«æŠ¥å‘Šç»™_æ£€æŸ¥ç‚¹åè°ƒå™¨_ï¼ˆFlinkçš„JobManagerï¼‰ã€‚ç„¶åï¼Œå±éšœå‘ä¸‹æ¸¸æµåŠ¨ã€‚å½“ä¸­é—´operatorä»å…¶æ‰€æœ‰è¾“å…¥æµä¸­æ”¶åˆ°å¿«ç…§nçš„å±éšœæ—¶ï¼Œå®ƒä¼šå°†å¿«ç…§nçš„å±éšœå‘å°„åˆ°å…¶æ‰€æœ‰è¾“å‡ºæµä¸­ã€‚æ¥æ”¶å™¨è¿ç®—ç¬¦ï¼ˆæµå¼DAGçš„æœ«å°¾ï¼‰ä»å…¶æ‰€æœ‰è¾“å…¥æµæ¥æ”¶åˆ°å±éšœnåï¼Œä¾¿å°†å¿«ç…§nç¡®è®¤ç»™æ£€æŸ¥ç‚¹åè°ƒå™¨ã€‚æ‰€æœ‰æ¥æ”¶å™¨éƒ½ç¡®è®¤å¿«ç…§åï¼Œå°±è®¤ä¸ºå¿«ç…§å·²å®Œæˆã€‚ä¸€æ—¦å¿«ç…§nå®Œæˆï¼Œè¯¥ä½œä¸šå°†å†ä¹Ÿä¸ä¼šå‘æºè¯¢é—®_S _ä¹‹å‰çš„è®°å½•ï¼Œå› ä¸ºæ­¤æ—¶è¿™äº›è®°å½•ï¼ˆåŠå…¶åä»£è®°å½•ï¼‰å°†é€šè¿‡æ•´ä¸ªæ•°æ®æµæ‹“æ‰‘ã€‚æ¥æ”¶å¤šä¸ªè¾“å…¥æµçš„operatoréœ€è¦åœ¨å¿«ç…§barriersä¸Š_å¯¹é½_è¾“å…¥æµã€‚ä¸Šå›¾è¯´æ˜äº†è¿™ä¸€ç‚¹ï¼šoperatorä¸€æ—¦ä»ä¼ å…¥æµæ¥æ”¶åˆ°å¿«ç…§å±éšœnï¼Œå°±æ— æ³•å¤„ç†è¯¥æµä¸­çš„ä»»ä½•å…¶ä»–è®°å½•ï¼Œç›´åˆ°å®ƒä¹Ÿä»å…¶ä»–è¾“å…¥æ¥æ”¶åˆ°å±éšœnä¸ºæ­¢ã€‚å¦åˆ™ï¼Œå®ƒå°†æ··åˆå±äºå¿«ç…§_nçš„_è®°å½•å’Œå±äºå¿«ç…§_n + 1çš„è®°å½•_ã€‚æŠ¥å‘Šå±éšœ_nçš„_æµè¢«æš‚æ—¶æç½®ã€‚ä»è¿™äº›æµæ¥æ”¶åˆ°çš„è®°å½•å°†ä¸è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯æ”¾å…¥è¾“å…¥ç¼“å†²åŒºä¸­ã€‚ä¸€æ—¦æœ€åä¸€ä¸ªæµæ¥æ”¶åˆ°å±éšœnï¼Œæ“ä½œå‘˜å°†å‘å‡ºæ‰€æœ‰æœªå†³çš„ä¼ å‡ºè®°å½•ï¼Œç„¶åè‡ªèº«å‘å‡ºå¿«ç…§nå±éšœã€‚æ­¤åï¼Œå®ƒå°†æ¢å¤å¤„ç†æ‰€æœ‰è¾“å…¥æµä¸­çš„è®°å½•ï¼Œå¤„ç†è¾“å…¥ç¼“å†²ä¸­çš„è®°å½•ï¼Œç„¶åå†å¤„ç†æµä¸­çš„è®°å½•ã€‚Stateå½“è¿ç®—ç¬¦åŒ…å«ä»»ä½•å½¢å¼çš„_çŠ¶æ€æ—¶_ï¼Œè¯¥çŠ¶æ€ä¹Ÿå¿…é¡»æ˜¯å¿«ç…§çš„ä¸€éƒ¨åˆ†ã€‚operatorçŠ¶æ€ä»¥ä¸åŒçš„å½¢å¼å‡ºç°ï¼š_ç”¨æˆ·å®šä¹‰çš„çŠ¶æ€_ï¼šè¿™æ˜¯ç”±è½¬æ¢åŠŸèƒ½ï¼ˆå¦‚map()æˆ–filter()ï¼‰ç›´æ¥åˆ›å»ºå’Œä¿®æ”¹çš„çŠ¶æ€ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§æµåº”ç”¨ç¨‹åºä¸­çš„çŠ¶æ€ã€‚_ç³»ç»ŸçŠ¶æ€_ï¼šæ­¤çŠ¶æ€æ˜¯æŒ‡ä½œä¸ºæ“ä½œå‘˜è®¡ç®—çš„ä¸€éƒ¨åˆ†çš„æ•°æ®ç¼“å†²åŒºã€‚è¿™ç§çŠ¶æ€çš„ä¸€ä¸ªå…¸å‹ç¤ºä¾‹æ˜¯_çª—å£ç¼“å†²åŒº_ï¼Œç³»ç»Ÿåœ¨å…¶ä¸­æ”¶é›†ï¼ˆå¹¶æ±‡æ€»ï¼‰çª—å£è®°å½•ï¼Œç›´åˆ°è¯„ä¼°å¹¶é€å‡ºçª—å£ä¸ºæ­¢ã€‚æ“ä½œå‘˜åœ¨ä»è¾“å…¥æµæ¥æ”¶åˆ°æ‰€æœ‰å¿«ç…§barriersçš„æ—¶é—´ç‚¹ï¼Œä»¥åŠåœ¨å°†barrierså‘é€åˆ°å…¶è¾“å‡ºæµä¹‹å‰ï¼Œå¯¹å…¶çŠ¶æ€è¿›è¡Œå¿«ç…§ã€‚å±Šæ—¶ï¼Œå°†å¯¹è¿›è¡Œéšœç¢ä¹‹å‰çš„è®°å½•è¿›è¡Œçš„æ‰€æœ‰çŠ¶æ€æ›´æ–°ï¼Œå¹¶ä¸”ä¸ä¾èµ–äºåº”ç”¨éšœç¢åçš„è®°å½•è¿›è¡Œçš„ä»»ä½•æ›´æ–°ã€‚ç”±äºå¿«ç…§çš„çŠ¶æ€å¯èƒ½å¾ˆå¤§ï¼Œå› æ­¤å°†å…¶å­˜å‚¨åœ¨å¯é…ç½®state _backendä¸­_ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ˜¯JobManagerçš„å†…å­˜ï¼Œä½†å¯¹äºç”Ÿäº§ç”¨é€”ï¼Œåº”é…ç½®åˆ†å¸ƒå¼å¯é å­˜å‚¨ï¼ˆä¾‹å¦‚HDFSï¼‰ã€‚å­˜å‚¨çŠ¶æ€åï¼Œæ“ä½œå‘˜ç¡®è®¤æ£€æŸ¥ç‚¹ï¼Œå°†å¿«ç…§å±éšœå‘é€åˆ°è¾“å‡ºæµä¸­ï¼Œç„¶åç»§ç»­ã€‚ç°åœ¨ç”Ÿæˆçš„å¿«ç…§åŒ…å«ï¼šå¯¹äºæ¯ä¸ªå¹¶è¡Œæµæ•°æ®æºï¼Œå¿«ç…§å¯åŠ¨æ—¶æµä¸­çš„åç§»é‡/ä½ç½®å¯¹äºæ¯ä¸ªè¿ç®—ç¬¦ï¼ŒæŒ‡å‘ä½œä¸ºå¿«ç…§ä¸€éƒ¨åˆ†å­˜å‚¨çš„çŠ¶æ€çš„æŒ‡é’ˆExactly Once vs. At Least Onceå¯¹å‡†æ­¥éª¤å¯ä»¥å‘æµä¼ è¾“ç¨‹åºå¢åŠ ç­‰å¾…æ—¶é—´ã€‚é€šå¸¸ï¼Œè¿™ç§é¢å¤–çš„å»¶è¿Ÿå¤§çº¦æ˜¯å‡ æ¯«ç§’ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°ä¸€äº›å¼‚å¸¸å€¼çš„å»¶è¿Ÿæ˜¾ç€å¢åŠ çš„æƒ…å†µã€‚å¯¹äºè¦æ±‚æ‰€æœ‰è®°å½•å§‹ç»ˆå…·æœ‰è¶…ä½å»¶è¿Ÿï¼ˆå‡ æ¯«ç§’ï¼‰çš„åº”ç”¨ç¨‹åºï¼ŒFlinkå¯ä»¥è¿›è¡Œåˆ‡æ¢ä»¥åœ¨æ£€æŸ¥ç‚¹æœŸé—´è·³è¿‡æµå¯¹é½ã€‚ä¸€æ—¦æ“ä½œå‘˜ä»æ¯ä¸ªè¾“å…¥çœ‹åˆ°æ£€æŸ¥ç‚¹éšœç¢ï¼Œä»ç„¶ä¼šç»˜åˆ¶æ£€æŸ¥ç‚¹å¿«ç…§ã€‚è·³è¿‡å¯¹é½åï¼Œå³ä½¿åˆ°è¾¾æ£€æŸ¥ç‚¹nçš„_æŸäº›æ£€æŸ¥ç‚¹éšœç¢ï¼Œæ“ä½œå‘˜ä»ä¼šç»§ç»­å¤„ç†æ‰€æœ‰è¾“å…¥ã€‚è¿™æ ·ï¼Œæ“ä½œå‘˜è¿˜å¯ä»¥åœ¨è·å–æ£€æŸ¥ç‚¹nçš„çŠ¶æ€å¿«ç…§ä¹‹å‰å¤„ç†å±äºæ£€æŸ¥ç‚¹_n + 1çš„_å…ƒç´ ã€‚åœ¨è¿˜åŸæ—¶ï¼Œè¿™äº›è®°å½•å°†ä½œä¸ºé‡å¤è®°å½•å‡ºç°ï¼Œå› ä¸ºå®ƒä»¬éƒ½åŒ…å«åœ¨æ£€æŸ¥ç‚¹nçš„çŠ¶æ€å¿«ç…§ä¸­ï¼Œå¹¶å°†åœ¨æ£€æŸ¥ç‚¹nä¹‹åä½œä¸ºæ•°æ®çš„ä¸€éƒ¨åˆ†é‡æ’­ã€‚_æ³¨æ„_ï¼šå¯¹é½ä»…é€‚ç”¨äºå…·æœ‰å¤šä¸ªå‰ä»»ï¼ˆè”æ¥ï¼‰çš„è¿ç®—ç¬¦ä»¥åŠå…·æœ‰å¤šä¸ªå‘ä»¶äººçš„è¿ç®—ç¬¦ï¼ˆåœ¨æµé‡æ–°åˆ†åŒº/æ··æ´—ä¹‹åï¼‰ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œæœ‰æ•°æ®æµåªæœ‰å°´å°¬çš„å¹¶è¡Œæµæ“ä½œï¼ˆmap()ï¼ŒflatMap()ï¼Œfilter()ï¼Œâ€¦ï¼‰å®é™…ä¸Šç»™_æ­£å¥½ä¸€æ¬¡_ç”šè‡³åœ¨ä¿è¯_è‡³å°‘ä¸€æ¬¡_çš„æ¨¡å¼ã€‚Asynchronous State Snapshotsæ³¨æ„ï¼Œä¸Šè¿°æœºåˆ¶æ„å‘³ç€æ“ä½œå‘˜åœ¨å°†è¾“å…¥çŠ¶æ€çš„å¿«ç…§å­˜å‚¨åœ¨_çŠ¶æ€åç«¯æ—¶_åœæ­¢å¤„ç†è¾“å…¥è®°å½•ã€‚æ¯æ¬¡æ‹æ‘„å¿«ç…§æ—¶ï¼Œæ­¤_åŒæ­¥_çŠ¶æ€å¿«ç…§éƒ½ä¼šå¸¦æ¥å»¶è¿Ÿã€‚å¯ä»¥è®©operatoråœ¨å­˜å‚¨å…¶çŠ¶æ€å¿«ç…§æ—¶ç»§ç»­è¿›è¡Œå¤„ç†ï¼Œä»è€Œæœ‰æ•ˆåœ°ä½¿çŠ¶æ€å¿«ç…§åœ¨åå°_å¼‚æ­¥_å‘ç”Ÿã€‚ä¸ºæ­¤ï¼Œoperatorå¿…é¡»èƒ½å¤Ÿäº§ç”ŸçŠ¶æ€å¯¹è±¡ï¼Œè¯¥çŠ¶æ€å¯¹è±¡çš„å­˜å‚¨æ–¹å¼åº”ç¡®ä¿å¯¹æ“ä½œå‘˜çŠ¶æ€çš„è¿›ä¸€æ­¥ä¿®æ”¹ä¸ä¼šå½±å“è¯¥çŠ¶æ€å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œåœ¨RocksDBä¸­ä½¿ç”¨_çš„å†™æ—¶å¤åˆ¶_æ•°æ®ç»“æ„å…·æœ‰æ­¤è¡Œä¸ºã€‚åœ¨å…¶è¾“å…¥ä¸Šæ”¶åˆ°æ£€æŸ¥ç‚¹å±éšœåï¼Œæ“ä½œå‘˜å°†å¼€å§‹å¯¹å…¶çŠ¶æ€è¿›è¡Œå¼‚æ­¥å¿«ç…§å¤åˆ¶ã€‚å®ƒç«‹å³å¯¹è¾“å‡ºå‘å‡ºéšœç¢ï¼Œå¹¶ç»§ç»­è¿›è¡Œå¸¸è§„æµå¤„ç†ã€‚åå°å¤åˆ¶è¿‡ç¨‹å®Œæˆåï¼Œå®ƒå°†å‘æ£€æŸ¥ç‚¹åè°ƒå™¨ï¼ˆJobManagerï¼‰ç¡®è®¤æ£€æŸ¥ç‚¹ã€‚ç°åœ¨ï¼Œåªæœ‰åœ¨æ‰€æœ‰æ¥æ”¶å™¨éƒ½æ¥æ”¶åˆ°éšœç¢å¹¶ä¸”æ‰€æœ‰æœ‰çŠ¶æ€æ“ä½œå‘˜éƒ½å·²ç¡®è®¤å®Œæˆå¤‡ä»½åï¼ˆå¯èƒ½æ˜¯åœ¨éšœç¢åˆ°è¾¾æ¥æ”¶å™¨ä¹‹åï¼‰ï¼Œæ£€æŸ¥ç‚¹æ‰å®Œæˆã€‚æœ‰å…³çŠ¶æ€å¿«ç…§çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§çŠ¶æ€åç«¯ã€‚Recoveryåœ¨è¿™ç§æœºåˆ¶ä¸‹çš„æ¢å¤éå¸¸ç®€å•ï¼šå¤±è´¥æ—¶ï¼ŒFlinké€‰æ‹©æœ€æ–°å®Œæˆçš„æ£€æŸ¥ç‚¹kã€‚ç„¶åï¼Œç³»ç»Ÿé‡æ–°éƒ¨ç½²æ•´ä¸ªåˆ†å¸ƒå¼æ•°æ®æµï¼Œå¹¶ä¸ºæ¯ä¸ªæ“ä½œå‘˜æä¾›ä½œä¸ºæ£€æŸ¥ç‚¹_kçš„_ä¸€éƒ¨åˆ†å¿«ç…§çš„çŠ¶æ€ã€‚è®¾ç½®æºä»¥å¼€å§‹ä»ä½ç½®_S _è¯»å–æµã€‚ä¾‹å¦‚ï¼Œåœ¨Apache Kafkaä¸­ï¼Œè¿™æ„å‘³ç€å‘Šè¯‰ä½¿ç”¨è€…å¼€å§‹ä»åç§»é‡_S _è·å–ã€‚å¦‚æœçŠ¶æ€æ˜¯å¢é‡å¿«ç…§ï¼Œåˆ™æ“ä½œå‘˜å°†ä»æœ€æ–°å®Œæ•´å¿«ç…§çš„çŠ¶æ€å¼€å§‹ï¼Œç„¶åå¯¹è¯¥çŠ¶æ€åº”ç”¨ä¸€ç³»åˆ—å¢é‡å¿«ç…§æ›´æ–°ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§é‡æ–°å¯åŠ¨ç­–ç•¥ã€‚Operator Snapshot Implementationæ‹æ‘„æ“ä½œå‘˜å¿«ç…§æ—¶ï¼Œæœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼šåŒæ­¥éƒ¨åˆ†å’Œå¼‚æ­¥éƒ¨åˆ†ã€‚è¿ç®—ç¬¦å’ŒçŠ¶æ€åç«¯ä»¥Javaå½¢å¼æä¾›å…¶å¿«ç…§FutureTaskã€‚è¯¥ä»»åŠ¡åŒ…å«_åŒæ­¥_éƒ¨åˆ†å·²å®Œæˆè€Œ_å¼‚æ­¥_éƒ¨åˆ†æœªå†³çš„çŠ¶æ€ã€‚ç„¶åï¼Œå¼‚æ­¥éƒ¨åˆ†ç”±è¯¥æ£€æŸ¥ç‚¹çš„åå°çº¿ç¨‹æ‰§è¡Œã€‚çº¯ç²¹æ£€æŸ¥ç‚¹çš„æ“ä½œå‘˜å°†åŒæ­¥è¿”å›å·²å®Œæˆçš„æ“ä½œFutureTaskã€‚å¦‚æœéœ€è¦æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œåˆ™ä»¥run()that çš„æ–¹æ³•æ‰§è¡ŒFutureTaskã€‚è¿™äº›ä»»åŠ¡æ˜¯å¯å–æ¶ˆçš„ï¼Œå› æ­¤å¯ä»¥é‡Šæ”¾æµå’Œå…¶ä»–æ¶ˆè€—èµ„æºçš„å¥æŸ„ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Flink DataStream - Event Time","slug":"Flink-DataStream-Event-Time","date":"2018-03-25T10:09:11.000Z","updated":"2020-05-12T14:53:18.624Z","comments":true,"path":"2018/03/25/Flink-DataStream-Event-Time/","link":"","permalink":"cpeixin.cn/2018/03/25/Flink-DataStream-Event-Time/","excerpt":"","text":"Event Time / Processing Time / Ingestion TimeFlink åœ¨æµå¼ä¼ è¾“ç¨‹åºä¸­æ”¯æŒä¸åŒçš„_æ—¶é—´_æ¦‚å¿µã€‚å¤„ç†æ—¶é—´(Processing Time)ï¼šå¤„ç†æ—¶é—´æ˜¯æŒ‡æ‰§è¡Œç›¸åº”æ“ä½œçš„æœºå™¨çš„ç³»ç»Ÿæ—¶é—´ã€‚å½“æµå¼ç¨‹åºæŒ‰å¤„ç†æ—¶é—´è¿è¡Œæ—¶ï¼Œæ‰€æœ‰åŸºäºæ—¶é—´çš„æ“ä½œï¼ˆå¦‚æ—¶é—´çª—å£ï¼‰éƒ½å°†ä½¿ç”¨è¿è¡Œç›¸åº”æ“ä½œå‘˜çš„è®¡ç®—æœºçš„ç³»ç»Ÿæ—¶é’Ÿã€‚æ¯å°æ—¶å¤„ç†æ—¶é—´çª—å£å°†åŒ…æ‹¬ç³»ç»Ÿæ—¶é’ŸæŒ‡ç¤ºæ•´å°æ—¶çš„æ—¶é—´ä¹‹é—´åˆ°è¾¾ç‰¹å®šæ“ä½œå‘˜çš„æ‰€æœ‰è®°å½•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨ç¨‹åºåœ¨9:15 amå¼€å§‹è¿è¡Œï¼Œåˆ™ç¬¬ä¸€ä¸ªæ¯å°æ—¶å¤„ç†æ—¶é—´çª—å£å°†åŒ…æ‹¬åœ¨9:15 amå’Œ10:00 amä¹‹é—´å¤„ç†çš„äº‹ä»¶ï¼Œä¸‹ä¸€ä¸ªçª—å£å°†åŒ…æ‹¬åœ¨10:00 amå’Œ11:00 amä¹‹é—´å¤„ç†çš„äº‹ä»¶ï¼Œä¾æ­¤ç±»æ¨ã€‚å¤„ç†æ—¶é—´æ˜¯æœ€ç®€å•çš„æ—¶é—´æ¦‚å¿µï¼Œä¸éœ€è¦æµå’Œæœºå™¨ä¹‹é—´çš„åè°ƒã€‚å®ƒæä¾›äº†æœ€ä½³çš„æ€§èƒ½å’Œæœ€ä½çš„å»¶è¿Ÿã€‚ä½†æ˜¯ï¼Œåœ¨åˆ†å¸ƒå¼å’Œå¼‚æ­¥ç¯å¢ƒä¸­ï¼Œå¤„ç†æ—¶é—´ä¸èƒ½æä¾›ç¡®å®šæ€§ï¼Œå› ä¸ºå®ƒå®¹æ˜“å—åˆ°è®°å½•åˆ°è¾¾ç³»ç»Ÿï¼ˆä¾‹å¦‚ä»æ¶ˆæ¯é˜Ÿåˆ—ï¼‰åˆ°è¾¾ç³»ç»Ÿçš„é€Ÿåº¦ï¼Œè®°å½•åœ¨ç³»ç»Ÿå†…éƒ¨æ“ä½œå‘˜ä¹‹é—´æµåŠ¨çš„é€Ÿåº¦çš„å½±å“ã€‚ ä»¥åŠä¸­æ–­ï¼ˆè®¡åˆ’çš„æˆ–å…¶ä»–æ–¹å¼ï¼‰ã€‚äº‹ä»¶æ—¶é—´(Event time)ï¼šäº‹ä»¶æ—¶é—´æ˜¯æ¯ä¸ªäº‹ä»¶åœ¨å…¶ç”Ÿäº§è®¾å¤‡ä¸Šå‘ç”Ÿçš„æ—¶é—´ã€‚è¯¥æ—¶é—´é€šå¸¸åœ¨å®ƒä»¬è¿›å…¥Flinkä¹‹å‰åµŒå…¥åˆ°è®°å½•ä¸­ï¼Œå¹¶ä¸” å¯ä»¥ä»æ¯ä¸ªè®°å½•ä¸­æå–_äº‹ä»¶æ—¶é—´æˆ³_ã€‚åœ¨äº‹ä»¶æ—¶é—´ä¸­ï¼Œæ—¶é—´çš„è¿›åº¦å–å†³äºæ•°æ®ï¼Œè€Œä¸å–å†³äºä»»ä½•æŒ‚é’Ÿã€‚äº‹ä»¶æ—¶é—´ç¨‹åºå¿…é¡»æŒ‡å®šå¦‚ä½•ç”Ÿæˆâ€œ _äº‹ä»¶æ—¶é—´æ°´å°â€_ï¼Œè¿™æ˜¯ä¸€ç§è¡¨ç¤ºäº‹ä»¶æ—¶é—´è¿›å±•çš„æœºåˆ¶ã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œäº‹ä»¶æ—¶é—´å¤„ç†å°†äº§ç”Ÿå®Œå…¨ä¸€è‡´ä¸”ç¡®å®šçš„ç»“æœï¼Œè€Œä¸ç®¡äº‹ä»¶ä½•æ—¶åˆ°è¾¾æˆ–å®ƒä»¬çš„é¡ºåºå¦‚ä½•ã€‚ä½†æ˜¯ï¼Œé™¤éå·²çŸ¥äº‹ä»¶æ˜¯æŒ‰æ—¶é—´æˆ³ï¼ˆæŒ‰æ—¶é—´æˆ³ï¼‰åˆ°è¾¾çš„ï¼Œå¦åˆ™äº‹ä»¶æ—¶é—´å¤„ç†ä¼šåœ¨ç­‰å¾…æ— åºäº‹ä»¶æ—¶äº§ç”Ÿä¸€å®šçš„å»¶è¿Ÿã€‚ç”±äºåªèƒ½ç­‰å¾…æœ‰é™çš„æ—¶é—´ï¼Œå› æ­¤è¿™é™åˆ¶äº†ç¡®å®šæ€§äº‹ä»¶æ—¶é—´åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§ã€‚å‡è®¾æ‰€æœ‰æ•°æ®éƒ½å·²åˆ°è¾¾ï¼Œäº‹ä»¶æ—¶é—´æ“ä½œå°†æŒ‰é¢„æœŸæ–¹å¼è¿è¡Œï¼Œå³ä½¿åœ¨å¤„ç†æ— åºæˆ–è¿Ÿåˆ°çš„äº‹ä»¶æˆ–é‡æ–°å¤„ç†å†å²æ•°æ®æ—¶ï¼Œä¹Ÿä¼šäº§ç”Ÿæ­£ç¡®ä¸”ä¸€è‡´çš„ç»“æœã€‚ä¾‹å¦‚ï¼Œæ¯å°æ—¶äº‹ä»¶æ—¶é—´çª—å£å°†åŒ…å«æ‰€æœ‰å¸¦æœ‰è½å…¥è¯¥å°æ—¶äº‹ä»¶æ—¶é—´æˆ³çš„è®°å½•ï¼Œæ— è®ºå®ƒä»¬åˆ°è¾¾çš„é¡ºåºæˆ–å¤„ç†çš„æ—¶é—´ã€‚è¯·æ³¨æ„ï¼Œæœ‰æ—¶å½“äº‹ä»¶æ—¶é—´ç¨‹åºå®æ—¶å¤„ç†å®æ—¶æ•°æ®æ—¶ï¼Œå®ƒä»¬å°†ä½¿ç”¨ä¸€äº›_å¤„ç†æ—¶é—´_æ“ä½œï¼Œä»¥ç¡®ä¿å®ƒä»¬åŠæ—¶è¿›è¡Œã€‚æ‘„å–æ—¶é—´(Ingestion Time)ï¼šæ‘„å–æ—¶é—´æ˜¯äº‹ä»¶è¿›å…¥Flinkçš„æ—¶é—´ã€‚åœ¨æºæ“ä½œå‘˜å¤„ï¼Œæ¯ä¸ªè®°å½•éƒ½å°†æºçš„å½“å‰æ—¶é—´ä½œä¸ºæ—¶é—´æˆ³è®°ï¼Œå¹¶ä¸”åŸºäºæ—¶é—´çš„æ“ä½œï¼ˆå¦‚æ—¶é—´çª—å£ï¼‰å¼•ç”¨è¯¥æ—¶é—´æˆ³è®°ã€‚_æ‘„å–æ—¶é—´_ä»æ¦‚å¿µä¸Šè®²ä»‹äº_äº‹ä»¶æ—¶é—´å’Œå¤„ç†æ—¶é—´ä¹‹é—´_ã€‚ä¸_å¤„ç†æ—¶é—´_ç›¸æ¯” ï¼Œå®ƒç¨å¾®è´µä¸€äº›ï¼Œä½†ç»“æœå´æ›´å¯é¢„æµ‹ã€‚ç”±äº _æ‘„å–æ—¶é—´_ä½¿ç”¨ç¨³å®šçš„æ—¶é—´æˆ³ï¼ˆåœ¨æºå¤„åˆ†é…äº†ä¸€æ¬¡ï¼‰ï¼Œå› æ­¤å¯¹è®°å½•çš„ä¸åŒçª—å£æ“ä½œå°†å¼•ç”¨ç›¸åŒçš„æ—¶é—´æˆ³ï¼Œè€Œåœ¨_å¤„ç†æ—¶é—´ä¸­ï¼Œ_æ¯ä¸ªçª—å£æ“ä½œå‘˜éƒ½å¯ä»¥å°†è®°å½•åˆ†é…ç»™ä¸åŒçš„çª—å£ï¼ˆåŸºäºæœ¬åœ°ç³»ç»Ÿæ—¶é’Ÿå’Œä»»ä½•è¿è¾“å»¶è¯¯ï¼‰ã€‚ä¸_äº‹ä»¶æ—¶é—´_ç›¸æ¯”ï¼Œ_æå–æ—¶é—´_ç¨‹åºæ— æ³•å¤„ç†ä»»ä½•ä¹±åºäº‹ä»¶æˆ–è¿Ÿåˆ°çš„æ•°æ®ï¼Œä½†æ˜¯ç¨‹åºä¸å¿…æŒ‡å®šå¦‚ä½•ç”Ÿæˆ_æ°´å°_ã€‚åœ¨å†…éƒ¨ï¼Œ_æ‘„å–æ—¶é—´ä¸äº‹ä»¶æ—¶é—´_éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯å…·æœ‰è‡ªåŠ¨æ—¶é—´æˆ³åˆ†é…å’Œè‡ªåŠ¨æ°´å°ç”ŸæˆåŠŸèƒ½ã€‚è®¾ç½®æ—¶é—´ç‰¹å¾ï¼ˆSetting a Time Characteristicï¼‰Flink DataStreamç¨‹åºçš„ç¬¬ä¸€éƒ¨åˆ†é€šå¸¸è®¾ç½®åŸºå‡†_æ—¶é—´ç‰¹å¾_ã€‚è¯¥è®¾ç½®å®šä¹‰äº†æ•°æ®æµæºçš„è¡Œä¸ºæ–¹å¼ï¼ˆä¾‹å¦‚ï¼Œæ˜¯å¦åˆ†é…æ—¶é—´æˆ³ï¼‰ï¼Œä»¥åŠè¯¸å¦‚çš„çª—å£æ“ä½œåº”ä½¿ç”¨ä»€ä¹ˆæ—¶é—´æ¦‚å¿µKeyedStream.timeWindow(Time.seconds(30))ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ªFlinkç¨‹åºï¼Œè¯¥ç¨‹åºåœ¨æ¯å°æ—¶çš„æ—¶é—´çª—å£ä¸­æ±‡æ€»äº‹ä»¶ã€‚çª—å£çš„è¡Œä¸ºä¸æ—¶é—´ç‰¹å¾ç›¸é€‚åº”ã€‚1234567891011val env = StreamExecutionEnvironment.getExecutionEnvironmentenv.setStreamTimeCharacteristic(TimeCharacteristic.ProcessingTime)// alternatively:// env.setStreamTimeCharacteristic(TimeCharacteristic.IngestionTime)// env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)val stream: DataStream[MyEvent] = env.addSource(new FlinkKafkaConsumer09[MyEvent](topic, schema, props))stream .keyBy( _.getUser ) .timeWindow(Time.hours(1)) .reduce( (a, b) =&gt; a.add(b) ) .addSink(...)è¯·æ³¨æ„ï¼Œä¸ºäº†åœ¨_äº‹ä»¶æ—¶é—´ä¸­_è¿è¡Œæ­¤ç¤ºä¾‹ï¼Œç¨‹åºéœ€è¦ä½¿ç”¨ç›´æ¥ä¸ºæ•°æ®å®šä¹‰äº‹ä»¶æ—¶é—´å¹¶è‡ªå·±å‘å‡ºæ°´å°çš„æºï¼Œæˆ–è€…ç¨‹åºå¿…é¡»åœ¨æºä¹‹åæ³¨å…¥_Timestamp Assignerï¼†Watermark Generator_ã€‚è¿™äº›åŠŸèƒ½æè¿°äº†å¦‚ä½•è®¿é—®äº‹ä»¶æ—¶é—´æˆ³ï¼Œä»¥åŠäº‹ä»¶æµå‘ˆç°å‡ºä½•ç§ç¨‹åº¦çš„ä¹±åºã€‚ä»¥ä¸‹éƒ¨åˆ†æè¿°äº†_æ—¶é—´æˆ³å’Œæ°´å°_èƒŒåçš„ä¸€èˆ¬æœºåˆ¶ã€‚æœ‰å…³å¦‚ä½•åœ¨Flink DataStream APIä¸­ä½¿ç”¨æ—¶é—´æˆ³åˆ†é…å’Œæ°´å°ç”Ÿæˆçš„æŒ‡å—ï¼Œè¯·å‚é˜… ç”Ÿæˆæ—¶é—´æˆ³/æ°´å°ã€‚ç°å®ä¸–ç•Œä¸­çš„æ—¶é—´æ˜¯ä¸ä¸€è‡´çš„ï¼Œåœ¨ flink ä¸­è¢«åˆ’åˆ†ä¸ºäº‹ä»¶æ—¶é—´ï¼Œæå–æ—¶é—´ï¼Œå¤„ç†æ—¶é—´ä¸‰ç§ã€‚å¦‚æœä»¥ EventTime ä¸ºåŸºå‡†æ¥å®šä¹‰æ—¶é—´çª—å£é‚£å°†å½¢æˆ EventTimeWindow,è¦æ±‚æ¶ˆæ¯æœ¬èº«å°±åº”è¯¥æºå¸¦ EventTime å¦‚æœä»¥ IngesingtTime ä¸ºåŸºå‡†æ¥å®šä¹‰æ—¶é—´çª—å£é‚£å°†å½¢æˆ IngestingTimeWindow,ä»¥ source çš„ systemTime ä¸ºå‡†ã€‚ å¦‚æœä»¥ ProcessingTime åŸºå‡†æ¥å®šä¹‰æ—¶é—´çª—å£é‚£å°†å½¢æˆ ProcessingTimeWindowï¼Œä»¥ operator çš„ systemTime ä¸ºå‡†ã€‚ä»¥ä¸Šä¸‰ç§é€‰æ‹©æ˜¯éœ€è¦æ ¹æ®ä¸åŒä¸šåŠ¡éœ€æ±‚è¿›è¡Œé€‰æ‹©çš„ï¼Œä¾‹å¦‚ï¼Œåœ¨æ•°æ®è®¡ç®—çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è€ƒè™‘åˆ°ç½‘ç»œå»¶è¿Ÿçš„åŸå› ï¼Œé‚£ä¹ˆå°±åº”è¯¥é€‰æ‹©setStreamTimeCharacteristic(TimeCharacteristic.EventTime)ï¼Œç›¸åï¼Œä¸éœ€è¦è€ƒè™‘å»¶è¿ŸåŸå› çš„è¯ï¼Œåªè€ƒè™‘å¤„ç†æ•°æ®çš„æ—¶é—´ï¼Œåˆ™å¯ä»¥é€‰æ‹©å¦ä¸¤ä¸ªã€‚Event Time and Watermarksæ”¯æŒäº‹ä»¶æ—¶é—´çš„_æµå¤„ç†å™¨éœ€è¦ä¸€ç§æµ‹é‡äº‹ä»¶æ—¶é—´è¿›åº¦çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå½“äº‹ä»¶æ—¶é—´è¶…è¿‡ä¸€ä¸ªå°æ—¶ç»“æŸæ—¶ï¼Œéœ€è¦é€šçŸ¥æ„å»ºæ¯å°æ—¶çª—å£çš„çª—å£æ“ä½œå‘˜ï¼Œä»¥ä¾¿è¯¥æ“ä½œå‘˜å¯ä»¥å…³é—­æ­£åœ¨è¿›è¡Œçš„çª—å£ã€‚_äº‹ä»¶æ—¶é—´_å¯ä»¥ç‹¬ç«‹äº_å¤„ç†æ—¶é—´_ï¼ˆç”±æŒ‚é’Ÿæµ‹é‡ï¼‰è¿›è¡Œã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç¨‹åºä¸­ï¼Œæ“ä½œå‘˜çš„å½“å‰_äº‹ä»¶æ—¶é—´_å¯èƒ½ä¼šç¨å¾®è½åäº_å¤„ç†æ—¶é—´ ï¼ˆè€ƒè™‘åˆ°äº‹ä»¶æ¥æ”¶çš„å»¶è¿Ÿï¼‰ï¼Œè€Œä¸¤è€…å‡ä»¥ç›¸åŒçš„é€Ÿåº¦è¿›è¡Œã€‚å¦ä¸€æ–¹é¢ï¼Œå¦ä¸€ä¸ªæµåª’ä½“ç¨‹åºå¯ä»¥é€šè¿‡å¿«é€Ÿè½¬å‘å·²ç»åœ¨Kafkaä¸»é¢˜ï¼ˆæˆ–å¦ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ä¸­ç¼“å­˜çš„ä¸€äº›å†å²æ•°æ®æ¥åœ¨æ•°å‘¨çš„äº‹ä»¶æ—¶é—´å†…è¿›è¡Œå¤„ç†ï¼Œè€Œå¤„ç†æ—¶é—´ä»…ä¸ºå‡ ç§’é’Ÿã€‚Flinkä¸­è¡¡é‡äº‹ä»¶æ—¶é—´è¿›åº¦çš„æœºåˆ¶æ˜¯æ°´å°ã€‚æ°´å°ä½œä¸ºæ•°æ®æµçš„ä¸€éƒ¨åˆ†æµåŠ¨ï¼Œå¹¶å¸¦æœ‰æ—¶é—´æˆ³tã€‚ç”²_æ°´å°ï¼ˆTï¼‰_å®£å¸ƒäº‹ä»¶æ—¶é—´è¾¾åˆ°æ—¶é—´ å¨è¯¥æµï¼Œè¿™æ„å‘³ç€åº”è¯¥æœ‰ä»è¯¥æµæ²¡æœ‰æ›´å¤šçš„å…ƒç´ ä¸æ—¶é—´æˆ³_Tâ€ &lt;= T_ï¼ˆå³ï¼Œå…·æœ‰æ—¶é—´æˆ³çš„äº‹ä»¶è¾ƒæ—§çš„æˆ–ç­‰äºæ°´å°ï¼‰ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†å¸¦æœ‰ï¼ˆé€»è¾‘ï¼‰æ—¶é—´æˆ³è®°çš„äº‹ä»¶æµï¼Œä»¥åŠä¸²è”çš„æ°´å°ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œäº‹ä»¶æ˜¯æŒ‰é¡ºåºæ’åˆ—çš„ï¼ˆç›¸å¯¹äºå…¶æ—¶é—´æˆ³ï¼‰ï¼Œè¿™æ„å‘³ç€æ°´å°åªæ˜¯æµä¸­çš„å‘¨æœŸæ€§æ ‡è®°ã€‚æ°´å°å¯¹äº_ä¹±åº_æµè‡³å…³é‡è¦ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­äº‹ä»¶ä¸æ˜¯æŒ‰å…¶æ—¶é—´æˆ³æ’åºçš„ã€‚é€šå¸¸ï¼Œæ°´å°æ˜¯ä¸€ç§å£°æ˜ï¼Œå³åˆ°æµä¸­çš„é‚£ä¸ªç‚¹ï¼Œç›´åˆ°æŸä¸ªæ—¶é—´æˆ³çš„æ‰€æœ‰äº‹ä»¶éƒ½åº”è¯¥åˆ°è¾¾ã€‚ä¸€æ—¦æ°´å°åˆ°è¾¾æ“ä½œå‘˜ï¼Œæ“ä½œå‘˜å°±å¯ä»¥å°†å…¶å†…éƒ¨_äº‹ä»¶æ—¶é’Ÿ_æå‰åˆ°æ°´å°çš„å€¼ã€‚è¯·æ³¨æ„ï¼Œäº‹ä»¶æ—¶é—´æ˜¯ç”±æ–°åˆ›å»ºçš„ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰æµå…ƒç´ ä»äº§ç”Ÿå®ƒä»¬çš„äº‹ä»¶æˆ–è§¦å‘äº†åˆ›å»ºè¿™äº›å…ƒç´ çš„æ°´å°ä¸­ç»§æ‰¿çš„ã€‚å¹¶è¡Œæµä¸­çš„æ°´å°(Watermarks in Parallel Streams)æ°´å°åœ¨æºå‡½æ•°å¤„æˆ–æºå‡½æ•°ä¹‹åç›´æ¥ç”Ÿæˆã€‚æºå‡½æ•°çš„æ¯ä¸ªå¹¶è¡Œå­ä»»åŠ¡é€šå¸¸ç‹¬ç«‹ç”Ÿæˆå…¶æ°´å°ã€‚è¿™äº›æ°´å°å®šä¹‰äº†è¯¥ç‰¹å®šå¹¶è¡Œæºå¤„çš„äº‹ä»¶æ—¶é—´ã€‚éšç€æ°´å°åœ¨æµå¼ä¼ è¾“ç¨‹åºä¸­çš„æµåŠ¨ï¼Œå®ƒä»¬ä¼šæå‰åˆ°è¾¾å…¶åˆ°è¾¾çš„è¿è¥å•†çš„äº‹ä»¶æ—¶é—´ã€‚æ¯å½“æ“ä½œå‘˜æå‰å…¶äº‹ä»¶æ—¶é—´æ—¶ï¼Œéƒ½ä¼šä¸ºå…¶åç»­æ“ä½œå‘˜åœ¨ä¸‹æ¸¸ç”Ÿæˆæ–°çš„æ°´å°ã€‚ä¸€äº›è¿ç®—ç¬¦æ¶ˆè€—å¤šä¸ªè¾“å…¥æµï¼›ä¾‹å¦‚ï¼Œå¹¶é›†ï¼Œæˆ–éµå¾ª_keyByï¼ˆâ€¦ï¼‰æˆ–partitionï¼ˆâ€¦ï¼‰_å‡½æ•°çš„è¿ç®—ç¬¦ã€‚è¯¥æ“ä½œå‘˜çš„å½“å‰äº‹ä»¶æ—¶é—´æ˜¯å…¶è¾“å…¥æµçš„äº‹ä»¶æ—¶é—´ä¸­çš„æœ€å°å€¼ã€‚éšç€å…¶è¾“å…¥æµæ›´æ–°å…¶äº‹ä»¶æ—¶é—´ï¼Œæ“ä½œå‘˜ä¹Ÿå°†æ›´æ–°ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†æµè¿‡å¹¶è¡Œæµçš„äº‹ä»¶å’Œæ°´å°çš„ç¤ºä¾‹ï¼Œæ“ä½œå‘˜è·Ÿè¸ªäº‹ä»¶æ—¶é—´ã€‚è¯·æ³¨æ„ï¼ŒKafkaæºæ”¯æŒæŒ‰åˆ†åŒºæ·»åŠ æ°´å°ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤å¤„é˜…è¯»æ›´å¤šä¿¡æ¯ã€‚åæœŸå…ƒç´ æŸäº›å…ƒç´ å¯èƒ½ä¼šè¿åæ°´å°æ¡ä»¶ï¼Œè¿™æ„å‘³ç€å³ä½¿åœ¨å‘ç”Ÿ_æ°´å°ï¼ˆtï¼‰_ä¹‹åï¼Œä¹Ÿä¼šå‡ºç°æ›´å¤šæ—¶é—´æˆ³ä¸º_tâ€™&lt;= tçš„_å…ƒç´ ã€‚å®é™…ä¸Šï¼Œåœ¨è®¸å¤šç°å®ä¸–ç•Œçš„è®¾ç½®ä¸­ï¼ŒæŸäº›å…ƒç´ å¯ä»¥ä»»æ„å»¶è¿Ÿï¼Œä»è€Œæ— æ³•æŒ‡å®šæŸä¸ªäº‹ä»¶æ—¶é—´æˆ³è®°çš„æ‰€æœ‰å…ƒç´ éƒ½å°†å‘ç”Ÿçš„æ—¶é—´ã€‚æ­¤å¤–ï¼Œå³ä½¿å¯ä»¥é™åˆ¶å»¶è¿Ÿï¼Œé€šå¸¸ä¹Ÿä¸å¸Œæœ›å°†æ°´å°å»¶è¿Ÿå¤ªå¤šï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´äº‹ä»¶æ—¶é—´çª—çš„è¯„ä¼°å»¶è¿Ÿè¿‡å¤šã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œæµå¼ä¼ è¾“ç¨‹åºå¯èƒ½ä¼šæ˜ç¡®æœŸæœ›æŸäº›_åæœŸ_å…ƒç´ ã€‚å»¶è¿Ÿå…ƒç´ æ˜¯åœ¨ç³»ç»Ÿçš„äº‹ä»¶æ—¶é—´æ—¶é’Ÿï¼ˆç”±æ°´å°æŒ‡ç¤ºï¼‰å·²ç»ç»è¿‡å»¶è¿Ÿå…ƒç´ æ—¶é—´æˆ³çš„æ—¶é—´ä¹‹ååˆ°è¾¾çš„å…ƒç´ ã€‚æœ‰å…³å¦‚ä½•åœ¨äº‹ä»¶æ—¶é—´çª—å£ä¸­ä½¿ç”¨å»¶è¿Ÿå…ƒç´ çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§å…è®¸å»¶è¿Ÿã€‚é—²ç½®æ¥æºå½“å‰ï¼Œä½¿ç”¨çº¯äº‹ä»¶æ—¶é—´æ°´å°ç”Ÿæˆå™¨ï¼Œå¦‚æœæ²¡æœ‰è¦å¤„ç†çš„å…ƒç´ ï¼Œåˆ™æ°´å°å°†æ— æ³•è¿›è¡Œã€‚è¿™æ„å‘³ç€åœ¨è¾“å…¥æ•°æ®å­˜åœ¨é—´éš™çš„æƒ…å†µä¸‹ï¼Œäº‹ä»¶æ—¶é—´å°†ä¸ä¼šç»§ç»­è¿›è¡Œï¼Œä¾‹å¦‚ä¸ä¼šè§¦å‘çª—å£æ“ä½œç¬¦ï¼Œå› æ­¤ç°æœ‰çª—å£å°†æ— æ³•ç”Ÿæˆä»»ä½•è¾“å‡ºæ•°æ®ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨å‘¨æœŸæ€§çš„æ°´å°åˆ†é…å™¨ï¼Œè¿™äº›åˆ†é…å™¨ä¸ä»…åŸºäºå…ƒç´ æ—¶é—´æˆ³è¿›è¡Œåˆ†é…ã€‚ä¸€ä¸ªç¤ºä¾‹è§£å†³æ–¹æ¡ˆå¯èƒ½æ˜¯ä¸€ä¸ªåˆ†é…å™¨ï¼Œè¯¥åˆ†é…å™¨åœ¨ä¸€æ®µæ—¶é—´å†…æœªè§‚å¯Ÿåˆ°æ–°äº‹ä»¶ä¹‹ååˆ‡æ¢ä¸ºä½¿ç”¨å½“å‰å¤„ç†æ—¶é—´ä½œä¸ºæ—¶é—´åŸºç¡€ã€‚å¯ä»¥ä½¿ç”¨å°†æºæ ‡è®°ä¸ºç©ºé—²SourceFunction.SourceContext#markAsTemporarilyIdleã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒæ­¤æ–¹æ³•çš„Javadocä»¥åŠStreamStatusã€‚è°ƒè¯•æ°´å°è¯·å‚é˜…â€œ è°ƒè¯•Windowså’Œäº‹ä»¶æ—¶é—´â€éƒ¨åˆ†ä»¥åœ¨è¿è¡Œæ—¶è°ƒè¯•æ°´å°ã€‚è¿è¥å•†å¦‚ä½•å¤„ç†æ°´å°é€šå¸¸ï¼Œè¦æ±‚æ“ä½œå‘˜åœ¨å°†ç»™å®šæ°´å°è½¬å‘åˆ°ä¸‹æ¸¸ä¹‹å‰å¯¹å…¶è¿›è¡Œå®Œå…¨å¤„ç†ã€‚ä¾‹å¦‚ï¼Œ WindowOperatorå°†é¦–å…ˆè¯„ä¼°åº”è§¦å‘å“ªä¸ªçª—å£ï¼Œåªæœ‰åœ¨äº§ç”Ÿäº†æ‰€æœ‰ç”±æ°´å°è§¦å‘çš„è¾“å‡ºä¹‹åï¼Œæ°´å°æœ¬èº«æ‰ä¼šè¢«å‘é€åˆ°ä¸‹æ¸¸ã€‚æ¢å¥è¯è¯´ï¼Œç”±äºæ°´å°çš„å‡ºç°è€Œäº§ç”Ÿçš„æ‰€æœ‰å…ƒç´ å°†åœ¨æ°´å°ä¹‹å‰å‘å‡ºã€‚ç›¸åŒçš„è§„åˆ™é€‚ç”¨äºTwoInputStreamOperatorã€‚ä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ“ä½œå‘˜çš„å½“å‰æ°´å°è¢«å®šä¹‰ä¸ºå…¶ä¸¤ä¸ªè¾“å…¥çš„æœ€å°å€¼ã€‚ç”Ÿæˆæ—¶é—´æˆ³/æ°´å°åˆ†é…æ—¶é—´æˆ³å¸¦æœ‰æ—¶é—´æˆ³å’Œæ°´å°çš„æºå‡½æ•°æ—¶é—´æˆ³è®°åˆ†é…å™¨/æ°´å°ç”Ÿæˆå™¨æ¯ä¸ªKafkaåˆ†åŒºçš„æ—¶é—´æˆ³æœ¬èŠ‚ä¸åœ¨äº‹ä»¶æ—¶é—´è¿è¡Œçš„ç¨‹åºæœ‰å…³ã€‚æœ‰å…³äº‹ä»¶æ—¶é—´_ï¼Œ _å¤„ç†æ—¶é—´å’Œæ‘„å–æ—¶é—´çš„ç®€ä»‹_ï¼Œè¯·å‚é˜…äº‹ä»¶æ—¶é—´çš„ç®€ä»‹ã€‚ä¸ºäº†å¤„ç†**_äº‹ä»¶æ—¶é—´ï¼Œæµå¼ä¼ è¾“ç¨‹åºéœ€è¦ç›¸åº”åœ°è®¾ç½®æ—¶é—´ç‰¹å¾**ã€‚12val env = StreamExecutionEnvironment.getExecutionEnvironmentenv.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)åˆ†é…æ—¶é—´æˆ³ä¸ºäº†ä½¿ç”¨_äº‹ä»¶æ—¶é—´_ï¼ŒFlinkéœ€è¦çŸ¥é“äº‹ä»¶çš„_æ—¶é—´æˆ³_ï¼Œè¿™æ„å‘³ç€æµä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½éœ€è¦_åˆ†é…_å…¶äº‹ä»¶æ—¶é—´æˆ³ã€‚è¿™é€šå¸¸æ˜¯é€šè¿‡ä»å…ƒç´ çš„æŸä¸ªå­—æ®µè®¿é—®/æå–æ—¶é—´æˆ³æ¥å®Œæˆçš„ã€‚æ—¶é—´æˆ³åˆ†é…ä¸ç”Ÿæˆæ°´å°é½å¤´å¹¶è¿›ï¼Œæ°´å°å‘Šè¯‰ç³»ç»Ÿäº‹ä»¶æ—¶é—´çš„è¿›å±•ã€‚æœ‰ä¸¤ç§åˆ†é…æ—¶é—´æˆ³å’Œç”Ÿæˆæ°´å°çš„æ–¹æ³•ï¼šç›´æ¥åœ¨æ•°æ®æµæºä¸­é€šè¿‡æ—¶é—´æˆ³åˆ†é…å™¨/æ°´å°ç”Ÿæˆå™¨ï¼šåœ¨Flinkä¸­ï¼Œæ—¶é—´æˆ³åˆ†é…å™¨è¿˜å®šä¹‰è¦å‘é€çš„æ°´å°æ³¨æ„è‡ª1970å¹´1æœˆ1æ—¥T00ï¼š00ï¼š00Zçš„Javaæ—¶ä»£ä»¥æ¥ï¼Œæ—¶é—´æˆ³å’Œæ°´å°éƒ½æŒ‡å®šä¸ºæ¯«ç§’ã€‚å¸¦æœ‰æ—¶é—´æˆ³å’Œæ°´å°çš„æºå‡½æ•°æµæºå¯ä»¥å°†æ—¶é—´æˆ³ç›´æ¥åˆ†é…ç»™å®ƒä»¬äº§ç”Ÿçš„å…ƒç´ ï¼Œå¹¶ä¸”å®ƒä»¬è¿˜å¯ä»¥å‘å‡ºæ°´å°ã€‚å®Œæˆæ­¤æ“ä½œåï¼Œæ— éœ€æ—¶é—´æˆ³åˆ†é…å™¨ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨æ—¶é—´æˆ³åˆ†é…å™¨ï¼Œåˆ™æºæ‰€æä¾›çš„ä»»ä½•æ—¶é—´æˆ³å’Œæ°´å°éƒ½å°†è¢«è¦†ç›–ã€‚è¦å°†æ—¶é—´æˆ³ç›´æ¥åˆ†é…ç»™æºä¸­çš„å…ƒç´ ï¼Œæºå¿…é¡»ä½¿ç”¨ä¸Šçš„collectWithTimestamp(...) æ–¹æ³•SourceContextã€‚è¦ç”Ÿæˆæ°´å°ï¼Œæºå¿…é¡»è°ƒç”¨è¯¥emitWatermark(Watermark)å‡½æ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹_ï¼ˆéæ£€æŸ¥ç‚¹ï¼‰_æºï¼Œè¯¥æºåˆ†é…æ—¶é—´æˆ³å¹¶ç”Ÿæˆæ°´å°ï¼š12345678910override def run(ctx: SourceContext[MyType]): Unit &#x3D; &#123; while (&#x2F;* condition *&#x2F;) &#123; val next: MyType &#x3D; getNext() ctx.collectWithTimestamp(next, next.eventTimestamp) if (next.hasWatermarkTime) &#123; ctx.emitWatermark(new Watermark(next.getWatermarkTime)) &#125; &#125;&#125;æ—¶é—´æˆ³è®°åˆ†é…å™¨/æ°´å°ç”Ÿæˆå™¨æ—¶é—´æˆ³è®°åˆ†é…å™¨è·å–æµå¹¶äº§ç”Ÿå¸¦æœ‰æ—¶é—´æˆ³è®°çš„å…ƒç´ å’Œæ°´å°çš„æ–°æµã€‚å¦‚æœåŸå§‹æµå·²ç»å…·æœ‰æ—¶é—´æˆ³å’Œ/æˆ–æ°´å°ï¼Œåˆ™æ—¶é—´æˆ³åˆ†é…å™¨å°†è¦†ç›–å®ƒä»¬ã€‚æ—¶é—´æˆ³è®°åˆ†é…å™¨é€šå¸¸åœ¨æ•°æ®æºä¹‹åç«‹å³æŒ‡å®šï¼Œä½†å¹¶éä¸¥æ ¼è¦æ±‚è¿™æ ·åšã€‚ä¾‹å¦‚ï¼Œä¸€ç§å¸¸è§çš„æ¨¡å¼æ˜¯åœ¨æ—¶é—´æˆ³åˆ†é…å™¨ä¹‹å‰è§£æï¼ˆ_MapFunction_ï¼‰å’Œç­›é€‰å™¨ï¼ˆ_FilterFunction_ï¼‰ã€‚æ— è®ºå¦‚ä½•ï¼Œéƒ½éœ€è¦åœ¨äº‹ä»¶æ—¶é—´çš„ç¬¬ä¸€ä¸ªæ“ä½œï¼ˆä¾‹å¦‚ç¬¬ä¸€ä¸ªçª—å£æ“ä½œï¼‰ä¹‹å‰æŒ‡å®šæ—¶é—´æˆ³åˆ†é…å™¨ã€‚ä½œä¸ºä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå½“ä½¿ç”¨Kafkaä½œä¸ºæµä½œä¸šçš„æºæ—¶ï¼ŒFlinkå…è®¸åœ¨æºï¼ˆæˆ–ä½¿ç”¨è€…ï¼‰æœ¬èº«å†…éƒ¨æŒ‡å®šæ—¶é—´æˆ³åˆ†é…å™¨/æ°´å°å‘å°„å™¨ã€‚æœ‰å…³å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ Kafka Connectoræ–‡æ¡£ã€‚æ³¨æ„ï¼šæœ¬èŠ‚çš„å…¶ä½™éƒ¨åˆ†ä»‹ç»äº†ç¨‹åºå‘˜ä¸ºäº†åˆ›å»ºè‡ªå·±çš„æ—¶é—´æˆ³æå–å™¨/æ°´å°å‘å°„å™¨è€Œå¿…é¡»å®ç°çš„ä¸»è¦æ¥å£ã€‚è¦æŸ¥çœ‹Flinké™„å¸¦çš„é¢„å®ç°æå–å™¨ï¼Œè¯·å‚é˜…â€œ é¢„å®šä¹‰æ—¶é—´æˆ³æå–å™¨/æ°´å°å‘å°„å™¨â€é¡µé¢ã€‚çˆªå“‡æ–¯å¡æ‹‰12345678910111213141516val env = StreamExecutionEnvironment.getExecutionEnvironmentenv.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)val stream: DataStream[MyEvent] = env.readFile( myFormat, myFilePath, FileProcessingMode.PROCESS_CONTINUOUSLY, 100, FilePathFilter.createDefaultFilter())val withTimestampsAndWatermarks: DataStream[MyEvent] = stream .filter( _.severity == WARNING ) .assignTimestampsAndWatermarks(new MyTimestampsAndWatermarks())withTimestampsAndWatermarks .keyBy( _.getGroup ) .timeWindow(Time.seconds(10)) .reduce( (a, b) =&gt; a.add(b) ) .addSink(...)**å¸¦æœ‰å®šæœŸæ°´å°AssignerWithPeriodicWatermarks åˆ†é…æ—¶é—´æˆ³å¹¶å®šæœŸç”Ÿæˆæ°´å°ï¼ˆå¯èƒ½å–å†³äºæµå…ƒç´ ï¼Œæˆ–ä»…åŸºäºå¤„ç†æ—¶é—´ï¼‰ã€‚é€šè¿‡å®šä¹‰ç”Ÿæˆæ°´å°çš„é—´éš”ï¼ˆæ¯næ¯«ç§’ï¼‰ ExecutionConfig.setAutoWatermarkInterval(...)ã€‚åˆ†é…å™¨çš„getCurrentWatermark()æ–¹æ³•æ¯æ¬¡éƒ½ä¼šè¢«è°ƒç”¨ï¼Œå¦‚æœè¿”å›çš„æ°´å°éç©ºä¸”å¤§äºå‰ä¸€ä¸ªæ°´å°ï¼Œåˆ™å°†å‘å‡ºæ–°çš„æ°´å°ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ˜¾ç¤ºäº†ä¸¤ä¸ªä½¿ç”¨å®šæœŸæ°´å°ç”Ÿæˆçš„æ—¶é—´æˆ³åˆ†é…å™¨çš„ç®€å•ç¤ºä¾‹ã€‚è¯·æ³¨æ„ï¼ŒFlinkéšé™„ä¸ä»¥ä¸‹æ‰€ç¤ºBoundedOutOfOrdernessTimestampExtractorç±»ä¼¼çš„å†…å®¹BoundedOutOfOrdernessGeneratorï¼Œæ‚¨å¯ä»¥åœ¨æ­¤å¤„é˜…è¯»æœ‰å…³å†…å®¹ã€‚12345678910111213141516171819202122232425262728293031323334353637383940/** * This generator generates watermarks assuming that elements arrive out of order, * but only to a certain degree. The latest elements for a certain timestamp t will arrive * at most n milliseconds after the earliest elements for timestamp t. */class BoundedOutOfOrdernessGenerator extends AssignerWithPeriodicWatermarks[MyEvent] &#123; val maxOutOfOrderness = 3500L // 3.5 seconds var currentMaxTimestamp: Long = _ override def extractTimestamp(element: MyEvent, previousElementTimestamp: Long): Long = &#123; val timestamp = element.getCreationTime() currentMaxTimestamp = max(timestamp, currentMaxTimestamp) timestamp &#125; override def getCurrentWatermark(): Watermark = &#123; // return the watermark as current highest timestamp minus the out-of-orderness bound new Watermark(currentMaxTimestamp - maxOutOfOrderness) &#125;&#125;/** * This generator generates watermarks that are lagging behind processing time by a fixed amount. * It assumes that elements arrive in Flink after a bounded delay. */class TimeLagWatermarkGenerator extends AssignerWithPeriodicWatermarks[MyEvent] &#123; val maxTimeLag = 5000L // 5 seconds override def extractTimestamp(element: MyEvent, previousElementTimestamp: Long): Long = &#123; element.getCreationTime &#125; override def getCurrentWatermark(): Watermark = &#123; // return the watermark as current time minus the maximum time lag new Watermark(System.currentTimeMillis() - maxTimeLag) &#125;&#125;**å¸¦æ ‡ç‚¹çš„æ°´å°è¦åœ¨ç‰¹å®šäº‹ä»¶è¡¨æ˜å¯èƒ½ä¼šç”Ÿæˆæ–°çš„æ°´å°æ—¶ç”Ÿæˆæ°´å°ï¼Œè¯·ä½¿ç”¨ AssignerWithPunctuatedWatermarksã€‚å¯¹äºæ­¤ç±»ï¼ŒFlinkå°†é¦–å…ˆè°ƒç”¨è¯¥extractTimestamp(...)æ–¹æ³•ä¸ºå…ƒç´ åˆ†é…æ—¶é—´æˆ³ï¼Œç„¶åç«‹å³checkAndGetNextWatermark(...)åœ¨è¯¥å…ƒç´ ä¸Šè°ƒç”¨è¯¥ æ–¹æ³•ã€‚è¯¥checkAndGetNextWatermark(...)æ–¹æ³•ä¼šä¼ é€’è¯¥æ–¹æ³•ä¸­åˆ†é…çš„æ—¶é—´æˆ³extractTimestamp(...) ï¼Œå¹¶å¯ä»¥å†³å®šæ˜¯å¦è¦ç”Ÿæˆæ°´å°ã€‚æ¯å½“è¯¥checkAndGetNextWatermark(...) æ–¹æ³•è¿”å›ä¸€ä¸ªéç©ºæ°´å°ï¼Œå¹¶ä¸”è¯¥æ°´å°å¤§äºæœ€æ–°çš„å…ˆå‰æ°´å°æ—¶ï¼Œå°±ä¼šå‘å‡ºæ–°çš„æ°´å°ã€‚çˆªå“‡æ–¯å¡æ‹‰12345678910class PunctuatedAssigner extends AssignerWithPunctuatedWatermarks[MyEvent] &#123; override def extractTimestamp(element: MyEvent, previousElementTimestamp: Long): Long = &#123; element.getCreationTime &#125; override def checkAndGetNextWatermark(lastElement: MyEvent, extractedTimestamp: Long): Watermark = &#123; if (lastElement.hasWatermarkMarker()) new Watermark(extractedTimestamp) else null &#125;&#125;_æ³¨æ„ï¼š_å¯ä»¥åœ¨æ¯ä¸ªäº‹ä»¶ä¸Šç”Ÿæˆæ°´å°ã€‚ä½†æ˜¯ï¼Œç”±äºæ¯ä¸ªæ°´å°éƒ½ä¼šåœ¨ä¸‹æ¸¸å¼•èµ·ä¸€äº›è®¡ç®—ï¼Œå› æ­¤è¿‡å¤šçš„æ°´å°ä¼šé™ä½æ€§èƒ½ã€‚æ¯ä¸ªKafkaåˆ†åŒºçš„æ—¶é—´æˆ³å½“ä½¿ç”¨Apache Kafkaä½œä¸ºæ•°æ®æºæ—¶ï¼Œæ¯ä¸ªKafkaåˆ†åŒºå¯èƒ½éƒ½æœ‰ä¸€ä¸ªç®€å•çš„äº‹ä»¶æ—¶é—´æ¨¡å¼ï¼ˆæ—¶é—´æˆ³å‡åºæˆ–æœ‰ç•Œä¹±åºï¼‰ã€‚ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨æ¥è‡ªKafkaçš„æµæ—¶ï¼Œé€šå¸¸ä¼šå¹¶è¡Œä½¿ç”¨å¤šä¸ªåˆ†åŒºï¼Œä»è€Œäº¤é”™æ’å…¥åˆ†åŒºä¸­çš„äº‹ä»¶å¹¶ç ´åæ¯ä¸ªåˆ†åŒºçš„æ¨¡å¼ï¼ˆè¿™æ˜¯Kafkaçš„å®¢æˆ·å®¢æˆ·ç«¯å·¥ä½œæ–¹å¼æ‰€å›ºæœ‰çš„ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Flinkçš„Kafkaåˆ†åŒºæ„ŸçŸ¥æ°´å°ç”Ÿæˆã€‚ä½¿ç”¨è¯¥åŠŸèƒ½ï¼Œå°†åœ¨Kafkaä½¿ç”¨è€…å†…éƒ¨é’ˆå¯¹æ¯ä¸ªKafkaåˆ†åŒºç”Ÿæˆæ°´å°ï¼Œå¹¶ä¸”æŒ‰ä¸åˆå¹¶æ°´å°åœ¨æµshuffleä¸Šç›¸åŒçš„æ–¹å¼åˆå¹¶æ¯ä¸ªåˆ†åŒºçš„æ°´å°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœäº‹ä»¶æ—¶é—´æˆ³ä¸¥æ ¼æŒ‰ç…§æ¯ä¸ªKafkaåˆ†åŒºé€’å¢ï¼Œåˆ™ä½¿ç”¨é€’å¢æ—¶é—´æˆ³æ°´å°ç”Ÿæˆå™¨ç”ŸæˆæŒ‰åˆ†åŒºçš„æ°´å° å°†äº§ç”Ÿå®Œç¾çš„æ•´ä½“æ°´å°ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨æŒ‰kafkaåˆ†åŒºçš„æ°´å°ç”Ÿæˆï¼Œä»¥åŠåœ¨è¿™ç§æƒ…å†µä¸‹æ°´å°å¦‚ä½•é€šè¿‡æµæ•°æ®æµä¼ æ’­ã€‚123456val kafkaSource = new FlinkKafkaConsumer09[MyType](\"myTopic\", schema, props)kafkaSource.assignTimestampsAndWatermarks(new AscendingTimestampExtractor[MyType] &#123; def extractAscendingTimestamp(element: MyType): Long = element.eventTimestamp&#125;)val stream: DataStream[MyType] = env.addSource(kafkaSource)é¢„å®šä¹‰çš„æ—¶é—´æˆ³æå–å™¨/æ°´å°å‘å°„å™¨å¦‚æ—¶é—´æˆ³å’Œæ°´å°å¤„ç†ä¸­æ‰€è¿°ï¼ŒFlinkæä¾›äº†æŠ½è±¡ï¼Œå…è®¸ç¨‹åºå‘˜åˆ†é…è‡ªå·±çš„æ—¶é—´æˆ³å¹¶å‘å‡ºè‡ªå·±çš„æ°´å°ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œæ ¹æ®ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥é€šè¿‡å®ç°AssignerWithPeriodicWatermarkså’ŒAssignerWithPunctuatedWatermarksæ¥å£ä¹‹ä¸€æ¥å®ç°ã€‚ç®€è€Œè¨€ä¹‹ï¼Œç¬¬ä¸€ä¸ªå°†å®šæœŸå‘å‡ºæ°´å°ï¼Œè€Œç¬¬äºŒä¸ªåˆ™æ ¹æ®ä¼ å…¥è®°å½•çš„æŸäº›å±æ€§å‘å‡ºæ°´å°ï¼Œä¾‹å¦‚ï¼Œæ¯å½“æµä¸­é‡åˆ°ç‰¹æ®Šå…ƒç´ æ—¶ã€‚ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–æ­¤ç±»ä»»åŠ¡çš„ç¼–ç¨‹å·¥ä½œï¼ŒFlinké™„å¸¦äº†ä¸€äº›é¢„å…ˆå®ç°çš„æ—¶é—´æˆ³åˆ†é…å™¨ã€‚æœ¬èŠ‚æä¾›äº†å®ƒä»¬çš„åˆ—è¡¨ã€‚é™¤äº†å¼€ç®±å³ç”¨çš„åŠŸèƒ½å¤–ï¼Œå®ƒä»¬çš„å®ç°è¿˜å¯ä»¥ä½œä¸ºè‡ªå®šä¹‰å®ç°çš„ç¤ºä¾‹ã€‚æ—¶é—´æˆ³é€’å¢çš„åˆ†é…è€…_å®šæœŸ_ç”Ÿæˆæ°´å°çš„æœ€ç®€å•çš„ç‰¹æ®Šæƒ…å†µæ˜¯ç»™å®šæºä»»åŠ¡çœ‹åˆ°çš„æ—¶é—´æˆ³ä»¥å‡åºå‡ºç°çš„æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å‰æ—¶é—´æˆ³å§‹ç»ˆå¯ä»¥å……å½“æ°´å°ï¼Œå› ä¸ºæ²¡æœ‰æ›´æ—©çš„æ—¶é—´æˆ³ä¼šåˆ°è¾¾ã€‚è¯·æ³¨æ„ï¼Œ_æ¯ä¸ªå¹¶è¡Œæ•°æ®æºä»»åŠ¡_åªéœ€è¦å¢åŠ æ—¶é—´æˆ³è®°å³å¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨ä¸€ä¸ªç‰¹å®šçš„è®¾ç½®ä¸­ï¼Œä¸€ä¸ªå¹¶è¡Œæ•°æ®æºå®ä¾‹è¯»å–ä¸€ä¸ªKafkaåˆ†åŒºï¼Œåˆ™åªéœ€è¦åœ¨æ¯ä¸ªKafkaåˆ†åŒºå†…å°†æ—¶é—´æˆ³è®°é€’å¢ã€‚æ¯å½“å¯¹å¹¶è¡Œæµè¿›è¡Œæ··æ´—ï¼Œåˆå¹¶ï¼Œè¿æ¥æˆ–åˆå¹¶æ—¶ï¼ŒFlinkçš„æ°´å°åˆå¹¶æœºåˆ¶éƒ½ä¼šç”Ÿæˆæ­£ç¡®çš„æ°´å°ã€‚12val stream: DataStream[MyEvent] = ...val withTimestampsAndWatermarks = stream.assignAscendingTimestamps( _.getCreationTime )**åˆ†é…å™¨å…è®¸å›ºå®šçš„å»¶è¿Ÿæ—¶é—´å‘¨æœŸæ€§æ°´å°ç”Ÿæˆçš„å¦ä¸€ä¸ªç¤ºä¾‹æ˜¯æ°´å°åœ¨æµä¸­çœ‹åˆ°çš„æœ€å¤§ï¼ˆäº‹ä»¶æ—¶é—´ï¼‰æ—¶é—´æˆ³è½åå›ºå®šæ—¶é—´é‡çš„æƒ…å†µã€‚è¿™ç§æƒ…å†µåŒ…æ‹¬é¢„å…ˆçŸ¥é“æµä¸­å¯èƒ½é‡åˆ°çš„æœ€å¤§å»¶è¿Ÿçš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼Œå½“åˆ›å»ºåŒ…å«æ—¶é—´æˆ³çš„å…ƒç´ çš„è‡ªå®šä¹‰æºæ—¶ï¼Œè¯¥æ—¶é—´æˆ³åœ¨å›ºå®šçš„æ—¶é—´æ®µå†…ä¼ æ’­ä»¥è¿›è¡Œæµ‹è¯•ã€‚å¯¹äºè¿™äº›æƒ…å†µï¼ŒFlinkæä¾›äº†BoundedOutOfOrdernessTimestampExtractorï¼Œå°†ç”¨ä½œå‚æ•°maxOutOfOrdernessï¼Œå³åœ¨è®¡ç®—ç»™å®šçª—å£çš„æœ€ç»ˆç»“æœæ—¶å…è®¸å…ƒç´ å»¶è¿Ÿåˆ°è¢«å¿½ç•¥ä¹‹å‰çš„æœ€é•¿æ—¶é—´ã€‚å»¶è¿Ÿå¯¹åº”äºçš„ç»“æœt - t_wï¼Œå…¶ä¸­tå…ƒç´ çš„ï¼ˆäº‹ä»¶æ—¶é—´ï¼‰æ—¶é—´æˆ³å’Œt_wå‰ä¸€ä¸ªæ°´å°çš„æ—¶é—´æˆ³ã€‚å¦‚æœlateness &gt; 0é‚£ä¹ˆè¯¥å…ƒç´ å°†è¢«è®¤ä¸ºæ˜¯è¾ƒæ™šçš„å…ƒç´ ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ä¸ºå…¶ç›¸åº”çª—å£è®¡ç®—ä½œä¸šç»“æœæ—¶å°†å…¶å¿½ç•¥ã€‚æœ‰å…³ ä½¿ç”¨å»¶è¿Ÿå…ƒç´ çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§æœ‰å…³å…è®¸å»¶è¿Ÿçš„æ–‡æ¡£ã€‚12val stream: DataStream[MyEvent] &#x3D; ...val withTimestampsAndWatermarks &#x3D; stream.assignTimestampsAndWatermarks(new BoundedOutOfOrdernessTimestampExtractor[MyEvent](Time.seconds(10))( _.getCreationTime ))","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Flink DataStream API","slug":"Flink-DataStream-API","date":"2018-03-20T14:44:42.000Z","updated":"2020-05-12T14:53:29.761Z","comments":true,"path":"2018/03/20/Flink-DataStream-API/","link":"","permalink":"cpeixin.cn/2018/03/20/Flink-DataStream-API/","excerpt":"","text":"Flinkä¸­çš„DataStreamç¨‹åºæ˜¯å¸¸è§„ç¨‹åºï¼Œå¯å¯¹æ•°æ®æµå®æ–½è½¬æ¢ï¼ˆä¾‹å¦‚ï¼Œè¿‡æ»¤ï¼Œæ›´æ–°çŠ¶æ€ï¼Œå®šä¹‰çª—å£ï¼Œèšåˆï¼‰ã€‚æœ€åˆä»å„ç§æ¥æºï¼ˆä¾‹å¦‚ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¥—æ¥å­—æµï¼Œæ–‡ä»¶ï¼‰åˆ›å»ºæ•°æ®æµã€‚ç»“æœé€šè¿‡æ¥æ”¶å™¨è¿”å›ï¼Œæ¥æ”¶å™¨å¯ä»¥ä¾‹å¦‚å°†æ•°æ®å†™å…¥æ–‡ä»¶æˆ–æ ‡å‡†è¾“å‡ºï¼ˆä¾‹å¦‚å‘½ä»¤è¡Œç»ˆç«¯ï¼‰ã€‚Flinkç¨‹åºå¯ä»¥åœ¨å„ç§ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œç‹¬ç«‹è¿è¡Œæˆ–åµŒå…¥å…¶ä»–ç¨‹åºä¸­ã€‚æ‰§è¡Œå¯ä»¥åœ¨æœ¬åœ°JVMæˆ–è®¸å¤šè®¡ç®—æœºçš„ç¾¤é›†ä¸­è¿›è¡Œã€‚èŒƒä¾‹ç¨‹åºä»¥ä¸‹ç¨‹åºæ˜¯æµå¼çª—å£å•è¯è®¡æ•°åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªå®Œæ•´çš„å·¥ä½œç¤ºä¾‹ï¼Œè¯¥åº”ç”¨ç¨‹åºåœ¨5ç§’çš„çª—å£ä¸­å¯¹æ¥è‡ªWebå¥—æ¥å­—çš„å•è¯è¿›è¡Œè®¡æ•°ã€‚æ‚¨å¯ä»¥å¤åˆ¶å¹¶ç²˜è´´ä»£ç ä»¥åœ¨æœ¬åœ°è¿è¡Œã€‚123456789101112131415import org.apache.flink.streaming.api.scala._import org.apache.flink.streaming.api.windowing.time.Timeobject WindowWordCount &#123; def main(args: Array[String]) &#123; val env = StreamExecutionEnvironment.getExecutionEnvironment val text = env.socketTextStream(\"localhost\", 9999) val counts = text.flatMap &#123; _.toLowerCase.split(\"\\\\W+\") filter &#123; _.nonEmpty &#125; &#125; .map &#123; (_, 1) &#125; .keyBy(0) .timeWindow(Time.seconds(5)) .sum(1) counts.print() env.execute(\"Window Stream WordCount\") &#125;&#125;è¦è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œè¯·é¦–å…ˆä»ç»ˆç«¯ä½¿ç”¨netcatå¯åŠ¨è¾“å…¥æµï¼š1nc -lk 9999åªéœ€è¾“å…¥ä¸€äº›å•è¯ï¼Œç„¶åæŒ‰å›è½¦é”®å³å¯è·å¾—ä¸€ä¸ªæ–°å•è¯ã€‚è¿™äº›å°†ä½œä¸ºå•è¯è®¡æ•°ç¨‹åºçš„è¾“å…¥ã€‚å¦‚æœæ‚¨æƒ³çœ‹åˆ°è®¡æ•°å¤§äº1ï¼Œè¯·åœ¨5ç§’é’Ÿå†…ä¸€æ¬¡åˆä¸€æ¬¡åœ°é”®å…¥ç›¸åŒçš„å•è¯ï¼ˆå¦‚æœæ‚¨ä¸èƒ½å¿«é€Ÿé”®å…¥â˜ºï¼Œåˆ™å°†çª—å£å¤§å°ä»5ç§’é’Ÿå¢åŠ ï¼‰ã€‚æ•°æ®æºæºæ˜¯ç¨‹åºè¯»å–å…¶è¾“å…¥çš„ä½ç½®ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å°†æºé™„åŠ åˆ°ç¨‹åºStreamExecutionEnvironment.addSource(sourceFunction)ã€‚Flinké™„å¸¦äº†è®¸å¤šé¢„å…ˆå®ç°çš„æºå‡½æ•°ï¼Œä½†æ˜¯æ‚¨å§‹ç»ˆå¯ä»¥é€šè¿‡å®ç°SourceFunction foréå¹¶è¡Œæºï¼Œå®ç°ParallelSourceFunctionæ¥å£æˆ–æ‰©å±• RichParallelSourceFunctionforå¹¶è¡Œæºæ¥ç¼–å†™è‡ªå·±çš„è‡ªå®šä¹‰æºã€‚å¯ä»ä»¥ä¸‹ä½ç½®è®¿é—®å‡ ä¸ªé¢„å®šä¹‰çš„æµæºStreamExecutionEnvironmentï¼šåŸºäºæ–‡ä»¶ï¼šreadTextFile(path)- TextInputFormaté€è¡Œè¯»å–æ–‡æœ¬æ–‡ä»¶ï¼Œå³ç¬¦åˆè§„èŒƒçš„æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä½œä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚readFile(fileInputFormat, path) -æ ¹æ®æŒ‡å®šçš„æ–‡ä»¶è¾“å…¥æ ¼å¼è¯»å–ï¼ˆä¸€æ¬¡ï¼‰æ–‡ä»¶ã€‚readFile(fileInputFormat, path, watchType, interval, pathFilter)-è¿™æ˜¯å‰ä¸¤ä¸ªå†…éƒ¨è°ƒç”¨çš„æ–¹æ³•ã€‚å®ƒpathæ ¹æ®ç»™å®šçš„è¯»å–æ–‡ä»¶fileInputFormatã€‚æ ¹æ®æä¾›çš„å†…å®¹watchTypeï¼Œæ­¤æºå¯ä»¥å®šæœŸï¼ˆæ¯intervalmsï¼‰ç›‘è§†è·¯å¾„ä¸­çš„æ–°æ•°æ®ï¼ˆFileProcessingMode.PROCESS_CONTINUOUSLYï¼‰ï¼Œæˆ–å¤„ç†ä¸€æ¬¡è·¯å¾„ä¸­å½“å‰çš„æ•°æ®å¹¶é€€å‡ºï¼ˆFileProcessingMode.PROCESS_ONCEï¼‰ã€‚ä½¿ç”¨pathFilterï¼Œç”¨æˆ·å¯ä»¥è¿›ä¸€æ­¥ä»æ–‡ä»¶ä¸­æ’é™¤æ–‡ä»¶ã€‚å®æ–½ï¼šåœ¨åå°ï¼ŒFlinkå°†æ–‡ä»¶è¯»å–è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªå­ä»»åŠ¡ï¼Œå³ç›®å½•ç›‘è§†å’Œæ•°æ®è¯»å–ã€‚è¿™äº›å­ä»»åŠ¡ä¸­çš„æ¯ä¸€ä¸ªéƒ½æ˜¯ç”±å•ç‹¬çš„å®ä½“å®ç°çš„ã€‚ç›‘è§†ç”±å•ä¸ªéå¹¶è¡Œï¼ˆå¹¶è¡Œåº¦= 1ï¼‰ä»»åŠ¡å®ç°ï¼Œè€Œè¯»å–ç”±å¹¶è¡Œè¿è¡Œçš„å¤šä¸ªä»»åŠ¡æ‰§è¡Œã€‚åè€…çš„å¹¶è¡Œæ€§ç­‰äºä½œä¸šå¹¶è¡Œæ€§ã€‚å•ä¸ªç›‘è§†ä»»åŠ¡çš„ä½œç”¨æ˜¯æ‰«æç›®å½•ï¼ˆæ ¹æ®å®šæœŸæ‰«ææˆ–ä»…æ‰«æä¸€æ¬¡watchTypeï¼‰ï¼Œæ‰¾åˆ°è¦å¤„ç†çš„æ–‡ä»¶ï¼Œå°†å®ƒä»¬åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œå¹¶å°†è¿™äº›æ‹†åˆ†åˆ†é…ç»™ä¸‹æ¸¸é˜…è¯»å™¨ã€‚è¯»è€…å°†æ˜¯é˜…è¯»å®é™…æ•°æ®çš„äººã€‚æ¯ä¸ªæ‹†åˆ†åªèƒ½ç”±ä¸€ä¸ªé˜…è¯»å™¨è¯»å–ï¼Œè€Œé˜…è¯»å™¨å¯ä»¥ä¸€ä¸€é˜…è¯»å¤šä¸ªæ‹†åˆ†ã€‚é‡è¦ç¬”è®°ï¼šå¦‚æœå°†watchTypeè®¾ç½®ä¸ºFileProcessingMode.PROCESS_CONTINUOUSLYï¼Œåˆ™åœ¨ä¿®æ”¹æ–‡ä»¶æ—¶ï¼Œå°†å®Œå…¨é‡æ–°å¤„ç†å…¶å†…å®¹ã€‚è¿™å¯èƒ½ä¼šç ´åâ€œå®Œå…¨ä¸€æ¬¡â€çš„è¯­ä¹‰ï¼Œå› ä¸ºåœ¨æ–‡ä»¶æœ«å°¾é™„åŠ æ•°æ®å°†å¯¼è‡´é‡æ–°å¤„ç†å…¶æ‰€æœ‰å†…å®¹ã€‚å¦‚æœå°†watchTypeè®¾ç½®ä¸ºFileProcessingMode.PROCESS_ONCEï¼Œåˆ™æºå°†æ‰«æè·¯å¾„ä¸€æ¬¡å¹¶é€€å‡ºï¼Œè€Œæ— éœ€ç­‰å¾…è¯»å–å™¨å®Œæˆæ–‡ä»¶å†…å®¹çš„è¯»å–ã€‚å½“ç„¶ï¼Œè¯»è€…å°†ç»§ç»­é˜…è¯»ï¼Œç›´åˆ°è¯»å–äº†æ‰€æœ‰æ–‡ä»¶å†…å®¹ã€‚å…³é—­æºå°†å¯¼è‡´åœ¨è¯¥ç‚¹ä¹‹åæ²¡æœ‰æ›´å¤šæ£€æŸ¥ç‚¹ã€‚è¿™å¯èƒ½å¯¼è‡´èŠ‚ç‚¹æ•…éšœåæ¢å¤é€Ÿåº¦å˜æ…¢ï¼Œå› ä¸ºä½œä¸šå°†ä»ä¸Šä¸€ä¸ªæ£€æŸ¥ç‚¹æ¢å¤è¯»å–ã€‚åŸºäºå¥—æ¥å­—ï¼šsocketTextStream-ä»å¥—æ¥å­—è¯»å–ã€‚å…ƒç´ å¯ä»¥ç”±å®šç•Œç¬¦åˆ†éš”ã€‚åŸºäºé›†åˆï¼šfromCollection(Seq)-ä»Java Java.util.Collectionåˆ›å»ºæ•°æ®æµã€‚é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ å¿…é¡»å…·æœ‰ç›¸åŒçš„ç±»å‹ã€‚fromCollection(Iterator)-ä»è¿­ä»£å™¨åˆ›å»ºæ•°æ®æµã€‚è¯¥ç±»æŒ‡å®šè¿­ä»£å™¨è¿”å›çš„å…ƒç´ çš„æ•°æ®ç±»å‹ã€‚fromElements(elements: _*)-ä»ç»™å®šçš„å¯¹è±¡åºåˆ—åˆ›å»ºæ•°æ®æµã€‚æ‰€æœ‰å¯¹è±¡å¿…é¡»å…·æœ‰ç›¸åŒçš„ç±»å‹ã€‚fromParallelCollection(SplittableIterator)-ä»è¿­ä»£å™¨å¹¶è¡Œåˆ›å»ºæ•°æ®æµã€‚è¯¥ç±»æŒ‡å®šè¿­ä»£å™¨è¿”å›çš„å…ƒç´ çš„æ•°æ®ç±»å‹ã€‚generateSequence(from, to) -å¹¶è¡Œç”Ÿæˆç»™å®šé—´éš”ä¸­çš„æ•°å­—åºåˆ—ã€‚è‡ªå®šä¹‰ï¼šaddSource-é™„åŠ æ–°çš„æºåŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œè¦é˜…è¯»Apache Kafkaï¼Œå¯ä»¥ä½¿ç”¨ addSource(new FlinkKafkaConsumer08&lt;&gt;(â€¦))ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§è¿æ¥å™¨ã€‚Flink è¿æ¥ kafkaå®ä¾‹ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556package data_streamimport java.util.Propertiesimport com.alibaba.fastjson.&#123;JSON, JSONObject&#125;import org.apache.flink.api.common.serialization.SimpleStringSchemaimport org.apache.flink.streaming.api.scala._import org.apache.flink.runtime.state.filesystem.FsStateBackendimport org.apache.flink.streaming.api.CheckpointingModeimport org.apache.flink.streaming.api.windowing.time.Timeimport org.apache.flink.streaming.connectors.kafka.&#123;FlinkKafkaConsumer, FlinkKafkaConsumerBase&#125;object wordcount_stream &#123; private val KAFKA_TOPIC: String = \"weibo_keyword\" def main(args: Array[String]) &#123; val properties: Properties = new Properties() properties.setProperty(\"bootstrap.servers\", \"localhost:9092\") properties.setProperty(\"group.id\", \"kafka_consumer\") val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment // exactly-once è¯­ä¹‰ä¿è¯æ•´ä¸ªåº”ç”¨å†…ç«¯åˆ°ç«¯çš„æ•°æ®ä¸€è‡´æ€§ env.getCheckpointConfig.setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE) // å¼€å¯æ£€æŸ¥ç‚¹å¹¶æŒ‡å®šæ£€æŸ¥ç‚¹æ—¶é—´é—´éš”ä¸º5s env.enableCheckpointing(5000) // checkpoint every 5000 msecs // è®¾ç½®StateBackendï¼Œå¹¶æŒ‡å®šçŠ¶æ€æ•°æ®å­˜å‚¨ä½ç½® env.setStateBackend(new FsStateBackend(\"file:///Users/cpeixin/IdeaProjects/code_warehouse/data/KafkaSource\")) val dataSource: FlinkKafkaConsumerBase[String] = new FlinkKafkaConsumer( KAFKA_TOPIC, new SimpleStringSchema(), properties)// .setStartFromEarliest() // æŒ‡å®šä»æœ€æ—©offsetå¼€å§‹æ¶ˆè´¹ .setStartFromLatest() // æŒ‡å®šä»æœ€æ–°offsetå¼€å§‹æ¶ˆè´¹ env.addSource(dataSource) .flatMap(get_value(_: String).split(\",\")) .map((_: String, 1)) .keyBy(0) .timeWindow(Time.seconds(5)) .sum(1) .print()// .setParallelism(1) è®¾ç½®å¹¶è¡Œåº¦ env.execute(\"Flink Streamingâ€”â€”â€”â€”â€”KafkaSource\") &#125; def get_value(string_data: String): String = &#123; val json_data: JSONObject = JSON.parseObject(string_data) val date_time: String = json_data.get(\"datetime\").toString val keywordList: String = json_data.get(\"keywordList\").toString keywordList &#125;&#125;æ•°æ®æ¥æ”¶å™¨æ•°æ®æ¥æ”¶å™¨ä½¿ç”¨DataStreamï¼Œå¹¶å°†å…¶è½¬å‘åˆ°æ–‡ä»¶ï¼Œå¥—æ¥å­—ï¼Œå¤–éƒ¨ç³»ç»Ÿæˆ–æ‰“å°å®ƒä»¬ã€‚Flinkå¸¦æœ‰å„ç§å†…ç½®çš„è¾“å‡ºæ ¼å¼ï¼Œè¿™äº›æ ¼å¼å°è£…åœ¨DataStreamçš„æ“ä½œåé¢ï¼šwriteAsText()/ TextOutputFormat-å°†å…ƒç´ æŒ‰è¡Œå†™ä¸ºå­—ç¬¦ä¸²ã€‚é€šè¿‡è°ƒç”¨æ¯ä¸ªå…ƒç´ çš„_toStringï¼ˆï¼‰_æ–¹æ³•è·å¾—å­—ç¬¦ä¸²ã€‚writeAsCsv(...)/ CsvOutputFormat-å°†å…ƒç»„å†™ä¸ºé€—å·åˆ†éš”çš„å€¼æ–‡ä»¶ã€‚è¡Œå’Œå­—æ®µå®šç•Œç¬¦æ˜¯å¯é…ç½®çš„ã€‚æ¯ä¸ªå­—æ®µçš„å€¼æ¥è‡ªå¯¹è±¡çš„_toStringï¼ˆï¼‰_æ–¹æ³•ã€‚print()/ printToErr() - åœ¨æ ‡å‡†è¾“å‡º/æ ‡å‡†é”™è¯¯æµä¸Šæ‰“å°æ¯ä¸ªå…ƒç´ çš„_toStringï¼ˆï¼‰_å€¼ã€‚å¯é€‰åœ°ï¼Œå¯ä»¥æä¾›å‰ç¼€ï¼ˆmsgï¼‰ï¼Œè¯¥å‰ç¼€åœ¨è¾“å‡ºä¹‹å‰ã€‚è¿™å¯ä»¥å¸®åŠ©åŒºåˆ†ä¸åŒçš„_æ‰“å°_è°ƒç”¨ã€‚å¦‚æœå¹¶è¡Œåº¦å¤§äº1ï¼Œåˆ™è¾“å‡ºä¹‹å‰è¿˜å°†å¸¦æœ‰äº§ç”Ÿè¾“å‡ºçš„ä»»åŠ¡çš„æ ‡è¯†ç¬¦ã€‚writeUsingOutputFormat()/ FileOutputFormat-è‡ªå®šä¹‰æ–‡ä»¶è¾“å‡ºçš„æ–¹æ³•å’ŒåŸºç±»ã€‚æ”¯æŒè‡ªå®šä¹‰å¯¹è±¡åˆ°å­—èŠ‚çš„è½¬æ¢ã€‚writeToSocket -æ ¹æ®ä»¥ä¸‹å†…å®¹å°†å…ƒç´ å†™å…¥å¥—æ¥å­— SerializationSchemaaddSink-è°ƒç”¨è‡ªå®šä¹‰æ¥æ”¶å™¨åŠŸèƒ½ã€‚Flinkæ†ç»‘æœ‰è¿æ¥åˆ°å…¶ä»–ç³»ç»Ÿï¼ˆä¾‹å¦‚Apache Kafkaï¼‰çš„è¿æ¥å™¨ï¼Œè¿™äº›è¿æ¥å™¨å®ç°ä¸ºæ¥æ”¶å™¨åŠŸèƒ½ã€‚è¯·æ³¨æ„ï¼Œä¸Šçš„write*()æ–¹æ³•DataStreamä¸»è¦ç”¨äºè°ƒè¯•ç›®çš„ã€‚å®ƒä»¬ä¸å‚ä¸Flinkçš„æ£€æŸ¥ç‚¹ï¼Œè¿™æ„å‘³ç€è¿™äº›åŠŸèƒ½é€šå¸¸å…·æœ‰è‡³å°‘ä¸€æ¬¡çš„è¯­ä¹‰ã€‚åˆ·æ–°åˆ°ç›®æ ‡ç³»ç»Ÿçš„æ•°æ®å–å†³äºOutputFormatçš„å®ç°ã€‚è¿™æ„å‘³ç€å¹¶éæ‰€æœ‰å‘é€åˆ°OutputFormatçš„å…ƒç´ éƒ½ç«‹å³æ˜¾ç¤ºåœ¨ç›®æ ‡ç³»ç»Ÿä¸­ã€‚åŒæ ·ï¼Œåœ¨å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œè¿™äº›è®°å½•å¯èƒ½ä¼šä¸¢å¤±ã€‚ä¸ºäº†å°†æµå¯é ï¼Œå‡†ç¡®åœ°ä¸€æ¬¡ä¼ è¾“åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè¯·ä½¿ç”¨flink-connector-filesystemã€‚åŒæ ·ï¼Œé€šè¿‡è¯¥.addSink(...)æ–¹æ³•çš„è‡ªå®šä¹‰å®ç°å¯ä»¥å‚ä¸Flinkä¸€æ¬¡ç²¾ç¡®è¯­ä¹‰çš„æ£€æŸ¥ç‚¹ã€‚æ‰§è¡Œå‚æ•°åœ¨StreamExecutionEnvironmentåŒ…å«äº†ExecutionConfigå…è®¸ç”¨äºè¿è¡Œç»„å·¥ä½œçš„å…·ä½“é…ç½®å€¼ã€‚è¯·å‚è€ƒæ‰§è¡Œé…ç½® ä»¥è·å–å¤§å¤šæ•°å‚æ•°çš„è¯´æ˜ã€‚è¿™äº›å‚æ•°ä¸“é—¨ä¸DataStream APIæœ‰å…³ï¼šsetAutoWatermarkInterval(long milliseconds)ï¼šè®¾ç½®è‡ªåŠ¨æ°´å°å‘å°„çš„é—´éš”ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è·å–å½“å‰å€¼long getAutoWatermarkInterval()å®¹é”™èƒ½åŠ›çŠ¶æ€å’Œæ£€æŸ¥ç‚¹æè¿°äº†å¦‚ä½•å¯ç”¨å’Œé…ç½®Flinkçš„æ£€æŸ¥ç‚¹æœºåˆ¶ã€‚æ§åˆ¶å»¶è¿Ÿé»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç´ ä¸ä¼šåœ¨ç½‘ç»œä¸Šä¸€å¯¹ä¸€ä¼ è¾“ï¼ˆè¿™ä¼šå¯¼è‡´ä¸å¿…è¦çš„ç½‘ç»œé€šä¿¡ï¼‰ï¼Œä½†æ˜¯ä¼šè¿›è¡Œç¼“å†²ã€‚ç¼“å†²åŒºçš„å¤§å°ï¼ˆå®é™…ä¸Šæ˜¯åœ¨è®¡ç®—æœºä¹‹é—´ä¼ è¾“çš„ï¼‰å¯ä»¥åœ¨Flinké…ç½®æ–‡ä»¶ä¸­è®¾ç½®ã€‚å°½ç®¡æ­¤æ–¹æ³•å¯ä»¥ä¼˜åŒ–ååé‡ï¼Œä½†æ˜¯å½“ä¼ å…¥æµä¸å¤Ÿå¿«æ—¶ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´å»¶è¿Ÿé—®é¢˜ã€‚ä¸ºäº†æ§åˆ¶ååé‡å’Œå»¶è¿Ÿï¼Œæ‚¨å¯ä»¥env.setBufferTimeout(timeoutMillis)åœ¨æ‰§è¡Œç¯å¢ƒï¼ˆæˆ–å„ä¸ªè¿ç®—ç¬¦ï¼‰ä¸Šä½¿ç”¨æ¥è®¾ç½®ç¼“å†²åŒºå¡«å……çš„æœ€å¤§ç­‰å¾…æ—¶é—´ã€‚åœ¨æ­¤æ—¶é—´ä¹‹åï¼Œå³ä½¿ç¼“å†²åŒºæœªæ»¡ï¼Œä¹Ÿä¼šè‡ªåŠ¨å‘é€ç¼“å†²åŒºã€‚æ­¤è¶…æ—¶çš„é»˜è®¤å€¼ä¸º100æ¯«ç§’ã€‚ç”¨æ³•:123val env: LocalStreamEnvironment = StreamExecutionEnvironment.createLocalEnvironmentenv.setBufferTimeout(timeoutMillis)env.generateSequence(1,10).map(myMap).setBufferTimeout(timeoutMillis)ä¸ºäº†æœ€å¤§åŒ–ååé‡ï¼Œè¯·è®¾ç½®set setBufferTimeout(-1)æ¥æ¶ˆé™¤è¶…æ—¶ï¼Œå¹¶ä¸”ä»…åœ¨ç¼“å†²åŒºå·²æ»¡æ—¶æ‰åˆ·æ–°å®ƒä»¬ã€‚ä¸ºäº†ä½¿å»¶è¿Ÿæœ€å°åŒ–ï¼Œè¯·å°†è¶…æ—¶è®¾ç½®ä¸ºæ¥è¿‘0çš„å€¼ï¼ˆä¾‹å¦‚5æˆ–10 msï¼‰ã€‚åº”é¿å…å°†ç¼“å†²åŒºè¶…æ—¶è®¾ç½®ä¸º0ï¼Œå› ä¸ºå®ƒå¯èƒ½å¯¼è‡´ä¸¥é‡çš„æ€§èƒ½ä¸‹é™ã€‚è°ƒè¯•åœ¨åˆ†å¸ƒå¼ç¾¤é›†ä¸­è¿è¡Œæµå¼ç¨‹åºä¹‹å‰ï¼Œæœ€å¥½ç¡®ä¿å·²å®ç°çš„ç®—æ³•æŒ‰é¢„æœŸå·¥ä½œã€‚å› æ­¤ï¼Œå®æ–½æ•°æ®åˆ†æç¨‹åºé€šå¸¸æ˜¯æ£€æŸ¥ç»“æœï¼Œè°ƒè¯•å’Œæ”¹è¿›çš„å¢é‡è¿‡ç¨‹ã€‚Flinkæä¾›çš„åŠŸèƒ½å¯é€šè¿‡åœ¨IDEä¸­æ”¯æŒæœ¬åœ°è°ƒè¯•ï¼Œæ³¨å…¥æµ‹è¯•æ•°æ®å’Œæ”¶é›†ç»“æœæ•°æ®æ¥å¤§å¤§ç®€åŒ–æ•°æ®åˆ†æç¨‹åºçš„å¼€å‘è¿‡ç¨‹ã€‚æœ¬èŠ‚æä¾›ä¸€äº›æç¤ºï¼Œè¯´æ˜å¦‚ä½•ç®€åŒ–Flinkç¨‹åºçš„å¼€å‘ã€‚æœ¬åœ°æ‰§è¡Œç¯å¢ƒA LocalStreamEnvironmentåœ¨åˆ›å»ºè¯¥JVMçš„åŒä¸€JVMè¿›ç¨‹å†…å¯åŠ¨Flinkç³»ç»Ÿã€‚å¦‚æœä»IDEå¯åŠ¨LocalEnvironmentï¼Œåˆ™å¯ä»¥åœ¨ä»£ç ä¸­è®¾ç½®æ–­ç‚¹å¹¶è½»æ¾è°ƒè¯•ç¨‹åºã€‚åˆ›å»ºå¹¶æŒ‰å¦‚ä¸‹æ–¹å¼ä½¿ç”¨LocalEnvironmentï¼š1234val env = StreamExecutionEnvironment.createLocalEnvironment()val lines = env.addSource(/* some source */)// build your programenv.execute()æ”¶é›†æ•°æ®æºFlinkæä¾›äº†ç”±Javaé›†åˆæ”¯æŒçš„ç‰¹æ®Šæ•°æ®æºï¼Œä»¥ç®€åŒ–æµ‹è¯•ã€‚ä¸€æ—¦æµ‹è¯•äº†ç¨‹åºï¼Œå°±å¯ä»¥è½»æ¾åœ°å°†æºå’Œæ¥æ”¶å™¨æ›¿æ¢ä¸ºå¯è¯»å–/å†™å…¥å¤–éƒ¨ç³»ç»Ÿçš„æºå’Œæ¥æ”¶å™¨ã€‚æ”¶é›†æ•°æ®æºå¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼ä½¿ç”¨ï¼š123456789val env = StreamExecutionEnvironment.createLocalEnvironment()// Create a DataStream from a list of elementsval myInts = env.fromElements(1, 2, 3, 4, 5)// Create a DataStream from any Collectionval data: Seq[(String, Int)] = ...val myTuples = env.fromCollection(data)// Create a DataStream from an Iteratorval longIt: Iterator[Long] = ...val myLongs = env.fromCollection(longIt)æ³¨æ„ï¼šå½“å‰ï¼Œé›†åˆæ•°æ®æºè¦æ±‚æ•°æ®ç±»å‹å’Œè¿­ä»£å™¨å®ç° Serializableã€‚æ­¤å¤–ï¼Œæ”¶é›†æ•°æ®æºä¸èƒ½å¹¶è¡Œæ‰§è¡Œï¼ˆå¹¶è¡Œåº¦= 1ï¼‰ã€‚è¿­ä»£å™¨æ•°æ®æ¥æ”¶å™¨Flinkè¿˜æä¾›æ¥æ”¶å™¨ä»¥æ”¶é›†DataStreamç»“æœä»¥è¿›è¡Œæµ‹è¯•å’Œè°ƒè¯•ã€‚å¯ä»¥å¦‚ä¸‹ä½¿ç”¨ï¼š1234import org.apache.flink.streaming.experimental.DataStreamUtilsimport scala.collection.JavaConverters.asScalaIteratorConverterval myResult: DataStream[(String, Int)] = ...val myOutput: Iterator[(String, Int)] = DataStreamUtils.collect(myResult.javaStream).asScalaæ³¨æ„ï¼š flink-streaming-contribæ¨¡å—å·²ä»Flink 1.5.0ä¸­åˆ é™¤ã€‚å·²ç§»å…¥flink-streaming-javaå’Œflink-streaming-scalaã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Flink åŸºç¡€","slug":"Flink-åŸºç¡€","date":"2018-03-15T14:44:42.000Z","updated":"2020-05-12T14:53:28.007Z","comments":true,"path":"2018/03/15/Flink-åŸºç¡€/","link":"","permalink":"cpeixin.cn/2018/03/15/Flink-%E5%9F%BA%E7%A1%80/","excerpt":"","text":"Flink ç¨‹åºæ˜¯å®ç°äº†åˆ†å¸ƒå¼é›†åˆè½¬æ¢ï¼ˆä¾‹å¦‚è¿‡æ»¤ã€æ˜ å°„ã€æ›´æ–°çŠ¶æ€ã€joinã€åˆ†ç»„ã€å®šä¹‰çª—å£ã€èšåˆï¼‰çš„è§„èŒƒåŒ–ç¨‹åºã€‚é›†åˆåˆå§‹åˆ›å»ºè‡ª sourceï¼ˆä¾‹å¦‚è¯»å–æ–‡ä»¶ã€kafka ä¸»é¢˜ï¼Œæˆ–æœ¬åœ°å†…å­˜ä¸­çš„é›†åˆï¼‰ã€‚ç»“æœé€šè¿‡ sink è¿”å›ï¼Œä¾‹å¦‚ï¼Œå®ƒå¯ä»¥å°†æ•°æ®å†™å…¥ï¼ˆåˆ†å¸ƒå¼ï¼‰æ–‡ä»¶ï¼Œæˆ–æ ‡å‡†è¾“å‡ºï¼ˆä¾‹å¦‚å‘½ä»¤è¡Œç»ˆç«¯ï¼‰ã€‚Flink ç¨‹åºå¯ä»¥åœ¨å¤šç§ç¯å¢ƒä¸­è¿è¡Œï¼Œç‹¬ç«‹è¿è¡Œæˆ–åµŒå…¥åˆ°å…¶ä»–ç¨‹åºä¸­ã€‚å¯ä»¥åœ¨æœ¬åœ° JVM ä¸­æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨å¤šå°æœºå™¨çš„é›†ç¾¤ä¸Šæ‰§è¡Œã€‚é’ˆå¯¹æœ‰ç•Œå’Œæ— ç•Œä¸¤ç§æ•°æ® source ç±»å‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ DataSet API æ¥ç¼–å†™æ‰¹å¤„ç†ç¨‹åºæˆ–ä½¿ç”¨ DataStream API æ¥ç¼–å†™æµå¤„ç†ç¨‹åºã€‚æœ¬ç¯‡æŒ‡å—å°†ä»‹ç»è¿™ä¸¤ç§ API é€šç”¨çš„åŸºæœ¬æ¦‚å¿µï¼Œå…³äºä½¿ç”¨ API ç¼–å†™ç¨‹åºçš„å…·ä½“ä¿¡æ¯è¯·æŸ¥é˜… æµå¤„ç†æŒ‡å— å’Œ æ‰¹å¤„ç†æŒ‡å—ã€‚è¯·æ³¨æ„ï¼š** å½“å±•ç¤ºå¦‚ä½•ä½¿ç”¨ API çš„å®é™…ç¤ºä¾‹æ—¶æˆ‘ä»¬ä½¿ç”¨ StreamingExecutionEnvironment å’Œ DataStream APIã€‚å¯¹äºæ‰¹å¤„ç†ï¼Œå°†ä»–ä»¬æ›¿æ¢ä¸º ExecutionEnvironment å’Œ DataSet API å³å¯ï¼Œæ¦‚å¿µæ˜¯å®Œå…¨ç›¸åŒçš„ã€‚DataSet å’Œ DataStreamFlink ç”¨ç‰¹æœ‰çš„ DataSet å’Œ DataStream ç±»æ¥è¡¨ç¤ºç¨‹åºä¸­çš„æ•°æ®ã€‚ä½ å¯ä»¥å°†ä»–ä»¬è§†ä¸ºå¯èƒ½åŒ…å«é‡å¤é¡¹çš„ä¸å¯å˜æ•°æ®é›†åˆã€‚å¯¹äº DataSetï¼Œæ•°æ®æ˜¯æœ‰é™çš„ï¼Œè€Œå¯¹äº DataStreamï¼Œå…ƒç´ çš„æ•°é‡å¯ä»¥æ˜¯æ— é™çš„ã€‚è¿™äº›é›†åˆä¸æ ‡å‡†çš„ Java é›†åˆæœ‰ä¸€äº›å…³é”®çš„åŒºåˆ«ã€‚é¦–å…ˆå®ƒä»¬æ˜¯ä¸å¯å˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬ä¸€æ—¦è¢«åˆ›å»ºä½ å°±ä¸èƒ½æ·»åŠ æˆ–åˆ é™¤å…ƒç´ äº†ã€‚ä½ ä¹Ÿä¸èƒ½ç®€å•åœ°æ£€æŸ¥å®ƒä»¬å†…éƒ¨çš„å…ƒç´ ã€‚åœ¨ Flink ç¨‹åºä¸­ï¼Œé›†åˆæœ€åˆé€šè¿‡æ·»åŠ æ•°æ® source æ¥åˆ›å»ºï¼Œé€šè¿‡ä½¿ç”¨è¯¸å¦‚ mapã€filter ç­‰ API æ–¹æ³•å¯¹æ•°æ® source è¿›è¡Œè½¬æ¢ä»è€Œæ´¾ç”Ÿæ–°çš„é›†åˆã€‚å‰–æä¸€ä¸ª Flink ç¨‹åºFlink ç¨‹åºçœ‹èµ·æ¥åƒæ˜¯è½¬æ¢æ•°æ®é›†åˆçš„è§„èŒƒåŒ–ç¨‹åºã€‚æ¯ä¸ªç¨‹åºç”±ä¸€äº›åŸºæœ¬çš„éƒ¨åˆ†ç»„æˆï¼šè·å–æ‰§è¡Œç¯å¢ƒï¼ŒåŠ è½½/åˆ›å»ºåˆå§‹æ•°æ®ï¼ŒæŒ‡å®šå¯¹æ•°æ®çš„è½¬æ¢æ“ä½œï¼ŒæŒ‡å®šè®¡ç®—ç»“æœå­˜æ”¾çš„ä½ç½®ï¼Œè§¦å‘ç¨‹åºæ‰§è¡Œæˆ‘ä»¬ç°åœ¨å°†æ¦‚è¿°æ¯ä¸ªæ­¥éª¤ï¼Œè¯¦ç»†ä¿¡æ¯è¯·å‚é˜…ç›¸åº”ç« èŠ‚ã€‚è¯·æ³¨æ„æ‰€æœ‰ Scala DataSet API å¯ä»¥åœ¨è¿™ä¸ªåŒ… org.apache.flink.api.scala ä¸­æ‰¾åˆ°ï¼ŒåŒæ—¶ï¼Œæ‰€æœ‰ Scala DataStream API å¯ä»¥åœ¨è¿™ä¸ªåŒ… org.apache.flink.streaming.api.scala ä¸­æ‰¾åˆ°ã€‚StreamExecutionEnvironment æ˜¯æ‰€æœ‰ Flink ç¨‹åºçš„åŸºç¡€ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒçš„è¿™äº›é™æ€æ–¹æ³•è·å–ï¼š123getExecutionEnvironment()createLocalEnvironment()createRemoteEnvironment(host: String, port: Int, jarFiles: String*)é€šå¸¸ä½ åªéœ€è¦ä½¿ç”¨ getExecutionEnvironment()ï¼Œå› ä¸ºå®ƒä¼šæ ¹æ®ä¸Šä¸‹æ–‡ç¯å¢ƒå®Œæˆæ­£ç¡®çš„å·¥ä½œï¼Œå¦‚æœä½ åœ¨ IDE ä¸­æ‰§è¡Œç¨‹åºæˆ–è€…ä½œä¸ºæ ‡å‡†çš„ Java ç¨‹åºæ¥æ‰§è¡Œï¼Œå®ƒä¼šåˆ›å»ºä½ çš„æœ¬æœºæ‰§è¡Œç¯å¢ƒã€‚å¦‚æœä½ å°†ç¨‹åºå°è£…æˆ JAR åŒ…ï¼Œç„¶åé€šè¿‡å‘½ä»¤è¡Œè°ƒç”¨ï¼ŒFlink é›†ç¾¤ç®¡ç†å™¨ä¼šæ‰§è¡Œä½ çš„ main æ–¹æ³•å¹¶ä¸” getExecutionEnvironment() ä¼šè¿”å›åœ¨é›†ç¾¤ä¸Šæ‰§è¡Œç¨‹åºçš„æ‰§è¡Œç¯å¢ƒã€‚é’ˆå¯¹ä¸åŒçš„æ•°æ® sourceï¼Œæ‰§è¡Œç¯å¢ƒæœ‰è‹¥å¹²ä¸åŒçš„è¯»å–æ–‡ä»¶çš„æ–¹æ³•ï¼šä½ å¯ä»¥é€è¡Œè¯»å– CSV æ–‡ä»¶ï¼Œæˆ–è€…ä½¿ç”¨å®Œå…¨è‡ªå®šä¹‰çš„è¾“å…¥æ ¼å¼ã€‚è¦å°†æ–‡æœ¬æ–‡ä»¶ä½œä¸ºä¸€ç³»åˆ—è¡Œè¯»å–ï¼Œä½ å¯ä»¥ä½¿ç”¨ï¼š12val env = StreamExecutionEnvironment.getExecutionEnvironment()val text: DataStream[String] = env.readTextFile(\"file:///path/to/file\")å¦‚æ­¤ä½ ä¼šå¾—åˆ°ä¸€ä¸ª DataStream ç„¶åå¯¹å…¶åº”ç”¨è½¬æ¢æ“ä½œä»è€Œåˆ›å»ºæ–°çš„æ´¾ç”Ÿ DataStreamã€‚é€šè¿‡è°ƒç”¨ DataStream çš„è½¬æ¢å‡½æ•°æ¥è¿›è¡Œè½¬æ¢ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ˜ å°„è½¬æ¢çš„å®ä¾‹ï¼š12val input: DataSet[String] &#x3D; ...val mapped &#x3D; input.map &#123; x &#x3D;&gt; x.toInt &#125;è¿™ä¼šé€šè¿‡æŠŠåŸå§‹æ•°æ®é›†åˆçš„æ¯ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•´æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ DataStreamã€‚ä¸€æ—¦ä½ å¾—åˆ°äº†åŒ…å«æœ€ç»ˆç»“æœçš„ DataStreamï¼Œå°±å¯ä»¥é€šè¿‡åˆ›å»º sink å°†å…¶å†™å…¥å¤–éƒ¨ç³»ç»Ÿã€‚å¦‚ä¸‹æ˜¯ä¸€äº›åˆ›å»º sink çš„ç¤ºä¾‹ï¼š12writeAsText(path: String)print()å½“è®¾å®šå¥½æ•´ä¸ªç¨‹åºä»¥åä½ éœ€è¦è°ƒç”¨ StreamExecutionEnvironment çš„ execute() æ–¹æ³•è§¦å‘ç¨‹åºæ‰§è¡Œã€‚è‡³äºåœ¨ä½ çš„æœ¬æœºè§¦å‘è¿˜æ˜¯æäº¤åˆ°é›†ç¾¤è¿è¡Œå–å†³äº ExecutionEnvironment çš„ç±»å‹ã€‚execute() æ–¹æ³•è¿”å› JobExecutionResultï¼Œå®ƒåŒ…æ‹¬æ‰§è¡Œè€—æ—¶å’Œä¸€ä¸ªç´¯åŠ å™¨çš„ç»“æœã€‚å¦‚æœä½ ä¸éœ€è¦ç­‰å¾…ä½œä¸šçš„ç»“æŸï¼Œåªæ˜¯æƒ³è¦è§¦å‘ç¨‹åºæ‰§è¡Œï¼Œä½ å¯ä»¥è°ƒç”¨ StreamExecutionEnvironment çš„ executeAsync() æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å°†è¿”å›ä¸€ä¸ª JobClient å¯¹è±¡ï¼Œé€šè¿‡ JobClient èƒ½å¤Ÿä¸ç¨‹åºå¯¹åº”çš„ä½œä¸šè¿›è¡Œäº¤äº’ã€‚ä½œä¸ºä¾‹å­ï¼Œè¿™é‡Œä»‹ç»é€šè¿‡ executeAsync() å®ç°ä¸ execute() ç›¸åŒè¡Œä¸ºçš„æ–¹æ³•ã€‚12final JobClient jobClient = env.executeAsync();final JobExecutionResult jobExecutionResult = jobClient.getJobExecutionResult(userClassloader).get();æœ‰å…³æµæ•°æ®çš„ source å’Œ sink ä»¥åŠæœ‰å…³ DataStream æ”¯æŒçš„è½¬æ¢æ“ä½œçš„è¯¦ç»†ä¿¡æ¯è¯·å‚é˜…æµå¤„ç†æŒ‡å—ã€‚æœ‰å…³æ‰¹æ•°æ®çš„ source å’Œ sink ä»¥åŠæœ‰å…³ DataSet æ”¯æŒçš„è½¬æ¢æ“ä½œçš„è¯¦ç»†ä¿¡æ¯è¯·å‚é˜…æ‰¹å¤„ç†æŒ‡å—ã€‚å»¶è¿Ÿè®¡ç®—æ— è®ºåœ¨æœ¬åœ°è¿˜æ˜¯é›†ç¾¤æ‰§è¡Œï¼Œæ‰€æœ‰çš„ Flink ç¨‹åºéƒ½æ˜¯å»¶è¿Ÿæ‰§è¡Œçš„ï¼šå½“ç¨‹åºçš„ main æ–¹æ³•è¢«æ‰§è¡Œæ—¶ï¼Œå¹¶ä¸ç«‹å³æ‰§è¡Œæ•°æ®çš„åŠ è½½å’Œè½¬æ¢ï¼Œè€Œæ˜¯åˆ›å»ºæ¯ä¸ªæ“ä½œå¹¶å°†å…¶åŠ å…¥åˆ°ç¨‹åºçš„æ‰§è¡Œè®¡åˆ’ä¸­ã€‚å½“æ‰§è¡Œç¯å¢ƒè°ƒç”¨ execute() æ–¹æ³•æ˜¾å¼åœ°è§¦å‘æ‰§è¡Œçš„æ—¶å€™æ‰çœŸæ­£æ‰§è¡Œå„ä¸ªæ“ä½œã€‚å»¶è¿Ÿè®¡ç®—å…è®¸ä½ æ„å»ºå¤æ‚çš„ç¨‹åºï¼ŒFlink å°†å…¶ä½œä¸ºæ•´ä½“è®¡åˆ’å•å…ƒæ¥æ‰§è¡Œã€‚æŒ‡å®šé”®ä¸€äº›è½¬æ¢æ“ä½œï¼ˆjoin, coGroup, keyBy, groupByï¼‰è¦æ±‚åœ¨å…ƒç´ é›†åˆä¸Šå®šä¹‰é”®ã€‚å¦å¤–ä¸€äº›è½¬æ¢æ“ä½œ ï¼ˆReduce, GroupReduce, Aggregate, Windowsï¼‰å…è®¸åœ¨åº”ç”¨è¿™äº›è½¬æ¢ä¹‹å‰å°†æ•°æ®æŒ‰é”®åˆ†ç»„ã€‚å¦‚ä¸‹å¯¹ DataSet åˆ†ç»„1234DataSet&lt;...&gt; input = // [...]DataSet&lt;...&gt; reduced = input .groupBy(/*åœ¨è¿™é‡Œå®šä¹‰é”®*/) .reduceGroup(/*ä¸€äº›å¤„ç†æ“ä½œ*/);å¦‚ä¸‹å¯¹ DataStream æŒ‡å®šé”®1234DataStream&lt;...&gt; input = // [...]DataStream&lt;...&gt; windowed = input .keyBy(/*åœ¨è¿™é‡Œå®šä¹‰é”®*/) .window(/*æŒ‡å®šçª—å£*/);Flink çš„æ•°æ®æ¨¡å‹ä¸æ˜¯åŸºäºé”®å€¼å¯¹çš„ã€‚å› æ­¤ä½ ä¸éœ€è¦å°†æ•°æ®é›†ç±»å‹ç‰©ç†åœ°æ‰“åŒ…åˆ°é”®å’Œå€¼ä¸­ã€‚é”®éƒ½æ˜¯â€œè™šæ‹Ÿçš„â€ï¼šå®ƒä»¬çš„åŠŸèƒ½æ˜¯æŒ‡å¯¼åˆ†ç»„ç®—å­ç”¨å“ªäº›æ•°æ®æ¥åˆ†ç»„ã€‚è¯·æ³¨æ„ï¼š*ä¸‹é¢çš„è®¨è®ºä¸­æˆ‘ä»¬å°†ä»¥ *DataStream** å’Œ **keyby** ä¸ºä¾‹ã€‚ å¯¹äº DataSet API ä½ åªéœ€è¦ç”¨ **DataSet** å’Œ **groupBy** æ›¿æ¢å³å¯ã€‚**ä¸º Tuple å®šä¹‰é”®æœ€ç®€å•çš„æ–¹å¼æ˜¯æŒ‰ç…§ Tuple çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µè¿›è¡Œåˆ†ç»„ï¼š12val input: DataStream[(Int, String, Long)] = // [...]val keyed = input.keyBy(0)æŒ‰ç…§ç¬¬ä¸€ä¸ªå­—æ®µï¼ˆæ•´å‹å­—æ®µï¼‰å¯¹ Tuple åˆ†ç»„ã€‚12val input: DataSet[(Int, String, Long)] = // [...]val grouped = input.groupBy(0,1)è¿™é‡Œæˆ‘ä»¬ç”¨ç¬¬ä¸€ä¸ªå­—æ®µå’Œç¬¬äºŒä¸ªå­—æ®µç»„æˆçš„ç»„åˆé”®å¯¹ Tuple åˆ†ç»„å¯¹äºåµŒå¥— Tuple è¯·æ³¨æ„ï¼š å¦‚æœä½ çš„ DataStream æ˜¯åµŒå¥— Tupleï¼Œä¾‹å¦‚ï¼š1DataStream&lt;Tuple3&lt;Tuple2&lt;Integer, Float&gt;,String,Long&gt;&gt; ds;æŒ‡å®š keyBy(0) å°†å¯¼è‡´ç³»ç»Ÿä½¿ç”¨æ•´ä¸ª Tuple2 ä½œä¸ºé”®ï¼ˆä¸€ä¸ªæ•´æ•°å’Œä¸€ä¸ªæµ®ç‚¹æ•°ï¼‰ã€‚ å¦‚æœä½ æƒ³â€œè¿›å…¥â€åˆ° Tuple2 çš„å†…éƒ¨ï¼Œä½ å¿…é¡»ä½¿ç”¨å¦‚ä¸‹æ‰€è¿°çš„å­—æ®µè¡¨è¾¾å¼é”®ã€‚ä½¿ç”¨å­—æ®µè¡¨è¾¾å¼å®šä¹‰é”®å¯ä»¥ä½¿ç”¨åŸºäºå­—ç¬¦ä¸²çš„å­—æ®µè¡¨è¾¾å¼æ¥å¼•ç”¨åµŒå¥—å­—æ®µï¼Œå¹¶å®šä¹‰ç”¨äºåˆ†ç»„ã€æ’åºã€join æˆ– coGrouping çš„é”®ã€‚å­—æ®µè¡¨è¾¾å¼å¯ä»¥å¾ˆå®¹æ˜“åœ°é€‰å–å¤åˆï¼ˆåµŒå¥—ï¼‰ç±»å‹ä¸­çš„å­—æ®µï¼Œä¾‹å¦‚ Tuple å’Œ POJO ç±»å‹ã€‚ä¸‹ä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«â€œwordâ€å’Œâ€œcountâ€ä¸¤ä¸ªå­—æ®µçš„ POJOï¼šWCã€‚è¦ç”¨ word å­—æ®µåˆ†ç»„ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠå®ƒçš„åå­—ä¼ ç»™ keyBy() å‡½æ•°å³å¯ã€‚12345678910// æ™®é€šçš„ POJOï¼ˆç®€å•çš„ Java å¯¹è±¡ï¼‰class WC(var word: String, var count: Int) &#123; def this() &#123; this(\"\", 0L) &#125;&#125;val words: DataStream[WC] = // [...]val wordCounts = words.keyBy(\"word\").window(/*æŒ‡å®šçª—å£*/)// æˆ–è€…ï¼Œä»£ç å°‘ä¸€ç‚¹çš„ case classcase class WC(word: String, count: Int)val words: DataStream[WC] = // [...]val wordCounts = words.keyBy(\"word\").window(/*æŒ‡å®šçª—å£*/)å­—æ®µè¡¨è¾¾å¼è¯­æ³•**ï¼šæ ¹æ®å­—æ®µåç§°é€‰æ‹© POJO çš„å­—æ®µã€‚ä¾‹å¦‚ â€œuserâ€ å°±æ˜¯æŒ‡ POJO ç±»å‹çš„â€œuserâ€å­—æ®µã€‚æ ¹æ® 1 å¼€å§‹çš„å­—æ®µåç§°æˆ– 0 å¼€å§‹çš„å­—æ®µç´¢å¼•é€‰æ‹© Tuple çš„å­—æ®µã€‚ä¾‹å¦‚ â€œ_1â€ å’Œ â€œ5â€ åˆ†åˆ«æŒ‡ Java Tuple ç±»å‹çš„ç¬¬ä¸€ä¸ªå’Œç¬¬å…­ä¸ªå­—æ®µã€‚å¯ä»¥é€‰æ‹© POJO å’Œ Tuple çš„åµŒå¥—å­—æ®µã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ª POJO ç±»å‹æœ‰ä¸€ä¸ªâ€œuserâ€å­—æ®µè¿˜æ˜¯ä¸€ä¸ª POJO ç±»å‹ï¼Œé‚£ä¹ˆ â€œuser.zipâ€ å³æŒ‡è¿™ä¸ªâ€œuserâ€å­—æ®µçš„â€œzipâ€å­—æ®µã€‚ä»»æ„åµŒå¥—å’Œæ··åˆçš„ POJO å’Œ Tupleéƒ½æ˜¯æ”¯æŒçš„ï¼Œä¾‹å¦‚ â€œ_2.user.zipâ€ æˆ– â€œuser._4.1.zipâ€ã€‚å¯ä»¥ä½¿ç”¨ &quot;*&quot; é€šé…ç¬¦è¡¨è¾¾å¼é€‰æ‹©å®Œæ•´çš„ç±»å‹ã€‚è¿™ä¹Ÿé€‚ç”¨äºé Tuple æˆ– POJO ç±»å‹ã€‚å­—æ®µè¡¨è¾¾å¼ç¤ºä¾‹**:12345678910class WC(var complex: ComplexNestedClass, var count: Int) &#123; def this() &#123; this(null, 0) &#125;&#125;class ComplexNestedClass( var someNumber: Int, someFloat: Float, word: (Long, Long, String), hadoopCitizen: IntWritable) &#123; def this() &#123; this(0, 0, (0, 0, \"\"), new IntWritable(0)) &#125;&#125;è¿™äº›å­—æ®µè¡¨è¾¾å¼å¯¹äºä»¥ä¸Šä»£ç ç¤ºä¾‹éƒ½æ˜¯åˆæ³•çš„ï¼š&quot;count&quot;ï¼šWC ç±»çš„ count å­—æ®µã€‚&quot;complex&quot;ï¼šé€’å½’é€‰æ‹© POJO ç±»å‹ ComplexNestedClass çš„ complex å­—æ®µçš„å…¨éƒ¨å­—æ®µã€‚&quot;complex.word._3&quot;ï¼šé€‰æ‹©åµŒå¥— Tuple3 ç±»å‹çš„æœ€åä¸€ä¸ªå­—æ®µã€‚&quot;complex.hadoopCitizen&quot;ï¼šé€‰æ‹© hadoop çš„ IntWritable ç±»å‹ã€‚ä½¿ç”¨é”®é€‰æ‹©å™¨å‡½æ•°å®šä¹‰é”®å®šä¹‰é”®çš„å¦ä¸€ç§æ–¹æ³•æ˜¯â€œé”®é€‰æ‹©å™¨â€å‡½æ•°ã€‚é”®é€‰æ‹©å™¨å‡½æ•°å°†å•ä¸ªå…ƒç´ ä½œä¸ºè¾“å…¥å¹¶è¿”å›å…ƒç´ çš„é”®ã€‚é”®å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œå¹¶ä¸”å¯ä»¥ç”±ç¡®å®šæ€§è®¡ç®—å¾—å‡ºã€‚ä¸‹ä¾‹å±•ç¤ºäº†ä¸€ä¸ªç®€å•è¿”å›å¯¹è±¡å­—æ®µçš„é”®é€‰æ‹©å™¨å‡½æ•°ï¼š1234&#x2F;&#x2F; æ™®é€šçš„ case classcase class WC(word: String, count: Int)val words: DataStream[WC] &#x3D; &#x2F;&#x2F; [...]val keyed &#x3D; words.keyBy( _.word )æŒ‡å®šè½¬æ¢å‡½æ•°å¤§å¤šæ•°è½¬æ¢æ“ä½œéœ€è¦ç”¨æˆ·å®šä¹‰å‡½æ•°ã€‚æœ¬èŠ‚åˆ—ä¸¾äº†æŒ‡å®šå®ƒä»¬çš„ä¸åŒæ–¹æ³•ã€‚Lambda å‡½æ•°æ­£å¦‚å‰é¢çš„ä¾‹å­ä¸­æ‰€è§ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ¥å— lambda å‡½æ•°æ¥æè¿°æ“ä½œï¼š12val data: DataSet[String] = // [...]data.filter &#123; _.startsWith(\"http://\") &#125;1234val data: DataSet[Int] = // [...]data.reduce &#123; (i1,i2) =&gt; i1 + i2 &#125;// æˆ–è€…data.reduce &#123; _ + _ &#125;å¯Œå‡½æ•°æ‰€æœ‰éœ€è¦ç”¨æˆ·å®šä¹‰å‡½æ•°çš„è½¬æ¢æ“ä½œéƒ½å¯ä»¥å°†å¯Œå‡½æ•°ä½œä¸ºå‚æ•°ã€‚ä¾‹å¦‚ï¼Œå¯¹äº1data.map &#123; x =&gt; x.toInt &#125;ä½ å¯ä»¥æ›¿æ¢æˆ123class MyMapFunction extends RichMapFunction[String, Int] &#123; def map(in: String):Int = &#123; in.toInt &#125;&#125;;å¹¶åƒå¾€å¸¸ä¸€æ ·å°†å‡½æ•°ä¼ é€’ç»™ map è½¬æ¢æ“ä½œï¼š1data.map(new MyMapFunction())å¯Œå‡½æ•°ä¹Ÿå¯ä»¥è¢«å®šä¹‰ä¸ºåŒ¿åç±»ï¼š123data.map (new RichMapFunction[String, Int] &#123; def map(in: String):Int &#x3D; &#123; in.toInt &#125;&#125;)å¯Œå‡½æ•°ä¸ºç”¨æˆ·å®šä¹‰å‡½æ•°ï¼ˆmapã€reduce ç­‰ï¼‰é¢å¤–æä¾›äº† 4 ä¸ªæ–¹æ³•ï¼š openã€closeã€getRuntimeContext å’Œ setRuntimeContextã€‚è¿™äº›æ–¹æ³•æœ‰åŠ©äºå‘å‡½æ•°ä¼ å‚ï¼ˆè¯·å‚é˜… å‘å‡½æ•°ä¼ é€’å‚æ•°ï¼‰ã€ åˆ›å»ºå’Œç»ˆæ­¢æœ¬åœ°çŠ¶æ€ã€è®¿é—®å¹¿æ’­å˜é‡ï¼ˆè¯·å‚é˜… å¹¿æ’­å˜é‡ï¼‰ã€è®¿é—®è¯¸å¦‚ç´¯åŠ å™¨å’Œè®¡æ•°å™¨ç­‰è¿è¡Œæ—¶ä¿¡æ¯ï¼ˆè¯·å‚é˜… ç´¯åŠ å™¨å’Œè®¡æ•°å™¨ï¼‰å’Œè¿­ä»£ä¿¡æ¯ï¼ˆè¯·å‚é˜… è¿­ä»£ï¼‰ã€‚æ”¯æŒçš„æ•°æ®ç±»å‹Flink å¯¹äº DataSet æˆ– DataStream ä¸­å¯ä»¥åŒ…å«çš„å…ƒç´ ç±»å‹åšäº†ä¸€äº›é™åˆ¶ã€‚è¿™ä¹ˆåšæ˜¯ä¸ºäº†ä½¿ç³»ç»Ÿèƒ½å¤Ÿåˆ†æç±»å‹ä»¥ç¡®å®šæœ‰æ•ˆçš„æ‰§è¡Œç­–ç•¥ã€‚æœ‰ä¸ƒç§ä¸åŒçš„æ•°æ®ç±»å‹ï¼šJava Tuple å’Œ Scala Case ClassJava POJOåŸºæœ¬æ•°æ®ç±»å‹å¸¸è§„çš„ç±»å€¼Hadoop Writableç‰¹æ®Šç±»å‹Tuple å’Œ Case ClassScala Case Classï¼ˆä»¥åŠä½œä¸º Case Class çš„ç‰¹ä¾‹çš„ Scala Tupleï¼‰æ˜¯å¤åˆç±»å‹ï¼ŒåŒ…å«å›ºå®šæ•°é‡çš„å„ç§ç±»å‹çš„å­—æ®µã€‚Tuple çš„å­—æ®µä» 1 å¼€å§‹ç´¢å¼•ã€‚ä¾‹å¦‚ _1 æŒ‡ç¬¬ä¸€ä¸ªå­—æ®µã€‚Case Class å­—æ®µç”¨åç§°ç´¢å¼•ã€‚123456789case class WordCount(word: String, count: Int)val input = env.fromElements( WordCount(\"hello\", 1), WordCount(\"world\", 2)) // Case Class æ•°æ®é›†input.keyBy(\"word\")// ä»¥å­—æ®µè¡¨è¾¾å¼â€œwordâ€ä¸ºé”®val input2 = env.fromElements((\"hello\", 1), (\"world\", 2)) // Tuple2 æ•°æ®é›†input2.keyBy(0, 1) // ä»¥ç¬¬ 0 å’Œç¬¬ 1 ä¸ªå­—æ®µä¸ºé”®POJOFlink å°†æ»¡è¶³å¦‚ä¸‹æ¡ä»¶çš„ Java å’Œ Scala çš„ç±»ä½œä¸ºç‰¹æ®Šçš„ POJO æ•°æ®ç±»å‹å¤„ç†ï¼šç±»å¿…é¡»æ˜¯å…¬æœ‰çš„ã€‚å®ƒå¿…é¡»æœ‰ä¸€ä¸ªå…¬æœ‰çš„æ— å‚æ„é€ å™¨ï¼ˆé»˜è®¤æ„é€ å™¨ï¼‰ã€‚æ‰€æœ‰çš„å­—æ®µè¦ä¹ˆæ˜¯å…¬æœ‰çš„è¦ä¹ˆå¿…é¡»å¯ä»¥é€šè¿‡ getter å’Œ setter å‡½æ•°è®¿é—®ã€‚ä¾‹å¦‚ä¸€ä¸ªåä¸º foo çš„å­—æ®µï¼Œå®ƒçš„ getter å’Œ setter æ–¹æ³•å¿…é¡»å‘½åä¸º getFoo() å’Œ setFoo()ã€‚å­—æ®µçš„ç±»å‹å¿…é¡»è¢«å·²æ³¨å†Œçš„åºåˆ—åŒ–ç¨‹åºæ‰€æ”¯æŒã€‚POJO é€šå¸¸ç”¨ PojoTypeInfo è¡¨ç¤ºï¼Œå¹¶ä½¿ç”¨ PojoSerializerï¼ˆKryo ä½œä¸ºå¯é…ç½®çš„å¤‡ç”¨åºåˆ—åŒ–å™¨ï¼‰åºåˆ—åŒ–ã€‚ ä¾‹å¤–æƒ…å†µæ˜¯ POJO æ˜¯ Avro ç±»å‹ï¼ˆAvro æŒ‡å®šçš„è®°å½•ï¼‰æˆ–ä½œä¸ºâ€œAvro åå°„ç±»å‹â€ç”Ÿæˆæ—¶ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹POJO ç”± AvroTypeInfo è¡¨ç¤ºï¼Œå¹¶ä¸”ç”± AvroSerializer åºåˆ—åŒ–ã€‚ å¦‚æœéœ€è¦ï¼Œä½ å¯ä»¥æ³¨å†Œè‡ªå·±çš„åºåˆ—åŒ–å™¨ï¼›æ›´å¤šä¿¡æ¯è¯·å‚é˜… åºåˆ—åŒ–ã€‚Flink åˆ†æ POJO ç±»å‹çš„ç»“æ„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¼šæ¨æ–­å‡º POJO çš„å­—æ®µã€‚å› æ­¤ï¼ŒPOJO ç±»å‹æ¯”å¸¸è§„ç±»å‹æ›´æ˜“äºä½¿ç”¨ã€‚æ­¤å¤–ï¼ŒFlink å¯ä»¥æ¯”ä¸€èˆ¬ç±»å‹æ›´é«˜æ•ˆåœ°å¤„ç† POJOã€‚ä¸‹ä¾‹å±•ç¤ºäº†ä¸€ä¸ªæ‹¥æœ‰ä¸¤ä¸ªå…¬æœ‰å­—æ®µçš„ç®€å• POJOã€‚123456789class WordWithCount(var word: String, var count: Int) &#123; def this() &#123; this(null, -1) &#125;&#125;val input = env.fromElements( new WordWithCount(\"hello\", 1), new WordWithCount(\"world\", 2)) // Case Class æ•°æ®é›†input.keyBy(\"word\")// ä»¥å­—æ®µè¡¨è¾¾å¼â€œwordâ€ä¸ºé”®åŸºæœ¬æ•°æ®ç±»å‹Flink æ”¯æŒæ‰€æœ‰ Java å’Œ Scala çš„åŸºæœ¬æ•°æ®ç±»å‹å¦‚ Integerã€ Stringã€å’Œ Doubleã€‚å¸¸è§„çš„ç±»Flink æ”¯æŒå¤§éƒ¨åˆ† Java å’Œ Scala çš„ç±»ï¼ˆAPI å’Œè‡ªå®šä¹‰ï¼‰ã€‚ é™¤äº†åŒ…å«æ— æ³•åºåˆ—åŒ–çš„å­—æ®µçš„ç±»ï¼Œå¦‚æ–‡ä»¶æŒ‡é’ˆï¼ŒI / Oæµæˆ–å…¶ä»–æœ¬åœ°èµ„æºã€‚éµå¾ª Java Beans çº¦å®šçš„ç±»é€šå¸¸å¯ä»¥å¾ˆå¥½åœ°å·¥ä½œã€‚Flink å¯¹äºæ‰€æœ‰æœªè¯†åˆ«ä¸º POJO ç±»å‹çš„ç±»ï¼ˆè¯·å‚é˜…ä¸Šé¢å¯¹äºçš„ POJO è¦æ±‚ï¼‰éƒ½ä½œä¸ºå¸¸è§„ç±»å¤„ç†ã€‚ Flink å°†è¿™äº›æ•°æ®ç±»å‹è§†ä¸ºé»‘ç›’ï¼Œå¹¶ä¸”æ— æ³•è®¿é—®å…¶å†…å®¹ï¼ˆä¸ºäº†è¯¸å¦‚é«˜æ•ˆæ’åºç­‰ç›®çš„ï¼‰ã€‚å¸¸è§„ç±»ä½¿ç”¨ Kryo åºåˆ—åŒ–æ¡†æ¶è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚å€¼å€¼ ç±»å‹æ‰‹å·¥æè¿°å…¶åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚å®ƒä»¬ä¸æ˜¯é€šè¿‡é€šç”¨åºåˆ—åŒ–æ¡†æ¶ï¼Œè€Œæ˜¯é€šè¿‡å®ç°org.apache.flinktypes.Value æ¥å£çš„ read å’Œ write æ–¹æ³•æ¥ä¸ºè¿™äº›æ“ä½œæä¾›è‡ªå®šä¹‰ç¼–ç ã€‚å½“é€šç”¨åºåˆ—åŒ–æ•ˆç‡éå¸¸ä½æ—¶ï¼Œä½¿ç”¨å€¼ç±»å‹æ˜¯åˆç†çš„ã€‚ä¾‹å¦‚ï¼Œç”¨æ•°ç»„å®ç°ç¨€ç–å‘é‡ã€‚å·²çŸ¥æ•°ç»„å¤§éƒ¨åˆ†å…ƒç´ ä¸ºé›¶ï¼Œå°±å¯ä»¥å¯¹éé›¶å…ƒç´ ä½¿ç”¨ç‰¹æ®Šç¼–ç ï¼Œè€Œé€šç”¨åºåˆ—åŒ–åªä¼šç®€å•åœ°å°†æ‰€æœ‰æ•°ç»„å…ƒç´ éƒ½å†™å…¥ã€‚org.apache.flinktypes.CopyableValue æ¥å£ä»¥ç±»ä¼¼çš„æ–¹å¼æ”¯æŒå†…éƒ¨æ‰‹å·¥å…‹éš†é€»è¾‘ã€‚Flink æœ‰ä¸åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„é¢„å®šä¹‰å€¼ç±»å‹ã€‚ï¼ˆByteValueã€ ShortValueã€ IntValueã€LongValueã€ FloatValueã€DoubleValueã€ StringValueã€CharValueã€ BooleanValueï¼‰ã€‚è¿™äº›å€¼ç±»å‹å……å½“åŸºæœ¬æ•°æ®ç±»å‹çš„å¯å˜å˜ä½“ï¼šå®ƒä»¬çš„å€¼å¯ä»¥æ”¹å˜ï¼Œå…è®¸ç¨‹åºå‘˜é‡ç”¨å¯¹è±¡å¹¶å‡è½»åƒåœ¾å›æ”¶å™¨çš„å‹åŠ›ã€‚Hadoop Writableå¯ä»¥ä½¿ç”¨å®ç°äº† org.apache.hadoop.Writable æ¥å£çš„ç±»å‹ã€‚å®ƒä»¬ä¼šä½¿ç”¨ write() å’Œ readFields() æ–¹æ³•ä¸­å®šä¹‰çš„åºåˆ—åŒ–é€»è¾‘ã€‚ç‰¹æ®Šç±»å‹å¯ä»¥ä½¿ç”¨ç‰¹æ®Šç±»å‹ï¼ŒåŒ…æ‹¬ Scala çš„ Eitherã€Option å’Œ Tryã€‚ Java API æœ‰å¯¹ Either çš„è‡ªå®šä¹‰å®ç°ã€‚ ç±»ä¼¼äº Scala çš„ Eitherï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªå…·æœ‰ Left æˆ– Right ä¸¤ç§å¯èƒ½ç±»å‹çš„å€¼ã€‚ Either å¯ç”¨äºé”™è¯¯å¤„ç†æˆ–éœ€è¦è¾“å‡ºä¸¤ç§ä¸åŒç±»å‹è®°å½•çš„ç®—å­ã€‚ç±»å‹æ“¦é™¤å’Œç±»å‹æ¨æ–­_Java ç¼–è¯‘å™¨åœ¨ç¼–è¯‘åæŠ›å¼ƒäº†å¤§é‡æ³›å‹ç±»å‹ä¿¡æ¯ã€‚è¿™åœ¨ Java ä¸­è¢«ç§°ä½œ _ç±»å‹æ“¦é™¤_ã€‚å®ƒæ„å‘³ç€åœ¨è¿è¡Œæ—¶ï¼Œå¯¹è±¡çš„å®ä¾‹å·²ç»ä¸çŸ¥é“å®ƒçš„æ³›å‹ç±»å‹äº†ã€‚ä¾‹å¦‚ DataStream&lt;String&gt; å’Œ DataStream&lt;Long&gt; çš„å®ä¾‹åœ¨ JVM çœ‹æ¥æ˜¯ä¸€æ ·çš„ã€‚Flink åœ¨å‡†å¤‡ç¨‹åºæ‰§è¡Œæ—¶ï¼ˆç¨‹åºçš„ main æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼‰éœ€è¦ç±»å‹ä¿¡æ¯ã€‚Flink Java API å°è¯•é‡å»ºä»¥å„ç§æ–¹å¼ä¸¢å¼ƒçš„ç±»å‹ä¿¡æ¯ï¼Œå¹¶å°†å…¶æ˜¾å¼å­˜å‚¨åœ¨æ•°æ®é›†å’Œç®—å­ä¸­ã€‚ä½ å¯ä»¥é€šè¿‡ DataStream.getType() è·å–æ•°æ®ç±»å‹ã€‚æ­¤æ–¹æ³•è¿”å› TypeInformation çš„ä¸€ä¸ªå®ä¾‹ï¼Œè¿™æ˜¯ Flink å†…éƒ¨è¡¨ç¤ºç±»å‹çš„æ–¹å¼ã€‚ç±»å‹æ¨æ–­æœ‰å…¶å±€é™æ€§ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹éœ€è¦ç¨‹åºå‘˜çš„â€œé…åˆâ€ã€‚ è¿™æ–¹é¢çš„ç¤ºä¾‹æ˜¯ä»é›†åˆåˆ›å»ºæ•°æ®é›†çš„æ–¹æ³•ï¼Œä¾‹å¦‚ ExecutionEnvironment.fromCollection()ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œä¼ é€’ä¸€ä¸ªæè¿°ç±»å‹çš„å‚æ•°ã€‚ åƒMapFunction&lt;I, O&gt; è¿™æ ·çš„æ³›å‹å‡½æ•°åŒæ ·å¯èƒ½éœ€è¦é¢å¤–çš„ç±»å‹ä¿¡æ¯ã€‚å¯ä»¥é€šè¿‡è¾“å…¥æ ¼å¼å’Œå‡½æ•°å®ç° ResultTypeQueryable æ¥å£ï¼Œä»¥æ˜ç¡®å‘ŠçŸ¥ API å…¶è¿”å›ç±»å‹ã€‚ è¢«è°ƒå‡½æ•°çš„_è¾“å…¥ç±»å‹_é€šå¸¸å¯ä»¥é€šè¿‡å…ˆå‰æ“ä½œçš„ç»“æœç±»å‹æ¥æ¨æ–­ã€‚ç´¯åŠ å™¨å’Œè®¡æ•°å™¨ç´¯åŠ å™¨ç®€å•åœ°ç”± åŠ æ³•æ“ä½œ å’Œ æœ€ç»ˆç´¯åŠ ç»“æœæ„æˆï¼Œå¯åœ¨ä½œä¸šç»“æŸåä½¿ç”¨ã€‚æœ€ç®€å•çš„ç´¯åŠ å™¨æ˜¯ä¸€ä¸ª è®¡æ•°å™¨ï¼šä½ å¯ä»¥ä½¿ç”¨ Accumulator.add(V value) æ–¹æ³•é€’å¢å®ƒã€‚ä½œä¸šç»“æŸæ—¶ Flink ä¼šåˆè®¡ï¼ˆåˆå¹¶ï¼‰æ‰€æœ‰çš„éƒ¨åˆ†ç»“æœå¹¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚ç´¯åŠ å™¨åœ¨ debug æˆ–è€…ä½ æƒ³å¿«é€Ÿäº†è§£æ•°æ®çš„æ—¶å€™éå¸¸æœ‰ç”¨ã€‚Flink ç›®å‰æœ‰å¦‚ä¸‹ å†…ç½®ç´¯åŠ å™¨ã€‚å®ƒä»¬æ¯ä¸€ä¸ªéƒ½å®ç°äº† Accumulator æ¥å£ã€‚IntCounter, LongCounter å’Œ DoubleCounterï¼š æœ‰å…³ä½¿ç”¨è®¡æ•°å™¨çš„ç¤ºä¾‹ï¼Œè¯·å‚è§ä¸‹æ–‡ã€‚Histogram: ç¦»æ•£æ•°é‡æ¡¶çš„ç›´æ–¹å›¾å®ç°ã€‚åœ¨å†…éƒ¨ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªä»æ•´æ•°åˆ°æ•´æ•°çš„æ˜ å°„ã€‚ä½ å¯ä»¥ç”¨å®ƒè®¡ç®—å€¼çš„åˆ†å¸ƒï¼Œä¾‹å¦‚ä¸€ä¸ªè¯é¢‘ç»Ÿè®¡ç¨‹åºä¸­æ¯è¡Œè¯é¢‘çš„åˆ†å¸ƒã€‚å¦‚ä½•ä½¿ç”¨ç´¯åŠ å™¨ï¼š**é¦–å…ˆä½ å¿…é¡»åœ¨è¦ä½¿ç”¨å®ƒçš„ç”¨æˆ·å®šä¹‰è½¬æ¢å‡½æ•°ä¸­åˆ›å»ºç´¯åŠ å™¨å¯¹è±¡ï¼ˆä¸‹ä¾‹ä¸ºè®¡æ•°å™¨ï¼‰ã€‚1private IntCounter numLines = new IntCounter();å…¶æ¬¡ï¼Œä½ å¿…é¡»æ³¨å†Œç´¯åŠ å™¨å¯¹è±¡ï¼Œé€šå¸¸åœ¨å¯Œå‡½æ•°çš„ open() æ–¹æ³•ä¸­ã€‚åœ¨è¿™é‡Œä½ è¿˜å¯ä»¥å®šä¹‰åç§°ã€‚1getRuntimeContext().addAccumulator(\"num-lines\", this.numLines);ä½ ç°åœ¨å¯ä»¥åœ¨ç®—å­å‡½æ•°ä¸­çš„ä»»ä½•ä½ç½®ä½¿ç”¨ç´¯åŠ å™¨ï¼ŒåŒ…æ‹¬ open() å’Œ close() æ–¹æ³•ã€‚1this.numLines.add(1);æ€»ä½“ç»“æœå°†å­˜å‚¨åœ¨ JobExecutionResult å¯¹è±¡ä¸­ï¼Œè¯¥å¯¹è±¡æ˜¯ä»æ‰§è¡Œç¯å¢ƒçš„ execute() æ–¹æ³•è¿”å›çš„ ï¼ˆç›®å‰è¿™ä»…åœ¨æ‰§è¡Œç­‰å¾…ä½œä¸šå®Œæˆæ—¶æ‰æœ‰æ•ˆï¼‰ã€‚1myJobExecutionResult.getAccumulatorResult(&quot;num-lines&quot;)æ¯ä¸ªä½œä¸šçš„æ‰€æœ‰ç´¯åŠ å™¨å…±äº«ä¸€ä¸ªå‘½åç©ºé—´ã€‚ è¿™æ ·ä½ å°±å¯ä»¥åœ¨ä½œä¸šçš„ä¸åŒç®—å­å‡½æ•°ä¸­ä½¿ç”¨ç›¸åŒçš„ç´¯åŠ å™¨ã€‚Flink ä¼šåœ¨å†…éƒ¨åˆå¹¶æ‰€æœ‰åŒåç´¯åŠ å™¨ã€‚å…³äºç´¯åŠ å™¨å’Œè¿­ä»£è¯·æ³¨æ„ï¼š ç›®å‰ï¼Œç´¯åŠ å™¨çš„ç»“æœåªæœ‰åœ¨æ•´ä¸ªä½œä¸šç»“æŸä»¥åæ‰å¯ç”¨ã€‚æˆ‘ä»¬è¿˜è®¡åˆ’å®ç°åœ¨ä¸‹ä¸€æ¬¡è¿­ä»£ä¸­ä½¿å‰ä¸€æ¬¡è¿­ä»£çš„ç»“æœå¯ç”¨ã€‚ä½ å¯ä»¥ä½¿ç”¨ Aggregators è®¡ç®—æ¯æ¬¡è¿­ä»£çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œå¹¶æ ¹æ®è¿™äº›ä¿¡æ¯ç¡®å®šè¿­ä»£ä½•æ—¶ç»ˆæ­¢ã€‚è‡ªå®šä¹‰ç´¯åŠ å™¨ï¼šè¦å®ç°ä½ è‡ªå·±çš„ç´¯åŠ å™¨ï¼Œåªéœ€ç¼–å†™ç´¯åŠ å™¨æ¥å£çš„å®ç°å³å¯ã€‚å¦‚æœä½ è®¤ä¸º Flink åº”è¯¥æä¾›ä½ çš„è‡ªå®šä¹‰ç´¯åŠ å™¨ï¼Œè¯·åˆ›å»º pull requestã€‚ä½ å¯ä»¥é€‰æ‹©å®ç° Accumulator æˆ–è€… SimpleAccumulatorã€‚Accumulator&lt;V,R&gt; æœ€çµæ´»ï¼šå®ƒä¸ºè¦é€’å¢çš„å€¼å®šä¹‰ç±»å‹ Vï¼Œä¸ºæœ€ç»ˆç»“æœå®šä¹‰ç±»å‹ Rã€‚ä¾‹å¦‚å¯¹äº histogramï¼ŒV æ˜¯æ•°å­—è€Œ R æ˜¯ histogramã€‚SimpleAccumulator åˆ™é€‚ç”¨äºä¸¤ä¸ªç±»å‹ç›¸åŒçš„æƒ…å†µï¼Œä¾‹å¦‚è®¡æ•°å™¨ã€‚Scala APIæ‰©å±•ä¸ºäº†åœ¨Scalaå’ŒJava APIä¹‹é—´ä¿æŒç›¸å½“ç¨‹åº¦çš„ä¸€è‡´æ€§ï¼Œç”¨äºæ‰¹å¤„ç†å’Œæµä¼ è¾“çš„æ ‡å‡†APIçœç•¥äº†ä¸€äº›å…è®¸åœ¨Scalaä¸­è¿›è¡Œé«˜æ°´å¹³è¡¨è¾¾çš„åŠŸèƒ½ã€‚å¦‚æœæ‚¨æƒ³_äº«å—å®Œæ•´çš„Scalaä½“éªŒ_ï¼Œåˆ™å¯ä»¥é€‰æ‹©åŠ å…¥é€šè¿‡éšå¼è½¬æ¢æ¥å¢å¼ºScala APIçš„æ‰©å±•ã€‚è¦ä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„æ‰©å±•ï¼Œæ‚¨åªéœ€importä¸ºDataSet API æ·»åŠ ä¸€ä¸ªç®€å•çš„1import org.apache.flink.api.scala.extensions._æˆ–DataStream API1import org.apache.flink.streaming.api.scala.extensions._å¦å¤–ï¼Œæ‚¨ä¹Ÿå¯ä»¥å¯¼å…¥å•ä¸ªæ‰©å±•_ä¸€ä¸ªç‚¹èœ_åªä½¿ç”¨é‚£äº›ä½ å–œæ¬¢ã€‚é€šå¸¸ï¼ŒDataSetå’ŒDataStream APIéƒ½ä¸æ¥å—åŒ¿åæ¨¡å¼åŒ¹é…å‡½æ•°æ¥è§£æ„å…ƒç»„ï¼Œæ¡ˆä¾‹ç±»æˆ–é›†åˆï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š123456val data: DataSet[(Int, String, Double)] = // [...]data.map &#123; case (id, name, temperature) =&gt; // [...] // The previous line causes the following compilation error: // \"The argument types of an anonymous function must be fully known. (SLS 8.5)\"&#125;æ­¤æ‰©å±•åœ¨DataSetå’ŒDataStream Scala APIä¸­å¼•å…¥äº†æ–°æ–¹æ³•ï¼Œè¿™äº›æ–°æ–¹æ³•åœ¨æ‰©å±•APIä¸­å…·æœ‰ä¸€å¯¹ä¸€çš„å¯¹åº”å…³ç³»ã€‚è¿™äº›å§”æ‰˜æ–¹æ³•ç¡®å®æ”¯æŒåŒ¿åæ¨¡å¼åŒ¹é…åŠŸèƒ½ã€‚DataSet APIMethodOriginalExamplemapWithmap (DataSet)```data.mapWith {case (_, value) =&gt; value.toString}12 || **mapPartitionWith** | **mapPartition (DataSet)** |data.mapPartitionWith {case head #:: _ =&gt; head}12 || **flatMapWith** | **flatMap (DataSet)** |data.flatMapWith {case (_, name, visitTimes) =&gt; visitTimes.map(name -&gt; _)}12 || **filterWith** | **filter (DataSet)** |data.filterWith {case Train(_, isOnTime) =&gt; isOnTime}12 || **reduceWith** | **reduce (DataSet, GroupedDataSet)** |data.reduceWith {case ((, amount1), (, amount2)) =&gt; amount1 + amount2}12 || **reduceGroupWith** | **reduceGroup (GroupedDataSet)** |data.reduceGroupWith {case id #:: value #:: _ =&gt; id -&gt; value}12 || **groupingBy** | **groupBy (DataSet)** |data.groupingBy {case (id, _, _) =&gt; id}12 || **sortGroupWith** | **sortGroup (GroupedDataSet)** |grouped.sortGroupWith(Order.ASCENDING) {case House(_, value) =&gt; value}12 || **combineGroupWith** | **combineGroup (GroupedDataSet)** |grouped.combineGroupWith {case header #:: amounts =&gt; amounts.sum}12 || **projecting** | **apply (JoinDataSet, CrossDataSet)** |data1.join(data2).whereClause(case (pk, _) =&gt; pk).isEqualTo(case (_, fk) =&gt; fk).projecting {case ((pk, tx), (products, fk)) =&gt; tx -&gt; products}data1.cross(data2).projecting {case ((a, ), (, b) =&gt; a -&gt; b}12 || **projecting** | **apply (CoGroupDataSet)** |data1.coGroup(data2).whereClause(case (pk, _) =&gt; pk).isEqualTo(case (_, fk) =&gt; fk).projecting {case (head1 #:: _, head2 #:: _) =&gt; head1 -&gt; head2}}123456789 |&lt;a name&#x3D;&quot;datastream-api&quot;&gt;&lt;&#x2F;a&gt;#### &lt;a name&#x3D;&quot;n1Myp&quot;&gt;&lt;&#x2F;a&gt;#### DataStream API| Method | Original | Example || :--- | :--- | :---: || **mapWith** | **map (DataStream)** |data.mapWith {case (_, value) =&gt; value.toString}12 || **flatMapWith** | **flatMap (DataStream)** |data.flatMapWith {case (_, name, visits) =&gt; visits.map(name -&gt; _)}12 || **filterWith** | **filter (DataStream)** |data.filterWith {case Train(_, isOnTime) =&gt; isOnTime}12 || **keyingBy** | **keyBy (DataStream)** |data.keyingBy {case (id, _, _) =&gt; id}12 || **mapWith** | **map (ConnectedDataStream)** |data.mapWith(map1 = case (_, value) =&gt; value.toString,map2 = case (_, _, value, _) =&gt; value + 1)12 || **flatMapWith** | **flatMap (ConnectedDataStream)** |data.flatMapWith(flatMap1 = case (_, json) =&gt; parse(json),flatMap2 = case (_, _, json, _) =&gt; parse(json))12 || **keyingBy** | **keyBy (ConnectedDataStream)** |data.keyingBy(key1 = case (_, timestamp) =&gt; timestamp,key2 = case (id, _, _) =&gt; id)12 || **reduceWith** | **reduce (KeyedStream, WindowedStream)** |data.reduceWith {case ((, sum1), (, sum2) =&gt; sum1 + sum2}12 || **foldWith** | **fold (KeyedStream, WindowedStream)** |data.foldWith(User(bought = 0)) {case (User(b), (_, items)) =&gt; User(b + items.size)}12 || **applyWith** | **apply (WindowedStream)** |data.applyWith(0)(foldFunction = case (sum, amount) =&gt; sum + amountwindowFunction = case (k, w, sum) =&gt; // [â€¦])12 || **projecting** | **apply (JoinedStream)** |data1.join(data2).whereClause(case (pk, _) =&gt; pk).isEqualTo(case (_, fk) =&gt; fk).projecting {case ((pk, tx), (products, fk)) =&gt; tx -&gt; products}1234567 |&lt;br &#x2F;&gt;æœ‰å…³æ¯ç§æ–¹æ³•çš„è¯­ä¹‰çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ [DataSet](https:&#x2F;&#x2F;ci.apache.org&#x2F;projects&#x2F;flink&#x2F;flink-docs-release-1.10&#x2F;dev&#x2F;batch&#x2F;index.html)å’Œ[DataStream](https:&#x2F;&#x2F;ci.apache.org&#x2F;projects&#x2F;flink&#x2F;flink-docs-release-1.10&#x2F;dev&#x2F;datastream_api.html) APIæ–‡æ¡£ã€‚&lt;br &#x2F;&gt;&lt;br &#x2F;&gt;è¦ä¸“é—¨ä½¿ç”¨æ­¤æ‰©å±•ï¼Œå¯ä»¥æ·»åŠ ä»¥ä¸‹å†…å®¹&#96;import&#96;ï¼š&#96;&#96;&#96;scalaimport org.apache.flink.api.scala.extensions.acceptPartialFunctionsç”¨äºæ•°æ®é›†æ‰©å±•å’Œ1import org.apache.flink.streaming.api.scala.extensions.acceptPartialFunctionsä»¥ä¸‹ä»£ç ç‰‡æ®µæ˜¾ç¤ºäº†å¦‚ä½•ä¸€èµ·ä½¿ç”¨è¿™äº›æ‰©å±•æ–¹æ³•ï¼ˆä¸DataSet APIä¸€èµ·ä½¿ç”¨ï¼‰çš„æœ€å°ç¤ºä¾‹ï¼š12345678910111213141516171819object Main &#123; import org.apache.flink.api.scala.extensions._ case class Point(x: Double, y: Double) def main(args: Array[String]): Unit = &#123; val env = ExecutionEnvironment.getExecutionEnvironment val ds = env.fromElements(Point(1, 2), Point(3, 4), Point(5, 6)) ds.filterWith &#123; case Point(x, _) =&gt; x &gt; 1 &#125;.reduceWith &#123; case (Point(x1, y1), (Point(x2, y2))) =&gt; Point(x1 + y1, x2 + y2) &#125;.mapWith &#123; case Point(x, y) =&gt; (x, y) &#125;.flatMapWith &#123; case (x, y) =&gt; Seq(\"x\" -&gt; x, \"y\" -&gt; y) &#125;.groupingBy &#123; case (id, value) =&gt; id &#125; &#125;&#125;","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"MySQLä¸­å¦‚ä½•å®ç°äº‹åŠ¡","slug":"MySQLä¸­å¦‚ä½•å®ç°äº‹åŠ¡","date":"2018-03-10T14:04:36.000Z","updated":"2020-05-10T14:06:56.435Z","comments":true,"path":"2018/03/10/MySQLä¸­å¦‚ä½•å®ç°äº‹åŠ¡/","link":"","permalink":"cpeixin.cn/2018/03/10/MySQL%E4%B8%AD%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%BA%8B%E5%8A%A1/","excerpt":"","text":"äº‹åŠ¡ï¼ˆTransactionï¼‰ï¼Œä¸€èˆ¬æ˜¯æŒ‡è¦åšçš„æˆ–æ‰€åšçš„äº‹æƒ…ã€‚åœ¨è®¡ç®—æœºæœ¯è¯­ä¸­æ˜¯æŒ‡è®¿é—®å¹¶å¯èƒ½æ›´æ–°æ•°æ®åº“ä¸­å„ç§æ•°æ®é¡¹çš„ä¸€ä¸ªç¨‹åºæ‰§è¡Œå•å…ƒ(unit)ã€‚äº‹åŠ¡å…¶å®å°±æ˜¯å¹¶å‘æ§åˆ¶çš„åŸºæœ¬å•ä½ï¼›ç‰¹æ€§äº‹åŠ¡æ˜¯æ¢å¤å’Œå¹¶å‘æ§åˆ¶çš„åŸºæœ¬å•ä½ã€‚äº‹åŠ¡åº”è¯¥å…·æœ‰4ä¸ªå±æ€§ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ã€‚è¿™å››ä¸ªå±æ€§é€šå¸¸ç§°ä¸ºACIDç‰¹æ€§ã€‚åŸå­æ€§ï¼ˆatomicityï¼‰ã€‚ä¸€ä¸ªäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­åŒ…æ‹¬çš„æ“ä½œè¦ä¹ˆéƒ½åšï¼Œè¦ä¹ˆéƒ½ä¸åšã€‚ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ã€‚äº‹åŠ¡å¿…é¡»æ˜¯ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚ä¸€è‡´æ€§ä¸åŸå­æ€§æ˜¯å¯†åˆ‡ç›¸å…³çš„ã€‚éš”ç¦»æ€§ï¼ˆisolationï¼‰ã€‚ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°ã€‚å³ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹å¹¶å‘çš„å…¶ä»–äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰°ã€‚æŒä¹…æ€§ï¼ˆdurabilityï¼‰ã€‚æŒä¹…æ€§ä¹Ÿç§°æ°¸ä¹…æ€§ï¼ˆpermanenceï¼‰ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±åº”è¯¥æ˜¯æ°¸ä¹…æ€§çš„ã€‚æ¥ä¸‹æ¥çš„å…¶ä»–æ“ä½œæˆ–æ•…éšœä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚MySQLæ€ä¹ˆå®ç°äº‹åŠ¡çš„ï¼Ÿäº‹åŠ¡æ˜¯MySQLç­‰å…³ç³»å‹æ•°æ®åº“åŒºåˆ«äºNoSQLçš„é‡è¦æ–¹é¢ï¼Œæ˜¯ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„é‡è¦æ‰‹æ®µã€‚MySQL äº‹åŠ¡ä¸»è¦ç”¨äºå¤„ç†æ“ä½œé‡å¤§ï¼Œå¤æ‚åº¦é«˜çš„æ•°æ®ã€‚æ¯”å¦‚è¯´ï¼Œåœ¨äººå‘˜ç®¡ç†ç³»ç»Ÿä¸­ï¼Œä½ åˆ é™¤ä¸€ä¸ªäººå‘˜ï¼Œä½ æ—¢éœ€è¦åˆ é™¤äººå‘˜çš„åŸºæœ¬èµ„æ–™ï¼Œä¹Ÿè¦åˆ é™¤å’Œè¯¥äººå‘˜ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚ä¿¡ç®±ï¼Œæ–‡ç« ç­‰ç­‰ï¼Œè¿™æ ·ï¼Œè¿™äº›æ•°æ®åº“æ“ä½œè¯­å¥å°±æ„æˆä¸€ä¸ªäº‹åŠ¡ï¼MySQLåœ¨æ¶æ„æ–¹é¢åˆ†ä¸ºä¸‰å±‚ï¼šç¬¬ä¸€å±‚ï¼šå¤„ç†å®¢æˆ·ç«¯è¿æ¥ã€æˆæƒè®¤è¯ç­‰ã€‚ç¬¬äºŒå±‚ï¼šæœåŠ¡å™¨å±‚ï¼Œè´Ÿè´£æŸ¥è¯¢è¯­å¥çš„è§£æã€ä¼˜åŒ–ã€ç¼“å­˜ä»¥åŠå†…ç½®å‡½æ•°çš„å®ç°ã€å­˜å‚¨è¿‡ç¨‹ç­‰ã€‚ç¬¬ä¸‰å±‚ï¼šå­˜å‚¨å¼•æ“ï¼Œè´Ÿè´£MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ã€‚MySQLä¸­æœåŠ¡å™¨å±‚ä¸ç®¡ç†äº‹åŠ¡ï¼Œäº‹åŠ¡æ˜¯ç”±å­˜å‚¨å¼•æ“å®ç°çš„ã€‚**MySQLæ”¯æŒäº‹åŠ¡çš„å­˜å‚¨å¼•æ“æœ‰InnoDBã€BDB Clusterç­‰ï¼Œå…¶ä¸­InnoDBçš„ä½¿ç”¨æœ€ä¸ºå¹¿æ³›ï¼›å…¶ä»–å­˜å‚¨å¼•æ“ä¸æ”¯æŒäº‹åŠ¡ï¼Œå¦‚MyIsamã€Memoryç­‰ã€‚å®ç°åŸç† #### åŸå­æ€§å¦‚æœäº‹åŠ¡ä¸å…·å¤‡åŸå­æ€§ï¼Œé‚£ä¹ˆå°±æ²¡åŠæ³•ä¿è¯åŒä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½è¢«æ‰§è¡Œæˆ–è€…æœªè¢«æ‰§è¡Œäº†ï¼Œæ•´ä¸ªæ•°æ®åº“ç³»ç»Ÿå°±æ—¢ä¸å¯ç”¨ä¹Ÿä¸å¯ä¿¡ã€‚æƒ³è¦ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ï¼Œå°±éœ€è¦åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå¯¹å·²ç»æ‰§è¡Œçš„æ“ä½œè¿›è¡Œå›æ»šã€‚åœ¨ MySQL ä¸­ï¼Œæ¢å¤æœºåˆ¶æ˜¯é€šè¿‡_å›æ»šæ—¥å¿—_ï¼ˆundo logï¼‰å®ç°çš„ï¼Œæ‰€æœ‰äº‹åŠ¡è¿›è¡Œçš„ä¿®æ”¹éƒ½ä¼šå…ˆè®°å½•åˆ°è¿™ä¸ªå›æ»šæ—¥å¿—ä¸­ï¼Œç„¶ååœ¨å¯¹æ•°æ®åº“ä¸­çš„å¯¹åº”è¡Œè¿›è¡Œå†™å…¥ã€‚å›æ»šæ—¥å¿—é™¤äº†èƒ½å¤Ÿåœ¨å‘ç”Ÿé”™è¯¯æˆ–è€…ç”¨æˆ·æ‰§è¡Œ ROLLBACK æ—¶æä¾›å›æ»šç›¸å…³çš„ä¿¡æ¯ï¼Œå®ƒè¿˜èƒ½å¤Ÿåœ¨æ•´ä¸ªç³»ç»Ÿå‘ç”Ÿå´©æºƒã€æ•°æ®åº“è¿›ç¨‹ç›´æ¥è¢«æ€æ­»åï¼Œå½“ç”¨æˆ·å†æ¬¡å¯åŠ¨æ•°æ®åº“è¿›ç¨‹æ—¶ï¼Œè¿˜èƒ½å¤Ÿç«‹åˆ»é€šè¿‡æŸ¥è¯¢å›æ»šæ—¥å¿—å°†ä¹‹å‰æœªå®Œæˆçš„äº‹åŠ¡è¿›è¡Œå›æ»šï¼Œè¿™ä¹Ÿå°±éœ€è¦å›æ»šæ—¥å¿—å¿…é¡»å…ˆäºæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œæ˜¯æˆ‘ä»¬éœ€è¦å…ˆå†™æ—¥å¿—åå†™æ•°æ®åº“çš„ä¸»è¦åŸå› ã€‚å›æ»šæ—¥å¿—å¹¶ä¸èƒ½å°†æ•°æ®åº“ç‰©ç†åœ°æ¢å¤åˆ°æ‰§è¡Œè¯­å¥æˆ–è€…äº‹åŠ¡ä¹‹å‰çš„æ ·å­ï¼›å®ƒæ˜¯é€»è¾‘æ—¥å¿—ï¼Œå½“å›æ»šæ—¥å¿—è¢«ä½¿ç”¨æ—¶ï¼Œå®ƒåªä¼šæŒ‰ç…§æ—¥å¿—é€»è¾‘åœ°å°†æ•°æ®åº“ä¸­çš„ä¿®æ”¹æ’¤é”€æ‰çœ‹ï¼Œå¯ä»¥ç†è§£ä¸ºï¼Œæˆ‘ä»¬åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨çš„æ¯ä¸€æ¡ INSERT éƒ½å¯¹åº”äº†ä¸€æ¡ DELETEï¼Œæ¯ä¸€æ¡ UPDATE ä¹Ÿéƒ½å¯¹åº”ä¸€æ¡ç›¸åçš„ UPDATE è¯­å¥ã€‚æŒä¹…æ€§äº‹åŠ¡çš„æŒä¹…æ€§å°±ä½“ç°åœ¨ï¼Œä¸€æ—¦äº‹åŠ¡è¢«æäº¤ï¼Œé‚£ä¹ˆæ•°æ®ä¸€å®šä¼šè¢«å†™å…¥åˆ°æ•°æ®åº“ä¸­å¹¶æŒä¹…å­˜å‚¨èµ·æ¥ã€‚ä¸åŸå­æ€§ä¸€æ ·ï¼Œäº‹åŠ¡çš„æŒä¹…æ€§ä¹Ÿæ˜¯é€šè¿‡æ—¥å¿—æ¥å®ç°çš„ï¼ŒMySQL ä½¿ç”¨é‡åšæ—¥å¿—ï¼ˆredo logï¼‰å®ç°äº‹åŠ¡çš„æŒä¹…æ€§ï¼Œé‡åšæ—¥å¿—ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€æ˜¯å†…å­˜ä¸­çš„é‡åšæ—¥å¿—ç¼“å†²åŒºï¼Œå› ä¸ºé‡åšæ—¥å¿—ç¼“å†²åŒºåœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥å®ƒæ˜¯æ˜“å¤±çš„ï¼Œå¦ä¸€ä¸ªå°±æ˜¯åœ¨ç£ç›˜ä¸Šçš„é‡åšæ—¥å¿—æ–‡ä»¶ï¼Œå®ƒæ˜¯æŒä¹…çš„ã€‚å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å°è¯•å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå®ƒä¼šå…ˆå°†æ•°æ®ä»ç£ç›˜è¯»å…¥å†…å­˜ï¼Œå¹¶æ›´æ–°å†…å­˜ä¸­ç¼“å­˜çš„æ•°æ®ï¼Œç„¶åç”Ÿæˆä¸€æ¡é‡åšæ—¥å¿—å¹¶å†™å…¥é‡åšæ—¥å¿—ç¼“å­˜ï¼Œå½“äº‹åŠ¡çœŸæ­£æäº¤æ—¶ï¼ŒMySQL ä¼šå°†é‡åšæ—¥å¿—ç¼“å­˜ä¸­çš„å†…å®¹åˆ·æ–°åˆ°é‡åšæ—¥å¿—æ–‡ä»¶ï¼Œå†å°†å†…å­˜ä¸­çš„æ•°æ®æ›´æ–°åˆ°ç£ç›˜ä¸Šï¼Œåœ¨ InnoDB ä¸­ï¼Œé‡åšæ—¥å¿—éƒ½æ˜¯ä»¥ 512 å­—èŠ‚çš„å—çš„å½¢å¼è¿›è¡Œå­˜å‚¨çš„ï¼ŒåŒæ—¶å› ä¸ºå—çš„å¤§å°ä¸ç£ç›˜æ‰‡åŒºå¤§å°ç›¸åŒï¼Œæ‰€ä»¥é‡åšæ—¥å¿—çš„å†™å…¥å¯ä»¥ä¿è¯åŸå­æ€§ï¼Œä¸ä¼šç”±äºæœºå™¨æ–­ç”µå¯¼è‡´é‡åšæ—¥å¿—ä»…å†™å…¥ä¸€åŠå¹¶ç•™ä¸‹è„æ•°æ®ã€‚åœ¨MySQLä¸­è¿˜å­˜åœ¨binlog(äºŒè¿›åˆ¶æ—¥å¿—)ä¹Ÿå¯ä»¥è®°å½•å†™æ“ä½œå¹¶ç”¨äºæ•°æ®çš„æ¢å¤ï¼Œä½†äºŒè€…æ˜¯æœ‰ç€æ ¹æœ¬çš„ä¸åŒçš„ï¼šredo logæ˜¯ç”¨äºcrash recoveryçš„ï¼Œä¿è¯MySQLå®•æœºä¹Ÿä¸ä¼šå½±å“æŒä¹…æ€§ï¼›binlogæ˜¯ç”¨äºpoint-in-time recoveryçš„ï¼Œä¿è¯æœåŠ¡å™¨å¯ä»¥åŸºäºæ—¶é—´ç‚¹æ¢å¤æ•°æ®ï¼Œæ­¤å¤–binlogè¿˜ç”¨äºä¸»ä»å¤åˆ¶ã€‚éš”ç¦»æ€§ä¸åŸå­æ€§ã€æŒä¹…æ€§ä¾§é‡äºç ”ç©¶äº‹åŠ¡æœ¬èº«ä¸åŒï¼Œéš”ç¦»æ€§ç ”ç©¶çš„æ˜¯ä¸åŒäº‹åŠ¡ä¹‹é—´çš„ç›¸äº’å½±å“ã€‚**éš”ç¦»æ€§è¿½æ±‚çš„æ˜¯å¹¶å‘æƒ…å½¢ä¸‹äº‹åŠ¡ä¹‹é—´äº’ä¸å¹²æ‰°ã€‚ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä»…è€ƒè™‘æœ€ç®€å•çš„è¯»æ“ä½œå’Œå†™æ“ä½œ(æš‚æ—¶ä¸è€ƒè™‘å¸¦é”è¯»ç­‰ç‰¹æ®Šæ“ä½œ)ï¼Œé‚£ä¹ˆéš”ç¦»æ€§çš„æ¢è®¨ï¼Œä¸»è¦å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæ–¹é¢ï¼š(ä¸€ä¸ªäº‹åŠ¡)å†™æ“ä½œå¯¹(å¦ä¸€ä¸ªäº‹åŠ¡)å†™æ“ä½œçš„å½±å“ï¼šé”æœºåˆ¶ä¿è¯éš”ç¦»æ€§(ä¸€ä¸ªäº‹åŠ¡)å†™æ“ä½œå¯¹(å¦ä¸€ä¸ªäº‹åŠ¡)è¯»æ“ä½œçš„å½±å“ï¼šMVCCä¿è¯éš”ç¦»æ€§æ¦‚æ‹¬æ¥è¯´ï¼ŒInnoDBå®ç°çš„é‡å¤è¯»ï¼Œé€šè¿‡é”æœºåˆ¶ã€æ•°æ®çš„éšè—åˆ—ã€undo logå’Œç±»next-key lockï¼Œå®ç°äº†ä¸€å®šç¨‹åº¦çš„éš”ç¦»æ€§ï¼Œå¯ä»¥æ»¡è¶³å¤§å¤šæ•°åœºæ™¯çš„éœ€è¦ã€‚ä¸€è‡´æ€§ä¸€è‡´æ€§æ˜¯æŒ‡äº‹åŠ¡æ‰§è¡Œç»“æŸåï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«ç ´åï¼Œäº‹åŠ¡æ‰§è¡Œçš„å‰åéƒ½æ˜¯åˆæ³•çš„æ•°æ®çŠ¶æ€ã€‚**å¯ä»¥è¯´ï¼Œä¸€è‡´æ€§æ˜¯äº‹åŠ¡è¿½æ±‚çš„æœ€ç»ˆç›®æ ‡ï¼šå‰é¢æåˆ°çš„åŸå­æ€§ã€æŒä¹…æ€§å’Œéš”ç¦»æ€§ï¼Œéƒ½æ˜¯ä¸ºäº†ä¿è¯æ•°æ®åº“çŠ¶æ€çš„ä¸€è‡´æ€§ã€‚æ­¤å¤–ï¼Œé™¤äº†æ•°æ®åº“å±‚é¢çš„ä¿éšœï¼Œä¸€è‡´æ€§çš„å®ç°ä¹Ÿéœ€è¦åº”ç”¨å±‚é¢è¿›è¡Œä¿éšœã€‚å®ç°ä¸€è‡´æ€§çš„æªæ–½åŒ…æ‹¬ï¼šä¿è¯åŸå­æ€§ã€æŒä¹…æ€§å’Œéš”ç¦»æ€§ï¼Œå¦‚æœè¿™äº›ç‰¹æ€§æ— æ³•ä¿è¯ï¼Œäº‹åŠ¡çš„ä¸€è‡´æ€§ä¹Ÿæ— æ³•ä¿è¯æ•°æ®åº“æœ¬èº«æä¾›ä¿éšœï¼Œä¾‹å¦‚ä¸å…è®¸å‘æ•´å½¢åˆ—æ’å…¥å­—ç¬¦ä¸²å€¼ã€å­—ç¬¦ä¸²é•¿åº¦ä¸èƒ½è¶…è¿‡åˆ—çš„é™åˆ¶ç­‰åº”ç”¨å±‚é¢è¿›è¡Œä¿éšœï¼Œä¾‹å¦‚å¦‚æœè½¬è´¦æ“ä½œåªæ‰£é™¤è½¬è´¦è€…çš„ä½™é¢ï¼Œè€Œæ²¡æœ‰å¢åŠ æ¥æ”¶è€…çš„ä½™é¢ï¼Œæ— è®ºæ•°æ®åº“å®ç°çš„å¤šä¹ˆå®Œç¾ï¼Œä¹Ÿæ— æ³•ä¿è¯çŠ¶æ€çš„ä¸€è‡´","categories":[{"name":"DataBase","slug":"DataBase","permalink":"cpeixin.cn/categories/DataBase/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"cpeixin.cn/tags/mysql/"}]},{"title":"Flink åè¯è§£é‡Š","slug":"Flink-åè¯è§£é‡Š","date":"2018-03-10T07:32:00.000Z","updated":"2020-05-11T09:45:22.543Z","comments":true,"path":"2018/03/10/Flink-åè¯è§£é‡Š/","link":"","permalink":"cpeixin.cn/2018/03/10/Flink-%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A/","excerpt":"","text":"Flink Application ClusterFlink Application Cluster æ˜¯ä¸€ä¸ªä¸“ç”¨çš„ Flink Clusterï¼Œå®ƒä»…ç”¨äºæ‰§è¡Œå•ä¸ª Flink Jobã€‚Flink Clusterçš„ç”Ÿå‘½å‘¨æœŸä¸ Flink Jobçš„ç”Ÿå‘½å‘¨æœŸç»‘å®šåœ¨ä¸€èµ·ã€‚ä»¥å‰ï¼ŒFlink Application Cluster ä¹Ÿç§°ä¸º_job mode_çš„ Flink Clusterã€‚å’Œ Flink Session Cluster ä½œå¯¹æ¯”ã€‚Flink Clusterä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒFlink é›†ç¾¤æ˜¯ç”±ä¸€ä¸ª Flink Master å’Œä¸€ä¸ªæˆ–å¤šä¸ª Flink TaskManager è¿›ç¨‹ç»„æˆçš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚EventEvent æ˜¯å¯¹åº”ç”¨ç¨‹åºå»ºæ¨¡çš„åŸŸçš„çŠ¶æ€æ›´æ”¹çš„å£°æ˜ã€‚å®ƒå¯ä»¥åŒæ—¶ä¸ºæµæˆ–æ‰¹å¤„ç†åº”ç”¨ç¨‹åºçš„ input å’Œ outputï¼Œä¹Ÿå¯ä»¥å•ç‹¬æ˜¯ input æˆ–è€… output ä¸­çš„ä¸€ç§ã€‚Event æ˜¯ç‰¹æ®Šç±»å‹çš„ Recordã€‚ExecutionGraphè§ Physical Graphã€‚FunctionFunction æ˜¯ç”±ç”¨æˆ·å®ç°çš„ï¼Œå¹¶å°è£…äº† Flink ç¨‹åºçš„åº”ç”¨ç¨‹åºé€»è¾‘ã€‚å¤§å¤šæ•° Function éƒ½ç”±ç›¸åº”çš„ Operator å°è£…ã€‚InstanceInstance å¸¸ç”¨äºæè¿°è¿è¡Œæ—¶çš„ç‰¹å®šç±»å‹(é€šå¸¸æ˜¯ Operator æˆ–è€… Function)çš„ä¸€ä¸ªå…·ä½“å®ä¾‹ã€‚ç”±äº Apache Flink ä¸»è¦æ˜¯ç”¨ Java ç¼–å†™çš„ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ Java ä¸­çš„ Instance æˆ– Object çš„å®šä¹‰ç›¸å¯¹åº”ã€‚åœ¨ Apache Flink çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œparallel instance ä¹Ÿå¸¸ç”¨äºå¼ºè°ƒåŒä¸€ Operator æˆ–è€… Function çš„å¤šä¸ª instance ä»¥å¹¶è¡Œçš„æ–¹å¼è¿è¡Œã€‚Flink JobFlink Job ä»£è¡¨è¿è¡Œæ—¶çš„ Flink ç¨‹åºã€‚Flink Job å¯ä»¥æäº¤åˆ°é•¿æ—¶é—´è¿è¡Œçš„ Flink Session Clusterï¼Œä¹Ÿå¯ä»¥ä½œä¸ºç‹¬ç«‹çš„ Flink Application Cluster å¯åŠ¨ã€‚JobGraphè§ Logical Graphã€‚Flink JobManagerJobManager æ˜¯åœ¨ Flink Master è¿è¡Œä¸­çš„ç»„ä»¶ä¹‹ä¸€ã€‚JobManager è´Ÿè´£ç›‘ç£å•ä¸ªä½œä¸š Task çš„æ‰§è¡Œã€‚ä»¥å‰ï¼Œæ•´ä¸ª Flink Master éƒ½å«åš JobManagerã€‚Logical GraphLogical Graph æ˜¯ä¸€ç§æè¿°æµå¤„ç†ç¨‹åºçš„é«˜é˜¶é€»è¾‘æœ‰å‘å›¾ã€‚èŠ‚ç‚¹æ˜¯Operatorï¼Œè¾¹ä»£è¡¨è¾“å…¥/è¾“å‡ºå…³ç³»ã€æ•°æ®æµå’Œæ•°æ®é›†ä¸­çš„ä¹‹ä¸€ã€‚Managed StateManaged State æè¿°äº†å·²åœ¨æ¡†æ¶ä¸­æ³¨å†Œçš„åº”ç”¨ç¨‹åºçš„æ‰˜ç®¡çŠ¶æ€ã€‚å¯¹äºæ‰˜ç®¡çŠ¶æ€ï¼ŒApache Flink ä¼šè´Ÿè´£æŒä¹…åŒ–å’Œé‡ä¼¸ç¼©ç­‰äº‹å®œã€‚Flink MasterFlink Master æ˜¯ Flink Cluster çš„ä¸»èŠ‚ç‚¹ã€‚å®ƒåŒ…å«ä¸‰ä¸ªä¸åŒçš„ç»„ä»¶ï¼šFlink Resource Managerã€Flink Dispatcherã€è¿è¡Œæ¯ä¸ª Flink Job çš„ Flink JobManagerã€‚OperatorLogical Graph çš„èŠ‚ç‚¹ã€‚ç®—å­æ‰§è¡ŒæŸç§æ“ä½œï¼Œè¯¥æ“ä½œé€šå¸¸ç”± Function æ‰§è¡Œã€‚Source å’Œ Sink æ˜¯æ•°æ®è¾“å…¥å’Œæ•°æ®è¾“å‡ºçš„ç‰¹æ®Šç®—å­ã€‚Operator Chainç®—å­é“¾ç”±ä¸¤ä¸ªæˆ–å¤šä¸ªè¿ç»­çš„ Operator ç»„æˆï¼Œä¸¤è€…ä¹‹é—´æ²¡æœ‰ä»»ä½•çš„é‡æ–°åˆ†åŒºã€‚åŒä¸€ç®—å­é“¾å†…çš„ç®—å­å¯ä»¥å½¼æ­¤ç›´æ¥ä¼ é€’ recordï¼Œè€Œæ— éœ€é€šè¿‡åºåˆ—åŒ–æˆ– Flink çš„ç½‘ç»œæ ˆã€‚Partitionåˆ†åŒºæ˜¯æ•´ä¸ªæ•°æ®æµæˆ–æ•°æ®é›†çš„ç‹¬ç«‹å­é›†ã€‚é€šè¿‡å°†æ¯ä¸ª Record åˆ†é…ç»™ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†åŒºï¼Œæ¥æŠŠæ•°æ®æµæˆ–æ•°æ®é›†åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†åŒºã€‚åœ¨è¿è¡ŒæœŸé—´ï¼ŒTask ä¼šæ¶ˆè´¹æ•°æ®æµæˆ–æ•°æ®é›†çš„åˆ†åŒºã€‚æ”¹å˜æ•°æ®æµæˆ–æ•°æ®é›†åˆ†åŒºæ–¹å¼çš„è½¬æ¢é€šå¸¸ç§°ä¸ºé‡åˆ†åŒºã€‚Physical GraphPhysical graph æ˜¯ä¸€ä¸ªåœ¨åˆ†å¸ƒå¼è¿è¡Œæ—¶ï¼ŒæŠŠ Logical Graph è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„ç»“æœã€‚èŠ‚ç‚¹æ˜¯ Taskï¼Œè¾¹è¡¨ç¤ºæ•°æ®æµæˆ–æ•°æ®é›†çš„è¾“å…¥/è¾“å‡ºå…³ç³»æˆ– partitionã€‚RecordRecord æ˜¯æ•°æ®é›†æˆ–æ•°æ®æµçš„ç»„æˆå…ƒç´ ã€‚Operator å’Œ Functionæ¥æ”¶ record ä½œä¸ºè¾“å…¥ï¼Œå¹¶å°† record ä½œä¸ºè¾“å‡ºå‘å‡ºã€‚Flink Session Clusteré•¿æ—¶é—´è¿è¡Œçš„ Flink Clusterï¼Œå®ƒå¯ä»¥æ¥å—å¤šä¸ª Flink Job çš„æ‰§è¡Œã€‚æ­¤ Flink Cluster çš„ç”Ÿå‘½å‘¨æœŸä¸å—ä»»ä½• Flink Job ç”Ÿå‘½å‘¨æœŸçš„çº¦æŸé™åˆ¶ã€‚ä»¥å‰ï¼ŒFlink Session Cluster ä¹Ÿç§°ä¸º session mode çš„ Flink Clusterï¼Œå’Œ Flink Application Cluster ç›¸å¯¹åº”ã€‚State Backendå¯¹äºæµå¤„ç†ç¨‹åºï¼ŒFlink Job çš„ State Backend å†³å®šäº†å…¶ state æ˜¯å¦‚ä½•å­˜å‚¨åœ¨æ¯ä¸ª TaskManager ä¸Šçš„ï¼ˆ TaskManager çš„ Java å †æ ˆæˆ–åµŒå…¥å¼ RocksDBï¼‰ï¼Œä»¥åŠå®ƒåœ¨ checkpoint æ—¶çš„å†™å…¥ä½ç½®ï¼ˆ Flink Master çš„ Java å †æˆ–è€… Filesystemï¼‰ã€‚Sub-TaskSub-Task æ˜¯è´Ÿè´£å¤„ç†æ•°æ®æµ Partition çš„ Taskã€‚â€Sub-Taskâ€å¼ºè°ƒçš„æ˜¯åŒä¸€ä¸ª Operator æˆ–è€… Operator Chain å…·æœ‰å¤šä¸ªå¹¶è¡Œçš„ Task ã€‚TaskTask æ˜¯ Physical Graph çš„èŠ‚ç‚¹ã€‚å®ƒæ˜¯åŸºæœ¬çš„å·¥ä½œå•å…ƒï¼Œç”± Flink çš„ runtime æ¥æ‰§è¡Œã€‚Task æ­£å¥½å°è£…äº†ä¸€ä¸ª Operator æˆ–è€… Operator Chain çš„ _parallel instance_ã€‚Flink TaskManagerTaskManager æ˜¯ Flink Cluster çš„å·¥ä½œè¿›ç¨‹ã€‚Task è¢«è°ƒåº¦åˆ° TaskManager ä¸Šæ‰§è¡Œã€‚TaskManager ç›¸äº’é€šä¿¡ï¼Œåªä¸ºåœ¨åç»­çš„ Task ä¹‹é—´äº¤æ¢æ•°æ®ã€‚TransformationTransformation åº”ç”¨äºä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®æµæˆ–æ•°æ®é›†ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªæˆ–å¤šä¸ªè¾“å‡ºæ•°æ®æµæˆ–æ•°æ®é›†ã€‚Transformation å¯èƒ½ä¼šåœ¨æ¯ä¸ªè®°å½•çš„åŸºç¡€ä¸Šæ›´æ”¹æ•°æ®æµæˆ–æ•°æ®é›†ï¼Œä½†ä¹Ÿå¯ä»¥åªæ›´æ”¹å…¶åˆ†åŒºæˆ–æ‰§è¡Œèšåˆã€‚è™½ç„¶ Operator å’Œ Function æ˜¯ Flink API çš„â€œç‰©ç†â€éƒ¨åˆ†ï¼Œä½† Transformation åªæ˜¯ä¸€ä¸ª API æ¦‚å¿µã€‚å…·ä½“æ¥è¯´ï¼Œå¤§å¤šæ•°ï¼ˆä½†ä¸æ˜¯å…¨éƒ¨ï¼‰Transformation æ˜¯ç”±æŸäº› Operator å®ç°çš„ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Flink è¿è¡Œæ¶æ„","slug":"Flink-è¿è¡Œæ¶æ„","date":"2018-03-05T07:32:00.000Z","updated":"2020-05-12T14:53:23.279Z","comments":true,"path":"2018/03/05/Flink-è¿è¡Œæ¶æ„/","link":"","permalink":"cpeixin.cn/2018/03/05/Flink-%E8%BF%90%E8%A1%8C%E6%9E%B6%E6%9E%84/","excerpt":"","text":"ä»»åŠ¡æäº¤æµç¨‹å®¢æˆ·ç«¯æäº¤æµç¨‹1.æ‰§è¡Œå‘½ä»¤**:123bin/flink run -d -m yarn-cluster æˆ–è€…bin/yarn-session.shæäº¤per-jobè¿è¡Œæ¨¡å¼æˆ–sessionè¿è¡Œæ¨¡å¼çš„åº”ç”¨ï¼›2.è§£æå‘½ä»¤å‚æ•°é¡¹å¹¶åˆå§‹åŒ–ï¼Œå¯åŠ¨æŒ‡å®šè¿è¡Œæ¨¡å¼ï¼Œå¦‚æœæ˜¯per-jobè¿è¡Œæ¨¡å¼å°†æ ¹æ®å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šçš„Jobä¸»ç±»åˆ›å»ºjob graphï¼›å¦‚æœå¯ä»¥ä»å‘½ä»¤è¡Œå‚æ•°(-yid )æˆ–YARN propertiesä¸´æ—¶æ–‡ä»¶(${java.io.tmpdir}/.yarn-properties-${user.name})ä¸­è·å–åº”ç”¨IDï¼Œå‘æŒ‡å®šçš„åº”ç”¨æäº¤Jobï¼›å¦åˆ™å½“å‘½ä»¤è¡Œå‚æ•°ä¸­åŒ…å« -dï¼ˆè¡¨ç¤ºdetachedæ¨¡å¼ï¼‰å’Œ -m yarn-clusterï¼ˆè¡¨ç¤ºæŒ‡å®šYARNé›†ç¾¤æ¨¡å¼ï¼‰ï¼Œå¯åŠ¨per-jobè¿è¡Œæ¨¡å¼ï¼›å¦åˆ™å½“å‘½ä»¤è¡Œå‚æ•°é¡¹ä¸åŒ…å« -yqï¼ˆè¡¨ç¤ºæŸ¥è¯¢YARNé›†ç¾¤å¯ç”¨èµ„æºï¼‰æ—¶ï¼Œå¯åŠ¨sessionè¿è¡Œæ¨¡å¼ï¼›3.è·å–YARNé›†ç¾¤ä¿¡æ¯ã€æ–°åº”ç”¨IDå¹¶å¯åŠ¨è¿è¡Œå‰æ£€æŸ¥ï¼›**é€šè¿‡YarnClientå‘YARN ResourceManager(ä¸‹æ–‡ç¼©å†™ä¸ºï¼šYARN RMï¼ŒYARN MasterèŠ‚ç‚¹ï¼Œè´Ÿè´£æ•´ä¸ªé›†ç¾¤èµ„æºçš„ç®¡ç†å’Œè°ƒåº¦)è¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°åº”ç”¨ï¼ˆYARN RMæ”¶åˆ°åˆ›å»ºåº”ç”¨è¯·æ±‚åç”Ÿæˆæ–°åº”ç”¨IDå’Œcontainerç”³è¯·çš„èµ„æºä¸Šé™åè¿”å›ï¼‰ï¼Œå¹¶ä¸”è·å–YARN SlaveèŠ‚ç‚¹æŠ¥å‘Šï¼ˆYARN RMè¿”å›å…¨éƒ¨slaveèŠ‚ç‚¹çš„IDã€çŠ¶æ€ã€rackã€httpåœ°å€ã€æ€»èµ„æºã€å·²ä½¿ç”¨èµ„æºç­‰ä¿¡æ¯ï¼‰ï¼›è¿è¡Œå‰æ£€æŸ¥ï¼š(1) ç®€å•éªŒè¯YARNé›†ç¾¤èƒ½å¦è®¿é—®ï¼›(2) æœ€å¤§nodeèµ„æºèƒ½å¦æ»¡è¶³flink JobManager/TaskManager vcoresèµ„æºç”³è¯·éœ€æ±‚ï¼›(3) æŒ‡å®šqueueæ˜¯å¦å­˜åœ¨(ä¸å­˜åœ¨ä¹Ÿåªæ˜¯æ‰“å°WARNä¿¡æ¯ï¼Œåç»­å‘YARNæäº¤æ—¶æ’é™¤å¼‚å¸¸å¹¶é€€å‡º)ï¼›(4)å½“é¢„æœŸåº”ç”¨ç”³è¯·çš„Containerèµ„æºä¼šè¶…å‡ºYARNèµ„æºé™åˆ¶æ—¶æŠ›å‡ºå¼‚å¸¸å¹¶é€€å‡ºï¼›(5) å½“é¢„æœŸåº”ç”¨ç”³è¯·ä¸èƒ½è¢«æ»¡è¶³æ—¶ï¼ˆä¾‹å¦‚æ€»èµ„æºè¶…å‡ºYARNé›†ç¾¤å¯ç”¨èµ„æºæ€»é‡ã€Containerç”³è¯·èµ„æºè¶…å‡ºNMå¯ç”¨èµ„æºæœ€å¤§å€¼ç­‰ï¼‰æä¾›ä¸€äº›å‚è€ƒä¿¡æ¯ã€‚4.å°†åº”ç”¨é…ç½®(flink-conf.yamlã€logback.xmlã€log4j.properties)å’Œç›¸å…³æ–‡ä»¶(flink jarsã€ship filesã€user jarsã€job graphç­‰)ä¸Šä¼ è‡³åˆ†å¸ƒå¼å­˜å‚¨(ä¾‹å¦‚HDFS)çš„åº”ç”¨æš‚å­˜ç›®å½•(/user/${user.name}/.flink/)ï¼›5.å‡†å¤‡åº”ç”¨æäº¤ä¸Šä¸‹æ–‡(ApplicationSubmissionContextï¼ŒåŒ…æ‹¬åº”ç”¨çš„åç§°ã€ç±»å‹ã€é˜Ÿåˆ—ã€æ ‡ç­¾ç­‰ä¿¡æ¯å’Œåº”ç”¨Masterçš„containerçš„ç¯å¢ƒå˜é‡ã€classpathã€èµ„æºå¤§å°ç­‰)ï¼Œæ³¨å†Œå¤„ç†éƒ¨ç½²å¤±è´¥çš„shutdown hookï¼ˆæ¸…ç†åº”ç”¨å¯¹åº”çš„HDFSç›®å½•ï¼‰ï¼Œç„¶åé€šè¿‡YarnClientå‘YARN RMæäº¤åº”ç”¨ï¼›6.å¾ªç¯ç­‰å¾…ç›´åˆ°åº”ç”¨çŠ¶æ€ä¸ºRUNNINGï¼ŒåŒ…å«ä¸¤ä¸ªé˜¶æ®µï¼šå¾ªç¯ç­‰å¾…åº”ç”¨æäº¤æˆåŠŸï¼ˆSUBMITTEDï¼‰ï¼šé»˜è®¤æ¯éš”200msé€šè¿‡YarnClientè·å–åº”ç”¨æŠ¥å‘Šï¼Œå¦‚æœåº”ç”¨çŠ¶æ€ä¸æ˜¯NEWå’ŒNEW_SAVINGåˆ™è®¤ä¸ºæäº¤æˆåŠŸå¹¶é€€å‡ºå¾ªç¯ï¼Œæ¯å¾ªç¯10æ¬¡ä¼šå°†å½“å‰çš„åº”ç”¨çŠ¶æ€è¾“å‡ºè‡³æ—¥å¿—ï¼šâ€Application submission is not finished, submitted application is still in â€œï¼Œæäº¤æˆåŠŸåè¾“å‡ºæ—¥å¿—ï¼šâ€Submitted application â€œå¾ªç¯ç­‰å¾…åº”ç”¨æ­£å¸¸è¿è¡Œï¼ˆRUNNINGï¼‰ï¼šæ¯éš”250msé€šè¿‡YarnClientè·å–åº”ç”¨æŠ¥å‘Šï¼Œæ¯è½®å¾ªç¯ä¹Ÿä¼šå°†å½“å‰çš„åº”ç”¨çŠ¶æ€è¾“å‡ºè‡³æ—¥å¿—ï¼šâ€Deploying cluster, current state â€œã€‚åº”ç”¨çŠ¶æ€æˆåŠŸå˜ä¸ºRUNNINGåå°†è¾“å‡ºæ—¥å¿—â€YARN application has been deployed successfully.â€ å¹¶é€€å‡ºå¾ªç¯ï¼Œå¦‚æœç­‰åˆ°çš„æ˜¯éé¢„æœŸçŠ¶æ€å¦‚FAILED/FINISHED/KILLED,å°±ä¼šåœ¨è¾“å‡ºYARNè¿”å›çš„è¯Šæ–­ä¿¡æ¯ï¼ˆâ€The YARN application unexpectedly switched to state during deployment. Diagnostics from YARN: â€¦â€ï¼‰ä¹‹åæŠ›å‡ºå¼‚å¸¸å¹¶é€€å‡ºã€‚Flink Clusterå¯åŠ¨æµç¨‹1.YARN RMä¸­çš„ClientRMServiceï¼ˆä¸ºæ™®é€šç”¨æˆ·æä¾›çš„RPCæœåŠ¡ç»„ä»¶ï¼Œå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„å„ç§RPCè¯·æ±‚ï¼Œæ¯”å¦‚æŸ¥è¯¢YARNé›†ç¾¤ä¿¡æ¯ï¼Œæäº¤ã€ç»ˆæ­¢åº”ç”¨ç­‰ï¼‰æ¥æ”¶åˆ°åº”ç”¨æäº¤è¯·æ±‚ï¼Œç®€å•æ ¡éªŒåå°†è¯·æ±‚è½¬äº¤RMAppManagerï¼ˆYARN RMå†…éƒ¨ç®¡ç†åº”ç”¨ç”Ÿå‘½å‘¨æœŸçš„ç»„ä»¶ï¼‰ï¼›2.RMAppManageræ ¹æ®åº”ç”¨æäº¤ä¸Šä¸‹æ–‡å†…å®¹åˆ›å»ºåˆå§‹çŠ¶æ€ä¸ºNEWçš„åº”ç”¨ï¼Œå°†åº”ç”¨çŠ¶æ€æŒä¹…åŒ–åˆ°RMçŠ¶æ€å­˜å‚¨æœåŠ¡ï¼ˆä¾‹å¦‚ZooKeeperé›†ç¾¤ï¼ŒRMçŠ¶æ€å­˜å‚¨æœåŠ¡ç”¨æ¥ä¿è¯RMé‡å¯ã€HAåˆ‡æ¢æˆ–å‘ç”Ÿæ•…éšœåé›†ç¾¤åº”ç”¨èƒ½å¤Ÿæ­£å¸¸æ¢å¤ï¼Œåç»­æµç¨‹ä¸­çš„æ¶‰åŠçŠ¶æ€å­˜å‚¨æ—¶ä¸å†èµ˜è¿°ï¼‰ï¼Œåº”ç”¨çŠ¶æ€å˜ä¸ºNEW_SAVINGï¼›3.åº”ç”¨çŠ¶æ€å­˜å‚¨å®Œæˆåï¼Œåº”ç”¨çŠ¶æ€å˜ä¸ºSUBMITTEDï¼›RMAppManagerå¼€å§‹å‘ResourceSchedulerï¼ˆYARN RMå¯æ‹”æ’èµ„æºè°ƒåº¦å™¨ï¼ŒYARNè‡ªå¸¦ä¸‰ç§è°ƒåº¦å™¨FifoScheduler/FairScheduler/CapacitySchedulerï¼Œå…¶ä¸­CapacityScheduleræ”¯æŒåŠŸèƒ½æœ€å¤šä½¿ç”¨æœ€å¹¿æ³›ï¼ŒFifoScheduleråŠŸèƒ½æœ€ç®€å•åŸºæœ¬ä¸å¯ç”¨ï¼Œä»Šå¹´ç¤¾åŒºå·²æ˜ç¡®ä¸å†ç»§ç»­æ”¯æŒFairSchedulerï¼Œå»ºè®®å·²æœ‰ç”¨æˆ·è¿è‡³CapacitySchedulerï¼‰æäº¤åº”ç”¨ï¼Œå¦‚æœæ— æ³•æ­£å¸¸æäº¤ï¼ˆä¾‹å¦‚é˜Ÿåˆ—ä¸å­˜åœ¨ã€ä¸æ˜¯å¶å­é˜Ÿåˆ—ã€é˜Ÿåˆ—å·²åœç”¨ã€è¶…å‡ºé˜Ÿåˆ—æœ€å¤§åº”ç”¨æ•°é™åˆ¶ç­‰ï¼‰åˆ™æŠ›å‡ºæ‹’ç»è¯¥åº”ç”¨ï¼Œåº”ç”¨çŠ¶æ€å…ˆå˜ä¸ºFINAL_SAVINGè§¦å‘åº”ç”¨çŠ¶æ€å­˜å‚¨æµç¨‹å¹¶åœ¨å®Œæˆåå˜ä¸ºFAILEDï¼›å¦‚æœæäº¤æˆåŠŸï¼Œåº”ç”¨çŠ¶æ€å˜ä¸ºACCEPTEDï¼›4.å¼€å§‹åˆ›å»ºåº”ç”¨è¿è¡Œå®ä¾‹(ApplicationAttemptï¼Œç”±äºä¸€æ¬¡è¿è¡Œå®ä¾‹ä¸­æœ€é‡è¦çš„ç»„ä»¶æ˜¯ApplicationMasterï¼Œä¸‹æ–‡ç®€ç§°AMï¼Œå®ƒçš„çŠ¶æ€ä»£è¡¨äº†ApplicationAttemptçš„å½“å‰çŠ¶æ€ï¼Œæ‰€ä»¥ApplicationAttemptå®é™…ä¹Ÿä»£è¡¨äº†AM)ï¼Œåˆå§‹çŠ¶æ€ä¸ºNEWï¼›5.åˆå§‹åŒ–åº”ç”¨è¿è¡Œå®ä¾‹ä¿¡æ¯ï¼Œå¹¶å‘ApplicationMasterServiceï¼ˆAM&amp;RMåè®®æ¥å£æœåŠ¡ï¼Œå¤„ç†æ¥è‡ªAMçš„è¯·æ±‚ï¼Œä¸»è¦åŒ…æ‹¬æ³¨å†Œå’Œå¿ƒè·³ï¼‰æ³¨å†Œï¼Œåº”ç”¨å®ä¾‹çŠ¶æ€å˜ä¸ºSUBMITTEDï¼›6.RMAppManagerç»´æŠ¤çš„åº”ç”¨å®ä¾‹å¼€å§‹åˆå§‹åŒ–AMèµ„æºç”³è¯·ä¿¡æ¯å¹¶é‡æ–°æ ¡éªŒé˜Ÿåˆ—ï¼Œç„¶åå‘ResourceSchedulerç”³è¯·AM Containerï¼ˆContaineræ˜¯YARNä¸­èµ„æºçš„æŠ½è±¡ï¼ŒåŒ…å«äº†å†…å­˜ã€CPUç­‰å¤šç»´åº¦èµ„æºï¼‰ï¼Œåº”ç”¨å®ä¾‹çŠ¶æ€å˜ä¸ºACCEPTEDï¼›7.ResourceSchedulerä¼šæ ¹æ®ä¼˜å…ˆçº§ï¼ˆé˜Ÿåˆ—/åº”ç”¨/è¯·æ±‚æ¯ä¸ªç»´åº¦éƒ½æœ‰ä¼˜å…ˆçº§é…ç½®ï¼‰ä»æ ¹é˜Ÿåˆ—å¼€å§‹å±‚å±‚é€’è¿›ï¼Œå…ˆåé€‰æ‹©å½“å‰ä¼˜å…ˆçº§æœ€é«˜çš„å­é˜Ÿåˆ—ã€åº”ç”¨ç›´è‡³å…·ä½“æŸä¸ªè¯·æ±‚ï¼Œç„¶åç»“åˆé›†ç¾¤èµ„æºåˆ†å¸ƒç­‰æƒ…å†µä½œå‡ºåˆ†é…å†³ç­–ï¼ŒAM Containeråˆ†é…æˆåŠŸåï¼Œåº”ç”¨å®ä¾‹çŠ¶æ€å˜ä¸ºALLOCATED_SAVINGï¼Œå¹¶è§¦å‘åº”ç”¨å®ä¾‹çŠ¶æ€å­˜å‚¨æµç¨‹ï¼Œå­˜å‚¨æˆåŠŸååº”ç”¨å®ä¾‹çŠ¶æ€å˜ä¸ºALLOCATEDï¼›8.RMAppManagerç»´æŠ¤çš„åº”ç”¨å®ä¾‹å¼€å§‹é€šçŸ¥ApplicationMasterLauncherï¼ˆAMç”Ÿå‘½å‘¨æœŸç®¡ç†æœåŠ¡ï¼Œè´Ÿè´£å¯åŠ¨æˆ–æ¸…ç†AM containerï¼‰å¯åŠ¨AM containerï¼ŒApplicationMasterLauncherä¸YARN NodeManagerï¼ˆä¸‹æ–‡ç®€ç§°YARN NMï¼Œä¸YARN RMä¿æŒé€šä¿¡ï¼Œè´Ÿè´£ç®¡ç†å•ä¸ªèŠ‚ç‚¹ä¸Šçš„å…¨éƒ¨èµ„æºã€Containerç”Ÿå‘½å‘¨æœŸã€é™„å±æœåŠ¡ç­‰ï¼Œç›‘æ§èŠ‚ç‚¹å¥åº·çŠ¶å†µå’ŒContainerèµ„æºä½¿ç”¨ï¼‰å»ºç«‹é€šä¿¡å¹¶è¯·æ±‚å¯åŠ¨AM containerï¼›9.ContainerManagerï¼ˆYARN NMæ ¸å¿ƒç»„ä»¶ï¼Œç®¡ç†æ‰€æœ‰Containerçš„ç”Ÿå‘½å‘¨æœŸï¼‰æ¥æ”¶åˆ°AM containerå¯åŠ¨è¯·æ±‚ï¼ŒYARN NMå¼€å§‹æ ¡éªŒContainer TokenåŠèµ„æºæ–‡ä»¶ï¼Œåˆ›å»ºåº”ç”¨å®ä¾‹å’ŒContainerå®ä¾‹å¹¶å­˜å‚¨è‡³æœ¬åœ°ï¼Œç»“æœè¿”å›ååº”ç”¨å®ä¾‹çŠ¶æ€å˜ä¸ºLAUNCHEDï¼›10.ResourceLocalizationServiceï¼ˆèµ„æºæœ¬åœ°åŒ–æœåŠ¡ï¼Œè´Ÿè´£Containeræ‰€éœ€èµ„æºçš„æœ¬åœ°åŒ–ã€‚å®ƒèƒ½å¤ŸæŒ‰ç…§æè¿°ä»HDFSä¸Šä¸‹è½½Containeræ‰€éœ€çš„æ–‡ä»¶èµ„æºï¼Œå¹¶å°½é‡å°†å®ƒä»¬åˆ†æ‘Šåˆ°å„ä¸ªç£ç›˜ä¸Šä»¥é˜²æ­¢å‡ºç°è®¿é—®çƒ­ç‚¹ï¼‰åˆå§‹åŒ–å„ç§æœåŠ¡ç»„ä»¶ã€åˆ›å»ºå·¥ä½œç›®å½•ã€ä»HDFSä¸‹è½½è¿è¡Œæ‰€éœ€çš„å„ç§èµ„æºè‡³Containerå·¥ä½œç›®å½•ï¼ˆè·¯å¾„ä¸º: ${yarn.nodemanager.local-dirs}/usercache/${user}/appcache//ï¼‰ï¼›11.ContainersLauncherï¼ˆè´Ÿè´£containerçš„å…·ä½“æ“ä½œï¼ŒåŒ…æ‹¬å¯åŠ¨ã€é‡å¯ã€æ¢å¤å’Œæ¸…ç†ç­‰ï¼‰å°†å¾…è¿è¡ŒContaineræ‰€éœ€çš„ç¯å¢ƒå˜é‡å’Œè¿è¡Œå‘½ä»¤å†™åˆ°Containerå·¥ä½œç›®å½•ä¸‹çš„launch_container.shè„šæœ¬ä¸­ï¼Œç„¶åè¿è¡Œè¯¥è„šæœ¬å¯åŠ¨Containerï¼›12.Containerè¿›ç¨‹åŠ è½½å¹¶è¿è¡ŒClusterEntrypoint**(Flink JobManagerå…¥å£ç±»ï¼Œæ¯ç§é›†ç¾¤éƒ¨ç½²æ¨¡å¼å’Œåº”ç”¨è¿è¡Œæ¨¡å¼éƒ½æœ‰ç›¸åº”çš„å®ç°ï¼Œä¾‹å¦‚åœ¨YARNé›†ç¾¤éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œper-jobåº”ç”¨è¿è¡Œæ¨¡å¼å®ç°ç±»æ˜¯YarnJobClusterEntrypointï¼Œsessionåº”ç”¨è¿è¡Œæ¨¡å¼å®ç°ç±»æ˜¯YarnSessionClusterEntrypoint)ï¼Œé¦–å…ˆåˆå§‹åŒ–ç›¸å…³è¿è¡Œç¯å¢ƒï¼šè¾“å‡ºå„è½¯ä»¶ç‰ˆæœ¬åŠè¿è¡Œç¯å¢ƒä¿¡æ¯ã€å‘½ä»¤è¡Œå‚æ•°é¡¹ã€classpathç­‰ä¿¡æ¯ï¼›æ³¨å†Œå¤„ç†å„ç§SIGNALçš„handler:è®°å½•åˆ°æ—¥å¿—æ³¨å†ŒJVMå…³é—­ä¿éšœçš„shutdown hookï¼šé¿å…JVMé€€å‡ºæ—¶è¢«å…¶ä»–shutdown hooké˜»å¡æ‰“å°YARNè¿è¡Œç¯å¢ƒä¿¡æ¯ï¼šç”¨æˆ·åä»è¿è¡Œç›®å½•ä¸­åŠ è½½flink confåˆå§‹åŒ–æ–‡ä»¶ç³»ç»Ÿåˆ›å»ºå¹¶å¯åŠ¨å„ç±»å†…éƒ¨æœåŠ¡ï¼ˆåŒ…æ‹¬RpcServiceã€HAServiceã€BlobServerã€HeartbeatServicesã€MetricRegistryã€ExecutionGraphStoreç­‰ï¼‰å°†RPC addresså’Œportæ›´æ–°åˆ°flink confé…ç½®13.å¯åŠ¨ResourceManagerï¼ˆFlinkèµ„æºç®¡ç†æ ¸å¿ƒç»„ä»¶ï¼ŒåŒ…å«YarnResourceManagerå’ŒSlotManagerä¸¤ä¸ªå­ç»„ä»¶ï¼ŒYarnResourceManagerè´Ÿè´£å¤–éƒ¨èµ„æºç®¡ç†ï¼Œä¸YARN RMå»ºç«‹é€šä¿¡å¹¶ä¿æŒå¿ƒè·³ï¼Œç”³è¯·æˆ–é‡Šæ”¾TaskManagerèµ„æºï¼Œæ³¨é”€åº”ç”¨ç­‰ï¼›SlotManageråˆ™è´Ÿè´£å†…éƒ¨èµ„æºç®¡ç†ï¼Œç»´æŠ¤å…¨éƒ¨Slotä¿¡æ¯å’ŒçŠ¶æ€ï¼‰åŠç›¸å…³æœåŠ¡ï¼Œåˆ›å»ºå¼‚æ­¥AMRMClientï¼Œå¼€å§‹æ³¨å†ŒAMï¼Œæ³¨å†ŒæˆåŠŸåæ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆå¿ƒè·³é—´éš”é…ç½®é¡¹ï¼š${yarn.heartbeat.interval}ï¼Œé»˜è®¤5sï¼‰å‘YARN RMå‘é€å¿ƒè·³æ¥å‘é€èµ„æºæ›´æ–°è¯·æ±‚å’Œæ¥å—èµ„æºå˜æ›´ç»“æœã€‚YARN RMå†…éƒ¨è¯¥åº”ç”¨å’Œåº”ç”¨è¿è¡Œå®ä¾‹çš„çŠ¶æ€éƒ½å˜ä¸ºRUNNINGï¼Œå¹¶é€šçŸ¥AMLivelinessMonitoræœåŠ¡ç›‘æ§AMæ˜¯å¦å­˜æ´»çŠ¶æ€ï¼Œå½“å¿ƒè·³è¶…è¿‡ä¸€å®šæ—¶é—´ï¼ˆé»˜è®¤10åˆ†é’Ÿï¼‰è§¦å‘AM failoveræµç¨‹ï¼›14.å¯åŠ¨**Dispatcherï¼ˆè´Ÿè´£æ¥æ”¶ç”¨æˆ·æä¾›çš„ä½œä¸šï¼Œå¹¶ä¸”è´Ÿè´£ä¸ºè¿™ä¸ªæ–°æäº¤çš„ä½œä¸šæ‹‰èµ·ä¸€ä¸ªæ–°çš„ JobManagerï¼‰åŠç›¸å…³æœåŠ¡ï¼ˆåŒ…æ‹¬REST endpointç­‰ï¼‰ï¼Œåœ¨per-jobè¿è¡Œæ¨¡å¼ä¸‹ï¼ŒDispatcherå°†ç›´æ¥ä»Containerå·¥ä½œç›®å½•åŠ è½½JobGraphæ–‡ä»¶ï¼›åœ¨sessionè¿è¡Œæ¨¡å¼ä¸‹ï¼ŒDispatcherå°†åœ¨æ¥æ”¶å®¢æˆ·ç«¯æäº¤çš„Jobï¼ˆ_é€šè¿‡BlockServeræ¥æ”¶job graphæ–‡ä»¶ï¼‰åå†è¿›è¡Œåç»­æµç¨‹ï¼›15.æ ¹æ®JobGraphå¯åŠ¨JobManagerï¼ˆè´Ÿè´£ä½œä¸šè°ƒåº¦ã€ç®¡ç†Jobå’ŒTaskçš„ç”Ÿå‘½å‘¨æœŸï¼‰ï¼Œæ„å»º ExecutionGraphï¼ˆJobGraphçš„å¹¶è¡ŒåŒ–ç‰ˆæœ¬ï¼Œè°ƒåº¦å±‚æœ€æ ¸å¿ƒçš„æ•°æ®ç»“æ„ï¼‰ï¼›16.JobManagerå¼€å§‹æ‰§è¡ŒExecutionGraphï¼Œå‘ResourceManagerç”³è¯·èµ„æºï¼›17.ResourceManagerå°†èµ„æºè¯·æ±‚åŠ å…¥ç­‰å¾…è¯·æ±‚é˜Ÿåˆ—ï¼Œå¹¶é€šè¿‡å¿ƒè·³å‘YARN RMç”³è¯·æ–°çš„Containerèµ„æºæ¥å¯åŠ¨TaskManagerè¿›ç¨‹ï¼›åç»­æµç¨‹å¦‚æœæœ‰ç©ºé—²Slotèµ„æºï¼ŒSlotManagerå°†å…¶åˆ†é…ç»™ç­‰å¾…è¯·æ±‚é˜Ÿåˆ—ä¸­åŒ¹é…çš„è¯·æ±‚ï¼Œä¸ç”¨å†é€šè¿‡18. YarnResourceManagerç”³è¯·æ–°çš„TaskManagerï¼›18.YARN ApplicationMasterServiceæ¥æ”¶åˆ°èµ„æºè¯·æ±‚åï¼Œè§£æå‡ºæ–°çš„èµ„æºè¯·æ±‚å¹¶æ›´æ–°åº”ç”¨è¯·æ±‚ä¿¡æ¯ï¼›19.YARN ResourceScheduleræˆåŠŸä¸ºè¯¥åº”ç”¨åˆ†é…èµ„æºåæ›´æ–°åº”ç”¨ä¿¡æ¯ï¼ŒApplicationMasterServiceæ¥æ”¶åˆ°Flink JobManagerçš„ä¸‹ä¸€æ¬¡å¿ƒè·³æ—¶è¿”å›æ–°åˆ†é…èµ„æºä¿¡æ¯ï¼›20.Flink ResourceManageræ¥æ”¶åˆ°æ–°åˆ†é…çš„Containerèµ„æºåï¼Œå‡†å¤‡å¥½TaskManagerå¯åŠ¨ä¸Šä¸‹æ–‡ï¼ˆContainerLauncherContextï¼Œç”ŸæˆTaskManageré…ç½®å¹¶ä¸Šä¼ è‡³åˆ†å¸ƒå¼å­˜å‚¨ï¼Œé…ç½®å…¶ä»–ä¾èµ–å’Œç¯å¢ƒå˜é‡ç­‰ï¼‰ï¼Œç„¶åå‘YARN NMç”³è¯·å¯åŠ¨TaskManagerè¿›ç¨‹ï¼ŒYARN NMå¯åŠ¨Containerçš„æµç¨‹ä¸AM Containerå¯åŠ¨æµç¨‹åŸºæœ¬ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºåº”ç”¨å®ä¾‹åœ¨NMä¸Šå·²å­˜åœ¨å¹¶æœªRUNNINGçŠ¶æ€æ—¶åˆ™è·³è¿‡åº”ç”¨å®ä¾‹åˆå§‹åŒ–æµç¨‹ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼›21.TaskManagerè¿›ç¨‹åŠ è½½å¹¶è¿è¡ŒYarnTaskExecutorRunnerï¼ˆFlink TaskManagerå…¥å£ç±»ï¼‰ï¼Œåˆå§‹åŒ–æµç¨‹å®Œæˆåå¯åŠ¨TaskExecutorï¼ˆè´Ÿè´£æ‰§è¡ŒTaskç›¸å…³æ“ä½œï¼‰ï¼›22.TaskExecutorå¯åŠ¨åå…ˆå‘ResourceManageræ³¨å†Œï¼ŒæˆåŠŸåå†å‘SlotManageræ±‡æŠ¥è‡ªå·±çš„Slotèµ„æºä¸çŠ¶æ€ï¼›SlotManageræ¥æ”¶åˆ°Slotç©ºé—²èµ„æºåä¸»åŠ¨è§¦å‘Slotåˆ†é…ï¼Œä»ç­‰å¾…è¯·æ±‚é˜Ÿåˆ—ä¸­é€‰å‡ºåˆé€‚çš„èµ„æºè¯·æ±‚åï¼Œå‘TaskManagerè¯·æ±‚è¯¥Slotèµ„æº23.TaskManageræ”¶åˆ°è¯·æ±‚åæ£€æŸ¥è¯¥Slotæ˜¯å¦å¯åˆ†é…ï¼ˆä¸å­˜åœ¨åˆ™è¿”å›å¼‚å¸¸ä¿¡æ¯ï¼‰ã€Jobæ˜¯å¦å·²æ³¨å†Œï¼ˆæ²¡æœ‰åˆ™å…ˆæ³¨å†Œå†åˆ†é…Slotï¼‰ï¼Œæ£€æŸ¥é€šè¿‡åå°†Slotåˆ†é…ç»™JobManagerï¼›24.JobManageræ£€æŸ¥Slotåˆ†é…æ˜¯å¦é‡å¤**ï¼Œé€šè¿‡åé€šçŸ¥Executionæ‰§è¡Œéƒ¨ç½²taskæµç¨‹ï¼Œå‘TaskExecutoræäº¤taskï¼›TaskExecutorå¯åŠ¨æ–°çš„çº¿ç¨‹è¿è¡ŒTaskã€‚ä»»åŠ¡å’Œç®—å­é“¾åˆ†å¸ƒå¼è®¡ç®—ä¸­ï¼ŒFlink å°†ç®—å­ï¼ˆoperatorï¼‰çš„ subtask _é“¾æ¥ï¼ˆchainï¼‰_æˆ taskã€‚æ¯ä¸ª task ç”±ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚æŠŠç®—å­é“¾æ¥æˆ tasks èƒ½å¤Ÿå‡å°‘çº¿ç¨‹é—´åˆ‡æ¢å’Œç¼“å†²çš„å¼€é”€ï¼Œåœ¨é™ä½å»¶è¿Ÿçš„åŒæ—¶æé«˜äº†æ•´ä½“ååé‡ã€‚é“¾æ¥æ“ä½œçš„é…ç½®è¯¦æƒ…å¯å‚è€ƒï¼šchaining docsä¸‹å›¾çš„ dataflow ç”±äº”ä¸ª subtasks æ‰§è¡Œï¼Œå› æ­¤å…·æœ‰äº”ä¸ªå¹¶è¡Œçº¿ç¨‹ã€‚Job Managersã€Task Managersã€å®¢æˆ·ç«¯ï¼ˆClientsï¼‰Flink è¿è¡Œæ—¶åŒ…å«ä¸¤ç±»è¿›ç¨‹ï¼šJobManagers ï¼ˆä¹Ÿç§°ä¸º masters_ï¼‰åè°ƒåˆ†å¸ƒå¼è®¡ç®—ã€‚å®ƒä»¬è´Ÿè´£è°ƒåº¦ä»»åŠ¡ã€åè°ƒ checkpointsã€åè°ƒæ•…éšœæ¢å¤ç­‰ã€‚æ¯ä¸ª Job è‡³å°‘ä¼šæœ‰ä¸€ä¸ª JobManagerã€‚é«˜å¯ç”¨éƒ¨ç½²ä¸‹ä¼šæœ‰å¤šä¸ª JobManagersï¼Œå…¶ä¸­ä¸€ä¸ªä½œä¸º _leader_ï¼Œå…¶ä½™å¤„äº _standby çŠ¶æ€ã€‚TaskManagersï¼ˆä¹Ÿç§°ä¸º _workers_ï¼‰æ‰§è¡Œ dataflow ä¸­çš„ _tasks_ï¼ˆå‡†ç¡®æ¥è¯´æ˜¯ subtasks ï¼‰ï¼Œå¹¶ä¸”ç¼“å­˜å’Œäº¤æ¢æ•°æ® _streams_ã€‚æ¯ä¸ª Job è‡³å°‘ä¼šæœ‰ä¸€ä¸ª TaskManagerã€‚JobManagers å’Œ TaskManagers æœ‰å¤šç§å¯åŠ¨æ–¹å¼ï¼šç›´æ¥åœ¨æœºå™¨ä¸Šå¯åŠ¨ï¼ˆè¯¥é›†ç¾¤ç§°ä¸º standalone clusterï¼‰ï¼Œåœ¨å®¹å™¨æˆ–èµ„æºç®¡ç†æ¡†æ¶ï¼Œå¦‚ YARN æˆ– Mesosï¼Œä¸­å¯åŠ¨ã€‚TaskManagers è¿æ¥åˆ° JobManagersï¼Œé€šçŸ¥åè€…è‡ªå·±å¯ç”¨ï¼Œç„¶åå¼€å§‹æ¥æ‰‹è¢«åˆ†é…çš„å·¥ä½œã€‚å®¢æˆ·ç«¯**è™½ç„¶ä¸æ˜¯è¿è¡Œæ—¶ï¼ˆruntimeï¼‰å’Œä½œä¸šæ‰§è¡Œæ—¶çš„ä¸€éƒ¨åˆ†ï¼Œä½†å®ƒæ˜¯è¢«ç”¨ä½œå‡†å¤‡å’Œæäº¤ dataflow åˆ° JobManager çš„ã€‚æäº¤å®Œæˆä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥æ–­å¼€è¿æ¥ï¼Œä¹Ÿå¯ä»¥ä¿æŒè¿æ¥æ¥æ¥æ”¶è¿›åº¦æŠ¥å‘Šã€‚å®¢æˆ·ç«¯æ—¢å¯ä»¥ä½œä¸ºè§¦å‘æ‰§è¡Œçš„ Java / Scala ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œè¿›ç¨‹ä¸­è¿è¡Œ./bin/flink run ...ã€‚Task Slots å’Œèµ„æºæ¯ä¸ª workerï¼ˆTaskManagerï¼‰éƒ½æ˜¯ä¸€ä¸ª JVM è¿›ç¨‹_ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ª subtasksã€‚ä¸ºäº†æ§åˆ¶ worker æ¥æ”¶ task çš„æ•°é‡ï¼Œworker æ‹¥æœ‰æ‰€è°“çš„ task slots ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰ã€‚æ¯ä¸ª _task slots ä»£è¡¨ TaskManager çš„ä¸€ä»½å›ºå®šèµ„æºå­é›†ã€‚ä¾‹å¦‚ï¼Œå…·æœ‰ä¸‰ä¸ª slots çš„ TaskManager ä¼šå°†å…¶ç®¡ç†çš„å†…å­˜èµ„æºåˆ†æˆä¸‰ç­‰ä»½ç»™æ¯ä¸ª slotã€‚ åˆ’åˆ†èµ„æºæ„å‘³ç€ subtask ä¹‹é—´ä¸ä¼šç«äº‰èµ„æºï¼Œä½†æ˜¯ä¹Ÿæ„å‘³ç€å®ƒä»¬åªæ‹¥æœ‰å›ºå®šçš„èµ„æºã€‚æ³¨æ„è¿™é‡Œå¹¶æ²¡æœ‰ CPU éš”ç¦»ï¼Œå½“å‰ slots ä¹‹é—´åªæ˜¯åˆ’åˆ†ä»»åŠ¡çš„å†…å­˜èµ„æºã€‚é€šè¿‡è°ƒæ•´ slot çš„æ•°é‡ï¼Œç”¨æˆ·å¯ä»¥å†³å®š subtasks çš„éš”ç¦»æ–¹å¼ã€‚æ¯ä¸ª TaskManager æœ‰ä¸€ä¸ª slot æ„å‘³ç€æ¯ç»„ task åœ¨ä¸€ä¸ªå•ç‹¬çš„ JVM ä¸­è¿è¡Œï¼ˆä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå•ç‹¬çš„å®¹å™¨ä¸­å¯åŠ¨ï¼‰ã€‚æ‹¥æœ‰å¤šä¸ª slots æ„å‘³ç€å¤šä¸ª subtasks å…±äº«åŒä¸€ä¸ª JVMã€‚ Tasks åœ¨åŒä¸€ä¸ª JVM ä¸­å…±äº« TCP è¿æ¥ï¼ˆé€šè¿‡å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼‰å’Œå¿ƒè·³ä¿¡æ¯ï¼ˆheartbeat messagesï¼‰ã€‚å®ƒä»¬è¿˜å¯èƒ½å…±äº«æ•°æ®é›†å’Œæ•°æ®ç»“æ„ï¼Œä»è€Œé™ä½æ¯ä¸ª task çš„å¼€é”€ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlink å…è®¸ subtasks å…±äº« slotsï¼Œå³ä½¿å®ƒä»¬æ˜¯ä¸åŒ tasks çš„ subtasksï¼Œåªè¦å®ƒä»¬æ¥è‡ªåŒä¸€ä¸ª jobã€‚å› æ­¤ï¼Œä¸€ä¸ª slot å¯èƒ½ä¼šè´Ÿè´£è¿™ä¸ª job çš„æ•´ä¸ªç®¡é“ï¼ˆpipelineï¼‰ã€‚å…è®¸ slot sharing æœ‰ä¸¤ä¸ªå¥½å¤„ï¼šFlink é›†ç¾¤éœ€è¦ä¸ job ä¸­ä½¿ç”¨çš„æœ€é«˜å¹¶è¡Œåº¦ä¸€æ ·å¤šçš„ slotsã€‚è¿™æ ·ä¸éœ€è¦è®¡ç®—ä½œä¸šæ€»å…±åŒ…å«å¤šå°‘ä¸ª tasksï¼ˆå…·æœ‰ä¸åŒå¹¶è¡Œåº¦ï¼‰ã€‚æ›´å¥½çš„èµ„æºåˆ©ç”¨ç‡ã€‚åœ¨æ²¡æœ‰ slot sharing çš„æƒ…å†µä¸‹ï¼Œç®€å•çš„ subtasksï¼ˆ_source/map()_ï¼‰å°†ä¼šå ç”¨å’Œå¤æ‚çš„ subtasks ï¼ˆ_window_ï¼‰ä¸€æ ·å¤šçš„èµ„æºã€‚é€šè¿‡ slot sharingï¼Œå°†ç¤ºä¾‹ä¸­çš„å¹¶è¡Œåº¦ä» 2 å¢åŠ åˆ° 6 å¯ä»¥å……åˆ†åˆ©ç”¨ slot çš„èµ„æºï¼ŒåŒæ—¶ç¡®ä¿ç¹é‡çš„ subtask åœ¨ TaskManagers ä¹‹é—´å…¬å¹³åœ°è·å–èµ„æºã€‚APIs è¿˜åŒ…å«äº† resource group æœºåˆ¶ï¼Œå®ƒå¯ä»¥ç”¨æ¥é˜²æ­¢ä¸å¿…è¦çš„ slot sharingã€‚æ ¹æ®ç»éªŒï¼Œåˆç†çš„ slots æ•°é‡åº”è¯¥å’Œ CPU æ ¸æ•°ç›¸åŒã€‚åœ¨ä½¿ç”¨è¶…çº¿ç¨‹ï¼ˆhyper-threadingï¼‰æ—¶ï¼Œæ¯ä¸ª slot å°†ä¼šå ç”¨ 2 ä¸ªæˆ–æ›´å¤šçš„ç¡¬ä»¶çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼ˆhardware thread contextsï¼‰ã€‚State Backendskey/values ç´¢å¼•å­˜å‚¨çš„æ•°æ®ç»“æ„å–å†³äº state backend çš„é€‰æ‹©ã€‚ä¸€ç±» state backend å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜çš„å“ˆå¸Œæ˜ å°„ä¸­ï¼Œå¦ä¸€ç±» state backend ä½¿ç”¨ RocksDB ä½œä¸ºé”®/å€¼å­˜å‚¨ã€‚é™¤äº†å®šä¹‰ä¿å­˜çŠ¶æ€ï¼ˆstateï¼‰çš„æ•°æ®ç»“æ„ä¹‹å¤–ï¼Œ state backend è¿˜å®ç°äº†è·å–é”®/å€¼çŠ¶æ€çš„æ—¶é—´ç‚¹å¿«ç…§çš„é€»è¾‘ï¼Œå¹¶å°†è¯¥å¿«ç…§å­˜å‚¨ä¸º checkpoint çš„ä¸€éƒ¨åˆ†ã€‚Savepointsç”¨ Data Stream API ç¼–å†™çš„ç¨‹åºå¯ä»¥ä» savepoint ç»§ç»­æ‰§è¡Œã€‚Savepoints å…è®¸åœ¨ä¸ä¸¢å¤±ä»»ä½•çŠ¶æ€çš„æƒ…å†µä¸‹å‡çº§ç¨‹åºå’Œ Flink é›†ç¾¤ã€‚Savepoints æ˜¯æ‰‹åŠ¨è§¦å‘çš„ checkpointsï¼Œå®ƒä¾é å¸¸è§„çš„ checkpoint æœºåˆ¶è·å–ç¨‹åºçš„å¿«ç…§å¹¶å°†å…¶å†™å…¥ state backendã€‚åœ¨æ‰§è¡ŒæœŸé—´ï¼Œç¨‹åºä¼šå®šæœŸåœ¨ worker èŠ‚ç‚¹ä¸Šåˆ›å»ºå¿«ç…§å¹¶ç”Ÿæˆ checkpointsã€‚å¯¹äºæ¢å¤ï¼ŒFlink ä»…éœ€è¦æœ€åå®Œæˆçš„ checkpointï¼Œè€Œä¸€æ—¦å®Œæˆäº†æ–°çš„ checkpointï¼Œæ—§çš„å°±å¯ä»¥è¢«ä¸¢å¼ƒã€‚Savepoints ç±»ä¼¼äºè¿™äº›å®šæœŸçš„ checkpointsï¼Œé™¤äº†å®ƒä»¬æ˜¯ç”±ç”¨æˆ·è§¦å‘å¹¶ä¸”åœ¨æ–°çš„ checkpoint å®Œæˆæ—¶ä¸ä¼šè‡ªåŠ¨è¿‡æœŸã€‚ä½ å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œ æˆ–åœ¨å–æ¶ˆä¸€ä¸ª job æ—¶é€šè¿‡ REST API æ¥åˆ›å»º Savepointsã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Flink ç¼–ç¨‹æ¨¡å‹","slug":"Flink-ç¼–ç¨‹æ¨¡å‹","date":"2018-03-01T07:32:00.000Z","updated":"2020-05-11T09:45:19.925Z","comments":true,"path":"2018/03/01/Flink-ç¼–ç¨‹æ¨¡å‹/","link":"","permalink":"cpeixin.cn/2018/03/01/Flink-%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B/","excerpt":"","text":"æŠ½è±¡çº§åˆ«Flinkæä¾›äº†ä¸åŒçº§åˆ«çš„æŠ½è±¡æ¥å¼€å‘æµ/æ‰¹å¤„ç†åº”ç”¨ç¨‹åºã€‚æœ€ä½çº§åˆ«çš„æŠ½è±¡ä»…æä¾›çŠ¶æ€æµã€‚å®ƒ é€šè¿‡Process FunctionåµŒå…¥åˆ°DataStream APIä¸­ã€‚å®ƒå…è®¸ç”¨æˆ·è‡ªç”±åœ°å¤„ç†ä¸€ä¸ªæˆ–å¤šä¸ªæµä¸­çš„äº‹ä»¶ï¼Œå¹¶ä½¿ç”¨ä¸€è‡´çš„å®¹é”™_çŠ¶æ€_ã€‚æ­¤å¤–ï¼Œç”¨æˆ·å¯ä»¥æ³¨å†Œäº‹ä»¶æ—¶é—´å’Œå¤„ç†æ—¶é—´å›è°ƒï¼Œä»è€Œå…è®¸ç¨‹åºå®ç°å¤æ‚çš„è®¡ç®—ã€‚å®é™…ä¸Šï¼Œå¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸éœ€è¦ä¸Šè¿°ä½çº§æŠ½è±¡ï¼Œè€Œæ˜¯é’ˆå¯¹Core APIè¿›è¡Œç¼–ç¨‹ï¼Œ ä¾‹å¦‚DataStream APIï¼ˆæœ‰ç•Œ/æ— ç•Œæµï¼‰å’ŒDataSet API ï¼ˆæœ‰ç•Œæ•°æ®é›†ï¼‰ã€‚è¿™äº›æµç•…çš„APIä¸ºæ•°æ®å¤„ç†æä¾›äº†é€šç”¨çš„æ„å»ºå—ï¼Œä¾‹å¦‚å„ç§å½¢å¼çš„ç”¨æˆ·æŒ‡å®šçš„è½¬æ¢ï¼Œè”æ¥ï¼Œèšåˆï¼Œçª—å£ï¼ŒçŠ¶æ€ç­‰ã€‚è¿™äº›APIä¸­å¤„ç†çš„æ•°æ®ç±»å‹ä»¥ç›¸åº”ç¼–ç¨‹è¯­è¨€ä¸­çš„ç±»è¡¨ç¤ºã€‚ä½çº§_Process Function_ä¸_DataStream API_é›†æˆåœ¨ä¸€èµ·ï¼Œä»è€Œä½¿å¾—ä»…å¯¹æŸäº›æ“ä½œè¿›è¡Œä½çº§æŠ½è±¡æˆä¸ºå¯èƒ½ã€‚è¯¥_æ•°æ®é›†API_æä¾›çš„æœ‰é™æ•°æ®é›†çš„å…¶ä»–åŸè¯­ï¼Œå¦‚å¾ªç¯/è¿­ä»£ã€‚è¯¥Table APIæ˜¯ä¸ºä¸­å¿ƒçš„å£°æ˜æ€§DSL è¡¨ï¼Œå…¶å¯è¢«åŠ¨æ€åœ°æ”¹å˜çš„è¡¨ï¼ˆè¡¨ç¤ºæµæ—¶ï¼‰ã€‚è¯¥Table APIéµå¾ªï¼ˆæ‰©å±•ï¼‰å…³ç³»æ¨¡å‹ï¼šè¡¨æœ‰ä¸€ä¸ªæ¨¡å¼è¿æ¥ï¼ˆç±»ä¼¼äºåœ¨å…³ç³»æ•°æ®åº“ä¸­çš„è¡¨ï¼‰å’ŒAPIæä¾›å¯æ¯”çš„æ“ä½œï¼Œå¦‚select, project, join, group-by, aggregateç­‰è¡¨APIç¨‹åºä»¥å£°æ˜çš„æ–¹å¼å®šä¹‰åº”è¯¥è¿›è¡Œå“ªäº›é€»è¾‘è¿ç®—ï¼Œ_è€Œ ä¸ç¡®åˆ‡åœ°å®šä¹‰_è¿ç®—çš„ä»£ç å¤–è§‚_ã€‚å°½ç®¡Table APIå¯ä»¥é€šè¿‡å„ç§ç±»å‹çš„ç”¨æˆ·å®šä¹‰å‡½æ•°è¿›è¡Œæ‰©å±•ï¼Œä½†å®ƒçš„è¡¨è¾¾æ€§ä¸å¦‚_Core APIã€‚_ï¼Œä½†ä½¿ç”¨èµ·æ¥æ›´ç®€æ´ï¼ˆæ— éœ€ç¼–å†™ä»£ç ï¼‰ã€‚æ­¤å¤–ï¼ŒTable APIç¨‹åºè¿˜ç»è¿‡ä¼˜åŒ–ç¨‹åºï¼Œè¯¥ä¼˜åŒ–ç¨‹åºåœ¨æ‰§è¡Œä¹‹å‰åº”ç”¨ä¼˜åŒ–è§„åˆ™ã€‚å¯ä»¥åœ¨è¡¨å’Œ_DataStream / DataSet_ä¹‹é—´æ— ç¼è½¬æ¢ï¼Œä»è€Œå…è®¸ç¨‹åºå°†_Table API_ä»¥åŠ_DataStream å’ŒDataSet APIæ··åˆä½¿ç”¨ã€‚Flinkæä¾›çš„æœ€é«˜çº§åˆ«çš„æŠ½è±¡æ˜¯SQLã€‚è¿™ç§æŠ½è±¡åœ¨è¯­ä¹‰å’Œè¡¨è¾¾æ–¹å¼ä¸Šå‡ç±»ä¼¼äº_Table API_ï¼Œä½†æ˜¯å°†ç¨‹åºè¡¨ç¤ºä¸ºSQLæŸ¥è¯¢è¡¨è¾¾å¼ã€‚åœ¨SQLæŠ½è±¡ä¸è¡¨API SQLæŸ¥è¯¢ç´§å¯†åœ°ç›¸äº’ä½œç”¨ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸­å®šä¹‰çš„è¡¨æ‰§è¡Œ_è¡¨API_ã€‚ç¨‹åºå’Œæ•°æ®æµFlinkç¨‹åºçš„åŸºæœ¬æ„å»ºéƒ¨åˆ†æ˜¯æµå’Œè½¬æ¢ã€‚ï¼ˆè¯·æ³¨æ„ï¼ŒFlinkçš„DataSet APIä¸­ä½¿ç”¨çš„DataSetä¹Ÿæ˜¯å†…éƒ¨æµï¼‰ä»æ¦‚å¿µä¸Šè®²ï¼Œæµæ˜¯æ•°æ®è®°å½•æµï¼ˆå¯èƒ½æ°¸æ— æ­¢å¢ƒï¼‰ï¼Œè€Œè½¬æ¢_æ˜¯å°†ä¸€ä¸ªæˆ–å¤šä¸ªæµä½œä¸ºä¸€ä¸ªæ“ä½œçš„æ“ä½œã€‚è¾“å…¥ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªæˆ–å¤šä¸ªè¾“å‡ºæµã€‚æ‰§è¡Œæ—¶ï¼ŒFlinkç¨‹åºå°†æ˜ å°„åˆ°ç”±æµå’Œè½¬æ¢è¿ç®—ç¬¦ç»„æˆçš„æµæ•°æ®æµã€‚æ¯ä¸ªæ•°æ®æµéƒ½ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªæºå¼€å§‹ï¼Œå¹¶ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªæ¥æ”¶å™¨ç»“æŸã€‚æ•°æ®æµç±»ä¼¼äºä»»æ„**æœ‰å‘æ— ç¯å›¾_ï¼ˆDAGï¼‰**ã€‚å°½ç®¡å¯ä»¥é€šè¿‡_è¿­ä»£_æ„é€ æ¥å…è®¸ç‰¹æ®Šå½¢å¼çš„å¾ªç¯ ï¼Œä½†æ˜¯åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œä»‹ç»ã€‚ç¨‹åºä¸­çš„è½¬æ¢ä¸æ•°æ®æµä¸­çš„è¿ç®—ç¬¦ä¹‹é—´é€šå¸¸å­˜åœ¨ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶ï¼Œä¸€ä¸ªè½¬æ¢å¯èƒ½åŒ…å«å¤šä¸ªè½¬æ¢è¿ç®—ç¬¦ã€‚æºå’Œæ¥æ”¶å™¨è®°å½•åœ¨æµè¿æ¥å™¨å’Œæ‰¹å¤„ç†è¿æ¥å™¨æ–‡æ¡£ä¸­ã€‚è½¬æ¢è®°å½•åœ¨DataStreamè¿ç®—ç¬¦å’ŒDataSetè½¬æ¢ä¸­ã€‚å›åˆ°é¡¶éƒ¨å¹¶è¡Œæ•°æ®æµFlinkä¸­çš„ç¨‹åºæœ¬è´¨ä¸Šæ˜¯å¹¶è¡Œçš„å’Œåˆ†å¸ƒå¼çš„ã€‚åœ¨æ‰§è¡ŒæœŸé—´ï¼Œä¸€ä¸ªæµå…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæµåˆ†åŒºï¼Œå¹¶ä¸”æ¯ä¸ª_è¿ç®—ç¬¦_å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¿ç®—ç¬¦å­ä»»åŠ¡ã€‚æ“ä½œå‘˜å­ä»»åŠ¡å½¼æ­¤ç‹¬ç«‹ï¼Œå¹¶åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¹¶ä¸”å¯èƒ½åœ¨ä¸åŒçš„æœºå™¨æˆ–å®¹å™¨ä¸Šæ‰§è¡Œã€‚_operator subtask_çš„æ•°é‡æ˜¯è¯¥ç‰¹å®šæ“ä½œå‘˜çš„å¹¶è¡Œæ€§ã€‚æµçš„å¹¶è¡Œæ€§å§‹ç»ˆæ˜¯å…¶ç”Ÿäº§è¿è¥å•†çš„å¹¶è¡Œæ€§ã€‚åŒä¸€ç¨‹åºçš„ä¸åŒè¿ç®—ç¬¦å¯èƒ½å…·æœ‰ä¸åŒçš„å¹¶è¡Œåº¦ã€‚æµå¯ä»¥_æŒ‰ä¸€å¯¹ä¸€_ï¼ˆæˆ–_è½¬å‘_ï¼‰æ¨¡å¼æˆ–_é‡æ–°åˆ†é…_æ¨¡å¼åœ¨ä¸¤ä¸ªè¿ç®—ç¬¦ä¹‹é—´ä¼ è¾“æ•°æ®ï¼šä¸€å¯¹ä¸€çš„æµï¼ˆä¾‹å¦‚ï¼Œä¸Šå›¾ä¸­çš„_Source_å’Œ_mapï¼ˆï¼‰_è¿ç®—ç¬¦ä¹‹é—´ï¼‰ä¿ç•™å…ƒç´ çš„åˆ†åŒºå’Œæ’åºã€‚è¿™æ„å‘³ç€_mapï¼ˆï¼‰_è¿ç®—ç¬¦çš„subtask [1] å°†ä»¥ä¸_Source_è¿ç®—ç¬¦çš„subtask [1]äº§ç”Ÿçš„ç›¸åŒé¡ºåºçœ‹åˆ°ç›¸åŒçš„å…ƒç´ ã€‚é‡æ–°åˆ†é…æµï¼ˆå¦‚ä¸Šé¢çš„mapï¼ˆï¼‰å’ŒkeyByï¼ˆï¼‰ / windowï¼ˆï¼‰_ä¹‹é—´ä»¥åŠ _keyByï¼ˆï¼‰ / windowï¼ˆï¼‰å’ŒSinkä¹‹é—´_ï¼‰ä¼šæ›´æ”¹æµçš„åˆ†åŒºã€‚æ¯ä¸ª_operator subtaskéƒ½_å°†æ•°æ®å‘é€åˆ°ä¸åŒçš„ç›®æ ‡å­ä»»åŠ¡ï¼Œå…·ä½“å–å†³äºæ‰€é€‰çš„è½¬æ¢ã€‚å®ä¾‹æ˜¯ _keyByï¼ˆï¼‰ _ï¼ˆå…¶é‡æ–°åˆ†åŒºé€šè¿‡æ•£åˆ—é”®ï¼‰ï¼Œ_broadcast() æˆ–è€… rebalance() _ï¼ˆå…¶é‡æ–°åˆ†åŒºéšæœºåœ°ï¼‰ã€‚åœ¨_é‡æ–°åˆ†é…_äº¤æ¢ä¸­ï¼Œå…ƒç´ ä¹‹é—´çš„é¡ºåºä»…ä¿ç•™åœ¨æ¯å¯¹å‘é€å’Œæ¥æ”¶å­ä»»åŠ¡ä¸­ï¼ˆä¾‹å¦‚_mapï¼ˆï¼‰çš„ subtask [1]å’Œmapï¼ˆï¼‰çš„ subtask [2]_keyBy / window_ï¼‰ã€‚å› æ­¤ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä¿ç•™äº†æ¯ä¸ªé”®å†…çš„é¡ºåºï¼Œä½†æ˜¯å¹¶è¡Œæ€§ç¡®å®å¼•å…¥äº†ä¸ç¡®å®šæ€§ï¼Œå³ä¸åŒé”®çš„èšåˆç»“æœåˆ°è¾¾æ¥æ”¶å™¨çš„é¡ºåºã€‚æœ‰å…³é…ç½®å’Œæ§åˆ¶å¹¶è¡Œæ€§çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§å¹¶è¡Œæ‰§è¡Œæ–‡æ¡£ã€‚è§†çª—æ±‡æ€»äº‹ä»¶ï¼ˆä¾‹å¦‚ï¼Œè®¡æ•°ï¼Œæ€»å’Œï¼‰åœ¨æµä¸Šçš„å·¥ä½œæ–¹å¼ä¸æ‰¹å¤„ç†ä¸­çš„ä¸åŒã€‚ä¾‹å¦‚ï¼Œä¸å¯èƒ½è®¡ç®—æµä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå› ä¸ºæµé€šå¸¸æ˜¯æ— é™çš„ï¼ˆæ— ç•Œï¼‰ã€‚ç›¸åï¼Œæµä¸Šçš„èšåˆï¼ˆè®¡æ•°ï¼Œæ€»å’Œç­‰ï¼‰ç”±çª—å£ç¡®å®šèŒƒå›´ï¼Œä¾‹å¦‚_â€œè¿‡å»5åˆ†é’Ÿå†…çš„è®¡æ•°â€æˆ–â€œæœ€è¿‘100ä¸ªå…ƒç´ çš„æ€»å’Œâ€_ã€‚Windowså¯ä»¥æ˜¯_æ—¶é—´é©±åŠ¨çš„_ï¼ˆä¾‹å¦‚ï¼šæ¯30ç§’ï¼‰æˆ–_æ•°æ®é©±åŠ¨çš„_ï¼ˆä¾‹å¦‚ï¼šæ¯100ä¸ªå…ƒç´ ï¼‰ã€‚é€šå¸¸å¯ä»¥åŒºåˆ†ä¸åŒç±»å‹çš„çª—å£ï¼Œä¾‹å¦‚_æ»šåŠ¨çª—å£_ï¼ˆæ— é‡å ï¼‰ï¼Œ _æ»‘åŠ¨çª—å£_ï¼ˆæœ‰é‡å ï¼‰å’Œ_ä¼šè¯çª—å£_ï¼ˆç”±ä¸æ´»åŠ¨çš„é—´éš™æ‰“æ–­ï¼‰ã€‚å¯ä»¥åœ¨æ­¤åšå®¢æ–‡ç« ä¸­æ‰¾åˆ°æ›´å¤šçª—å£ç¤ºä¾‹ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯åœ¨docsçª—å£ä¸­ã€‚æ—¶é—´åœ¨æµå¼ä¼ è¾“ç¨‹åºä¸­å¼•ç”¨æ—¶é—´ï¼ˆä¾‹å¦‚ï¼Œå®šä¹‰çª—å£ï¼‰æ—¶ï¼Œå¯ä»¥å¼•ç”¨ä¸åŒçš„æ—¶é—´æ¦‚å¿µï¼šäº‹ä»¶æ—¶é—´æ˜¯åˆ›å»ºäº‹ä»¶çš„æ—¶é—´ã€‚é€šå¸¸ç”¨äº‹ä»¶ä¸­çš„æ—¶é—´æˆ³è®°æ¥æè¿°ï¼Œä¾‹å¦‚ç”±ç”Ÿäº§ä¼ æ„Ÿå™¨æˆ–ç”Ÿäº§æœåŠ¡é™„åŠ ã€‚Flinké€šè¿‡æ—¶é—´æˆ³åˆ†é…å™¨è®¿é—®äº‹ä»¶æ—¶é—´æˆ³ã€‚æ¥æ”¶æ—¶é—´æ˜¯äº‹ä»¶åœ¨æºæ“ä½œå‘˜è¿›å…¥Flinkæ•°æ®æµçš„æ—¶é—´ã€‚å¤„ç†æ—¶é—´æ˜¯æ¯ä¸ªæ‰§è¡ŒåŸºäºæ—¶é—´çš„æ“ä½œçš„æ“ä½œå‘˜çš„æœ¬åœ°æ—¶é—´ã€‚æœ‰å…³å¦‚ä½•å¤„ç†æ—¶é—´çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§äº‹ä»¶æ—¶é—´æ–‡æ¡£ã€‚æœ‰çŠ¶æ€çš„æ“ä½œå°½ç®¡æ•°æ®æµä¸­çš„è®¸å¤šæ“ä½œä¸€æ¬¡ä»…æŸ¥çœ‹ä¸€ä¸ª_äº‹ä»¶_ï¼ˆä¾‹å¦‚äº‹ä»¶è§£æå™¨ï¼‰ï¼Œä½†æŸäº›æ“ä½œä¼šè®°ä½å¤šä¸ªäº‹ä»¶çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚çª—å£è¿ç®—ç¬¦ï¼‰ã€‚è¿™äº›æ“ä½œç§°ä¸ºæœ‰çŠ¶æ€ã€‚æœ‰çŠ¶æ€æ“ä½œçš„çŠ¶æ€ä»¥å¯ä»¥è¢«è®¤ä¸ºæ˜¯åµŒå…¥å¼é”®/å€¼å­˜å‚¨çš„æ–¹å¼ç»´æŠ¤ã€‚ä¸¥æ ¼å°†çŠ¶æ€ä¸æœ‰çŠ¶æ€è¿ç®—ç¬¦è¯»å–çš„æµä¸€èµ·è¿›è¡Œåˆ†åŒºå’Œåˆ†å‘ã€‚å› æ­¤ï¼Œåªæœ‰åœ¨_keyByï¼ˆï¼‰_å‡½æ•°ä¹‹åï¼Œæ‰å¯ä»¥åœ¨_é”®æ§æµ_ä¸Šè®¿é—®é”®/å€¼çŠ¶æ€ï¼Œå¹¶ä¸”ä»…é™äºä¸å½“å‰äº‹ä»¶çš„é”®å…³è”çš„å€¼ã€‚å¯¹é½æµé”®å’ŒçŠ¶æ€é”®å¯ç¡®ä¿æ‰€æœ‰çŠ¶æ€æ›´æ–°éƒ½æ˜¯æœ¬åœ°æ“ä½œï¼Œä»è€Œç¡®ä¿äº†ä¸€è‡´æ€§è€Œæ²¡æœ‰äº‹åŠ¡å¼€é”€ã€‚è¿™ç§å¯¹é½æ–¹å¼è¿˜å…è®¸Flinké‡æ–°åˆ†é…çŠ¶æ€å¹¶é€æ˜åœ°è°ƒæ•´æµåˆ†åŒºã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…å…³äºstateçš„æ–‡æ¡£ã€‚å®¹é”™æ£€æŸ¥ç‚¹Flinké€šè¿‡ç»“åˆstream replay and checkpointing.æ¥å®ç°å®¹é”™ã€‚æ£€æŸ¥ç‚¹ä¸æ¯ä¸ªè¾“å…¥æµä¸­çš„ç‰¹å®šç‚¹ä»¥åŠæ¯ä¸ªè¿ç®—ç¬¦çš„å¯¹åº”çŠ¶æ€æœ‰å…³ã€‚é€šè¿‡æ¢å¤operatorsçš„çŠ¶æ€å¹¶ä»æ£€æŸ¥ç‚¹å¼€å§‹é‡æ”¾äº‹ä»¶ï¼Œå¯ä»¥ä»æ£€æŸ¥ç‚¹æ¢å¤æµæ•°æ®æµï¼ŒåŒæ—¶ä¿æŒä¸€è‡´æ€§_ï¼ˆä¸€æ¬¡å¤„ç†è¯­ä¹‰ï¼‰_ã€‚æ£€æŸ¥ç‚¹é—´éš”æ˜¯åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æƒè¡¡å®¹é”™å¼€é”€ä¸æ¢å¤æ—¶é—´ï¼ˆéœ€è¦é‡æ’­çš„äº‹ä»¶æ•°ï¼‰çš„ä¸€ç§æ–¹æ³•ã€‚å®¹é”™å†…éƒ¨çš„æè¿°æä¾›äº†æœ‰å…³Flinkå¦‚ä½•ç®¡ç†æ£€æŸ¥ç‚¹å’Œç›¸å…³ä¸»é¢˜çš„æ›´å¤šä¿¡æ¯ã€‚æœ‰å…³å¯ç”¨å’Œé…ç½®æ£€æŸ¥ç‚¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§checkpointing APIæ–‡æ¡£ã€‚ä¸²æµå¤„ç†Flinkæ‰§è¡Œæ‰¹å¤„ç†ç¨‹åºï¼Œè¿™æ˜¯æµç¨‹åºçš„ç‰¹ä¾‹ï¼Œå…¶ä¸­æµæ˜¯æœ‰ç•Œçš„ï¼ˆå…ƒç´ æ•°é‡æœ‰é™ï¼‰ã€‚ç”²_æ•°æ®é›†_åœ¨å†…éƒ¨è§†ä¸ºæ•°æ®æµã€‚å› æ­¤ï¼Œä»¥ä¸Šæ¦‚å¿µä»¥åŒæ ·çš„æ–¹å¼é€‚ç”¨äºæ‰¹å¤„ç†ç¨‹åºï¼Œä¹Ÿé€‚ç”¨äºæµå¼ç¨‹åºï¼Œä½†æœ‰å°‘é‡ä¾‹å¤–ï¼šæ‰¹å¤„ç†ç¨‹åºçš„å®¹é”™åŠŸèƒ½ä¸ä½¿ç”¨æ£€æŸ¥ç‚¹ã€‚é€šè¿‡å®Œå…¨é‡æ’­æµæ¥è¿›è¡Œæ¢å¤ã€‚è¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºè¾“å…¥æ˜¯æœ‰ç•Œçš„ã€‚è¿™å°†æˆæœ¬æ›´å¤šåœ°æ¨å‘äº†æ¢å¤ï¼Œä½†ç”±äºé¿å…äº†æ£€æŸ¥ç‚¹ï¼Œå› æ­¤ä½¿å¸¸è§„å¤„ç†çš„æˆæœ¬é™ä½äº†ã€‚DataSet APIä¸­çš„çŠ¶æ€æ“ä½œä½¿ç”¨ç®€åŒ–çš„å†…å­˜ä¸­/æ ¸å¤–æ•°æ®ç»“æ„ï¼Œè€Œä¸æ˜¯é”®/å€¼ç´¢å¼•ã€‚DataSet APIå¼•å…¥äº†ç‰¹æ®Šçš„åŒæ­¥ï¼ˆåŸºäºè¶…æ­¥ï¼‰è¿­ä»£ï¼Œä»…åœ¨æœ‰é™æµä¸Šæ‰æœ‰å¯èƒ½ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹è¿­ä»£æ–‡æ¡£ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Flink åº”ç”¨åœºæ™¯","slug":"Flink-åº”ç”¨åœºæ™¯","date":"2018-02-22T09:00:58.000Z","updated":"2020-05-10T13:06:31.078Z","comments":true,"path":"2018/02/22/Flink-åº”ç”¨åœºæ™¯/","link":"","permalink":"cpeixin.cn/2018/02/22/Flink-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/","excerpt":"","text":"Apache Flink åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå¼€å‘å’Œè¿è¡Œå¤šç§ä¸åŒç§ç±»çš„åº”ç”¨ç¨‹åºã€‚å®ƒçš„ä¸»è¦ç‰¹æ€§åŒ…æ‹¬ï¼šæ‰¹æµä¸€ä½“åŒ–ã€ç²¾å¯†çš„çŠ¶æ€ç®¡ç†ã€äº‹ä»¶æ—¶é—´æ”¯æŒä»¥åŠç²¾ç¡®ä¸€æ¬¡çš„çŠ¶æ€ä¸€è‡´æ€§ä¿éšœç­‰ã€‚Flink ä¸ä»…å¯ä»¥è¿è¡Œåœ¨åŒ…æ‹¬ YARNã€ Mesosã€Kubernetes åœ¨å†…çš„å¤šç§èµ„æºç®¡ç†æ¡†æ¶ä¸Šï¼Œè¿˜æ”¯æŒåœ¨è£¸æœºé›†ç¾¤ä¸Šç‹¬ç«‹éƒ¨ç½²ã€‚åœ¨å¯ç”¨é«˜å¯ç”¨é€‰é¡¹çš„æƒ…å†µä¸‹ï¼Œå®ƒä¸å­˜åœ¨å•ç‚¹å¤±æ•ˆé—®é¢˜ã€‚äº‹å®è¯æ˜ï¼ŒFlink å·²ç»å¯ä»¥æ‰©å±•åˆ°æ•°åƒæ ¸å¿ƒï¼Œå…¶çŠ¶æ€å¯ä»¥è¾¾åˆ° TB çº§åˆ«ï¼Œä¸”ä»èƒ½ä¿æŒé«˜ååã€ä½å»¶è¿Ÿçš„ç‰¹æ€§ã€‚ä¸–ç•Œå„åœ°æœ‰å¾ˆå¤šè¦æ±‚ä¸¥è‹›çš„æµå¤„ç†åº”ç”¨éƒ½è¿è¡Œåœ¨ Flink ä¹‹ä¸Šã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä»‹ç» Flink å¸¸è§çš„å‡ ç±»åº”ç”¨å¹¶ç»™å‡ºç›¸å…³å®ä¾‹é“¾æ¥ã€‚äº‹ä»¶é©±åŠ¨å‹åº”ç”¨æ•°æ®åˆ†æåº”ç”¨æ•°æ®ç®¡é“åº”ç”¨äº‹ä»¶é©±åŠ¨å‹åº”ç”¨ä»€ä¹ˆæ˜¯äº‹ä»¶é©±åŠ¨å‹åº”ç”¨ï¼Ÿäº‹ä»¶é©±åŠ¨å‹åº”ç”¨æ˜¯ä¸€ç±»å…·æœ‰çŠ¶æ€çš„åº”ç”¨ï¼Œå®ƒä»ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶æµæå–æ•°æ®ï¼Œå¹¶æ ¹æ®åˆ°æ¥çš„äº‹ä»¶è§¦å‘è®¡ç®—ã€çŠ¶æ€æ›´æ–°æˆ–å…¶ä»–å¤–éƒ¨åŠ¨ä½œã€‚äº‹ä»¶é©±åŠ¨å‹åº”ç”¨æ˜¯åœ¨è®¡ç®—å­˜å‚¨åˆ†ç¦»çš„ä¼ ç»Ÿåº”ç”¨åŸºç¡€ä¸Šè¿›åŒ–è€Œæ¥ã€‚åœ¨ä¼ ç»Ÿæ¶æ„ä¸­ï¼Œåº”ç”¨éœ€è¦è¯»å†™è¿œç¨‹äº‹åŠ¡å‹æ•°æ®åº“ã€‚ç›¸åï¼Œäº‹ä»¶é©±åŠ¨å‹åº”ç”¨æ˜¯åŸºäºçŠ¶æ€åŒ–æµå¤„ç†æ¥å®Œæˆã€‚åœ¨è¯¥è®¾è®¡ä¸­ï¼Œæ•°æ®å’Œè®¡ç®—ä¸ä¼šåˆ†ç¦»ï¼Œåº”ç”¨åªéœ€è®¿é—®æœ¬åœ°ï¼ˆå†…å­˜æˆ–ç£ç›˜ï¼‰å³å¯è·å–æ•°æ®ã€‚ç³»ç»Ÿå®¹é”™æ€§çš„å®ç°ä¾èµ–äºå®šæœŸå‘è¿œç¨‹æŒä¹…åŒ–å­˜å‚¨å†™å…¥ checkpointã€‚ä¸‹å›¾æè¿°äº†ä¼ ç»Ÿåº”ç”¨å’Œäº‹ä»¶é©±åŠ¨å‹åº”ç”¨æ¶æ„çš„åŒºåˆ«ã€‚äº‹ä»¶é©±åŠ¨å‹åº”ç”¨çš„ä¼˜åŠ¿ï¼Ÿäº‹ä»¶é©±åŠ¨å‹åº”ç”¨æ— é¡»æŸ¥è¯¢è¿œç¨‹æ•°æ®åº“ï¼Œæœ¬åœ°æ•°æ®è®¿é—®ä½¿å¾—å®ƒå…·æœ‰æ›´é«˜çš„ååå’Œæ›´ä½çš„å»¶è¿Ÿã€‚è€Œç”±äºå®šæœŸå‘è¿œç¨‹æŒä¹…åŒ–å­˜å‚¨çš„ checkpoint å·¥ä½œå¯ä»¥å¼‚æ­¥ã€å¢é‡å¼å®Œæˆï¼Œå› æ­¤å¯¹äºæ­£å¸¸äº‹ä»¶å¤„ç†çš„å½±å“ç”šå¾®ã€‚äº‹ä»¶é©±åŠ¨å‹åº”ç”¨çš„ä¼˜åŠ¿ä¸ä»…é™äºæœ¬åœ°æ•°æ®è®¿é—®ã€‚ä¼ ç»Ÿåˆ†å±‚æ¶æ„ä¸‹ï¼Œé€šå¸¸å¤šä¸ªåº”ç”¨ä¼šå…±äº«åŒä¸€ä¸ªæ•°æ®åº“ï¼Œå› è€Œä»»ä½•å¯¹æ•°æ®åº“è‡ªèº«çš„æ›´æ”¹ï¼ˆä¾‹å¦‚ï¼šç”±åº”ç”¨æ›´æ–°æˆ–æœåŠ¡æ‰©å®¹å¯¼è‡´æ•°æ®å¸ƒå±€å‘ç”Ÿæ”¹å˜ï¼‰éƒ½éœ€è¦è°¨æ…åè°ƒã€‚åè§‚äº‹ä»¶é©±åŠ¨å‹åº”ç”¨ï¼Œç”±äºåªéœ€è€ƒè™‘è‡ªèº«æ•°æ®ï¼Œå› æ­¤åœ¨æ›´æ”¹æ•°æ®è¡¨ç¤ºæˆ–æœåŠ¡æ‰©å®¹æ—¶æ‰€éœ€çš„åè°ƒå·¥ä½œå°†å¤§å¤§å‡å°‘ã€‚Flink å¦‚ä½•æ”¯æŒäº‹ä»¶é©±åŠ¨å‹åº”ç”¨ï¼Ÿäº‹ä»¶é©±åŠ¨å‹åº”ç”¨ä¼šå—åˆ¶äºåº•å±‚æµå¤„ç†ç³»ç»Ÿå¯¹æ—¶é—´å’ŒçŠ¶æ€çš„æŠŠæ§èƒ½åŠ›ï¼ŒFlink è¯¸å¤šä¼˜ç§€ç‰¹è´¨éƒ½æ˜¯å›´ç»•è¿™äº›æ–¹é¢æ¥è®¾è®¡çš„ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—ä¸°å¯Œçš„çŠ¶æ€æ“ä½œåŸè¯­ï¼Œå…è®¸ä»¥ç²¾ç¡®ä¸€æ¬¡çš„ä¸€è‡´æ€§è¯­ä¹‰åˆå¹¶æµ·é‡è§„æ¨¡ï¼ˆTB çº§åˆ«ï¼‰çš„çŠ¶æ€æ•°æ®ã€‚æ­¤å¤–ï¼ŒFlink è¿˜æ”¯æŒäº‹ä»¶æ—¶é—´å’Œè‡ªç”±åº¦æé«˜çš„å®šåˆ¶åŒ–çª—å£é€»è¾‘ï¼Œè€Œä¸”å®ƒå†…ç½®çš„ ProcessFunction æ”¯æŒç»†ç²’åº¦æ—¶é—´æ§åˆ¶ï¼Œæ–¹ä¾¿å®ç°ä¸€äº›é«˜çº§ä¸šåŠ¡é€»è¾‘ã€‚åŒæ—¶ï¼ŒFlink è¿˜æ‹¥æœ‰ä¸€ä¸ªå¤æ‚äº‹ä»¶å¤„ç†ï¼ˆCEPï¼‰ç±»åº“ï¼Œå¯ä»¥ç”¨æ¥æ£€æµ‹æ•°æ®æµä¸­çš„æ¨¡å¼ã€‚Flink ä¸­é’ˆå¯¹äº‹ä»¶é©±åŠ¨åº”ç”¨çš„æ˜æ˜Ÿç‰¹æ€§å½“å± savepointã€‚Savepoint æ˜¯ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€æ˜ åƒï¼Œå®ƒå¯ä»¥ç”¨æ¥åˆå§‹åŒ–ä»»æ„çŠ¶æ€å…¼å®¹çš„åº”ç”¨ã€‚åœ¨å®Œæˆä¸€æ¬¡ savepoint åï¼Œå³å¯æ”¾å¿ƒå¯¹åº”ç”¨å‡çº§æˆ–æ‰©å®¹ï¼Œè¿˜å¯ä»¥å¯åŠ¨å¤šä¸ªç‰ˆæœ¬çš„åº”ç”¨æ¥å®Œæˆ A/B æµ‹è¯•ã€‚å…¸å‹çš„äº‹ä»¶é©±åŠ¨å‹åº”ç”¨å®ä¾‹åæ¬ºè¯ˆå¼‚å¸¸æ£€æµ‹åŸºäºè§„åˆ™çš„æŠ¥è­¦ä¸šåŠ¡æµç¨‹ç›‘æ§ï¼ˆç¤¾äº¤ç½‘ç»œï¼‰Web åº”ç”¨æ•°æ®åˆ†æåº”ç”¨ä»€ä¹ˆæ˜¯æ•°æ®åˆ†æåº”ç”¨ï¼Ÿæ•°æ®åˆ†æä»»åŠ¡éœ€è¦ä»åŸå§‹æ•°æ®ä¸­æå–æœ‰ä»·å€¼çš„ä¿¡æ¯å’ŒæŒ‡æ ‡ã€‚ä¼ ç»Ÿçš„åˆ†ææ–¹å¼é€šå¸¸æ˜¯åˆ©ç”¨æ‰¹æŸ¥è¯¢ï¼Œæˆ–å°†äº‹ä»¶è®°å½•ä¸‹æ¥å¹¶åŸºäºæ­¤æœ‰é™æ•°æ®é›†æ„å»ºåº”ç”¨æ¥å®Œæˆã€‚ä¸ºäº†å¾—åˆ°æœ€æ–°æ•°æ®çš„åˆ†æç»“æœï¼Œå¿…é¡»å…ˆå°†å®ƒä»¬åŠ å…¥åˆ†ææ•°æ®é›†å¹¶é‡æ–°æ‰§è¡ŒæŸ¥è¯¢æˆ–è¿è¡Œåº”ç”¨ï¼Œéšåå°†ç»“æœå†™å…¥å­˜å‚¨ç³»ç»Ÿæˆ–ç”ŸæˆæŠ¥å‘Šã€‚å€ŸåŠ©ä¸€äº›å…ˆè¿›çš„æµå¤„ç†å¼•æ“ï¼Œè¿˜å¯ä»¥å®æ—¶åœ°è¿›è¡Œæ•°æ®åˆ†æã€‚å’Œä¼ ç»Ÿæ¨¡å¼ä¸‹è¯»å–æœ‰é™æ•°æ®é›†ä¸åŒï¼Œæµå¼æŸ¥è¯¢æˆ–åº”ç”¨ä¼šæ¥å…¥å®æ—¶äº‹ä»¶æµï¼Œå¹¶éšç€äº‹ä»¶æ¶ˆè´¹æŒç»­äº§ç”Ÿå’Œæ›´æ–°ç»“æœã€‚è¿™äº›ç»“æœæ•°æ®å¯èƒ½ä¼šå†™å…¥å¤–éƒ¨æ•°æ®åº“ç³»ç»Ÿæˆ–ä»¥å†…éƒ¨çŠ¶æ€çš„å½¢å¼ç»´æŠ¤ã€‚ä»ªè¡¨å±•ç¤ºåº”ç”¨å¯ä»¥ç›¸åº”åœ°ä»å¤–éƒ¨æ•°æ®åº“è¯»å–æ•°æ®æˆ–ç›´æ¥æŸ¥è¯¢åº”ç”¨çš„å†…éƒ¨çŠ¶æ€ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒApache Flink åŒæ—¶æ”¯æŒæµå¼åŠæ‰¹é‡åˆ†æåº”ç”¨ã€‚æµå¼åˆ†æåº”ç”¨çš„ä¼˜åŠ¿ï¼Ÿå’Œæ‰¹é‡åˆ†æç›¸æ¯”ï¼Œç”±äºæµå¼åˆ†æçœæ‰äº†å‘¨æœŸæ€§çš„æ•°æ®å¯¼å…¥å’ŒæŸ¥è¯¢è¿‡ç¨‹ï¼Œå› æ­¤ä»äº‹ä»¶ä¸­è·å–æŒ‡æ ‡çš„å»¶è¿Ÿæ›´ä½ã€‚ä¸ä»…å¦‚æ­¤ï¼Œæ‰¹é‡æŸ¥è¯¢å¿…é¡»å¤„ç†é‚£äº›ç”±å®šæœŸå¯¼å…¥å’Œè¾“å…¥æœ‰ç•Œæ€§å¯¼è‡´çš„äººå·¥æ•°æ®è¾¹ç•Œï¼Œè€Œæµå¼æŸ¥è¯¢åˆ™æ— é¡»è€ƒè™‘è¯¥é—®é¢˜ã€‚å¦ä¸€æ–¹é¢ï¼Œæµå¼åˆ†æä¼šç®€åŒ–åº”ç”¨æŠ½è±¡ã€‚æ‰¹é‡æŸ¥è¯¢çš„æµæ°´çº¿é€šå¸¸ç”±å¤šä¸ªç‹¬ç«‹éƒ¨ä»¶ç»„æˆï¼Œéœ€è¦å‘¨æœŸæ€§åœ°è°ƒåº¦æå–æ•°æ®å’Œæ‰§è¡ŒæŸ¥è¯¢ã€‚å¦‚æ­¤å¤æ‚çš„æµæ°´çº¿æ“ä½œèµ·æ¥å¹¶ä¸å®¹æ˜“ï¼Œä¸€æ—¦æŸä¸ªç»„ä»¶å‡ºé”™å°†ä¼šå½±å“æµæ°´çº¿çš„åç»­æ­¥éª¤ã€‚è€Œæµå¼åˆ†æåº”ç”¨æ•´ä½“è¿è¡Œåœ¨ Flink ä¹‹ç±»çš„é«˜ç«¯æµå¤„ç†ç³»ç»Ÿä¹‹ä¸Šï¼Œæ¶µç›–äº†ä»æ•°æ®æ¥å…¥åˆ°è¿ç»­ç»“æœè®¡ç®—çš„æ‰€æœ‰æ­¥éª¤ï¼Œå› æ­¤å¯ä»¥ä¾èµ–åº•å±‚å¼•æ“æä¾›çš„æ•…éšœæ¢å¤æœºåˆ¶ã€‚Flink å¦‚ä½•æ”¯æŒæ•°æ®åˆ†æç±»åº”ç”¨ï¼ŸFlink ä¸ºæŒç»­æµå¼åˆ†æå’Œæ‰¹é‡åˆ†æéƒ½æä¾›äº†è‰¯å¥½çš„æ”¯æŒã€‚å…·ä½“è€Œè¨€ï¼Œå®ƒå†…ç½®äº†ä¸€ä¸ªç¬¦åˆ ANSI æ ‡å‡†çš„ SQL æ¥å£ï¼Œå°†æ‰¹ã€æµæŸ¥è¯¢çš„è¯­ä¹‰ç»Ÿä¸€èµ·æ¥ã€‚æ— è®ºæ˜¯åœ¨è®°å½•äº‹ä»¶çš„é™æ€æ•°æ®é›†ä¸Šè¿˜æ˜¯å®æ—¶äº‹ä»¶æµä¸Šï¼Œç›¸åŒ SQL æŸ¥è¯¢éƒ½ä¼šå¾—åˆ°ä¸€è‡´çš„ç»“æœã€‚åŒæ—¶ Flink è¿˜æ”¯æŒä¸°å¯Œçš„ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œå…è®¸åœ¨ SQL ä¸­æ‰§è¡Œå®šåˆ¶åŒ–ä»£ç ã€‚å¦‚æœè¿˜éœ€è¿›ä¸€æ­¥å®šåˆ¶é€»è¾‘ï¼Œå¯ä»¥åˆ©ç”¨ Flink DataStream API å’Œ DataSet API è¿›è¡Œæ›´ä½å±‚æ¬¡çš„æ§åˆ¶ã€‚æ­¤å¤–ï¼ŒFlink çš„ Gelly åº“ä¸ºåŸºäºæ‰¹é‡æ•°æ®é›†çš„å¤§è§„æ¨¡é«˜æ€§èƒ½å›¾åˆ†ææä¾›äº†ç®—æ³•å’Œæ„å»ºæ¨¡å—æ”¯æŒã€‚å…¸å‹çš„æ•°æ®åˆ†æåº”ç”¨å®ä¾‹ç”µä¿¡ç½‘ç»œè´¨é‡ç›‘æ§ç§»åŠ¨åº”ç”¨ä¸­çš„äº§å“æ›´æ–°åŠå®éªŒè¯„ä¼°åˆ†ææ¶ˆè´¹è€…æŠ€æœ¯ä¸­çš„å®æ—¶æ•°æ®å³å¸­åˆ†æå¤§è§„æ¨¡å›¾åˆ†ææ•°æ®ç®¡é“åº”ç”¨ä»€ä¹ˆæ˜¯æ•°æ®ç®¡é“ï¼Ÿæå–-è½¬æ¢-åŠ è½½ï¼ˆETLï¼‰æ˜¯ä¸€ç§åœ¨å­˜å‚¨ç³»ç»Ÿä¹‹é—´è¿›è¡Œæ•°æ®è½¬æ¢å’Œè¿ç§»çš„å¸¸ç”¨æ–¹æ³•ã€‚ETL ä½œä¸šé€šå¸¸ä¼šå‘¨æœŸæ€§åœ°è§¦å‘ï¼Œå°†æ•°æ®ä»äº‹åŠ¡å‹æ•°æ®åº“æ‹·è´åˆ°åˆ†æå‹æ•°æ®åº“æˆ–æ•°æ®ä»“åº“ã€‚æ•°æ®ç®¡é“å’Œ ETL ä½œä¸šçš„ç”¨é€”ç›¸ä¼¼ï¼Œéƒ½å¯ä»¥è½¬æ¢ã€ä¸°å¯Œæ•°æ®ï¼Œå¹¶å°†å…¶ä»æŸä¸ªå­˜å‚¨ç³»ç»Ÿç§»åŠ¨åˆ°å¦ä¸€ä¸ªã€‚ä½†æ•°æ®ç®¡é“æ˜¯ä»¥æŒç»­æµæ¨¡å¼è¿è¡Œï¼Œè€Œéå‘¨æœŸæ€§è§¦å‘ã€‚å› æ­¤å®ƒæ”¯æŒä»ä¸€ä¸ªä¸æ–­ç”Ÿæˆæ•°æ®çš„æºå¤´è¯»å–è®°å½•ï¼Œå¹¶å°†å®ƒä»¬ä»¥ä½å»¶è¿Ÿç§»åŠ¨åˆ°ç»ˆç‚¹ã€‚ä¾‹å¦‚ï¼šæ•°æ®ç®¡é“å¯ä»¥ç”¨æ¥ç›‘æ§æ–‡ä»¶ç³»ç»Ÿç›®å½•ä¸­çš„æ–°æ–‡ä»¶ï¼Œå¹¶å°†å…¶æ•°æ®å†™å…¥äº‹ä»¶æ—¥å¿—ï¼›å¦ä¸€ä¸ªåº”ç”¨å¯èƒ½ä¼šå°†äº‹ä»¶æµç‰©åŒ–åˆ°æ•°æ®åº“æˆ–å¢é‡æ„å»ºå’Œä¼˜åŒ–æŸ¥è¯¢ç´¢å¼•ã€‚ä¸‹å›¾æè¿°äº†å‘¨æœŸæ€§ ETL ä½œä¸šå’ŒæŒç»­æ•°æ®ç®¡é“çš„å·®å¼‚ã€‚æ•°æ®ç®¡é“çš„ä¼˜åŠ¿ï¼Ÿå’Œå‘¨æœŸæ€§ ETL ä½œä¸šç›¸æ¯”ï¼ŒæŒç»­æ•°æ®ç®¡é“å¯ä»¥æ˜æ˜¾é™ä½å°†æ•°æ®ç§»åŠ¨åˆ°ç›®çš„ç«¯çš„å»¶è¿Ÿã€‚æ­¤å¤–ï¼Œç”±äºå®ƒèƒ½å¤ŸæŒç»­æ¶ˆè´¹å’Œå‘é€æ•°æ®ï¼Œå› æ­¤ç”¨é€”æ›´å¹¿ï¼Œæ”¯æŒç”¨ä¾‹æ›´å¤šã€‚Flink å¦‚ä½•æ”¯æŒæ•°æ®ç®¡é“åº”ç”¨ï¼Ÿå¾ˆå¤šå¸¸è§çš„æ•°æ®è½¬æ¢å’Œå¢å¼ºæ“ä½œå¯ä»¥åˆ©ç”¨ Flink çš„ SQL æ¥å£ï¼ˆæˆ– Table APIï¼‰åŠç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°è§£å†³ã€‚å¦‚æœæ•°æ®ç®¡é“æœ‰æ›´é«˜çº§çš„éœ€æ±‚ï¼Œå¯ä»¥é€‰æ‹©æ›´é€šç”¨çš„ DataStream API æ¥å®ç°ã€‚Flink ä¸ºå¤šç§æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼ˆå¦‚ï¼šKafkaã€Kinesisã€Elasticsearchã€JDBCæ•°æ®åº“ç³»ç»Ÿç­‰ï¼‰å†…ç½®äº†è¿æ¥å™¨ã€‚åŒæ—¶å®ƒè¿˜æä¾›äº†æ–‡ä»¶ç³»ç»Ÿçš„è¿ç»­å‹æ•°æ®æºåŠæ•°æ®æ±‡ï¼Œå¯ç”¨æ¥ç›‘æ§ç›®å½•å˜åŒ–å’Œä»¥æ—¶é—´åˆ†åŒºçš„æ–¹å¼å†™å…¥æ–‡ä»¶ã€‚å…¸å‹çš„æ•°æ®ç®¡é“åº”ç”¨å®ä¾‹ç”µå­å•†åŠ¡ä¸­çš„å®æ—¶æŸ¥è¯¢ç´¢å¼•æ„å»ºç”µå­å•†åŠ¡ä¸­çš„æŒç»­ ETL","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Flink æ˜¯ä»€ä¹ˆï¼Ÿ","slug":"Flink-æ˜¯ä»€ä¹ˆï¼Ÿ","date":"2018-02-20T09:21:58.000Z","updated":"2020-05-10T13:06:33.408Z","comments":true,"path":"2018/02/20/Flink-æ˜¯ä»€ä¹ˆï¼Ÿ/","link":"","permalink":"cpeixin.cn/2018/02/20/Flink-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/","excerpt":"","text":"æ¶æ„Apache Flink æ˜¯ä¸€ä¸ªæ¡†æ¶å’Œåˆ†å¸ƒå¼å¤„ç†å¼•æ“ï¼Œç”¨äºåœ¨_æ— è¾¹ç•Œå’Œæœ‰è¾¹ç•Œ_æ•°æ®æµä¸Šè¿›è¡Œæœ‰çŠ¶æ€çš„è®¡ç®—ã€‚Flink èƒ½åœ¨æ‰€æœ‰å¸¸è§é›†ç¾¤ç¯å¢ƒä¸­è¿è¡Œï¼Œå¹¶èƒ½ä»¥å†…å­˜é€Ÿåº¦å’Œä»»æ„è§„æ¨¡è¿›è¡Œè®¡ç®—ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹ Flink æ¶æ„ä¸­çš„é‡è¦æ–¹é¢ã€‚å¤„ç†æ— ç•Œå’Œæœ‰ç•Œæ•°æ®ä»»ä½•ç±»å‹çš„æ•°æ®éƒ½å¯ä»¥å½¢æˆä¸€ç§äº‹ä»¶æµã€‚ä¿¡ç”¨å¡äº¤æ˜“ã€ä¼ æ„Ÿå™¨æµ‹é‡ã€æœºå™¨æ—¥å¿—ã€ç½‘ç«™æˆ–ç§»åŠ¨åº”ç”¨ç¨‹åºä¸Šçš„ç”¨æˆ·äº¤äº’è®°å½•ï¼Œæ‰€æœ‰è¿™äº›æ•°æ®éƒ½å½¢æˆä¸€ç§æµã€‚æ•°æ®å¯ä»¥è¢«ä½œä¸º æ— ç•Œ æˆ–è€… æœ‰ç•Œ æµæ¥å¤„ç†ã€‚æ— ç•Œæµ æœ‰å®šä¹‰æµçš„å¼€å§‹ï¼Œä½†æ²¡æœ‰å®šä¹‰æµçš„ç»“æŸã€‚å®ƒä»¬ä¼šæ— ä¼‘æ­¢åœ°äº§ç”Ÿæ•°æ®ã€‚æ— ç•Œæµçš„æ•°æ®å¿…é¡»æŒç»­å¤„ç†ï¼Œå³æ•°æ®è¢«æ‘„å–åéœ€è¦ç«‹åˆ»å¤„ç†ã€‚æˆ‘ä»¬ä¸èƒ½ç­‰åˆ°æ‰€æœ‰æ•°æ®éƒ½åˆ°è¾¾å†å¤„ç†ï¼Œå› ä¸ºè¾“å…¥æ˜¯æ— é™çš„ï¼Œåœ¨ä»»ä½•æ—¶å€™è¾“å…¥éƒ½ä¸ä¼šå®Œæˆã€‚å¤„ç†æ— ç•Œæ•°æ®é€šå¸¸è¦æ±‚ä»¥ç‰¹å®šé¡ºåºæ‘„å–äº‹ä»¶ï¼Œä¾‹å¦‚äº‹ä»¶å‘ç”Ÿçš„é¡ºåºï¼Œä»¥ä¾¿èƒ½å¤Ÿæ¨æ–­ç»“æœçš„å®Œæ•´æ€§ã€‚æœ‰ç•Œæµ æœ‰å®šä¹‰æµçš„å¼€å§‹ï¼Œä¹Ÿæœ‰å®šä¹‰æµçš„ç»“æŸã€‚æœ‰ç•Œæµå¯ä»¥åœ¨æ‘„å–æ‰€æœ‰æ•°æ®åå†è¿›è¡Œè®¡ç®—ã€‚æœ‰ç•Œæµæ‰€æœ‰æ•°æ®å¯ä»¥è¢«æ’åºï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦æœ‰åºæ‘„å–ã€‚æœ‰ç•Œæµå¤„ç†é€šå¸¸è¢«ç§°ä¸ºæ‰¹å¤„ç†Apache Flink æ“…é•¿å¤„ç†æ— ç•Œå’Œæœ‰ç•Œæ•°æ®é›† ç²¾ç¡®çš„æ—¶é—´æ§åˆ¶å’ŒçŠ¶æ€åŒ–ä½¿å¾— Flink çš„è¿è¡Œæ—¶(runtime)èƒ½å¤Ÿè¿è¡Œä»»ä½•å¤„ç†æ— ç•Œæµçš„åº”ç”¨ã€‚æœ‰ç•Œæµåˆ™ç”±ä¸€äº›ä¸“ä¸ºå›ºå®šå¤§å°æ•°æ®é›†ç‰¹æ®Šè®¾è®¡çš„ç®—æ³•å’Œæ•°æ®ç»“æ„è¿›è¡Œå†…éƒ¨å¤„ç†ï¼Œäº§ç”Ÿäº†å‡ºè‰²çš„æ€§èƒ½ã€‚éƒ¨ç½²åº”ç”¨åˆ°ä»»æ„åœ°æ–¹Apache Flink æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå®ƒéœ€è¦è®¡ç®—èµ„æºæ¥æ‰§è¡Œåº”ç”¨ç¨‹åºã€‚Flink é›†æˆäº†æ‰€æœ‰å¸¸è§çš„é›†ç¾¤èµ„æºç®¡ç†å™¨ï¼Œä¾‹å¦‚ Hadoop YARNã€ Apache Mesos å’Œ Kubernetesï¼Œä½†åŒæ—¶ä¹Ÿå¯ä»¥ä½œä¸ºç‹¬ç«‹é›†ç¾¤è¿è¡Œã€‚Flink è¢«è®¾è®¡ä¸ºèƒ½å¤Ÿå¾ˆå¥½åœ°å·¥ä½œåœ¨ä¸Šè¿°æ¯ä¸ªèµ„æºç®¡ç†å™¨ä¸­ï¼Œè¿™æ˜¯é€šè¿‡èµ„æºç®¡ç†å™¨ç‰¹å®š(resource-manager-specific)çš„éƒ¨ç½²æ¨¡å¼å®ç°çš„ã€‚Flink å¯ä»¥é‡‡ç”¨ä¸å½“å‰èµ„æºç®¡ç†å™¨ç›¸é€‚åº”çš„æ–¹å¼è¿›è¡Œäº¤äº’ã€‚éƒ¨ç½² Flink åº”ç”¨ç¨‹åºæ—¶ï¼ŒFlink ä¼šæ ¹æ®åº”ç”¨ç¨‹åºé…ç½®çš„å¹¶è¡Œæ€§è‡ªåŠ¨æ ‡è¯†æ‰€éœ€çš„èµ„æºï¼Œå¹¶ä»èµ„æºç®¡ç†å™¨è¯·æ±‚è¿™äº›èµ„æºã€‚åœ¨å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹ï¼ŒFlink é€šè¿‡è¯·æ±‚æ–°èµ„æºæ¥æ›¿æ¢å‘ç”Ÿæ•…éšœçš„å®¹å™¨ã€‚æäº¤æˆ–æ§åˆ¶åº”ç”¨ç¨‹åºçš„æ‰€æœ‰é€šä¿¡éƒ½æ˜¯é€šè¿‡ REST è°ƒç”¨è¿›è¡Œçš„ï¼Œè¿™å¯ä»¥ç®€åŒ– Flink ä¸å„ç§ç¯å¢ƒä¸­çš„é›†æˆã€‚è¿è¡Œä»»æ„è§„æ¨¡åº”ç”¨Flink æ—¨åœ¨ä»»æ„è§„æ¨¡ä¸Šè¿è¡Œæœ‰çŠ¶æ€æµå¼åº”ç”¨ã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºè¢«å¹¶è¡ŒåŒ–ä¸ºå¯èƒ½æ•°åƒä¸ªä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­å¹¶å‘æ‰§è¡Œã€‚æ‰€ä»¥åº”ç”¨ç¨‹åºèƒ½å¤Ÿå……åˆ†åˆ©ç”¨æ— å°½çš„ CPUã€å†…å­˜ã€ç£ç›˜å’Œç½‘ç»œ IOã€‚è€Œä¸” Flink å¾ˆå®¹æ˜“ç»´æŠ¤éå¸¸å¤§çš„åº”ç”¨ç¨‹åºçŠ¶æ€ã€‚å…¶å¼‚æ­¥å’Œå¢é‡çš„æ£€æŸ¥ç‚¹ç®—æ³•å¯¹å¤„ç†å»¶è¿Ÿäº§ç”Ÿæœ€å°çš„å½±å“ï¼ŒåŒæ—¶ä¿è¯ç²¾ç¡®ä¸€æ¬¡çŠ¶æ€çš„ä¸€è‡´æ€§ã€‚Flink ç”¨æˆ·æŠ¥å‘Šäº†å…¶ç”Ÿäº§ç¯å¢ƒä¸­ä¸€äº›ä»¤äººå°è±¡æ·±åˆ»çš„æ‰©å±•æ€§æ•°å­—å¤„ç†æ¯å¤©å¤„ç†æ•°ä¸‡äº¿çš„äº‹ä»¶,åº”ç”¨ç»´æŠ¤å‡ TBå¤§å°çš„çŠ¶æ€, å’Œåº”ç”¨åœ¨æ•°åƒä¸ªå†…æ ¸ä¸Šè¿è¡Œã€‚åˆ©ç”¨å†…å­˜æ€§èƒ½æœ‰çŠ¶æ€çš„ Flink ç¨‹åºé’ˆå¯¹æœ¬åœ°çŠ¶æ€è®¿é—®è¿›è¡Œäº†ä¼˜åŒ–ã€‚ä»»åŠ¡çš„çŠ¶æ€å§‹ç»ˆä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœçŠ¶æ€å¤§å°è¶…è¿‡å¯ç”¨å†…å­˜ï¼Œåˆ™ä¼šä¿å­˜åœ¨èƒ½é«˜æ•ˆè®¿é—®çš„ç£ç›˜æ•°æ®ç»“æ„ä¸­ã€‚ä»»åŠ¡é€šè¿‡è®¿é—®æœ¬åœ°ï¼ˆé€šå¸¸åœ¨å†…å­˜ä¸­ï¼‰çŠ¶æ€æ¥è¿›è¡Œæ‰€æœ‰çš„è®¡ç®—ï¼Œä»è€Œäº§ç”Ÿéå¸¸ä½çš„å¤„ç†å»¶è¿Ÿã€‚Flink é€šè¿‡å®šæœŸå’Œå¼‚æ­¥åœ°å¯¹æœ¬åœ°çŠ¶æ€è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨æ¥ä¿è¯æ•…éšœåœºæ™¯ä¸‹ç²¾ç¡®ä¸€æ¬¡çš„çŠ¶æ€ä¸€è‡´æ€§ã€‚åº”ç”¨Apache Flink æ˜¯ä¸€ä¸ªé’ˆå¯¹æ— ç•Œå’Œæœ‰ç•Œæ•°æ®æµè¿›è¡Œæœ‰çŠ¶æ€è®¡ç®—çš„æ¡†æ¶ã€‚Flink è‡ªåº•å‘ä¸Šåœ¨ä¸åŒçš„æŠ½è±¡çº§åˆ«æä¾›äº†å¤šç§ APIï¼Œå¹¶ä¸”é’ˆå¯¹å¸¸è§çš„ä½¿ç”¨åœºæ™¯å¼€å‘äº†ä¸“ç”¨çš„æ‰©å±•åº“ã€‚æµå¤„ç†åº”ç”¨çš„åŸºæœ¬ç»„ä»¶å¯ä»¥ç”±æµå¤„ç†æ¡†æ¶æ„å»ºå’Œæ‰§è¡Œçš„åº”ç”¨ç¨‹åºç±»å‹æ˜¯ç”±æ¡†æ¶å¯¹ æµã€çŠ¶æ€ã€æ—¶é—´ çš„æ”¯æŒç¨‹åº¦æ¥å†³å®šçš„ã€‚åœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å¯¹ä¸Šè¿°è¿™äº›æµå¤„ç†åº”ç”¨çš„åŸºæœ¬ç»„ä»¶é€ä¸€è¿›è¡Œæè¿°ï¼Œå¹¶å¯¹ Flink å¤„ç†å®ƒä»¬çš„æ–¹æ³•è¿›è¡Œç»†è‡´å‰–æã€‚**æµæ˜¾è€Œæ˜“è§ï¼Œï¼ˆæ•°æ®ï¼‰æµæ˜¯æµå¤„ç†çš„åŸºæœ¬è¦ç´ ã€‚ç„¶è€Œï¼Œæµä¹Ÿæ‹¥æœ‰ç€å¤šç§ç‰¹å¾ã€‚è¿™äº›ç‰¹å¾å†³å®šäº†æµå¦‚ä½•ä»¥åŠä½•æ—¶è¢«å¤„ç†ã€‚Flink æ˜¯ä¸€ä¸ªèƒ½å¤Ÿå¤„ç†ä»»ä½•ç±»å‹æ•°æ®æµçš„å¼ºå¤§å¤„ç†æ¡†æ¶ã€‚æœ‰ç•Œ å’Œ æ— ç•Œ çš„æ•°æ®æµï¼šæµå¯ä»¥æ˜¯æ— ç•Œçš„ï¼›ä¹Ÿå¯ä»¥æ˜¯æœ‰ç•Œçš„ï¼Œä¾‹å¦‚å›ºå®šå¤§å°çš„æ•°æ®é›†ã€‚Flink åœ¨æ— ç•Œçš„æ•°æ®æµå¤„ç†ä¸Šæ‹¥æœ‰è¯¸å¤šåŠŸèƒ½å¼ºå¤§çš„ç‰¹æ€§ï¼ŒåŒæ—¶ä¹Ÿé’ˆå¯¹æœ‰ç•Œçš„æ•°æ®æµå¼€å‘äº†ä¸“ç”¨çš„é«˜æ•ˆç®—å­ã€‚å®æ—¶ å’Œ å†å²è®°å½• çš„æ•°æ®æµï¼šæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯ä»¥æµçš„æ–¹å¼äº§ç”Ÿï¼Œä½†ç”¨æˆ·é€šå¸¸ä¼šä½¿ç”¨ä¸¤ç§æˆªç„¶ä¸åŒçš„æ–¹æ³•å¤„ç†æ•°æ®ã€‚æˆ–æ˜¯åœ¨æ•°æ®ç”Ÿæˆæ—¶è¿›è¡Œå®æ—¶çš„å¤„ç†ï¼›äº¦æˆ–æ˜¯å…ˆå°†æ•°æ®æµæŒä¹…åŒ–åˆ°å­˜å‚¨ç³»ç»Ÿä¸­â€”â€”ä¾‹å¦‚æ–‡ä»¶ç³»ç»Ÿæˆ–å¯¹è±¡å­˜å‚¨ï¼Œç„¶åå†è¿›è¡Œæ‰¹å¤„ç†ã€‚Flink çš„åº”ç”¨èƒ½å¤ŸåŒæ—¶æ”¯æŒå¤„ç†å®æ—¶ä»¥åŠå†å²è®°å½•æ•°æ®æµã€‚çŠ¶æ€åªæœ‰åœ¨æ¯ä¸€ä¸ªå•ç‹¬çš„äº‹ä»¶ä¸Šè¿›è¡Œè½¬æ¢æ“ä½œçš„åº”ç”¨æ‰ä¸éœ€è¦çŠ¶æ€ï¼Œæ¢è¨€ä¹‹ï¼Œæ¯ä¸€ä¸ªå…·æœ‰ä¸€å®šå¤æ‚åº¦çš„æµå¤„ç†åº”ç”¨éƒ½æ˜¯æœ‰çŠ¶æ€çš„ã€‚ä»»ä½•è¿è¡ŒåŸºæœ¬ä¸šåŠ¡é€»è¾‘çš„æµå¤„ç†åº”ç”¨éƒ½éœ€è¦åœ¨ä¸€å®šæ—¶é—´å†…å­˜å‚¨æ‰€æ¥æ”¶çš„äº‹ä»¶æˆ–ä¸­é—´ç»“æœï¼Œä»¥ä¾›åç»­çš„æŸä¸ªæ—¶é—´ç‚¹ï¼ˆä¾‹å¦‚æ”¶åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶æˆ–è€…ç»è¿‡ä¸€æ®µç‰¹å®šæ—¶é—´ï¼‰è¿›è¡Œè®¿é—®å¹¶è¿›è¡Œåç»­å¤„ç†ã€‚åº”ç”¨çŠ¶æ€æ˜¯ Flink ä¸­çš„ä¸€ç­‰å…¬æ°‘ï¼ŒFlink æä¾›äº†è®¸å¤šçŠ¶æ€ç®¡ç†ç›¸å…³çš„ç‰¹æ€§æ”¯æŒï¼Œå…¶ä¸­åŒ…æ‹¬ï¼šå¤šç§çŠ¶æ€åŸºç¡€ç±»å‹ï¼šFlink ä¸ºå¤šç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›äº†ç›¸å¯¹åº”çš„çŠ¶æ€åŸºç¡€ç±»å‹ï¼Œä¾‹å¦‚åŸå­å€¼ï¼ˆvalueï¼‰ï¼Œåˆ—è¡¨ï¼ˆlistï¼‰ä»¥åŠæ˜ å°„ï¼ˆmapï¼‰ã€‚å¼€å‘è€…å¯ä»¥åŸºäºå¤„ç†å‡½æ•°å¯¹çŠ¶æ€çš„è®¿é—®æ–¹å¼ï¼Œé€‰æ‹©æœ€é«˜æ•ˆã€æœ€é€‚åˆçš„çŠ¶æ€åŸºç¡€ç±»å‹ã€‚æ’ä»¶åŒ–çš„State Backendï¼šState Backend è´Ÿè´£ç®¡ç†åº”ç”¨ç¨‹åºçŠ¶æ€ï¼Œå¹¶åœ¨éœ€è¦çš„æ—¶å€™è¿›è¡Œ checkpointã€‚Flink æ”¯æŒå¤šç§ state backendï¼Œå¯ä»¥å°†çŠ¶æ€å­˜åœ¨å†…å­˜æˆ–è€… RocksDBã€‚RocksDB æ˜¯ä¸€ç§é«˜æ•ˆçš„åµŒå…¥å¼ã€æŒä¹…åŒ–é”®å€¼å­˜å‚¨å¼•æ“ã€‚Flink ä¹Ÿæ”¯æŒæ’ä»¶å¼çš„è‡ªå®šä¹‰ state backend è¿›è¡ŒçŠ¶æ€å­˜å‚¨ã€‚ç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰ï¼šFlink çš„ checkpoint å’Œæ•…éšœæ¢å¤ç®—æ³•ä¿è¯äº†æ•…éšœå‘ç”Ÿååº”ç”¨çŠ¶æ€çš„ä¸€è‡´æ€§ã€‚å› æ­¤ï¼ŒFlink èƒ½å¤Ÿåœ¨åº”ç”¨ç¨‹åºå‘ç”Ÿæ•…éšœæ—¶ï¼Œå¯¹åº”ç”¨ç¨‹åºé€æ˜ï¼Œä¸é€ æˆæ­£ç¡®æ€§çš„å½±å“ã€‚è¶…å¤§æ•°æ®é‡çŠ¶æ€ï¼šFlink èƒ½å¤Ÿåˆ©ç”¨å…¶å¼‚æ­¥ä»¥åŠå¢é‡å¼çš„ checkpoint ç®—æ³•ï¼Œå­˜å‚¨æ•° TB çº§åˆ«çš„åº”ç”¨çŠ¶æ€ã€‚å¯å¼¹æ€§ä¼¸ç¼©çš„åº”ç”¨ï¼šFlink èƒ½å¤Ÿé€šè¿‡åœ¨æ›´å¤šæˆ–æ›´å°‘çš„å·¥ä½œèŠ‚ç‚¹ä¸Šå¯¹çŠ¶æ€è¿›è¡Œé‡æ–°åˆ†å¸ƒï¼Œæ”¯æŒæœ‰çŠ¶æ€åº”ç”¨çš„åˆ†å¸ƒå¼çš„æ¨ªå‘ä¼¸ç¼©ã€‚æ—¶é—´æ—¶é—´æ˜¯æµå¤„ç†åº”ç”¨å¦ä¸€ä¸ªé‡è¦çš„ç»„æˆéƒ¨åˆ†ã€‚å› ä¸ºäº‹ä»¶æ€»æ˜¯åœ¨ç‰¹å®šæ—¶é—´ç‚¹å‘ç”Ÿï¼Œæ‰€ä»¥å¤§å¤šæ•°çš„äº‹ä»¶æµéƒ½æ‹¥æœ‰äº‹ä»¶æœ¬èº«æ‰€å›ºæœ‰çš„æ—¶é—´è¯­ä¹‰ã€‚è¿›ä¸€æ­¥è€Œè¨€ï¼Œè®¸å¤šå¸¸è§çš„æµè®¡ç®—éƒ½åŸºäºæ—¶é—´è¯­ä¹‰ï¼Œä¾‹å¦‚çª—å£èšåˆã€ä¼šè¯è®¡ç®—ã€æ¨¡å¼æ£€æµ‹å’ŒåŸºäºæ—¶é—´çš„ joinã€‚æµå¤„ç†çš„ä¸€ä¸ªé‡è¦æ–¹é¢æ˜¯åº”ç”¨ç¨‹åºå¦‚ä½•è¡¡é‡æ—¶é—´ï¼Œå³åŒºåˆ†äº‹ä»¶æ—¶é—´ï¼ˆevent-timeï¼‰å’Œå¤„ç†æ—¶é—´ï¼ˆprocessing-timeï¼‰ã€‚Flink æä¾›äº†ä¸°å¯Œçš„æ—¶é—´è¯­ä¹‰æ”¯æŒã€‚äº‹ä»¶æ—¶é—´æ¨¡å¼ï¼šä½¿ç”¨äº‹ä»¶æ—¶é—´è¯­ä¹‰çš„æµå¤„ç†åº”ç”¨æ ¹æ®äº‹ä»¶æœ¬èº«è‡ªå¸¦çš„æ—¶é—´æˆ³è¿›è¡Œç»“æœçš„è®¡ç®—ã€‚å› æ­¤ï¼Œæ— è®ºå¤„ç†çš„æ˜¯å†å²è®°å½•çš„äº‹ä»¶è¿˜æ˜¯å®æ—¶çš„äº‹ä»¶ï¼Œäº‹ä»¶æ—¶é—´æ¨¡å¼çš„å¤„ç†æ€»èƒ½ä¿è¯ç»“æœçš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚Watermark æ”¯æŒï¼šFlink å¼•å…¥äº† watermark çš„æ¦‚å¿µï¼Œç”¨ä»¥è¡¡é‡äº‹ä»¶æ—¶é—´è¿›å±•ã€‚Watermark ä¹Ÿæ˜¯ä¸€ç§å¹³è¡¡å¤„ç†å»¶æ—¶å’Œå®Œæ•´æ€§çš„çµæ´»æœºåˆ¶ã€‚è¿Ÿåˆ°æ•°æ®å¤„ç†ï¼šå½“ä»¥å¸¦æœ‰ watermark çš„äº‹ä»¶æ—¶é—´æ¨¡å¼å¤„ç†æ•°æ®æµæ—¶ï¼Œåœ¨è®¡ç®—å®Œæˆä¹‹åä»ä¼šæœ‰ç›¸å…³æ•°æ®åˆ°è¾¾ã€‚è¿™æ ·çš„äº‹ä»¶è¢«ç§°ä¸ºè¿Ÿåˆ°äº‹ä»¶ã€‚Flink æä¾›äº†å¤šç§å¤„ç†è¿Ÿåˆ°æ•°æ®çš„é€‰é¡¹ï¼Œä¾‹å¦‚å°†è¿™äº›æ•°æ®é‡å®šå‘åˆ°æ—è·¯è¾“å‡ºï¼ˆside outputï¼‰æˆ–è€…æ›´æ–°ä¹‹å‰å®Œæˆè®¡ç®—çš„ç»“æœã€‚å¤„ç†æ—¶é—´æ¨¡å¼ï¼šé™¤äº†äº‹ä»¶æ—¶é—´æ¨¡å¼ï¼ŒFlink è¿˜æ”¯æŒå¤„ç†æ—¶é—´è¯­ä¹‰ã€‚å¤„ç†æ—¶é—´æ¨¡å¼æ ¹æ®å¤„ç†å¼•æ“çš„æœºå™¨æ—¶é’Ÿè§¦å‘è®¡ç®—ï¼Œä¸€èˆ¬é€‚ç”¨äºæœ‰ç€ä¸¥æ ¼çš„ä½å»¶è¿Ÿéœ€æ±‚ï¼Œå¹¶ä¸”èƒ½å¤Ÿå®¹å¿è¿‘ä¼¼ç»“æœçš„æµå¤„ç†åº”ç”¨ã€‚åˆ†å±‚ APIFlink æ ¹æ®æŠ½è±¡ç¨‹åº¦åˆ†å±‚ï¼Œæä¾›äº†ä¸‰ç§ä¸åŒçš„ APIã€‚æ¯ä¸€ç§ API åœ¨ç®€æ´æ€§å’Œè¡¨è¾¾åŠ›ä¸Šæœ‰ç€ä¸åŒçš„ä¾§é‡ï¼Œå¹¶ä¸”é’ˆå¯¹ä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ç®€è¦æè¿°æ¯ä¸€ç§ API åŠå…¶åº”ç”¨ï¼Œå¹¶æä¾›ç›¸å…³çš„ä»£ç ç¤ºä¾‹ã€‚ProcessFunctionProcessFunction æ˜¯ Flink æ‰€æä¾›çš„æœ€å…·è¡¨è¾¾åŠ›çš„æ¥å£ã€‚ProcessFunction å¯ä»¥å¤„ç†ä¸€æˆ–ä¸¤æ¡è¾“å…¥æ•°æ®æµä¸­çš„å•ä¸ªäº‹ä»¶æˆ–è€…å½’å…¥ä¸€ä¸ªç‰¹å®šçª—å£å†…çš„å¤šä¸ªäº‹ä»¶ã€‚å®ƒæä¾›äº†å¯¹äºæ—¶é—´å’ŒçŠ¶æ€çš„ç»†ç²’åº¦æ§åˆ¶ã€‚å¼€å‘è€…å¯ä»¥åœ¨å…¶ä¸­ä»»æ„åœ°ä¿®æ”¹çŠ¶æ€ï¼Œä¹Ÿèƒ½å¤Ÿæ³¨å†Œå®šæ—¶å™¨ç”¨ä»¥åœ¨æœªæ¥çš„æŸä¸€æ—¶åˆ»è§¦å‘å›è°ƒå‡½æ•°ã€‚å› æ­¤ï¼Œä½ å¯ä»¥åˆ©ç”¨ ProcessFunction å®ç°è®¸å¤šæœ‰çŠ¶æ€çš„äº‹ä»¶é©±åŠ¨åº”ç”¨æ‰€éœ€è¦çš„åŸºäºå•ä¸ªäº‹ä»¶çš„å¤æ‚ä¸šåŠ¡é€»è¾‘ã€‚ä¸‹é¢çš„ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨ KeyedStream ä¸Šåˆ©ç”¨ KeyedProcessFunction å¯¹æ ‡è®°ä¸º START å’Œ END çš„äº‹ä»¶è¿›è¡Œå¤„ç†ã€‚å½“æ”¶åˆ° START äº‹ä»¶æ—¶ï¼Œå¤„ç†å‡½æ•°ä¼šè®°å½•å…¶æ—¶é—´æˆ³ï¼Œå¹¶ä¸”æ³¨å†Œä¸€ä¸ªæ—¶é•¿4å°æ—¶çš„è®¡æ—¶å™¨ã€‚å¦‚æœåœ¨è®¡æ—¶å™¨ç»“æŸä¹‹å‰æ”¶åˆ° END äº‹ä»¶ï¼Œå¤„ç†å‡½æ•°ä¼šè®¡ç®—å…¶ä¸ä¸Šä¸€ä¸ª START äº‹ä»¶çš„æ—¶é—´é—´éš”ï¼Œæ¸…ç©ºçŠ¶æ€å¹¶å°†è®¡ç®—ç»“æœè¿”å›ã€‚å¦åˆ™ï¼Œè®¡æ—¶å™¨ç»“æŸï¼Œå¹¶æ¸…ç©ºçŠ¶æ€ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** * å°†ç›¸é‚»çš„ keyed START å’Œ END äº‹ä»¶ç›¸åŒ¹é…å¹¶è®¡ç®—ä¸¤è€…çš„æ—¶é—´é—´éš” * è¾“å…¥æ•°æ®ä¸º Tuple2&lt;String, String&gt; ç±»å‹ï¼Œç¬¬ä¸€ä¸ªå­—æ®µä¸º key å€¼ï¼Œ * ç¬¬äºŒä¸ªå­—æ®µæ ‡è®° START å’Œ END äº‹ä»¶ã€‚ */public static class StartEndDuration extends KeyedProcessFunction&lt;String, Tuple2&lt;String, String&gt;, Tuple2&lt;String, Long&gt;&gt; &#123; private ValueState&lt;Long&gt; startTime; @Override public void open(Configuration conf) &#123; // obtain state handle startTime = getRuntimeContext() .getState(new ValueStateDescriptor&lt;Long&gt;(\"startTime\", Long.class)); &#125; /** Called for each processed event. */ @Override public void processElement( Tuple2&lt;String, String&gt; in, Context ctx, Collector&lt;Tuple2&lt;String, Long&gt;&gt; out) throws Exception &#123; switch (in.f1) &#123; case \"START\": // set the start time if we receive a start event. startTime.update(ctx.timestamp()); // register a timer in four hours from the start event. ctx.timerService() .registerEventTimeTimer(ctx.timestamp() + 4 * 60 * 60 * 1000); break; case \"END\": // emit the duration between start and end event Long sTime = startTime.value(); if (sTime != null) &#123; out.collect(Tuple2.of(in.f0, ctx.timestamp() - sTime)); // clear the state startTime.clear(); &#125; default: // do nothing &#125; &#125; /** Called when a timer fires. */ @Override public void onTimer( long timestamp, OnTimerContext ctx, Collector&lt;Tuple2&lt;String, Long&gt;&gt; out) &#123; // Timeout interval exceeded. Cleaning up the state. startTime.clear(); &#125;&#125;è¿™ä¸ªä¾‹å­å……åˆ†å±•ç°äº† KeyedProcessFunction å¼ºå¤§çš„è¡¨è¾¾åŠ›ï¼Œä¹Ÿå› æ­¤æ˜¯ä¸€ä¸ªå®ç°ç›¸å½“å¤æ‚çš„æ¥å£ã€‚DataStream APIDataStream API ä¸ºè®¸å¤šé€šç”¨çš„æµå¤„ç†æ“ä½œæä¾›äº†å¤„ç†åŸè¯­ã€‚è¿™äº›æ“ä½œåŒ…æ‹¬çª—å£ã€é€æ¡è®°å½•çš„è½¬æ¢æ“ä½œï¼Œåœ¨å¤„ç†äº‹ä»¶æ—¶è¿›è¡Œå¤–éƒ¨æ•°æ®åº“æŸ¥è¯¢ç­‰ã€‚DataStream API æ”¯æŒ Java å’Œ Scala è¯­è¨€ï¼Œé¢„å…ˆå®šä¹‰äº†ä¾‹å¦‚map()ã€reduce()ã€aggregate() ç­‰å‡½æ•°ã€‚ä½ å¯ä»¥é€šè¿‡æ‰©å±•å®ç°é¢„å®šä¹‰æ¥å£æˆ–ä½¿ç”¨ Javaã€Scala çš„ lambda è¡¨è¾¾å¼å®ç°è‡ªå®šä¹‰çš„å‡½æ•°ã€‚ä¸‹é¢çš„ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æ•è·ä¼šè¯æ—¶é—´èŒƒå›´å†…æ‰€æœ‰çš„ç‚¹å‡»æµäº‹ä»¶ï¼Œå¹¶å¯¹æ¯ä¸€æ¬¡ä¼šè¯çš„ç‚¹å‡»é‡è¿›è¡Œè®¡æ•°ã€‚123456789101112131415161718// ç½‘ç«™ç‚¹å‡» Click çš„æ•°æ®æµDataStream&lt;Click&gt; clicks = ...DataStream&lt;Tuple2&lt;String, Long&gt;&gt; result = clicks // å°†ç½‘ç«™ç‚¹å‡»æ˜ å°„ä¸º (userId, 1) ä»¥ä¾¿è®¡æ•° .map( // å®ç° MapFunction æ¥å£å®šä¹‰å‡½æ•° new MapFunction&lt;Click, Tuple2&lt;String, Long&gt;&gt;() &#123; @Override public Tuple2&lt;String, Long&gt; map(Click click) &#123; return Tuple2.of(click.userId, 1L); &#125; &#125;) // ä»¥ userId (field 0) ä½œä¸º key .keyBy(0) // å®šä¹‰ 30 åˆ†é’Ÿè¶…æ—¶çš„ä¼šè¯çª—å£ .window(EventTimeSessionWindows.withGap(Time.minutes(30L))) // å¯¹æ¯ä¸ªä¼šè¯çª—å£çš„ç‚¹å‡»è¿›è¡Œè®¡æ•°ï¼Œä½¿ç”¨ lambda è¡¨è¾¾å¼å®šä¹‰ reduce å‡½æ•° .reduce((a, b) -&gt; Tuple2.of(a.f0, a.f1 + b.f1));SQL &amp; Table APIFlink æ”¯æŒä¸¤ç§å…³ç³»å‹çš„ APIï¼ŒTable API å’Œ SQLã€‚è¿™ä¸¤ä¸ª API éƒ½æ˜¯æ‰¹å¤„ç†å’Œæµå¤„ç†ç»Ÿä¸€çš„ APIï¼Œè¿™æ„å‘³ç€åœ¨æ— è¾¹ç•Œçš„å®æ—¶æ•°æ®æµå’Œæœ‰è¾¹ç•Œçš„å†å²è®°å½•æ•°æ®æµä¸Šï¼Œå…³ç³»å‹ API ä¼šä»¥ç›¸åŒçš„è¯­ä¹‰æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¹¶äº§ç”Ÿç›¸åŒçš„ç»“æœã€‚Table API å’Œ SQL å€ŸåŠ©äº† Apache Calcite æ¥è¿›è¡ŒæŸ¥è¯¢çš„è§£æï¼Œæ ¡éªŒä»¥åŠä¼˜åŒ–ã€‚å®ƒä»¬å¯ä»¥ä¸ DataStream å’Œ DataSet API æ— ç¼é›†æˆï¼Œå¹¶æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰çš„æ ‡é‡å‡½æ•°ï¼Œèšåˆå‡½æ•°ä»¥åŠè¡¨å€¼å‡½æ•°ã€‚Flink çš„å…³ç³»å‹ API æ—¨åœ¨ç®€åŒ–æ•°æ®åˆ†æã€æ•°æ®æµæ°´çº¿å’Œ ETL åº”ç”¨çš„å®šä¹‰ã€‚ä¸‹é¢çš„ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ SQL è¯­å¥æŸ¥è¯¢æ•è·ä¼šè¯æ—¶é—´èŒƒå›´å†…æ‰€æœ‰çš„ç‚¹å‡»æµäº‹ä»¶ï¼Œå¹¶å¯¹æ¯ä¸€æ¬¡ä¼šè¯çš„ç‚¹å‡»é‡è¿›è¡Œè®¡æ•°ã€‚æ­¤ç¤ºä¾‹ä¸ä¸Šè¿° DataStream API ä¸­çš„ç¤ºä¾‹æœ‰ç€ç›¸åŒçš„é€»è¾‘ã€‚123SELECT userId, COUNT(*)FROM clicksGROUP BY SESSION(clicktime, INTERVAL &#39;30&#39; MINUTE), userIdåº“Flink å…·æœ‰æ•°ä¸ªé€‚ç”¨äºå¸¸è§æ•°æ®å¤„ç†åº”ç”¨åœºæ™¯çš„æ‰©å±•åº“ã€‚è¿™äº›åº“é€šå¸¸åµŒå…¥åœ¨ API ä¸­ï¼Œä¸”å¹¶ä¸å®Œå…¨ç‹¬ç«‹äºå…¶å®ƒ APIã€‚å®ƒä»¬ä¹Ÿå› æ­¤å¯ä»¥å—ç›Šäº API çš„æ‰€æœ‰ç‰¹æ€§ï¼Œå¹¶ä¸å…¶ä»–åº“é›†æˆã€‚å¤æ‚äº‹ä»¶å¤„ç†(CEP)ï¼šæ¨¡å¼æ£€æµ‹æ˜¯äº‹ä»¶æµå¤„ç†ä¸­çš„ä¸€ä¸ªéå¸¸å¸¸è§çš„ç”¨ä¾‹ã€‚Flink çš„ CEP åº“æä¾›äº† APIï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿä»¥ä¾‹å¦‚æ­£åˆ™è¡¨è¾¾å¼æˆ–çŠ¶æ€æœºçš„æ–¹å¼æŒ‡å®šäº‹ä»¶æ¨¡å¼ã€‚CEP åº“ä¸ Flink çš„ DataStream API é›†æˆï¼Œä»¥ä¾¿åœ¨ DataStream ä¸Šè¯„ä¼°æ¨¡å¼ã€‚CEP åº“çš„åº”ç”¨åŒ…æ‹¬ç½‘ç»œå…¥ä¾µæ£€æµ‹ï¼Œä¸šåŠ¡æµç¨‹ç›‘æ§å’Œæ¬ºè¯ˆæ£€æµ‹ã€‚DataSet APIï¼šDataSet API æ˜¯ Flink ç”¨äºæ‰¹å¤„ç†åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒ APIã€‚DataSet API æ‰€æä¾›çš„åŸºç¡€ç®—å­åŒ…æ‹¬map_ã€_reduce_ã€(outer) join_ã€_co-group_ã€_iterate_ç­‰ã€‚æ‰€æœ‰ç®—å­éƒ½æœ‰ç›¸åº”çš„ç®—æ³•å’Œæ•°æ®ç»“æ„æ”¯æŒï¼Œå¯¹å†…å­˜ä¸­çš„åºåˆ—åŒ–æ•°æ®è¿›è¡Œæ“ä½œã€‚å¦‚æœæ•°æ®å¤§å°è¶…è¿‡é¢„ç•™å†…å­˜ï¼Œåˆ™è¿‡é‡æ•°æ®å°†å­˜å‚¨åˆ°ç£ç›˜ã€‚Flink çš„ DataSet API çš„æ•°æ®å¤„ç†ç®—æ³•å€Ÿé‰´äº†ä¼ ç»Ÿæ•°æ®åº“ç®—æ³•çš„å®ç°ï¼Œä¾‹å¦‚æ··åˆæ•£åˆ—è¿æ¥ï¼ˆhybrid hash-joinï¼‰å’Œå¤–éƒ¨å½’å¹¶æ’åºï¼ˆexternal merge-sortï¼‰ã€‚Gelly: Gelly æ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„å›¾å½¢å¤„ç†å’Œåˆ†æåº“ã€‚Gelly æ˜¯åœ¨ DataSet API ä¹‹ä¸Šå®ç°çš„ï¼Œå¹¶ä¸ DataSet API é›†æˆã€‚å› æ­¤ï¼Œå®ƒèƒ½å¤Ÿå—ç›Šäºå…¶å¯æ‰©å±•ä¸”å¥å£®çš„æ“ä½œç¬¦ã€‚Gelly æä¾›äº†å†…ç½®ç®—æ³•ï¼Œå¦‚ label propagationã€triangle enumeration å’Œ page rank ç®—æ³•ï¼Œä¹Ÿæä¾›äº†ä¸€ä¸ªç®€åŒ–è‡ªå®šä¹‰å›¾ç®—æ³•å®ç°çš„ Graph APIã€‚è¿ç»´Apache Flink æ˜¯ä¸€ä¸ªé’ˆå¯¹æ— ç•Œå’Œæœ‰ç•Œæ•°æ®æµè¿›è¡Œæœ‰çŠ¶æ€è®¡ç®—çš„æ¡†æ¶ã€‚ç”±äºè®¸å¤šæµåº”ç”¨ç¨‹åºæ—¨åœ¨ä»¥æœ€çŸ­çš„åœæœºæ—¶é—´è¿ç»­è¿è¡Œï¼Œå› æ­¤æµå¤„ç†å™¨å¿…é¡»æä¾›å‡ºè‰²çš„æ•…éšœæ¢å¤èƒ½åŠ›ï¼Œä»¥åŠåœ¨åº”ç”¨ç¨‹åºè¿è¡ŒæœŸé—´è¿›è¡Œç›‘æ§å’Œç»´æŠ¤çš„å·¥å…·ã€‚Apache Flink éå¸¸æ³¨é‡æµæ•°æ®å¤„ç†çš„å¯è¿ç»´æ€§ã€‚å› æ­¤åœ¨è¿™ä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç» Flink çš„æ•…éšœæ¢å¤æœºåˆ¶ï¼Œå¹¶ä»‹ç»å…¶ç®¡ç†å’Œç›‘æ§åº”ç”¨çš„åŠŸèƒ½ã€‚7 * 24å°æ—¶ç¨³å®šè¿è¡Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡æ•…éšœæ˜¯å¸¸æœ‰çš„äº‹ï¼Œä¸ºäº†ä¿è¯æœåŠ¡èƒ½å¤Ÿ7*24å°æ—¶ç¨³å®šè¿è¡Œï¼ŒåƒFlinkè¿™æ ·çš„æµå¤„ç†å™¨æ•…éšœæ¢å¤æœºåˆ¶æ˜¯å¿…é¡»è¦æœ‰çš„ã€‚æ˜¾ç„¶è¿™å°±æ„å‘³ç€ï¼Œå®ƒ(è¿™ç±»æµå¤„ç†å™¨)ä¸ä»…è¦èƒ½åœ¨æœåŠ¡å‡ºç°æ•…éšœæ—¶å€™èƒ½å¤Ÿé‡å¯æœåŠ¡ï¼Œè€Œä¸”è¿˜è¦å½“æ•…éšœå‘ç”Ÿæ—¶ï¼Œä¿è¯èƒ½å¤ŸæŒä¹…åŒ–æœåŠ¡å†…éƒ¨å„ä¸ªç»„ä»¶çš„å½“å‰çŠ¶æ€ï¼Œåªæœ‰è¿™æ ·æ‰èƒ½ä¿è¯åœ¨æ•…éšœæ¢å¤æ—¶å€™ï¼ŒæœåŠ¡èƒ½å¤Ÿç»§ç»­æ­£å¸¸è¿è¡Œï¼Œå¥½åƒæ•…éšœå°±æ²¡æœ‰å‘ç”Ÿè¿‡ä¸€æ ·ã€‚Flinké€šè¿‡å‡ ä¸‹å¤šç§æœºåˆ¶ç»´æŠ¤åº”ç”¨å¯æŒç»­è¿è¡ŒåŠå…¶ä¸€è‡´æ€§:æ£€æŸ¥ç‚¹çš„ä¸€è‡´æ€§: Flinkçš„æ•…éšœæ¢å¤æœºåˆ¶æ˜¯é€šè¿‡å»ºç«‹åˆ†å¸ƒå¼åº”ç”¨æœåŠ¡çŠ¶æ€ä¸€è‡´æ€§æ£€æŸ¥ç‚¹å®ç°çš„ï¼Œå½“æœ‰æ•…éšœäº§ç”Ÿæ—¶ï¼Œåº”ç”¨æœåŠ¡ä¼šé‡å¯åï¼Œå†é‡æ–°åŠ è½½ä¸Šä¸€æ¬¡æˆåŠŸå¤‡ä»½çš„çŠ¶æ€æ£€æŸ¥ç‚¹ä¿¡æ¯ã€‚ç»“åˆå¯é‡æ”¾çš„æ•°æ®æºï¼Œè¯¥ç‰¹æ€§å¯ä¿è¯_ç²¾ç¡®ä¸€æ¬¡ï¼ˆexactly-onceï¼‰_çš„çŠ¶æ€ä¸€è‡´æ€§ã€‚é«˜æ•ˆçš„æ£€æŸ¥ç‚¹: å¦‚æœä¸€ä¸ªåº”ç”¨è¦ç»´æŠ¤ä¸€ä¸ªTBçº§çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¯¹æ­¤åº”ç”¨çš„çŠ¶æ€å»ºç«‹æ£€æŸ¥ç‚¹æœåŠ¡çš„èµ„æºå¼€é”€æ˜¯å¾ˆé«˜çš„ï¼Œä¸ºäº†å‡å°å› æ£€æŸ¥ç‚¹æœåŠ¡å¯¹åº”ç”¨çš„å»¶è¿Ÿæ€§ï¼ˆSLAsæœåŠ¡ç­‰çº§åè®®ï¼‰çš„å½±å“ï¼ŒFlinké‡‡ç”¨å¼‚æ­¥åŠå¢é‡çš„æ–¹å¼æ„å»ºæ£€æŸ¥ç‚¹æœåŠ¡ã€‚ç«¯åˆ°ç«¯çš„ç²¾ç¡®ä¸€æ¬¡: Flink ä¸ºæŸäº›ç‰¹å®šçš„å­˜å‚¨æ”¯æŒäº†äº‹åŠ¡å‹è¾“å‡ºçš„åŠŸèƒ½ï¼ŒåŠæ—¶åœ¨å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½å¤Ÿä¿è¯ç²¾ç¡®ä¸€æ¬¡çš„è¾“å‡ºã€‚é›†æˆå¤šç§é›†ç¾¤ç®¡ç†æœåŠ¡: Flinkå·²ä¸å¤šç§é›†ç¾¤ç®¡ç†æœåŠ¡ç´§å¯†é›†æˆï¼Œå¦‚ Hadoop YARN, Mesos, ä»¥åŠ Kubernetesã€‚å½“é›†ç¾¤ä¸­æŸä¸ªæµç¨‹ä»»åŠ¡å¤±è´¥åï¼Œä¸€ä¸ªæ–°çš„æµç¨‹æœåŠ¡ä¼šè‡ªåŠ¨å¯åŠ¨å¹¶æ›¿ä»£å®ƒç»§ç»­æ‰§è¡Œã€‚å†…ç½®é«˜å¯ç”¨æœåŠ¡: Flinkå†…ç½®äº†ä¸ºè§£å†³å•ç‚¹æ•…éšœé—®é¢˜çš„é«˜å¯ç”¨æ€§æœåŠ¡æ¨¡å—ï¼Œæ­¤æ¨¡å—æ˜¯åŸºäºApache ZooKeeper æŠ€æœ¯å®ç°çš„ï¼ŒApache ZooKeeperæ˜¯ä¸€ç§å¯é çš„ã€äº¤äº’å¼çš„ã€åˆ†å¸ƒå¼åè°ƒæœåŠ¡ç»„ä»¶ã€‚Flinkèƒ½å¤Ÿæ›´æ–¹ä¾¿åœ°å‡çº§ã€è¿ç§»ã€æš‚åœã€æ¢å¤åº”ç”¨æœåŠ¡é©±åŠ¨å…³é”®ä¸šåŠ¡æœåŠ¡çš„æµåº”ç”¨æ˜¯ç»å¸¸éœ€è¦ç»´æŠ¤çš„ã€‚æ¯”å¦‚éœ€è¦ä¿®å¤ç³»ç»Ÿæ¼æ´ï¼Œæ”¹è¿›åŠŸèƒ½ï¼Œæˆ–å¼€å‘æ–°åŠŸèƒ½ã€‚ç„¶è€Œå‡çº§ä¸€ä¸ªæœ‰çŠ¶æ€çš„æµåº”ç”¨å¹¶ä¸æ˜¯ç®€å•çš„äº‹æƒ…ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬ä¸ºäº†å‡çº§ä¸€ä¸ªæ”¹è¿›åç‰ˆæœ¬è€Œç®€å•åœæ­¢å½“å‰æµåº”ç”¨å¹¶é‡å¯æ—¶ï¼Œæˆ‘ä»¬è¿˜ä¸èƒ½ä¸¢å¤±æ‰å½“å‰æµåº”ç”¨çš„æ‰€å¤„äºçš„çŠ¶æ€ä¿¡æ¯ã€‚è€ŒFlinkçš„ Savepoint æœåŠ¡å°±æ˜¯ä¸ºè§£å†³å‡çº§æœåŠ¡è¿‡ç¨‹ä¸­è®°å½•æµåº”ç”¨çŠ¶æ€ä¿¡æ¯åŠå…¶ç›¸å…³éš¾é¢˜è€Œäº§ç”Ÿçš„ä¸€ç§å”¯ä¸€çš„ã€å¼ºå¤§çš„ç»„ä»¶ã€‚ä¸€ä¸ª Savepointï¼Œå°±æ˜¯ä¸€ä¸ªåº”ç”¨æœåŠ¡çŠ¶æ€çš„ä¸€è‡´æ€§å¿«ç…§ï¼Œå› æ­¤å…¶ä¸checkpointç»„ä»¶çš„å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯ä¸checkpointç›¸æ¯”ï¼ŒSavepoint éœ€è¦æ‰‹åŠ¨è§¦å‘å¯åŠ¨ï¼Œè€Œä¸”å½“æµåº”ç”¨æœåŠ¡åœæ­¢æ—¶ï¼Œå®ƒå¹¶ä¸ä¼šè‡ªåŠ¨åˆ é™¤ã€‚Savepoint å¸¸è¢«åº”ç”¨äºå¯åŠ¨ä¸€ä¸ªå·²å«æœ‰çŠ¶æ€çš„æµæœåŠ¡ï¼Œå¹¶åˆå§‹åŒ–å…¶ï¼ˆå¤‡ä»½æ—¶ï¼‰çŠ¶æ€ã€‚Savepoint æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼šä¾¿äºå‡çº§åº”ç”¨æœåŠ¡ç‰ˆæœ¬: Savepoint å¸¸åœ¨åº”ç”¨ç‰ˆæœ¬å‡çº§æ—¶ä½¿ç”¨ï¼Œå½“å‰åº”ç”¨çš„æ–°ç‰ˆæœ¬æ›´æ–°å‡çº§æ—¶ï¼Œå¯ä»¥æ ¹æ®ä¸Šä¸€ä¸ªç‰ˆæœ¬ç¨‹åºè®°å½•çš„ Savepoint å†…çš„æœåŠ¡çŠ¶æ€ä¿¡æ¯æ¥é‡å¯æœåŠ¡ã€‚å®ƒä¹Ÿå¯èƒ½ä¼šä½¿ç”¨æ›´æ—©çš„ Savepoint è¿˜åŸç‚¹æ¥é‡å¯æœåŠ¡ï¼Œä»¥ä¾¿äºä¿®å¤ç”±äºæœ‰ç¼ºé™·çš„ç¨‹åºç‰ˆæœ¬å¯¼è‡´çš„ä¸æ­£ç¡®çš„ç¨‹åºè¿è¡Œç»“æœã€‚æ–¹ä¾¿é›†ç¾¤æœåŠ¡ç§»æ¤: é€šè¿‡ä½¿ç”¨ Savepointï¼ŒæµæœåŠ¡åº”ç”¨å¯ä»¥è‡ªç”±çš„åœ¨ä¸åŒé›†ç¾¤ä¸­è¿ç§»éƒ¨ç½²ã€‚æ–¹ä¾¿Flinkç‰ˆæœ¬å‡çº§: é€šè¿‡ä½¿ç”¨ Savepointï¼Œå¯ä»¥ä½¿åº”ç”¨æœåŠ¡åœ¨å‡çº§Flinkæ—¶ï¼Œæ›´åŠ å®‰å…¨ä¾¿æ·ã€‚å¢åŠ åº”ç”¨å¹¶è¡ŒæœåŠ¡çš„æ‰©å±•æ€§: Savepoint ä¹Ÿå¸¸åœ¨å¢åŠ æˆ–å‡å°‘åº”ç”¨æœåŠ¡é›†ç¾¤çš„å¹¶è¡Œåº¦æ—¶ä½¿ç”¨ã€‚ä¾¿äºA/Bæµ‹è¯•åŠå‡è®¾åˆ†æåœºæ™¯å¯¹æ¯”ç»“æœ: é€šè¿‡æŠŠåŒä¸€åº”ç”¨åœ¨ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºï¼ŒåŸºäºåŒä¸€ä¸ª Savepoint è¿˜åŸç‚¹å¯åŠ¨æœåŠ¡æ—¶ï¼Œå¯ä»¥æµ‹è¯•å¯¹æ¯”2ä¸ªæˆ–å¤šä¸ªç‰ˆæœ¬ç¨‹åºçš„æ€§èƒ½åŠæœåŠ¡è´¨é‡ã€‚æš‚åœå’Œæ¢å¤æœåŠ¡: ä¸€ä¸ªåº”ç”¨æœåŠ¡å¯ä»¥åœ¨æ–°å»ºä¸€ä¸ª Savepoint åå†åœæ­¢æœåŠ¡ï¼Œä»¥ä¾¿äºåé¢ä»»ä½•æ—¶é—´ç‚¹å†æ ¹æ®è¿™ä¸ªå®æ—¶åˆ·æ–°çš„ Savepoint è¿˜åŸç‚¹è¿›è¡Œæ¢å¤æœåŠ¡ã€‚å½’æ¡£æœåŠ¡: Savepoint è¿˜æä¾›è¿˜åŸç‚¹çš„å½’æ¡£æœåŠ¡ï¼Œä»¥ä¾¿äºç”¨æˆ·èƒ½å¤ŸæŒ‡å®šæ—¶é—´ç‚¹çš„ Savepoint çš„æœåŠ¡æ•°æ®è¿›è¡Œé‡ç½®åº”ç”¨æœåŠ¡çš„çŠ¶æ€ï¼Œè¿›è¡Œæ¢å¤æœåŠ¡ã€‚ç›‘æ§å’Œæ§åˆ¶åº”ç”¨æœåŠ¡å¦‚å…¶å®ƒåº”ç”¨æœåŠ¡ä¸€æ ·ï¼ŒæŒç»­è¿è¡Œçš„æµåº”ç”¨æœåŠ¡ä¹Ÿéœ€è¦ç›‘æ§åŠé›†æˆåˆ°ä¸€äº›åŸºç¡€è®¾æ–½èµ„æºç®¡ç†æœåŠ¡ä¸­ï¼Œä¾‹å¦‚ä¸€ä¸ªç»„ä»¶çš„ç›‘æ§æœåŠ¡åŠæ—¥å¿—æœåŠ¡ç­‰ã€‚ç›‘æ§æœåŠ¡æœ‰åŠ©äºé¢„æµ‹é—®é¢˜å¹¶æå‰åšå‡ºååº”ï¼Œæ—¥å¿—æœåŠ¡æä¾›æ—¥å¿—è®°å½•èƒ½å¤Ÿå¸®åŠ©è¿½è¸ªã€è°ƒæŸ¥ã€åˆ†ææ•…éšœå‘ç”Ÿçš„æ ¹æœ¬åŸå› ã€‚æœ€åï¼Œä¾¿æ·æ˜“ç”¨çš„è®¿é—®æ§åˆ¶åº”ç”¨æœåŠ¡è¿è¡Œçš„æ¥å£ä¹Ÿæ˜¯Flinkçš„ä¸€ä¸ªé‡è¦çš„äº®ç‚¹ç‰¹å¾ã€‚Flinkä¸è®¸å¤šå¸¸è§çš„æ—¥å¿—è®°å½•å’Œç›‘è§†æœåŠ¡é›†æˆå¾—å¾ˆå¥½ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªREST APIæ¥æ§åˆ¶åº”ç”¨æœåŠ¡å’ŒæŸ¥è¯¢åº”ç”¨ä¿¡æ¯ã€‚å…·ä½“è¡¨ç°å¦‚ä¸‹ï¼šWeb UIæ–¹å¼: Flinkæä¾›äº†ä¸€ä¸ªweb UIæ¥è§‚å¯Ÿã€ç›‘è§†å’Œè°ƒè¯•æ­£åœ¨è¿è¡Œçš„åº”ç”¨æœåŠ¡ã€‚å¹¶ä¸”è¿˜å¯ä»¥æ‰§è¡Œæˆ–å–æ¶ˆç»„ä»¶æˆ–ä»»åŠ¡çš„æ‰§è¡Œã€‚æ—¥å¿—é›†æˆæœåŠ¡:Flinkå®ç°äº†æµè¡Œçš„slf4jæ—¥å¿—æ¥å£ï¼Œå¹¶ä¸æ—¥å¿—æ¡†æ¶log4jæˆ–logbacké›†æˆã€‚æŒ‡æ ‡æœåŠ¡: Flinkæä¾›äº†ä¸€ä¸ªå¤æ‚çš„åº¦é‡ç³»ç»Ÿæ¥æ”¶é›†å’ŒæŠ¥å‘Šç³»ç»Ÿå’Œç”¨æˆ·å®šä¹‰çš„åº¦é‡æŒ‡æ ‡ä¿¡æ¯ã€‚åº¦é‡ä¿¡æ¯å¯ä»¥å¯¼å‡ºåˆ°å¤šä¸ªæŠ¥è¡¨ç»„ä»¶æœåŠ¡ï¼ŒåŒ…æ‹¬ JMX, Ganglia, Graphite, Prometheus, StatsD, Datadog, å’Œ Slf4j.æ ‡å‡†çš„WEB REST APIæ¥å£æœåŠ¡: Flinkæä¾›å¤šç§REST APIæ¥å£ï¼Œæœ‰æäº¤æ–°åº”ç”¨ç¨‹åºã€è·å–æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºçš„SavepointæœåŠ¡ä¿¡æ¯ã€å–æ¶ˆåº”ç”¨æœåŠ¡ç­‰æ¥å£ã€‚REST APIè¿˜æä¾›å…ƒæ•°æ®ä¿¡æ¯å’Œå·²é‡‡é›†çš„è¿è¡Œä¸­æˆ–å®Œæˆåçš„åº”ç”¨æœåŠ¡çš„æŒ‡æ ‡ä¿¡æ¯ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"}]},{"title":"Docker three elements","slug":"Docker-three-elements","date":"2018-01-02T13:01:05.000Z","updated":"2020-04-04T12:00:32.855Z","comments":true,"path":"2018/01/02/Docker-three-elements/","link":"","permalink":"cpeixin.cn/2018/01/02/Docker-three-elements/","excerpt":"","text":"whatbuild, ship and run any app anywhereDocker is designed to avoid a series of problems caused by inconsistencies between development and production environments during the process of program delivery and deployment between development engineers and operations engineers. Through docker, the development engineer packages the program code, running system, software version, description document and so on in a image file, and passes the image file to the operation and maintenance engineer for deployment. For example, if you buy a fish tank with water in it from a pet store, the fish can live in your home without any other operation.At present, there is no need to discuss the struggle between docker and virtual machine, because major Internet companies are using docker technology, and can expand capacity in a short time, we can know that in the current high concurrency business scenario, from practicality and convenience, virtual machine is unable to defeat docker.Simply, dockerâ€™s centos image is only 200MB, while the virtual machine image is about 2GB. Docker makes use of the resources of the host and only copies the Linux kernel, and docker is no need Hypervisor ,which can be said to be a stripped-down version of the virtual machinesoftware architectureFocus on understanding the three elementsHowDocker has many commands, which are not complicated. Just like Linux commands, it is recommended to find them on the official website and practice them a lotdocker imagesdocker run [options]docker build [options]and so on â€¦Docker imagebase on UnionFSimage = fs1 + fs2 + â€¦ + fnIt looks like an image is a file system, but itâ€™s actually an image thatâ€™s made up of layers of file systemsAn available image file is made up of multiple base image layers superimposed, all read-onlyFor example,Tomcat image = kernel image + centos image + jdk image + tomcat imageDocker containerdocker container = docker run -it imageWhen docker image is launched, a docker container will be instantiated. In principle, a layer of writable files is added to the top layer of multiple read-only docker images superimposed together, thus generating the running docker containerDocker volumes is very important and you can check the official website for detailed usageDockerfileDockerfile is similar to a key/value configuration file, which is composed of the construction word in the following figure. Starting From â€˜Fromâ€™, other construction words are listed according to requirements to tell the Dockerfile what to do and what image to generate.Note the difference between CMD and ENTRYPOINT build wordsDockerfile Docker image Docker containerï¼Œ So what is the relationship between these threeDockerfileâ€“&gt;(build)â€“&gt;Docker imageâ€“&gt;(run)â€“&gt;Docker containerDocker RegistryA Repository is a place to store images. Like Nodeâ€™s NPM; Python PyPi. Currently, Docker officially maintains a public repository, and most of the requirements can be implemented by directly downloading the image from the Docker Hub. Similar to GitHub, in the process of making image or Dockerfile, we draw the base image, i.e. From [base image], From the public library.","categories":[{"name":"Docker","slug":"Docker","permalink":"cpeixin.cn/categories/Docker/"}],"tags":[{"name":"docker","slug":"docker","permalink":"cpeixin.cn/tags/docker/"}]},{"title":"Docker install and first Dockerfile","slug":"Docker-install-and-first-Dockerfile","date":"2018-01-01T12:00:05.000Z","updated":"2020-04-04T12:00:27.785Z","comments":true,"path":"2018/01/01/Docker-install-and-first-Dockerfile/","link":"","permalink":"cpeixin.cn/2018/01/01/Docker-install-and-first-Dockerfile/","excerpt":"","text":"prefaceThis article only explains the installation of Docker and the creation of Dockerfile. Dockerfile is composed of different commands in different requirements, which can be understood as a configuration file. However, only a demo is shown here to show the basic usage of DockerServer environmentlinux centos 7.6installstep 1If you have installed an older version of docker, you need to uninstall it first12345678910sudo yum remove docker \\ docker-client \\ docker-client-latest \\ docker-common \\ docker-latest \\ docker-latest-logrotate \\ docker-logrotate \\ docker-selinux \\ docker-engine-selinux \\ docker-enginestep 2install dependencies123sudo yum install -y yum-utils \\ device-mapper-persistent-data \\ lvm2step 3set stable Repository123sudo yum-config-manager \\ --add-repo \\ https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repostep 4install docker1sudo yum install docker-ce docker-ce-cli containerd.iostep 5start docker service1sudo systemctl start dockerstep 6Run a demo to see if the installation was successful: The hello-world image is not in your local, but when you run the command, docker will pulls the helloworld image from the remote repository1sudo docker run hello-worldcreate a demostep 1create dockerfileChoose any directory and create a dockerfile.It is suggested to name â€˜Dockerfileâ€™, because by default docker will run the file called â€˜Dockerfileâ€™ in the current directory. If you give it a different name, add the -f parameter and the path of the dockerfile12345678vim DockerfileFROM nginxMAINTAINER author &lt;email&gt;RUN echo &#39;&lt;h1&gt;Hello, Docker!&lt;&#x2F;h1&gt;&#39; &gt; &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;index.html:wqstep 2build image1docker build -t test&#x2F;hello-world: .-t is to set the repository and imagetest is repository namehello-world as the image namestep 3run image1docker run --name hello -d -p 8080:80 test&#x2F;hellostep 4Browser input http://localhost:8080/finalThis is a simple example of using Dockerfile to build the image and run the container!","categories":[{"name":"Docker","slug":"Docker","permalink":"cpeixin.cn/categories/Docker/"}],"tags":[{"name":"docker","slug":"docker","permalink":"cpeixin.cn/tags/docker/"}]},{"title":"Spark DataFrame withColumn","slug":"Spark-DataFrame-withColumn","date":"2017-10-03T05:53:39.000Z","updated":"2020-06-14T05:58:24.744Z","comments":true,"path":"2017/10/03/Spark-DataFrame-withColumn/","link":"","permalink":"cpeixin.cn/2017/10/03/Spark-DataFrame-withColumn/","excerpt":"","text":"Spark withColumn()å‡½æ•°ç”¨äºé‡å‘½åï¼Œæ›´æ”¹å€¼ï¼Œè½¬æ¢ç°æœ‰DataFrameåˆ—çš„æ•°æ®ç±»å‹ï¼Œè¿˜å¯ä»¥ç”¨äºåˆ›å»ºæ–°åˆ—ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†é€šè¿‡Scalaå’ŒPysparkç¤ºä¾‹å‘æ‚¨ä»‹ç»å¸¸ç”¨çš„DataFrameåˆ—æ“ä½œã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¦ä½¿ç”¨çš„DataFrameã€‚123456789101112131415val data = Seq(Row(Row(\"James \",\"\",\"Smith\"),\"36636\",\"M\",\"3000\"), Row(Row(\"Michael \",\"Rose\",\"\"),\"40288\",\"M\",\"4000\"), Row(Row(\"Robert \",\"\",\"Williams\"),\"42114\",\"M\",\"4000\"), Row(Row(\"Maria \",\"Anne\",\"Jones\"),\"39192\",\"F\",\"4000\"), Row(Row(\"Jen\",\"Mary\",\"Brown\"),\"\",\"F\",\"-1\"))val schema = new StructType() .add(\"name\",new StructType() .add(\"firstname\",StringType) .add(\"middlename\",StringType) .add(\"lastname\",StringType)) .add(\"dob\",StringType) .add(\"gender\",StringType) .add(\"salary\",StringType)val df = spark.createDataFrame(spark.sparkContext.parallelize(data),schema)Spark withColumn â€“æ›´æ”¹åˆ—çš„æ•°æ®ç±»å‹é€šè¿‡åœ¨DataFrameä¸Šä½¿ç”¨Spark withColumnå¹¶åœ¨åˆ—ä¸Šä½¿ç”¨å¼ºåˆ¶è½¬æ¢åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ”¹DataFrameåˆ—çš„æ•°æ®ç±»å‹ã€‚ä¸‹é¢çš„è¯­å¥å°†â€œå·¥èµ„â€åˆ—çš„æ•°æ®ç±»å‹ä»å­—ç¬¦ä¸²æ›´æ”¹ä¸ºæ•´æ•°ã€‚1df.withColumn(\"salary\",col(\"salary\").cast(\"Integer\"))æ›´æ”¹ç°æœ‰åˆ—çš„å€¼withColumn() å‡½æ•°ä¹Ÿå¯ä»¥ç”¨äºæ›´æ–°ç°æœ‰åˆ—çš„å€¼ã€‚ä¸ºäº†æ›´æ”¹å€¼ï¼Œå°†ç°æœ‰çš„åˆ—åä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ï¼Œå°†å€¼åˆ†é…ä¸ºç¬¬äºŒä¸ªåˆ—ã€‚è¯·æ³¨æ„ï¼Œç¬¬äºŒä¸ªå‚æ•°åº”ä¸ºColumntypeã€‚1df.withColumn(\"salary\",col(\"salary\")*100)æ­¤ä»£ç æ®µå°†â€œ salaryâ€çš„å€¼ä¹˜ä»¥100ï¼Œå¹¶å°†å…¶å€¼æ›´æ–°å›â€œ salaryâ€åˆ—ã€‚ä»ç°æœ‰åˆ—æ´¾ç”Ÿæ–°åˆ—è¦åˆ›å»ºæ–°åˆ—ï¼Œè¯·ä½¿ç”¨æ‚¨å¸Œæœ›æ–°åˆ—ä½¿ç”¨çš„åç§°æŒ‡å®šç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¹¶é€šè¿‡å¯¹ç°æœ‰åˆ—è¿›è¡Œæ“ä½œæ¥ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°æ¥åˆ†é…å€¼ã€‚1df.withColumn(\"CopiedColumn\",col(\"salary\")* -1)æ­¤ä»£ç æ®µé€šè¿‡å°†â€œå·¥èµ„â€åˆ—ä¹˜ä»¥å€¼-1æ¥åˆ›å»ºæ–°åˆ—â€œ CopiedColumnâ€ã€‚å¦‚æœæ´¾ç”Ÿå‡ºæ¥çš„åˆ—éœ€è¦å¤æ‚çš„è®¡ç®—ï¼Œåˆ™å¯ä»¥ä½¿ç”¨udfæ¥è¿›è¡Œè½¬æ¢12345678910111213141516// åˆ©ç”¨withColumnæ–¹æ³•ï¼Œæ–°å¢åˆ—çš„è¿‡ç¨‹åŒ…å«åœ¨udfå‡½æ•°ä¸­val to_date_udf: (Long =&gt; String) = (timestamps: Long) =&gt; &#123; var sdf: SimpleDateFormat = new SimpleDateFormat(\"yyyy-MM-dd\") var date: String = sdf.format(new Date(timestamps*1000L)) date&#125;val timestamps_2_date: UserDefinedFunction = udf(to_date_udf)val user_behavior_dataframe: DataFrame = spark.read.format(\"csv\") .option(\"header\", \"false\") // æ–‡ä»¶ä¸­çš„ç¬¬ä¸€è¡Œæ˜¯å¦ä¸ºåˆ—çš„åç§° .option(\"mode\", \"FAILFAST\") // æ˜¯å¦å¿«é€Ÿå¤±è´¥ .option(\"inferSchema\", \"true\") // æ˜¯å¦è‡ªåŠ¨æ¨æ–­ schema .schema(user_behavior_Schema) .load(\"/Users/cpeixin/IdeaProjects/code_warehouse/data/UserBehavior_5000.csv\") .withColumn(\"date\", timestamps_2_date(col(\"timestamps\")))æ·»åŠ ä¸€ä¸ªæ–°åˆ—è¦åˆ›å»ºæ–°åˆ—ï¼Œè¯·å°†æ‰€éœ€çš„åˆ—åä¼ é€’ç»™withColumn()è½¬æ¢å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ç¡®ä¿æ­¤æ–°åˆ—å°šæœªå‡ºç°åœ¨DataFrameä¸Šï¼ˆå¦‚æœæ˜¾ç¤ºçš„è¯ï¼‰ä¼šæ›´æ–°è¯¥åˆ—çš„å€¼ã€‚åœ¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œlitï¼ˆï¼‰å‡½æ•°ç”¨äºå°†å¸¸é‡å€¼æ·»åŠ åˆ°DataFrameåˆ—ã€‚æˆ‘ä»¬è¿˜å¯ä»¥é“¾æ¥ä»¥æ·»åŠ å¤šä¸ªåˆ—ã€‚1234df.withColumn(\"Country\", lit(\"USA\"))//chaining to operate on multiple columnsdf.withColumn(\"Country\", lit(\"USA\")) .withColumn(\"anotherColumn\",lit(\"anotherValue\"))é‡å‘½åDataFrameåˆ—åè¦é‡å‘½åç°æœ‰åˆ—ï¼Œè¯·åœ¨DataFrameä¸Šä½¿ç”¨â€œ withColumnRenamed â€åŠŸèƒ½ã€‚1df.withColumnRenamed(\"gender\",\"sex\")ä»Spark DataFrameåˆ é™¤ä¸€åˆ—ä½¿ç”¨â€œæ”¾ç½®â€åŠŸèƒ½ä»æ•°æ®æ¡†ä¸­æ”¾ç½®ç‰¹å®šçš„åˆ—ã€‚1df.drop(\"CopiedColumn\")å°†åˆ—æ‹†åˆ†ä¸ºå¤šåˆ—å°½ç®¡æ­¤ç¤ºä¾‹æœªä½¿ç”¨withColumn()å‡½æ•°ï¼Œä½†æˆ‘ä»ç„¶è§‰å¾—ç”¨map()è½¬æ¢å‡½æ•°å°†ä¸€ä¸ªDataFrameåˆ—æ‹†åˆ†ä¸ºå¤šä¸ªåˆ—è¿˜æ˜¯å¾ˆå¥½çš„è§£é‡Šã€‚123456789101112131415import spark.implicits._val columns = Seq(\"name\",\"address\")val data = Seq((\"Robert, Smith\", \"1 Main st, Newark, NJ, 92537\"), (\"Maria, Garcia\",\"3456 Walnut st, Newark, NJ, 94732\"))var dfFromData = spark.createDataFrame(data).toDF(columns:_*)dfFromData.printSchema()val newDF = dfFromData.map(f=&gt;&#123;val nameSplit = f.getAs[String](0).split(\",\")val addSplit = f.getAs[String](1).split(\",\") (nameSplit(0),nameSplit(1),addSplit(0),addSplit(1),addSplit(2),addSplit(3)) &#125;)val finalDF = newDF.toDF(\"First Name\",\"Last Name\", \"Address Line1\",\"City\",\"State\",\"zipCode\")finalDF.printSchema()finalDF.show(false)æ­¤ä»£ç æ®µå°†â€œåç§°â€åˆ—æ‹†åˆ†ä¸ºâ€œåå­—â€ï¼Œâ€œå§“æ°â€ï¼Œå¹¶å°†â€œåœ°å€â€åˆ—æ‹†åˆ†ä¸ºâ€œåœ°å€è¡Œ1â€ï¼Œâ€œåŸå¸‚â€ï¼Œâ€œå·â€å’Œâ€œé‚®æ”¿ç¼–ç â€ã€‚äº§é‡ä½äºäº§å‡ºï¼š12345678910111213root |-- First Name: string (nullable &#x3D; true) |-- Last Name: string (nullable &#x3D; true) |-- Address Line1: string (nullable &#x3D; true) |-- City: string (nullable &#x3D; true) |-- State: string (nullable &#x3D; true) |-- zipCode: string (nullable &#x3D; true)+----------+---------+--------------+-------+-----+-------+|First Name|Last Name|Address Line1 |City |State|zipCode|+----------+---------+--------------+-------+-----+-------+|Robert | Smith |1 Main st | Newark| NJ | 92537 ||Maria | Garcia |3456 Walnut st| Newark| NJ | 94732 |+----------+---------+--------------+-------+-----+-------+æ³¨æ„ï¼šè¯·æ³¨æ„ï¼Œæ‰€æœ‰è¿™äº›å‡½æ•°åœ¨åº”ç”¨å‡½æ•°åéƒ½å°†è¿”å›æ–°çš„DataFrameï¼Œè€Œä¸æ˜¯æ›´æ–°DataFrameã€‚Spark withColumnå®Œæ•´ç¤ºä¾‹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970package com.sparkbyexamples.spark.dataframeimport org.apache.spark.sql.&#123;Row, SparkSession&#125;import org.apache.spark.sql.types.&#123;ArrayType, IntegerType, MapType, StringType, StructType&#125;import org.apache.spark.sql.functions._object WithColumn &#123; def main(args:Array[String]):Unit= &#123; val spark: SparkSession = SparkSession.builder() .master(\"local[1]\") .appName(\"SparkByExamples.com\") .getOrCreate() val arrayStructureData = Seq( Row(Row(\"James \",\"\",\"Smith\"),\"1\",\"M\",3100,List(\"Cricket\",\"Movies\"),Map(\"hair\"-&gt;\"black\",\"eye\"-&gt;\"brown\")), Row(Row(\"Michael \",\"Rose\",\"\"),\"2\",\"M\",3100,List(\"Tennis\"),Map(\"hair\"-&gt;\"brown\",\"eye\"-&gt;\"black\")), Row(Row(\"Robert \",\"\",\"Williams\"),\"3\",\"M\",3100,List(\"Cooking\",\"Football\"),Map(\"hair\"-&gt;\"red\",\"eye\"-&gt;\"gray\")), Row(Row(\"Maria \",\"Anne\",\"Jones\"),\"4\",\"M\",3100,null,Map(\"hair\"-&gt;\"blond\",\"eye\"-&gt;\"red\")), Row(Row(\"Jen\",\"Mary\",\"Brown\"),\"5\",\"M\",3100,List(\"Blogging\"),Map(\"white\"-&gt;\"black\",\"eye\"-&gt;\"black\")) ) val arrayStructureSchema = new StructType() .add(\"name\",new StructType() .add(\"firstname\",StringType) .add(\"middlename\",StringType) .add(\"lastname\",StringType)) .add(\"id\",StringType) .add(\"gender\",StringType) .add(\"salary\",IntegerType) .add(\"Hobbies\", ArrayType(StringType)) .add(\"properties\", MapType(StringType,StringType)) val df2 = spark.createDataFrame( spark.sparkContext.parallelize(arrayStructureData),arrayStructureSchema) //Change the column data type df2.withColumn(\"salary\",df2(\"salary\").cast(\"Integer\")) //Derive a new column from existing val df4=df2.withColumn(\"CopiedColumn\",df2(\"salary\")* -1) //Transforming existing column val df5 = df2.withColumn(\"salary\",df2(\"salary\")*100) //You can also chain withColumn to change multiple columns //Renaming a column. val df3=df2.withColumnRenamed(\"gender\",\"sex\") df3.printSchema() //Droping a column val df6=df4.drop(\"CopiedColumn\") println(df6.columns.contains(\"CopiedColumn\")) //Adding a literal value df2.withColumn(\"Country\", lit(\"USA\")).printSchema() //Retrieving df2.show(false) df2.select(\"name\").show(false) df2.select(\"name.firstname\").show(false) df2.select(\"name.*\").show(false) val df8 = df2.select(col(\"*\"),explode(col(\"hobbies\"))) df8.show(false) //Splitting one column to multiple columns import spark.implicits._ val columns = Seq(\"name\",\"address\") val data = Seq((\"Robert, Smith\", \"1 Main st, Newark, NJ, 92537\"), (\"Maria, Garcia\",\"3456 Walnut st, Newark, NJ, 94732\")) var dfFromData = spark.createDataFrame(data).toDF(columns:_*) dfFromData.printSchema() val newDF = dfFromData.map(f=&gt;&#123; val nameSplit = f.getAs[String](0).split(\",\") val addSplit = f.getAs[String](1).split(\",\") (nameSplit(0),nameSplit(1),addSplit(0),addSplit(1),addSplit(2),addSplit(3)) &#125;) val finalDF = newDF.toDF(\"First Name\",\"Last Name\", \"Address Line1\",\"City\",\"State\",\"zipCode\") finalDF.printSchema() finalDF.show(false) &#125;&#125;","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"HBaseå›¾è§£","slug":"HBaseå›¾è§£","date":"2017-08-09T17:33:43.000Z","updated":"2020-07-20T01:56:01.413Z","comments":true,"path":"2017/08/10/HBaseå›¾è§£/","link":"","permalink":"cpeixin.cn/2017/08/10/HBase%E5%9B%BE%E8%A7%A3/","excerpt":"","text":"","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"HBase","slug":"HBase","permalink":"cpeixin.cn/tags/HBase/"}]},{"title":"HashMap æ€»ç»“","slug":"HashMap-æ€»ç»“","date":"2017-08-07T13:29:53.000Z","updated":"2020-08-07T13:30:58.302Z","comments":true,"path":"2017/08/07/HashMap-æ€»ç»“/","link":"","permalink":"cpeixin.cn/2017/08/07/HashMap-%E6%80%BB%E7%BB%93/","excerpt":"","text":"ç®€ä»‹HashMapï¼šå®ƒæ ¹æ®é”®çš„hashCodeå€¼å­˜å‚¨æ•°æ®ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ç›´æ¥å®šä½åˆ°å®ƒçš„å€¼ï¼Œå› è€Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œä½†éå†é¡ºåºå´æ˜¯ä¸ç¡®å®šçš„ã€‚HashMapæœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºHashMapéçº¿ç¨‹å®‰å…¨ï¼Œå³ä»»ä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™HashMapConcurrentHashMap: æ»¡è¶³çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ç”¨ Collectionsçš„synchronizedMapæ–¹æ³•ä½¿HashMapå…·æœ‰çº¿ç¨‹å®‰å…¨çš„èƒ½åŠ›ï¼Œæˆ–è€…ä½¿ç”¨ConcurrentHashMapã€‚LinkedHashMapï¼šLinkedHashMapæ˜¯HashMapçš„ä¸€ä¸ªå­ç±»ï¼Œä¿å­˜äº†è®°å½•çš„æ’å…¥é¡ºåºï¼Œåœ¨ç”¨Iteratoréå†LinkedHashMapæ—¶ï¼Œå…ˆå¾—åˆ°çš„è®°å½•è‚¯å®šæ˜¯å…ˆæ’å…¥çš„ï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ æ—¶å¸¦å‚æ•°ï¼ŒæŒ‰ç…§è®¿é—®æ¬¡åºæ’åºã€‚LinkedHashMap æ˜¯é€šè¿‡åŒå‘é“¾è¡¨å’Œæ•£åˆ—è¡¨è¿™ä¸¤ç§æ•°æ®ç»“æ„ç»„åˆå®ç°çš„ã€‚LinkedHashMap ä¸­çš„â€œLinkedâ€å®é™…ä¸Šæ˜¯æŒ‡çš„æ˜¯åŒå‘é“¾è¡¨ï¼Œå¹¶éæŒ‡ç”¨é“¾è¡¨æ³•è§£å†³æ•£åˆ—å†²çªã€‚TreeMapï¼šTreeMapå®ç°SortedMapæ¥å£ï¼Œèƒ½å¤ŸæŠŠå®ƒä¿å­˜çš„è®°å½•æ ¹æ®é”®æ’åºï¼Œé»˜è®¤æ˜¯æŒ‰é”®å€¼çš„å‡åºæ’åºï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ’åºçš„æ¯”è¾ƒå™¨ï¼Œå½“ç”¨Iteratoréå†TreeMapæ—¶ï¼Œå¾—åˆ°çš„è®°å½•æ˜¯æ’è¿‡åºçš„ã€‚å¦‚æœä½¿ç”¨æ’åºçš„æ˜ å°„ï¼Œå»ºè®®ä½¿ç”¨TreeMapã€‚åœ¨ä½¿ç”¨TreeMapæ—¶ï¼Œkeyå¿…é¡»å®ç°Comparableæ¥å£æˆ–è€…åœ¨æ„é€ TreeMapä¼ å…¥è‡ªå®šä¹‰çš„Comparatorï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºjava.lang.ClassCastExceptionç±»å‹çš„å¼‚å¸¸ã€‚åº•å±‚ç»„æˆç»“æ„ç»“æ„HashMapæ˜¯æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼ŒHashMapç±»ä¸­æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„å­—æ®µï¼Œå°±æ˜¯ Node[] tableï¼Œå³å“ˆå¸Œæ¡¶æ•°ç»„ï¼Œæ˜æ˜¾å®ƒæ˜¯ä¸€ä¸ªNodeçš„æ•°ç»„Node(int hash, K key, V value, Node&lt;K,V&gt; next) å­˜å‚¨ç€hash //ç”¨æ¥å®šä½æ•°ç»„ç´¢å¼•ä½ç½®keyvalueNode&lt;K,V&gt; next //é“¾è¡¨çš„ä¸‹ä¸€ä¸ªnodeé»˜è®¤åˆå§‹å‚æ•°ä»HashMapçš„é»˜è®¤æ„é€ å‡½æ•°æºç å¯çŸ¥ï¼Œæ„é€ å‡½æ•°å°±æ˜¯å¯¹ä¸‹é¢å‡ ä¸ªå­—æ®µè¿›è¡Œåˆå§‹åŒ–int threshold; // æ‰€èƒ½å®¹çº³çš„key-valueå¯¹æé™final float loadFactor; // è´Ÿè½½å› å­int modCount;int size;Node[] tableçš„åˆå§‹åŒ–é•¿åº¦length(é»˜è®¤å€¼æ˜¯16)ï¼ŒLoad factorä¸ºè´Ÿè½½å› å­(é»˜è®¤å€¼æ˜¯0.75)thresholdæ˜¯HashMapæ‰€èƒ½å®¹çº³çš„æœ€å¤§æ•°æ®é‡çš„Node(é”®å€¼å¯¹)ä¸ªæ•°ã€‚threshold = length * Load factorã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ•°ç»„å®šä¹‰å¥½é•¿åº¦ä¹‹åï¼Œè´Ÿè½½å› å­è¶Šå¤§ï¼Œæ‰€èƒ½å®¹çº³çš„é”®å€¼å¯¹ä¸ªæ•°è¶Šå¤šã€‚thresholdå°±æ˜¯åœ¨æ­¤Load factorå’Œlength(æ•°ç»„é•¿åº¦)å¯¹åº”ä¸‹å…è®¸çš„æœ€å¤§å…ƒç´ æ•°ç›®ï¼Œè¶…è¿‡è¿™ä¸ªæ•°ç›®å°±é‡æ–°resize(æ‰©å®¹)ï¼Œæ‰©å®¹åçš„HashMapå®¹é‡æ˜¯ä¹‹å‰å®¹é‡çš„ä¸¤å€ã€‚é»˜è®¤çš„è´Ÿè½½å› å­0.75æ˜¯å¯¹ç©ºé—´å’Œæ—¶é—´æ•ˆç‡çš„ä¸€ä¸ªå¹³è¡¡é€‰æ‹©ï¼Œå»ºè®®å¤§å®¶ä¸è¦ä¿®æ”¹ï¼Œé™¤éåœ¨æ—¶é—´å’Œç©ºé—´æ¯”è¾ƒç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼Œå¦‚æœå†…å­˜ç©ºé—´å¾ˆå¤šè€Œåˆå¯¹æ—¶é—´æ•ˆç‡è¦æ±‚å¾ˆé«˜ï¼Œå¯ä»¥é™ä½è´Ÿè½½å› å­Load factorçš„å€¼ï¼›ç›¸åï¼Œå¦‚æœå†…å­˜ç©ºé—´ç´§å¼ è€Œå¯¹æ—¶é—´æ•ˆç‡è¦æ±‚ä¸é«˜ï¼Œå¯ä»¥å¢åŠ è´Ÿè½½å› å­loadFactorçš„å€¼ï¼Œè¿™ä¸ªå€¼å¯ä»¥å¤§äº1ã€‚sizeè¿™ä¸ªå­—æ®µå…¶å®å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯HashMapä¸­å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡ã€‚æ³¨æ„å’Œtableçš„é•¿åº¦lengthã€å®¹çº³æœ€å¤§é”®å€¼å¯¹æ•°é‡thresholdçš„åŒºåˆ«ã€‚è€ŒmodCountå­—æ®µä¸»è¦ç”¨æ¥è®°å½•HashMapå†…éƒ¨ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°ï¼Œä¸»è¦ç”¨äºè¿­ä»£çš„å¿«é€Ÿå¤±è´¥ã€‚å¼ºè°ƒä¸€ç‚¹ï¼Œå†…éƒ¨ç»“æ„å‘ç”Ÿå˜åŒ–æŒ‡çš„æ˜¯ç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œä¾‹å¦‚putæ–°é”®å€¼å¯¹ï¼Œä½†æ˜¯æŸä¸ªkeyå¯¹åº”çš„valueå€¼è¢«è¦†ç›–ä¸å±äºç»“æ„å˜åŒ–ã€‚åœ¨HashMapä¸­ï¼Œå“ˆå¸Œæ¡¶æ•°ç»„tableçš„é•¿åº¦lengthå¤§å°å¿…é¡»ä¸º2çš„næ¬¡æ–¹(ä¸€å®šæ˜¯åˆæ•°)ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸è§„çš„è®¾è®¡ï¼Œå¸¸è§„çš„è®¾è®¡æ˜¯æŠŠæ¡¶çš„å¤§å°è®¾è®¡ä¸ºç´ æ•°ã€‚ç›¸å¯¹æ¥è¯´ç´ æ•°å¯¼è‡´å†²çªçš„æ¦‚ç‡è¦å°äºåˆæ•°ï¼ŒHashtableåˆå§‹åŒ–æ¡¶å¤§å°ä¸º11ï¼Œå°±æ˜¯æ¡¶å¤§å°è®¾è®¡ä¸ºç´ æ•°çš„åº”ç”¨ï¼ˆHashtableæ‰©å®¹åä¸èƒ½ä¿è¯è¿˜æ˜¯ç´ æ•°ï¼‰ã€‚HashMapé‡‡ç”¨è¿™ç§éå¸¸è§„è®¾è®¡ï¼Œä¸»è¦æ˜¯ä¸ºäº†åœ¨å–æ¨¡å’Œæ‰©å®¹æ—¶åšä¼˜åŒ–ï¼ŒåŒæ—¶ä¸ºäº†å‡å°‘å†²çªï¼ŒHashMapå®šä½å“ˆå¸Œæ¡¶ç´¢å¼•ä½ç½®æ—¶ï¼Œä¹ŸåŠ å…¥äº†é«˜ä½å‚ä¸è¿ç®—çš„è¿‡ç¨‹ã€‚è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå³ä½¿è´Ÿè½½å› å­å’ŒHashç®—æ³•è®¾è®¡çš„å†åˆç†ï¼Œä¹Ÿå…ä¸äº†ä¼šå‡ºç°æ‹‰é“¾è¿‡é•¿çš„æƒ…å†µï¼Œä¸€æ—¦å‡ºç°æ‹‰é“¾è¿‡é•¿ï¼Œåˆ™ä¼šä¸¥é‡å½±å“HashMapçš„æ€§èƒ½ã€‚äºæ˜¯ï¼Œåœ¨JDK1.8ç‰ˆæœ¬ä¸­ï¼Œå¯¹æ•°æ®ç»“æ„åšäº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–ï¼Œå¼•å…¥äº†çº¢é»‘æ ‘ã€‚è€Œå½“é“¾è¡¨é•¿åº¦å¤ªé•¿ï¼ˆé»˜è®¤è¶…è¿‡8ï¼‰æ—¶ï¼Œé“¾è¡¨å°±è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåˆ©ç”¨çº¢é»‘æ ‘å¿«é€Ÿå¢åˆ æ”¹æŸ¥çš„ç‰¹ç‚¹æé«˜HashMapçš„æ€§èƒ½å½“çº¢é»‘æ ‘ç»“ç‚¹ä¸ªæ•°å°‘äº 8 ä¸ªçš„æ—¶å€™ï¼Œåˆä¼šå°†çº¢é»‘æ ‘è½¬åŒ–ä¸ºé“¾è¡¨ã€‚å› ä¸ºåœ¨æ•°æ®é‡è¾ƒå°çš„æƒ…å†µä¸‹ï¼Œçº¢é»‘æ ‘è¦ç»´æŠ¤å¹³è¡¡ï¼Œæ¯”èµ·é“¾è¡¨æ¥ï¼Œæ€§èƒ½ä¸Šçš„ä¼˜åŠ¿å¹¶ä¸æ˜æ˜¾ã€‚å…¶ä¸­ä¼šç”¨åˆ°çº¢é»‘æ ‘çš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾ç­‰ç®—æ³•ã€‚æœ¬æ–‡ä¸å†å¯¹çº¢é»‘æ ‘å±•å¼€è®¨è®ºï¼Œæƒ³äº†è§£æ›´å¤šçº¢é»‘æ ‘æ•°æ®ç»“æ„çš„å·¥ä½œåŸç†å¯ä»¥å‚è€ƒHashMapå¸¸ç”¨æ–¹æ³•æ ¹æ®keyè·å–å“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®åœ¨JDK1.8çš„å®ç°ä¸­ï¼Œä¼˜åŒ–äº†é«˜ä½è¿ç®—çš„ç®—æ³•ï¼Œé€šè¿‡hashCode()çš„é«˜16ä½å¼‚æˆ–ä½16ä½å®ç°çš„ï¼š(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)ï¼Œä¸»è¦æ˜¯ä»é€Ÿåº¦ã€åŠŸæ•ˆã€è´¨é‡æ¥è€ƒè™‘çš„ï¼Œè¿™ä¹ˆåšå¯ä»¥åœ¨æ•°ç»„tableçš„lengthæ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½ä¿è¯è€ƒè™‘åˆ°é«˜ä½Bitéƒ½å‚ä¸åˆ°Hashçš„è®¡ç®—ä¸­ï¼ŒåŒæ—¶ä¸ä¼šæœ‰å¤ªå¤§çš„å¼€é”€ã€‚å› ä¸ºä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒHashMapé•¿åº¦ä¸ä¼šå¤ªå¤§ï¼Œæ‰€ä»¥å¦‚æœé‡‡ç”¨å–æ¨¡è®¡ç®—æƒ…å†µä¸‹ï¼Œh &amp; (table.length -1)çš„å¾—åˆ°çš„äºŒè¿›åˆ¶æ•°ï¼Œå®é™…æœ‰æ•ˆä½æœ‰é™ï¼Œä¸€èˆ¬éƒ½æ˜¯ä½16ä½ï¼Œè¿™æ ·é«˜16ä½å°±ç­‰äºå®Œå…¨æµªè´¹äº†ã€‚HashMap Putæµç¨‹â‘ .åˆ¤æ–­é”®å€¼å¯¹æ•°ç»„table[i]æ˜¯å¦ä¸ºç©ºæˆ–ä¸ºnullï¼Œå¦åˆ™æ‰§è¡Œresize()è¿›è¡Œæ‰©å®¹ï¼›â‘¡.æ ¹æ®é”®å€¼keyè®¡ç®—hashå€¼å¾—åˆ°æ’å…¥çš„æ•°ç»„ç´¢å¼•iï¼Œå¦‚æœtable[i]==nullï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹æ·»åŠ ï¼Œè½¬å‘â‘¥ï¼Œå¦‚æœtable[i]ä¸ä¸ºç©ºï¼Œè½¬å‘â‘¢ï¼›â‘¢.åˆ¤æ–­table[i]çš„é¦–ä¸ªå…ƒç´ æ˜¯å¦å’Œkeyä¸€æ ·ï¼Œå¦‚æœç›¸åŒç›´æ¥è¦†ç›–valueï¼Œå¦åˆ™è½¬å‘â‘£ï¼Œè¿™é‡Œçš„ç›¸åŒæŒ‡çš„æ˜¯hashCodeä»¥åŠequalsï¼›â‘£.åˆ¤æ–­table[i] æ˜¯å¦ä¸ºtreeNodeï¼Œå³table[i] æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œå¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåˆ™ç›´æ¥åœ¨æ ‘ä¸­æ’å…¥é”®å€¼å¯¹ï¼Œå¦åˆ™è½¬å‘â‘¤ï¼›â‘¤.éå†table[i]ï¼Œåˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äº8ï¼Œå¤§äº8çš„è¯æŠŠé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æ‰§è¡Œæ’å…¥æ“ä½œï¼Œå¦åˆ™è¿›è¡Œé“¾è¡¨çš„æ’å…¥æ“ä½œï¼›éå†è¿‡ç¨‹ä¸­è‹¥å‘ç°keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–valueå³å¯ï¼›â‘¥.æ’å…¥æˆåŠŸåï¼Œåˆ¤æ–­å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡sizeæ˜¯å¦è¶…å¤šäº†æœ€å¤§å®¹é‡thresholdï¼Œå¦‚æœè¶…è¿‡ï¼Œè¿›è¡Œæ‰©å®¹ã€‚æ‰©å®¹é€šè¿‡ä»€ä¹ˆæ–¹å¼æ¥æ§åˆ¶mapä½¿å¾—Hashç¢°æ’çš„æ¦‚ç‡åˆå°ï¼Œå“ˆå¸Œæ¡¶æ•°ç»„ï¼ˆNode[] tableï¼‰å ç”¨ç©ºé—´åˆå°‘å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å¥½çš„Hashç®—æ³•å’Œæ‰©å®¹æœºåˆ¶ã€‚HashMapçš„sizeè¾¾åˆ°thresholdå¤§å°ï¼Œåˆ™ä¼šæ‰©å®¹æ‰©å®¹ç®—æ³•ï¼šæ¯ä¸€æ¬¡çš„æ‰©å®¹ï¼Œéƒ½æ˜¯åŸsizeçš„ä¸¤å€ï¼Œå…·ä½“æ˜¯æ ¹æ®ä¸Šä¸€æ¬¡çš„table sizeè¿›è¡Œä¸€æ¬¡ä½ç§»è¿ç®—å¾—åˆ°çš„ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆä¸ç›´æ¥ä¹˜ä»¥2æ¥å¾—åˆ°æ–°çš„é•¿åº¦å‘¢ï¼Ÿä¸»è¦æ˜¯CPUæ”¯æŒä¹˜æ³•è¿ç®—ï¼Œéƒ½æ˜¯ä»¥åŠ æ³•çš„æ–¹å¼æ¥å®ç°çš„ï¼Œä½è¿ç®—çš„è¯ä¼šæ›´ç®€æ´é«˜æ•ˆã€‚æ‰©å®¹åï¼ŒåŸæ•°ç»„æ‹·è´åˆ°æ–°æ•°ç»„ï¼šæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯2æ¬¡å¹‚çš„æ‰©å±•(æŒ‡é•¿åº¦æ‰©ä¸ºåŸæ¥2å€)ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ã€‚çœ‹ä¸‹å›¾å¯ä»¥æ˜ç™½è¿™å¥è¯çš„æ„æ€ï¼Œnä¸ºtableçš„é•¿åº¦ï¼Œå›¾ï¼ˆaï¼‰è¡¨ç¤ºæ‰©å®¹å‰çš„key1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå›¾ï¼ˆbï¼‰è¡¨ç¤ºæ‰©å®¹åkey1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå…¶ä¸­hash1æ˜¯key1å¯¹åº”çš„å“ˆå¸Œä¸é«˜ä½è¿ç®—ç»“æœã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ‰©å……HashMapçš„æ—¶å€™ï¼Œä¸éœ€è¦åƒJDK1.7çš„å®ç°é‚£æ ·é‡æ–°è®¡ç®—hashï¼Œåªéœ€è¦çœ‹çœ‹åŸæ¥çš„hashå€¼æ–°å¢çš„é‚£ä¸ªbitæ˜¯1è¿˜æ˜¯0å°±å¥½äº†ï¼Œæ˜¯0çš„è¯ç´¢å¼•æ²¡å˜ï¼Œæ˜¯1çš„è¯ç´¢å¼•å˜æˆâ€œåŸç´¢å¼•+oldCapâ€ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹å›¾ä¸º16æ‰©å……ä¸º32çš„resizeç¤ºæ„å›¾ï¼šè¿™ä¸ªè®¾è®¡ç¡®å®éå¸¸çš„å·§å¦™ï¼Œæ—¢çœå»äº†é‡æ–°è®¡ç®—hashå€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºæ–°å¢çš„1bitæ˜¯0è¿˜æ˜¯1å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œå› æ­¤resizeçš„è¿‡ç¨‹ï¼Œå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„bucketäº†ã€‚è¿™ä¸€å—å°±æ˜¯JDK1.8æ–°å¢çš„ä¼˜åŒ–ç‚¹ã€‚æœ‰ä¸€ç‚¹æ³¨æ„åŒºåˆ«ï¼ŒJDK1.7ä¸­rehashçš„æ—¶å€™ï¼Œæ—§é“¾è¡¨è¿ç§»æ–°é“¾è¡¨çš„æ—¶å€™ï¼Œå¦‚æœåœ¨æ–°è¡¨çš„æ•°ç»„ç´¢å¼•ä½ç½®ç›¸åŒï¼Œåˆ™é“¾è¡¨å…ƒç´ ä¼šå€’ç½®ï¼Œä½†æ˜¯ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒJDK1.8ä¸ä¼šå€’ç½®ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ç ”ç©¶ä¸‹JDK1.8çš„resizeæºç ï¼Œå†™çš„å¾ˆèµçº¢é»‘æ ‘æ‰©å±•ä¸€æ£µåˆæ ¼çš„çº¢é»‘æ ‘éœ€è¦æ»¡è¶³è¿™æ ·å‡ ä¸ªè¦æ±‚ï¼šæ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²çš„ï¼›æ¯ä¸ªå¶å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ç©ºèŠ‚ç‚¹ï¼ˆNILï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¶å­èŠ‚ç‚¹ä¸å­˜å‚¨æ•°æ®ï¼›ä»»ä½•ç›¸é‚»çš„èŠ‚ç‚¹éƒ½ä¸èƒ½åŒæ—¶ä¸ºçº¢è‰²ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œçº¢è‰²èŠ‚ç‚¹æ˜¯è¢«é»‘è‰²èŠ‚ç‚¹éš”å¼€çš„ï¼›æ¯ä¸ªèŠ‚ç‚¹ï¼Œä»è¯¥èŠ‚ç‚¹åˆ°è¾¾å…¶å¯è¾¾å¶å­èŠ‚ç‚¹çš„æ‰€æœ‰è·¯å¾„ï¼Œéƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚ä¸¤ä¸ªéå¸¸é‡è¦çš„æ“ä½œï¼Œå·¦æ—‹ï¼ˆrotate leftï¼‰ã€å³æ—‹ï¼ˆrotate rightï¼‰ã€‚å·¦æ—‹å…¨ç§°å…¶å®æ˜¯å«å›´ç»•æŸä¸ªèŠ‚ç‚¹çš„å·¦æ—‹ï¼Œé‚£å³æ—‹çš„å…¨ç§°ä¼°è®¡ä½ å·²ç»çŒœåˆ°äº†ï¼Œå°±å«å›´ç»•æŸä¸ªèŠ‚ç‚¹çš„å³æ—‹ã€‚çº¢é»‘æ ‘è§„å®šï¼Œæ’å…¥çš„èŠ‚ç‚¹å¿…é¡»æ˜¯çº¢è‰²çš„ã€‚è€Œä¸”ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘ä¸­æ–°æ’å…¥çš„èŠ‚ç‚¹éƒ½æ˜¯æ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸Šã€‚æ‰€ä»¥ï¼Œå…³äºæ’å…¥æ“ä½œçš„å¹³è¡¡è°ƒæ•´ï¼Œæœ‰è¿™æ ·ä¸¤ç§ç‰¹æ®Šæƒ…å†µï¼Œä½†æ˜¯ä¹Ÿéƒ½éå¸¸å¥½å¤„ç†ã€‚å¦‚æœæ’å…¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯é»‘è‰²çš„ï¼Œé‚£æˆ‘ä»¬ä»€ä¹ˆéƒ½ä¸ç”¨åšï¼Œå®ƒä»ç„¶æ»¡è¶³çº¢é»‘æ ‘çš„å®šä¹‰ã€‚å¦‚æœæ’å…¥çš„èŠ‚ç‚¹æ˜¯æ ¹èŠ‚ç‚¹ï¼Œé‚£æˆ‘ä»¬ç›´æ¥æ”¹å˜å®ƒçš„é¢œè‰²ï¼ŒæŠŠå®ƒå˜æˆé»‘è‰²å°±å¯ä»¥äº†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå…¶ä»–æƒ…å†µéƒ½ä¼šè¿èƒŒçº¢é»‘æ ‘çš„å®šä¹‰ï¼Œäºæ˜¯æˆ‘ä»¬å°±éœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œè°ƒæ•´çš„è¿‡ç¨‹åŒ…å«ä¸¤ç§åŸºç¡€çš„æ“ä½œï¼šå·¦å³æ—‹è½¬å’Œæ”¹å˜é¢œè‰²ã€‚çº¢é»‘æ ‘çš„å¹³è¡¡è°ƒæ•´è¿‡ç¨‹æ˜¯ä¸€ä¸ªè¿­ä»£çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬æŠŠæ­£åœ¨å¤„ç†çš„èŠ‚ç‚¹å«åšå…³æ³¨èŠ‚ç‚¹ã€‚å…³æ³¨èŠ‚ç‚¹ä¼šéšç€ä¸åœåœ°è¿­ä»£å¤„ç†ï¼Œè€Œä¸æ–­å‘ç”Ÿå˜åŒ–ã€‚æœ€å¼€å§‹çš„å…³æ³¨èŠ‚ç‚¹å°±æ˜¯æ–°æ’å…¥çš„èŠ‚ç‚¹ã€‚æ–°èŠ‚ç‚¹æ’å…¥ä¹‹åï¼Œå¦‚æœçº¢é»‘æ ‘çš„å¹³è¡¡è¢«æ‰“ç ´ï¼Œé‚£ä¸€èˆ¬ä¼šæœ‰ä¸‹é¢ä¸‰ç§æƒ…å†µã€‚æˆ‘ä»¬åªéœ€è¦æ ¹æ®æ¯ç§æƒ…å†µçš„ç‰¹ç‚¹ï¼Œä¸åœåœ°è°ƒæ•´ï¼Œå°±å¯ä»¥è®©çº¢é»‘æ ‘ç»§ç»­ç¬¦åˆå®šä¹‰ï¼Œä¹Ÿå°±æ˜¯ç»§ç»­ä¿æŒå¹³è¡¡ã€‚ä¸ºä»€ä¹ˆè¦å¼•å…¥çº¢é»‘æ ‘ï¼šè§£å†³Hashå†²çªçš„æƒ…å†µä¸‹ï¼Œé“¾åŒ–ä¸¥é‡ï¼Œå¦‚æœéœ€è¦æŸ¥æ‰¾çš„å…ƒç´ åœ¨é“¾è¡¨çš„æœ«å°¾ï¼Œåˆ™æ—¶é—´å¤æ‚åº¦é€€åŒ–ä¸ºO(1)äº†æ‰©å±•æ•£åˆ—è¡¨çš„è‹±æ–‡å«â€œHash Tableâ€ï¼Œæˆ‘ä»¬å¹³æ—¶ä¹Ÿå«å®ƒâ€œå“ˆå¸Œè¡¨â€æˆ–è€…â€œHash è¡¨â€æ˜ å°„æ–¹æ³•å°±å«ä½œæ•£åˆ—å‡½æ•°ï¼ˆæˆ–â€œHash å‡½æ•°â€â€œå“ˆå¸Œå‡½æ•°â€ï¼‰ï¼Œè€Œæ•£åˆ—å‡½æ•°è®¡ç®—å¾—åˆ°çš„å€¼å°±å«ä½œæ•£åˆ—å€¼æ•£åˆ—è¡¨çš„æŸ¥è¯¢æ•ˆç‡å¹¶ä¸èƒ½ç¬¼ç»Ÿåœ°è¯´æˆæ˜¯ O(1)ã€‚å®ƒè·Ÿæ•£åˆ—å‡½æ•°ã€è£…è½½å› å­ã€æ•£åˆ—å†²çªç­‰éƒ½æœ‰å…³ç³»æ•£åˆ—å‡½æ•°è®¾è®¡æ€»ç»“äº†ä¸‰ç‚¹æ•£åˆ—å‡½æ•°è®¾è®¡çš„åŸºæœ¬è¦æ±‚ï¼šæ•£åˆ—å‡½æ•°è®¡ç®—å¾—åˆ°çš„æ•£åˆ—å€¼æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼›å¦‚æœ key1 = key2ï¼Œé‚£ hash(key1) == hash(key2)ï¼›3.å¦‚æœ key1 â‰  key2ï¼Œé‚£ hash(key1) â‰  hash(key2)ã€‚æ•£åˆ—å‡½æ•°çš„è®¾è®¡ä¸èƒ½å¤ªå¤æ‚ã€‚å½±å“åˆ°æ•£åˆ—è¡¨çš„æ€§èƒ½ã€‚æ•£åˆ—å‡½æ•°ç”Ÿæˆçš„å€¼è¦å°½å¯èƒ½éšæœºå¹¶ä¸”å‡åŒ€åˆ†å¸ƒæ•£åˆ—å‡½æ•°çš„è®¾è®¡æ–¹æ³•ç›´æ¥å¯»å€æ³•ã€å¹³æ–¹å–ä¸­æ³•ã€æŠ˜å æ³•ã€éšæœºæ•°æ³•ç­‰å³ä¾¿åƒä¸šç•Œè‘—åçš„MD5ã€SHAã€CRCç­‰å“ˆå¸Œç®—æ³•ï¼Œä¹Ÿæ— æ³•å®Œå…¨é¿å…è¿™ç§æ•£åˆ—å†²çªã€‚è€Œä¸”ï¼Œå› ä¸ºæ•°ç»„çš„å­˜å‚¨ç©ºé—´æœ‰é™ï¼Œä¹Ÿä¼šåŠ å¤§æ•£åˆ—å†²çªçš„æ¦‚ç‡ã€‚æ•£åˆ—å†²çªå†å¥½çš„æ•£åˆ—å‡½æ•°ä¹Ÿæ— æ³•é¿å…æ•£åˆ—å†²çªã€‚é‚£ç©¶ç«Ÿè¯¥å¦‚ä½•è§£å†³æ•£åˆ—å†²çªé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬å¸¸ç”¨çš„æ•£åˆ—å†²çªè§£å†³æ–¹æ³•æœ‰ä¸¤ç±»ï¼Œå¼€æ”¾å¯»å€æ³•ï¼ˆopen addressingï¼‰å’Œé“¾è¡¨æ³•ï¼ˆchainingï¼‰ã€‚LinkedHashMap å°±é‡‡ç”¨äº†é“¾è¡¨æ³•è§£å†³å†²çªï¼ŒThreadLocalMap æ˜¯é€šè¿‡çº¿æ€§æ¢æµ‹çš„å¼€æ”¾å¯»å€æ³•æ¥è§£å†³å†²çªå¼€æ”¾å¯»å€æ³•(ç¼ºç‚¹ï¼šå¼€æ”¾å¯»å€æ³•è§£å†³å†²çªçš„æ•£åˆ—è¡¨ï¼Œåˆ é™¤æ•°æ®çš„æ—¶å€™æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦ç‰¹æ®Šæ ‡è®°å·²ç»åˆ é™¤æ‰çš„æ•°æ®ã€‚è€Œä¸”ï¼Œåœ¨å¼€æ”¾å¯»å€æ³•ä¸­ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œæ¯”èµ·é“¾è¡¨æ³•æ¥è¯´ï¼Œå†²çªçš„ä»£ä»·æ›´é«˜ã€‚)çº¿æ€§æ¢æµ‹ï¼ˆLinear Probingï¼‰äºŒæ¬¡æ¢æµ‹ï¼ˆQuadratic probingï¼‰åŒé‡æ•£åˆ—ï¼ˆDouble hashingï¼‰ï¼ˆä½¿ç”¨ä¸€ç»„æ•£åˆ—å‡½æ•°ï¼‰é“¾è¡¨æ³•åŸºäºé“¾è¡¨çš„æ•£åˆ—å†²çªå¤„ç†æ–¹æ³•æ¯”è¾ƒé€‚åˆå­˜å‚¨å¤§å¯¹è±¡ã€å¤§æ•°æ®é‡çš„æ•£åˆ—è¡¨ï¼Œè€Œä¸”ï¼Œæ¯”èµ·å¼€æ”¾å¯»å€æ³•ï¼Œå®ƒæ›´åŠ çµæ´»ï¼Œæ”¯æŒæ›´å¤šçš„ä¼˜åŒ–ç­–ç•¥ï¼Œæ¯”å¦‚ç”¨çº¢é»‘æ ‘ä»£æ›¿é“¾è¡¨ã€‚è£…è½½å› å­å½“æ•£åˆ—è¡¨çš„è£…è½½å› å­è¶…è¿‡æŸä¸ªé˜ˆå€¼æ—¶ï¼Œå°±éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚å¦‚æœå¤ªå¤§ï¼Œä¼šå¯¼è‡´å†²çªè¿‡å¤šï¼›å¦‚æœå¤ªå°ï¼Œä¼šå¯¼è‡´å†…å­˜æµªè´¹ä¸¥é‡ã€‚è£…è½½å› å­é˜ˆå€¼çš„è®¾ç½®è¦æƒè¡¡æ—¶é—´ã€ç©ºé—´å¤æ‚åº¦ã€‚å¦‚æœå†…å­˜ç©ºé—´ä¸ç´§å¼ ï¼Œå¯¹æ‰§è¡Œæ•ˆç‡è¦æ±‚å¾ˆé«˜ï¼Œå¯ä»¥é™ä½è´Ÿè½½å› å­çš„é˜ˆå€¼ï¼›ç›¸åï¼Œå¦‚æœå†…å­˜ç©ºé—´ç´§å¼ ï¼Œå¯¹æ‰§è¡Œæ•ˆç‡è¦æ±‚åˆä¸é«˜ï¼Œå¯ä»¥å¢åŠ è´Ÿè½½å› å­çš„å€¼ï¼Œç”šè‡³å¯ä»¥å¤§äº 1","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"HashMap","slug":"HashMap","permalink":"cpeixin.cn/tags/HashMap/"}]},{"title":"Spark Streaming offset ç®¡ç†","slug":"Spark-Streaming-offset-ç®¡ç†","date":"2017-08-02T08:03:44.000Z","updated":"2020-05-07T08:13:24.491Z","comments":true,"path":"2017/08/02/Spark-Streaming-offset-ç®¡ç†/","link":"","permalink":"cpeixin.cn/2017/08/02/Spark-Streaming-offset-%E7%AE%A1%E7%90%86/","excerpt":"","text":"è¶Šæ¥è¶Šå¤šçš„å®æ—¶é¡¹ç›®éœ€æ±‚ï¼Œæ„Ÿè§‰å¥½åƒå„ä¸ªä¸šåŠ¡çº¿ï¼Œäº§å“éƒ½æƒ³è®©è‡ªå·±çš„æ•°æ®åŠ¨èµ·æ¥ï¼Œå¹¶ä¸”é…åˆä¸Šæ•°æ®å¯è§†åŒ–å±•ç¤ºå‡ºæ¥ã€‚é‚£ä¹ˆåœ¨ä½¿ç”¨Spark Streamingè¿‡ç¨‹ä¸­ï¼Œè‚¯å®šä¸èƒ½é¿å…ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ï¼Œä½ å…¨å¤©24å°æ—¶è¿è¡Œçš„å®æ—¶ç¨‹åºï¼Œå¦‚æœåœ¨æŸä¸€æ—¶åˆ»å› ä¸ºå„ç§åŸå› ï¼Œåœæ‰ã€‚å½“ä½ å‘ç°å®æ—¶ç¨‹åºå·²ç»å› ä¸ºæ•…éšœåœæ­¢è¿è¡Œäº†1ä¸ªå°æ—¶ï¼Œæˆ–è€…äº§å“è¿è¥ä¸­æ•°æ®çš„ä½¿ç”¨è€…æ‰“ç”µè¯ç»™ä½ ï¼Œé€šçŸ¥ä½ æœ€è¿‘ä¸€ä¸ªå°æ—¶çš„æ•°æ®æ²¡æœ‰æ˜¾ç¤ºï¼ˆå°´å°¬ğŸ˜…ï¼‰ï¼Œæˆ–è€…å®æ—¶ç¨‹åºè¦ä¸´æ—¶å‡çº§ï¼Œéœ€è¦æ·»åŠ æ–°çš„ä¸šåŠ¡é€»è¾‘é‡æ–°éƒ¨ç½²ã€‚é‚£ä¹ˆæ­¤æ—¶ï¼Œåœ¨ä½ è¿˜æ²¡æœ‰åšoffsetç®¡ç†çš„æ—¶å€™ï¼Œä½ å‡†å¤‡æ€ä¹ˆåŠå‘¢ï¼Ÿæ˜¯â€auto.offset.resetâ€ -&gt; â€œlatestâ€ ä»æœ€æ–°çš„offsetä½ç§»æ•°æ®è¯»èµ·ï¼Œæ”¾å¼ƒé‚£1ä¸ªå°æ—¶æœªè¯»å–åˆ°çš„æ•°æ®ï¼Œè¿˜æ˜¯â€auto.offset.resetâ€ -&gt; â€œearliestâ€, ä»æœ€æ—©çš„ä½ç§»æ•°æ®è¯»å–ï¼Œé‡æ–°å¤„ç†ä¸€éæ‰€æœ‰topicæ•°æ®ã€‚æ€è€ƒä¸€ä¸‹ï¼Œè¿™ä¸¤ç§æƒ…å†µéƒ½ä¸æ˜¯ä¸€ä¸ªå¥½çš„åŠæ³•ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬è¦åœ¨æœ‰è¿™ä¸ªéœ€æ±‚çš„ç¨‹åºä¸­ï¼Œæ¥è¿›è¡Œoffsetçš„ç®¡ç†ï¼Œé¿å…æ•°æ®çš„ä¸¢å¤±ä»¥åŠé‡å¤è®¡ç®—çš„é—®é¢˜ã€‚å°†offsetå­˜å‚¨åœ¨å¤–éƒ¨æ•°æ®å­˜å‚¨ä¸­CheckpointsHBaseZooKeeperKafkaredisä¸ç®¡ç†offsetä¸Šå›¾æè¿°äº†åœ¨Spark Streamingåº”ç”¨ç¨‹åºä¸­ç®¡ç†offsetçš„ä¸€èˆ¬æµç¨‹ã€‚offsetå¯ä»¥é€šè¿‡å‡ ç§æ–¹å¼è¿›è¡Œç®¡ç†ï¼Œä½†é€šå¸¸éµå¾ªä»¥ä¸‹é€šç”¨æ­¥éª¤ã€‚åœ¨Direct DStreamåˆå§‹åŒ–åï¼Œå¯ä»¥æŒ‡å®šæ¯ä¸ªä¸»é¢˜åˆ†åŒºçš„offsetæ˜ å°„ï¼Œä»¥äº†è§£Direct DStreamåº”è¯¥ä»å“ªä¸ªåˆ†åŒºå¼€å§‹è¯»å–ã€‚æŒ‡å®šçš„åç§»é‡ä¸ä¸‹é¢çš„ç¬¬4æ­¥å†™å…¥çš„ä½ç½®ç›¸åŒã€‚ç„¶åå¯ä»¥è¯»å–å’Œå¤„ç†è¿™æ‰¹æ¶ˆæ¯ã€‚å¤„ç†åï¼Œç»“æœå’Œoffsetéƒ½å¯ä»¥å­˜å‚¨ã€‚_å­˜å‚¨ç»“æœå’Œæäº¤åç§»é‡_åŠ¨ä½œå‘¨å›´çš„è™šçº¿åªæ˜¯çªå‡ºæ˜¾ç¤ºäº†ä¸€ç³»åˆ—æ­¥éª¤ï¼Œå¦‚æœéœ€è¦ç‰¹æ®Šçš„äº¤ä»˜è¯­ä¹‰æ›´ä¸¥æ ¼çš„æƒ…å†µï¼Œç”¨æˆ·å¯èƒ½éœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥ã€‚è¿™å¯èƒ½åŒ…æ‹¬æ£€æŸ¥å¹‚ç­‰è¿ç®—æˆ–å°†ç»“æœåŠå…¶åç§»é‡å­˜å‚¨åœ¨åŸå­è¿ç®—ä¸­ã€‚æœ€åï¼Œä»»ä½•å¤–éƒ¨æŒä¹…æ•°æ®å­˜å‚¨ï¼ˆä¾‹å¦‚HBaseï¼ŒKafkaï¼ŒHDFSå’ŒZooKeeperï¼‰éƒ½å¯ä»¥ç”¨æ¥è·Ÿè¸ªå·²å¤„ç†çš„æ¶ˆæ¯ã€‚æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œå¯ä»¥å°†ä¸åŒçš„æ–¹æ¡ˆåˆå¹¶åˆ°ä¸Šè¿°æ­¥éª¤ä¸­ã€‚Sparkçš„ç¼–ç¨‹çµæ´»æ€§å…è®¸ç”¨æˆ·è¿›è¡Œç»†ç²’åº¦çš„æ§åˆ¶ï¼Œä»¥åœ¨å¤„ç†çš„å‘¨æœŸæ€§é˜¶æ®µä¹‹å‰æˆ–ä¹‹åå­˜å‚¨offsetã€‚è€ƒè™‘å‘ç”Ÿä»¥ä¸‹æƒ…å†µçš„åº”ç”¨ç¨‹åºï¼šSpark Streamingåº”ç”¨ç¨‹åºæ­£åœ¨ä»Kafkaè¯»å–æ¶ˆæ¯ï¼Œé’ˆå¯¹HBaseæ•°æ®æ‰§è¡Œè½¬æ¢æ“ä½œï¼Œç„¶åå°†æ“ä½œåçš„æ¶ˆæ¯å‘å¸ƒåˆ°å¦ä¸€ä¸ªtopicä¸­æˆ–å•ç‹¬çš„ç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼Œå…¶ä»–æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼Œåˆ°HBaseï¼ŒSolrï¼ŒDBMSç­‰ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰å°†æ¶ˆæ¯æˆåŠŸå‘å¸ƒåˆ°è¾…åŠ©ç³»ç»Ÿåï¼Œæˆ‘ä»¬æ‰å°†å…¶è§†ä¸ºå·²å¤„ç†ã€‚å¤–éƒ¨å­˜å‚¨offsetåœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ¢ç´¢ç”¨äºåœ¨æŒä¹…æ•°æ®å­˜å‚¨åŒºä¸­å°†offsetæŒä¹…ä¿å­˜åœ¨å¤–éƒ¨çš„ä¸åŒé€‰é¡¹ã€‚å¯¹äºæœ¬èŠ‚ä¸­æåˆ°çš„æ–¹æ³•ï¼Œå¦‚æœä½¿ç”¨spark-streaming-kafka-0-10_2.**åº“ï¼Œå»ºè®®ç”¨æˆ·å°†enable.auto.commit è®¾ç½®ä¸ºfalseã€‚æ­¤é…ç½®ä»…é€‚ç”¨äºæ­¤ç‰ˆæœ¬ï¼Œå°†enable.auto.commit è®¾ç½®ä¸ºtrueæ„å‘³ç€offsetå°†ä»¥config auto.commit.interval.msæ§åˆ¶çš„é¢‘ç‡è‡ªåŠ¨æäº¤ã€‚åœ¨Spark Streamingä¸­ï¼Œå°†æ­¤å€¼è®¾ç½®ä¸ºtrueä¼šåœ¨ä»Kafkaè¯»å–æ¶ˆæ¯æ—¶è‡ªåŠ¨å‘Kafkaæäº¤åç§»é‡ï¼Œè¿™ä¸ä¸€å®šæ„å‘³ç€Sparkå·²å®Œæˆå¯¹è¿™äº›æ¶ˆæ¯çš„å¤„ç†ã€‚è¦å¯ç”¨ç²¾ç¡®çš„åç§»é‡æ§åˆ¶ï¼Œè¯·å°†Kafkaå‚æ•°enable.auto.commit è®¾ç½®ä¸º falseã€‚Spark Streaming checkpointså¯ç”¨Spark Streamingçš„æ˜¯å­˜å‚¨checkpointsçš„æœ€ç®€å•æ–¹æ³•ï¼Œå› ä¸ºå®ƒåœ¨Sparkçš„æ¡†æ¶ä¸­å¾ˆå®¹æ˜“è·å¾—ã€‚checkpointæ˜¯ä¸“é—¨ä¸ºä¿å­˜åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ä¿å­˜åœ¨HDFSï¼‰è€Œè®¾è®¡çš„ï¼Œä»¥ä¾¿å¯ä»¥åœ¨å‡ºç°æ•…éšœæ—¶å°†å…¶æ¢å¤ã€‚å¯¹Kafkaæµè¿›è¡Œæ£€æŸ¥ç‚¹å°†å¯¼è‡´åç§»èŒƒå›´å­˜å‚¨åœ¨æ£€æŸ¥ç‚¹ä¸­ã€‚å¦‚æœå‡ºç°æ•…éšœï¼ŒSpark Streamingåº”ç”¨ç¨‹åºå¯ä»¥å¼€å§‹ä»æ£€æŸ¥ç‚¹åç§»èŒƒå›´è¯»å–æ¶ˆæ¯ã€‚ä½†æ˜¯ï¼ŒSpark Streamingæ£€æŸ¥ç‚¹æ— æ³•åœ¨Sparkåº”ç”¨ç¨‹åºå‡çº§ä¹‹åæ¢å¤ï¼Œå› æ­¤ä¸æ˜¯å¾ˆå¯é ï¼Œå°¤å…¶æ˜¯å½“æ‚¨å°†è¿™ç§æœºåˆ¶ç”¨äºå…³é”®çš„ç”Ÿäº§åº”ç”¨ç¨‹åºæ—¶ã€‚æˆ‘ä»¬ä¸å»ºè®®é€šè¿‡Sparkæ£€æŸ¥ç‚¹ç®¡ç†åç§»é‡ã€‚åœ¨HBaseä¸­å­˜å‚¨offsetHBaseå¯ç”¨ä½œå¤–éƒ¨æ•°æ®å­˜å‚¨ï¼Œä»¥å¯é çš„æ–¹å¼ä¿ç•™åç§»èŒƒå›´ã€‚é€šè¿‡åœ¨å¤–éƒ¨å­˜å‚¨åç§»é‡èŒƒå›´ï¼Œå®ƒä½¿Spark Streamingåº”ç”¨ç¨‹åºèƒ½å¤Ÿä»ä»»æ„æ—¶é—´ç‚¹é‡æ–°å¯åŠ¨å’Œé‡æ’­æ¶ˆæ¯ï¼Œåªè¦æ¶ˆæ¯åœ¨Kafkaä¸­ä»ç„¶æœ‰æ•ˆã€‚å€ŸåŠ©HBaseçš„é€šç”¨è®¾è®¡ï¼Œè¯¥åº”ç”¨ç¨‹åºèƒ½å¤Ÿåˆ©ç”¨rowkeyå’Œcolumn family æ¥å¤„ç†è·¨åŒä¸€è¡¨ä¸­çš„å¤šä¸ªSpark Streamingåº”ç”¨ç¨‹åºå’ŒKafka topic å­˜å‚¨åç§»èŒƒå›´ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ˜¯ä½¿ç”¨åŒ…å«topicï¼Œgroup idå’ŒSpark Streaming çš„ batchTime.milliSeconds ç»„åˆä½œä¸ºè¡Œé”®æ¥åŒºåˆ†å†™å…¥è¡¨çš„æ¯ä¸ªæ¡ç›®ã€‚æ–°è®°å½•å°†ç´¯ç§¯åœ¨æˆ‘ä»¬åœ¨ä»¥ä¸‹è®¾è®¡ä¸­é…ç½®çš„è¡¨æ ¼ä¸­ï¼Œä»¥åœ¨30å¤©åè‡ªåŠ¨è¿‡æœŸã€‚ä¸‹é¢æ˜¯HBaseè¡¨çš„DDLå’Œç»“æ„ã€‚ddl1create &#39;stream_kafka_offsets&#39;, &#123;NAME&#x3D;&gt;&#39;offsets&#39;, TTL&#x3D;&gt;2592000&#125;RowKey è®¾è®¡1234row: &lt;TOPIC_NAME&gt;:&lt;GROUP_ID&gt;:&lt;EPOCH_BATCHTIME_MS&gt;column family: offsetsqualifier: &lt;PARTITION_ID&gt;value: &lt;OFFSET_ID&gt;ä¸‹é¢ç›´æ¥ç»™å‡ºåœ¨HBaseä¸­ï¼Œoffsetçš„ç®¡ç†è®¾è®¡æµç¨‹ä»£ç ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162import kafka.utils.ZkUtilsimport org.apache.hadoop.hbase.filter.PrefixFilterimport org.apache.hadoop.hbase.util.Bytesimport org.apache.hadoop.hbase.&#123;TableName, HBaseConfiguration&#125;import org.apache.hadoop.hbase.client.&#123;Scan, Put, ConnectionFactory&#125;import org.apache.kafka.clients.consumer.ConsumerRecordimport org.apache.kafka.common.TopicPartitionimport org.apache.kafka.common.serialization.StringDeserializerimport org.apache.spark.streaming.kafka010.ConsumerStrategies._import org.apache.spark.streaming.kafka010.&#123;OffsetRange, HasOffsetRanges, KafkaUtils&#125;import org.apache.spark.streaming.kafka010.LocationStrategies._import org.apache.spark.streaming.&#123;Seconds, StreamingContext&#125;import org.apache.spark.&#123;SparkContext, SparkConf&#125;/** * Created by gmedasani on 6/10/17. */object KafkaOffsetsBlogStreamingDriver &#123; def main(args: Array[String]) &#123; if (args.length &lt; 6) &#123; System.err.println(\"Usage: KafkaDirectStreamTest &lt;batch-duration-in-seconds&gt; &lt;kafka-bootstrap-servers&gt; \" + \"&lt;kafka-topics&gt; &lt;kafka-consumer-group-id&gt; &lt;hbase-table-name&gt; &lt;kafka-zookeeper-quorum&gt;\") System.exit(1) &#125; val batchDuration = args(0) val bootstrapServers = args(1).toString val topicsSet = args(2).toString.split(\",\").toSet val consumerGroupID = args(3) val hbaseTableName = args(4) val zkQuorum = args(5) val zkKafkaRootDir = \"kafka\" val zkSessionTimeOut = 10000 val zkConnectionTimeOut = 10000 val sparkConf = new SparkConf().setAppName(\"Kafka-Offset-Management-Blog\") .setMaster(\"local[4]\")//Uncomment this line to test while developing on a workstation val sc = new SparkContext(sparkConf) val ssc = new StreamingContext(sc, Seconds(batchDuration.toLong)) val topics = topicsSet.toArray val topic = topics(0) val kafkaParams = Map[String, Object]( \"bootstrap.servers\" -&gt; bootstrapServers, \"key.deserializer\" -&gt; classOf[StringDeserializer], \"value.deserializer\" -&gt; classOf[StringDeserializer], \"group.id\" -&gt; consumerGroupID, \"auto.offset.reset\" -&gt; \"earliest\", \"enable.auto.commit\" -&gt; (false: java.lang.Boolean) ) /* Create a dummy process that simply returns the message as is. */ def processMessage(message:ConsumerRecord[String,String]):ConsumerRecord[String,String]=&#123; message &#125; /* Save Offsets into HBase */ def saveOffsets(TOPIC_NAME:String,GROUP_ID:String,offsetRanges:Array[OffsetRange],hbaseTableName:String, batchTime: org.apache.spark.streaming.Time) =&#123; val hbaseConf = HBaseConfiguration.create() hbaseConf.addResource(\"src/main/resources/hbase-site.xml\") val conn = ConnectionFactory.createConnection(hbaseConf) val table = conn.getTable(TableName.valueOf(hbaseTableName)) val rowKey = TOPIC_NAME + \":\" + GROUP_ID + \":\" + String.valueOf(batchTime.milliseconds) val put = new Put(rowKey.getBytes) for(offset &lt;- offsetRanges)&#123; put.addColumn(Bytes.toBytes(\"offsets\"),Bytes.toBytes(offset.partition.toString), Bytes.toBytes(offset.untilOffset.toString)) &#125; table.put(put) conn.close() &#125; /* Returns last committed offsets for all the partitions of a given topic from HBase in following cases. - CASE 1: SparkStreaming job is started for the first time. This function gets the number of topic partitions from Zookeeper and for each partition returns the last committed offset as 0 - CASE 2: SparkStreaming is restarted and there are no changes to the number of partitions in a topic. Last committed offsets for each topic-partition is returned as is from HBase. - CASE 3: SparkStreaming is restarted and the number of partitions in a topic increased. For old partitions, last committed offsets for each topic-partition is returned as is from HBase as is. For newly added partitions, function returns last committed offsets as 0 */ def getLastCommittedOffsets(TOPIC_NAME:String,GROUP_ID:String,hbaseTableName:String,zkQuorum:String, zkRootDir:String, sessionTimeout:Int,connectionTimeOut:Int):Map[TopicPartition,Long] =&#123; val hbaseConf = HBaseConfiguration.create() hbaseConf.addResource(\"src/main/resources/hbase-site.xml\") val zkUrl = zkQuorum+\"/\"+zkRootDir val zkClientAndConnection = ZkUtils.createZkClientAndConnection(zkUrl,sessionTimeout,connectionTimeOut) val zkUtils = new ZkUtils(zkClientAndConnection._1, zkClientAndConnection._2,false) val zKNumberOfPartitionsForTopic = zkUtils.getPartitionsForTopics(Seq(TOPIC_NAME)).get(TOPIC_NAME).toList.head.size //Connect to HBase to retrieve last committed offsets val conn = ConnectionFactory.createConnection(hbaseConf) val table = conn.getTable(TableName.valueOf(hbaseTableName)) val startRow = TOPIC_NAME + \":\" + GROUP_ID + \":\" + String.valueOf(System.currentTimeMillis()) val stopRow = TOPIC_NAME + \":\" + GROUP_ID + \":\" + 0 val scan = new Scan() val scanner = table.getScanner(scan.setStartRow(startRow.getBytes).setStopRow(stopRow.getBytes).setReversed(true)) val result = scanner.next() var hbaseNumberOfPartitionsForTopic = 0 //Set the number of partitions discovered for a topic in HBase to 0 if (result != null)&#123; //If the result from hbase scanner is not null, set number of partitions from hbase to the number of cells hbaseNumberOfPartitionsForTopic = result.listCells().size() &#125; val fromOffsets = collection.mutable.Map[TopicPartition,Long]() if(hbaseNumberOfPartitionsForTopic == 0)&#123; // initialize fromOffsets to beginning for (partition &lt;- 0 to zKNumberOfPartitionsForTopic-1)&#123; fromOffsets += (new TopicPartition(TOPIC_NAME,partition) -&gt; 0)&#125; &#125; else if(zKNumberOfPartitionsForTopic &gt; hbaseNumberOfPartitionsForTopic)&#123; // handle scenario where new partitions have been added to existing kafka topic for (partition &lt;- 0 to hbaseNumberOfPartitionsForTopic-1)&#123; val fromOffset = Bytes.toString(result.getValue(Bytes.toBytes(\"offsets\"),Bytes.toBytes(partition.toString))) fromOffsets += (new TopicPartition(TOPIC_NAME,partition) -&gt; fromOffset.toLong)&#125; for (partition &lt;- hbaseNumberOfPartitionsForTopic to zKNumberOfPartitionsForTopic-1)&#123; fromOffsets += (new TopicPartition(TOPIC_NAME,partition) -&gt; 0)&#125; &#125; else &#123; //initialize fromOffsets from last run for (partition &lt;- 0 to hbaseNumberOfPartitionsForTopic-1 )&#123; val fromOffset = Bytes.toString(result.getValue(Bytes.toBytes(\"offsets\"),Bytes.toBytes(partition.toString))) fromOffsets += (new TopicPartition(TOPIC_NAME,partition) -&gt; fromOffset.toLong)&#125; &#125; scanner.close() conn.close() fromOffsets.toMap &#125; val fromOffsets= getLastCommittedOffsets(topic,consumerGroupID,hbaseTableName,zkQuorum,zkKafkaRootDir, zkSessionTimeOut,zkConnectionTimeOut) val inputDStream = KafkaUtils.createDirectStream[String, String](ssc,PreferConsistent,Assign[String, String]( fromOffsets.keys,kafkaParams,fromOffsets)) /* For each RDD in a DStream apply a map transformation that processes the message. */ inputDStream.foreachRDD((rdd,batchTime) =&gt; &#123; val offsetRanges = rdd.asInstanceOf[HasOffsetRanges].offsetRanges offsetRanges.foreach(offset =&gt; println(offset.topic, offset.partition, offset.fromOffset,offset.untilOffset)) val newRDD = rdd.map(message =&gt; processMessage(message)) newRDD.count() saveOffsets(topic,consumerGroupID,offsetRanges,hbaseTableName,batchTime) //save the offsets to HBase &#125;) println(\"Number of messages processed \" + inputDStream.count()) ssc.start() ssc.awaitTermination() &#125;&#125;åœ¨ZooKeeperä¸­å­˜å‚¨offsetç”¨æˆ·å¯ä»¥å°†åç§»èŒƒå›´å­˜å‚¨åœ¨ZooKeeperä¸­ï¼Œè¿™å¯ä»¥ç±»ä¼¼åœ°æä¾›ä¸€ç§å¯é çš„æ–¹æ³•ï¼Œä»¥åœ¨æœ€ååœæ­¢çš„Kafkaæµä¸Šå¼€å§‹æµå¤„ç†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯åŠ¨æ—¶ï¼ŒSpark Streamingä½œä¸šå°†ä»ZooKeeperä¸­æ£€ç´¢æ¯ä¸ªä¸»é¢˜åˆ†åŒºçš„æœ€æ–°å¤„ç†è¿‡çš„åç§»é‡ã€‚å¦‚æœæ‰¾åˆ°äº†ä¸€ä¸ªä»¥å‰åœ¨ZooKeeperä¸­æœªç®¡ç†è¿‡çš„æ–°åˆ†åŒºï¼Œåˆ™é»˜è®¤å°†å…¶æœ€æ–°å¤„ç†çš„åç§»é‡ä»å¤´å¼€å§‹ã€‚å¤„ç†å®Œæ¯æ‰¹åï¼Œç”¨æˆ·å¯ä»¥å­˜å‚¨ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªå¤„ç†è¿‡çš„åç§»é‡ã€‚æ­¤å¤–ï¼Œåœ¨ZooKeeperä¸­å­˜å‚¨åç§»é‡çš„znodeä½ç½®ä½¿ç”¨ä¸æ—§Kafkaä½¿ç”¨è€…APIç›¸åŒçš„æ ¼å¼ã€‚å› æ­¤ï¼Œç”¨äºè·Ÿè¸ªæˆ–ç›‘è§†å­˜å‚¨åœ¨ZooKeeperä¸­çš„Kafkaåç§»é‡çš„ä»»ä½•å·¥å…·ä»ç„¶å¯ä»¥ä½¿ç”¨ã€‚åˆå§‹åŒ–ZooKeeperè¿æ¥ï¼Œä»¥è·å–å’Œå­˜å‚¨åˆ°ZooKeeperçš„åç§»é‡ï¼š12val zkClientAndConnection = ZkUtils.createZkClientAndConnection(zkUrl, sessionTimeout, connectionTimeout)val zkUtils = new ZkUtils(zkClientAndConnection._1, zkClientAndConnection._2, false)æ£€ç´¢å­˜å‚¨åœ¨ä½¿ç”¨è€…ç»„å’Œä¸»é¢˜åˆ—è¡¨çš„ZooKeeperä¸­çš„æœ€ååç§»é‡çš„æ–¹æ³•ï¼š1234567891011121314151617181920212223242526272829303132def readOffsets(topics: Seq[String], groupId:String): Map[TopicPartition, Long] = &#123; val topicPartOffsetMap = collection.mutable.HashMap.empty[TopicPartition, Long] val partitionMap = zkUtils.getPartitionsForTopics(topics) // /consumers/&lt;groupId&gt;/offsets/&lt;topic&gt;/ partitionMap.foreach(topicPartitions =&gt; &#123; val zkGroupTopicDirs = new ZKGroupTopicDirs(groupId, topicPartitions._1) topicPartitions._2.foreach(partition =&gt; &#123; val offsetPath = zkGroupTopicDirs.consumerOffsetDir + \"/\" + partition try &#123; val offsetStatTuple = zkUtils.readData(offsetPath) if (offsetStatTuple != null) &#123; LOGGER.info(\"retrieving offset details - topic: &#123;&#125;, partition: &#123;&#125;, offset: &#123;&#125;, node path: &#123;&#125;\", Seq[AnyRef](topicPartitions._1, partition.toString, offsetStatTuple._1, offsetPath): _*) topicPartOffsetMap.put(new TopicPartition(topicPartitions._1, Integer.valueOf(partition)), offsetStatTuple._1.toLong) &#125; &#125; catch &#123; case e: Exception =&gt; LOGGER.warn(\"retrieving offset details - no previous node exists:\" + \" &#123;&#125;, topic: &#123;&#125;, partition: &#123;&#125;, node path: &#123;&#125;\", Seq[AnyRef](e.getMessage, topicPartitions._1, partition.toString, offsetPath): _*) topicPartOffsetMap.put(new TopicPartition(topicPartitions._1, Integer.valueOf(partition)), 0L) &#125; &#125;) &#125;) topicPartOffsetMap.toMap&#125;ä½¿ç”¨ç‰¹å®šçš„åç§»é‡åˆå§‹åŒ–Kafka Direct Dstreamä»¥å¼€å§‹å¤„ç†ï¼š1val inputDStream = KafkaUtils.createDirectStream(ssc, PreferConsistent, ConsumerStrategies.Subscribe[String,String](topics, kafkaParams, fromOffsets))å°†ä¸€ç»„å¯æ¢å¤çš„åç§»é‡æŒä¹…ä¿å­˜åˆ°ZooKeeperçš„æ–¹æ³•ã€‚æ³¨æ„ï¼š_offsetPath_æ˜¯ä¸€ä¸ªZooKeeperä½ç½®ï¼Œè¡¨ç¤ºä¸º/ consumers / [groupId] / offsets / topic / [partitionId]ï¼Œç”¨äºå­˜å‚¨åç§»å€¼123456789101112131415161718def persistOffsets(offsets: Seq[OffsetRange], groupId: String, storeEndOffset: Boolean): Unit = &#123; offsets.foreach(or =&gt; &#123; val zkGroupTopicDirs = new ZKGroupTopicDirs(groupId, or.topic); val acls = new ListBuffer[ACL]() val acl = new ACL acl.setId(ANYONE_ID_UNSAFE) acl.setPerms(PERMISSIONS_ALL) acls += acl val offsetPath = zkGroupTopicDirs.consumerOffsetDir + \"/\" + or.partition; val offsetVal = if (storeEndOffset) or.untilOffset else or.fromOffset zkUtils.updatePersistentPath(zkGroupTopicDirs.consumerOffsetDir + \"/\" + or.partition, offsetVal + \"\", JavaConversions.bufferAsJavaList(acls)) LOGGER.debug(\"persisting offset details - topic: &#123;&#125;, partition: &#123;&#125;, offset: &#123;&#125;, node path: &#123;&#125;\", Seq[AnyRef](or.topic, or.partition.toString, offsetVal.toString, offsetPath): _*) &#125;)&#125;åœ¨kafkaä¸­ç®¡ç†offsetåœ¨Apache Spark 2.1.xçš„Clouderaå‘è¡Œç‰ˆä¸­ï¼Œspark-streaming-kafka-0-10ä½¿ç”¨äº†æ–°çš„Consumer apiï¼Œå®ƒå…¬å¼€äº†commitAsync APIã€‚ä½¿ç”¨commitAsync APIï¼Œä½¿ç”¨æ–¹å¯ä»¥åœ¨çŸ¥é“è¾“å‡ºå·²å­˜å‚¨åå°†åç§»é‡æäº¤ç»™Kafkaã€‚æ–°çš„ä½¿ç”¨è€…apiæ ¹æ®ä½¿ç”¨è€…çš„_group.id_å”¯ä¸€åœ°å°†åç§»æäº¤å›Kafka ã€‚Persist Offsets in Kafka123456789101112131415161718192021222324252627282930313233343536def createKafkaRDD(ssc: StreamingContext, config: Source) = &#123; var SparkDStream: InputDStream[ConsumerRecord[String, String]] = null try &#123; SparkDStream = &#123; val kafkaParams = Map[String, Object]( \"bootstrap.servers\" -&gt; config.servers, \"key.deserializer\" -&gt; classOf[StringDeserializer], \"value.deserializer\" -&gt; classOf[StringDeserializer], \"group.id\" -&gt; config.group, \"auto.offset.reset\" -&gt; config.offset )/* \"enable.auto.commit\" -&gt; config.getString(\"kafkaSource.enable.auto.commit\"))*/ // val subscribeTopics = config.getStringList(\"kafkaSource.topics\").toIterable import scala.collection.JavaConversions._ val kafkaStream = KafkaUtils.createDirectStream[String, String]( ssc, LocationStrategies.PreferConsistent, ConsumerStrategies.Subscribe[String, String](config.topic.toList, kafkaParams) ) kafkaStream &#125; &#125; catch &#123; case e: Throwable =&gt; &#123; throw new Exception(\"Couldn't init Spark stream processing\", e) &#125; &#125; SparkDStream &#125;var inputDStream: InputDStream[ConsumerRecord[String, String]] = createKafkaRDDï¼ˆï¼‰inputDStream.foreachRDD &#123; rdd =&gt; val offsetRanges = rdd.asInstanceOf[HasOffsetRanges].offsetRanges // æ›´æ–° Offset å€¼ inputDStream.asInstanceOf[CanCommitOffsets].commitAsync(offsetRanges) &#125;æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·è®¿é—®â€“ http://spark.apache.org/docs/latest/streaming-kafka-0-10-integration.html#kafka-itselfæ³¨æ„ï¼šcommitAsyncï¼ˆï¼‰æ˜¯Spark Streamingå’ŒKafka Integrationçš„kafka-0-10ç‰ˆæœ¬çš„ä¸€éƒ¨åˆ†ã€‚å¦‚Sparkæ–‡æ¡£æ‰€è¿°ï¼Œæ­¤é›†æˆä»å¤„äºè¯•éªŒé˜¶æ®µï¼ŒAPIå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚åœ¨Redisä¸­å­˜å‚¨offset123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189import org.apache.kafka.clients.consumer.ConsumerRecordimport org.apache.kafka.common.TopicPartitionimport org.apache.kafka.common.serialization.StringDeserializerimport org.apache.spark.SparkConfimport org.apache.spark.streaming.&#123;Seconds, StreamingContext&#125;import org.apache.spark.streaming.dstream.InputDStreamimport org.apache.spark.streaming.kafka010._import scala.collection.JavaConverters._import scala.util.Tryobject KafkaOffsetsBlogStreamingDriver &#123; /** * æ ¹æ®groupIdä¿å­˜offset * @param ranges * @param groupId */ def storeOffset(ranges: Array[OffsetRange], groupId: String): Unit = &#123; for (o &lt;- ranges) &#123; val key = s\"bi_kafka_offset_$&#123;groupId&#125;_$&#123;o.topic&#125;_$&#123;o.partition&#125;\" val value = o.untilOffset JedisUtil.set(key, value.toString) &#125; &#125; /** * æ ¹æ®topicï¼Œgroupidè·å–offset * @param topics * @param groupId * @return */ def getOffset(topics: Array[String], groupId: String): (Map[TopicPartition, Long], Int) = &#123; val fromOffSets = scala.collection.mutable.Map[TopicPartition, Long]() topics.foreach(topic =&gt; &#123; val keys = JedisUtil.getKeys(s\"bi_kafka_offset_$&#123;groupId&#125;_$&#123;topic&#125;*\") if (!keys.isEmpty) &#123; keys.asScala.foreach(key =&gt; &#123; val offset = JedisUtil.get(key) val partition = Try(key.split(s\"bi_kafka_offset_$&#123;groupId&#125;_$&#123;topic&#125;_\").apply(1)).getOrElse(\"0\") fromOffSets.put(new TopicPartition(topic, partition.toInt), offset.toLong) &#125;) &#125; &#125;) if (fromOffSets.isEmpty) &#123; (fromOffSets.toMap, 0) &#125; else &#123; (fromOffSets.toMap, 1) &#125; &#125; /** * åˆ›å»ºInputDStreamï¼Œå¦‚æœauto.offset.resetä¸ºlateståˆ™ä»redisè¯»å– * @param ssc * @param topic * @param kafkaParams * @return */ def createStreamingContextRedis(ssc: StreamingContext, topic: Array[String], kafkaParams: Map[String, Object]): InputDStream[ConsumerRecord[String, String]] = &#123; var kafkaStreams: InputDStream[ConsumerRecord[String, String]] = null val groupId = kafkaParams.get(\"group.id\").get val (fromOffSet, flag) = getOffset(topic, groupId.toString) val offsetReset = kafkaParams.get(\"auto.offset.reset\").get if (flag == 1 &amp;&amp; offsetReset.equals(\"latest\")) &#123; kafkaStreams = KafkaUtils.createDirectStream(ssc, LocationStrategies.PreferConsistent, ConsumerStrategies.Subscribe(topic, kafkaParams, fromOffSet)) &#125; else &#123; kafkaStreams = KafkaUtils.createDirectStream(ssc, LocationStrategies.PreferConsistent, ConsumerStrategies.Subscribe(topic, kafkaParams)) &#125; kafkaStreams &#125; def main(args: Array[String]): Unit = &#123; val conf = new SparkConf().setAppName(\"offSet Redis\").setMaster(\"local[2]\") val ssc = new StreamingContext(conf, Seconds(60)) val kafkaParams = Map[String, Object]( \"bootstrap.servers\" -&gt; \"localhost:9092\", \"group.id\" -&gt; \"binlog.test.rpt_test_1min\", \"auto.offset.reset\" -&gt; \"latest\", \"enable.auto.commit\" -&gt; (false: java.lang.Boolean), \"session.timeout.ms\" -&gt; \"20000\", \"key.deserializer\" -&gt; classOf[StringDeserializer], \"value.deserializer\" -&gt; classOf[StringDeserializer] ) val topic = Array(\"weibo_keyword\") val groupId = \"test\" val lines = createStreamingContextRedis(ssc, topic, kafkaParams) lines.foreachRDD(rdds =&gt; &#123; if (!rdds.isEmpty()) &#123; println(\"##################:\" + rdds.count()) &#125; storeOffset(rdds.asInstanceOf[HasOffsetRanges].offsetRanges, groupId) &#125;) ssc.start() ssc.awaitTermination() &#125;&#125;import java.utilimport com.typesafe.config.ConfigFactoryimport org.apache.kafka.common.serialization.StringDeserializerimport redis.clients.jedis.&#123;HostAndPort, JedisCluster, JedisPool, JedisPoolConfig&#125;object JedisUtil &#123; private val config = ConfigFactory.load(\"realtime-etl.conf\") private val redisHosts: String = config.getString(\"redis.server\") private val port: Int = config.getInt(\"redis.port\") private val hostAndPortsSet: java.util.Set[HostAndPort] = new util.HashSet[HostAndPort]() redisHosts.split(\",\").foreach(host =&gt; &#123; hostAndPortsSet.add(new HostAndPort(host, port)) &#125;) private val jedisConf: JedisPoolConfig = new JedisPoolConfig() jedisConf.setMaxTotal(5000) jedisConf.setMaxWaitMillis(50000) jedisConf.setMaxIdle(300) jedisConf.setTestOnBorrow(true) jedisConf.setTestOnReturn(true) jedisConf.setTestWhileIdle(true) jedisConf.setMinEvictableIdleTimeMillis(60000l) jedisConf.setTimeBetweenEvictionRunsMillis(3000l) jedisConf.setNumTestsPerEvictionRun(-1) lazy val redis = new JedisCluster(hostAndPortsSet, jedisConf) def get(key: String): String = &#123; try &#123; redis.get(key) &#125; catch &#123; case e: Exception =&gt; e.printStackTrace() null &#125; &#125; def set(key: String, value: String) = &#123; try &#123; redis.set(key, value) &#125; catch &#123; case e: Exception =&gt; &#123; e.printStackTrace() &#125; &#125; &#125; def hmset(key: String, map: java.util.Map[String, String]): Unit = &#123; // val redis=pool.getResource try &#123; redis.hmset(key, map) &#125;catch &#123; case e:Exception =&gt; e.printStackTrace() &#125; &#125; def hset(key: String, field: String, value: String): Unit = &#123; // val redis=pool.getResource try &#123; redis.hset(key, field, value) &#125; catch &#123; case e: Exception =&gt; &#123; e.printStackTrace() &#125; &#125; &#125; def hget(key: String, field: String): String = &#123; try &#123; redis.hget(key, field) &#125;catch &#123; case e:Exception =&gt; e.printStackTrace() null &#125; &#125; def hgetAll(key: String): java.util.Map[String, String] = &#123; try &#123; redis.hgetAll(key) &#125; catch &#123; case e: Exception =&gt; e.printStackTrace() null &#125; &#125;&#125; #### å…¶ä»–æ–¹æ³• å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ‚¨è¿˜å¯ä»¥å°†åç§»é‡å­˜å‚¨åœ¨HDFSä¹‹ç±»çš„å­˜å‚¨ç³»ç»Ÿä¸­ã€‚ä¸ä¸Šè¿°é€‰é¡¹ç›¸æ¯”ï¼Œåœ¨HDFSä¸­å­˜å‚¨åç§»é‡ä¸å¤ªå—æ¬¢è¿ï¼Œå› ä¸ºä¸å…¶ä»–ç³»ç»Ÿï¼ˆå¦‚ZooKeeperå’ŒHBaseï¼‰ç›¸æ¯”ï¼ŒHDFSå…·æœ‰æ›´é«˜çš„å»¶è¿Ÿã€‚æ­¤å¤–ï¼Œå¦‚æœç®¡ç†ä¸å½“ï¼Œåˆ™åœ¨HDFSä¸­ä¸ºæ¯ä¸ªæ‰¹æ¬¡ç¼–å†™offsetRangeså¯èƒ½ä¼šå¯¼è‡´æ–‡ä»¶è¾ƒå°çš„é—®é¢˜ã€‚ä¸ç®¡ç†offsetå½“ç„¶ï¼ŒSpark Streamingåº”ç”¨ç¨‹åºå¹¶ä¸æ˜¯å¿…é¡»çš„å»ç®¡ç†offsetã€‚å¯¹å½“å‰ä¸šåŠ¡è€ƒè™‘å¥½æ˜¯å¦éœ€è¦å¯¹offsetè¿›è¡Œä¿å­˜ã€‚æœ¬æ–‡å‚è€ƒå¦‚ä¸‹ï¼šOffset Management For Apache Kafka With Apache Spark Streaming","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"python - åç¨‹","slug":"python-åç¨‹","date":"2017-05-31T12:16:32.000Z","updated":"2020-04-04T11:03:54.388Z","comments":true,"path":"2017/05/31/python-åç¨‹/","link":"","permalink":"cpeixin.cn/2017/05/31/python-%E5%8D%8F%E7%A8%8B/","excerpt":"","text":"æ·±å…¥ç†è§£Pythonå¼‚æ­¥ç¼–ç¨‹æ¨èæ¨èæ¨èï¼ï¼ï¼ï¼åç¨‹ï¼ŒPython asyncioå¼‚æ­¥ç¼–ç¨‹ åªæ­¤ä¸€ç¯‡è¶³çŸ£ï¼Œä¸€è§ˆä¼—å±±å°ï¼é“¾æ¥","categories":[{"name":"python","slug":"python","permalink":"cpeixin.cn/categories/python/"}],"tags":[{"name":"python","slug":"python","permalink":"cpeixin.cn/tags/python/"}]},{"title":"python - ç”Ÿæˆå™¨ 2","slug":"python-ç”Ÿæˆå™¨-2","date":"2017-05-30T11:08:35.000Z","updated":"2020-04-04T17:14:25.836Z","comments":true,"path":"2017/05/30/python-ç”Ÿæˆå™¨-2/","link":"","permalink":"cpeixin.cn/2017/05/30/python-%E7%94%9F%E6%88%90%E5%99%A8-2/","excerpt":"","text":"ç”Ÿæˆå™¨è¿›åŒ–æˆåç¨‹ç”Ÿæˆå™¨æ˜¯ç”±è¿­ä»£å™¨è¿›åŒ–è€Œæ¥ï¼Œæ‰€ä»¥ç”Ÿæˆå™¨å¯¹è±¡æœ‰ iter å’Œ next æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ for å¾ªç¯è·å¾—å€¼ï¼Œæ³¨æ„è¿™é‡Œæ‰€è¯´çš„ â€œè·å¾—å€¼â€ æŒ‡çš„æ˜¯ä¸‹æ–‡ä»£ç å—é‡Œ yield è¯­å¥ä¸­ yield å…³é”®å­—åé¢çš„ i ã€‚è¿™æ˜¯åœ¨ Python 2.5 æ—¶å‡ºç°çš„ç‰¹æ€§ï¼Œåœ¨ Python 3.3 ä¸­å‡ºç° yield from è¯­æ³•ä¹‹å‰ï¼Œç”Ÿæˆå™¨æ²¡æœ‰å¤ªå¤§ç”¨é€”ã€‚ä½†æ­¤æ—¶ yield å…³é”®å­—è¿˜æ˜¯å®ç°äº†ä¸€äº›ç‰¹æ€§ï¼Œä¸”è‡³å…³é‡è¦ï¼Œå°±æ˜¯ç”Ÿæˆå™¨å¯¹è±¡æœ‰ send ã€throw å’Œ close æ–¹æ³•ã€‚è¿™ä¸‰ä¸ªæ–¹æ³•çš„ä½œç”¨åˆ†åˆ«æ˜¯å‘é€æ•°æ®ç»™ç”Ÿæˆå™¨å¹¶èµ‹å€¼ç»™ yield è¯­å¥ã€å‘ç”Ÿæˆå™¨ä¸­æŠ›å…¥å¼‚å¸¸ç”±ç”Ÿæˆå™¨å†…éƒ¨å¤„ç†ã€ç»ˆæ­¢ç”Ÿæˆå™¨ã€‚è¿™ä¸‰ä¸ªæ–¹æ³•ä½¿å¾—ç”Ÿæˆå™¨è¿›åŒ–æˆåç¨‹ã€‚åç¨‹æœ‰å››ç§å­˜åœ¨çŠ¶æ€ï¼šGEN_CREATED åˆ›å»ºå®Œæˆï¼Œç­‰å¾…æ‰§è¡ŒGEN_RUNNING è§£é‡Šå™¨æ­£åœ¨æ‰§è¡Œï¼ˆè¿™ä¸ªçŠ¶æ€åœ¨ä¸‹é¢çš„ç¤ºä¾‹ç¨‹åºä¸­æ— æ³•çœ‹åˆ°ï¼‰GEN_SUSPENDED åœ¨ yield è¡¨è¾¾å¼å¤„æš‚åœGEN_CLOSE æ‰§è¡Œç»“æŸï¼Œç”Ÿæˆå™¨åœæ­¢å¯ä»¥ä½¿ç”¨ inspect.getgeneratorstate æ–¹æ³•æŸ¥çœ‹åç¨‹çš„å½“å‰çŠ¶æ€ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼šinspectæ¨¡å—ç”¨äºæ”¶é›†pythonå¯¹è±¡çš„ä¿¡æ¯ï¼Œå¯ä»¥è·å–ç±»æˆ–å‡½æ•°çš„å‚æ•°çš„ä¿¡æ¯ï¼Œæºç ï¼Œè§£æå †æ ˆï¼Œå¯¹å¯¹è±¡è¿›è¡Œç±»å‹æ£€æŸ¥ç­‰ç­‰12345678910111213141516171819202122import inspectdef generator(): i = 'æ¿€æ´»ç”Ÿæˆå™¨' while True: try: value = yield i except ValueError: print('OVER') i = valueg = generator() # 1inspect.getgeneratorstate(g) # 2print(next(g)) # 3inspect.getgeneratorstate(g)print(g.send('Hello Shiyanlou')) # 4g.throw(ValueError) # 5g.close() # 6inspect.getgeneratorstate(g)ä»£ç è¯´æ˜å¦‚ä¸‹ï¼š1ã€åˆ›å»ºç”Ÿæˆå™¨2ã€æŸ¥çœ‹ç”Ÿæˆå™¨çŠ¶æ€3ã€è¿™æ­¥æ“ä½œå«åšé¢„æ¿€ç”Ÿæˆå™¨ï¼ˆæˆ–åç¨‹ï¼‰ï¼Œè¿™æ˜¯å¿…é¡»åšçš„ã€‚åœ¨ç”Ÿæˆå™¨åˆ›å»ºå®Œæˆåï¼Œéœ€è¦å°†å…¶ç¬¬ä¸€æ¬¡è¿è¡Œåˆ° yield è¯­å¥å¤„æš‚åœ4ã€æš‚åœçŠ¶æ€çš„ç”Ÿæˆå™¨å¯ä»¥ä½¿ç”¨ send æ–¹æ³•å‘é€æ•°æ®ï¼Œæ­¤æ–¹æ³•çš„å‚æ•°å°±æ˜¯ yield è¡¨è¾¾å¼çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ yield è¡¨è¾¾å¼ç­‰å·å‰é¢çš„ value å˜é‡çš„å€¼å˜æˆ â€˜Hello Shiyanlouâ€™ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œå®Œä¸€æ¬¡ while å¾ªç¯ï¼Œå˜é‡ i è¢«èµ‹å€¼ï¼Œç»§ç»­è¿è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œyield è¡¨è¾¾å¼å¼¹å‡ºå˜é‡ i5ã€å‘ç”Ÿæˆå™¨æŠ›å…¥å¼‚å¸¸ï¼Œå¼‚å¸¸ä¼šè¢« try except æ•è·ï¼Œä½œè¿›ä¸€æ­¥å¤„ç†6ã€close æ–¹æ³•ç»ˆæ­¢ç”Ÿæˆå™¨ï¼Œå¼‚å¸¸ä¸ä¼šè¢«æŠ›å‡ºå› ä¸ºç”Ÿæˆå™¨çš„è°ƒç”¨æ–¹ä¹Ÿå°±æ˜¯ç¨‹åºå‘˜è‡ªå·±å¯ä»¥æ§åˆ¶ç”Ÿæˆå™¨çš„å¯åŠ¨ã€æš‚åœã€ç»ˆæ­¢ï¼Œè€Œä¸”å¯ä»¥å‘ç”Ÿæˆå™¨å†…éƒ¨ä¼ å…¥æ•°æ®ï¼Œæ‰€ä»¥è¿™ç§ç”Ÿæˆå™¨åˆå«åšåç¨‹ï¼Œgenerator å‡½æ•°æ—¢å¯ä»¥å«åšç”Ÿæˆå™¨å‡½æ•°ï¼Œä¹Ÿå¯ä»¥å«åç¨‹å‡½æ•°ï¼Œè¿™æ˜¯ç”Ÿæˆå™¨å‘åç¨‹çš„è¿‡æ¸¡é˜¶æ®µã€‚yield -&gt; yield fromåœ¨ Python 3.3 ä¸­æ–°å¢äº† yield from è¯­æ³•ï¼Œå¦‚æœå°†yieldç†è§£æˆâ€œè¿”å›â€ï¼Œé‚£ä¹ˆyield fromå°±æ˜¯â€œä»ä»€ä¹ˆï¼ˆç”Ÿæˆå™¨ï¼‰é‡Œé¢è¿”å›â€,è¿™æ˜¯å…¨æ–°çš„è¯­è¨€ç»“æ„ï¼Œæ˜¯ yield çš„å‡çº§ç‰ˆã€‚ç›¸æ¯” yield ï¼Œè¯¥è¯­æ³•æœ‰ä¸¤å¤§ä¼˜åŠ¿ï¼Œæˆ‘ä»¬æ¥ä¸¾ä¾‹è¯´æ˜å®ƒçš„ç”¨æ³•ã€‚åŒºåˆ«ç¤ºä¾‹123456789101112def generator(): yield 'a' yield 'b' yield 'c' yield from generator1() #yield from iterableæœ¬è´¨ä¸Šç­‰äº for item in iterable: yield itemçš„ç¼©å†™ç‰ˆ yield from [11,22,33,44] yield from (12,23,34) yield from range(3) for i in generator(): print(i,end=' , ')é¿å…æ½œé€ƒå¾ªç¯yield:12345678910def chain(*args): for iter_obj in args: for i in iter_obj: yield ichain(&#123;'one', 'two'&#125;, list('ace'))for i in c: print(i)yield from:123456789def chain(*args): for iter_obj in args: yield from iter_objc = chain(&#123;'one', 'two'&#125;, list('ace'))for i in c: print(i)å¯ä»¥çœ‹åˆ° yield from è¯­å¥å¯ä»¥æ›¿ä»£ for å¾ªç¯ï¼Œé¿å…äº†åµŒå¥—å¾ªç¯ã€‚åŒ yield ä¸€æ ·ï¼Œyield from è¯­å¥ä¹Ÿåªèƒ½å‡ºç°åœ¨å‡½æ•°ä½“å†…éƒ¨ï¼Œæœ‰ yield from è¯­å¥çš„å‡½æ•°å«åšåç¨‹å‡½æ•°æˆ–ç”Ÿæˆå™¨å‡½æ•°ã€‚yield from åé¢æ¥æ”¶ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œä¾‹å¦‚ä¸Šé¢ä»£ç ä¸­çš„ iter_obj å˜é‡ï¼Œåœ¨åç¨‹ä¸­ï¼Œå¯è¿­ä»£å¯¹è±¡å¾€å¾€æ˜¯åç¨‹å¯¹è±¡ï¼Œè¿™æ ·å°±å½¢æˆäº†åµŒå¥—åç¨‹ã€‚è½¬ç§»æ§åˆ¶æƒ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960import timefrom faker import Fakerfrom functools import wraps# é¢„æ¿€åç¨‹è£…é¥°å™¨def coroutine(func): @wraps(func) def wrapper(*args, **kw): g = func(*args, **kw) next(g) return g return wrapper# å­ç”Ÿæˆå™¨å‡½æ•°ï¼Œè¿™ä¸ªç”Ÿæˆå™¨æ˜¯çœŸæ­£åšäº‹çš„ç”Ÿæˆå™¨def sub_coro(): l = [] # åˆ›å»ºç©ºåˆ—è¡¨ while True: # æ— é™å¾ªç¯ value = yield # è°ƒç”¨æ–¹ä½¿ç”¨ send æ–¹æ³•å‘ç”Ÿæ•°æ®å¹¶èµ‹å€¼ç»™ value å˜é‡ if value == 'CLOSE': # å¦‚æœè°ƒç”¨æ–¹å‘ç”Ÿçš„æ•°æ®æ˜¯ CLOSE ï¼Œç»ˆæ­¢å¾ªç¯ break l.append(value) # å‘åˆ—è¡¨æ·»åŠ æ•°æ® return sorted(l) # è¿”å›æ’åºåçš„åˆ—è¡¨# ä½¿ç”¨é¢„æ¿€åç¨‹è£…é¥°å™¨# å¸¦æœ‰ yield from è¯­å¥çš„çˆ¶ç”Ÿæˆå™¨å‡½æ•°@coroutinedef dele_coro(): # while True å¯ä»¥å¤šæ¬¡å¾ªç¯ï¼Œæ¯æ¬¡å¾ªç¯ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­ç”Ÿæˆå™¨ sub_coro() # è¿™é‡Œ while åªå¾ªç¯ä¸€æ¬¡ï¼Œè¿™æ˜¯ç”±è°ƒç”¨æ–¹ï¼Œä¹Ÿå°±æ˜¯ main å‡½æ•°å†³å®šçš„ # while å¾ªç¯å¯ä»¥æ•è·å‡½æ•°æœ¬èº«åˆ›å»ºçš„çˆ¶ç”Ÿæˆå™¨ç»ˆæ­¢æ—¶è§¦å‘çš„ StopIteration å¼‚å¸¸ while True: # yield from ä¼šè‡ªåŠ¨é¢„æ¿€å­ç”Ÿæˆå™¨ sub_coro() # æ‰€ä»¥ sub_coro åœ¨å®šä¹‰æ—¶ä¸å¯ä»¥ä½¿ç”¨é¢„æ¿€åç¨‹è£…é¥°å™¨ # yield from å°†æ•è·å­ç”Ÿæˆå™¨ç»ˆæ­¢æ—¶è§¦å‘çš„ StopIteration å¼‚å¸¸ # å¹¶å°†å¼‚å¸¸çš„ value å±æ€§å€¼èµ‹å€¼ç»™ç­‰å·å‰é¢çš„å˜é‡ l # ä¹Ÿå°±æ˜¯ l å˜é‡çš„å€¼ç­‰äº sub_coro å‡½æ•°çš„ return å€¼ # yield from è¿˜å®ç°äº†ä¸€ä¸ªé‡è¦åŠŸèƒ½ # å°±æ˜¯çˆ¶ç”Ÿæˆå™¨çš„ send æ–¹æ³•å°†å‘é€å€¼ç»™å­ç”Ÿæˆå™¨ # å¹¶èµ‹å€¼ç»™å­ç”Ÿæˆå™¨ä¸­ yield è¯­å¥ç­‰å·å‰é¢çš„å˜é‡ value l = yield from sub_coro() print('æ’åºåçš„åˆ—è¡¨ï¼š', l) print('------------------')# è°ƒç”¨çˆ¶ç”Ÿæˆå™¨çš„å‡½æ•°ï¼Œä¹Ÿå«è°ƒç”¨æ–¹def main(): # ç”Ÿæˆéšæœºå›½å®¶ä»£å·çš„æ–¹æ³• fake = Faker().country_code # åµŒå¥—åˆ—è¡¨ï¼Œæ¯ä¸ªå­åˆ—è¡¨ä¸­æœ‰ä¸‰ä¸ªéšæœºå›½å®¶ä»£å·(å­—ç¬¦ä¸²) nest_country_list = [[fake() for i in range(3)] for j in range(3)] for country_list in nest_country_list: print('å›½å®¶ä»£å·åˆ—è¡¨ï¼š', country_list) c = dele_coro() # åˆ›å»ºçˆ¶ç”Ÿæˆå™¨ for country in country_list: c.send(country) # çˆ¶ç”Ÿæˆå™¨çš„ send æ–¹æ³•å°†å›½å®¶ä»£å·å‘é€ç»™å­ç”Ÿæˆå™¨ # CLOSE å°†ç»ˆæ­¢å­ç”Ÿæˆå™¨ä¸­çš„ while å¾ªç¯ # å­ç”Ÿæˆå™¨çš„ return å€¼èµ‹å€¼ç»™çˆ¶ç”Ÿæˆå™¨ yield from è¯­å¥ä¸­ç­‰å·å‰é¢çš„å˜é‡ l c.send('CLOSE')if __name__ == '__main__': main()æ‰€è°“ â€œè½¬ç§»æ§åˆ¶æƒâ€ å°±æ˜¯ yield from è¯­æ³•å¯ä»¥å°†å­ç”Ÿæˆå™¨çš„æ§åˆ¶æƒäº¤ç»™è°ƒç”¨æ–¹ main å‡½æ•°ï¼Œåœ¨ main å‡½æ•°å†…éƒ¨åˆ›å»ºçˆ¶ç”Ÿæˆå™¨ c ï¼Œæ§åˆ¶ c.send æ–¹æ³•ä¼ å€¼ç»™å­ç”Ÿæˆå™¨ã€‚è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„è¿›æ­¥ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼ŒPython 3.4 æ–°å¢äº†åˆ›å»ºåç¨‹çš„è£…é¥°å™¨ï¼Œè¿™æ ·éç”Ÿæˆå™¨å‡½æ•°çš„åç¨‹å‡½æ•°å°±æ­£å¼å‡ºç°äº†ã€‚","categories":[{"name":"python","slug":"python","permalink":"cpeixin.cn/categories/python/"}],"tags":[{"name":"python","slug":"python","permalink":"cpeixin.cn/tags/python/"}]},{"title":"python - ç”Ÿæˆå™¨","slug":"python-ç”Ÿæˆå™¨","date":"2017-05-28T12:07:35.000Z","updated":"2020-04-04T17:13:37.299Z","comments":true,"path":"2017/05/28/python-ç”Ÿæˆå™¨/","link":"","permalink":"cpeixin.cn/2017/05/28/python-%E7%94%9F%E6%88%90%E5%99%A8/","excerpt":"","text":"å‰è¨€åœ¨å¼€å§‹è®²è§£åç¨‹å’Œç”Ÿæˆå™¨ä¹‹å‰ï¼Œè¯´æ˜ä¸€ä¸‹åç¨‹å’Œç”Ÿæˆå™¨ä¹‹é—´çš„å…³ç³»æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œç”Ÿæˆå™¨åœ¨å­¦ä¹ pythonçš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰æ·±å…¥çš„å­¦ä¹ ï¼Œæ‰€ä»¥æ„Ÿè§‰å¾ˆæŠ½è±¡å¾ˆéš¾æ‡‚ï¼Œå’Œæ™®é€šå‡½æ•°å•å‘è°ƒç”¨çš„é€»è¾‘æ€ç»´å¹¶ä¸ä¸€æ ·ã€‚åç¨‹åˆ™æ˜¯å’Œçº¿ç¨‹ï¼Œè¿›ç¨‹æ˜¯åŒä¸€ç±»åˆ«çš„æ¦‚å¿µã€‚é¦–å…ˆè¦è®¤è¯†yieldå…³é”®å­—ï¼Œæ˜¯yieldå…³é”®è¯ï¼Œyieldæ”¾åœ¨å‡½æ•°ä¸­å¯ä»¥ä½¿å¾—å‡½æ•°å˜æˆç”Ÿæˆå™¨ï¼Œä¹Ÿå¯ä»¥å˜æˆåç¨‹ã€‚åœ¨ç”Ÿæˆå™¨ä¸­, yield åªå¯¹å¤–äº§å‡ºå€¼ï¼Œåœ¨åç¨‹ä¸­ï¼Œyieldèƒ½å¯¹å¤–äº§å‡ºå€¼ï¼Œè€Œä¸”èƒ½æ¥æ”¶é€šè¿‡send()æ–¹æ³•ä¼ å…¥å€¼yielldæ„é€ çš„ç”Ÿæˆå™¨å¯ä»¥ä½œä¸ºåç¨‹ä½¿ç”¨ï¼Œåç¨‹æ˜¯æŒ‡ä¸€ä¸ªè¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸è°ƒç”¨æ–¹åä½œï¼Œç”±è°ƒç”¨æ–¹æä¾›çš„å€¼ï¼Œæ¥è®¡ç®—å¹¶äº§å‡ºã€‚çº¯ç²¹çš„ç”Ÿï¼Œè¿™æ ·å¯ä»¥äº¤æ¥ç»™forè°ƒç”¨ã€‚æˆå™¨åªè¾“å‡ºå€¼ï¼Œå’Œè¿­ä»£æœ‰å…³åç¨‹ä¸å‡½æ•°çš„åŒºåˆ«ï¼Œå‡½æ•°æ˜¯ä¸€ç§ä¸Šä¸‹çº§è°ƒç”¨å…³ç³»ï¼Œè€Œåç¨‹æ˜¯é€šè¿‡_yield_æ–¹å¼è½¬ç§»æ‰§è¡Œæƒï¼Œå¯¹ç§°è€Œå¹³çº§çš„è°ƒç”¨å¯¹æ–¹ï¼Œå…¸å‹çš„æœ‰ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚ä»è°ƒè¯•è¿‡ç¨‹ä¸­ç†è§£åŒºåˆ«äºå…¶ä»–æ•™ç¨‹ï¼Œå‰å‡ æ®µéƒ½æ˜¯äº‘é‡Œé›¾é‡Œçš„è®²æ¦‚å¿µï¼Œä½†æ˜¯å¯¹äºç”Ÿæˆå™¨ï¼Œä¸€ä¸Šæ¥å°±çœ‹æ¦‚å¿µï¼ŒçœŸçš„å¾ˆéš¾æ‡‚ã€‚æ‰€ä»¥æˆ‘å‡†å¤‡äº†ä¸‰ä¸ªå®ä¾‹ï¼Œå»ºè®®ä¸Šæ¥å…ˆé€šè¿‡æ‰“æ–­ç‚¹ï¼Œåˆ†æ­¥è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡çœ‹è°ƒç”¨é¡ºåºå’Œè¿”å›å€¼æ¥åˆæ­¥äº†è§£ç”Ÿæˆå™¨çš„åŸç†ï¼Œæ¥ä¸‹æ¥åœ¨çœ‹æ¦‚å¿µè§£é‡Šï¼Œåˆ™æ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚1234567891011121314151617# encoding:UTF-8def yield_test(n): for i in range(n): yield call(i) print(\"i=\", i) # åšä¸€äº›å…¶å®ƒçš„äº‹æƒ… print(\"do something.\") print(\"end.\")def call(i): return i * 2# ä½¿ç”¨forå¾ªç¯for i in yield_test(5): print(i, \",\")ä¸‹å›¾æ˜¯æ‰“æ–­ç‚¹è°ƒè¯•çš„è¿‡ç¨‹ï¼Œå…¶ä¸­ç¨‹åºæ³¨é‡Šä¸­ä¼šæ ‡æ³¨ï¼Œè¿è¡Œæ­¥éª¤é¡ºåºï¼Œç”¨step xæ¥è¡¨ç¤º123456789101112131415161718192021def consumer(): r = '' while True: n = yield r if not n: return print('[CONSUMER] Consuming %s...' % n) r = '200 OK'def produce(c): c.send(None) n = 0 while n &lt; 5: n = n + 1 print('[PRODUCER] Producing %s...' % n) r = c.send(n) print('[PRODUCER] Consumer return: %s' % r) c.close()c = consumer()produce(c)ä¸‹å›¾æ˜¯æ‰“æ–­ç‚¹è°ƒè¯•çš„è¿‡ç¨‹ï¼Œå…¶ä¸­ç¨‹åºæ³¨é‡Šä¸­ä¼šæ ‡æ³¨ï¼Œè¿è¡Œæ­¥éª¤é¡ºåºï¼Œç”¨step xæ¥è¡¨ç¤º12345678910def h(): print 'Wen Chuan', m = yield 5 print m d = yield 12 print 'We are together!'c = h()m = c.__next__() c.send('Fighting!')ä¸‹å›¾æ˜¯æ‰“æ–­ç‚¹è°ƒè¯•çš„è¿‡ç¨‹ï¼Œå…¶ä¸­ç¨‹åºæ³¨é‡Šä¸­ä¼šæ ‡æ³¨ï¼Œè¿è¡Œæ­¥éª¤é¡ºåºï¼Œç”¨step xæ¥è¡¨ç¤ºç»è¿‡ä¸Šé¢çš„ä¸‰ä¸ªç¨‹åºçš„è°ƒè¯•æ­¥éª¤åï¼Œä¸‹é¢å¼€å§‹å¸¦ç€å¿ƒä¸­åˆæ­¥äº†è§£çš„ç¨‹åºè¿è¡Œé¡ºåºæ¥çœ‹ç”Ÿæˆå™¨ç›¸å…³çš„åŸç†ç”Ÿæˆå™¨whatç”Ÿæˆå™¨æ˜¯ä¸€æ¬¡ç”Ÿæˆä¸€ä¸ªå€¼çš„ç‰¹æ®Šç±»å‹å‡½æ•°ã€‚å¯ä»¥å°†å…¶è§†ä¸ºå¯æ¢å¤å‡½æ•°ã€‚è°ƒç”¨è¯¥å‡½æ•°å°†è¿”å›ä¸€ä¸ªå¯ç”¨äºç”Ÿæˆè¿ç»­ x å€¼çš„ç”Ÿæˆã€Generatorã€‘ï¼Œç®€å•çš„è¯´å°±æ˜¯åœ¨å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œyieldè¯­å¥ä¼šæŠŠä½ éœ€è¦çš„å€¼è¿”å›ç»™è°ƒç”¨ç”Ÿæˆå™¨çš„åœ°æ–¹ï¼Œç„¶åé€€å‡ºå‡½æ•°ï¼Œä¸‹ä¸€æ¬¡è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°çš„æ—¶å€™åˆä»ä¸Šæ¬¡ä¸­æ–­çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œï¼Œè€Œç”Ÿæˆå™¨å†…çš„æ‰€æœ‰å˜é‡å‚æ•°éƒ½ä¼šè¢«ä¿å­˜ä¸‹æ¥ä¾›ä¸‹ä¸€æ¬¡ä½¿ç”¨ã€‚whyåˆ—è¡¨æ‰€æœ‰æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœæœ‰æµ·é‡æ•°æ®çš„è¯å°†ä¼šéå¸¸è€—å†…å­˜ã€‚å¦‚ï¼šä»…ä»…éœ€è¦è®¿é—®å‰é¢å‡ ä¸ªå…ƒç´ ï¼Œé‚£åé¢ç»å¤§å¤šæ•°å…ƒç´ å ç”¨çš„ç©ºé—´éƒ½ç™½ç™½æµªè´¹äº†ã€‚å¦‚æœåˆ—è¡¨å…ƒç´ æŒ‰ç…§æŸç§ç®—æ³•æ¨ç®—å‡ºæ¥ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥åœ¨å¾ªç¯çš„è¿‡ç¨‹ä¸­ä¸æ–­æ¨ç®—å‡ºåç»­çš„å…ƒç´ ï¼Œè¿™æ ·å°±ä¸å¿…åˆ›å»ºå®Œæ•´çš„listï¼Œä»è€ŒèŠ‚çœå¤§é‡çš„ç©ºé—´ã€‚ç®€å•ä¸€å¥è¯ï¼šæˆ‘åˆæƒ³è¦å¾—åˆ°åºå¤§çš„æ•°æ®ï¼Œåˆæƒ³è®©å®ƒå ç”¨ç©ºé—´å°‘ï¼Œé‚£å°±ç”¨ç”Ÿæˆå™¨ï¼Howæ–¹æ³•ä¸€123456&gt;&gt;&gt; L = [x * x for x in range(10)]&gt;&gt;&gt; L[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]&gt;&gt;&gt; g = (x * x for x in range(10))&gt;&gt;&gt; g&lt;generator object &lt;genexpr&gt; at 0x1022ef630&gt;æ–¹æ³•äºŒå¦‚æœä¸€ä¸ªå‡½æ•°ä¸­åŒ…å«yieldå…³é”®å­—ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±ä¸å†æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªgeneratorã€‚è°ƒç”¨å‡½æ•°å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰å¯¹è±¡ã€‚yieldå…³é”®å­—yield çš„ç”¨æ³•èµ·æºäºå¯¹ä¸€èˆ¬ function ä¸­ return çš„æ‰©å±•ã€‚åœ¨ä¸€ä¸ª function ä¸­ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªè¿”å›å€¼åˆ—äº return ä¹‹åï¼Œå¯ä»¥è¿”å›æ•°å­—ä¹Ÿå¯ä»¥è¿”å›ç©ºå€¼ï¼Œä½†æ˜¯å¿…é¡»è¦æœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œæ ‡å¿—ç€è¿™ä¸ª function çš„ç»“æŸã€‚ä¸€æ—¦å®ƒç»“æŸï¼Œé‚£ä¹ˆè¿™ä¸ª function ä¸­äº§ç”Ÿçš„ä¸€åˆ‡å˜é‡å°†è¢«ç»Ÿç»ŸæŠ›å¼ƒï¼Œæœ‰ä»€ä¹ˆå¯ä»¥ä½¿ä¸€ä¸ª function æš‚åœä¸‹æ¥ï¼Œå¹¶ä¸”è¿”å›å½“å‰æ‰€åœ¨åœ°æ–¹çš„å€¼ï¼Œå½“æ¥æ”¶åˆ°ç»§ç»­çš„å‘½ä»¤æ—¶å¯ä»¥ç»§ç»­å‰è¿›å‘¢ï¼Ÿæ¢ä¸ªè¯´æ³•ï¼Œå°±æ˜¯ return è¿”å›ä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”è®°ä½è¿™ä¸ªè¿”å›çš„ä½ç½®ã€‚è¿™ä¸ªæ“ä½œæœ‰ç‚¹å„¿åƒPython2.5ä»¥å‰ï¼Œyieldæ˜¯ä¸€ä¸ªè¯­å¥ï¼Œä½†ç°åœ¨2.5ä¸­ï¼Œyieldæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼(Expression)ï¼Œæ¯”å¦‚ï¼š1m = yield 5å¤§å®¶ä¸è¦è®¤ä¸ºï¼Œmå€¼ä¸º5ï¼Œè€Œæ˜¯è¡¨è¾¾å¼(yield 5)çš„è¿”å›å€¼å°†èµ‹å€¼ç»™mï¼Œé‚£ä¹ˆyield 5çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿyield 5çš„è¿”å›å€¼æ˜¯ä¸‹é¢å°†è¦æåˆ°çš„send(msg)æ–¹æ³•ä¼ é€’è¿‡æ¥çš„msgå‚æ•°ã€‚ç”Ÿæˆå™¨çš„å·¥ä½œåŸç†ç”Ÿæˆå™¨(generator)èƒ½å¤Ÿè¿­ä»£çš„å…³é”®æ˜¯å®ƒæœ‰ä¸€ä¸ª next() æ–¹æ³• ã€‚ å·¥ä½œåŸç†å°±æ˜¯é€šè¿‡é‡å¤è°ƒç”¨next()æ–¹æ³•ï¼Œç›´åˆ°æ•è·ä¸€ä¸ªå¼‚å¸¸ã€‚å¸¦æœ‰ yield çš„å‡½æ•°ä¸å†æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨generatorã€‚å¯ç”¨next()è°ƒç”¨ç”Ÿæˆå™¨å¯¹è±¡æ¥å–å€¼ã€‚next ä¸¤ç§æ–¹å¼ t.next() | next(t)ã€‚ å¯ç”¨for å¾ªç¯è·å–è¿”å›å€¼ï¼ˆæ¯æ‰§è¡Œä¸€æ¬¡ï¼Œå–ç”Ÿæˆå™¨é‡Œé¢ä¸€ä¸ªå€¼ï¼‰ ï¼ˆåŸºæœ¬ä¸Šä¸ä¼šç”¨next()æ¥è·å–ä¸‹ä¸€ä¸ªè¿”å›å€¼ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨forå¾ªç¯æ¥è¿­ä»£ï¼‰ã€‚yieldç›¸å½“äº return è¿”å›ä¸€ä¸ªå€¼ï¼Œ_è¿­ä»£ä¸€æ¬¡é‡åˆ°yieldæ—¶å°±è¿”å›yieldåé¢(å³è¾¹)çš„å€¼_ã€‚å¹¶ä¸”è®°ä½è¿™ä¸ªè¿”å›çš„ä½ç½®ï¼Œä¸‹æ¬¡è¿­ä»£æ—¶ï¼Œä»£ç ä»yieldçš„_ä¸‹ä¸€æ¡_è¯­å¥å¼€å§‹æ‰§è¡Œã€‚send() å’Œnext()ä¸€æ ·ï¼Œéƒ½èƒ½è®©ç”Ÿæˆå™¨ç»§ç»­å¾€ä¸‹èµ°ä¸€æ­¥ï¼ˆä¸‹æ¬¡é‡åˆ°yieldåœï¼‰ï¼Œsend()èƒ½ä¼ ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼ä½œä¸ºyieldè¡¨è¾¾å¼ç­‰å·å·¦è¾¹çš„å€¼ã€‚â€”â€”æ¢å¥è¯è¯´ï¼Œå°±æ˜¯sendå¯ä»¥å¼ºè¡Œä¿®æ”¹ä¸Šä¸€ä¸ªyieldè¡¨è¾¾å¼å€¼ã€‚æ¯”å¦‚å‡½æ•°ä¸­æœ‰ä¸€ä¸ªyieldèµ‹å€¼ï¼Œa = yieldç¬¬ä¸€æ¬¡è¿­ä»£åˆ°è¿™é‡Œä¼šè¿”å›5ï¼Œaè¿˜æ²¡æœ‰èµ‹å€¼ã€‚ç¬¬äºŒæ¬¡è¿­ä»£æ—¶ï¼Œä½¿ç”¨.send(10)ï¼Œé‚£ä¹ˆï¼Œå°±æ˜¯å¼ºè¡Œä¿®æ”¹yield 5è¡¨è¾¾å¼çš„å€¼ä¸º10ï¼Œæœ¬æ¥æ˜¯5çš„ï¼Œé‚£ä¹ˆa=10send(msg)ä¸next()éƒ½æœ‰è¿”å›å€¼ï¼Œå®ƒä»¬çš„è¿”å›å€¼æ˜¯å½“å‰è¿­ä»£é‡åˆ°yieldæ—¶ï¼Œyieldåé¢è¡¨è¾¾å¼çš„å€¼ï¼Œå…¶å®å°±æ˜¯å½“å‰è¿­ä»£ä¸­yieldåé¢çš„å‚æ•°ã€‚æ„Ÿå—ä¸‹yieldè¿”å›å€¼çš„è¿‡ç¨‹ï¼ˆå…³æ³¨ç‚¹ï¼šæ¯æ¬¡åœåœ¨å“ªï¼Œä¸‹æ¬¡åˆå¼€å§‹åœ¨å“ªï¼‰åŠsend()ä¼ å‚çš„é€šè®¯è¿‡ç¨‹ç”Ÿæˆå™¨è¿˜å¯ä»¥ä½¿ç”¨ next æ–¹æ³•è¿­ä»£ã€‚ç”Ÿæˆå™¨ä¼šåœ¨ yield è¯­å¥å¤„æš‚åœï¼Œè¿™æ˜¯è‡³å…³é‡è¦çš„ï¼Œæœªæ¥åç¨‹ä¸­çš„ IO é˜»å¡å°±å‡ºç°åœ¨è¿™é‡Œã€‚","categories":[{"name":"python","slug":"python","permalink":"cpeixin.cn/categories/python/"}],"tags":[{"name":"python","slug":"python","permalink":"cpeixin.cn/tags/python/"}]},{"title":"python - å¤šè¿›ç¨‹","slug":"python-å¤šè¿›ç¨‹","date":"2017-05-26T15:10:35.000Z","updated":"2020-04-04T11:05:03.269Z","comments":true,"path":"2017/05/26/python-å¤šè¿›ç¨‹/","link":"","permalink":"cpeixin.cn/2017/05/26/python-%E5%A4%9A%E8%BF%9B%E7%A8%8B/","excerpt":"","text":"å¤šçº¿ç¨‹ï¼š åŒä¸€è¿›ç¨‹ä¸­ï¼Œåˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œæ‰§è¡Œæ·»åŠ çš„ä»»åŠ¡åˆ—è¡¨å¤šè¿›ç¨‹ï¼š åˆ›å»ºä»»æ„ä¸ªè¿›ç¨‹ï¼Œå„è‡ªæ‰§è¡Œæ·»åŠ çš„ä»»åŠ¡åˆ—è¡¨å‡å¦‚cpuåªæœ‰ä¸€ä¸ªï¼ˆæ—©æœŸçš„è®¡ç®—æœºç¡®å®å¦‚æ­¤ï¼‰ï¼Œä¹Ÿèƒ½ä¿è¯æ”¯æŒï¼ˆä¼ªï¼‰å¹¶å‘çš„èƒ½åŠ›ï¼Œå°†ä¸€ä¸ªå•ç‹¬çš„cpuå˜æˆå¤šä¸ªè™šæ‹Ÿçš„cpuï¼ˆå¤šé“æŠ€æœ¯ï¼šæ—¶é—´å¤šè·¯å¤ç”¨å’Œç©ºé—´å¤šè·¯å¤ç”¨+ç¡¬ä»¶ä¸Šæ”¯æŒéš”ç¦»ï¼‰ï¼Œæ²¡æœ‰è¿›ç¨‹çš„æŠ½è±¡ï¼Œç°ä»£è®¡ç®—æœºå°†ä¸å¤å­˜åœ¨ã€‚å¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œä¸€ä¸ªä»»åŠ¡å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼ˆProcessï¼‰ï¼Œæ¯”å¦‚æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨å°±æ˜¯å¯åŠ¨ä¸€ä¸ªæµè§ˆå™¨è¿›ç¨‹ï¼Œæ‰“å¼€ä¸€ä¸ªè®°äº‹æœ¬å°±å¯åŠ¨äº†ä¸€ä¸ªè®°äº‹æœ¬è¿›ç¨‹ï¼Œæ‰“å¼€ä¸¤ä¸ªè®°äº‹æœ¬å°±å¯åŠ¨äº†ä¸¤ä¸ªè®°äº‹æœ¬è¿›ç¨‹ï¼Œæ‰“å¼€ä¸€ä¸ªWordå°±å¯åŠ¨äº†ä¸€ä¸ªWordè¿›ç¨‹ã€‚æœ‰äº›è¿›ç¨‹è¿˜ä¸æ­¢åŒæ—¶å¹²ä¸€ä»¶äº‹ï¼Œæ¯”å¦‚Wordï¼Œå®ƒå¯ä»¥åŒæ—¶è¿›è¡Œæ‰“å­—ã€æ‹¼å†™æ£€æŸ¥ã€æ‰“å°ç­‰äº‹æƒ…ã€‚åœ¨ä¸€ä¸ªè¿›ç¨‹å†…éƒ¨ï¼Œè¦åŒæ—¶å¹²å¤šä»¶äº‹ï¼Œå°±éœ€è¦åŒæ—¶è¿è¡Œå¤šä¸ªâ€œå­ä»»åŠ¡â€ï¼Œæˆ‘ä»¬æŠŠè¿›ç¨‹å†…çš„è¿™äº›â€œå­ä»»åŠ¡â€ç§°ä¸ºçº¿ç¨‹ï¼ˆThreadï¼‰ã€‚ç”±äºæ¯ä¸ªè¿›ç¨‹è‡³å°‘è¦å¹²ä¸€ä»¶äº‹ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚å½“ç„¶ï¼ŒåƒWordè¿™ç§å¤æ‚çš„è¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ‰§è¡Œï¼Œå¤šçº¿ç¨‹çš„æ‰§è¡Œæ–¹å¼å’Œå¤šè¿›ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿæ˜¯ç”±æ“ä½œç³»ç»Ÿåœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å¿«é€Ÿåˆ‡æ¢ï¼Œè®©æ¯ä¸ªçº¿ç¨‹éƒ½çŸ­æš‚åœ°äº¤æ›¿è¿è¡Œï¼Œçœ‹èµ·æ¥å°±åƒåŒæ—¶æ‰§è¡Œä¸€æ ·ã€‚å½“ç„¶ï¼ŒçœŸæ­£åœ°åŒæ—¶æ‰§è¡Œå¤šçº¿ç¨‹éœ€è¦å¤šæ ¸CPUæ‰å¯èƒ½å®ç°ã€‚å¦‚æœæˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨ç¨‹åºä¸­åŠ å…¥è¿›ç¨‹ï¼Œçº¿ç¨‹ï¼Œåç¨‹ç­‰ï¼Œç¨‹åºéƒ½æ˜¯æ‰§è¡Œå•ä»»åŠ¡çš„è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚å¦‚æœæˆ‘ä»¬è¦åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡æ€ä¹ˆåŠï¼Ÿæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šä¸€ç§æ˜¯å¯åŠ¨å¤šä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹è™½ç„¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä½†å¤šä¸ªè¿›ç¨‹å¯ä»¥ä¸€å—æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œåœ¨ä¸€ä¸ªè¿›ç¨‹å†…å¯åŠ¨å¤šä¸ªçº¿ç¨‹ï¼Œè¿™æ ·ï¼Œå¤šä¸ªçº¿ç¨‹ä¹Ÿå¯ä»¥ä¸€å—æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚å½“ç„¶è¿˜æœ‰ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œå°±æ˜¯å¯åŠ¨å¤šä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹å†å¯åŠ¨å¤šä¸ªçº¿ç¨‹ï¼Œè¿™æ ·åŒæ—¶æ‰§è¡Œçš„ä»»åŠ¡å°±æ›´å¤šäº†ï¼Œå½“ç„¶è¿™ç§æ¨¡å‹æ›´å¤æ‚ï¼Œå®é™…å¾ˆå°‘é‡‡ç”¨ã€‚æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼Œå¤šä»»åŠ¡çš„å®ç°æœ‰3ç§æ–¹å¼ï¼šå¤šè¿›ç¨‹æ¨¡å¼ï¼›å¤šçº¿ç¨‹æ¨¡å¼ï¼›å¤šè¿›ç¨‹+å¤šçº¿ç¨‹æ¨¡å¼ã€‚åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡é€šå¸¸å„ä¸ªä»»åŠ¡ä¹‹é—´å¹¶ä¸æ˜¯æ²¡æœ‰å…³è”çš„ï¼Œè€Œæ˜¯éœ€è¦ç›¸äº’é€šä¿¡å’Œåè°ƒï¼Œæœ‰æ—¶ï¼Œä»»åŠ¡1å¿…é¡»æš‚åœç­‰å¾…ä»»åŠ¡2å®Œæˆåæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œæœ‰æ—¶ï¼Œä»»åŠ¡3å’Œä»»åŠ¡4åˆä¸èƒ½åŒæ—¶æ‰§è¡Œï¼Œæ‰€ä»¥ï¼Œå¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹çš„ç¨‹åºçš„å¤æ‚åº¦è¦è¿œè¿œé«˜äºæˆ‘ä»¬å‰é¢å†™çš„å•è¿›ç¨‹å•çº¿ç¨‹çš„ç¨‹åºã€‚å› ä¸ºå¤æ‚åº¦é«˜ï¼Œè°ƒè¯•å›°éš¾ï¼Œæ‰€ä»¥ï¼Œä¸æ˜¯è¿«ä¸å¾—å·²ï¼Œæˆ‘ä»¬ä¹Ÿä¸æƒ³ç¼–å†™å¤šä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œæœ‰å¾ˆå¤šæ—¶å€™ï¼Œæ²¡æœ‰å¤šä»»åŠ¡è¿˜çœŸä¸è¡Œã€‚æƒ³æƒ³åœ¨ç”µè„‘ä¸Šçœ‹ç”µå½±ï¼Œå°±å¿…é¡»ç”±ä¸€ä¸ªçº¿ç¨‹æ’­æ”¾è§†é¢‘ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ’­æ”¾éŸ³é¢‘ï¼Œå¦åˆ™ï¼Œå•çº¿ç¨‹å®ç°çš„è¯å°±åªèƒ½å…ˆæŠŠè§†é¢‘æ’­æ”¾å®Œå†æ’­æ”¾éŸ³é¢‘ï¼Œæˆ–è€…å…ˆæŠŠéŸ³é¢‘æ’­æ”¾å®Œå†æ’­æ”¾è§†é¢‘ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸è¡Œçš„ã€‚ä»€ä¹ˆæ—¶å€™ç”¨å¤šè¿›ç¨‹1.å¤šçº¿ç¨‹ä½¿ç”¨åœºæ™¯ï¼šIOå¯†é›†å‹2.å¤šè¿›ç¨‹ä½¿ç”¨åœºæ™¯ï¼šCPUå¯†é›†å‹æ¶‰åŠå¹¶å‘çš„åœºæ™¯ï¼Œå¤§å®¶æƒ³åˆ°ä½¿ç”¨å¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹è§£å†³å¹¶å‘é—®é¢˜;ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè§£å†³å¤šå¹¶å‘åœºæ™¯é—®é¢˜ï¼Œå¤šæ•°è¯­è¨€é‡‡ç”¨å¤šçº¿ç¨‹ç¼–ç¨‹æ¨¡å¼(çº¿ç¨‹æ˜¯è½»é‡çº§çš„è¿›ç¨‹ï¼Œå…±ç”¨ä¸€ä»½è¿›ç¨‹ç©ºé—´)ã€‚ä¹ŸåŒæ ·é€‚ç”¨äºPythonå¤šå¹¶å‘å¤„ç†å—? ä¸æ˜¯çš„ï¼Œé’ˆå¯¹å¹¶å‘å¤„ç†ï¼ŒPythonå¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹æ˜¯æœ‰å¾ˆå¤§å·®å¼‚çš„!Pythonå¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹å·®å¼‚Pythonå¤šçº¿ç¨‹ä¸èƒ½ä½¿ç”¨CPUå¤šæ ¸èµ„æºï¼Œå³åŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨CPUèµ„æºï¼Œæ‰€ä»¥ä½¿ç”¨Pythonå¤šçº¿ç¨‹ä¸èƒ½ç®—æ˜¯å¹¶å‘ã€‚å¦‚æœæƒ³è¦å……åˆ†åˆ©ç”¨CPUå¤šæ ¸èµ„æºï¼Œåšåˆ°å¤šå¹¶å‘ï¼Œè¿™å°±éœ€è¦Pythonå¤šè¿›ç¨‹çš„äº†!ä¹Ÿå°±æ˜¯è¯´ï¼šåªæœ‰Pythonå¤šè¿›ç¨‹æ‰èƒ½åˆ©ç”¨CPUå¤šæ ¸èµ„æºï¼Œåšåˆ°çœŸæ­£çš„å¤šå¹¶å‘!Pythonå¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹åº”ç”¨åœºæ™¯Pythonå¤šçº¿ç¨‹é€‚ç”¨äºI/Oå¯†é›†å‹åœºæ™¯ï¼Œå¦‚è§£å†³ç½‘ç»œIOã€ç£ç›˜IOé˜»å¡é—®é¢˜ï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œæ•°æ®ä¼ è¾“ç­‰;è€ŒPythonå¤šè¿›ç¨‹æ›´é€‚ç”¨äºè®¡ç®—å¯†é›†å‹åœºæ™¯ï¼Œå¤šå¹¶å‘ï¼Œå¤§é‡è®¡ç®—ä»»åŠ¡ç­‰ã€‚æ³¨æ„ï¼šPythonå¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹åœ¨å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ³¨æ„ä½¿ç”¨ï¼Œå¦‚æœä½¿ç”¨Pythonå¤šçº¿ç¨‹æ–¹å¼å¤„ç†è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œå®ƒæ¯”å®é™…å•è¿›ç¨‹å¤„ç†æ€§èƒ½è¿˜è¦æ…¢!æ‰€ä»¥è¦æ³¨æ„ï¼Œçœ‹åœºæ™¯ç±»å‹ã€‚å¤šè¿›ç¨‹-fork()Unix/Linuxæ“ä½œç³»ç»Ÿæä¾›äº†ä¸€ä¸ªfork()ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒéå¸¸ç‰¹æ®Šã€‚æ™®é€šçš„å‡½æ•°è°ƒç”¨ï¼Œè°ƒç”¨ä¸€æ¬¡ï¼Œè¿”å›ä¸€æ¬¡ï¼Œä½†æ˜¯fork()è°ƒç”¨ä¸€æ¬¡ï¼Œè¿”å›ä¸¤æ¬¡ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿè‡ªåŠ¨æŠŠå½“å‰è¿›ç¨‹ï¼ˆç§°ä¸ºçˆ¶è¿›ç¨‹ï¼‰å¤åˆ¶äº†ä¸€ä»½ï¼ˆç§°ä¸ºå­è¿›ç¨‹ï¼‰ï¼Œç„¶åï¼Œåˆ†åˆ«åœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹å†…è¿”å›ã€‚å­è¿›ç¨‹æ°¸è¿œè¿”å›0ï¼Œè€Œçˆ¶è¿›ç¨‹è¿”å›å­è¿›ç¨‹çš„IDã€‚è¿™æ ·åšçš„ç†ç”±æ˜¯ï¼Œä¸€ä¸ªçˆ¶è¿›ç¨‹å¯ä»¥forkå‡ºå¾ˆå¤šå­è¿›ç¨‹ï¼Œæ‰€ä»¥ï¼Œçˆ¶è¿›ç¨‹è¦è®°ä¸‹æ¯ä¸ªå­è¿›ç¨‹çš„IDï¼Œè€Œå­è¿›ç¨‹åªéœ€è¦è°ƒç”¨getppid()å°±å¯ä»¥æ‹¿åˆ°çˆ¶è¿›ç¨‹çš„IDã€‚Pythonçš„osæ¨¡å—å°è£…äº†å¸¸è§çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå…¶ä¸­å°±åŒ…æ‹¬forkï¼Œå¯ä»¥åœ¨Pythonç¨‹åºä¸­è½»æ¾åˆ›å»ºå­è¿›ç¨‹ï¼š123456789import osprint('Process (%s) start...' % os.getpid())# Only works on Unix/Linux/Mac:pid = os.fork()if pid == 0: print('I am child process (%s) and my parent is %s.' % (os.getpid(), os.getppid()))else: print('I (%s) just created a child process (%s).' % (os.getpid(), pid))ç»“æœï¼š123Process (876) start...I (876) just created a child process (877).I am child process (877) and my parent is 876.ç”±äºWindowsæ²¡æœ‰forkè°ƒç”¨ï¼Œä¸Šé¢çš„ä»£ç åœ¨Windowsä¸Šæ— æ³•è¿è¡Œã€‚ç”±äºMacç³»ç»Ÿæ˜¯åŸºäºBSDï¼ˆUnixçš„ä¸€ç§ï¼‰å†…æ ¸ï¼Œæ‰€ä»¥ï¼Œåœ¨Macä¸‹è¿è¡Œæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œæ¨èå¤§å®¶ç”¨Macå­¦Pythonï¼æœ‰äº†forkè°ƒç”¨ï¼Œä¸€ä¸ªè¿›ç¨‹åœ¨æ¥åˆ°æ–°ä»»åŠ¡æ—¶å°±å¯ä»¥å¤åˆ¶å‡ºä¸€ä¸ªå­è¿›ç¨‹æ¥å¤„ç†æ–°ä»»åŠ¡ï¼Œå¸¸è§çš„ApacheæœåŠ¡å™¨å°±æ˜¯ç”±çˆ¶è¿›ç¨‹ç›‘å¬ç«¯å£ï¼Œæ¯å½“æœ‰æ–°çš„httpè¯·æ±‚æ—¶ï¼Œå°±forkå‡ºå­è¿›ç¨‹æ¥å¤„ç†æ–°çš„httpè¯·æ±‚ã€‚å¤šè¿›ç¨‹-multiprocessingè¿›ç¨‹åŸºç¡€ç‰ˆæœ¬ï¼š1234567891011121314from multiprocessing import Processimport os# å­è¿›ç¨‹è¦æ‰§è¡Œçš„ä»£ç def run_proc(name): print('Run child process %s (%s)...' % (name, os.getpid()))if __name__=='__main__': print('Parent process %s.' % os.getpid()) p = Process(target=run_proc, args=('test',)) print('Child process will start.') p.start() p.join() print('Child process end.')æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š1234Parent process 928.Process will start.Run child process test (929)...Process end.è¿›ç¨‹æ± ï¼šå¦‚æœè¦å¯åŠ¨å¤§é‡çš„å­è¿›ç¨‹ï¼Œå¯ä»¥ç”¨è¿›ç¨‹æ± çš„æ–¹å¼æ‰¹é‡åˆ›å»ºå­è¿›ç¨‹ï¼š12345678910111213141516171819from multiprocessing import Poolimport os, time, randomdef long_time_task(name): print('Run task %s (%s)...' % (name, os.getpid())) start = time.time() time.sleep(random.random() * 3) end = time.time() print('Task %s runs %0.2f seconds.' % (name, (end - start)))if __name__=='__main__': print('Parent process %s.' % os.getpid()) p = Pool(4) for i in range(5): p.apply_async(long_time_task, args=(i,)) print('Waiting for all subprocesses done...') p.close() p.join() print('All subprocesses done.')ä»£ç è§£è¯»ï¼šå¯¹Poolå¯¹è±¡è°ƒç”¨join()æ–¹æ³•ä¼šç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œè°ƒç”¨join()ä¹‹å‰å¿…é¡»å…ˆè°ƒç”¨close()ï¼Œè°ƒç”¨close()ä¹‹åå°±ä¸èƒ½ç»§ç»­æ·»åŠ æ–°çš„Processäº†ã€‚è¯·æ³¨æ„è¾“å‡ºçš„ç»“æœï¼Œtask 0ï¼Œ1ï¼Œ2ï¼Œ3æ˜¯ç«‹åˆ»æ‰§è¡Œçš„ï¼Œè€Œtask 4è¦ç­‰å¾…å‰é¢æŸä¸ªtaskå®Œæˆåæ‰æ‰§è¡Œï¼Œè¿™æ˜¯å› ä¸ºPoolçš„é»˜è®¤å¤§å°åœ¨æˆ‘çš„ç”µè„‘ä¸Šæ˜¯4ï¼Œå› æ­¤ï¼Œæœ€å¤šåŒæ—¶æ‰§è¡Œ4ä¸ªè¿›ç¨‹ã€‚è¿™æ˜¯Poolæœ‰æ„è®¾è®¡çš„é™åˆ¶ï¼Œå¹¶ä¸æ˜¯æ“ä½œç³»ç»Ÿçš„é™åˆ¶ã€‚å¦‚æœæ”¹æˆï¼šp = Pool(5)å°±å¯ä»¥åŒæ—¶è·‘5ä¸ªè¿›ç¨‹ã€‚ç”±äºPoolçš„é»˜è®¤å¤§å°æ˜¯CPUçš„æ ¸æ•°ï¼Œå¦‚æœä½ ä¸å¹¸æ‹¥æœ‰8æ ¸CPUï¼Œä½ è¦æäº¤è‡³å°‘9ä¸ªå­è¿›ç¨‹æ‰èƒ½çœ‹åˆ°ä¸Šé¢çš„ç­‰å¾…æ•ˆæœã€‚è¿›ç¨‹æ± å®ä¾‹æ–¹æ³•ï¼šapply(func[, args[, kwds]])ï¼šåŒæ­¥è¿›ç¨‹æ± apply_async(func[, args[, kwds[, callback[, error_callback]]]]) ï¼šå¼‚æ­¥è¿›ç¨‹æ± Lockäº’æ–¥é”å½“å¤šä¸ªè¿›ç¨‹éœ€è¦è®¿é—®å…±äº«èµ„æºçš„æ—¶å€™ï¼ŒLockå¯ä»¥ç”¨æ¥é¿å…è®¿é—®çš„å†²çªè¿›ç¨‹ä¹‹é—´æ•°æ®éš”ç¦»ï¼Œä½†æ˜¯å…±äº«ä¸€å¥—æ–‡ä»¶ç³»ç»Ÿï¼Œå› è€Œå¯ä»¥é€šè¿‡æ–‡ä»¶æ¥å®ç°è¿›ç¨‹ç›´æ¥çš„é€šä¿¡ï¼Œä½†é—®é¢˜æ˜¯å¿…é¡»è‡ªå·±åŠ é”å¤„ç†ã€‚æ³¨æ„ï¼šåŠ é”çš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯å¤šä¸ªè¿›ç¨‹ä¿®æ”¹åŒä¸€å—æ•°æ®æ—¶ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªä¿®æ”¹ï¼Œå³ä¸²è¡Œçš„ä¿®æ”¹ï¼Œæ²¡é”™ï¼Œé€Ÿåº¦æ˜¯æ…¢äº†ï¼Œç‰ºç‰²äº†é€Ÿåº¦è€Œä¿è¯äº†æ•°æ®å®‰å…¨1234567891011121314151617181920212223242526272829303132333435363738import jsonimport timeimport randomimport osfrom multiprocessing import Process,Lockdef chakan(): dic = json.load(open('piao',)) # å…ˆæŸ¥çœ‹ç¥¨æ•°ï¼Œä¹Ÿå°±æ˜¯æ‰“å¼€é‚£ä¸ªæ–‡ä»¶ print('å‰©ä½™ç¥¨æ•°ï¼š%s' % dic['count']) # æŸ¥çœ‹å‰©ä½™çš„ç¥¨æ•°def buy(): dic = json.load(open('piao',)) if dic['count']&gt;0: #å¦‚æœè¿˜æœ‰ç¥¨ dic['count']-=1 #å°±ä¿®æ”¹é‡Œé¢çš„å€¼-1 time.sleep(random.randint(1,3)) #æ‰§è¡Œé‡Œé¢ä¹°ç¥¨çš„ä¸€ç³»åˆ—æ“ä½œå°±å…ˆä¸æ‰§è¡Œäº†ï¼Œè®©ç¡ä¸€ä¼šä»£æ›¿ï¼ˆå¹¶ä¸”éšæœºçš„ç¡ï¼‰ json.dump(dic,open('piao','w')) print('%s è´­ç¥¨æˆåŠŸ' % os.getpid()) # å½“å‰çš„é‚£ä¸ªidè´­ç¥¨æˆåŠŸdef task(mutex): #æŠ¢ç¥¨ # ç¬¬ä¸€ç§åŠ é”ï¼š # mutex.acquire() #åŠ é” # chakan() # å› ä¸ºæŸ¥çœ‹çš„æ—¶å€™å¤§å®¶éƒ½å¯ä»¥çœ‹åˆ°ï¼Œä¸éœ€è¦åŠ é” # buy() #ä¹°çš„æ—¶å€™å¿…é¡»ä¸€ä¸ªä¸€ä¸ªçš„ä¹°ï¼Œå…ˆç­‰ä¸€ä¸ªäººä¹°å®Œäº†ï¼Œåé¢çš„äººåœ¨ä¹° # mutex.release() #å–æ¶ˆé” # ç¬¬äºŒç§åŠ é”ï¼š #withè¡¨ç¤ºè‡ªåŠ¨æ‰“å¼€è‡ªåŠ¨é‡Šæ”¾é” with mutex: chakan() # å› ä¸ºæŸ¥çœ‹çš„æ—¶å€™å¤§å®¶éƒ½å¯ä»¥çœ‹åˆ°ï¼Œä¸éœ€è¦åŠ é” buy() #ä¹°çš„æ—¶å€™å¿…é¡»ä¸€ä¸ªä¸€ä¸ªçš„ä¹°ï¼Œå…ˆç­‰ä¸€ä¸ªäººä¹°å®Œäº†ï¼Œåé¢çš„äººåœ¨ä¹°if __name__ == '__main__': mutex = Lock() for i in range(50):#è®©50ä¸ªäººå»è®¿é—®é‚£ä¸ªç¥¨æ•° p = Process(target=task,args=(mutex,)) p.start()è¿›ç¨‹æ± åŠ é”è¿˜æ˜¯ä¸Šé¢æŠ¢ç¥¨çš„ä¾‹å­ï¼Œè¿™æ¬¡ä½¿ç”¨äº†è¿›ç¨‹æ± ï¼Œç”±äºè¿›ç¨‹ä¹‹é—´ä¸å…±äº«å†…å­˜ï¼Œæ‰€ä»¥è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ä¸èƒ½åƒçº¿ç¨‹ä¹‹é—´ç›´æ¥å¼•ç”¨ï¼Œä½¿ç”¨è¿›ç¨‹æ± å¼‚æ­¥å¯¹å…±äº«å˜é‡è¿›è¡Œæ“ä½œï¼Œå¼‚æ­¥æ“ä½œlocké”ï¼Œä¼šå¼•èµ·å†²çªï¼Œå› è€Œéœ€è¦é‡‡å–ä¸€äº›ç­–ç•¥æ¥å®Œæˆè¿›ç¨‹ä¹‹é—´çš„æ•°æ®é€šä¿¡ã€‚æ‰€ä»¥è¦å¼•å…¥è¿›ç¨‹Manageræ¥å®Œæˆè¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼è¿™é‡Œä¸¾ä¸¤ä¸ªä¾‹å­ï¼šå¤§å®¶è‡ªè¡Œåˆ›å»º piao æ–‡ä»¶ï¼Œå†…å®¹ä¸º {â€œcountâ€:320}1234567891011121314151617181920212223242526272829303132333435363738394041424344454647import jsonimport timeimport randomimport osfrom multiprocessing import Process,Lock,Pooldef chakan(): dic = json.load(open('piao',)) # å…ˆæŸ¥çœ‹ç¥¨æ•°ï¼Œä¹Ÿå°±æ˜¯æ‰“å¼€é‚£ä¸ªæ–‡ä»¶ print('å‰©ä½™ç¥¨æ•°ï¼š%s' % dic['count']) # æŸ¥çœ‹å‰©ä½™çš„ç¥¨æ•°def buy(): dic = json.load(open('piao',)) if dic['count']&gt;0: #å¦‚æœè¿˜æœ‰ç¥¨ dic['count']-=1 #å°±ä¿®æ”¹é‡Œé¢çš„å€¼-1 time.sleep(random.randint(1,3)) #æ‰§è¡Œé‡Œé¢ä¹°ç¥¨çš„ä¸€ç³»åˆ—æ“ä½œå°±å…ˆä¸æ‰§è¡Œäº†ï¼Œè®©ç¡ä¸€ä¼šä»£æ›¿ï¼ˆå¹¶ä¸”éšæœºçš„ç¡ï¼‰ json.dump(dic,open('piao','w')) print('%s è´­ç¥¨æˆåŠŸ' % os.getpid()) # å½“å‰çš„é‚£ä¸ªidè´­ç¥¨æˆåŠŸdef task(mutex): #æŠ¢ç¥¨ # mutex.acquire() #åŠ é” # chakan() # å› ä¸ºæŸ¥çœ‹çš„æ—¶å€™å¤§å®¶éƒ½å¯ä»¥çœ‹åˆ°ï¼Œä¸éœ€è¦åŠ é” # buy() #ä¹°çš„æ—¶å€™å¿…é¡»ä¸€ä¸ªä¸€ä¸ªçš„ä¹°ï¼Œå…ˆç­‰ä¸€ä¸ªäººä¹°å®Œäº†ï¼Œåé¢çš„äººåœ¨ä¹° # mutex.release() #å–æ¶ˆé” with mutex: chakan() # å› ä¸ºæŸ¥çœ‹çš„æ—¶å€™å¤§å®¶éƒ½å¯ä»¥çœ‹åˆ°ï¼Œä¸éœ€è¦åŠ é” buy() #ä¹°çš„æ—¶å€™å¿…é¡»ä¸€ä¸ªä¸€ä¸ªçš„ä¹°ï¼Œå…ˆç­‰ä¸€ä¸ªäººä¹°å®Œäº†ï¼Œåé¢çš„äººåœ¨ä¹°if __name__ == '__main__': mutex = Lock() pool = Pool(20) \"\"\"è¿›ç¨‹æ± åŠ é” \"\"\" from multiprocessing import Pool, Manager, Lock manager = Manager() mutex = manager.Lock() for i in range(50):#è®©50ä¸ªäººå»è®¿é—®é‚£ä¸ªç¥¨æ•° pool.apply_async(task,args=(mutex, )) pool.close() pool.join()12345678910111213141516171819202122232425from multiprocessing import Process,Managerimport os# è¿™é‡Œå®ç°çš„å°±æ˜¯å¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«å†…å­˜ï¼Œå¹¶ä¿®æ”¹æ•°æ®# è¿™é‡Œä¸éœ€è¦åŠ é”ï¼Œå› ä¸ºmanagerå·²ç»é»˜è®¤ç»™ä½ åŠ é”äº†def f(d,l): d[1] = '1' d['2'] = 2 d[0.25] = None l.append(os.getpid()) print(l)if __name__ == '__main__': with Manager() as manager: d = manager.dict() #ç”Ÿæˆä¸€ä¸ªå­—å…¸ l = manager.list(range(5)) #ç”Ÿæˆä¸€ä¸ªåˆ—è¡¨ p_list = [] for i in range(10): p = Process(target=f,args=(d,l)) p.start() p_list.append(p) for res in p_list: res.join() print(d) print(l)","categories":[{"name":"python","slug":"python","permalink":"cpeixin.cn/categories/python/"}],"tags":[{"name":"python","slug":"python","permalink":"cpeixin.cn/tags/python/"}]},{"title":"python - å¤šçº¿ç¨‹","slug":"python-å¤šçº¿ç¨‹","date":"2017-05-24T15:08:35.000Z","updated":"2020-04-04T11:04:52.986Z","comments":true,"path":"2017/05/24/python-å¤šçº¿ç¨‹/","link":"","permalink":"cpeixin.cn/2017/05/24/python-%E5%A4%9A%E7%BA%BF%E7%A8%8B/","excerpt":"","text":"å·´æ‹‰å·´æ‹‰æœ€è¿‘åœ¨æçˆ¬è™«é¡¹ç›®ï¼Œæ¶æ„å’Œç¨‹åºè®¾è®¡éƒ½æ˜¯ç”±æˆ‘æ¥å†³å®šå’Œè®¾è®¡ï¼Œæ‰€ä»¥å‘æŒ¥ç©ºé—´è¿˜æ˜¯å¾ˆè‡ªç”±çš„ã€‚ç¨‹åºè¯­è¨€é€‰æ‹©çš„æ˜¯pythonï¼Œåœ¨è¯­è¨€é€‰å‹ä¸Šä¹Ÿè€ƒè™‘è¿‡golangï¼Œgolangçš„æ•ˆç‡å’Œé€Ÿåº¦è‚¯å®šæ˜¯è¦æ¯”pythonå¥½å¾ˆå¤šçš„ã€‚ä½†æ˜¯åœ¨çˆ¬è™«é¢†åŸŸï¼Œpythonçš„æ˜“ç”¨æ€§ï¼Œè¶…å¤šçš„ç¬¬ä¸‰æ–¹æ‰©å±•åº“ï¼Œè€Œä¸”pythonæ”¯æŒåç¨‹åï¼Œæ•ˆç‡é€Ÿåº¦æ–¹é¢ä¸Šçš„è¡¨ç°ï¼Œä¹Ÿæ˜¯å¾ˆä¸é”™çš„ã€‚é‚£ä¹ˆåœ¨pythonåšçˆ¬è™«çš„è¿‡ç¨‹ä¸­ï¼Œå¤šçº¿ç¨‹ï¼Œå¤šè¿›ç¨‹ï¼Œåç¨‹ï¼Œå¼‚æ­¥ç­‰è‚¯å®šéƒ½æ˜¯é€ƒä¸è¿‡çš„ã€‚æ‰€ä»¥æŠ½å‡ºä¸€äº›æ—¶é—´ï¼Œå†™ä¸€å†™çº¿ç¨‹ï¼Œè¿›ç¨‹ï¼Œåç¨‹ï¼Œå¼‚æ­¥ç­‰æ–¹æ³•åœ¨çˆ¬è™«ä¸­çš„è¡¨ç°ã€‚å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹æˆ‘ä»¬å¸¸è§çš„ Linuxã€Windowsã€Mac OS æ“ä½œç³»ç»Ÿï¼Œéƒ½æ˜¯æ”¯æŒå¤šè¿›ç¨‹çš„å¤šæ ¸æ“ä½œç³»ç»Ÿã€‚æ‰€è°“å¤šè¿›ç¨‹ï¼Œå°±æ˜¯ç³»ç»Ÿå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªä»»åŠ¡ã€‚ä¾‹å¦‚æˆ‘ä»¬çš„ç”µè„‘ä¸Šè¿è¡Œç€ QQã€æµè§ˆå™¨ã€éŸ³ä¹æ’­æ”¾å™¨ã€å½±éŸ³æ’­æ”¾å™¨ç­‰ã€‚åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªä»»åŠ¡å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚æ¯ä¸ªè¿›ç¨‹è‡³å°‘åšä¸€ä»¶äº‹ï¼Œå¤šæ•°è¿›ç¨‹ä¼šåšå¾ˆå¤šäº‹ï¼Œä¾‹å¦‚å½±éŸ³æ’­æ”¾å™¨ï¼Œè¦æ’­æ”¾ç”»é¢ï¼ŒåŒæ—¶è¦æ’­æ”¾å£°éŸ³ï¼Œåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå°±æœ‰å¾ˆå¤šçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åšä¸€ä»¶äº‹ï¼Œåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹è¿è¡Œå°±æ˜¯å¤šçº¿ç¨‹ã€‚å¯ä»¥åœ¨å®éªŒç¯å¢ƒç»ˆç«¯æ‰§è¡Œ ps -ef å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚è®¡ç®—æœºçš„ä¸¤å¤§æ ¸å¿ƒä¸ºè¿ç®—å™¨å’Œå­˜å‚¨å™¨ã€‚å¸¸è¯´çš„æ‰‹æœºé…ç½®å››æ ¸ã€å…«æ ¸ï¼ŒæŒ‡çš„å°±æ˜¯ CPU çš„æ•°é‡ï¼Œå®ƒå†³å®šäº†æ‰‹æœºçš„è¿ç®—èƒ½åŠ›ï¼›128Gã€256G è¶…å¤§å­˜å‚¨ç©ºé—´ï¼ŒæŒ‡çš„å°±æ˜¯æ‰‹æœºå­˜å‚¨æ•°æ®çš„èƒ½åŠ›ã€‚å½“æˆ‘ä»¬è¿è¡Œä¸€ä¸ªç¨‹åºæ¥è®¡ç®— 3 + 5ï¼Œè®¡ç®—æœºæ“ä½œç³»ç»Ÿä¼šå¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶è¦æ±‚è¿ç®—å™¨æ´¾è¿‡æ¥ä¸€ä¸ª CPU æ¥å®Œæˆä»»åŠ¡ï¼›å½“æˆ‘ä»¬è¿è¡Œä¸€ä¸ªç¨‹åºæ¥æ‰“å¼€æ–‡ä»¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå¯åŠ¨å­˜å‚¨å™¨çš„åŠŸèƒ½å°†ç¡¬ç›˜ä¸­çš„æ–‡ä»¶æ•°æ®å¯¼å…¥åˆ°å†…å­˜ä¸­ã€‚ä¸€ä¸ª CPU åœ¨æŸä¸€æ—¶åˆ»åªèƒ½åšä¸€é¡¹ä»»åŠ¡ï¼Œå³åœ¨ä¸€ä¸ªè¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰ä¸­å·¥ä½œï¼Œå½“å®ƒé—²ç½®æ—¶ï¼Œä¼šè¢«ç³»ç»Ÿæ´¾åˆ°å…¶å®ƒè¿›ç¨‹ä¸­ã€‚å•æ ¸è®¡ç®—æœºä¹Ÿå¯ä»¥å®ç°å¤šè¿›ç¨‹ï¼ŒåŸç†æ˜¯ç¬¬ 1 ç§’çš„æ—¶é—´æ®µå†…è¿è¡Œ A è¿›ç¨‹ï¼Œå…¶å®ƒè¿›ç¨‹ç­‰å¾…ï¼šç¬¬ 2 ç§’çš„æ—¶é—´æ®µå†…è¿è¡Œ B è¿›ç¨‹ï¼Œå…¶å®ƒè¿›ç¨‹ç­‰å¾…ã€‚ã€‚ã€‚ç¬¬ 5 ç§’çš„æ—¶é—´æ®µå†…åˆè¿è¡Œ A è¿›ç¨‹ï¼Œå¾€å¤å¾ªç¯ã€‚å½“ç„¶å®é™…ä¸Š CPU åœ¨å„ä¸ªè¿›ç¨‹é—´çš„åˆ‡æ¢æ˜¯æå¿«çš„ï¼Œåœ¨æ¯«ç§’ï¼ˆåƒåˆ†ä¹‹ä¸€ï¼‰ã€å¾®ç§’ï¼ˆç™¾ä¸‡åˆ†ä¹‹ä¸€ï¼‰çº§ï¼Œä»¥è‡³äºæˆ‘ä»¬çœ‹èµ·æ¥è¿™äº›ç¨‹åºå°±åƒåœ¨åŒæ—¶è¿è¡Œã€‚ç°ä»£çš„è®¡ç®—æœºéƒ½æ˜¯å¤šæ ¸é…ç½®ï¼Œå››æ ¸å…«æ ¸ç­‰ï¼Œä½†è®¡ç®—æœºå¯åŠ¨çš„ç¬é—´ï¼Œå¾€å¾€å°±æœ‰å‡ åä¸Šç™¾ä¸ªè¿›ç¨‹åœ¨è¿è¡Œäº†ï¼Œæ‰€ä»¥è¿›ç¨‹åˆ‡æ¢æ˜¯ä¸€å®šä¼šå‘ç”Ÿçš„ï¼ŒCPU åœ¨å¿™ä¸è¿­åœåœ°åˆ°å¤„èµ¶åœºã€‚æ³¨æ„ï¼Œä»€ä¹ˆæ—¶å€™è¿›è¡Œè¿›ç¨‹ ã€çº¿ç¨‹åˆ‡æ¢æ˜¯ç”±æ“ä½œç³»ç»Ÿå†³å®šçš„ï¼Œæ— æ³•äººä¸ºå¹²é¢„ã€‚çº¿ç¨‹å®‰å…¨æˆ‘ä»¬éƒ½çŸ¥é“åœ¨ MySQL ä¸­æœ‰ â€œåŸå­æ“ä½œâ€ çš„æ¦‚å¿µï¼Œæ‰“ä¸ªæ¯”æ–¹ï¼šéŸ©æ¢…å‘æçº¢è½¬è´¦ 100 å—é’±ï¼Œåœ¨ MySQL ä¸­éœ€è¦ä¸¤æ­¥æ“ä½œï¼šéŸ©æ¢…è´¦æˆ·å‡å°‘ 100 å…ƒï¼Œæçº¢è´¦æˆ·å¢åŠ  100 å…ƒã€‚å¦‚æœç¬¬ä¸€æ­¥æ“ä½œå®Œæˆåï¼Œæ„å¤–æƒ…å†µå¯¼è‡´ç¬¬äºŒæ­¥æ²¡æœ‰åšï¼Œè¿™æ˜¯ä¸å…è®¸å‘ç”Ÿçš„ï¼Œå¦‚ä½•ä¿è¯å…¶ä¸å…è®¸å‘ç”Ÿå‘¢ï¼Ÿå°†ä¸¤æ­¥æ“ä½œè®¾è®¡æˆä¸€ä¸ªäº‹åŠ¡ï¼Œäº‹åŠ¡é‡Œå¯ä»¥æœ‰å¤šä¸ªæ­¥éª¤ï¼Œå…¶ä¸­ä»»ä½•ä¸€æ­¥å‡ºç°é—®é¢˜ï¼Œäº‹åŠ¡éƒ½å°†å¤±è´¥ï¼Œå‰é¢çš„æ­¥éª¤å…¨éƒ¨å›æ»šï¼Œå°±åƒä»€ä¹ˆäº‹éƒ½æ²¡å‘ç”Ÿã€‚è¿™ç§æ“ä½œå°±å«åšåŸå­æ“ä½œï¼Œè¿™ç§ç‰¹æ€§å°±å«åšåŸå­æ€§ã€‚åœ¨ Python å¤šçº¿ç¨‹ä¸­ï¼Œå˜é‡æ˜¯å…±äº«çš„ï¼Œè¿™ä¹Ÿæ˜¯ç›¸è¾ƒå¤šè¿›ç¨‹çš„ä¸€ä¸ªä¼˜ç‚¹ï¼Œçº¿ç¨‹å ç”¨èµ„æºè¦å°‘å¾—å¤šï¼Œä½†ä¹Ÿå¯¼è‡´å¤šä¸ª CPU åŒæ—¶æ“ä½œå¤šä¸ªçº¿ç¨‹æ—¶ä¼šå¼•èµ·ç»“æœæ— æ³•é¢„æµ‹çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´ Python çš„çº¿ç¨‹ä¸å®‰å…¨ã€‚åœ¨å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹çš„æ—¶å€™ï¼Œå› ä¸ºä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯å„è‡ªå®Œæˆå„è‡ªçš„ä»»åŠ¡ï¼Œå„ä¸ªå­çº¿ç¨‹æˆ–è€…å„ä¸ªå­è¿›ç¨‹ä¹‹å‰å¹¶æ²¡æœ‰å¤ªå¤šçš„è”ç³»ï¼Œå¦‚æœéœ€è¦é€šä¿¡çš„è¯æˆ‘ä¼šä½¿ç”¨é˜Ÿåˆ—æˆ–è€…æ•°æ®åº“æ¥å®Œæˆï¼Œä½†æ˜¯æœ€è¿‘æˆ‘åœ¨å†™ä¸€äº›å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹çš„ä»£ç æ—¶ï¼Œå‘ç°å¦‚æœå®ƒä»¬éœ€è¦ç”¨åˆ°å…±äº«å˜é‡çš„è¯ï¼Œéœ€è¦æœ‰ä¸€äº›æ³¨æ„çš„åœ°æ–¹æ¥ä¸‹æ¥ç”¨å®ä¾‹è®²è§£ä¸€ä¸‹çº¿ç¨‹å…±äº«çš„é—®é¢˜æ ‡å‡†æ•°æ®ç±»å‹åœ¨çº¿ç¨‹é—´å…±äº«ä¸‹é¢çš„å®ä¾‹ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºå˜é‡d,åœ¨5ä¸ªå­çº¿ç¨‹ä¸­å¼•ç”¨ã€‚123456789101112131415# coding:utf-8import threadingdef test(name, data): print(\"in thread &#123;&#125; name is &#123;&#125;\".format(threading.current_thread(), name)) print(\"data is &#123;&#125; id(data) is &#123;&#125;\".format(data, id(data)))if __name__ == '__main__': d = 5 name = \"cpeixin\" for i in range(5): th = threading.Thread(target=test, args=(name, d)) th.start()ä¸‹é¢çš„ç»“æœä¸­æ˜¾ç¤ºï¼Œ5ä¸ªå­çº¿ç¨‹ä¸­æ‰“å°å‡ºå˜é‡dçš„idç›¸åŒï¼Œè¡¨ç¤ºå¼•ç”¨çš„åŒä¸€ä¸ªå˜é‡ï¼Œæ‰€ä»¥è¯´æ˜åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºäº†å˜é‡dï¼Œåœ¨å­çº¿ç¨‹ä¸­æ˜¯å¯ä»¥å…±äº«çš„ï¼Œåœ¨å­çº¿ç¨‹ä¸­å¯¹å…±äº«å…ƒç´ çš„æ”¹å˜æ˜¯ä¼šå½±å“åˆ°å…¶å®ƒçº¿ç¨‹çš„ï¼Œæ‰€ä»¥å¦‚æœè¦å¯¹å…±äº«å˜é‡è¿›è¡Œä¿®æ”¹æ—¶ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œéœ€è¦åŠ é”ã€‚1234567891011/Users/cpeixin/venv/pythonCode/bin/python /Users/cpeixin/PycharmProjects/pythonCode/thread/variable_thread.pyin thread &lt;Thread(Thread-1, started 123145519386624)&gt; name is cpeixindata is 5 id(data) is 4304846080in thread &lt;Thread(Thread-2, started 123145524641792)&gt; name is cpeixindata is 5 id(data) is 4304846080in thread &lt;Thread(Thread-3, started 123145519386624)&gt; name is cpeixindata is 5 id(data) is 4304846080in thread &lt;Thread(Thread-4, started 123145519386624)&gt; name is cpeixindata is 5 id(data) is 4304846080in thread &lt;Thread(Thread-5, started 123145524641792)&gt; name is cpeixindata is 5 id(data) is 4304846080è‡ªå®šä¹‰ç±»å‹å¯¹è±¡åœ¨çº¿ç¨‹é—´å…±äº«å¦‚æœæˆ‘ä»¬è¦è‡ªå®šä¹‰ä¸€ä¸ªç±»å‘¢ï¼Œå°†ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå˜é‡åœ¨å­çº¿ç¨‹ä¸­ä¼ é€’å‘¢ï¼Ÿä¼šæ˜¯ä»€ä¹ˆæ•ˆæœå‘¢ï¼Ÿ123456789101112131415161718192021222324252627# coding:utf-8import threadingclass Data: def __init__(self, data=None): self.data = data def get(self): return self.data def set(self, data): self.data = datadef test(name, data): print(\"in thread &#123;&#125; name is &#123;&#125;\".format(threading.current_thread(), name)) print(\"data is &#123;&#125; id(data) is &#123;&#125;\".format(data.get(), id(data)))if __name__ == '__main__': d = Data(10) name = \"cpeixin\" print(\"in main thread id(data) is &#123;&#125;\".format(id(d))) for i in range(5): th = threading.Thread(target=test, args=(name, d)) th.start()1234567891011in main thread id(data) is 4348194152in thread &lt;Thread(Thread-1, started 123145427701760)&gt; name is cpeixindata is 10 id(data) is 4348194152in thread &lt;Thread(Thread-2, started 123145427701760)&gt; name is cpeixindata is 10 id(data) is 4348194152in thread &lt;Thread(Thread-3, started 123145427701760)&gt; name is cpeixindata is 10 id(data) is 4348194152in thread &lt;Thread(Thread-4, started 123145427701760)&gt; name is cpeixindata is 10 id(data) is 4348194152in thread &lt;Thread(Thread-5, started 123145427701760)&gt; name is cpeixindata is 10 id(data) is 4348194152æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹ä¸­ï¼Œè¿™ä¸ªå¯¹è±¡çš„idæ˜¯ä¸€æ ·çš„ï¼Œè¯´æ˜å®ƒä»¬ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚æ— è®ºæ˜¯æ ‡å‡†æ•°æ®ç±»å‹è¿˜æ˜¯å¤æ‚çš„è‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼Œå®ƒä»¬åœ¨å¤šçº¿ç¨‹ä¹‹é—´æ˜¯å…±äº«åŒä¸€ä¸ªçš„ä»¥ä¸Šå°±æ˜¯åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œå˜é‡å…±äº«çš„ç ä¸Šè¯´æ˜GIL å…¨å±€è§£é‡Šå™¨é”å¦‚ä½•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŸCPython è§£é‡Šå™¨ä½¿ç”¨äº†åŠ é”çš„æ–¹æ³•ã€‚æ¯ä¸ªè¿›ç¨‹æœ‰ä¸€æŠŠé”ï¼Œå¯åŠ¨çº¿ç¨‹å…ˆåŠ é”ï¼Œç»“æŸçº¿ç¨‹é‡Šæ”¾é”ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œè¿›ç¨‹æ˜¯ä¸€ä¸ªå‚æˆ¿ï¼Œå‚æˆ¿å¤§é—¨æ˜¯å¼€ç€çš„ï¼Œé—¨å†…æœ‰é”ï¼Œå·¥äººè¿›å…¥å¤§é—¨åå¯ä»¥åœ¨å†…éƒ¨ä¸Šé”ã€‚å‚æˆ¿é‡Œé¢æœ‰ 10 ä¸ªè½¦é—´å¯¹åº” 10 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ª CPU å°±æ˜¯ä¸€ä¸ªå·¥äººã€‚GILï¼ˆGlobal Interpreter Lockï¼‰å…¨å±€é”å°±ç›¸å½“äºå‚æˆ¿è§„å®šï¼šå·¥äººè¦åˆ°è½¦é—´å·¥ä½œï¼Œä»å‚æˆ¿å¤§é—¨è¿›å»åè¦åœ¨é‡Œé¢åé”ï¼Œå®Œæˆå·¥ä½œåå¼€é”å‡ºé—¨ï¼Œä¸‹ä¸€ä¸ªå·¥äººå†è¿›é—¨ä¸Šé”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»»æ„æ—¶åˆ»å‚æˆ¿é‡Œåªèƒ½æœ‰ä¸€ä¸ªå·¥äººï¼Œä½†è¿™æ ·å°±ä¿è¯äº†å·¥ä½œçš„å®‰å…¨æ€§ï¼Œè¿™å°±æ˜¯ GIL çš„åŸç†ã€‚å½“ç„¶äº†ï¼ŒGIL çš„å­˜åœ¨æœ‰å¾ˆå¤šå…¶å®ƒç›Šå¤„ï¼ŒåŒ…æ‹¬ç®€åŒ– CPython è§£é‡Šå™¨å’Œå¤§é‡æ‰©å±•çš„å®ç°ã€‚æ ¹æ®ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡º GIL å®ç°äº†çº¿ç¨‹æ“ä½œçš„å®‰å…¨æ€§ï¼Œä½†å¤šçº¿ç¨‹çš„æ•ˆç‡è¢«å¤§æ‰“æŠ˜æ‰£ï¼Œä¸€ä¸ªå·¥å‚é‡Œåªèƒ½æœ‰ä¸€ä¸ªå·¥äººå¹²æ´»ï¼Œå¾ˆéš¾æƒ³è±¡ã€‚è¿™ä¹Ÿæ˜¯ David Beazleyï¼ˆã€ŠPython å‚è€ƒæ‰‹å†Œã€‹å’Œã€ŠPython Cookbookã€‹çš„ä½œè€…ï¼‰è¯´ â€œPython çº¿ç¨‹æ¯«æ— ç”¨å¤„â€ çš„åŸå› ã€‚æ³¨æ„ï¼ŒGIL ä¸æ˜¯è¯­è¨€ç‰¹æ€§ï¼Œè€Œæ˜¯è§£é‡Šå™¨çš„è®¾è®¡ç‰¹ç‚¹ï¼Œæœ‰äº› Python è§£é‡Šå™¨ä¾‹å¦‚ JPython å°±æ²¡æœ‰ GIL ï¼Œé™¤äº† Python å…¶å®ƒè¯­è¨€ä¹Ÿæœ‰ GIL è®¾è®¡ï¼Œä¾‹å¦‚ Ruby ã€‚çº¿ç¨‹é”ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹é”?å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹æ—¶ï¼Œ å¯èƒ½ä¼šå‡ºç°ä¸å¯é¢„æ–™çš„æƒ…å†µ.ä¾‹å¦‚å®ç°é“¶è¡Œè½¬è´¦åŠŸèƒ½ï¼Œmoney += 1 è¿™å¥å…¶å®æœ‰ä¸‰ä¸ªæ­¥éª¤ money; money+1; money=money+1;å‡å¦‚è¿™ä¸‰æ­¥éª¤è¿˜æ²¡å®Œæˆmoney-=1çš„çº¿ç¨‹å°±å¼€å§‹æ‰§è¡Œäº†ï¼Œåæœå¯æƒ³è€ŒçŸ¥ï¼Œmoneyçš„å€¼è‚¯å®šæ—¶ä¹±çš„å¦‚ä½•å®ç°çº¿ç¨‹é”?å®ä¾‹åŒ–ä¸€ä¸ªé”å¯¹è±¡;lock = threading.Lock()æ“ä½œå˜é‡ä¹‹å‰è¿›è¡ŒåŠ é”lock.acquire()æ“ä½œå˜é‡ä¹‹åè¿›è¡Œè§£é”lock.release()12345678910111213141516171819202122232425262728293031323334353637import threading# é“¶è¡Œå­˜é’±å’Œå–é’±def add(lock): global money # ç”Ÿå‘½moneyä¸ºå…¨å±€å˜é‡ for i in range(1000000): # 2. æ“ä½œå˜é‡ä¹‹å‰è¿›è¡ŒåŠ é” lock.acquire() money += 1 # money; money+1; money=money+1; # 3. æ“ä½œå˜é‡ä¹‹åè¿›è¡Œè§£é” lock.release()def reduce(lock): global money for i in range(1000000): # 2. æ“ä½œå˜é‡ä¹‹å‰è¿›è¡ŒåŠ é” lock.acquire() money -= 1 # 3. æ“ä½œå˜é‡ä¹‹åè¿›è¡Œè§£é” lock.release()if __name__ == '__main__': money = 0 # 1. å®ä¾‹åŒ–ä¸€ä¸ªé”å¯¹è±¡; lock = threading.Lock() t1 = threading.Thread(target=add, args=(lock,)) t2 = threading.Thread(target=reduce, args=(lock,)) t1.start() t2.start() t1.join() t2.join() print(\"å½“å‰é‡‘é¢:\", money)å¤šçº¿ç¨‹æé«˜å·¥ä½œæ•ˆç‡å®é™…æƒ…å†µå¹¶éä¸Šé¢è®²å¾—é‚£ä¹ˆæƒ¨ï¼ŒPython å¤šçº¿ç¨‹å¯ä»¥æˆå€æé«˜ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ï¼Œè€Œä¸”åœ¨å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚æ¥ç€ä¸Šé¢çš„ä¾‹å­è¯´ï¼Œä¸€ä¸ªå·¥å‚é‡ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªå·¥äººåœ¨å·¥ä½œï¼Œå¦‚æœè¿™ä¸ªå·¥å‚é‡Œå„ä¸ªè½¦é—´çš„è‡ªåŠ¨åŒ–ç¨‹åº¦æé«˜ä¸”ä»»åŠ¡è€¦åˆåº¦æä½ï¼Œå·¥äººè¿›å»åªæ˜¯æŒ‰å‡ ä¸‹æŒ‰é’®ï¼Œå°±å¯ä»¥ç­‰å¾…æœºå™¨å®Œæˆå…¶ä½™å·¥ä½œï¼Œé‚£æƒ…å†µå°±ä¸ä¸€æ ·äº†ï¼Œè¿™ç§åœºæ™¯ä¸‹ä¸€ä¸ªå·¥äººå¯ä»¥ç®¡ç†å¥½å¤šä¸ªè½¦é—´ï¼Œè€Œä¸”å¤§å¤šæ•°æ—¶é—´éƒ½æ˜¯ç­‰ï¼Œç”šè‡³è¿˜èƒ½æŠ½ç©ºæ‰“æ‰“ç¾½æ¯›çƒçœ‹åœºç”µå½±ã€‚æ¯”å¦‚çˆ¬è™«ç¨‹åºçˆ¬å–é¡µé¢æ•°æ®è¿™ä¸ªåœºæ™¯ä¸­ï¼ŒCPU åšçš„äº‹å°±æ˜¯å‘èµ·é¡µé¢è¯·æ±‚å’Œå¤„ç†å“åº”æ•°æ®ï¼Œè¿™ä¸¤æ­¥æ˜¯æå¿«çš„ï¼Œä¸­é—´ç½‘ç»œä¼ è¾“æ•°æ®çš„è¿‡ç¨‹æ˜¯è€—æ—¶ä¸”ä¸å ç”¨ CPU çš„ã€‚ä¸€ä¸ªå·¥äººå¯ä»¥åœ¨åƒå®Œæ—©é¥­åä¸€åˆ†é’Ÿå†…å¿«é€Ÿåˆ° 1000 ä¸ªè½¦é—´æŒ‰ä¸‹å‘èµ·è¯·æ±‚çš„æŒ‰é’®ï¼Œåƒå®Œåˆé¥­ç¡ä¸€è§‰ï¼Œæ—¥è–„è¥¿å±±æ—¶å·®ä¸å¤šæ”¶åˆ°ç½‘ç»œä¼ å›çš„æ•°æ®ï¼Œåˆç”¨ä¸€åˆ†é’Ÿå¤„ç†æ•°æ®ï¼Œæ•´ä¸ªç¨‹åºå®Œæˆã€‚ä¸Šé¢çš„åœºæ™¯ä¸­ï¼ŒCPU å†å¤šä¹Ÿæ²¡æœ‰ç”¨å¤„ï¼Œä¸€ä¸ª CPU æŠ½ç©ºå°±èƒ½å®Œæˆæ•´ä¸ªä»»åŠ¡äº†ï¼Œæ¯•ç«Ÿç¨‹åºä¸­éœ€è¦ CPU åšçš„äº‹å¹¶ä¸å¤šã€‚è¿™å°±æ¶‰åŠå¤æ‚ç¨‹åºçš„åˆ†ç±»ï¼šCPU å¯†é›†å‹å’Œ IO å¯†é›†å‹ã€‚çˆ¬è™«ç¨‹åºå°±æ˜¯ IO å¯†é›†å‹ç¨‹åºã€‚CPU å¯†é›†å‹ç¨‹åºå…¨æ˜¯æ‰‹å·¥æ“ä½œï¼Œå·¥äººä¸€åˆ»ä¹Ÿä¸èƒ½åœæ­‡ï¼Œè¿™ç§æƒ…å†µä¸‹ Python å¤šçº¿ç¨‹å°±çœŸå¯ä»¥è¯´æ˜¯æ¯«æ— ç”¨å¤„äº†ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ time.sleep æ–¹æ³•æ¨¡æ‹Ÿ IO æ“ä½œæ¥å†™ä¸€æ®µç¨‹åºè¯æ˜å¤šçº¿ç¨‹å¯ä»¥æé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ï¼š12345678910111213141516171819202122232425262728293031323334353637# File Name: thread.pyimport threadingimport timeimport requestsdef crawl_url(): # å‡è®¾è¿™æ˜¯çˆ¬è™«ç¨‹åºï¼Œçˆ¬å–ä¸€ä¸ª URL time.sleep(0.02) # æ¨¡æ‹Ÿ IO æ“ä½œ # res = requests.get(\"http://www.ip111.cn\").status_code # print(res)def main1(): # å•çº¿ç¨‹ç¨‹åº for i in range(100): crawl_url()def main2(): # å¤šçº¿ç¨‹ç¨‹åº thread_list = [] for i in range(100): t = threading.Thread(target=crawl_url) t.start() thread_list.append(t) for t in thread_list: t.join()if __name__ == '__main__': start = time.time() main1() end = time.time() print('å•çº¿ç¨‹è€—æ—¶ï¼š&#123;:.4f&#125;s'.format(end - start)) start = time.time() main2() end = time.time() print('å¤šçº¿ç¨‹è€—æ—¶ï¼š&#123;:.4f&#125;s'.format(end - start))12å•çº¿ç¨‹è€—æ—¶ï¼š2.4027så¤šçº¿ç¨‹è€—æ—¶ï¼š0.0323sç†è®ºä¸Šï¼Œmain1 çš„è€—æ—¶æ˜¯ main2 çš„ 100 å€ï¼Œè€ƒè™‘åˆ° main2 åˆ›å»ºå¤šçº¿ç¨‹ã€çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ï¼Œè¿™ä¸ªç»“æœä¹Ÿæ˜¯ç›¸å½“å¯è§‚çš„ï¼ŒIO æ“ä½œè€—æ—¶è¶Šé•¿ï¼Œå¤šçº¿ç¨‹çš„å¨åŠ›è¶Šå¤§ã€‚çº¿ç¨‹æ± ThreadPoolåœ¨ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†ä»»åŠ¡æ—¶ä¹Ÿä¸æ˜¯çº¿ç¨‹è¶Šå¤šè¶Šå¥½ï¼Œç”±äºåœ¨åˆ‡æ¢çº¿ç¨‹çš„æ—¶å€™ï¼Œéœ€è¦åˆ‡æ¢ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¾ç„¶ä¼šé€ æˆcpuçš„å¤§é‡å¼€é”€ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œçº¿ç¨‹æ± çš„æ¦‚å¿µè¢«æå‡ºæ¥äº†ã€‚é¢„å…ˆåˆ›å»ºå¥½ä¸€ä¸ªè¾ƒä¸ºä¼˜åŒ–çš„æ•°é‡çš„çº¿ç¨‹ï¼Œè®©è¿‡æ¥çš„ä»»åŠ¡ç«‹åˆ»èƒ½å¤Ÿä½¿ç”¨ï¼Œå°±å½¢æˆäº†çº¿ç¨‹æ± ã€‚1234567891011121314# coding: utf-8from concurrent.futures import ThreadPoolExecutorimport timedef spider(page): time.sleep(page) print(f\"crawl task&#123;page&#125; finished\") return pagewith ThreadPoolExecutor(max_workers=5) as t: # åˆ›å»ºä¸€ä¸ªæœ€å¤§å®¹çº³æ•°é‡ä¸º5çš„çº¿ç¨‹æ±  task1 = t.submit(spider, 1) task2 = t.submit(spider, 2) # é€šè¿‡submitæäº¤æ‰§è¡Œçš„å‡½æ•°åˆ°çº¿ç¨‹æ± ä¸­ task3 = t.submit(spider, 3)ä½¿ç”¨ with è¯­å¥ ï¼Œé€šè¿‡ ThreadPoolExecutor æ„é€ å®ä¾‹ï¼ŒåŒæ—¶ä¼ å…¥ max_workers å‚æ•°æ¥è®¾ç½®çº¿ç¨‹æ± ä¸­æœ€å¤šèƒ½åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°ç›®ã€‚ä½¿ç”¨ submit å‡½æ•°æ¥æäº¤çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡åˆ°çº¿ç¨‹æ± ä¸­ï¼Œå¹¶è¿”å›è¯¥ä»»åŠ¡çš„å¥æŸ„ï¼ˆç±»ä¼¼äºæ–‡ä»¶ã€ç”»å›¾ï¼‰ï¼Œæ³¨æ„ submit() ä¸æ˜¯é˜»å¡çš„ï¼Œè€Œæ˜¯ç«‹å³è¿”å›ã€‚multiprocessing.dummy.Poolmultiprocessing.dummy.Pool æ˜¯ä¸ªä»€ä¹ˆä¸œä¸œï¼Ÿçœ‹èµ·æ¥åƒä¸€ä¸ªè¿›ç¨‹æ± çš„æ ·å­å•Šï½ï½çœ‹äº†æºç ä¸­çš„ä»£ç å’Œæ³¨é‡Š123456789# Support for the API of the multiprocessing package using threads## multiprocessing/dummy/__init__.pyclass DummyProcess(threading.Thread)def Pool(processes=None, initializer=None, initargs=()): from ..pool import ThreadPool return ThreadPool(processes, initializer, initargs)è¿™åªæ˜¯æ˜¯ä»¥multiprocessingç›¸åŒAPIå®ç°çš„å¤šçº¿ç¨‹æ¨¡å—ã€‚ç»§æ‰¿äº†Threadï¼Œå†…éƒ¨æ˜¯å°è£…è°ƒç”¨äº†ThreadPoolï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ã€‚å¼‚æ­¥å’ŒåŒæ­¥ï¼Œé˜»å¡å’Œéé˜»å¡ä¸Šæ–‡çš„æ¨¡æ‹Ÿçˆ¬è™«ç¤ºä¾‹ä»£ç ä¸­ï¼Œmain1 ä¸­çš„ for å¾ªç¯è¿è¡Œ 100 æ¬¡çˆ¬å–ç½‘é¡µçš„æ“ä½œï¼Œå‰ä¸€ä¸ªå®Œæˆåæ‰èƒ½è¿è¡Œä¸‹ä¸€ä¸ªï¼Œè¿™å°±æ˜¯åŒæ­¥çš„æ¦‚å¿µï¼Œåœ¨ crawl_url å‡½æ•°å†…éƒ¨çš„ IO æ“ä½œä¸ºé˜»å¡æ“ä½œï¼Œçº¿ç¨‹æ— æ³•å‘ä¸‹æ‰§è¡Œã€‚main2 ä¸­çš„ç¬¬ä¸€ä¸ª for å¾ªç¯ï¼Œ_åˆ›å»º 100 ä¸ªçº¿ç¨‹å¹¶å¯åŠ¨ï¼Œè¿™æ­¥æ“ä½œæ˜¯éé˜»å¡çš„_ï¼Œä¸ä¼šç­‰ä¸€ä¸ªçº¿ç¨‹è¿è¡Œå®Œæˆæ‰åˆ›å»ºä¸‹ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒä¼šä¸€æ°”å„¿åˆ›å»º 100 ä¸ªçº¿ç¨‹ï¼›ç¬¬äºŒä¸ª for å¾ªç¯å°†ä¸»çº¿ç¨‹æŒ‚èµ·ï¼Œç›´åˆ°å…¨éƒ¨å­çº¿ç¨‹å®Œæˆï¼Œæ­¤æ—¶çš„ä¸»çº¿ç¨‹å°±æ˜¯é˜»å¡çš„ã€‚è¿™ç§ç¨‹åºè¿è¡Œæ–¹å¼å«åšå¼‚æ­¥ï¼ŒCPU åœ¨é‡åˆ° IO é˜»å¡æ—¶ä¸ä¼šç«™åœ¨é‚£å„¿å‚»ç­‰ï¼Œè€Œæ˜¯è¢«æ“ä½œç³»ç»Ÿæ´¾å¾€å…¶å®ƒçº¿ç¨‹ä¸­çœ‹çœ‹æœ‰ä»€ä¹ˆäº‹å¯åšã€‚æ‰€è°“çš„å¼‚æ­¥ï¼Œå°±æ˜¯ CPU åœ¨å½“å‰çº¿ç¨‹é˜»å¡æ—¶å¯ä»¥å»å…¶å®ƒçº¿ç¨‹ä¸­å·¥ä½œï¼Œä¸ç®¡æ€ä¹ˆè®¾è®¡ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹å†…éƒ¨ä»£ç éƒ½æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œé‡åˆ° IO éƒ½å¾—é˜»å¡ï¼Œæ‰€è°“çš„éé˜»å¡ï¼Œæ˜¯é‡åˆ°å½“å‰çº¿ç¨‹é˜»å¡æ—¶ï¼ŒCPU å»å…¶å®ƒçº¿ç¨‹å·¥ä½œã€‚","categories":[{"name":"python","slug":"python","permalink":"cpeixin.cn/categories/python/"}],"tags":[{"name":"python","slug":"python","permalink":"cpeixin.cn/tags/python/"}]},{"title":"Spark å•å…ƒæµ‹è¯•","slug":"Spark-å•å…ƒæµ‹è¯•","date":"2017-05-19T09:52:52.000Z","updated":"2020-05-19T09:57:56.873Z","comments":true,"path":"2017/05/19/Spark-å•å…ƒæµ‹è¯•/","link":"","permalink":"cpeixin.cn/2017/05/19/Spark-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/","excerpt":"","text":"Spark å•å…ƒæµ‹è¯•ç›¸æ¯”äºä¼ ç»Ÿä»£ç ï¼ŒSparkæ˜¯æ¯”è¾ƒéš¾è°ƒè¯•çš„ã€‚ç¨‹åºè¿è¡Œåœ¨é›†ç¾¤ä¸­ï¼Œæ¯æ¬¡ä¿®æ”¹ä»£ç åï¼Œéƒ½è¦ä¸Šä¼ åˆ°é›†ç¾¤è¿›è¡Œæµ‹è¯•ï¼Œä»£ä»·éå¸¸å¤§ï¼Œæ‰€ä»¥ä¼˜å…ˆåœ¨æœ¬åœ°è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œå¯ä»¥å‡å°‘å°æ¨¡å—çš„é€»è¾‘é”™è¯¯ã€‚ScalaTest æµ‹è¯•æ¡†æ¶ScalaTestæ˜¯æ¯”JUnitå’ŒTestNGæ›´åŠ é«˜é˜¶çš„æµ‹è¯•ç¼–å†™å·¥å…·ï¼Œè¿™ä¸ªScalaåº”ç”¨åœ¨JVMä¸Šè¿è¡Œï¼Œå¯ä»¥æµ‹è¯•Scalaä»¥åŠJavaä»£ç ã€‚ScalaTestä¸€å…±æä¾›äº†ä¸ƒç§æµ‹è¯•é£æ ¼ï¼Œåˆ†åˆ«ä¸ºï¼šFunSuiteï¼ŒFlatSpecï¼ŒFunSpecï¼ŒWordSpecï¼ŒFreeSpecï¼ŒPropSpecå’ŒFeatureSpecã€‚FunSuiteçš„æ–¹å¼è¾ƒä¸ºçµæ´»ï¼Œè€Œä¸”æ›´ç¬¦åˆä¼ ç»Ÿæµ‹è¯•æ–¹æ³•çš„é£æ ¼ï¼ŒåŒºåˆ«ä»…åœ¨äºtest()æ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªé—­åŒ…ã€‚è€ŒFlatSpecå’ŒFunSpecåˆ™é€šè¿‡æä¾›è¯¸å¦‚itã€shouldã€describeç­‰æ–¹æ³•ï¼Œæ¥è§„å®šä¹¦å†™æµ‹è¯•çš„ä¸€ç§æ¨¡å¼ã€‚Mavenä¸­å¼•å…¥ï¼š1234567&lt;!-- Test Dependency --&gt;&lt;dependency&gt; &lt;groupId&gt;org.scalatest&lt;/groupId&gt; &lt;artifactId&gt;scalatest_2.11&lt;/artifactId&gt; &lt;version&gt;3.1.1&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;é¦–å…ˆå®šä¹‰å¥½æˆ‘ä»¬è¦æµ‹è¯•çš„å‡½æ•°ï¼Œä¸‹é¢çš„ç¨‹åºä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ count(rdd:RDD[String]): RDD[(String,Int)] è¿›è¡Œæµ‹è¯•1234567891011121314151617181920212223242526package unit_testimport org.apache.spark.&#123;SparkConf, SparkContext&#125;import org.apache.spark.rdd.RDDobject WordCount extends Serializable&#123; def main(args: Array[String]): Unit = &#123; val sparkConf: SparkConf = new SparkConf().setAppName(\"test_rdd\").setMaster(\"local\") val sc = new SparkContext(sparkConf) val make_rdd: RDD[String] = sc.parallelize(Array(\"Brent\",\"HayLee\",\"Henry\")) val result_rdd: RDD[(String, Int)] = count(make_rdd) result_rdd.foreach(println) &#125; def count(rdd:RDD[String]): RDD[(String,Int)]=&#123; val wordcount_rdd: RDD[(String, Int)] =rdd.map((word: String) =&gt;(word,1)) .reduceByKey((_: Int) + (_: Int)) wordcount_rdd &#125;&#125;åˆ›å»ºæµ‹è¯•ç±»ï¼š12345678910111213141516171819202122232425262728293031323334353637383940import org.apache.spark.&#123;SparkConf, SparkContext&#125;import org.scalatest.&#123;BeforeAndAfter, FlatSpec&#125;import unit_test.WordCount//å¼•å…¥scalatestå»ºç«‹ä¸€ä¸ªå•å…ƒæµ‹è¯•ç±»ï¼Œæ··å…¥ç‰¹è´¨BeforeAndAfterï¼Œåœ¨beforeå’Œafterä¸­åˆ†åˆ«åˆå§‹åŒ–scå’Œåœæ­¢scï¼Œ//åˆå§‹åŒ–SparkContextæ—¶åªéœ€å°†Masterè®¾ç½®ä¸ºlocal(local[N],Nè¡¨ç¤ºçº¿ç¨‹)å³å¯ï¼Œæ— éœ€æœ¬åœ°é…ç½®æˆ–æ­å»ºé›†ç¾¤ï¼Œclass WordCountTests extends FlatSpec with BeforeAndAfter&#123; val master=\"local\" //sparkcontextçš„è¿è¡Œmaster var sc:SparkContext=_ \"wordcount_class\" should \"map word ,1\" in&#123; //å…¶ä¸­å‚æ•°ä¸ºrddæˆ–è€…dataframeå¯ä»¥é€šè¿‡é€šè¿‡ç®€å•çš„æ‰‹åŠ¨æ„é€ å³å¯ val seq=Seq(\"Brent\",\"HayLee\",\"Henry\") val rdd=sc.parallelize(seq) val wordCounts=WordCount.count(rdd) wordCounts.map(p=&gt;&#123; p._1 match &#123; case \"Brent\"=&gt; assert(p._2==1)// æ–­è¨€ case \"HayLee\"=&gt; assert(p._2==1) case \"Henry\"=&gt; assert(p._2==1) case _=&gt; None &#125; &#125;).foreach(_=&gt;()) &#125; //è¿™é‡Œbeforeå’Œafterä¸­åˆ†åˆ«è¿›è¡Œsparkcontextçš„åˆå§‹åŒ–å’Œç»“æŸï¼Œå¦‚æœæ˜¯SQLContextä¹Ÿå¯ä»¥åœ¨è¿™é‡Œé¢åˆå§‹åŒ– before&#123; val conf=new SparkConf() .setAppName(\"test\").setMaster(master) sc=new SparkContext(conf) &#125; after&#123; if(sc!=null)&#123; sc.stop() &#125; &#125;&#125;","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"Spark Streaming + ELK + HBase","slug":"Spark-Streaming-ELK-HBase","date":"2017-04-22T15:26:15.000Z","updated":"2020-05-06T16:57:17.655Z","comments":true,"path":"2017/04/22/Spark-Streaming-ELK-HBase/","link":"","permalink":"cpeixin.cn/2017/04/22/Spark-Streaming-ELK-HBase/","excerpt":"","text":"åœ¨Spark Streamingçš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¤§å¤šæ•°çš„ä¸šåŠ¡éœ€æ±‚æ˜¯é’ˆå¯¹å®æ—¶æ•°æ®åšæ•°æ®ç»Ÿè®¡ï¼Œç½‘ç«™æ•°æ®ï¼ŒAppæ•°æ®çš„ç›‘æ§åˆ†æï¼Œæˆ–è€…æ˜¯å¯¹æŠ“å–çš„å®æ—¶æ•°æ®åšETLï¼Œå†è¿›è¡Œå±•ç¤ºï¼Œä»¥åŠå®æ—¶çš„æ¨èç³»ç»Ÿç­‰ã€‚ç›®å‰å…¬å¸æ­£åœ¨åšçš„é¡¹ç›®ï¼Œé’ˆå¯¹å…¬å¸å†…éƒ¨è¿è¥éƒ¨é—¨çš„éœ€æ±‚ï¼Œä¸€æ–¹é¢ç»Ÿè®¡æ—¶å°šï¼Œæ•™è‚²ï¼Œç§‘æŠ€ç­‰è¡Œä¸šçš„æœ€æ–°åŠ¨æ€ï¼ŒäºŒåˆ™æ˜¯å¯¹å…¬å¸ç¼–è¾‘äººå‘˜æä¾›ç›®å‰è¡Œä¸šçƒ­ç‚¹ç´ æï¼Œä»¥çƒ­ç‚¹å›¾çš„æ–¹å¼å±•ç¤ºï¼Œç‚¹å‡»ç›¸åº”çš„å…³é”®è¯ï¼Œå¹¶æå–å‡ºç›¸åº”çš„ç´ æã€‚é‚£ä¹ˆåœ¨æ•´ä½“çš„æ¶æ„ä¸Šï¼šæ•°æ®æºæ¥è‡ªPythonçš„å®šå‘çˆ¬è™«æ¶ˆæ¯é˜Ÿåˆ—é‡‡ç”¨Kafkaæ•°æ®å¤„ç†é‡‡ç”¨Spark Streamingï¼Œå¯¹æœé›†çš„ç´ æåšETLä»¥åŠå…³é”®è¯æå–ç­‰æ•°æ®å­˜å‚¨é‡‡ç”¨HBaseï¼ŒElasticsearchï¼Œ HBaseå­˜å‚¨å…¨é‡æ•°æ®ï¼Œåšå†å²æ•°æ®çš„å¤‡ä»½ï¼Œæ–¹ä¾¿äºåç»­çš„æ•°æ®åˆ†æï¼ŒElasticsearchæ­é…HBaseåšäºŒçº§ç´¢å¼•æ–¹æ¡ˆï¼ŒåŒæ—¶å­˜å‚¨éƒ¨åˆ†æ•°æ®ï¼Œå¯¹æˆ’Kibanaåšæ•°æ®å¯è§†åŒ–ã€‚ä¸‹é¢å¯¹ä¸Šé¢çš„ä¸šåŠ¡åœºæ™¯åšä¸€ä¸ªç®€å•çš„ä»£ç å®ä¾‹ï¼Œå…¶ä¸­æ²¡æœ‰å†™å…¥é¡¹ç›®çš„æ•°æ®é€»è¾‘ï¼Œé‚£è‡ªå·±ç”µè„‘ä¸­çš„æ•°æ®è¿›è¡Œäº†æ¨¡æ‹Ÿ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114package writeimport java.security.MessageDigestimport com.alibaba.fastjson.&#123;JSON, JSONObject&#125;import org.apache.hadoop.hbase.TableNameimport org.apache.hadoop.hbase.client.&#123;Connection, Put, Table&#125;import org.apache.hadoop.hbase.util.Bytesimport org.apache.kafka.clients.consumer.ConsumerRecordimport org.apache.kafka.common.serialization.StringDeserializerimport org.apache.log4j.&#123;Level, Logger&#125;import org.apache.spark.&#123;SparkConf, SparkContext&#125;import org.apache.spark.rdd.RDDimport org.apache.spark.streaming.&#123;Seconds, StreamingContext&#125;import org.apache.spark.streaming.dstream.DStreamimport org.apache.spark.streaming.kafka010.ConsumerStrategies.Subscribeimport org.apache.spark.streaming.kafka010.KafkaUtilsimport org.apache.spark.streaming.kafka010.LocationStrategies.PreferConsistentimport org.elasticsearch.spark.streaming.EsSparkStreamingimport utils.HBaseUtilimport scala.util.Tryobject streaming_to_hbase_1 &#123; val logger:Logger = Logger.getRootLogger Logger.getLogger(\"org\").setLevel(Level.ERROR) def main(args: Array[String]): Unit = &#123; val conf: SparkConf = new SparkConf() .setAppName(\"spark streaming window\") .setMaster(\"local[2]\") .set(\"spark.es.nodes\", \"localhost\") .set(\"spark.es.port\", \"9200\") .set(\"es.index.auto.create\", \"true\") val ssc = new StreamingContext(conf, Seconds(5)) val kafkaParams: Map[String, Object] = Map[String, Object]( \"bootstrap.servers\" -&gt; \"localhost:9092\", \"key.deserializer\" -&gt; classOf[StringDeserializer], \"value.deserializer\" -&gt; classOf[StringDeserializer], \"group.id\" -&gt; \"kafka_spark_streaming\", \"auto.offset.reset\" -&gt; \"earliest\", // earliestï¼Œlatest \"enable.auto.commit\" -&gt; (false: java.lang.Boolean) ) val topics = Array(\"weibo_keyword\") val kafkaStream: DStream[(String, String)] = KafkaUtils .createDirectStream[String, String](ssc, PreferConsistent, Subscribe[String, String](topics, kafkaParams)) .map((x: ConsumerRecord[String, String]) =&gt; &#123; val json_data: JSONObject = JSON.parseObject(x.value()) val date_time: String = json_data.get(\"datetime\").toString val keywordList: String = json_data.get(\"keywordList\").toString (date_time, keywordList) &#125;) // ES æ•°æ®å†™å…¥éƒ¨åˆ† val es_dstream: DStream[String] = kafkaStream.map((x: (String, String)) =&gt; &#123; val date_time: String = x._1 val keywordList: String = x._2 val data_es_json: JSONObject = new JSONObject() data_es_json.put(\"date_time\", date_time) data_es_json.put(\"keyword_list\", keywordList) data_es_json.put(\"rowkey\", MD5Encode(date_time)) data_es_json.toJSONString &#125;) EsSparkStreaming.saveJsonToEs(es_dstream,\"weibo_keyword-2017-04-25/default\") //HBase æ•°æ®å†™å…¥éƒ¨åˆ† kafkaStream.foreachRDD((rdd: RDD[(String, String)]) =&gt; &#123; rdd.foreachPartition((partitionRecords: Iterator[(String, String)]) =&gt; &#123;//å¾ªç¯åˆ†åŒº try &#123; val connection: Connection = HBaseUtil.getHBaseConn //è·å–HBaseè¿æ¥,åˆ†åŒºåˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œåˆ†åŒºä¸è·¨èŠ‚ç‚¹ï¼Œä¸éœ€è¦åºåˆ—åŒ– partitionRecords.foreach((s: (String, String)) =&gt; &#123; val tableName: TableName = TableName.valueOf(\"t_weibo_keyword\") val table: Table = connection.getTable(tableName)//è·å–è¡¨è¿æ¥ var date_time: String = s._1 val keywordList: String = s._2 val put = new Put(Bytes.toBytes(MD5Encode(date_time))) put.addColumn(Bytes.toBytes(\"cf1\"), Bytes.toBytes(\"keywordLisr\"), Bytes.toBytes(keywordList)) Try(table.put(put)).getOrElse(table.close())//å°†æ•°æ®å†™å…¥HBaseï¼Œè‹¥å‡ºé”™å…³é—­table// table.close()//åˆ†åŒºæ•°æ®å†™å…¥HBaseåå…³é—­è¿æ¥ &#125;) &#125; catch &#123; case e: Exception =&gt; logger.info(e) logger.info(\"å†™å…¥HBaseå¤±è´¥\") &#125; &#125;) &#125;) ssc.start() ssc.awaitTermination() &#125; def MD5Encode(input: String): String = &#123; // æŒ‡å®šMD5åŠ å¯†ç®—æ³• val md5: MessageDigest = MessageDigest.getInstance(\"MD5\") // å¯¹è¾“å…¥æ•°æ®è¿›è¡ŒåŠ å¯†,è¿‡ç¨‹æ˜¯å…ˆå°†å­—ç¬¦ä¸²ä¸­è½¬æ¢æˆbyteæ•°ç»„,ç„¶åè¿›è¡Œéšæœºå“ˆå¸Œ val encoded: Array[Byte] = md5.digest(input.getBytes) // å°†åŠ å¯†åçš„æ¯ä¸ªå­—èŠ‚è½¬åŒ–æˆåå…­è¿›åˆ¶ï¼Œä¸€ä¸ªå­—èŠ‚8ä½ï¼Œç›¸å½“äº2ä¸ª16è¿›åˆ¶ï¼Œä¸è¶³2ä½çš„å‰é¢è¡¥0 encoded.map(\"%02x\".format(_: Byte)).mkString &#125;&#125;esåœ¨mavenä¸­å¼•å…¥çš„ä¾èµ–ï¼š12345&lt;dependency&gt; &lt;groupId&gt;org.elasticsearch&lt;&#x2F;groupId&gt; &lt;artifactId&gt;elasticsearch-spark-20_2.11&lt;&#x2F;artifactId&gt; &lt;version&gt;6.7.0&lt;&#x2F;version&gt;&lt;&#x2F;dependency&gt;kibanaä¸­çš„ç»“æœå±•ç¤º","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"Spark Streaming è¿›é˜¶","slug":"Spark-Streaming-è¿›é˜¶","date":"2017-04-14T14:22:12.000Z","updated":"2020-05-05T16:34:55.494Z","comments":true,"path":"2017/04/14/Spark-Streaming-è¿›é˜¶/","link":"","permalink":"cpeixin.cn/2017/04/14/Spark-Streaming-%E8%BF%9B%E9%98%B6/","excerpt":"","text":"åˆå§‹åŒ–è¦åˆå§‹åŒ–Spark Streamingç¨‹åºï¼Œå¿…é¡»åˆ›å»ºStreamingContextå¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ˜¯æ‰€æœ‰Spark StreamingåŠŸèƒ½çš„ä¸»è¦å…¥å£ç‚¹ã€‚1234val conf: SparkConf = new SparkConf() .setAppName(\"your application name\") .setMaster(\"local[2]\")val ssc = new StreamingContext(conf, Seconds(5))mavenä¾èµ–ï¼š123456&lt;dependency&gt; &lt;groupId&gt;org.apache.spark&lt;/groupId&gt; &lt;artifactId&gt;spark-streaming_2.11&lt;/artifactId&gt; &lt;version&gt;$&#123;spark.version&#125;&lt;/version&gt; &lt;!--&lt;scope&gt;provided&lt;/scope&gt;--&gt;&lt;/dependency&gt;è¯¥appNameå‚æ•°æ˜¯æ‚¨çš„åº”ç”¨ç¨‹åºåœ¨é›†ç¾¤UIä¸Šæ˜¾ç¤ºçš„åç§°ã€‚ masteræ˜¯Sparkï¼ŒMesosï¼ŒKubernetesæˆ–YARNç¾¤é›†URLæˆ–ç‰¹æ®Šçš„â€œ local []â€å­—ç¬¦ä¸²ï¼Œä»¥æœ¬åœ°æ¨¡å¼è¿è¡Œã€‚å®é™…å·¥ä½œä¸­ï¼Œç¨‹åºéƒ¨ç½²ã€è¿è¡Œåœ¨é›†ç¾¤ä¸Šï¼Œæ‰€ä»¥å¹¶ä¸å¸Œæœ›masteråœ¨ç¨‹åºä¸­è¿›è¡Œç¡¬ç¼–ç ï¼Œè€Œæ˜¯åœ¨æäº¤ç¨‹åºçš„spark-submit â€“master * å‘½ä»¤ä¸­æ¥æŒ‡å®šã€‚å¦‚æœåªæ˜¯æœ¬åœ°IDEAè¿è¡Œï¼Œåˆ™å¯æŒ‡å®š localã€‚åœ¨åˆå§‹åŒ–çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¦è®¾ç½®æ¯ä¸ªæ‰¹å¤„ç†çš„æ—¶é—´é—´éš”ï¼Œä¸Šé¢ä»£ç ä¸­ Seconds(5)ï¼Œä¹Ÿå°±æ˜¯5ç§’åˆ’åˆ†ä¸€ä¸ªæ‰¹æ¬¡ã€‚æˆ‘ä»¬æ‰“å¼€æºç ï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒStreamingContextï¼ˆï¼‰ç¬¬äºŒä¸ªå‚æ•°è¿˜æœ‰å…¶ä»–é€‰æ‹©ï¼Œæœ€ç»ˆéƒ½æ˜¯å°†æ—¶é—´è½¬æ¢æˆæ¯«ç§’ã€‚**DstreamDStreamç”±ä¸€ç³»åˆ—è¿ç»­çš„RDDè¡¨ç¤ºï¼Œè¿™æ˜¯Sparkå¯¹ä¸å¯å˜çš„åˆ†å¸ƒå¼æ•°æ®é›†çš„æŠ½è±¡ã€‚DStreamä¸­çš„æ¯ä¸ªRDDéƒ½åŒ…å«æ¥è‡ªç‰¹å®šé—´éš”çš„æ•°æ®ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556package streamingimport com.alibaba.fastjson.&#123;JSON, JSONObject&#125;import org.apache.kafka.clients.consumer.ConsumerRecordimport org.apache.kafka.common.serialization.StringDeserializerimport org.apache.log4j.&#123;Level, Logger&#125;import org.apache.spark.SparkConfimport org.apache.spark.rdd.RDDimport org.apache.spark.streaming.dstream.InputDStreamimport org.apache.spark.streaming.kafka010.ConsumerStrategies.Subscribeimport org.apache.spark.streaming.kafka010.KafkaUtilsimport org.apache.spark.streaming.kafka010.LocationStrategies.PreferConsistentimport org.apache.spark.streaming.&#123;Seconds, StreamingContext&#125;object streaming_case &#123; // è®¾ç½®æ—¥å¿—çº§åˆ« Logger.getLogger(\"org\").setLevel(Level.ERROR) def main(args: Array[String]): Unit = &#123; val conf: SparkConf = new SparkConf() .setAppName(\"Kafka Streaming\") .setMaster(\"local[2]\") val ssc = new StreamingContext(conf, Seconds(10)) ssc.checkpoint(\"/Users/cpeixin/IdeaProjects/code_warehouse/spark_streaming/src/main/scala/streaming/\") val kafkaParams: Map[String, Object] = Map[String, Object]( \"bootstrap.servers\" -&gt; \"localhost:9092\", \"key.deserializer\" -&gt; classOf[StringDeserializer], \"value.deserializer\" -&gt; classOf[StringDeserializer], \"group.id\" -&gt; \"kafka_spark_streaming\", \"auto.offset.reset\" -&gt; \"earliest\", // earliest \"enable.auto.commit\" -&gt; (false: java.lang.Boolean) ) val topics = Array(\"weibo_keyword\") val kafkaStream: InputDStream[ConsumerRecord[String, String]] = KafkaUtils .createDirectStream[String, String](ssc, PreferConsistent, Subscribe[String, String](topics, kafkaParams)) kafkaStream.foreachRDD((x: RDD[ConsumerRecord[String, String]]) =&gt;println(x)) ssc.start() ssc.awaitTermination() &#125; def change_data(string_data: String): String = &#123; val json_data: JSONObject = JSON.parseObject(string_data) val date_time: String = json_data.get(\"datetime\").toString val keywordList: String = json_data.get(\"keywordList\").toString keywordList &#125;&#125;ç»“æœï¼š1KafkaRDD[0] at createDirectStream at streaming_case.scala:39ä¸Šé¢çš„ä»£ç ï¼Œåœ¨42è¡ŒforeachRDDçš„ä¸­ï¼Œæˆ‘ä»¬æ‰“å°DStreamä¸­çš„RDDï¼Œç»“æœä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œç¬¬ä¸€ä¸ªæ‰¹æ¬¡ä¸­ï¼Œåªæœ‰ä¸€ä¸ªRDDï¼Œè¿™é‡Œæˆ‘æƒ³è¯´çš„æ˜¯ï¼Œåœ¨ä¸Šé¢çš„è¿™ç§è¯»å–æ•°æ®ä»£ç ä¸­ï¼Œä¸€ä¸ª batch Intervalä¸­ï¼ŒDStream åªæœ‰ä¸€ä¸ªRDDï¼Œå½“ä¸€ä¸ªæ–°çš„æ—¶é—´çª—å£ï¼ˆbatchInterval)å¼€å§‹æ—¶ï¼Œæ­¤æ—¶äº§ç”Ÿä¸€ä¸ªç©ºçš„blockï¼Œæ­¤ååœ¨è¿™ä¸ªçª—å£å†…æ¥å—åˆ°çš„æ•°æ®éƒ½ä¼šç´¯åŠ åˆ°è¿™ä¸ªblockä¸Šï¼Œå½“è¿™ä¸ªæ—¶é—´çª—å£ç»“æŸæ—¶ï¼Œåœæ­¢ç´¯åŠ ï¼Œè¿™ä¸ªblockå¯¹åº”çš„æ•°æ®å°±æ˜¯è¿™ä¸ªæ—¶é—´çª—å£å¯¹åº”çš„RDDåŒ…å«çš„æ•°æ®è¿™é‡Œæˆ‘ä»¬è¿˜å¯ä»¥æ·±å…¥ slideDurationï¼šDurationæ¥çœ‹ï¼Œå’Œåé¢è¦è®²çš„çª—å£å‡½æ•°windiwï¼ˆï¼‰ä¸­ï¼ŒRDDçš„åŒºåˆ«ã€‚batch intervalå…³äºSpark Streamingçš„æ‰¹å¤„ç†æ—¶é—´è®¾ç½®æ˜¯éå¸¸é‡è¦çš„ï¼ŒSpark Streamingåœ¨ä¸æ–­æ¥æ”¶æ•°æ®çš„åŒæ—¶ï¼Œéœ€è¦å¤„ç†æ•°æ®çš„æ—¶é—´ï¼Œæ‰€ä»¥å¦‚æœè®¾ç½®è¿‡æ®µçš„æ‰¹å¤„ç†æ—¶é—´ï¼Œä¼šé€ æˆæ•°æ®å †ç§¯ï¼Œå³æœªå®Œæˆçš„batchæ•°æ®è¶Šæ¥è¶Šå¤šï¼Œä»è€Œå‘ç”Ÿé˜»å¡ã€‚å¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒbatchDurationæœ¬èº«ä¹Ÿä¸èƒ½è®¾ç½®ä¸ºå°äº500msï¼Œè¿™ä¼šå¯¼è‡´Spark Streamingè¿›è¡Œé¢‘ç¹åœ°æäº¤ä½œä¸šï¼Œé€ æˆé¢å¤–çš„å¼€é”€ï¼Œå‡å°‘æ•´ä¸ªç³»ç»Ÿçš„ååé‡ï¼›ç›¸åå¦‚æœå°†batchDurationæ—¶é—´è®¾ç½®å¾—è¿‡é•¿ï¼Œåˆä¼šå½±å“æ•´ä¸ªç³»ç»Ÿçš„ååé‡ã€‚å¦‚ä½•è®¾ç½®ä¸€ä¸ªåˆç†çš„æ‰¹å¤„ç†æ—¶é—´ï¼Œéœ€è¦æ ¹æ®åº”ç”¨æœ¬èº«ã€é›†ç¾¤èµ„æºæƒ…å†µï¼Œä»¥åŠå…³æ³¨å’Œç›‘æ§Spark Streamingç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ¥è°ƒæ•´ï¼Œé‡ç‚¹å…³æ³¨Spark Web UIç›‘æ§ç•Œé¢ä¸­çš„Total Delayï¼Œæ¥è¿›è¡Œè°ƒæ•´ã€‚CheckPointæˆ‘ä»¬æ‰€ç¼–å†™çš„å®æ—¶è®¡ç®—ç¨‹åºå¤§å¤šæ•°éƒ½æ˜¯24å°æ—¶å…¨å¤©å€™ç”Ÿäº§ç¯å¢ƒè¿è¡Œçš„ï¼Œå› æ­¤å¿…é¡»å¯¹ä¸åº”ç”¨ç¨‹åºé€»è¾‘æ— å…³çš„æ•…éšœï¼ˆä¾‹å¦‚ï¼Œç³»ç»Ÿæ•…éšœï¼ŒJVMå´©æºƒç­‰ï¼‰å…·æœ‰å¼¹æ€§ã€‚ä¸ºæ­¤ï¼ŒSpark Streamingéœ€è¦å°†è¶³å¤Ÿçš„ä¿¡æ¯æ£€æŸ¥ç‚¹æŒ‡å‘å®¹é”™å­˜å‚¨ç³»ç»Ÿï¼Œä»¥ä¾¿å¯ä»¥ä»æ•…éšœä¸­æ¢å¤ã€‚æ£€æŸ¥ç‚¹æœ‰ä¸¤ç§ç±»å‹çš„æ•°æ®ã€‚å…ƒæ•°æ®æ£€æŸ¥ç‚¹-å°†å®šä¹‰æµè®¡ç®—çš„ä¿¡æ¯ä¿å­˜åˆ°HDFSç­‰å®¹é”™å­˜å‚¨ä¸­ã€‚è¿™ç”¨äºä»è¿è¡Œæµåº”ç”¨ç¨‹åºçš„é©±åŠ¨ç¨‹åºçš„èŠ‚ç‚¹çš„æ•…éšœä¸­æ¢å¤ã€‚å…ƒæ•°æ®åŒ…æ‹¬ï¼šé…ç½® ç”¨äºåˆ›å»ºæµåº”ç”¨ç¨‹åºçš„é…ç½®ã€‚DStreamæ“ä½œ -å®šä¹‰æµåº”ç”¨ç¨‹åºçš„DStreamæ“ä½œé›†ã€‚ä¸å®Œæ•´çš„æ‰¹æ¬¡ -ä½œä¸šæ’é˜Ÿä½†å°šæœªå®Œæˆçš„æ‰¹æ¬¡ã€‚æ•°æ®æ£€æŸ¥ç‚¹ å°†ç”Ÿæˆçš„RDDä¿å­˜åˆ°å¯é çš„å­˜å‚¨ä¸­ã€‚åœ¨ä¸€äº›æœ‰çŠ¶æ€è½¬æ¢ä¸­ï¼Œè¿™éœ€è¦è·¨å¤šä¸ªæ‰¹æ¬¡åˆå¹¶æ•°æ®ï¼Œè¿™æ˜¯å¿…éœ€çš„ã€‚åœ¨æ­¤ç±»è½¬æ¢ä¸­ï¼Œç”Ÿæˆçš„RDDä¾èµ–äºå…ˆå‰æ‰¹æ¬¡çš„RDDï¼Œè¿™å¯¼è‡´ä¾èµ–é¡¹é“¾çš„é•¿åº¦éšæ—¶é—´ä¸æ–­å¢åŠ ã€‚ä¸ºäº†é¿å…æ¢å¤æ—¶é—´çš„è¿™ç§æ— é™åˆ¶çš„å¢åŠ ï¼ˆä¸ä¾èµ–å…³ç³»é“¾æˆæ¯”ä¾‹ï¼‰ï¼Œæœ‰çŠ¶æ€è½¬æ¢çš„ä¸­é—´RDDå®šæœŸ æ£€æŸ¥ç‚¹åˆ°å¯é çš„å­˜å‚¨ï¼ˆä¾‹å¦‚HDFSï¼‰ä»¥åˆ‡æ–­ä¾èµ–å…³ç³»é“¾ã€‚æ€»è€Œè¨€ä¹‹ï¼Œmetadata checkpointingä¸»è¦è¿˜æ˜¯ä»drvierå¤±è´¥ä¸­æ¢å¤ï¼Œè€ŒData Checkpoingç”¨äºå¯¹æœ‰çŠ¶æ€çš„transformationæ“ä½œè¿›è¡ŒcheckpointingCheckpointå’Œpersistä»æ ¹æœ¬ä¸Šæ˜¯ä¸ä¸€æ ·çš„ï¼š1ã€Cache or persist:Cache or persistä¿å­˜äº†RDDçš„è¡€ç»Ÿå…³ç³»ï¼Œå‡å¦‚æœ‰éƒ¨åˆ†cacheçš„æ•°æ®ä¸¢å¤±å¯ä»¥æ ¹æ®è¡€ç¼˜å…³ç³»é‡æ–°ç”Ÿæˆã€‚2ã€Checkpointä¼šå°†RDDæ•°æ®å†™åˆ°hdfsè¿™ç§å®‰å…¨çš„æ–‡ä»¶ç³»ç»Ÿé‡Œé¢ï¼Œå¹¶ä¸”æŠ›å¼ƒäº†RDDè¡€ç¼˜å…³ç³»çš„è®°å½•ã€‚å³ä½¿persistå­˜å‚¨åˆ°äº†ç£ç›˜é‡Œé¢ï¼Œåœ¨driveråœæ‰ä¹‹åä¼šè¢«åˆ é™¤ï¼Œè€Œcheckpointå¯ä»¥è¢«ä¸‹æ¬¡å¯åŠ¨ä½¿ç”¨ã€‚ä½•æ—¶å¯ç”¨æ£€æŸ¥ç‚¹å¿…é¡»ä¸ºå…·æœ‰ä»¥ä¸‹ä»»ä¸€è¦æ±‚çš„åº”ç”¨ç¨‹åºå¯ç”¨æ£€æŸ¥ç‚¹ï¼šæœ‰çŠ¶æ€è½¬æ¢çš„ç”¨æ³• -å¦‚æœåœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨updateStateByKeyæˆ–reduceByKeyAndWindowï¼ˆå¸¦æœ‰åå‡½æ•°ï¼‰ï¼Œåˆ™å¿…é¡»æä¾›æ£€æŸ¥ç‚¹ç›®å½•ä»¥å…è®¸å®šæœŸè¿›è¡ŒRDDæ£€æŸ¥ç‚¹ã€‚ä»è¿è¡Œåº”ç”¨ç¨‹åºçš„é©±åŠ¨ç¨‹åºæ•…éšœä¸­æ¢å¤ -å…ƒæ•°æ®æ£€æŸ¥ç‚¹ç”¨äºæ¢å¤è¿›åº¦ä¿¡æ¯ã€‚æ³¨æ„ï¼Œæ²¡æœ‰å‰è¿°çŠ¶æ€è½¬æ¢çš„ç®€å•æµåº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä¸å¯ç”¨æ£€æŸ¥ç‚¹çš„æƒ…å†µä¸‹è¿è¡Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»é©±åŠ¨ç¨‹åºæ•…éšœä¸­æ¢å¤ä¹Ÿå°†æ˜¯éƒ¨åˆ†çš„ï¼ˆæŸäº›å·²æ¥æ”¶ä½†æœªå¤„ç†çš„æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ï¼‰ã€‚è¿™é€šå¸¸æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå¹¶ä¸”è®¸å¤šéƒ½ä»¥è¿™ç§æ–¹å¼è¿è¡ŒSpark Streamingåº”ç”¨ç¨‹åºã€‚é¢„è®¡å°†æ¥ä¼šæ”¹å–„å¯¹éHadoopç¯å¢ƒçš„æ”¯æŒã€‚å¦‚ä½•é…ç½®æ£€æŸ¥ç‚¹**å¯ä»¥é€šè¿‡åœ¨å®¹é”™ï¼Œå¯é çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼ŒHDFSï¼ŒS3ç­‰ï¼‰ä¸­è®¾ç½®ç›®å½•æ¥å¯ç”¨æ£€æŸ¥ç‚¹ï¼Œå°†æ£€æŸ¥ç‚¹ä¿¡æ¯ä¿å­˜åˆ°è¯¥ç›®å½•ä¸­ã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨å®Œæˆçš„streamingContext.checkpoint(checkpointDirectory)ã€‚è¿™å°†å…è®¸æ‚¨ä½¿ç”¨å‰é¢æåˆ°çš„æœ‰çŠ¶æ€è½¬æ¢ã€‚æ­¤å¤–ï¼Œå¦‚æœè¦ä½¿åº”ç”¨ç¨‹åºä»é©±åŠ¨ç¨‹åºæ•…éšœä¸­æ¢å¤ï¼Œåˆ™åº”é‡å†™æµåº”ç”¨ç¨‹åºä»¥å…·æœ‰ä»¥ä¸‹è¡Œä¸ºã€‚ç¨‹åºé¦–æ¬¡å¯åŠ¨æ—¶ï¼Œå®ƒå°†åˆ›å»ºä¸€ä¸ªæ–°çš„StreamingContextï¼Œè®¾ç½®æ‰€æœ‰æµï¼Œç„¶åè°ƒç”¨startï¼ˆï¼‰ã€‚å¤±è´¥åé‡æ–°å¯åŠ¨ç¨‹åºæ—¶ï¼Œå®ƒå°†æ ¹æ®æ£€æŸ¥ç‚¹ç›®å½•ä¸­çš„æ£€æŸ¥ç‚¹æ•°æ®é‡æ–°åˆ›å»ºStreamingContextã€‚ä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718def functionToCreateContext(): StreamingContext = &#123; val ssc = new StreamingContext(...) // new context val lines = ssc.socketTextStream(...) // create DStreams ... ssc.checkpoint(checkpointDirectory) // set checkpoint directory ssc&#125;// Get StreamingContext from checkpoint data or create a new oneval context = StreamingContext.getOrCreate(checkpointDirectory, functionToCreateContext _)// Do additional setup on context that needs to be done,// irrespective of whether it is being started or restartedcontext. ...// Start the contextcontext.start()context.awaitTermination()è¯·æ³¨æ„ï¼ŒRDDçš„æ£€æŸ¥ç‚¹ä¼šå¯¼è‡´ä¿å­˜åˆ°å¯é å­˜å‚¨çš„æˆæœ¬ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´RDDè·å¾—æ£€æŸ¥ç‚¹çš„é‚£äº›æ‰¹æ¬¡çš„å¤„ç†æ—¶é—´å¢åŠ ã€‚å› æ­¤ï¼Œéœ€è¦ä»”ç»†è®¾ç½®æ£€æŸ¥ç‚¹çš„é—´éš”ã€‚åœ¨å°æ‰¹é‡ï¼ˆä¾‹å¦‚1ç§’ï¼‰æ—¶ï¼Œæ¯æ‰¹æ£€æŸ¥ç‚¹å¯èƒ½ä¼šå¤§å¤§é™ä½æ“ä½œååé‡ã€‚ç›¸åï¼Œæ£€æŸ¥ç‚¹å¤ªä¸é¢‘ç¹ä¼šå¯¼è‡´æ²¿è¢­å’Œä»»åŠ¡è§„æ¨¡å¢åŠ ï¼Œè¿™å¯èƒ½ä¼šäº§ç”Ÿä¸åˆ©å½±å“ã€‚å¯¹äºéœ€è¦RDDæ£€æŸ¥ç‚¹çš„æœ‰çŠ¶æ€è½¬æ¢ï¼Œé»˜è®¤é—´éš”ä¸ºæ‰¹å¤„ç†é—´éš”çš„å€æ•°ï¼Œè‡³å°‘åº”ä¸º10ç§’ã€‚å¯ä»¥ä½¿ç”¨è®¾ç½® dstream.checkpoint(checkpointInterval)ã€‚é€šå¸¸ï¼ŒDStreamçš„5-10ä¸ªæ»‘åŠ¨é—´éš”çš„æ£€æŸ¥ç‚¹é—´éš”æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å°è¯•è®¾ç½®ã€‚checkpointæ—¶æœºåœ¨spark Streamingä¸­ï¼ŒJobGeneratorç”¨äºç”Ÿæˆæ¯ä¸ªbatchå¯¹åº”çš„jobsï¼Œå®ƒæœ‰ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå®šæ—¶å™¨ çš„å‘¨æœŸå³åˆå§‹åŒ–StreamingContextæ—¶è®¾ç½®batchDurationã€‚è¿™ä¸ªå‘¨æœŸä¸€åˆ°ï¼ŒJobGeneratorå°†è°ƒç”¨generateJobsæ–¹æ³•æ¥ç”Ÿæˆå¹¶æäº¤jobsï¼Œè¿™ä¹‹åè°ƒç”¨doCheckpointæ–¹æ³•æ¥è¿›è¡Œcheckpointã€‚doCheckpointæ–¹æ³•ä¸­ï¼Œä¼šåˆ¤æ–­ å½“å‰æ—¶é—´ä¸streaming application startçš„æ—¶é—´åªå·®æ˜¯å¦æ˜¯ checkpoint durationçš„å€æ•°ï¼Œåªæœ‰åœ¨æ˜¯çš„æƒ…å†µä¸‹æ‰è¿›è¡Œcheckpointã€‚å…·ä½“åº”ç”¨å®ä¾‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119package org.apache.spark.examples.streamingimport java.io.Fileimport java.nio.charset.Charsetimport com.google.common.io.Filesimport org.apache.spark.&#123;SparkConf, SparkContext&#125;import org.apache.spark.broadcast.Broadcastimport org.apache.spark.rdd.RDDimport org.apache.spark.streaming.&#123;Seconds, StreamingContext, Time&#125;import org.apache.spark.util.&#123;IntParam, LongAccumulator&#125;/** * Use this singleton to get or register a Broadcast variable. */object WordBlacklist &#123; @volatile private var instance: Broadcast[Seq[String]] = null def getInstance(sc: SparkContext): Broadcast[Seq[String]] = &#123; if (instance == null) &#123; synchronized &#123; if (instance == null) &#123; val wordBlacklist = Seq(\"a\", \"b\", \"c\") instance = sc.broadcast(wordBlacklist) &#125; &#125; &#125; instance &#125;&#125;/** * Use this singleton to get or register an Accumulator. */object DroppedWordsCounter &#123; @volatile private var instance: LongAccumulator = null def getInstance(sc: SparkContext): LongAccumulator = &#123; if (instance == null) &#123; synchronized &#123; if (instance == null) &#123; instance = sc.longAccumulator(\"WordsInBlacklistCounter\") &#125; &#125; &#125; instance &#125;&#125;object RecoverableNetworkWordCount &#123; def createContext(ip: String, port: Int, outputPath: String, checkpointDirectory: String) : StreamingContext = &#123; // If you do not see this printed, that means the StreamingContext has been loaded // from the new checkpoint println(\"Creating new context\") val outputFile = new File(outputPath) if (outputFile.exists()) outputFile.delete() val sparkConf = new SparkConf().setAppName(\"RecoverableNetworkWordCount\") // Create the context with a 1 second batch size val ssc = new StreamingContext(sparkConf, Seconds(1)) ssc.checkpoint(checkpointDirectory) // Create a socket stream on target ip:port and count the // words in input stream of \\n delimited text (eg. generated by 'nc') val lines = ssc.socketTextStream(ip, port) val words = lines.flatMap(_.split(\" \")) val wordCounts = words.map((_, 1)).reduceByKey(_ + _) wordCounts.foreachRDD &#123; (rdd: RDD[(String, Int)], time: Time) =&gt; // Get or register the blacklist Broadcast val blacklist = WordBlacklist.getInstance(rdd.sparkContext) // Get or register the droppedWordsCounter Accumulator val droppedWordsCounter = DroppedWordsCounter.getInstance(rdd.sparkContext) // Use blacklist to drop words and use droppedWordsCounter to count them val counts = rdd.filter &#123; case (word, count) =&gt; if (blacklist.value.contains(word)) &#123; droppedWordsCounter.add(count) false &#125; else &#123; true &#125; &#125;.collect().mkString(\"[\", \", \", \"]\") val output = s\"Counts at time $time $counts\" println(output) println(s\"Dropped $&#123;droppedWordsCounter.value&#125; word(s) totally\") println(s\"Appending to $&#123;outputFile.getAbsolutePath&#125;\") Files.append(output + \"\\n\", outputFile, Charset.defaultCharset()) &#125; ssc &#125; def main(args: Array[String]): Unit = &#123; if (args.length != 4) &#123; System.err.println(s\"Your arguments were $&#123;args.mkString(\"[\", \", \", \"]\")&#125;\") System.err.println( \"\"\" |Usage: RecoverableNetworkWordCount &lt;hostname&gt; &lt;port&gt; &lt;checkpoint-directory&gt; | &lt;output-file&gt;. &lt;hostname&gt; and &lt;port&gt; describe the TCP server that Spark | Streaming would connect to receive data. &lt;checkpoint-directory&gt; directory to | HDFS-compatible file system which checkpoint data &lt;output-file&gt; file to which the | word counts will be appended | |In local mode, &lt;master&gt; should be 'local[n]' with n &gt; 1 |Both &lt;checkpoint-directory&gt; and &lt;output-file&gt; must be absolute paths \"\"\".stripMargin ) System.exit(1) &#125; val Array(ip, IntParam(port), checkpointDirectory, outputPath) = args val ssc = StreamingContext.getOrCreate(checkpointDirectory, () =&gt; createContext(ip, port, outputPath, checkpointDirectory)) ssc.start() ssc.awaitTermination() &#125;&#125;UpdateStateByKeyæµå¤„ç†ä¸»è¦æœ‰3ç§åº”ç”¨åœºæ™¯ï¼šæ— çŠ¶æ€æ“ä½œã€windowæ“ä½œã€çŠ¶æ€æ“ä½œã€‚updateStateByKeyå°±æ˜¯å…¸å‹çš„çŠ¶æ€æ“ä½œã€‚ä¸‹é¢æ˜¯é’ˆå¯¹updateStateByKeyä¸¾çš„å®ä¾‹ï¼Œä¸»è¦åŠŸèƒ½æ˜¯é’ˆå¯¹æµæ•°æ®ä¸­çš„å…³é”®è¯è¿›è¡Œç»Ÿè®¡ï¼Œå¹¶ä¸”æ˜¯æ ¹æ®å†å²çŠ¶æ€æŒç»­ç»Ÿè®¡ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768package streamingimport com.alibaba.fastjson.&#123;JSON, JSONObject&#125;import org.apache.kafka.clients.consumer.ConsumerRecordimport org.apache.kafka.common.serialization.StringDeserializerimport org.apache.log4j.&#123;Level, Logger&#125;import org.apache.spark.&#123;SparkConf, SparkContext&#125;import org.apache.spark.rdd.RDDimport org.apache.spark.streaming.&#123;Seconds, StreamingContext&#125;import org.apache.spark.streaming.dstream.&#123;DStream, InputDStream&#125;import org.apache.spark.streaming.kafka010.ConsumerStrategies.Subscribeimport org.apache.spark.streaming.kafka010.KafkaUtilsimport org.apache.spark.streaming.kafka010.LocationStrategies.PreferConsistentobject streaming_updatastatebykey &#123; Logger.getLogger(\"org\").setLevel(Level.ERROR) def main(args: Array[String]): Unit = &#123; val conf: SparkConf = new SparkConf() .setAppName(\"Kafka Streaming\") .setMaster(\"local[2]\") val ssc = new StreamingContext(conf, Seconds(2)) ssc.checkpoint(\"/Users/cpeixin/IdeaProjects/code_warehouse/spark_streaming/src/main/scala/streaming/\") val kafkaParams: Map[String, Object] = Map[String, Object]( \"bootstrap.servers\" -&gt; \"localhost:9092\", \"key.deserializer\" -&gt; classOf[StringDeserializer], \"value.deserializer\" -&gt; classOf[StringDeserializer], \"group.id\" -&gt; \"kafka_spark_streaming\", \"auto.offset.reset\" -&gt; \"latest\", // earliest \"enable.auto.commit\" -&gt; (false: java.lang.Boolean) ) val topics = Array(\"weibo_keyword\") val kafkaStream: InputDStream[ConsumerRecord[String, String]] = KafkaUtils .createDirectStream[String, String](ssc, PreferConsistent, Subscribe[String, String](topics, kafkaParams)) val wordcount_dstream: DStream[(String, Int)] = kafkaStream .map((x: ConsumerRecord[String, String]) =&gt; &#123; change_data(x.value()) &#125;) .flatMap((_: String).split(\",\")) .map((x: String) =&gt; (x, 1)) val sum_dstream: DStream[(String, Int)] = wordcount_dstream.updateStateByKey((seq: Seq[Int], state: Option[Int]) =&gt; &#123; var sum: Int = state.getOrElse(0)+seq.sum Option(sum) &#125;) sum_dstream.foreachRDD((keywordFormat_rdd: RDD[(String, Int)]) =&gt; &#123; val sort_rdd: Array[(Int, String)] = keywordFormat_rdd.map((x: (String, Int)) =&gt; &#123;(x._2, x._1)&#125;).sortByKey().top(10) sort_rdd.foreach(println) println(\"====================\") &#125;) ssc.start() ssc.awaitTermination() &#125; def change_data(string_data: String): String = &#123; val json_data: JSONObject = JSON.parseObject(string_data) val date_time: String = json_data.get(\"datetime\").toString val keywordList: String = json_data.get(\"keywordList\").toString keywordList &#125;&#125;æ‰“å°ç»Ÿè®¡ä¿¡æ¯ï¼š12345678910111213141516171819202122&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;(8,å‰ªå¤´)(5,é»‘äººæŠ¬æ£ºé˜Ÿé•¿ç§°å°†ç¯æ¸¸ä¸–ç•Œ)(5,é»‘äºº)(5,é˜Ÿé•¿)(5,ç¯æ¸¸ä¸–ç•Œ)(4,é‡é¤)(4,è¿™é‡é¤ä¹Ÿå¤ªå®åœ¨äº†å§)(3,éƒ‘é’§ä½ç©ºé£è¡Œ)(3,éƒ‘é’§)(3,æ£®æ—)&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;(8,å‰ªå¤´)(7,æ£®æ—)(7,æŒªå¨)(7,ä¼ä½° æŒªå¨çš„æ£®æ—)(7,ä¼ä½°)(6,è‚¤è‰²)(6,çŠ¶æ€)(6,ä»Šå¹´å¤å¤©çš„è‚¤è‰²çŠ¶æ€)(6,ä»Šå¹´å¤å¤©)(5,é»‘äººæŠ¬æ£ºé˜Ÿé•¿ç§°å°†ç¯æ¸¸ä¸–ç•Œ)æ³¨æ„ï¼šç±»ä¼¼updateStateByKeyå’ŒmapWithStateç­‰æœ‰çŠ¶æ€è½¬æ¢ç®—å­ï¼Œç¨‹åºä¸­å¿…é¡»è¦æŒ‡å®šcheckpointæ£€æŸ¥ç‚¹ã€‚çª—å£å‡½æ•°Spark Streamingè¿˜æä¾›äº†_çª—å£è®¡ç®—_ï¼Œå¯è®©æ‚¨åœ¨æ•°æ®çš„æ»‘åŠ¨çª—å£ä¸Šåº”ç”¨è½¬æ¢ã€‚ä¸‹å›¾è¯´æ˜äº†æ­¤æ»‘åŠ¨çª—å£ã€‚å¦‚è¯¥å›¾æ‰€ç¤ºï¼Œæ¯å½“çª—å£_æ»‘åŠ¨_åœ¨æºDSTREAMï¼Œè½å…¥çª—å£å†…çš„æºRDDSè¢«ç»„åˆåŠæ“ä½œä»¥äº§ç”ŸRDDSçš„çª—DSTREAMã€‚åœ¨è¿™ç§ç‰¹å®šæƒ…å†µä¸‹ï¼Œè¯¥æ“ä½œå°†åº”ç”¨äºæ•°æ®çš„æœ€å3ä¸ªæ—¶é—´å•ä½ï¼Œå¹¶ä»¥2ä¸ªæ—¶é—´å•ä½æ»‘åŠ¨ã€‚è¿™è¡¨æ˜ä»»ä½•çª—å£æ“ä½œéƒ½éœ€è¦æŒ‡å®šä¸¤ä¸ªå‚æ•°ã€‚çª—å£é•¿åº¦ - _çª—å£_çš„æŒç»­æ—¶é—´ã€‚æ»‘åŠ¨é—´éš” -è¿›è¡Œçª—å£æ“ä½œçš„é—´éš”ã€‚è¿™ä¸¤ä¸ªå‚æ•°å¿…é¡»æ˜¯æºDStreamçš„æ‰¹å¤„ç†é—´éš”çš„å€æ•°ä¸‹é¢ç»™å‡ºå®ä¾‹ä»£ç ï¼Œæè¿°çš„åœºæ™¯æ˜¯æ¯10ç§’ç»Ÿè®¡ä¸€æ¬¡è¿‡å»30ç§’æœŸé—´ï¼Œå…³é”®è¯å‡ºç°æ¬¡æ•°çš„top 51234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465package streamingimport com.alibaba.fastjson.&#123;JSON, JSONObject&#125;import org.apache.kafka.clients.consumer.ConsumerRecordimport org.apache.kafka.common.serialization.StringDeserializerimport org.apache.log4j.&#123;Level, Logger&#125;import org.apache.spark.SparkConfimport org.apache.spark.rdd.RDDimport org.apache.spark.streaming.dstream.&#123;DStream, InputDStream&#125;import org.apache.spark.streaming.kafka010.ConsumerStrategies.Subscribeimport org.apache.spark.streaming.kafka010.KafkaUtilsimport org.apache.spark.streaming.kafka010.LocationStrategies.PreferConsistentimport org.apache.spark.streaming.&#123;Duration, Seconds, StreamingContext&#125;object streaming_window &#123; Logger.getLogger(\"org\").setLevel(Level.ERROR) def main(args: Array[String]): Unit = &#123; val conf: SparkConf = new SparkConf() .setAppName(\"spark streaming window\") .setMaster(\"local[2]\") val sc = new StreamingContext(conf, Seconds(5)) val kafkaParams: Map[String, Object] = Map[String, Object]( \"bootstrap.servers\" -&gt; \"localhost:9092\", \"key.deserializer\" -&gt; classOf[StringDeserializer], \"value.deserializer\" -&gt; classOf[StringDeserializer], \"group.id\" -&gt; \"kafka_spark_streaming\", \"auto.offset.reset\" -&gt; \"latest\", // earliest \"enable.auto.commit\" -&gt; (false: java.lang.Boolean) ) val topics = Array(\"weibo_keyword\") val kafkaStream: InputDStream[ConsumerRecord[String, String]] = KafkaUtils .createDirectStream[String, String](sc, PreferConsistent, Subscribe[String, String](topics, kafkaParams)) val wordcount_dstream: DStream[(String, Int)] = kafkaStream .map((x: ConsumerRecord[String, String]) =&gt; &#123; get_data(x.value()) &#125;) .flatMap((_: String).split(\",\")) .map((x: String) =&gt; (x, 1)) val window_dstream: DStream[(String, Int)] = wordcount_dstream.reduceByKeyAndWindow((x: Int,y: Int)=&gt;x+y,Seconds(30), Seconds(10)) val result: DStream[(String, Int)] = window_dstream.transform((rdd: RDD[(String, Int)]) =&gt;&#123; val top3: Array[(String, Int)] = rdd.map((x: (String, Int)) =&gt;(x._2,x._1)).sortByKey(ascending = false).map((x: (Int, String)) =&gt;(x._2,x._1)).take(5) sc.sparkContext.makeRDD(top3) &#125;) result.print() sc.start() sc.awaitTermination() &#125; def get_data(string_data: String): String = &#123; val json_data: JSONObject = JSON.parseObject(string_data) val date_time: String = json_data.get(\"datetime\").toString val keywordList: String = json_data.get(\"keywordList\").toString keywordList &#125;&#125;ç»“æœï¼š1234567891011121314151617181920212223242526272829303132333435-------------------------------------------Time: 1588694330000 ms-------------------------------------------(å°ç‰ˆ,6)(é»‘äºº,6)(å°ç‰ˆ101æ¨¡ä»¿é»‘äººæŠ¬æ£º,6)(è®­ç»ƒ,2)(å¬èµ·æ¥å¾ˆå‰å®³çš„ä¸“ä¸šæœ¯è¯­,2)-------------------------------------------Time: 1588694340000 ms-------------------------------------------(é‡é¤,10)(é‡é¤è¿˜æ²¡æ‹å¥½ç…§å°±è¢«ç‰›åƒäº†,10)(å°ç‰ˆ,6)(é»‘äºº,6)(å°ç‰ˆ101æ¨¡ä»¿é»‘äººæŠ¬æ£º,6)-------------------------------------------Time: 1588694350000 ms-------------------------------------------(å§å§,10)(é‡é¤,10)(é‡é¤è¿˜æ²¡æ‹å¥½ç…§å°±è¢«ç‰›åƒäº†,10)(ä¹˜é£ç ´æµªçš„å§å§ä»¬,10)(å°ç‰ˆ,6)-------------------------------------------Time: 1588694360000 ms-------------------------------------------(å§å§,10)(é‡é¤,10)(é‡é¤è¿˜æ²¡æ‹å¥½ç…§å°±è¢«ç‰›åƒäº†,10)(ä¹˜é£ç ´æµªçš„å§å§ä»¬,10)(å¶å†²å¤ªéš¾äº†,9)transformæ“ä½œï¼Œåº”ç”¨åœ¨DStreamä¸Šæ—¶ï¼Œå¯ä»¥ç”¨äºæ‰§è¡Œä»»æ„çš„RDDåˆ°RDDçš„è½¬æ¢æ“ä½œï¼›å®ƒå¯ä»¥ç”¨äºå®ç°ï¼ŒDStream APIä¸­æ‰€æ²¡æœ‰æä¾›çš„æ“ä½œï¼›æ¯”å¦‚è¯´ï¼ŒDStream APIä¸­ï¼Œå¹¶æ²¡æœ‰æä¾›å°†ä¸€ä¸ªDStreamä¸­çš„æ¯ä¸ªbatchï¼Œä¸ä¸€ä¸ªç‰¹å®šçš„RDDè¿›è¡Œjoinçš„æ“ä½œã€‚ä½†æ˜¯æˆ‘ä»¬è‡ªå·±å°±å¯ä»¥ä½¿ç”¨transformæ“ä½œæ¥å®ç°è¯¥åŠŸèƒ½ã€‚è¿™é‡Œçœ‹ reduceByKeyAndWindowï¼ˆï¼‰å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å’Œç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä»£è¡¨çš„æ„ä¹‰å°±æ˜¯ï¼Œçª—å£çš„é•¿åº¦å’Œçª—å£æ»‘åŠ¨é—´éš”ã€‚è¿™é‡Œè¿˜éœ€è¦çŸ¥é“ä¸€ç‚¹ï¼ŒDstreamä¸­çš„RDDä¹Ÿå¯ä»¥è°ƒç”¨persist()æ–¹æ³•ä¿å­˜åœ¨å†…å­˜å½“ä¸­ï¼Œä½†æ˜¯åŸºäºwindowå’Œstateçš„æ“ä½œï¼ŒreduceByWindow,reduceByKeyAndWindow,updateStateByKeyç­‰å®ƒä»¬å·²ç»åœ¨æºç ä¸­é»˜è®¤persistäº†**","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"Spark Streaming è®²è§£","slug":"Spark-Streaming-è®²è§£","date":"2017-04-10T14:22:12.000Z","updated":"2020-05-04T14:25:36.548Z","comments":true,"path":"2017/04/10/Spark-Streaming-è®²è§£/","link":"","permalink":"cpeixin.cn/2017/04/10/Spark-Streaming-%E8%AE%B2%E8%A7%A3/","excerpt":"","text":"ç®€è¿°Spark Streamingæ˜¯æ ¸å¿ƒSpark APIçš„æ‰©å±•ï¼Œè¿‘å®æ—¶è®¡ç®—æ¡†æ¶ã€‚ç‰¹ç‚¹å¯ä¼¸ç¼©ï¼Œé«˜ååé‡ï¼Œå®¹é”™æµå¤„ç†ã€‚è€Œæˆ‘ä»¬ä¹‹å‰è®²çš„Spark SQLæ˜¯è´Ÿè´£å¤„ç†ç¦»çº¿æ•°æ®ã€‚æ—¢ç„¶æ˜¯è®¡ç®—æ¡†æ¶ï¼Œé‚£ä¹ˆå®æˆ˜çš„è¿‡ç¨‹ä¸­è¿˜æ˜¯ä¸‰ä¸ªæ­¥éª¤ï¼Œè¯»å–æ•°æ®æºã€è®¡ç®—æ•°æ®ã€æ•°æ®å­˜å‚¨ï¼šæ•°æ®æºï¼šå¯ä»¥ä»Kafka, Flume, Kinesis, or TCP socketsç­‰æ•°æ®æºè¯»å…¥æ•°æ®è®¡ç®—ï¼šåŒæ ·å¯ä»¥ä½¿ç”¨åŒæ ·çš„mapï¼Œreduceï¼Œjoinç­‰ç®—å­è¿›è¡Œæ•°æ®è®¡ç®—ï¼Œè¿˜æœ‰Spark Streaming ç‰¹æœ‰çš„windowçª—å£å‡½æ•°ã€‚æ•°æ®å­˜å‚¨ï¼šå¯ä»¥å°†å¤„ç†åçš„æ•°æ®æ¨é€åˆ°æ–‡ä»¶ç³»ç»ŸHDFSï¼Œæ•°æ®åº“çš„è¯æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯MySQLï¼ŒMongo DBå’ŒHBaseç­‰ï¼Œå¯¹äºå®æ—¶æ•°æ®çš„å±•ç¤ºå’Œç›‘æ§æ–¹é¢ï¼Œæˆ‘ä»¬æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯å°†æ•°æ®å†™å…¥Elasticsearchä¸­ï¼Œå¹¶ä¸”ä½¿ç”¨Kibanaæˆ–è€…Grafanaæ¥è¿›è¡Œå±•ç¤ºã€‚Spark Streaming æä¾›ä¸€ä¸ªå¯¹äºæµæ•°æ®çš„æŠ½è±¡ DStreamã€‚DStream å¯ä»¥ç”±æ¥è‡ª Apache Kafkaã€Flume æˆ–è€… HDFS çš„æµæ•°æ®ç”Ÿæˆï¼Œä¹Ÿå¯ä»¥ç”±åˆ«çš„ DStream ç»è¿‡å„ç§è½¬æ¢æ“ä½œå¾—æ¥ï¼Œåº•å±‚ DStream ä¹Ÿæ˜¯ç”±å¾ˆå¤šä¸ªåºåˆ—åŒ–çš„ RDD æ„æˆï¼ŒæŒ‰æ—¶é—´ç‰‡ï¼ˆæ¯”å¦‚ä¸€ç§’ï¼‰åˆ‡åˆ†æˆçš„æ¯ä¸ªæ•°æ®å•ä½éƒ½æ˜¯ä¸€ä¸ª RDDã€‚ç„¶åï¼ŒSpark æ ¸å¿ƒå¼•æ“å°†å¯¹ DStream çš„ Transformation æ“ä½œå˜ä¸ºé’ˆå¯¹ Spark ä¸­å¯¹ RDD çš„ Transformation æ“ä½œï¼Œå°† RDD ç»è¿‡æ“ä½œå˜æˆä¸­é—´ç»“æœä¿å­˜åœ¨å†…å­˜ä¸­ã€‚ä¹‹å‰çš„ DataFrame å’Œ DataSet ä¹Ÿæ˜¯åŒæ ·åŸºäº RDDï¼Œæ‰€ä»¥è¯´ RDD æ˜¯ Spark æœ€åŸºæœ¬çš„æ•°æ®æŠ½è±¡ã€‚å°±åƒ Java é‡Œçš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆPrimitive Typeï¼‰ä¸€æ ·ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½å¯ä»¥ç”¨åŸºæœ¬æ•°æ®ç±»å‹æè¿°ã€‚ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™æ ·ï¼Œæ— è®ºæ˜¯ DataFrameï¼Œè¿˜æ˜¯ DStreamï¼Œéƒ½å…·æœ‰ RDD çš„ä¸å¯å˜æ€§ã€åˆ†åŒºæ€§å’Œå®¹é”™æ€§ç­‰ç‰¹è´¨ã€‚æ‰€ä»¥ï¼ŒSpark æ˜¯ä¸€ä¸ªé«˜åº¦ç»Ÿä¸€çš„å¹³å°ï¼Œæ‰€æœ‰çš„é«˜çº§ API éƒ½æœ‰ç›¸åŒçš„æ€§è´¨ï¼Œå®ƒä»¬ä¹‹é—´å¯ä»¥å¾ˆå®¹æ˜“åœ°ç›¸äº’è½¬åŒ–ã€‚Spark çš„é‡å¿ƒå°±æ˜¯ç”¨è¿™ä¸€å¥—å·¥å…·ç»Ÿä¸€æ‰€æœ‰æ•°æ®å¤„ç†çš„åœºæ™¯ã€‚ç”±äº Spark Streaming å°†åº•å±‚çš„ç»†èŠ‚å°è£…èµ·æ¥äº†ï¼Œæ‰€ä»¥å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œåªéœ€è¦æ“ä½œ DStream å°±è¡Œã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä¸€èµ·å­¦ä¹  DStream çš„ç»“æ„ä»¥åŠå®ƒæ”¯æŒçš„è½¬æ¢æ“ä½œå¯¹æ¯”ä¸€èˆ¬åœ¨è®²è¿°Spark Streamingçš„æ—¶å€™ï¼Œå…¶ä»–åšä¸»éƒ½ä¼šåˆ—ä¸€ä¸ªè¡¨æ ¼ï¼Œå°†Stormï¼ŒSpark Streamingï¼ŒFlinkä¸‰ä¸ªå®æ—¶è®¡ç®—æ¡†æ¶è¿›è¡Œå¯¹æ¯”ï¼Œè¿™é‡Œæˆ‘å°±ä¸è¿›è¡Œä¸‰è€…ä¹‹é—´çš„æ¯”è¾ƒäº†ï¼Œç›´æ¥æ ¹æ®æˆ‘è¿™å‡ å¹´ä½¿ç”¨çš„ç»éªŒæ¥åˆ†äº«ä¸€ä¸‹ç›´æ¥çš„ç»“æœï¼ŒStormæ˜¯ä¸€ä¸ªæ—©æœŸçš„æµå¼è®¡ç®—æ¡†æ¶ï¼Œå¯ä»¥åšåˆ°æ¯«ç§’çº§åˆ«çš„è®¡ç®—ï¼Œä½†æ˜¯ç¼–ç¨‹è¯­è¨€ä½¿ç”¨çš„æ˜¯Javaï¼Œä»£ç é‡å¾ˆå¤šï¼Œç¼–ç¨‹å¤æ‚åº¦ä¼šé«˜ä¸€äº›ï¼Œå¹¶ä¸”ç›®å‰å¾ˆå°‘æœ‰å…¬å¸ä½¿ç”¨Stormï¼Œæˆ‘å®ä¹ æœŸåï¼Œåœ¨ç¬¬ä¸€å®¶å…¬å¸çš„ç¬¬ä¸€ä¸ªä»»åŠ¡å°±æ˜¯æ”¹å†™ç°æœ‰çš„Stormä»»åŠ¡ï¼Œè¿ç§»åˆ°Spark Streamingã€‚Spark Streamingçš„æµå¼è®¡ç®—ï¼Œå‡†ç¡®çš„æ¥è®²ï¼Œå¯ä»¥è¯´æ˜¯è¿‘å®æ—¶æˆ–è€…å¾®æ‰¹è®¡ç®—ï¼Œæ‰€ä»¥åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äºæ—¶é—´è¦æ±‚ä¸æ˜¯å¤ªä¸¥æ ¼çš„æƒ…å†µä¸‹ï¼ŒSpark Streamingå¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†çš„åœºæ™¯äº†ã€‚æ”¯æŒJavaï¼ŒScalaï¼Œ Pythonä¸‰ç§è¯­è¨€ã€‚ä½†æ˜¯Spark Streamingæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯æŸäº›éœ€æ±‚ä¸­ï¼Œæˆ‘ä»¬çš„è®¡ç®—ç»“æœåº”è¯¥æ˜¯åŸºäºevent timeæ•°æ®äº§ç”Ÿæ—¶é—´ï¼Œä½†æ˜¯åœ¨Spark Streamingä¸­ï¼Œæœ‰æ—¶ä¼šå› ä¸ºå»¶è¿Ÿçš„åŸå› ï¼Œè®¡ç®—ç»“æœä¼šåŸºäºprocess time æ•°æ®åˆ°è¾¾çš„æ—¶é—´ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘åœ¨åé¢çš„Structured Streamingä¹Ÿä¼šè®²åˆ°ã€‚Flinkå¯ä»¥è¯´æ˜¯æµå¼è®¡ç®—çš„åèµ·ä¹‹ç§€ï¼Œå¹¶ä¸”å°±æ˜¯ä¸ºäº†æµè®¡ç®—è€Œè¯ç”Ÿï¼Œå®ƒé‡‡ç”¨äº†åŸºäºæ“ä½œç¬¦ï¼ˆOperatorï¼‰çš„è¿ç»­æµæ¨¡å‹ï¼Œå¯ä»¥åšåˆ°å¾®ç§’çº§åˆ«çš„å»¶è¿Ÿã€‚åŒæ ·æ”¯æŒJavaï¼ŒScalaï¼ŒPythonä¸‰ç§è¯­è¨€ï¼Œåœ¨æˆ‘è¿˜è®¤è®¤çœŸçœŸå†™Sparkä»£ç çš„æ—¶å€™ï¼Œæ¯å¤©éƒ½èƒ½çœ‹åˆ°é“ºå¤©ç›–åœ°çš„Flinkæ–°é—»ï¼ŒFlink ç”¨æµå¤„ç†å»æ¨¡æ‹Ÿæ‰¹å¤„ç†çš„æ€æƒ³ï¼Œæ¯” Spark ç”¨æ‰¹å¤„ç†å»æ¨¡æ‹Ÿæµå¤„ç†çš„æ€æƒ³æ‰©å±•æ€§æ›´å¥½ï¼Œæ‰€ä»¥æˆ‘ç›¸ä¿¡å°†æ¥ Flink ä¼šå‘å±•çš„è¶Šæ¥è¶Šå¥½ï¼Œç”Ÿæ€å’Œç¤¾åŒºå„æ–¹é¢è¿½ä¸Š Sparkã€‚æ¯”å¦‚ï¼Œé˜¿é‡Œå·´å·´å°±åŸºäº Flink æ„å»ºäº†å…¬å¸èŒƒå›´å†…å…¨å¹³å°ä½¿ç”¨çš„æ•°æ®å¤„ç†å¹³å° Blinkï¼Œç¾å›¢ã€é¥¿äº†ä¹ˆç­‰å…¬å¸ä¹Ÿéƒ½æ¥å— Flink ä½œä¸ºæ•°æ®å¤„ç†è§£å†³æ–¹æ¡ˆã€‚å®ä¾‹è¿™é‡Œç”¨ä¸€ä¸ªå®ä¾‹æ¥å±•ç¤ºä¸€ä¸‹å®é™…å·¥ä½œä¸­ï¼ŒSpark Streamingçš„å¤§æ¦‚æµç¨‹ï¼šæ•°æ®çš„é‡‡é›†æˆ–è€…ç½‘ç«™æ•°æ®æ”¶é›†â€”&gt;Kafkaâ€”&gt;Spark Streamingâ€”&gt;show data or save dataä¸‹é¢è¿™ç«¯pythonä»£ç æ˜¯æ•°æ®é‡‡é›†æˆ–è€…æ”¶é›†ï¼Œæ‰“åˆ°Kafkaçš„é˜¶æ®µã€‚æˆ‘æœ¬æƒ³å†™ä¸ªçˆ¬è™«æ¥åšå®æ—¶æ•°æ®çš„ï¼Œä½†æ˜¯æˆ‘æƒ³èµ·æ¥æˆ‘çš„Elasticsearché›†ç¾¤ä¸­æ­£åœ¨å®æ—¶çš„çˆ¬å–æŸåšæ•°æ®ï¼Œæ‰€ä»¥å°±ç›´æ¥é—´éš”è°ƒç”¨ESï¼Œæ¥æ‰“å…¥Kafkaä¸­ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152# -*- coding: utf-8 -*-import timefrom kafka import KafkaProducerimport jsonfrom elasticsearch import Elasticsearchproducer = KafkaProducer(value_serializer=lambda v: json.dumps(v).encode('utf-8'),bootstrap_servers=['localhost:9092'])def getEsArticle(): \"\"\"åŠ¨æ€é“¾æ¥\"\"\" es = Elasticsearch( ['xxx.xxx.xxx.xxx:9205'], # åœ¨åšä»»ä½•æ“ä½œä¹‹å‰ï¼Œå…ˆè¿›è¡Œå—…æ¢ sniff_on_start=True, # èŠ‚ç‚¹æ²¡æœ‰å“åº”æ—¶ï¼Œè¿›è¡Œåˆ·æ–°ï¼Œé‡æ–°è¿æ¥ sniff_on_connection_fail=True, # æ¯ 60 ç§’åˆ·æ–°ä¸€æ¬¡ sniffer_timeout=10 ) # æ¨¡ç³ŠæŸ¥è¯¢ query = &#123; \"query\": &#123; \"match_all\": &#123;&#125; &#125;, \"sort\": &#123; \"datetime\": &#123; \"order\": \"desc\" # é™åº &#125; &#125;, \"size\": 10 &#125; esResult = es.search(index=\"article_warehouse*\", body=query) for hit in esResult['hits']['hits']: data = &#123;'datetime': hit[\"_source\"][\"datetime\"], 'keywordList': hit[\"_source\"][\"keywordList\"]&#125; print(data) producer.send('weibo_keyword', data)def main(): while True: getEsArticle() time.sleep(10)if __name__ == '__main__': main()æ‰“å…¥æ•°æ®çš„æ ¼å¼ï¼š12345678910111213&#123;&#39;datetime&#39;: &#39;2017-04-10 18:29:42&#39;, &#39;keywordList&#39;: &#39;ç‰¹æœ—æ™®,å¾—å¿—,é¢†å¤´ç¾Š,æ²»å›½,çˆ±å¿ƒ,ç¾å›½,æœ¬é¢†&#39;&#125;&#123;&#39;datetime&#39;: &#39;2017-04-10 18:29:56&#39;, &#39;keywordList&#39;: &#39;è½¦å‹,æ•´ä½“,é•¿å®‰,æ‰‹åŠ¨æŒ¡,è‡ªåŠ¨,ä¾¿åˆ©æ€§,æ–°æ‰‹,å¹³é¡º,å‘åŠ¨æœº,ç‰ˆæœ¬,å¸‚åŒº,ç§¯ç‚­,ç¼–æƒ³,å°ç¼–,é©»è½¦,é€Ÿæ‰‹,æ¬¡é¡¶,å°ä¼™ä¼´,è½¦å¸ˆ,çœå¿ƒ&#39;&#125;&#123;&#39;datetime&#39;: &#39;2017-04-10 18:29:53&#39;, &#39;keywordList&#39;: &#39;åŒæ¡Œ,ä¸€ä¸ªç”·å­©,é«˜ä¸‰,äººæ‰,æ„Ÿè§‰&#39;&#125;&#123;&#39;datetime&#39;: &#39;2017-04-10 18:29:53&#39;, &#39;keywordList&#39;: &#39;ç©å®¶,æ®µä½,è½åœ°,é’¢æª,æ¸¸æˆ,æ–°äºº,æœºå™¨äºº,æˆç›’,å¼€å±€,å†›äº‹åŸºåœ°,ä½ç«¯,å°å­¦ç”Ÿ,ç²¾è‹±,é«˜æ°´å¹³,æƒ©ç½š,è°¢è°¢,å­—æ•°,é«˜ç«¯,ä¼˜è´¨,æˆ˜åœº&#39;&#125;&#123;&#39;datetime&#39;: &#39;2017-04-10 18:29:52&#39;, &#39;keywordList&#39;: &#39;å…¬è¯,æƒ…ä¾£,é’æ˜¥æ ¡å›­,æ”¾å­¦,æ ¡å›­,åŒå­¦,å°è±¡,å®¶äºº&#39;&#125;&#123;&#39;datetime&#39;: &#39;2017-04-10 18:29:52&#39;, &#39;keywordList&#39;: &#39;é˜¿è¨å¾·,è¡¨å“¥,ç»æµå‘½è„‰,çš‡äº²å›½æˆš,å™åˆ©äºš,åŠ¨æ‰‹,å›½å®¶&#39;&#125;&#123;&#39;datetime&#39;: &#39;2017-04-10 18:29:51&#39;, &#39;keywordList&#39;: &#39;é›†è®­,é«˜å¸¦,ä½“å·¥é˜Ÿ,å¤§ç‰Œ,åŠ²æ—…,çƒå‘˜,å—äºš,æµªè´¹,å°åº¦,æ—¶ä»£,å›½å®¶&#39;&#125;&#123;&#39;datetime&#39;: &#39;2017-04-10 18:29:51&#39;, &#39;keywordList&#39;: &#39;å›¾ç‰‡,è€å¸ˆ,å…¨æ ¡,åŒæ¡Œ,çˆ±æ…•,å§¨å¦ˆ,æ‰‹å†Œ,ç”·å­©,é’æ˜¥,çª—æˆ·,ä¸»æƒ,æˆ‘ä¼š,æ¯•ä¸š&#39;&#125;&#123;&#39;datetime&#39;: &#39;2017-04-10 18:29:51&#39;, &#39;keywordList&#39;: &#39;æ®µä½,ç©å®¶,åˆ†ä¼š,åˆ†æ•°,æˆ˜åœº&#39;&#125;&#123;&#39;datetime&#39;: &#39;2017-04-10 18:29:50&#39;, &#39;keywordList&#39;: &#39;æ¯å­,ç›’å­,è‡ªä¹ å®¤,ä¸“å››,ä¿é€ç”Ÿ,ä½œæ–‡,å•è¯,ç¤¼ç‰©,ä¼¤å¿ƒ,è€ƒè¯•,è€³æœµ,è·ç¦»,å§‘å¨˜&#39;&#125;&#123;&#39;datetime&#39;: &#39;2017-04-10 18:29:50&#39;, &#39;keywordList&#39;: &#39;è¾¹è·¯ä¼ ,æœ‰çƒ,æ›¼è”,å…¨å‘˜,å‡ºåŠ›&#39;&#125;&#123;&#39;datetime&#39;: &#39;2017-04-10 18:30:07&#39;, &#39;keywordList&#39;: &#39;Tæ¤,å¥³ç”Ÿ,èº«æ,æ—¶å°š,å¥³è£…,å°èŠ±,è¢–å£,æ¡çº¹,å°ç¼–,æ¿å‹,æ½˜é¢†,è“¬è“¬è£™,è¸æ¬¾,ç™¾è¤¶è£™,ç¢èŠ±,æ‹œæ‹œ,é»‘ç™½ç›¸é—´,ç‰›ä»”,ç‰›ä»”è£¤,æ·±è‰²&#39;&#125;&#123;&#39;datetime&#39;: &#39;2017-04-10 18:30:06&#39;, &#39;keywordList&#39;: &#39;å‘¨æ¢…æ£®,ç»æµ&#39;&#125;ä¸‹é¢çš„spark streamingä»£ç æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯è¯»å–æ•°æ®ï¼Œä»jsonæ ¼å¼ä¸­è§£æå‡ºæ¥ï¼Œéšåæ‰“å°ï¼Œè¿™é‡Œæˆ‘æ²¡æœ‰ç›´æ¥å†™å…¥çš„æ•°æ®åº“æˆ–è€…esä¸­ï¼Œä¸»è¦æ˜¯ç»™å‡ºä¸€ä¸ªspark streamingçš„ç¨‹åºæ¡†æ¶ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556package streamingimport org.apache.kafka.clients.consumer.ConsumerRecordimport org.apache.kafka.common.serialization.StringDeserializerimport org.apache.spark.rdd.RDDimport org.apache.spark.streaming.dstream.InputDStreamimport org.apache.spark.streaming.&#123;Seconds, StreamingContext&#125;import org.apache.spark.&#123;HashPartitioner, SparkConf&#125;import org.apache.spark.streaming.kafka010.ConsumerStrategies.Subscribeimport org.apache.spark.streaming.kafka010.KafkaUtilsimport org.apache.spark.streaming.kafka010.LocationStrategies.PreferConsistentimport com.alibaba.fastjson.&#123;JSON, JSONArray, JSONObject&#125;import org.apache.log4j.&#123;Level, Logger&#125;object streaming_weibo &#123; // è®¾ç½®æ—¥å¿—çº§åˆ« Logger.getLogger(\"org\").setLevel(Level.ERROR) def main(args: Array[String]): Unit = &#123; val conf: SparkConf = new SparkConf() .setAppName(\"Kafka Streaming\") .setMaster(\"local[2]\") val ssc = new StreamingContext(conf, Seconds(10)) ssc.checkpoint(\"/Users/cpeixin/IdeaProjects/code_warehouse/spark_streaming/src/main/scala/streaming/\") val kafkaParams: Map[String, Object] = Map[String, Object]( \"bootstrap.servers\" -&gt; \"localhost:9092\", \"key.deserializer\" -&gt; classOf[StringDeserializer], \"value.deserializer\" -&gt; classOf[StringDeserializer], \"group.id\" -&gt; \"kafka_spark_streaming\", \"auto.offset.reset\" -&gt; \"earliest\", // earliest \"enable.auto.commit\" -&gt; (false: java.lang.Boolean) ) val topics = Array(\"weibo_keyword\") val kafkaStream: InputDStream[ConsumerRecord[String, String]] = KafkaUtils .createDirectStream[String, String](ssc, PreferConsistent, Subscribe[String, String](topics, kafkaParams)) kafkaStream.map((x: ConsumerRecord[String, String]) =&gt; &#123; get_data(x.value()) &#125;).foreachRDD((x: RDD[String]) =&gt; x.foreach(println)) ssc.start() ssc.awaitTermination() &#125; def get_data(string_data: String): String = &#123; val json_data: JSONObject = JSON.parseObject(string_data) val date_time: String = json_data.get(\"datetime\").toString val keywordList: String = json_data.get(\"keywordList\").toString keywordList &#125;&#125;12345678910111213141516æ‰‹æœº,å®‰å“,åƒç´ ,æ‘„åƒå¤´,å›½äº§å“ç‰Œ,å“ç‰Œ,åä¸º,å°ç±³,æ——èˆ°,è‹±å¯¸,å±å¹•,ç”µæ± å®¹é‡,å¯¹ç„¦,é€†å…‰,éŸ³è´¨,ç³»ç»Ÿ,åç½®,æœºèº«,å…‰çº¿,å…‰å­¦ç”µåœºçº¿,æœ¬å­,æ ·å­,é“ƒå“,å¿ƒå½¢,å·å­,çŒ«å„¿,å¼‚æ€§,ç”·æœ‹å‹,æ¿å‡³,ç”µè·,æˆ‘ä¼š,æ¡Œå­,å°å­¦èŒƒç•´,å¿ƒæƒ…,èƒ½åŠ›,ä¸œè¥¿è½¦å‹,æ•´ä½“,é•¿å®‰,æ‰‹åŠ¨æŒ¡,è‡ªåŠ¨,ä¾¿åˆ©æ€§,æ–°æ‰‹,å¹³é¡º,å‘åŠ¨æœº,ç‰ˆæœ¬,å¸‚åŒº,ç§¯ç‚­,ç¼–æƒ³,å°ç¼–,é©»è½¦,é€Ÿæ‰‹,æ¬¡é¡¶,å°ä¼™ä¼´,è½¦å¸ˆ,çœå¿ƒé«˜å°”å¤«,å¤§ä¼—,é¢†é€Ÿ,é«˜å˜‰,æŠ€æœ¯å®åŠ›,è¯•è½¦,æ€§ä»·æ¯”,èˆ’é€‚æ€§,å†…é¥°,äº®ç‚¹,äº²æˆš,é‡åº†,æ¶ˆè´¹è€…,åŠ¨åŠ›,ç©ºé—´,äººå£«,åŸå› ,äº§å“,æƒ…å†µåŒæ¡Œ,ä¸€ä¸ªç”·å­©,é«˜ä¸‰,äººæ‰,æ„Ÿè§‰æ–¹å‘æœº,æ¼†é¢,å¤§å”,å·®ç‚¹,å›¾ç‰‡å…¬è¯,æƒ…ä¾£,é’æ˜¥æ ¡å›­,æ”¾å­¦,æ ¡å›­,åŒå­¦,å°è±¡,å®¶äººæ£’æ£’,ä¸œå¿˜è¥¿,å¤ªä¹…,æ–¹è¨€,è€æ±‰,è€å¤´,è€å¸ˆ,æ—¶é—´å›¾ç‰‡,è€å¸ˆ,å…¨æ ¡,åŒæ¡Œ,çˆ±æ…•,å§¨å¦ˆ,æ‰‹å†Œ,ç”·å­©,é’æ˜¥,çª—æˆ·,ä¸»æƒ,æˆ‘ä¼š,æ¯•ä¸šåˆ¹è½¦,å•Šå•Šå•Š,ç¯®çƒåœº,è½¬åœˆ,è„¸çº¢,å¼ å¼€,æ‰‹è‡‚,æ±‰å­,å£æ°”,æœ‹å‹æ®µä½,ç©å®¶,åˆ†ä¼š,åˆ†æ•°,æˆ˜åœºæ³•å­¦ä¸“å®¶è°ˆæ‹’ç»åŠ ç­è¢«åˆ¤èµ”1.8ä¸‡,è¢«åˆ¤èµ”,æ³•å­¦,ä¸“å®¶æ¯å­,ç›’å­,è‡ªä¹ å®¤,ä¸“å››,ä¿é€ç”Ÿ,ä½œæ–‡,å•è¯,ç¤¼ç‰©,ä¼¤å¿ƒ,è€ƒè¯•,è€³æœµ,è·ç¦»,å§‘å¨˜æ€åŸŸ,å“å‘³å‘¨æ¢…æ£®,ç»æµ","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"Spark æ€§èƒ½ä¼˜åŒ–æ–¹å‘","slug":"Spark-æ€§èƒ½ä¼˜åŒ–æ–¹å‘","date":"2017-04-05T15:48:43.000Z","updated":"2020-04-29T13:25:12.537Z","comments":true,"path":"2017/04/05/Spark-æ€§èƒ½ä¼˜åŒ–æ–¹å‘/","link":"","permalink":"cpeixin.cn/2017/04/05/Spark-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%96%B9%E5%90%91/","excerpt":"","text":"ç›®å‰å¤§æ•°æ®ä¸šåŠ¡ä¸­ï¼ŒSparkå¼€å‘ä»»åŠ¡æ˜¯å¾ˆå¤šçš„ï¼Œä¸€å‘¨ä¸€ä¸ªå°ä»»åŠ¡ï¼Œä¸¤ä¸‰ä¸ªæœˆä¸€ä¸ªå¤§é¡¹ç›®ï¼Œæ ¹æ®ä¸åŒå…¬å¸æ•°æ®é‡çš„å¤§å°ï¼Œé‚£ä¹ˆSparkä»»åŠ¡éœ€è¦ä¼˜åŒ–çš„ç¨‹åº¦ä¹Ÿå°±æœ‰æ‰€ä¸åŒï¼Œä¸€èˆ¬å…¬å¸ä¸­çš„å¤§æ•°æ®é›†ç¾¤è®¡ç®—èµ„æºéƒ½æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥å¦‚æœæŸä¸ªSparkä»»åŠ¡æ‰€å ç”¨çš„èµ„æºè¿‡å¤§ï¼Œåˆ™ä¼šå½±å“Yarné˜Ÿåˆ—ä¸­ï¼Œå…¶ä»–ä»»åŠ¡çš„è¿è¡Œï¼Œå°¤å…¶æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œè¿™ç§æƒ…å†µè¿˜æ˜¯è¦é¿å…å‘ç”Ÿçš„ã€‚åœ¨å¤§æ•°æ®ä½¿ç”¨ã€å¼€å‘è¿‡ç¨‹çš„æ€§èƒ½ä¼˜åŒ–ä¸€èˆ¬å¯ä»¥ä»ä»¥ä¸‹è§’åº¦ç€æ‰‹è¿›è¡Œã€‚SQL è¯­å¥ä¼˜åŒ–ä½¿ç”¨å…³ç³»æ•°æ®åº“çš„æ—¶å€™ï¼ŒSQL ä¼˜åŒ–æ˜¯æ•°æ®åº“ä¼˜åŒ–çš„é‡è¦æ‰‹æ®µï¼Œå› ä¸ºå®ç°åŒæ ·åŠŸèƒ½ä½†æ˜¯ä¸åŒçš„ SQL å†™æ³•å¯èƒ½å¸¦æ¥çš„æ€§èƒ½å·®è·æ˜¯æ•°é‡çº§çš„ã€‚æˆ‘ä»¬çŸ¥é“åœ¨å¤§æ•°æ®åˆ†ææ—¶ï¼Œç”±äºæ•°æ®é‡è§„æ¨¡å·¨å¤§ï¼Œæ‰€ä»¥ SQL è¯­å¥å†™æ³•å¼•èµ·çš„æ€§èƒ½å·®è·å°±æ›´åŠ å·¨å¤§ã€‚å…¸å‹çš„å°±æ˜¯ Hive çš„ MapJoin è¯­æ³•ï¼Œå¦‚æœ join çš„ä¸€å¼ è¡¨æ¯”è¾ƒå°ï¼Œæ¯”å¦‚åªæœ‰å‡  MBï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ MapJoin è¿›è¡Œè¿æ¥ï¼ŒHive ä¼šå°†è¿™å¼ å°è¡¨å½“ä½œ Cache æ•°æ®å…¨éƒ¨åŠ è½½åˆ°æ‰€æœ‰çš„ Map ä»»åŠ¡ä¸­ï¼Œåœ¨ Map é˜¶æ®µå®Œæˆ join æ“ä½œï¼Œæ— éœ€ shuffleã€‚æ•°æ®å€¾æ–œå¤„ç†æ•°æ®å€¾æ–œçš„åŸç†å¾ˆç®€å•ï¼šåœ¨è¿›è¡Œshuffleçš„æ—¶å€™ï¼Œå¿…é¡»å°†å„ä¸ªèŠ‚ç‚¹ä¸Šç›¸åŒçš„keyæ‹‰å–åˆ°æŸä¸ªèŠ‚ç‚¹ä¸Šçš„ä¸€ä¸ªtaskæ¥è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚æŒ‰ç…§keyè¿›è¡Œèšåˆæˆ–joinç­‰æ“ä½œã€‚æ­¤æ—¶å¦‚æœæŸä¸ªkeyå¯¹åº”çš„æ•°æ®é‡ç‰¹åˆ«å¤§çš„è¯ï¼Œå°±ä¼šå‘ç”Ÿæ•°æ®å€¾æ–œã€‚æ¯”å¦‚å¤§éƒ¨åˆ†keyå¯¹åº”10æ¡æ•°æ®ï¼Œä½†æ˜¯ä¸ªåˆ«keyå´å¯¹åº”äº†100ä¸‡æ¡æ•°æ®ï¼Œé‚£ä¹ˆå¤§éƒ¨åˆ†taskå¯èƒ½å°±åªä¼šåˆ†é…åˆ°10æ¡æ•°æ®ï¼Œç„¶å1ç§’é’Ÿå°±è¿è¡Œå®Œäº†ï¼›ä½†æ˜¯ä¸ªåˆ«taskå¯èƒ½åˆ†é…åˆ°äº†100ä¸‡æ•°æ®ï¼Œè¦è¿è¡Œä¸€ä¸¤ä¸ªå°æ—¶ã€‚å› æ­¤ï¼Œæ•´ä¸ªSparkä½œä¸šçš„è¿è¡Œè¿›åº¦æ˜¯ç”±è¿è¡Œæ—¶é—´æœ€é•¿çš„é‚£ä¸ªtaskå†³å®šçš„ã€‚æ·˜å®çš„äº§å“ç»ç†æ›¾ç»è®²è¿‡ä¸€ä¸ªæ¡ˆä¾‹ï¼Œä»–æƒ³æŠŠç”¨æˆ·æ—¥å¿—å’Œç”¨æˆ·è¡¨é€šè¿‡ç”¨æˆ· ID è¿›è¡Œ joinï¼Œä½†æ˜¯æ—¥å¿—è¡¨æœ‰å‡ äº¿æ¡ è®°å½•çš„ç”¨æˆ· ID æ˜¯ nullï¼ŒHive æŠŠ null å½“ä½œä¸€ä¸ªå­—æ®µå€¼ shuffle åˆ°åŒä¸€ä¸ª Reduceï¼Œç»“æœè¿™ä¸ª Reduce è·‘äº†ä¸¤ å¤©ä¹Ÿæ²¡è·‘å®Œï¼ŒSQL å½“ç„¶ä¹Ÿæ‰§è¡Œä¸å®Œã€‚åƒè¿™ç§æƒ…å†µçš„æ•°æ®å€¾æ–œï¼Œå› ä¸º null å­—æ®µæ²¡æœ‰æ„ä¹‰ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ where æ¡ä»¶é‡ŒåŠ ä¸€ä¸ª userID != null è¿‡æ»¤æ‰å°±å¯ä»¥äº†ã€‚å®šä½å¯¼è‡´æ•°æ®å€¾æ–œçš„ä»£ç æ•°æ®å€¾æ–œåªä¼šå‘ç”Ÿåœ¨shuffleè¿‡ç¨‹ä¸­ã€‚è¿™é‡Œç»™å¤§å®¶ç½—åˆ—ä¸€äº›å¸¸ç”¨çš„å¹¶ä¸”å¯èƒ½ä¼šè§¦å‘shuffleæ“ä½œçš„ç®—å­ï¼š distinctã€groupByKeyã€reduceByKeyã€aggregateByKeyã€joinã€cogroupã€repartitionç­‰ã€‚å‡ºç°æ•°æ®å€¾æ–œæ—¶ï¼Œå¯èƒ½å°±æ˜¯ä½ çš„ä»£ç ä¸­ä½¿ç”¨äº†è¿™äº›ç®—å­ä¸­çš„æŸä¸€ä¸ªæ‰€å¯¼è‡´çš„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡Spark Web UIï¼ŒæŸ¥çœ‹å„ä¸ªtaskçš„è¿è¡Œæ—¶é—´å¼‚å¸¸ï¼Œæˆ–è€…ä»yarnæ—¥å¿—ä¸­æŸ¥çœ‹taskçš„è¿è¡Œä¿¡æ¯ï¼Œæ˜¯å¦å­˜åœ¨æŸä¸ªtaskå†…å­˜æº¢å‡ºçš„æƒ…å†µã€‚æŸ¥çœ‹å¯¼è‡´æ•°æ®å€¾æ–œçš„keyçš„æ•°æ®åˆ†å¸ƒæƒ…å†µåœ¨ç¡®å®šäº†æ•°æ®å€¾æ–œçš„æƒ…å†µä¸‹ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æŸ¥çœ‹é”å®šä½ç½®çš„keyåˆ†å¸ƒï¼Œæ¯”å¦‚RDD.countByKey()ã€‚ç„¶åå¯¹ç»Ÿè®¡å‡ºæ¥çš„å„ä¸ªkeyå‡ºç°çš„æ¬¡æ•°ï¼Œcollect/takeåˆ°å®¢æˆ·ç«¯æ‰“å°ä¸€ä¸‹ï¼Œå°±å¯ä»¥çœ‹åˆ°keyçš„åˆ†å¸ƒæƒ…å†µã€‚æ•°æ®å€¾æ–œè§£å†³æ–¹æ¡ˆä½¿ç”¨Hive ETLé¢„å¤„ç†æ•°æ®æ–¹æ¡ˆé€‚ç”¨åœºæ™¯ï¼šå¯¼è‡´æ•°æ®å€¾æ–œçš„æ˜¯Hiveè¡¨ã€‚å¦‚æœè¯¥Hiveè¡¨ä¸­çš„æ•°æ®æœ¬èº«å¾ˆä¸å‡åŒ€ï¼ˆæ¯”å¦‚æŸä¸ªkeyå¯¹åº”äº†100ä¸‡æ•°æ®ï¼Œå…¶ä»–keyæ‰å¯¹åº”äº†10æ¡æ•°æ®ï¼‰ï¼Œè€Œä¸”ä¸šåŠ¡åœºæ™¯éœ€è¦é¢‘ç¹ä½¿ç”¨Sparkå¯¹Hiveè¡¨æ‰§è¡ŒæŸä¸ªåˆ†ææ“ä½œï¼Œé‚£ä¹ˆæ¯”è¾ƒé€‚åˆä½¿ç”¨è¿™ç§æŠ€æœ¯æ–¹æ¡ˆã€‚æ–¹æ¡ˆå®ç°æ€è·¯ï¼šæ­¤æ—¶å¯ä»¥è¯„ä¼°ä¸€ä¸‹ï¼Œæ˜¯å¦å¯ä»¥é€šè¿‡Hiveæ¥è¿›è¡Œæ•°æ®é¢„å¤„ç†ï¼ˆå³é€šè¿‡Hive ETLé¢„å…ˆå¯¹æ•°æ®æŒ‰ç…§keyè¿›è¡Œèšåˆï¼Œæˆ–è€…æ˜¯é¢„å…ˆå’Œå…¶ä»–è¡¨è¿›è¡Œjoinï¼‰ï¼Œç„¶ååœ¨Sparkä½œä¸šä¸­é’ˆå¯¹çš„æ•°æ®æºå°±ä¸æ˜¯åŸæ¥çš„Hiveè¡¨äº†ï¼Œè€Œæ˜¯é¢„å¤„ç†åçš„Hiveè¡¨ã€‚æ­¤æ—¶ç”±äºæ•°æ®å·²ç»é¢„å…ˆè¿›è¡Œè¿‡èšåˆæˆ–joinæ“ä½œäº†ï¼Œé‚£ä¹ˆåœ¨Sparkä½œä¸šä¸­ä¹Ÿå°±ä¸éœ€è¦ä½¿ç”¨åŸå…ˆçš„shuffleç±»ç®—å­æ‰§è¡Œè¿™ç±»æ“ä½œäº†ã€‚æ–¹æ¡ˆå®ç°åŸç†ï¼šè¿™ç§æ–¹æ¡ˆä»æ ¹æºä¸Šè§£å†³äº†æ•°æ®å€¾æ–œï¼Œå› ä¸ºå½»åº•é¿å…äº†åœ¨Sparkä¸­æ‰§è¡Œshuffleç±»ç®—å­ï¼Œé‚£ä¹ˆè‚¯å®šå°±ä¸ä¼šæœ‰æ•°æ®å€¾æ–œçš„é—®é¢˜äº†ã€‚ä½†æ˜¯è¿™é‡Œä¹Ÿè¦æé†’ä¸€ä¸‹å¤§å®¶ï¼Œè¿™ç§æ–¹å¼å±äºæ²»æ ‡ä¸æ²»æœ¬ã€‚å› ä¸ºæ¯•ç«Ÿæ•°æ®æœ¬èº«å°±å­˜åœ¨åˆ†å¸ƒä¸å‡åŒ€çš„é—®é¢˜ï¼Œæ‰€ä»¥Hive ETLä¸­è¿›è¡Œgroup byæˆ–è€…joinç­‰shuffleæ“ä½œæ—¶ï¼Œè¿˜æ˜¯ä¼šå‡ºç°æ•°æ®å€¾æ–œï¼Œå¯¼è‡´Hive ETLçš„é€Ÿåº¦å¾ˆæ…¢ã€‚æˆ‘ä»¬åªæ˜¯æŠŠæ•°æ®å€¾æ–œçš„å‘ç”Ÿæå‰åˆ°äº†Hive ETLä¸­ï¼Œé¿å…Sparkç¨‹åºå‘ç”Ÿæ•°æ®å€¾æ–œè€Œå·²ã€‚æ–¹æ¡ˆä¼˜ç‚¹ï¼šå®ç°èµ·æ¥ç®€å•ä¾¿æ·ï¼Œæ•ˆæœè¿˜éå¸¸å¥½ï¼Œå®Œå…¨è§„é¿æ‰äº†æ•°æ®å€¾æ–œï¼ŒSparkä½œä¸šçš„æ€§èƒ½ä¼šå¤§å¹…åº¦æå‡ã€‚æ–¹æ¡ˆç¼ºç‚¹ï¼šæ²»æ ‡ä¸æ²»æœ¬ï¼ŒHive ETLä¸­è¿˜æ˜¯ä¼šå‘ç”Ÿæ•°æ®å€¾æ–œã€‚æ–¹æ¡ˆå®è·µç»éªŒï¼šåœ¨ä¸€äº›Javaç³»ç»Ÿä¸Sparkç»“åˆä½¿ç”¨çš„é¡¹ç›®ä¸­ï¼Œä¼šå‡ºç°Javaä»£ç é¢‘ç¹è°ƒç”¨Sparkä½œä¸šçš„åœºæ™¯ï¼Œè€Œä¸”å¯¹Sparkä½œä¸šçš„æ‰§è¡Œæ€§èƒ½è¦æ±‚å¾ˆé«˜ï¼Œå°±æ¯”è¾ƒé€‚åˆä½¿ç”¨è¿™ç§æ–¹æ¡ˆã€‚å°†æ•°æ®å€¾æ–œæå‰åˆ°ä¸Šæ¸¸çš„Hive ETLï¼Œæ¯å¤©ä»…æ‰§è¡Œä¸€æ¬¡ï¼Œåªæœ‰é‚£ä¸€æ¬¡æ˜¯æ¯”è¾ƒæ…¢çš„ï¼Œè€Œä¹‹åæ¯æ¬¡Javaè°ƒç”¨Sparkä½œä¸šæ—¶ï¼Œæ‰§è¡Œé€Ÿåº¦éƒ½ä¼šå¾ˆå¿«ï¼Œèƒ½å¤Ÿæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚è¿‡æ»¤å°‘æ•°å¯¼è‡´å€¾æ–œçš„keyæ–¹æ¡ˆé€‚ç”¨åœºæ™¯ï¼šå¦‚æœå‘ç°å¯¼è‡´å€¾æ–œçš„keyå°±å°‘æ•°å‡ ä¸ªï¼Œè€Œä¸”å¯¹è®¡ç®—æœ¬èº«çš„å½±å“å¹¶ä¸å¤§çš„è¯ï¼Œé‚£ä¹ˆå¾ˆé€‚åˆä½¿ç”¨è¿™ç§æ–¹æ¡ˆã€‚æ¯”å¦‚99%çš„keyå°±å¯¹åº”10æ¡æ•°æ®ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªkeyå¯¹åº”äº†100ä¸‡æ•°æ®ï¼Œä»è€Œå¯¼è‡´äº†æ•°æ®å€¾æ–œã€‚æ–¹æ¡ˆå®ç°æ€è·¯ï¼šå¦‚æœæˆ‘ä»¬åˆ¤æ–­é‚£å°‘æ•°å‡ ä¸ªæ•°æ®é‡ç‰¹åˆ«å¤šçš„keyï¼Œå¯¹ä½œä¸šçš„æ‰§è¡Œå’Œè®¡ç®—ç»“æœä¸æ˜¯ç‰¹åˆ«é‡è¦çš„è¯ï¼Œé‚£ä¹ˆå¹²è„†å°±ç›´æ¥è¿‡æ»¤æ‰é‚£å°‘æ•°å‡ ä¸ªkeyã€‚æ¯”å¦‚ï¼Œåœ¨Spark SQLä¸­å¯ä»¥ä½¿ç”¨whereå­å¥è¿‡æ»¤æ‰è¿™äº›keyæˆ–è€…åœ¨Spark Coreä¸­å¯¹RDDæ‰§è¡Œfilterç®—å­è¿‡æ»¤æ‰è¿™äº›keyã€‚å¦‚æœéœ€è¦æ¯æ¬¡ä½œä¸šæ‰§è¡Œæ—¶ï¼ŒåŠ¨æ€åˆ¤å®šå“ªäº›keyçš„æ•°æ®é‡æœ€å¤šç„¶åå†è¿›è¡Œè¿‡æ»¤ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨sampleç®—å­å¯¹RDDè¿›è¡Œé‡‡æ ·ï¼Œç„¶åè®¡ç®—å‡ºæ¯ä¸ªkeyçš„æ•°é‡ï¼Œå–æ•°æ®é‡æœ€å¤šçš„keyè¿‡æ»¤æ‰å³å¯ã€‚æ–¹æ¡ˆå®ç°åŸç†ï¼šå°†å¯¼è‡´æ•°æ®å€¾æ–œçš„keyç»™è¿‡æ»¤æ‰ä¹‹åï¼Œè¿™äº›keyå°±ä¸ä¼šå‚ä¸è®¡ç®—äº†ï¼Œè‡ªç„¶ä¸å¯èƒ½äº§ç”Ÿæ•°æ®å€¾æ–œã€‚æ–¹æ¡ˆä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œè€Œä¸”æ•ˆæœä¹Ÿå¾ˆå¥½ï¼Œå¯ä»¥å®Œå…¨è§„é¿æ‰æ•°æ®å€¾æ–œã€‚æ–¹æ¡ˆç¼ºç‚¹ï¼šé€‚ç”¨åœºæ™¯ä¸å¤šï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¼è‡´å€¾æ–œçš„keyè¿˜æ˜¯å¾ˆå¤šçš„ï¼Œå¹¶ä¸æ˜¯åªæœ‰å°‘æ•°å‡ ä¸ªã€‚æ–¹æ¡ˆå®è·µç»éªŒï¼šåœ¨é¡¹ç›®ä¸­æˆ‘ä»¬ä¹Ÿé‡‡ç”¨è¿‡è¿™ç§æ–¹æ¡ˆè§£å†³æ•°æ®å€¾æ–œã€‚æœ‰ä¸€æ¬¡å‘ç°æŸä¸€å¤©Sparkä½œä¸šåœ¨è¿è¡Œçš„æ—¶å€™çªç„¶OOMäº†ï¼Œè¿½æŸ¥ä¹‹åå‘ç°ï¼Œæ˜¯Hiveè¡¨ä¸­çš„æŸä¸€ä¸ªkeyåœ¨é‚£å¤©æ•°æ®å¼‚å¸¸ï¼Œå¯¼è‡´æ•°æ®é‡æš´å¢ã€‚å› æ­¤å°±é‡‡å–æ¯æ¬¡æ‰§è¡Œå‰å…ˆè¿›è¡Œé‡‡æ ·ï¼Œè®¡ç®—å‡ºæ ·æœ¬ä¸­æ•°æ®é‡æœ€å¤§çš„å‡ ä¸ªkeyä¹‹åï¼Œç›´æ¥åœ¨ç¨‹åºä¸­å°†é‚£äº›keyç»™è¿‡æ»¤æ‰ã€‚æé«˜shuffleæ“ä½œçš„å¹¶è¡Œåº¦æ–¹æ¡ˆé€‚ç”¨åœºæ™¯ï¼šå¦‚æœæˆ‘ä»¬å¿…é¡»è¦å¯¹æ•°æ®å€¾æ–œè¿éš¾è€Œä¸Šï¼Œé‚£ä¹ˆå»ºè®®ä¼˜å…ˆä½¿ç”¨è¿™ç§æ–¹æ¡ˆï¼Œå› ä¸ºè¿™æ˜¯å¤„ç†æ•°æ®å€¾æ–œæœ€ç®€å•çš„ä¸€ç§æ–¹æ¡ˆã€‚æ–¹æ¡ˆå®ç°æ€è·¯ï¼šåœ¨å¯¹RDDæ‰§è¡Œshuffleç®—å­æ—¶ï¼Œç»™shuffleç®—å­ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œæ¯”å¦‚reduceByKey(1000)ï¼Œè¯¥å‚æ•°å°±è®¾ç½®äº†è¿™ä¸ªshuffleç®—å­æ‰§è¡Œæ—¶shuffle read taskçš„æ•°é‡ã€‚å¯¹äºSpark SQLä¸­çš„shuffleç±»è¯­å¥ï¼Œæ¯”å¦‚group byã€joinç­‰ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªå‚æ•°ï¼Œå³spark.sql.shuffle.partitionsï¼Œè¯¥å‚æ•°ä»£è¡¨äº†shuffle read taskçš„å¹¶è¡Œåº¦ï¼Œè¯¥å€¼é»˜è®¤æ˜¯200ï¼Œå¯¹äºå¾ˆå¤šåœºæ™¯æ¥è¯´éƒ½æœ‰ç‚¹è¿‡å°ã€‚æ–¹æ¡ˆå®ç°åŸç†ï¼šå¢åŠ shuffle read taskçš„æ•°é‡ï¼Œå¯ä»¥è®©åŸæœ¬åˆ†é…ç»™ä¸€ä¸ªtaskçš„å¤šä¸ªkeyåˆ†é…ç»™å¤šä¸ªtaskï¼Œä»è€Œè®©æ¯ä¸ªtaskå¤„ç†æ¯”åŸæ¥æ›´å°‘çš„æ•°æ®ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœåŸæœ¬æœ‰5ä¸ªkeyï¼Œæ¯ä¸ªkeyå¯¹åº”10æ¡æ•°æ®ï¼Œè¿™5ä¸ªkeyéƒ½æ˜¯åˆ†é…ç»™ä¸€ä¸ªtaskçš„ï¼Œé‚£ä¹ˆè¿™ä¸ªtaskå°±è¦å¤„ç†50æ¡æ•°æ®ã€‚è€Œå¢åŠ äº†shuffle read taskä»¥åï¼Œæ¯ä¸ªtaskå°±åˆ†é…åˆ°ä¸€ä¸ªkeyï¼Œå³æ¯ä¸ªtaskå°±å¤„ç†10æ¡æ•°æ®ï¼Œé‚£ä¹ˆè‡ªç„¶æ¯ä¸ªtaskçš„æ‰§è¡Œæ—¶é—´éƒ½ä¼šå˜çŸ­äº†ã€‚æ–¹æ¡ˆä¼˜ç‚¹ï¼šå®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥æœ‰æ•ˆç¼“è§£å’Œå‡è½»æ•°æ®å€¾æ–œçš„å½±å“ã€‚æ–¹æ¡ˆç¼ºç‚¹ï¼šåªæ˜¯ç¼“è§£äº†æ•°æ®å€¾æ–œè€Œå·²ï¼Œæ²¡æœ‰å½»åº•æ ¹é™¤é—®é¢˜ï¼Œæ ¹æ®å®è·µç»éªŒæ¥çœ‹ï¼Œå…¶æ•ˆæœæœ‰é™ã€‚æ–¹æ¡ˆå®è·µç»éªŒï¼šè¯¥æ–¹æ¡ˆé€šå¸¸æ— æ³•å½»åº•è§£å†³æ•°æ®å€¾æ–œï¼Œå› ä¸ºå¦‚æœå‡ºç°ä¸€äº›æç«¯æƒ…å†µï¼Œæ¯”å¦‚æŸä¸ªkeyå¯¹åº”çš„æ•°æ®é‡æœ‰100ä¸‡ï¼Œé‚£ä¹ˆæ— è®ºä½ çš„taskæ•°é‡å¢åŠ åˆ°å¤šå°‘ï¼Œè¿™ä¸ªå¯¹åº”ç€100ä¸‡æ•°æ®çš„keyè‚¯å®šè¿˜æ˜¯ä¼šåˆ†é…åˆ°ä¸€ä¸ªtaskä¸­å»å¤„ç†ï¼Œå› æ­¤æ³¨å®šè¿˜æ˜¯ä¼šå‘ç”Ÿæ•°æ®å€¾æ–œçš„ã€‚æ‰€ä»¥è¿™ç§æ–¹æ¡ˆåªèƒ½è¯´æ˜¯åœ¨å‘ç°æ•°æ®å€¾æ–œæ—¶å°è¯•ä½¿ç”¨çš„ç¬¬ä¸€ç§æ‰‹æ®µï¼Œå°è¯•å»ç”¨æœ€ç®€å•çš„æ–¹æ³•ç¼“è§£æ•°æ®å€¾æ–œè€Œå·²ï¼Œæˆ–è€…æ˜¯å’Œå…¶ä»–æ–¹æ¡ˆç»“åˆèµ·æ¥ä½¿ç”¨ã€‚ä¸¤é˜¶æ®µèšåˆï¼ˆå±€éƒ¨èšåˆ+å…¨å±€èšåˆï¼‰æ–¹æ¡ˆé€‚ç”¨åœºæ™¯ï¼šå¯¹RDDæ‰§è¡ŒreduceByKeyç­‰èšåˆç±»shuffleç®—å­æˆ–è€…åœ¨Spark SQLä¸­ä½¿ç”¨group byè¯­å¥è¿›è¡Œåˆ†ç»„èšåˆæ—¶ï¼Œæ¯”è¾ƒé€‚ç”¨è¿™ç§æ–¹æ¡ˆã€‚æ–¹æ¡ˆå®ç°æ€è·¯ï¼šè¿™ä¸ªæ–¹æ¡ˆçš„æ ¸å¿ƒå®ç°æ€è·¯å°±æ˜¯è¿›è¡Œä¸¤é˜¶æ®µèšåˆã€‚ç¬¬ä¸€æ¬¡æ˜¯å±€éƒ¨èšåˆï¼Œå…ˆç»™æ¯ä¸ªkeyéƒ½æ‰“ä¸Šä¸€ä¸ªéšæœºæ•°ï¼Œæ¯”å¦‚10ä»¥å†…çš„éšæœºæ•°ï¼Œæ­¤æ—¶åŸå…ˆä¸€æ ·çš„keyå°±å˜æˆä¸ä¸€æ ·çš„äº†ï¼Œæ¯”å¦‚(hello, 1) (hello, 1) (hello, 1) (hello, 1)ï¼Œå°±ä¼šå˜æˆ(1_hello, 1) (1_hello, 1) (2_hello, 1) (2_hello, 1)ã€‚æ¥ç€å¯¹æ‰“ä¸Šéšæœºæ•°åçš„æ•°æ®ï¼Œæ‰§è¡ŒreduceByKeyç­‰èšåˆæ“ä½œï¼Œè¿›è¡Œå±€éƒ¨èšåˆï¼Œé‚£ä¹ˆå±€éƒ¨èšåˆç»“æœï¼Œå°±ä¼šå˜æˆäº†(1_hello, 2) (2_hello, 2)ã€‚ç„¶åå°†å„ä¸ªkeyçš„å‰ç¼€ç»™å»æ‰ï¼Œå°±ä¼šå˜æˆ(hello,2)(hello,2)ï¼Œå†æ¬¡è¿›è¡Œå…¨å±€èšåˆæ“ä½œï¼Œå°±å¯ä»¥å¾—åˆ°æœ€ç»ˆç»“æœäº†ï¼Œæ¯”å¦‚(hello, 4)ã€‚æ–¹æ¡ˆå®ç°åŸç†ï¼šå°†åŸæœ¬ç›¸åŒçš„keyé€šè¿‡é™„åŠ éšæœºå‰ç¼€çš„æ–¹å¼ï¼Œå˜æˆå¤šä¸ªä¸åŒçš„keyï¼Œå°±å¯ä»¥è®©åŸæœ¬è¢«ä¸€ä¸ªtaskå¤„ç†çš„æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªtaskä¸Šå»åšå±€éƒ¨èšåˆï¼Œè¿›è€Œè§£å†³å•ä¸ªtaskå¤„ç†æ•°æ®é‡è¿‡å¤šçš„é—®é¢˜ã€‚æ¥ç€å»é™¤æ‰éšæœºå‰ç¼€ï¼Œå†æ¬¡è¿›è¡Œå…¨å±€èšåˆï¼Œå°±å¯ä»¥å¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚å…·ä½“åŸç†è§ä¸‹å›¾ã€‚æ–¹æ¡ˆä¼˜ç‚¹ï¼šå¯¹äºèšåˆç±»çš„shuffleæ“ä½œå¯¼è‡´çš„æ•°æ®å€¾æ–œï¼Œæ•ˆæœæ˜¯éå¸¸ä¸é”™çš„ã€‚é€šå¸¸éƒ½å¯ä»¥è§£å†³æ‰æ•°æ®å€¾æ–œï¼Œæˆ–è€…è‡³å°‘æ˜¯å¤§å¹…åº¦ç¼“è§£æ•°æ®å€¾æ–œï¼Œå°†Sparkä½œä¸šçš„æ€§èƒ½æå‡æ•°å€ä»¥ä¸Šã€‚æ–¹æ¡ˆç¼ºç‚¹ï¼šä»…ä»…é€‚ç”¨äºèšåˆç±»çš„shuffleæ“ä½œï¼Œé€‚ç”¨èŒƒå›´ç›¸å¯¹è¾ƒçª„ã€‚å¦‚æœæ˜¯joinç±»çš„shuffleæ“ä½œï¼Œè¿˜å¾—ç”¨å…¶ä»–çš„è§£å†³æ–¹æ¡ˆã€‚å°†reduce joinè½¬ä¸ºmap joinæ–¹æ¡ˆé€‚ç”¨åœºæ™¯ï¼šåœ¨å¯¹RDDä½¿ç”¨joinç±»æ“ä½œï¼Œæˆ–è€…æ˜¯åœ¨Spark SQLä¸­ä½¿ç”¨joinè¯­å¥æ—¶ï¼Œè€Œä¸”joinæ“ä½œä¸­çš„ä¸€ä¸ªRDDæˆ–è¡¨çš„æ•°æ®é‡æ¯”è¾ƒå°ï¼ˆæ¯”å¦‚å‡ ç™¾Mæˆ–è€…ä¸€ä¸¤Gï¼‰ï¼Œæ¯”è¾ƒé€‚ç”¨æ­¤æ–¹æ¡ˆã€‚æ–¹æ¡ˆå®ç°æ€è·¯ï¼šä¸ä½¿ç”¨joinç®—å­è¿›è¡Œè¿æ¥æ“ä½œï¼Œè€Œä½¿ç”¨Broadcastå˜é‡ä¸mapç±»ç®—å­å®ç°joinæ“ä½œï¼Œè¿›è€Œå®Œå…¨è§„é¿æ‰shuffleç±»çš„æ“ä½œï¼Œå½»åº•é¿å…æ•°æ®å€¾æ–œçš„å‘ç”Ÿå’Œå‡ºç°ã€‚å°†è¾ƒå°RDDä¸­çš„æ•°æ®ç›´æ¥é€šè¿‡collectç®—å­æ‹‰å–åˆ°Driverç«¯çš„å†…å­˜ä¸­æ¥ï¼Œç„¶åå¯¹å…¶åˆ›å»ºä¸€ä¸ªBroadcastå˜é‡ï¼›æ¥ç€å¯¹å¦å¤–ä¸€ä¸ªRDDæ‰§è¡Œmapç±»ç®—å­ï¼Œåœ¨ç®—å­å‡½æ•°å†…ï¼Œä»Broadcastå˜é‡ä¸­è·å–è¾ƒå°RDDçš„å…¨é‡æ•°æ®ï¼Œä¸å½“å‰RDDçš„æ¯ä¸€æ¡æ•°æ®æŒ‰ç…§è¿æ¥keyè¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœè¿æ¥keyç›¸åŒçš„è¯ï¼Œé‚£ä¹ˆå°±å°†ä¸¤ä¸ªRDDçš„æ•°æ®ç”¨ä½ éœ€è¦çš„æ–¹å¼è¿æ¥èµ·æ¥ã€‚æ–¹æ¡ˆå®ç°åŸç†ï¼šæ™®é€šçš„joinæ˜¯ä¼šèµ°shuffleè¿‡ç¨‹çš„ï¼Œè€Œä¸€æ—¦shuffleï¼Œå°±ç›¸å½“äºä¼šå°†ç›¸åŒkeyçš„æ•°æ®æ‹‰å–åˆ°ä¸€ä¸ªshuffle read taskä¸­å†è¿›è¡Œjoinï¼Œæ­¤æ—¶å°±æ˜¯reduce joinã€‚ä½†æ˜¯å¦‚æœä¸€ä¸ªRDDæ˜¯æ¯”è¾ƒå°çš„ï¼Œåˆ™å¯ä»¥é‡‡ç”¨å¹¿æ’­å°RDDå…¨é‡æ•°æ®+mapç®—å­æ¥å®ç°ä¸joinåŒæ ·çš„æ•ˆæœï¼Œä¹Ÿå°±æ˜¯map joinï¼Œæ­¤æ—¶å°±ä¸ä¼šå‘ç”Ÿshuffleæ“ä½œï¼Œä¹Ÿå°±ä¸ä¼šå‘ç”Ÿæ•°æ®å€¾æ–œã€‚å…·ä½“åŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æ–¹æ¡ˆä¼˜ç‚¹ï¼šå¯¹joinæ“ä½œå¯¼è‡´çš„æ•°æ®å€¾æ–œï¼Œæ•ˆæœéå¸¸å¥½ï¼Œå› ä¸ºæ ¹æœ¬å°±ä¸ä¼šå‘ç”Ÿshuffleï¼Œä¹Ÿå°±æ ¹æœ¬ä¸ä¼šå‘ç”Ÿæ•°æ®å€¾æ–œã€‚æ–¹æ¡ˆç¼ºç‚¹ï¼šé€‚ç”¨åœºæ™¯è¾ƒå°‘ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ¡ˆåªé€‚ç”¨äºä¸€ä¸ªå¤§è¡¨å’Œä¸€ä¸ªå°è¡¨çš„æƒ…å†µã€‚æ¯•ç«Ÿæˆ‘ä»¬éœ€è¦å°†å°è¡¨è¿›è¡Œå¹¿æ’­ï¼Œæ­¤æ—¶ä¼šæ¯”è¾ƒæ¶ˆè€—å†…å­˜èµ„æºï¼Œdriverå’Œæ¯ä¸ªExecutorå†…å­˜ä¸­éƒ½ä¼šé©»ç•™ä¸€ä»½å°RDDçš„å…¨é‡æ•°æ®ã€‚å¦‚æœæˆ‘ä»¬å¹¿æ’­å‡ºå»çš„RDDæ•°æ®æ¯”è¾ƒå¤§ï¼Œæ¯”å¦‚10Gä»¥ä¸Šï¼Œé‚£ä¹ˆå°±å¯èƒ½å‘ç”Ÿå†…å­˜æº¢å‡ºäº†ã€‚å› æ­¤å¹¶ä¸é€‚åˆä¸¤ä¸ªéƒ½æ˜¯å¤§è¡¨çš„æƒ…å†µã€‚é‡‡æ ·å€¾æ–œkeyå¹¶åˆ†æ‹†joinæ“ä½œæ–¹æ¡ˆé€‚ç”¨åœºæ™¯ï¼šä¸¤ä¸ªRDD/Hiveè¡¨è¿›è¡Œjoinçš„æ—¶å€™ï¼Œå¦‚æœæ•°æ®é‡éƒ½æ¯”è¾ƒå¤§ï¼Œæ— æ³•é‡‡ç”¨â€œmap joinâ€ï¼Œé‚£ä¹ˆæ­¤æ—¶å¯ä»¥çœ‹ä¸€ä¸‹ä¸¤ä¸ªRDD/Hiveè¡¨ä¸­çš„keyåˆ†å¸ƒæƒ…å†µã€‚å¦‚æœå‡ºç°æ•°æ®å€¾æ–œï¼Œæ˜¯å› ä¸ºå…¶ä¸­æŸä¸€ä¸ªRDD/Hiveè¡¨ä¸­çš„å°‘æ•°å‡ ä¸ªkeyçš„æ•°æ®é‡è¿‡å¤§ï¼Œè€Œå¦ä¸€ä¸ªRDD/Hiveè¡¨ä¸­çš„æ‰€æœ‰keyéƒ½åˆ†å¸ƒæ¯”è¾ƒå‡åŒ€ï¼Œé‚£ä¹ˆé‡‡ç”¨è¿™ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚æ–¹æ¡ˆå®ç°æ€è·¯ï¼š å¯¹åŒ…å«å°‘æ•°å‡ ä¸ªæ•°æ®é‡è¿‡å¤§çš„keyçš„é‚£ä¸ªRDDï¼Œé€šè¿‡sampleç®—å­é‡‡æ ·å‡ºä¸€ä»½æ ·æœ¬æ¥ï¼Œç„¶åç»Ÿè®¡ä¸€ä¸‹æ¯ä¸ªkeyçš„æ•°é‡ï¼Œè®¡ç®—å‡ºæ¥æ•°æ®é‡æœ€å¤§çš„æ˜¯å“ªå‡ ä¸ªkeyã€‚ * ç„¶åå°†è¿™å‡ ä¸ªkeyå¯¹åº”çš„æ•°æ®ä»åŸæ¥çš„RDDä¸­æ‹†åˆ†å‡ºæ¥ï¼Œå½¢æˆä¸€ä¸ªå•ç‹¬çš„RDDï¼Œå¹¶ç»™æ¯ä¸ªkeyéƒ½æ‰“ä¸Šnä»¥å†…çš„éšæœºæ•°ä½œä¸ºå‰ç¼€ï¼Œè€Œä¸ä¼šå¯¼è‡´å€¾æ–œçš„å¤§éƒ¨åˆ†keyå½¢æˆå¦å¤–ä¸€ä¸ªRDDã€‚ æ¥ç€å°†éœ€è¦joinçš„å¦ä¸€ä¸ªRDDï¼Œä¹Ÿè¿‡æ»¤å‡ºæ¥é‚£å‡ ä¸ªå€¾æ–œkeyå¯¹åº”çš„æ•°æ®å¹¶å½¢æˆä¸€ä¸ªå•ç‹¬çš„RDDï¼Œå°†æ¯æ¡æ•°æ®è†¨èƒ€æˆnæ¡æ•°æ®ï¼Œè¿™næ¡æ•°æ®éƒ½æŒ‰é¡ºåºé™„åŠ ä¸€ä¸ª0~nçš„å‰ç¼€ï¼Œä¸ä¼šå¯¼è‡´å€¾æ–œçš„å¤§éƒ¨åˆ†keyä¹Ÿå½¢æˆå¦å¤–ä¸€ä¸ªRDDã€‚ å†å°†é™„åŠ äº†éšæœºå‰ç¼€çš„ç‹¬ç«‹RDDä¸å¦ä¸€ä¸ªè†¨èƒ€nå€çš„ç‹¬ç«‹RDDè¿›è¡Œjoinï¼Œæ­¤æ—¶å°±å¯ä»¥å°†åŸå…ˆç›¸åŒçš„keyæ‰“æ•£æˆnä»½ï¼Œåˆ†æ•£åˆ°å¤šä¸ªtaskä¸­å»è¿›è¡Œjoinäº†ã€‚è€Œå¦å¤–ä¸¤ä¸ªæ™®é€šçš„RDDå°±ç…§å¸¸joinå³å¯ã€‚ æœ€åå°†ä¸¤æ¬¡joinçš„ç»“æœä½¿ç”¨unionç®—å­åˆå¹¶èµ·æ¥å³å¯ï¼Œå°±æ˜¯æœ€ç»ˆçš„joinç»“æœã€‚æ–¹æ¡ˆå®ç°åŸç†ï¼šå¯¹äºjoinå¯¼è‡´çš„æ•°æ®å€¾æ–œï¼Œå¦‚æœåªæ˜¯æŸå‡ ä¸ªkeyå¯¼è‡´äº†å€¾æ–œï¼Œå¯ä»¥å°†å°‘æ•°å‡ ä¸ªkeyåˆ†æ‹†æˆç‹¬ç«‹RDDï¼Œå¹¶é™„åŠ éšæœºå‰ç¼€æ‰“æ•£æˆnä»½å»è¿›è¡Œjoinï¼Œæ­¤æ—¶è¿™å‡ ä¸ªkeyå¯¹åº”çš„æ•°æ®å°±ä¸ä¼šé›†ä¸­åœ¨å°‘æ•°å‡ ä¸ªtaskä¸Šï¼Œè€Œæ˜¯åˆ†æ•£åˆ°å¤šä¸ªtaskè¿›è¡Œjoinäº†ã€‚æ–¹æ¡ˆä¼˜ç‚¹ï¼šå¯¹äºjoinå¯¼è‡´çš„æ•°æ®å€¾æ–œï¼Œå¦‚æœåªæ˜¯æŸå‡ ä¸ªkeyå¯¼è‡´äº†å€¾æ–œï¼Œé‡‡ç”¨è¯¥æ–¹å¼å¯ä»¥ç”¨æœ€æœ‰æ•ˆçš„æ–¹å¼æ‰“æ•£keyè¿›è¡Œjoinã€‚è€Œä¸”åªéœ€è¦é’ˆå¯¹å°‘æ•°å€¾æ–œkeyå¯¹åº”çš„æ•°æ®è¿›è¡Œæ‰©å®¹nå€ï¼Œä¸éœ€è¦å¯¹å…¨é‡æ•°æ®è¿›è¡Œæ‰©å®¹ã€‚é¿å…äº†å ç”¨è¿‡å¤šå†…å­˜ã€‚æ–¹æ¡ˆç¼ºç‚¹ï¼šå¦‚æœå¯¼è‡´å€¾æ–œçš„keyç‰¹åˆ«å¤šçš„è¯ï¼Œæ¯”å¦‚æˆåƒä¸Šä¸‡ä¸ªkeyéƒ½å¯¼è‡´æ•°æ®å€¾æ–œï¼Œé‚£ä¹ˆè¿™ç§æ–¹å¼ä¹Ÿä¸é€‚åˆã€‚ä½¿ç”¨éšæœºå‰ç¼€å’Œæ‰©å®¹RDDè¿›è¡Œjoinæ–¹æ¡ˆé€‚ç”¨åœºæ™¯ï¼šå¦‚æœåœ¨è¿›è¡Œjoinæ“ä½œæ—¶ï¼ŒRDDä¸­æœ‰å¤§é‡çš„keyå¯¼è‡´æ•°æ®å€¾æ–œï¼Œé‚£ä¹ˆè¿›è¡Œåˆ†æ‹†keyä¹Ÿæ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œæ­¤æ—¶å°±åªèƒ½ä½¿ç”¨æœ€åä¸€ç§æ–¹æ¡ˆæ¥è§£å†³é—®é¢˜äº†ã€‚æ–¹æ¡ˆå®ç°æ€è·¯ï¼š é¦–å…ˆæŸ¥çœ‹RDD/Hiveè¡¨ä¸­çš„æ•°æ®åˆ†å¸ƒæƒ…å†µï¼Œæ‰¾åˆ°é‚£ä¸ªé€ æˆæ•°æ®å€¾æ–œçš„RDD/Hiveè¡¨ï¼Œæ¯”å¦‚æœ‰å¤šä¸ªkeyéƒ½å¯¹åº”äº†è¶…è¿‡1ä¸‡æ¡æ•°æ®ã€‚ ç„¶åå°†è¯¥RDDçš„æ¯æ¡æ•°æ®éƒ½æ‰“ä¸Šä¸€ä¸ªnä»¥å†…çš„éšæœºå‰ç¼€ã€‚ åŒæ—¶å¯¹å¦å¤–ä¸€ä¸ªæ­£å¸¸çš„RDDè¿›è¡Œæ‰©å®¹ï¼Œå°†æ¯æ¡æ•°æ®éƒ½æ‰©å®¹æˆnæ¡æ•°æ®ï¼Œæ‰©å®¹å‡ºæ¥çš„æ¯æ¡æ•°æ®éƒ½ä¾æ¬¡æ‰“ä¸Šä¸€ä¸ª0~nçš„å‰ç¼€ã€‚ æœ€åå°†ä¸¤ä¸ªå¤„ç†åçš„RDDè¿›è¡Œjoinå³å¯ã€‚æ–¹æ¡ˆå®ç°åŸç†ï¼šå°†åŸå…ˆä¸€æ ·çš„keyé€šè¿‡é™„åŠ éšæœºå‰ç¼€å˜æˆä¸ä¸€æ ·çš„keyï¼Œç„¶åå°±å¯ä»¥å°†è¿™äº›å¤„ç†åçš„â€œä¸åŒkeyâ€åˆ†æ•£åˆ°å¤šä¸ªtaskä¸­å»å¤„ç†ï¼Œè€Œä¸æ˜¯è®©ä¸€ä¸ªtaskå¤„ç†å¤§é‡çš„ç›¸åŒkeyã€‚è¯¥æ–¹æ¡ˆä¸â€œè§£å†³æ–¹æ¡ˆå…­â€çš„ä¸åŒä¹‹å¤„å°±åœ¨äºï¼Œä¸Šä¸€ç§æ–¹æ¡ˆæ˜¯å°½é‡åªå¯¹å°‘æ•°å€¾æ–œkeyå¯¹åº”çš„æ•°æ®è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œç”±äºå¤„ç†è¿‡ç¨‹éœ€è¦æ‰©å®¹RDDï¼Œå› æ­¤ä¸Šä¸€ç§æ–¹æ¡ˆæ‰©å®¹RDDåå¯¹å†…å­˜çš„å ç”¨å¹¶ä¸å¤§ï¼›è€Œè¿™ä¸€ç§æ–¹æ¡ˆæ˜¯é’ˆå¯¹æœ‰å¤§é‡å€¾æ–œkeyçš„æƒ…å†µï¼Œæ²¡æ³•å°†éƒ¨åˆ†keyæ‹†åˆ†å‡ºæ¥è¿›è¡Œå•ç‹¬å¤„ç†ï¼Œå› æ­¤åªèƒ½å¯¹æ•´ä¸ªRDDè¿›è¡Œæ•°æ®æ‰©å®¹ï¼Œå¯¹å†…å­˜èµ„æºè¦æ±‚å¾ˆé«˜ã€‚æ–¹æ¡ˆä¼˜ç‚¹ï¼šå¯¹joinç±»å‹çš„æ•°æ®å€¾æ–œåŸºæœ¬éƒ½å¯ä»¥å¤„ç†ï¼Œè€Œä¸”æ•ˆæœä¹Ÿç›¸å¯¹æ¯”è¾ƒæ˜¾è‘—ï¼Œæ€§èƒ½æå‡æ•ˆæœéå¸¸ä¸é”™ã€‚æ–¹æ¡ˆç¼ºç‚¹ï¼šè¯¥æ–¹æ¡ˆæ›´å¤šçš„æ˜¯ç¼“è§£æ•°æ®å€¾æ–œï¼Œè€Œä¸æ˜¯å½»åº•é¿å…æ•°æ®å€¾æ–œã€‚è€Œä¸”éœ€è¦å¯¹æ•´ä¸ªRDDè¿›è¡Œæ‰©å®¹ï¼Œå¯¹å†…å­˜èµ„æºè¦æ±‚å¾ˆé«˜ã€‚ä»£ç ä¼˜åŒ–äº†è§£ Spark çš„å·¥ä½œåŸç†ï¼Œäº†è§£è¦å¤„ç†çš„æ•°æ®çš„ç‰¹ç‚¹ï¼Œäº†è§£è¦è®¡ç®—çš„ç›®æ ‡ï¼Œè®¾è®¡åˆç†çš„ä»£ç å¤„ç†é€»è¾‘ï¼ŒRDD lineageè®¾è®¡ã€ç®—å­çš„åˆç†ä½¿ç”¨ï¼Œshuffleè°ƒä¼˜ç­‰ï¼Œä½¿ç”¨è‰¯å¥½çš„ç¼–ç¨‹æ–¹æ³•å¼€å‘å¤§æ•°æ®åº”ç”¨ï¼Œæ˜¯å¤§æ•°æ®åº”ç”¨æ€§èƒ½ä¼˜åŒ–çš„é‡è¦æ‰‹æ®µï¼Œä¹Ÿæ˜¯å¤§æ•°æ®å¼€å‘å·¥ç¨‹å¸ˆçš„é‡è¦èŒè´£ã€‚é¿å…åˆ›å»ºé‡å¤çš„RDDæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­è¦æ³¨æ„ï¼šå¯¹äºåŒä¸€ä»½æ•°æ®ï¼Œåªåº”è¯¥åˆ›å»ºä¸€ä¸ªRDDï¼Œä¸èƒ½åˆ›å»ºå¤šä¸ªRDDæ¥ä»£è¡¨åŒä¸€ä»½æ•°æ®ã€‚å¯¹å¤šæ¬¡ä½¿ç”¨çš„RDDè¿›è¡ŒæŒä¹…åŒ–Sparkä¸­å¯¹äºä¸€ä¸ªRDDæ‰§è¡Œå¤šæ¬¡ç®—å­çš„é»˜è®¤åŸç†æ˜¯è¿™æ ·çš„ï¼šæ¯æ¬¡ä½ å¯¹ä¸€ä¸ªRDDæ‰§è¡Œä¸€ä¸ªç®—å­æ“ä½œæ—¶ï¼Œéƒ½ä¼šé‡æ–°ä»æºå¤´å¤„è®¡ç®—ä¸€éï¼Œè®¡ç®—å‡ºé‚£ä¸ªRDDæ¥ï¼Œç„¶åå†å¯¹è¿™ä¸ªRDDæ‰§è¡Œä½ çš„ç®—å­æ“ä½œã€‚è¿™ç§æ–¹å¼çš„æ€§èƒ½æ˜¯å¾ˆå·®çš„ã€‚å› æ­¤å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬çš„å»ºè®®æ˜¯ï¼šå¯¹å¤šæ¬¡ä½¿ç”¨çš„RDDè¿›è¡ŒæŒä¹…åŒ–ã€‚æ­¤æ—¶Sparkå°±ä¼šæ ¹æ®ä½ çš„æŒä¹…åŒ–ç­–ç•¥ï¼Œå°†RDDä¸­çš„æ•°æ®ä¿å­˜åˆ°å†…å­˜æˆ–è€…ç£ç›˜ä¸­ã€‚ä»¥åæ¯æ¬¡å¯¹è¿™ä¸ªRDDè¿›è¡Œç®—å­æ“ä½œæ—¶ï¼Œéƒ½ä¼šç›´æ¥ä»å†…å­˜æˆ–ç£ç›˜ä¸­æå–æŒä¹…åŒ–çš„RDDæ•°æ®ï¼Œç„¶åæ‰§è¡Œç®—å­ï¼Œè€Œä¸ä¼šä»æºå¤´å¤„é‡æ–°è®¡ç®—ä¸€éè¿™ä¸ªRDDï¼Œå†æ‰§è¡Œç®—å­æ“ä½œã€‚å°½é‡é¿å…ä½¿ç”¨shuffleç±»ç®—å­å¦‚æœæœ‰å¯èƒ½çš„è¯ï¼Œè¦å°½é‡é¿å…ä½¿ç”¨shuffleç±»ç®—å­ã€‚å› ä¸ºSparkä½œä¸šè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ€æ¶ˆè€—æ€§èƒ½çš„åœ°æ–¹å°±æ˜¯shuffleè¿‡ç¨‹ã€‚shuffleè¿‡ç¨‹ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„åŒä¸€ä¸ªkeyï¼Œæ‹‰å–åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè¿›è¡Œèšåˆæˆ–joinç­‰æ“ä½œã€‚æ¯”å¦‚reduceByKeyã€joinç­‰ç®—å­ï¼Œéƒ½ä¼šè§¦å‘shuffleæ“ä½œã€‚shuffleè¿‡ç¨‹ä¸­ï¼Œå„ä¸ªèŠ‚ç‚¹ä¸Šçš„ç›¸åŒkeyéƒ½ä¼šå…ˆå†™å…¥æœ¬åœ°ç£ç›˜æ–‡ä»¶ä¸­ï¼Œç„¶åå…¶ä»–èŠ‚ç‚¹éœ€è¦é€šè¿‡ç½‘ç»œä¼ è¾“æ‹‰å–å„ä¸ªèŠ‚ç‚¹ä¸Šçš„ç£ç›˜æ–‡ä»¶ä¸­çš„ç›¸åŒkeyã€‚è€Œä¸”ç›¸åŒkeyéƒ½æ‹‰å–åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œèšåˆæ“ä½œæ—¶ï¼Œè¿˜æœ‰å¯èƒ½ä¼šå› ä¸ºä¸€ä¸ªèŠ‚ç‚¹ä¸Šå¤„ç†çš„keyè¿‡å¤šï¼Œå¯¼è‡´å†…å­˜ä¸å¤Ÿå­˜æ”¾ï¼Œè¿›è€Œæº¢å†™åˆ°ç£ç›˜æ–‡ä»¶ä¸­ã€‚å› æ­¤åœ¨shuffleè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå¤§é‡çš„ç£ç›˜æ–‡ä»¶è¯»å†™çš„IOæ“ä½œï¼Œä»¥åŠæ•°æ®çš„ç½‘ç»œä¼ è¾“æ“ä½œã€‚ç£ç›˜IOå’Œç½‘ç»œæ•°æ®ä¼ è¾“ä¹Ÿæ˜¯shuffleæ€§èƒ½è¾ƒå·®çš„ä¸»è¦åŸå› ã€‚å› æ­¤åœ¨æˆ‘ä»¬çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œèƒ½é¿å…åˆ™å°½å¯èƒ½é¿å…ä½¿ç”¨reduceByKeyã€joinã€distinctã€repartitionç­‰ä¼šè¿›è¡Œshuffleçš„ç®—å­ï¼Œå°½é‡ä½¿ç”¨mapç±»çš„éshuffleç®—å­ã€‚è¿™æ ·çš„è¯ï¼Œæ²¡æœ‰shuffleæ“ä½œæˆ–è€…ä»…æœ‰è¾ƒå°‘shuffleæ“ä½œçš„Sparkä½œä¸šï¼Œå¯ä»¥å¤§å¤§å‡å°‘æ€§èƒ½å¼€é”€ã€‚å°½é‡ä½¿ç”¨å¯ä»¥åœ¨mapç«¯è¿›è¡Œshuffleç±»ç®—å­å¦‚æœå› ä¸ºä¸šåŠ¡éœ€è¦ï¼Œä¸€å®šè¦ä½¿ç”¨shuffleæ“ä½œï¼Œæ— æ³•ç”¨mapç±»çš„ç®—å­æ¥æ›¿ä»£ï¼Œé‚£ä¹ˆå°½é‡ä½¿ç”¨å¯ä»¥åœ¨mapç«¯è¿›è¡Œèšåˆçš„ç®—å­è¿™é‡Œæ‹¿reduceByKeyå’ŒgroupByKeyè¿›è¡Œä¸¾ä¾‹reduceByKey(func, numPartitions=None)reduceByKeyç”¨äºå¯¹æ¯ä¸ªkeyå¯¹åº”çš„å¤šä¸ªvalueè¿›è¡Œmergeæ“ä½œï¼Œæœ€é‡è¦çš„æ˜¯å®ƒèƒ½å¤Ÿåœ¨æœ¬åœ°å…ˆè¿›è¡Œmergeæ“ä½œï¼Œå¹¶ä¸”mergeæ“ä½œå¯ä»¥é€šè¿‡å‡½æ•°è‡ªå®šä¹‰ã€‚groupByKey(numPartitions=None)groupByKeyä¹Ÿæ˜¯å¯¹æ¯ä¸ªkeyè¿›è¡Œæ“ä½œï¼Œä½†åªç”Ÿæˆä¸€ä¸ªsequenceã€‚å¦‚æœéœ€è¦å¯¹sequenceè¿›è¡Œaggregationæ“ä½œï¼ˆæ³¨æ„ï¼ŒgroupByKeyæœ¬èº«ä¸èƒ½è‡ªå®šä¹‰æ“ä½œå‡½æ•°ï¼‰ï¼Œé‚£ä¹ˆï¼Œé€‰æ‹©reduceByKey/aggregateByKeyæ›´å¥½ã€‚è¿™æ˜¯å› ä¸ºgroupByKeyä¸èƒ½è‡ªå®šä¹‰å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç”¨groupByKeyç”ŸæˆRDDï¼Œç„¶åæ‰èƒ½å¯¹æ­¤RDDé€šè¿‡mapè¿›è¡Œè‡ªå®šä¹‰å‡½æ•°æ“ä½œã€‚æœ€åreduceByKeyå’ŒgroupByKeyéƒ½æ˜¯è¦ç»è¿‡shuffleçš„ï¼ŒgroupByKeyåœ¨æ–¹æ³•shuffleä¹‹é—´ä¸ä¼šåˆå¹¶åŸæ ·è¿›è¡Œshuffleï¼ŒreduceByKeyè¿›è¡Œshuffleä¹‹å‰ä¼šå…ˆåšåˆå¹¶,è¿™æ ·å°±å‡å°‘äº†shuffleçš„ioä¼ é€ï¼Œæ‰€ä»¥æ•ˆç‡é«˜ä¸€ç‚¹ã€‚å…¶ä»–ç®—å­çš„ä¼˜åŒ–ä½¿ç”¨mapPartitionsæ›¿ä»£æ™®é€šmapä½¿ç”¨reduceByKey/aggregateByKeyæ›¿ä»£groupByKeyä½¿ç”¨foreachPartitionsæ›¿ä»£foreachä½¿ç”¨filterä¹‹åè¿›è¡Œcoalesceæ“ä½œä½¿ç”¨repartitionAndSortWithinPartitionsæ›¿ä»£repartitionä¸sortç±»æ“ä½œå·§ç”¨å¹¿æ’­å˜é‡æœ‰æ—¶åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¼šé‡åˆ°éœ€è¦åœ¨ç®—å­å‡½æ•°ä¸­ä½¿ç”¨å¤–éƒ¨å˜é‡çš„åœºæ™¯ï¼ˆå°¤å…¶æ˜¯å¤§å˜é‡ï¼Œæ¯”å¦‚100Mä»¥ä¸Šçš„å¤§é›†åˆï¼‰ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±åº”è¯¥ä½¿ç”¨Sparkçš„å¹¿æ’­ï¼ˆBroadcastï¼‰åŠŸèƒ½æ¥æå‡æ€§èƒ½ã€‚åœ¨ç®—å­å‡½æ•°ä¸­ä½¿ç”¨åˆ°å¤–éƒ¨å˜é‡æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒSparkä¼šå°†è¯¥å˜é‡å¤åˆ¶å¤šä¸ªå‰¯æœ¬ï¼Œé€šè¿‡ç½‘ç»œä¼ è¾“åˆ°taskä¸­ï¼Œæ­¤æ—¶æ¯ä¸ªtaskéƒ½æœ‰ä¸€ä¸ªå˜é‡å‰¯æœ¬ã€‚å¦‚æœå˜é‡æœ¬èº«æ¯”è¾ƒå¤§çš„è¯ï¼ˆæ¯”å¦‚100Mï¼Œç”šè‡³1Gï¼‰ï¼Œé‚£ä¹ˆå¤§é‡çš„å˜é‡å‰¯æœ¬åœ¨ç½‘ç»œä¸­ä¼ è¾“çš„æ€§èƒ½å¼€é”€ï¼Œä»¥åŠåœ¨å„ä¸ªèŠ‚ç‚¹çš„Executorä¸­å ç”¨è¿‡å¤šå†…å­˜å¯¼è‡´çš„é¢‘ç¹GCï¼Œéƒ½ä¼šæå¤§åœ°å½±å“æ€§èƒ½ã€‚å› æ­¤å¯¹äºä¸Šè¿°æƒ…å†µï¼Œå¦‚æœä½¿ç”¨çš„å¤–éƒ¨å˜é‡æ¯”è¾ƒå¤§ï¼Œå»ºè®®ä½¿ç”¨Sparkçš„å¹¿æ’­åŠŸèƒ½ï¼Œå¯¹è¯¥å˜é‡è¿›è¡Œå¹¿æ’­ã€‚å¹¿æ’­åçš„å˜é‡ï¼Œä¼šä¿è¯æ¯ä¸ªExecutorçš„å†…å­˜ä¸­ï¼Œåªé©»ç•™ä¸€ä»½å˜é‡å‰¯æœ¬ï¼Œè€ŒExecutorä¸­çš„taskæ‰§è¡Œæ—¶å…±äº«è¯¥Executorä¸­çš„é‚£ä»½å˜é‡å‰¯æœ¬ã€‚è¿™æ ·çš„è¯ï¼Œå¯ä»¥å¤§å¤§å‡å°‘å˜é‡å‰¯æœ¬çš„æ•°é‡ï¼Œä»è€Œå‡å°‘ç½‘ç»œä¼ è¾“çš„æ€§èƒ½å¼€é”€ï¼Œå¹¶å‡å°‘å¯¹Executorå†…å­˜çš„å ç”¨å¼€é”€ï¼Œé™ä½GCçš„é¢‘ç‡ã€‚ä½¿ç”¨Kryoä¼˜åŒ–åºåˆ—åŒ–æ€§èƒ½åœ¨Sparkä¸­ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªåœ°æ–¹æ¶‰åŠåˆ°äº†åºåˆ—åŒ–ï¼š * åœ¨ç®—å­å‡½æ•°ä¸­ä½¿ç”¨åˆ°å¤–éƒ¨å˜é‡æ—¶ï¼Œè¯¥å˜é‡ä¼šè¢«åºåˆ—åŒ–åè¿›è¡Œç½‘ç»œä¼ è¾“ï¼ˆè§â€œåŸåˆ™ä¸ƒï¼šå¹¿æ’­å¤§å˜é‡â€ä¸­çš„è®²è§£ï¼‰ã€‚ * å°†è‡ªå®šä¹‰çš„ç±»å‹ä½œä¸ºRDDçš„æ³›å‹ç±»å‹æ—¶ï¼ˆæ¯”å¦‚JavaRDDï¼ŒStudentæ˜¯è‡ªå®šä¹‰ç±»å‹ï¼‰ï¼Œæ‰€æœ‰è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼Œéƒ½ä¼šè¿›è¡Œåºåˆ—åŒ–ã€‚å› æ­¤è¿™ç§æƒ…å†µä¸‹ï¼Œä¹Ÿè¦æ±‚è‡ªå®šä¹‰çš„ç±»å¿…é¡»å®ç°Serializableæ¥å£ã€‚ * ä½¿ç”¨å¯åºåˆ—åŒ–çš„æŒä¹…åŒ–ç­–ç•¥æ—¶ï¼ˆæ¯”å¦‚MEMORY_ONLY_SERï¼‰ï¼ŒSparkä¼šå°†RDDä¸­çš„æ¯ä¸ªpartitionéƒ½åºåˆ—åŒ–æˆä¸€ä¸ªå¤§çš„å­—èŠ‚æ•°ç»„ã€‚å¯¹äºè¿™ä¸‰ç§å‡ºç°åºåˆ—åŒ–çš„åœ°æ–¹ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨Kryoåºåˆ—åŒ–ç±»åº“ï¼Œæ¥ä¼˜åŒ–åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ€§èƒ½ã€‚Sparké»˜è®¤ä½¿ç”¨çš„æ˜¯Javaçš„åºåˆ—åŒ–æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯ObjectOutputStream/ObjectInputStream APIæ¥è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚ä½†æ˜¯SparkåŒæ—¶æ”¯æŒä½¿ç”¨Kryoåºåˆ—åŒ–åº“ï¼ŒKryoåºåˆ—åŒ–ç±»åº“çš„æ€§èƒ½æ¯”Javaåºåˆ—åŒ–ç±»åº“çš„æ€§èƒ½è¦é«˜å¾ˆå¤šã€‚å®˜æ–¹ä»‹ç»ï¼ŒKryoåºåˆ—åŒ–æœºåˆ¶æ¯”Javaåºåˆ—åŒ–æœºåˆ¶ï¼Œæ€§èƒ½é«˜10å€å·¦å³ã€‚Sparkä¹‹æ‰€ä»¥é»˜è®¤æ²¡æœ‰ä½¿ç”¨Kryoä½œä¸ºåºåˆ—åŒ–ç±»åº“ï¼Œæ˜¯å› ä¸ºKryoè¦æ±‚æœ€å¥½è¦æ³¨å†Œæ‰€æœ‰éœ€è¦è¿›è¡Œåºåˆ—åŒ–çš„è‡ªå®šä¹‰ç±»å‹ï¼Œå› æ­¤å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œè¿™ç§æ–¹å¼æ¯”è¾ƒéº»çƒ¦ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨Kryoçš„ä»£ç ç¤ºä¾‹ï¼Œæˆ‘ä»¬åªè¦è®¾ç½®åºåˆ—åŒ–ç±»ï¼Œå†æ³¨å†Œè¦åºåˆ—åŒ–çš„è‡ªå®šä¹‰ç±»å‹å³å¯ï¼ˆæ¯”å¦‚ç®—å­å‡½æ•°ä¸­ä½¿ç”¨åˆ°çš„å¤–éƒ¨å˜é‡ç±»å‹ã€ä½œä¸ºRDDæ³›å‹ç±»å‹çš„è‡ªå®šä¹‰ç±»å‹ç­‰ï¼‰123456val spark: SparkSession = SparkSession .builder() .appName(\"sql_case\") .master(\"local\") .config(\"spark.serializer\", \"org.apache.spark.serializer.KryoSerializer\") .getOrCreate() ### é…ç½®å‚æ•°ä¼˜åŒ–æ ¹æ®å…¬å¸æ•°æ®ç‰¹ç‚¹ï¼Œä¸ºéƒ¨ç½²çš„å¤§æ•°æ®äº§å“ä»¥åŠè¿è¡Œçš„ä½œä¸šé€‰æ‹©åˆé€‚çš„é…ç½®å‚æ•°ï¼Œæ˜¯å…¬å¸å¤§æ•°æ®å¹³å°æ€§èƒ½ä¼˜åŒ–æœ€ä¸»è¦çš„æ‰‹æ®µï¼Œä¹Ÿæ˜¯å¤§æ•°æ®å·¥ç¨‹å¸ˆæˆ–è€…å¤§æ•°æ®è¿ç»´å·¥ç¨‹å¸ˆçš„ä¸»è¦èŒè´£ã€‚æ¯”å¦‚ Yarn çš„æ¯ä¸ª Container åŒ…å«çš„ CPU ä¸ªæ•°å’Œå†…å­˜æ•°ç›®ã€HDFS æ•°æ®å—çš„å¤§å°å’Œå¤åˆ¶æ•°ç­‰ï¼Œæ¯ä¸ªå¤§æ•°æ®äº§å“éƒ½æœ‰å¾ˆå¤šé…ç½®å‚æ•°ï¼Œè¿™äº›å‚æ•°ä¼šå¯¹å¤§æ•°æ®è¿è¡Œæ—¶çš„æ€§èƒ½äº§ç”Ÿé‡è¦å½±å“ã€‚num-executorså‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®Sparkä½œä¸šæ€»å…±è¦ç”¨å¤šå°‘ä¸ªExecutorè¿›ç¨‹æ¥æ‰§è¡Œã€‚Driveråœ¨å‘YARNé›†ç¾¤ç®¡ç†å™¨ç”³è¯·èµ„æºæ—¶ï¼ŒYARNé›†ç¾¤ç®¡ç†å™¨ä¼šå°½å¯èƒ½æŒ‰ç…§ä½ çš„è®¾ç½®æ¥åœ¨é›†ç¾¤çš„å„ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œå¯åŠ¨ç›¸åº”æ•°é‡çš„Executorè¿›ç¨‹ã€‚è¿™ä¸ªå‚æ•°éå¸¸ä¹‹é‡è¦ï¼Œå¦‚æœä¸è®¾ç½®çš„è¯ï¼Œé»˜è®¤åªä¼šç»™ä½ å¯åŠ¨å°‘é‡çš„Executorè¿›ç¨‹ï¼Œæ­¤æ—¶ä½ çš„Sparkä½œä¸šçš„è¿è¡Œé€Ÿåº¦æ˜¯éå¸¸æ…¢çš„ã€‚å‚æ•°è°ƒä¼˜å»ºè®®ï¼šæ¯ä¸ªSparkä½œä¸šçš„è¿è¡Œä¸€èˆ¬è®¾ç½®50~100ä¸ªå·¦å³çš„Executorè¿›ç¨‹æ¯”è¾ƒåˆé€‚ï¼Œè®¾ç½®å¤ªå°‘æˆ–å¤ªå¤šçš„Executorè¿›ç¨‹éƒ½ä¸å¥½ã€‚è®¾ç½®çš„å¤ªå°‘ï¼Œæ— æ³•å……åˆ†åˆ©ç”¨é›†ç¾¤èµ„æºï¼›è®¾ç½®çš„å¤ªå¤šçš„è¯ï¼Œå¤§éƒ¨åˆ†é˜Ÿåˆ—å¯èƒ½æ— æ³•ç»™äºˆå……åˆ†çš„èµ„æºã€‚executor-memoryå‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®æ¯ä¸ªExecutorè¿›ç¨‹çš„å†…å­˜ã€‚Executorå†…å­˜çš„å¤§å°ï¼Œå¾ˆå¤šæ—¶å€™ç›´æ¥å†³å®šäº†Sparkä½œä¸šçš„æ€§èƒ½ï¼Œè€Œä¸”è·Ÿå¸¸è§çš„JVM OOMå¼‚å¸¸ï¼Œä¹Ÿæœ‰ç›´æ¥çš„å…³è”ã€‚å‚æ•°è°ƒä¼˜å»ºè®®ï¼šæ¯ä¸ªExecutorè¿›ç¨‹çš„å†…å­˜è®¾ç½®4G8Gè¾ƒä¸ºåˆé€‚ã€‚ä½†æ˜¯è¿™åªæ˜¯ä¸€ä¸ªå‚è€ƒå€¼ï¼Œå…·ä½“çš„è®¾ç½®è¿˜æ˜¯å¾—æ ¹æ®ä¸åŒéƒ¨é—¨çš„èµ„æºé˜Ÿåˆ—æ¥å®šã€‚å¯ä»¥çœ‹çœ‹è‡ªå·±å›¢é˜Ÿçš„èµ„æºé˜Ÿåˆ—çš„æœ€å¤§å†…å­˜é™åˆ¶æ˜¯å¤šå°‘ï¼Œnum-executorsä¹˜ä»¥executor-memoryï¼Œæ˜¯ä¸èƒ½è¶…è¿‡é˜Ÿåˆ—çš„æœ€å¤§å†…å­˜é‡çš„ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ æ˜¯è·Ÿå›¢é˜Ÿé‡Œå…¶ä»–äººå…±äº«è¿™ä¸ªèµ„æºé˜Ÿåˆ—ï¼Œé‚£ä¹ˆç”³è¯·çš„å†…å­˜é‡æœ€å¥½ä¸è¦è¶…è¿‡èµ„æºé˜Ÿåˆ—æœ€å¤§æ€»å†…å­˜çš„1/31/2ï¼Œé¿å…ä½ è‡ªå·±çš„Sparkä½œä¸šå ç”¨äº†é˜Ÿåˆ—æ‰€æœ‰çš„èµ„æºï¼Œå¯¼è‡´åˆ«çš„åŒå­¦çš„ä½œä¸šæ— æ³•è¿è¡Œã€‚executor-coreså‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®æ¯ä¸ªExecutorè¿›ç¨‹çš„CPU coreæ•°é‡ã€‚è¿™ä¸ªå‚æ•°å†³å®šäº†æ¯ä¸ªExecutorè¿›ç¨‹å¹¶è¡Œæ‰§è¡Œtaskçº¿ç¨‹çš„èƒ½åŠ›ã€‚å› ä¸ºæ¯ä¸ªCPU coreåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªtaskçº¿ç¨‹ï¼Œå› æ­¤æ¯ä¸ªExecutorè¿›ç¨‹çš„CPU coreæ•°é‡è¶Šå¤šï¼Œè¶Šèƒ½å¤Ÿå¿«é€Ÿåœ°æ‰§è¡Œå®Œåˆ†é…ç»™è‡ªå·±çš„æ‰€æœ‰taskçº¿ç¨‹ã€‚å‚æ•°è°ƒä¼˜å»ºè®®ï¼šExecutorçš„CPU coreæ•°é‡è®¾ç½®ä¸º24ä¸ªè¾ƒä¸ºåˆé€‚ã€‚åŒæ ·å¾—æ ¹æ®ä¸åŒéƒ¨é—¨çš„èµ„æºé˜Ÿåˆ—æ¥å®šï¼Œå¯ä»¥çœ‹çœ‹è‡ªå·±çš„èµ„æºé˜Ÿåˆ—çš„æœ€å¤§CPU coreé™åˆ¶æ˜¯å¤šå°‘ï¼Œå†ä¾æ®è®¾ç½®çš„Executoræ•°é‡ï¼Œæ¥å†³å®šæ¯ä¸ªExecutorè¿›ç¨‹å¯ä»¥åˆ†é…åˆ°å‡ ä¸ªCPU coreã€‚åŒæ ·å»ºè®®ï¼Œå¦‚æœæ˜¯è·Ÿä»–äººå…±äº«è¿™ä¸ªé˜Ÿåˆ—ï¼Œé‚£ä¹ˆnum-executors * executor-coresä¸è¦è¶…è¿‡é˜Ÿåˆ—æ€»CPU coreçš„1/31/2å·¦å³æ¯”è¾ƒåˆé€‚ï¼Œä¹Ÿæ˜¯é¿å…å½±å“å…¶ä»–åŒå­¦çš„ä½œä¸šè¿è¡Œã€‚driver-memoryå‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®Driverè¿›ç¨‹çš„å†…å­˜ã€‚å‚æ•°è°ƒä¼˜å»ºè®®ï¼šDriverçš„å†…å­˜é€šå¸¸æ¥è¯´ä¸è®¾ç½®ï¼Œæˆ–è€…è®¾ç½®1Gå·¦å³åº”è¯¥å°±å¤Ÿäº†ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨collectç®—å­å°†RDDçš„æ•°æ®å…¨éƒ¨æ‹‰å–åˆ°Driverä¸Šè¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆå¿…é¡»ç¡®ä¿Driverçš„å†…å­˜è¶³å¤Ÿå¤§ï¼Œå¦åˆ™ä¼šå‡ºç°OOMå†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚spark.default.parallelismå‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®æ¯ä¸ªstageçš„é»˜è®¤taskæ•°é‡ã€‚è¿™ä¸ªå‚æ•°æä¸ºé‡è¦ï¼Œå¦‚æœä¸è®¾ç½®å¯èƒ½ä¼šç›´æ¥å½±å“ä½ çš„Sparkä½œä¸šæ€§èƒ½ã€‚å‚æ•°è°ƒä¼˜å»ºè®®ï¼šSparkä½œä¸šçš„é»˜è®¤taskæ•°é‡ä¸º5001000ä¸ªè¾ƒä¸ºåˆé€‚ã€‚å¾ˆå¤šåŒå­¦å¸¸çŠ¯çš„ä¸€ä¸ªé”™è¯¯å°±æ˜¯ä¸å»è®¾ç½®è¿™ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šå¯¼è‡´Sparkè‡ªå·±æ ¹æ®åº•å±‚HDFSçš„blockæ•°é‡æ¥è®¾ç½®taskçš„æ•°é‡ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªHDFS blockå¯¹åº”ä¸€ä¸ªtaskã€‚é€šå¸¸æ¥è¯´ï¼ŒSparké»˜è®¤è®¾ç½®çš„æ•°é‡æ˜¯åå°‘çš„ï¼ˆæ¯”å¦‚å°±å‡ åä¸ªtaskï¼‰ï¼Œå¦‚æœtaskæ•°é‡åå°‘çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ä½ å‰é¢è®¾ç½®å¥½çš„Executorçš„å‚æ•°éƒ½å‰åŠŸå°½å¼ƒã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œæ— è®ºä½ çš„Executorè¿›ç¨‹æœ‰å¤šå°‘ä¸ªï¼Œå†…å­˜å’ŒCPUæœ‰å¤šå¤§ï¼Œä½†æ˜¯taskåªæœ‰1ä¸ªæˆ–è€…10ä¸ªï¼Œé‚£ä¹ˆ90%çš„Executorè¿›ç¨‹å¯èƒ½æ ¹æœ¬å°±æ²¡æœ‰taskæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ç™½ç™½æµªè´¹äº†èµ„æºï¼å› æ­¤Sparkå®˜ç½‘å»ºè®®çš„è®¾ç½®åŸåˆ™æ˜¯ï¼Œè®¾ç½®è¯¥å‚æ•°ä¸ºnum-executors * executor-coresçš„23å€è¾ƒä¸ºåˆé€‚ï¼Œæ¯”å¦‚Executorçš„æ€»CPU coreæ•°é‡ä¸º300ä¸ªï¼Œé‚£ä¹ˆè®¾ç½®1000ä¸ªtaskæ˜¯å¯ä»¥çš„ï¼Œæ­¤æ—¶å¯ä»¥å……åˆ†åœ°åˆ©ç”¨Sparké›†ç¾¤çš„èµ„æºã€‚spark.storage.memoryFractionå‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®RDDæŒä¹…åŒ–æ•°æ®åœ¨Executorå†…å­˜ä¸­èƒ½å çš„æ¯”ä¾‹ï¼Œé»˜è®¤æ˜¯0.6ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤Executor 60%çš„å†…å­˜ï¼Œå¯ä»¥ç”¨æ¥ä¿å­˜æŒä¹…åŒ–çš„RDDæ•°æ®ã€‚æ ¹æ®ä½ é€‰æ‹©çš„ä¸åŒçš„æŒä¹…åŒ–ç­–ç•¥ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿæ—¶ï¼Œå¯èƒ½æ•°æ®å°±ä¸ä¼šæŒä¹…åŒ–ï¼Œæˆ–è€…æ•°æ®ä¼šå†™å…¥ç£ç›˜ã€‚å‚æ•°è°ƒä¼˜å»ºè®®ï¼šå¦‚æœSparkä½œä¸šä¸­ï¼Œæœ‰è¾ƒå¤šçš„RDDæŒä¹…åŒ–æ“ä½œï¼Œè¯¥å‚æ•°çš„å€¼å¯ä»¥é€‚å½“æé«˜ä¸€äº›ï¼Œä¿è¯æŒä¹…åŒ–çš„æ•°æ®èƒ½å¤Ÿå®¹çº³åœ¨å†…å­˜ä¸­ã€‚é¿å…å†…å­˜ä¸å¤Ÿç¼“å­˜æ‰€æœ‰çš„æ•°æ®ï¼Œå¯¼è‡´æ•°æ®åªèƒ½å†™å…¥ç£ç›˜ä¸­ï¼Œé™ä½äº†æ€§èƒ½ã€‚ä½†æ˜¯å¦‚æœSparkä½œä¸šä¸­çš„shuffleç±»æ“ä½œæ¯”è¾ƒå¤šï¼Œè€ŒæŒä¹…åŒ–æ“ä½œæ¯”è¾ƒå°‘ï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°çš„å€¼é€‚å½“é™ä½ä¸€äº›æ¯”è¾ƒåˆé€‚ã€‚æ­¤å¤–ï¼Œå¦‚æœå‘ç°ä½œä¸šç”±äºé¢‘ç¹çš„gcå¯¼è‡´è¿è¡Œç¼“æ…¢ï¼ˆé€šè¿‡spark web uiå¯ä»¥è§‚å¯Ÿåˆ°ä½œä¸šçš„gcè€—æ—¶ï¼‰ï¼Œæ„å‘³ç€taskæ‰§è¡Œç”¨æˆ·ä»£ç çš„å†…å­˜ä¸å¤Ÿç”¨ï¼Œé‚£ä¹ˆåŒæ ·å»ºè®®è°ƒä½è¿™ä¸ªå‚æ•°çš„å€¼ã€‚spark.shuffle.memoryFractionå‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®shuffleè¿‡ç¨‹ä¸­ä¸€ä¸ªtaskæ‹‰å–åˆ°ä¸Šä¸ªstageçš„taskçš„è¾“å‡ºåï¼Œè¿›è¡Œèšåˆæ“ä½œæ—¶èƒ½å¤Ÿä½¿ç”¨çš„Executorå†…å­˜çš„æ¯”ä¾‹ï¼Œé»˜è®¤æ˜¯0.2ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒExecutoré»˜è®¤åªæœ‰20%çš„å†…å­˜ç”¨æ¥è¿›è¡Œè¯¥æ“ä½œã€‚shuffleæ“ä½œåœ¨è¿›è¡Œèšåˆæ—¶ï¼Œå¦‚æœå‘ç°ä½¿ç”¨çš„å†…å­˜è¶…å‡ºäº†è¿™ä¸ª20%çš„é™åˆ¶ï¼Œé‚£ä¹ˆå¤šä½™çš„æ•°æ®å°±ä¼šæº¢å†™åˆ°ç£ç›˜æ–‡ä»¶ä¸­å»ï¼Œæ­¤æ—¶å°±ä¼šæå¤§åœ°é™ä½æ€§èƒ½ã€‚å‚æ•°è°ƒä¼˜å»ºè®®ï¼šå¦‚æœSparkä½œä¸šä¸­çš„RDDæŒä¹…åŒ–æ“ä½œè¾ƒå°‘ï¼Œshuffleæ“ä½œè¾ƒå¤šæ—¶ï¼Œå»ºè®®é™ä½æŒä¹…åŒ–æ“ä½œçš„å†…å­˜å æ¯”ï¼Œæé«˜shuffleæ“ä½œçš„å†…å­˜å æ¯”æ¯”ä¾‹ï¼Œé¿å…shuffleè¿‡ç¨‹ä¸­æ•°æ®è¿‡å¤šæ—¶å†…å­˜ä¸å¤Ÿç”¨ï¼Œå¿…é¡»æº¢å†™åˆ°ç£ç›˜ä¸Šï¼Œé™ä½äº†æ€§èƒ½ã€‚æ­¤å¤–ï¼Œå¦‚æœå‘ç°ä½œä¸šç”±äºé¢‘ç¹çš„gcå¯¼è‡´è¿è¡Œç¼“æ…¢ï¼Œæ„å‘³ç€taskæ‰§è¡Œç”¨æˆ·ä»£ç çš„å†…å­˜ä¸å¤Ÿç”¨ï¼Œé‚£ä¹ˆåŒæ ·å»ºè®®è°ƒä½è¿™ä¸ªå‚æ•°çš„å€¼ã€‚123456789./bin/spark-submit \\ --master yarn-cluster \\ --num-executors 100 \\ --executor-memory 6G \\ --executor-cores 4 \\ --driver-memory 1G \\ --conf spark.default.parallelism=1000 \\ --conf spark.storage.memoryFraction=0.5 \\ --conf spark.shuffle.memoryFraction=0.3 \\åœ¨æ€§èƒ½ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œ**CPUã€å†…å­˜ã€ç½‘ç»œã€ç£ç›˜**è¿™å››ç§ä¸»è¦è®¡ç®—èµ„æºçš„ä½¿ç”¨å’Œ Spark çš„è®¡ç®—é˜¶æ®µå¯†åˆ‡ç›¸å…³ã€‚Spark æ€§èƒ½ä¼˜åŒ–å¯ä»¥åˆ†è§£ä¸ºä¸‹é¢å‡ æ­¥ã€‚æ€§èƒ½æµ‹è¯•ï¼Œè§‚å¯Ÿ Spark æ€§èƒ½ç‰¹æ€§å’Œèµ„æºï¼ˆCPUã€Memoryã€Diskã€Netï¼‰åˆ©ç”¨æƒ…å†µã€‚åˆ†æã€å¯»æ‰¾èµ„æºç“¶é¢ˆã€‚åˆ†æç³»ç»Ÿæ¶æ„ã€ä»£ç ï¼Œå‘ç°èµ„æºåˆ©ç”¨å…³é”®æ‰€åœ¨ï¼Œæ€è€ƒä¼˜åŒ–ç­–ç•¥ã€‚ä»£ç ã€æ¶æ„ã€åŸºç¡€è®¾æ–½è°ƒä¼˜ï¼Œä¼˜åŒ–ã€å¹³è¡¡èµ„æºåˆ©ç”¨ã€‚æ€§èƒ½æµ‹è¯•ï¼Œè§‚å¯Ÿç³»ç»Ÿæ€§èƒ½ç‰¹æ€§ï¼Œæ˜¯å¦è¾¾åˆ°ä¼˜åŒ–ç›®çš„ï¼Œä»¥åŠå¯»æ‰¾ä¸‹ä¸€ä¸ªç“¶é¢ˆç‚¹ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"Spark SQL æºç è§£æ","slug":"Spark-SQL-æºç è§£æ","date":"2017-04-01T15:48:43.000Z","updated":"2020-04-29T12:09:17.572Z","comments":true,"path":"2017/04/01/Spark-SQL-æºç è§£æ/","link":"","permalink":"cpeixin.cn/2017/04/01/Spark-SQL-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/","excerpt":"","text":"Spark SQLæ˜¯è®©Sparkåº”ç”¨ç¨‹åºæ‹¥æœ‰é«˜æ•ˆæ€§ã€é«˜å¯å®¹é”™æ€§å’Œä¸°å¯Œç”Ÿæ€çš„â€œå¹•åè‹±é›„â€ã€‚åœ¨å­¦ä¹ Spark SQL åº•å±‚è§£æåŸç†å‰ï¼Œå…ˆçœ‹ä¸‹é¢ä¸‰å¼ æ¶æ„å›¾ã€‚æ¶æ„å›¾ä¸­è¿è¡Œçš„æµç¨‹ï¼Œä»¥åŠè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„ç»„ä»¶ã€‚ä¸¤å¼ å›¾ç‰‡äº’ä¸ºè¡¥å……çš„å»çœ‹ã€‚è¿è¡Œæµç¨‹é¦–å…ˆæ¢³ç†è¿è¡Œæµç¨‹ï¼Œåœ¨sparkä¸­æ‰§è¡ŒSQLè¯­å¥æˆ–è€…DataFrameçš„ç®—å­æ“ä½œï¼Œåœ¨é›†ç¾¤ä¸»è¦ç»è¿‡ä¸¤å¤§è¿‡ç¨‹LogicalPlanï¼ˆé€»è¾‘è®¡åˆ’ï¼‰ï¼Œç†è§£ä¸ºæ ‘å‹æ•°æ®ç»“æ„ï¼Œé€»è¾‘ç®—å­æ ‘PhysicalPlanï¼ˆç‰©ç†è®¡åˆ’ï¼‰ï¼Œç†è§£ä¸ºç‰©ç†ç®—å­æ ‘å…¶æ¬¡ï¼Œä¸¤ä¸ªä¸»è¦è¿‡ç¨‹ä¸­æœ‰åŒ…å«å‡ ä¸ªå­è¿‡ç¨‹ï¼šé€»è¾‘è®¡åˆ’ï¼ˆLogicalPlanï¼‰:**æœªè§£æçš„é€»è¾‘ç®—å­æ ‘ï¼ˆUnresolved LogicalPlanï¼‰ï¼Œä»…ä»…æ˜¯æ•°æ®ç»“æ„ï¼Œä¸åŒ…å«ä»»ä½•æ•°æ®ä¿¡æ¯è§£æåé€»è¾‘ç®—å­æ ‘ï¼ˆAnalyzed LogicalPlanï¼‰ï¼ŒèŠ‚ç‚¹ä¸­ç»‘å®šå„ç§ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æœ‰catalogå‚ä¸ä¼˜åŒ–åé€»è¾‘ç®—å­æ ‘ï¼ˆOptimized LogicalPlanï¼‰ï¼Œåº”ç”¨å„ç§ä¼˜åŒ–è§„åˆ™å¯¹ä¸€äº›ä½æ•ˆçš„é€»è¾‘è®¡åˆ’è¿›è¡Œè½¬æ¢ç‰©ç†è®¡åˆ’ï¼ˆPhysicalPlanï¼‰ï¼š**æ ¹æ®é€»è¾‘ç®—å­æ ‘ï¼Œç”Ÿæˆç‰©ç†ç®—å­æ ‘çš„åˆ—è¡¨ï¼ˆIterator[PhysicalPlan]ï¼‰,åŒæ ·é€»è¾‘ç®—å­æ ‘å¯èƒ½å¯¹åº”å¤šä¸ªç‰©ç†ç®—å­æ ‘ã€‚ï¼ˆä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼ŒPhysicalPlané˜¶æ®µçš„å¤šä¸ªç»¿è‰²äº”è¾¹å½¢ï¼‰ä»åˆ—è¡¨ä¸­æŒ‰ç…§ä¸€å®šç­–ç•¥é€‰å–æœ€ä¼˜çš„ç‰©ç†ç®—å­æ ‘ï¼ˆSparkPlanï¼‰å¯¹é€‰å–çš„ç‰©ç†ç®—å­æ ‘åšæäº¤å‰çš„å‡†å¤‡å·¥ä½œï¼Œä¾‹å¦‚ç¡®ä¿åˆ†åŒºæ“ä½œæ­£ç¡®ï¼Œç‰©ç†ç®—å­èŠ‚ç‚¹é‡ç”¨ï¼Œæ‰§è¡Œä»£ç ç”Ÿæˆç­‰ã€‚ç»è¿‡å‡†å¤‡åçš„ç‰©ç†ç®—å­ï¼ˆPrepared SparkPlanï¼‰æœ€ç»ˆç‰©ç†ç®—å­æ ‘ç”Ÿæˆçš„RDDæ‰§è¡Œactionæ“ä½œï¼Œå³å¯æäº¤æ‰§è¡Œã€‚æµç¨‹è¯´æ˜é€»è¾‘æ‰§è¡Œè®¡åˆ’ä¸»è¦æ˜¯ä¸€ç³»åˆ— _æŠ½è±¡çš„è½¬æ¢è¿‡ç¨‹_ï¼Œå®ƒå¹¶ä¸æ¶‰åŠexecutorsæˆ–è€…driversï¼Œå®ƒä»…ä»…æ˜¯å°†ç”¨æˆ·çš„ä»£ç è¡¨è¾¾å¼è½¬æ¢æˆä¸€ä¸ªä¼˜åŒ–çš„ç‰ˆæœ¬ã€‚ç”¨æˆ·çš„ä»£ç é¦–å…ˆä¼šè¢«è½¬æ¢æˆ æœªè§£å†³çš„é€»è¾‘è®¡åˆ’(unresolved logical plan) ï¼Œä¹‹æ‰€ä»¥å°†ä¹‹ç§°ä½œ æœªè§£å†³çš„ , æ˜¯å› ä¸ºå®ƒå¹¶ä¸€å®šæ˜¯æ­£ç¡®çš„ï¼Œå®ƒæ‰€å¼•ç”¨åˆ°çš„è¡¨åæˆ–è€…åˆ—åå¯èƒ½å­˜åœ¨ï¼Œä¹Ÿå¯èƒ½ä¸å­˜åœ¨ã€‚Sparkä¹‹åä¼šä½¿ç”¨ calalog_ï¼Œä¸€ä¸ªå«æœ‰æ‰€æœ‰tableå’ŒDataFrameçš„å…ƒæ•°æ®ä»“åº“ï¼Œåœ¨ _åˆ†æå™¨(analyser) ä¸­æ¥è§£ææ ¡å¯¹æ‰€å¼•ç”¨çš„è¡¨åæˆ–è€…åˆ—åã€‚å‡å¦‚ unresolved logical plan é€šè¿‡äº†éªŒè¯ï¼Œè¿™æ—¶çš„è®¡åˆ’æˆ‘ä»¬ç§°ä¹‹ä¸º å·²è§£å†³çš„é€»è¾‘è®¡åˆ’(resolved logical plan) ã€‚å®ƒä¼šä¼ é€’åˆ° Catalyst Optimizer ä¼˜åŒ–å™¨ï¼Œç„¶åè¢«ç»è¿‡ä¸€äº›åˆ—ä¼˜åŒ–ç”Ÿæˆæœ€ä¼˜é€»è¾‘è®¡åˆ’(Optimized logical plan)AST -&gt; Unresolved Logical Planå®è´¨ï¼šSQLè¯­å¥é¦–å…ˆé€šè¿‡Parseræ¨¡å—è¢«è§£æä¸ºè¯­æ³•æ ‘ï¼Œæ­¤æ£µæ ‘ç§°ä¸ºUnresolved Logical Plané¦–å…ˆåœ¨æ¶æ„å›¾ä¸­ï¼Œæœ€å‰ç«¯æˆ‘ä»¬å¯ä»¥æ˜¯åœ¨Sparkä¸­æŒ‡å®šSQLè¯­å¥ï¼Œæˆ–è€…æ˜¯Dataframeçš„ç®—å­æ“ä½œï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œå°±ç›´æ¥è¿›å…¥äº†é€»è¾‘è®¡åˆ’ç”Ÿæˆé˜¶æ®µï¼šspark.sql() è¿™ç§æ–¹å¼çš„è¯ä¼šæ¶‰åŠåˆ°sqlçš„è§£æï¼Œè§£æä¹‹åå°±ä¼šç”Ÿæˆé€»è¾‘è®¡åˆ’å¦‚æœæ˜¯ç›´æ¥åœ¨DataFrameçš„apiä¸Šç›´æ¥æ“ä½œçš„è¯ï¼Œä½¿ç”¨çš„apiå°†ç›´æ¥ç”Ÿæˆé€»è¾‘è®¡åˆ’è¿™é‡Œï¼Œæˆ‘ä»¬ä»spark.sql()ä¸ºå…¥å£ï¼Œåœ¨æºç é‡Œé¢ä¸€æ­¥ä¸€æ­¥çš„å»æ¢ç´¢åº•å±‚é€»è¾‘æ˜¯å¦‚ä½•å®ç°çš„ã€‚1spark.sql(\"select * from t_user\")sqlå…¥å£â¬‡ï¸123456789/** * Executes a SQL query using Spark, returning the result as a `DataFrame`. * The dialect that is used for SQL parsing can be configured with 'spark.sql.dialect'. * * @since 2.0.0 */ def sql(sqlText: String): DataFrame = &#123; Dataset.ofRows(self, sessionState.sqlParser.parsePlan(sqlText)) &#125;â¬‡ï¸12345678trait ParserInterface &#123; /** * Parse a string to a [[LogicalPlan]]. */ @throws[ParseException](\"Text cannot be parsed to a LogicalPlan\") def parsePlan(sqlText: String): LogicalPlan.......&#125;è¿™é‡Œçœ‹åˆ° parsePlan æ–¹æ³•è¿”å›ä¸ºLogicalPlanï¼Œå°±æ˜¯åœ¨è¿™é‡Œï¼Œå°†ä¸€ä¸ªsqlè¯­å¥é€šè¿‡astè§£ææˆunresolved logicalPlanâ¬‡ï¸123456789/** Creates LogicalPlan for a given SQL string. */override def parsePlan(sqlText: String): LogicalPlan = parse(sqlText) &#123; parser =&gt; astBuilder.visitSingleStatement(parser.singleStatement()) match &#123; case plan: LogicalPlan =&gt; plan case _ =&gt; val position = Origin(None, None) throw new ParseException(Option(sqlText), \"Unsupported SQL statement\", position, position) &#125;&#125;ANTLR4æ˜¯JAVAå†™çš„è¯­è¨€è¯†åˆ«å·¥å…·ï¼Œå®ƒç”¨æ¥å£°æ˜è¯­è¨€çš„è¯­æ³•ã€‚å®ƒçš„è¯­æ³•è¯†åˆ«åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µè¯æ³•åˆ†æé˜¶æ®µï¼šç†è§£ä¸ºæŠŠç¬¦å·åˆ†æˆç»„æˆ–è€…ç¬¦å·ç±»è§£æé˜¶æ®µï¼šæ ¹æ®è¯æ³•ï¼Œè§£ææˆä¸€æ£µè¯­æ³•åˆ†ææ ‘astBuilderç±»ä¸»è¦åŠŸèƒ½æ˜¯æŠŠAntlr4çš„è§£ææ ‘ è½¬æ¢ä¸ºcatalystè¡¨è¾¾å¼astBuilderæ˜¯SparkSqlAstBuilderçš„å®ä¾‹ï¼Œåœ¨å°†Antlrä¸­çš„åŒ¹é…æ ‘è½¬æ¢æˆunresolved logical planä¸­ï¼Œå®ƒèµ·ç€æ¡¥æ¢ä½œç”¨ã€‚singleStatement()æ–¹æ³•æ„å»ºæ•´æ£µè¯­æ³•æ ‘ï¼Œç„¶åé€šè¿‡ astBuilder.visitSingleStatementä½¿ç”¨visitoræ¨¡å¼ï¼Œå¼€å§‹åŒ¹é…SqlBase.g4ä¸­sqlçš„å…¥å£åŒ¹é…è§„åˆ™ï¼Œï¼ˆSqlBase.g4æ˜¯sparksqlçš„è¯­æ³•æ–‡ä»¶ï¼‰é€’å½’çš„éå†statementï¼Œä»¥åŠå…¶åçš„å„ä¸ªèŠ‚ç‚¹ã€‚åœ¨åŒ¹é…è¿‡ç¨‹ä¸­ï¼Œç¢°åˆ°å¶å­èŠ‚ç‚¹ï¼Œå°±å°†æ„é€ Logical Planä¸­å¯¹åº”çš„TreeNodeã€‚â¬‡ï¸12345678910111213141516171819202122232425262728293031323334353637383940protected def parse[T](command: String)(toResult: SqlBaseParser =&gt; T): T = &#123; logDebug(s\"Parsing command: $command\") val lexer = new SqlBaseLexer(new UpperCaseCharStream(CharStreams.fromString(command))) lexer.removeErrorListeners() lexer.addErrorListener(ParseErrorListener) val tokenStream = new CommonTokenStream(lexer) val parser = new SqlBaseParser(tokenStream) parser.addParseListener(PostProcessor) parser.removeErrorListeners() parser.addErrorListener(ParseErrorListener) try &#123; try &#123; // first, try parsing with potentially faster SLL mode parser.getInterpreter.setPredictionMode(PredictionMode.SLL) toResult(parser) &#125; catch &#123; case e: ParseCancellationException =&gt; // if we fail, parse with LL mode tokenStream.seek(0) // rewind input stream parser.reset() // Try Again. parser.getInterpreter.setPredictionMode(PredictionMode.LL) toResult(parser) &#125; &#125; catch &#123; case e: ParseException if e.command.isDefined =&gt; throw e case e: ParseException =&gt; throw e.withCommand(command) case e: AnalysisException =&gt; val position = Origin(e.line, e.startPosition) throw new ParseException(Option(command), e.message, position, position) &#125; &#125;å…ˆåå®ä¾‹åŒ–äº†åˆ†è¯è§£æSqlBaseLexerå’Œè¯­æ³•è§£æSqlBaseParserç±»ï¼Œæœ€åå°†antlrçš„è¯­æ³•è§£æå™¨ï¼Œç„¶åä¸€æ¬¡å°è¯•ç”¨ä¸åŒçš„æ¨¡å¼å»è¿›è¡Œè§£æã€‚æœ€ç»ˆå°†antlrçš„è¯­æ³•è§£æå™¨parserï¼Œä¼ å…¥parsePlanã€‚UnresolvedLogicalPlanåœ¨ç»å†ä¸Šé¢è¿‡ç¨‹ä¹‹åï¼Œæ­¤æ—¶çš„æœªè§£æçš„é€»è¾‘æ ‘ï¼Œåªæ˜¯ä¸€ä¸ªç®€å•é€»è¾‘ï¼Œè¿˜æ²¡æœ‰ç»‘å®šæ•°æ®ï¼Œæ²¡æœ‰ä»»ä½•æ•°æ®ä¿¡æ¯ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥å‘ç”Ÿçš„äº‹æƒ…å°±æ˜¯å¦‚ä½•åœ¨UnresolvedLogicalPlanåŸºç¡€ä¸Šç»‘å®šæ¯ä¸ªèŠ‚ç‚¹ä¿¡æ¯ï¼ŸUnresolved Logical Plan -&gt; Logical Planå®è´¨ï¼šUnresolved Logical Plané€šè¿‡Analyzeræ¨¡å—å€ŸåŠ©äºCatalogä¸­çš„è¡¨ä¿¡æ¯è§£æä¸ºLogical Planï¼›æµç¨‹å›¾ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°Analysisä¸»è¦èŒè´£å°±æ˜¯å°†é€šè¿‡Sql Parseræœªèƒ½Resolvedçš„Logical Planç»™Resolvedæ‰ã€‚æˆ‘ä»¬ä»ä¸‹é¢å¼€å§‹ï¼š123456789/** * Executes a SQL query using Spark, returning the result as a `DataFrame`. * The dialect that is used for SQL parsing can be configured with 'spark.sql.dialect'. * * @since 2.0.0 */ def sql(sqlText: String): DataFrame = &#123; Dataset.ofRows(self, sessionState.sqlParser.parsePlan(sqlText)) &#125;åœ¨ä¸Šä¸€é˜¶æ®µæˆ‘ä»¬åˆ†æåˆ°sessionState.sqlParser.parsePlan(sqlText)æ–¹å¼æ˜¯é€»è¾‘è®¡åˆ’çš„å¼€å§‹ï¼Œè§£æç”ŸæˆUnresolved Logical Planï¼Œè¿™æ—¶Unresolved Logical Planä½œä¸ºå‚æ•°ï¼Œä¼ å…¥åˆ°ofRows()æ–¹æ³•ä¸­ã€‚1234567891011121314151617package org.apache.spark.sqlprivate[sql] object Dataset &#123; def apply[T: Encoder](sparkSession: SparkSession, logicalPlan: LogicalPlan): Dataset[T] = &#123; val dataset = new Dataset(sparkSession, logicalPlan, implicitly[Encoder[T]]) // Eagerly bind the encoder so we verify that the encoder matches the underlying // schema. The user will get an error if this is not the case. dataset.deserializer dataset &#125; def ofRows(sparkSession: SparkSession, logicalPlan: LogicalPlan): DataFrame = &#123; val qe = sparkSession.sessionState.executePlan(logicalPlan) qe.assertAnalyzed() new Dataset[Row](sparkSession, qe, RowEncoder(qe.analyzed.schema)) &#125;&#125;è¿™é‡Œé¦–å…ˆåˆ›å»ºäº†queryExecutionç±»å¯¹è±¡ï¼ŒQueryExecutionä¸­å®šä¹‰äº†sqlæ‰§è¡Œè¿‡ç¨‹ä¸­çš„å…³é”®æ­¥éª¤ï¼Œæ˜¯sqlæ‰§è¡Œçš„å…³é”®ç±»ï¼Œè¿”å›ä¸€ä¸ªdataframeç±»å‹çš„å¯¹è±¡ã€‚QueryExecutionç±»ä¸­çš„æˆå‘˜éƒ½æ˜¯lazyçš„ï¼Œè¢«è°ƒç”¨æ—¶æ‰ä¼šæ‰§è¡Œã€‚åªæœ‰ç­‰åˆ°ç¨‹åºä¸­å‡ºç°actionç®—å­æ—¶ï¼Œæ‰ä¼šè°ƒç”¨ queryExecutionç±»ä¸­çš„executedPlanæˆå‘˜ï¼Œ1def executePlan(plan: LogicalPlan): QueryExecution = createQueryExecution(plan)åˆ›å»ºQueryExecution123456789101112131415161718class QueryExecution(val sparkSession: SparkSession, val logical: LogicalPlan) &#123; // TODO: Move the planner an optimizer into here from SessionState. protected def planner = sparkSession.sessionState.planner def assertAnalyzed(): Unit = analyzed def assertSupported(): Unit = &#123; if (sparkSession.sessionState.conf.isUnsupportedOperationCheckEnabled) &#123; UnsupportedOperationChecker.checkForBatch(analyzed) &#125; &#125; lazy val analyzed: LogicalPlan = &#123; SparkSession.setActiveSession(sparkSession) sparkSession.sessionState.analyzer.executeAndCheck(logical) &#125; .......QueryExecutionæ˜¯Sparkç”¨æ¥æ‰§è¡Œå…³ç³»å‹æŸ¥è¯¢çš„ä¸»è¦å·¥ä½œæµã€‚å®ƒæ˜¯è¢«è®¾è®¡ç”¨æ¥ä¸ºå¼€å‘äººå‘˜æä¾›æ›´æ–¹ä¾¿çš„å¯¹æŸ¥è¯¢æ‰§è¡Œä¸­é—´é˜¶æ®µçš„è®¿é—®ã€‚QueryExecutionä¸­æœ€é‡è¦çš„æ˜¯æˆå‘˜å˜é‡ï¼Œå®ƒçš„æˆå‘˜å˜é‡å‡ ä¹éƒ½æ˜¯lazy variableï¼Œå®ƒçš„æ–¹æ³•å¤§éƒ¨åˆ†æ˜¯ä¸ºäº†æä¾›ç»™è¿™äº›lazy variableå»è°ƒç”¨çš„ï¼Œè°ƒç”¨analyzerè§£æå™¨,å¯¹Unresolved LogicalPlanè¿›è¡Œå…ƒæ•°æ®ç»‘å®šç”Ÿæˆçš„Resolved LogicalPlan123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111package org.apache.spark.sql.catalyst.analysis/** * Provides a logical query plan analyzer, which translates [[UnresolvedAttribute]]s and * [[UnresolvedRelation]]s into fully typed objects using information in a [[SessionCatalog]]. */class Analyzer( catalog: SessionCatalog, conf: SQLConf, maxIterations: Int) extends RuleExecutor[LogicalPlan] with CheckAnalysis &#123; def this(catalog: SessionCatalog, conf: SQLConf) = &#123; this(catalog, conf, conf.optimizerMaxIterations) &#125; def executeAndCheck(plan: LogicalPlan): LogicalPlan = &#123; val analyzed = execute(plan) try &#123; checkAnalysis(analyzed) EliminateBarriers(analyzed) &#125; catch &#123; case e: AnalysisException =&gt; val ae = new AnalysisException(e.message, e.line, e.startPosition, Option(analyzed)) ae.setStackTrace(e.getStackTrace) throw ae &#125; &#125; override def execute(plan: LogicalPlan): LogicalPlan = &#123; AnalysisContext.reset() try &#123; executeSameContext(plan) &#125; finally &#123; AnalysisContext.reset() &#125; &#125; private def executeSameContext(plan: LogicalPlan): LogicalPlan = super.execute(plan) def resolver: Resolver = conf.resolver protected val fixedPoint = FixedPoint(maxIterations) /** * Override to provide additional rules for the \"Resolution\" batch. */ val extendedResolutionRules: Seq[Rule[LogicalPlan]] = Nil /** * Override to provide rules to do post-hoc resolution. Note that these rules will be executed * in an individual batch. This batch is to run right after the normal resolution batch and * execute its rules in one pass. */ val postHocResolutionRules: Seq[Rule[LogicalPlan]] = Nil lazy val batches: Seq[Batch] = Seq( Batch(\"Hints\", fixedPoint, new ResolveHints.ResolveBroadcastHints(conf), ResolveHints.RemoveAllHints), Batch(\"Simple Sanity Check\", Once, LookupFunctions), Batch(\"Substitution\", fixedPoint, CTESubstitution, WindowsSubstitution, EliminateUnions, new SubstituteUnresolvedOrdinals(conf)), Batch(\"Resolution\", fixedPoint, ResolveTableValuedFunctions :: ResolveRelations :: ResolveReferences :: ResolveCreateNamedStruct :: ResolveDeserializer :: ResolveNewInstance :: ResolveUpCast :: ResolveGroupingAnalytics :: ResolvePivot :: ResolveOrdinalInOrderByAndGroupBy :: ResolveAggAliasInGroupBy :: ResolveMissingReferences :: ExtractGenerator :: ResolveGenerate :: ResolveFunctions :: ResolveAliases :: ResolveSubquery :: ResolveSubqueryColumnAliases :: ResolveWindowOrder :: ResolveWindowFrame :: ResolveNaturalAndUsingJoin :: ExtractWindowExpressions :: GlobalAggregates :: ResolveAggregateFunctions :: TimeWindowing :: ResolveInlineTables(conf) :: ResolveTimeZone(conf) :: ResolvedUuidExpressions :: TypeCoercion.typeCoercionRules(conf) ++ extendedResolutionRules : _*), Batch(\"Post-Hoc Resolution\", Once, postHocResolutionRules: _*), Batch(\"View\", Once, AliasViewChild(conf)), Batch(\"Nondeterministic\", Once, PullOutNondeterministic), Batch(\"UDF\", Once, HandleNullInputsForUDF), Batch(\"FixNullability\", Once, FixNullability), Batch(\"Subquery\", Once, UpdateOuterReferences), Batch(\"Cleanup\", fixedPoint, CleanupAliases) )å…¶ä¸­val analyzed: LogicalPlan= analyzer.execute(logical)ï¼Œlogicalå°±æ˜¯sqlparserè§£æå‡ºæ¥çš„unresolved logical planï¼Œanalyzedå°±æ˜¯analyzed logical planã€‚é‚£ä¹ˆexectueç©¶ç«Ÿæ˜¯è¿™ä¹ˆæ ·çš„è¿‡ç¨‹å‘¢ï¼Ÿsuper.execute(plan)æ–¹æ³•123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124package org.apache.spark.sql.catalyst.rulesobject RuleExecutor &#123; protected val queryExecutionMeter = QueryExecutionMetering() /** Dump statistics about time spent running specific rules. */ def dumpTimeSpent(): String = &#123; queryExecutionMeter.dumpTimeSpent() &#125; /** Resets statistics about time spent running specific rules */ def resetMetrics(): Unit = &#123; queryExecutionMeter.resetMetrics() &#125;&#125;abstract class RuleExecutor[TreeType &lt;: TreeNode[_]] extends Logging &#123; /** * An execution strategy for rules that indicates the maximum number of executions. If the * execution reaches fix point (i.e. converge) before maxIterations, it will stop. */ abstract class Strategy &#123; def maxIterations: Int &#125; /** A strategy that only runs once. */ case object Once extends Strategy &#123; val maxIterations = 1 &#125; /** A strategy that runs until fix point or maxIterations times, whichever comes first. */ case class FixedPoint(maxIterations: Int) extends Strategy /** A batch of rules. */ protected case class Batch(name: String, strategy: Strategy, rules: Rule[TreeType]*) /** Defines a sequence of rule batches, to be overridden by the implementation. */ protected def batches: Seq[Batch] /** * Defines a check function that checks for structural integrity of the plan after the execution * of each rule. For example, we can check whether a plan is still resolved after each rule in * `Optimizer`, so we can catch rules that return invalid plans. The check function returns * `false` if the given plan doesn't pass the structural integrity check. */ protected def isPlanIntegral(plan: TreeType): Boolean = true /** * Executes the batches of rules defined by the subclass. The batches are executed serially * using the defined execution strategy. Within each batch, rules are also executed serially. */ def execute(plan: TreeType): TreeType = &#123; var curPlan = plan val queryExecutionMetrics = RuleExecutor.queryExecutionMeter batches.foreach &#123; batch =&gt; val batchStartPlan = curPlan var iteration = 1 var lastPlan = curPlan var continue = true // Run until fix point (or the max number of iterations as specified in the strategy. while (continue) &#123; curPlan = batch.rules.foldLeft(curPlan) &#123; case (plan, rule) =&gt; val startTime = System.nanoTime() val result = rule(plan) val runTime = System.nanoTime() - startTime if (!result.fastEquals(plan)) &#123; queryExecutionMetrics.incNumEffectiveExecution(rule.ruleName) queryExecutionMetrics.incTimeEffectiveExecutionBy(rule.ruleName, runTime) logTrace( s\"\"\" |=== Applying Rule $&#123;rule.ruleName&#125; === |$&#123;sideBySide(plan.treeString, result.treeString).mkString(\"\\n\")&#125; \"\"\".stripMargin) &#125; queryExecutionMetrics.incExecutionTimeBy(rule.ruleName, runTime) queryExecutionMetrics.incNumExecution(rule.ruleName) // Run the structural integrity checker against the plan after each rule. if (!isPlanIntegral(result)) &#123; val message = s\"After applying rule $&#123;rule.ruleName&#125; in batch $&#123;batch.name&#125;, \" + \"the structural integrity of the plan is broken.\" throw new TreeNodeException(result, message, null) &#125; result &#125; iteration += 1 if (iteration &gt; batch.strategy.maxIterations) &#123; // Only log if this is a rule that is supposed to run more than once. if (iteration != 2) &#123; val message = s\"Max iterations ($&#123;iteration - 1&#125;) reached for batch $&#123;batch.name&#125;\" if (Utils.isTesting) &#123; throw new TreeNodeException(curPlan, message, null) &#125; else &#123; logWarning(message) &#125; &#125; continue = false &#125; if (curPlan.fastEquals(lastPlan)) &#123; logTrace( s\"Fixed point reached for batch $&#123;batch.name&#125; after $&#123;iteration - 1&#125; iterations.\") continue = false &#125; lastPlan = curPlan &#125; if (!batchStartPlan.fastEquals(curPlan)) &#123; logDebug( s\"\"\" |=== Result of Batch $&#123;batch.name&#125; === |$&#123;sideBySide(batchStartPlan.treeString, curPlan.treeString).mkString(\"\\n\")&#125; \"\"\".stripMargin) &#125; else &#123; logTrace(s\"Batch $&#123;batch.name&#125; has no effect.\") &#125; &#125; curPlan &#125;&#125;æ­¤å‡½æ•°å®ç°äº†é’ˆå¯¹analyzerç±»ä¸­å®šä¹‰çš„æ¯ä¸€ä¸ªbatchï¼ˆç±»åˆ«ï¼‰ï¼ŒæŒ‰ç…§batchä¸­å®šä¹‰çš„fix point(ç­–ç•¥)å’Œruleï¼ˆè§„åˆ™ï¼‰å¯¹Unresolvedçš„é€»è¾‘è®¡åˆ’è¿›è¡Œè§£æã€‚è¿™é‡Œæåˆ°çš„batchï¼Œå¯ä»¥åœ¨ä¸Šé¢çš„class Analyzerä¸­çœ‹åˆ°ï¼Œlazy val batches: Seq[Batch]ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸€ç»„è½¬æ¢è§„åˆ™ã€‚Analyzerä¸­ä½¿ç”¨çš„Rulesï¼Œå…·ä½“çš„Ruleå®ç°æ˜¯é€šè¿‡RuleExecutorå®Œæˆ ,å®šä¹‰äº†batchesï¼Œç”±å¤šä¸ªbatchæ„æˆï¼Œæ¯ä¸ªbatchåˆæœ‰ä¸åŒçš„ruleæ„æˆï¼Œå¦‚Resolutionç”±ResolveReferences ã€ResolveRelationsã€ResolveSortReferences ã€NewRelationInstancesç­‰æ„æˆï¼›æ¯ä¸ªruleåˆæœ‰è‡ªå·±ç›¸å¯¹åº”çš„å¤„ç†å‡½æ•°ï¼Œå¯ä»¥å…·ä½“å‚çœ‹Analyzerä¸­çš„ResolveReferences ã€ResolveRelationsã€ResolveSortReferences ã€NewRelationInstanceså‡½æ•°ï¼›åŒæ—¶è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒçš„ruleåº”ç”¨æ¬¡æ•°æ˜¯ä¸åŒçš„ï¼šå¦‚CaseInsensitiveAttributeReferencesè¿™ä¸ªbatchä¸­ruleåªåº”ç”¨äº†ä¸€æ¬¡ï¼ˆOnceï¼‰ï¼Œè€ŒResolutionè¿™ä¸ªbatchä¸­çš„ruleåº”ç”¨äº†å¤šæ¬¡ï¼ˆfixedPoint = FixedPoint(100)ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¤šåº”ç”¨100æ¬¡ï¼Œé™¤éå‰åè¿­ä»£ç»“æœä¸€è‡´é€€å‡ºï¼‰ã€‚1234567891011121314/** * è¾“å…¥ä¸ºæ—§çš„planï¼Œè¾“å‡ºä¸ºæ–°çš„planï¼Œä»…æ­¤è€Œå·²ã€‚ * æ‰€ä»¥çœŸæ­£çš„é€»è¾‘åœ¨å„ä¸ªç»§æ‰¿å®ç°çš„ruleé‡Œï¼Œanalyzeçš„è¿‡ç¨‹ä¹Ÿå°±æ˜¯æ‰§è¡Œå„ä¸ªruleçš„è¿‡ç¨‹ */abstract class Rule[TreeType &lt;: TreeNode[_]] extends Logging &#123; /** Name for this rule, automatically inferred based on class name. */ val ruleName: String = &#123; val className = getClass.getName if (className endsWith \"$\") className.dropRight(1) else className &#125; def apply(plan: TreeType): TreeType&#125;rule(plan)ï¼Œè¿™é‡Œçš„å‚æ•°planæ˜¯åº”ç”¨rule.applyè½¬åŒ–é‡Œé¢çš„TreeNodeåˆ†æåï¼Œæ¯å¼ è¡¨å¯¹åº”çš„å­—æ®µé›†ï¼Œå­—æ®µç±»å‹ï¼Œæ•°æ®å­˜å‚¨ä½ç½®éƒ½å·²ç¡®å®šã€‚Project ä¸ Filter æ“ä½œçš„å­—æ®µç±»å‹ä»¥åŠåœ¨è¡¨ä¸­çš„ä½ç½®ä¹Ÿå·²ç¡®å®šã€‚æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œå·²ç»å¯ä»¥ç›´æ¥å°†è¯¥ LogicalPlan è½¬æ¢ä¸º Physical Plan è¿›è¡Œæ‰§è¡Œã€‚ä½†æ˜¯ç”±äºä¸åŒç”¨æˆ·æäº¤çš„ SQL è´¨é‡ä¸åŒï¼Œç›´æ¥æ‰§è¡Œä¼šé€ æˆä¸åŒç”¨æˆ·æäº¤çš„è¯­ä¹‰ç›¸åŒçš„ä¸åŒ SQL æ‰§è¡Œæ•ˆç‡å·®è·ç”šè¿œã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœè¦ä¿è¯è¾ƒé«˜çš„æ‰§è¡Œæ•ˆç‡ï¼Œç”¨æˆ·éœ€è¦åšå¤§é‡çš„ SQL ä¼˜åŒ–ï¼Œä½¿ç”¨ä½“éªŒå¤§å¤§é™ä½ã€‚ä¸ºäº†å°½å¯èƒ½ä¿è¯æ— è®ºç”¨æˆ·æ˜¯å¦ç†Ÿæ‚‰ SQL ä¼˜åŒ–ï¼Œæäº¤çš„ SQL è´¨é‡å¦‚ä½•ï¼Œ Spark SQL éƒ½èƒ½ä»¥è¾ƒé«˜æ•ˆç‡æ‰§è¡Œï¼Œè¿˜éœ€åœ¨æ‰§è¡Œå‰è¿›è¡Œ LogicalPlan ä¼˜åŒ–ã€‚Logical Plan -&gt; Optimized Logical Planä½œç”¨ï¼šOptimizerå†é€šè¿‡å„ç§åŸºäºè§„åˆ™çš„ä¼˜åŒ–ç­–ç•¥å¯¹Logical Planè¿›è¡Œæ·±å…¥ä¼˜åŒ–ï¼Œå¾—åˆ°Optimized Logical Planï¼›ä¼˜åŒ–åçš„é€»è¾‘æ‰§è¡Œè®¡åˆ’ä¾ç„¶æ˜¯é€»è¾‘çš„ï¼Œå¹¶ä¸èƒ½è¢«Sparkç³»ç»Ÿç†è§£Optimizerçš„ä¸»è¦èŒè´£æ˜¯å°†Analyzerç»™Resolvedçš„Logical Planæ ¹æ®ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥Batchï¼Œæ¥å¯¹è¯­æ³•æ ‘è¿›è¡Œä¼˜åŒ–ï¼Œä¼˜åŒ–é€»è¾‘è®¡åˆ’èŠ‚ç‚¹(Logical Plan)ä»¥åŠè¡¨è¾¾å¼(Expression)ï¼Œä¹Ÿæ˜¯è½¬æ¢æˆç‰©ç†æ‰§è¡Œè®¡åˆ’çš„å‰ç½®ã€‚å®ƒçš„å·¥ä½œåŸç†å’Œanalyzerä¸€è‡´ï¼Œä¹Ÿæ˜¯é€šè¿‡å…¶ä¸‹çš„batché‡Œé¢çš„Rule[LogicalPlan]æ¥è¿›è¡Œå¤„ç†çš„ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142package org.apache.spark.sql.execution/** * The primary workflow for executing relational queries using Spark. Designed to allow easy * access to the intermediate phases of query execution for developers. * * While this is not a public class, we should avoid changing the function names for the sake of * changing them, because a lot of developers use the feature for debugging. */class QueryExecution(val sparkSession: SparkSession, val logical: LogicalPlan) &#123; // TODO: Move the planner an optimizer into here from SessionState. protected def planner = sparkSession.sessionState.planner def assertAnalyzed(): Unit = analyzed def assertSupported(): Unit = &#123; if (sparkSession.sessionState.conf.isUnsupportedOperationCheckEnabled) &#123; UnsupportedOperationChecker.checkForBatch(analyzed) &#125; &#125; lazy val analyzed: LogicalPlan = &#123; SparkSession.setActiveSession(sparkSession) sparkSession.sessionState.analyzer.executeAndCheck(logical) &#125;// å¦‚æœç¼“å­˜ä¸­æœ‰æŸ¥è¯¢ç»“æœï¼Œåˆ™ç›´æ¥æ›¿æ¢ä¸ºç¼“å­˜çš„ç»“æœï¼Œé€»è¾‘ä¸å¤æ‚ï¼Œè¿™é‡Œä¸å†å±•å¼€è®²äº†ã€‚ lazy val withCachedData: LogicalPlan = &#123; assertAnalyzed() assertSupported() sparkSession.sharedState.cacheManager.useCachedData(analyzed) &#125;// å¯¹Logical Plan ä¼˜åŒ– lazy val optimizedPlan: LogicalPlan = sparkSession.sessionState.optimizer.execute(withCachedData) lazy val sparkPlan: SparkPlan = &#123; SparkSession.setActiveSession(sparkSession) // TODO: We use next(), i.e. take the first plan returned by the planner, here for now, // but we will implement to choose the best plan. planner.plan(ReturnAnswer(optimizedPlan)).next() &#125;.......çœ‹åˆ°Optimizerä¹Ÿæ˜¯ç»§æ‰¿è‡ªRuleExecutorï¼Œå’ŒAnalyzerä¸€ä¸ªå¥—è·¯ï¼Œä¹Ÿæ˜¯éå†treeï¼Œå¹¶å¯¹æ¯ä¸ªèŠ‚ç‚¹åº”ç”¨ruleã€‚Optimizeré‡Œçš„batchesåŒ…å«äº†3ç±»ä¼˜åŒ–ç­–ç•¥ï¼š1ã€Combine Limits åˆå¹¶Limits 2ã€ConstantFolding å¸¸é‡åˆå¹¶ 3ã€Filter Pushdown è¿‡æ»¤å™¨ä¸‹æ¨,æ¯ä¸ªBatché‡Œå®šä¹‰çš„ä¼˜åŒ–ä¼´éšå¯¹è±¡éƒ½å®šä¹‰åœ¨Optimizeré‡Œäº†ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127package org.apache.spark.sql.catalyst.optimizer/** * Abstract class all optimizers should inherit of, contains the standard batches (extending * Optimizers can override this. */abstract class Optimizer(sessionCatalog: SessionCatalog) extends RuleExecutor[LogicalPlan] &#123; // Check for structural integrity of the plan in test mode. Currently we only check if a plan is // still resolved after the execution of each rule. override protected def isPlanIntegral(plan: LogicalPlan): Boolean = &#123; !Utils.isTesting || plan.resolved &#125; protected def fixedPoint = FixedPoint(SQLConf.get.optimizerMaxIterations) def batches: Seq[Batch] = &#123; val operatorOptimizationRuleSet = Seq( // Operator push down PushProjectionThroughUnion, ReorderJoin, EliminateOuterJoin, PushPredicateThroughJoin, PushDownPredicate, LimitPushDown, ColumnPruning, InferFiltersFromConstraints, // Operator combine CollapseRepartition, CollapseProject, CollapseWindow, CombineFilters, CombineLimits, CombineUnions, // Constant folding and strength reduction NullPropagation, ConstantPropagation, FoldablePropagation, OptimizeIn, ConstantFolding, ReorderAssociativeOperator, LikeSimplification, BooleanSimplification, SimplifyConditionals, RemoveDispensableExpressions, SimplifyBinaryComparison, PruneFilters, EliminateSorts, SimplifyCasts, SimplifyCaseConversionExpressions, RewriteCorrelatedScalarSubquery, EliminateSerialization, RemoveRedundantAliases, RemoveRedundantProject, SimplifyCreateStructOps, SimplifyCreateArrayOps, SimplifyCreateMapOps, CombineConcats) ++ extendedOperatorOptimizationRules val operatorOptimizationBatch: Seq[Batch] = &#123; val rulesWithoutInferFiltersFromConstraints = operatorOptimizationRuleSet.filterNot(_ == InferFiltersFromConstraints) Batch(\"Operator Optimization before Inferring Filters\", fixedPoint, rulesWithoutInferFiltersFromConstraints: _*) :: Batch(\"Infer Filters\", Once, InferFiltersFromConstraints) :: Batch(\"Operator Optimization after Inferring Filters\", fixedPoint, rulesWithoutInferFiltersFromConstraints: _*) :: Nil &#125; (Batch(\"Eliminate Distinct\", Once, EliminateDistinct) :: // Technically some of the rules in Finish Analysis are not optimizer rules and belong more // in the analyzer, because they are needed for correctness (e.g. ComputeCurrentTime). // However, because we also use the analyzer to canonicalized queries (for view definition), // we do not eliminate subqueries or compute current time in the analyzer. Batch(\"Finish Analysis\", Once, EliminateSubqueryAliases, EliminateView, ReplaceExpressions, ComputeCurrentTime, GetCurrentDatabase(sessionCatalog), RewriteDistinctAggregates, ReplaceDeduplicateWithAggregate) :: ////////////////////////////////////////////////////////////////////////////////////////// // Optimizer rules start here ////////////////////////////////////////////////////////////////////////////////////////// // - Do the first call of CombineUnions before starting the major Optimizer rules, // since it can reduce the number of iteration and the other rules could add/move // extra operators between two adjacent Union operators. // - Call CombineUnions again in Batch(\"Operator Optimizations\"), // since the other rules might make two separate Unions operators adjacent. Batch(\"Union\", Once, CombineUnions) :: Batch(\"Pullup Correlated Expressions\", Once, PullupCorrelatedPredicates) :: Batch(\"Subquery\", Once, OptimizeSubqueries) :: Batch(\"Replace Operators\", fixedPoint, ReplaceIntersectWithSemiJoin, ReplaceExceptWithFilter, ReplaceExceptWithAntiJoin, ReplaceDistinctWithAggregate) :: Batch(\"Aggregate\", fixedPoint, RemoveLiteralFromGroupExpressions, RemoveRepetitionFromGroupExpressions) :: Nil ++ operatorOptimizationBatch) :+ Batch(\"Join Reorder\", Once, CostBasedJoinReorder) :+ Batch(\"Decimal Optimizations\", fixedPoint, DecimalAggregates) :+ Batch(\"Object Expressions Optimization\", fixedPoint, EliminateMapObjects, CombineTypedFilters) :+ Batch(\"LocalRelation\", fixedPoint, ConvertToLocalRelation, PropagateEmptyRelation) :+ // The following batch should be executed after batch \"Join Reorder\" and \"LocalRelation\". Batch(\"Check Cartesian Products\", Once, CheckCartesianProducts) :+ Batch(\"RewriteSubquery\", Once, RewritePredicateSubquery, ColumnPruning, CollapseProject, RemoveRedundantProject) &#125;Optimizerçš„ä¼˜åŒ–ç­–ç•¥ä¸ä»…æœ‰å¯¹planè¿›è¡Œtransformçš„ï¼Œä¹Ÿæœ‰å¯¹expressionè¿›è¡Œtransformçš„ï¼Œç©¶å…¶åŸç†å°±æ˜¯éå†æ ‘ï¼Œç„¶ååº”ç”¨ä¼˜åŒ–çš„Ruleï¼Œä½†æ˜¯æ³¨æ„ä¸€ç‚¹ï¼Œå¯¹Logical Plantransfromçš„æ˜¯å…ˆåºéå†(pre-order)ï¼Œè€Œå¯¹Expression transfromçš„æ—¶å€™æ˜¯ååºéå†(post-order)ï¼šbatchçš„æ‰§è¡Œå’Œanalyzerä¸€æ ·æ˜¯é€šè¿‡RuleExecutorçš„executeæ–¹æ³•ä¾æ¬¡éå†ï¼Œè¿™é‡Œä¸å†è§£æCatalystä»¥ä¸Šçš„ä¸‰ä¸ªè¿‡ç¨‹éƒ½æ˜¯å±äºCatalysté˜¶æ®µï¼ŒSQLè¯­å¥é¦–å…ˆé€šè¿‡Parseræ¨¡å—è¢«è§£æä¸ºè¯­æ³•æ ‘ï¼Œæ­¤æ£µæ ‘ç§°ä¸ºUnresolved Logical Planï¼›Unresolved Logical Plané€šè¿‡Analyzeræ¨¡å—å€ŸåŠ©äºCatalogä¸­çš„è¡¨ä¿¡æ¯è§£æä¸ºLogical Planï¼›æ­¤æ—¶ï¼ŒOptimizerå†é€šè¿‡å„ç§åŸºäºè§„åˆ™çš„ä¼˜åŒ–ç­–ç•¥è¿›è¡Œæ·±å…¥ä¼˜åŒ–ï¼Œå¾—åˆ°Optimized Logical Planï¼›ä¼˜åŒ–åçš„é€»è¾‘æ‰§è¡Œè®¡åˆ’ä¾ç„¶æ˜¯é€»è¾‘çš„ï¼Œå¹¶ä¸èƒ½è¢«Sparkç³»ç»Ÿç†è§£ï¼Œæ­¤æ—¶éœ€è¦å°†æ­¤é€»è¾‘æ‰§è¡Œè®¡åˆ’è½¬æ¢ä¸ºPhysical Planã€‚Physical Planä»Optimizer LogicalPlanä¼ å…¥SparkSQLç‰©ç†è®¡åˆ’ï¼Œå¹¶æäº¤ï¼Œæ•´ä¸ªPhysicalPlanç»å†äº†ä¸‰ä¸ªé˜¶æ®µè½¬æ¢ä¸ºIterator[PhysicalPlan]SparkPlanPrepared SparkPlanSparkPlanneræŠŠOptimizer LogicalPlanè½¬æ¢ä¸ºPhysicalPlanåˆ—è¡¨ã€‚SparkPlannerä¸»è¦æ˜¯é€šè¿‡ç‰©ç†è®¡åˆ’ç­–ç•¥ï¼ˆStrategyï¼‰ä½œç”¨äºOptimizer LogicalPlanä¸Šï¼Œä»è€Œç”ŸæˆSparkPlanåˆ—è¡¨å³Iterator[PhysicalPlan]ï¼Œæ­¤æ—¶çš„ä¸€ä¸ªOptimizer LogicalPlanä¼šå¯¹åº”å¤šä¸ªSparkPlanã€‚åœ¨Iterator[PhysicalPlan]ä¸­é€‰å–ä¸€ä¸ªæœ€ä½³çš„SparkPlanSparkPlané€šè¿‡ prepareForExecutionæ–¹æ³•è°ƒç”¨è‹¥å¹²è§„åˆ™ï¼ˆ Rule ï¼‰è¿›è¡Œè½¬æ¢ä¸ºPrepared SparkPlanä¸ºèƒ½åœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šæ­£ç¡®æ‰§è¡Œã€‚Spark SQLä¸­æœ‰å¤šäº65ç§ä»¥ä¸Šçš„SparkPlanå®ç°ï¼Œæ¶‰åŠåˆ°æ•°æ®æºRDDçš„åˆ›å»ºå’Œå„ç§æ•°æ®å¤„ç†ç­‰ã€‚12345678910111213141516171819202122232425262728293031323334353637package org.apache.spark.sql.executionlazy val optimizedPlan: LogicalPlan = sparkSession.sessionState.optimizer.execute(withCachedData) lazy val sparkPlan: SparkPlan = &#123; SparkSession.setActiveSession(sparkSession) // TODO: We use next(), i.e. take the first plan returned by the planner, here for now, // but we will implement to choose the best plan. planner.plan(ReturnAnswer(optimizedPlan)).next() &#125; // executedPlan should not be used to initialize any SparkPlan. It should be // only used for execution. lazy val executedPlan: SparkPlan = prepareForExecution(sparkPlan) /** Internal version of the RDD. Avoids copies and has no schema */ lazy val toRdd: RDD[InternalRow] = executedPlan.execute() /** * Prepares a planned [[SparkPlan]] for execution by inserting shuffle operations and internal * row format conversions as needed. */ protected def prepareForExecution(plan: SparkPlan): SparkPlan = &#123; preparations.foldLeft(plan) &#123; case (sp, rule) =&gt; rule.apply(sp) &#125; &#125; /** A sequence of rules that will be applied in order to the physical plan before execution. */ protected def preparations: Seq[Rule[SparkPlan]] = Seq( python.ExtractPythonUDFs, PlanSubqueries(sparkSession), EnsureRequirements(sparkSession.sessionState.conf), CollapseCodegenStages(sparkSession.sessionState.conf), ReuseExchange(sparkSession.sessionState.conf), ReuseSubquery(sparkSession.sessionState.conf))......ä¸€æ¡SQLç»å†äº†Parserï¼ŒAnalyzedï¼ŒOptimizerä¹‹åå†è½¬æ¢ä¸ºæœ€ç»ˆèƒ½åœ¨Sparkæ¡†æ¶ä¸­å®é™…æ‰§è¡Œçš„SparkPlançš„ç‰©ç†ç®—å­æ ‘ã€‚ç‰©ç†ç®—å­æ ‘ä¸­ï¼Œå¶å­ç±»å‹SparkPlanæ˜¯åˆ›å»ºä¸€ä¸ªRDDå¼€å§‹ï¼Œè€Œå¾€ä¸Šéå†Treeè¿‡ç¨‹ä¸­æ¯ä¸ªéå¶å­èŠ‚ç‚¹åšä¸€æ¬¡Transformationï¼Œé€šè¿‡executeå‡½æ•°è½¬æ¢æˆæ–°çš„RDDï¼Œæœ€ç»ˆä¼šæ‰§è¡ŒActionç®—å­æŠŠç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚SparkPlané™¤äº†ç»™RDDåšTransformationçš„æ“ä½œä¹‹å¤–ï¼Œè¿˜åšåˆ†åŒºï¼Œæ’åºï¼›åŒæ—¶é™¤äº†æ‰§è¡Œexecuteæ–¹æ³•ä¹‹å¤–ï¼Œè¿˜ä¼šæ‰§è¡ŒexecuteBroadcaseæ–¹æ³•ï¼Œå°†æ•°æ®ç›´æ¥å¹¿æ’­åˆ°é›†ç¾¤ä¸Šã€‚SparkPlanåˆ†ä¸ºä¸‰å¤§å—ï¼š1ï¼Œæ¯ä¸ªSparkPlanéƒ½ä¼šè®°ä½å…¶å…ƒæ•°æ®(Metadata)ä¸æŒ‡æ ‡(Metric)çš„ä¿¡æ¯ã€‚2ï¼ŒRDDåšTransformationæ“ä½œæ—¶å€™è¿˜åŒæ—¶åšäº†åˆ†åŒºå’Œæ’åº3ï¼Œæœ€åSparkPlanä½œä¸ºç‰©ç†è®¡åˆ’æäº¤åˆ°Sparké›†ç¾¤ä¸­æ‰§è¡Œï¼Œå…¶ä¸­ä»¥executeä¸ºä¸»ï¼ŒexecuteBroadcastä¸ºè¾…ã€‚è‡³æ­¤ï¼Œå°†ç”¨æˆ·ç¨‹åºä¸­çš„SQL/Dataset/DataFrameç»è¿‡ä¸€ç³»åˆ—æ“ä½œï¼Œæœ€ç»ˆè½¬åŒ–ä¸ºSparkç³»ç»Ÿä¸­æ‰§è¡Œçš„RDDã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"Spark SQL å…¥é—¨","slug":"Spark-SQL-å…¥é—¨","date":"2017-03-25T15:48:43.000Z","updated":"2020-04-22T04:19:49.614Z","comments":true,"path":"2017/03/25/Spark-SQL-å…¥é—¨/","link":"","permalink":"cpeixin.cn/2017/03/25/Spark-SQL-%E5%85%A5%E9%97%A8/","excerpt":"","text":"ç¨‹åºèµ·ç‚¹åœ¨Spark2.0ä¹‹å‰ï¼Œ Sparkç¨‹åºå¿…é¡»åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯åˆ›å»ºä¸€ä¸ªSparkContextå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å‘Šè¯‰Sparkå¦‚ä½•è®¿é—®é›†ç¾¤ã€‚è¦åˆ›å»ºä¸€ä¸ªSparkContextæ‚¨é¦–å…ˆéœ€è¦æ„å»ºä¸€ä¸ªSparkConfå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³æ‚¨çš„åº”ç”¨ç¨‹åºçš„ä¿¡æ¯ã€‚æ¯ä¸ªJVMåªèƒ½æ¿€æ´»ä¸€ä¸ªSparkContextã€‚12345val sparkConf: SparkConf = new SparkConf() .setAppName(\"transformation_func\") .setMaster(\"local\")val sc = new SparkContext(sparkConf)åœ¨Spark2.0ä¹‹åï¼Œ SparkSessionç±»æ˜¯Sparkä¸­æ‰€æœ‰åŠŸèƒ½çš„å…¥å£ç‚¹ã€‚ä¸ºäº†å¼•å…¥dataframeå’Œdatasetçš„APIï¼Œè¦åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„SparkSessionï¼Œåªéœ€ä½¿ç”¨SparkSession.builder()ã€‚SparkConfã€SparkContextå’ŒSQLContextéƒ½å·²ç»è¢«å°è£…åœ¨SparkSessionå½“ä¸­ï¼Œä¸éœ€è¦æ˜¾ç¤ºçš„åˆ›å»ºã€‚å¹¶ä¸”æä¾›äº†å¯¹HiveåŠŸèƒ½çš„å†…ç½®æ”¯æŒï¼Œä¸‹å›¾æ˜¯SparkSessionçš„æºç å®šä¹‰ï¼šSparkSessionåˆ›å»º**12345678910import org.apache.spark.sql.SparkSessionval spark = SparkSession .builder() .appName(\"Spark SQL basic example\") .config(\"spark.some.config.option\", \"some-value\") .getOrCreate()// For implicit conversions like converting RDDs to DataFramesimport spark.implicits._åˆ›å»ºDataFrameä½¿ç”¨SparkSessionï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä»ç°æœ‰çš„RDDï¼ŒHiveè¡¨çš„æˆ–Sparkæ•°æ®æºåˆ›å»ºDataFrame ã€‚åŸºäºRDDè½¬åŒ–DataFrameï¼š1234567891011121314151617181920212223package readimport org.apache.spark.rdd.RDDimport org.apache.spark.sql.&#123;DataFrame, SparkSession&#125;object sparksql_rdd &#123; case class Person(user_name: String, sex: String) def main(args: Array[String]): Unit = &#123; val spark: SparkSession = SparkSession .builder() .appName(\"function_case\") .master(\"local\") .getOrCreate() val rdd_ss: RDD[(String, String)] = spark.sparkContext.makeRDD(List((\"brent\",\"male\"),(\"haylee\",\"female\"),(\"vicky\",\"male\"))) import spark.implicits._ val df2: DataFrame = rdd_ss.map((x: (String, String)) =&gt;&#123;Person(x._1,x._2)&#125;).toDF() &#125;&#125;åŸºäºJSONæ–‡ä»¶çš„å†…å®¹åˆ›å»ºä¸€ä¸ªDataFrameï¼š1234567891011121314151617package spark_sqlimport org.apache.spark.sql.&#123;DataFrame, SparkSession&#125;object sparksql_1 &#123; def main(args: Array[String]): Unit =&#123; val spark: SparkSession = SparkSession .builder() .appName(\"sql_case\") .master(\"local\") .getOrCreate() val df_json: DataFrame = spark.read.json(\"hdfs://localhost:8020/data/user_data.json\") df_json.show(5) &#125;&#125;åŸºäºHiveè¡¨å†…å®¹åˆ›å»ºä¸€ä¸ªDataFrameï¼š12345678910111213141516171819package spark_sqlimport org.apache.spark.sql.&#123;DataFrame, SparkSession&#125;object sparksql_hive &#123; def main(args: Array[String]): Unit = &#123; val warehouseLocation=\"hdfs://localhost:8020/user/hive/warehouse\" val spark: SparkSession = SparkSession .builder() .appName(\"sql_case\") .master(\"local\") .config(\"spark.sql.warehouse.dir\",warehouseLocation) .enableHiveSupport() .getOrCreate() val df_databases: DataFrame = spark.sql(\"show databases\") df_databases.show() &#125;&#125;æ³¨æ„ï¼š Sparkè¯»å–Hiveæ˜¯éœ€è¦ä¸¤ä¸‰ä¸ªæ­¥éª¤çš„å¦‚æœä½ æ˜¯åœ¨é›†ç¾¤ä¸Šè¿è¡Œï¼Œéœ€è¦æ³¨æ„ï¼Œè¦å°†hive-site.xmlå¤åˆ¶ä¸€ä»½åˆ°sparkç›®å½•ä¸‹çš„confæ–‡ä»¶å¤¹ä¸­ï¼Œå¦‚æœä½ æ˜¯åœ¨æœ¬åœ°è¿æ¥é›†ç¾¤ä¸­çš„Hiveï¼Œé‚£ä¹ˆè¯·å°†hive-site.xmlå¤åˆ¶ä¸€ä»½åˆ°ä½ IDEAä¸­ï¼Œresourcesç›®å½•ä¸‹ã€‚å¦‚æœä½ æ˜¯åœ¨é›†ç¾¤ä¸Šè¿è¡Œï¼Œéœ€è¦æ³¨æ„ï¼Œè¦å°†mysql-connector-java-8.0.19.jarå¤åˆ¶ä¸€ä»½åˆ°sparkç›®å½•ä¸‹çš„jarsæ–‡ä»¶å¤¹ä¸­ï¼Œå¦‚æœä½ æ˜¯åœ¨æœ¬åœ°è¿æ¥é›†ç¾¤ä¸­çš„Hiveï¼Œé‚£ä¹ˆè¯·åœ¨pomæ–‡ä»¶ä¸­ä¸è¦å¿˜è®°å¼•å…¥mysql-connector-javaåœ¨æœ¬åœ°è¿è¡Œï¼Œå¯èƒ½ä¼šé‡åˆ°/tmp/hiveçš„æƒé™é—®é¢˜ï¼Œè¯·ç”¨chmodä¿®æ”¹/tmpæƒé™ä¸º777**åŸºäºHBaseå†…å®¹åˆ›å»ºä¸€ä¸ªDataFrameï¼š**1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package spark_sqlimport org.apache.spark.sql.&#123;DataFrame, SparkSession&#125;import org.apache.spark.sql.execution.datasources.hbase.HBaseTableCatalogimport scala.collection.immutableobject sparksql_hbase &#123; def main(args: Array[String]): Unit = &#123; case class Record(col0: Int, col1: Int, col2: Boolean) val spark: SparkSession = SparkSession .builder() .appName(\"Spark HBase Example\") .master(\"local[4]\") .getOrCreate() def catalog: String = // è¿™é‡Œï¼Œæˆ‘ä»¬åœ¨è¯»å–æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œæ— è®ºä»€ä¹ˆç±»å‹çš„æ•°æ®ï¼Œtypeå­—æ®µç»Ÿä¸€æŒ‡å®šæˆ string å³å¯ã€‚å¦åˆ™è¯»å–æŠ¥é”™ s\"\"\"&#123; |\"table\":&#123;\"namespace\":\"default\", \"name\":\"t_user\"&#125;, |\"rowkey\":\"key\", |\"columns\":&#123; |\"col0\":&#123;\"cf\":\"rowkey\", \"col\":\"key\", \"type\":\"string\"&#125;, |\"col1\":&#123;\"cf\":\"cf1\", \"col\":\"user_name\", \"type\":\"string\"&#125;, |\"col2\":&#123;\"cf\":\"cf1\", \"col\":\"customer_id\", \"type\":\"string\"&#125;, |\"col3\":&#123;\"cf\":\"cf1\", \"col\":\"age\", \"type\":\"string\"&#125;, |\"col4\":&#123;\"cf\":\"cf1\", \"col\":\"birthday\", \"type\":\"string\"&#125;, |\"col5\":&#123;\"cf\":\"cf1\", \"col\":\"deposit_amount\", \"type\":\"string\"&#125;, |\"col6\":&#123;\"cf\":\"cf1\", \"col\":\"last_login_time\", \"type\":\"string\"&#125;, |\"col7\":&#123;\"cf\":\"cf1\", \"col\":\"flag\", \"type\":\"string\"&#125; |&#125; |&#125;\"\"\".stripMargin // read val df: DataFrame = spark .read .option(HBaseTableCatalog.tableCatalog, catalog) .format(\"org.apache.spark.sql.execution.datasources.hbase\") .load() df.show() &#125;&#125;æ³¨æ„ï¼šå¦‚æœæˆ‘ä»¬å¯¹äºè¯»å–å’Œå†™å…¥HBaseçš„åœºæ™¯å¾ˆé¢‘ç¹çš„è¯ï¼Œå°±éœ€è¦è€ƒè™‘æ€§èƒ½çš„é—®é¢˜ï¼Œå†…ç½®çš„è¯»å–æ•°æ®æºæ˜¯ä½¿ç”¨äº† TableInputFormat æ¥è¯»å– HBase ä¸­çš„æ•°æ®ã€‚è¿™ä¸ª TableInputFormat æœ‰ä¸€äº›ç¼ºç‚¹ï¼šä¸€ä¸ª Task é‡Œé¢åªèƒ½å¯åŠ¨ä¸€ä¸ª Scan å» HBase ä¸­è¯»å–æ•°æ®ï¼›TableInputFormat ä¸­ä¸æ”¯æŒ BulkGetï¼›ä¸èƒ½äº«å—åˆ° Spark SQL å†…ç½®çš„ catalyst å¼•æ“çš„ä¼˜åŒ–ã€‚åŸºäºè¿™äº›é—®é¢˜ï¼Œæ¥è‡ª Hortonworks çš„å·¥ç¨‹å¸ˆä»¬ä¸ºæˆ‘ä»¬å¸¦æ¥äº†å…¨æ–°çš„ Apache Sparkâ€”Apache HBase Connectorï¼Œä¸‹é¢ç®€ç§° SHCã€‚é€šè¿‡è¿™ä¸ªç±»åº“ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ Spark SQL å°† DataFrame ä¸­çš„æ•°æ®å†™å…¥åˆ° HBase ä¸­ï¼›è€Œä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ Spark SQL å»æŸ¥è¯¢ HBase ä¸­çš„æ•°æ®ï¼Œåœ¨æŸ¥è¯¢ HBase çš„æ—¶å€™å……åˆ†åˆ©ç”¨äº† catalyst å¼•æ“åšäº†è®¸å¤šä¼˜åŒ–ï¼Œæ¯”å¦‚åˆ†åŒºä¿®å‰ªï¼ˆpartition pruningï¼‰ï¼Œåˆ—ä¿®å‰ªï¼ˆcolumn pruningï¼‰ï¼Œè°“è¯ä¸‹æ¨ï¼ˆpredicate pushdownï¼‰å’Œæ•°æ®æœ¬åœ°æ€§ï¼ˆdata localityï¼‰ç­‰ç­‰ã€‚å› ä¸ºæœ‰äº†è¿™äº›ä¼˜åŒ–ï¼Œé€šè¿‡ Spark æŸ¥è¯¢ HBase çš„é€Ÿåº¦æœ‰äº†å¾ˆå¤§çš„æå‡ã€‚ä½†æ˜¯å¯¹äºä½¿ç”¨SHCï¼Œç›®å‰è¿˜æ˜¯æœ‰äº›éº»çƒ¦çš„ï¼Œç½‘ä¸Šçš„mavenä¾èµ–å¯èƒ½æ˜¯å› ä¸ºç‰ˆæœ¬çš„åŸå› ï¼Œç¨‹åºå¼•å…¥æ‰¾ä¸åˆ°org.apache.spark.sql.execution.datasources.hbase.HBaseTableCatalogç±»ï¼Œè¿™é‡Œæ¨èè‡ªå·±ä¸‹è½½æºç ï¼Œè¿›è¡Œç¼–è¯‘æˆjaræ–‡ä»¶æˆ–è€…ç¼–è¯‘åä¸Šä¼ åˆ°è‡ªå·±çš„mavenåº“ä¸­è¿›è¡Œä½¿ç”¨ä¸‹è½½æºç  https://github.com/hortonworks-spark/shcï¼Œé€‰æ‹©ç›¸åº”ä½äºæˆ–è€…ç­‰äºsparkï¼Œhbaseçš„ç‰ˆæœ¬æœ¬åœ°ä¸­æ‰“å¼€ï¼Œç‚¹å‡»ç¨‹åºæ ¹ç›®å½•ä¸‹çš„pomæ–‡ä»¶ï¼Œæ³¨é‡Šæ‰distributionManagementï¼Œç›´æ¥ç‚¹å‡»installï¼Œå°†jaråŒ…ç”Ÿæˆåˆ°ä½ æœ¬åœ°çš„mavenåº“ä¸­ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸Šä¼ åˆ°ä½ è¿œç¨‹çš„ç§æœ‰Maven åº“ä¸­ã€‚pomæ–‡ä»¶ä¸­ï¼Œå¼•å…¥ä¸‹é¢ä¾èµ–ï¼Œå°±å¯ä»¥ä½¿ç”¨äº†ï¼ˆæ³¨æ„ version ç‰ˆæœ¬å·ï¼‰12345&lt;dependency&gt; &lt;groupId&gt;com.hortonworks&lt;/groupId&gt; &lt;artifactId&gt;shc-core&lt;/artifactId&gt; &lt;version&gt;1.1.2-2.2-s_2.11&lt;/version&gt;&lt;/dependency&gt;DataFrameæ“ä½œä¸Šç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®²åˆ°DataFrameæ¯ä¸€åˆ—å¹¶ä¸å­˜å‚¨ç±»å‹ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æ—¶å¹¶ä¸èƒ½å‘ç°ç±»å‹é”™è¯¯ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å«åš** æ— ç±»å‹çš„æ•°æ®é›†æ“ä½œã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270package functionimport org.apache.spark.rdd.RDDimport org.apache.spark.sql.types.&#123;StringType, StructField, StructType&#125;import org.apache.spark.sql.&#123;DataFrame, Row, SparkSession&#125;object sparksql_function &#123; def main(args: Array[String]): Unit =&#123; val spark: SparkSession = SparkSession .builder() .appName(\"function_case\") .master(\"local\") .config(\"spark.sql.crossJoin.enabled\", \"true\") .getOrCreate() // æ ·ä¾‹æ•°æ® /** * &#123;\"user_name\":\"brent\",\"customer_id\":12031602,\"age\": 22,\"birthday\":\"1993-04-05\",\"deposit_amount\":3000,\"last_login_time\":\"2017-03-10 14:55:22\"&#125; &#123;\"user_name\":\"haylee\",\"customer_id\":12031603,\"age\":23,\"birthday\":\"1992-08-10\",\"deposit_amount\":4000.56,\"last_login_time\":\"2017-03-11 10:55:00\"&#125; &#123;\"user_name\":\"vicky\",\"customer_id\":12031604,\"age\":30,\"birthday\":\"2000-03-02\",\"deposit_amount\":200.4,\"last_login_time\":\"2017-03-10 09:10:00\"&#125; */ val df: DataFrame = spark.read.json(\"hdfs://localhost:8020/data/user_data.json\") val rdd_row: RDD[Row] = spark.sparkContext .makeRDD(List((\"brent\", \"male\"), (\"haylee\", \"female\"), (\"vicky\", \"male\"))) .map((x: (String, String)) =&gt; Row(x._1, x._2)) // The schema is encoded in a string val schemaString = \"user_name sex\" // Generate the schema based on the string of schema val fields: Array[StructField] = schemaString.split(\" \") .map((fieldName: String) =&gt; StructField(fieldName, StringType, nullable = true)) val schema = StructType(fields) val df2: DataFrame = spark.createDataFrame(rdd_row, schema) show_get_data(spark, df) map_data(spark, df) filter_data(spark, df) sort_data(spark, df) groupBy_data(spark, df) join_data(spark, df, df2) intersect_data(spark, df, df2) withColumn_rename_dataframe(spark, df) &#125; def show_get_data(spark: SparkSession, df: DataFrame): Unit = &#123; df.printSchema() // root // |-- age: long (nullable = true) // |-- birthday: string (nullable = true) // |-- customer_id: long (nullable = true) // |-- deposit_amount: double (nullable = true) // |-- last_login_time: string (nullable = true) // |-- user_name: string (nullable = true) df.show(5) //é»˜è®¤æ‰“å°å‰20æ¡ç»“æœ // +---+----------+-----------+--------------+-------------------+---------+ // |age| birthday|customer_id|deposit_amount| last_login_time|user_name| // +---+----------+-----------+--------------+-------------------+---------+ // | 22|1993-04-05| 12031602| 3000.0|2017-03-10 14:55:22| brent| // | 23|1992-08-10| 12031603| 4000.56|2017-03-11 10:55:00| haylee| // | 30|2000-03-02| 12031604| 200.4|2017-03-10 09:10:00| vicky| // +---+----------+-----------+--------------+-------------------+---------+ // Select only the \"name\" column // è¿™ä¸ªè¡¨è¾¾å¼ä¸èƒ½è¿›è¡Œè®¡ç®—æ“ä½œ df.select(\"user_name\", \"age\").show() // +---------+ // |user_name| // +---------+ // | brent| // | haylee| // | vicky| // +---------+ // Select everybody, but increment the age by 1 // This import is needed to use the $-notation import spark.implicits._ df.select($\"user_name\", $\"age\" + 1 as \"new_age\").show() // +---------+-------+ // |user_name|new_age| // +---------+-------+ // | brent| 23| // | haylee| 24| // | vicky| 31| // +---------+-------+ import org.apache.spark.sql.functions._ df.select(col(\"customer_id\"), col(\"deposit_amount\")).show() df.limit(5).show() df.describe() &#125; def map_data(spark: SparkSession, df: DataFrame): Unit = &#123; import spark.implicits._ // æ³¨æ„ è¿™é‡Œæ˜¯Rowç±»å‹ df.map((x: Row) =&gt; &#123;\"name: \"+x.getAs[String](\"user_name\")&#125;).show() &#125; def filter_data(spark: SparkSession, df: DataFrame): Unit = &#123; import spark.implicits._ // å–ç­‰äºæ—¶å¿…é¡»ç”¨=== df.filter($\"user_name\" === \"brent\").show()// +---+----------+-----------+--------------+-------------------+---------+// |age| birthday|customer_id|deposit_amount| last_login_time|user_name|// +---+----------+-----------+--------------+-------------------+---------+// | 22|1993-04-05| 12031602| 3000.0|2017-03-10 14:55:22| brent|// +---+----------+-----------+--------------+-------------------+---------+ df.filter($\"age\" &gt; 25).show()// +---+----------+-----------+--------------+-------------------+---------+// |age| birthday|customer_id|deposit_amount| last_login_time|user_name|// +---+----------+-----------+--------------+-------------------+---------+// | 30|2000-03-02| 12031604| 200.4|2017-03-10 09:10:00| vicky|// +---+----------+-----------+--------------+-------------------+---------+ df.filter(\"deposit_amount = 3000.0\").show() df.filter($\"deposit_amount\" &gt; 200 and $\"age\" &lt; 25).show()// +---+----------+-----------+--------------+-------------------+---------+// |age| birthday|customer_id|deposit_amount| last_login_time|user_name|// +---+----------+-----------+--------------+-------------------+---------+// | 22|1993-04-05| 12031602| 3000.0|2017-03-10 14:55:22| brent|// | 23|1992-08-10| 12031603| 4000.56|2017-03-11 10:55:00| haylee|// +---+----------+-----------+--------------+-------------------+---------+ df.filter(\"substring(user_name,0,1) = 'h'\").show()// +---+----------+-----------+--------------+-------------------+---------+// |age| birthday|customer_id|deposit_amount| last_login_time|user_name|// +---+----------+-----------+--------------+-------------------+---------+// | 23|1992-08-10| 12031603| 4000.56|2017-03-11 10:55:00| haylee|// +---+----------+-----------+--------------+-------------------+---------+// åœ¨æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œwhereç®—å­ï¼Œåº•å±‚æ˜¯filterå®ç°çš„ã€‚ import org.apache.spark.sql.functions._ df.where(col(\"age\") &gt; 23).show()// +---+----------+-----------+--------------+-------------------+---------+// |age| birthday|customer_id|deposit_amount| last_login_time|user_name|// +---+----------+-----------+--------------+-------------------+---------+// | 30|2000-03-02| 12031604| 200.4|2017-03-10 09:10:00| vicky|// +---+----------+-----------+--------------+-------------------+---------+ df.where(\"age&gt; 23\").show()// +---+----------+-----------+--------------+-------------------+---------+// |age| birthday|customer_id|deposit_amount| last_login_time|user_name|// +---+----------+-----------+--------------+-------------------+---------+// | 30|2000-03-02| 12031604| 200.4|2017-03-10 09:10:00| vicky|// +---+----------+-----------+--------------+-------------------+---------+ &#125; def sort_data(spark: SparkSession, df: DataFrame): Unit = &#123; import spark.implicits._ df.sort($\"age\".desc).show()// +---+----------+-----------+--------------+-------------------+---------+// |age| birthday|customer_id|deposit_amount| last_login_time|user_name|// +---+----------+-----------+--------------+-------------------+---------+// | 30|2000-03-02| 12031604| 200.4|2017-03-10 09:10:00| vicky|// | 23|1992-08-10| 12031603| 4000.56|2017-03-11 10:55:00| haylee|// | 22|1993-04-05| 12031602| 3000.0|2017-03-10 14:55:22| brent|// +---+----------+-----------+--------------+-------------------+---------+ df.sort($\"age\".asc).show()// +---+----------+-----------+--------------+-------------------+---------+// |age| birthday|customer_id|deposit_amount| last_login_time|user_name|// +---+----------+-----------+--------------+-------------------+---------+// | 22|1993-04-05| 12031602| 3000.0|2017-03-10 14:55:22| brent|// | 23|1992-08-10| 12031603| 4000.56|2017-03-11 10:55:00| haylee|// | 30|2000-03-02| 12031604| 200.4|2017-03-10 09:10:00| vicky|// +---+----------+-----------+--------------+-------------------+---------+ // åªèƒ½å¯¹æ•°å­—ç±»å‹å’Œæ—¥æœŸç±»å‹ç”Ÿæ•ˆ df.orderBy($\"age\") df.orderBy(- df(\"age\")) df.orderBy(df(\"age\").desc) &#125; def groupBy_data(spark: SparkSession, df: DataFrame): Unit = &#123; df.groupBy(\"age\").count().show()// +---+-----+// |age|count|// +---+-----+// | 22| 1|// | 30| 1|// | 23| 1|// +---+-----+ // åªèƒ½ä½œç”¨äºæ•°å€¼å­—æ®µ df.groupBy(\"user_name\").max(\"deposit_amount\").show() df.groupBy(\"user_name\").min(\"deposit_amount\").show() df.groupBy(\"user_name\").mean(\"deposit_amount\").as(\"mean_deposit_amount\").show() df.groupBy(\"user_name\").sum(\"deposit_amount\").toDF(\"user_name\", \"sum_deposit_amount\").show()// +---------+------------------+// |user_name|sum_deposit_amount|// +---------+------------------+// | vicky| 200.4|// | haylee| 4000.56|// | brent| 3000.0|// +---------+------------------+ import org.apache.spark.sql.functions._ df.groupBy(\"user_name\", \"age\") .agg(min(\"deposit_amount\").as(\"min_deposit_amount\")) .show()// +---------+---+------------------+// |user_name|age|min_deposit_amount|// +---------+---+------------------+// | vicky| 30| 200.4|// | haylee| 23| 4000.56|// | brent| 22| 3000.0|// +---------+---+------------------+ //å•ç‹¬ä½¿ç”¨ agg df.agg(\"age\" -&gt; \"max\").show() &#125; def distinct_data(spark: SparkSession, df: DataFrame): Unit = &#123; // distinct åº•å±‚å®ç°å®åˆ™ä¸º dropDuplicatesï¼ˆï¼‰ df.distinct() df.dropDuplicates() &#125; def join_data(spark: SparkSession, df: DataFrame, df2: DataFrame): Unit = &#123; //ç¬›å¡å°”ç§¯, spark2ä¸­é»˜è®¤ä¸å¼€å¯ç¬›å¡å°”ç§¯ï¼Œéœ€æ·»åŠ \"spark.sql.crossJoin.enabled\", \"true\"é…ç½® df.join(df2).show() df.join(df2, \"user_name\").show() df.join(df2, Seq(\"user_name\"), \"left\").show()// +---------+---+----------+-----------+--------------+-------------------+------+// |user_name|age| birthday|customer_id|deposit_amount| last_login_time| sex|// +---------+---+----------+-----------+--------------+-------------------+------+// | vicky| 30|2000-03-02| 12031604| 200.4|2017-03-10 09:10:00| male|// | haylee| 23|1992-08-10| 12031603| 4000.56|2017-03-11 10:55:00|female|// | brent| 22|1993-04-05| 12031602| 3000.0|2017-03-10 14:55:22| male|// +---------+---+----------+-----------+--------------+-------------------+------+ &#125; def intersect_data(spark: SparkSession, df: DataFrame, df2: DataFrame): Unit = &#123; // è·å–ä¸¤ä¸ªDataFrameä¸­å…±æœ‰çš„è®°å½• df.intersect(df2).show(false) &#125; def withColumn_rename_dataframe(spark: SparkSession, df: DataFrame): Unit = &#123; // å­—æ®µé‡å‘½å df.withColumnRenamed(\"deposit_amount\",\"withdraw_amount\").show() // æ·»åŠ æ–°åˆ— import spark.implicits._ df.withColumn(\"next_year_age\", $\"age\"+1).show() &#125;&#125;ä»¥ç¼–ç¨‹æ–¹å¼è¿è¡ŒSQLæŸ¥è¯¢12345678910111213141516171819202122232425262728293031323334package sqlimport org.apache.spark.sql.&#123;DataFrame, SparkSession&#125;object spark_use_sql &#123; def main(args: Array[String]): Unit = &#123; val spark: SparkSession = SparkSession .builder() .appName(\"sql_case\") .master(\"local\") .getOrCreate() // æ ·ä¾‹æ•°æ® /** * &#123;\"user_name\":\"brent\",\"customer_id\":12031602,\"age\": 22,\"birthday\":\"1993-04-05\",\"deposit_amount\":3000,\"last_login_time\":\"2017-03-10 14:55:22\"&#125; * &#123;\"user_name\":\"haylee\",\"customer_id\":12031603,\"age\":23,\"birthday\":\"1992-08-10\",\"deposit_amount\":4000.56,\"last_login_time\":\"2017-03-11 10:55:00\"&#125; * &#123;\"user_name\":\"vicky\",\"customer_id\":12031604,\"age\":30,\"birthday\":\"2000-03-02\",\"deposit_amount\":200.4,\"last_login_time\":\"2017-03-10 09:10:00\"&#125; */ val df: DataFrame = spark.read.json(\"hdfs://localhost:8020/data/user_data.json\") df.createTempView(\"t_user\") spark.sql(\"select * from t_user\").show()// +---+----------+-----------+--------------+-------------------+---------+// |age| birthday|customer_id|deposit_amount| last_login_time|user_name|// +---+----------+-----------+--------------+-------------------+---------+// | 22|1993-04-05| 12031602| 3000.0|2017-03-10 14:55:22| brent|// | 23|1992-08-10| 12031603| 4000.56|2017-03-11 10:55:00| haylee|// | 30|2000-03-02| 12031604| 200.4|2017-03-10 09:10:00| vicky|// +---+----------+-----------+--------------+-------------------+---------+ import org.apache.spark.sql.functions._ spark.sql(\"select * from t_user\").groupBy(\"user_name\").agg(\"deposit_amount\"-&gt;\"sum\").show() &#125; &#125;DataSetåˆ›å»º12345678910111213141516171819202122232425262728293031323334353637383940import org.apache.spark.sql.&#123;Dataset, SparkSession&#125;object dataset &#123; case class Person(name: String, age: Long) def main(args: Array[String]): Unit =&#123; val spark: SparkSession = SparkSession .builder() .appName(\"dataset_case\") .master(\"local\") .getOrCreate() import spark.implicits._ // $example on:create_ds$ // Encoders are created for case classes val caseClassDS: Dataset[Person] = Seq(Person(\"Andy\", 32)).toDS() caseClassDS.show() // +----+---+ // |name|age| // +----+---+ // |Andy| 32| // +----+---+ // Encoders for most common types are automatically provided by importing spark.implicits._ val primitiveDS: Dataset[Int] = Seq(1, 2, 3).toDS() primitiveDS.map(_ + 1).collect() // Returns: Array(2, 3, 4) // DataFrames can be converted to a Dataset by providing a class. Mapping will be done by name val path = \"examples/src/main/resources/people.json\" val peopleDS: Dataset[Person] = spark.read.json(path).as[Person] peopleDS.show() // +----+-------+ // | age| name| // +----+-------+ // |null|Michael| // | 30| Andy| // | 19| Justin| // +----+-------+ // $example off:create_ds$ &#125;&#125;æ•°æ®å­˜å‚¨æ–‡ä»¶123456789101112131415161718192021222324252627282930313233343536373839404142// $example on:generic_load_save_functions$ val usersDF = spark.read.load(\"examples/src/main/resources/users.parquet\") usersDF.select(\"name\", \"favorite_color\").write.save(\"namesAndFavColors.parquet\") // $example off:generic_load_save_functions$ // $example on:manual_load_options$ val peopleDF = spark.read.format(\"json\").load(\"examples/src/main/resources/people.json\") peopleDF.select(\"name\", \"age\").write.format(\"parquet\").save(\"namesAndAges.parquet\") // $example off:manual_load_options$ // $example on:manual_load_options_csv$ val peopleDFCsv = spark.read.format(\"csv\") .option(\"sep\", \";\") .option(\"inferSchema\", \"true\") .option(\"header\", \"true\") .load(\"examples/src/main/resources/people.csv\") // $example off:manual_load_options_csv$ // $example on:manual_save_options_orc$ usersDF.write.format(\"orc\") .option(\"orc.bloom.filter.columns\", \"favorite_color\") .option(\"orc.dictionary.key.threshold\", \"1.0\") .option(\"orc.column.encoding.direct\", \"name\") .save(\"users_with_options.orc\") // $example off:manual_save_options_orc$ // $example on:direct_sql$ val sqlDF = spark.sql(\"SELECT * FROM parquet.`examples/src/main/resources/users.parquet`\") // $example off:direct_sql$ // $example on:write_sorting_and_bucketing$ peopleDF.write.bucketBy(42, \"name\").sortBy(\"age\").saveAsTable(\"people_bucketed\") // $example off:write_sorting_and_bucketing$ // $example on:write_partitioning$ usersDF.write.partitionBy(\"favorite_color\").format(\"parquet\").save(\"namesPartByColor.parquet\") // $example off:write_partitioning$ // $example on:write_partition_and_bucket$ usersDF .write .partitionBy(\"favorite_color\") .bucketBy(42, \"name\") .saveAsTable(\"users_partitioned_bucketed\") // $example off:write_partition_and_bucket$ spark.sql(\"DROP TABLE IF EXISTS people_bucketed\") spark.sql(\"DROP TABLE IF EXISTS users_partitioned_bucketed\")jdbc123456789101112131415161718192021222324252627282930313233343536373839404142434445package writeimport java.util.Propertiesimport org.apache.spark.sql.&#123;DataFrame, SparkSession&#125;object write_data &#123; def main(args: Array[String]): Unit = &#123; val spark: SparkSession = SparkSession .builder() .appName(\"write_case\") .master(\"local\") .getOrCreate() // read val jdbcDF: DataFrame = spark.read .format(\"jdbc\") .option(\"url\", \"jdbc:postgresql:dbserver\") .option(\"dbtable\", \"schema.tablename\") .option(\"user\", \"username\") .option(\"password\", \"password\") .load() // write // Saving data to a JDBC source jdbcDF.write .format(\"jdbc\") .option(\"url\", \"jdbc:postgresql:dbserver\") .option(\"dbtable\", \"schema.tablename\") .option(\"user\", \"username\") .option(\"password\", \"password\") .mode(\"append\") .save() // or val properties=new Properties() properties.setProperty(\"user\",\"root\") properties.setProperty(\"password\",\"secret_password\") jdbcDF.write .mode(\"append\") .jdbc(\"jdbc:mysql://your_ip:3306/my_test?useUnicode=true&amp;characterEncoding=UTF-8\",\"t_result\",properties) &#125;&#125;hive123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117import java.io.Fileimport org.apache.spark.sql.&#123;Row, SaveMode, SparkSession&#125;case class Record(key: Int, value: String)// warehouseLocation points to the default location for managed databases and tablesval warehouseLocation = new File(\"spark-warehouse\").getAbsolutePathval spark = SparkSession .builder() .appName(\"Spark Hive Example\") .config(\"spark.sql.warehouse.dir\", warehouseLocation) .enableHiveSupport() .getOrCreate()import spark.implicits._import spark.sqlsql(\"CREATE TABLE IF NOT EXISTS src (key INT, value STRING) USING hive\")sql(\"LOAD DATA LOCAL INPATH 'examples/src/main/resources/kv1.txt' INTO TABLE src\")// Queries are expressed in HiveQLsql(\"SELECT * FROM src\").show()// +---+-------+// |key| value|// +---+-------+// |238|val_238|// | 86| val_86|// |311|val_311|// ...// Aggregation queries are also supported.sql(\"SELECT COUNT(*) FROM src\").show()// +--------+// |count(1)|// +--------+// | 500 |// +--------+// The results of SQL queries are themselves DataFrames and support all normal functions.val sqlDF = sql(\"SELECT key, value FROM src WHERE key &lt; 10 ORDER BY key\")// The items in DataFrames are of type Row, which allows you to access each column by ordinal.val stringsDS = sqlDF.map &#123; case Row(key: Int, value: String) =&gt; s\"Key: $key, Value: $value\"&#125;stringsDS.show()// +--------------------+// | value|// +--------------------+// |Key: 0, Value: val_0|// |Key: 0, Value: val_0|// |Key: 0, Value: val_0|// ...// You can also use DataFrames to create temporary views within a SparkSession.val recordsDF = spark.createDataFrame((1 to 100).map(i =&gt; Record(i, s\"val_$i\")))recordsDF.createOrReplaceTempView(\"records\")// Queries can then join DataFrame data with data stored in Hive.sql(\"SELECT * FROM records r JOIN src s ON r.key = s.key\").show()// +---+------+---+------+// |key| value|key| value|// +---+------+---+------+// | 2| val_2| 2| val_2|// | 4| val_4| 4| val_4|// | 5| val_5| 5| val_5|// ...// Create a Hive managed Parquet table, with HQL syntax instead of the Spark SQL native syntax// `USING hive`sql(\"CREATE TABLE hive_records(key int, value string) STORED AS PARQUET\")// Save DataFrame to the Hive managed tableval df = spark.table(\"src\")df.write.mode(SaveMode.Overwrite).saveAsTable(\"hive_records\")// After insertion, the Hive managed table has data nowsql(\"SELECT * FROM hive_records\").show()// +---+-------+// |key| value|// +---+-------+// |238|val_238|// | 86| val_86|// |311|val_311|// ...// Prepare a Parquet data directoryval dataDir = \"/tmp/parquet_data\"spark.range(10).write.parquet(dataDir)// Create a Hive external Parquet tablesql(s\"CREATE EXTERNAL TABLE hive_bigints(id bigint) STORED AS PARQUET LOCATION '$dataDir'\")// The Hive external table should already have datasql(\"SELECT * FROM hive_bigints\").show()// +---+// | id|// +---+// | 0|// | 1|// | 2|// ... Order may vary, as spark processes the partitions in parallel.// Turn on flag for Hive Dynamic Partitioningspark.sqlContext.setConf(\"hive.exec.dynamic.partition\", \"true\")spark.sqlContext.setConf(\"hive.exec.dynamic.partition.mode\", \"nonstrict\")// Create a Hive partitioned table using DataFrame APIdf.write.partitionBy(\"key\").format(\"hive\").saveAsTable(\"hive_part_tbl\")// Partitioned column `key` will be moved to the end of the schema.sql(\"SELECT * FROM hive_part_tbl\").show()// +-------+---+// | value|key|// +-------+---+// |val_238|238|// | val_86| 86|// |val_311|311|// ...spark.stop()hbase12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061object Application &#123; def main(args: Array[String]): Unit = &#123; val spark = SparkSession .builder() .master(\"local\") .appName(\"normal\") .getOrCreate() spark.sparkContext.setLogLevel(\"warn\") val data = (0 to 255).map &#123; i =&gt; HBaseRecord(i, \"extra\")&#125; val df:DataFrame = spark.createDataFrame(data) df.write .mode(SaveMode.Overwrite) .options(Map(HBaseTableCatalog.tableCatalog -&gt; catalog)) .format(\"org.apache.spark.sql.execution.datasources.hbase\") .save() &#125; def catalog = s\"\"\"&#123; |\"table\":&#123;\"namespace\":\"rec\", \"name\":\"user_rec\"&#125;, |\"rowkey\":\"key\", |\"columns\":&#123; |\"col0\":&#123;\"cf\":\"rowkey\", \"col\":\"key\", \"type\":\"string\"&#125;, |\"col1\":&#123;\"cf\":\"t\", \"col\":\"col1\", \"type\":\"boolean\"&#125;, |\"col2\":&#123;\"cf\":\"t\", \"col\":\"col2\", \"type\":\"double\"&#125;, |\"col3\":&#123;\"cf\":\"t\", \"col\":\"col3\", \"type\":\"float\"&#125;, |\"col4\":&#123;\"cf\":\"t\", \"col\":\"col4\", \"type\":\"int\"&#125;, |\"col5\":&#123;\"cf\":\"t\", \"col\":\"col5\", \"type\":\"bigint\"&#125;, |\"col6\":&#123;\"cf\":\"t\", \"col\":\"col6\", \"type\":\"smallint\"&#125;, |\"col7\":&#123;\"cf\":\"t\", \"col\":\"col7\", \"type\":\"string\"&#125;, |\"col8\":&#123;\"cf\":\"t\", \"col\":\"col8\", \"type\":\"tinyint\"&#125; |&#125; |&#125;\"\"\".stripMargin&#125;case class HBaseRecord( col0: String, col1: Boolean, col2: Double, col3: Float, col4: Int, col5: Long, col6: Short, col7: String, col8: Byte)object HBaseRecord&#123; def apply(i: Int, t: String): HBaseRecord = &#123; val s = s\"\"\"row$&#123;\"%03d\".format(i)&#125;\"\"\" HBaseRecord(s, i % 2 == 0, i.toDouble, i.toFloat, i, i.toLong, i.toShort, s\"String$i: $t\", i.toByte) &#125;&#125;","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"Spark SQL è®²è§£","slug":"Spark-SQL-è®²è§£","date":"2017-03-17T13:15:45.000Z","updated":"2020-04-22T04:19:51.260Z","comments":true,"path":"2017/03/17/Spark-SQL-è®²è§£/","link":"","permalink":"cpeixin.cn/2017/03/17/Spark-SQL-%E8%AE%B2%E8%A7%A3/","excerpt":"","text":"Spark SQLæ˜¯Apache Sparkçš„ç”¨äºå¤„ç†ç»“æ„åŒ–æ•°æ®çš„æ¨¡å—ã€‚ä¸‹å›¾æ˜¯Sparkå®˜ç½‘å¯¹Spark SQLçš„æè¿°Spark SQLç‰¹ç‚¹å­˜åœ¨å³åˆç†ï¼Œåœ¨æ•°æ®åˆ†ææŸ¥è¯¢é¢†åŸŸä¸­ï¼Œè™½ç„¶å·²ç»å­˜åœ¨äº†åº•å±‚è¿è¡ŒMapReduceçš„Hiveï¼Œä½†æ˜¯äººä»¬è¶Šæ¥è¶Šä¸æ»¡è¶³äºæŸ¥è¯¢çš„é€Ÿåº¦ï¼Œæ‰€ä»¥Spark SQLå°±åº”è¿è€Œç”Ÿã€‚åœ¨æˆ‘å¹³å¸¸çš„å·¥ä½œä¸­ï¼ŒSpark SQLçš„å‡ºåœºç‡çœŸçš„è¶…é«˜ï½ï½é›†æˆ123å°†SQLæŸ¥è¯¢ä¸Sparkç¨‹åºæ— ç¼æ··åˆã€‚Spark SQLä½¿æ‚¨å¯ä»¥ä½¿ç”¨SQLæˆ–ç†Ÿæ‚‰çš„DataFrame APIåœ¨Sparkç¨‹åºä¸­æŸ¥è¯¢ç»“æ„åŒ–æ•°æ®ã€‚å¯åœ¨Javaï¼ŒScalaï¼ŒPythonå’ŒRä¸­ä½¿ç”¨ã€‚ç»Ÿä¸€æ•°æ®è®¿é—®123ä»¥ç›¸åŒçš„æ–¹å¼è¿æ¥åˆ°ä»»ä½•æ•°æ®æºã€‚DataFrameå’ŒSQLæä¾›äº†ä¸€ç§è®¿é—®å„ç§æ•°æ®æºçš„é€šç”¨æ–¹æ³•ï¼ŒåŒ…æ‹¬Hiveï¼ŒAvroï¼ŒParquetï¼ŒORCï¼ŒJSONå’ŒJDBCã€‚æ‚¨ç”šè‡³å¯ä»¥è·¨è¿™äº›æºè”æ¥æ•°æ®ã€‚Hiveæ•´åˆ12åœ¨ç°æœ‰ä»“åº“ä¸Šè¿è¡ŒSQLæˆ–HiveQLæŸ¥è¯¢ã€‚Spark SQLæ”¯æŒHiveQLè¯­æ³•ä»¥åŠHive SerDeså’ŒUDFï¼Œä»è€Œä½¿æ‚¨å¯ä»¥è®¿é—®ç°æœ‰çš„Hiveä»“åº“ã€‚æ ‡å‡†è¿æ¥12é€šè¿‡JDBCæˆ–ODBCè¿æ¥ã€‚æœåŠ¡å™¨æ¨¡å¼ä¸ºå•†ä¸šæ™ºèƒ½å·¥å…·æä¾›äº†è¡Œä¸šæ ‡å‡†çš„JDBCå’ŒODBCè¿æ¥ã€‚Spark SQLæ¶æ„Spark SQL æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåº“ã€‚å®ƒè¿è¡Œåœ¨ Spark çš„æ ¸å¿ƒæ‰§è¡Œå¼•æ“ä¹‹ä¸Šã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå®ƒæä¾›ç±»ä¼¼äº SQL çš„æ“ä½œæ¥å£ï¼Œå…è®¸æ•°æ®ä»“åº“åº”ç”¨ç¨‹åºç›´æ¥è·å–æ•°æ®ï¼Œå…è®¸ä½¿ç”¨è€…é€šè¿‡å‘½ä»¤è¡Œæ“ä½œæ¥äº¤äº’åœ°æŸ¥è¯¢æ•°æ®ï¼Œè¿˜æä¾›ä¸¤ä¸ªç¼–ç¨‹æŠ½è±¡APIï¼šDataFrame API å’Œ DataSet APIã€‚Javaã€Python å’Œ Scala çš„åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ª API æ¥è¯»å–å’Œå†™å…¥ RDDã€‚æ­¤å¤–ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨RDDä»‹ç»çš„ï¼Œåº”ç”¨ç¨‹åºè¿˜å¯ä»¥ç›´æ¥æ“ä½œ RDDã€‚ä½¿ç”¨ Spark SQL ä¼šè®©å¼€å‘è€…è§‰å¾—å¥½åƒæ˜¯åœ¨æ“ä½œä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ä¸€æ ·ï¼Œè€Œä¸æ˜¯åœ¨æ“ä½œ RDDã€‚è¿™æ˜¯å®ƒä¼˜äºåŸç”Ÿçš„ RDD API çš„åœ°æ–¹ã€‚ä¸åŸºæœ¬çš„ Spark RDD API ä¸åŒï¼ŒSpark SQL æä¾›çš„æ¥å£ä¸º Spark æä¾›äº†å…³äºæ•°æ®ç»“æ„å’Œæ­£åœ¨æ‰§è¡Œçš„è®¡ç®—çš„æ›´å¤šä¿¡æ¯ã€‚åœ¨å†…éƒ¨ï¼ŒSpark SQL ä½¿ç”¨è¿™äº›é¢å¤–çš„ä¿¡æ¯æ¥æ‰§è¡Œé¢å¤–çš„ä¼˜åŒ–ã€‚è™½ç„¶ Spark SQL æ”¯æŒå¤šç§äº¤äº’æ–¹å¼ï¼Œä½†æ˜¯åœ¨è®¡ç®—ç»“æœæ—¶å‡ä½¿ç”¨ç›¸åŒçš„æ‰§è¡Œå¼•æ“ã€‚è¿™ç§ç»Ÿä¸€æ„å‘³ç€å¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°åœ¨ä¸åŒçš„ API ä¹‹é—´æ¥å›åˆ‡æ¢ï¼ŒåŸºäºè¿™äº› API æä¾›äº†è¡¨è¾¾ç»™å®šè½¬æ¢çš„æœ€è‡ªç„¶çš„æ–¹å¼ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬è¿›ä¸€æ­¥äº†è§£ DataSet å’Œ DataFrameã€‚DataSetDataSetï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ•°æ®é›†çš„æ„æ€ï¼Œå®ƒæ˜¯ Spark 1.6 æ–°å¼•å…¥çš„æ¥å£ã€‚åŒå¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ç±»ä¼¼ï¼ŒDataSet ä¹Ÿæ˜¯ä¸å¯å˜åˆ†å¸ƒå¼çš„æ•°æ®å•å…ƒï¼Œå®ƒæ—¢æœ‰ä¸ RDD ç±»ä¼¼çš„å„ç§è½¬æ¢å’ŒåŠ¨ä½œå‡½æ•°å®šä¹‰ï¼Œè€Œä¸”è¿˜äº«å— Spark SQL ä¼˜åŒ–è¿‡çš„æ‰§è¡Œå¼•æ“ï¼Œä½¿å¾—æ•°æ®æœç´¢æ•ˆç‡æ›´é«˜ã€‚DataSet æ”¯æŒçš„è½¬æ¢å’ŒåŠ¨ä½œä¹Ÿå’Œ RDD ç±»ä¼¼ï¼Œæ¯”å¦‚ mapã€filterã€selectã€countã€show åŠæŠŠæ•°æ®å†™å…¥æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚åŒæ ·åœ°ï¼ŒDataSet ä¸Šçš„è½¬æ¢æ“ä½œä¹Ÿä¸ä¼šè¢«ç«‹åˆ»æ‰§è¡Œï¼Œåªæ˜¯å…ˆç”Ÿæˆæ–°çš„ DataSetï¼Œåªæœ‰å½“é‡åˆ°åŠ¨ä½œæ“ä½œï¼Œæ‰ä¼šæŠŠä¹‹å‰çš„è½¬æ¢æ“ä½œä¸€å¹¶æ‰§è¡Œï¼Œç”Ÿæˆç»“æœã€‚æ‰€ä»¥ï¼ŒDataSet çš„å†…éƒ¨ç»“æ„åŒ…å«äº†é€»è¾‘è®¡åˆ’ï¼Œå³ç”Ÿæˆè¯¥æ•°æ®é›†æ‰€éœ€è¦çš„è¿ç®—ã€‚å½“åŠ¨ä½œæ“ä½œæ‰§è¡Œæ—¶ï¼ŒSpark SQL çš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šä¼˜åŒ–è¿™ä¸ªé€»è¾‘è®¡åˆ’ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªå¯ä»¥åˆ†å¸ƒå¼æ‰§è¡Œçš„ã€åŒ…å«åˆ†åŒºä¿¡æ¯çš„ç‰©ç†è®¡åˆ’ã€‚é‚£ä¹ˆï¼ŒDataSet å’Œ RDD çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé€šè¿‡ä¹‹å‰çš„å™è¿°ï¼Œæˆ‘ä»¬çŸ¥é“ DataSet API æ˜¯ Spark SQL çš„ä¸€ä¸ªç»„ä»¶ã€‚é‚£ä¹ˆï¼Œä½ åº”è¯¥èƒ½å¾ˆå®¹æ˜“åœ°è”æƒ³åˆ°ï¼ŒDataSet ä¹Ÿå…·æœ‰å…³ç³»å‹æ•°æ®åº“ä¸­è¡¨çš„ç‰¹æ€§ã€‚æ˜¯çš„ï¼ŒDataSet æ‰€æè¿°çš„æ•°æ®éƒ½è¢«ç»„ç»‡åˆ°æœ‰åå­—çš„åˆ—ä¸­ï¼Œå°±åƒå…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨ä¸€æ ·ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå·¦ä¾§çš„ RDD è™½ç„¶ä»¥ People ä¸ºç±»å‹å‚æ•°ï¼Œä½† Spark æ¡†æ¶æœ¬èº«ä¸äº†è§£ People ç±»çš„å†…éƒ¨ç»“æ„ã€‚æ‰€æœ‰çš„æ“ä½œéƒ½ä»¥ People ä¸ºå•ä½æ‰§è¡Œã€‚è€Œå³ä¾§çš„ DataSet å´æä¾›äº†è¯¦ç»†çš„ç»“æ„ä¿¡æ¯ä¸æ¯åˆ—çš„æ•°æ®ç±»å‹ã€‚è¿™è®© Spark SQL å¯ä»¥æ¸…æ¥šåœ°çŸ¥é“è¯¥æ•°æ®é›†ä¸­åŒ…å«å“ªäº›åˆ—ï¼Œæ¯åˆ—çš„åç§°å’Œç±»å‹å„æ˜¯ä»€ä¹ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒDataSet æä¾›æ•°æ®è¡¨çš„ schema ä¿¡æ¯ã€‚è¿™æ ·çš„ç»“æ„ä½¿å¾— DataSet API çš„æ‰§è¡Œæ•ˆç‡æ›´é«˜ã€‚è¯•æƒ³ï¼Œå¦‚æœæˆ‘ä»¬è¦æŸ¥è¯¢ People çš„å¹´é¾„ä¿¡æ¯ï¼ŒSpark SQL æ‰§è¡Œçš„æ—¶å€™å¯ä»¥ä¾é æŸ¥è¯¢ä¼˜åŒ–å™¨ä»…ä»…æŠŠéœ€è¦çš„é‚£ä¸€åˆ—å–å‡ºæ¥ï¼Œå…¶ä»–åˆ—çš„ä¿¡æ¯æ ¹æœ¬å°±ä¸éœ€è¦å»è¯»å–äº†ã€‚æ‰€ä»¥ï¼Œæœ‰äº†è¿™äº›ä¿¡æ¯ä»¥ååœ¨ç¼–è¯‘çš„æ—¶å€™èƒ½å¤Ÿåšæ›´å¤šçš„ä¼˜åŒ–ã€‚å…¶æ¬¡ï¼Œç”±äº DataSet å­˜å‚¨äº†æ¯åˆ—çš„æ•°æ®ç±»å‹ã€‚æ‰€ä»¥ï¼Œåœ¨ç¨‹åºç¼–è¯‘æ—¶å¯ä»¥æ‰§è¡Œç±»å‹æ£€æµ‹ã€‚DataFrameDataFrame å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ç§ç‰¹æ®Šçš„ DataSetã€‚å®ƒä¹Ÿæ˜¯å…³ç³»å‹æ•°æ®åº“ä¸­è¡¨ä¸€æ ·çš„ç»“æ„åŒ–å­˜å‚¨æœºåˆ¶ï¼Œä¹Ÿæ˜¯åˆ†å¸ƒå¼ä¸å¯å˜çš„æ•°æ®ç»“æ„ã€‚ä½†æ˜¯ï¼Œå®ƒçš„æ¯ä¸€åˆ—å¹¶ä¸å­˜å‚¨ç±»å‹ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æ—¶å¹¶ä¸èƒ½å‘ç°ç±»å‹é”™è¯¯ã€‚DataFrame æ¯ä¸€è¡Œçš„ç±»å‹å›ºå®šä¸º Rowï¼Œä»–å¯ä»¥è¢«å½“ä½œ DataSet[Row]æ¥å¤„ç†ï¼Œæˆ‘ä»¬å¿…é¡»è¦é€šè¿‡è§£ææ‰èƒ½è·å–å„åˆ—çš„å€¼ã€‚æ‰€ä»¥ï¼Œå¯¹äº DataSet æˆ‘ä»¬å¯ä»¥ç”¨ç±»ä¼¼ people.name æ¥è®¿é—®ä¸€ä¸ªäººçš„åå­—ï¼Œè€Œå¯¹äº DataFrame æˆ‘ä»¬ä¸€å®šè¦ç”¨ç±»ä¼¼ people.get As [String] (â€œnameâ€) æ¥è®¿é—®ã€‚RDDã€DataFrameã€DataSet å¯¹æ¯”å­¦ä¹  Spark åˆ°ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æ¥è§¦äº†ä¸‰ç§åŸºæœ¬çš„æ•°æ®ç»“æ„ï¼šRDDã€DataFrame å’Œ DataSetã€‚æ¥ä¸‹æ¥ä½ çš„è¡¨æ ¼ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°å®ƒä»¬çš„å¼‚åŒç‚¹ï¼Œåœ¨å®é™…å·¥ä½œä¸­ï¼Œç»å¸¸ä¼šé‡åˆ° RDD-&gt;DataFrame-&gt;DataSetä¹‹é—´çš„ç›¸äº’è½¬æ¢ï¼Œæ€è€ƒä¸€ä¸‹æ€æ ·åœ¨å®é™…å·¥ç¨‹ä¸­é€‰æ‹©ã€‚å‘å±•å†å²ä»å‘å±•å†å²ä¸Šæ¥çœ‹ï¼ŒRDD API åœ¨ç¬¬ä¸€ä»£ Spark ä¸­å°±å­˜åœ¨ï¼Œæ˜¯æ•´ä¸ª Spark æ¡†æ¶çš„åŸºçŸ³ã€‚æ¥ä¸‹æ¥ï¼Œä¸ºäº†æ–¹ä¾¿ç†Ÿæ‚‰å…³ç³»å‹æ•°æ®åº“å’Œ SQL çš„å¼€å‘äººå‘˜ä½¿ç”¨ï¼Œåœ¨ RDD çš„åŸºç¡€ä¸Šï¼ŒSpark åˆ›å»ºäº† DataFrame APIã€‚ä¾é å®ƒï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°å¯¹æ•°æ®çš„åˆ—è¿›è¡Œæ“ä½œã€‚DataSet æœ€æ—©è¢«åŠ å…¥ Spark SQL æ˜¯åœ¨ Spark 1.6ï¼Œå®ƒåœ¨ DataFrame çš„åŸºç¡€ä¸Šæ·»åŠ äº†å¯¹æ•°æ®çš„æ¯ä¸€åˆ—çš„ç±»å‹çš„é™åˆ¶ã€‚åœ¨ Spark 2.0 ä¸­ï¼ŒDataFrame å’Œ DataSet è¢«ç»Ÿä¸€ã€‚DataFrame ä½œä¸º DataSet[Row]å­˜åœ¨ã€‚åœ¨å¼±ç±»å‹çš„è¯­è¨€ï¼Œå¦‚ Python ä¸­ï¼ŒDataFrame API ä¾ç„¶å­˜åœ¨ï¼Œä½†æ˜¯åœ¨ Java ä¸­ï¼ŒDataFrame API å·²ç»ä¸å¤å­˜åœ¨äº†ã€‚ä¸å˜æ€§ä¸åˆ†åŒºç”±äº DataSet å’Œ DataFrame éƒ½æ˜¯åŸºäº RDD çš„ï¼Œæ‰€ä»¥å®ƒä»¬éƒ½æ‹¥æœ‰ RDD çš„åŸºæœ¬ç‰¹æ€§ï¼Œåœ¨æ­¤ä¸åšèµ˜è¿°ã€‚è€Œä¸”æˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•çš„ API åœ¨ DataFrame æˆ– Dataset ä¸ RDD ä¹‹é—´è¿›è¡Œæ— ç¼åˆ‡æ¢ã€‚æ€§èƒ½DataFrame å’Œ DataSet çš„æ€§èƒ½è¦æ¯” RDD æ›´å¥½ã€‚Spark ç¨‹åºè¿è¡Œæ—¶ï¼ŒSpark SQL ä¸­çš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šå¯¹è¯­å¥è¿›è¡Œåˆ†æï¼Œå¹¶ç”Ÿæˆä¼˜åŒ–è¿‡çš„ RDD åœ¨åº•å±‚æ‰§è¡Œã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å…ˆå¯¹ä¸€å †æ•°æ®è¿›è¡Œ GroupBy å†è¿›è¡Œ Filter æ“ä½œï¼Œè¿™æ— ç–‘æ˜¯ä½æ•ˆçš„ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶ä¸éœ€è¦å¯¹æ‰€æœ‰æ•°æ®éƒ½ GroupByã€‚å¦‚æœç”¨ RDD API å®ç°è¿™ä¸€è¯­å¥ï¼Œåœ¨æ‰§è¡Œæ—¶å®ƒåªä¼šæœºæ¢°åœ°æŒ‰é¡ºåºæ‰§è¡Œã€‚è€Œå¦‚æœç”¨ DataFrame/DataSet APIï¼ŒSpark SQL çš„ Catalyst ä¼˜åŒ–å™¨ä¼šå°† Filter æ“ä½œå’Œ GroupBy æ“ä½œè°ƒæ¢é¡ºåºï¼Œä»è€Œæé«˜æ‰§è¡Œæ•ˆç‡ã€‚ä¸‹å›¾åæ˜ äº†è¿™ä¸€ä¼˜åŒ–è¿‡ç¨‹ã€‚è¯¦ç»†çš„è§£æä¼˜åŒ–è¿‡ç¨‹ï¼Œæˆ‘ä¼šå•ç‹¬ç”¨ä¸€ç¯‡æ–‡ç« æ¥å†™çš„ã€‚é”™è¯¯æ£€æµ‹RDD å’Œ DataSet éƒ½æ˜¯ç±»å‹å®‰å…¨çš„ï¼Œè€Œ DataFrame å¹¶ä¸æ˜¯ç±»å‹å®‰å…¨çš„ã€‚è¿™æ˜¯å› ä¸ºå®ƒä¸å­˜å‚¨æ¯ä¸€åˆ—çš„ä¿¡æ¯å¦‚åå­—å’Œç±»å‹ã€‚ä½¿ç”¨ DataFrame API æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€ä¸ªå¹¶ä¸å­˜åœ¨çš„åˆ—ï¼Œè¿™ä¸ªé”™è¯¯åªæœ‰åœ¨ä»£ç è¢«æ‰§è¡Œæ—¶æ‰ä¼šæŠ›å‡ºã€‚å¦‚æœä½¿ç”¨ DataSet APIï¼Œåœ¨ç¼–è¯‘æ—¶å°±ä¼šæ£€æµ‹åˆ°è¿™ä¸ªé”™è¯¯ã€‚å°ç»“DataFrame å’Œ DataSet æ˜¯ Spark SQL æä¾›çš„åŸºäº RDD çš„ç»“æ„åŒ–æ•°æ®æŠ½è±¡ã€‚å®ƒæ—¢æœ‰ RDD ä¸å¯å˜ã€åˆ†åŒºã€å­˜å‚¨ä¾èµ–å…³ç³»ç­‰ç‰¹æ€§ï¼Œåˆæ‹¥æœ‰ç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“çš„ç»“æ„åŒ–ä¿¡æ¯ã€‚æ‰€ä»¥ï¼ŒåŸºäº DataFrame å’Œ DataSet API å¼€å‘å‡ºçš„ç¨‹åºä¼šè¢«è‡ªåŠ¨ä¼˜åŒ–ï¼Œä½¿å¾—å¼€å‘äººå‘˜ä¸éœ€è¦æ“ä½œåº•å±‚çš„ RDD API æ¥è¿›è¡Œæ‰‹åŠ¨ä¼˜åŒ–ï¼Œå¤§å¤§æå‡å¼€å‘æ•ˆç‡ã€‚ä½†æ˜¯ RDD API å¯¹äºéç»“æ„åŒ–çš„æ•°æ®å¤„ç†æœ‰ç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼Œæ¯”å¦‚æ–‡æœ¬æµæ•°æ®ï¼Œè€Œä¸”æ›´æ–¹ä¾¿æˆ‘ä»¬åšåº•å±‚çš„æ“ä½œã€‚æ‰€ä»¥åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥é€‰æ‹©ä½¿ç”¨å“ªç§ APIã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"Spark Core æ•°æ®å­˜å‚¨æ“ä½œ","slug":"Spark-Core-æ•°æ®å­˜å‚¨æ“ä½œ","date":"2017-03-15T14:41:50.000Z","updated":"2020-04-14T17:27:43.590Z","comments":true,"path":"2017/03/15/Spark-Core-æ•°æ®å­˜å‚¨æ“ä½œ/","link":"","permalink":"cpeixin.cn/2017/03/15/Spark-Core-%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E6%93%8D%E4%BD%9C/","excerpt":"","text":"ä¸Šæ–‡è®²è§£äº†RDDçš„æ¦‚å¿µå’Œè½¬æ¢ç®—å­ã€è¡ŒåŠ¨ç®—å­çš„æ“ä½œå†…å®¹ï¼Œå¯¹äºç®—å­çš„æ“ä½œï¼Œå±äºSparké’ˆå¯¹æ•°æ®è¿›è¡Œè®¡ç®—çš„è¿‡ç¨‹ã€‚å›åˆ°ç°å®åœºæ™¯ï¼Œæˆ‘ä»¬ä½¿ç”¨Sparkæ¥åšä»»åŠ¡çš„è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯ä¸‰ä¸ªé˜¶æ®µï¼šè¯»å–æ•°æ®æºå¯¹æºæ•°æ®è¿›è¡Œè®¡ç®—ï¼Œä¸šåŠ¡é€»è¾‘çš„ç¼–å†™æ•°æ®å­˜å‚¨ï¼Œæ•°æ®è½åœ°åœ¨æ—¥å¸¸çš„å·¥ä½œä¸­ï¼ŒSparkçš„ä»»åŠ¡å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œç¦»çº¿è®¡ç®—å’Œå®æ—¶è®¡ç®—ã€‚é’ˆå¯¹å®æ—¶è®¡ç®—ï¼Œå‡ ä¹95%çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯ä½¿ç”¨kafkaä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ä¸Sparkè¿›è¡Œæ•°æ®å¯¹æ¥ã€‚é’ˆå¯¹ç¦»çº¿è®¡ç®—ï¼Œæ•°æ®æºå°±å¤šç§å¤šæ ·äº†ï¼Œå¯ä»¥æ˜¯äº§å“ä¸šåŠ¡çº¿çš„ä¸šåŠ¡æ•°æ®åº“ï¼Œå¯ä»¥æ˜¯å¤§æ•°æ®å¹³å°çš„Hiveï¼ŒHBaseç­‰ï¼Œä¹Ÿå¯ä»¥æ˜¯CEOåŠå…¬å®¤ç»™å‡ºçš„æŠ¥è¡¨æ•°æ®ã€‚æ€»ç»“ä¸€ä¸‹ä¸Šé¢æ‰€è®²è¿°çš„ï¼Œå°±æ˜¯æ•°æ®æºå¤šç§å¤šæ ·ï¼Œé€‰æ‹©åˆé€‚çš„ç»„ä»¶å’ŒAPIå°†æ•°æ®è¯»è¿›æ¥å°±å¥½ã€‚å¹¶ä¸”ï¼Œåœ¨ç°å®ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œéƒ½æ˜¯é€‰æ‹©ä¸Šå±‚ç»„ä»¶Spark SQL å’Œ Spark Streamingæ¥è¯»å–æ•°æ®ï¼Œè®¡ç®—æ•°æ®ï¼Œå­˜å‚¨æ•°æ®ã€‚æ‰€ä»¥åœ¨è¿™é‡Œå°±ä¸å¤æ‚çš„æ•°æ®æ“ä½œäº†ï¼Œåªæ˜¯é’ˆå¯¹åœ¨ç®€å•çš„ä¸šåŠ¡åœºæ™¯ï¼Œä¸éœ€è¦Spark SQL å’Œ Spark Streamingç»„ä»¶ï¼Œä½¿ç”¨Spark Coreå¤„ç†ç®€å•çš„è¯»å–ã€è®¡ç®—å’Œå­˜å‚¨ä»»åŠ¡ç¤ºä¾‹ã€‚æ•°æ®è½åœ°è‡³HDFSæ–‡ä»¶ç³»ç»Ÿ1234567891011121314151617181920212223242526272829package rddimport com.google.gson.&#123;JsonObject, JsonParser&#125;import org.apache.spark.rdd.RDDimport org.apache.spark.&#123;SparkConf, SparkContext&#125;object process_json &#123; def main(args: Array[String]): Unit=&#123; val sparkConf: SparkConf = new SparkConf() .setAppName(\"process_json\") .setMaster(\"local\") val sc = new SparkContext(sparkConf) \"\"\" data_demo: &#123;\"user_name\":\"brent\",\"customer_id\":12031602,\"age\":22,\"birthday\":\"1993-04-05\",\"deposit_amount\":3000,\"last_login_time\":\"2017-03-10 14:55:22\"&#125; &#123;\"user_name\":\"haylee\",\"customer_id\":12031603,\"age\":23,\"birthday\":\"1992-08-10\",\"deposit_amount\":4000.56,\"last_login_time\":\"2017-03-11 10:55:00\"&#125; &#123;\"user_name\":\"vicky\",\"customer_id\":12031604,\"age\":30,\"birthday\":\"2000-03-02\",\"deposit_amount\":200.4,\"last_login_time\":\"2017-03-10 09:10:00\"&#125; \"\"\".stripMargin var json_rdd: RDD[String] = sc.textFile(\"hdfs://localhost:8020/data/user_data.json\") val result_rdd: RDD[JsonObject] = json_rdd.map((x: String) =&gt; &#123; val json = new JsonParser() val json_item = json.parse(x).asInstanceOf[JsonObject] json_item.addProperty(\"flag\", 1) json_item &#125;) result_rdd.saveAsTextFile(\"hdfs://localhost:8020/data/result/user_data\") &#125;&#125;æ•°æ®è½åœ°è‡³MySQL**1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465package rddimport java.sql.&#123;Connection, DriverManager, PreparedStatement&#125;import com.alibaba.fastjson.&#123;JSON, JSONArray, JSONObject&#125;import org.apache.spark.rdd.RDDimport org.apache.spark.&#123;SparkConf, SparkContext&#125;object process_json &#123; def main(args: Array[String]): Unit=&#123; val sparkConf: SparkConf = new SparkConf() .setAppName(\"process_json\") \"\"\" data_demo: &#123;\"user_name\":\"brent\",\"customer_id\":12031602,\"age\":22,\"birthday\":\"1993-04-05\",\"deposit_amount\":3000,\"last_login_time\":\"2017-03-10 14:55:22\"&#125; &#123;\"user_name\":\"haylee\",\"customer_id\":12031603,\"age\":23,\"birthday\":\"1992-08-10\",\"deposit_amount\":4000.56,\"last_login_time\":\"2017-03-11 10:55:00\"&#125; &#123;\"user_name\":\"vicky\",\"customer_id\":12031604,\"age\":30,\"birthday\":\"2000-03-02\",\"deposit_amount\":200.4,\"last_login_time\":\"2017-03-10 09:10:00\"&#125; \"\"\".stripMargin val sc = new SparkContext(sparkConf) // è¯»å–æ•°æ®æº var json_rdd: RDD[String] = sc.textFile(\"hdfs://localhost:8020/data/user_data.json\") // æ•°æ®è®¡ç®— val result_rdd: RDD[JSONObject] = json_rdd.map((x: String) =&gt; &#123; val json_item: JSONObject = JSON.parseObject(x) json_item.put(\"flag\", 1) json_item &#125;) val driverClassName = \"com.mysql.jdbc.Driver\" val url = \"jdbc:mysql://localhost:3306/test?characterEncoding=utf8&amp;useSSL=false\" val user = \"root\" val password = \"cpx726175\" result_rdd.foreachPartition((partition: Iterator[JSONObject]) =&gt; &#123; Class.forName(driverClassName) val connection: Connection = DriverManager.getConnection(url, user, password) val sql = \"insert into t_user(user_name, customer_id, age, birthday, deposit_amount, last_login_time,flag) values(?,?,?,?,?,?,?)\" val statement: PreparedStatement = connection.prepareStatement(sql) try &#123; partition.foreach &#123; json_data: JSONObject =&gt; &#123; statement.setString(1, json_data.getString(\"user_name\")) statement.setInt(2, json_data.getInteger(\"customer_id\")) statement.setInt(3, json_data.getInteger(\"age\")) statement.setString(4, json_data.getString(\"birthday\")) statement.setFloat(5, json_data.getFloat(\"deposit_amount\")) statement.setString(6, json_data.getString(\"last_login_time\")) statement.setInt(7, json_data.getInteger(\"flag\")) statement.executeUpdate() &#125; &#125; &#125;catch &#123; case e: Exception =&gt; println(e.printStackTrace()) &#125; finally &#123; if(statement!=null) statement.close() if(connection!=null) connection.close() &#125; connection.close() &#125; ) sc.stop() &#125;&#125;æ³¨ï¼šåœ¨ä½¿ç”¨mysqlå»ºè¡¨æ—¶ï¼Œfloatå­—æ®µï¼Œdoubleå­—æ®µéœ€è¦æŒ‡å®šå°æ•°ç‚¹ä½æ•°ã€‚å¦åˆ™å°†ä¼šæŒ‰ç…§å››èˆäº”å…¥æ•´æ•°æ˜¾ç¤º123456789CREATE TABLE &#96;t_user&#96; ( &#96;user_name&#96; varchar(50) DEFAULT NULL, &#96;customer_id&#96; int(50) DEFAULT NULL, &#96;age&#96; int(20) DEFAULT NULL, &#96;birthday&#96; varchar(50) DEFAULT NULL, &#96;deposit_amount&#96; float(20,3) DEFAULT NULL, &#96;last_login_time&#96; varchar(100) DEFAULT NULL, &#96;flag&#96; int(10) DEFAULT NULL) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8mb4 COLLATE&#x3D;utf8mb4_0900_ai_ciè½åœ°æ•°æ®å¦‚ä¸‹ï¼š**æ•°æ®è½åœ°è‡³HBase123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566package rddimport java.langimport java.sql.&#123;Connection, DriverManager, PreparedStatement&#125;import org.apache.hadoop.hbase.client.Putimport org.apache.hadoop.hbase.io.ImmutableBytesWritableimport org.apache.hadoop.hbase.mapreduce.&#123;TableInputFormat, TableOutputFormat&#125;import org.apache.hadoop.hbase.client.Resultimport org.apache.hadoop.hbase.util.Bytesimport org.apache.hadoop.mapreduce.Jobimport com.alibaba.fastjson.&#123;JSON, JSONArray, JSONObject&#125;import org.apache.hadoop.conf.Configurationimport org.apache.hadoop.hbase.HBaseConfigurationimport org.apache.hadoop.mapred.JobConfimport org.apache.spark.rdd.RDDimport org.apache.spark.&#123;SparkConf, SparkContext&#125;object process_json &#123; def main(args: Array[String]): Unit=&#123; val sparkConf: SparkConf = new SparkConf() .setAppName(\"process_json\") \"\"\" data_demo: &#123;\"user_name\":\"brent\",\"customer_id\":12031602,\"age\":22,\"birthday\":\"1993-04-05\",\"deposit_amount\":3000,\"last_login_time\":\"2017-03-10 14:55:22\"&#125; &#123;\"user_name\":\"haylee\",\"customer_id\":12031603,\"age\":23,\"birthday\":\"1992-08-10\",\"deposit_amount\":4000.56,\"last_login_time\":\"2017-03-11 10:55:00\"&#125; &#123;\"user_name\":\"vicky\",\"customer_id\":12031604,\"age\":30,\"birthday\":\"2000-03-02\",\"deposit_amount\":200.4,\"last_login_time\":\"2017-03-10 09:10:00\"&#125; \"\"\".stripMargin val sc = new SparkContext(sparkConf) var json_rdd: RDD[String] = sc.textFile(\"hdfs://localhost:8020/data/user_data.json\") val result_rdd: RDD[JSONObject] = json_rdd.map((x: String) =&gt; &#123; val json_item: JSONObject = JSON.parseObject(x) json_item.put(\"flag\", 1) json_item &#125;) var resultConf: Configuration = HBaseConfiguration.create() //è®¾ç½®zooKeeperé›†ç¾¤åœ°å€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å°†hbase-site.xmlå¯¼å…¥classpathï¼Œä½†æ˜¯å»ºè®®åœ¨ç¨‹åºé‡Œè¿™æ ·è®¾ç½® resultConf.set(\"hbase.zookeeper.quorum\", \"localhost\") //è®¾ç½®zookeeperè¿æ¥ç«¯å£ï¼Œé»˜è®¤2181 resultConf.set(\"hbase.zookeeper.property.clientPort\", \"2181\") //æ³¨æ„è¿™é‡Œæ˜¯output resultConf.set(TableOutputFormat.OUTPUT_TABLE, \"t_user\") var job: Job = Job.getInstance(resultConf) job.setOutputKeyClass(classOf[ImmutableBytesWritable]) job.setOutputValueClass(classOf[org.apache.hadoop.hbase.client.Result]) job.setOutputFormatClass(classOf[TableOutputFormat[ImmutableBytesWritable]]) val hbaseOut: RDD[(ImmutableBytesWritable, Put)] = result_rdd.map((json_data: JSONObject) =&gt; &#123; val put = new Put(Bytes.toBytes(json_data.getInteger(\"customer_id\").toString)) put.addColumn(Bytes.toBytes(\"cf1\"), Bytes.toBytes(\"user_name\"), Bytes.toBytes(json_data.getString(\"user_name\"))) //ç›´æ¥å†™å…¥æ•´å‹ä¼šä»¥åå…­è¿›åˆ¶å­˜å‚¨ put.addColumn(Bytes.toBytes(\"cf1\"), Bytes.toBytes(\"customer_id\"), Bytes.toBytes(json_data.get(\"customer_id\").toString)) put.addColumn(Bytes.toBytes(\"cf1\"), Bytes.toBytes(\"age\"), Bytes.toBytes(json_data.get(\"age\").toString)) put.addColumn(Bytes.toBytes(\"cf1\"), Bytes.toBytes(\"birthday\"), Bytes.toBytes(json_data.getString(\"birthday\"))) put.addColumn(Bytes.toBytes(\"cf1\"), Bytes.toBytes(\"deposit_amount\"), Bytes.toBytes(json_data.get(\"deposit_amount\").toString)) put.addColumn(Bytes.toBytes(\"cf1\"), Bytes.toBytes(\"last_login_time\"), Bytes.toBytes(json_data.getString(\"last_login_time\"))) put.addColumn(Bytes.toBytes(\"cf1\"), Bytes.toBytes(\"flag\"), Bytes.toBytes(json_data.get(\"flag\").toString)) (new ImmutableBytesWritable, put) &#125;) hbaseOut.saveAsNewAPIHadoopDataset(job.getConfiguration) sc.stop() &#125;&#125;hbaseå»ºè¡¨è¯­å¥ï¼š1create 't_user', 'cf1'è½åœ°æ•°æ®å¦‚ä¸‹ï¼šä»¥ä¸Šå°±æ˜¯é’ˆå¯¹RDDï¼Œè¿›è¡Œæ•°æ®å†™å…¥çš„æ“ä½œã€‚è¿‡ç¨‹å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å†™å…¥è¿‡ç¨‹ä¸­ï¼Œè¦å¯¹åº”å¥½æ•°æ®ç±»å‹ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"Spark - RDDè®²è§£","slug":"Spark-RDDè®²è§£","date":"2017-03-11T22:41:50.000Z","updated":"2020-05-18T06:36:24.984Z","comments":true,"path":"2017/03/12/Spark-RDDè®²è§£/","link":"","permalink":"cpeixin.cn/2017/03/12/Spark-RDD%E8%AE%B2%E8%A7%A3/","excerpt":"","text":"What is RDDåœ¨è®²RDDä¹‹å‰ï¼Œå…ˆå’Œå¤§å®¶è¯´ä¸€ä¸‹åœ¨Sparkä¸­ï¼Œæˆ‘ä»¬åˆ†ææ•°æ®çš„è¿‡ç¨‹ï¼Œä¸»è¦ä¼šç¢°åˆ°RDDï¼ŒDataFrameï¼ŒDataSetæ¦‚å¿µï¼Œè¿™ä¸‰ç§éƒ½æ˜¯æˆ‘ä»¬è®¡ç®—è¿‡ç¨‹ä¸­çš„æ•°æ®å•å…ƒã€‚åœ¨Spark 2.0ä¹‹å‰ï¼Œä¸»è¦çš„æ•°æ®æ“ä½œéƒ½æ˜¯æ“ä½œRDDï¼Œè€Œåœ¨Spark 2.0ä»¥åï¼Œå®˜æ–¹å¼€å§‹å‘¼åå¤§å®¶è¿ç§»åˆ°åŸºäºDataSetï¼Œå³ä½¿ä½ æ˜¯ä»Spark 2.0ä»¥åå¼€å§‹æ¥è§¦çš„sparkï¼Œä½†æ˜¯æˆ‘ä¹Ÿå¾ˆè´Ÿè´£äººçš„å‘Šè¯‰ä½ ï¼ŒRDDä½ å¿…é¡»è¦æ‡‚ï½ï½å®šä¹‰å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ï¼ˆResilient Distributed Datasets : RDDï¼‰ï¼Œè¡¨ç¤ºå·²è¢«åˆ†åŒºã€ä¸å¯å˜çš„ï¼Œå¹¶èƒ½å¤Ÿè¢«å¹¶è¡Œæ“ä½œï¼Œå¯åŒé”™çš„æ•°æ®é›†åˆã€‚é’ˆå¯¹ä¸Šé¢çš„å®šä¹‰ï¼Œè¿˜è¯´æè¿°çš„å¾ˆæŠ½è±¡ï¼Œæ¥ä¸‹æ¥æ ¹æ®æ¯ä¸ªRDDçš„å±æ€§ï¼Œè¿›è¡Œé€ç‚¹è¯´æ˜åˆ†åŒºåˆ†åŒºè¿™ä¸ªæ¦‚å¿µåœ¨åˆ†å¸ƒå¼è®¡ç®—ä¸­æˆ‘ä»¬ç»å¸¸ä¼šçœ‹åˆ°ï¼Œä¾‹å¦‚MapReduceä¸­ï¼Œæ•°æ®åœ¨Mapç«¯å†™å…¥åˆ°ç¯å½¢ç¼“å†²åŒºï¼Œæ•°æ®è¿›è¡Œåˆ†åŒºï¼Œreduceç«¯è¯»å–ç›¸åº”çš„åˆ†åŒºæ–‡ä»¶ï¼Œè¿˜æœ‰åœ¨Kafkaä¸­ï¼Œtopicä¸­çš„åˆ†åŒºæ¦‚å¿µã€‚åœ¨RDDä¸­ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåªè¯»çš„åˆ†åŒºè®°å½•é›†åˆã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦å¤„ç†çš„æºæ•°æ®çš„æŠ½è±¡ã€‚æ¯ä¸ª RDD å¯ä»¥åˆ†æˆå¤šä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºå°±æ˜¯ä¸€ä¸ªæ•°æ®é›†ç‰‡æ®µã€‚ä¸€ä¸ª RDD çš„ä¸åŒåˆ†åŒºå¯ä»¥ä¿å­˜åˆ°é›†ç¾¤ä¸­çš„ä¸åŒèŠ‚ç‚¹ä¸Šï¼Œä»è€Œå¯ä»¥åœ¨é›†ç¾¤ä¸­çš„ä¸åŒèŠ‚ç‚¹ä¸Šè¿›è¡Œå¹¶è¡Œè®¡ç®—ã€‚è¿™ä¹Ÿæ˜¯å®ƒå¯ä»¥è¢«å¹¶è¡Œå¤„ç†çš„å‰æã€‚åå‘æ¥æ€è€ƒçš„è¯ï¼Œå¦‚æœRDDä¸å¯åˆ†åŒºï¼Œåªæ˜¯ä¸€ä¸ªå•ç‹¬ä¸å¯æ‹†åˆ†çš„æ•°æ®å—ï¼Œé‚£ä¹ˆé›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ€ä¹ˆå¯¹è¿™ä¸ªæºæ•°æ®è¿›è¡Œåˆ†å¸ƒå¼å¹¶è¡Œè®¡ç®—å‘¢ï¼Ÿé€»è¾‘ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸º RDD æ˜¯ä¸€ä¸ªå¤§çš„æ•°ç»„ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å¯ä»¥ä»£è¡¨ä¸€ä¸ªåˆ†åŒºï¼ˆPartitionï¼‰ã€‚åœ¨ç‰©ç†å­˜å‚¨ä¸­ï¼Œæ¯ä¸ªåˆ†åŒºæŒ‡å‘ä¸€ä¸ªå­˜æ”¾åœ¨å †å†…å†…å­˜å’Œå †å¤–å†…å­˜æˆ–è€…ç£ç›˜ä¸­çš„æ•°æ®å—ï¼ˆBlockï¼‰ï¼Œè€Œè¿™äº›æ•°æ®å—æ˜¯ç‹¬ç«‹çš„ï¼Œå®ƒä»¬å¯ä»¥è¢«å­˜æ”¾åœ¨ç³»ç»Ÿä¸­çš„ä¸åŒèŠ‚ç‚¹ã€‚æ‰€ä»¥ï¼ŒRDD åªæ˜¯æŠ½è±¡æ„ä¹‰çš„æ•°æ®é›†åˆï¼Œåˆ†åŒºå†…éƒ¨å¹¶ä¸ä¼šå­˜å‚¨å…·ä½“çš„æ•°æ®ï¼Œä»…ä¿å­˜äº†å…ƒæ•°æ®ä¿¡æ¯ã€‚ä¸‹å›¾å¾ˆå¥½åœ°å±•ç¤ºäº† RDD çš„åˆ†åŒºé€»è¾‘ç»“æ„ï¼šRDD ä¸­çš„æ¯ä¸ªåˆ†åŒºå­˜æœ‰å®ƒåœ¨è¯¥ RDD ä¸­çš„ indexã€‚é€šè¿‡ RDD çš„ ID å’Œåˆ†åŒºçš„ index å¯ä»¥å”¯ä¸€ç¡®å®šå¯¹åº”æ•°æ®å—çš„ç¼–å·ï¼Œä»è€Œé€šè¿‡åº•å±‚å­˜å‚¨å±‚çš„æ¥å£ä¸­æå–åˆ°æ•°æ®è¿›è¡Œå¤„ç†ã€‚åœ¨é›†ç¾¤ä¸­ï¼Œå„ä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®å—ä¼šå°½å¯èƒ½åœ°å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œåªæœ‰å½“å†…å­˜æ²¡æœ‰ç©ºé—´æ—¶æ‰ä¼šå­˜å…¥ç¡¬ç›˜ã€‚è¿™æ ·å¯ä»¥æœ€å¤§åŒ–åœ°å‡å°‘ç¡¬ç›˜è¯»å†™çš„å¼€é”€ã€‚è™½ç„¶ RDD å†…éƒ¨å­˜å‚¨çš„æ•°æ®æ˜¯åªè¯»çš„ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å»ä¿®æ”¹ï¼ˆä¾‹å¦‚é€šè¿‡ repartition è½¬æ¢æ“ä½œï¼‰å¹¶è¡Œè®¡ç®—å•å…ƒçš„åˆ’åˆ†ç»“æ„ï¼Œä¹Ÿå°±æ˜¯åˆ†åŒºçš„æ•°é‡ã€‚ä¸å¯å˜æ€§ä¸å¯å˜æ€§ä»£è¡¨æ¯ä¸€ä¸ª RDD éƒ½æ˜¯åªè¯»çš„ï¼Œå®ƒæ‰€åŒ…å«çš„åˆ†åŒºä¿¡æ¯ä¸å¯ä»¥è¢«æ”¹å˜ã€‚æ—¢ç„¶å·²æœ‰çš„ RDD ä¸å¯ä»¥è¢«æ”¹å˜ï¼Œæˆ‘ä»¬åªå¯ä»¥å¯¹ç°æœ‰çš„ RDD è¿›è¡Œè½¬æ¢ï¼ˆTransformationï¼‰æ“ä½œï¼Œå¾—åˆ°æ–°çš„ RDD ä½œä¸ºä¸­é—´è®¡ç®—çš„ç»“æœã€‚ä¸Šå›¾ä¹Ÿå°±æ˜¯åˆšåˆšæåˆ°çš„é’ˆå¯¹RDDçš„Transformationæ“ä½œä¸­ï¼ŒåŒ…æ‹¬çš„mapç®—å­ï¼ŒflatMapç®—å­ï¼Œfilterç®—å­ï¼Œè¿™äº›ç®—å­æˆ‘ä»¬æ¥ä¸‹æ¥çš„æ–‡ç« åœ¨ä¸€ä¸€è®²è§£ï¼Œè¿™é‡Œæˆ‘æƒ³ç»™å¤§å®¶çœ‹çš„æ˜¯ï¼Œåœ¨ä¸¾ä¾‹çš„è¿™ä¸‰ä¸ªç®—å­å®ç°æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°éƒ½new MapPartitionsRDDï¼ˆï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å¯¹ä¸€ä¸ªå·²æœ‰çš„RDDè¿›è¡Œè½¬æ¢æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œå¹¶ä¸æ˜¯å¯¹è¿™ä¸ªRDDè¿›è¡Œç›´æ¥çš„ä¿®æ”¹ï¼Œå˜æ¢ï¼Œè€Œæ˜¯è¯»å–çˆ¶RDDï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„RDDè¿›è¡Œè½¬æ¢å¹¶ä¸”æœ€åè¿”å›ã€‚é‚£ä¹ˆè¿™æ ·ä¼šå¸¦æ¥ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿæ˜¾ç„¶ï¼Œå¯¹äºä»£è¡¨ä¸­é—´ç»“æœçš„ RDDï¼Œæˆ‘ä»¬éœ€è¦è®°å½•å®ƒæ˜¯é€šè¿‡å“ªä¸ª RDD è¿›è¡Œå“ªäº›è½¬æ¢æ“ä½œå¾—æ¥ï¼Œå³ä¾èµ–å…³ç³»ï¼Œè€Œä¸ç”¨ç«‹åˆ»å»å…·ä½“å­˜å‚¨è®¡ç®—å‡ºçš„æ•°æ®æœ¬èº«ã€‚è¿™æ ·åšæœ‰åŠ©äºæå‡ Spark çš„è®¡ç®—æ•ˆç‡ï¼Œå¹¶ä¸”ä½¿é”™è¯¯æ¢å¤æ›´åŠ å®¹æ˜“ã€‚è¯•æƒ³ï¼Œåœ¨ä¸€ä¸ªæœ‰ N æ­¥çš„è®¡ç®—æ¨¡å‹ä¸­ï¼Œå¦‚æœè®°è½½ç¬¬ N æ­¥è¾“å‡º RDD çš„èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œæ•°æ®ä¸¢å¤±ï¼Œæˆ‘ä»¬å¯ä»¥ä»ç¬¬ N-1 æ­¥çš„ RDD å‡ºå‘ï¼Œå†æ¬¡è®¡ç®—ï¼Œè€Œæ— éœ€é‡å¤æ•´ä¸ª N æ­¥è®¡ç®—è¿‡ç¨‹ã€‚è¿™æ ·çš„å®¹é”™ç‰¹æ€§ä¹Ÿæ˜¯ RDD ä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªâ€œå¼¹æ€§â€çš„æ•°æ®é›†çš„åŸå› ä¹‹ä¸€ã€‚åè¾¹æˆ‘ä»¬ä¼šæåˆ° RDD å¦‚ä½•å­˜å‚¨è¿™æ ·çš„ä¾èµ–å…³ç³»ã€‚å¹¶è¡Œæ“ä½œç”±äºå•ä¸ª RDD çš„åˆ†åŒºç‰¹æ€§ï¼Œä½¿å¾—å®ƒå¤©ç„¶æ”¯æŒå¹¶è¡Œæ“ä½œï¼Œå³ä¸åŒèŠ‚ç‚¹ä¸Šçš„æ•°æ®å¯ä»¥è¢«åˆ†åˆ«å¤„ç†ï¼Œç„¶åäº§ç”Ÿä¸€ä¸ªæ–°çš„ RDDã€‚å®¹é”™æ€§ä¸ºäº†ä¿è¯RDD ä¸­æ•°æ®çš„é²æ£’æ€§ï¼ŒRDDæ•°æ®é›†é€šè¿‡æ‰€è°“çš„è¡€ç»Ÿå…³ç³»(Lineage)è®°ä½äº†å®ƒæ˜¯å¦‚ä½•ä»å…¶å®ƒRDDä¸­æ¼”å˜è¿‡æ¥çš„ã€‚ ç›¸æ¯”å…¶å®ƒç³»ç»Ÿçš„ç»†é¢—ç²’åº¦çš„å†…å­˜æ•°æ®æ›´æ–°çº§åˆ«çš„å¤‡ä»½æˆ–è€…LOGæœºåˆ¶ï¼ŒRDDçš„Lineageè®°å½•çš„æ˜¯ç²—é¢—ç²’åº¦çš„ ç‰¹å®šæ•°æ®è½¬æ¢ï¼ˆTransformationï¼‰æ“ä½œï¼ˆfilter, map, join etc.)è¡Œä¸ºã€‚å½“è¿™ä¸ªRDDçš„éƒ¨åˆ†åˆ†åŒºæ•°æ®ä¸¢å¤±æ—¶ ï¼Œå®ƒå¯ä»¥é€šè¿‡Lineageè·å–è¶³å¤Ÿçš„ä¿¡æ¯æ¥é‡æ–°è¿ç®—å’Œæ¢å¤ä¸¢å¤±çš„æ•°æ®åˆ†åŒºã€‚è¿™ç§ç²—é¢—ç²’çš„æ•°æ®æ¨¡å‹ï¼Œé™åˆ¶ äº†Sparkçš„è¿ç”¨åœºåˆï¼Œä½†åŒæ—¶ç›¸æ¯”ç»†é¢—ç²’åº¦çš„æ•°æ®æ¨¡å‹ï¼Œä¹Ÿå¸¦æ¥äº†æ€§èƒ½çš„æå‡ã€‚å¦å¤–ï¼Œåœ¨RDDè®¡ç®—ä¸­ï¼Œä¹Ÿé€šè¿‡checkpointè¿›è¡Œå®¹é”™ï¼Œåšcheckpointæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ä¸ªæ˜¯checkpoint dataï¼Œä¸€ä¸ªæ˜¯ logging the updatesã€‚ç”¨æˆ·å¯ä»¥æ§åˆ¶é‡‡ç”¨å“ªç§æ–¹å¼æ¥å®ç°å®¹é”™ï¼Œé»˜è®¤æ˜¯logging the updatesæ–¹å¼ï¼Œé€š è¿‡è®°å½•è·Ÿè¸ªæ‰€æœ‰ç”ŸæˆRDDçš„è½¬æ¢ï¼ˆtransformationsï¼‰ä¹Ÿå°±æ˜¯è®°å½•æ¯ä¸ªRDDçš„lineageï¼ˆè¡€ç»Ÿï¼‰æ¥é‡æ–°è®¡ç®— ç”Ÿæˆä¸¢å¤±çš„åˆ†åŒºæ•°æ®ã€‚RDD äº”å¤§ç‰¹æ€§A list of partitionsRDDæ˜¯ä¸€ä¸ªç”±å¤šä¸ªpartitionï¼ˆæŸä¸ªèŠ‚ç‚¹é‡Œçš„æŸä¸€ç‰‡è¿ç»­çš„æ•°æ®ï¼‰ç»„æˆçš„çš„listï¼›å°†æ•°æ®åŠ è½½ä¸ºRDDæ—¶ï¼Œä¸€èˆ¬ä¼šéµå¾ªæ•°æ®çš„æœ¬åœ°æ€§ï¼ˆä¸€èˆ¬ä¸€ä¸ªhdfsé‡Œçš„blockä¼šåŠ è½½ä¸ºä¸€ä¸ªpartitionï¼‰ã€‚A function for computing each splitä¸€ä¸ªå‡½æ•°è®¡ç®—æ¯ä¸€ä¸ªåˆ†ç‰‡ï¼ŒRDDçš„æ¯ä¸ªpartitionä¸Šé¢éƒ½ä¼šæœ‰functionï¼Œä¹Ÿå°±æ˜¯å‡½æ•°åº”ç”¨A list of dependencies on other RDDsRDDä¼šè®°å½•å®ƒçš„ä¾èµ– ï¼Œä¾èµ–è¿˜å…·ä½“åˆ†ä¸ºå®½ä¾èµ–å’Œçª„ä¾èµ–ï¼ŒRDDåœ¨è®¡ç®—çš„è¿‡ç¨‹ä¸­ï¼Œä¸æ–­çš„è½¬æ¢ï¼Œåœ¨å†…å­˜ä¸­ï¼Œä¸è½åœ°ç£ç›˜ï¼Œå¦‚æœæŸä¸€ç¯èŠ‚å‡ºé”™ï¼Œå¯ä»¥æ ¹æ®ä¾èµ–æ¥æ‰¾å›ä¸Šä¸€çŠ¶æ€çš„RDDï¼Œä¸ºäº†å®¹é”™ï¼ˆé‡ç®—ï¼Œcacheï¼Œcheckpointï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å†…å­˜ä¸­çš„RDDæ“ä½œæ—¶å‡ºé”™æˆ–ä¸¢å¤±ä¼šè¿›è¡Œé‡ç®—ã€‚Optionally,a Partitioner for Key-value RDDså¯é€‰é¡¹ï¼Œå¦‚æœRDDé‡Œé¢å­˜çš„æ•°æ®æ˜¯key-valueå½¢å¼ï¼Œåˆ™å¯ä»¥ä¼ é€’ä¸€ä¸ªè‡ªå®šä¹‰çš„Partitionerè¿›è¡Œé‡æ–°åˆ†åŒºï¼Œä¾‹å¦‚è¿™é‡Œè‡ªå®šä¹‰çš„Partitioneræ˜¯åŸºäºkeyè¿›è¡Œåˆ†åŒºï¼Œé‚£åˆ™ä¼šå°†ä¸åŒRDDé‡Œé¢çš„ç›¸åŒkeyçš„æ•°æ®æ”¾åˆ°åŒä¸€ä¸ªpartitioné‡Œé¢Optionally, a list of preferred locations to compute each split onæˆ‘ä»¬çš„åŸåˆ™æ˜¯ç§»åŠ¨è®¡ç®—ï¼Œä¸ç§»åŠ¨æ•°æ®ï¼Œé»˜è®¤çš„æ˜¯ï¼Œç£ç›˜ä¸­çš„æ•°æ®æ˜¯ä½œä¸ºRDDåŠ è½½åˆ°æœ¬æœºçš„å†…å­˜ä¸­ï¼Œä½†æ˜¯ï¼ŒSparkè¿™é‡Œç»™å‡ºäº†ä¸€ä¸ªå¯é€‰é¡¹ï¼Œå¯ä»¥é€‰æ‹©åŠ è½½åˆ°æŒ‡å®šçš„æœºå™¨å†…å­˜ä¸­ï¼Œå°±æ˜¯å¯ä»¥é€‰æ‹©å°†æ•°æ®æ”¾åœ¨é‚£å‡ å°æ€§èƒ½å¥½çš„èŠ‚ç‚¹ä¸ŠRDD ç»“æ„é€šè¿‡ä¸Šè¿°è®²è§£ï¼Œæˆ‘ä»¬äº†è§£äº† RDD çš„åŸºæœ¬ç‰¹æ€§ã€‚è€Œä¸”ï¼Œæˆ‘ä»¬è¿˜æåˆ°æ¯ä¸€ä¸ª RDD é‡Œéƒ½ä¼šåŒ…æ‹¬åˆ†åŒºä¿¡æ¯ã€æ‰€ä¾èµ–çš„çˆ¶ RDD ä»¥åŠé€šè¿‡æ€æ ·çš„è½¬æ¢æ“ä½œæ‰èƒ½ç”±çˆ¶ RDD å¾—æ¥ç­‰ä¿¡æ¯ã€‚å®é™…ä¸Š RDD çš„ç»“æ„è¿œæ¯”ä½ æƒ³è±¡çš„è¦å¤æ‚ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ª RDD çš„ç®€æ˜“ç»“æ„ç¤ºæ„å›¾ï¼šSparkContext æ˜¯æ‰€æœ‰ Spark åŠŸèƒ½çš„å…¥å£ï¼Œå®ƒä»£è¡¨äº†ä¸ Spark èŠ‚ç‚¹çš„è¿æ¥ï¼Œå¯ä»¥ç”¨æ¥åˆ›å»º RDD å¯¹è±¡ä»¥åŠåœ¨èŠ‚ç‚¹ä¸­çš„å¹¿æ’­å˜é‡ç­‰ã€‚ä¸€ä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ª SparkContextã€‚SparkConf åˆ™æ˜¯ä¸€äº›å‚æ•°é…ç½®ä¿¡æ¯ã€‚æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»é˜…è¯»å®˜æ–¹çš„æŠ€æœ¯æ–‡æ¡£ï¼Œä¸€äº›ç›¸å¯¹ä¸é‡è¦çš„æ¦‚å¿µæˆ‘å°±ä¸å†èµ˜è¿°äº†ã€‚Partitions å‰æ–‡ä¸­æˆ‘å·²ç»æåˆ°è¿‡ï¼Œå®ƒä»£è¡¨ RDD ä¸­æ•°æ®çš„é€»è¾‘ç»“æ„ï¼Œæ¯ä¸ª Partition ä¼šæ˜ å°„åˆ°æŸä¸ªèŠ‚ç‚¹å†…å­˜æˆ–ç¡¬ç›˜çš„ä¸€ä¸ªæ•°æ®å—ã€‚Partitioner å†³å®šäº† RDD çš„åˆ†åŒºæ–¹å¼ï¼Œç›®å‰æœ‰ä¸¤ç§ä¸»æµçš„åˆ†åŒºæ–¹å¼ï¼šHash partitioner å’Œ Range partitionerã€‚Hashï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å¯¹æ•°æ®çš„ Key è¿›è¡Œæ•£åˆ—åˆ†åŒºï¼ŒRange åˆ™æ˜¯æŒ‰ç…§ Key çš„æ’åºè¿›è¡Œå‡åŒ€åˆ†åŒºã€‚æ­¤å¤–æˆ‘ä»¬è¿˜å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„ Partitionerã€‚ä¾èµ–å…³ç³»Dependencies æ˜¯ RDD ä¸­æœ€é‡è¦çš„ç»„ä»¶ä¹‹ä¸€ã€‚å¦‚å‰æ–‡æ‰€è¯´ï¼ŒSpark ä¸éœ€è¦å°†æ¯ä¸ªä¸­é—´è®¡ç®—ç»“æœè¿›è¡Œæ•°æ®å¤åˆ¶ä»¥é˜²æ•°æ®ä¸¢å¤±ï¼Œå› ä¸ºæ¯ä¸€æ­¥äº§ç”Ÿçš„ RDD é‡Œéƒ½ä¼šå­˜å‚¨å®ƒçš„ä¾èµ–å…³ç³»ï¼Œå³å®ƒæ˜¯é€šè¿‡å“ªä¸ª RDD ç»è¿‡å“ªä¸ªè½¬æ¢æ“ä½œå¾—åˆ°çš„ã€‚ç»†å¿ƒçš„è¯»è€…ä¼šé—®è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œçˆ¶ RDD çš„åˆ†åŒºå’Œå­ RDD çš„åˆ†åŒºä¹‹é—´æ˜¯å¦æ˜¯ä¸€å¯¹ä¸€çš„å¯¹åº”å…³ç³»å‘¢ï¼ŸSpark æ”¯æŒä¸¤ç§ä¾èµ–å…³ç³»ï¼šçª„ä¾èµ–ï¼ˆNarrow Dependencyï¼‰å’Œå®½ä¾èµ–ï¼ˆWide Dependencyï¼‰ã€‚çª„ä¾èµ–å°±æ˜¯çˆ¶ RDD çš„åˆ†åŒºå¯ä»¥ä¸€ä¸€å¯¹åº”åˆ°å­ RDD çš„åˆ†åŒºï¼Œå®½ä¾èµ–å°±æ˜¯çˆ¶ RDD çš„æ¯ä¸ªåˆ†åŒºå¯ä»¥è¢«å¤šä¸ªå­ RDD çš„åˆ†åŒºä½¿ç”¨ã€‚æ˜¾ç„¶ï¼Œçª„ä¾èµ–å…è®¸å­ RDD çš„æ¯ä¸ªåˆ†åŒºå¯ä»¥è¢«å¹¶è¡Œå¤„ç†äº§ç”Ÿï¼Œè€Œå®½ä¾èµ–åˆ™å¿…é¡»ç­‰çˆ¶ RDD çš„æ‰€æœ‰åˆ†åŒºéƒ½è¢«è®¡ç®—å¥½ä¹‹åæ‰èƒ½å¼€å§‹å¤„ç†ã€‚å®½ä¾èµ–æœ¬è´¨å°±æ˜¯shuffle,è®¡ç®—ä»£ä»·å¤§,ç»è¿‡å¤§é‡shuffleç”Ÿæˆçš„RDDï¼Œå»ºè®®è¿›è¡Œç¼“å­˜ã€‚è¿™æ ·é¿å…å¤±è´¥åé‡æ–°è®¡ç®—å¸¦æ¥çš„å¼€é”€å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸€äº›è½¬æ¢æ“ä½œå¦‚ mapã€filter ä¼šäº§ç”Ÿçª„ä¾èµ–å…³ç³»ï¼Œè€Œ Joinã€groupBy åˆ™ä¼šç”Ÿæˆå®½ä¾èµ–å…³ç³»ã€‚è¿™å¾ˆå®¹æ˜“ç†è§£ï¼Œå› ä¸º map æ˜¯å°†åˆ†åŒºé‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ é€šè¿‡è®¡ç®—è½¬åŒ–ä¸ºå¦ä¸€ä¸ªå…ƒç´ ï¼Œä¸€ä¸ªåˆ†åŒºé‡Œçš„æ•°æ®ä¸ä¼šè·‘åˆ°ä¸¤ä¸ªä¸åŒçš„åˆ†åŒºã€‚è€Œ groupBy åˆ™è¦å°†æ‹¥æœ‰æ‰€æœ‰åˆ†åŒºé‡Œæœ‰ç›¸åŒ Key çš„å…ƒç´ æ”¾åˆ°åŒä¸€ä¸ªç›®æ ‡åˆ†åŒºï¼Œè€Œæ¯ä¸€ä¸ªçˆ¶åˆ†åŒºéƒ½å¯èƒ½åŒ…å«å„ç§ Key çš„å…ƒç´ ï¼Œæ‰€ä»¥å®ƒå¯èƒ½è¢«ä»»æ„ä¸€ä¸ªå­åˆ†åŒºæ‰€ä¾èµ–ã€‚Spark ä¹‹æ‰€ä»¥è¦åŒºåˆ†å®½ä¾èµ–å’Œçª„ä¾èµ–æ˜¯å‡ºäºä»¥ä¸‹ä¸¤ç‚¹è€ƒè™‘ï¼šçª„ä¾èµ–å¯ä»¥æ”¯æŒåœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šé“¾å¼æ‰§è¡Œå¤šæ¡å‘½ä»¤ï¼Œä¾‹å¦‚åœ¨æ‰§è¡Œäº† map åï¼Œç´§æ¥ç€æ‰§è¡Œ filterã€‚ç›¸åï¼Œå®½ä¾èµ–éœ€è¦æ‰€æœ‰çš„çˆ¶åˆ†åŒºéƒ½æ˜¯å¯ç”¨çš„ï¼Œå¯èƒ½è¿˜éœ€è¦è°ƒç”¨ç±»ä¼¼ MapReduce ä¹‹ç±»çš„æ“ä½œè¿›è¡Œè·¨èŠ‚ç‚¹ä¼ é€’ã€‚ä»å¤±è´¥æ¢å¤çš„è§’åº¦è€ƒè™‘ï¼Œçª„ä¾èµ–çš„å¤±è´¥æ¢å¤æ›´æœ‰æ•ˆï¼Œå› ä¸ºå®ƒåªéœ€è¦é‡æ–°è®¡ç®—ä¸¢å¤±çš„çˆ¶åˆ†åŒºå³å¯ï¼Œè€Œå®½ä¾èµ–ç‰µæ¶‰åˆ° RDD å„çº§çš„å¤šä¸ªçˆ¶åˆ†åŒºã€‚DAGç»“åˆä¸Šç¯‡sparkè¿è¡ŒåŸç†å’Œè¿™ç¯‡RDDçš„è®²è¿°ï¼Œæˆ‘ä»¬æ¥è®²ä¸€ä¸‹å…³äºä»»åŠ¡è¿è¡Œä¸­ï¼ŒJobï¼ŒStageï¼ŒTaskçš„åˆ’åˆ†sparkä»»åŠ¡è¿è¡Œä¸­ï¼Œä¼šå­˜åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªJobï¼Œactionç®—å­çš„è§¦å‘ä¼šç”Ÿæˆä¸€ä¸ªJob, Jobä¼šæäº¤ç»™DAGScheduler,åˆ†è§£æˆStageã€‚ä¸Šå›¾æ˜¯ä¸€ä¸ªjobè¢«åˆ‡å‰²æˆä¸‰ä¸ªStageï¼Œæ¯ä¸ªstageä¸­æœ‰åŒ…å«ä¸ç”¨ä¸ªæ•°çš„partitionï¼Œæ¯ä¸ªpartitionåœ¨è®¡ç®—çš„æ—¶å€™å¯¹åº”ä¸€ä¸ªtaskï¼Œå½±å“ç¨‹åºçš„å¹¶è¡Œåº¦ã€‚jobåˆ†å‰²stageçš„è§„åˆ™æ˜¯ä»Gç«¯å‘å‰å¼€å§‹åˆ†å‰²ï¼Œé‡åˆ°å®½ä¾èµ–ï¼Œå°±åˆ†å‰²ä¸€ä¸ªstage.ã€‚Fâ€“&gt;G åˆ‡å‰² stage2 å’Œ stage3Aâ€“&gt;B stage1ä¸Šå›¾ï¼Œç¨‹åºçš„è¿è¡Œæœ€å°å•å…ƒæ˜¯Taskï¼Œå°±æ‹¿stage2æ¥ä¸¾ä¾‹ï¼šstage2æœ‰4ä¸ªTask: Cç«¯æœ‰2ä¸ªpartitionï¼ŒEç«¯æœ‰ä¸¤ä¸ªpartitionã€‚æ¯ä¸ªpartitionä¸ºå¼€å§‹ï¼Œæœ€ç»ˆåˆ°Fç«¯ï¼Œä½œä¸ºä¸€ä¸ªTaskã€‚ å…¶ä¸­Bé˜¶æ®µå‘¢ï¼Œå±äºä¸€ä¸ªç¨‹åºçº§åˆ«çš„ä¼˜åŒ–æ“ä½œã€‚ä¸€èˆ¬åˆ†å¸ƒå¼ç¨‹åºä¸­ï¼Œä¸ºäº†è®©ç¨‹åºèƒ½å¹³ç¨³çš„æ‰§è¡Œï¼Œå°±è¦åšä¸€äº›ä¼˜åŒ–æ“ä½œã€‚åœ¨ä»¥åçš„Sparkå¼€å‘ä¸­ï¼Œæˆ‘ä»¬åœ¨Web UIä¸­ä¼šç»å¸¸çœ‹åˆ°ç±»ä¼¼äºä¸‹å›¾çš„å·¥ä½œæµç¨‹ï¼Œè¿™é‡Œå±•ç¤ºäº†ä¸€ä¸ªJobçš„åˆ’åˆ†å’Œå¯¹åº”æ“ä½œçš„ç»†èŠ‚ã€‚How use RDDä¸Šé¢è®²äº†å¾ˆé•¿ç¯‡å¹…çš„RDDæ¦‚å¿µå’Œå±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•å¼€å§‹å®æ“RDDå‘¢ï¼Ÿæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªRDDæ¥è‡ªå“ªé‡Œï¼Ÿä¸Šé¢æˆ‘è¯´è¿‡äº†ï¼Œå…¶å®RDDå°±æ˜¯æˆ‘ä»¬è¦è¿›è¡Œå¤„ç†çš„æºæ•°æ®é›†åˆã€‚åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¯¹äºç¦»çº¿æ•°æ®åˆ†æï¼Œå¤§å¤šæ•°çš„åœºæ™¯ä¸‹ï¼Œæºæ•°æ®å¯ä»¥æ˜¯Sparkä»Hiveã€HBaseä¸­è¯»å–ï¼Œè½¬åŒ–æˆRDDï¼Œå†ç»†å°ä¸€ç‚¹çš„åœºæ™¯ï¼Œæºæ•°æ®å¯ä»¥æ˜¯ä¸€ä¸ªcsvæŠ¥è¡¨æ•°æ®ï¼Œè¯»å–ç›®æ ‡CSVè¿›è¡ŒRDDçš„è½¬æ¢ã€‚é‚£ä¹ˆåœ¨ä¸‹é¢çš„è®²è§£ä¸­ï¼Œæˆ‘ä»¬æ— éœ€å¯¹æ¥ä¸Šæ¸¸ç”Ÿäº§ç¯å¢ƒçš„æ•°æ®æºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨IDEAä¸­ç›´æ¥è¿›è¡ŒRDDçš„åˆ›å»ºï¼Œéšåå†è¿›è¡Œå„ç§è½¬æ¢ç®—å­å’Œè¡ŒåŠ¨ç®—å­çš„æ“ä½œæ¼”ç¤ºåˆ›å»ºRDDRDDçš„åˆ›å»ºæœ‰ä¸‰ç§æ–¹æ³•åˆ©ç”¨å†…å­˜ä¸­é›†åˆä¸­åˆ›å»ºåˆ©ç”¨å¤–éƒ¨æ–‡ä»¶åˆ›å»ºç”±å…¶ä»–RDDåˆ›å»ºæ–°çš„RDDä»é›†åˆä¸­åˆ›å»ºå¯ä»¥ä½¿ç”¨parallelize() å’Œ makeRDD()æ–¹æ³•åˆ›å»ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éœ€è¦æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ˜¯ Seq[T] é›†åˆï¼Œè¿”å›çš„éƒ½æ˜¯RDD[T]ã€‚æ³¨æ„ï¼ŒmakeRDDç»™äº†ä¸¤ç§æ–¹æ³•ï¼Œè¿™é‡Œå…ˆè®°ä¸ºç¬¬ä¸€ç§makeRDDå’Œç¬¬äºŒç§makeRDDè¿™é‡Œï¼Œå…ˆæŠŠæºç poå‡ºæ¥å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ï¼Œç¬¬ä¸€ç§makeRDDçš„æºç å®ç°ä¸­ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨äº†parallelizeï¼ˆï¼‰ï¼Œå¹¶ä¸”éƒ½å¯ä»¥æŒ‡å®šåˆ†åŒºæ•°é‡ï¼Œè€Œä¸”åœ¨æ³¨é‡Šä¸­æ¸…æ™°çš„å†™æ˜äº†ï¼Œç¬¬ä¸€ç§makeRDDå’Œparallelizeæ˜¯identicalï¼ˆå®Œå…¨ç›¸åŒçš„ï¼‰ã€‚å†æ¥çœ‹ç¬¬äºŒç§makeRDDï¼Œç¬¬äºŒç§å®ç°å¯ä»¥ä¸ºæ•°æ®æä¾›ä½ç½®ä¿¡æ¯ï¼Œå¹¶ä¸”ä¸èƒ½æŒ‡å®šRDDçš„åˆ†åŒºæ•°é‡ï¼Œé™¤æ­¤ä¹‹å¤–çš„å®ç°å’Œparallelizeå‡½æ•°ä¹Ÿæ˜¯ä¸€è‡´çš„åˆ›å»ºç¤ºä¾‹ï¼š123456789val make_rdd: RDD[Int] = sc.makeRDD(List(1,2,3,4))val make_rdd_1: RDD[String] = sc.parallelize(Array(\"Brent\",\"HayLee\",\"Henry\"))val make_rdd_2: RDD[Int] = sc.makeRDD(List(1,2,3,4),2)val make_rdd_3: RDD[String] = sc.parallelize(Array(\"Brent\",\"HayLee\",\"Henry\"),4)println(make_rdd.partitions.size)println(make_rdd_1.partitions.size)println(make_rdd_2.partitions.size)println(make_rdd_3.partitions.size)ç»“æœï¼š12341124**å¤–éƒ¨æ–‡ä»¶åˆ›å»º****1234sc.textFile(\"hdfs://hadoop000:9000/xxx/data.txt\") // è¯»å–hdfsæ–‡ä»¶sc.textFile(\"data.txt\") // è¿™é‡Œçº¯ç²¹çš„æœ¬åœ°æ–‡ä»¶æ˜¯ä¸æ¨èçš„ï¼Œ å› ä¸ºè¿™ä¸ªæ–‡ä»¶è®¿é—®æ˜¯é’ˆå¯¹æ¯ä¸€ä¸ªWorkeréƒ½è¦æ˜¯èƒ½è®¿é—®çš„ æ¢è¨€ä¹‹,å¦‚æœæ˜¯æœ¬åœ°æ–‡ä»¶,åˆ™å¿…é¡»ä¿è¯æ¯ä¸€ä¸ªWorkerçš„æœ¬åœ°éƒ½æœ‰ä¸€ä»½è¿™ä¸ªæ–‡ä»¶RDD ç®—å­æ“ä½œRDD çš„æ•°æ®æ“ä½œåˆ†ä¸ºä¸¤ç§ï¼šè½¬æ¢ï¼ˆTransformationï¼‰å’ŒåŠ¨ä½œï¼ˆActionï¼‰ã€‚é¡¾åæ€ä¹‰ï¼Œè½¬æ¢æ˜¯ç”¨æ¥æŠŠä¸€ä¸ª RDD è½¬æ¢æˆå¦ä¸€ä¸ª RDDï¼Œè€ŒåŠ¨ä½œåˆ™æ˜¯é€šè¿‡è®¡ç®—è¿”å›ä¸€ä¸ªç»“æœã€‚ä¸‹è¡¨åˆ—å‡ºäº†ä¸€äº› Spark å¸¸ç”¨çš„ transformationsï¼ˆè½¬æ¢ï¼‰ã€‚è¯¦æƒ…è¯·å‚è€ƒ RDD API æ–‡æ¡£ï¼ˆScalaï¼ŒJavaï¼ŒPythonï¼ŒRï¼‰å’Œ pair RDD å‡½æ•°æ–‡æ¡£ï¼ˆScalaï¼ŒJavaï¼‰Transformationï¼ˆè½¬æ¢ï¼‰Meaningï¼ˆå«ä¹‰ï¼‰map(func)è¿”å›ä¸€ä¸ªæ–°çš„ distributed datasetï¼ˆåˆ†å¸ƒå¼æ•°æ®é›†ï¼‰ï¼Œå®ƒç”±æ¯ä¸ª sourceï¼ˆæ•°æ®æºï¼‰ä¸­çš„å…ƒç´ åº”ç”¨ä¸€ä¸ªå‡½æ•° func æ¥ç”Ÿæˆã€‚filter(func)è¿”å›ä¸€ä¸ªæ–°çš„ distributed datasetï¼ˆåˆ†å¸ƒå¼æ•°æ®é›†ï¼‰ï¼Œå®ƒç”±æ¯ä¸ª sourceï¼ˆæ•°æ®æºï¼‰ä¸­åº”ç”¨ä¸€ä¸ªå‡½æ•° func ä¸”è¿”å›å€¼ä¸º true çš„å…ƒç´ æ¥ç”Ÿæˆã€‚flatMap(func)ä¸ map ç±»ä¼¼ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªè¾“å…¥çš„ item å¯ä»¥è¢«æ˜ å°„æˆ 0 ä¸ªæˆ–å¤šä¸ªè¾“å‡ºçš„ itemsï¼ˆæ‰€ä»¥ func åº”è¯¥è¿”å›ä¸€ä¸ª Seq è€Œä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„ itemï¼‰ã€‚mapPartitions(func)ä¸ map ç±»ä¼¼ï¼Œä½†æ˜¯å•ç‹¬çš„è¿è¡Œåœ¨åœ¨æ¯ä¸ª RDD çš„ partitionï¼ˆåˆ†åŒºï¼Œblockï¼‰ä¸Šï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªç±»å‹ä¸º T çš„ RDD ä¸Šè¿è¡Œæ—¶ func å¿…é¡»æ˜¯ Iterator=&gt; Iterator ç±»å‹ã€‚mapPartitionsWithIndex(func)ä¸ mapPartitions ç±»ä¼¼ï¼Œä½†æ˜¯ä¹Ÿéœ€è¦æä¾›ä¸€ä¸ªä»£è¡¨ partition çš„ indexï¼ˆç´¢å¼•ï¼‰çš„ interger valueï¼ˆæ•´å‹å€¼ï¼‰ä½œä¸ºå‚æ•°çš„ func_ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªç±»å‹ä¸º T çš„ RDD ä¸Šè¿è¡Œæ—¶ _func å¿…é¡»æ˜¯ (Int, Iterator) =&gt; Iterator ç±»å‹ã€‚sample(withReplacement, fraction, seed)æ ·æœ¬æ•°æ®ï¼Œè®¾ç½®æ˜¯å¦æ”¾å›ï¼ˆwithReplacementï¼‰ï¼Œé‡‡æ ·çš„ç™¾åˆ†æ¯”ï¼ˆ_fraction_ï¼‰ã€ä½¿ç”¨æŒ‡å®šçš„éšæœºæ•°ç”Ÿæˆå™¨çš„ç§å­ï¼ˆseedï¼‰ã€‚union(otherDataset)è¿”å›ä¸€ä¸ªæ–°çš„ datasetï¼Œå®ƒåŒ…å«äº† source datasetï¼ˆæºæ•°æ®é›†ï¼‰å’Œ otherDatasetï¼ˆå…¶å®ƒæ•°æ®é›†ï¼‰çš„å¹¶é›†ã€‚intersection(otherDataset)è¿”å›ä¸€ä¸ªæ–°çš„ RDDï¼Œå®ƒåŒ…å«äº† source datasetï¼ˆæºæ•°æ®é›†ï¼‰å’Œ otherDatasetï¼ˆå…¶å®ƒæ•°æ®é›†ï¼‰çš„äº¤é›†ã€‚distinct([_numTasks_]))è¿”å›ä¸€ä¸ªæ–°çš„ datasetï¼Œå®ƒåŒ…å«äº† source datasetï¼ˆæºæ•°æ®é›†ï¼‰ä¸­å»é‡çš„å…ƒç´ ã€‚groupByKey([_numTasks_])åœ¨ä¸€ä¸ª (K, V) pair çš„ dataset ä¸Šè°ƒç”¨æ—¶ï¼Œè¿”å›ä¸€ä¸ª (K, Iterable) .Note: å¦‚æœåˆ†ç»„æ˜¯ä¸ºäº†åœ¨æ¯ä¸€ä¸ª key ä¸Šæ‰§è¡Œèšåˆæ“ä½œï¼ˆä¾‹å¦‚ï¼Œsum æˆ– average)ï¼Œæ­¤æ—¶ä½¿ç”¨ reduceByKey æˆ– aggregateByKey æ¥è®¡ç®—æ€§èƒ½ä¼šæ›´å¥½.Note: é»˜è®¤æƒ…å†µä¸‹ï¼Œå¹¶è¡Œåº¦å–å†³äºçˆ¶ RDD çš„åˆ†åŒºæ•°ã€‚å¯ä»¥ä¼ é€’ä¸€ä¸ªå¯é€‰çš„ numTasks å‚æ•°æ¥è®¾ç½®ä¸åŒçš„ä»»åŠ¡æ•°ã€‚reduceByKey(func, [_numTasks_])åœ¨ (K, V) pairs çš„ dataset ä¸Šè°ƒç”¨æ—¶ï¼Œè¿”å› dataset of (K, V) pairs çš„ datasetï¼Œå…¶ä¸­çš„ values æ˜¯é’ˆå¯¹æ¯ä¸ª key ä½¿ç”¨ç»™å®šçš„å‡½æ•° func æ¥è¿›è¡Œèšåˆçš„ï¼Œå®ƒå¿…é¡»æ˜¯ type (V,V) =&gt; V çš„ç±»å‹ã€‚åƒ groupByKey ä¸€æ ·ï¼Œreduce tasks çš„æ•°é‡æ˜¯å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå¯é€‰çš„å‚æ•°æ¥é…ç½®çš„ã€‚aggregateByKey(zeroValue)(seqOp, combOp, [_numTasks_])åœ¨ (K, V) pairs çš„ dataset ä¸Šè°ƒç”¨æ—¶ï¼Œè¿”å› (K, U) pairs çš„ datasetï¼Œå…¶ä¸­çš„ values æ˜¯é’ˆå¯¹æ¯ä¸ª key ä½¿ç”¨ç»™å®šçš„ combine å‡½æ•°ä»¥åŠä¸€ä¸ª neutral â€œ0â€ å€¼æ¥è¿›è¡Œèšåˆçš„ã€‚å…è®¸èšåˆå€¼çš„ç±»å‹ä¸è¾“å…¥å€¼çš„ç±»å‹ä¸ä¸€æ ·ï¼ŒåŒæ—¶é¿å…ä¸å¿…è¦çš„é…ç½®ã€‚åƒ groupByKey ä¸€æ ·ï¼Œreduce tasks çš„æ•°é‡æ˜¯å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå¯é€‰çš„å‚æ•°æ¥é…ç½®çš„ã€‚sortByKey([_ascending_], [_numTasks_])åœ¨ä¸€ä¸ª (K, V) pair çš„ dataset ä¸Šè°ƒç”¨æ—¶ï¼Œå…¶ä¸­çš„ K å®ç°äº† Orderedï¼Œè¿”å›ä¸€ä¸ªæŒ‰ keys å‡åºæˆ–é™åºçš„ (K, V) pairs çš„ datasetï¼Œç”± boolean ç±»å‹çš„ ascending å‚æ•°æ¥æŒ‡å®šã€‚join(otherDataset, [_numTasks_])åœ¨ä¸€ä¸ª (K, V) å’Œ (K, W) ç±»å‹çš„ dataset ä¸Šè°ƒç”¨æ—¶ï¼Œè¿”å›ä¸€ä¸ª (K, (V, W)) pairs çš„ datasetï¼Œå®ƒæ‹¥æœ‰æ¯ä¸ª key ä¸­æ‰€æœ‰çš„å…ƒç´ å¯¹ã€‚Outer joins å¯ä»¥é€šè¿‡ leftOuterJoin, rightOuterJoin å’Œ fullOuterJoin æ¥å®ç°ã€‚cogroup(otherDataset, [_numTasks_])åœ¨ä¸€ä¸ª (K, V) å’Œçš„ dataset ä¸Šè°ƒç”¨æ—¶ï¼Œè¿”å›ä¸€ä¸ª (K, (Iterable, Iterable)) tuples çš„ datasetã€‚è¿™ä¸ªæ“ä½œä¹Ÿè°ƒç”¨äº† groupWithã€‚cartesian(otherDataset)åœ¨ä¸€ä¸ª T å’Œ U ç±»å‹çš„ dataset ä¸Šè°ƒç”¨æ—¶ï¼Œè¿”å›ä¸€ä¸ª (T, U) pairs ç±»å‹çš„ datasetï¼ˆæ‰€æœ‰å…ƒç´ çš„ pairsï¼Œå³ç¬›å¡å°”ç§¯ï¼‰ã€‚pipe(command, [envVars])é€šè¿‡ä½¿ç”¨ shell å‘½ä»¤æ¥å°†æ¯ä¸ª RDD çš„åˆ†åŒºç»™ Pipeã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª Perl æˆ– bash è„šæœ¬ã€‚RDD çš„å…ƒç´ ä¼šè¢«å†™å…¥è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰ï¼Œå¹¶ä¸” linesï¼ˆè¡Œï¼‰è¾“å‡ºåˆ°å®ƒçš„æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰è¢«ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å‹ RDD çš„ string è¿”å›ã€‚coalesce(numPartitions)Decreaseï¼ˆé™ä½ï¼‰RDD ä¸­ partitionsï¼ˆåˆ†åŒºï¼‰çš„æ•°é‡ä¸º numPartitionsã€‚å¯¹äºæ‰§è¡Œè¿‡æ»¤åä¸€ä¸ªå¤§çš„ dataset æ“ä½œæ˜¯æ›´æœ‰æ•ˆçš„ã€‚repartition(numPartitions)Reshuffleï¼ˆé‡æ–°æ´—ç‰Œï¼‰RDD ä¸­çš„æ•°æ®ä»¥åˆ›å»ºæˆ–è€…æ›´å¤šçš„ partitionsï¼ˆåˆ†åŒºï¼‰å¹¶å°†æ¯ä¸ªåˆ†åŒºä¸­çš„æ•°æ®å°½é‡ä¿æŒå‡åŒ€ã€‚è¯¥æ“ä½œæ€»æ˜¯é€šè¿‡ç½‘ç»œæ¥ shuffles æ‰€æœ‰çš„æ•°æ®ã€‚repartitionAndSortWithinPartitions(partitioner)æ ¹æ®ç»™å®šçš„ partitionerï¼ˆåˆ†åŒºå™¨ï¼‰å¯¹ RDD è¿›è¡Œé‡æ–°åˆ†åŒºï¼Œå¹¶åœ¨æ¯ä¸ªç»“æœåˆ†åŒºä¸­ï¼ŒæŒ‰ç…§ key å€¼å¯¹è®°å½•æ’åºã€‚è¿™æ¯”æ¯ä¸€ä¸ªåˆ†åŒºä¸­å…ˆè°ƒç”¨ repartition ç„¶åå† sortingï¼ˆæ’åºï¼‰æ•ˆç‡æ›´é«˜ï¼Œå› ä¸ºå®ƒå¯ä»¥å°†æ’åºè¿‡ç¨‹æ¨é€åˆ° shuffle æ“ä½œçš„æœºå™¨ä¸Šè¿›è¡Œã€‚ä¸‹è¡¨åˆ—å‡ºäº†ä¸€äº› Spark å¸¸ç”¨çš„ actions æ“ä½œã€‚è¯¦ç»†è¯·å‚è€ƒ RDD API æ–‡æ¡£ï¼ˆScalaï¼ŒJavaï¼ŒPythonï¼ŒRï¼‰å’Œ pair RDD å‡½æ•°æ–‡æ¡£ï¼ˆScalaï¼ŒJavaï¼‰ã€‚Actionï¼ˆåŠ¨ä½œï¼‰Meaningï¼ˆå«ä¹‰ï¼‰reduce(func)ä½¿ç”¨å‡½æ•° func èšåˆ dataset ä¸­çš„å…ƒç´ ï¼Œè¿™ä¸ªå‡½æ•° func è¾“å…¥ä¸ºä¸¤ä¸ªå…ƒç´ ï¼Œè¿”å›ä¸ºä¸€ä¸ªå…ƒç´ ã€‚è¿™ä¸ªå‡½æ•°åº”è¯¥æ˜¯å¯äº¤æ¢ï¼ˆcommutativeï¼‰å’Œå…³è”ï¼ˆassociativeï¼‰çš„ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯å®ƒå¯ä»¥è¢«å¹¶è¡Œåœ°æ­£ç¡®è®¡ç®—ã€‚collect()åœ¨ driver ç¨‹åºä¸­ï¼Œä»¥ä¸€ä¸ª array æ•°ç»„çš„å½¢å¼è¿”å› dataset çš„æ‰€æœ‰å…ƒç´ ã€‚è¿™åœ¨è¿‡æ»¤å™¨ï¼ˆfilterï¼‰æˆ–å…¶ä»–æ“ä½œï¼ˆother operationï¼‰ä¹‹åè¿”å›è¶³å¤Ÿå°ï¼ˆsufficiently smallï¼‰çš„æ•°æ®å­é›†é€šå¸¸æ˜¯æœ‰ç”¨çš„ã€‚count()è¿”å› dataset ä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚first()è¿”å› dataset ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆç±»ä¼¼äº take(1)ã€‚take(n)å°†æ•°æ®é›†ä¸­çš„å‰ n ä¸ªå…ƒç´ ä½œä¸ºä¸€ä¸ª array æ•°ç»„è¿”å›ã€‚takeSample(withReplacement, num, [_seed_])å¯¹ä¸€ä¸ª dataset è¿›è¡ŒéšæœºæŠ½æ ·ï¼Œè¿”å›ä¸€ä¸ªåŒ…å« num ä¸ªéšæœºæŠ½æ ·ï¼ˆrandom sampleï¼‰å…ƒç´ çš„æ•°ç»„ï¼Œå‚æ•° withReplacement æŒ‡å®šæ˜¯å¦æœ‰æ”¾å›æŠ½æ ·ï¼Œå‚æ•° seed æŒ‡å®šç”Ÿæˆéšæœºæ•°çš„ç§å­ã€‚takeOrdered(n, [ordering])è¿”å› RDD æŒ‰è‡ªç„¶é¡ºåºï¼ˆnatural orderï¼‰æˆ–è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼ˆcustom comparatorï¼‰æ’åºåçš„å‰ n ä¸ªå…ƒç´ ã€‚saveAsTextFile(path)å°† dataset ä¸­çš„å…ƒç´ ä»¥æ–‡æœ¬æ–‡ä»¶ï¼ˆæˆ–æ–‡æœ¬æ–‡ä»¶é›†åˆï¼‰çš„å½¢å¼å†™å…¥æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€HDFS æˆ–å…¶å®ƒ Hadoop æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿä¸­çš„ç»™å®šç›®å½•ä¸­ã€‚Spark å°†å¯¹æ¯ä¸ªå…ƒç´ è°ƒç”¨ toString æ–¹æ³•ï¼Œå°†æ•°æ®å…ƒç´ è½¬æ¢ä¸ºæ–‡æœ¬æ–‡ä»¶ä¸­çš„ä¸€è¡Œè®°å½•ã€‚saveAsSequenceFile(path)(Java and Scala)å°† dataset ä¸­çš„å…ƒç´ ä»¥ Hadoop SequenceFile çš„å½¢å¼å†™å…¥åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€HDFS æˆ–å…¶å®ƒ Hadoop æ”¯æŒçš„æ–‡ä»¶ç³»ç»ŸæŒ‡å®šçš„è·¯å¾„ä¸­ã€‚è¯¥æ“ä½œå¯ä»¥åœ¨å®ç°äº† Hadoop çš„ Writable æ¥å£çš„é”®å€¼å¯¹ï¼ˆkey-value pairsï¼‰çš„ RDD ä¸Šä½¿ç”¨ã€‚åœ¨ Scala ä¸­ï¼Œå®ƒè¿˜å¯ä»¥éšå¼è½¬æ¢ä¸º Writable çš„ç±»å‹ï¼ˆSpark åŒ…æ‹¬äº†åŸºæœ¬ç±»å‹çš„è½¬æ¢ï¼Œä¾‹å¦‚ Intï¼ŒDoubleï¼ŒString ç­‰ç­‰)ã€‚saveAsObjectFile(path)(Java and Scala)ä½¿ç”¨ Java åºåˆ—åŒ–ï¼ˆserializationï¼‰ä»¥ç®€å•çš„æ ¼å¼ï¼ˆsimple formatï¼‰ç¼–å†™æ•°æ®é›†çš„å…ƒç´ ï¼Œç„¶åä½¿ç”¨ SparkContext.objectFile() è¿›è¡ŒåŠ è½½ã€‚countByKey()ä»…é€‚ç”¨äºï¼ˆK,Vï¼‰ç±»å‹çš„ RDDã€‚è¿”å›å…·æœ‰æ¯ä¸ª key çš„è®¡æ•°çš„ï¼ˆK , Intï¼‰pairs çš„ hashmapã€‚foreach(func)å¯¹ dataset ä¸­æ¯ä¸ªå…ƒç´ è¿è¡Œå‡½æ•° _func_ã€‚è¿™é€šå¸¸ç”¨äºå‰¯ä½œç”¨ï¼ˆside effectsï¼‰ï¼Œä¾‹å¦‚æ›´æ–°ä¸€ä¸ª Accumulatorï¼ˆç´¯åŠ å™¨ï¼‰æˆ–ä¸å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿï¼ˆexternal storage systemsï¼‰è¿›è¡Œäº¤äº’ã€‚Noteï¼šä¿®æ”¹é™¤ foreach()ä¹‹å¤–çš„ç´¯åŠ å™¨ä»¥å¤–çš„å˜é‡ï¼ˆvariablesï¼‰å¯èƒ½ä¼šå¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºï¼ˆundefined behaviorï¼‰ã€‚è¯¦ç»†ä»‹ç»è¯·é˜…è¯» Understanding closuresï¼ˆç†è§£é—­åŒ…ï¼‰ éƒ¨åˆ†ã€‚è¯¥ Spark RDD API è¿˜æš´éœ²äº†ä¸€äº› actionsï¼ˆæ“ä½œï¼‰çš„å¼‚æ­¥ç‰ˆæœ¬ï¼Œä¾‹å¦‚é’ˆå¯¹ foreach çš„ foreachAsyncï¼Œå®ƒä»¬ä¼šç«‹å³è¿”å›ä¸€ä¸ªFutureAction åˆ°è°ƒç”¨è€…ï¼Œè€Œä¸æ˜¯åœ¨å®Œæˆ action æ—¶é˜»å¡ã€‚è¿™å¯ä»¥ç”¨äºç®¡ç†æˆ–ç­‰å¾… action çš„å¼‚æ­¥æ‰§è¡Œã€‚éƒ¨åˆ†Transformationç®—å­æ“ä½œï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960package rddimport org.apache.spark.rdd.RDDimport org.apache.spark.&#123;SparkConf, SparkContext&#125;object transformation_func &#123; def main(args: Array[String]): Unit =&#123; val sparkConf: SparkConf = new SparkConf() .setAppName(\"transformation_func\") .setMaster(\"local\") val sc = new SparkContext(sparkConf) var original_rdd: RDD[(String, Int)] = sc.parallelize(Array((\"a\", 1), (\"b\", 1), (\"a\", 2),(\"c\",4),(\"c\",4)),2) var map_rdd: RDD[(String, Int)] = original_rdd.map(x =&gt;(x._1,x._2+1)) println(\"mapæ“ä½œï¼šå¯¹original_rddæ¯ä¸ªæ•°æ®çš„ç¬¬äºŒä¸ªå…ƒç´ +1\") map_rdd.foreach(println) println(\"filteræ“ä½œï¼šè¿‡æ»¤æ‰original_rddä¸­ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä¸ä¸ºaçš„æ•°æ®\") var filter_rdd: RDD[(String, Int)] = original_rdd.filter(x =&gt; x._1 == \"a\") filter_rdd.foreach(println) println(\"flatmapæ“ä½œï¼šå¯¹original_rddåšæ˜ å°„æ‰å¹³åŒ–æ“ä½œ\") val flatmap_rdd: RDD[Char] = original_rdd.flatMap(x=&gt; x._1 + x._2) flatmap_rdd.foreach(println) println(\"mapPartitionsæ“ä½œï¼šå¯¹original_rddæ¯ä¸ªåˆ†åŒºåšç›¸åº”æ“ä½œ\") // æ•ˆç‡è¦å¥½äºmap å‡å°‘äº†å‘é€åˆ°æ‰§è¡Œå™¨çš„äº¤äº’æ¬¡æ•°ï¼Œä½†æ˜¯å¯èƒ½ä¼šå‡ºç°å†…å­˜æº¢å‡º val mapPartitions_rdd: RDD[(String, Int)] = original_rdd.mapPartitions(x=&gt;&#123;x.map(item=&gt;(item._1,item._2+1))&#125;) mapPartitions_rdd.foreach(println) println(\"sampleæ“ä½œï¼šæå–æ ·æœ¬\") val sample_rdd: RDD[(String, Int)] = original_rdd.sample(true, 0.25) sample_rdd.foreach(println) println(\"distinctæ“ä½œï¼šå»é‡\") val distinct_rdd: RDD[(String, Int)] = original_rdd.distinct() distinct_rdd.foreach(println) println(\"groupbykeyæ“ä½œï¼šåˆ†ç»„èšåˆ\") val groupByKey_rdd: RDD[(String, Iterable[Int])] = original_rdd.groupByKey() groupByKey_rdd.foreach(println) println(\"reduceByKeyæ“ä½œï¼šèšåˆ\") val reduceByKey_rdd: RDD[(String, Int)] = original_rdd.reduceByKey(_+_) reduceByKey_rdd.foreach(println) println(\"sortByKeyæ“ä½œï¼šæ’åº\") val sortByKey_rdd: RDD[(String, Int)] = original_rdd.sortByKey() sortByKey_rdd.foreach(println) &#125;&#125;RDD çš„æŒä¹…åŒ–ï¼ˆç¼“å­˜ï¼‰æ¯å½“æˆ‘ä»¬å¯¹ RDD è°ƒç”¨ä¸€ä¸ªæ–°çš„ action æ“ä½œæ—¶ï¼Œæ•´ä¸ª RDD éƒ½ä¼šä»å¤´å¼€å§‹è¿ç®—ã€‚å› æ­¤ï¼Œå¦‚æœæŸä¸ª RDD ä¼šè¢«åå¤é‡ç”¨çš„è¯ï¼Œæ¯æ¬¡éƒ½ä»å¤´è®¡ç®—éå¸¸ä½æ•ˆï¼Œæˆ‘ä»¬åº”è¯¥å¯¹å¤šæ¬¡ä½¿ç”¨çš„ RDD è¿›è¡Œä¸€ä¸ªæŒä¹…åŒ–æ“ä½œã€‚Spark çš„ persist() å’Œ cache() æ–¹æ³•æ”¯æŒå°† RDD çš„æ•°æ®ç¼“å­˜è‡³å†…å­˜æˆ–ç¡¬ç›˜ä¸­ï¼Œè¿™æ ·å½“ä¸‹æ¬¡å¯¹åŒä¸€ RDD è¿›è¡Œ Action æ“ä½œæ—¶ï¼Œå¯ä»¥ç›´æ¥è¯»å– RDD çš„ç»“æœï¼Œå¤§å¹…æé«˜äº† Spark çš„è®¡ç®—æ•ˆç‡ã€‚12345678rdd = sc.parallelize([1, 2, 3, 4, 5])rdd1 = rdd.map(lambda x: x+5)rdd2 = rdd1.filter(lambda x: x % 2 == 0)rdd2.persist()count = rdd2.count() // 3first = rdd2.first() // 6rdd2.unpersist()åœ¨æ–‡ä¸­çš„ä»£ç ä¾‹å­ä¸­ä½ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¯¹ RDD2 è¿›è¡Œäº†å¤šä¸ªä¸åŒçš„ action æ“ä½œã€‚ç”±äºåœ¨ç¬¬å››è¡Œæˆ‘æŠŠ RDD2 çš„ç»“æœç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥ Spark æ— éœ€ä»ä¸€å¼€å§‹çš„ rdd å¼€å§‹ç®—èµ·äº†ï¼ˆæŒä¹…åŒ–å¤„ç†è¿‡çš„ RDD åªæœ‰ç¬¬ä¸€æ¬¡æœ‰ action æ“ä½œæ—¶æ‰ä¼šä»æºå¤´è®¡ç®—ï¼Œä¹‹åå°±æŠŠç»“æœå­˜å‚¨ä¸‹æ¥ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œcount éœ€è¦ä»æºå¤´å¼€å§‹è®¡ç®—ï¼Œè€Œ first ä¸éœ€è¦ï¼‰ã€‚åœ¨ç¼“å­˜ RDD çš„æ—¶å€™ï¼Œå®ƒæ‰€æœ‰çš„ä¾èµ–å…³ç³»ä¹Ÿä¼šè¢«ä¸€å¹¶å­˜ä¸‹æ¥ã€‚æ‰€ä»¥æŒä¹…åŒ–çš„ RDD æœ‰è‡ªåŠ¨çš„å®¹é”™æœºåˆ¶ã€‚å¦‚æœ RDD çš„ä»»ä¸€åˆ†åŒºä¸¢å¤±äº†ï¼Œé€šè¿‡ä½¿ç”¨åŸå…ˆåˆ›å»ºå®ƒçš„è½¬æ¢æ“ä½œï¼Œå®ƒå°†ä¼šè¢«è‡ªåŠ¨é‡ç®—ã€‚æŒä¹…åŒ–å¯ä»¥é€‰æ‹©ä¸åŒçš„å­˜å‚¨çº§åˆ«ã€‚æ­£å¦‚æˆ‘ä»¬è®² RDD çš„ç»“æ„æ—¶æåˆ°çš„ä¸€æ ·ï¼Œæœ‰ MEMORY_ONLYï¼ŒMEMORY_AND_DISKï¼ŒDISK_ONLY ç­‰ã€‚cache() æ–¹æ³•ä¼šé»˜è®¤å– MEMORY_ONLY è¿™ä¸€çº§åˆ«ã€‚RDD CheckpointCheckpoint çš„äº§ç”Ÿå°±æ˜¯ä¸ºäº†ç›¸å¯¹è€Œè¨€æ›´åŠ å¯é çš„æŒä¹…åŒ–æ•°æ®ï¼Œåœ¨ Checkpoint å¯ä»¥æŒ‡å®šæŠŠæ•°æ®æ”¾åœ¨æœ¬åœ°å¹¶ä¸”æ˜¯å¤šå‰¯æœ¬çš„æ–¹å¼ï¼Œä½†æ˜¯åœ¨æ­£å¸¸ç”Ÿäº§ç¯å¢ƒä¸‹æ”¾åœ¨ HDFS ä¸Šï¼Œè¿™å°±å¤©ç„¶çš„å€ŸåŠ©HDFS é«˜å¯é çš„ç‰¹å¾æ¥å®Œæˆæœ€å¤§åŒ–çš„å¯é çš„æŒä¹…åŒ–æ•°æ®çš„æ–¹å¼ã€‚åœ¨è¿›è¡Œ RDD çš„ Checkpoint çš„æ—¶å€™ï¼Œå…¶æ‰€ä¾èµ–çš„æ‰€æœ‰ RDD éƒ½ä¼šæ¸…ç©ºæ‰ï¼›å®˜æ–¹å»ºè®®å¦‚æœè¦è¿›è¡Œ checkpoint æ—¶ï¼Œå¿…éœ€å…ˆç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚ä½†å®é™…å¯ä»¥è€ƒè™‘ç¼“å­˜åœ¨æœ¬åœ°ç£ç›˜ä¸Šæˆ–è€…æ˜¯ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œe.g. Taychon ä¸Šã€‚åœ¨è¿›è¡Œ checkpoint ä¹‹å‰éœ€è¦é€šè¿‡ SparkConetxt è®¾ç½® checkpoint çš„æ–‡ä»¶å¤¹ä½œä¸ºæœ€ä½³å®è·µï¼Œä¸€èˆ¬åœ¨è¿›è¡Œ checkpoint æ–¹æ³•è°ƒç”¨å‰éƒ½è¦è¿›è¡Œ persists æ¥æŠŠå½“å‰ RDD çš„æ•°æ®æŒä¹…åŒ–åˆ°å†…å­˜æˆ–è€…æ˜¯ç£ç›˜ä¸Šï¼Œè¿™æ˜¯å› ä¸º checkpoint æ˜¯ lazy çº§åˆ«ï¼Œå¿…éœ€æœ‰ Job çš„æ‰§è¡Œä¸”åœ¨Job æ‰§è¡Œå®Œæˆåæ‰ä¼šä»åå¾€å‰å›æº¯å“ªä¸ª RDD è¿›è¡Œäº†Checkpoint æ ‡è®°ï¼Œç„¶åå¯¹è¯¥æ ‡è®°äº†è¦è¿›è¡Œ Checkpoint çš„ RDD æ–°å¯åŠ¨ä¸€ä¸ªJob æ‰§è¡Œå…·ä½“ Checkpoint çš„è¿‡ç¨‹RDD ShuffleSpark é‡Œçš„æŸäº›æ“ä½œä¼šè§¦å‘ shuffleã€‚shuffle æ˜¯spark é‡æ–°åˆ†é…æ•°æ®çš„ä¸€ç§æœºåˆ¶ï¼Œä½¿å¾—è¿™äº›æ•°æ®å¯ä»¥è·¨ä¸åŒçš„åŒºåŸŸè¿›è¡Œåˆ†ç»„ã€‚è¿™é€šå¸¸æ¶‰åŠåœ¨ executors å’Œ æœºå™¨ä¹‹é—´æ‹·è´æ•°æ®ï¼Œè¿™ä½¿å¾— shuffle æˆä¸ºä¸€ä¸ªå¤æ‚çš„ã€ä»£ä»·é«˜çš„æ“ä½œã€‚[Background](http://spark.apachecn.org/#/docs/4?id=background%ef%bc%88%e5%b9%95%e5%90%8e%ef%bc%89)ä¸ºäº†æ˜ç™½ reduceByKey æ“ä½œçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬ä»¥ reduceByKey ä¸ºä¾‹ã€‚reduceBykey æ“ä½œäº§ç”Ÿä¸€ä¸ªæ–°çš„ RDDï¼Œå…¶ä¸­ key æ‰€æœ‰ç›¸åŒçš„çš„å€¼ç»„åˆæˆä¸ºä¸€ä¸ª tuple - key ä»¥åŠä¸ key ç›¸å…³è”çš„æ‰€æœ‰å€¼åœ¨ reduce å‡½æ•°ä¸Šçš„æ‰§è¡Œç»“æœã€‚é¢ä¸´çš„æŒ‘æˆ˜æ˜¯ï¼Œä¸€ä¸ª key çš„æ‰€æœ‰å€¼ä¸ä¸€å®šéƒ½åœ¨ä¸€ä¸ªåŒä¸€ä¸ª paritition åˆ†åŒºé‡Œï¼Œç”šè‡³æ˜¯ä¸ä¸€å®šåœ¨åŒä¸€å°æœºå™¨é‡Œï¼Œä½†æ˜¯å®ƒä»¬å¿…é¡»å…±åŒè¢«è®¡ç®—ã€‚åœ¨ spark é‡Œï¼Œç‰¹å®šçš„æ“ä½œéœ€è¦æ•°æ®ä¸è·¨åˆ†åŒºåˆ†å¸ƒã€‚åœ¨è®¡ç®—æœŸé—´ï¼Œä¸€ä¸ªä»»åŠ¡åœ¨ä¸€ä¸ªåˆ†åŒºä¸Šæ‰§è¡Œï¼Œä¸ºäº†æ‰€æœ‰æ•°æ®éƒ½åœ¨å•ä¸ª reduceByKey çš„ reduce ä»»åŠ¡ä¸Šè¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸€ä¸ª all-to-all æ“ä½œã€‚å®ƒå¿…é¡»ä»æ‰€æœ‰åˆ†åŒºè¯»å–æ‰€æœ‰çš„ key å’Œ keyå¯¹åº”çš„æ‰€æœ‰çš„å€¼ï¼Œå¹¶ä¸”è·¨åˆ†åŒºèšé›†å»è®¡ç®—æ¯ä¸ª key çš„ç»“æœ - è¿™ä¸ªè¿‡ç¨‹å°±å«åš shuffleã€‚å°½ç®¡æ¯ä¸ªåˆ†åŒºæ–° shuffle çš„æ•°æ®é›†å°†æ˜¯ç¡®å®šçš„ï¼Œåˆ†åŒºæœ¬èº«çš„é¡ºåºä¹Ÿæ˜¯è¿™æ ·ï¼Œä½†æ˜¯è¿™äº›æ•°æ®çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚å¦‚æœå¸Œæœ› shuffle åçš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥ä½¿ç”¨:mapPartitions å¯¹æ¯ä¸ª partition åˆ†åŒºè¿›è¡Œæ’åºï¼Œä¾‹å¦‚ï¼Œ.sortedrepartitionAndSortWithinPartitions åœ¨åˆ†åŒºçš„åŒæ—¶å¯¹åˆ†åŒºè¿›è¡Œé«˜æ•ˆçš„æ’åº.sortBy å¯¹ RDD è¿›è¡Œå…¨å±€çš„æ’åºè§¦å‘çš„ shuffle æ“ä½œåŒ…æ‹¬ repartition æ“ä½œï¼Œå¦‚ repartition å’Œ coalesceï¼Œâ€˜ByKey æ“ä½œï¼ˆé™¤äº† count ä¹‹å¤–ï¼‰åƒ groupByKey å’Œ reduceByKeyï¼Œå’Œ join æ“ä½œï¼Œåƒ cogroup å’Œ join.æ€§èƒ½å½±å“è¯¥ **Shuffle æ˜¯ä¸€ä¸ªä»£ä»·æ¯”è¾ƒé«˜çš„æ“ä½œï¼Œå®ƒæ¶‰åŠç£ç›˜ I/Oã€æ•°æ®åºåˆ—åŒ–ã€ç½‘ç»œ I/Oã€‚ä¸ºäº†å‡†å¤‡ shuffle æ“ä½œçš„æ•°æ®ï¼ŒSpark å¯åŠ¨äº†ä¸€ç³»åˆ—çš„ä»»åŠ¡ï¼Œmap ä»»åŠ¡ç»„ç»‡æ•°æ®ï¼Œreduce å®Œæˆæ•°æ®çš„èšåˆã€‚è¿™äº›æœ¯è¯­æ¥è‡ª MapReduceï¼Œè·Ÿ Spark çš„ map æ“ä½œå’Œ reduce æ“ä½œæ²¡æœ‰å…³ç³»ã€‚åœ¨å†…éƒ¨ï¼Œä¸€ä¸ª map ä»»åŠ¡çš„æ‰€æœ‰ç»“æœæ•°æ®ä¼šä¿å­˜åœ¨å†…å­˜ï¼Œç›´åˆ°å†…å­˜ä¸èƒ½å…¨éƒ¨å­˜å‚¨ä¸ºæ­¢ã€‚ç„¶åï¼Œè¿™äº›æ•°æ®å°†åŸºäºç›®æ ‡åˆ†åŒºè¿›è¡Œæ’åºå¹¶å†™å…¥ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚åœ¨ reduce æ—¶ï¼Œä»»åŠ¡å°†è¯»å–ç›¸å…³çš„å·²æ’åºçš„æ•°æ®å—ã€‚æŸäº› shuffle æ“ä½œä¼šå¤§é‡æ¶ˆè€—å †å†…å­˜ç©ºé—´ï¼Œå› ä¸º shuffle æ“ä½œåœ¨æ•°æ®è½¬æ¢å‰åï¼Œéœ€è¦åœ¨ä½¿ç”¨å†…å­˜ä¸­çš„æ•°æ®ç»“æ„å¯¹æ•°æ®è¿›è¡Œç»„ç»‡ã€‚éœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ï¼ŒreduceByKey å’Œ aggregateByKey åœ¨ map æ—¶ä¼šåˆ›å»ºè¿™äº›æ•°æ®ç»“æ„ï¼Œ&#39;ByKey æ“ä½œåœ¨ reduce æ—¶åˆ›å»ºè¿™äº›æ•°æ®ç»“æ„ã€‚å½“å†…å­˜æ»¡çš„æ—¶å€™ï¼ŒSpark ä¼šæŠŠæº¢å‡ºçš„æ•°æ®å­˜åˆ°ç£ç›˜ä¸Šï¼Œè¿™å°†å¯¼è‡´é¢å¤–çš„ç£ç›˜ I/O å¼€é”€å’Œåƒåœ¾å›æ”¶å¼€é”€çš„å¢åŠ ã€‚shuffle æ“ä½œè¿˜ä¼šåœ¨ç£ç›˜ä¸Šç”Ÿæˆå¤§é‡çš„ä¸­é—´æ–‡ä»¶ã€‚åœ¨ Spark 1.3 ä¸­ï¼Œè¿™äº›æ–‡ä»¶å°†ä¼šä¿ç•™è‡³å¯¹åº”çš„ RDD ä¸åœ¨ä½¿ç”¨å¹¶è¢«åƒåœ¾å›æ”¶ä¸ºæ­¢ã€‚è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯ï¼Œå¦‚æœåœ¨ Spark é‡æ–°è®¡ç®— RDD çš„è¡€ç»Ÿå…³ç³»ï¼ˆlineageï¼‰æ—¶ï¼Œshuffle æ“ä½œäº§ç”Ÿçš„è¿™äº›ä¸­é—´æ–‡ä»¶ä¸éœ€è¦é‡æ–°åˆ›å»ºã€‚å¦‚æœ Spark åº”ç”¨é•¿æœŸä¿æŒå¯¹ RDD çš„å¼•ç”¨ï¼Œæˆ–è€…åƒåœ¾å›æ”¶ä¸é¢‘ç¹ï¼Œè¿™å°†å¯¼è‡´åƒåœ¾å›æ”¶çš„å‘¨æœŸæ¯”è¾ƒé•¿ã€‚è¿™æ„å‘³ç€ï¼Œé•¿æœŸè¿è¡Œ Spark ä»»åŠ¡å¯èƒ½ä¼šæ¶ˆè€—å¤§é‡çš„ç£ç›˜ç©ºé—´ã€‚ä¸´æ—¶æ•°æ®å­˜å‚¨è·¯å¾„å¯ä»¥é€šè¿‡ SparkContext ä¸­è®¾ç½®å‚æ•° spark.local.dir è¿›è¡Œé…ç½®ã€‚shuffle æ“ä½œçš„è¡Œä¸ºå¯ä»¥é€šè¿‡è°ƒèŠ‚å¤šä¸ªå‚æ•°è¿›è¡Œè®¾ç½®ã€‚è¯¦ç»†çš„è¯´æ˜è¯·çœ‹ Spark é…ç½®æŒ‡å— ä¸­çš„ â€œShuffle è¡Œä¸ºâ€ éƒ¨åˆ†ã€‚Why use RDDé¦–å…ˆï¼Œå®ƒçš„æ•°æ®å¯ä»¥å°½å¯èƒ½åœ°å­˜åœ¨å†…å­˜ä¸­ï¼Œä»è€Œå¤§å¤§æé«˜çš„æ•°æ®å¤„ç†çš„æ•ˆç‡ï¼›å…¶æ¬¡å®ƒæ˜¯åˆ†åŒºå­˜å‚¨ï¼Œæ‰€ä»¥å¤©ç„¶æ”¯æŒå¹¶è¡Œå¤„ç†ï¼›è€Œä¸”å®ƒè¿˜å­˜å‚¨äº†æ¯ä¸€æ­¥éª¤è®¡ç®—ç»“æœä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä»è€Œå¤§å¤§æå‡äº†æ•°æ®å®¹é”™æ€§å’Œé”™è¯¯æ¢å¤çš„æ­£ç¡®ç‡ï¼Œä½¿ Spark æ›´åŠ å¯é ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"Spark è¿è¡ŒåŸç†","slug":"Spark-è¿è¡ŒåŸç†","date":"2017-03-10T13:41:50.000Z","updated":"2020-08-27T23:48:58.618Z","comments":true,"path":"2017/03/10/Spark-è¿è¡ŒåŸç†/","link":"","permalink":"cpeixin.cn/2017/03/10/Spark-%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86/","excerpt":"","text":"sparkçš„è¿è¡ŒåŸç†å¯¹äºsparkçš„å­¦ä¹ å°¤ä¸ºé‡è¦ï¼Œå¦‚æœä¸äº†è§£å…¶è¿è¡ŒåŸç†ï¼Œä¹Ÿå°±ä¸ä¼šä»æ ¹æœ¬ä¸Šå°†sparkçš„ç¨‹åºå†™å¥½ã€‚è¿™æ˜¯ä¸€ç¯‡sparkç†è®ºçš„æ–‡ç« ï¼Œå¦‚æœè¿™ç¯‡æ–‡ç« å¹¶ä¸èƒ½è®©ä½ ç†è§£ï¼Œå¯ä»¥å…ˆä»å®æˆ˜å…¥æ‰‹ï¼Œç­‰ä½ èƒ½ç®€å•çš„ç”¨sparkå†™ä¸€ä¸ªword countï¼Œéœ€è¦æäº¤ä»»åŠ¡åœ¨æœ¬åœ°æˆ–è€…æ‰”åˆ°æœåŠ¡å™¨ä¸Šçš„æ—¶å€™ï¼Œå†å›æ¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼Œä¹Ÿè®¸ç†è§£çš„ç¨‹åº¦å°±ä¼šæ›´é«˜ä¸€äº›ã€‚è¿è¡Œæ¶æ„è¿è¡Œæ¶æ„12345é‡Šä¹‰ï¼šâ€¢ Cluster Managerï¼šæ§åˆ¶æ•´ä¸ªé›†ç¾¤ï¼Œç›‘æ§workerã€‚åœ¨standaloneæ¨¡å¼ä¸­å³ä¸ºMasterä¸»èŠ‚ç‚¹ï¼Œåœ¨YARNæ¨¡å¼ä¸­ä¸ºResourceManagerâ€¢ WorkerèŠ‚ç‚¹ï¼šä»èŠ‚ç‚¹ï¼Œè´Ÿè´£æ§åˆ¶è®¡ç®—èŠ‚ç‚¹ï¼Œå¯åŠ¨Executoræˆ–è€…Driverã€‚â€¢ Driverï¼š è¿è¡ŒApplication çš„main()å‡½æ•°â€¢ Executorï¼šæ‰§è¡Œå™¨ï¼Œæ˜¯ä¸ºæŸä¸ªApplicationè¿è¡Œåœ¨worker nodeä¸Šçš„ä¸€ä¸ªè¿›ç¨‹,Executorä¸­æœ‰çº¿ç¨‹æ± ä»»åŠ¡è¿è¡Œæµç¨‹æ„å»ºSpark Applicationçš„è¿è¡Œç¯å¢ƒï¼Œå¯åŠ¨SparkContextSparkContextå‘èµ„æºç®¡ç†å™¨ï¼ˆStandaloneï¼ŒMesosï¼ŒYarnï¼‰ç”³è¯·è¿è¡ŒExecutorèµ„æºï¼Œå¹¶å¯åŠ¨StandaloneExecutorbackendExecutorå‘SparkContextç”³è¯·TaskSparkContextå°†åº”ç”¨ç¨‹åºåˆ†å‘ç»™ExecutorSparkContextæ„å»ºæˆDAGå›¾ï¼Œå°†DAGå›¾åˆ†è§£æˆStageã€å°†Tasksetå‘é€ç»™Task Schedulerï¼Œæœ€åç”±Task Schedulerå°†Taskå‘é€ç»™Executorè¿è¡ŒTaskåœ¨Executorä¸Šè¿è¡Œï¼Œè¿è¡Œå®Œé‡Šæ”¾æ‰€æœ‰èµ„æºè¿è¡Œç‰¹ç‚¹**æ¯ä¸ªApplicationè·å–ä¸“å±çš„executorè¿›ç¨‹ï¼Œè¯¥è¿›ç¨‹åœ¨ApplicationæœŸé—´ä¸€ç›´é©»ç•™ï¼Œå¹¶ä»¥å¤šçº¿ç¨‹æ–¹å¼è¿è¡ŒTaskã€‚è¿™ç§Applicationéš”ç¦»æœºåˆ¶æ˜¯æœ‰ä¼˜åŠ¿çš„ï¼Œæ— è®ºæ˜¯ä»è°ƒåº¦è§’åº¦çœ‹ï¼ˆæ¯ä¸ªDriverè°ƒåº¦ä»–è‡ªå·±çš„ä»»åŠ¡ï¼‰ï¼Œè¿˜æ˜¯ä»è¿è¡Œè§’åº¦çœ‹ï¼ˆæ¥è‡ªä¸åŒApplicationçš„Taskè¿è¡Œåœ¨ä¸åŒJVMä¸­ï¼‰ï¼Œå½“ç„¶è¿™æ ·æ„å‘³ç€Spark Applicationä¸èƒ½è·¨åº”ç”¨ç¨‹åºå…±äº«æ•°æ®ï¼Œé™¤éå°†æ•°æ®å†™å…¥å¤–éƒ¨å­˜å‚¨ç³»ç»ŸSparkä¸èµ„æºç®¡ç†å™¨æ— å…³ï¼Œåªè¦èƒ½å¤Ÿè·å–executorè¿›ç¨‹ï¼Œå¹¶èƒ½ä¿æŒç›¸äº’é€šä¿¡å°±å¯ä»¥äº†æäº¤SparkContextçš„Clientåº”è¯¥é è¿‘WorkerèŠ‚ç‚¹ï¼ˆè¿è¡ŒExecutorçš„èŠ‚ç‚¹ï¼‰ï¼Œæœ€å¥½æ˜¯åœ¨åŒä¸€ä¸ªRacké‡Œï¼Œå› ä¸ºSpark Applicationè¿è¡Œè¿‡ç¨‹ä¸­SparkContextå’ŒExecutorä¹‹é—´æœ‰å¤§é‡çš„ä¿¡æ¯äº¤æ¢Taské‡‡ç”¨äº†æ•°æ®æœ¬åœ°æ€§å’Œæ¨æµ‹æ‰§è¡Œçš„ä¼˜åŒ–æœºåˆ¶é‡Šä¹‰ï¼šApplication: Applictionéƒ½æ˜¯æŒ‡ç”¨æˆ·ç¼–å†™çš„Sparkåº”ç”¨ç¨‹åºï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ªDriveråŠŸèƒ½çš„ä»£ç å’Œåˆ†å¸ƒåœ¨é›†ç¾¤ä¸­å¤šä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„Executorä»£ç Driver: Sparkä¸­çš„Driverå³è¿è¡Œä¸Šè¿°Applicationçš„mainå‡½æ•°å¹¶åˆ›å»ºSparkContextï¼Œåˆ›å»ºSparkContextçš„ç›®çš„æ˜¯ä¸ºäº†å‡†å¤‡Sparkåº”ç”¨ç¨‹åºçš„è¿è¡Œç¯å¢ƒï¼Œåœ¨Sparkä¸­æœ‰SparkContextè´Ÿè´£ä¸ClusterManageré€šä¿¡ï¼Œè¿›è¡Œèµ„æºç”³è¯·ã€ä»»åŠ¡çš„åˆ†é…å’Œç›‘æ§ç­‰ï¼Œå½“Executoréƒ¨åˆ†è¿è¡Œå®Œæ¯•åï¼ŒDriveråŒæ—¶è´Ÿè´£å°†SparkContextå…³é—­ï¼Œé€šå¸¸ç”¨SparkContextä»£è¡¨DriverExecutor: æŸä¸ªApplicationè¿è¡Œåœ¨workerèŠ‚ç‚¹ä¸Šçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œ è¯¥è¿›ç¨‹è´Ÿè´£è¿è¡ŒæŸäº›Taskï¼Œ å¹¶ä¸”è´Ÿè´£å°†æ•°æ®å­˜åˆ°å†…å­˜æˆ–ç£ç›˜ä¸Šï¼Œæ¯ä¸ªApplicationéƒ½æœ‰å„è‡ªç‹¬ç«‹çš„ä¸€æ‰¹Executorï¼Œ åœ¨Spark on Yarnæ¨¡å¼ä¸‹ï¼Œå…¶è¿›ç¨‹åç§°ä¸ºCoarseGrainedExecutor Backendã€‚ä¸€ä¸ªCoarseGrainedExecutor Backendæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªExecutorå¯¹è±¡ï¼Œ è´Ÿè´£å°†TaskåŒ…è£…æˆtaskRunner,å¹¶ä»çº¿ç¨‹æ± ä¸­æŠ½å–ä¸€ä¸ªç©ºé—²çº¿ç¨‹è¿è¡ŒTaskï¼Œ è¿™ä¸ªæ¯ä¸€ä¸ªoarseGrainedExecutor Backendèƒ½å¹¶è¡Œè¿è¡ŒTaskçš„æ•°é‡å–å†³ä¸åˆ†é…ç»™å®ƒçš„cpuä¸ªæ•°Cluter Managerï¼šæŒ‡çš„æ˜¯åœ¨é›†ç¾¤ä¸Šè·å–èµ„æºçš„å¤–éƒ¨æœåŠ¡ã€‚ç›®å‰æœ‰ä¸‰ç§ç±»å‹Standalone : sparkåŸç”Ÿçš„èµ„æºç®¡ç†ï¼Œç”±Masterè´Ÿè´£èµ„æºçš„åˆ†é…Apache Mesos:ä¸hadoop MRå…¼å®¹æ€§è‰¯å¥½çš„ä¸€ç§èµ„æºè°ƒåº¦æ¡†æ¶Hadoop Yarn: ä¸»è¦æ˜¯æŒ‡Yarnä¸­çš„ResourceManagerWorker: é›†ç¾¤ä¸­ä»»ä½•å¯ä»¥è¿è¡ŒApplicationä»£ç çš„èŠ‚ç‚¹ï¼Œåœ¨Standaloneæ¨¡å¼ä¸­æŒ‡çš„æ˜¯é€šè¿‡slaveæ–‡ä»¶é…ç½®çš„WorkerèŠ‚ç‚¹ï¼Œåœ¨Spark on Yarnæ¨¡å¼ä¸‹å°±æ˜¯NodeManagerèŠ‚ç‚¹Task: è¢«é€åˆ°æŸä¸ªExecutorä¸Šçš„å·¥ä½œå•å…ƒï¼Œä½†hadoopMRä¸­çš„MapTaskå’ŒReduceTaskæ¦‚å¿µä¸€æ ·ï¼Œæ˜¯è¿è¡ŒApplicationçš„åŸºæœ¬å•ä½ï¼Œå¤šä¸ªTaskç»„æˆä¸€ä¸ªStageï¼Œè€ŒTaskçš„è°ƒåº¦å’Œç®¡ç†ç­‰æ˜¯ç”±TaskSchedulerè´Ÿè´£Job: åŒ…å«å¤šä¸ªTaskç»„æˆçš„å¹¶è¡Œè®¡ç®—ï¼Œå¾€å¾€ç”±Spark Actionè§¦å‘ç”Ÿæˆï¼Œ ä¸€ä¸ªApplicationä¸­å¾€å¾€ä¼šäº§ç”Ÿå¤šä¸ªJobStage: æ¯ä¸ªJobä¼šè¢«æ‹†åˆ†æˆå¤šç»„Taskï¼Œ ä½œä¸ºä¸€ä¸ªTaskSetï¼Œ å…¶åç§°ä¸ºStageï¼ŒStageçš„åˆ’åˆ†å’Œè°ƒåº¦æ˜¯æœ‰DAGScheduleræ¥è´Ÿè´£çš„ï¼ŒStageæœ‰éæœ€ç»ˆçš„Stageï¼ˆShuffle Map Stageï¼‰å’Œæœ€ç»ˆçš„Stageï¼ˆResult Stageï¼‰ä¸¤ç§ï¼ŒStageçš„è¾¹ç•Œå°±æ˜¯å‘ç”Ÿshuffleçš„åœ°æ–¹DAGScheduler: æ ¹æ®Jobæ„å»ºåŸºäºStageçš„DAGï¼ˆDirected Acyclic Graphæœ‰å‘æ— ç¯å›¾)ï¼Œå¹¶æäº¤Stageç»™TASkSchedulerã€‚ å…¶åˆ’åˆ†Stageçš„ä¾æ®æ˜¯RDDä¹‹é—´çš„ä¾èµ–çš„å…³ç³»æ‰¾å‡ºå¼€é”€æœ€å°çš„è°ƒåº¦æ–¹æ³•TASKSedulter: å°†TaskSETæäº¤ç»™workerè¿è¡Œï¼Œæ¯ä¸ªExecutorè¿è¡Œä»€ä¹ˆTaskå°±æ˜¯åœ¨æ­¤å¤„åˆ†é…çš„. TaskSchedulerç»´æŠ¤æ‰€æœ‰TaskSetï¼Œå½“Executorå‘Driverå‘ç”Ÿå¿ƒè·³æ—¶ï¼ŒTaskSchedulerä¼šæ ¹æ®èµ„æºå‰©ä½™æƒ…å†µåˆ†é…ç›¸åº”çš„Taskã€‚å¦å¤–TaskSchedulerè¿˜ç»´æŠ¤ç€æ‰€æœ‰Taskçš„è¿è¡Œæ ‡ç­¾ï¼Œé‡è¯•å¤±è´¥çš„Taskã€‚ä¸‹å›¾å±•ç¤ºäº†DAGSchedulerï¼Œ TaskSchedulerçš„ä½œç”¨Job=å¤šä¸ªstageï¼ŒStage=å¤šä¸ªåŒç§task, Taskåˆ†ä¸ºShuffleMapTaskå’ŒResultTaskï¼ŒDependencyåˆ†ä¸ºShuffleDependencyå’ŒNarrowDependency1234åœ¨ä¸åŒè¿è¡Œæ¨¡å¼ä¸­ä»»åŠ¡è°ƒåº¦å™¨å…·ä½“ä¸ºï¼š a. Spark on Standaloneæ¨¡å¼ä¸ºTaskScheduler b. YARN-Clientæ¨¡å¼ä¸ºYarnClientClusterScheduler c. YARN-Clusteræ¨¡å¼ä¸ºYarnClusterSchedulerå°†è¿™äº›æœ¯è¯­ä¸²èµ·æ¥çš„è¿è¡Œå±‚æ¬¡å›¾å¦‚ä¸‹ï¼š![512251993-5b043bbda8a04_articlex.png](https://cdn.nlark.com/yuque/0/2020/png/1072113/1586437820952-5268cd17-13cb-41d9-ba92-5bb1208b34b7.png#align=left&display=inline&height=449&name=512251993-5b043bbda8a04_articlex.png&originHeight=449&originWidth=559&size=113090&status=done&style=none&width=559)è¿è¡Œæ¨¡å¼Sparkçš„è¿è¡Œæ¨¡å¼å¤šç§å¤šæ ·ï¼Œçµæ´»å¤šå˜ï¼Œéƒ¨ç½²åœ¨å•æœºä¸Šæ—¶ï¼Œæ—¢å¯ä»¥ç”¨æœ¬åœ°æ¨¡å¼è¿è¡Œï¼Œä¹Ÿå¯ä»¥ç”¨ä¼ªåˆ†å¸ƒæ¨¡å¼è¿è¡Œï¼Œè€Œå½“ä»¥åˆ†å¸ƒå¼é›†ç¾¤çš„æ–¹å¼éƒ¨ç½²æ—¶ï¼Œä¹Ÿæœ‰ä¼—å¤šçš„è¿è¡Œæ¨¡å¼å¯ä¾›é€‰æ‹©ï¼Œè¿™å–å†³äºé›†ç¾¤çš„å®é™…æƒ…å†µï¼Œåº•å±‚çš„èµ„æºè°ƒåº¦å³å¯ä»¥ä¾èµ–å¤–éƒ¨èµ„æºè°ƒåº¦æ¡†æ¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Sparkå†…å»ºçš„Standaloneæ¨¡å¼ã€‚å¯¹äºå¤–éƒ¨èµ„æºè°ƒåº¦æ¡†æ¶çš„æ”¯æŒï¼Œç›®å‰çš„å®ç°åŒ…æ‹¬ç›¸å¯¹ç¨³å®šçš„Mesosæ¨¡å¼ï¼Œä»¥åŠhadoop YARNæ¨¡å¼æœ¬åœ°æ¨¡å¼ï¼šå¸¸ç”¨äºæœ¬åœ°å¼€å‘æµ‹è¯•ï¼Œæœ¬åœ°è¿˜åˆ†åˆ« local å’Œ local clusterstandalone: ç‹¬ç«‹é›†ç¾¤è¿è¡Œæ¨¡å¼**Standaloneæ¨¡å¼ä½¿ç”¨Sparkè‡ªå¸¦çš„èµ„æºè°ƒåº¦æ¡†æ¶ï¼Œé‡‡ç”¨Master/Slavesçš„å…¸å‹æ¶æ„ï¼Œé€‰ç”¨ZooKeeperæ¥å®ç°Masterçš„HAã€‚æ¡†æ¶ç»“æ„å›¾å¦‚ä¸‹:è¯¥æ¨¡å¼ä¸»è¦çš„èŠ‚ç‚¹æœ‰ClientèŠ‚ç‚¹ã€MasterèŠ‚ç‚¹å’ŒWorkerèŠ‚ç‚¹ã€‚å…¶ä¸­Driveræ—¢å¯ä»¥è¿è¡Œåœ¨MasterèŠ‚ç‚¹ä¸Šä¸­ï¼Œä¹Ÿå¯ä»¥è¿è¡Œåœ¨æœ¬åœ°Clientç«¯ã€‚å½“ç”¨spark-shelläº¤äº’å¼å·¥å…·æäº¤Sparkçš„Jobæ—¶ï¼ŒDriveråœ¨MasterèŠ‚ç‚¹ä¸Šè¿è¡Œï¼›å½“ä½¿ç”¨spark-submitå·¥å…·æäº¤Jobæˆ–è€…åœ¨Eclipsã€IDEAç­‰å¼€å‘å¹³å°ä¸Šä½¿ç”¨â€new SparkConf.setManager(â€œspark://master:7077â€)â€æ–¹å¼è¿è¡ŒSparkä»»åŠ¡æ—¶ï¼ŒDriveræ˜¯è¿è¡Œåœ¨æœ¬åœ°Clientç«¯ä¸Šçš„Yarnæ¨¡å¼è¿è¡Œï¼šSpark on YARNæ¨¡å¼æ ¹æ®Driveråœ¨é›†ç¾¤ä¸­çš„ä½ç½®åˆ†ä¸ºä¸¤ç§æ¨¡å¼ï¼šä¸€ç§æ˜¯YARN-Clientæ¨¡å¼ï¼Œå¦ä¸€ç§æ˜¯YARN-ClusterYarn-Clientæ¨¡å¼ä¸­ï¼ŒDriveråœ¨å®¢æˆ·ç«¯æœ¬åœ°è¿è¡Œï¼Œè¿™ç§æ¨¡å¼å¯ä»¥ä½¿å¾—Spark Applicationå’Œå®¢æˆ·ç«¯è¿›è¡Œäº¤äº’ï¼Œå› ä¸ºDriveråœ¨å®¢æˆ·ç«¯ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡webUIè®¿é—®Driverçš„çŠ¶æ€ï¼Œé»˜è®¤æ˜¯http://xxxx:4040è®¿é—®ï¼Œè€ŒYARNé€šè¿‡http:// xxxx:8088è®¿é—®YARN-clientçš„å·¥ä½œæµç¨‹æ­¥éª¤ä¸ºï¼šYARN-clusterçš„å·¥ä½œæµç¨‹æ­¥éª¤Spark Yarn Clientå‘YARNä¸­æäº¤åº”ç”¨ç¨‹åºï¼ŒåŒ…æ‹¬ApplicationMasterç¨‹åºã€å¯åŠ¨ApplicationMasterçš„å‘½ä»¤ã€éœ€è¦åœ¨Executorä¸­è¿è¡Œçš„ç¨‹åºç­‰ResourceManageræ”¶åˆ°è¯·æ±‚åï¼Œåœ¨é›†ç¾¤ä¸­é€‰æ‹©ä¸€ä¸ªNodeManagerï¼Œä¸ºè¯¥åº”ç”¨ç¨‹åºåˆ†é…ç¬¬ä¸€ä¸ªContainerï¼Œè¦æ±‚å®ƒåœ¨è¿™ä¸ªContainerä¸­å¯åŠ¨åº”ç”¨ç¨‹åºçš„ApplicationMasterï¼Œå…¶ä¸­ApplicationMasterè¿›è¡ŒSparkContextç­‰çš„åˆå§‹åŒ–ApplicationMasterå‘ResourceManageræ³¨å†Œï¼Œè¿™æ ·ç”¨æˆ·å¯ä»¥ç›´æ¥é€šè¿‡ResourceManageæŸ¥çœ‹åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ï¼Œç„¶åå®ƒå°†é‡‡ç”¨è½®è¯¢çš„æ–¹å¼é€šè¿‡RPCåè®®ä¸ºå„ä¸ªä»»åŠ¡ç”³è¯·èµ„æºï¼Œå¹¶ç›‘æ§å®ƒä»¬çš„è¿è¡ŒçŠ¶æ€ç›´åˆ°è¿è¡Œç»“æŸä¸€æ—¦ApplicationMasterç”³è¯·åˆ°èµ„æºï¼ˆä¹Ÿå°±æ˜¯Containerï¼‰åï¼Œä¾¿ä¸å¯¹åº”çš„NodeManageré€šä¿¡ï¼Œè¦æ±‚å®ƒåœ¨è·å¾—çš„Containerä¸­å¯åŠ¨CoarseGrainedExecutorBackendï¼ŒCoarseGrainedExecutorBackendå¯åŠ¨åä¼šå‘ApplicationMasterä¸­çš„SparkContextæ³¨å†Œå¹¶ç”³è¯·Taskã€‚è¿™ä¸€ç‚¹å’ŒStandaloneæ¨¡å¼ä¸€æ ·ï¼Œåªä¸è¿‡SparkContextåœ¨Spark Applicationä¸­åˆå§‹åŒ–æ—¶ï¼Œä½¿ç”¨CoarseGrainedSchedulerBackendé…åˆYarnClusterSchedulerè¿›è¡Œä»»åŠ¡çš„è°ƒåº¦ï¼Œå…¶ä¸­YarnClusterScheduleråªæ˜¯å¯¹TaskSchedulerImplçš„ä¸€ä¸ªç®€å•åŒ…è£…ï¼Œå¢åŠ äº†å¯¹Executorçš„ç­‰å¾…é€»è¾‘ç­‰ApplicationMasterä¸­çš„SparkContextåˆ†é…Taskç»™CoarseGrainedExecutorBackendæ‰§è¡Œï¼ŒCoarseGrainedExecutorBackendè¿è¡ŒTaskå¹¶å‘ApplicationMasteræ±‡æŠ¥è¿è¡Œçš„çŠ¶æ€å’Œè¿›åº¦ï¼Œä»¥è®©ApplicationMasteréšæ—¶æŒæ¡å„ä¸ªä»»åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œä»è€Œå¯ä»¥åœ¨ä»»åŠ¡å¤±è´¥æ—¶é‡æ–°å¯åŠ¨ä»»åŠ¡åº”ç”¨ç¨‹åºè¿è¡Œå®Œæˆåï¼ŒApplicationMasterå‘ResourceManagerç”³è¯·æ³¨é”€å¹¶å…³é—­è‡ªå·±Spark Client å’Œ Spark Clusterçš„åŒºåˆ«ç†è§£YARN-Clientå’ŒYARN-Clusteræ·±å±‚æ¬¡çš„åŒºåˆ«ä¹‹å‰å…ˆæ¸…æ¥šä¸€ä¸ªæ¦‚å¿µï¼šApplication Masterã€‚åœ¨YARNä¸­ï¼Œæ¯ä¸ªApplicationå®ä¾‹éƒ½æœ‰ä¸€ä¸ªApplicationMasterè¿›ç¨‹ï¼Œå®ƒæ˜¯Applicationå¯åŠ¨çš„ç¬¬ä¸€ä¸ªå®¹å™¨ã€‚å®ƒè´Ÿè´£å’ŒResourceManageræ‰“äº¤é“å¹¶è¯·æ±‚èµ„æºï¼Œè·å–èµ„æºä¹‹åå‘Šè¯‰NodeManagerä¸ºå…¶å¯åŠ¨Containerã€‚ä»æ·±å±‚æ¬¡çš„å«ä¹‰è®²YARN-Clusterå’ŒYARN-Clientæ¨¡å¼çš„åŒºåˆ«å…¶å®å°±æ˜¯ApplicationMasterè¿›ç¨‹çš„åŒºåˆ«YARN-Clusteræ¨¡å¼ä¸‹ï¼ŒDriverè¿è¡Œåœ¨AM(Application Master)ä¸­ï¼Œå®ƒè´Ÿè´£å‘YARNç”³è¯·èµ„æºï¼Œå¹¶ç›‘ç£ä½œä¸šçš„è¿è¡ŒçŠ¶å†µã€‚å½“ç”¨æˆ·æäº¤äº†ä½œä¸šä¹‹åï¼Œå°±å¯ä»¥å…³æ‰Clientï¼Œä½œä¸šä¼šç»§ç»­åœ¨YARNä¸Šè¿è¡Œï¼Œå› è€ŒYARN-Clusteræ¨¡å¼ä¸é€‚åˆè¿è¡Œäº¤äº’ç±»å‹çš„ä½œä¸šYARN-Clientæ¨¡å¼ä¸‹ï¼ŒApplication Masterä»…ä»…å‘YARNè¯·æ±‚Executorï¼ŒClientä¼šå’Œè¯·æ±‚çš„Containeré€šä¿¡æ¥è°ƒåº¦ä»–ä»¬å·¥ä½œï¼Œä¹Ÿå°±æ˜¯è¯´Clientä¸èƒ½ç¦»å¼€","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"Spark åˆè¯†","slug":"Spark-åˆè¯†","date":"2017-03-09T11:27:07.000Z","updated":"2020-04-10T03:22:37.781Z","comments":true,"path":"2017/03/09/Spark-åˆè¯†/","link":"","permalink":"cpeixin.cn/2017/03/09/Spark-%E5%88%9D%E8%AF%86/","excerpt":"","text":"è¿™ç¯‡åˆ†äº«ä»ä»‹ç»Sparkå¼€å§‹ï¼Œç®—æ˜¯å…¥é—¨å‰çš„å…¥é—¨ï¼Œä¸æ¶‰åŠåŸç†ï¼Œä¸æ¶‰åŠæŠ€æœ¯ï¼Œä½†æ˜¯å´å¾ˆé‡è¦ï¼Œé‡è¦çš„æ˜¯ç†è§£Sparkæ˜¯ä»€ä¹ˆï¼Ÿç”¨æ¥åšä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦é€‰æ‹©Spark?è¿™å°†å¯¹ä»¥åå·¥ç¨‹å¸ˆä»¬åœ¨é€‰æ‹©å’Œä½¿ç”¨Sparkçš„æ—¶å€™ï¼Œæ›´åŠ èƒ½çŸ¥é“ï¼Œåº”è¯¥æ€æ ·çš„å»ç”¨Sparkï¼Œåœ¨ä»€ä¹ˆæ ·çš„åœºæ™¯ä¸‹å»ä½¿ç”¨ä»€ä¹ˆæ ·çš„Sparkç»„ä»¶ï¼Œæ¥å‘æŒ¥å®ƒçš„ä»·å€¼ã€‚What - SparkSparkæ˜¯ä¸€ä¸ªé€šç”¨æ•°æ®å¤„ç†å¼•æ“ã€‚é€‚ç”¨äºå„ç§ç¯å¢ƒ ï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸‹ï¼Œä¸»è¦åº”ç”¨äºä¸¤ç§æœ€å¸¸è§çš„åœºæ™¯ç¦»çº¿åœºæ™¯ï¼šå¯ä»¥æ˜¯æ—¶é—´ä¸ºç»´åº¦ï¼Œå‡ å¹´çš„æ•°æ®é›†ï¼Œæˆ–è€…æ˜¯ä¸šåŠ¡ä¸ºç»´åº¦ï¼ŒæŸä¸ªé¢†åŸŸçš„å¤§æ•°æ®é›†ï¼Œè¿™ç§æ•°æ®å¯ä»¥æˆ‘ä»¬ä¸€èˆ¬å«åšç¦»çº¿æ•°æ®ï¼Œæˆ–è€…å†·æ•°æ®ã€‚å®æ—¶åœºæ™¯ï¼šç½‘ç«™åŸ‹ç‚¹ï¼Œå®æ—¶ä»å‰ç«¯é¡µé¢ä¼ è¾“è¿‡æ¥çš„æ•°æ®ï¼Œæˆ–è€…ä¸šåŠ¡ç³»ç»Ÿï¼Œç‰©ç†ç¡¬ä»¶å®æ—¶ä¼ è¾“è¿‡æ¥çš„æ•°æ®ï¼Œç¡¬ä»¶ä¿¡å·æˆ–è€…å›¾åƒæ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å®æ—¶çš„å»è®¡ç®—å¤„ç†å¹¶ä¸”è¿”å›ç»“æœã€‚åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å’Œæ•°æ®ç§‘å­¦å®¶å°†Sparkçº³å…¥å…¶åº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿å¿«é€ŸæŸ¥è¯¢ï¼Œåˆ†æå’Œè½¬æ¢æ•°æ®ã€‚æ‰€ä»¥ä¸Sparkå…³è”æœ€é¢‘ç¹çš„ä»»åŠ¡åŒ…æ‹¬è·¨å¤§å‹æ•°æ®é›†çš„äº¤äº’å¼æŸ¥è¯¢ï¼Œå¤„ç†æ¥è‡ªä¼ æ„Ÿå™¨æˆ–é‡‘èç³»ç»Ÿçš„æµæ•°æ®ä»¥åŠæœºå™¨å­¦ä¹ ä»»åŠ¡ã€‚Sparkäº2009å¹´å¼€å§‹åœ¨åŠ åˆ©ç¦å°¼äºšå¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡çš„AMPLabé¡¹ç›®ä¸­ç”Ÿæ´»ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œå®ƒæ˜¯ç”±äºéœ€è¦è¯æ˜Mesoçš„æ¦‚å¿µè€Œè¯ç”Ÿçš„ï¼Œè¿™ä¹Ÿæ˜¯åœ¨AMPLabä¸­åˆ›å»ºçš„ã€‚ï¼ˆç§‘æ™®ï¼šMesosæ˜¯Apacheä¸‹çš„å¼€æºåˆ†å¸ƒå¼èµ„æºç®¡ç†æ¡†æ¶ï¼Œå®ƒè¢«ç§°ä¸ºæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„å†…æ ¸ã€‚ï¼‰ä»ä¸€å¼€å§‹ï¼ŒSparkå°±è¢«ä¼˜åŒ–æˆåœ¨å†…å­˜ä¸­è¿è¡Œã€‚å®ƒæ¯”Hadoopçš„MapReduceç­‰æ›¿ä»£æ–¹æ³•æ›´å¿«é€Ÿåœ°å¤„ç†æ•°æ®ï¼Œè¿™å¾€å¾€ä¼šåœ¨æ¯ä¸ªå¤„ç†é˜¶æ®µä¹‹é—´å‘è®¡ç®—æœºç¡¬ç›˜é©±åŠ¨å™¨å†™å…¥æ•°æ®ã€‚Sparkçš„æ”¯æŒè€…å£°ç§°ï¼ŒSparkåœ¨å†…å­˜ä¸­çš„è¿è¡Œé€Ÿåº¦æ¯”Hadoop MapReduceå¿«100å€ï¼Œè€Œä¸”åœ¨å¤„ç†åŸºäºHadoop MapReduceæœ¬èº«çš„ç£ç›˜æ•°æ®æ—¶é€Ÿåº¦ä¹Ÿå¿«äº†10å€ã€‚è¿™ç§æ¯”è¾ƒå¹¶ä¸å®Œå…¨å…¬å¹³ï¼Œè¿™ä¸ä»…ä»…æ˜¯å› ä¸ºå¯¹äºSparkçš„å…¸å‹ç”¨ä¾‹ï¼ŒåŸå§‹é€Ÿåº¦å¾€å¾€æ¯”æ‰¹å¤„ç†æ›´é‡è¦ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ç±»ä¼¼MapReduceçš„è§£å†³æ–¹æ¡ˆä»ç„¶éå¸¸å‡ºè‰²ã€‚åŸºäºHadoopåŸºäºYARNçš„ä½“ç³»ç»“æ„ä¸ºSparkå’Œå…¶ä»–åº”ç”¨ç¨‹åºå…±äº«é€šç”¨é›†ç¾¤å’Œæ•°æ®é›†æä¾›äº†åŸºç¡€ï¼ŒåŒæ—¶ç¡®ä¿ä¸€è‡´çš„æœåŠ¡å’Œå“åº”çº§åˆ«ã€‚ä¸‹å›¾æ˜¯æ„æˆSparkçš„ç”Ÿæ€ç³»ç»Ÿï¼Œå¼ºå¤§çš„ç”Ÿæ€ç³»ç»Ÿï¼šå…¶ä¸­ Spark Coreæ˜¯Sparkçš„æ ¸å¿ƒAPIï¼Œå¹¶ä¸”æ”¯æŒScala,Python,Javaç¼–ç¨‹è¯­è¨€ï¼ŒR,SQLåˆ†æè¯­è¨€,åœ¨ä»¥Spark Coreä¸ºåŸºç¡€ä¹‹ä¸Šï¼Œæœ‰ç€Spark SQLï¼ŒSpark Streamingï¼ŒSpark Mlib,Spark Graphxå››ä¸ªäº²å„¿å­ã€‚è¿™å››ä¸ªç»„ä»¶ï¼Œæˆ‘å°†åœ¨ä¹‹åçš„æ–‡ç« è¯¦ç»†çš„ä»‹ç»ï¼Œå¹¶ä¸”ä¼šä»åº”ç”¨å’Œä»£ç ç¤ºä¾‹æ¥è®²è§£ã€‚Spark do WhatSparkèƒ½å¤Ÿä¸€æ¬¡å¤„ç†æ•°PBçš„æ•°æ®ï¼Œåˆ†å¸ƒåœ¨æ•°åƒä¸ªåä½œçš„ç‰©ç†æˆ–è™šæ‹ŸæœåŠ¡å™¨é›†ç¾¤ä¸­ã€‚ï¼ˆç§‘æ™®ï¼šä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼è®¡ç®—ï¼Ÿæ‰€è°“åˆ†å¸ƒå¼è®¡ç®—æ˜¯ä¸€é—¨è®¡ç®—æœºç§‘å­¦ï¼Œå®ƒç ”ç©¶å¦‚ä½•æŠŠä¸€ä¸ªéœ€è¦éå¸¸å·¨å¤§çš„è®¡ç®—èƒ½åŠ›æ‰èƒ½è§£å†³çš„é—®é¢˜åˆ†æˆè®¸å¤šå°çš„éƒ¨åˆ†ï¼Œç„¶åæŠŠè¿™äº›éƒ¨åˆ†åˆ†é…ç»™è®¸å¤šè®¡ç®—æœºè¿›è¡Œå¤„ç†ï¼Œæœ€åæŠŠè¿™äº›è®¡ç®—ç»“æœç»¼åˆèµ·æ¥å¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚åˆ†å¸ƒå¼ç½‘ç»œå­˜å‚¨æŠ€æœ¯æ˜¯å°†æ•°æ®åˆ†æ•£çš„å­˜å‚¨äºå¤šå°ç‹¬ç«‹çš„æœºå™¨è®¾å¤‡ä¸Šã€‚åˆ†å¸ƒå¼ç½‘ç»œå­˜å‚¨ç³»ç»Ÿé‡‡ç”¨ å¯æ‰©å±•çš„ç³»ç»Ÿç»“æ„ï¼Œåˆ©ç”¨å¤šå°å­˜å‚¨æœåŠ¡å™¨åˆ†æ‹…å­˜å‚¨è´Ÿè·ï¼Œåˆ©ç”¨ä½ç½®æœåŠ¡å™¨å®šä½å­˜å‚¨ä¿¡æ¯ï¼Œä¸ä½†è§£å†³äº†ä¼ ç»Ÿé›†ä¸­å¼å­˜å‚¨ç³»ç»Ÿä¸­å•å­˜å‚¨æœåŠ¡å™¨çš„ç“¶é¢ˆé—®é¢˜ï¼Œè¿˜æé«˜äº†ç³»ç»Ÿçš„å¯é æ€§ã€å¯ç”¨æ€§å’Œæ‰©å±•æ€§ã€‚ï¼‰å®ƒæœ‰ä¸€å¥—å¹¿æ³›çš„å¼€å‘è€…åº“å’ŒAPIï¼Œå¹¶ä¸”æ”¯æŒJavaï¼ŒPythonï¼ŒRå’ŒScalaç­‰è¯­è¨€; (ç°åœ¨åœ¨å†™sparkåº”ç”¨ç¨‹åºæ—¶ï¼Œæœ€é•¿ä½¿ç”¨çš„æ˜¯Scalaè¯­è¨€ï¼Œå› ä¸ºsparkçš„æºç å°±æ˜¯ç”¨scalaæ¥ç¼–å†™çš„ï¼Œå†å…¶æ¬¡å°±æ˜¯pythonè¯­è¨€ï¼Œpythonçš„ç¬¬ä¸‰æ–¹åº“å¾ˆå¤šï¼ŒèŠ‚çœäº†ç¨‹åºå‘˜å¾ˆå¤šçš„æ—¶é—´è¦å»è‡ªå·±å®ç°æŸäº›åŠŸèƒ½ï¼Œè¿™ä¸¤ä¸ªè¯­è¨€çš„è¯­æ³•éƒ½å¾ˆç®€æ´ï¼Œä¸Šæ‰‹ç®€å•ï¼Œæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹)å®ƒçš„çµæ´»æ€§ä½¿å…¶éå¸¸é€‚åˆäºå„ç§ç”¨ä¾‹ã€‚Sparké€šå¸¸ä¸Hadoopçš„æ•°æ®å­˜å‚¨æ¨¡å—HDFSä¸€èµ·ä½¿ç”¨ï¼Œä½†å®ƒä¹Ÿå¯ä»¥ä¸HBaseï¼ŒCassandraï¼ŒMapR-DBï¼ŒMongoDBå’ŒAmazon S3 ç­‰å…¶ä»–æµè¡Œçš„æ•°æ®å­˜å‚¨å­ç³»ç»Ÿé›†æˆï¼Œå¹¶ä¸”å¯ä»¥å’ŒKafkaï¼ŒFlumeç­‰æ•°æ®ä¼ è¾“é˜Ÿåˆ—å’Œæ•°æ®é‡‡é›†å·¥å…·ä¸€èµ·æ­é…ä½¿ç”¨ã€‚Who Use SparkSparkæ˜¯ä¸ºæ•°æ®ç§‘å­¦è®¾è®¡çš„ï¼Œå…¶æŠ½è±¡ä½¿æ•°æ®ç§‘å­¦å˜å¾—æ›´åŠ ç®€å•ã€‚æ•°æ®ç§‘å­¦å®¶é€šå¸¸ä½¿ç”¨æœºå™¨å­¦ä¹  - ä¸€å¥—å¯ä»¥ä»æ•°æ®ä¸­å­¦ä¹ çš„æŠ€æœ¯å’Œç®—æ³•ã€‚è¿™äº›ç®—æ³•é€šå¸¸æ˜¯è¿­ä»£çš„ï¼ŒSparkå°†æ•°æ®é›†ç¼“å­˜åœ¨å†…å­˜ä¸­çš„èƒ½åŠ›å¤§å¤§åŠ å¿«äº†è¿­ä»£æ•°æ®å¤„ç†é€Ÿåº¦ï¼Œä½¿å¾—Sparkæˆä¸ºå®ç°è¿™ç§ç®—æ³•çš„ç†æƒ³å¤„ç†å¼•æ“ã€‚Sparkæ˜¯ä¸ºå¤§æ•°æ®å·¥ç¨‹å¸ˆè®¾è®¡çš„ï¼Œåœ¨å¼ºå¤§çš„è®¡ç®—èƒ½åŠ›å’Œä¼˜ç§€çš„æ¶æ„è®¾è®¡é¢å‰ï¼Œå¯ä»¥è®©æ•°æ®å·¥ç¨‹å¸ˆåœ¨ä¸ç®¡æ˜¯ç¦»çº¿æƒ…æ™¯ä¸‹è¿˜æ˜¯å®æ—¶çš„ä¸šåŠ¡éœ€æ±‚ä¸‹ï¼Œéƒ½å¯ä»¥æ”¾å¿ƒçš„é€‰æ‹©ä½¿ç”¨Spark,ä¸€æ¬¡è¯»å–ï¼Œå¹¶è¡ŒåŒ–å¤„ç†ï¼Œå¯¹æ•°æ®é›†æ”¯æŒå®¹é”™ï¼Œæ“ä½œçµæ´»æ€§ï¼Œç¬¬ä¸‰æ–¹ç¤¾åŒºçš„ç§¯ææ”¯æŒï¼Œè™½ç„¶Sparkè¿˜é¢å¯¹ç€ç¼ºç‚¹ï¼Œä½†æˆ‘ç›¸ä¿¡Sparkçš„æ˜å¤©ä¼šæ›´å¥½ã€‚Why Use Sparkåœ¨æŠ€æœ¯ä¸æ–­é«˜é€Ÿæ›´è¿­çš„ç¨‹åºåœˆï¼Œä¸€ä¸ªæ–°å·¥å…·çš„å‡ºç°ä¸æµè¡Œï¼Œå¿…ç„¶æ˜¯å› ä¸ºå®ƒæ»¡è¶³äº†å¾ˆå¤§ä¸€éƒ¨åˆ†äººé•¿æœŸæœªè¢«æ»¡è¶³çš„éœ€æ±‚ï¼Œæˆ–æ˜¯è§£å†³äº†ä¸€ä¸ªé•¿æœŸè®©å¾ˆå¤šäººéš¾å—çš„ç—›ç‚¹ã€‚è¿™é‡Œå°±ä¸èƒ½ä¸æMapReduceäº†ï¼Œæ—¢ç„¶å·²ç»æœ‰äº†çœ‹ä¼¼å¾ˆæˆç†Ÿçš„ Hadoop å’Œ MapReduceï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦ Sparkï¼ŸMapReduce è¢«ç¡…è°·ä¸€çº¿å…¬å¸æ·˜æ±°çš„ä¸¤å¤§ä¸»è¦åŸå› ï¼šé«˜æ˜‚çš„ç»´æŠ¤æˆæœ¬ã€æ—¶é—´æ€§èƒ½â€œè¾¾ä¸åˆ°â€ç”¨æˆ·çš„æœŸå¾…ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒMapReduce æ¨¡å‹çš„æŠ½è±¡å±‚æ¬¡ä½ï¼Œå¤§é‡çš„åº•å±‚é€»è¾‘éƒ½éœ€è¦å¼€å‘è€…æ‰‹å·¥å®Œæˆã€‚åªæä¾› Map å’Œ Reduce ä¸¤ä¸ªæ“ä½œã€‚åœ¨ Hadoop ä¸­ï¼Œæ¯ä¸€ä¸ª Job çš„è®¡ç®—ç»“æœéƒ½ä¼šå­˜å‚¨åœ¨ HDFS æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œæ‰€ä»¥æ¯ä¸€æ­¥è®¡ç®—éƒ½è¦è¿›è¡Œç¡¬ç›˜çš„è¯»å–å’Œå†™å…¥ï¼Œå¤§å¤§å¢åŠ äº†ç³»ç»Ÿçš„å»¶è¿Ÿã€‚ç”±äºè¿™ä¸€åŸå› ï¼ŒMapReduce å¯¹äºè¿­ä»£ç®—æ³•çš„å¤„ç†æ€§èƒ½å¾ˆå·®ï¼Œè€Œä¸”å¾ˆè€—èµ„æºã€‚å› ä¸ºè¿­ä»£çš„æ¯ä¸€æ­¥éƒ½è¦å¯¹ HDFS è¿›è¡Œè¯»å†™ï¼Œæ‰€ä»¥æ¯ä¸€æ­¥éƒ½éœ€è¦å·®ä¸å¤šçš„ç­‰å¾…æ—¶é—´ã€‚ç¬¬å››ï¼Œåªæ”¯æŒæ‰¹æ•°æ®å¤„ç†ï¼Œæ¬ ç¼ºå¯¹æµæ•°æ®å¤„ç†çš„æ”¯æŒã€‚å› æ­¤ï¼Œåœ¨ Hadoop æ¨å‡ºåï¼Œæœ‰å¾ˆå¤šäººæƒ³åŠæ³•å¯¹ Hadoop è¿›è¡Œä¼˜åŒ–ï¼Œå…¶ä¸­å‘å±•åˆ°ç°åœ¨æœ€æˆç†Ÿçš„å°±æ˜¯ Sparkã€‚é€‰æ‹©Sparkæœ‰å¾ˆå¤šåŸå› ï¼Œä½†ä¸‰ä¸ªå…³é”®ï¼šç®€å•æ€§ï¼šSparkçš„åŠŸèƒ½å¯ä»¥é€šè¿‡ä¸€ç»„ä¸°å¯Œçš„APIæ¥è®¿é—®ï¼Œæ‰€æœ‰è¿™äº›éƒ½æ˜¯ä¸“é—¨ä¸ºå¤§è§„æ¨¡æ•°æ®å¿«é€Ÿè½»æ¾åœ°äº¤äº’è€Œè®¾è®¡çš„ã€‚è¿™äº›APIéƒ½æœ‰è¯¦ç»†çš„æ–‡æ¡£å’Œç»“æ„ï¼Œä½¿æ•°æ®ç§‘å­¦å®¶å’Œåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜èƒ½å¤Ÿå¿«é€Ÿåœ°å°†Sparkå·¥ä½œã€‚é€Ÿåº¦ï¼šSparkæ˜¯ä¸ºé€Ÿåº¦è€Œè®¾è®¡çš„ï¼Œå¯ä»¥åœ¨å†…å­˜å’Œç£ç›˜ä¸Šè¿è¡Œã€‚æ¥è‡ªDatabricksçš„å›¢é˜Ÿä½¿ç”¨Sparkåœ¨2014å¹´Daytona Grey Sort 100TB BenchmarkæŒ‘æˆ˜èµ›ä¸­ä¸åŠ åˆ©ç¦å°¼äºšå¤§å­¦åœ£åœ°äºšå“¥åˆ†æ ¡çš„ä¸€é˜Ÿé˜Ÿå‘˜å¹¶åˆ—ç¬¬ä¸€åã€‚æŒ‘æˆ˜åŒ…æ‹¬å¤„ç†é™æ€æ•°æ®é›†; Databrickså›¢é˜Ÿèƒ½å¤Ÿåœ¨23åˆ†é’Ÿå†…å¤„ç†å­˜å‚¨åœ¨å›ºæ€ç¡¬ç›˜ä¸Šçš„100TBçš„æ•°æ®ï¼Œè€Œä¹‹å‰çš„è·èƒœè€…é€šè¿‡ä½¿ç”¨Hadoopå’Œä¸åŒçš„é›†ç¾¤é…ç½®éœ€è¦72åˆ†é’Ÿçš„æ—¶é—´ã€‚åœ¨æ”¯æŒå­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®çš„äº¤äº’å¼æŸ¥è¯¢æ—¶ï¼ŒSparkå¯ä»¥æ‰§è¡Œå¾—æ›´å¥½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰äººå£°ç§°Sparkå¯ä»¥æ¯”Hadoopçš„MapReduceå¿«100å€ã€‚å…³äºé€Ÿåº¦æ¥å¥½å¥½è®²è§£ä¸€ä¸‹ï¼ŒSparkä»¥é€Ÿåº¦ä¸ºå‡ºåï¼Œæ‰€ä»¥è¦æŠŠSparkä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«æ¥èŠä¸€èŠç”±äº Spark å¯ä»¥æŠŠè¿­ä»£è¿‡ç¨‹ä¸­æ¯ä¸€æ­¥çš„è®¡ç®—ç»“æœéƒ½ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥éå¸¸é€‚ç”¨äºå„ç±»è¿­ä»£ç®—æ³•ã€‚Spark ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶éœ€è¦æŠŠæ•°æ®è½½å…¥åˆ°å†…å­˜ï¼Œä¹‹åçš„è¿­ä»£å¯ä»¥ç›´æ¥åœ¨å†…å­˜é‡Œåˆ©ç”¨ä¸­é—´ç»“æœåšä¸è½åœ°çš„è¿ç®—ã€‚æ‰€ä»¥ï¼ŒåæœŸçš„è¿­ä»£é€Ÿåº¦å¿«åˆ°å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚åœ¨å½“ä»Šæœºå™¨å­¦ä¹ å’Œäººå·¥æ™ºèƒ½å¤§çƒ­çš„ç¯å¢ƒä¸‹ï¼ŒSpark æ— ç–‘æ˜¯æ›´å¥½çš„æ•°æ®å¤„ç†å¼•æ“ã€‚ä¸‹å›¾æ˜¯åœ¨ Spark å’Œ Hadoop ä¸Šè¿è¡Œé€»è¾‘å›å½’ç®—æ³•çš„è¿è¡Œæ—¶é—´å¯¹æ¯”ã€‚åœ¨ä»»åŠ¡ï¼ˆtaskï¼‰çº§åˆ«ä¸Šï¼ŒSpark çš„å¹¶è¡Œæœºåˆ¶æ˜¯å¤šçº¿ç¨‹æ¨¡å‹ï¼Œè€Œ MapReduce æ˜¯å¤šè¿›ç¨‹æ¨¡å‹ã€‚å¤šè¿›ç¨‹æ¨¡å‹ä¾¿äºç»†ç²’åº¦æ§åˆ¶æ¯ä¸ªä»»åŠ¡å ç”¨çš„èµ„æºï¼Œä½†ä¼šæ¶ˆè€—è¾ƒå¤šçš„å¯åŠ¨æ—¶é—´ã€‚è€Œ Spark åŒä¸€èŠ‚ç‚¹ä¸Šçš„ä»»åŠ¡ä»¥å¤šçº¿ç¨‹çš„æ–¹å¼è¿è¡Œåœ¨ä¸€ä¸ª JVM è¿›ç¨‹ä¸­ï¼Œå¯ä»¥å¸¦æ¥æ›´å¿«çš„å¯åŠ¨é€Ÿåº¦ã€æ›´é«˜çš„ CPU åˆ©ç”¨ç‡ï¼Œä»¥åŠæ›´å¥½çš„å†…å­˜å…±äº«ã€‚ä»å‰æ–‡ä¸­ä½ å¯ä»¥çœ‹å‡ºï¼ŒSpark ä½œä¸ºæ–°çš„åˆ†å¸ƒå¼æ•°æ®å¤„ç†å¼•æ“ï¼Œå¯¹ MapReduce è¿›è¡Œäº†å¾ˆå¤šæ”¹è¿›ï¼Œä½¿å¾—æ€§èƒ½å¤§å¤§æå‡ï¼Œå¹¶ä¸”æ›´åŠ é€‚ç”¨äºæ–°æ—¶ä»£çš„æ•°æ®å¤„ç†åœºæ™¯ã€‚æ”¯æŒï¼šSparkæ”¯æŒä¸€ç³»åˆ—ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬Javaï¼ŒPythonï¼ŒRå’ŒScalaã€‚å°½ç®¡é€šå¸¸ä¸HDFSå¯†åˆ‡ç›¸å…³ï¼Œä½†Sparkè¿˜åŒ…æ‹¬å¯¹Hadoopç”Ÿæ€ç³»ç»ŸåŠå…¶ä»¥åçš„è®¸å¤šé¢†å…ˆå­˜å‚¨è§£å†³æ–¹æ¡ˆçš„ç´§å¯†é›†æˆçš„æœ¬åœ°æ”¯æŒã€‚æ­¤å¤–ï¼ŒApache Sparkç¤¾åŒºæ˜¯å¤§å‹çš„ï¼Œæ´»è·ƒçš„å’Œå›½é™…æ€§çš„ã€‚åŒ…æ‹¬Databricksï¼ŒIBMä»¥åŠæ‰€æœ‰ä¸»è¦Hadoopä¾›åº”å•†åœ¨å†…çš„ä¸æ–­å¢é•¿çš„å•†ä¸šæä¾›å•†ä¸ºSparkè§£å†³æ–¹æ¡ˆæä¾›å…¨é¢çš„æ”¯æŒã€‚Spark Use Caseéšç€ Apache Sparkçš„å‘å±•åŠ¿å¤´ç»§ç»­å¢é•¿ï¼Œå‡ ä¹æ‰€æœ‰ä¸€ç«™å¼å¤§æ•°æ®å¹³å°éƒ½æ—©å·²é›†æˆSpark,å›½å¤–æœ€ä¸ºè‘—åçš„CDH,HDPï¼Œå›½å†…çš„TDHç­‰ï¼Œæ‰€æœ‰è¡Œä¸šç”¨äºå®é™…åº”ç”¨ã€‚æ­£åœ¨ä½¿ç”¨Sparkæ¥æ”¹å–„ä»–ä»¬çš„ä¸šåŠ¡ï¼Œé€šè¿‡æ£€æµ‹æ¨¡å¼å’Œæä¾›å¯æ“ä½œçš„æ´å¯ŸåŠ›æ¥æ¨åŠ¨ç»„ç»‡å˜é©ï¼Œå¹¶å¼€å§‹æ”¹å˜ç”Ÿæ´»çš„æŸäº›æ–¹é¢ã€‚ä¸‹é¢æä¾›äº†ä¸€äº›ä»ä¿é™©åˆ°äº’è”ç½‘å…¬å¸å¦‚ä½•ä½¿ç”¨Sparkçš„ä¾‹å­ï¼šä¿é™©è¡Œä¸šï¼š é€šè¿‡ä½¿ç”¨Sparkçš„æœºå™¨å­¦ä¹ åŠŸèƒ½æ¥å¤„ç†å’Œåˆ†ææ‰€æœ‰ç´¢èµ”ï¼Œä¼˜åŒ–ç´¢èµ”æŠ¥é”€æµç¨‹ã€‚åŒ»ç–—ä¿å¥ï¼š ä½¿ç”¨Spark Coreï¼ŒStreamingå’ŒSQLæ„å»ºç—…äººæŠ¤ç†ç³»ç»Ÿã€‚é›¶å”®ä¸š ï¼š ä½¿ç”¨Sparkåˆ†æé”€å”®ç‚¹æ•°æ®å’Œä¼˜æƒ åˆ¸ä½¿ç”¨æƒ…å†µã€‚äº’è”ç½‘ ï¼š ä½¿ç”¨Sparkçš„MLåŠŸèƒ½æ¥è¯†åˆ«è™šå‡çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶å¢å¼ºä»–ä»¬å‘å®¢æˆ·å±•ç¤ºçš„äº§å“åŒ¹é…ã€‚é“¶è¡Œä¸š ï¼š ä½¿ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹æ¥é¢„æµ‹æŸäº›é‡‘èäº§å“çš„é›¶å”®é“¶è¡Œå®¢æˆ·çš„èµ„æ–™ã€‚æ”¿åºœ ï¼š åˆ†æåœ°ç†ï¼Œæ—¶é—´å’Œè´¢æ”¿æ”¯å‡ºã€‚ç§‘å­¦ç ”ç©¶ ï¼š é€šè¿‡æ—¶é—´ï¼Œæ·±åº¦ï¼Œåœ°ç†åˆ†æåœ°éœ‡äº‹ä»¶æ¥é¢„æµ‹æœªæ¥çš„äº‹ä»¶ã€‚æŠ•èµ„é“¶è¡Œ ï¼š åˆ†ææ—¥å†…è‚¡ä»·ä»¥é¢„æµ‹æœªæ¥çš„ä»·æ ¼èµ°åŠ¿ã€‚åœ°ç†ç©ºé—´åˆ†æï¼š æŒ‰æ—¶é—´å’Œåœ°ç†åˆ†æUberæ—…è¡Œï¼Œä»¥é¢„æµ‹æœªæ¥çš„éœ€æ±‚å’Œå®šä»·ã€‚Twitteræƒ…ç»ªåˆ†æï¼š åˆ†æå¤§é‡çš„æ¨æ–‡ï¼Œä»¥ç¡®å®šç‰¹å®šç»„ç»‡å’Œäº§å“çš„ç§¯æï¼Œæ¶ˆææˆ–ä¸­ç«‹çš„æƒ…ç»ªã€‚èˆªç©ºå…¬å¸ ï¼š å»ºç«‹é¢„æµ‹èˆªç©ºæ—…è¡Œå»¶è¯¯çš„æ¨¡å‹ã€‚è®¾å¤‡ ï¼š é¢„æµ‹å»ºç­‘ç‰©è¶…è¿‡ä¸´ç•Œæ¸©åº¦çš„å¯èƒ½æ€§ã€‚ä¸Šé¢æ‰€ä¸¾çš„åº”ç”¨å®ä¾‹æ˜¯æƒ³è®©å¤§å®¶æ›´ç›´æ¥çš„å»ç†è§£ï¼ŒSparkåˆ°åº•åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­èƒ½å¸¦æ¥ä»€ä¹ˆæ ·çš„ä½œç”¨å’Œå‘æŒ¥ä»€ä¹ˆæ ·çš„ä»·å€¼ï¼Œå¯¹ä»¥åçš„å­¦ä¹ ï¼Œèƒ½æ›´å¥½çš„æŒ‡å¯¼æ–¹å‘ï¼æœ€åæ¥çº æ­£ä¸€ä¸ªä¸æ­£ç¡®çš„è§‚ç‚¹ï¼Œè²Œä¼¼å¾ˆå¤šæŠ€æœ¯è®ºå›å’Œç½‘ç«™ä¸Šéƒ½æœ‰ä¸€äº›æ ‡é¢˜å…šåœ¨è¯´â€œSparkæ˜¯Hadoopçš„ä»£æ›¿è€…â€ï¼Œâ€œHadoopè¢«Sparkç»ˆç»“â€ç­‰ç±»ä¼¼æ ‡é¢˜çš„æ–‡ç« ï¼Œå†…è¡Œçš„äººä¸€çœ‹å°±æ˜¯è„‘æ®‹ä¸€æ ·çš„æ ‡é¢˜ğŸ˜„ï¼ŒSpark å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œå…¨æ›¿ä»£ Hadoop çš„å…¨æ–°å·¥å…·ã€‚å› ä¸º Hadoop è¿˜åŒ…å«äº†å¾ˆå¤šç»„ä»¶ï¼šæ•°æ®å­˜å‚¨å±‚ï¼šåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿ HDFSï¼Œåˆ†å¸ƒå¼æ•°æ®åº“å­˜å‚¨çš„ HBaseï¼›æ•°æ®å¤„ç†å±‚ï¼šè¿›è¡Œæ•°æ®å¤„ç†çš„ MapReduceï¼Œè´Ÿè´£é›†ç¾¤å’Œèµ„æºç®¡ç†çš„ YARNï¼›æ•°æ®è®¿é—®å±‚ï¼šHiveã€Pigã€Mahoutâ€¦â€¦ä»ç‹­ä¹‰ä¸Šæ¥çœ‹ï¼ŒSpark åªæ˜¯ MapReduce çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå¤§éƒ¨åˆ†åº”ç”¨åœºæ™¯ä¸­ï¼Œå®ƒè¿˜è¦ä¾èµ–äº HDFS å’Œ HBase æ¥å­˜å‚¨æ•°æ®ï¼Œä¾èµ–äº YARN æ¥ç®¡ç†é›†ç¾¤å’Œèµ„æºã€‚å½“ç„¶ï¼ŒSpark å¹¶ä¸æ˜¯ä¸€å®šè¦ä¾é™„äº Hadoop æ‰èƒ½ç”Ÿå­˜ï¼Œå®ƒè¿˜å¯ä»¥è¿è¡Œåœ¨ Apache Mesosã€Kubernetesã€standalone ç­‰å…¶ä»–äº‘å¹³å°ä¸Šã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"}]},{"title":"ã€è½¬è½½ã€‘æ•°æ®ç»“æ„å’Œç®—æ³•çš„æ€ç»´æ¡†æ¶","slug":"ã€è½¬è½½ã€‘æ•°æ®ç»“æ„å’Œç®—æ³•çš„æ€ç»´æ¡†æ¶","date":"2017-02-20T03:34:45.000Z","updated":"2020-05-20T03:39:02.516Z","comments":true,"path":"2017/02/20/ã€è½¬è½½ã€‘æ•°æ®ç»“æ„å’Œç®—æ³•çš„æ€ç»´æ¡†æ¶/","link":"","permalink":"cpeixin.cn/2017/02/20/%E3%80%90%E8%BD%AC%E8%BD%BD%E3%80%91%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95%E7%9A%84%E6%80%9D%E7%BB%B4%E6%A1%86%E6%9E%B6/","excerpt":"","text":"è¿™æ˜¯å¥½ä¹…ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ã€Œå­¦ä¹ æ•°æ®ç»“æ„å’Œç®—æ³•çš„æ¡†æ¶æ€ç»´ã€çš„ä¿®è®¢ç‰ˆã€‚ä¹‹å‰é‚£ç¯‡æ–‡ç« æ”¶åˆ°å¹¿æ³›å¥½è¯„ï¼Œæ²¡çœ‹è¿‡ä¹Ÿæ²¡å…³ç³»ï¼Œè¿™ç¯‡æ–‡ç« ä¼šæ¶µç›–ä¹‹å‰çš„æ‰€æœ‰å†…å®¹ï¼Œå¹¶ä¸”ä¼šä¸¾å¾ˆå¤šä»£ç çš„å®ä¾‹ï¼Œæ•™ä½ å¦‚ä½•ä½¿ç”¨æ¡†æ¶æ€ç»´ã€‚é¦–å…ˆï¼Œè¿™é‡Œè®²çš„éƒ½æ˜¯æ™®é€šçš„æ•°æ®ç»“æ„ï¼Œå’±ä¸æ˜¯æç®—æ³•ç«èµ›çš„ï¼Œé‡è·¯å­å‡ºç”Ÿï¼Œæˆ‘åªä¼šè§£å†³å¸¸è§„çš„é—®é¢˜ã€‚å¦å¤–ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä¸ªäººçš„ç»éªŒçš„æ€»ç»“ï¼Œæ²¡æœ‰å“ªæœ¬ç®—æ³•ä¹¦ä¼šå†™è¿™äº›ä¸œè¥¿ï¼Œæ‰€ä»¥è¯·è¯»è€…è¯•ç€ç†è§£æˆ‘çš„è§’åº¦ï¼Œåˆ«çº ç»“äºç»†èŠ‚é—®é¢˜ï¼Œå› ä¸ºè¿™ç¯‡æ–‡ç« å°±æ˜¯å¸Œæœ›å¯¹æ•°æ®ç»“æ„å’Œç®—æ³•å»ºç«‹ä¸€ä¸ªæ¡†æ¶æ€§çš„è®¤è¯†ã€‚ä»æ•´ä½“åˆ°ç»†èŠ‚ï¼Œè‡ªé¡¶å‘ä¸‹ï¼Œä»æŠ½è±¡åˆ°å…·ä½“çš„æ¡†æ¶æ€ç»´æ˜¯é€šç”¨çš„ï¼Œä¸åªæ˜¯å­¦ä¹ æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œå­¦ä¹ å…¶ä»–ä»»ä½•çŸ¥è¯†éƒ½æ˜¯é«˜æ•ˆçš„ã€‚ä¸€ã€æ•°æ®ç»“æ„çš„å­˜å‚¨æ–¹å¼æ•°æ®ç»“æ„çš„å­˜å‚¨æ–¹å¼åªæœ‰ä¸¤ç§ï¼šæ•°ç»„ï¼ˆé¡ºåºå­˜å‚¨ï¼‰å’Œé“¾è¡¨ï¼ˆé“¾å¼å­˜å‚¨ï¼‰ã€‚è¿™å¥è¯æ€ä¹ˆç†è§£ï¼Œä¸æ˜¯è¿˜æœ‰æ•£åˆ—è¡¨ã€æ ˆã€é˜Ÿåˆ—ã€å †ã€æ ‘ã€å›¾ç­‰ç­‰å„ç§æ•°æ®ç»“æ„å—ï¼Ÿæˆ‘ä»¬åˆ†æé—®é¢˜ï¼Œä¸€å®šè¦æœ‰é€’å½’çš„æ€æƒ³ï¼Œè‡ªé¡¶å‘ä¸‹ï¼Œä»æŠ½è±¡åˆ°å…·ä½“ã€‚ä½ ä¸Šæ¥å°±åˆ—å‡ºè¿™ä¹ˆå¤šï¼Œé‚£äº›éƒ½å±äºã€Œä¸Šå±‚å»ºç­‘ã€ï¼Œè€Œæ•°ç»„å’Œé“¾è¡¨æ‰æ˜¯ã€Œç»“æ„åŸºç¡€ã€ã€‚å› ä¸ºé‚£äº›å¤šæ ·åŒ–çš„æ•°æ®ç»“æ„ï¼Œç©¶å…¶æºå¤´ï¼Œéƒ½æ˜¯åœ¨é“¾è¡¨æˆ–è€…æ•°ç»„ä¸Šçš„ç‰¹æ®Šæ“ä½œï¼ŒAPI ä¸åŒè€Œå·²ã€‚æ¯”å¦‚è¯´ã€Œé˜Ÿåˆ—ã€ã€ã€Œæ ˆã€è¿™ä¸¤ç§æ•°æ®ç»“æ„æ—¢å¯ä»¥ä½¿ç”¨é“¾è¡¨ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°ç»„å®ç°ã€‚ç”¨æ•°ç»„å®ç°ï¼Œå°±è¦å¤„ç†æ‰©å®¹ç¼©å®¹çš„é—®é¢˜ï¼›ç”¨é“¾è¡¨å®ç°ï¼Œæ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œä½†éœ€è¦æ›´å¤šçš„å†…å­˜ç©ºé—´å­˜å‚¨èŠ‚ç‚¹æŒ‡é’ˆã€‚ã€Œå›¾ã€çš„ä¸¤ç§è¡¨ç¤ºæ–¹æ³•ï¼Œé‚»æ¥è¡¨å°±æ˜¯é“¾è¡¨ï¼Œé‚»æ¥çŸ©é˜µå°±æ˜¯äºŒç»´æ•°ç»„ã€‚é‚»æ¥çŸ©é˜µåˆ¤æ–­è¿é€šæ€§è¿…é€Ÿï¼Œå¹¶å¯ä»¥è¿›è¡ŒçŸ©é˜µè¿ç®—è§£å†³ä¸€äº›é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœå›¾æ¯”è¾ƒç¨€ç–çš„è¯å¾ˆè€—è´¹ç©ºé—´ã€‚é‚»æ¥è¡¨æ¯”è¾ƒèŠ‚çœç©ºé—´ï¼Œä½†æ˜¯å¾ˆå¤šæ“ä½œçš„æ•ˆç‡ä¸Šè‚¯å®šæ¯”ä¸è¿‡é‚»æ¥çŸ©é˜µã€‚ã€Œæ•£åˆ—è¡¨ã€å°±æ˜¯é€šè¿‡æ•£åˆ—å‡½æ•°æŠŠé”®æ˜ å°„åˆ°ä¸€ä¸ªå¤§æ•°ç»„é‡Œã€‚è€Œä¸”å¯¹äºè§£å†³æ•£åˆ—å†²çªçš„æ–¹æ³•ï¼Œæ‹‰é“¾æ³•éœ€è¦é“¾è¡¨ç‰¹æ€§ï¼Œæ“ä½œç®€å•ï¼Œä½†éœ€è¦é¢å¤–çš„ç©ºé—´å­˜å‚¨æŒ‡é’ˆï¼›çº¿æ€§æ¢æŸ¥æ³•å°±éœ€è¦æ•°ç»„ç‰¹æ€§ï¼Œä»¥ä¾¿è¿ç»­å¯»å€ï¼Œä¸éœ€è¦æŒ‡é’ˆçš„å­˜å‚¨ç©ºé—´ï¼Œä½†æ“ä½œç¨å¾®å¤æ‚äº›ã€‚ã€Œæ ‘ã€ï¼Œç”¨æ•°ç»„å®ç°å°±æ˜¯ã€Œå †ã€ï¼Œå› ä¸ºã€Œå †ã€æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼Œç”¨æ•°ç»„å­˜å‚¨ä¸éœ€è¦èŠ‚ç‚¹æŒ‡é’ˆï¼Œæ“ä½œä¹Ÿæ¯”è¾ƒç®€å•ï¼›ç”¨é“¾è¡¨å®ç°å°±æ˜¯å¾ˆå¸¸è§çš„é‚£ç§ã€Œæ ‘ã€ï¼Œå› ä¸ºä¸ä¸€å®šæ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œæ‰€ä»¥ä¸é€‚åˆç”¨æ•°ç»„å­˜å‚¨ã€‚ä¸ºæ­¤ï¼Œåœ¨è¿™ç§é“¾è¡¨ã€Œæ ‘ã€ç»“æ„ä¹‹ä¸Šï¼Œåˆè¡ç”Ÿå‡ºå„ç§å·§å¦™çš„è®¾è®¡ï¼Œæ¯”å¦‚äºŒå‰æœç´¢æ ‘ã€AVL æ ‘ã€çº¢é»‘æ ‘ã€åŒºé—´æ ‘ã€B æ ‘ç­‰ç­‰ï¼Œä»¥åº”å¯¹ä¸åŒçš„é—®é¢˜ã€‚äº†è§£ Redis æ•°æ®åº“çš„æœ‹å‹å¯èƒ½ä¹ŸçŸ¥é“ï¼ŒRedis æä¾›åˆ—è¡¨ã€å­—ç¬¦ä¸²ã€é›†åˆç­‰ç­‰å‡ ç§å¸¸ç”¨æ•°æ®ç»“æ„ï¼Œä½†æ˜¯å¯¹äºæ¯ç§æ•°æ®ç»“æ„ï¼Œåº•å±‚çš„å­˜å‚¨æ–¹å¼éƒ½è‡³å°‘æœ‰ä¸¤ç§ï¼Œä»¥ä¾¿äºæ ¹æ®å­˜å‚¨æ•°æ®çš„å®é™…æƒ…å†µä½¿ç”¨åˆé€‚çš„å­˜å‚¨æ–¹å¼ã€‚ç»¼ä¸Šï¼Œæ•°æ®ç»“æ„ç§ç±»å¾ˆå¤šï¼Œç”šè‡³ä½ ä¹Ÿå¯ä»¥å‘æ˜è‡ªå·±çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯åº•å±‚å­˜å‚¨æ— éæ•°ç»„æˆ–è€…é“¾è¡¨ï¼ŒäºŒè€…çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼šæ•°ç»„ç”±äºæ˜¯ç´§å‡‘è¿ç»­å­˜å‚¨,å¯ä»¥éšæœºè®¿é—®ï¼Œé€šè¿‡ç´¢å¼•å¿«é€Ÿæ‰¾åˆ°å¯¹åº”å…ƒç´ ï¼Œè€Œä¸”ç›¸å¯¹èŠ‚çº¦å­˜å‚¨ç©ºé—´ã€‚ä½†æ­£å› ä¸ºè¿ç»­å­˜å‚¨ï¼Œå†…å­˜ç©ºé—´å¿…é¡»ä¸€æ¬¡æ€§åˆ†é…å¤Ÿï¼Œæ‰€ä»¥è¯´æ•°ç»„å¦‚æœè¦æ‰©å®¹ï¼Œéœ€è¦é‡æ–°åˆ†é…ä¸€å—æ›´å¤§çš„ç©ºé—´ï¼Œå†æŠŠæ•°æ®å…¨éƒ¨å¤åˆ¶è¿‡å»ï¼Œæ—¶é—´å¤æ‚åº¦ O(N)ï¼›è€Œä¸”ä½ å¦‚æœæƒ³åœ¨æ•°ç»„ä¸­é—´è¿›è¡Œæ’å…¥å’Œåˆ é™¤ï¼Œæ¯æ¬¡å¿…é¡»æ¬ç§»åé¢çš„æ‰€æœ‰æ•°æ®ä»¥ä¿æŒè¿ç»­ï¼Œæ—¶é—´å¤æ‚åº¦ O(N)ã€‚é“¾è¡¨**å› ä¸ºå…ƒç´ ä¸è¿ç»­ï¼Œè€Œæ˜¯é æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æ•°ç»„çš„æ‰©å®¹é—®é¢˜ï¼›å¦‚æœçŸ¥é“æŸä¸€å…ƒç´ çš„å‰é©±å’Œåé©±ï¼Œæ“ä½œæŒ‡é’ˆå³å¯åˆ é™¤è¯¥å…ƒç´ æˆ–è€…æ’å…¥æ–°å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ O(1)ã€‚ä½†æ˜¯æ­£å› ä¸ºå­˜å‚¨ç©ºé—´ä¸è¿ç»­ï¼Œä½ æ— æ³•æ ¹æ®ä¸€ä¸ªç´¢å¼•ç®—å‡ºå¯¹åº”å…ƒç´ çš„åœ°å€ï¼Œæ‰€ä»¥ä¸èƒ½éšæœºè®¿é—®ï¼›è€Œä¸”ç”±äºæ¯ä¸ªå…ƒç´ å¿…é¡»å­˜å‚¨æŒ‡å‘å‰åå…ƒç´ ä½ç½®çš„æŒ‡é’ˆï¼Œä¼šæ¶ˆè€—ç›¸å¯¹æ›´å¤šçš„å‚¨å­˜ç©ºé—´ã€‚äºŒã€æ•°æ®ç»“æ„çš„åŸºæœ¬æ“ä½œå¯¹äºä»»ä½•æ•°æ®ç»“æ„ï¼Œå…¶åŸºæœ¬æ“ä½œæ— ééå† + è®¿é—®ï¼Œå†å…·ä½“ä¸€ç‚¹å°±æ˜¯ï¼šå¢åˆ æŸ¥æ”¹ã€‚æ•°æ®ç»“æ„ç§ç±»å¾ˆå¤šï¼Œä½†å®ƒä»¬å­˜åœ¨çš„ç›®çš„éƒ½æ˜¯åœ¨ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œå°½å¯èƒ½é«˜æ•ˆåœ°å¢åˆ æŸ¥æ”¹**ã€‚è¯è¯´è¿™ä¸å°±æ˜¯æ•°æ®ç»“æ„çš„ä½¿å‘½ä¹ˆï¼Ÿå¦‚ä½•éå† + è®¿é—®ï¼Ÿæˆ‘ä»¬ä»ç„¶ä»æœ€é«˜å±‚æ¥çœ‹ï¼Œå„ç§æ•°æ®ç»“æ„çš„éå† + è®¿é—®æ— éä¸¤ç§å½¢å¼ï¼šçº¿æ€§çš„å’Œéçº¿æ€§çš„ã€‚çº¿æ€§å°±æ˜¯ for/while è¿­ä»£ä¸ºä»£è¡¨ï¼Œéçº¿æ€§å°±æ˜¯é€’å½’ä¸ºä»£è¡¨ã€‚å†å…·ä½“ä¸€æ­¥ï¼Œæ— éä»¥ä¸‹å‡ ç§æ¡†æ¶ï¼šæ•°ç»„éå†æ¡†æ¶ï¼Œå…¸å‹çš„çº¿æ€§è¿­ä»£ç»“æ„ï¼š12345void traverse(int[] arr) &#123; for (int i = 0; i &lt; arr.length; i++) &#123; // è¿­ä»£è®¿é—® arr[i] &#125;&#125;é“¾è¡¨éå†æ¡†æ¶ï¼Œå…¼å…·è¿­ä»£å’Œé€’å½’ç»“æ„ï¼š1234567891011121314/* åŸºæœ¬çš„å•é“¾è¡¨èŠ‚ç‚¹ */class ListNode &#123; int val; ListNode next;&#125;void traverse(ListNode head) &#123; for (ListNode p = head; p != null; p = p.next) &#123; // è¿­ä»£è®¿é—® p.val &#125;&#125;void traverse(ListNode head) &#123; // é€’å½’è®¿é—® head.val traverse(head.next)&#125;äºŒå‰æ ‘éå†æ¡†æ¶ï¼Œå…¸å‹çš„éçº¿æ€§é€’å½’éå†ç»“æ„ï¼š123456789/* åŸºæœ¬çš„äºŒå‰æ ‘èŠ‚ç‚¹ */class TreeNode &#123; int val; TreeNode left, right;&#125;void traverse(TreeNode root) &#123; traverse(root.left) traverse(root.right)&#125;ä½ çœ‹äºŒå‰æ ‘çš„é€’å½’éå†æ–¹å¼å’Œé“¾è¡¨çš„é€’å½’éå†æ–¹å¼ï¼Œç›¸ä¼¼ä¸ï¼Ÿå†çœ‹çœ‹äºŒå‰æ ‘ç»“æ„å’Œå•é“¾è¡¨ç»“æ„ï¼Œç›¸ä¼¼ä¸ï¼Ÿå¦‚æœå†å¤šå‡ æ¡å‰ï¼ŒN å‰æ ‘ä½ ä¼šä¸ä¼šéå†ï¼ŸäºŒå‰æ ‘æ¡†æ¶å¯ä»¥æ‰©å±•ä¸º N å‰æ ‘çš„éå†æ¡†æ¶ï¼š123456789/* åŸºæœ¬çš„ N å‰æ ‘èŠ‚ç‚¹ */class TreeNode &#123; int val; TreeNode[] children;&#125;void traverse(TreeNode root) &#123; for (TreeNode child : root.children) traverse(child)&#125;N å‰æ ‘çš„éå†åˆå¯ä»¥æ‰©å±•ä¸ºå›¾çš„éå†ï¼Œå› ä¸ºå›¾å°±æ˜¯å¥½å‡  N å‰æ£µæ ‘çš„ç»“åˆä½“ã€‚ä½ è¯´å›¾æ˜¯å¯èƒ½å‡ºç°ç¯çš„ï¼Ÿè¿™ä¸ªå¾ˆå¥½åŠï¼Œç”¨ä¸ªå¸ƒå°”æ•°ç»„ visited åšæ ‡è®°å°±è¡Œäº†ï¼Œè¿™é‡Œå°±ä¸å†™ä»£ç äº†ã€‚æ‰€è°“æ¡†æ¶ï¼Œå°±æ˜¯å¥—è·¯ã€‚ä¸ç®¡å¢åˆ æŸ¥æ”¹ï¼Œè¿™äº›ä»£ç éƒ½æ˜¯æ°¸è¿œæ— æ³•è„±ç¦»çš„ç»“æ„ï¼Œä½ å¯ä»¥æŠŠè¿™ä¸ªç»“æ„ä½œä¸ºå¤§çº²ï¼Œæ ¹æ®å…·ä½“é—®é¢˜åœ¨æ¡†æ¶ä¸Šæ·»åŠ ä»£ç å°±è¡Œäº†ï¼Œä¸‹é¢ä¼šå…·ä½“ä¸¾ä¾‹**ã€‚ä¸‰ã€ç®—æ³•åˆ·é¢˜æŒ‡å—é¦–å…ˆè¦æ˜ç¡®çš„æ˜¯ï¼Œæ•°æ®ç»“æ„æ˜¯å·¥å…·ï¼Œç®—æ³•æ˜¯é€šè¿‡åˆé€‚çš„å·¥å…·è§£å†³ç‰¹å®šé—®é¢˜çš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå­¦ä¹ ç®—æ³•ä¹‹å‰ï¼Œæœ€èµ·ç å¾—äº†è§£é‚£äº›å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œäº†è§£å®ƒä»¬çš„ç‰¹æ€§å’Œç¼ºé™·ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•åœ¨ LeetCode åˆ·é¢˜å‘¢ï¼Ÿä¹‹å‰çš„æ–‡ç« ç®—æ³•å­¦ä¹ ä¹‹è·¯å†™è¿‡ä¸€äº›ï¼Œä»€ä¹ˆæŒ‰æ ‡ç­¾åˆ·ï¼ŒåšæŒä¸‹å»äº‘äº‘ã€‚ç°åœ¨è·é‚£ç¯‡æ–‡ç« å·²ç»è¿‡å»å°†è¿‘ä¸€å¹´äº†ï¼Œæˆ‘ä¸è¯´é‚£äº›ä¸ç—›ä¸ç—’çš„è¯ï¼Œç›´æ¥è¯´å…·ä½“çš„å»ºè®®ï¼šå…ˆåˆ·äºŒå‰æ ‘ï¼Œå…ˆåˆ·äºŒå‰æ ‘ï¼Œå…ˆåˆ·äºŒå‰æ ‘ï¼è¿™æ˜¯æˆ‘è¿™åˆ·é¢˜ä¸€å¹´çš„äº²èº«ä½“ä¼šï¼Œä¸‹å›¾æ˜¯å»å¹´åæœˆä»½çš„æäº¤æˆªå›¾ï¼šå…¬ä¼—å·æ–‡ç« çš„é˜…è¯»æ•°æ®æ˜¾ç¤ºï¼Œå¤§éƒ¨åˆ†äººå¯¹æ•°æ®ç»“æ„ç›¸å…³çš„ç®—æ³•æ–‡ç« ä¸æ„Ÿå…´è¶£ï¼Œè€Œæ˜¯æ›´å…³å¿ƒåŠ¨è§„å›æº¯åˆ†æ²»ç­‰ç­‰æŠ€å·§ã€‚ä¸ºä»€ä¹ˆè¦å…ˆåˆ·äºŒå‰æ ‘å‘¢ï¼Œå› ä¸ºäºŒå‰æ ‘æ˜¯æœ€å®¹æ˜“åŸ¹å…»æ¡†æ¶æ€ç»´çš„ï¼Œè€Œä¸”å¤§éƒ¨åˆ†ç®—æ³•æŠ€å·§ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯æ ‘çš„éå†é—®é¢˜ã€‚åˆ·äºŒå‰æ ‘çœ‹åˆ°é¢˜ç›®æ²¡æ€è·¯ï¼Ÿæ ¹æ®å¾ˆå¤šè¯»è€…çš„é—®é¢˜ï¼Œå…¶å®å¤§å®¶ä¸æ˜¯æ²¡æ€è·¯ï¼Œåªæ˜¯æ²¡æœ‰ç†è§£æˆ‘ä»¬è¯´çš„ã€Œæ¡†æ¶ã€æ˜¯ä»€ä¹ˆã€‚ä¸è¦å°çœ‹è¿™å‡ è¡Œç ´ä»£ç ï¼Œå‡ ä¹æ‰€æœ‰äºŒå‰æ ‘çš„é¢˜ç›®éƒ½æ˜¯ä¸€å¥—è¿™ä¸ªæ¡†æ¶å°±å‡ºæ¥äº†**ã€‚1234567void traverse(TreeNode root) &#123; // å‰åºéå† traverse(root.left) // ä¸­åºéå† traverse(root.right) // ååºéå†&#125;æ¯”å¦‚è¯´æˆ‘éšä¾¿æ‹¿å‡ é“é¢˜çš„è§£æ³•å‡ºæ¥ï¼Œä¸ç”¨ç®¡å…·ä½“çš„ä»£ç é€»è¾‘ï¼Œåªè¦çœ‹çœ‹æ¡†æ¶åœ¨å…¶ä¸­æ˜¯å¦‚ä½•å‘æŒ¥ä½œç”¨çš„å°±è¡Œã€‚LeetCode 124 é¢˜ï¼Œéš¾åº¦ Hardï¼Œè®©ä½ æ±‚äºŒå‰æ ‘ä¸­æœ€å¤§è·¯å¾„å’Œï¼Œä¸»è¦ä»£ç å¦‚ä¸‹ï¼š12345678int ans = INT_MIN;int oneSideMax(TreeNode* root) &#123; if (root == nullptr) return 0; int left = max(0, oneSideMax(root-&gt;left)); int right = max(0, oneSideMax(root-&gt;right)); ans = max(ans, left + right + root-&gt;val); return max(left, right) + root-&gt;val;&#125;ä½ çœ‹ï¼Œè¿™å°±æ˜¯ä¸ªååºéå†å˜›ã€‚LeetCode 105 é¢˜ï¼Œéš¾åº¦ Mediumï¼Œè®©ä½ æ ¹æ®å‰åºéå†å’Œä¸­åºéå†çš„ç»“æœè¿˜åŸä¸€æ£µäºŒå‰æ ‘ï¼Œå¾ˆç»å…¸çš„é—®é¢˜å§ï¼Œä¸»è¦ä»£ç å¦‚ä¸‹ï¼š123456789101112TreeNode buildTree(int[] preorder, int preStart, int preEnd, int[] inorder, int inStart, int inEnd, Map&lt;Integer, Integer&gt; inMap) &#123; if(preStart &gt; preEnd || inStart &gt; inEnd) return null; TreeNode root = new TreeNode(preorder[preStart]); int inRoot = inMap.get(root.val); int numsLeft = inRoot - inStart; root.left = buildTree(preorder, preStart + 1, preStart + numsLeft, inorder, inStart, inRoot - 1, inMap); root.right = buildTree(preorder, preStart + numsLeft + 1, preEnd, inorder, inRoot + 1, inEnd, inMap); return root;&#125;ä¸è¦çœ‹è¿™ä¸ªå‡½æ•°çš„å‚æ•°å¾ˆå¤šï¼Œåªæ˜¯ä¸ºäº†æ§åˆ¶æ•°ç»„ç´¢å¼•è€Œå·²ï¼Œæœ¬è´¨ä¸Šè¯¥ç®—æ³•ä¹Ÿå°±æ˜¯ä¸€ä¸ªå‰åºéå†ã€‚LeetCode 99 é¢˜ï¼Œéš¾åº¦ Hardï¼Œæ¢å¤ä¸€æ£µ BSTï¼Œä¸»è¦ä»£ç å¦‚ä¸‹ï¼š12345678910void traverse(TreeNode* node) &#123; if (!node) return; traverse(node-&gt;left); if (node-&gt;val &lt; prev-&gt;val) &#123; s = (s == NULL) ? prev : s; t = node; &#125; prev = node; traverse(node-&gt;right);&#125;è¿™ä¸å°±æ˜¯ä¸ªä¸­åºéå†å˜›ï¼Œå¯¹äºä¸€æ£µ BST ä¸­åºéå†æ„å‘³ç€ä»€ä¹ˆï¼Œåº”è¯¥ä¸éœ€è¦è§£é‡Šäº†å§ã€‚ä½ çœ‹ï¼ŒHard éš¾åº¦çš„é¢˜ç›®ä¸è¿‡å¦‚æ­¤ï¼Œè€Œä¸”è¿˜è¿™ä¹ˆæœ‰è§„å¾‹å¯å¾ªï¼Œåªè¦æŠŠæ¡†æ¶å†™å‡ºæ¥ï¼Œç„¶åå¾€ç›¸åº”çš„ä½ç½®åŠ ä¸œè¥¿å°±è¡Œäº†ï¼Œè¿™ä¸å°±æ˜¯æ€è·¯å—ã€‚å¯¹äºä¸€ä¸ªç†è§£äºŒå‰æ ‘çš„äººæ¥è¯´ï¼Œåˆ·ä¸€é“äºŒå‰æ ‘çš„é¢˜ç›®èŠ±ä¸äº†å¤šé•¿æ—¶é—´ã€‚é‚£ä¹ˆå¦‚æœä½ å¯¹åˆ·é¢˜æ— ä»ä¸‹æ‰‹æˆ–è€…æœ‰ç•æƒ§å¿ƒç†ï¼Œä¸å¦¨ä»äºŒå‰æ ‘ä¸‹æ‰‹ï¼Œå‰ 10 é“ä¹Ÿè®¸æœ‰ç‚¹éš¾å—ï¼›ç»“åˆæ¡†æ¶å†åš 20 é“ï¼Œä¹Ÿè®¸ä½ å°±æœ‰ç‚¹è‡ªå·±çš„ç†è§£äº†ï¼›åˆ·å®Œæ•´ä¸ªä¸“é¢˜ï¼Œå†å»åšä»€ä¹ˆå›æº¯åŠ¨è§„åˆ†æ²»ä¸“é¢˜ï¼Œä½ å°±ä¼šå‘ç°åªè¦æ¶‰åŠé€’å½’çš„é—®é¢˜ï¼Œéƒ½æ˜¯æ ‘çš„é—®é¢˜ã€‚å†ä¸¾ä¾‹å§ï¼Œè¯´å‡ é“æˆ‘ä»¬ä¹‹å‰æ–‡ç« å†™è¿‡çš„é—®é¢˜ã€‚åŠ¨æ€è§„åˆ’è¯¦è§£è¯´è¿‡å‡‘é›¶é’±é—®é¢˜ï¼Œæš´åŠ›è§£æ³•å°±æ˜¯éå†ä¸€æ£µ N å‰æ ‘ï¼š12345678910111213def coinChange(coins: List[int], amount: int): def dp(n): if n == 0: return 0 if n &lt; 0: return -1 res = float('INF') for coin in coins: subproblem = dp(n - coin) # å­é—®é¢˜æ— è§£ï¼Œè·³è¿‡ if subproblem == -1: continue res = min(res, 1 + subproblem) return res if res != float('INF') else -1 return dp(amount)è¿™ä¹ˆå¤šä»£ç çœ‹ä¸æ‡‚å’‹åŠï¼Ÿç›´æ¥æå–å‡ºæ¡†æ¶ï¼Œå°±èƒ½çœ‹å‡ºæ ¸å¿ƒæ€è·¯äº†ï¼š1234# ä¸è¿‡æ˜¯ä¸€ä¸ª N å‰æ ‘çš„éå†é—®é¢˜è€Œå·²def dp(n): for coin in coins: dp(n - coin)å…¶å®å¾ˆå¤šåŠ¨æ€è§„åˆ’é—®é¢˜å°±æ˜¯åœ¨éå†ä¸€æ£µæ ‘ï¼Œä½ å¦‚æœå¯¹æ ‘çš„éå†æ“ä½œçƒ‚ç†Ÿäºå¿ƒï¼Œèµ·ç çŸ¥é“æ€ä¹ˆæŠŠæ€è·¯è½¬åŒ–æˆä»£ç ï¼Œä¹ŸçŸ¥é“å¦‚ä½•æå–åˆ«äººè§£æ³•çš„æ ¸å¿ƒæ€è·¯ã€‚å†çœ‹çœ‹å›æº¯ç®—æ³•ï¼Œå‰æ–‡å›æº¯ç®—æ³•è¯¦è§£å¹²è„†ç›´æ¥è¯´äº†ï¼Œå›æº¯ç®—æ³•å°±æ˜¯ä¸ª N å‰æ ‘çš„å‰ååºéå†é—®é¢˜ï¼Œæ²¡æœ‰ä¾‹å¤–ã€‚æ¯”å¦‚ N çš‡åé—®é¢˜å§ï¼Œä¸»è¦ä»£ç å¦‚ä¸‹ï¼š12345678910111213141516171819void backtrack(int[] nums, LinkedList&lt;Integer&gt; track) &#123; if (track.size() == nums.length) &#123; res.add(new LinkedList(track)); return; &#125; for (int i = 0; i &lt; nums.length; i++) &#123; if (track.contains(nums[i])) continue; track.add(nums[i]); // è¿›å…¥ä¸‹ä¸€å±‚å†³ç­–æ ‘ backtrack(nums, track); track.removeLast(); &#125;/* æå–å‡º N å‰æ ‘éå†æ¡†æ¶ */void backtrack(int[] nums, LinkedList&lt;Integer&gt; track) &#123; for (int i = 0; i &lt; nums.length; i++) &#123; backtrack(nums, track);&#125;N å‰æ ‘çš„éå†æ¡†æ¶ï¼Œæ‰¾å‡ºæ¥äº†æŠŠï½ä½ è¯´ï¼Œæ ‘è¿™ç§ç»“æ„é‡ä¸é‡è¦ï¼Ÿç»¼ä¸Šï¼Œå¯¹äºç•æƒ§ç®—æ³•çš„æœ‹å‹æ¥è¯´ï¼Œå¯ä»¥å…ˆåˆ·æ ‘çš„ç›¸å…³é¢˜ç›®ï¼Œè¯•ç€ä»æ¡†æ¶ä¸Šçœ‹é—®é¢˜ï¼Œè€Œä¸è¦çº ç»“äºç»†èŠ‚é—®é¢˜ã€‚çº ç»“ç»†èŠ‚é—®é¢˜ï¼Œå°±æ¯”å¦‚çº ç»“ i åˆ°åº•åº”è¯¥åŠ åˆ° n è¿˜æ˜¯åŠ åˆ° n - 1ï¼Œè¿™ä¸ªæ•°ç»„çš„å¤§å°åˆ°åº•åº”è¯¥å¼€ n è¿˜æ˜¯ n + 1 ï¼Ÿä»æ¡†æ¶ä¸Šçœ‹é—®é¢˜ï¼Œå°±æ˜¯åƒæˆ‘ä»¬è¿™æ ·åŸºäºæ¡†æ¶è¿›è¡ŒæŠ½å–å’Œæ‰©å±•ï¼Œæ—¢å¯ä»¥åœ¨çœ‹åˆ«äººè§£æ³•æ—¶å¿«é€Ÿç†è§£æ ¸å¿ƒé€»è¾‘ï¼Œä¹Ÿæœ‰åŠ©äºæ‰¾åˆ°æˆ‘ä»¬è‡ªå·±å†™è§£æ³•æ—¶çš„æ€è·¯æ–¹å‘ã€‚å½“ç„¶ï¼Œå¦‚æœç»†èŠ‚å‡ºé”™ï¼Œä½ å¾—ä¸åˆ°æ­£ç¡®çš„ç­”æ¡ˆï¼Œä½†æ˜¯åªè¦æœ‰æ¡†æ¶ï¼Œä½ å†é”™ä¹Ÿé”™ä¸åˆ°å“ªå»ï¼Œå› ä¸ºä½ çš„æ–¹å‘æ˜¯å¯¹çš„ã€‚ä½†æ˜¯ï¼Œä½ è¦æ˜¯å¿ƒä¸­æ²¡æœ‰æ¡†æ¶ï¼Œé‚£ä¹ˆä½ æ ¹æœ¬æ— æ³•è§£é¢˜ï¼Œç»™äº†ä½ ç­”æ¡ˆï¼Œä½ ä¹Ÿä¸ä¼šå‘ç°è¿™å°±æ˜¯ä¸ªæ ‘çš„éå†é—®é¢˜ã€‚è¿™ç§æ€ç»´æ˜¯å¾ˆé‡è¦çš„ï¼ŒåŠ¨æ€è§„åˆ’è¯¦è§£ä¸­æ€»ç»“çš„æ‰¾çŠ¶æ€è½¬ç§»æ–¹ç¨‹çš„å‡ æ­¥æµç¨‹ï¼Œæœ‰æ—¶å€™æŒ‰ç…§æµç¨‹å†™å‡ºè§£æ³•ï¼Œè¯´å®è¯æˆ‘è‡ªå·±éƒ½ä¸çŸ¥é“ä¸ºå•¥æ˜¯å¯¹çš„ï¼Œåæ­£å®ƒå°±æ˜¯å¯¹äº†ã€‚ã€‚ã€‚è¿™å°±æ˜¯æ¡†æ¶çš„åŠ›é‡ï¼Œèƒ½å¤Ÿä¿è¯ä½ åœ¨å¿«ç¡ç€çš„æ—¶å€™ï¼Œä¾ç„¶èƒ½å†™å‡ºæ­£ç¡®çš„ç¨‹åºï¼›å°±ç®—ä½ å•¥éƒ½ä¸ä¼šï¼Œéƒ½èƒ½æ¯”åˆ«äººé«˜ä¸€ä¸ªçº§åˆ«ã€‚å››ã€æ€»ç»“å‡ å¥æ•°æ®ç»“æ„çš„åŸºæœ¬å­˜å‚¨æ–¹å¼å°±æ˜¯é“¾å¼å’Œé¡ºåºä¸¤ç§ï¼ŒåŸºæœ¬æ“ä½œå°±æ˜¯å¢åˆ æŸ¥æ”¹ï¼Œéå†æ–¹å¼æ— éè¿­ä»£å’Œé€’å½’ã€‚åˆ·ç®—æ³•é¢˜å»ºè®®ä»ã€Œæ ‘ã€åˆ†ç±»å¼€å§‹åˆ·ï¼Œç»“åˆæ¡†æ¶æ€ç»´ï¼ŒæŠŠè¿™å‡ åé“é¢˜åˆ·å®Œï¼Œå¯¹äºæ ‘ç»“æ„çš„ç†è§£åº”è¯¥å°±åˆ°ä½äº†ã€‚è¿™æ—¶å€™å»çœ‹å›æº¯ã€åŠ¨è§„ã€åˆ†æ²»ç­‰ç®—æ³•ä¸“é¢˜ï¼Œå¯¹æ€è·¯çš„ç†è§£å¯èƒ½ä¼šæ›´åŠ æ·±åˆ»ä¸€äº›ã€‚è½¬è½½è‡ªï¼šlabuladong / fucking-algorithm","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[]},{"title":"Scala assert()æ–­è¨€å‡½æ•°","slug":"Scala-assert-æ–­è¨€å‡½æ•°","date":"2017-02-03T16:46:14.000Z","updated":"2020-05-18T16:47:47.992Z","comments":true,"path":"2017/02/04/Scala-assert-æ–­è¨€å‡½æ•°/","link":"","permalink":"cpeixin.cn/2017/02/04/Scala-assert-%E6%96%AD%E8%A8%80%E5%87%BD%E6%95%B0/","excerpt":"","text":"Scala assert()æ–­è¨€å‡½æ•°assertæºç assertçš„ä½œç”¨æ˜¯ç°è®¡ç®—è¡¨è¾¾å¼ assertion ï¼Œå¦‚æœå…¶å€¼ä¸ºå‡ï¼ˆå³ä¸º0ï¼‰ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œç»ˆæ­¢ç¨‹åºè¿è¡Œã€‚å¸¸ç”¨åœ¨å•å…ƒæµ‹è¯•ä¸­è¿›è¡Œå€¼æˆ–è€…æ¡ä»¶çš„åˆ¤æ–­è°ƒè¯•ï¼Œä¾‹å¦‚åœ¨ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬åœ¨æ‰‹åŠ¨æµ‹è¯•æ—¶ï¼Œå¯ä»¥ä¸ç”¨å†™å¤§é‡çš„if elseä»¥ä¸‹æ˜¯ä½¿ç”¨æ–­è¨€çš„å‡ ä¸ªåŸåˆ™ï¼šï¼ˆ1ï¼‰ä½¿ç”¨æ–­è¨€æ•æ‰ä¸åº”è¯¥å‘ç”Ÿçš„éæ³•æƒ…å†µã€‚ä¸è¦æ··æ·†éæ³•æƒ…å†µä¸é”™è¯¯æƒ…å†µä¹‹é—´çš„åŒºåˆ«ï¼Œåè€…æ˜¯å¿…ç„¶å­˜åœ¨çš„å¹¶ä¸”æ˜¯ä¸€å®šè¦ä½œå‡ºå¤„ç†çš„ã€‚ï¼ˆ2ï¼‰ä½¿ç”¨æ–­è¨€å¯¹å‡½æ•°çš„å‚æ•°è¿›è¡Œç¡®è®¤ã€‚ï¼ˆ3ï¼‰åœ¨ç¼–å†™å‡½æ•°æ—¶ï¼Œè¦è¿›è¡Œåå¤çš„è€ƒæŸ¥ï¼Œå¹¶ä¸”è‡ªé—®ï¼šâ€œæˆ‘æ‰“ç®—åšå“ªäº›å‡å®šï¼Ÿâ€ä¸€æ—¦ç¡®å®šäº†çš„å‡å®šï¼Œå°±è¦ä½¿ç”¨æ–­è¨€å¯¹å‡å®šè¿›è¡Œæ£€æŸ¥ã€‚ï¼ˆ4ï¼‰ä¸€èˆ¬æ•™ç§‘ä¹¦éƒ½é¼“åŠ±ç¨‹åºå‘˜ä»¬è¿›è¡Œé˜²é”™æ€§çš„ç¨‹åºè®¾è®¡ï¼Œä½†è¦è®°ä½è¿™ç§ç¼–ç¨‹é£æ ¼ä¼šéšç’é”™è¯¯ã€‚å½“è¿›è¡Œé˜²é”™æ€§ç¼–ç¨‹æ—¶ï¼Œå¦‚æœâ€œä¸å¯èƒ½å‘ç”Ÿâ€çš„äº‹æƒ…çš„ç¡®å‘ç”Ÿäº†ï¼Œåˆ™è¦ä½¿ç”¨æ–­è¨€è¿›è¡ŒæŠ¥è­¦ã€‚ASSERT ()æ˜¯ä¸€ä¸ªè°ƒè¯•ç¨‹åºæ—¶ç»å¸¸ä½¿ç”¨çš„å®ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶å®ƒè®¡ç®—æ‹¬å·å†…çš„è¡¨è¾¾å¼ï¼Œå¦‚æœè¡¨è¾¾å¼ä¸ºFALSE (0), ç¨‹åºå°†æŠ¥å‘Šé”™è¯¯ï¼Œå¹¶ç»ˆæ­¢æ‰§è¡Œã€‚å¦‚æœè¡¨è¾¾å¼ä¸ä¸º0ï¼Œåˆ™ç»§ç»­æ‰§è¡Œåé¢çš„è¯­å¥ã€‚è¿™ä¸ªå®é€šå¸¸åŸæ¥åˆ¤æ–­ç¨‹åºä¸­æ˜¯å¦å‡ºç°äº†æ˜æ˜¾éæ³•çš„æ•°æ®ï¼Œå¦‚æœå‡ºç°äº†ç»ˆæ­¢ç¨‹åºä»¥å…å¯¼è‡´ä¸¥é‡åæœï¼ŒåŒæ—¶ä¹Ÿä¾¿äºæŸ¥æ‰¾é”™è¯¯ã€‚ASSERTåªæœ‰åœ¨Debugç‰ˆæœ¬ä¸­æ‰æœ‰æ•ˆï¼Œå¦‚æœç¼–è¯‘ä¸ºReleaseç‰ˆæœ¬åˆ™è¢«å¿½ç•¥ã€‚æ¯”è¾ƒå¥½çš„åœ¨ç¨‹åºä¸­ä½¿ç”¨assertçš„åœ°æ–¹ï¼š(1)ç©ºæŒ‡é’ˆæ£€æŸ¥ã€‚ä¾‹å¦‚ï¼Œé’ˆå¯¹ä¸€ä¸ªå‡½æ•°çš„å‚æ•°è¿›è¡Œç©ºæŒ‡é’ˆæ£€æŸ¥ã€‚å½“å‡ºç°ç©ºæŒ‡é’ˆæ—¶ï¼Œä½ çš„ç¨‹åºå°±ä¼šé€€å‡ºï¼Œå¹¶å¾ˆå¥½çš„ç»™å‡ºé”™è¯¯ä¿¡æ¯ã€‚(2)æ£€æŸ¥å‡½æ•°å‚æ•°çš„å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°åªèƒ½åœ¨å®ƒçš„ä¸€ä¸ªå‚æ•°å•Šä¸ºæ­£å€¼çš„æ—¶å€™è¢«è°ƒç”¨ï¼Œä½ å¯ä»¥åœ¨å‡½æ•°å¼€å§‹æ—¶è¿™æ ·å†™:assert (a &gt; 0);ï¼Œè¿™å°†å¸®åŠ©ä½ æ£€æµ‹å‡½æ•°çš„é”™è¯¯ä½¿ç”¨ï¼Œè¿™ä¹Ÿç»™æºä»£ç é˜…è¯»è€…å¾ˆæ¸…æ™°çš„å°è±¡ï¼Œé‚£å°±æ˜¯åœ¨è¿™é‡Œå¯¹å‡½æ•°çš„å‚æ•°å€¼æœ‰é™åˆ¶ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"scala","slug":"scala","permalink":"cpeixin.cn/tags/scala/"}]},{"title":"Scala æ–¹æ³•å’Œå‡½æ•°","slug":"Scala-æ–¹æ³•å’Œå‡½æ•°","date":"2017-01-04T09:23:59.000Z","updated":"2020-04-10T03:22:41.218Z","comments":true,"path":"2017/01/04/Scala-æ–¹æ³•å’Œå‡½æ•°/","link":"","permalink":"cpeixin.cn/2017/01/04/Scala-%E6%96%B9%E6%B3%95%E5%92%8C%E5%87%BD%E6%95%B0/","excerpt":"","text":"Scala æ–¹æ³•å’Œå‡½æ•°æ–¹æ³•ä¸å‡½æ•°Scala æœ‰æ–¹æ³•ä¸å‡½æ•°ï¼ŒäºŒè€…åœ¨è¯­ä¹‰ä¸Šçš„åŒºåˆ«å¾ˆå°ã€‚Scala æ–¹æ³•æ˜¯ç±»çš„ä¸€éƒ¨åˆ†ï¼Œè€Œå‡½æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡å¯ä»¥èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ã€‚æ¢å¥è¯æ¥è¯´åœ¨ç±»ä¸­å®šä¹‰çš„å‡½æ•°å³æ˜¯æ–¹æ³•ã€‚Scala ä¸­çš„æ–¹æ³•è·Ÿ Java çš„ç±»ä¼¼ï¼Œæ–¹æ³•æ˜¯ç»„æˆç±»çš„ä¸€éƒ¨åˆ†ã€‚Scala ä¸­çš„å‡½æ•°åˆ™æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡ï¼ŒScala ä¸­çš„å‡½æ•°å…¶å®å°±æ˜¯ç»§æ‰¿äº† Trait çš„ç±»çš„å¯¹è±¡ã€‚Scala ä¸­ä½¿ç”¨ val è¯­å¥å¯ä»¥å®šä¹‰å‡½æ•°ï¼Œdef è¯­å¥å®šä¹‰æ–¹æ³•ã€‚æ–¹æ³•å®šä¹‰æ–¹æ³•å®šä¹‰ç”±ä¸€ä¸ª def å…³é”®å­—å¼€å§‹ï¼Œç´§æ¥ç€æ˜¯å¯é€‰çš„å‚æ•°åˆ—è¡¨ï¼Œä¸€ä¸ªå†’å· : å’Œæ–¹æ³•çš„è¿”å›ç±»å‹ï¼Œä¸€ä¸ªç­‰äºå· = ï¼Œæœ€åæ˜¯æ–¹æ³•çš„ä¸»ä½“ã€‚å®šä¹‰æ ¼å¼å¦‚ä¸‹ï¼š1234def functionName ([å‚æ•°åˆ—è¡¨]) : [return type] = &#123; function body return [expr]&#125;ä»¥ä¸Šä»£ç ä¸­ return type å¯ä»¥æ˜¯ä»»æ„åˆæ³•çš„ Scala æ•°æ®ç±»å‹ã€‚å‚æ•°åˆ—è¡¨ä¸­çš„å‚æ•°å¯ä»¥ä½¿ç”¨é€—å·åˆ†éš”ã€‚ä»¥ä¸‹æ–¹æ³•çš„åŠŸèƒ½æ˜¯å°†ä¸¤ä¸ªä¼ å…¥çš„å‚æ•°ç›¸åŠ å¹¶æ±‚å’Œï¼š1234567object add&#123; def addInt( a:Int, b:Int ) : Int = &#123; var sum:Int = 0 sum = a + b return sum &#125;&#125;å‡½æ•°Scala ä¹Ÿæ˜¯ä¸€ç§å‡½æ•°å¼è¯­è¨€ï¼Œæ‰€ä»¥å‡½æ•°æ˜¯ Scala è¯­è¨€çš„æ ¸å¿ƒã€‚ä»¥ä¸‹ä¸€äº›å‡½æ•°æ¦‚å¿µæœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½çš„ç†è§£ Scala ç¼–ç¨‹ï¼Œå®šä¹‰æ–¹å¼ä¸Šï¼Œå’Œscalaæ–¹æ³•æ˜¯ä¸€æ ·çš„ã€‚ä¼ å€¼å‡½æ•°&amp;ä¼ åå‡½æ•°**Scalaçš„è§£é‡Šå™¨åœ¨è§£æå‡½æ•°å‚æ•°(function arguments)æ—¶æœ‰ä¸¤ç§æ–¹å¼ï¼šå…ˆè®¡ç®—å‚æ•°è¡¨è¾¾å¼çš„å€¼(reduce the arguments)ï¼Œå†åº”ç”¨åˆ°å‡½æ•°å†…éƒ¨ï¼›æˆ–è€…æ˜¯å°†æœªè®¡ç®—çš„å‚æ•°è¡¨è¾¾å¼ç›´æ¥åº”ç”¨åˆ°å‡½æ•°å†…éƒ¨ã€‚å‰è€…å«åšä¼ å€¼è°ƒç”¨ï¼ˆcall-by-valueï¼‰ï¼Œåè€…å«åšä¼ åè°ƒç”¨ï¼ˆcall-by-nameï¼‰123456789101112131415object Test &#123; def main(args: Array[String]) &#123; delayed(time()); &#125; def time() = &#123; println(\"è·å–æ—¶é—´ï¼Œå•ä½ä¸ºçº³ç§’\") System.nanoTime &#125; def delayed( t: =&gt; Long ) = &#123; println(\"åœ¨ delayed æ–¹æ³•å†…\") println(\"å‚æ•°ï¼š \" + t) æ­¤æ—¶è®¡ç®— time()å‡½æ•° t &#125;&#125;æ³¨ï¼šscalaå‡½æ•°ä½“å’Œæ–¹æ³•ä½“ä¸­çš„æœ€åä¸€è¡Œä¸ºè¿”å›å€¼ç»“æœï¼š1234åœ¨ delayed æ–¹æ³•å†…è·å–æ—¶é—´ï¼Œå•ä½ä¸ºçº³ç§’å‚æ•°ï¼š 241550840475831è·å–æ—¶é—´ï¼Œå•ä½ä¸ºçº³ç§’=&gt; Unit ä¸ () =&gt;Unitçš„åŒºåˆ«ç®€å•æ¥è¯´, =&gt; Unitæ˜¯ ä¼ åå‡½æ•°, åªä¼ å…¥äº†ä¸€ä¸ªè¡¨è¾¾å¼, åœ¨è°ƒç”¨æ—¶æ‰ä¼šå»æ‰§è¡Œ, ä½¿ç”¨ codeè°ƒç”¨() =&gt; æ˜¯ä¼ å€¼å‡½æ•°, ä¼ å…¥çš„è®¡ç®—åçš„å€¼ï¼Œç¤ºä¾‹ä¾‹å¦‚ï¼š1234567def function_1(t: () =&gt; Long): Unit = &#123; xxxx &#125; def function_2(t: =&gt; Long): Unit = &#123; xxxx &#125;æŒ‡å®šå‡½æ•°å‚æ•°å**ä¸ç®¡åœ¨ç”¨ä»€ä¹ˆè¯­è¨€åœ¨è¿›è¡Œå¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹äºå‡½æ•°çš„ä¼ å‚ï¼Œæˆ‘ä»¬å‡ ä¹éƒ½æ˜¯æŒ‰ç…§å‡½æ•°å®šä¹‰ä¸­ï¼Œå‚æ•°çš„é¡ºåºè¿›è¡Œä¼ å‚çš„ï¼Œä½†æ˜¯åœ¨Scalaä¸­ä¼šçµæ´»ä¸€äº›ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šå‡½æ•°å‚æ•°åï¼Œå¹¶ä¸”ä¸éœ€è¦æŒ‰ç…§é¡ºåºå‘å‡½æ•°ä¼ é€’å‚æ•°ï¼Œå®ä¾‹å¦‚ä¸‹ï¼š123456789object Test &#123; def main(args: Array[String]) &#123; printInt(b=5, a=7); &#125; def printInt( a:Int, b:Int ) = &#123; println(\"Value of a : \" + a ); println(\"Value of b : \" + b ); &#125;&#125;å¯å˜å‚æ•°**Scala å…è®¸ä½ æŒ‡æ˜å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯é‡å¤çš„ï¼Œå³æˆ‘ä»¬ä¸éœ€è¦æŒ‡å®šå‡½æ•°å‚æ•°çš„ä¸ªæ•°ï¼Œå¯ä»¥å‘å‡½æ•°ä¼ å…¥å¯å˜é•¿åº¦å‚æ•°åˆ—è¡¨ã€‚Scala é€šè¿‡åœ¨å‚æ•°çš„ç±»å‹ä¹‹åæ”¾ä¸€ä¸ªæ˜Ÿå·æ¥è®¾ç½®å¯å˜å‚æ•°(å¯é‡å¤çš„å‚æ•°)ã€‚ä¾‹å¦‚ï¼š123456789101112object Test &#123; def main(args: Array[String]) &#123; printStrings(\"Runoob\", \"Scala\", \"Python\"); &#125; def printStrings( args:String* ) = &#123; var i : Int = 0; for( arg &lt;- args )&#123; println(\"Arg value[\" + i + \"] = \" + arg ); i = i + 1; &#125; &#125;&#125;**é€’å½’å‡½æ•°**12345678910111213object Test &#123; def main(args: Array[String]) &#123; for (i &lt;- 1 to 10) println(i + \" çš„é˜¶ä¹˜ä¸º: = \" + factorial(i) ) &#125; def factorial(n: BigInt): BigInt = &#123; if (n &lt;= 1) 1 else n * factorial(n - 1) &#125;&#125;é»˜è®¤å‚æ•°å€¼Scala å¯ä»¥ä¸ºå‡½æ•°å‚æ•°æŒ‡å®šé»˜è®¤å‚æ•°å€¼ï¼Œä½¿ç”¨äº†é»˜è®¤å‚æ•°ï¼Œä½ åœ¨è°ƒç”¨å‡½æ•°çš„è¿‡ç¨‹ä¸­å¯ä»¥ä¸éœ€è¦ä¼ é€’å‚æ•°ï¼Œè¿™æ—¶å‡½æ•°å°±ä¼šè°ƒç”¨å®ƒçš„é»˜è®¤å‚æ•°å€¼ï¼Œå¦‚æœä¼ é€’äº†å‚æ•°ï¼Œåˆ™ä¼ é€’å€¼ä¼šå–ä»£é»˜è®¤å€¼ã€‚å®ä¾‹å¦‚ä¸‹ï¼š12345678910object Test &#123; def main(args: Array[String]) &#123; println( \"è¿”å›å€¼ : \" + addInt() ); &#125; def addInt( a:Int=5, b:Int=7 ) : Int = &#123; var sum:Int = 0 sum = a + b return sum &#125;&#125;é«˜é˜¶å‡½æ•°é«˜é˜¶å‡½æ•°ï¼ˆHigher-Order Functionï¼‰å°±æ˜¯æ“ä½œå…¶ä»–å‡½æ•°çš„å‡½æ•°ã€‚Scala ä¸­å…è®¸ä½¿ç”¨é«˜é˜¶å‡½æ•°, é«˜é˜¶å‡½æ•°å¯ä»¥ä½¿ç”¨å…¶ä»–å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæˆ–è€…ä½¿ç”¨å‡½æ•°ä½œä¸ºè¾“å‡ºç»“æœã€‚ä»¥ä¸‹å®ä¾‹ä¸­ï¼Œapply() å‡½æ•°ä½¿ç”¨äº†å¦å¤–ä¸€ä¸ªå‡½æ•° f å’Œ å€¼ v ä½œä¸ºå‚æ•°ï¼Œè€Œå‡½æ•° f åˆè°ƒç”¨äº†å‚æ•° vï¼š**123456789101112object Test &#123; def main(args: Array[String]) &#123; println( apply( layout, 10) ) &#125; // å‡½æ•° f å’Œ å€¼ v ä½œä¸ºå‚æ•°ï¼Œè€Œå‡½æ•° f åˆè°ƒç”¨äº†å‚æ•° v def apply(f: Int =&gt; String, v: Int) = f(v) def layout[A](x: A) = \"[\" + x.toString() + \"]\" &#125;åŒ¿åå‡½æ•°**åŒ¿åå‡½æ•°çš„è¯­æ³•å¾ˆç®€å•ï¼Œç®­å¤´å·¦è¾¹æ˜¯å‚æ•°åˆ—è¡¨ï¼Œå³è¾¹æ˜¯å‡½æ•°ä½“ã€‚ä½¿ç”¨åŒ¿åå‡½æ•°åï¼Œæˆ‘ä»¬çš„ä»£ç å˜å¾—æ›´ç®€æ´äº†ã€‚ä¸‹é¢çš„è¡¨è¾¾å¼å°±å®šä¹‰äº†ä¸€ä¸ªæ¥å—ä¸€ä¸ªIntç±»å‹è¾“å…¥å‚æ•°çš„åŒ¿åå‡½æ•°:1var inc = (x:Int) =&gt; x+1ä¸Šè¿°å®šä¹‰çš„åŒ¿åå‡½æ•°ï¼Œå…¶å®æ˜¯ä¸‹é¢è¿™ç§å†™æ³•çš„ç®€å†™ï¼š123def add2 = new Function1[Int,Int]&#123; def apply(x:Int):Int = x+1; &#125;ä»¥ä¸Šå®ä¾‹çš„ inc ç°åœ¨å¯ä½œä¸ºä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š1var x = inc(7)-1åŒæ ·æˆ‘ä»¬å¯ä»¥åœ¨åŒ¿åå‡½æ•°ä¸­å®šä¹‰å¤šä¸ªå‚æ•°ï¼š1var mul = (x: Int, y: Int) =&gt; x*ymul ç°åœ¨å¯ä½œä¸ºä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š1println(mul(3, 4))æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ç»™åŒ¿åå‡½æ•°è®¾ç½®å‚æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š1var userDir = () =&gt; &#123; System.getProperty(\"user.dir\") &#125;userDir ç°åœ¨å¯ä½œä¸ºä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š1println( userDir() )ååº”ç”¨å‡½æ•°ååº”ç”¨å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªè›®æœ‰æ„æ€çš„ç”¨æ³•ï¼Œ**Scala ååº”ç”¨å‡½æ•°æ˜¯ä¸€ç§è¡¨è¾¾å¼ï¼Œä½ ä¸éœ€è¦æä¾›å‡½æ•°éœ€è¦çš„æ‰€æœ‰å‚æ•°ï¼Œåªéœ€è¦æä¾›éƒ¨åˆ†ï¼Œæˆ–ä¸æä¾›æ‰€éœ€å‚æ•°ã€‚1234567891011121314import java.util.Dateobject Test &#123; def main(args: Array[String]) &#123; val date = new Date log(date, \"message1\" ) Thread.sleep(1000) log(date, \"message2\" ) Thread.sleep(1000) log(date, \"message3\" ) &#125; def log(date: Date, message: String) = &#123; println(date + \"----\" + message) &#125;&#125;æ‰§è¡Œä»¥ä¸Šä»£ç ï¼Œè¾“å‡ºç»“æœä¸ºï¼š12345$ scalac Test.scala$ scala TestMon Dec 02 12:52:41 CST 2018----message1Mon Dec 02 12:52:41 CST 2018----message2Mon Dec 02 12:52:41 CST 2018----message3å®ä¾‹ä¸­ï¼Œlog() æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šdate å’Œ messageã€‚æˆ‘ä»¬åœ¨ç¨‹åºæ‰§è¡Œæ—¶è°ƒç”¨äº†ä¸‰æ¬¡ï¼Œå‚æ•° date å€¼éƒ½ç›¸åŒï¼Œmessage ä¸åŒã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ååº”ç”¨å‡½æ•°ä¼˜åŒ–ä»¥ä¸Šæ–¹æ³•ï¼Œç»‘å®šç¬¬ä¸€ä¸ª date å‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä½¿ç”¨ä¸‹åˆ’çº¿(_)æ›¿æ¢ç¼ºå¤±çš„å‚æ•°åˆ—è¡¨ï¼Œå¹¶æŠŠè¿™ä¸ªæ–°çš„å‡½æ•°å€¼çš„ç´¢å¼•çš„èµ‹ç»™å˜é‡ã€‚ä»¥ä¸Šå®ä¾‹ä¿®æ”¹å¦‚ä¸‹ï¼š123456789101112131415import java.util.Dateobject Test &#123; def main(args: Array[String]) &#123; val date = new Date val logWithDateBound = log(date, _ : String) logWithDateBound(\"message1\" ) Thread.sleep(1000) logWithDateBound(\"message2\" ) Thread.sleep(1000) logWithDateBound(\"message3\" ) &#125; def log(date: Date, message: String) = &#123; println(date + \"----\" + message) &#125;&#125;æ‰§è¡Œä»¥ä¸Šä»£ç ï¼Œè¾“å‡ºç»“æœä¸ºå’Œä¸Šé¢çš„æ˜¯ä¸€æ ·çš„ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"scala","slug":"scala","permalink":"cpeixin.cn/tags/scala/"}]},{"title":"Scala åŸºæœ¬è¯­æ³•","slug":"Scala-åŸºæœ¬è¯­æ³•","date":"2017-01-03T09:21:58.000Z","updated":"2020-04-10T03:22:44.338Z","comments":true,"path":"2017/01/03/Scala-åŸºæœ¬è¯­æ³•/","link":"","permalink":"cpeixin.cn/2017/01/03/Scala-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/","excerpt":"","text":"æ•°æ®ç±»å‹Scala ä¸ Javaæœ‰ç€ç›¸åŒçš„æ•°æ®ç±»å‹ï¼Œä¸‹è¡¨åˆ—å‡ºäº† Scala æ”¯æŒçš„æ•°æ®ç±»å‹ï¼šä¸Šè¡¨ä¸­åˆ—å‡ºçš„æ•°æ®ç±»å‹éƒ½æ˜¯å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´scalaæ²¡æœ‰javaä¸­çš„åŸç”Ÿç±»å‹ã€‚åœ¨scalaæ˜¯å¯ä»¥å¯¹æ•°å­—ç­‰åŸºç¡€ç±»å‹è°ƒç”¨æ–¹æ³•çš„ã€‚è¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œå…¶ä¸­éœ€è¦æ³¨æ„çš„ä¸€ç‚¹ï¼Œå°±æ˜¯å­—ç¬¦ä¸å­—ç¬¦ä¸²çš„è¡¨ç¤ºï¼Œå› ä¸ºå¹³å¸¸ä½¿ç”¨pythonç¼–ç¨‹ä¹Ÿæ˜¯æ¯”è¾ƒå¤šçš„ï¼Œåœ¨pythonä¸­å­—ç¬¦ä¸²æ˜¯ç”¨å•å¼•å·è¡¨ç¤ºçš„ï¼Œæ‰€ä»¥åˆ‡æ¢å›scalaï¼Œæ€»ä¼šå‡ºç°ä½¿ç”¨å•å¼•å·å®šä¹‰å­—ç¬¦ä¸²çš„æƒ…å†µåœ¨ Scala å­—ç¬¦å˜é‡ä½¿ç”¨å•å¼•å· â€˜ æ¥å®šä¹‰ï¼Œå¦‚ä¸‹ï¼šâ€˜aâ€™è€Œå­—ç¬¦ä¸²å­—é¢é‡ä½¿ç”¨åŒå¼•å· â€œ æ¥å®šä¹‰ï¼Œå¦‚ä¸‹ï¼šâ€œHello,World!â€å˜é‡å®šä¹‰å£°æ˜å˜é‡å®ä¾‹å¦‚ä¸‹ï¼š1var myVar : String = \"Foo\"å£°æ˜å¸¸é‡å®ä¾‹å¦‚ä¸‹ï¼š1val myVal : String = \"Foo\"ä»¥ä¸Šå®šä¹‰äº†å¸¸é‡ myValï¼Œå®ƒæ˜¯ä¸èƒ½ä¿®æ”¹çš„ã€‚å¦‚æœç¨‹åºå°è¯•ä¿®æ”¹å¸¸é‡ myVal çš„å€¼ï¼Œç¨‹åºå°†ä¼šåœ¨ç¼–è¯‘æ—¶æŠ¥é”™ã€‚å˜é‡ç±»å‹å£°æ˜å˜é‡çš„ç±»å‹åœ¨å˜é‡åä¹‹åçš„ ï¼šå£°æ˜ã€‚å®šä¹‰å˜é‡çš„ç±»å‹çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š12345var VariableName : DataType = Valueæˆ–val VariableName : DataType = Valueåœ¨ Scala ä¸­å£°æ˜å˜é‡å’Œå¸¸é‡ä¸ä¸€å®šè¦æŒ‡æ˜æ•°æ®ç±»å‹ï¼Œåœ¨æ²¡æœ‰æŒ‡æ˜æ•°æ®ç±»å‹çš„æƒ…å†µä¸‹ï¼Œå…¶æ•°æ®ç±»å‹æ˜¯é€šè¿‡å˜é‡æˆ–å¸¸é‡çš„åˆå§‹å€¼æ¨æ–­å‡ºæ¥çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœåœ¨æ²¡æœ‰æŒ‡æ˜æ•°æ®ç±»å‹çš„æƒ…å†µä¸‹å£°æ˜å˜é‡æˆ–å¸¸é‡å¿…é¡»è¦ç»™å‡ºå…¶åˆå§‹å€¼ï¼Œå¦åˆ™å°†ä¼šæŠ¥é”™ã€‚ä¸Šå›¾åˆ™ä¸ºçœç•¥å˜é‡ç±»å‹ï¼Œscalaæ ¹æ®åˆå§‹å€¼è¿›è¡Œåˆ¤æ–­ã€‚ä½†æ˜¯åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œå»ºè®®å¤§å®¶ä¸è¦çœç•¥å˜é‡ç±»å‹ã€‚è®¿é—®ä¿®é¥°ç¬¦Scala è®¿é—®ä¿®é¥°ç¬¦åŸºæœ¬å’ŒJavaçš„ä¸€æ ·ï¼Œåˆ†åˆ«æœ‰ï¼šprivateï¼Œprotectedï¼Œpublicã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šè®¿é—®ä¿®é¥°ç¬¦ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒScala å¯¹è±¡çš„è®¿é—®çº§åˆ«éƒ½æ˜¯ publicã€‚Scala ä¸­çš„ private é™å®šç¬¦ï¼Œæ¯” Java æ›´ä¸¥æ ¼ï¼Œåœ¨åµŒå¥—ç±»æƒ…å†µä¸‹ï¼Œå¤–å±‚ç±»ç”šè‡³ä¸èƒ½è®¿é—®è¢«åµŒå¥—ç±»çš„ç§æœ‰æˆå‘˜ã€‚æ¡ä»¶è¯­å¥1234567891011121314151617181920if(å¸ƒå°”è¡¨è¾¾å¼)&#123; // å¦‚æœå¸ƒå°”è¡¨è¾¾å¼ä¸º true åˆ™æ‰§è¡Œè¯¥è¯­å¥å—&#125;if(å¸ƒå°”è¡¨è¾¾å¼)&#123; // å¦‚æœå¸ƒå°”è¡¨è¾¾å¼ä¸º true åˆ™æ‰§è¡Œè¯¥è¯­å¥å—&#125;else&#123; // å¦‚æœå¸ƒå°”è¡¨è¾¾å¼ä¸º false åˆ™æ‰§è¡Œè¯¥è¯­å¥å—&#125;if(å¸ƒå°”è¡¨è¾¾å¼ 1)&#123; // å¦‚æœå¸ƒå°”è¡¨è¾¾å¼ 1 ä¸º true åˆ™æ‰§è¡Œè¯¥è¯­å¥å—&#125;else if(å¸ƒå°”è¡¨è¾¾å¼ 2)&#123; // å¦‚æœå¸ƒå°”è¡¨è¾¾å¼ 2 ä¸º true åˆ™æ‰§è¡Œè¯¥è¯­å¥å—&#125;else if(å¸ƒå°”è¡¨è¾¾å¼ 3)&#123; // å¦‚æœå¸ƒå°”è¡¨è¾¾å¼ 3 ä¸º true åˆ™æ‰§è¡Œè¯¥è¯­å¥å—&#125;else &#123; // å¦‚æœä»¥ä¸Šæ¡ä»¶éƒ½ä¸º false æ‰§è¡Œè¯¥è¯­å¥å—&#125;å¾ªç¯è¯­å¥è¿™é‡Œå°±ä¸æè¿° while() do while() è¯­å¥äº†å’Œå…¶ä»–è¯­è¨€åŸºæœ¬ä¸€è‡´ï¼Œè¿™é‡Œåªæè¿°å’Œå…¶ä»–è¯­è¨€æœ‰å·®å¼‚çš„forå¾ªç¯è¯­æ³•å¦‚ä¸‹ï¼š1234567891011for( var x &lt;- Range )&#123; statement(s);&#125;ä»¥ä¸Šè¯­æ³•ä¸­ï¼ŒRange å¯ä»¥æ˜¯ä¸€ä¸ªæ•°å­—åŒºé—´è¡¨ç¤º i to j ï¼Œæˆ–è€… i until jã€‚å·¦ç®­å¤´ &lt;- ç”¨äºä¸ºå˜é‡ x èµ‹å€¼ã€‚for( var x &lt;- List )&#123; statement(s);&#125;ä»¥ä¸Šè¯­æ³•ä¸­ï¼Œ List å˜é‡æ˜¯ä¸€ä¸ªé›†åˆï¼Œfor å¾ªç¯ä¼šè¿­ä»£æ‰€æœ‰é›†åˆçš„å…ƒç´ ã€‚yieldï¼šä½ å¯ä»¥åˆ©ç”¨yield å°† for å¾ªç¯ä¸­ç¬¦åˆæ¡ä»¶çš„å€¼ä½œä¸ºä¸€ä¸ªå˜é‡å­˜å‚¨ã€‚è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š12345678910111213141516object Test &#123; def main(args: Array[String]) &#123; var a = 0; val numList = List(1,2,3,4,5,6,7,8,9,10); // for å¾ªç¯ var retVal = for&#123; a &lt;- numList if a != 3; if a &lt; 8 &#125;yield a // è¾“å‡ºè¿”å›å€¼ for( a &lt;- retVal)&#123; println( \"Value of a: \" + a ); &#125; &#125;&#125;","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"scala","slug":"scala","permalink":"cpeixin.cn/tags/scala/"}]},{"title":"Scala åˆ›å»ºç¨‹åºæ–‡ä»¶","slug":"Scala-åˆ›å»ºç¨‹åºæ–‡ä»¶","date":"2017-01-02T09:20:44.000Z","updated":"2020-04-10T03:22:51.424Z","comments":true,"path":"2017/01/02/Scala-åˆ›å»ºç¨‹åºæ–‡ä»¶/","link":"","permalink":"cpeixin.cn/2017/01/02/Scala-%E5%88%9B%E5%BB%BA%E7%A8%8B%E5%BA%8F%E6%96%87%E4%BB%B6/","excerpt":"","text":"Scala æ˜¯ä¸€é—¨ç±» Java çš„ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒç»“åˆäº†é¢å‘å¯¹è±¡ç¼–ç¨‹å’Œå‡½æ•°å¼ç¼–ç¨‹ã€‚Scala æ˜¯çº¯é¢å‘å¯¹è±¡çš„ï¼Œæ¯ä¸ªå€¼éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡çš„ç±»å‹å’Œè¡Œä¸ºç”±ç±»å®šä¹‰ï¼Œä¸åŒçš„ç±»å¯ä»¥é€šè¿‡æ··å…¥(mixin)çš„æ–¹å¼ç»„åˆåœ¨ä¸€èµ·ã€‚Scala çš„è®¾è®¡ç›®çš„æ˜¯è¦å’Œä¸¤ç§ä¸»æµé¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€Java å’Œ C#å®ç°æ— ç¼äº’æ“ä½œï¼Œè¿™ä¸¤ç§ä¸»æµè¯­è¨€éƒ½éçº¯é¢å‘å¯¹è±¡ã€‚Scala ä¹Ÿæ˜¯ä¸€é—¨å‡½æ•°å¼å˜æˆè¯­è¨€ï¼Œæ¯ä¸ªå‡½æ•°éƒ½æ˜¯ä¸€ä¸ªå€¼ï¼ŒåŸç”Ÿæ”¯æŒåµŒå¥—å‡½æ•°å®šä¹‰å’Œé«˜é˜¶å‡½æ•°ã€‚Scala ä¹Ÿæ”¯æŒä¸€ç§é€šç”¨å½¢å¼çš„æ¨¡å¼åŒ¹é…ï¼Œæ¨¡å¼åŒ¹é…ç”¨æ¥æ“ä½œä»£æ•°å¼ç±»å‹ï¼Œåœ¨å¾ˆå¤šå‡½æ•°å¼è¯­è¨€ä¸­éƒ½æœ‰å®ç°ã€‚Scala è¢«è®¾è®¡ç”¨æ¥å’Œ Java æ— ç¼äº’æ“ä½œï¼ˆå¦ä¸€ä¸ªä¿®æ”¹çš„ Scala å®ç°å¯ä»¥å·¥ä½œåœ¨.NETä¸Šï¼‰ã€‚Scala ç±»å¯ä»¥è°ƒç”¨ Java æ–¹æ³•ï¼Œåˆ›å»º Java å¯¹è±¡ï¼Œç»§æ‰¿ Java ç±»å’Œå®ç° Java æ¥å£ã€‚è¿™äº›éƒ½ä¸éœ€è¦é¢å¤–çš„æ¥å£å®šä¹‰æˆ–è€…èƒ¶åˆä»£ç ã€‚å‰è¨€æˆ‘ç›¸ä¿¡å¤§å¤šæ•°æ¥è§¦scalaçš„å·¥ç¨‹å¸ˆï¼Œéƒ½æ˜¯å› ä¸ºæ¥è§¦åˆ°äº†å¤§æ•°æ®æŠ€æœ¯æ ˆï¼Œè€Œè¢«è¿«å»å­¦ä¹ scalaçš„ã€‚scalaè¿™é—¨è¯­è¨€å®Œå…¨å¯ä»¥ç†è§£æˆå› ä¸ºå…¶å¼€æºé¡¹ç›®çš„ç«çˆ†ï¼Œè€Œå°†è¿™é—¨è¯­è¨€å¸¦åˆ°äº†å¤§ä¼—çš„è§†é‡ï¼Œä¾‹å¦‚è®¡ç®—æ¡†æ¶Sparkï¼Œæ¶ˆæ¯é˜Ÿåˆ—Kafkaï¼Œ akkaï¼Œä½¿ç”¨Scalaç¼–å†™Sparkç¨‹åºçœŸçš„æ˜¯å¤ªä¾¿åˆ©äº†ï¼Œç®€æ´çš„å‡½æ•°ç¼–ç¨‹è®©ä½ æ¬²ç½¢ä¸èƒ½ï¼Œé‚£ä¹ˆä»å¦ä¸€æ–¹é¢æ¥è¯´ï¼Œå¦‚æœæœ‰ä¸€å¤©ï¼ŒSparkè¢«å¤§æ•°æ®æŠ€æœ¯æ ˆæ·˜æ±°äº†ï¼Œé‚£ä¹ˆScalaå¯¹äºå¤§æ•°æ®å·¥ç¨‹å¸ˆè¿˜æ˜¯ç¡¬éœ€æ±‚ä¹ˆï¼Ÿä»ç°åœ¨æ¥çœ‹ï¼Œå¼‚å†›çªèµ·çš„Flinkå®æ—¶è®¡ç®—æ¡†æ¶ä¹Ÿæ˜¯æ”¯æŒScalaçš„ï¼ŒåŒæ ·ç›¸å¯¹äºJavaå’Œpythonæ¥è¯´ï¼ŒScalaéƒ½æœ‰ç‹¬ç‰¹è¿·äººçš„åœ°æ–¹ã€‚åˆ›å»ºæ–‡ä»¶å¯¹äºæœ‰å…¶ä»–è¯­è¨€åŸºç¡€çš„å·¥ç¨‹å¸ˆæ¥è®²ï¼Œæ–°å­¦ä¸€é—¨è¯­è¨€å¹¶ä¸éš¾ï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘å°±å…ˆå†™ä¸€äº›ç®€æ˜æ‰¼è¦çš„ï¼Œå·¥ç¨‹å¸ˆçœ‹å®Œå°±å¯ä»¥ç›´æ¥åˆ›å»ºæ–‡ä»¶ï¼Œç¼–å†™hello wordå°±å¯ä»¥è¿è¡Œçš„ã€‚é¦–å…ˆï¼Œæˆ‘å‡å®šä½ å·²ç»é…ç½®å¥½äº†scalaçš„ç¯å¢ƒï¼Œç¼–è¯‘å™¨IDEAä¹Ÿå·²ç»é…ç½®å®Œæ¯•äº†ï¼Œåœ¨é€‰æ‹©å¥½çš„ç›®å½•ä¸­å¯ä»¥åˆ›å»ºScalaæ–‡ä»¶äº†ï¼Œå¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆé€‰æ‹©å‘¢ï¼Ÿç®€å•çš„æ¥è¯´ï¼šç±»classé‡Œæ— staticç±»å‹ï¼Œç±»é‡Œçš„å±æ€§å’Œæ–¹æ³•ï¼Œå¿…é¡»é€šè¿‡newå‡ºæ¥çš„å¯¹è±¡æ¥è°ƒç”¨ï¼Œæ‰€ä»¥æœ‰mainä¸»å‡½æ•°ä¹Ÿæ²¡ç”¨ã€‚è€Œobjectçš„ç‰¹ç‚¹æ˜¯ï¼šå¯ä»¥æ‹¥æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œä¸”é»˜è®¤éƒ½æ˜¯â€staticâ€ç±»å‹ï¼Œå¯ä»¥ç›´æ¥ç”¨objectåç›´æ¥è°ƒç”¨å±æ€§å’Œæ–¹æ³•ï¼Œä¸éœ€è¦é€šè¿‡newå‡ºæ¥çš„å¯¹è±¡ï¼ˆä¹Ÿä¸æ”¯æŒï¼‰ã€‚objecté‡Œçš„mainå‡½æ•°å¼åº”ç”¨ç¨‹åºçš„å…¥å£ã€‚objectå’Œclassæœ‰å¾ˆå¤šå’Œclassç›¸åŒçš„åœ°æ–¹ï¼Œå¯ä»¥extendsçˆ¶ç±»æˆ–Traitï¼Œä½†objectä¸å¯ä»¥extends objectï¼Œå³objectæ— æ³•ä½œä¸ºçˆ¶ç±»ã€‚Scalaçš„Traitç›¸å½“äºJavaé‡Œçš„Interfaceæ ¹æ®ä¸Šé¢çš„çº¢å­—ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çŸ¥é“ï¼Œå¦‚æœæƒ³åˆ›å»ºæ–‡ä»¶ï¼Œå¹¶ä¸”è¿è¡Œæ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©Objectæ¥å†™main()å‡½æ•°mainå‡½æ•°æ€ä¹ˆå†™å‘¢ï¼Ÿ1def main(args: Array[String]) - Scalaç¨‹åºä»main()æ–¹æ³•å¼€å§‹å¤„ç†ï¼Œè¿™æ˜¯æ¯ä¸€ä¸ªScalaç¨‹åºçš„å¼ºåˆ¶ç¨‹åºå…¥å£éƒ¨åˆ†ã€‚æ‰“å° hello word12345object helloword &#123; def main(args: Array[String]): Unit = &#123; println(\"hello word\") &#125;&#125;å‡å¦‚ç°åœ¨ä½ å¯¹scalaå…¶ä»–è¯­æ³•ä¸€æ— æ‰€çŸ¥çš„æƒ…å†µä¸‹ï¼Œä½ æ‡‚çš„äº†æ€ä¹ˆåˆ›å»ºæ–‡ä»¶ï¼Œæ€ä¹ˆå»å®šä¹‰main()å‡½æ•°ï¼Œè¿˜æœ‰å’Œå…¶ä»–è¯­è¨€å·®ä¸å¤ªå¤šçš„æ‰“å°å‡½æ•° println(â€˜â€™)ï¼Œå°±å®Œæˆäº†ç¼–ç¨‹è¯­è¨€ç¬¬ä¸€è¯¾ï¼ŒHelloWorldè¿™é‡Œæœ‰å‡ ä¸ªéœ€è¦è®°ä½çš„ç‚¹scalaè¯­è¨€ï¼Œæ¯è¡Œè¯­å¥åï¼Œä¸ç”¨ ï¼› ç»“å°¾ï¼Œjavaä¸­éœ€è¦ä½¿ç”¨ ï¼›å·ç»“å°¾ï¼Œpythonå’Œscalaä¸€æ ·ï¼Œä¸éœ€è¦åˆ†å·ã€‚ä½†æ˜¯å¦‚æœä½ æƒ³å¦‚æœä¸€è¡Œé‡Œå†™å¤šä¸ªè¯­å¥é‚£ä¹ˆåˆ†å·æ˜¯éœ€è¦çš„ã€‚ä¾‹å¦‚val s = â€œå“ˆå“ˆå“ˆâ€; println(s)Scala ä½¿ç”¨ import å…³é”®å­—å¼•ç”¨åŒ…","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"scala","slug":"scala","permalink":"cpeixin.cn/tags/scala/"}]},{"title":"ç®—æ³• - å›æº¯","slug":"ç®—æ³•-å›æº¯","date":"2016-11-25T23:36:39.000Z","updated":"2020-06-25T23:40:14.275Z","comments":true,"path":"2016/11/26/ç®—æ³•-å›æº¯/","link":"","permalink":"cpeixin.cn/2016/11/26/%E7%AE%97%E6%B3%95-%E5%9B%9E%E6%BA%AF/","excerpt":"","text":"æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•åˆ©ç”¨çš„æ˜¯å›æº¯ç®—æ³•æ€æƒ³ã€‚è¿™ä¸ªç®—æ³•æ€æƒ³éå¸¸ç®€å•ï¼Œä½†æ˜¯åº”ç”¨å´éå¸¸å¹¿æ³›ã€‚å®ƒé™¤äº†ç”¨æ¥æŒ‡å¯¼åƒæ·±åº¦ä¼˜å…ˆæœç´¢è¿™ç§ç»å…¸çš„ç®—æ³•è®¾è®¡ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç”¨åœ¨å¾ˆå¤šå®é™…çš„è½¯ä»¶å¼€å‘åœºæ™¯ä¸­ï¼Œæ¯”å¦‚æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€ç¼–è¯‘åŸç†ä¸­çš„è¯­æ³•åˆ†æç­‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¾ˆå¤šç»å…¸çš„æ•°å­¦é—®é¢˜éƒ½å¯ä»¥ç”¨å›æº¯ç®—æ³•è§£å†³ï¼Œæ¯”å¦‚æ•°ç‹¬ã€å…«çš‡åã€0-1 èƒŒåŒ…ã€å›¾çš„ç€è‰²ã€æ—…è¡Œå•†é—®é¢˜ã€å…¨æ’åˆ—ç­‰ç­‰ã€‚æ—¢ç„¶åº”ç”¨å¦‚æ­¤å¹¿æ³›ï¼Œæˆ‘ä»¬ä»Šå¤©å°±æ¥å­¦ä¹ ä¸€ä¸‹è¿™ä¸ªç®—æ³•æ€æƒ³ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•æŒ‡å¯¼æˆ‘ä»¬è§£å†³é—®é¢˜çš„ã€‚å¦‚ä½•ç†è§£â€œå›æº¯ç®—æ³•â€ï¼Ÿåœ¨æˆ‘ä»¬çš„ä¸€ç”Ÿä¸­ï¼Œä¼šé‡åˆ°å¾ˆå¤šé‡è¦çš„å²”è·¯å£ã€‚åœ¨å²”è·¯å£ä¸Šï¼Œæ¯ä¸ªé€‰æ‹©éƒ½ä¼šå½±å“æˆ‘ä»¬ä»Šåçš„äººç”Ÿã€‚æœ‰çš„äººåœ¨æ¯ä¸ªå²”è·¯å£éƒ½èƒ½åšå‡ºæœ€æ­£ç¡®çš„é€‰æ‹©ï¼Œæœ€åç”Ÿæ´»ã€äº‹ä¸šéƒ½è¾¾åˆ°äº†ä¸€ä¸ªå¾ˆé«˜çš„é«˜åº¦ï¼›è€Œæœ‰çš„äººä¸€è·¯é€‰é”™ï¼Œæœ€åç¢Œç¢Œæ— ä¸ºã€‚å¦‚æœäººç”Ÿå¯ä»¥é‡åŒ–ï¼Œé‚£å¦‚ä½•æ‰èƒ½åœ¨å²”è·¯å£åšå‡ºæœ€æ­£ç¡®çš„é€‰æ‹©ï¼Œè®©è‡ªå·±çš„äººç”Ÿâ€œæœ€ä¼˜â€å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å€ŸåŠ©å‰é¢å­¦è¿‡çš„è´ªå¿ƒç®—æ³•ï¼Œåœ¨æ¯æ¬¡é¢å¯¹å²”è·¯å£çš„æ—¶å€™ï¼Œéƒ½åšå‡ºçœ‹èµ·æ¥æœ€ä¼˜çš„é€‰æ‹©ï¼ŒæœŸæœ›è¿™ä¸€ç»„é€‰æ‹©å¯ä»¥ä½¿å¾—æˆ‘ä»¬çš„äººç”Ÿè¾¾åˆ°â€œæœ€ä¼˜â€ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å‰é¢ä¹Ÿè®²è¿‡ï¼Œè´ªå¿ƒç®—æ³•å¹¶ä¸ä¸€å®šèƒ½å¾—åˆ°æœ€ä¼˜è§£ã€‚é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•èƒ½å¾—åˆ°æœ€ä¼˜è§£å‘¢ï¼Ÿ2004 å¹´ä¸Šæ˜ äº†ä¸€éƒ¨éå¸¸è‘—åçš„ç”µå½±ã€Šè´è¶æ•ˆåº”ã€‹ï¼Œè®²çš„å°±æ˜¯ä¸»äººå…¬ä¸ºäº†è¾¾åˆ°è‡ªå·±çš„ç›®æ ‡ï¼Œä¸€ç›´é€šè¿‡å›æº¯çš„æ–¹æ³•ï¼Œå›åˆ°ç«¥å¹´ï¼Œåœ¨å…³é”®çš„å²”è·¯å£ï¼Œé‡æ–°åšé€‰æ‹©ã€‚å½“ç„¶ï¼Œè¿™åªæ˜¯ç§‘å¹»ç”µå½±ï¼Œæˆ‘ä»¬çš„äººç”Ÿæ˜¯æ— æ³•å€’é€€çš„ï¼Œä½†æ˜¯è¿™å…¶ä¸­è•´å«çš„æ€æƒ³å…¶å®å°±æ˜¯å›æº¯ç®—æ³•ã€‚ç¬¼ç»Ÿåœ°è®²ï¼Œå›æº¯ç®—æ³•å¾ˆå¤šæ—¶å€™éƒ½åº”ç”¨åœ¨â€œæœç´¢â€è¿™ç±»é—®é¢˜ä¸Šã€‚ä¸è¿‡è¿™é‡Œè¯´çš„æœç´¢ï¼Œå¹¶ä¸æ˜¯ç‹­ä¹‰çš„æŒ‡æˆ‘ä»¬å‰é¢è®²è¿‡çš„å›¾çš„æœç´¢ç®—æ³•ï¼Œè€Œæ˜¯åœ¨ä¸€ç»„å¯èƒ½çš„è§£ä¸­ï¼Œæœç´¢æ»¡è¶³æœŸæœ›çš„è§£ã€‚å›æº¯çš„å¤„ç†æ€æƒ³ï¼Œæœ‰ç‚¹ç±»ä¼¼æšä¸¾æœç´¢ã€‚æˆ‘ä»¬æšä¸¾æ‰€æœ‰çš„è§£ï¼Œæ‰¾åˆ°æ»¡è¶³æœŸæœ›çš„è§£ã€‚ä¸ºäº†æœ‰è§„å¾‹åœ°æšä¸¾æ‰€æœ‰å¯èƒ½çš„è§£ï¼Œé¿å…é—æ¼å’Œé‡å¤ï¼Œæˆ‘ä»¬æŠŠé—®é¢˜æ±‚è§£çš„è¿‡ç¨‹åˆ†ä¸ºå¤šä¸ªé˜¶æ®µã€‚æ¯ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬éƒ½ä¼šé¢å¯¹ä¸€ä¸ªå²”è·¯å£ï¼Œæˆ‘ä»¬å…ˆéšæ„é€‰ä¸€æ¡è·¯èµ°ï¼Œå½“å‘ç°è¿™æ¡è·¯èµ°ä¸é€šçš„æ—¶å€™ï¼ˆä¸ç¬¦åˆæœŸæœ›çš„è§£ï¼‰ï¼Œå°±å›é€€åˆ°ä¸Šä¸€ä¸ªå²”è·¯å£ï¼Œå¦é€‰ä¸€ç§èµ°æ³•ç»§ç»­èµ°ã€‚ç†è®ºçš„ä¸œè¥¿è¿˜æ˜¯è¿‡äºæŠ½è±¡ï¼Œè€è§„çŸ©ï¼Œæˆ‘è¿˜æ˜¯ä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹ã€‚æˆ‘ä¸¾ä¸€ä¸ªç»å…¸çš„å›æº¯ä¾‹å­ï¼Œæˆ‘æƒ³ä½ å¯èƒ½å·²ç»çŒœåˆ°äº†ï¼Œé‚£å°±æ˜¯å…«çš‡åé—®é¢˜ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ª 8x8 çš„æ£‹ç›˜ï¼Œå¸Œæœ›å¾€é‡Œæ”¾ 8 ä¸ªæ£‹å­ï¼ˆçš‡åï¼‰ï¼Œæ¯ä¸ªæ£‹å­æ‰€åœ¨çš„è¡Œã€åˆ—ã€å¯¹è§’çº¿éƒ½ä¸èƒ½æœ‰å¦ä¸€ä¸ªæ£‹å­ã€‚ä½ å¯ä»¥çœ‹æˆ‘ç”»çš„å›¾ï¼Œç¬¬ä¸€å¹…å›¾æ˜¯æ»¡è¶³æ¡ä»¶çš„ä¸€ç§æ–¹æ³•ï¼Œç¬¬äºŒå¹…å›¾æ˜¯ä¸æ»¡è¶³æ¡ä»¶çš„ã€‚å…«çš‡åé—®é¢˜å°±æ˜¯æœŸæœ›æ‰¾åˆ°æ‰€æœ‰æ»¡è¶³è¿™ç§è¦æ±‚çš„æ”¾æ£‹å­æ–¹å¼ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªé—®é¢˜åˆ’åˆ†æˆ 8 ä¸ªé˜¶æ®µï¼Œä¾æ¬¡å°† 8 ä¸ªæ£‹å­æ”¾åˆ°ç¬¬ä¸€è¡Œã€ç¬¬äºŒè¡Œã€ç¬¬ä¸‰è¡Œâ€¦â€¦ç¬¬å…«è¡Œã€‚åœ¨æ”¾ç½®çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸åœåœ°æ£€æŸ¥å½“å‰æ”¾æ³•ï¼Œæ˜¯å¦æ»¡è¶³è¦æ±‚ã€‚å¦‚æœæ»¡è¶³ï¼Œåˆ™è·³åˆ°ä¸‹ä¸€è¡Œç»§ç»­æ”¾ç½®æ£‹å­ï¼›å¦‚æœä¸æ»¡è¶³ï¼Œé‚£å°±å†æ¢ä¸€ç§æ”¾æ³•ï¼Œç»§ç»­å°è¯•ã€‚å›æº¯ç®—æ³•éå¸¸é€‚åˆç”¨é€’å½’ä»£ç å®ç°ï¼Œæ‰€ä»¥ï¼Œæˆ‘æŠŠå…«çš‡åçš„ç®—æ³•ç¿»è¯‘æˆä»£ç ã€‚æˆ‘åœ¨ä»£ç é‡Œæ·»åŠ äº†è¯¦ç»†çš„æ³¨é‡Šï¼Œä½ å¯ä»¥å¯¹æ¯”ç€çœ‹ä¸‹ã€‚å¦‚æœä½ ä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡å…«çš‡åé—®é¢˜ï¼Œå»ºè®®ä½ è‡ªå·±ç”¨ç†Ÿæ‚‰çš„ç¼–ç¨‹è¯­è¨€å®ç°ä¸€éï¼Œè¿™å¯¹ä½ ç†è§£å›æº¯æ€æƒ³éå¸¸æœ‰å¸®åŠ©ã€‚12345678910111213141516171819202122232425262728293031323334353637383940int[] result = new int[8];//å…¨å±€æˆ–æˆå‘˜å˜é‡,ä¸‹æ ‡è¡¨ç¤ºè¡Œ,å€¼è¡¨ç¤ºqueenå­˜å‚¨åœ¨å“ªä¸€åˆ—public void cal8queens(int row) &#123; // è°ƒç”¨æ–¹å¼ï¼šcal8queens(0); if (row == 8) &#123; // 8ä¸ªæ£‹å­éƒ½æ”¾ç½®å¥½äº†ï¼Œæ‰“å°ç»“æœ printQueens(result); return; // 8è¡Œæ£‹å­éƒ½æ”¾å¥½äº†ï¼Œå·²ç»æ²¡æ³•å†å¾€ä¸‹é€’å½’äº†ï¼Œæ‰€ä»¥å°±return &#125; for (int column = 0; column &lt; 8; ++column) &#123; // æ¯ä¸€è¡Œéƒ½æœ‰8ä¸­æ”¾æ³• if (isOk(row, column)) &#123; // æœ‰äº›æ”¾æ³•ä¸æ»¡è¶³è¦æ±‚ result[row] = column; // ç¬¬rowè¡Œçš„æ£‹å­æ”¾åˆ°äº†columnåˆ— cal8queens(row+1); // è€ƒå¯Ÿä¸‹ä¸€è¡Œ &#125; &#125;&#125;private boolean isOk(int row, int column) &#123;//åˆ¤æ–­rowè¡Œcolumnåˆ—æ”¾ç½®æ˜¯å¦åˆé€‚ int leftup = column - 1, rightup = column + 1; for (int i = row-1; i &gt;= 0; --i) &#123; // é€è¡Œå¾€ä¸Šè€ƒå¯Ÿæ¯ä¸€è¡Œ if (result[i] == column) return false; // ç¬¬iè¡Œçš„columnåˆ—æœ‰æ£‹å­å—ï¼Ÿ if (leftup &gt;= 0) &#123; // è€ƒå¯Ÿå·¦ä¸Šå¯¹è§’çº¿ï¼šç¬¬iè¡Œleftupåˆ—æœ‰æ£‹å­å—ï¼Ÿ if (result[i] == leftup) return false; &#125; if (rightup &lt; 8) &#123; // è€ƒå¯Ÿå³ä¸Šå¯¹è§’çº¿ï¼šç¬¬iè¡Œrightupåˆ—æœ‰æ£‹å­å—ï¼Ÿ if (result[i] == rightup) return false; &#125; --leftup; ++rightup; &#125; return true;&#125;private void printQueens(int[] result) &#123; // æ‰“å°å‡ºä¸€ä¸ªäºŒç»´çŸ©é˜µ for (int row = 0; row &lt; 8; ++row) &#123; for (int column = 0; column &lt; 8; ++column) &#123; if (result[row] == column) System.out.print(\"Q \"); else System.out.print(\"* \"); &#125; System.out.println(); &#125; System.out.println();&#125;ä¸¤ä¸ªå›æº¯ç®—æ³•çš„ç»å…¸åº”ç”¨å›æº¯ç®—æ³•çš„ç†è®ºçŸ¥è¯†å¾ˆå®¹æ˜“å¼„æ‡‚ã€‚ä¸è¿‡ï¼Œå¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œæ¯”è¾ƒéš¾çš„æ˜¯ç”¨é€’å½’æ¥å®ç°ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å†é€šè¿‡ä¸¤ä¸ªä¾‹å­ï¼Œæ¥ç»ƒä¹ ä¸€ä¸‹å›æº¯ç®—æ³•çš„åº”ç”¨å’Œå®ç°ã€‚1.0-1 èƒŒåŒ…0-1èƒŒåŒ…æ˜¯éå¸¸ç»å…¸çš„ç®—æ³•é—®é¢˜ï¼Œå¾ˆå¤šåœºæ™¯éƒ½å¯ä»¥æŠ½è±¡æˆè¿™ä¸ªé—®é¢˜æ¨¡å‹ã€‚è¿™ä¸ªé—®é¢˜çš„ç»å…¸è§£æ³•æ˜¯åŠ¨æ€è§„åˆ’ï¼Œä¸è¿‡è¿˜æœ‰ä¸€ç§ç®€å•ä½†æ²¡æœ‰é‚£ä¹ˆé«˜æ•ˆçš„è§£æ³•ï¼Œé‚£å°±æ˜¯ä»Šå¤©è®²çš„å›æº¯ç®—æ³•ã€‚åŠ¨æ€è§„åˆ’çš„è§£æ³•æˆ‘ä¸‹ä¸€èŠ‚å†è®²ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ï¼Œå¦‚ä½•ç”¨å›æº¯æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚0-1 èƒŒåŒ…é—®é¢˜æœ‰å¾ˆå¤šå˜ä½“ï¼Œæˆ‘è¿™é‡Œä»‹ç»ä¸€ç§æ¯”è¾ƒåŸºç¡€çš„ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªèƒŒåŒ…ï¼ŒèƒŒåŒ…æ€»çš„æ‰¿è½½é‡é‡æ˜¯ Wkgã€‚ç°åœ¨æˆ‘ä»¬æœ‰ n ä¸ªç‰©å“ï¼Œæ¯ä¸ªç‰©å“çš„é‡é‡ä¸ç­‰ï¼Œå¹¶ä¸”ä¸å¯åˆ†å‰²ã€‚æˆ‘ä»¬ç°åœ¨æœŸæœ›é€‰æ‹©å‡ ä»¶ç‰©å“ï¼Œè£…è½½åˆ°èƒŒåŒ…ä¸­ã€‚åœ¨ä¸è¶…è¿‡èƒŒåŒ…æ‰€èƒ½è£…è½½é‡é‡çš„å‰æä¸‹ï¼Œå¦‚ä½•è®©èƒŒåŒ…ä¸­ç‰©å“çš„æ€»é‡é‡æœ€å¤§ï¼Ÿå®é™…ä¸Šï¼ŒèƒŒåŒ…é—®é¢˜æˆ‘ä»¬åœ¨è´ªå¿ƒç®—æ³•é‚£ä¸€èŠ‚ï¼Œå·²ç»è®²è¿‡ä¸€ä¸ªäº†ï¼Œä¸è¿‡é‚£é‡Œè®²çš„ç‰©å“æ˜¯å¯ä»¥åˆ†å‰²çš„ï¼Œæˆ‘å¯ä»¥è£…æŸä¸ªç‰©å“çš„ä¸€éƒ¨åˆ†åˆ°èƒŒåŒ…é‡Œé¢ã€‚ä»Šå¤©è®²çš„è¿™ä¸ªèƒŒåŒ…é—®é¢˜ï¼Œç‰©å“æ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œè¦ä¹ˆè£…è¦ä¹ˆä¸è£…ï¼Œæ‰€ä»¥å« 0-1 èƒŒåŒ…é—®é¢˜ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸ªé—®é¢˜å·²ç»æ— æ³•é€šè¿‡è´ªå¿ƒç®—æ³•æ¥è§£å†³äº†ã€‚æˆ‘ä»¬ç°åœ¨æ¥çœ‹çœ‹ï¼Œç”¨å›æº¯ç®—æ³•å¦‚ä½•æ¥è§£å†³ã€‚å¯¹äºæ¯ä¸ªç‰©å“æ¥è¯´ï¼Œéƒ½æœ‰ä¸¤ç§é€‰æ‹©ï¼Œè£…è¿›èƒŒåŒ…æˆ–è€…ä¸è£…è¿›èƒŒåŒ…ã€‚å¯¹äº n ä¸ªç‰©å“æ¥è¯´ï¼Œæ€»çš„è£…æ³•å°±æœ‰ 2^n ç§ï¼Œå»æ‰æ€»é‡é‡è¶…è¿‡ Wkg çš„ï¼Œä»å‰©ä¸‹çš„è£…æ³•ä¸­é€‰æ‹©æ€»é‡é‡æœ€æ¥è¿‘ Wkg çš„ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¦‚ä½•æ‰èƒ½ä¸é‡å¤åœ°ç©·ä¸¾å‡ºè¿™ 2^n ç§è£…æ³•å‘¢ï¼Ÿè¿™é‡Œå°±å¯ä»¥ç”¨å›æº¯çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥æŠŠç‰©å“ä¾æ¬¡æ’åˆ—ï¼Œæ•´ä¸ªé—®é¢˜å°±åˆ†è§£ä¸ºäº† n ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µå¯¹åº”ä¸€ä¸ªç‰©å“æ€ä¹ˆé€‰æ‹©ã€‚å…ˆå¯¹ç¬¬ä¸€ä¸ªç‰©å“è¿›è¡Œå¤„ç†ï¼Œé€‰æ‹©è£…è¿›å»æˆ–è€…ä¸è£…è¿›å»ï¼Œç„¶åå†é€’å½’åœ°å¤„ç†å‰©ä¸‹çš„ç‰©å“ã€‚æè¿°èµ·æ¥å¾ˆè´¹åŠ²ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä»£ç ï¼Œåè€Œä¼šæ›´åŠ æ¸…æ™°ä¸€äº›ã€‚è¿™é‡Œè¿˜ç¨å¾®ç”¨åˆ°äº†ä¸€ç‚¹æœç´¢å‰ªæçš„æŠ€å·§ï¼Œå°±æ˜¯å½“å‘ç°å·²ç»é€‰æ‹©çš„ç‰©å“çš„é‡é‡è¶…è¿‡ Wkg ä¹‹åï¼Œæˆ‘ä»¬å°±åœæ­¢ç»§ç»­æ¢æµ‹å‰©ä¸‹çš„ç‰©å“ã€‚ä½ å¯ä»¥çœ‹æˆ‘å†™çš„å…·ä½“çš„ä»£ç ã€‚12345678910111213141516public int maxW = Integer.MIN_VALUE; //å­˜å‚¨èƒŒåŒ…ä¸­ç‰©å“æ€»é‡é‡çš„æœ€å¤§å€¼// cwè¡¨ç¤ºå½“å‰å·²ç»è£…è¿›å»çš„ç‰©å“çš„é‡é‡å’Œï¼›iè¡¨ç¤ºè€ƒå¯Ÿåˆ°å“ªä¸ªç‰©å“äº†ï¼›// wèƒŒåŒ…é‡é‡ï¼›itemsè¡¨ç¤ºæ¯ä¸ªç‰©å“çš„é‡é‡ï¼›nè¡¨ç¤ºç‰©å“ä¸ªæ•°// å‡è®¾èƒŒåŒ…å¯æ‰¿å—é‡é‡100ï¼Œç‰©å“ä¸ªæ•°10ï¼Œç‰©å“é‡é‡å­˜å‚¨åœ¨æ•°ç»„aä¸­ï¼Œé‚£å¯ä»¥è¿™æ ·è°ƒç”¨å‡½æ•°ï¼š// f(0, 0, a, 10, 100)public void f(int i, int cw, int[] items, int n, int w) &#123; if (cw == w || i == n) &#123; // cw==wè¡¨ç¤ºè£…æ»¡äº†;i==nè¡¨ç¤ºå·²ç»è€ƒå¯Ÿå®Œæ‰€æœ‰çš„ç‰©å“ if (cw &gt; maxW) maxW = cw; return; &#125; f(i+1, cw, items, n, w); if (cw + items[i] &lt;= w) &#123;// å·²ç»è¶…è¿‡å¯ä»¥èƒŒåŒ…æ‰¿å—çš„é‡é‡çš„æ—¶å€™ï¼Œå°±ä¸è¦å†è£…äº† f(i+1,cw + items[i], items, n, w); &#125;&#125;2. æ­£åˆ™è¡¨è¾¾å¼çœ‹æ‡‚äº† 0-1 èƒŒåŒ…é—®é¢˜ï¼Œæˆ‘ä»¬å†æ¥çœ‹å¦å¤–ä¸€ä¸ªä¾‹å­ï¼Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚å¯¹äºä¸€ä¸ªå¼€å‘å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä½ åº”è¯¥ä¸é™Œç”Ÿå§ï¼Ÿåœ¨å¹³æ—¶çš„å¼€å‘ä¸­ï¼Œæˆ–å¤šæˆ–å°‘éƒ½åº”è¯¥ç”¨è¿‡ã€‚å®é™…ä¸Šï¼Œæ­£åˆ™è¡¨è¾¾å¼é‡Œæœ€é‡è¦çš„ä¸€ç§ç®—æ³•æ€æƒ³å°±æ˜¯å›æº¯ã€‚æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œæœ€é‡è¦çš„å°±æ˜¯é€šé…ç¬¦ï¼Œé€šé…ç¬¦ç»“åˆåœ¨ä¸€èµ·ï¼Œå¯ä»¥è¡¨è¾¾éå¸¸ä¸°å¯Œçš„è¯­ä¹‰ã€‚ä¸ºäº†æ–¹ä¾¿è®²è§£ï¼Œæˆ‘å‡è®¾æ­£åˆ™è¡¨è¾¾å¼ä¸­åªåŒ…å«â€œâ€å’Œâ€œ?â€è¿™ä¸¤ç§é€šé…ç¬¦ï¼Œå¹¶ä¸”å¯¹è¿™ä¸¤ä¸ªé€šé…ç¬¦çš„è¯­ä¹‰ç¨å¾®åšäº›æ”¹å˜ï¼Œå…¶ä¸­ï¼Œâ€œâ€åŒ¹é…ä»»æ„å¤šä¸ªï¼ˆå¤§äºç­‰äº 0 ä¸ªï¼‰ä»»æ„å­—ç¬¦ï¼Œâ€œ?â€åŒ¹é…é›¶ä¸ªæˆ–è€…ä¸€ä¸ªä»»æ„å­—ç¬¦ã€‚åŸºäºä»¥ä¸ŠèƒŒæ™¯å‡è®¾ï¼Œæˆ‘ä»¬çœ‹ä¸‹ï¼Œå¦‚ä½•ç”¨å›æº¯ç®—æ³•ï¼Œåˆ¤æ–­ä¸€ä¸ªç»™å®šçš„æ–‡æœ¬ï¼Œèƒ½å¦è·Ÿç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Ÿæˆ‘ä»¬ä¾æ¬¡è€ƒå¯Ÿæ­£åˆ™è¡¨è¾¾å¼ä¸­çš„æ¯ä¸ªå­—ç¬¦ï¼Œå½“æ˜¯éé€šé…ç¬¦æ—¶ï¼Œæˆ‘ä»¬å°±ç›´æ¥è·Ÿæ–‡æœ¬çš„å­—ç¬¦è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœç›¸åŒï¼Œåˆ™ç»§ç»­å¾€ä¸‹å¤„ç†ï¼›å¦‚æœä¸åŒï¼Œåˆ™å›æº¯ã€‚å¦‚æœé‡åˆ°ç‰¹æ®Šå­—ç¬¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±æœ‰å¤šç§å¤„ç†æ–¹å¼äº†ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„å²”è·¯å£ï¼Œæ¯”å¦‚â€œ*â€æœ‰å¤šç§åŒ¹é…æ–¹æ¡ˆï¼Œå¯ä»¥åŒ¹é…ä»»æ„ä¸ªæ–‡æœ¬ä¸²ä¸­çš„å­—ç¬¦ï¼Œæˆ‘ä»¬å°±å…ˆéšæ„çš„é€‰æ‹©ä¸€ç§åŒ¹é…æ–¹æ¡ˆï¼Œç„¶åç»§ç»­è€ƒå¯Ÿå‰©ä¸‹çš„å­—ç¬¦ã€‚å¦‚æœä¸­é€”å‘ç°æ— æ³•ç»§ç»­åŒ¹é…ä¸‹å»äº†ï¼Œæˆ‘ä»¬å°±å›åˆ°è¿™ä¸ªå²”è·¯å£ï¼Œé‡æ–°é€‰æ‹©ä¸€ç§åŒ¹é…æ–¹æ¡ˆï¼Œç„¶åå†ç»§ç»­åŒ¹é…å‰©ä¸‹çš„å­—ç¬¦ã€‚æœ‰äº†å‰é¢çš„åŸºç¡€ï¼Œæ˜¯ä¸æ˜¯è¿™ä¸ªé—®é¢˜å°±å¥½æ‡‚å¤šäº†å‘¢ï¼Ÿæˆ‘æŠŠè¿™ä¸ªè¿‡ç¨‹ç¿»è¯‘æˆäº†ä»£ç ï¼Œä½ å¯ä»¥ç»“åˆç€ä¸€å—çœ‹ä¸‹ï¼Œåº”è¯¥æœ‰åŠ©äºä½ ç†è§£ã€‚1234567891011121314151617181920212223242526272829303132333435public class Pattern &#123; private boolean matched = false; private char[] pattern; // æ­£åˆ™è¡¨è¾¾å¼ private int plen; // æ­£åˆ™è¡¨è¾¾å¼é•¿åº¦ public Pattern(char[] pattern, int plen) &#123; this.pattern = pattern; this.plen = plen; &#125; public boolean match(char[] text, int tlen) &#123; // æ–‡æœ¬ä¸²åŠé•¿åº¦ matched = false; rmatch(0, 0, text, tlen); return matched; &#125; private void rmatch(int ti, int pj, char[] text, int tlen) &#123; if (matched) return; // å¦‚æœå·²ç»åŒ¹é…äº†ï¼Œå°±ä¸è¦ç»§ç»­é€’å½’äº† if (pj == plen) &#123; // æ­£åˆ™è¡¨è¾¾å¼åˆ°ç»“å°¾äº† if (ti == tlen) matched = true; // æ–‡æœ¬ä¸²ä¹Ÿåˆ°ç»“å°¾äº† return; &#125; if (pattern[pj] == '*') &#123; // *åŒ¹é…ä»»æ„ä¸ªå­—ç¬¦ for (int k = 0; k &lt;= tlen-ti; ++k) &#123; rmatch(ti+k, pj+1, text, tlen); &#125; &#125; else if (pattern[pj] == '?') &#123; // ?åŒ¹é…0ä¸ªæˆ–è€…1ä¸ªå­—ç¬¦ rmatch(ti, pj+1, text, tlen); rmatch(ti+1, pj+1, text, tlen); &#125; else if (ti &lt; tlen &amp;&amp; pattern[pj] == text[ti]) &#123; // çº¯å­—ç¬¦åŒ¹é…æ‰è¡Œ rmatch(ti+1, pj+1, text, tlen); &#125; &#125;&#125;å†…å®¹å°ç»“å›æº¯ç®—æ³•çš„æ€æƒ³éå¸¸ç®€å•ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ç”¨æ¥è§£å†³å¹¿ä¹‰çš„æœç´¢é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ï¼Œä»ä¸€ç»„å¯èƒ½çš„è§£ä¸­ï¼Œé€‰æ‹©å‡ºä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„è§£ã€‚å›æº¯ç®—æ³•éå¸¸é€‚åˆç”¨é€’å½’æ¥å®ç°ï¼Œåœ¨å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œå‰ªææ“ä½œæ˜¯æé«˜å›æº¯æ•ˆç‡çš„ä¸€ç§æŠ€å·§ã€‚åˆ©ç”¨å‰ªæï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ç©·ä¸¾æœç´¢æ‰€æœ‰çš„æƒ…å†µï¼Œä»è€Œæé«˜æœç´¢æ•ˆç‡ã€‚å°½ç®¡å›æº¯ç®—æ³•çš„åŸç†éå¸¸ç®€å•ï¼Œä½†æ˜¯å´å¯ä»¥è§£å†³å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬å¼€å¤´æåˆ°çš„æ·±åº¦ä¼˜å…ˆæœç´¢ã€å…«çš‡åã€0-1 èƒŒåŒ…é—®é¢˜ã€å›¾çš„ç€è‰²ã€æ—…è¡Œå•†é—®é¢˜ã€æ•°ç‹¬ã€å…¨æ’åˆ—ã€æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç­‰ç­‰ã€‚å¦‚æœæ„Ÿå…´è¶£çš„è¯ï¼Œä½ å¯ä»¥è‡ªå·±æœç´¢ç ”ç©¶ä¸€ä¸‹ï¼Œæœ€å¥½è¿˜èƒ½ç”¨ä»£ç å®ç°ä¸€ä¸‹ã€‚å¦‚æœè¿™å‡ ä¸ªé—®é¢˜éƒ½èƒ½å®ç°çš„è¯ï¼Œä½ åŸºæœ¬å°±æŒæ¡äº†å›æº¯ç®—æ³•ã€‚","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"å›æº¯","slug":"å›æº¯","permalink":"cpeixin.cn/tags/%E5%9B%9E%E6%BA%AF/"}]},{"title":"æ•°æ®ç»“æ„ - å †","slug":"æ•°æ®ç»“æ„-å †","date":"2016-11-16T18:17:37.000Z","updated":"2020-06-16T18:19:30.651Z","comments":true,"path":"2016/11/17/æ•°æ®ç»“æ„-å †/","link":"","permalink":"cpeixin.cn/2016/11/17/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%A0%86/","excerpt":"","text":"æˆ‘ä»¬ä»Šå¤©è®²å¦å¤–ä¸€ç§ç‰¹æ®Šçš„æ ‘ï¼Œâ€œå †â€ï¼ˆHeapï¼‰ã€‚å †è¿™ç§æ•°æ®ç»“æ„çš„åº”ç”¨åœºæ™¯éå¸¸å¤šï¼Œæœ€ç»å…¸çš„è«è¿‡äºå †æ’åºäº†ã€‚å †æ’åºæ˜¯ä¸€ç§åŸåœ°çš„ã€æ—¶é—´å¤æ‚åº¦ä¸º O(nlogn) çš„æ’åºç®—æ³•ã€‚å‰é¢æˆ‘ä»¬å­¦è¿‡å¿«é€Ÿæ’åºï¼Œå¹³å‡æƒ…å†µä¸‹ï¼Œå®ƒçš„æ—¶é—´å¤æ‚åº¦ä¸º O(nlogn)ã€‚å°½ç®¡è¿™ä¸¤ç§æ’åºç®—æ³•çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(nlogn)ï¼Œç”šè‡³å †æ’åºæ¯”å¿«é€Ÿæ’åºçš„æ—¶é—´å¤æ‚åº¦è¿˜è¦ç¨³å®šï¼Œä½†æ˜¯ï¼Œåœ¨å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œå¿«é€Ÿæ’åºçš„æ€§èƒ½è¦æ¯”å †æ’åºå¥½ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå¦‚ä½•ç†è§£â€œå †â€ï¼Ÿå‰é¢æˆ‘ä»¬æåˆ°ï¼Œå †æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ‘ã€‚æˆ‘ä»¬ç°åœ¨å°±æ¥çœ‹çœ‹ï¼Œä»€ä¹ˆæ ·çš„æ ‘æ‰æ˜¯å †ã€‚æˆ‘ç½—åˆ—äº†ä¸¤ç‚¹è¦æ±‚ï¼Œåªè¦æ»¡è¶³è¿™ä¸¤ç‚¹ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå †ã€‚å †æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼›å †ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¿…é¡»å¤§äºç­‰äºï¼ˆæˆ–å°äºç­‰äºï¼‰å…¶å­æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ã€‚æˆ‘åˆ†åˆ«è§£é‡Šä¸€ä¸‹è¿™ä¸¤ç‚¹ã€‚ç¬¬ä¸€ç‚¹ï¼Œå †å¿…é¡»æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ã€‚è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰è®²çš„å®Œå…¨äºŒå‰æ ‘çš„å®šä¹‰å—ï¼Ÿå®Œå…¨äºŒå‰æ ‘è¦æ±‚ï¼Œé™¤äº†æœ€åä¸€å±‚ï¼Œå…¶ä»–å±‚çš„èŠ‚ç‚¹ä¸ªæ•°éƒ½æ˜¯æ»¡çš„ï¼Œæœ€åä¸€å±‚çš„èŠ‚ç‚¹éƒ½é å·¦æ’åˆ—ã€‚ç¬¬äºŒç‚¹ï¼Œå †ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹çš„å€¼å¿…é¡»å¤§äºç­‰äºï¼ˆæˆ–è€…å°äºç­‰äºï¼‰å…¶å­æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ¢ä¸€ç§è¯´æ³•ï¼Œå †ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºï¼ˆæˆ–è€…å°äºç­‰äºï¼‰å…¶å·¦å³å­èŠ‚ç‚¹çš„å€¼ã€‚è¿™ä¸¤ç§è¡¨è¿°æ˜¯ç­‰ä»·çš„ã€‚å¯¹äºæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºå­æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹å€¼çš„å †ï¼Œæˆ‘ä»¬å«ä½œâ€œå¤§é¡¶å †â€ã€‚å¯¹äºæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å°äºç­‰äºå­æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹å€¼çš„å †ï¼Œæˆ‘ä»¬å«ä½œâ€œå°é¡¶å †â€ã€‚å®šä¹‰è§£é‡Šæ¸…æ¥šäº†ï¼Œä½ æ¥çœ‹çœ‹ï¼Œä¸‹é¢è¿™å‡ ä¸ªäºŒå‰æ ‘æ˜¯ä¸æ˜¯å †ï¼Ÿå…¶ä¸­ç¬¬ 1 ä¸ªå’Œç¬¬ 2 ä¸ªæ˜¯å¤§é¡¶å †ï¼Œç¬¬ 3 ä¸ªæ˜¯å°é¡¶å †ï¼Œç¬¬ 4 ä¸ªä¸æ˜¯å †ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä»å›¾ä¸­è¿˜å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¯¹äºåŒä¸€ç»„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºå¤šç§ä¸åŒå½¢æ€çš„å †ã€‚å¦‚ä½•å®ç°ä¸€ä¸ªå †ï¼Ÿè¦å®ç°ä¸€ä¸ªå †ï¼Œæˆ‘ä»¬å…ˆè¦çŸ¥é“ï¼Œå †éƒ½æ”¯æŒå“ªäº›æ“ä½œä»¥åŠå¦‚ä½•å­˜å‚¨ä¸€ä¸ªå †ã€‚æˆ‘ä¹‹å‰è®²è¿‡ï¼Œå®Œå…¨äºŒå‰æ ‘æ¯”è¾ƒé€‚åˆç”¨æ•°ç»„æ¥å­˜å‚¨ã€‚ç”¨æ•°ç»„æ¥å­˜å‚¨å®Œå…¨äºŒå‰æ ‘æ˜¯éå¸¸èŠ‚çœå­˜å‚¨ç©ºé—´çš„ã€‚å› ä¸ºæˆ‘ä»¬ä¸éœ€è¦å­˜å‚¨å·¦å³å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå•çº¯åœ°é€šè¿‡æ•°ç»„çš„ä¸‹æ ‡ï¼Œå°±å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªèŠ‚ç‚¹çš„å·¦å³å­èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹ã€‚æˆ‘ç”»äº†ä¸€ä¸ªç”¨æ•°ç»„å­˜å‚¨å †çš„ä¾‹å­ï¼Œä½ å¯ä»¥å…ˆçœ‹ä¸‹ã€‚ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ•°ç»„ä¸­ä¸‹æ ‡ä¸º i çš„èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ï¼Œå°±æ˜¯ä¸‹æ ‡ä¸º iâˆ—2 çš„èŠ‚ç‚¹ï¼Œå³å­èŠ‚ç‚¹å°±æ˜¯ä¸‹æ ‡ä¸º iâˆ—2+1 çš„èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹å°±æ˜¯ä¸‹æ ‡ä¸º 2i çš„èŠ‚ç‚¹ã€‚çŸ¥é“äº†å¦‚ä½•å­˜å‚¨ä¸€ä¸ªå †ï¼Œé‚£æˆ‘ä»¬å†æ¥çœ‹çœ‹ï¼Œå †ä¸Šçš„æ“ä½œæœ‰å“ªäº›å‘¢ï¼Ÿæˆ‘ç½—åˆ—äº†å‡ ä¸ªéå¸¸æ ¸å¿ƒçš„æ“ä½œï¼Œåˆ†åˆ«æ˜¯å¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ å’Œåˆ é™¤å †é¡¶å…ƒç´ ã€‚ï¼ˆå¦‚æœæ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œæˆ‘ä¸‹é¢éƒ½æ˜¯æ‹¿å¤§é¡¶å †æ¥è®²è§£ï¼‰ã€‚1. å¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ å¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ åï¼Œæˆ‘ä»¬éœ€è¦ç»§ç»­æ»¡è¶³å †çš„ä¸¤ä¸ªç‰¹æ€§ã€‚å¦‚æœæˆ‘ä»¬æŠŠæ–°æ’å…¥çš„å…ƒç´ æ”¾åˆ°å †çš„æœ€åï¼Œä½ å¯ä»¥çœ‹æˆ‘ç”»çš„è¿™ä¸ªå›¾ï¼Œæ˜¯ä¸æ˜¯ä¸ç¬¦åˆå †çš„ç‰¹æ€§äº†ï¼Ÿäºæ˜¯ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œè®©å…¶é‡æ–°æ»¡è¶³å †çš„ç‰¹æ€§ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬èµ·äº†ä¸€ä¸ªåå­—ï¼Œå°±å«ä½œå †åŒ–ï¼ˆheapifyï¼‰ã€‚å †åŒ–å®é™…ä¸Šæœ‰ä¸¤ç§ï¼Œä»ä¸‹å¾€ä¸Šå’Œä»ä¸Šå¾€ä¸‹ã€‚è¿™é‡Œæˆ‘å…ˆè®²ä»ä¸‹å¾€ä¸Šçš„å †åŒ–æ–¹æ³•ã€‚å †åŒ–éå¸¸ç®€å•ï¼Œå°±æ˜¯é¡ºç€èŠ‚ç‚¹æ‰€åœ¨çš„è·¯å¾„ï¼Œå‘ä¸Šæˆ–è€…å‘ä¸‹ï¼Œå¯¹æ¯”ï¼Œç„¶åäº¤æ¢ã€‚æˆ‘è¿™é‡Œç”»äº†ä¸€å¼ å †åŒ–çš„è¿‡ç¨‹åˆ†è§£å›¾ã€‚æˆ‘ä»¬å¯ä»¥è®©æ–°æ’å…¥çš„èŠ‚ç‚¹ä¸çˆ¶èŠ‚ç‚¹å¯¹æ¯”å¤§å°ã€‚å¦‚æœä¸æ»¡è¶³å­èŠ‚ç‚¹å°äºç­‰äºçˆ¶èŠ‚ç‚¹çš„å¤§å°å…³ç³»ï¼Œæˆ‘ä»¬å°±äº’æ¢ä¸¤ä¸ªèŠ‚ç‚¹ã€‚ä¸€ç›´é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°çˆ¶å­èŠ‚ç‚¹ä¹‹é—´æ»¡è¶³åˆšè¯´çš„é‚£ç§å¤§å°å…³ç³»ã€‚æˆ‘å°†ä¸Šé¢è®²çš„å¾€å †ä¸­æ’å…¥æ•°æ®çš„è¿‡ç¨‹ï¼Œç¿»è¯‘æˆäº†ä»£ç ï¼Œä½ å¯ä»¥ç»“åˆç€ä¸€å—çœ‹ã€‚1234567891011121314151617181920212223public class Heap &#123; private int[] a; // æ•°ç»„ï¼Œä»ä¸‹æ ‡1å¼€å§‹å­˜å‚¨æ•°æ® private int n; // å †å¯ä»¥å­˜å‚¨çš„æœ€å¤§æ•°æ®ä¸ªæ•° private int count; // å †ä¸­å·²ç»å­˜å‚¨çš„æ•°æ®ä¸ªæ•° public Heap(int capacity) &#123; a = new int[capacity + 1]; n = capacity; count = 0; &#125; public void insert(int data) &#123; if (count &gt;= n) return; // å †æ»¡äº† ++count; a[count] = data; int i = count; while (i/2 &gt; 0 &amp;&amp; a[i] &gt; a[i/2]) &#123; // è‡ªä¸‹å¾€ä¸Šå †åŒ– swap(a, i, i/2); // swap()å‡½æ•°ä½œç”¨ï¼šäº¤æ¢ä¸‹æ ‡ä¸ºiå’Œi/2çš„ä¸¤ä¸ªå…ƒç´  i = i/2; &#125; &#125; &#125;2. åˆ é™¤å †é¡¶å…ƒç´ ä»å †çš„å®šä¹‰çš„ç¬¬äºŒæ¡ä¸­ï¼Œä»»ä½•èŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºï¼ˆæˆ–å°äºç­‰äºï¼‰å­æ ‘èŠ‚ç‚¹çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå †é¡¶å…ƒç´ å­˜å‚¨çš„å°±æ˜¯å †ä¸­æ•°æ®çš„æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼ã€‚å‡è®¾æˆ‘ä»¬æ„é€ çš„æ˜¯å¤§é¡¶å †ï¼Œå †é¡¶å…ƒç´ å°±æ˜¯æœ€å¤§çš„å…ƒç´ ã€‚å½“æˆ‘ä»¬åˆ é™¤å †é¡¶å…ƒç´ ä¹‹åï¼Œå°±éœ€è¦æŠŠç¬¬äºŒå¤§çš„å…ƒç´ æ”¾åˆ°å †é¡¶ï¼Œé‚£ç¬¬äºŒå¤§å…ƒç´ è‚¯å®šä¼šå‡ºç°åœ¨å·¦å³å­èŠ‚ç‚¹ä¸­ã€‚ç„¶åæˆ‘ä»¬å†è¿­ä»£åœ°åˆ é™¤ç¬¬äºŒå¤§èŠ‚ç‚¹ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°å¶å­èŠ‚ç‚¹è¢«åˆ é™¤ã€‚è¿™é‡Œæˆ‘ä¹Ÿç”»äº†ä¸€ä¸ªåˆ†è§£å›¾ã€‚ä¸è¿‡è¿™ç§æ–¹æ³•æœ‰ç‚¹é—®é¢˜ï¼Œå°±æ˜¯æœ€åå †åŒ–å‡ºæ¥çš„å †å¹¶ä¸æ»¡è¶³å®Œå…¨äºŒå‰æ ‘çš„ç‰¹æ€§ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬ç¨å¾®æ”¹å˜ä¸€ä¸‹æ€è·¯ï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½ çœ‹æˆ‘ç”»çš„ä¸‹é¢è¿™å¹…å›¾ã€‚æˆ‘ä»¬æŠŠæœ€åä¸€ä¸ªèŠ‚ç‚¹æ”¾åˆ°å †é¡¶ï¼Œç„¶ååˆ©ç”¨åŒæ ·çš„çˆ¶å­èŠ‚ç‚¹å¯¹æ¯”æ–¹æ³•ã€‚å¯¹äºä¸æ»¡è¶³çˆ¶å­èŠ‚ç‚¹å¤§å°å…³ç³»çš„ï¼Œäº’æ¢ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”é‡å¤è¿›è¡Œè¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°çˆ¶å­èŠ‚ç‚¹ä¹‹é—´æ»¡è¶³å¤§å°å…³ç³»ä¸ºæ­¢ã€‚è¿™å°±æ˜¯ä»ä¸Šå¾€ä¸‹çš„å †åŒ–æ–¹æ³•ã€‚å› ä¸ºæˆ‘ä»¬ç§»é™¤çš„æ˜¯æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œè€Œåœ¨å †åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½æ˜¯äº¤æ¢æ“ä½œï¼Œä¸ä¼šå‡ºç°æ•°ç»„ä¸­çš„â€œç©ºæ´â€ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•å †åŒ–ä¹‹åçš„ç»“æœï¼Œè‚¯å®šæ»¡è¶³å®Œå…¨äºŒå‰æ ‘çš„ç‰¹æ€§ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªåŒ…å« n ä¸ªèŠ‚ç‚¹çš„å®Œå…¨äºŒå‰æ ‘ï¼Œæ ‘çš„é«˜åº¦ä¸ä¼šè¶…è¿‡ log2nã€‚å †åŒ–çš„è¿‡ç¨‹æ˜¯é¡ºç€èŠ‚ç‚¹æ‰€åœ¨è·¯å¾„æ¯”è¾ƒäº¤æ¢çš„ï¼Œæ‰€ä»¥å †åŒ–çš„æ—¶é—´å¤æ‚åº¦è·Ÿæ ‘çš„é«˜åº¦æˆæ­£æ¯”ï¼Œä¹Ÿå°±æ˜¯ O(logn)ã€‚æ’å…¥æ•°æ®å’Œåˆ é™¤å †é¡¶å…ƒç´ çš„ä¸»è¦é€»è¾‘å°±æ˜¯å †åŒ–ï¼Œæ‰€ä»¥ï¼Œå¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ å’Œåˆ é™¤å †é¡¶å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn)ã€‚å¦‚ä½•åŸºäºå †å®ç°æ’åºï¼Ÿå‰é¢æˆ‘ä»¬è®²è¿‡å¥½å‡ ç§æ’åºç®—æ³•ï¼Œæˆ‘ä»¬å†æ¥å›å¿†ä¸€ä¸‹ï¼Œæœ‰æ—¶é—´å¤æ‚åº¦æ˜¯ O(n2) çš„å†’æ³¡æ’åºã€æ’å…¥æ’åºã€é€‰æ‹©æ’åºï¼Œæœ‰æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn) çš„å½’å¹¶æ’åºã€å¿«é€Ÿæ’åºï¼Œè¿˜æœ‰çº¿æ€§æ’åºã€‚è¿™é‡Œæˆ‘ä»¬å€ŸåŠ©äºå †è¿™ç§æ•°æ®ç»“æ„å®ç°çš„æ’åºç®—æ³•ï¼Œå°±å«ä½œå †æ’åºã€‚è¿™ç§æ’åºæ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦éå¸¸ç¨³å®šï¼Œæ˜¯ O(nlogn)ï¼Œå¹¶ä¸”å®ƒè¿˜æ˜¯åŸåœ°æ’åºç®—æ³•ã€‚å¦‚æ­¤ä¼˜ç§€ï¼Œå®ƒæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠå †æ’åºçš„è¿‡ç¨‹å¤§è‡´åˆ†è§£æˆä¸¤ä¸ªå¤§çš„æ­¥éª¤ï¼Œå»ºå †å’Œæ’åºã€‚1. å»ºå †æˆ‘ä»¬é¦–å…ˆå°†æ•°ç»„åŸåœ°å»ºæˆä¸€ä¸ªå †ã€‚æ‰€è°“â€œåŸåœ°â€å°±æ˜¯ï¼Œä¸å€ŸåŠ©å¦ä¸€ä¸ªæ•°ç»„ï¼Œå°±åœ¨åŸæ•°ç»„ä¸Šæ“ä½œã€‚å»ºå †çš„è¿‡ç¨‹ï¼Œæœ‰ä¸¤ç§æ€è·¯ã€‚ç¬¬ä¸€ç§æ˜¯å€ŸåŠ©æˆ‘ä»¬å‰é¢è®²çš„ï¼Œåœ¨å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ çš„æ€è·¯ã€‚å°½ç®¡æ•°ç»„ä¸­åŒ…å« n ä¸ªæ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å‡è®¾ï¼Œèµ·åˆå †ä¸­åªåŒ…å«ä¸€ä¸ªæ•°æ®ï¼Œå°±æ˜¯ä¸‹æ ‡ä¸º 1 çš„æ•°æ®ã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨å‰é¢è®²çš„æ’å…¥æ“ä½œï¼Œå°†ä¸‹æ ‡ä» 2 åˆ° n çš„æ•°æ®ä¾æ¬¡æ’å…¥åˆ°å †ä¸­ã€‚è¿™æ ·æˆ‘ä»¬å°±å°†åŒ…å« n ä¸ªæ•°æ®çš„æ•°ç»„ï¼Œç»„ç»‡æˆäº†å †ã€‚ç¬¬äºŒç§å®ç°æ€è·¯ï¼Œè·Ÿç¬¬ä¸€ç§æˆªç„¶ç›¸åï¼Œä¹Ÿæ˜¯æˆ‘è¿™é‡Œè¦è¯¦ç»†è®²çš„ã€‚ç¬¬ä¸€ç§å»ºå †æ€è·¯çš„å¤„ç†è¿‡ç¨‹æ˜¯ä»å‰å¾€åå¤„ç†æ•°ç»„æ•°æ®ï¼Œå¹¶ä¸”æ¯ä¸ªæ•°æ®æ’å…¥å †ä¸­æ—¶ï¼Œéƒ½æ˜¯ä»ä¸‹å¾€ä¸Šå †åŒ–ã€‚è€Œç¬¬äºŒç§å®ç°æ€è·¯ï¼Œæ˜¯ä»åå¾€å‰å¤„ç†æ•°ç»„ï¼Œå¹¶ä¸”æ¯ä¸ªæ•°æ®éƒ½æ˜¯ä»ä¸Šå¾€ä¸‹å †åŒ–ã€‚æˆ‘ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼Œå¹¶ä¸”ç”»äº†ä¸€ä¸ªç¬¬äºŒç§å®ç°æ€è·¯çš„å»ºå †åˆ†è§£æ­¥éª¤å›¾ï¼Œä½ å¯ä»¥çœ‹ä¸‹ã€‚å› ä¸ºå¶å­èŠ‚ç‚¹å¾€ä¸‹å †åŒ–åªèƒ½è‡ªå·±è·Ÿè‡ªå·±æ¯”è¾ƒï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä»ç¬¬ä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡å †åŒ–å°±è¡Œäº†ã€‚)ä»£ç ï¼š1234567891011121314151617private static void buildHeap(int[] a, int n) &#123; for (int i = n/2; i &gt;= 1; --i) &#123; heapify(a, n, i); &#125;&#125;private static void heapify(int[] a, int n, int i) &#123; while (true) &#123; int maxPos = i; if (i*2 &lt;= n &amp;&amp; a[i] &lt; a[i*2]) maxPos = i*2; if (i*2+1 &lt;= n &amp;&amp; a[maxPos] &lt; a[i*2+1]) maxPos = i*2+1; if (maxPos == i) break; swap(a, i, maxPos); i = maxPos; &#125;&#125;ä½ å¯èƒ½å·²ç»å‘ç°äº†ï¼Œåœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯¹ä¸‹æ ‡ä» 2n å¼€å§‹åˆ° 1 çš„æ•°æ®è¿›è¡Œå †åŒ–ï¼Œä¸‹æ ‡æ˜¯ 2n+1 åˆ° n çš„èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ï¼Œæˆ‘ä»¬ä¸éœ€è¦å †åŒ–ã€‚å®é™…ä¸Šï¼Œå¯¹äºå®Œå…¨äºŒå‰æ ‘æ¥è¯´ï¼Œä¸‹æ ‡ä» 2n+1 åˆ° n çš„èŠ‚ç‚¹éƒ½æ˜¯å¶å­èŠ‚ç‚¹ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ï¼Œå»ºå †æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿæ¯ä¸ªèŠ‚ç‚¹å †åŒ–çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ï¼Œé‚£ 2n+1 ä¸ªèŠ‚ç‚¹å †åŒ–çš„æ€»æ—¶é—´å¤æ‚åº¦æ˜¯ä¸æ˜¯å°±æ˜¯ O(nlogn) å‘¢ï¼Ÿè¿™ä¸ªç­”æ¡ˆè™½ç„¶ä¹Ÿæ²¡é”™ï¼Œä½†æ˜¯è¿™ä¸ªå€¼è¿˜æ˜¯ä¸å¤Ÿç²¾ç¡®ã€‚å®é™…ä¸Šï¼Œå †æ’åºçš„å»ºå †è¿‡ç¨‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚æˆ‘å¸¦ä½ æ¨å¯¼ä¸€ä¸‹ã€‚å› ä¸ºå¶å­èŠ‚ç‚¹ä¸éœ€è¦å †åŒ–ï¼Œæ‰€ä»¥éœ€è¦å †åŒ–çš„èŠ‚ç‚¹ä»å€’æ•°ç¬¬äºŒå±‚å¼€å§‹ã€‚æ¯ä¸ªèŠ‚ç‚¹å †åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ¯”è¾ƒå’Œäº¤æ¢çš„èŠ‚ç‚¹ä¸ªæ•°ï¼Œè·Ÿè¿™ä¸ªèŠ‚ç‚¹çš„é«˜åº¦ k æˆæ­£æ¯”ã€‚æˆ‘æŠŠæ¯ä¸€å±‚çš„èŠ‚ç‚¹ä¸ªæ•°å’Œå¯¹åº”çš„é«˜åº¦ç”»äº†å‡ºæ¥ï¼Œä½ å¯ä»¥çœ‹çœ‹ã€‚æˆ‘ä»¬åªéœ€è¦å°†æ¯ä¸ªèŠ‚ç‚¹çš„é«˜åº¦æ±‚å’Œï¼Œå¾—å‡ºçš„å°±æ˜¯å»ºå †çš„æ—¶é—´å¤æ‚åº¦ã€‚æˆ‘ä»¬å°†æ¯ä¸ªéå¶å­èŠ‚ç‚¹çš„é«˜åº¦æ±‚å’Œï¼Œå°±æ˜¯ä¸‹é¢è¿™ä¸ªå…¬å¼ï¼šè¿™ä¸ªå…¬å¼çš„æ±‚è§£ç¨å¾®æœ‰ç‚¹æŠ€å·§ï¼Œä¸è¿‡æˆ‘ä»¬é«˜ä¸­åº”è¯¥éƒ½å­¦è¿‡ï¼šæŠŠå…¬å¼å·¦å³éƒ½ä¹˜ä»¥ 2ï¼Œå°±å¾—åˆ°å¦ä¸€ä¸ªå…¬å¼ S2ã€‚æˆ‘ä»¬å°† S2 é”™ä½å¯¹é½ï¼Œå¹¶ä¸”ç”¨ S2 å‡å» S1ï¼Œå¯ä»¥å¾—åˆ° Sã€‚S çš„ä¸­é—´éƒ¨åˆ†æ˜¯ä¸€ä¸ªç­‰æ¯”æ•°åˆ—ï¼Œæ‰€ä»¥æœ€åå¯ä»¥ç”¨ç­‰æ¯”æ•°åˆ—çš„æ±‚å’Œå…¬å¼æ¥è®¡ç®—ï¼Œæœ€ç»ˆçš„ç»“æœå°±æ˜¯ä¸‹é¢å›¾ä¸­ç”»çš„è¿™ä¸ªæ ·å­ã€‚å› ä¸º h=log2nï¼Œä»£å…¥å…¬å¼ Sï¼Œå°±èƒ½å¾—åˆ° S=O(n)ï¼Œæ‰€ä»¥ï¼Œå»ºå †çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(n)ã€‚2. æ’åºå»ºå †ç»“æŸä¹‹åï¼Œæ•°ç»„ä¸­çš„æ•°æ®å·²ç»æ˜¯æŒ‰ç…§å¤§é¡¶å †çš„ç‰¹æ€§æ¥ç»„ç»‡çš„ã€‚æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯å †é¡¶ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§çš„å…ƒç´ ã€‚æˆ‘ä»¬æŠŠå®ƒè·Ÿæœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œé‚£æœ€å¤§å…ƒç´ å°±æ”¾åˆ°äº†ä¸‹æ ‡ä¸º n çš„ä½ç½®ã€‚è¿™ä¸ªè¿‡ç¨‹æœ‰ç‚¹ç±»ä¼¼ä¸Šé¢è®²çš„â€œåˆ é™¤å †é¡¶å…ƒç´ â€çš„æ“ä½œï¼Œå½“å †é¡¶å…ƒç´ ç§»é™¤ä¹‹åï¼Œæˆ‘ä»¬æŠŠä¸‹æ ‡ä¸º n çš„å…ƒç´ æ”¾åˆ°å †é¡¶ï¼Œç„¶åå†é€šè¿‡å †åŒ–çš„æ–¹æ³•ï¼Œå°†å‰©ä¸‹çš„ nâˆ’1 ä¸ªå…ƒç´ é‡æ–°æ„å»ºæˆå †ã€‚å †åŒ–å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å†å–å †é¡¶çš„å…ƒç´ ï¼Œæ”¾åˆ°ä¸‹æ ‡æ˜¯ nâˆ’1 çš„ä½ç½®ï¼Œä¸€ç›´é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æœ€åå †ä¸­åªå‰©ä¸‹æ ‡ä¸º 1 çš„ä¸€ä¸ªå…ƒç´ ï¼Œæ’åºå·¥ä½œå°±å®Œæˆäº†ã€‚1234567891011// nè¡¨ç¤ºæ•°æ®çš„ä¸ªæ•°ï¼Œæ•°ç»„aä¸­çš„æ•°æ®ä»ä¸‹æ ‡1åˆ°nçš„ä½ç½®ã€‚public static void sort(int[] a, int n) &#123; buildHeap(a, n); int k = n; while (k &gt; 1) &#123; swap(a, 1, k); --k; heapify(a, k, 1); &#125;&#125;ç°åœ¨ï¼Œæˆ‘ä»¬å†æ¥åˆ†æä¸€ä¸‹å †æ’åºçš„æ—¶é—´å¤æ‚åº¦ã€ç©ºé—´å¤æ‚åº¦ä»¥åŠç¨³å®šæ€§ã€‚æ•´ä¸ªå †æ’åºçš„è¿‡ç¨‹ï¼Œéƒ½åªéœ€è¦æä¸ªåˆ«ä¸´æ—¶å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥å †æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•ã€‚å †æ’åºåŒ…æ‹¬å»ºå †å’Œæ’åºä¸¤ä¸ªæ“ä½œï¼Œå»ºå †è¿‡ç¨‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œæ’åºè¿‡ç¨‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn)ï¼Œæ‰€ä»¥ï¼Œå †æ’åºæ•´ä½“çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn)ã€‚å †æ’åºä¸æ˜¯ç¨³å®šçš„æ’åºç®—æ³•ï¼Œå› ä¸ºåœ¨æ’åºçš„è¿‡ç¨‹ï¼Œå­˜åœ¨å°†å †çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹è·Ÿå †é¡¶èŠ‚ç‚¹äº’æ¢çš„æ“ä½œï¼Œæ‰€ä»¥å°±æœ‰å¯èƒ½æ”¹å˜å€¼ç›¸åŒæ•°æ®çš„åŸå§‹ç›¸å¯¹é¡ºåºã€‚ä»Šå¤©çš„å†…å®¹åˆ°æ­¤å°±è®²å®Œäº†ã€‚æˆ‘è¿™é‡Œè¦ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼Œåœ¨å‰é¢çš„è®²è§£ä»¥åŠä»£ç ä¸­ï¼Œæˆ‘éƒ½å‡è®¾ï¼Œå †ä¸­çš„æ•°æ®æ˜¯ä»æ•°ç»„ä¸‹æ ‡ä¸º 1 çš„ä½ç½®å¼€å§‹å­˜å‚¨ã€‚é‚£å¦‚æœä» 0 å¼€å§‹å­˜å‚¨ï¼Œå®é™…ä¸Šå¤„ç†æ€è·¯æ˜¯æ²¡æœ‰ä»»ä½•å˜åŒ–çš„ï¼Œå”¯ä¸€å˜åŒ–çš„ï¼Œå¯èƒ½å°±æ˜¯ï¼Œä»£ç å®ç°çš„æ—¶å€™ï¼Œè®¡ç®—å­èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„ä¸‹æ ‡çš„å…¬å¼æ”¹å˜äº†ã€‚å¦‚æœèŠ‚ç‚¹çš„ä¸‹æ ‡æ˜¯ iï¼Œé‚£å·¦å­èŠ‚ç‚¹çš„ä¸‹æ ‡å°±æ˜¯ 2âˆ—i+1ï¼Œå³å­èŠ‚ç‚¹çš„ä¸‹æ ‡å°±æ˜¯ 2âˆ—i+2ï¼Œçˆ¶èŠ‚ç‚¹çš„ä¸‹æ ‡å°±æ˜¯ 2iâˆ’1ã€‚è§£ç­”å¼€ç¯‡ç°åœ¨æˆ‘ä»¬æ¥çœ‹å¼€ç¯‡çš„é—®é¢˜ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸ºä»€ä¹ˆå¿«é€Ÿæ’åºè¦æ¯”å †æ’åºæ€§èƒ½å¥½ï¼Ÿæˆ‘è§‰å¾—ä¸»è¦æœ‰ä¸¤æ–¹é¢çš„åŸå› ã€‚ç¬¬ä¸€ç‚¹ï¼Œå †æ’åºæ•°æ®è®¿é—®çš„æ–¹å¼æ²¡æœ‰å¿«é€Ÿæ’åºå‹å¥½ã€‚å¯¹äºå¿«é€Ÿæ’åºæ¥è¯´ï¼Œæ•°æ®æ˜¯é¡ºåºè®¿é—®çš„ã€‚è€Œå¯¹äºå †æ’åºæ¥è¯´ï¼Œæ•°æ®æ˜¯è·³ç€è®¿é—®çš„ã€‚ æ¯”å¦‚ï¼Œå †æ’åºä¸­ï¼Œæœ€é‡è¦çš„ä¸€ä¸ªæ“ä½œå°±æ˜¯æ•°æ®çš„å †åŒ–ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œå¯¹å †é¡¶èŠ‚ç‚¹è¿›è¡Œå †åŒ–ï¼Œä¼šä¾æ¬¡è®¿é—®æ•°ç»„ä¸‹æ ‡æ˜¯ 1ï¼Œ2ï¼Œ4ï¼Œ8 çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯åƒå¿«é€Ÿæ’åºé‚£æ ·ï¼Œå±€éƒ¨é¡ºåºè®¿é—®ï¼Œæ‰€ä»¥ï¼Œè¿™æ ·å¯¹ CPU ç¼“å­˜æ˜¯ä¸å‹å¥½çš„ã€‚ç¬¬äºŒç‚¹ï¼Œå¯¹äºåŒæ ·çš„æ•°æ®ï¼Œåœ¨æ’åºè¿‡ç¨‹ä¸­ï¼Œå †æ’åºç®—æ³•çš„æ•°æ®äº¤æ¢æ¬¡æ•°è¦å¤šäºå¿«é€Ÿæ’åºã€‚æˆ‘ä»¬åœ¨è®²æ’åºçš„æ—¶å€™ï¼Œæè¿‡ä¸¤ä¸ªæ¦‚å¿µï¼Œæœ‰åºåº¦å’Œé€†åºåº¦ã€‚å¯¹äºåŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•æ¥è¯´ï¼Œæ•´ä¸ªæ’åºè¿‡ç¨‹å°±æ˜¯ç”±ä¸¤ä¸ªåŸºæœ¬çš„æ“ä½œç»„æˆçš„ï¼Œæ¯”è¾ƒå’Œäº¤æ¢ï¼ˆæˆ–ç§»åŠ¨ï¼‰ã€‚å¿«é€Ÿæ’åºæ•°æ®äº¤æ¢çš„æ¬¡æ•°ä¸ä¼šæ¯”é€†åºåº¦å¤šã€‚ä½†æ˜¯å †æ’åºçš„ç¬¬ä¸€æ­¥æ˜¯å»ºå †ï¼Œå»ºå †çš„è¿‡ç¨‹ä¼šæ‰“ä¹±æ•°æ®åŸæœ‰çš„ç›¸å¯¹å…ˆåé¡ºåºï¼Œå¯¼è‡´åŸæ•°æ®çš„æœ‰åºåº¦é™ä½ã€‚æ¯”å¦‚ï¼Œå¯¹äºä¸€ç»„å·²ç»æœ‰åºçš„æ•°æ®æ¥è¯´ï¼Œç»è¿‡å»ºå †ä¹‹åï¼Œæ•°æ®åè€Œå˜å¾—æ›´æ— åºäº†ã€‚å†…å®¹å°ç»“ä»Šå¤©æˆ‘ä»¬è®²äº†å †è¿™ç§æ•°æ®ç»“æ„ã€‚å †æ˜¯ä¸€ç§å®Œå…¨äºŒå‰æ ‘ã€‚å®ƒæœ€å¤§çš„ç‰¹æ€§æ˜¯ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºï¼ˆæˆ–å°äºç­‰äºï¼‰å…¶å­æ ‘èŠ‚ç‚¹çš„å€¼ã€‚å› æ­¤ï¼Œå †è¢«åˆ†æˆäº†ä¸¤ç±»ï¼Œå¤§é¡¶å †å’Œå°é¡¶å †ã€‚å †ä¸­æ¯”è¾ƒé‡è¦çš„ä¸¤ä¸ªæ“ä½œæ˜¯æ’å…¥ä¸€ä¸ªæ•°æ®å’Œåˆ é™¤å †é¡¶å…ƒç´ ã€‚è¿™ä¸¤ä¸ªæ“ä½œéƒ½è¦ç”¨åˆ°å †åŒ–ã€‚æ’å…¥ä¸€ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠæ–°æ’å…¥çš„æ•°æ®æ”¾åˆ°æ•°ç»„çš„æœ€åï¼Œç„¶åä»ä¸‹å¾€ä¸Šå †åŒ–ï¼›åˆ é™¤å †é¡¶æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠæ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ æ”¾åˆ°å †é¡¶ï¼Œç„¶åä»ä¸Šå¾€ä¸‹å †åŒ–ã€‚è¿™ä¸¤ä¸ªæ“ä½œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn)ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è®²äº†å †çš„ä¸€ä¸ªç»å…¸åº”ç”¨ï¼Œå †æ’åºã€‚å †æ’åºåŒ…å«ä¸¤ä¸ªè¿‡ç¨‹ï¼Œå»ºå †å’Œæ’åºã€‚æˆ‘ä»¬å°†ä¸‹æ ‡ä» 2n åˆ° 1 çš„èŠ‚ç‚¹ï¼Œä¾æ¬¡è¿›è¡Œä»ä¸Šåˆ°ä¸‹çš„å †åŒ–æ“ä½œï¼Œç„¶åå°±å¯ä»¥å°†æ•°ç»„ä¸­çš„æ•°æ®ç»„ç»‡æˆå †è¿™ç§æ•°æ®ç»“æ„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿­ä»£åœ°å°†å †é¡¶çš„å…ƒç´ æ”¾åˆ°å †çš„æœ«å°¾ï¼Œå¹¶å°†å †çš„å¤§å°å‡ä¸€ï¼Œç„¶åå†å †åŒ–ï¼Œé‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°å †ä¸­åªå‰©ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œæ•´ä¸ªæ•°ç»„ä¸­çš„æ•°æ®å°±éƒ½æœ‰åºæ’åˆ—äº†ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"å †","slug":"å †","permalink":"cpeixin.cn/tags/%E5%A0%86/"}]},{"title":"LeetCode - ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘","slug":"LeetCode-ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘","date":"2016-11-12T06:53:21.000Z","updated":"2020-06-05T16:45:15.890Z","comments":true,"path":"2016/11/12/LeetCode-ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘/","link":"","permalink":"cpeixin.cn/2016/11/12/LeetCode-%E4%BB%8E%E4%B8%AD%E5%BA%8F%E4%B8%8E%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86%E5%BA%8F%E5%88%97%E6%9E%84%E9%80%A0%E4%BA%8C%E5%8F%89%E6%A0%91/","excerpt":"","text":"æ ¹æ®ä¸€æ£µæ ‘çš„ä¸­åºéå†ä¸ååºéå†æ„é€ äºŒå‰æ ‘ã€‚æ³¨æ„:**ä½ å¯ä»¥å‡è®¾æ ‘ä¸­æ²¡æœ‰é‡å¤çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œç»™å‡ºä¸­åºéå† inorder = [9,3,15,20,7]ååºéå† postorder = [9,15,7,20,3]è¿”å›å¦‚ä¸‹çš„äºŒå‰æ ‘ï¼š12345 3 &#x2F; \\9 20 &#x2F; \\ 15 7å‰æè§£å†³æ­¤é—®é¢˜çš„å…³é”®åœ¨äºè¦å¾ˆç†Ÿæ‚‰æ ‘çš„å„ç§éå†æ¬¡åºä»£è¡¨çš„ä»€ä¹ˆï¼Œæœ€å¥½èƒ½å¤Ÿå°†å›¾ç”»å‡ºæ¥ã€‚æœ¬é¢˜è§£å¸¦ä½ å…ˆè¿›è¡Œä¸­åºéå†å’Œåç»­éå†äºŒå‰æ ‘ï¼Œç„¶åå†æ ¹æ®éå†ç»“æœå°†äºŒå‰æ ‘è¿›è¡Œè¿˜åŸã€‚é¦–å…ˆï¼Œæ¥ä¸€æ£µæ ‘ç„¶åå†çœ‹æ ‘çš„éå†ç»“æœæ ¹æ®ä¸­åºå’Œååºéå†ç»“æœè¿˜åŸäºŒå‰æ ‘ä¸­åºéå†å’Œåç»­éå†çš„ç‰¹æ€§**é¦–å…ˆæ¥çœ‹é¢˜ç›®ç»™å‡ºçš„ä¸¤ä¸ªå·²çŸ¥æ¡ä»¶ä¸­åºéå†åºåˆ—å’Œååºéå†åºåˆ— æ ¹æ®è¿™ä¸¤ç§éå†çš„ç‰¹æ€§æˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸¤ä¸ªç»“è®ºåœ¨ååºéå†åºåˆ—ä¸­,æœ€åä¸€ä¸ªå…ƒç´ ä¸ºæ ‘çš„æ ¹èŠ‚ç‚¹åœ¨ä¸­åºéå†åºåˆ—ä¸­,æ ¹èŠ‚ç‚¹çš„å·¦è¾¹ä¸ºå·¦å­æ ‘ï¼Œæ ¹èŠ‚ç‚¹çš„å³è¾¹ä¸ºå³å­æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºæ ‘çš„è¿˜åŸè¿‡ç¨‹æè¿°æ ¹æ®ä¸­åºéå†å’Œåç»­éå†çš„ç‰¹æ€§æˆ‘ä»¬è¿›è¡Œæ ‘çš„è¿˜åŸè¿‡ç¨‹åˆ†æé¦–å…ˆåœ¨ååºéå†åºåˆ—ä¸­æ‰¾åˆ°æ ¹èŠ‚ç‚¹(æœ€åä¸€ä¸ªå…ƒç´ )æ ¹æ®æ ¹èŠ‚ç‚¹åœ¨ä¸­åºéå†åºåˆ—ä¸­æ‰¾åˆ°æ ¹èŠ‚ç‚¹çš„ä½ç½®æ ¹æ®æ ¹èŠ‚ç‚¹çš„ä½ç½®å°†ä¸­åºéå†åºåˆ—åˆ†ä¸ºå·¦å­æ ‘å’Œå³å­æ ‘æ ¹æ®æ ¹èŠ‚ç‚¹çš„ä½ç½®ç¡®å®šå·¦å­æ ‘å’Œå³å­æ ‘åœ¨ä¸­åºæ•°ç»„å’Œååºæ•°ç»„ä¸­çš„å·¦å³è¾¹ç•Œä½ç½®é€’å½’æ„é€ å·¦å­æ ‘å’Œå³å­æ ‘è¿”å›æ ¹èŠ‚ç‚¹ç»“æŸæ ‘çš„è¿˜åŸè¿‡ç¨‹å˜é‡å®šä¹‰éœ€è¦å®šä¹‰å‡ ä¸ªå˜é‡å¸®åŠ©æˆ‘ä»¬è¿›è¡Œæ ‘çš„è¿˜åŸHashMap memo éœ€è¦ä¸€ä¸ªå“ˆå¸Œè¡¨æ¥ä¿å­˜ä¸­åºéå†åºåˆ—ä¸­,å…ƒç´ å’Œç´¢å¼•çš„ä½ç½®å…³ç³».å› ä¸ºä»ååºåºåˆ—ä¸­æ‹¿åˆ°æ ¹èŠ‚ç‚¹åï¼Œè¦åœ¨ä¸­åºåºåˆ—ä¸­æŸ¥æ‰¾å¯¹åº”çš„ä½ç½®,ä»è€Œå°†æ•°ç»„åˆ†ä¸ºå·¦å­æ ‘å’Œå³å­æ ‘int ri æ ¹èŠ‚ç‚¹åœ¨ä¸­åºéå†æ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®ä¸­åºéå†æ•°ç»„çš„ä¸¤ä¸ªä½ç½®æ ‡è®° [is, ie],isæ˜¯èµ·å§‹ä½ç½®ï¼Œieæ˜¯ç»“æŸä½ç½®ååºéå†æ•°ç»„çš„ä¸¤ä¸ªä½ç½®æ ‡è®° [ps, pe] psæ˜¯èµ·å§‹ä½ç½®ï¼Œpeæ˜¯ç»“æŸä½ç½®ä½ç½®å…³ç³»çš„è®¡ç®—åœ¨æ‰¾åˆ°æ ¹èŠ‚ç‚¹ä½ç½®ä»¥åï¼Œæˆ‘ä»¬è¦ç¡®å®šä¸‹ä¸€è½®ä¸­ï¼Œå·¦å­æ ‘å’Œå³å­æ ‘åœ¨ä¸­åºæ•°ç»„å’Œåç»­æ•°ç»„ä¸­çš„å·¦å³è¾¹ç•Œçš„ä½ç½®ã€‚å·¦å­æ ‘-ä¸­åºæ•°ç»„ is = is, ie = ri - 1å·¦å­æ ‘-ååºæ•°ç»„ ps = ps, pe = ps + ri - is - 1 (peè®¡ç®—è¿‡ç¨‹è§£é‡Šï¼Œåç»­æ•°ç»„çš„èµ·å§‹ä½ç½®åŠ ä¸Šå·¦å­æ ‘é•¿åº¦-1 å°±æ˜¯åååºæ•°ç»„ç»“æŸä½ç½®äº†ï¼Œå·¦å­æ ‘çš„é•¿åº¦ = æ ¹èŠ‚ç‚¹ç´¢å¼•-å·¦å­æ ‘)å³å­æ ‘-ä¸­åºæ•°ç»„ is = ri + 1, ie = ieå³å­æ ‘-ååºæ•°ç»„ ps = ps + ri - is, pe - 1å¬ä¸æ˜ç™½æ²¡å…³ç³»ï¼Œçœ‹å›¾å°±å¯¹äº†,è®¡ç®—å›¾ç¤ºå¦‚ä¸‹æ ‘çš„è¿˜åŸè¿‡ç¨‹ä»£ç 123456789101112131415161718class Solution: def __init__(self): self.memo=&#123;&#125; self.post=[] def buildTree(self, inorder: List[int], postorder: List[int]) -&gt; TreeNode: self.memo=&#123;val:idx for idx,val in enumerate(inorder)&#125; self.post=postorder root=self.helper(0,len(inorder)-1,0,len(self.post)-1) return root def helper(self,istart,iend,pstart,pend): if istart&gt;iend or pstart&gt;pend: return None root=self.post[pend] # è·å–æ ¹ç»“ç‚¹çš„val ri=self.memo[root] # è·å–æ ¹ç»“ç‚¹çš„ç´¢å¼• node=TreeNode(self.post[pend]) node.left=self.helper(istart,ri-1,pstart,pstart+ri-istart-1) node.right=self.helper(ri+1,iend,pstart+ri-istart,pend-1) return nodeæœ€åæ€»ç»“é¦–å…ˆæ–°å»ºä¸€ä¸ªhashmapï¼Œå°†inorderä¹Ÿå°±æ˜¯ä¸­åºéå†æ•°ç»„çš„å€¼ä½œä¸ºkeyï¼Œä¸‹æ ‡ä½œä¸ºvalueæ”¾è¿›å»ï¼›ç„¶åç”¨ä¸€ä¸ªä¸åŒå‚æ•°çš„buildTreeå‡½æ•°å¸®åŠ©å®ç°ï¼Œå…¶ä¸­æœ‰å››ä¸ªå‚æ•°è¦æ³¨æ„ï¼šinLã€inRã€poLã€poRï¼Œå…¶ä¸­çš„å«ä¹‰é¡¾åæ€ä¹‰ï¼Œåˆ†åˆ«ä»£è¡¨ç€å½“å‰å­æ ‘åœ¨ååºéå†å’Œä¸­åºéå†ä¸­çš„èŒƒå›´ï¼Œä»Låˆ°Rçš„å€¼éƒ½å¤„äºå½“å‰å­æ ‘ä¸­ï¼›ä»£ç çš„éš¾ç‚¹å¯èƒ½åœ¨äºnode.leftå’Œnode.rightè¿™ä¸¤éƒ¨åˆ†ï¼Œåšé¢˜æ—¶å¯ä»¥é€šè¿‡ç”»å›¾æ¥ç¡®å®šå››ä¸ªå‚æ•°çš„å€¼ï¼Œå…¶ä¸­éš¾ç‚¹å¯èƒ½å°±æ˜¯å·¦å­æ ‘å³ç«¯ç‚¹poL+(head-inL)-1å’Œå³å­æ ‘å·¦ç«¯ç‚¹poL+(head-inL)è¿™ä¸¤ä¸ªè¾¹ç•Œçš„ç¡®å®šï¼Œå…¶å®åªè¦æ˜ç™½ä¸­åºéå†å¤´ç»“ç‚¹å·¦è¾¹çš„å³ä¸ºå·¦å­æ ‘ï¼Œhead-inLé•¿åº¦å³ä¸ºå·¦å­æ ‘é•¿åº¦ï¼Œç„¶ååœ¨ååºéå†çš„å·¦ç«¯ç‚¹åŠ ä¸Šè¿™ä¹ˆä¸€æ®µï¼Œå³ä¸ºå³å­æ ‘çš„å·¦ç«¯ç‚¹ï¼ŒåŒç†å¯å¾—å·¦å­æ ‘çš„å³ç«¯ç‚¹","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"cpeixin.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","permalink":"cpeixin.cn/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"}]},{"title":"æ•°æ®ç»“æ„-è·³è¡¨","slug":"æ•°æ®ç»“æ„-è·³è¡¨","date":"2016-11-08T08:46:05.000Z","updated":"2020-06-08T09:38:41.120Z","comments":true,"path":"2016/11/08/æ•°æ®ç»“æ„-è·³è¡¨/","link":"","permalink":"cpeixin.cn/2016/11/08/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E8%B7%B3%E8%A1%A8/","excerpt":"","text":"äºŒåˆ†æŸ¥æ‰¾åº•å±‚ä¾èµ–çš„æ˜¯æ•°ç»„éšæœºè®¿é—®çš„ç‰¹æ€§ï¼Œæ‰€ä»¥åªèƒ½ç”¨æ•°ç»„æ¥å®ç°ã€‚å¦‚æœæ•°æ®å­˜å‚¨åœ¨é“¾è¡¨ä¸­ï¼Œå°±çœŸçš„æ²¡æ³•ç”¨äºŒåˆ†æŸ¥æ‰¾ç®—æ³•äº†å—ï¼Ÿå®é™…ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹é“¾è¡¨ç¨åŠ æ”¹é€ ï¼Œå°±å¯ä»¥æ”¯æŒç±»ä¼¼â€œäºŒåˆ†â€çš„æŸ¥æ‰¾ç®—æ³•ã€‚æˆ‘ä»¬æŠŠæ”¹é€ ä¹‹åçš„æ•°æ®ç»“æ„å«ä½œè·³è¡¨ï¼ˆSkip listï¼‰ï¼Œä¹Ÿå°±æ˜¯ä»Šå¤©è¦è®²çš„å†…å®¹ã€‚è·³è¡¨è¿™ç§æ•°æ®ç»“æ„å¯¹ä½ æ¥è¯´ï¼Œå¯èƒ½ä¼šæ¯”è¾ƒé™Œç”Ÿï¼Œå› ä¸ºä¸€èˆ¬çš„æ•°æ®ç»“æ„å’Œç®—æ³•ä¹¦ç±é‡Œéƒ½ä¸æ€ä¹ˆä¼šè®²ï¼Œè·³è¡¨è¿™ä¸ªæ•°æ®ç»“æ„å‡ºç°çš„æ—¶é—´ç›¸å¯¹ä¸å…¶ä»–æ•°æ®ç»“æ„å‡ºç°çš„è¾ƒæ™šï¼Œå¤§æ¦‚åœ¨1980å¹´å·¦å³æ‰å‡ºç°ï¼Œæ‰€ä»¥å¤§å¤šæ•°çš„ç³»ç»Ÿåº•å±‚éƒ½æ˜¯ä½¿ç”¨æ ‘ç­‰å…¶ä»–æ•°æ®ç»“æ„å®ç°çš„ã€‚ä½†æ˜¯å®ƒç¡®å®æ˜¯ä¸€ç§å„æ–¹é¢æ€§èƒ½éƒ½æ¯”è¾ƒä¼˜ç§€çš„åŠ¨æ€æ•°æ®ç»“æ„ï¼Œå¯ä»¥æ”¯æŒå¿«é€Ÿçš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œï¼Œå†™èµ·æ¥ä¹Ÿä¸å¤æ‚ï¼Œç”šè‡³å¯ä»¥æ›¿ä»£çº¢é»‘æ ‘ï¼ˆRed-black treeï¼‰ã€‚Redis ä¸­çš„æœ‰åºé›†åˆï¼ˆSorted Setï¼‰å°±æ˜¯ç”¨è·³è¡¨æ¥å®ç°çš„ã€‚å¦‚æœä½ æœ‰ä¸€å®šåŸºç¡€ï¼Œåº”è¯¥çŸ¥é“çº¢é»‘æ ‘ä¹Ÿå¯ä»¥å®ç°å¿«é€Ÿçš„æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾æ“ä½œã€‚é‚£ Redis ä¸ºä»€ä¹ˆä¼šé€‰æ‹©ç”¨è·³è¡¨æ¥å®ç°æœ‰åºé›†åˆå‘¢ï¼Ÿå¦‚ä½•ç†è§£â€œè·³è¡¨â€ï¼Ÿå¯¹äºä¸€ä¸ªå•é“¾è¡¨æ¥è®²ï¼Œå³ä¾¿é“¾è¡¨ä¸­å­˜å‚¨çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œå¦‚æœæˆ‘ä»¬è¦æƒ³åœ¨å…¶ä¸­æŸ¥æ‰¾æŸä¸ªæ•°æ®ï¼Œä¹Ÿåªèƒ½ä»å¤´åˆ°å°¾éå†é“¾è¡¨ã€‚è¿™æ ·æŸ¥æ‰¾æ•ˆç‡å°±ä¼šå¾ˆä½ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šå¾ˆé«˜ï¼Œæ˜¯ O(n)ã€‚é‚£æ€ä¹ˆæ¥æé«˜æŸ¥æ‰¾æ•ˆç‡å‘¢ï¼Ÿå¦‚æœåƒå›¾ä¸­é‚£æ ·ï¼Œå¯¹é“¾è¡¨å»ºç«‹ä¸€çº§â€œç´¢å¼•â€ï¼ŒæŸ¥æ‰¾èµ·æ¥æ˜¯ä¸æ˜¯å°±ä¼šæ›´å¿«ä¸€äº›å‘¢ï¼Ÿæ¯ä¸¤ä¸ªç»“ç‚¹æå–ä¸€ä¸ªç»“ç‚¹åˆ°ä¸Šä¸€çº§ï¼Œæˆ‘ä»¬æŠŠæŠ½å‡ºæ¥çš„é‚£ä¸€çº§å«ä½œç´¢å¼•æˆ–ç´¢å¼•å±‚ã€‚ä½ å¯ä»¥çœ‹æˆ‘ç”»çš„å›¾ã€‚å›¾ä¸­çš„ down è¡¨ç¤º down æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸‹ä¸€çº§ç»“ç‚¹ã€‚å¦‚æœæˆ‘ä»¬ç°åœ¨è¦æŸ¥æ‰¾æŸä¸ªç»“ç‚¹ï¼Œæ¯”å¦‚ 16ã€‚æˆ‘ä»¬å¯ä»¥å…ˆåœ¨ç´¢å¼•å±‚éå†ï¼Œå½“éå†åˆ°ç´¢å¼•å±‚ä¸­å€¼ä¸º 13 çš„ç»“ç‚¹æ—¶ï¼Œæˆ‘ä»¬å‘ç°ä¸‹ä¸€ä¸ªç»“ç‚¹æ˜¯ 17ï¼Œé‚£è¦æŸ¥æ‰¾çš„ç»“ç‚¹ 16 è‚¯å®šå°±åœ¨è¿™ä¸¤ä¸ªç»“ç‚¹ä¹‹é—´ã€‚ç„¶åæˆ‘ä»¬é€šè¿‡ç´¢å¼•å±‚ç»“ç‚¹çš„ down æŒ‡é’ˆï¼Œä¸‹é™åˆ°åŸå§‹é“¾è¡¨è¿™ä¸€å±‚ï¼Œç»§ç»­éå†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦å†éå† 2 ä¸ªç»“ç‚¹ï¼Œå°±å¯ä»¥æ‰¾åˆ°å€¼ç­‰äº 16 çš„è¿™ä¸ªç»“ç‚¹äº†ã€‚è¿™æ ·ï¼ŒåŸæ¥å¦‚æœè¦æŸ¥æ‰¾ 16ï¼Œéœ€è¦éå† 10 ä¸ªç»“ç‚¹ï¼Œç°åœ¨åªéœ€è¦éå† 7 ä¸ªç»“ç‚¹ã€‚ä»è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬çœ‹å‡ºï¼ŒåŠ æ¥ä¸€å±‚ç´¢å¼•ä¹‹åï¼ŒæŸ¥æ‰¾ä¸€ä¸ªç»“ç‚¹éœ€è¦éå†çš„ç»“ç‚¹ä¸ªæ•°å‡å°‘äº†ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥æ‰¾æ•ˆç‡æé«˜äº†ã€‚é‚£å¦‚æœæˆ‘ä»¬å†åŠ ä¸€çº§ç´¢å¼•å‘¢ï¼Ÿæ•ˆç‡ä¼šä¸ä¼šæå‡æ›´å¤šå‘¢ï¼Ÿè·Ÿå‰é¢å»ºç«‹ç¬¬ä¸€çº§ç´¢å¼•çš„æ–¹å¼ç›¸ä¼¼ï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸€çº§ç´¢å¼•çš„åŸºç¡€ä¹‹ä¸Šï¼Œæ¯ä¸¤ä¸ªç»“ç‚¹å°±æŠ½å‡ºä¸€ä¸ªç»“ç‚¹åˆ°ç¬¬äºŒçº§ç´¢å¼•ã€‚ç°åœ¨æˆ‘ä»¬å†æ¥æŸ¥æ‰¾ 16ï¼Œåªéœ€è¦éå† 6 ä¸ªç»“ç‚¹äº†ï¼Œéœ€è¦éå†çš„ç»“ç‚¹æ•°é‡åˆå‡å°‘äº†ã€‚æˆ‘ä¸¾çš„ä¾‹å­æ•°æ®é‡ä¸å¤§ï¼Œæ‰€ä»¥å³ä¾¿åŠ äº†ä¸¤çº§ç´¢å¼•ï¼ŒæŸ¥æ‰¾æ•ˆç‡çš„æå‡ä¹Ÿå¹¶ä¸æ˜æ˜¾ã€‚ä¸ºäº†è®©ä½ èƒ½çœŸåˆ‡åœ°æ„Ÿå—ç´¢å¼•æå‡æŸ¥è¯¢æ•ˆç‡ã€‚æˆ‘ç”»äº†ä¸€ä¸ªåŒ…å« 64 ä¸ªç»“ç‚¹çš„é“¾è¡¨ï¼ŒæŒ‰ç…§å‰é¢è®²çš„è¿™ç§æ€è·¯ï¼Œå»ºç«‹äº†äº”çº§ç´¢å¼•ã€‚ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒåŸæ¥æ²¡æœ‰ç´¢å¼•çš„æ—¶å€™ï¼ŒæŸ¥æ‰¾ 62 éœ€è¦éå† 62 ä¸ªç»“ç‚¹ï¼Œç°åœ¨åªéœ€è¦éå† 11 ä¸ªç»“ç‚¹ï¼Œé€Ÿåº¦æ˜¯ä¸æ˜¯æé«˜äº†å¾ˆå¤šï¼Ÿæ‰€ä»¥ï¼Œå½“é“¾è¡¨çš„é•¿åº¦ n æ¯”è¾ƒå¤§æ—¶ï¼Œæ¯”å¦‚ 1000ã€10000 çš„æ—¶å€™ï¼Œåœ¨æ„å»ºç´¢å¼•ä¹‹åï¼ŒæŸ¥æ‰¾æ•ˆç‡çš„æå‡å°±ä¼šéå¸¸æ˜æ˜¾ã€‚å‰é¢è®²çš„è¿™ç§é“¾è¡¨åŠ å¤šçº§ç´¢å¼•çš„ç»“æ„ï¼Œå°±æ˜¯è·³è¡¨ã€‚æˆ‘é€šè¿‡ä¾‹å­ç»™ä½ å±•ç¤ºäº†è·³è¡¨æ˜¯å¦‚ä½•å‡å°‘æŸ¥è¯¢æ¬¡æ•°çš„ï¼Œç°åœ¨ä½ åº”è¯¥æ¯”è¾ƒæ¸…æ™°åœ°çŸ¥é“ï¼Œè·³è¡¨ç¡®å®æ˜¯å¯ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡çš„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šå®šé‡åœ°åˆ†æä¸€ä¸‹ï¼Œç”¨è·³è¡¨æŸ¥è¯¢åˆ°åº•æœ‰å¤šå¿«ã€‚ç”¨è·³è¡¨æŸ¥è¯¢åˆ°åº•æœ‰å¤šå¿«ï¼Ÿå‰é¢æˆ‘è®²è¿‡ï¼Œç®—æ³•çš„æ‰§è¡Œæ•ˆç‡å¯ä»¥é€šè¿‡æ—¶é—´å¤æ‚åº¦æ¥åº¦é‡ï¼Œè¿™é‡Œä¾æ—§å¯ä»¥ç”¨ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä¸€ä¸ªå•é“¾è¡¨ä¸­æŸ¥è¯¢æŸä¸ªæ•°æ®çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚é‚£åœ¨ä¸€ä¸ªå…·æœ‰å¤šçº§ç´¢å¼•çš„è·³è¡¨ä¸­ï¼ŒæŸ¥è¯¢æŸä¸ªæ•°æ®çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿè¿™ä¸ªæ—¶é—´å¤æ‚åº¦çš„åˆ†ææ–¹æ³•æ¯”è¾ƒéš¾æƒ³åˆ°ã€‚æˆ‘æŠŠé—®é¢˜åˆ†è§£ä¸€ä¸‹ï¼Œå…ˆæ¥çœ‹è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœé“¾è¡¨é‡Œæœ‰ n ä¸ªç»“ç‚¹ï¼Œä¼šæœ‰å¤šå°‘çº§ç´¢å¼•å‘¢ï¼ŸæŒ‰ç…§æˆ‘ä»¬åˆšæ‰è®²çš„ï¼Œæ¯ä¸¤ä¸ªç»“ç‚¹ä¼šæŠ½å‡ºä¸€ä¸ªç»“ç‚¹ä½œä¸ºä¸Šä¸€çº§ç´¢å¼•çš„ç»“ç‚¹ï¼Œé‚£ç¬¬ä¸€çº§ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°å¤§çº¦å°±æ˜¯ n/2ï¼Œç¬¬äºŒçº§ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°å¤§çº¦å°±æ˜¯ n/4ï¼Œç¬¬ä¸‰çº§ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°å¤§çº¦å°±æ˜¯ n/8ï¼Œä¾æ¬¡ç±»æ¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬ k çº§ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°æ˜¯ç¬¬ k-1 çº§ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°çš„ 1/2ï¼Œé‚£ç¬¬ kçº§ç´¢å¼•ç»“ç‚¹çš„ä¸ªæ•°å°±æ˜¯ n/(2k)ã€‚å‡è®¾ç´¢å¼•æœ‰ h çº§ï¼Œæœ€é«˜çº§çš„ç´¢å¼•æœ‰ 2 ä¸ªç»“ç‚¹ã€‚é€šè¿‡ä¸Šé¢çš„å…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° n/(2h)=2ï¼Œä»è€Œæ±‚å¾— h=log2n-1ã€‚å¦‚æœåŒ…å«åŸå§‹é“¾è¡¨è¿™ä¸€å±‚ï¼Œæ•´ä¸ªè·³è¡¨çš„é«˜åº¦å°±æ˜¯ log2nã€‚æˆ‘ä»¬åœ¨è·³è¡¨ä¸­æŸ¥è¯¢æŸä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœæ¯ä¸€å±‚éƒ½è¦éå† m ä¸ªç»“ç‚¹ï¼Œé‚£åœ¨è·³è¡¨ä¸­æŸ¥è¯¢ä¸€ä¸ªæ•°æ®çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(m*logn)ã€‚é‚£è¿™ä¸ª m çš„å€¼æ˜¯å¤šå°‘å‘¢ï¼ŸæŒ‰ç…§å‰é¢è¿™ç§ç´¢å¼•ç»“æ„ï¼Œæˆ‘ä»¬æ¯ä¸€çº§ç´¢å¼•éƒ½æœ€å¤šåªéœ€è¦éå† 3 ä¸ªç»“ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ m=3ï¼Œä¸ºä»€ä¹ˆæ˜¯ 3 å‘¢ï¼Ÿæˆ‘æ¥è§£é‡Šä¸€ä¸‹ã€‚å‡è®¾æˆ‘ä»¬è¦æŸ¥æ‰¾çš„æ•°æ®æ˜¯ xï¼Œåœ¨ç¬¬ k çº§ç´¢å¼•ä¸­ï¼Œæˆ‘ä»¬éå†åˆ° y ç»“ç‚¹ä¹‹åï¼Œå‘ç° x å¤§äº yï¼Œå°äºåé¢çš„ç»“ç‚¹ zï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ y çš„ down æŒ‡é’ˆï¼Œä»ç¬¬ k çº§ç´¢å¼•ä¸‹é™åˆ°ç¬¬ k-1 çº§ç´¢å¼•ã€‚åœ¨ç¬¬ k-1 çº§ç´¢å¼•ä¸­ï¼Œy å’Œ z ä¹‹é—´åªæœ‰ 3 ä¸ªç»“ç‚¹ï¼ˆåŒ…å« y å’Œ zï¼‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ K-1 çº§ç´¢å¼•ä¸­æœ€å¤šåªéœ€è¦éå† 3 ä¸ªç»“ç‚¹ï¼Œä¾æ¬¡ç±»æ¨ï¼Œæ¯ä¸€çº§ç´¢å¼•éƒ½æœ€å¤šåªéœ€è¦éå† 3 ä¸ªç»“ç‚¹ã€‚é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¾—åˆ° m=3ï¼Œæ‰€ä»¥åœ¨è·³è¡¨ä¸­æŸ¥è¯¢ä»»æ„æ•°æ®çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(logn)ã€‚è¿™ä¸ªæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦è·ŸäºŒåˆ†æŸ¥æ‰¾æ˜¯ä¸€æ ·çš„ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å…¶å®æ˜¯åŸºäºå•é“¾è¡¨å®ç°äº†äºŒåˆ†æŸ¥æ‰¾ï¼Œæ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ï¼Ÿä¸è¿‡ï¼Œå¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ï¼Œè¿™ç§æŸ¥è¯¢æ•ˆç‡çš„æå‡ï¼Œå‰ææ˜¯å»ºç«‹äº†å¾ˆå¤šçº§ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ç¬¬ 6 èŠ‚è®²è¿‡çš„ç©ºé—´æ¢æ—¶é—´çš„è®¾è®¡æ€è·¯ã€‚è·³è¡¨æ˜¯ä¸æ˜¯å¾ˆæµªè´¹å†…å­˜ï¼Ÿæ¯”èµ·å•çº¯çš„å•é“¾è¡¨ï¼Œè·³è¡¨éœ€è¦å­˜å‚¨å¤šçº§ç´¢å¼•ï¼Œè‚¯å®šè¦æ¶ˆè€—æ›´å¤šçš„å­˜å‚¨ç©ºé—´ã€‚é‚£åˆ°åº•éœ€è¦æ¶ˆè€—å¤šå°‘é¢å¤–çš„å­˜å‚¨ç©ºé—´å‘¢ï¼Ÿæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è·³è¡¨çš„ç©ºé—´å¤æ‚åº¦ã€‚è·³è¡¨çš„ç©ºé—´å¤æ‚åº¦åˆ†æå¹¶ä¸éš¾ï¼Œæˆ‘åœ¨å‰é¢è¯´äº†ï¼Œå‡è®¾åŸå§‹é“¾è¡¨å¤§å°ä¸º nï¼Œé‚£ç¬¬ä¸€çº§ç´¢å¼•å¤§çº¦æœ‰ n/2 ä¸ªç»“ç‚¹ï¼Œç¬¬äºŒçº§ç´¢å¼•å¤§çº¦æœ‰ n/4 ä¸ªç»“ç‚¹ï¼Œä»¥æ­¤ç±»æ¨ï¼Œæ¯ä¸Šå‡ä¸€çº§å°±å‡å°‘ä¸€åŠï¼Œç›´åˆ°å‰©ä¸‹ 2 ä¸ªç»“ç‚¹ã€‚å¦‚æœæˆ‘ä»¬æŠŠæ¯å±‚ç´¢å¼•çš„ç»“ç‚¹æ•°å†™å‡ºæ¥ï¼Œå°±æ˜¯ä¸€ä¸ªç­‰æ¯”æ•°åˆ—ã€‚è¿™å‡ çº§ç´¢å¼•çš„ç»“ç‚¹æ€»å’Œå°±æ˜¯ n/2+n/4+n/8â€¦+8+4+2=n-2ã€‚æ‰€ä»¥ï¼Œè·³è¡¨çš„ç©ºé—´å¤æ‚åº¦æ˜¯ O(n)ã€‚è®¡ç®—è¿‡ç¨‹n/2, n/4, .., 2 è¿™ä¸ªæ•°åˆ—ä¸­ä¸€å…±æœ‰log2(n/2)é¡¹ç­‰æ¯”æ•°åˆ—æ±‚å’Œå…¬å¼S = a0(1-q^n)/(1-q)å…¶ä¸­a0è¡¨ç¤ºé¦–é¡¹ï¼Œnè¡¨ç¤ºé¡¹æ•°è¿™é‡Œçš„a0=n/2, é¡¹æ•°=log2(n/2), q=1/2ï¼Œå…¶ä¸­ç”±å¯¹æ•°çš„æ’ç­‰å¼2log2(X)=Xå¯å¾—s=n(1-2log2(2/n))S = n/2(1-2/n)/(1-1/2) = n-2ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå°†åŒ…å« n ä¸ªç»“ç‚¹çš„å•é“¾è¡¨æ„é€ æˆè·³è¡¨ï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–å†ç”¨æ¥è¿‘ n ä¸ªç»“ç‚¹çš„å­˜å‚¨ç©ºé—´ã€‚é‚£æˆ‘ä»¬æœ‰æ²¡æœ‰åŠæ³•é™ä½ç´¢å¼•å ç”¨çš„å†…å­˜ç©ºé—´å‘¢ï¼Ÿæˆ‘ä»¬å‰é¢éƒ½æ˜¯æ¯ä¸¤ä¸ªç»“ç‚¹æŠ½ä¸€ä¸ªç»“ç‚¹åˆ°ä¸Šçº§ç´¢å¼•ï¼Œå¦‚æœæˆ‘ä»¬æ¯ä¸‰ä¸ªç»“ç‚¹æˆ–äº”ä¸ªç»“ç‚¹ï¼ŒæŠ½ä¸€ä¸ªç»“ç‚¹åˆ°ä¸Šçº§ç´¢å¼•ï¼Œæ˜¯ä¸æ˜¯å°±ä¸ç”¨é‚£ä¹ˆå¤šç´¢å¼•ç»“ç‚¹äº†å‘¢ï¼Ÿæˆ‘ç”»äº†ä¸€ä¸ªæ¯ä¸‰ä¸ªç»“ç‚¹æŠ½ä¸€ä¸ªçš„ç¤ºæ„å›¾ï¼Œä½ å¯ä»¥çœ‹ä¸‹ã€‚![7.jpg](https://cdn.nlark.com/yuque/0/2020/jpeg/1072113/1591608508060-0fa55a6d-3586-4c21-b7b2-3dd90771785a.jpeg#align=left&display=inline&height=378&margin=%5Bobject%20Object%5D&name=7.jpg&originHeight=378&originWidth=1142&size=38717&status=done&style=none&width=1142)ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œç¬¬ä¸€çº§ç´¢å¼•éœ€è¦å¤§çº¦ n/3 ä¸ªç»“ç‚¹ï¼Œç¬¬äºŒçº§ç´¢å¼•éœ€è¦å¤§çº¦ n/9 ä¸ªç»“ç‚¹ã€‚æ¯å¾€ä¸Šä¸€çº§ï¼Œç´¢å¼•ç»“ç‚¹ä¸ªæ•°éƒ½é™¤ä»¥ 3ã€‚ä¸ºäº†æ–¹ä¾¿è®¡ç®—ï¼Œæˆ‘ä»¬å‡è®¾æœ€é«˜ä¸€çº§çš„ç´¢å¼•ç»“ç‚¹ä¸ªæ•°æ˜¯ 1ã€‚æˆ‘ä»¬æŠŠæ¯çº§ç´¢å¼•çš„ç»“ç‚¹ä¸ªæ•°éƒ½å†™ä¸‹æ¥ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç­‰æ¯”æ•°åˆ—ã€‚![8.jpg](https://cdn.nlark.com/yuque/0/2020/jpeg/1072113/1591608532950-bc75afc9-3833-4291-9cfb-09c8b0be8d0a.jpeg#align=left&display=inline&height=360&margin=%5Bobject%20Object%5D&name=8.jpg&originHeight=360&originWidth=1142&size=33537&status=done&style=none&width=1142)é€šè¿‡ç­‰æ¯”æ•°åˆ—æ±‚å’Œå…¬å¼ï¼Œæ€»çš„ç´¢å¼•ç»“ç‚¹å¤§çº¦å°±æ˜¯ n/3+n/9+n/27+â€¦+9+3+1=n/2ã€‚å°½ç®¡ç©ºé—´å¤æ‚åº¦è¿˜æ˜¯ O(n)ï¼Œä½†æ¯”ä¸Šé¢çš„æ¯ä¸¤ä¸ªç»“ç‚¹æŠ½ä¸€ä¸ªç»“ç‚¹çš„ç´¢å¼•æ„å»ºæ–¹æ³•ï¼Œè¦å‡å°‘äº†ä¸€åŠçš„ç´¢å¼•ç»“ç‚¹å­˜å‚¨ç©ºé—´ã€‚å®é™…ä¸Šï¼Œåœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸å¿…å¤ªåœ¨æ„ç´¢å¼•å ç”¨çš„é¢å¤–ç©ºé—´ã€‚åœ¨è®²æ•°æ®ç»“æ„å’Œç®—æ³•æ—¶ï¼Œæˆ‘ä»¬ä¹ æƒ¯æ€§åœ°æŠŠè¦å¤„ç†çš„æ•°æ®çœ‹æˆæ•´æ•°ï¼Œä½†æ˜¯åœ¨å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼ŒåŸå§‹é“¾è¡¨ä¸­å­˜å‚¨çš„æœ‰å¯èƒ½æ˜¯å¾ˆå¤§çš„å¯¹è±¡ï¼Œè€Œç´¢å¼•ç»“ç‚¹åªéœ€è¦å­˜å‚¨å…³é”®å€¼å’Œå‡ ä¸ªæŒ‡é’ˆï¼Œå¹¶ä¸éœ€è¦å­˜å‚¨å¯¹è±¡ï¼Œæ‰€ä»¥å½“å¯¹è±¡æ¯”ç´¢å¼•ç»“ç‚¹å¤§å¾ˆå¤šæ—¶ï¼Œé‚£ç´¢å¼•å ç”¨çš„é¢å¤–ç©ºé—´å°±å¯ä»¥å¿½ç•¥äº†ã€‚é«˜æ•ˆçš„åŠ¨æ€æ’å…¥å’Œåˆ é™¤è·³è¡¨é•¿ä»€ä¹ˆæ ·å­æˆ‘æƒ³ä½ åº”è¯¥å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œå®ƒçš„æŸ¥æ‰¾æ“ä½œæˆ‘ä»¬åˆšæ‰ä¹Ÿè®²è¿‡äº†ã€‚å®é™…ä¸Šï¼Œè·³è¡¨è¿™ä¸ªåŠ¨æ€æ•°æ®ç»“æ„ï¼Œä¸ä»…æ”¯æŒæŸ¥æ‰¾æ“ä½œï¼Œè¿˜æ”¯æŒåŠ¨æ€çš„æ’å…¥ã€åˆ é™¤æ“ä½œï¼Œè€Œä¸”æ’å…¥ã€åˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(logn)ã€‚æˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸‹ï¼Œ å¦‚ä½•åœ¨è·³è¡¨ä¸­æ’å…¥ä¸€ä¸ªæ•°æ®ï¼Œä»¥åŠå®ƒæ˜¯å¦‚ä½•åšåˆ° O(logn) çš„æ—¶é—´å¤æ‚åº¦çš„ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨å•é“¾è¡¨ä¸­ï¼Œä¸€æ—¦å®šä½å¥½è¦æ’å…¥çš„ä½ç½®ï¼Œæ’å…¥ç»“ç‚¹çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¾ˆä½çš„ï¼Œå°±æ˜¯ O(1)ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œä¸ºäº†ä¿è¯åŸå§‹é“¾è¡¨ä¸­æ•°æ®çš„æœ‰åºæ€§ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ‰¾åˆ°è¦æ’å…¥çš„ä½ç½®ï¼Œè¿™ä¸ªæŸ¥æ‰¾æ“ä½œå°±ä¼šæ¯”è¾ƒè€—æ—¶ã€‚å¯¹äºçº¯ç²¹çš„å•é“¾è¡¨ï¼Œéœ€è¦éå†æ¯ä¸ªç»“ç‚¹ï¼Œæ¥æ‰¾åˆ°æ’å…¥çš„ä½ç½®ã€‚ä½†æ˜¯ï¼Œå¯¹äºè·³è¡¨æ¥è¯´ï¼Œæˆ‘ä»¬è®²è¿‡æŸ¥æ‰¾æŸä¸ªç»“ç‚¹çš„çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ï¼Œæ‰€ä»¥è¿™é‡ŒæŸ¥æ‰¾æŸä¸ªæ•°æ®åº”è¯¥æ’å…¥çš„ä½ç½®ï¼Œæ–¹æ³•ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(logn)ã€‚æˆ‘ç”»äº†ä¸€å¼ å›¾ï¼Œä½ å¯ä»¥å¾ˆæ¸…æ™°åœ°çœ‹åˆ°æ’å…¥çš„è¿‡ç¨‹ã€‚å¥½äº†ï¼Œæˆ‘ä»¬å†æ¥çœ‹åˆ é™¤æ“ä½œã€‚å¦‚æœè¿™ä¸ªç»“ç‚¹åœ¨ç´¢å¼•ä¸­ä¹Ÿæœ‰å‡ºç°ï¼Œæˆ‘ä»¬é™¤äº†è¦åˆ é™¤åŸå§‹é“¾è¡¨ä¸­çš„ç»“ç‚¹ï¼Œè¿˜è¦åˆ é™¤ç´¢å¼•ä¸­çš„ã€‚å› ä¸ºå•é“¾è¡¨ä¸­çš„åˆ é™¤æ“ä½œéœ€è¦æ‹¿åˆ°è¦åˆ é™¤ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ï¼Œç„¶åé€šè¿‡æŒ‡é’ˆæ“ä½œå®Œæˆåˆ é™¤ã€‚æ‰€ä»¥åœ¨æŸ¥æ‰¾è¦åˆ é™¤çš„ç»“ç‚¹çš„æ—¶å€™ï¼Œä¸€å®šè¦è·å–å‰é©±ç»“ç‚¹ã€‚å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬ç”¨çš„æ˜¯åŒå‘é“¾è¡¨ï¼Œå°±ä¸éœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜äº†ã€‚è·³è¡¨ç´¢å¼•åŠ¨æ€æ›´æ–°å½“æˆ‘ä»¬ä¸åœåœ°å¾€è·³è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œå¦‚æœæˆ‘ä»¬ä¸æ›´æ–°ç´¢å¼•ï¼Œå°±æœ‰å¯èƒ½å‡ºç°æŸ 2 ä¸ªç´¢å¼•ç»“ç‚¹ä¹‹é—´æ•°æ®éå¸¸å¤šçš„æƒ…å†µã€‚æç«¯æƒ…å†µä¸‹ï¼Œè·³è¡¨è¿˜ä¼šé€€åŒ–æˆå•é“¾è¡¨ã€‚ä½œä¸ºä¸€ç§åŠ¨æ€æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬éœ€è¦æŸç§æ‰‹æ®µæ¥ç»´æŠ¤ç´¢å¼•ä¸åŸå§‹é“¾è¡¨å¤§å°ä¹‹é—´çš„å¹³è¡¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœé“¾è¡¨ä¸­ç»“ç‚¹å¤šäº†ï¼Œç´¢å¼•ç»“ç‚¹å°±ç›¸åº”åœ°å¢åŠ ä¸€äº›ï¼Œé¿å…å¤æ‚åº¦é€€åŒ–ï¼Œä»¥åŠæŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æ“ä½œæ€§èƒ½ä¸‹é™ã€‚å¦‚æœä½ äº†è§£çº¢é»‘æ ‘ã€AVL æ ‘è¿™æ ·å¹³è¡¡äºŒå‰æ ‘ï¼Œä½ å°±çŸ¥é“å®ƒä»¬æ˜¯é€šè¿‡å·¦å³æ—‹çš„æ–¹å¼ä¿æŒå·¦å³å­æ ‘çš„å¤§å°å¹³è¡¡ï¼ˆå¦‚æœä¸äº†è§£ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬åé¢ä¼šè®²ï¼‰ï¼Œè€Œè·³è¡¨æ˜¯é€šè¿‡éšæœºå‡½æ•°æ¥ç»´æŠ¤å‰é¢æåˆ°çš„â€œå¹³è¡¡æ€§â€ã€‚å½“æˆ‘ä»¬å¾€è·³è¡¨ä¸­æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åŒæ—¶å°†è¿™ä¸ªæ•°æ®æ’å…¥åˆ°éƒ¨åˆ†ç´¢å¼•å±‚ä¸­ã€‚å¦‚ä½•é€‰æ‹©åŠ å…¥å“ªäº›ç´¢å¼•å±‚å‘¢ï¼Ÿæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªéšæœºå‡½æ•°ï¼Œæ¥å†³å®šå°†è¿™ä¸ªç»“ç‚¹æ’å…¥åˆ°å“ªå‡ çº§ç´¢å¼•ä¸­ï¼Œæ¯”å¦‚éšæœºå‡½æ•°ç”Ÿæˆäº†å€¼ Kï¼Œé‚£æˆ‘ä»¬å°±å°†è¿™ä¸ªç»“ç‚¹æ·»åŠ åˆ°ç¬¬ä¸€çº§åˆ°ç¬¬ K çº§è¿™ K çº§ç´¢å¼•ä¸­ã€‚éšæœºå‡½æ•°çš„é€‰æ‹©å¾ˆæœ‰è®²ç©¶ï¼Œä»æ¦‚ç‡ä¸Šæ¥è®²ï¼Œèƒ½å¤Ÿä¿è¯è·³è¡¨çš„ç´¢å¼•å¤§å°å’Œæ•°æ®å¤§å°å¹³è¡¡æ€§ï¼Œä¸è‡³äºæ€§èƒ½è¿‡åº¦é€€åŒ–ã€‚è§£ç­”å¼€ç¯‡ä»Šå¤©çš„å†…å®¹åˆ°æ­¤å°±è®²å®Œäº†ã€‚ç°åœ¨ï¼Œæˆ‘æ¥è®²è§£ä¸€ä¸‹å¼€ç¯‡çš„æ€è€ƒé¢˜ï¼šä¸ºä»€ä¹ˆ Redis è¦ç”¨è·³è¡¨æ¥å®ç°æœ‰åºé›†åˆï¼Œè€Œä¸æ˜¯çº¢é»‘æ ‘ï¼ŸRedis ä¸­çš„æœ‰åºé›†åˆæ˜¯é€šè¿‡è·³è¡¨æ¥å®ç°çš„ï¼Œä¸¥æ ¼ç‚¹è®²ï¼Œå…¶å®è¿˜ç”¨åˆ°äº†æ•£åˆ—è¡¨ã€‚ä¸è¿‡æ•£åˆ—è¡¨æˆ‘ä»¬åé¢æ‰ä¼šè®²åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨æš‚ä¸”å¿½ç•¥è¿™éƒ¨åˆ†ã€‚å¦‚æœä½ å»æŸ¥çœ‹ Redis çš„å¼€å‘æ‰‹å†Œï¼Œå°±ä¼šå‘ç°ï¼ŒRedis ä¸­çš„æœ‰åºé›†åˆæ”¯æŒçš„æ ¸å¿ƒæ“ä½œä¸»è¦æœ‰ä¸‹é¢è¿™å‡ ä¸ªï¼šæ’å…¥ä¸€ä¸ªæ•°æ®ï¼›åˆ é™¤ä¸€ä¸ªæ•°æ®ï¼›æŸ¥æ‰¾ä¸€ä¸ªæ•°æ®ï¼›æŒ‰ç…§åŒºé—´æŸ¥æ‰¾æ•°æ®ï¼ˆæ¯”å¦‚æŸ¥æ‰¾å€¼åœ¨[100, 356]ä¹‹é—´çš„æ•°æ®ï¼‰ï¼›è¿­ä»£è¾“å‡ºæœ‰åºåºåˆ—ã€‚å…¶ä¸­ï¼Œæ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾ä»¥åŠè¿­ä»£è¾“å‡ºæœ‰åºåºåˆ—è¿™å‡ ä¸ªæ“ä½œï¼Œçº¢é»‘æ ‘ä¹Ÿå¯ä»¥å®Œæˆï¼Œæ—¶é—´å¤æ‚åº¦è·Ÿè·³è¡¨æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯ï¼ŒæŒ‰ç…§åŒºé—´æ¥æŸ¥æ‰¾æ•°æ®è¿™ä¸ªæ“ä½œï¼Œçº¢é»‘æ ‘çš„æ•ˆç‡æ²¡æœ‰è·³è¡¨é«˜ã€‚å¯¹äºæŒ‰ç…§åŒºé—´æŸ¥æ‰¾æ•°æ®è¿™ä¸ªæ“ä½œï¼Œè·³è¡¨å¯ä»¥åšåˆ° O(logn) çš„æ—¶é—´å¤æ‚åº¦å®šä½åŒºé—´çš„èµ·ç‚¹ï¼Œç„¶ååœ¨åŸå§‹é“¾è¡¨ä¸­é¡ºåºå¾€åéå†å°±å¯ä»¥äº†ã€‚è¿™æ ·åšéå¸¸é«˜æ•ˆã€‚å½“ç„¶ï¼ŒRedis ä¹‹æ‰€ä»¥ç”¨è·³è¡¨æ¥å®ç°æœ‰åºé›†åˆï¼Œè¿˜æœ‰å…¶ä»–åŸå› ï¼Œæ¯”å¦‚ï¼Œè·³è¡¨æ›´å®¹æ˜“ä»£ç å®ç°ã€‚è™½ç„¶è·³è¡¨çš„å®ç°ä¹Ÿä¸ç®€å•ï¼Œä½†æ¯”èµ·çº¢é»‘æ ‘æ¥è¯´è¿˜æ˜¯å¥½æ‡‚ã€å¥½å†™å¤šäº†ï¼Œè€Œç®€å•å°±æ„å‘³ç€å¯è¯»æ€§å¥½ï¼Œä¸å®¹æ˜“å‡ºé”™ã€‚è¿˜æœ‰ï¼Œè·³è¡¨æ›´åŠ çµæ´»ï¼Œå®ƒå¯ä»¥é€šè¿‡æ”¹å˜ç´¢å¼•æ„å»ºç­–ç•¥ï¼Œæœ‰æ•ˆå¹³è¡¡æ‰§è¡Œæ•ˆç‡å’Œå†…å­˜æ¶ˆè€—ã€‚ä¸è¿‡ï¼Œè·³è¡¨ä¹Ÿä¸èƒ½å®Œå…¨æ›¿ä»£çº¢é»‘æ ‘ã€‚å› ä¸ºçº¢é»‘æ ‘æ¯”è·³è¡¨çš„å‡ºç°è¦æ—©ä¸€äº›ï¼Œå¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­çš„ Map ç±»å‹éƒ½æ˜¯é€šè¿‡çº¢é»‘æ ‘æ¥å®ç°çš„ã€‚æˆ‘ä»¬åšä¸šåŠ¡å¼€å‘çš„æ—¶å€™ï¼Œç›´æ¥æ‹¿æ¥ç”¨å°±å¯ä»¥äº†ï¼Œä¸ç”¨è´¹åŠ²è‡ªå·±å»å®ç°ä¸€ä¸ªçº¢é»‘æ ‘ï¼Œä½†æ˜¯è·³è¡¨å¹¶æ²¡æœ‰ä¸€ä¸ªç°æˆçš„å®ç°ï¼Œæ‰€ä»¥åœ¨å¼€å‘ä¸­ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨è·³è¡¨ï¼Œå¿…é¡»è¦è‡ªå·±å®ç°ã€‚å†…å®¹å°ç»“ä»Šå¤©æˆ‘ä»¬è®²äº†è·³è¡¨è¿™ç§æ•°æ®ç»“æ„ã€‚è·³è¡¨ä½¿ç”¨ç©ºé—´æ¢æ—¶é—´çš„è®¾è®¡æ€è·¯ï¼Œé€šè¿‡æ„å»ºå¤šçº§ç´¢å¼•æ¥æé«˜æŸ¥è¯¢çš„æ•ˆç‡ï¼Œå®ç°äº†åŸºäºé“¾è¡¨çš„â€œäºŒåˆ†æŸ¥æ‰¾â€ã€‚è·³è¡¨æ˜¯ä¸€ç§åŠ¨æ€æ•°æ®ç»“æ„ï¼Œæ”¯æŒå¿«é€Ÿçš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn)ã€‚è·³è¡¨çš„ç©ºé—´å¤æ‚åº¦æ˜¯ O(n)ã€‚ä¸è¿‡ï¼Œè·³è¡¨çš„å®ç°éå¸¸çµæ´»ï¼Œå¯ä»¥é€šè¿‡æ”¹å˜ç´¢å¼•æ„å»ºç­–ç•¥ï¼Œæœ‰æ•ˆå¹³è¡¡æ‰§è¡Œæ•ˆç‡å’Œå†…å­˜æ¶ˆè€—ã€‚è™½ç„¶è·³è¡¨çš„ä»£ç å®ç°å¹¶ä¸ç®€å•ï¼Œä½†æ˜¯ä½œä¸ºä¸€ç§åŠ¨æ€æ•°æ®ç»“æ„ï¼Œæ¯”èµ·çº¢é»‘æ ‘æ¥è¯´ï¼Œå®ç°è¦ç®€å•å¤šäº†ã€‚æ‰€ä»¥å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¸ºäº†ä»£ç çš„ç®€å•ã€æ˜“è¯»ï¼Œæ¯”èµ·çº¢é»‘æ ‘ï¼Œæˆ‘ä»¬æ›´å€¾å‘ç”¨è·³è¡¨ã€‚","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"cpeixin.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"skipList","slug":"skipList","permalink":"cpeixin.cn/tags/skipList/"}]},{"title":"æ•°æ®ç»“æ„ - çº¢é»‘æ ‘ï¼ˆä¸Šï¼‰","slug":"æ•°æ®ç»“æ„-çº¢é»‘æ ‘ï¼ˆä¸Šï¼‰","date":"2016-11-07T00:38:30.000Z","updated":"2020-06-07T16:59:53.547Z","comments":true,"path":"2016/11/07/æ•°æ®ç»“æ„-çº¢é»‘æ ‘ï¼ˆä¸Šï¼‰/","link":"","permalink":"cpeixin.cn/2016/11/07/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%BA%A2%E9%BB%91%E6%A0%91%EF%BC%88%E4%B8%8A%EF%BC%89/","excerpt":"","text":"äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§äºŒå‰æ ‘ï¼Œå®ƒæ”¯æŒå¿«é€Ÿæ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œï¼Œå„ä¸ªæ“ä½œçš„æ—¶é—´å¤æ‚åº¦è·Ÿæ ‘çš„é«˜åº¦æˆæ­£æ¯”ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ã€‚ä¸è¿‡ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘åœ¨é¢‘ç¹çš„åŠ¨æ€æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°æ ‘çš„é«˜åº¦è¿œå¤§äº log2n çš„æƒ…å†µï¼Œä»è€Œå¯¼è‡´å„ä¸ªæ“ä½œçš„æ•ˆç‡ä¸‹é™ã€‚æç«¯æƒ…å†µä¸‹ï¼ŒäºŒå‰æ ‘ä¼šé€€åŒ–ä¸ºé“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šé€€åŒ–åˆ° O(n)ã€‚è¦è§£å†³è¿™ä¸ªå¤æ‚åº¦é€€åŒ–çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ç§å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œä¹Ÿå°±æ˜¯ä»Šå¤©è¦è®²çš„è¿™ç§æ•°æ®ç»“æ„ã€‚å¾ˆå¤šä¹¦ç±é‡Œï¼Œä½†å‡¡è®²åˆ°å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå°±ä¼šæ‹¿çº¢é»‘æ ‘ä½œä¸ºä¾‹å­ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå¦‚æœä½ æœ‰ä¸€å®šçš„å¼€å‘ç»éªŒï¼Œä½ ä¼šå‘ç°ï¼Œåœ¨å·¥ç¨‹ä¸­ï¼Œå¾ˆå¤šç”¨åˆ°å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘çš„åœ°æ–¹éƒ½ä¼šç”¨çº¢é»‘æ ‘ã€‚ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œä¸ºä»€ä¹ˆå·¥ç¨‹ä¸­éƒ½å–œæ¬¢ç”¨çº¢é»‘æ ‘ï¼Œè€Œä¸æ˜¯å…¶ä»–å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘å‘¢ï¼Ÿä»€ä¹ˆæ˜¯â€œå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘â€ï¼Ÿå¹³è¡¡äºŒå‰æ ‘çš„ä¸¥æ ¼å®šä¹‰æ˜¯è¿™æ ·çš„ï¼šäºŒå‰æ ‘ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘çš„é«˜åº¦ç›¸å·®ä¸èƒ½å¤§äº 1ã€‚ä»è¿™ä¸ªå®šä¹‰æ¥çœ‹ï¼Œä¸Šä¸€èŠ‚æˆ‘ä»¬è®²çš„å®Œå…¨äºŒå‰æ ‘ã€æ»¡äºŒå‰æ ‘å…¶å®éƒ½æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œä½†æ˜¯éå®Œå…¨äºŒå‰æ ‘ä¹Ÿæœ‰å¯èƒ½æ˜¯å¹³è¡¡äºŒå‰æ ‘ã€‚å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ä¸ä»…æ»¡è¶³ä¸Šé¢å¹³è¡¡äºŒå‰æ ‘çš„å®šä¹‰ï¼Œè¿˜æ»¡è¶³äºŒå‰æŸ¥æ‰¾æ ‘çš„ç‰¹ç‚¹ã€‚æœ€å…ˆè¢«å‘æ˜çš„å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯AVL æ ‘ï¼Œå®ƒä¸¥æ ¼ç¬¦åˆæˆ‘åˆšè®²åˆ°çš„å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘çš„å®šä¹‰ï¼Œå³ä»»ä½•èŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦ç›¸å·®ä¸è¶…è¿‡ 1ï¼Œæ˜¯ä¸€ç§é«˜åº¦å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ã€‚ä½†æ˜¯å¾ˆå¤šå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘å…¶å®å¹¶æ²¡æœ‰ä¸¥æ ¼ç¬¦åˆä¸Šé¢çš„å®šä¹‰ï¼ˆæ ‘ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘çš„é«˜åº¦ç›¸å·®ä¸èƒ½å¤§äº 1ï¼‰ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸‹é¢è¦è®²çš„çº¢é»‘æ ‘ï¼Œå®ƒä»æ ¹èŠ‚ç‚¹åˆ°å„ä¸ªå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ï¼Œæœ‰å¯èƒ½ä¼šæ¯”æœ€çŸ­è·¯å¾„å¤§ä¸€å€ã€‚æˆ‘ä»¬å­¦ä¹ æ•°æ®ç»“æ„å’Œç®—æ³•æ˜¯ä¸ºäº†åº”ç”¨åˆ°å®é™…çš„å¼€å‘ä¸­çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘è§‰å¾—æ²¡å¿…å»æ­»æŠ å®šä¹‰ã€‚å¯¹äºå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘è¿™ä¸ªæ¦‚å¿µï¼Œæˆ‘è§‰å¾—æˆ‘ä»¬è¦ä»è¿™ä¸ªæ•°æ®ç»“æ„çš„ç”±æ¥ï¼Œå»ç†è§£â€œå¹³è¡¡â€çš„æ„æ€ã€‚å‘æ˜å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘è¿™ç±»æ•°æ®ç»“æ„çš„åˆè¡·æ˜¯ï¼Œè§£å†³æ™®é€šäºŒå‰æŸ¥æ‰¾æ ‘åœ¨é¢‘ç¹çš„æ’å…¥ã€åˆ é™¤ç­‰åŠ¨æ€æ›´æ–°çš„æƒ…å†µä¸‹ï¼Œå‡ºç°æ—¶é—´å¤æ‚åº¦é€€åŒ–çš„é—®é¢˜ã€‚æ‰€ä»¥ï¼Œå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ä¸­â€œå¹³è¡¡â€çš„æ„æ€ï¼Œå…¶å®å°±æ˜¯è®©æ•´æ£µæ ‘å·¦å³çœ‹èµ·æ¥æ¯”è¾ƒâ€œå¯¹ç§°â€ã€æ¯”è¾ƒâ€œå¹³è¡¡â€ï¼Œä¸è¦å‡ºç°å·¦å­æ ‘å¾ˆé«˜ã€å³å­æ ‘å¾ˆçŸ®çš„æƒ…å†µã€‚è¿™æ ·å°±èƒ½è®©æ•´æ£µæ ‘çš„é«˜åº¦ç›¸å¯¹æ¥è¯´ä½ä¸€äº›ï¼Œç›¸åº”çš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾ç­‰æ“ä½œçš„æ•ˆç‡é«˜ä¸€äº›ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬ç°åœ¨è®¾è®¡ä¸€ä¸ªæ–°çš„å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œåªè¦æ ‘çš„é«˜åº¦ä¸æ¯” log2n å¤§å¾ˆå¤šï¼ˆæ¯”å¦‚æ ‘çš„é«˜åº¦ä»ç„¶æ˜¯å¯¹æ•°é‡çº§çš„ï¼‰ï¼Œå°½ç®¡å®ƒä¸ç¬¦åˆæˆ‘ä»¬å‰é¢è®²çš„ä¸¥æ ¼çš„å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘çš„å®šä¹‰ï¼Œä½†æˆ‘ä»¬ä»ç„¶å¯ä»¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆæ ¼çš„å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ã€‚å¦‚ä½•å®šä¹‰ä¸€æ£µâ€œçº¢é»‘æ ‘â€ï¼Ÿå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘å…¶å®æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼ŒSplay Treeï¼ˆä¼¸å±•æ ‘ï¼‰ã€Treapï¼ˆæ ‘å †ï¼‰ç­‰ï¼Œä½†æ˜¯æˆ‘ä»¬æåˆ°å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå¬åˆ°çš„åŸºæœ¬éƒ½æ˜¯çº¢é»‘æ ‘ã€‚å®ƒçš„å‡ºé•œç‡ç”šè‡³è¦é«˜äºâ€œå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘â€è¿™å‡ ä¸ªå­—ï¼Œæœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ç”šè‡³é»˜è®¤å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘å°±æ˜¯çº¢é»‘æ ‘ï¼Œé‚£æˆ‘ä»¬ç°åœ¨å°±æ¥çœ‹çœ‹è¿™ä¸ªâ€œæ˜æ˜Ÿæ ‘â€ã€‚çº¢é»‘æ ‘çš„è‹±æ–‡æ˜¯â€œRed-Black Treeâ€ï¼Œç®€ç§° R-B Treeã€‚å®ƒæ˜¯ä¸€ç§ä¸ä¸¥æ ¼çš„å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæˆ‘å‰é¢è¯´äº†ï¼Œå®ƒçš„å®šä¹‰æ˜¯ä¸ä¸¥æ ¼ç¬¦åˆå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘çš„å®šä¹‰çš„ã€‚é‚£çº¢é»‘æ ‘ç©¶ç«Ÿæ˜¯æ€ä¹ˆå®šä¹‰çš„å‘¢ï¼Ÿé¡¾åæ€ä¹‰ï¼Œçº¢é»‘æ ‘ä¸­çš„èŠ‚ç‚¹ï¼Œä¸€ç±»è¢«æ ‡è®°ä¸ºé»‘è‰²ï¼Œä¸€ç±»è¢«æ ‡è®°ä¸ºçº¢è‰²ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸€æ£µçº¢é»‘æ ‘è¿˜éœ€è¦æ»¡è¶³è¿™æ ·å‡ ä¸ªè¦æ±‚ï¼šæ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²çš„ï¼›æ¯ä¸ªå¶å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ç©ºèŠ‚ç‚¹ï¼ˆNILï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¶å­èŠ‚ç‚¹ä¸å­˜å‚¨æ•°æ®ï¼›ä»»ä½•ç›¸é‚»çš„èŠ‚ç‚¹éƒ½ä¸èƒ½åŒæ—¶ä¸ºçº¢è‰²ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œçº¢è‰²èŠ‚ç‚¹æ˜¯è¢«é»‘è‰²èŠ‚ç‚¹éš”å¼€çš„ï¼›æ¯ä¸ªèŠ‚ç‚¹ï¼Œä»è¯¥èŠ‚ç‚¹åˆ°è¾¾å…¶å¯è¾¾å¶å­èŠ‚ç‚¹çš„æ‰€æœ‰è·¯å¾„ï¼Œéƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ï¼›è¿™é‡Œçš„ç¬¬äºŒç‚¹è¦æ±‚â€œå¶å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ç©ºèŠ‚ç‚¹â€ï¼Œç¨å¾®æœ‰äº›å¥‡æ€ªï¼Œå®ƒä¸»è¦æ˜¯ä¸ºäº†ç®€åŒ–çº¢é»‘æ ‘çš„ä»£ç å®ç°è€Œè®¾ç½®çš„ï¼Œæ‰€ä»¥ï¼Œåœ¨ç”»å›¾å’Œè®²è§£çš„æ—¶å€™ï¼Œæˆ‘å°†é»‘è‰²çš„ã€ç©ºçš„å¶å­èŠ‚ç‚¹éƒ½çœç•¥æ‰äº†ã€‚ä¸ºäº†è®©ä½ æ›´å¥½åœ°ç†è§£ä¸Šé¢çš„å®šä¹‰ï¼Œæˆ‘ç”»äº†ä¸¤ä¸ªçº¢é»‘æ ‘çš„å›¾ä¾‹ï¼Œä½ å¯ä»¥å¯¹ç…§ç€çœ‹ä¸‹ã€‚ä¸ºä»€ä¹ˆè¯´çº¢é»‘æ ‘æ˜¯â€œè¿‘ä¼¼å¹³è¡¡â€çš„ï¼Ÿæˆ‘ä»¬å‰é¢ä¹Ÿè®²åˆ°ï¼Œå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘çš„åˆè¡·ï¼Œæ˜¯ä¸ºäº†è§£å†³äºŒå‰æŸ¥æ‰¾æ ‘å› ä¸ºåŠ¨æ€æ›´æ–°å¯¼è‡´çš„æ€§èƒ½é€€åŒ–é—®é¢˜ã€‚æ‰€ä»¥ï¼Œâ€œå¹³è¡¡â€çš„æ„æ€å¯ä»¥ç­‰ä»·ä¸ºæ€§èƒ½ä¸é€€åŒ–ã€‚â€œè¿‘ä¼¼å¹³è¡¡â€å°±ç­‰ä»·ä¸ºæ€§èƒ½ä¸ä¼šé€€åŒ–çš„å¤ªä¸¥é‡ã€‚æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚è®²è¿‡ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘å¾ˆå¤šæ“ä½œçš„æ€§èƒ½éƒ½è·Ÿæ ‘çš„é«˜åº¦æˆæ­£æ¯”ã€‚ä¸€æ£µæå…¶å¹³è¡¡çš„äºŒå‰æ ‘ï¼ˆæ»¡äºŒå‰æ ‘æˆ–å®Œå…¨äºŒå‰æ ‘ï¼‰çš„é«˜åº¦å¤§çº¦æ˜¯ log2nï¼Œæ‰€ä»¥å¦‚æœè¦è¯æ˜çº¢é»‘æ ‘æ˜¯è¿‘ä¼¼å¹³è¡¡çš„ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ†æï¼Œçº¢é»‘æ ‘çš„é«˜åº¦æ˜¯å¦æ¯”è¾ƒç¨³å®šåœ°è¶‹è¿‘ log2n å°±å¥½äº†ã€‚çº¢é»‘æ ‘çš„é«˜åº¦ä¸æ˜¯å¾ˆå¥½åˆ†æï¼Œæˆ‘å¸¦ä½ ä¸€æ­¥ä¸€æ­¥æ¥æ¨å¯¼ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ï¼Œå¦‚æœæˆ‘ä»¬å°†çº¢è‰²èŠ‚ç‚¹ä»çº¢é»‘æ ‘ä¸­å»æ‰ï¼Œé‚£å•çº¯åŒ…å«é»‘è‰²èŠ‚ç‚¹çš„çº¢é»‘æ ‘çš„é«˜åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿçº¢è‰²èŠ‚ç‚¹åˆ é™¤ä¹‹åï¼Œæœ‰äº›èŠ‚ç‚¹å°±æ²¡æœ‰çˆ¶èŠ‚ç‚¹äº†ï¼Œå®ƒä»¬ä¼šç›´æ¥æ‹¿è¿™äº›èŠ‚ç‚¹çš„ç¥–çˆ¶èŠ‚ç‚¹ï¼ˆçˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼‰ä½œä¸ºçˆ¶èŠ‚ç‚¹ã€‚æ‰€ä»¥ï¼Œä¹‹å‰çš„äºŒå‰æ ‘å°±å˜æˆäº†å››å‰æ ‘ã€‚å‰é¢çº¢é»‘æ ‘çš„å®šä¹‰é‡Œæœ‰è¿™ä¹ˆä¸€æ¡ï¼šä»ä»»æ„èŠ‚ç‚¹åˆ°å¯è¾¾çš„å¶å­èŠ‚ç‚¹çš„æ¯ä¸ªè·¯å¾„åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚æˆ‘ä»¬ä»å››å‰æ ‘ä¸­å–å‡ºæŸäº›èŠ‚ç‚¹ï¼Œæ”¾åˆ°å¶èŠ‚ç‚¹ä½ç½®ï¼Œå››å‰æ ‘å°±å˜æˆäº†å®Œå…¨äºŒå‰æ ‘ã€‚æ‰€ä»¥ï¼Œä»…åŒ…å«é»‘è‰²èŠ‚ç‚¹çš„å››å‰æ ‘çš„é«˜åº¦ï¼Œæ¯”åŒ…å«ç›¸åŒèŠ‚ç‚¹ä¸ªæ•°çš„å®Œå…¨äºŒå‰æ ‘çš„é«˜åº¦è¿˜è¦å°ã€‚å®Œå…¨äºŒå‰æ ‘çš„é«˜åº¦è¿‘ä¼¼ log2nï¼Œè¿™é‡Œçš„å››å‰â€œé»‘æ ‘â€çš„é«˜åº¦è¦ä½äºå®Œå…¨äºŒå‰æ ‘ï¼Œæ‰€ä»¥å»æ‰çº¢è‰²èŠ‚ç‚¹çš„â€œé»‘æ ‘â€çš„é«˜åº¦ä¹Ÿä¸ä¼šè¶…è¿‡ log2nã€‚æˆ‘ä»¬ç°åœ¨çŸ¥é“åªåŒ…å«é»‘è‰²èŠ‚ç‚¹çš„â€œé»‘æ ‘â€çš„é«˜åº¦ï¼Œé‚£æˆ‘ä»¬ç°åœ¨æŠŠçº¢è‰²èŠ‚ç‚¹åŠ å›å»ï¼Œé«˜åº¦ä¼šå˜æˆå¤šå°‘å‘¢ï¼Ÿä»ä¸Šé¢æˆ‘ç”»çš„çº¢é»‘æ ‘çš„ä¾‹å­å’Œå®šä¹‰çœ‹ï¼Œåœ¨çº¢é»‘æ ‘ä¸­ï¼Œçº¢è‰²èŠ‚ç‚¹ä¸èƒ½ç›¸é‚»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰ä¸€ä¸ªçº¢è‰²èŠ‚ç‚¹å°±è¦è‡³å°‘æœ‰ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œå°†å®ƒè·Ÿå…¶ä»–çº¢è‰²èŠ‚ç‚¹éš”å¼€ã€‚çº¢é»‘æ ‘ä¸­åŒ…å«æœ€å¤šé»‘è‰²èŠ‚ç‚¹çš„è·¯å¾„ä¸ä¼šè¶…è¿‡ log2nï¼Œæ‰€ä»¥åŠ å…¥çº¢è‰²èŠ‚ç‚¹ä¹‹åï¼Œæœ€é•¿è·¯å¾„ä¸ä¼šè¶…è¿‡ 2log2nï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œçº¢é»‘æ ‘çš„é«˜åº¦è¿‘ä¼¼ 2log2nã€‚æ‰€ä»¥ï¼Œçº¢é»‘æ ‘çš„é«˜åº¦åªæ¯”é«˜åº¦å¹³è¡¡çš„ AVL æ ‘çš„é«˜åº¦ï¼ˆlog2nï¼‰ä»…ä»…å¤§äº†ä¸€å€ï¼Œåœ¨æ€§èƒ½ä¸Šï¼Œä¸‹é™å¾—å¹¶ä¸å¤šã€‚è¿™æ ·æ¨å¯¼å‡ºæ¥çš„ç»“æœä¸å¤Ÿç²¾ç¡®ï¼Œå®é™…ä¸Šçº¢é»‘æ ‘çš„æ€§èƒ½æ›´å¥½ã€‚è§£ç­”å¼€ç¯‡æˆ‘ä»¬åˆšåˆšæåˆ°äº†å¾ˆå¤šå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥çœ‹ä¸‹ï¼Œä¸ºä»€ä¹ˆåœ¨å·¥ç¨‹ä¸­å¤§å®¶éƒ½å–œæ¬¢ç”¨çº¢é»‘æ ‘è¿™ç§å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Ÿæˆ‘ä»¬å‰é¢æåˆ° Treapã€Splay Treeï¼Œç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå®ƒä»¬æ“ä½œçš„æ•ˆç‡éƒ½å¾ˆé«˜ï¼Œä½†æ˜¯ä¹Ÿæ— æ³•é¿å…æç«¯æƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦çš„é€€åŒ–ã€‚å°½ç®¡è¿™ç§æƒ…å†µå‡ºç°çš„æ¦‚ç‡ä¸å¤§ï¼Œä½†æ˜¯å¯¹äºå•æ¬¡æ“ä½œæ—¶é—´éå¸¸æ•æ„Ÿçš„åœºæ™¯æ¥è¯´ï¼Œå®ƒä»¬å¹¶ä¸é€‚ç”¨ã€‚AVL æ ‘æ˜¯ä¸€ç§é«˜åº¦å¹³è¡¡çš„äºŒå‰æ ‘ï¼Œæ‰€ä»¥æŸ¥æ‰¾çš„æ•ˆç‡éå¸¸é«˜ï¼Œä½†æ˜¯ï¼Œæœ‰åˆ©å°±æœ‰å¼Šï¼ŒAVL æ ‘ä¸ºäº†ç»´æŒè¿™ç§é«˜åº¦çš„å¹³è¡¡ï¼Œå°±è¦ä»˜å‡ºæ›´å¤šçš„ä»£ä»·ã€‚æ¯æ¬¡æ’å…¥ã€åˆ é™¤éƒ½è¦åšè°ƒæ•´ï¼Œå°±æ¯”è¾ƒå¤æ‚ã€è€—æ—¶ã€‚æ‰€ä»¥ï¼Œå¯¹äºæœ‰é¢‘ç¹çš„æ’å…¥ã€åˆ é™¤æ“ä½œçš„æ•°æ®é›†åˆï¼Œä½¿ç”¨ AVL æ ‘çš„ä»£ä»·å°±æœ‰ç‚¹é«˜äº†ã€‚çº¢é»‘æ ‘åªæ˜¯åšåˆ°äº†è¿‘ä¼¼å¹³è¡¡ï¼Œå¹¶ä¸æ˜¯ä¸¥æ ¼çš„å¹³è¡¡ï¼Œæ‰€ä»¥åœ¨ç»´æŠ¤å¹³è¡¡çš„æˆæœ¬ä¸Šï¼Œè¦æ¯” AVL æ ‘è¦ä½ã€‚æ‰€ä»¥ï¼Œçº¢é»‘æ ‘çš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾å„ç§æ“ä½œæ€§èƒ½éƒ½æ¯”è¾ƒç¨³å®šã€‚å¯¹äºå·¥ç¨‹åº”ç”¨æ¥è¯´ï¼Œè¦é¢å¯¹å„ç§å¼‚å¸¸æƒ…å†µï¼Œä¸ºäº†æ”¯æ’‘è¿™ç§å·¥ä¸šçº§çš„åº”ç”¨ï¼Œæˆ‘ä»¬æ›´å€¾å‘äºè¿™ç§æ€§èƒ½ç¨³å®šçš„å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘å†…å®¹å°ç»“å¾ˆå¤šåŒå­¦éƒ½è§‰å¾—çº¢é»‘æ ‘å¾ˆéš¾ï¼Œçš„ç¡®ï¼Œå®ƒç®—æ˜¯æœ€éš¾æŒæ¡çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚å…¶å®çº¢é»‘æ ‘æœ€éš¾çš„åœ°æ–¹æ˜¯å®ƒçš„å®ç°ï¼Œæˆ‘ä»¬ä»Šå¤©è¿˜æ²¡æœ‰æ¶‰åŠï¼Œä¸‹ä¸€èŠ‚æˆ‘ä¼šä¸“é—¨æ¥è®²ã€‚ä¸è¿‡å‘¢ï¼Œæˆ‘è®¤ä¸ºï¼Œæˆ‘ä»¬å…¶å®ä¸åº”è¯¥æŠŠå­¦ä¹ çš„ä¾§é‡ç‚¹ï¼Œæ”¾åˆ°å®ƒçš„å®ç°ä¸Šã€‚é‚£ä½ å¯èƒ½è¦é—®äº†ï¼Œå…³äºçº¢é»‘æ ‘ï¼Œæˆ‘ä»¬ç©¶ç«Ÿéœ€è¦æŒæ¡å“ªäº›ä¸œè¥¿å‘¢ï¼Ÿè¿˜è®°å¾—æˆ‘å¤šæ¬¡è¯´è¿‡çš„è§‚ç‚¹å—ï¼Ÿæˆ‘ä»¬å­¦ä¹ æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œè¦å­¦ä¹ å®ƒçš„ç”±æ¥ã€ç‰¹æ€§ã€é€‚ç”¨çš„åœºæ™¯ä»¥åŠå®ƒèƒ½è§£å†³çš„é—®é¢˜ã€‚å¯¹äºçº¢é»‘æ ‘ï¼Œä¹Ÿä¸ä¾‹å¤–ã€‚ä½ å¦‚æœèƒ½ææ‡‚è¿™å‡ ä¸ªé—®é¢˜ï¼Œå…¶å®å°±å·²ç»è¶³å¤Ÿäº†ã€‚çº¢é»‘æ ‘æ˜¯ä¸€ç§å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ã€‚å®ƒæ˜¯ä¸ºäº†è§£å†³æ™®é€šäºŒå‰æŸ¥æ‰¾æ ‘åœ¨æ•°æ®æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œå¤æ‚åº¦é€€åŒ–çš„é—®é¢˜è€Œäº§ç”Ÿçš„ã€‚çº¢é»‘æ ‘çš„é«˜åº¦è¿‘ä¼¼ log2nï¼Œæ‰€ä»¥å®ƒæ˜¯è¿‘ä¼¼å¹³è¡¡ï¼Œæ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn)ã€‚å› ä¸ºçº¢é»‘æ ‘æ˜¯ä¸€ç§æ€§èƒ½éå¸¸ç¨³å®šçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ‰€ä»¥ï¼Œåœ¨å·¥ç¨‹ä¸­ï¼Œä½†å‡¡æ˜¯ç”¨åˆ°åŠ¨æ€æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ•°æ®çš„åœºæ™¯ï¼Œéƒ½å¯ä»¥ç”¨åˆ°å®ƒã€‚ä¸è¿‡ï¼Œå®ƒå®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œå¦‚æœè‡ªå·±å†™ä»£ç å®ç°ï¼Œéš¾åº¦ä¼šæœ‰äº›é«˜ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å…¶å®æ›´å€¾å‘ç”¨è·³è¡¨æ¥æ›¿ä»£å®ƒã€‚","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"cpeixin.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"çº¢é»‘æ ‘","slug":"çº¢é»‘æ ‘","permalink":"cpeixin.cn/tags/%E7%BA%A2%E9%BB%91%E6%A0%91/"}]},{"title":"æ•°æ®ç»“æ„ - äºŒå‰æ ‘åŸºç¡€ï¼ˆä¸‹ï¼‰","slug":"æ•°æ®ç»“æ„-äºŒå‰æ ‘åŸºç¡€ï¼ˆä¸‹ï¼‰","date":"2016-11-02T10:11:04.000Z","updated":"2020-05-31T10:16:21.213Z","comments":true,"path":"2016/11/02/æ•°æ®ç»“æ„-äºŒå‰æ ‘åŸºç¡€ï¼ˆä¸‹ï¼‰/","link":"","permalink":"cpeixin.cn/2016/11/02/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E4%BA%8C%E5%8F%89%E6%A0%91%E5%9F%BA%E7%A1%80%EF%BC%88%E4%B8%8B%EF%BC%89/","excerpt":"","text":"äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary Search Treeï¼‰äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯äºŒå‰æ ‘ä¸­æœ€å¸¸ç”¨çš„ä¸€ç§ç±»å‹ï¼Œä¹Ÿå«äºŒå‰æœç´¢æ ‘ã€‚é¡¾åæ€ä¹‰ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘æ˜¯ä¸ºäº†å®ç°å¿«é€ŸæŸ¥æ‰¾è€Œç”Ÿçš„ã€‚ä¸è¿‡ï¼Œå®ƒä¸ä»…ä»…æ”¯æŒå¿«é€ŸæŸ¥æ‰¾ä¸€ä¸ªæ•°æ®ï¼Œè¿˜æ”¯æŒå¿«é€Ÿæ’å…¥ã€åˆ é™¤ä¸€ä¸ªæ•°æ®ã€‚å®ƒæ˜¯æ€ä¹ˆåšåˆ°è¿™äº›çš„å‘¢ï¼Ÿè¿™äº›éƒ½ä¾èµ–äºäºŒå‰æŸ¥æ‰¾æ ‘çš„ç‰¹æ®Šç»“æ„ã€‚äºŒå‰æŸ¥æ‰¾æ ‘è¦æ±‚ï¼Œåœ¨æ ‘ä¸­çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…¶å·¦å­æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œéƒ½è¦å°äºè¿™ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œè€Œå³å­æ ‘èŠ‚ç‚¹çš„å€¼éƒ½å¤§äºè¿™ä¸ªèŠ‚ç‚¹çš„å€¼ã€‚ æˆ‘ç”»äº†å‡ ä¸ªäºŒå‰æŸ¥æ‰¾æ ‘çš„ä¾‹å­ï¼Œä½ ä¸€çœ‹åº”è¯¥å°±æ¸…æ¥šäº†ã€‚å‰é¢æˆ‘ä»¬è®²åˆ°ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘æ”¯æŒå¿«é€ŸæŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æ“ä½œï¼Œç°åœ¨æˆ‘ä»¬å°±ä¾æ¬¡æ¥çœ‹ä¸‹ï¼Œè¿™ä¸‰ä¸ªæ“ä½œæ˜¯å¦‚ä½•å®ç°çš„ã€‚1. äºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾æ“ä½œé¦–å…ˆï¼Œæˆ‘ä»¬çœ‹å¦‚ä½•åœ¨äºŒå‰æŸ¥æ‰¾æ ‘ä¸­æŸ¥æ‰¾ä¸€ä¸ªèŠ‚ç‚¹ã€‚æˆ‘ä»¬å…ˆå–æ ¹èŠ‚ç‚¹ï¼Œå¦‚æœå®ƒç­‰äºæˆ‘ä»¬è¦æŸ¥æ‰¾çš„æ•°æ®ï¼Œé‚£å°±è¿”å›ã€‚å¦‚æœè¦æŸ¥æ‰¾çš„æ•°æ®æ¯”æ ¹èŠ‚ç‚¹çš„å€¼å°ï¼Œé‚£å°±åœ¨å·¦å­æ ‘ä¸­é€’å½’æŸ¥æ‰¾ï¼›å¦‚æœè¦æŸ¥æ‰¾çš„æ•°æ®æ¯”æ ¹èŠ‚ç‚¹çš„å€¼å¤§ï¼Œé‚£å°±åœ¨å³å­æ ‘ä¸­é€’å½’æŸ¥æ‰¾ã€‚è¿™é‡Œæˆ‘æŠŠæŸ¥æ‰¾çš„ä»£ç å®ç°äº†ä¸€ä¸‹ï¼Œè´´åœ¨ä¸‹é¢äº†ï¼Œç»“åˆä»£ç ï¼Œç†è§£èµ·æ¥ä¼šæ›´åŠ å®¹æ˜“ã€‚123456789101112131415161718192021222324252627282930313233343536class Node: def __init__(self,value, left_child_node=None, right_child_node=None): self.value = value self.left_child_node = left_child_node self.right_child_node = right_child_nodeclass BinarySearchTree: def __init__(self, value, left_child_node=None, right_child_node=None): self.root = Node(value, left_child_node, right_child_node) def find_elem(self, value, node, parent_node, node_type): if node is None: return False, node, parent_node, node_type elif node.value == value: return True, node, parent_node, node_type elif value &gt; node.value: return self.find_elem(value, node.right_child_node, node, \"right_child_node\") elif value &lt; node.value: return self.find_elem(value, node.left_child_node, node, \"left_child_node\") def insert_elem(self, value): flag, node, parent_node, node_type = self.find_elem(value, self.root, self.root, None) if node_type == \"left_child_node\": node.left_child_node = Node(value) else: node.right_child_node = Node(value)if __name__ == '__main__': tree = BinarySearchTree(33, Node(17, Node(13,right_child_node=Node(16)), Node(18,right_child_node=Node(25, Node(19), Node(27)))), Node(50, Node(34), Node(58, Node(51), Node(66)))) flag, *rest = tree.find_elem(19, tree.root, tree.root, None) print(flag, rest[0].value, rest[1].value, rest[2])2. äºŒå‰æŸ¥æ‰¾æ ‘çš„æ’å…¥æ“ä½œäºŒå‰æŸ¥æ‰¾æ ‘çš„æ’å…¥è¿‡ç¨‹æœ‰ç‚¹ç±»ä¼¼æŸ¥æ‰¾æ“ä½œã€‚æ–°æ’å…¥çš„æ•°æ®ä¸€èˆ¬éƒ½æ˜¯åœ¨å¶å­èŠ‚ç‚¹ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡æ¯”è¾ƒè¦æ’å…¥çš„æ•°æ®å’ŒèŠ‚ç‚¹çš„å¤§å°å…³ç³»ã€‚å¦‚æœè¦æ’å…¥çš„æ•°æ®æ¯”èŠ‚ç‚¹çš„æ•°æ®å¤§ï¼Œå¹¶ä¸”èŠ‚ç‚¹çš„å³å­æ ‘ä¸ºç©ºï¼Œå°±å°†æ–°æ•°æ®ç›´æ¥æ’åˆ°å³å­èŠ‚ç‚¹çš„ä½ç½®ï¼›å¦‚æœä¸ä¸ºç©ºï¼Œå°±å†é€’å½’éå†å³å­æ ‘ï¼ŒæŸ¥æ‰¾æ’å…¥ä½ç½®ã€‚åŒç†ï¼Œå¦‚æœè¦æ’å…¥çš„æ•°æ®æ¯”èŠ‚ç‚¹æ•°å€¼å°ï¼Œå¹¶ä¸”èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ºç©ºï¼Œå°±å°†æ–°æ•°æ®æ’å…¥åˆ°å·¦å­èŠ‚ç‚¹çš„ä½ç½®ï¼›å¦‚æœä¸ä¸ºç©ºï¼Œå°±å†é€’å½’éå†å·¦å­æ ‘ï¼ŒæŸ¥æ‰¾æ’å…¥ä½ç½®ã€‚åŒæ ·ï¼Œæ’å…¥çš„ä»£ç æˆ‘ä¹Ÿå®ç°äº†ä¸€ä¸‹ï¼Œè´´åœ¨ä¸‹é¢ï¼Œä½ å¯ä»¥çœ‹çœ‹ã€‚1234567891011121314151617181920212223242526272829303132333435class Node: def __init__(self,value, left_child_node=None, right_child_node=None): self.value = value self.left_child_node = left_child_node self.right_child_node = right_child_nodeclass BinarySearchTree: def __init__(self, value, left_child_node=None, right_child_node=None): self.root = Node(value, left_child_node, right_child_node) def find_elem(self, value, node, parent_node, node_type): if node is None: return False, node, parent_node, node_type elif node.value == value: return True, node, parent_node, node_type elif value &gt; node.value: return self.find_elem(value, node.right_child_node, node, \"right_child_node\") elif value &lt; node.value: return self.find_elem(value, node.left_child_node, node, \"left_child_node\") def insert_elem(self, value): flag, node, parent_node, node_type = self.find_elem(value, self.root, self.root, None) if node_type == \"left_child_node\": parent_node.left_child_node = Node(value) else: parent_node.right_child_node = Node(value)if __name__ == '__main__': tree = BinarySearchTree(33, Node(17, Node(13,right_child_node=Node(16)), Node(18,right_child_node=Node(25, Node(19), Node(27)))), Node(50, Node(34), Node(58, Node(51), Node(66)))) flag, *rest = tree.find_elem(19, tree.root, tree.root, None) print(flag, rest[0].value, rest[1].value, rest[2]) tree.insert_elem(100) flag, *rest = tree.find_elem(100, tree.root, tree.root, None) print(flag, rest[0].value, rest[1].value, rest[2])3. äºŒå‰æŸ¥æ‰¾æ ‘çš„åˆ é™¤æ“ä½œäºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾ã€æ’å…¥æ“ä½œéƒ½æ¯”è¾ƒç®€å•æ˜“æ‡‚ï¼Œä½†æ˜¯å®ƒçš„åˆ é™¤æ“ä½œå°±æ¯”è¾ƒå¤æ‚äº† ã€‚é’ˆå¯¹è¦åˆ é™¤èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°çš„ä¸åŒï¼Œæˆ‘ä»¬éœ€è¦åˆ†ä¸‰ç§æƒ…å†µæ¥å¤„ç†ã€‚ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼Œå¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦ç›´æ¥å°†çˆ¶èŠ‚ç‚¹ä¸­ï¼ŒæŒ‡å‘è¦åˆ é™¤èŠ‚ç‚¹çš„æŒ‡é’ˆç½®ä¸º nullã€‚æ¯”å¦‚å›¾ä¸­çš„åˆ é™¤èŠ‚ç‚¹ 55ã€‚ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼Œå¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼ˆåªæœ‰å·¦å­èŠ‚ç‚¹æˆ–è€…å³å­èŠ‚ç‚¹ï¼‰ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ–°çˆ¶èŠ‚ç‚¹ä¸­ï¼ŒæŒ‡å‘è¦åˆ é™¤èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œè®©å®ƒæŒ‡å‘è¦åˆ é™¤èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å°±å¯ä»¥äº†ã€‚æ¯”å¦‚å›¾ä¸­çš„åˆ é™¤èŠ‚ç‚¹ 13ã€‚ç¬¬ä¸‰ç§æƒ…å†µæ˜¯ï¼Œå¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œè¿™å°±æ¯”è¾ƒå¤æ‚äº†ã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°è¿™ä¸ªèŠ‚ç‚¹çš„å³å­æ ‘ä¸­çš„æœ€å°èŠ‚ç‚¹ï¼ŒæŠŠå®ƒæ›¿æ¢åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹ä¸Šã€‚ç„¶åå†åˆ é™¤æ‰è¿™ä¸ªæœ€å°èŠ‚ç‚¹ï¼Œå› ä¸ºæœ€å°èŠ‚ç‚¹è‚¯å®šæ²¡æœ‰å·¦å­èŠ‚ç‚¹ï¼ˆå¦‚æœæœ‰å·¦å­ç»“ç‚¹ï¼Œé‚£å°±ä¸æ˜¯æœ€å°èŠ‚ç‚¹äº†ï¼‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åº”ç”¨ä¸Šé¢ä¸¤æ¡è§„åˆ™æ¥åˆ é™¤è¿™ä¸ªæœ€å°èŠ‚ç‚¹ã€‚æ¯”å¦‚å›¾ä¸­çš„åˆ é™¤èŠ‚ç‚¹ 18ã€‚åˆ é™¤ä»£ç ï¼ˆè¦å€ŸåŠ©æŸ¥æ‰¾æ–¹æ³•ï¼‰ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778class Node: def __init__(self,value, left_child_node=None, right_child_node=None): self.value = value self.left_child_node = left_child_node self.right_child_node = right_child_nodeclass BinarySearchTree: def __init__(self, value, left_child_node=None, right_child_node=None): self.root = Node(value, left_child_node, right_child_node) def find_elem(self, value, node, parent_node, node_type): if node is None: return False, node, parent_node, node_type elif node.value == value: return True, node, parent_node, node_type elif value &gt; node.value: return self.find_elem(value, node.right_child_node, node, \"right_child_node\") elif value &lt; node.value: return self.find_elem(value, node.left_child_node, node, \"left_child_node\") def insert_elem(self, value): flag, node, parent_node, node_type = self.find_elem(value, self.root, self.root, None) if node_type == \"left_child_node\": parent_node.left_child_node = Node(value) else: parent_node.right_child_node = Node(value) def delete_elem(self, value): \"\"\"Delete 1). æ— å­èŠ‚ç‚¹ 2). ä¸€ä¸ªå­èŠ‚ç‚¹ 3). ä¸¤ä¸ªå­èŠ‚ç‚¹ \"\"\" flag, node, parent_node, node_type = self.find_elem(value, self.root, self.root, None) if flag is False: return else: if node.left_child_node == None and node.right_child_node == None: if node_type == \"left_child_node\": parent_node.left_child_node = None else: parent_node.right_child_node = None elif node.left_child_node != None and node.right_child_node == None: parent_node.left_child_node = node.left_child_node elif node.left_child_node == None and node.right_child_node != None: parent_node.right_child_node = node.right_child_node else: min_node = self.find_min_node(node.right_child_node) self.delete_elem(min_node.value) if node_type == \"left_child_node\": parent_node.left_child_node = min_node else: parent_node.right_child_node = min_node min_node.left_child_node = node.left_child_node min_node.right_child_node = node.right_child_node def find_min_node(self, node): \"\"\"æŸ¥æ‰¾æœ€å°å€¼\"\"\" if node.left_child_node == None: return node else: return self.find_min_node(node.left_child_node)if __name__ == '__main__': tree = BinarySearchTree(33, Node(16, Node(13,right_child_node=Node(15)), Node(18,Node(17),right_child_node=Node(25, Node(19), Node(27)))), Node(50, Node(34), Node(58, Node(51), Node(66)))) flag, *rest = tree.find_elem(19, tree.root, tree.root, None) print(flag, rest[0].value, rest[1].value, rest[2]) # tree.insert_elem(100) # flag, *rest = tree.find_elem(100, tree.root, tree.root, None) # print(flag, rest[0].value, rest[1].value, rest[2]) tree.delete_elem(18)å®é™…ä¸Šï¼Œå…³äºäºŒå‰æŸ¥æ‰¾æ ‘çš„åˆ é™¤æ“ä½œï¼Œè¿˜æœ‰ä¸ªéå¸¸ç®€å•ã€å–å·§çš„æ–¹æ³•ï¼Œå°±æ˜¯å•çº¯å°†è¦åˆ é™¤çš„èŠ‚ç‚¹æ ‡è®°ä¸ºâ€œå·²åˆ é™¤â€ï¼Œä½†æ˜¯å¹¶ä¸çœŸæ­£ä»æ ‘ä¸­å°†è¿™ä¸ªèŠ‚ç‚¹å»æ‰ã€‚è¿™æ ·åŸæœ¬åˆ é™¤çš„èŠ‚ç‚¹è¿˜éœ€è¦å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ¯”è¾ƒæµªè´¹å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯åˆ é™¤æ“ä½œå°±å˜å¾—ç®€å•äº†å¾ˆå¤šã€‚è€Œä¸”ï¼Œè¿™ç§å¤„ç†æ–¹æ³•ä¹Ÿå¹¶æ²¡æœ‰å¢åŠ æ’å…¥ã€æŸ¥æ‰¾æ“ä½œä»£ç å®ç°çš„éš¾åº¦ã€‚4. äºŒå‰æŸ¥æ‰¾æ ‘çš„å…¶ä»–æ“ä½œé™¤äº†æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œä¹‹å¤–ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘ä¸­è¿˜å¯ä»¥æ”¯æŒå¿«é€Ÿåœ°æŸ¥æ‰¾æœ€å¤§èŠ‚ç‚¹å’Œæœ€å°èŠ‚ç‚¹ã€å‰é©±èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹ã€‚äºŒå‰æ ‘çš„éå†ï¼š1234567891011121314151617181920212223242526272829303132def preTraverse(self, root): ''' å‰åºéå† ä¸­å·¦å³ ''' if root == None: return print(root.value) self.preTraverse(root.left_child_node) self.preTraverse(root.right_child_node)def midTraverse(self, root): ''' ä¸­åºéå† å·¦ä¸­å³ ''' if root == None: return self.midTraverse(root.left_child_node) print(root.value) self.midTraverse(root.right_child_node)def afterTraverse(self, root): ''' ååºéå† å·¦å³ä¸­ ''' if root == None: return self.afterTraverse(root.left_child_node) self.afterTraverse(root.right_child_node) print(root.value)äºŒå‰æ ‘æŸ¥æ‰¾æœ€å¤§æœ€å°å€¼ï¼š123456789101112def find_min_node(self, node): \"\"\"æŸ¥æ‰¾æœ€å°å€¼\"\"\" if node.left_child_node == None: return node else: return self.find_min_node(node.left_child_node)def find_max(self, root): if root.right_child_node is None: return root else: return self.find_max(root.right_child_node)äºŒå‰æŸ¥æ‰¾æ ‘é™¤äº†æ”¯æŒä¸Šé¢å‡ ä¸ªæ“ä½œä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç‰¹æ€§ï¼Œå°±æ˜¯ä¸­åºéå†äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå¯ä»¥è¾“å‡ºæœ‰åºçš„æ•°æ®åºåˆ—ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œéå¸¸é«˜æ•ˆã€‚å› æ­¤ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘ä¹Ÿå«ä½œäºŒå‰æ’åºæ ‘ã€‚æ”¯æŒé‡å¤æ•°æ®çš„äºŒå‰æŸ¥æ‰¾æ ‘å‰é¢è®²äºŒå‰æŸ¥æ‰¾æ ‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬é»˜è®¤æ ‘ä¸­èŠ‚ç‚¹å­˜å‚¨çš„éƒ½æ˜¯æ•°å­—ã€‚å¾ˆå¤šæ—¶å€™ï¼Œåœ¨å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬åœ¨äºŒå‰æŸ¥æ‰¾æ ‘ä¸­å­˜å‚¨çš„ï¼Œæ˜¯ä¸€ä¸ªåŒ…å«å¾ˆå¤šå­—æ®µçš„å¯¹è±¡ã€‚æˆ‘ä»¬åˆ©ç”¨å¯¹è±¡çš„æŸä¸ªå­—æ®µä½œä¸ºé”®å€¼ï¼ˆkeyï¼‰æ¥æ„å»ºäºŒå‰æŸ¥æ‰¾æ ‘ã€‚æˆ‘ä»¬æŠŠå¯¹è±¡ä¸­çš„å…¶ä»–å­—æ®µå«ä½œå«æ˜Ÿæ•°æ®ã€‚å‰é¢æˆ‘ä»¬è®²çš„äºŒå‰æŸ¥æ‰¾æ ‘çš„æ“ä½œï¼Œé’ˆå¯¹çš„éƒ½æ˜¯ä¸å­˜åœ¨é”®å€¼ç›¸åŒçš„æƒ…å†µã€‚é‚£å¦‚æœå­˜å‚¨çš„ä¸¤ä¸ªå¯¹è±¡é”®å€¼ç›¸åŒï¼Œè¿™ç§æƒ…å†µè¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæˆ‘è¿™é‡Œæœ‰ä¸¤ç§è§£å†³æ–¹æ³•ã€‚ç¬¬ä¸€ç§æ–¹æ³•æ¯”è¾ƒå®¹æ˜“ã€‚äºŒå‰æŸ¥æ‰¾æ ‘ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸ä»…ä¼šå­˜å‚¨ä¸€ä¸ªæ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬é€šè¿‡é“¾è¡¨å’Œæ”¯æŒåŠ¨æ€æ‰©å®¹çš„æ•°ç»„ç­‰æ•°æ®ç»“æ„ï¼ŒæŠŠå€¼ç›¸åŒçš„æ•°æ®éƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ç¬¬äºŒç§æ–¹æ³•æ¯”è¾ƒä¸å¥½ç†è§£ï¼Œä¸è¿‡æ›´åŠ ä¼˜é›…ã€‚æ¯ä¸ªèŠ‚ç‚¹ä»ç„¶åªå­˜å‚¨ä¸€ä¸ªæ•°æ®ã€‚åœ¨æŸ¥æ‰¾æ’å…¥ä½ç½®çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœç¢°åˆ°ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œä¸è¦æ’å…¥æ•°æ®çš„å€¼ç›¸åŒï¼Œæˆ‘ä»¬å°±å°†è¿™ä¸ªè¦æ’å…¥çš„æ•°æ®æ”¾åˆ°è¿™ä¸ªèŠ‚ç‚¹çš„å³å­æ ‘ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠŠè¿™ä¸ªæ–°æ’å…¥çš„æ•°æ®å½“ä½œå¤§äºè¿™ä¸ªèŠ‚ç‚¹çš„å€¼æ¥å¤„ç†ã€‚å½“è¦æŸ¥æ‰¾æ•°æ®çš„æ—¶å€™ï¼Œé‡åˆ°å€¼ç›¸åŒçš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¹¶ä¸åœæ­¢æŸ¥æ‰¾æ“ä½œï¼Œè€Œæ˜¯ç»§ç»­åœ¨å³å­æ ‘ä¸­æŸ¥æ‰¾ï¼Œç›´åˆ°é‡åˆ°å¶å­èŠ‚ç‚¹ï¼Œæ‰åœæ­¢ã€‚è¿™æ ·å°±å¯ä»¥æŠŠé”®å€¼ç­‰äºè¦æŸ¥æ‰¾å€¼çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ‰¾å‡ºæ¥ã€‚å¯¹äºåˆ é™¤æ“ä½œï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å…ˆæŸ¥æ‰¾åˆ°æ¯ä¸ªè¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œç„¶åå†æŒ‰å‰é¢è®²çš„åˆ é™¤æ“ä½œçš„æ–¹æ³•ï¼Œä¾æ¬¡åˆ é™¤ã€‚äºŒå‰æŸ¥æ‰¾æ ‘çš„æ—¶é—´å¤æ‚åº¦åˆ†æå¥½äº†ï¼Œå¯¹äºäºŒå‰æŸ¥æ‰¾æ ‘å¸¸ç”¨æ“ä½œçš„å®ç°æ–¹å¼ï¼Œä½ åº”è¯¥æŒæ¡å¾—å·®ä¸å¤šäº†ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘çš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ã€‚å®é™…ä¸Šï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘çš„å½¢æ€å„å¼å„æ ·ã€‚æ¯”å¦‚è¿™ä¸ªå›¾ä¸­ï¼Œå¯¹äºåŒä¸€ç»„æ•°æ®ï¼Œæˆ‘ä»¬æ„é€ äº†ä¸‰ç§äºŒå‰æŸ¥æ‰¾æ ‘ã€‚å®ƒä»¬çš„æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æ“ä½œçš„æ‰§è¡Œæ•ˆç‡éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚å›¾ä¸­ç¬¬ä¸€ç§äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ ¹èŠ‚ç‚¹çš„å·¦å³å­æ ‘æåº¦ä¸å¹³è¡¡ï¼Œå·²ç»é€€åŒ–æˆäº†é“¾è¡¨ï¼Œæ‰€ä»¥æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦å°±å˜æˆäº† O(n)ã€‚æˆ‘åˆšåˆšå…¶å®åˆ†æäº†ä¸€ç§æœ€ç³Ÿç³•çš„æƒ…å†µï¼Œæˆ‘ä»¬ç°åœ¨æ¥åˆ†æä¸€ä¸ªæœ€ç†æƒ³çš„æƒ…å†µï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼ˆæˆ–æ»¡äºŒå‰æ ‘ï¼‰ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿä»æˆ‘å‰é¢çš„ä¾‹å­ã€å›¾ï¼Œä»¥åŠè¿˜æœ‰ä»£ç æ¥çœ‹ï¼Œä¸ç®¡æ“ä½œæ˜¯æ’å…¥ã€åˆ é™¤è¿˜æ˜¯æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦å…¶å®éƒ½è·Ÿæ ‘çš„é«˜åº¦æˆæ­£æ¯”ï¼Œä¹Ÿå°±æ˜¯ O(height)ã€‚æ—¢ç„¶è¿™æ ·ï¼Œç°åœ¨é—®é¢˜å°±è½¬å˜æˆå¦å¤–ä¸€ä¸ªäº†ï¼Œä¹Ÿå°±æ˜¯ï¼Œå¦‚ä½•æ±‚ä¸€æ£µåŒ…å« n ä¸ªèŠ‚ç‚¹çš„å®Œå…¨äºŒå‰æ ‘çš„é«˜åº¦ï¼Ÿæ ‘çš„é«˜åº¦å°±ç­‰äºæœ€å¤§å±‚æ•°å‡ä¸€ï¼Œä¸ºäº†æ–¹ä¾¿è®¡ç®—ï¼Œæˆ‘ä»¬è½¬æ¢æˆå±‚æ¥è¡¨ç¤ºã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒåŒ…å« n ä¸ªèŠ‚ç‚¹çš„å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œç¬¬ä¸€å±‚åŒ…å« 1 ä¸ªèŠ‚ç‚¹ï¼Œç¬¬äºŒå±‚åŒ…å« 2 ä¸ªèŠ‚ç‚¹ï¼Œç¬¬ä¸‰å±‚åŒ…å« 4 ä¸ªèŠ‚ç‚¹ï¼Œä¾æ¬¡ç±»æ¨ï¼Œä¸‹é¢ä¸€å±‚èŠ‚ç‚¹ä¸ªæ•°æ˜¯ä¸Šä¸€å±‚çš„ 2 å€ï¼Œç¬¬ K å±‚åŒ…å«çš„èŠ‚ç‚¹ä¸ªæ•°å°±æ˜¯ 2^(K-1)ã€‚ä¸è¿‡ï¼Œå¯¹äºå®Œå…¨äºŒå‰æ ‘æ¥è¯´ï¼Œæœ€åä¸€å±‚çš„èŠ‚ç‚¹ä¸ªæ•°æœ‰ç‚¹å„¿ä¸éµå®ˆä¸Šé¢çš„è§„å¾‹äº†ã€‚å®ƒåŒ…å«çš„èŠ‚ç‚¹ä¸ªæ•°åœ¨ 1 ä¸ªåˆ° 2^(L-1) ä¸ªä¹‹é—´ï¼ˆæˆ‘ä»¬å‡è®¾æœ€å¤§å±‚æ•°æ˜¯ Lï¼‰ã€‚å¦‚æœæˆ‘ä»¬æŠŠæ¯ä¸€å±‚çš„èŠ‚ç‚¹ä¸ªæ•°åŠ èµ·æ¥å°±æ˜¯æ€»çš„èŠ‚ç‚¹ä¸ªæ•° nã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœèŠ‚ç‚¹çš„ä¸ªæ•°æ˜¯ nï¼Œé‚£ä¹ˆ n æ»¡è¶³è¿™æ ·ä¸€ä¸ªå…³ç³»ï¼š12n &gt;= 1+2+4+8+...+2^(L-2)+1n &lt;= 1+2+4+8+...+2^(L-2)+2^(L-1)å€ŸåŠ©ç­‰æ¯”æ•°åˆ—çš„æ±‚å’Œå…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºï¼ŒL çš„èŒƒå›´æ˜¯[log2(n+1), log2n +1]ã€‚å®Œå…¨äºŒå‰æ ‘çš„å±‚æ•°å°äºç­‰äº log2n +1ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®Œå…¨äºŒå‰æ ‘çš„é«˜åº¦å°äºç­‰äº log2nã€‚æ˜¾ç„¶ï¼Œæåº¦ä¸å¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå®ƒçš„æŸ¥æ‰¾æ€§èƒ½è‚¯å®šä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚æˆ‘ä»¬éœ€è¦æ„å»ºä¸€ç§ä¸ç®¡æ€ä¹ˆåˆ é™¤ã€æ’å…¥æ•°æ®ï¼Œåœ¨ä»»ä½•æ—¶å€™ï¼Œéƒ½èƒ½ä¿æŒä»»æ„èŠ‚ç‚¹å·¦å³å­æ ‘éƒ½æ¯”è¾ƒå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä¸‹ä¸€èŠ‚è¯¾è¦è¯¦ç»†è®²çš„ï¼Œä¸€ç§ç‰¹æ®Šçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ã€‚å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘çš„é«˜åº¦æ¥è¿‘ lognï¼Œæ‰€ä»¥æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ¯”è¾ƒç¨³å®šï¼Œæ˜¯ O(logn)ã€‚è§£ç­”å¼€ç¯‡æˆ‘ä»¬åœ¨æ•£åˆ—è¡¨é‚£èŠ‚ä¸­è®²è¿‡ï¼Œæ•£åˆ—è¡¨çš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å¯ä»¥åšåˆ°å¸¸é‡çº§çš„ O(1)ï¼Œéå¸¸é«˜æ•ˆã€‚è€ŒäºŒå‰æŸ¥æ‰¾æ ‘åœ¨æ¯”è¾ƒå¹³è¡¡çš„æƒ…å†µä¸‹ï¼Œæ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œæ—¶é—´å¤æ‚åº¦æ‰æ˜¯ O(logn)ï¼Œç›¸å¯¹æ•£åˆ—è¡¨ï¼Œå¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Œé‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦ç”¨äºŒå‰æŸ¥æ‰¾æ ‘å‘¢ï¼Ÿæˆ‘è®¤ä¸ºæœ‰ä¸‹é¢å‡ ä¸ªåŸå› ï¼šç¬¬ä¸€ï¼Œæ•£åˆ—è¡¨ä¸­çš„æ•°æ®æ˜¯æ— åºå­˜å‚¨çš„ï¼Œå¦‚æœè¦è¾“å‡ºæœ‰åºçš„æ•°æ®ï¼Œéœ€è¦å…ˆè¿›è¡Œæ’åºã€‚è€Œå¯¹äºäºŒå‰æŸ¥æ‰¾æ ‘æ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸­åºéå†ï¼Œå°±å¯ä»¥åœ¨ O(n) çš„æ—¶é—´å¤æ‚åº¦å†…ï¼Œè¾“å‡ºæœ‰åºçš„æ•°æ®åºåˆ—ã€‚ç¬¬äºŒï¼Œæ•£åˆ—è¡¨æ‰©å®¹è€—æ—¶å¾ˆå¤šï¼Œè€Œä¸”å½“é‡åˆ°æ•£åˆ—å†²çªæ—¶ï¼Œæ€§èƒ½ä¸ç¨³å®šï¼Œå°½ç®¡äºŒå‰æŸ¥æ‰¾æ ‘çš„æ€§èƒ½ä¸ç¨³å®šï¼Œä½†æ˜¯åœ¨å·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨çš„å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘çš„æ€§èƒ½éå¸¸ç¨³å®šï¼Œæ—¶é—´å¤æ‚åº¦ç¨³å®šåœ¨ O(logn)ã€‚ç¬¬ä¸‰ï¼Œç¬¼ç»Ÿåœ°æ¥è¯´ï¼Œå°½ç®¡æ•£åˆ—è¡¨çš„æŸ¥æ‰¾ç­‰æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¸¸é‡çº§çš„ï¼Œä½†å› ä¸ºå“ˆå¸Œå†²çªçš„å­˜åœ¨ï¼Œè¿™ä¸ªå¸¸é‡ä¸ä¸€å®šæ¯” logn å°ï¼Œæ‰€ä»¥å®é™…çš„æŸ¥æ‰¾é€Ÿåº¦å¯èƒ½ä¸ä¸€å®šæ¯” O(logn) å¿«ã€‚åŠ ä¸Šå“ˆå¸Œå‡½æ•°çš„è€—æ—¶ï¼Œä¹Ÿä¸ä¸€å®šå°±æ¯”å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘çš„æ•ˆç‡é«˜ã€‚ç¬¬å››ï¼Œæ•£åˆ—è¡¨çš„æ„é€ æ¯”äºŒå‰æŸ¥æ‰¾æ ‘è¦å¤æ‚ï¼Œéœ€è¦è€ƒè™‘çš„ä¸œè¥¿å¾ˆå¤šã€‚æ¯”å¦‚æ•£åˆ—å‡½æ•°çš„è®¾è®¡ã€å†²çªè§£å†³åŠæ³•ã€æ‰©å®¹ã€ç¼©å®¹ç­‰ã€‚å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘åªéœ€è¦è€ƒè™‘å¹³è¡¡æ€§è¿™ä¸€ä¸ªé—®é¢˜ï¼Œè€Œä¸”è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ¯”è¾ƒæˆç†Ÿã€å›ºå®šã€‚æœ€åï¼Œä¸ºäº†é¿å…è¿‡å¤šçš„æ•£åˆ—å†²çªï¼Œæ•£åˆ—è¡¨è£…è½½å› å­ä¸èƒ½å¤ªå¤§ï¼Œç‰¹åˆ«æ˜¯åŸºäºå¼€æ”¾å¯»å€æ³•è§£å†³å†²çªçš„æ•£åˆ—è¡¨ï¼Œä¸ç„¶ä¼šæµªè´¹ä¸€å®šçš„å­˜å‚¨ç©ºé—´ã€‚ç»¼åˆè¿™å‡ ç‚¹ï¼Œå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘åœ¨æŸäº›æ–¹é¢è¿˜æ˜¯ä¼˜äºæ•£åˆ—è¡¨çš„ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸¤è€…çš„å­˜åœ¨å¹¶ä¸å†²çªã€‚æˆ‘ä»¬åœ¨å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ç»“åˆå…·ä½“çš„éœ€æ±‚æ¥é€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ªã€‚å†…å®¹å°ç»“ä»Šå¤©æˆ‘ä»¬å­¦ä¹ äº†ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘ã€‚å®ƒæ”¯æŒå¿«é€Ÿåœ°æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æ“ä½œã€‚äºŒå‰æŸ¥æ‰¾æ ‘ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºå·¦å­æ ‘èŠ‚ç‚¹çš„å€¼ï¼Œå°äºå³å­æ ‘èŠ‚ç‚¹çš„å€¼ã€‚ä¸è¿‡ï¼Œè¿™åªæ˜¯é’ˆå¯¹æ²¡æœ‰é‡å¤æ•°æ®çš„æƒ…å†µã€‚å¯¹äºå­˜åœ¨é‡å¤æ•°æ®çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæˆ‘ä»‹ç»äº†ä¸¤ç§æ„å»ºæ–¹æ³•ï¼Œä¸€ç§æ˜¯è®©æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨å¤šä¸ªå€¼ç›¸åŒçš„æ•°æ®ï¼›å¦ä¸€ç§æ˜¯ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸­å­˜å‚¨ä¸€ä¸ªæ•°æ®ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åªéœ€è¦ç¨åŠ æ”¹é€ åŸæ¥çš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œå³å¯ã€‚åœ¨äºŒå‰æŸ¥æ‰¾æ ‘ä¸­ï¼ŒæŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤ç­‰å¾ˆå¤šæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½è·Ÿæ ‘çš„é«˜åº¦æˆæ­£æ¯”ã€‚ä¸¤ä¸ªæç«¯æƒ…å†µçš„æ—¶é—´å¤æ‚åº¦åˆ†åˆ«æ˜¯ O(n) å’Œ O(logn)ï¼Œåˆ†åˆ«å¯¹åº”äºŒå‰æ ‘é€€åŒ–æˆé“¾è¡¨çš„æƒ…å†µå’Œå®Œå…¨äºŒå‰æ ‘ã€‚ä¸ºäº†é¿å…æ—¶é—´å¤æ‚åº¦çš„é€€åŒ–ï¼Œé’ˆå¯¹äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæˆ‘ä»¬åˆè®¾è®¡äº†ä¸€ç§æ›´åŠ å¤æ‚çš„æ ‘ï¼Œå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ—¶é—´å¤æ‚åº¦å¯ä»¥åšåˆ°ç¨³å®šçš„ O(logn)ã€‚","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"cpeixin.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","permalink":"cpeixin.cn/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"}]},{"title":"æ•°æ®ç»“æ„ - äºŒå‰æ ‘åŸºç¡€ï¼ˆä¸Šï¼‰","slug":"æ•°æ®ç»“æ„-äºŒå‰æ ‘åŸºç¡€ï¼ˆä¸Šï¼‰","date":"2016-11-01T10:11:04.000Z","updated":"2020-05-31T10:16:37.334Z","comments":true,"path":"2016/11/01/æ•°æ®ç»“æ„-äºŒå‰æ ‘åŸºç¡€ï¼ˆä¸Šï¼‰/","link":"","permalink":"cpeixin.cn/2016/11/01/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E4%BA%8C%E5%8F%89%E6%A0%91%E5%9F%BA%E7%A1%80%EF%BC%88%E4%B8%8A%EF%BC%89/","excerpt":"","text":"äºŒå‰æ ‘æœ‰å“ªå‡ ç§å­˜å‚¨æ–¹å¼ï¼Ÿä»€ä¹ˆæ ·çš„äºŒå‰æ ‘é€‚åˆç”¨æ•°ç»„æ¥å­˜å‚¨ï¼Ÿå¸¦ç€è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å°±æ¥å­¦ä¹ ä»Šå¤©çš„å†…å®¹ï¼Œæ ‘ï¼æ ‘ï¼ˆTreeï¼‰æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ï¼Œä»€ä¹ˆæ˜¯â€œæ ‘â€ï¼Ÿå†å®Œå¤‡çš„å®šä¹‰ï¼Œéƒ½æ²¡æœ‰å›¾ç›´è§‚ã€‚æ‰€ä»¥æˆ‘åœ¨å›¾ä¸­ç”»äº†å‡ æ£µâ€œæ ‘â€ã€‚ä½ æ¥çœ‹çœ‹ï¼Œè¿™äº›â€œæ ‘â€éƒ½æœ‰ä»€ä¹ˆç‰¹å¾ï¼Ÿä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œâ€œæ ‘â€è¿™ç§æ•°æ®ç»“æ„çœŸçš„å¾ˆåƒæˆ‘ä»¬ç°å®ç”Ÿæ´»ä¸­çš„â€œæ ‘â€ï¼Œè¿™é‡Œé¢æ¯ä¸ªå…ƒç´ æˆ‘ä»¬å«ä½œâ€œèŠ‚ç‚¹â€ï¼›ç”¨æ¥è¿çº¿ç›¸é‚»èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œæˆ‘ä»¬å«ä½œâ€œçˆ¶å­å…³ç³»â€ã€‚æ¯”å¦‚ä¸‹é¢è¿™å¹…å›¾ï¼ŒA èŠ‚ç‚¹å°±æ˜¯ B èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼ŒB èŠ‚ç‚¹æ˜¯ A èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ã€‚Bã€Cã€D è¿™ä¸‰ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥å®ƒä»¬ä¹‹é—´äº’ç§°ä¸ºå…„å¼ŸèŠ‚ç‚¹ã€‚æˆ‘ä»¬æŠŠæ²¡æœ‰çˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹å«ä½œæ ¹èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„èŠ‚ç‚¹ Eã€‚æˆ‘ä»¬æŠŠæ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹å«ä½œå¶å­èŠ‚ç‚¹æˆ–è€…å¶èŠ‚ç‚¹ï¼Œæ¯”å¦‚å›¾ä¸­çš„ Gã€Hã€Iã€Jã€Kã€L éƒ½æ˜¯å¶å­èŠ‚ç‚¹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå…³äºâ€œæ ‘â€ï¼Œè¿˜æœ‰ä¸‰ä¸ªæ¯”è¾ƒç›¸ä¼¼çš„æ¦‚å¿µï¼šé«˜åº¦ï¼ˆHeightï¼‰ã€æ·±åº¦ï¼ˆDepthï¼‰ã€å±‚ï¼ˆLevelï¼‰ã€‚å®ƒä»¬çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼šè¿™ä¸‰ä¸ªæ¦‚å¿µçš„å®šä¹‰æ¯”è¾ƒå®¹æ˜“æ··æ·†ï¼Œæè¿°èµ·æ¥ä¹Ÿæ¯”è¾ƒç©ºæ´ã€‚æˆ‘ä¸¾ä¸ªä¾‹å­è¯´æ˜ä¸€ä¸‹ï¼Œä½ ä¸€çœ‹åº”è¯¥å°±èƒ½æ˜ç™½ã€‚è®°è¿™å‡ ä¸ªæ¦‚å¿µï¼Œæˆ‘è¿˜æœ‰ä¸€ä¸ªå°çªé—¨ï¼Œå°±æ˜¯ç±»æ¯”â€œé«˜åº¦â€â€œæ·±åº¦â€â€œå±‚â€è¿™å‡ ä¸ªåè¯åœ¨ç”Ÿæ´»ä¸­çš„å«ä¹‰ã€‚åœ¨æˆ‘ä»¬çš„ç”Ÿæ´»ä¸­ï¼Œâ€œé«˜åº¦â€è¿™ä¸ªæ¦‚å¿µï¼Œå…¶å®å°±æ˜¯ä»ä¸‹å¾€ä¸Šåº¦é‡ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦åº¦é‡ç¬¬ 10 å±‚æ¥¼çš„é«˜åº¦ã€ç¬¬ 13 å±‚æ¥¼çš„é«˜åº¦ï¼Œèµ·ç‚¹éƒ½æ˜¯åœ°é¢ã€‚æ‰€ä»¥ï¼Œæ ‘è¿™ç§æ•°æ®ç»“æ„çš„é«˜åº¦ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä»æœ€åº•å±‚å¼€å§‹è®¡æ•°ï¼Œå¹¶ä¸”è®¡æ•°çš„èµ·ç‚¹æ˜¯ 0ã€‚â€œæ·±åº¦â€è¿™ä¸ªæ¦‚å¿µåœ¨ç”Ÿæ´»ä¸­æ˜¯ä»ä¸Šå¾€ä¸‹åº¦é‡çš„ï¼Œæ¯”å¦‚æ°´ä¸­é±¼çš„æ·±åº¦ï¼Œæ˜¯ä»æ°´å¹³é¢å¼€å§‹åº¦é‡çš„ã€‚æ‰€ä»¥ï¼Œæ ‘è¿™ç§æ•°æ®ç»“æ„çš„æ·±åº¦ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä»æ ¹ç»“ç‚¹å¼€å§‹åº¦é‡ï¼Œå¹¶ä¸”è®¡æ•°èµ·ç‚¹ä¹Ÿæ˜¯ 0ã€‚â€œå±‚æ•°â€è·Ÿæ·±åº¦çš„è®¡ç®—ç±»ä¼¼ï¼Œä¸è¿‡ï¼Œè®¡æ•°èµ·ç‚¹æ˜¯ 1ï¼Œä¹Ÿå°±æ˜¯è¯´æ ¹èŠ‚ç‚¹çš„ä½äºç¬¬ 1 å±‚ã€‚äºŒå‰æ ‘ï¼ˆBinary Treeï¼‰æ ‘ç»“æ„å¤šç§å¤šæ ·ï¼Œä¸è¿‡æˆ‘ä»¬æœ€å¸¸ç”¨è¿˜æ˜¯äºŒå‰æ ‘ã€‚äºŒå‰æ ‘ï¼Œé¡¾åæ€ä¹‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªâ€œå‰â€ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯å·¦å­èŠ‚ç‚¹å’Œå³å­èŠ‚ç‚¹ã€‚ä¸è¿‡ï¼ŒäºŒå‰æ ‘å¹¶ä¸è¦æ±‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œæœ‰çš„èŠ‚ç‚¹åªæœ‰å·¦å­èŠ‚ç‚¹ï¼Œæœ‰çš„èŠ‚ç‚¹åªæœ‰å³å­èŠ‚ç‚¹ã€‚æˆ‘ç”»çš„è¿™å‡ ä¸ªéƒ½æ˜¯äºŒå‰æ ‘ã€‚ä»¥æ­¤ç±»æ¨ï¼Œä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹å››å‰æ ‘ã€å…«å‰æ ‘é•¿ä»€ä¹ˆæ ·å­ã€‚è¿™ä¸ªå›¾é‡Œé¢ï¼Œæœ‰ä¸¤ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„äºŒå‰æ ‘ï¼Œåˆ†åˆ«æ˜¯ç¼–å· 2 å’Œç¼–å· 3 è¿™ä¸¤ä¸ªã€‚å…¶ä¸­ï¼Œç¼–å· 2 çš„äºŒå‰æ ‘ä¸­ï¼Œå¶å­èŠ‚ç‚¹å…¨éƒ½åœ¨æœ€åº•å±‚ï¼Œé™¤äº†å¶å­èŠ‚ç‚¹ä¹‹å¤–ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å·¦å³ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œè¿™ç§äºŒå‰æ ‘å°±å«ä½œæ»¡äºŒå‰æ ‘ã€‚ç¼–å· 3 çš„äºŒå‰æ ‘ä¸­ï¼Œå¶å­èŠ‚ç‚¹éƒ½åœ¨æœ€åº•ä¸‹ä¸¤å±‚ï¼Œæœ€åä¸€å±‚çš„å¶å­èŠ‚ç‚¹éƒ½é å·¦æ’åˆ—ï¼Œå¹¶ä¸”é™¤äº†æœ€åä¸€å±‚ï¼Œå…¶ä»–å±‚çš„èŠ‚ç‚¹ä¸ªæ•°éƒ½è¦è¾¾åˆ°æœ€å¤§ï¼Œè¿™ç§äºŒå‰æ ‘å«ä½œå®Œå…¨äºŒå‰æ ‘ã€‚æ»¡äºŒå‰æ ‘å¾ˆå¥½ç†è§£ï¼Œä¹Ÿå¾ˆå¥½è¯†åˆ«ï¼Œä½†æ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œæœ‰çš„äººå¯èƒ½å°±åˆ†ä¸æ¸…äº†ã€‚æˆ‘ç”»äº†å‡ ä¸ªå®Œå…¨äºŒå‰æ ‘å’Œéå®Œå…¨äºŒå‰æ ‘çš„ä¾‹å­ï¼Œä½ å¯ä»¥å¯¹æ¯”ç€çœ‹çœ‹ã€‚ä½ å¯èƒ½ä¼šè¯´ï¼Œæ»¡äºŒå‰æ ‘çš„ç‰¹å¾éå¸¸æ˜æ˜¾ï¼Œæˆ‘ä»¬æŠŠå®ƒå•ç‹¬æ‹å‡ºæ¥è®²ï¼Œè¿™ä¸ªå¯ä»¥ç†è§£ã€‚ä½†æ˜¯å®Œå…¨äºŒå‰æ ‘çš„ç‰¹å¾ä¸æ€ä¹ˆæ˜æ˜¾å•Šï¼Œå•ä»é•¿ç›¸ä¸Šæ¥çœ‹ï¼Œå®Œå…¨äºŒå‰æ ‘å¹¶æ²¡æœ‰ç‰¹åˆ«ç‰¹æ®Šçš„åœ°æ–¹å•Šï¼Œæ›´åƒæ˜¯â€œèŠ¸èŠ¸ä¼—æ ‘â€ä¸­çš„ä¸€ç§ã€‚é‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦ç‰¹æ„æŠŠå®ƒæ‹å‡ºæ¥è®²å‘¢ï¼Ÿä¸ºä»€ä¹ˆååæŠŠæœ€åä¸€å±‚çš„å¶å­èŠ‚ç‚¹é å·¦æ’åˆ—çš„å«å®Œå…¨äºŒå‰æ ‘ï¼Ÿå¦‚æœé å³æ’åˆ—å°±ä¸èƒ½å«å®Œå…¨äºŒå‰æ ‘äº†å—ï¼Ÿè¿™ä¸ªå®šä¹‰çš„ç”±æ¥æˆ–è€…è¯´ç›®çš„åœ¨å“ªé‡Œï¼Ÿè¦ç†è§£å®Œå…¨äºŒå‰æ ‘å®šä¹‰çš„ç”±æ¥ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ï¼Œå¦‚ä½•è¡¨ç¤ºï¼ˆæˆ–è€…å­˜å‚¨ï¼‰ä¸€æ£µäºŒå‰æ ‘ï¼Ÿæƒ³è¦å­˜å‚¨ä¸€æ£µäºŒå‰æ ‘ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯åŸºäºæŒ‡é’ˆæˆ–è€…å¼•ç”¨çš„äºŒå‰é“¾å¼å­˜å‚¨æ³•ï¼Œä¸€ç§æ˜¯åŸºäºæ•°ç»„çš„é¡ºåºå­˜å‚¨æ³•ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹æ¯”è¾ƒç®€å•ã€ç›´è§‚çš„é“¾å¼å­˜å‚¨æ³•ã€‚ä»å›¾ä¸­ä½ åº”è¯¥å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸‰ä¸ªå­—æ®µï¼Œå…¶ä¸­ä¸€ä¸ªå­˜å‚¨æ•°æ®ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯æŒ‡å‘å·¦å³å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚æˆ‘ä»¬åªè¦æ‹ä½æ ¹èŠ‚ç‚¹ï¼Œå°±å¯ä»¥é€šè¿‡å·¦å³å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼ŒæŠŠæ•´æ£µæ ‘éƒ½ä¸²èµ·æ¥ã€‚è¿™ç§å­˜å‚¨æ–¹å¼æˆ‘ä»¬æ¯”è¾ƒå¸¸ç”¨ã€‚å¤§éƒ¨åˆ†äºŒå‰æ ‘ä»£ç éƒ½æ˜¯é€šè¿‡è¿™ç§ç»“æ„æ¥å®ç°çš„ã€‚æˆ‘ä»¬å†æ¥çœ‹ï¼ŒåŸºäºæ•°ç»„çš„é¡ºåºå­˜å‚¨æ³•ã€‚æˆ‘ä»¬æŠŠæ ¹èŠ‚ç‚¹å­˜å‚¨åœ¨ä¸‹æ ‡ i = 1 çš„ä½ç½®ï¼Œé‚£å·¦å­èŠ‚ç‚¹å­˜å‚¨åœ¨ä¸‹æ ‡ 2 * i = 2 çš„ä½ç½®ï¼Œå³å­èŠ‚ç‚¹å­˜å‚¨åœ¨ 2 * i + 1 = 3 çš„ä½ç½®ã€‚ä»¥æ­¤ç±»æ¨ï¼ŒB èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹å­˜å‚¨åœ¨ 2 * i = 2 * 2 = 4 çš„ä½ç½®ï¼Œå³å­èŠ‚ç‚¹å­˜å‚¨åœ¨ 2 * i + 1 = 2 * 2 + 1 = 5 çš„ä½ç½®ã€‚æˆ‘æ¥æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚æœèŠ‚ç‚¹ X å­˜å‚¨åœ¨æ•°ç»„ä¸­ä¸‹æ ‡ä¸º i çš„ä½ç½®ï¼Œä¸‹æ ‡ä¸º 2 * i çš„ä½ç½®å­˜å‚¨çš„å°±æ˜¯å·¦å­èŠ‚ç‚¹ï¼Œä¸‹æ ‡ä¸º 2 * i + 1 çš„ä½ç½®å­˜å‚¨çš„å°±æ˜¯å³å­èŠ‚ç‚¹ã€‚åè¿‡æ¥ï¼Œä¸‹æ ‡ä¸º i/2 çš„ä½ç½®å­˜å‚¨å°±æ˜¯å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬åªè¦çŸ¥é“æ ¹èŠ‚ç‚¹å­˜å‚¨çš„ä½ç½®ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ºäº†æ–¹ä¾¿è®¡ç®—å­èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹ä¼šå­˜å‚¨åœ¨ä¸‹æ ‡ä¸º 1 çš„ä½ç½®ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ä¸‹æ ‡è®¡ç®—ï¼ŒæŠŠæ•´æ£µæ ‘éƒ½ä¸²èµ·æ¥ã€‚ä¸è¿‡ï¼Œæˆ‘åˆšåˆšä¸¾çš„ä¾‹å­æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼Œæ‰€ä»¥ä»…ä»…â€œæµªè´¹â€äº†ä¸€ä¸ªä¸‹æ ‡ä¸º 0 çš„å­˜å‚¨ä½ç½®ã€‚å¦‚æœæ˜¯éå®Œå…¨äºŒå‰æ ‘ï¼Œå…¶å®ä¼šæµªè´¹æ¯”è¾ƒå¤šçš„æ•°ç»„å­˜å‚¨ç©ºé—´ã€‚ä½ å¯ä»¥çœ‹æˆ‘ä¸¾çš„ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚æ‰€ä»¥ï¼Œå¦‚æœæŸæ£µäºŒå‰æ ‘æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼Œé‚£ç”¨æ•°ç»„å­˜å‚¨æ— ç–‘æ˜¯æœ€èŠ‚çœå†…å­˜çš„ä¸€ç§æ–¹å¼ã€‚å› ä¸ºæ•°ç»„çš„å­˜å‚¨æ–¹å¼å¹¶ä¸éœ€è¦åƒé“¾å¼å­˜å‚¨æ³•é‚£æ ·ï¼Œè¦å­˜å‚¨é¢å¤–çš„å·¦å³å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå®Œå…¨äºŒå‰æ ‘ä¼šå•ç‹¬æ‹å‡ºæ¥çš„åŸå› ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå®Œå…¨äºŒå‰æ ‘è¦æ±‚æœ€åä¸€å±‚çš„å­èŠ‚ç‚¹éƒ½é å·¦çš„åŸå› ã€‚å½“æˆ‘ä»¬è®²åˆ°å †å’Œå †æ’åºçš„æ—¶å€™ï¼Œä½ ä¼šå‘ç°ï¼Œå †å…¶å®å°±æ˜¯ä¸€ç§å®Œå…¨äºŒå‰æ ‘ï¼Œæœ€å¸¸ç”¨çš„å­˜å‚¨æ–¹å¼å°±æ˜¯æ•°ç»„ã€‚**äºŒå‰æ ‘çš„éå†å‰é¢æˆ‘è®²äº†äºŒå‰æ ‘çš„åŸºæœ¬å®šä¹‰å’Œå­˜å‚¨æ–¹æ³•ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹äºŒå‰æ ‘ä¸­éå¸¸é‡è¦çš„æ“ä½œï¼ŒäºŒå‰æ ‘çš„éå†ã€‚è¿™ä¹Ÿæ˜¯éå¸¸å¸¸è§çš„é¢è¯•é¢˜ã€‚å¦‚ä½•å°†æ‰€æœ‰èŠ‚ç‚¹éƒ½éå†æ‰“å°å‡ºæ¥å‘¢ï¼Ÿç»å…¸çš„æ–¹æ³•æœ‰ä¸‰ç§ï¼Œå‰åºéå†ã€ä¸­åºéå†å’Œååºéå†ã€‚å…¶ä¸­ï¼Œå‰ã€ä¸­ã€ååºï¼Œè¡¨ç¤ºçš„æ˜¯èŠ‚ç‚¹ä¸å®ƒçš„å·¦å³å­æ ‘èŠ‚ç‚¹éå†æ‰“å°çš„å…ˆåé¡ºåºã€‚å‰åºéå†æ˜¯æŒ‡ï¼Œå¯¹äºæ ‘ä¸­çš„ä»»æ„èŠ‚ç‚¹æ¥è¯´ï¼Œå…ˆæ‰“å°è¿™ä¸ªèŠ‚ç‚¹ï¼Œç„¶åå†æ‰“å°å®ƒçš„å·¦å­æ ‘ï¼Œæœ€åæ‰“å°å®ƒçš„å³å­æ ‘ã€‚ä¸­åºéå†æ˜¯æŒ‡ï¼Œå¯¹äºæ ‘ä¸­çš„ä»»æ„èŠ‚ç‚¹æ¥è¯´ï¼Œå…ˆæ‰“å°å®ƒçš„å·¦å­æ ‘ï¼Œç„¶åå†æ‰“å°å®ƒæœ¬èº«ï¼Œæœ€åæ‰“å°å®ƒçš„å³å­æ ‘ã€‚ååºéå†æ˜¯æŒ‡ï¼Œå¯¹äºæ ‘ä¸­çš„ä»»æ„èŠ‚ç‚¹æ¥è¯´ï¼Œå…ˆæ‰“å°å®ƒçš„å·¦å­æ ‘ï¼Œç„¶åå†æ‰“å°å®ƒçš„å³å­æ ‘ï¼Œæœ€åæ‰“å°è¿™ä¸ªèŠ‚ç‚¹æœ¬èº«ã€‚å®é™…ä¸Šï¼ŒäºŒå‰æ ‘çš„å‰ã€ä¸­ã€ååºéå†å°±æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ã€‚æ¯”å¦‚ï¼Œå‰åºéå†ï¼Œå…¶å®å°±æ˜¯å…ˆæ‰“å°æ ¹èŠ‚ç‚¹ï¼Œç„¶åå†é€’å½’åœ°æ‰“å°å·¦å­æ ‘ï¼Œæœ€åé€’å½’åœ°æ‰“å°å³å­æ ‘ã€‚å†™é€’å½’ä»£ç çš„å…³é”®ï¼Œå°±æ˜¯çœ‹èƒ½ä¸èƒ½å†™å‡ºé€’æ¨å…¬å¼ï¼Œè€Œå†™é€’æ¨å…¬å¼çš„å…³é”®å°±æ˜¯ï¼Œå¦‚æœè¦è§£å†³é—®é¢˜ Aï¼Œå°±å‡è®¾å­é—®é¢˜ Bã€C å·²ç»è§£å†³ï¼Œç„¶åå†æ¥çœ‹å¦‚ä½•åˆ©ç”¨ Bã€C æ¥è§£å†³ Aã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå‰ã€ä¸­ã€ååºéå†çš„é€’æ¨å…¬å¼éƒ½å†™å‡ºæ¥ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950class Node: def __init__(self, value=None, left=None, right=None): self.value = value self.left = left # å·¦å­æ ‘ self.right = right # å³å­æ ‘def preTraverse(root): ''' å‰åºéå† ''' if root == None: return print(root.value) preTraverse(root.left) preTraverse(root.right)def midTraverse(root): ''' ä¸­åºéå† ''' if root == None: return midTraverse(root.left) print(root.value) midTraverse(root.right)def afterTraverse(root): ''' ååºéå† ''' if root == None: return afterTraverse(root.left) afterTraverse(root.right) print(root.value)if __name__=='__main__': root=Node('D',Node('B',Node('A'),Node('C')),Node('E',right=Node('G',Node('F')))) print('å‰åºéå†ï¼š') preTraverse(root) print('\\n') print('ä¸­åºéå†ï¼š') midTraverse(root) print('\\n') print('ååºéå†ï¼š') afterTraverse(root) print('\\n')","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"cpeixin.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","permalink":"cpeixin.cn/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"}]},{"title":"Hive åŸºæœ¬æ“ä½œ","slug":"Hive-åŸºæœ¬æ“ä½œ","date":"2016-10-20T14:14:13.000Z","updated":"2020-06-14T14:31:01.292Z","comments":true,"path":"2016/10/20/Hive-åŸºæœ¬æ“ä½œ/","link":"","permalink":"cpeixin.cn/2016/10/20/Hive-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/","excerpt":"","text":"Hive äº¤äº’å‘½ä»¤åˆšåˆšå®‰è£…å¥½hiveåï¼Œå…ˆæ¥çœ‹ä¸€çœ‹åŸºæœ¬çš„äº¤äº’12345678910111213141516(base) [cpeixin@CpeixindeMBP:] ~ $ hive -helpHive Session ID &#x3D; 626af458-fe89-406e-9a63-5967e2962486usage: hive -d,--define &lt;key&#x3D;value&gt; Variable substitution to apply to Hive commands. e.g. -d A&#x3D;B or --define A&#x3D;B --database &lt;databasename&gt; Specify the database to use -e &lt;quoted-query-string&gt; SQL from command line -f &lt;filename&gt; SQL from files -H,--help Print help information --hiveconf &lt;property&#x3D;value&gt; Use value for given property --hivevar &lt;key&#x3D;value&gt; Variable substitution to apply to Hive commands. e.g. --hivevar A&#x3D;B -i &lt;filename&gt; Initialization SQL file -S,--silent Silent mode in interactive shell -v,--verbose Verbose mode (echo executed SQL to the console)åœ¨ä¸è¿›å…¥å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸Šé¢è¿™äº›äº¤äº’å‘½ä»¤æ¥æ“ä½œhive-e åœ¨linuxå‘½ä»¤è¡Œçª—å£æ‰§è¡Œsqlè¯­å¥[cpeixin@CpeixindeMBP]$ hive -e â€œhive -e â€œselect * from test.carâ€â€æ³¨ï¼š è®°å¾—åŠ åº“å-f æ‰§è¡Œè„šæœ¬ä¸­sqlè¯­å¥ï¼Œå¹¶å°†ç»“æœå†™åˆ°æŒ‡å®šæ–‡ä»¶[cpeixin@CpeixindeMBP]$ hive -f /opt/sql/test.sql &gt; /opt/data/test_result.txtæŸ¥çœ‹hiveçš„æ‰§è¡Œå†å²[cpeixin@CpeixindeMBP:] ~ $ cat .hivehistoryåœ¨è¿›å…¥hiveå®¢æˆ·ç«¯ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹æœ¬åœ°å’ŒHDFSæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ï¼Œè¿™ä¸ªè¿˜æ˜¯è›®å®ç”¨çš„Hive æ•°æ®ç±»å‹åŸºæœ¬çš„äº¤äº’äº†è§£åå‘¢ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Hiveä¸­çš„æ•°æ®ç±»å‹åŸºæœ¬æ•°æ®ç±»å‹ï¼šæ•°æ®ç±»å‹å­—èŠ‚èŒƒå›´ç¤ºä¾‹TINYINT1byte-128 ~ 127100YSMALLINT2byte-32,768 ~ 32,767100SINT/INTEGER4byte-2,147,483,648 ~ 2,147,483,647100BIGINT8byte-9,223,372,036,854,775,808 ~ 9,223,372,036,854,775,807100LFLOAT4byteå•ç²¾åº¦æµ®ç‚¹æ•°0.2DOUBLE8byteåŒç²¾åº¦æµ®ç‚¹æ•°0.2DECIMALé«˜ç²¾åº¦æµ®ç‚¹æ•°DECIMAL(9,8)BOOLEANTRUE/FALSEtrueBINARYäºŒè¿›åˆ¶ç±»å‹TIMESTAMPæ—¶é—´æˆ³DATEæ—¥æœŸ2016-08-08STRINGVARCHARé•¿åº¦ 1ï½65535CHARæœ€å¤§é•¿åº¦255å…³äºæ•´å‹ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œæ•´å‹æ•°æ®é»˜è®¤ä¸ºINTï¼Œé™¤éæ•°å­—è¶…å‡ºINTçš„èŒƒå›´ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å®ƒè¢«è¡¨ç¤ºä¸º BIGINTï¼Œæˆ–è€…ç›´æ¥æŒ‡å®š100Yï¼Œ100S, 100L æ‰ä¼šå¯¹åº”è½¬æ¢æˆTINYINTã€SMALLINTã€BIGINTã€‚å…³äºæµ®ç‚¹å‹ï¼šæµ®ç‚¹æ•°å‡å®šä¸º DOUBLEï¼ŒDecimal å­—ä¸º DOUBLE ç±»å‹æä¾›ç²¾ç¡®å€¼å’Œæµ®ç‚¹æ•°çš„æ›´å¤§èŒƒå›´ã€‚ Decimal æ•°æ®ç±»å‹å­˜å‚¨æ•°å€¼çš„ç²¾ç¡®è¡¨ç¤ºï¼Œè€Œ DOUBLE æ•°æ®ç±»å‹å­˜å‚¨éå¸¸æ¥è¿‘æ•°å€¼çš„è¿‘ä¼¼å€¼ã€‚DECIMALä¸æŒ‡å®šç²¾åº¦æ—¶é»˜è®¤ä¸ºDECIMAL(10,0)ï¼›DOUBLE çš„(éå¸¸æ¥è¿‘)è¿‘ä¼¼å€¼ä¸è¶³ä»¥æ»¡è¶³è¦æ±‚æ˜¯ï¼Œéœ€è¦ä½¿ç”¨Decimal ç±»å‹ï¼Œä¾‹å¦‚è´¢åŠ¡åº”ç”¨ç¨‹åºï¼Œç›¸ç­‰å’Œä¸ç­‰å¼æ£€æŸ¥ä»¥åŠèˆå…¥æ“ä½œã€‚å¯¹äºå¤„ç† DOUBLE èŒƒå›´(å¤§çº¦-10308 åˆ° 10308)æˆ–éå¸¸æ¥è¿‘é›¶(-10-308 åˆ° 10-308)ä¹‹å¤–çš„æ•°çš„ç”¨ä¾‹ï¼Œä¹Ÿéœ€è¦å®ƒä»¬ã€‚å¦å¤–ï¼ŒDecimalä¸ºä¸“é—¨ä¸ºè´¢åŠ¡ç›¸å…³é—®é¢˜è®¾è®¡çš„æ•°æ®ç±»å‹ã€‚å…³äºå­—ç¬¦å‹ï¼šStrings å­—ç¬¦ä¸²æ•°æ®å¯ä»¥ç”¨å•å¼•å·(â€˜)æˆ– åŒå¼•å·(â€œ)è¡¨ç¤º.Hive åœ¨ strings ä¸­ä½¿ç”¨ C-style è½¬ä¹‰ã€‚Varchar ä½¿ç”¨é•¿åº¦è¯´æ˜ç¬¦(ä»‹äº 1 å’Œ 65535 ä¹‹é—´)åˆ›å»º Varchar ç±»å‹ï¼Œè¯¥é•¿åº¦è¯´æ˜ç¬¦å®šä¹‰å­—ç¬¦ string ä¸­å…è®¸çš„æœ€å¤§å­—ç¬¦æ•°ã€‚å¦‚æœvarchar valueè¶…è¿‡äº†é•¿åº¦è¯´æ˜ç¬¦ï¼Œåˆ™ä¼šä»¥é™é»˜æ–¹å¼æˆªæ–­ stringã€‚å­—ç¬¦é•¿åº¦ç”±å­—ç¬¦ ä¸²ä¸­åŒ…å«çš„å­—ç¬¦æ•°å†³å®šã€‚ä¸ string ä¸€æ ·ï¼Œå°¾éšç©ºæ ¼åœ¨ varchar ä¸­å¾ˆé‡è¦ï¼Œä¼šå½±å“æ¯”è¾ƒç»“æœã€‚Char ç±»å‹ä¸ Varchar ç±»ä¼¼ï¼Œä½†å®ƒä»¬æ˜¯å›ºå®šé•¿åº¦æ„å‘³ç€çŸ­äºæŒ‡å®šé•¿åº¦ value çš„å€¼ç”¨ç©ºæ ¼å¡«å……ï¼Œä½†å°¾éƒ¨ç©ºæ ¼åœ¨æ¯”è¾ƒæœŸé—´ä¸å½±å“æ¯”è¾ƒã€‚æœ€å¤§é•¿åº¦å›ºå®šä¸º 255ã€‚å…³äºæ—¶é—´ç±»å‹ï¼šTimestampstimestampè¡¨ç¤ºUTCæ—¶é—´ï¼Œå¯ä»¥æ˜¯ä»¥ç§’ä¸ºå•ä½çš„æ•´æ•°ï¼›å¸¦ç²¾åº¦çš„æµ®ç‚¹æ•°ï¼Œæœ€å¤§ç²¾ç¡®åˆ°å°æ•°ç‚¹å9ä½ï¼Œçº³ç§’çº§ï¼›java.sql.Timestampæ ¼å¼çš„å­—ç¬¦ä¸² YYYY-MM-DD hh:mm:ss.fffffffffDateHiveä¸­çš„Dateåªæ”¯æŒYYYY-MM-DDæ ¼å¼çš„æ—¥æœŸï¼Œå…¶ä½™å†™æ³•éƒ½æ˜¯é”™è¯¯çš„ï¼Œå¦‚éœ€å¸¦ä¸Šæ—¶åˆ†ç§’ï¼Œè¯·ä½¿ç”¨timestampå¤æ‚æ•°æ®ç±»å‹ï¼šæ•°æ®ç±»å‹é‡Šä¹‰ARRAYARRAYç±»å‹æ˜¯ç”±ä¸€ç³»åˆ—ç›¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ ç»„æˆï¼Œè¿™äº›å…ƒç´ å¯ä»¥é€šè¿‡ä¸‹æ ‡æ¥è®¿é—®ã€‚æ¯”å¦‚æœ‰ä¸€ä¸ªARRAYç±»å‹çš„å˜é‡fruitsï¼Œå®ƒæ˜¯ç”±[â€˜appleâ€™,â€™orangeâ€™,â€™mangoâ€™]ç»„æˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡fruits[1]æ¥è®¿é—®å…ƒç´ orangeï¼Œå› ä¸ºARRAYç±»å‹çš„ä¸‹æ ‡æ˜¯ä»0å¼€å§‹çš„ï¼›MAPMAPåŒ…å«key-&gt;valueé”®å€¼å¯¹ï¼Œå¯ä»¥é€šè¿‡keyæ¥è®¿é—®å…ƒç´ ã€‚æ¯”å¦‚â€userlistâ€æ˜¯ä¸€ä¸ªmapç±»å‹ï¼Œå…¶ä¸­usernameæ˜¯keyï¼Œpasswordæ˜¯valueï¼›é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡userlist[â€˜usernameâ€™]æ¥å¾—åˆ°è¿™ä¸ªç”¨æˆ·å¯¹åº”çš„passwordï¼›STRUCTSTRUCTå¯ä»¥åŒ…å«ä¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ ã€‚è¿™äº›å…ƒç´ å¯ä»¥é€šè¿‡â€ç‚¹è¯­æ³•â€çš„æ–¹å¼æ¥å¾—åˆ°æ‰€éœ€è¦çš„å…ƒç´ ï¼Œæ¯”å¦‚useræ˜¯ä¸€ä¸ªSTRUCTç±»å‹ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡user.addresså¾—åˆ°è¿™ä¸ªç”¨æˆ·çš„åœ°å€ã€‚UNIONUNIONTYPE&lt;data_type, data_type, â€¦&gt;Hive DDLæ“ä½œå…³äºåº“ï¼šåˆ›å»ºåº“CREATE (DATABASE|SCHEMA) [IF NOT EXISTS] database_name[COMMENT database_comment] //å…³äºæ•°æ®å—çš„æè¿°[LOCATION hdfs_path] //æŒ‡å®šæ•°æ®åº“åœ¨HDFSä¸Šçš„å­˜å‚¨ä½ç½®[WITH DBPROPERTIES (property_name=property_value, â€¦)]; //æŒ‡å®šæ•°æ®å—å±æ€§eg: create database t1;** create database if not exists t1;** create database if not exists t1 comment â€˜comment dor t1â€™;**create database if not exists t3 with dbproperties(â€˜creatorâ€™=â€™cpeixinâ€™,â€™dateâ€™=â€™2016-04-05â€™);æŸ¥çœ‹åº“show databases;** desc database extended t1;**show create database t1;åˆ é™¤åº“** **drop database dbname;åˆ‡æ¢åº“use dbname;å…³äºè¡¨ï¼šåˆ›å»ºè¡¨ä¸‹é¢ä¸ºå®˜ç½‘ç»™å‡ºçš„å»ºè¡¨å‚æ•°ï¼š1234567891011121314CREATE [TEMPORARY] [EXTERNAL] TABLE [IF NOT EXISTS] [db_name.]table_name -- (Note: TEMPORARY available in Hive 0.14.0 and later) [(col_name data_type [column_constraint_specification] [COMMENT col_comment], ... [constraint_specification])] [COMMENT table_comment] [PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)] [CLUSTERED BY (col_name, col_name, ...) [SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS] [SKEWED BY (col_name, col_name, ...) -- (Note: Available in Hive 0.10.0 and later)] ON ((col_value, col_value, ...), (col_value, col_value, ...), ...) [STORED AS DIRECTORIES] [&lt;font&gt;&lt;&#x2F;font&gt; [ROW FORMAT row_format] [STORED AS file_format] | STORED BY &#39;storage.handler.class.name&#39; [WITH SERDEPROPERTIES (...)] -- (Note: Available in Hive 0.6.0 and later) ] [LOCATION hdfs_path]å†…éƒ¨è¡¨å’Œå¤–éƒ¨è¡¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒHiveåˆ›å»ºå†…éƒ¨è¡¨ï¼Œå…¶ä¸­æ–‡ä»¶ï¼Œå…ƒæ•°æ®å’Œç»Ÿè®¡ä¿¡æ¯ç”±å†…éƒ¨Hiveè¿›ç¨‹ç®¡ç†è¿™é‡Œæˆ‘ä»¬éœ€è¦çŸ¥é“æœ€æ ¹æœ¬çš„åŒºåˆ«å°±æ˜¯ï¼Œåœ¨åˆ é™¤å†…éƒ¨è¡¨çš„æ—¶å€™ï¼Œæ•°æ®ä¹Ÿä¼šè¢«åˆ é™¤ï¼Œè€Œå¤–éƒ¨è¡¨ä¸ä¼šã€‚STORED as å­˜å‚¨æ ¼å¼æ˜¯æŒ‡å®šæ–‡ä»¶çš„ç±»å‹ï¼Œä¿å­˜åœ¨hiveä¸­çš„æ–‡ä»¶çš„ç±»å‹æœ‰å¤šç§ï¼Œä¸€èˆ¬ç®€å•å°±ä¿å­˜ä¸ºæ–‡æœ¬æ ¼å¼ï¼Œå³TEXTFILEï¼Œä½†æ˜¯ä¼ä¸šä¸­ä¸€èˆ¬ä¸ä½¿ç”¨è¿™ç§æ ¼å¼æ¥ä¿å­˜æ•°æ®ï¼Œä¸»è¦æ˜¯å› ä¸ºæ–‡æœ¬æ ¼å¼å çš„ç©ºé—´æ¯”è¾ƒå¤§ï¼Œä¸åˆ©äºå¤§æ•°æ®åˆ†æã€‚ä¼ä¸šä¸­ä¸€èˆ¬ä½¿ç”¨ORCå’ŒPARQUETï¼ŒAVROä¸‰ç§æ–‡ä»¶ç±»å‹æ¥ä¿å­˜ï¼Œå…·ä½“çš„ä¼šåœ¨åé¢è®²è§£ã€‚ROW FORMAT DELIMITED è¡Œåˆ†éš”ç¬¦ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜ â€˜è¿™å¥çš„æ„æ€æ˜¯ä»¥ç©ºæ ¼æ¥åˆ†éš”è¡Œæ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸€è¡Œä¸­çš„æ•°æ®åªè¦é‡åˆ°ä¸€ä¸ªç©ºæ ¼å°±å¯ä»¥åˆ’åˆ†ä¸ºä¸€ä¸ªæ•°æ®ã€‚è¿™é‡Œçš„åˆ†éš”ç¬¦å¯ä»¥æ˜¯å…¶ä»–å­—ç¬¦ï¼Œæ¯”å¦‚â€,â€,â€#â€,â€|â€ç­‰ï¼Œä¸€èˆ¬åªè¦ç”¨æ•°æ®æ–‡ä»¶ä¸­å¯ä»¥åŒºåˆ†æ¯ä¸€è¡Œä¸­çš„ä¸åŒæ•°æ®å³å¯ã€‚åˆ—ä¸åˆ—ç›´æ¥çš„åˆ†éš”ç¬¦é€šå¸¸æ˜¯ä»¥æ¢è¡Œç¬¦æ¥åŒºåˆ†ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹çš„è¯­å¥æ¥æŒ‡å®šï¼š`COLLECTION ITEMS TERMINATED BY â€˜\\nâ€™ï¼Œ é€šå¸¸åˆ—ä¸åˆ—ç›´æ¥çš„åˆ†éš”ç¬¦æ˜¯ä¸éœ€è¦å†™çš„ã€‚LOCATION hdfs_path **å¯ä»¥åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™æŒ‡å®šè¯¥è¡¨æ˜ å°„åˆ°åˆ°hdfsçš„æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤æ˜¯æ˜ å°„åˆ°/user/hive/warehouseç›®å½•ä¸‹ã€‚PARTITIONED BY åˆ†åŒºä¸ºäº†å¯¹è¡¨è¿›è¡Œåˆç†çš„ç®¡ç†ä»¥åŠæé«˜æŸ¥è¯¢æ•ˆç‡ï¼ŒHiveå¯ä»¥å°†è¡¨ç»„ç»‡æˆâ€œåˆ†åŒºâ€ã€‚ä¸€ä¸ªåˆ†åŒºå®é™…ä¸Šå°±æ˜¯è¡¨ä¸‹çš„ä¸€ä¸ªç›®å½•ï¼Œä¸€ä¸ªè¡¨å¯ä»¥åœ¨å¤šä¸ªç»´åº¦ä¸Šè¿›è¡Œåˆ†åŒºï¼Œåˆ†åŒºä¹‹é—´çš„å…³ç³»å°±æ˜¯ç›®å½•æ ‘çš„å…³ç³»ã€‚é€šè¿‡PARTITIONED BYå­å¥æŒ‡å®šï¼Œåˆ†åŒºçš„é¡ºåºå†³å®šäº†è°æ˜¯çˆ¶ç›®å½•ï¼Œè°æ˜¯å­ç›®å½•ã€‚åœ¨è¿™é‡Œåˆ†åŒºåˆåˆ†ä¸º é™æ€åˆ†åŒºå’ŒåŠ¨æ€åˆ†åŒºã€‚ç®€å•çš„æ¥è¯´ï¼Œé™æ€åˆ†åŒºä¸åŠ¨æ€åˆ†åŒºçš„ä¸»è¦åŒºåˆ«åœ¨äºé™æ€åˆ†åŒºæ˜¯æ‰‹åŠ¨æŒ‡å®šï¼Œè€ŒåŠ¨æ€åˆ†åŒºæ˜¯é€šè¿‡æ•°æ®æ¥è¿›è¡Œåˆ¤æ–­ä¸‹é¢è¿›è¡Œå»ºè¡¨ï¼Œå»ºè¡¨çš„ç¤ºä¾‹ä¹Ÿä¼šå°½å¯é‡çš„ä½¿ç”¨å„ç§æ•°æ®ç±»å‹è¿›è¡Œè§£é‡Šè¯´æ˜ï¼šå»ºè¡¨å®ä¾‹ï¼š1.åˆ›å»ºæ™®é€šè¡¨ï¼Œä¸æ·»åŠ ä»»ä½•å‚æ•°**123456789101112create table t_user_details(user_name string,age tinyint,phone_number string,birth_date string,deposit_amount float,promotion_amount double,register_date date,last_login_time timestamp,user_level int,vip_flag boolean);**12345678910111213141516171819202122232425hive (test)&gt; show create table t_user_details;OKcreatetab_stmtCREATE TABLE &#96;t_user_details&#96;( &#96;user_name&#96; string, &#96;age&#96; tinyint, &#96;phone_number&#96; string, &#96;birth_date&#96; string, &#96;deposit_amount&#96; float, &#96;promotion_amount&#96; double, &#96;register_date&#96; date, &#96;last_login_time&#96; timestamp, &#96;user_level&#96; int, &#96;vip_flag&#96; boolean)ROW FORMAT SERDE &#39;org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe&#39; STORED AS INPUTFORMAT &#39;org.apache.hadoop.mapred.TextInputFormat&#39; OUTPUTFORMAT &#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;LOCATION &#39;hdfs:&#x2F;&#x2F;localhost:8020&#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;test.db&#x2F;t_user_details&#39;TBLPROPERTIES ( &#39;bucketing_version&#39;&#x3D;&#39;2&#39;, &#39;transient_lastDdlTime&#39;&#x3D;&#39;1586087852&#39;)1insert into t_user_details values (&#39;brent&#39;,27,&#39;13611111111&#39;,&#39;1993-03-14&#39;,100.91,4000.56,2016-04-05,&#39;2016-04-07 14:20:36.345&#39;,6,True),(&#39;haylee&#39;,25,&#39;13211111111&#39;,&#39;1994-03-14&#39;,130.91,40000000.56,&#39;2016-04-06&#39;,&#39;2016-04-08 14:20:36.345&#39;,6,False);è§‚å¯Ÿä»¥ä¸Šå†…å®¹ï¼Œæ˜¯é’ˆå¯¹æ²¡æœ‰è¾“å…¥ä»»ä½•å»ºè¡¨å‚æ•°çš„æƒ…å†µä¸‹ï¼Œæ‰€ç”Ÿæˆçš„ç»“æœï¼Œåœ¨show create table xxçš„ç»“æœä¸­ï¼Œä½“ç°å‡ºäº†å®Œæ•´çš„å»ºè¡¨é»˜è®¤å‚æ•°ã€‚å…³äºROW FORMAT SERDEï¼Œç”¨äºæŒ‡å®šåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è§„åˆ™ï¼Œé»˜è®¤å€¼ï¼šLazySimpleSerDeç®€å•æ¥è¯´ï¼Œå°±æ˜¯å®ƒå¸Œæœ›å¯¹äºDeserializationï¼Œååºåˆ—åŒ–ï¼Œå¯ä»¥lazyä¸€ç‚¹ã€‚å¯¹äºSerializationï¼Œåºåˆ—åŒ–ï¼Œå¯ä»¥simpleä¸€ç‚¹åœ¨æ²¡æœ‰æŒ‡å®šå­—æ®µä¹‹é—´çš„åˆ†éš”ç¬¦æ—¶ï¼Œé»˜è®¤æ˜¯ç”¨\\001 ä¸å¯è§å­—ç¬¦è¿›è¡Œåˆ†å‰²çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å»ºè¡¨çš„æ—¶å€™ä½¿ç”¨FIELDS TERMINATED BY â€˜,â€™ å‚æ•°æ¥æŒ‡å®šå­—æ®µä¹‹é—´ä½¿ç”¨é€—å·åˆ†å‰²ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ä½¿ç”¨hiveçš„æ—¶å€™ï¼Œå­˜å‚¨æ ¼å¼çš„é€‰æ‹©éå¸¸é‡è¦ï¼Œä¸åŒå­˜å‚¨æ ¼å¼ç›´æ¥åœ¨æœ€åº•å±‚å½±å“ç€ä½ çš„æ‰§è¡Œæ•ˆç‡ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†åœ¨ä¹‹åç”¨å•ç‹¬çš„ä¸€ç¯‡æ–‡ç« æ¥è¯´ã€‚è¿™é‡Œå¤§å®¶å…ˆçŸ¥é“ä¼ä¸šé‡Œé¢å¸¸ç”¨çš„ORCï¼ŒParquetï¼ŒAvroç­‰æ ¼å¼å°±å¯ä»¥äº†2.åˆ›å»ºåˆ†åŒºè¡¨**åˆ†åŒºè¡¨åœ¨æ˜¾ç¤ºå·¥ä½œä¸­éå¸¸å¸¸ç”¨ï¼Œä¾‹å¦‚é’ˆå¯¹ç½‘ç«™æ•°æ®çš„å­˜å‚¨ï¼Œç½‘ç«™æ¯å¤©äº§ç”Ÿæ•°æ®é‡è¿‡å¤§çš„è¯ï¼Œæˆ‘ä»¬ä¸èƒ½å§‹ç»ˆåœ¨è¡¨æœ«å°¾è¿›è¡Œæ•°æ®çš„è¿½åŠ ï¼Œè€Œæ˜¯åº”è¯¥åˆ©ç”¨åŠ¨æ€åˆ†åŒºæˆ–è€…é™æ€åˆ†åŒºï¼ŒæŒ‰æœˆï¼ŒæŒ‰å¤©çš„ç²’åº¦è¿›è¡Œåˆ†åŒºå­˜å‚¨123456789101112131415161718192021222324CREATE TABLE &#96;t_user_detail_partition&#96;( user_name string, age tinyint, phone_number string, birth_date string, deposit_amount float, promotion_amount double, register_date date, last_login_time timestamp, user_level int, vip_flag boolean)PARTITIONED BY ( &#96;snapshot_date&#96; string)ROW FORMAT SERDE &#39;org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe&#39; WITH SERDEPROPERTIES ( &#39;field.delim&#39;&#x3D;&#39;\\u0001&#39;, &#39;line.delim&#39;&#x3D;&#39;\\n&#39;, &#39;serialization.format&#39;&#x3D;&#39;\\u0001&#39;) STORED AS INPUTFORMAT &#39;org.apache.hadoop.mapred.TextInputFormat&#39; OUTPUTFORMAT &#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;;1insert into t_user_detail_partition values (&#39;brent&#39;,27,&#39;13611111111&#39;,&#39;1993-03-14&#39;,100.91,4000.56,2016-04-05,&#39;2016-04-07 14:20:36.345&#39;,6,True,&#39;2016-04-04&#39;),(&#39;haylee&#39;,25,&#39;13211111111&#39;,&#39;1994-03-14&#39;,130.91,40000000.56,&#39;2016-04-06&#39;,&#39;2016-04-08 14:20:36.345&#39;,6,False,&#39;2016-04-05&#39;);ä¸Šé¢çš„å»ºè¡¨è¯­å¥ä½¿ç”¨ PARTITIONED BY æŒ‡å®šäº† snapshot_date ä¸ºåˆ†åŒºå­—æ®µï¼Œå½“ç„¶ä½ è¿˜å¯ä»¥å†æ·»åŠ åˆ†åŒºå­—æ®µï¼Œhiveæ”¯æŒå¤šåˆ†åŒºï¼Œç†è®ºä¸Šæœ€å¤šæ”¯æŒ8çº§åˆ†åŒºåœ¨æ’å…¥æ•°æ®çš„è¯­å¥ä¸­ï¼Œå°†åˆ†åŒºå­—æ®µçš„å€¼é¡ºåºçš„å†™åœ¨è¡¨ä¸­å­—æ®µå€¼çš„åé¢ï¼Œåˆ™å¯ä»¥æŒ‰ç…§åˆ†åŒºè¿›è¡Œæ’å…¥æ•°æ®ã€‚åœ¨hdfsä¸­ï¼Œt_user_detail_partitionè¡¨åˆ™æŒ‰ç…§åˆ†åŒºå­—æ®µè¿›è¡Œåˆ’åˆ†ï¼Œå°†æ•°æ®å­˜å‚¨åˆ°ä¸åŒçš„åˆ†åŒºç›®å½•ä¸‹ã€‚Hiveä¸­çš„åˆ†åŒºæ˜¯ä½¿ç”¨çš„è¡¨å¤–å­—æ®µï¼ŒMySQLä½¿ç”¨çš„æ˜¯è¡¨å†…å­—æ®µé™æ€åˆ†åŒºå’ŒåŠ¨æ€åˆ†åŒºåœ¨åˆ›å»ºè¡¨æ—¶ï¼Œè¯­å¥æ˜¯ä¸€æ ·çš„ã€‚åªæ˜¯åœ¨èµ‹å€¼çš„æ—¶å€™æœ‰åŒºåˆ«åŠ¨æ€åˆ†åŒºå’Œé™æ€åˆ†åŒºçš„åŒºåˆ«åŠ è½½æ•°æ®çš„æ–¹å¼ï¼šé™æ€åˆ†åŒºå¯ä»¥é€šè¿‡loadå‘½ä»¤ï¼Œå‘ä¸åŒçš„åˆ†åŒºåŠ è½½æ•°æ®ï¼ŒåŠ è½½æ•°æ®æ—¶è¦æŒ‡å®šåˆ†åŒºçš„å€¼ï¼›é™æ€åˆ†åŒºåªèƒ½é€šè¿‡selectåŠ è½½æ•°æ®ï¼Œå¹¶ä¸”ä¸éœ€è¦æŒ‡å®šåˆ†åŒºçš„åå­—ï¼Œè€Œæ˜¯æ ¹æ®ä¼ªåˆ—çš„å€¼ï¼ŒåŠ¨æ€çš„ç¡®å®šåˆ†åŒºå€¼ç¡®å®šåˆ†åŒºå€¼çš„æ–¹å¼ï¼šä¸¤è€…åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™å‘½ä»¤å®Œå…¨ä¸€è‡´ï¼Œåªæ˜¯åœ¨ç¡®å®šåˆ†åŒºå€¼çš„æ—¶å€™ä¸åŒï¼Œé™æ€åˆ†åŒºéœ€è¦æ‰‹åŠ¨æŒ‡å®šåˆ†åŒºå€¼ï¼Œè€ŒåŠ¨æ€åˆ†åŒºä¼šè‡ªåŠ¨è¯†åˆ«ä¼ªåˆ—çš„å±æ€§ï¼ŒåŠ¨æ€ç”Ÿæˆåˆ†åŒºå€¼_åŠ¨æ€åˆ†åŒºæ’å…¥_ï¼ˆæˆ–å¤šåˆ†åŒºæ’å…¥ï¼‰æ—¨åœ¨é€šè¿‡åŠ¨æ€ç¡®å®šåœ¨æ‰«æè¾“å…¥è¡¨æ—¶åº”åˆ›å»ºå’Œå¡«å……å“ªäº›åˆ†åŒºæ¥è§£å†³æ­¤é—®é¢˜ã€‚è¿™æ˜¯æ–°å¢åŠŸèƒ½ï¼Œä»…ä»0.6.0ç‰ˆæœ¬å¼€å§‹å¯ç”¨ã€‚åœ¨åŠ¨æ€åˆ†åŒºæ’å…¥ä¸­ï¼Œå°†è¯„ä¼°è¾“å…¥åˆ—çš„å€¼ï¼Œä»¥ç¡®å®šåº”å°†æ­¤è¡Œæ’å…¥å“ªä¸ªåˆ†åŒºã€‚å¦‚æœå°šæœªåˆ›å»ºè¯¥åˆ†åŒºï¼Œå®ƒå°†è‡ªåŠ¨åˆ›å»ºè¯¥åˆ†åŒºã€‚ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œæ‚¨åªéœ€ä¸€ä¸ªæ’å…¥è¯­å¥å³å¯åˆ›å»ºå¹¶å¡«å……æ‰€æœ‰å¿…è¦çš„åˆ†åŒºã€‚å¦å¤–ï¼Œç”±äºåªæœ‰ä¸€ä¸ªinsertè¯­å¥ï¼Œå› æ­¤åªæœ‰ä¸€ä¸ªå¯¹åº”çš„MapReduceä½œä¸šã€‚ä¸å¤šæ¬¡æ’å…¥çš„æƒ…å†µç›¸æ¯”ï¼Œè¿™æ˜¾ç€æé«˜äº†æ€§èƒ½å¹¶å‡å°‘äº†Hadoopé›†ç¾¤çš„å·¥ä½œé‡ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ä¸€ä¸ªæ’å…¥è¯­å¥å°†æ•°æ®åŠ è½½åˆ°æ‰€æœ‰å›½å®¶/åœ°åŒºåˆ†åŒºçš„ç¤ºä¾‹ï¼š123FROM page_view_stg pvsINSERT OVERWRITE TABLE page_view PARTITION(dt='2008-06-08', country) SELECT pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, null, null, pvs.ip, pvs.countryåˆ›å»ºParquetæ ¼å¼ï¼Œsnappyå‹ç¼©Hiveè¡¨12345678CREATE TABLE t_user_behavior ( user_id bigint, good_id bigint, good_category_id bigint, behavior_type string, timestamps timestamp)partitioned by (snapshot_date string)STORED AS PARQUET TBLPROPERTIES('parquet.compression'='SNAPPY');ä¸è¦å¿˜è®°åŠ å‚æ•°1234567891011121314151617val spark: SparkSession = SparkSession .builder() .master(\"local\") .appName(\"login_data_2_hive\") .config(\"spark.sql.session.timeZone\", \"UTC\") .config(\"spark.serializer\",\"org.apache.spark.serializer.KryoSerializer\") .config(\"hive.exec.dynamici.partition\",true) .config(\"hive.exec.dynamic.partition.mode\",\"nonstrict\") .enableHiveSupport() .getOrCreate()user_behavior_dataframe .write .format(\"Hive\") .mode(SaveMode.Overwrite) .partitionBy(\"snapshot_date\") .saveAsTable(\"test.t_user_behavior\") #### æµè§ˆè¡¨å’Œåˆ†åŒº123456789101112131415161718SHOW TABLES;åˆ—å‡ºä»“åº“ä¸­çš„ç°æœ‰è¡¨ï¼›å…¶ä¸­æœ‰å¾ˆå¤šï¼Œå¯èƒ½æ¯”æ‚¨æƒ³è¦æµè§ˆçš„æ›´å¤šã€‚SHOW TABLES 'page.*';åˆ—å‡ºå‰ç¼€ä¸ºâ€œ pageâ€çš„è¡¨ã€‚è¯¥æ¨¡å¼éµå¾ªJavaæ­£åˆ™è¡¨è¾¾å¼è¯­æ³•ï¼ˆå› æ­¤å¥ç‚¹æ˜¯é€šé…ç¬¦ï¼‰ã€‚SHOW PARTITIONS page_view;åˆ—å‡ºè¡¨åˆ†åŒºã€‚å¦‚æœè¯¥è¡¨ä¸æ˜¯åˆ†åŒºè¡¨ï¼Œåˆ™ä¼šå¼•å‘é”™è¯¯ã€‚DESCRIBE page_view;åˆ—å‡ºè¡¨çš„åˆ—å’Œåˆ—ç±»å‹ã€‚DESCRIBE EXTENDED page_view;åˆ—å‡ºè¡¨çš„åˆ—å’Œæ‰€æœ‰å…¶ä»–å±æ€§ã€‚è¿™ä¼šæ‰“å°å¾ˆå¤šä¿¡æ¯ï¼Œä½†ä¹Ÿä¸ä¼šä»¥æ¼‚äº®çš„æ ¼å¼æ˜¾ç¤ºã€‚é€šå¸¸ç”¨äºè°ƒè¯•ã€‚DESCRIBE EXTENDED page_view PARTITION (ds='2008-08-08');åˆ—å‡ºåˆ†åŒºçš„åˆ—å’Œæ‰€æœ‰å…¶ä»–å±æ€§ã€‚è¿™è¿˜ä¼šæ‰“å°å¾ˆå¤šé€šå¸¸ç”¨äºè°ƒè¯•çš„ä¿¡æ¯ã€‚ä¿®æ”¹è¡¨1234567891011å°†ç°æœ‰è¡¨é‡å‘½åä¸ºæ–°åç§°ã€‚å¦‚æœå…·æœ‰æ–°åç§°çš„è¡¨å·²ç»å­˜åœ¨ï¼Œåˆ™è¿”å›é”™è¯¯ï¼šALTER TABLE old_table_name RENAME TO new_table_name;é‡å‘½åç°æœ‰è¡¨çš„åˆ—ã€‚ç¡®ä¿ä½¿ç”¨ç›¸åŒçš„åˆ—ç±»å‹ï¼Œå¹¶ä¸ºæ¯ä¸ªç°æœ‰åˆ—åŒ…æ‹¬ä¸€ä¸ªæ¡ç›®ï¼šALTER TABLE old_table_name REPLACE COLUMNS (col1 TYPE, ...);è¦å°†åˆ—æ·»åŠ åˆ°ç°æœ‰è¡¨ï¼šALTER TABLE tab1 ADD COLUMNS (c1 INT COMMENT 'a new int column', c2 STRING DEFAULT 'def val');è¯·æ³¨æ„ï¼Œæ¶æ„æ›´æ”¹ï¼ˆä¾‹å¦‚æ·»åŠ åˆ—ï¼‰ä¼šä¿ç•™è¡¨çš„æ—§åˆ†åŒºçš„æ¶æ„ï¼Œä»¥é˜²å®ƒæ˜¯åˆ†åŒºè¡¨ã€‚æ‰€æœ‰è®¿é—®è¿™äº›åˆ—å¹¶åœ¨æ—§åˆ†åŒºä¸Šè¿è¡Œçš„æŸ¥è¯¢éƒ½éšå¼è¿”å›è¿™äº›åˆ—çš„ç©ºå€¼æˆ–æŒ‡å®šçš„é»˜è®¤å€¼ã€‚åœ¨ä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœåœ¨ç‰¹å®šåˆ†åŒºä¸­æœªæ‰¾åˆ°è¯¥åˆ—ï¼Œåˆ™å¯ä»¥ä½¿æŸäº›è¡Œä¸ºå…·æœ‰å‡è®¾å€¼ï¼Œè€Œä¸æ˜¯æŠ›å‡ºé”™è¯¯ã€‚åˆ é™¤è¡¨å’Œåˆ†åŒº1234567åˆ é™¤è¡¨ç›¸å½“ç®€å•ã€‚å°†è¯¥è¡¨æ”¾ä¸‹å°†éšå¼åˆ é™¤è¯¥è¡¨ä¸Šå·²å»ºç«‹çš„æ‰€æœ‰ç´¢å¼•ï¼ˆè¿™æ˜¯å°†æ¥çš„åŠŸèƒ½ï¼‰ã€‚å…³è”çš„å‘½ä»¤æ˜¯ï¼šDROP TABLE pv_users;åˆ é™¤åˆ†åŒºã€‚æ›´æ”¹è¡¨ä»¥åˆ é™¤åˆ†åŒºã€‚ALTER TABLE pv_users DROP PARTITION (ds='2008-08-08') è¯·æ³¨æ„ï¼Œæ­¤è¡¨æˆ–åˆ†åŒºçš„ä»»ä½•æ•°æ®éƒ½å°†è¢«åˆ é™¤å¹¶ä¸”å¯èƒ½æ— æ³•æ¢å¤ã€‚ ### Hive DMLæ“ä½œåŠ è½½æ–‡ä»¶æ•°æ®åˆ°è¡¨123LOAD DATA [LOCAL] INPATH &#39;filepath&#39; [OVERWRITE] INTO TABLE tablename [PARTITION (partcol1&#x3D;val1, partcol2&#x3D;val2 ...)]å¤åˆ¶ä»£ç LOCAL å…³é”®å­—ä»£è¡¨ä»æœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŠ è½½æ–‡ä»¶ï¼Œçœç•¥åˆ™ä»£è¡¨ä» HDFS ä¸ŠåŠ è½½æ–‡ä»¶ï¼šä»æœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŠ è½½æ–‡ä»¶æ—¶ï¼Œ filepath å¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ (å»ºè®®ä½¿ç”¨ç»å¯¹è·¯å¾„)ï¼›ä» HDFS åŠ è½½æ–‡ä»¶æ—¶å€™ï¼Œfilepath ä¸ºæ–‡ä»¶å®Œæ•´çš„ URL åœ°å€ï¼šå¦‚ hdfs://namenode:port/user/hive/project/ data1filepath å¯ä»¥æ˜¯æ–‡ä»¶è·¯å¾„ (åœ¨è¿™ç§æƒ…å†µä¸‹ Hive ä¼šå°†æ–‡ä»¶ç§»åŠ¨åˆ°è¡¨ä¸­)ï¼Œä¹Ÿå¯ä»¥ç›®å½•è·¯å¾„ (åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒHive ä¼šå°†è¯¥ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ç§»åŠ¨åˆ°è¡¨ä¸­)ï¼›å¦‚æœä½¿ç”¨ OVERWRITE å…³é”®å­—ï¼Œåˆ™å°†åˆ é™¤ç›®æ ‡è¡¨ï¼ˆæˆ–åˆ†åŒºï¼‰çš„å†…å®¹ï¼Œä½¿ç”¨æ–°çš„æ•°æ®å¡«å……ï¼›ä¸ä½¿ç”¨æ­¤å…³é”®å­—ï¼Œåˆ™æ•°æ®ä»¥è¿½åŠ çš„æ–¹å¼åŠ å…¥ï¼›åŠ è½½çš„ç›®æ ‡å¯ä»¥æ˜¯è¡¨æˆ–åˆ†åŒºã€‚å¦‚æœæ˜¯åˆ†åŒºè¡¨ï¼Œåˆ™å¿…é¡»æŒ‡å®šåŠ è½½æ•°æ®çš„åˆ†åŒºï¼›åŠ è½½æ–‡ä»¶çš„æ ¼å¼å¿…é¡»ä¸å»ºè¡¨æ—¶ä½¿ç”¨ STORED AS æŒ‡å®šçš„å­˜å‚¨æ ¼å¼ç›¸åŒã€‚æŸ¥è¯¢ç»“æœæ’å…¥åˆ°è¡¨12345INSERT OVERWRITE TABLE tablename1 [PARTITION (partcol1&#x3D;val1, partcol2&#x3D;val2 ...) [IF NOT EXISTS]] select_statement1 FROM from_statement;INSERT INTO TABLE tablename1 [PARTITION (partcol1&#x3D;val1, partcol2&#x3D;val2 ...)] select_statement1 FROM from_statement;å¤åˆ¶ä»£ç Hive 0.13.0 å¼€å§‹ï¼Œå»ºè¡¨æ—¶å¯ä»¥é€šè¿‡ä½¿ç”¨ TBLPROPERTIESï¼ˆâ€œimmutableâ€=â€œtrueâ€ï¼‰æ¥åˆ›å»ºä¸å¯å˜è¡¨ (immutable table) ï¼Œå¦‚æœä¸å¯ä»¥å˜è¡¨ä¸­å­˜åœ¨æ•°æ®ï¼Œåˆ™ INSERT INTO å¤±è´¥ã€‚ï¼ˆæ³¨ï¼šINSERT OVERWRITE çš„è¯­å¥ä¸å— immutable å±æ€§çš„å½±å“ï¼‰;å¯ä»¥å¯¹è¡¨æˆ–åˆ†åŒºæ‰§è¡Œæ’å…¥æ“ä½œã€‚å¦‚æœè¡¨å·²åˆ†åŒºï¼Œåˆ™å¿…é¡»é€šè¿‡æŒ‡å®šæ‰€æœ‰åˆ†åŒºåˆ—çš„å€¼æ¥æŒ‡å®šè¡¨çš„ç‰¹å®šåˆ†åŒºï¼›ä» Hive 1.1.0 å¼€å§‹ï¼ŒTABLE å…³é”®å­—æ˜¯å¯é€‰çš„ï¼›ä» Hive 1.2.0 å¼€å§‹ ï¼Œå¯ä»¥é‡‡ç”¨ INSERT INTO tablename(zï¼Œxï¼Œc1) æŒ‡æ˜æ’å…¥åˆ—ï¼›å¯ä»¥å°† SELECT è¯­å¥çš„æŸ¥è¯¢ç»“æœæ’å…¥å¤šä¸ªè¡¨ï¼ˆæˆ–åˆ†åŒºï¼‰ï¼Œç§°ä¸ºå¤šè¡¨æ’å…¥ã€‚è¯­æ³•å¦‚ä¸‹ï¼š12345FROM from_statementINSERT OVERWRITE TABLE tablename1 [PARTITION (partcol1&#x3D;val1, partcol2&#x3D;val2 ...) [IF NOT EXISTS]] select_statement1[INSERT OVERWRITE TABLE tablename2 [PARTITION ... [IF NOT EXISTS]] select_statement2][INSERT INTO TABLE tablename2 [PARTITION ...] select_statement2] ...;**åŠ¨æ€æ’å…¥åˆ†åŒº****12345INSERT OVERWRITE TABLE tablename PARTITION (partcol1[&#x3D;val1], partcol2[&#x3D;val2] ...) select_statement FROM from_statement;INSERT INTO TABLE tablename PARTITION (partcol1[&#x3D;val1], partcol2[&#x3D;val2] ...) select_statement FROM from_statement;å¤åˆ¶ä»£ç åœ¨å‘åˆ†åŒºè¡¨æ’å…¥æ•°æ®æ—¶å€™ï¼Œåˆ†åŒºåˆ—åæ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯åˆ—å€¼æ˜¯å¯é€‰çš„ã€‚å¦‚æœç»™å‡ºäº†åˆ†åŒºåˆ—å€¼ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸ºé™æ€åˆ†åŒºï¼Œå¦åˆ™å®ƒæ˜¯åŠ¨æ€åˆ†åŒºã€‚åŠ¨æ€åˆ†åŒºåˆ—å¿…é¡»åœ¨ SELECT è¯­å¥çš„åˆ—ä¸­æœ€åæŒ‡å®šï¼Œå¹¶ä¸”ä¸å®ƒä»¬åœ¨ PARTITION() å­å¥ä¸­å‡ºç°çš„é¡ºåºç›¸åŒã€‚æ³¨æ„ï¼šHive 0.9.0 ä¹‹å‰çš„ç‰ˆæœ¬åŠ¨æ€åˆ†åŒºæ’å…¥æ˜¯é»˜è®¤ç¦ç”¨çš„ï¼Œè€Œ 0.9.0 ä¹‹åçš„ç‰ˆæœ¬åˆ™é»˜è®¤å¯ç”¨ã€‚ä½¿ç”¨SQLè¯­å¥æ’å…¥å€¼123INSERT INTO TABLE tablename [PARTITION (partcol1[&#x3D;val1], partcol2[&#x3D;val2] ...)] VALUES ( value [, value ...] )å¤åˆ¶ä»£ç ä½¿ç”¨æ—¶å¿…é¡»ä¸ºè¡¨ä¸­çš„æ¯ä¸ªåˆ—éƒ½æä¾›å€¼ã€‚ä¸æ”¯æŒåªå‘éƒ¨åˆ†åˆ—æ’å…¥å€¼ï¼ˆå¯ä»¥ä¸ºç¼ºçœå€¼çš„åˆ—æä¾›ç©ºå€¼æ¥æ¶ˆé™¤è¿™ä¸ªå¼Šç«¯ï¼‰ï¼›å¦‚æœç›®æ ‡è¡¨è¡¨æ”¯æŒ ACID åŠå…¶äº‹åŠ¡ç®¡ç†å™¨ï¼Œåˆ™æ’å…¥åè‡ªåŠ¨æäº¤ï¼›ä¸æ”¯æŒæ”¯æŒå¤æ‚ç±»å‹ (array, map, struct, union) çš„æ’å…¥ã€‚æ›´æ–°å’Œåˆ é™¤æ•°æ®æ›´æ–°å’Œåˆ é™¤çš„è¯­æ³•æ¯”è¾ƒç®€å•ï¼Œå’Œå…³ç³»å‹æ•°æ®åº“ä¸€è‡´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸¤ä¸ªæ“ä½œéƒ½åªèƒ½åœ¨æ”¯æŒ ACID çš„è¡¨ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡è¡¨ä¸Šæ‰èƒ½æ‰§è¡Œã€‚1234-- æ›´æ–°UPDATE tablename SET column &#x3D; value [, column &#x3D; value ...] [WHERE expression]--åˆ é™¤DELETE FROM tablename [WHERE expression]æŸ¥è¯¢ç»“æœå†™å‡ºåˆ°æ–‡ä»¶ç³»ç»Ÿ1234INSERT OVERWRITE [LOCAL] DIRECTORY directory1 [ROW FORMAT row_format] [STORED AS file_format] SELECT ... FROM ...å¤åˆ¶ä»£ç OVERWRITE å…³é”®å­—è¡¨ç¤ºè¾“å‡ºæ–‡ä»¶å­˜åœ¨æ—¶ï¼Œå…ˆåˆ é™¤åå†é‡æ–°å†™å…¥ï¼›å’Œ Load è¯­å¥ä¸€æ ·ï¼Œå»ºè®®æ— è®ºæ˜¯æœ¬åœ°è·¯å¾„è¿˜æ˜¯ URL åœ°å€éƒ½ä½¿ç”¨å®Œæ•´çš„ï¼›å†™å…¥æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®è¢«åºåˆ—åŒ–ä¸ºæ–‡æœ¬ï¼Œå…¶ä¸­åˆ—é»˜è®¤ç”±^A åˆ†éš”ï¼Œè¡Œç”±æ¢è¡Œç¬¦åˆ†éš”ã€‚å¦‚æœåˆ—ä¸æ˜¯åŸºæœ¬ç±»å‹ï¼Œåˆ™å°†å…¶åºåˆ—åŒ–ä¸º JSON æ ¼å¼ã€‚å…¶ä¸­è¡Œåˆ†éš”ç¬¦ä¸å…è®¸è‡ªå®šä¹‰ï¼Œä½†åˆ—åˆ†éš”ç¬¦å¯ä»¥è‡ªå®šä¹‰ï¼Œå¦‚ä¸‹ï¼š1234567-- å®šä¹‰åˆ—åˆ†éš”ç¬¦ä¸º&#39;\\t&#39; insert overwrite local directory &#39;.&#x2F;test-04&#39; row format delimited FIELDS TERMINATED BY &#39;\\t&#39;COLLECTION ITEMS TERMINATED BY &#39;,&#39;MAP KEYS TERMINATED BY &#39;:&#39;select * from src;","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"hive","slug":"hive","permalink":"cpeixin.cn/tags/hive/"}]},{"title":"Hive åˆè¯†","slug":"Hive-åˆè¯†","date":"2016-10-15T14:11:24.000Z","updated":"2020-04-05T14:32:53.687Z","comments":true,"path":"2016/10/15/Hive-åˆè¯†/","link":"","permalink":"cpeixin.cn/2016/10/15/Hive-%E5%88%9D%E8%AF%86/","excerpt":"","text":"What - Hivehiveæ˜¯åŸºäºHadoopçš„ä¸€ä¸ªæ•°æ®ä»“åº“å·¥å…·ï¼Œç”¨æ¥è¿›è¡Œæ•°æ®æå–ã€è½¬åŒ–ã€åŠ è½½ï¼Œè¿™æ˜¯ä¸€ç§å¯ä»¥å­˜å‚¨ã€æŸ¥è¯¢å’Œåˆ†æå­˜å‚¨åœ¨Hadoopä¸­çš„å¤§è§„æ¨¡æ•°æ®çš„æœºåˆ¶ã€‚hiveæ•°æ®ä»“åº“å·¥å…·èƒ½å°†ç»“æ„åŒ–çš„æ•°æ®æ–‡ä»¶æ˜ å°„ä¸ºä¸€å¼ æ•°æ®åº“è¡¨ï¼Œå¹¶æä¾›SQLæŸ¥è¯¢åŠŸèƒ½ï¼Œèƒ½å°†SQLè¯­å¥è½¬å˜æˆMapReduceä»»åŠ¡æ¥æ‰§è¡Œã€‚Why - HiveHiveæœ€åˆæ˜¯Facebookä¸ºäº†æ»¡è¶³å¯¹æµ·é‡ç¤¾äº¤ç½‘ç»œæ•°æ®çš„ç®¡ç†å’Œæœºå™¨å­¦ä¹ çš„éœ€æ±‚è€Œäº§ç”Ÿå’Œå‘å±•çš„ã€‚å¤§æ•°æ®æ˜¯ç°åœ¨äº’è”ç½‘çš„è¶‹åŠ¿ï¼Œè€Œhadoopå°±æ˜¯å¤§æ•°æ®æ—¶ä»£é‡Œçš„æ ¸å¿ƒæŠ€æœ¯ï¼Œä½†æ˜¯hadoopçš„mapreduceæ“ä½œä¸“ä¸šæ€§å¤ªå¼ºï¼Œæ‰€ä»¥facebookåœ¨è¿™äº›åŸºç¡€ä¸Šå¼€å‘äº†hiveæ¡†æ¶ï¼Œä¸šåŠ¡äººå‘˜åœ¨ä¸å­¦ä¹ ç¼–ç¨‹è¯­è¨€çš„æƒ…å†µä¸‹ï¼Œåªè¦å­¦ä¼šåŸºæœ¬çš„SQLè¯­å¥ï¼Œå°±å¯ä»¥å¯¹å¤§æ•°æ®å¹³å°çš„æ•°æ®è¿›è¡Œåˆ†æã€‚How - Hiveåœ¨hadoopé›†ç¾¤ä¸­ï¼Œå®‰è£…é…ç½®å¥½hiveï¼Œå°±å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ç›´æ¥è¾“å…¥hiveï¼Œè¿›å…¥hiveå®¢æˆ·ç«¯æ¥ä¸‹æ¥çš„æ“ä½œå°±å’Œæ“ä½œæ•°æ®åº“çš„SQLå‡ ä¹ä¸€æ ·ã€‚å…·ä½“æ“ä½œå°†åœ¨åé¢çš„æ–‡ç« é‡Œè¿›è¡Œä»‹ç»ã€‚Hive - ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼šç®€å•å®¹æ˜“ä¸Šæ‰‹ï¼šæä¾›äº†ç±»SQLæŸ¥è¯¢è¯­è¨€HQLå¯æ‰©å±•ï¼šä¸ºè¶…å¤§æ•°æ®é›†è®¾è®¡äº†è®¡ç®—/æ‰©å±•èƒ½åŠ›ï¼ˆMRä½œä¸ºè®¡ç®—å¼•æ“ï¼ŒHDFSä½œä¸ºå­˜å‚¨ç³»ç»Ÿï¼ŒYarnä½œä¸ºèµ„æºè°ƒåº¦ï¼‰æä¾›ç»Ÿä¸€çš„å…ƒæ•°æ®ç®¡ç†å»¶å±•æ€§ï¼šHiveæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥å®ç°è‡ªå·±çš„å‡½æ•°å®¹é”™ï¼šè‰¯å¥½çš„å®¹é”™æ€§ï¼ŒèŠ‚ç‚¹å‡ºç°é—®é¢˜SQLä»å¯å®Œæˆæ‰§è¡Œæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ç¼ºç‚¹ï¼šhiveçš„HQLè¡¨è¾¾èƒ½åŠ›æœ‰é™hiveçš„æ•ˆç‡æ¯”è¾ƒä½ï¼ˆåé¢å¯ç”¨sparkè®¡ç®—æ¡†æ¶ä»£æ›¿Hiveåˆ†æï¼‰hiveè°ƒä¼˜æ¯”è¾ƒå›°éš¾ï¼Œç²’åº¦è¾ƒç²—Hive - æ¶æ„","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"hive","slug":"hive","permalink":"cpeixin.cn/tags/hive/"}]},{"title":"HDFS-ä¸‰æ€","slug":"HDFS-ä¸‰æ€","date":"2016-10-06T07:30:21.000Z","updated":"2020-04-04T17:25:03.805Z","comments":true,"path":"2016/10/06/HDFS-ä¸‰æ€/","link":"","permalink":"cpeixin.cn/2016/10/06/HDFS-%E4%B8%89%E6%80%9D/","excerpt":"","text":"è¯»å†™æµç¨‹å†™æµç¨‹å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼šClient è°ƒç”¨ DistributedFileSystem å¯¹è±¡çš„ create æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶è¾“å‡ºæµï¼ˆFSDataOutputStreamï¼‰å¯¹è±¡ï¼›é€šè¿‡ DistributedFileSystem å¯¹è±¡ä¸é›†ç¾¤çš„ NameNode è¿›è¡Œä¸€æ¬¡ RPC è¿œç¨‹è°ƒç”¨ï¼Œåœ¨ HDFS çš„ Namespace ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ¡ç›®ï¼ˆEntryï¼‰ï¼Œæ­¤æ—¶è¯¥æ¡ç›®æ²¡æœ‰ä»»ä½•çš„ Blockï¼ŒNameNode ä¼šè¿”å›è¯¥æ•°æ®æ¯ä¸ªå—éœ€è¦æ‹·è´çš„ DataNode åœ°å€ä¿¡æ¯ï¼›é€šè¿‡ FSDataOutputStream å¯¹è±¡ï¼Œå¼€å§‹å‘ DataNode å†™å…¥æ•°æ®ï¼Œæ•°æ®é¦–å…ˆè¢«å†™å…¥ FSDataOutputStream å¯¹è±¡å†…éƒ¨çš„æ•°æ®é˜Ÿåˆ—ä¸­ï¼Œæ•°æ®é˜Ÿåˆ—ç”± DataStreamer ä½¿ç”¨ï¼Œå®ƒé€šè¿‡é€‰æ‹©åˆé€‚çš„ DataNode åˆ—è¡¨æ¥å­˜å‚¨å‰¯æœ¬ï¼Œä»è€Œè¦æ±‚ NameNode åˆ†é…æ–°çš„ blockï¼›DataStreamer å°†æ•°æ®åŒ…ä»¥æµå¼ä¼ è¾“çš„æ–¹å¼ä¼ è¾“åˆ°åˆ†é…çš„ç¬¬ä¸€ä¸ª DataNode ä¸­ï¼Œè¯¥æ•°æ®æµå°†æ•°æ®åŒ…å­˜å‚¨åˆ°ç¬¬ä¸€ä¸ª DataNode ä¸­å¹¶å°†å…¶è½¬å‘åˆ°ç¬¬äºŒä¸ª DataNode ä¸­ï¼Œæ¥ç€ç¬¬äºŒä¸ª DataNode èŠ‚ç‚¹ä¼šå°†æ•°æ®åŒ…è½¬å‘åˆ°ç¬¬ä¸‰ä¸ª DataNode èŠ‚ç‚¹ï¼›DataNode ç¡®è®¤æ•°æ®ä¼ è¾“å®Œæˆï¼Œæœ€åç”±ç¬¬ä¸€ä¸ª DataNode é€šçŸ¥ client æ•°æ®å†™å…¥æˆåŠŸï¼›å®Œæˆå‘æ–‡ä»¶å†™å…¥æ•°æ®ï¼ŒClient åœ¨æ–‡ä»¶è¾“å‡ºæµï¼ˆFSDataOutputStreamï¼‰å¯¹è±¡ä¸Šè°ƒç”¨ close æ–¹æ³•ï¼Œå®Œæˆæ–‡ä»¶å†™å…¥ï¼›è°ƒç”¨ DistributedFileSystem å¯¹è±¡çš„ complete æ–¹æ³•ï¼Œé€šçŸ¥ NameNode æ–‡ä»¶å†™å…¥æˆåŠŸï¼ŒNameNode ä¼šå°†ç›¸å…³ç»“æœè®°å½•åˆ° editlog ä¸­ã€‚**è¯»æµç¨‹**![p2.gif](https://cdn.nlark.com/yuque/0/2020/gif/1072113/1586020955556-6aa55757-4f0d-4d46-91bb-90e9963517fd.gif#align=left&display=inline&height=541&name=p2.gif&originHeight=541&originWidth=960&size=1319443&status=done&style=none&width=960)å…·ä½“è¿‡ç¨‹ï¼šClient é€šè¿‡ DistributedFileSystem å¯¹è±¡ä¸é›†ç¾¤çš„ NameNode è¿›è¡Œä¸€æ¬¡ RPC è¿œç¨‹è°ƒç”¨ï¼Œè·å–æ–‡ä»¶ block ä½ç½®ä¿¡æ¯ï¼›NameNode è¿”å›å­˜å‚¨çš„æ¯ä¸ªå—çš„ DataNode åˆ—è¡¨ï¼›Client å°†è¿æ¥åˆ°åˆ—è¡¨ä¸­æœ€è¿‘çš„ DataNodeï¼›Client å¼€å§‹ä» DataNode å¹¶è¡Œè¯»å–æ•°æ®ï¼›ä¸€æ—¦ Client è·å¾—äº†æ‰€æœ‰å¿…é¡»çš„ blockï¼Œå®ƒå°±ä¼šå°†è¿™äº› block ç»„åˆèµ·æ¥å½¢æˆä¸€ä¸ªæ–‡ä»¶ã€‚åœ¨å¤„ç† Client çš„è¯»å–è¯·æ±‚æ—¶ï¼ŒHDFS ä¼šåˆ©ç”¨æœºæ¶æ„ŸçŸ¥é€‰ä¸¾æœ€æ¥è¿‘ Client ä½ç½®çš„å‰¯æœ¬ï¼Œè¿™å°†ä¼šå‡å°‘è¯»å–å»¶è¿Ÿå’Œå¸¦å®½æ¶ˆè€—ã€‚å†™æµç¨‹ä¸­å¤‡ä»½ä¸‰ï¼Œå…¶ä¸­ä¸€ä¸ªå†™å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿåªè¦æˆåŠŸå†™å…¥çš„èŠ‚ç‚¹æ•°é‡è¾¾åˆ°dfs.replication.min(é»˜è®¤ä¸º1)ï¼Œé‚£ä¹ˆå°±ä»»åŠ¡æ˜¯å†™æˆåŠŸçš„ã€‚ç„¶åNameNodeä¼šé€šè¿‡å¼‚æ­¥çš„æ–¹å¼å°†blockå¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œä½¿æ•°æ®å‰¯æœ¬è¾¾åˆ°dfs.replicationå‚æ•°é…ç½®çš„ä¸ªæ•°HDFS HA å¯åŠ¨æµç¨‹â‘ å¼€å¯zookeeperæœåŠ¡1zkServer.sh startâ‘¡å¼€å¯`journalNode`å®ˆæŠ¤è¿›ç¨‹ï¼ˆåœ¨`journal`åè®®æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼‰[ËˆdÊ’ÉœËnl]1hadoop-daemon.sh start journalnodeâ‘¢å¼€å¯namenodeå®ˆæŠ¤è¿›ç¨‹ï¼ˆåœ¨nn1å’Œnn2æ‰§è¡Œï¼‰1hadoop-daemon.sh start namenodeâ‘£å¼€å¯datanodeå®ˆæŠ¤è¿›ç¨‹123hadoop-daemons.sh start datanodeï¼ˆåœ¨namenodeèŠ‚ç‚¹ä¸Šæ‰§è¡Œå¼€å¯å…¨éƒ¨datanodeï¼‰â‘¤å¼€å¯zkfcå®ˆæŠ¤è¿›ç¨‹1hadoop-daemon.sh --script $HADOOP_PREFIX&#x2F;bin&#x2F;hdfs start zkfcHDFS å­˜å‚¨ç±»å‹HDFSæ”¯æŒå¦‚ä¸‹4ç§å­˜å‚¨ç±»å‹ï¼šDISKï¼šè¡¨ç¤ºæ™®é€šç£ç›˜(æœºæ¢°ç£ç›˜)SSDï¼šè¡¨ç¤ºå›ºæ€ç¡¬ç›˜RAM_DISKï¼šè¡¨ç¤ºå†…å­˜ç¡¬ç›˜ï¼Œå‚è€ƒè™šæ‹Ÿå†…å­˜ç›˜ï¼Œè¯´ç™½äº†å°±æ˜¯å†…å­˜ARCHIVEï¼šè¿™ä¸ªå¹¶ä¸æ˜¯ç‰¹æŒ‡æŸç§å­˜å‚¨ä»‹è´¨ï¼Œè€Œæ˜¯ä¸ºäº†æ»¡è¶³é«˜å¯†åº¦å­˜å‚¨è€Œå®šä¹‰çš„ä¸€ç§å­˜å‚¨ç±»å‹ï¼Œä¸€èˆ¬å¯¹äºå½’æ¡£çš„ã€è®¿é—®ä¸æ€ä¹ˆé¢‘ç¹çš„æ•°æ®å¯ä»¥ä»¥ ARCHIVE çš„å½¢å¼å­˜å‚¨ã€‚ä»¥ä¸Šå››ç§çš„å­˜å‚¨ç±»å‹çš„å­˜å–çš„é€Ÿåº¦å¤§å°ä¸ºï¼šRAM_DISK-&gt;SSD-&gt;DISK-&gt;ARCHIVEã€‚ä½†æ˜¯å•bitå­˜å‚¨æˆæœ¬ç”±é«˜åˆ°ä½é‚£ä¹ˆæˆ‘ä»¬åœ¨é…ç½®DataNodeçš„å­˜å‚¨è·¯å¾„çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†åˆ«ä¸ºä¸Šé¢å››ç§å­˜å‚¨ç±»å‹é…ç½®å­˜å‚¨ä½ç½®ï¼Œå¦‚ä¸‹å›¾ï¼š12345&lt;property&gt; &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt; &lt;value&gt;[RAM_DISK]file:///ram_disk,[SSD]file:///ssd1/dn,[DISK]file:///disk1/dn,[ARCHIVE]file:///archive1/dn&lt;/value&gt; &lt;description&gt;DataNodeå­˜æ”¾æ•°æ®çš„åœ°æ–¹&lt;/description&gt;&lt;/property&gt;ä¸Šé¢é…ç½®çš„DataNodeçš„å¤šä¸ªå­˜å‚¨ä½ç½®ç”±é€—å·éš”å¼€ï¼Œæ¯ä¸€ä¸ªå­˜å‚¨ä½ç½®ç”±å­˜å‚¨ç±»å‹å’Œå­˜å‚¨ç‰©ç†è·¯å¾„ç»„æˆã€‚HDFSé€šè¿‡è¯¥é…ç½®æ„ŸçŸ¥åº•å±‚å­˜å‚¨çš„ä½ç½®å’Œç±»å‹HDFSæ˜¯å¦æœ‰å¼‚æ­¥è®¿é—®æ¨¡å¼ï¼Ÿåœ¨ç°æœ‰HDFSçš„RPCè°ƒç”¨æ–¹å¼ä¸Š,é‡‡ç”¨çš„åŸºæœ¬æ˜¯blocking callçš„å½¢å¼,ä¹Ÿå°±æ˜¯é˜»å¡å¼çš„è°ƒç”¨æ–¹å¼.é˜»å¡æ–¹å¼çš„ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹æ˜¯å®ƒçš„è¯·æ±‚è¿‡ç¨‹æ˜¯åŒæ­¥çš„,ä¹Ÿå°±æ˜¯è¯´,å®¢æˆ·ç«¯å¿…é¡»ç­‰å¾…å½“å‰è¯·æ±‚ç»“æœçš„è¿”å›,æ‰èƒ½æ¥ç€å‘é€ä¸‹ä¸€æ¬¡è¯·æ±‚.å¦‚æœæ­¤å®¢æˆ·ç«¯æ‰“ç®—åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å‘é€å¤§é‡è¯·æ±‚çš„è¯,é˜»å¡å¼çš„RPCè°ƒç”¨å°†ä¼šéå¸¸è€—æ—¶.ä½†æ˜¯å¦‚æœä¸ºäº†æ¯ä¸€æ¬¡è¯·æ±‚è°ƒç”¨è€Œä¸“é—¨å•ç‹¬å¼€ä¸€ä¸ªçº¿ç¨‹çš„è¯,ç³»ç»Ÿèµ„æºå°†ä¼šè¢«å¤§å¹…åº¦çš„ä½¿ç”¨,æ˜¾ç„¶è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªå¥½çš„è§£å†³çš„åŠæ³•.é‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆå¥½çš„åŠæ³•å‘¢,åœ¨HDFSä¸­æ˜¯å¦å­˜åœ¨æœ‰å¼‚æ­¥æ¨¡å¼çš„RPCè¯·æ±‚æ¥å£å‘¢æœ¬æ–‡æˆ‘ä»¬å°±æ¥èŠèŠHDFSçš„å¼‚æ­¥è®¿é—®æ¨¡å¼.HDFSå¼‚æ­¥è®¿é—®æ¨¡å¼è€å®è¯´,åœ¨ç›®å‰Hadoopçš„å‘å¸ƒç‰ˆæœ¬ä¸­,ç¡®å®è¿˜ä¸å­˜åœ¨HDFSå¼‚æ­¥è®¿é—®çš„æ¨¡å¼,ä½†æ˜¯è¿™å¹¶ä¸ä»£è¡¨ç¤¾åŒºæ²¡æœ‰åœ¨å…³æ³¨è¿™æ–¹é¢çš„é—®é¢˜.åœ¨è®¸å¤šç‰¹æ®Šçš„åœºæ™¯ä¸‹,HDFSçš„å¼‚æ­¥è®¿é—®æ¨¡å¼è¿˜æ˜¯æœ‰å®ƒç‹¬åˆ°çš„ç”¨å¤„çš„.ç¤¾åŒºåœ¨JIRA HDFS-9924([umbrella] Nonblocking HDFS Access)ä¸Šå¯¹æ­¤åŠŸèƒ½ç‰¹æ€§è¿›è¡Œäº†å®ç°.åœ¨æœ¬æ–‡ä¸­,æˆ‘ä»¬å§‘ä¸”å–åâ€HDFSå¼‚æ­¥è®¿é—®æ¨¡å¼â€ä¸ºAsyncDistributedFileSystem,ä¸DistributedFileSystemç›¸å¯¹åº”.HDFSå¼‚æ­¥è®¿é—®æ¨¡å¼åŸç†åœ¨HDFSå¼‚æ­¥è®¿é—®æ¨¡å¼çš„è®¾è®¡æ–‡æ¡£ä¸­,ç»™å‡ºäº†æ–°çš„å¼‚æ­¥çš„RPCè°ƒç”¨æ¨¡å¼,é‡‡ç”¨äº†Future-Getçš„å¼‚æ­¥è°ƒç”¨æ¨¡å¼,ä»¥FileSystemçš„renameæ–¹æ³•å®¢æˆ·ç«¯å¼‚æ­¥è¯·æ±‚çš„æ§åˆ¶åœ¨å‰é¢HDFSå¼‚æ­¥è®¿é—®æ¨¡å¼çš„è¿‡ç¨‹ä¸­,æœ‰ä¸€ç‚¹å¿…é¡»æ ¼å¤–å¼•èµ·æ³¨æ„:å®¢æˆ·ç«¯å¼‚æ­¥è¯·æ±‚çš„æ§åˆ¶.å®¢æˆ·ç«¯åº”æœ‰å¼‚æ­¥è¯·æ±‚æ•°çš„é™åˆ¶,ä»¥æ­¤é˜²æ­¢å®¢æˆ·ç«¯åˆ©ç”¨å¤§é‡çš„å¼‚æ­¥è¯·æ±‚å†²å®æœåŠ¡ç«¯.å¦‚æœè¶…è¿‡äº†æ­¤é™åˆ¶é˜ˆå€¼,å®¢æˆ·ç«¯çš„è¯·æ±‚å°†ä¼šå¤„äºé˜»å¡çŠ¶æ€.è¿™ç‚¹å¿…é¡»è¦å¼•èµ·è¶³å¤Ÿé‡è§†,å¦åˆ™å®¢æˆ·ç«¯éšéšä¾¿ä¾¿å‘èµ·çš„è¯·æ±‚å°†ä¼šæ‘§æ¯NameNode.HDFSå¼‚æ­¥è®¿é—®æ¨¡å¼çš„ä¼˜åŒ–ç‚¹ç¬¬ä¸€, ä¿è¯å¼‚æ­¥è¯·æ±‚çš„æœ‰åºæ€§.åœ¨æŸäº›åœºæ™¯ä¸‹,æˆ‘ä»¬éœ€è¦ä¿è¯å¼‚æ­¥è¯·æ±‚èƒ½å¤ŸæŒ‰ç…§è¯·æ±‚å‘èµ·çš„æ—¶é—´,é¡ºåºæ‰§è¡Œ.ç¬¬äºŒ, å®¢æˆ·ç«¯å¯¹HDFSè¯»å†™å¼‚æ­¥è¯·æ±‚çš„æ”¯æŒ.æ€»ç»“HDFS Asyncè°ƒç”¨æ¨¡å¼çš„å‡ºç°å°†ä¼šå¸¦ç»™ç”¨æˆ·æ›´çµæ´»çš„RPCè¯·æ±‚æ–¹å¼çš„é€‰æ‹©,ä½†æ˜¯å¯èƒ½è€ƒè™‘åˆ°æ­¤ç§æ–¹å¼å¯¹æ¯”ä¹‹å‰çš„æ–¹å¼è€Œè¨€,æ”¹åŠ¨è¾ƒå¤§,ç›®å‰è¿™äº›å¼‚æ­¥è°ƒç”¨ç›¸å…³çš„æ–¹æ³•è®¸å¤šæ˜¯æ‰“ä¸Šäº†@Unstableæ ‡è®°çš„.HDFSå¼‚æ­¥è°ƒç”¨çš„æ–¹å¼åŒæ ·å¯ä»¥å¾ˆå¥½çš„è¿ç”¨åœ¨å•å…ƒæµ‹è¯•ä¸Š.é‰´äºæ­¤ç‰¹æ€§æ˜¯è¿˜æš‚æœªå‘å¸ƒ,å¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦,è¿›è¡Œéƒ¨åˆ†çš„åˆå…¥.è°ƒæ•´æ•°æ®å—å¤§å°ä¼šæœ‰ä»€ä¹ˆå½±å“ï¼ŸHadoop 1.x ä¸­ï¼Œ é»˜è®¤çš„æ•°æ®å—å¤§å°æ˜¯ 64MHadoop 2.x ä¸­ï¼Œ é»˜è®¤çš„æ•°æ®å—å¤§å°æ˜¯ 128Måœ¨HDFSä¸­ï¼Œæ•°æ®å—ä¸å®œè®¾ç½®çš„è¿‡å¤§ï¼Œä¹Ÿä¸é€‚å®œè®¾ç½®çš„è¿‡å°ã€‚ä¸»è¦æ˜¯ä» å‡å°‘å¯»å€æ—¶é—´å’ŒMRä»»åŠ¡å¹¶è¡Œæ–¹é¢å»è€ƒè™‘ä¸ºä»€ä¹ˆHDFSä¸­å—ï¼ˆblockï¼‰ä¸èƒ½è®¾ç½®å¤ªå¤§ï¼Œä¹Ÿä¸èƒ½è®¾ç½®å¤ªå°ï¼Ÿå¦‚æœå—è®¾ç½®è¿‡å¤§ï¼Œä¸€æ–¹é¢ï¼Œä»ç£ç›˜ä¼ è¾“æ•°æ®çš„æ—¶é—´ä¼šæ˜æ˜¾å¤§äºå¯»å€æ—¶é—´ï¼Œå¯¼è‡´ç¨‹åºåœ¨å¤„ç†è¿™å—æ•°æ®æ—¶ï¼Œå˜å¾—éå¸¸æ…¢ï¼›å¦ä¸€æ–¹é¢ï¼Œmapreduceä¸­çš„mapä»»åŠ¡é€šå¸¸ä¸€æ¬¡åªå¤„ç†ä¸€ä¸ªå—ä¸­çš„æ•°æ®ï¼Œå¦‚æœå—è¿‡å¤§è¿è¡Œé€Ÿåº¦ä¹Ÿä¼šå¾ˆæ…¢ã€‚2. å¦‚æœå—è®¾ç½®è¿‡å°ï¼Œä¸€æ–¹é¢å­˜æ”¾å¤§é‡å°æ–‡ä»¶ä¼šå ç”¨NameNodeä¸­å¤§é‡å†…å­˜æ¥å­˜å‚¨å…ƒæ•°æ®ï¼Œè€ŒNameNodeçš„å†…å­˜æ˜¯æœ‰é™çš„ï¼Œä¸å¯å–ï¼›å¦ä¸€æ–¹é¢æ–‡ä»¶å—è¿‡å°ï¼Œå¯»å€æ—¶é—´å¢å¤§ï¼Œå¯¼è‡´ç¨‹åºä¸€ç›´åœ¨æ‰¾blockçš„å¼€å§‹ä½ç½®ã€‚å› è€Œï¼Œå—é€‚å½“è®¾ç½®å¤§ä¸€äº›ï¼Œå‡å°‘å¯»å€æ—¶é—´ï¼Œé‚£ä¹ˆä¼ è¾“ä¸€ä¸ªç”±å¤šä¸ªå—ç»„æˆçš„æ–‡ä»¶çš„æ—¶é—´ä¸»è¦å–å†³äºç£ç›˜çš„ä¼ è¾“é€Ÿç‡ã€‚HDFSä¸­å—ï¼ˆblockï¼‰çš„å¤§å°ä¸ºä»€ä¹ˆè®¾ç½®ä¸º128Mï¼ŸHDFSä¸­å¹³å‡å¯»å€æ—¶é—´å¤§æ¦‚ä¸º10msï¼›2. ç»è¿‡å‰äººçš„å¤§é‡æµ‹è¯•å‘ç°ï¼Œå¯»å€æ—¶é—´ä¸ºä¼ è¾“æ—¶é—´çš„1%æ—¶ï¼Œä¸ºæœ€ä½³çŠ¶æ€ï¼›æ‰€ä»¥æœ€ä½³ä¼ è¾“æ—¶é—´ä¸º10ms/0.01=1000ms=1s3. ç›®å‰ç£ç›˜çš„ä¼ è¾“é€Ÿç‡æ™®éä¸º100MB/sï¼›è®¡ç®—å‡ºæœ€ä½³blockå¤§å°ï¼š100MB/s x 1s = 100MBæ‰€ä»¥æˆ‘ä»¬è®¾å®šblockå¤§å°ä¸º128MBã€‚å®é™…åœ¨å·¥ä¸šç”Ÿäº§ä¸­ï¼Œç£ç›˜ä¼ è¾“é€Ÿç‡ä¸º200MB/sæ—¶ï¼Œä¸€èˆ¬è®¾å®šblockå¤§å°ä¸º256MBï¼Œç£ç›˜ä¼ è¾“é€Ÿç‡ä¸º400MB/sæ—¶ï¼Œä¸€èˆ¬è®¾å®šblockå¤§å°ä¸º512MBä»¥åéšç€æ–°ä¸€ä»£ç£ç›˜é©±åŠ¨å™¨ä¼ è¾“é€Ÿç‡çš„æå‡ï¼Œå—çš„å¤§å°å°†è¢«è®¾ç½®å¾—æ›´å¤§","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"hdfs","slug":"hdfs","permalink":"cpeixin.cn/tags/hdfs/"}]},{"title":"Hadoop 2.x - HDFS","slug":"Hadoop-2-x-HDFS","date":"2016-10-06T03:33:21.000Z","updated":"2020-04-04T17:26:26.578Z","comments":true,"path":"2016/10/06/Hadoop-2-x-HDFS/","link":"","permalink":"cpeixin.cn/2016/10/06/Hadoop-2-x-HDFS/","excerpt":"","text":"åœ¨ Hadoop 1.0 æ—¶ä»£ï¼ŒHadoop çš„ä¸¤å¤§æ ¸å¿ƒç»„ä»¶ HDFS NameNode å’Œ JobTracker éƒ½å­˜åœ¨ç€å•ç‚¹é—®é¢˜ï¼Œè¿™å…¶ä¸­ä»¥ NameNode çš„å•ç‚¹é—®é¢˜å°¤ä¸ºä¸¥é‡ã€‚å› ä¸º NameNode ä¿å­˜äº†æ•´ä¸ª HDFS çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œä¸€æ—¦ NameNode æŒ‚æ‰ï¼Œæ•´ä¸ª HDFS å°±æ— æ³•è®¿é—®ï¼ŒåŒæ—¶ Hadoop ç”Ÿæ€ç³»ç»Ÿä¸­ä¾èµ–äº HDFS çš„å„ä¸ªç»„ä»¶ï¼ŒåŒ…æ‹¬ MapReduceã€Hiveã€Pig ä»¥åŠ HBase ç­‰ä¹Ÿéƒ½æ— æ³•æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”é‡æ–°å¯åŠ¨ NameNode å’Œè¿›è¡Œæ•°æ®æ¢å¤çš„è¿‡ç¨‹ä¹Ÿä¼šæ¯”è¾ƒè€—æ—¶ã€‚è¿™äº›é—®é¢˜åœ¨ç»™ Hadoop çš„ä½¿ç”¨è€…å¸¦æ¥å›°æ‰°çš„åŒæ—¶ï¼Œä¹Ÿæå¤§åœ°é™åˆ¶äº† Hadoop çš„ä½¿ç”¨åœºæ™¯ï¼Œä½¿å¾— Hadoop åœ¨å¾ˆé•¿çš„æ—¶é—´å†…ä»…èƒ½ç”¨ä½œç¦»çº¿å­˜å‚¨å’Œç¦»çº¿è®¡ç®—ï¼Œæ— æ³•åº”ç”¨åˆ°å¯¹å¯ç”¨æ€§å’Œæ•°æ®ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜çš„åœ¨çº¿åº”ç”¨åœºæ™¯ä¸­ã€‚NameNode é«˜å¯ç”¨æ•´ä½“æ¶æ„æ¦‚è¿°åœ¨ Hadoop2.0 ä¸­ï¼ŒHDFS NameNode å’Œ YARN ResourceManger(JobTracker åœ¨ 2.0 ä¸­å·²ç»è¢«æ•´åˆåˆ° YARN ResourceManger ä¹‹ä¸­) çš„å•ç‚¹é—®é¢˜éƒ½å¾—åˆ°äº†è§£å†³ï¼Œç»è¿‡å¤šä¸ªç‰ˆæœ¬çš„è¿­ä»£å’Œå‘å±•ï¼Œç›®å‰å·²ç»èƒ½ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚HDFS NameNode å’Œ YARN ResourceManger çš„é«˜å¯ç”¨ (High Availabilityï¼ŒHA) æ–¹æ¡ˆåŸºæœ¬ç±»ä¼¼ï¼Œä¸¤è€…ä¹Ÿå¤ç”¨äº†éƒ¨åˆ†ä»£ç ï¼Œä½†æ˜¯ç”±äº HDFS NameNode å¯¹äºæ•°æ®å­˜å‚¨å’Œæ•°æ®ä¸€è‡´æ€§çš„è¦æ±‚æ¯” YARN ResourceManger é«˜å¾—å¤šï¼Œæ‰€ä»¥ HDFS NameNode çš„é«˜å¯ç”¨å®ç°æ›´ä¸ºå¤æ‚ä¸€äº›ï¼Œæœ¬æ–‡ä»å†…éƒ¨å®ç°çš„è§’åº¦å¯¹ HDFS NameNode çš„é«˜å¯ç”¨æœºåˆ¶è¿›è¡Œè¯¦ç»†çš„åˆ†æã€‚HDFS NameNode çš„é«˜å¯ç”¨æ•´ä½“æ¶æ„å¦‚å›¾ 1 æ‰€ç¤ºå›¾ 1.HDFS NameNode é«˜å¯ç”¨æ•´ä½“æ¶æ„ä»ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º NameNode çš„é«˜å¯ç”¨æ¶æ„ä¸»è¦åˆ†ä¸ºä¸‹é¢å‡ ä¸ªéƒ¨åˆ†ï¼šActive NameNode å’Œ Standby NameNodeï¼šä¸¤å° NameNode å½¢æˆäº’å¤‡ï¼Œä¸€å°å¤„äº Active çŠ¶æ€ï¼Œä¸ºä¸» NameNodeï¼Œå¦å¤–ä¸€å°å¤„äº Standby çŠ¶æ€ï¼Œä¸ºå¤‡ NameNodeï¼Œåªæœ‰ä¸» NameNode æ‰èƒ½å¯¹å¤–æä¾›è¯»å†™æœåŠ¡ã€‚ä¸»å¤‡åˆ‡æ¢æ§åˆ¶å™¨ ZKFailoverControllerï¼šZKFailoverController ä½œä¸ºç‹¬ç«‹çš„è¿›ç¨‹è¿è¡Œï¼Œå¯¹ NameNode çš„ä¸»å¤‡åˆ‡æ¢è¿›è¡Œæ€»ä½“æ§åˆ¶ã€‚ZKFailoverController èƒ½åŠæ—¶æ£€æµ‹åˆ° NameNode çš„å¥åº·çŠ¶å†µï¼Œåœ¨ä¸» NameNode æ•…éšœæ—¶å€ŸåŠ© Zookeeper å®ç°è‡ªåŠ¨çš„ä¸»å¤‡é€‰ä¸¾å’Œåˆ‡æ¢ï¼Œå½“ç„¶ NameNode ç›®å‰ä¹Ÿæ”¯æŒä¸ä¾èµ–äº Zookeeper çš„æ‰‹åŠ¨ä¸»å¤‡åˆ‡æ¢ã€‚Zookeeper é›†ç¾¤ï¼šä¸ºä¸»å¤‡åˆ‡æ¢æ§åˆ¶å™¨æä¾›ä¸»å¤‡é€‰ä¸¾æ”¯æŒã€‚å…±äº«å­˜å‚¨ç³»ç»Ÿï¼šå…±äº«å­˜å‚¨ç³»ç»Ÿæ˜¯å®ç° NameNode çš„é«˜å¯ç”¨æœ€ä¸ºå…³é”®çš„éƒ¨åˆ†ï¼Œå…±äº«å­˜å‚¨ç³»ç»Ÿä¿å­˜äº† NameNode åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ‰€äº§ç”Ÿçš„ HDFS çš„å…ƒæ•°æ®ã€‚ä¸» NameNode å’ŒNameNode é€šè¿‡å…±äº«å­˜å‚¨ç³»ç»Ÿå®ç°å…ƒæ•°æ®åŒæ­¥ã€‚åœ¨è¿›è¡Œä¸»å¤‡åˆ‡æ¢çš„æ—¶å€™ï¼Œæ–°çš„ä¸» NameNode åœ¨ç¡®è®¤å…ƒæ•°æ®å®Œå…¨åŒæ­¥ä¹‹åæ‰èƒ½ç»§ç»­å¯¹å¤–æä¾›æœåŠ¡ã€‚DataNode èŠ‚ç‚¹ï¼šé™¤äº†é€šè¿‡å…±äº«å­˜å‚¨ç³»ç»Ÿå…±äº« HDFS çš„å…ƒæ•°æ®ä¿¡æ¯ä¹‹å¤–ï¼Œä¸» NameNode å’Œå¤‡ NameNode è¿˜éœ€è¦å…±äº« HDFS çš„æ•°æ®å—å’Œ DataNode ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚DataNode ä¼šåŒæ—¶å‘ä¸» NameNode å’Œå¤‡ NameNode ä¸ŠæŠ¥æ•°æ®å—çš„ä½ç½®ä¿¡æ¯ã€‚ä¸‹é¢å¼€å§‹åˆ†åˆ«ä»‹ç» NameNode çš„ä¸»å¤‡åˆ‡æ¢å®ç°å’Œå…±äº«å­˜å‚¨ç³»ç»Ÿçš„å®ç°ï¼Œåœ¨æ–‡ç« çš„æœ€åä¼šç»“åˆç¬”è€…çš„å®è·µä»‹ç»ä¸€ä¸‹åœ¨ NameNode çš„é«˜å¯ç”¨è¿ç»´ä¸­çš„ä¸€äº›æ³¨æ„äº‹é¡¹ã€‚NameNode çš„ä¸»å¤‡åˆ‡æ¢å®ç°NameNode ä¸»å¤‡åˆ‡æ¢ä¸»è¦ç”± ZKFailoverControllerã€HealthMonitor å’Œ ActiveStandbyElector è¿™ 3 ä¸ªç»„ä»¶æ¥ååŒå®ç°ï¼šZKFailoverController ä½œä¸º NameNode æœºå™¨ä¸Šä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹å¯åŠ¨ (åœ¨ hdfs å¯åŠ¨è„šæœ¬ä¹‹ä¸­çš„è¿›ç¨‹åä¸º zkfc)ï¼Œå¯åŠ¨çš„æ—¶å€™ä¼šåˆ›å»º HealthMonitor å’Œ ActiveStandbyElector è¿™ä¸¤ä¸ªä¸»è¦çš„å†…éƒ¨ç»„ä»¶ï¼ŒZKFailoverController åœ¨åˆ›å»º HealthMonitor å’Œ ActiveStandbyElector çš„åŒæ—¶ï¼Œä¹Ÿä¼šå‘ HealthMonitor å’Œ ActiveStandbyElector æ³¨å†Œç›¸åº”çš„å›è°ƒæ–¹æ³•ã€‚HealthMonitor ä¸»è¦è´Ÿè´£æ£€æµ‹ NameNode çš„å¥åº·çŠ¶æ€ï¼Œå¦‚æœæ£€æµ‹åˆ° NameNode çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œä¼šå›è°ƒ ZKFailoverController çš„ç›¸åº”æ–¹æ³•è¿›è¡Œè‡ªåŠ¨çš„ä¸»å¤‡é€‰ä¸¾ã€‚ActiveStandbyElector ä¸»è¦è´Ÿè´£å®Œæˆè‡ªåŠ¨çš„ä¸»å¤‡é€‰ä¸¾ï¼Œå†…éƒ¨å°è£…äº† Zookeeper çš„å¤„ç†é€»è¾‘ï¼Œä¸€æ—¦ Zookeeper ä¸»å¤‡é€‰ä¸¾å®Œæˆï¼Œä¼šå›è°ƒ ZKFailoverController çš„ç›¸åº”æ–¹æ³•æ¥è¿›è¡Œ NameNode çš„ä¸»å¤‡çŠ¶æ€åˆ‡æ¢ã€‚NameNode å®ç°ä¸»å¤‡åˆ‡æ¢çš„æµç¨‹å¦‚å›¾ 2 æ‰€ç¤ºï¼Œæœ‰ä»¥ä¸‹å‡ æ­¥ï¼šHealthMonitor åˆå§‹åŒ–å®Œæˆä¹‹åä¼šå¯åŠ¨å†…éƒ¨çš„çº¿ç¨‹æ¥å®šæ—¶è°ƒç”¨å¯¹åº” NameNode çš„ HAServiceProtocol RPC æ¥å£çš„æ–¹æ³•ï¼Œå¯¹ NameNode çš„å¥åº·çŠ¶æ€è¿›è¡Œæ£€æµ‹ã€‚HealthMonitor å¦‚æœæ£€æµ‹åˆ° NameNode çš„å¥åº·çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œä¼šå›è°ƒ ZKFailoverController æ³¨å†Œçš„ç›¸åº”æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚å¦‚æœ ZKFailoverController åˆ¤æ–­éœ€è¦è¿›è¡Œä¸»å¤‡åˆ‡æ¢ï¼Œä¼šé¦–å…ˆä½¿ç”¨ ActiveStandbyElector æ¥è¿›è¡Œè‡ªåŠ¨çš„ä¸»å¤‡é€‰ä¸¾ã€‚ActiveStandbyElector ä¸ Zookeeper è¿›è¡Œäº¤äº’å®Œæˆè‡ªåŠ¨çš„ä¸»å¤‡é€‰ä¸¾ã€‚ActiveStandbyElector åœ¨ä¸»å¤‡é€‰ä¸¾å®Œæˆåï¼Œä¼šå›è°ƒ ZKFailoverController çš„ç›¸åº”æ–¹æ³•æ¥é€šçŸ¥å½“å‰çš„ NameNode æˆä¸ºä¸» NameNode æˆ–å¤‡ NameNodeã€‚ZKFailoverController è°ƒç”¨å¯¹åº” NameNode çš„ HAServiceProtocol RPC æ¥å£çš„æ–¹æ³•å°† NameNode è½¬æ¢ä¸º Active çŠ¶æ€æˆ– Standby çŠ¶æ€ã€‚å›¾ 2.NameNode çš„ä¸»å¤‡åˆ‡æ¢æµç¨‹ä¸‹é¢åˆ†åˆ«å¯¹ HealthMonitorã€ActiveStandbyElector å’Œ ZKFailoverController çš„å®ç°ç»†èŠ‚è¿›è¡Œåˆ†æï¼šHealthMonitor å®ç°åˆ†æZKFailoverController åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šåˆ›å»º HealthMonitorï¼ŒHealthMonitor åœ¨å†…éƒ¨ä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥å¾ªç¯è°ƒç”¨ NameNode çš„ HAServiceProtocol RPC æ¥å£çš„æ–¹æ³•æ¥æ£€æµ‹ NameNode çš„çŠ¶æ€ï¼Œå¹¶å°†çŠ¶æ€çš„å˜åŒ–é€šè¿‡å›è°ƒçš„æ–¹å¼æ¥é€šçŸ¥ ZKFailoverControllerã€‚HealthMonitor ä¸»è¦æ£€æµ‹ NameNode çš„ä¸¤ç±»çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ HealthMonitor.State å’Œ HAServiceStatusã€‚HealthMonitor.State æ˜¯é€šè¿‡ HAServiceProtocol RPC æ¥å£çš„ monitorHealth æ–¹æ³•æ¥è·å–çš„ï¼Œåæ˜ äº† NameNode èŠ‚ç‚¹çš„å¥åº·çŠ¶å†µï¼Œä¸»è¦æ˜¯ç£ç›˜å­˜å‚¨èµ„æºæ˜¯å¦å……è¶³ã€‚HealthMonitor.State åŒ…æ‹¬ä¸‹é¢å‡ ç§çŠ¶æ€ï¼šINITIALIZINGï¼šHealthMonitor åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œè¿˜æ²¡æœ‰å¼€å§‹è¿›è¡Œå¥åº·çŠ¶å†µæ£€æµ‹ï¼›SERVICE_HEALTHYï¼šNameNode çŠ¶æ€æ­£å¸¸ï¼›SERVICE_NOT_RESPONDINGï¼šè°ƒç”¨ NameNode çš„ monitorHealth æ–¹æ³•è°ƒç”¨æ— å“åº”æˆ–å“åº”è¶…æ—¶ï¼›SERVICE_UNHEALTHYï¼šNameNode è¿˜åœ¨è¿è¡Œï¼Œä½†æ˜¯ monitorHealth æ–¹æ³•è¿”å›çŠ¶æ€ä¸æ­£å¸¸ï¼Œç£ç›˜å­˜å‚¨èµ„æºä¸è¶³ï¼›HEALTH_MONITOR_FAILEDï¼šHealthMonitor è‡ªå·±åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼‚å¸¸ï¼Œä¸èƒ½ç»§ç»­æ£€æµ‹ NameNode çš„å¥åº·çŠ¶å†µï¼Œä¼šå¯¼è‡´ ZKFailoverController è¿›ç¨‹é€€å‡ºï¼›HealthMonitor.State åœ¨çŠ¶æ€æ£€æµ‹ä¹‹ä¸­èµ·ä¸»è¦çš„ä½œç”¨ï¼Œåœ¨ HealthMonitor.State å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼ŒHealthMonitor ä¼šå›è°ƒ ZKFailoverController çš„ç›¸åº”æ–¹æ³•æ¥è¿›è¡Œå¤„ç†ï¼Œå…·ä½“å¤„ç†è§åæ–‡ ZKFailoverController éƒ¨åˆ†æ‰€è¿°ã€‚è€Œ HAServiceStatus åˆ™æ˜¯é€šè¿‡ HAServiceProtocol RPC æ¥å£çš„ getServiceStatus æ–¹æ³•æ¥è·å–çš„ï¼Œä¸»è¦åæ˜ çš„æ˜¯ NameNode çš„ HA çŠ¶æ€ï¼ŒåŒ…æ‹¬ï¼šINITIALIZINGï¼šNameNode åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼›ACTIVEï¼šå½“å‰ NameNode ä¸ºä¸» NameNodeï¼›STANDBYï¼šå½“å‰ NameNode ä¸ºå¤‡ NameNodeï¼›STOPPINGï¼šå½“å‰ NameNode å·²åœæ­¢ï¼›HAServiceStatus åœ¨çŠ¶æ€æ£€æµ‹ä¹‹ä¸­åªæ˜¯èµ·è¾…åŠ©çš„ä½œç”¨ï¼Œåœ¨ HAServiceStatus å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒHealthMonitor ä¹Ÿä¼šå›è°ƒ ZKFailoverController çš„ç›¸åº”æ–¹æ³•æ¥è¿›è¡Œå¤„ç†ï¼Œå…·ä½“å¤„ç†è§åæ–‡ ZKFailoverController éƒ¨åˆ†æ‰€è¿°ã€‚ActiveStandbyElector å®ç°åˆ†æNamenode(åŒ…æ‹¬ YARN ResourceManager) çš„ä¸»å¤‡é€‰ä¸¾æ˜¯é€šè¿‡ ActiveStandbyElector æ¥å®Œæˆçš„ï¼ŒActiveStandbyElector ä¸»è¦æ˜¯åˆ©ç”¨äº† Zookeeper çš„å†™ä¸€è‡´æ€§å’Œä¸´æ—¶èŠ‚ç‚¹æœºåˆ¶ï¼Œå…·ä½“çš„ä¸»å¤‡é€‰ä¸¾å®ç°å¦‚ä¸‹ï¼šåˆ›å»ºé”èŠ‚ç‚¹å¦‚æœ HealthMonitor æ£€æµ‹åˆ°å¯¹åº”çš„ NameNode çš„çŠ¶æ€æ­£å¸¸ï¼Œé‚£ä¹ˆè¡¨ç¤ºè¿™ä¸ª NameNode æœ‰èµ„æ ¼å‚åŠ  Zookeeper çš„ä¸»å¤‡é€‰ä¸¾ã€‚å¦‚æœç›®å‰è¿˜æ²¡æœ‰è¿›è¡Œè¿‡ä¸»å¤‡é€‰ä¸¾çš„è¯ï¼Œé‚£ä¹ˆç›¸åº”çš„ ActiveStandbyElector å°±ä¼šå‘èµ·ä¸€æ¬¡ä¸»å¤‡é€‰ä¸¾ï¼Œå°è¯•åœ¨ Zookeeper ä¸Šåˆ›å»ºä¸€ä¸ªè·¯å¾„ä¸º/hadoop-ha/${dfs.nameservices}/ActiveStandbyElectorLock çš„ä¸´æ—¶èŠ‚ç‚¹ (${dfs.nameservices} ä¸º Hadoop çš„é…ç½®å‚æ•° dfs.nameservices çš„å€¼ï¼Œä¸‹åŒ)ï¼ŒZookeeper çš„å†™ä¸€è‡´æ€§ä¼šä¿è¯æœ€ç»ˆåªä¼šæœ‰ä¸€ä¸ª ActiveStandbyElector åˆ›å»ºæˆåŠŸï¼Œé‚£ä¹ˆåˆ›å»ºæˆåŠŸçš„ ActiveStandbyElector å¯¹åº”çš„ NameNode å°±ä¼šæˆä¸ºä¸» NameNodeï¼ŒActiveStandbyElector ä¼šå›è°ƒ ZKFailoverController çš„æ–¹æ³•è¿›ä¸€æ­¥å°†å¯¹åº”çš„ NameNode åˆ‡æ¢ä¸º Active çŠ¶æ€ã€‚è€Œåˆ›å»ºå¤±è´¥çš„ ActiveStandbyElector å¯¹åº”çš„ NameNode æˆä¸ºå¤‡ NameNodeï¼ŒActiveStandbyElector ä¼šå›è°ƒ ZKFailoverController çš„æ–¹æ³•è¿›ä¸€æ­¥å°†å¯¹åº”çš„ NameNode åˆ‡æ¢ä¸º Standby çŠ¶æ€ã€‚æ³¨å†Œ Watcher ç›‘å¬ä¸ç®¡åˆ›å»º/hadoop-ha/${dfs.nameservices}/ActiveStandbyElectorLock èŠ‚ç‚¹æ˜¯å¦æˆåŠŸï¼ŒActiveStandbyElector éšåéƒ½ä¼šå‘ Zookeeper æ³¨å†Œä¸€ä¸ª Watcher æ¥ç›‘å¬è¿™ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€å˜åŒ–äº‹ä»¶ï¼ŒActiveStandbyElector ä¸»è¦å…³æ³¨è¿™ä¸ªèŠ‚ç‚¹çš„ NodeDeleted äº‹ä»¶ã€‚è‡ªåŠ¨è§¦å‘ä¸»å¤‡é€‰ä¸¾å¦‚æœ Active NameNode å¯¹åº”çš„ HealthMonitor æ£€æµ‹åˆ° NameNode çš„çŠ¶æ€å¼‚å¸¸æ—¶ï¼Œ ZKFailoverController ä¼šä¸»åŠ¨åˆ é™¤å½“å‰åœ¨ Zookeeper ä¸Šå»ºç«‹çš„ä¸´æ—¶èŠ‚ç‚¹/hadoop-ha/${dfs.nameservices}/ActiveStandbyElectorLockï¼Œè¿™æ ·å¤„äº Standby çŠ¶æ€çš„ NameNode çš„ ActiveStandbyElector æ³¨å†Œçš„ç›‘å¬å™¨å°±ä¼šæ”¶åˆ°è¿™ä¸ªèŠ‚ç‚¹çš„ NodeDeleted äº‹ä»¶ã€‚æ”¶åˆ°è¿™ä¸ªäº‹ä»¶ä¹‹åï¼Œä¼šé©¬ä¸Šå†æ¬¡è¿›å…¥åˆ°åˆ›å»º/hadoop-ha/${dfs.nameservices}/ActiveStandbyElectorLock èŠ‚ç‚¹çš„æµç¨‹ï¼Œå¦‚æœåˆ›å»ºæˆåŠŸï¼Œè¿™ä¸ªæœ¬æ¥å¤„äº Standby çŠ¶æ€çš„ NameNode å°±é€‰ä¸¾ä¸ºä¸» NameNode å¹¶éšåå¼€å§‹åˆ‡æ¢ä¸º Active çŠ¶æ€ã€‚å½“ç„¶ï¼Œå¦‚æœæ˜¯ Active çŠ¶æ€çš„ NameNode æ‰€åœ¨çš„æœºå™¨æ•´ä¸ªå®•æ‰çš„è¯ï¼Œé‚£ä¹ˆæ ¹æ® Zookeeper çš„ä¸´æ—¶èŠ‚ç‚¹ç‰¹æ€§ï¼Œ/hadoop-ha/${dfs.nameservices}/ActiveStandbyElectorLock èŠ‚ç‚¹ä¼šè‡ªåŠ¨è¢«åˆ é™¤ï¼Œä»è€Œä¹Ÿä¼šè‡ªåŠ¨è¿›è¡Œä¸€æ¬¡ä¸»å¤‡åˆ‡æ¢ã€‚é˜²æ­¢è„‘è£‚Zookeeper åœ¨å·¥ç¨‹å®è·µçš„è¿‡ç¨‹ä¸­ç»å¸¸ä¼šå‘ç”Ÿçš„ä¸€ä¸ªç°è±¡å°±æ˜¯ Zookeeper å®¢æˆ·ç«¯â€œå‡æ­»â€ï¼Œæ‰€è°“çš„â€œå‡æ­»â€æ˜¯æŒ‡å¦‚æœ Zookeeper å®¢æˆ·ç«¯æœºå™¨è´Ÿè½½è¿‡é«˜æˆ–è€…æ­£åœ¨è¿›è¡Œ JVM Full GCï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¼è‡´ Zookeeper å®¢æˆ·ç«¯åˆ° Zookeeper æœåŠ¡ç«¯çš„å¿ƒè·³ä¸èƒ½æ­£å¸¸å‘å‡ºï¼Œä¸€æ—¦è¿™ä¸ªæ—¶é—´æŒç»­è¾ƒé•¿ï¼Œè¶…è¿‡äº†é…ç½®çš„ Zookeeper Session Timeout å‚æ•°çš„è¯ï¼ŒZookeeper æœåŠ¡ç«¯å°±ä¼šè®¤ä¸ºå®¢æˆ·ç«¯çš„ session å·²ç»è¿‡æœŸä»è€Œå°†å®¢æˆ·ç«¯çš„ Session å…³é—­ã€‚â€œå‡æ­»â€æœ‰å¯èƒ½å¼•èµ·åˆ†å¸ƒå¼ç³»ç»Ÿå¸¸è¯´çš„åŒä¸»æˆ–è„‘è£‚ (brain-split) ç°è±¡ã€‚å…·ä½“åˆ°æœ¬æ–‡æ‰€è¿°çš„ NameNodeï¼Œå‡è®¾ NameNode1 å½“å‰ä¸º Active çŠ¶æ€ï¼ŒNameNode2 å½“å‰ä¸º Standby çŠ¶æ€ã€‚å¦‚æœæŸä¸€æ—¶åˆ» NameNode1 å¯¹åº”çš„ ZKFailoverController è¿›ç¨‹å‘ç”Ÿäº†â€œå‡æ­»â€ç°è±¡ï¼Œé‚£ä¹ˆ Zookeeper æœåŠ¡ç«¯ä¼šè®¤ä¸º NameNode1 æŒ‚æ‰äº†ï¼Œæ ¹æ®å‰é¢çš„ä¸»å¤‡åˆ‡æ¢é€»è¾‘ï¼ŒNameNode2 ä¼šæ›¿ä»£ NameNode1 è¿›å…¥ Active çŠ¶æ€ã€‚ä½†æ˜¯æ­¤æ—¶ NameNode1 å¯èƒ½ä»ç„¶å¤„äº Active çŠ¶æ€æ­£å¸¸è¿è¡Œï¼Œå³ä½¿éšå NameNode1 å¯¹åº”çš„ ZKFailoverController å› ä¸ºè´Ÿè½½ä¸‹é™æˆ–è€… Full GC ç»“æŸè€Œæ¢å¤äº†æ­£å¸¸ï¼Œæ„ŸçŸ¥åˆ°è‡ªå·±å’Œ Zookeeper çš„ Session å·²ç»å…³é—­ï¼Œä½†æ˜¯ç”±äºç½‘ç»œçš„å»¶è¿Ÿä»¥åŠ CPU çº¿ç¨‹è°ƒåº¦çš„ä¸ç¡®å®šæ€§ï¼Œä»ç„¶æœ‰å¯èƒ½ä¼šåœ¨æ¥ä¸‹æ¥çš„ä¸€æ®µæ—¶é—´çª—å£å†… NameNode1 è®¤ä¸ºè‡ªå·±è¿˜æ˜¯å¤„äº Active çŠ¶æ€ã€‚è¿™æ · NameNode1 å’Œ NameNode2 éƒ½å¤„äº Active çŠ¶æ€ï¼Œéƒ½å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ã€‚è¿™ç§æƒ…å†µå¯¹äº NameNode è¿™ç±»å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚éå¸¸é«˜çš„ç³»ç»Ÿæ¥è¯´æ˜¯ç¾éš¾æ€§çš„ï¼Œæ•°æ®ä¼šå‘ç”Ÿé”™ä¹±ä¸”æ— æ³•æ¢å¤ã€‚Zookeeper ç¤¾åŒºå¯¹è¿™ç§é—®é¢˜çš„è§£å†³æ–¹æ³•å«åš fencingï¼Œä¸­æ–‡ç¿»è¯‘ä¸ºéš”ç¦»ï¼Œä¹Ÿå°±æ˜¯æƒ³åŠæ³•æŠŠæ—§çš„ Active NameNode éš”ç¦»èµ·æ¥ï¼Œä½¿å®ƒä¸èƒ½æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡ã€‚ActiveStandbyElector ä¸ºäº†å®ç° fencingï¼Œä¼šåœ¨æˆåŠŸåˆ›å»º Zookeeper èŠ‚ç‚¹ hadoop-ha/${dfs.nameservices}/ActiveStandbyElectorLock ä»è€Œæˆä¸º Active NameNode ä¹‹åï¼Œåˆ›å»ºå¦å¤–ä¸€ä¸ªè·¯å¾„ä¸º/hadoop-ha/${dfs.nameservices}/ActiveBreadCrumb çš„æŒä¹…èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹é‡Œé¢ä¿å­˜äº†è¿™ä¸ª Active NameNode çš„åœ°å€ä¿¡æ¯ã€‚Active NameNode çš„ ActiveStandbyElector åœ¨æ­£å¸¸çš„çŠ¶æ€ä¸‹å…³é—­ Zookeeper Session çš„æ—¶å€™ (æ³¨æ„ç”±äº/hadoop-ha/${dfs.nameservices}/ActiveStandbyElectorLock æ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œä¹Ÿä¼šéšä¹‹åˆ é™¤)ï¼Œä¼šä¸€èµ·åˆ é™¤èŠ‚ç‚¹/hadoop-ha/${dfs.nameservices}/ActiveBreadCrumbã€‚ä½†æ˜¯å¦‚æœ ActiveStandbyElector åœ¨å¼‚å¸¸çš„çŠ¶æ€ä¸‹ Zookeeper Session å…³é—­ (æ¯”å¦‚å‰è¿°çš„ Zookeeper å‡æ­»)ï¼Œé‚£ä¹ˆç”±äº/hadoop-ha/${dfs.nameservices}/ActiveBreadCrumb æ˜¯æŒä¹…èŠ‚ç‚¹ï¼Œä¼šä¸€ç›´ä¿ç•™ä¸‹æ¥ã€‚åé¢å½“å¦ä¸€ä¸ª NameNode é€‰ä¸»æˆåŠŸä¹‹åï¼Œä¼šæ³¨æ„åˆ°ä¸Šä¸€ä¸ª Active NameNode é—ç•™ä¸‹æ¥çš„è¿™ä¸ªèŠ‚ç‚¹ï¼Œä»è€Œä¼šå›è°ƒ ZKFailoverController çš„æ–¹æ³•å¯¹æ—§çš„ Active NameNode è¿›è¡Œ fencingï¼Œå…·ä½“å¤„ç†è§åæ–‡ ZKFailoverController éƒ¨åˆ†æ‰€è¿°ã€‚ZKFailoverController å®ç°åˆ†æZKFailoverController åœ¨åˆ›å»º HealthMonitor å’Œ ActiveStandbyElector çš„åŒæ—¶ï¼Œä¼šå‘ HealthMonitor å’Œ ActiveStandbyElector æ³¨å†Œç›¸åº”çš„å›è°ƒå‡½æ•°ï¼ŒZKFailoverController çš„å¤„ç†é€»è¾‘ä¸»è¦é  HealthMonitor å’Œ ActiveStandbyElector çš„å›è°ƒå‡½æ•°æ¥é©±åŠ¨ã€‚å¯¹ HealthMonitor çŠ¶æ€å˜åŒ–çš„å¤„ç†å¦‚å‰æ‰€è¿°ï¼ŒHealthMonitor ä¼šæ£€æµ‹ NameNode çš„ä¸¤ç±»çŠ¶æ€ï¼ŒHealthMonitor.State åœ¨çŠ¶æ€æ£€æµ‹ä¹‹ä¸­èµ·ä¸»è¦çš„ä½œç”¨ï¼ŒZKFailoverController æ³¨å†Œåˆ° HealthMonitor ä¸Šçš„å¤„ç† HealthMonitor.State çŠ¶æ€å˜åŒ–çš„å›è°ƒå‡½æ•°ä¸»è¦å…³æ³¨ SERVICE_HEALTHYã€SERVICE_NOT_RESPONDING å’Œ SERVICE_UNHEALTHY è¿™ 3 ç§çŠ¶æ€ï¼šå¦‚æœæ£€æµ‹åˆ°çŠ¶æ€ä¸º SERVICE_HEALTHYï¼Œè¡¨ç¤ºå½“å‰çš„ NameNode æœ‰èµ„æ ¼å‚åŠ  Zookeeper çš„ä¸»å¤‡é€‰ä¸¾ï¼Œå¦‚æœç›®å‰è¿˜æ²¡æœ‰è¿›è¡Œè¿‡ä¸»å¤‡é€‰ä¸¾çš„è¯ï¼ŒZKFailoverController ä¼šè°ƒç”¨ ActiveStandbyElector çš„ joinElection æ–¹æ³•å‘èµ·ä¸€æ¬¡ä¸»å¤‡é€‰ä¸¾ã€‚å¦‚æœæ£€æµ‹åˆ°çŠ¶æ€ä¸º SERVICE_NOT_RESPONDING æˆ–è€…æ˜¯ SERVICE_UNHEALTHYï¼Œå°±è¡¨ç¤ºå½“å‰çš„ NameNode å‡ºç°é—®é¢˜äº†ï¼ŒZKFailoverController ä¼šè°ƒç”¨ ActiveStandbyElector çš„ quitElection æ–¹æ³•åˆ é™¤å½“å‰å·²ç»åœ¨ Zookeeper ä¸Šå»ºç«‹çš„ä¸´æ—¶èŠ‚ç‚¹é€€å‡ºä¸»å¤‡é€‰ä¸¾ï¼Œè¿™æ ·å…¶å®ƒçš„ NameNode å°±æœ‰æœºä¼šæˆä¸ºä¸» NameNodeã€‚è€Œ HAServiceStatus åœ¨çŠ¶æ€æ£€æµ‹ä¹‹ä¸­ä»…èµ·è¾…åŠ©çš„ä½œç”¨ï¼Œåœ¨ HAServiceStatus å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒZKFailoverController æ³¨å†Œåˆ° HealthMonitor ä¸Šçš„å¤„ç† HAServiceStatus çŠ¶æ€å˜åŒ–çš„å›è°ƒå‡½æ•°ä¼šåˆ¤æ–­ NameNode è¿”å›çš„ HAServiceStatus å’Œ ZKFailoverController æ‰€æœŸæœ›çš„æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´çš„è¯ï¼ŒZKFailoverController ä¹Ÿä¼šè°ƒç”¨ ActiveStandbyElector çš„ quitElection æ–¹æ³•åˆ é™¤å½“å‰å·²ç»åœ¨ Zookeeper ä¸Šå»ºç«‹çš„ä¸´æ—¶èŠ‚ç‚¹é€€å‡ºä¸»å¤‡é€‰ä¸¾ã€‚å¯¹ ActiveStandbyElector ä¸»å¤‡é€‰ä¸¾çŠ¶æ€å˜åŒ–çš„å¤„ç†åœ¨ ActiveStandbyElector çš„ä¸»å¤‡é€‰ä¸¾çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šå›è°ƒ ZKFailoverController æ³¨å†Œçš„å›è°ƒå‡½æ•°æ¥è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼šå¦‚æœ ActiveStandbyElector é€‰ä¸»æˆåŠŸï¼Œé‚£ä¹ˆ ActiveStandbyElector å¯¹åº”çš„ NameNode æˆä¸ºä¸» NameNodeï¼ŒActiveStandbyElector ä¼šå›è°ƒ ZKFailoverController çš„ becomeActive æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é€šè¿‡è°ƒç”¨å¯¹åº”çš„ NameNode çš„ HAServiceProtocol RPC æ¥å£çš„ transitionToActive æ–¹æ³•ï¼Œå°† NameNode è½¬æ¢ä¸º Active çŠ¶æ€ã€‚å¦‚æœ ActiveStandbyElector é€‰ä¸»å¤±è´¥ï¼Œé‚£ä¹ˆ ActiveStandbyElector å¯¹åº”çš„ NameNode æˆä¸ºå¤‡ NameNodeï¼ŒActiveStandbyElector ä¼šå›è°ƒ ZKFailoverController çš„ becomeStandby æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é€šè¿‡è°ƒç”¨å¯¹åº”çš„ NameNode çš„ HAServiceProtocol RPC æ¥å£çš„ transitionToStandby æ–¹æ³•ï¼Œå°† NameNode è½¬æ¢ä¸º Standby çŠ¶æ€ã€‚å¦‚æœ ActiveStandbyElector é€‰ä¸»æˆåŠŸä¹‹åï¼Œå‘ç°äº†ä¸Šä¸€ä¸ª Active NameNode é—ç•™ä¸‹æ¥çš„/hadoop-ha/${dfs.nameservices}/ActiveBreadCrumb èŠ‚ç‚¹ (è§â€œActiveStandbyElector å®ç°åˆ†æâ€ä¸€èŠ‚â€œé˜²æ­¢è„‘è£‚â€éƒ¨åˆ†æ‰€è¿°)ï¼Œé‚£ä¹ˆ ActiveStandbyElector ä¼šé¦–å…ˆå›è°ƒ ZKFailoverController æ³¨å†Œçš„ fenceOldActive æ–¹æ³•ï¼Œå°è¯•å¯¹æ—§çš„ Active NameNode è¿›è¡Œ fencingï¼Œåœ¨è¿›è¡Œ fencing çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œä»¥ä¸‹çš„æ“ä½œï¼šé¦–å…ˆå°è¯•è°ƒç”¨è¿™ä¸ªæ—§ Active NameNode çš„ HAServiceProtocol RPC æ¥å£çš„ transitionToStandby æ–¹æ³•ï¼Œçœ‹èƒ½ä¸èƒ½æŠŠå®ƒè½¬æ¢ä¸º Standby çŠ¶æ€ã€‚å¦‚æœ transitionToStandby æ–¹æ³•è°ƒç”¨å¤±è´¥ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œ Hadoop é…ç½®æ–‡ä»¶ä¹‹ä¸­é¢„å®šä¹‰çš„éš”ç¦»æªæ–½ï¼ŒHadoop ç›®å‰ä¸»è¦æä¾›ä¸¤ç§éš”ç¦»æªæ–½ï¼Œé€šå¸¸ä¼šé€‰æ‹© sshfenceï¼šsshfenceï¼šé€šè¿‡ SSH ç™»å½•åˆ°ç›®æ ‡æœºå™¨ä¸Šï¼Œæ‰§è¡Œå‘½ä»¤ fuser å°†å¯¹åº”çš„è¿›ç¨‹æ€æ­»ï¼›shellfenceï¼šæ‰§è¡Œä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„ shell è„šæœ¬æ¥å°†å¯¹åº”çš„è¿›ç¨‹éš”ç¦»ï¼›åªæœ‰åœ¨æˆåŠŸåœ°æ‰§è¡Œå®Œæˆ fencing ä¹‹åï¼Œé€‰ä¸»æˆåŠŸçš„ ActiveStandbyElector æ‰ä¼šå›è°ƒ ZKFailoverController çš„ becomeActive æ–¹æ³•å°†å¯¹åº”çš„ NameNode è½¬æ¢ä¸º Active çŠ¶æ€ï¼Œå¼€å§‹å¯¹å¤–æä¾›æœåŠ¡ã€‚NameNode çš„å…±äº«å­˜å‚¨å®ç°è¿‡å»å‡ å¹´ä¸­ Hadoop ç¤¾åŒºæ¶Œç°è¿‡å¾ˆå¤šçš„ NameNode å…±äº«å­˜å‚¨æ–¹æ¡ˆï¼Œæ¯”å¦‚ shared NAS+NFSã€BookKeeperã€BackupNode å’Œ QJM(Quorum Journal Manager) ç­‰ç­‰ã€‚ç›®å‰ç¤¾åŒºå·²ç»æŠŠç”± Clouderea å…¬å¸å®ç°çš„åŸºäº QJM çš„æ–¹æ¡ˆåˆå¹¶åˆ° HDFS çš„ trunk ä¹‹ä¸­å¹¶ä¸”ä½œä¸ºé»˜è®¤çš„å…±äº«å­˜å‚¨å®ç°ï¼Œæœ¬éƒ¨åˆ†åªé’ˆå¯¹åŸºäº QJM çš„å…±äº«å­˜å‚¨æ–¹æ¡ˆçš„å†…éƒ¨å®ç°åŸç†è¿›è¡Œåˆ†æã€‚ä¸ºäº†ç†è§£ QJM çš„è®¾è®¡å’Œå®ç°ï¼Œé¦–å…ˆè¦å¯¹ NameNode çš„å…ƒæ•°æ®å­˜å‚¨ç»“æ„æœ‰æ‰€äº†è§£ã€‚NameNode çš„å…ƒæ•°æ®å­˜å‚¨æ¦‚è¿°ä¸€ä¸ªå…¸å‹çš„ NameNode çš„å…ƒæ•°æ®å­˜å‚¨ç›®å½•ç»“æ„å¦‚å›¾ 3 æ‰€ç¤º (å›¾ç‰‡æ¥æºäºå‚è€ƒæ–‡çŒ® [4])ï¼Œè¿™é‡Œä¸»è¦å…³æ³¨å…¶ä¸­çš„ EditLog æ–‡ä»¶å’Œ FSImage æ–‡ä»¶ï¼šå›¾ 3 .NameNode çš„å…ƒæ•°æ®å­˜å‚¨ç›®å½•ç»“æ„NameNode åœ¨æ‰§è¡Œ HDFS å®¢æˆ·ç«¯æäº¤çš„åˆ›å»ºæ–‡ä»¶æˆ–è€…ç§»åŠ¨æ–‡ä»¶è¿™æ ·çš„å†™æ“ä½œçš„æ—¶å€™ï¼Œä¼šé¦–å…ˆæŠŠè¿™äº›æ“ä½œè®°å½•åœ¨ EditLog æ–‡ä»¶ä¹‹ä¸­ï¼Œç„¶åå†æ›´æ–°å†…å­˜ä¸­çš„æ–‡ä»¶ç³»ç»Ÿé•œåƒã€‚å†…å­˜ä¸­çš„æ–‡ä»¶ç³»ç»Ÿé•œåƒç”¨äº NameNode å‘å®¢æˆ·ç«¯æä¾›è¯»æœåŠ¡ï¼Œè€Œ EditLog ä»…ä»…åªæ˜¯åœ¨æ•°æ®æ¢å¤çš„æ—¶å€™èµ·ä½œç”¨ã€‚è®°å½•åœ¨ EditLog ä¹‹ä¸­çš„æ¯ä¸€ä¸ªæ“ä½œåˆç§°ä¸ºä¸€ä¸ªäº‹åŠ¡ï¼Œæ¯ä¸ªäº‹åŠ¡æœ‰ä¸€ä¸ªæ•´æ•°å½¢å¼çš„äº‹åŠ¡ id ä½œä¸ºç¼–å·ã€‚EditLog ä¼šè¢«åˆ‡å‰²ä¸ºå¾ˆå¤šæ®µï¼Œæ¯ä¸€æ®µç§°ä¸ºä¸€ä¸ª Segmentã€‚æ­£åœ¨å†™å…¥çš„ EditLog Segment å¤„äº in-progress çŠ¶æ€ï¼Œå…¶æ–‡ä»¶åå½¢å¦‚ edits_inprogress_${start_txid}ï¼Œå…¶ä¸­${start_txid} è¡¨ç¤ºè¿™ä¸ª segment çš„èµ·å§‹äº‹åŠ¡ idï¼Œä¾‹å¦‚ä¸Šå›¾ä¸­çš„ edits_inprogress_0000000000000000020ã€‚è€Œå·²ç»å†™å…¥å®Œæˆçš„ EditLog Segment å¤„äº finalized çŠ¶æ€ï¼Œå…¶æ–‡ä»¶åå½¢å¦‚ edits_${start_txid}-${end_txid}ï¼Œå…¶ä¸­${start_txid} è¡¨ç¤ºè¿™ä¸ª segment çš„èµ·å§‹äº‹åŠ¡ idï¼Œ${end_txid} è¡¨ç¤ºè¿™ä¸ª segment çš„ç»“æŸäº‹åŠ¡ idï¼Œä¾‹å¦‚ä¸Šå›¾ä¸­çš„ edits_0000000000000000001-0000000000000000019ã€‚NameNode ä¼šå®šæœŸå¯¹å†…å­˜ä¸­çš„æ–‡ä»¶ç³»ç»Ÿé•œåƒè¿›è¡Œ checkpoint æ“ä½œï¼Œåœ¨ç£ç›˜ä¸Šç”Ÿæˆ FSImage æ–‡ä»¶ï¼ŒFSImage æ–‡ä»¶çš„æ–‡ä»¶åå½¢å¦‚ fsimage_${end_txid}ï¼Œå…¶ä¸­${end_txid} è¡¨ç¤ºè¿™ä¸ª fsimage æ–‡ä»¶çš„ç»“æŸäº‹åŠ¡ idï¼Œä¾‹å¦‚ä¸Šå›¾ä¸­çš„ fsimage_0000000000000000020ã€‚åœ¨ NameNode å¯åŠ¨çš„æ—¶å€™ä¼šè¿›è¡Œæ•°æ®æ¢å¤ï¼Œé¦–å…ˆæŠŠ FSImage æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­å½¢æˆæ–‡ä»¶ç³»ç»Ÿé•œåƒï¼Œç„¶åå†æŠŠ EditLog ä¹‹ä¸­ FsImage çš„ç»“æŸäº‹åŠ¡ id ä¹‹åçš„ EditLog å›æ”¾åˆ°è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿé•œåƒä¸Šã€‚åŸºäº QJM çš„å…±äº«å­˜å‚¨ç³»ç»Ÿçš„æ€»ä½“æ¶æ„åŸºäº QJM çš„å…±äº«å­˜å‚¨ç³»ç»Ÿä¸»è¦ç”¨äºä¿å­˜ EditLogï¼Œå¹¶ä¸ä¿å­˜ FSImage æ–‡ä»¶ã€‚FSImage æ–‡ä»¶è¿˜æ˜¯åœ¨ NameNode çš„æœ¬åœ°ç£ç›˜ä¸Šã€‚QJM å…±äº«å­˜å‚¨çš„åŸºæœ¬æ€æƒ³æ¥è‡ªäº Paxos ç®—æ³• (å‚è§å‚è€ƒæ–‡çŒ® [3])ï¼Œé‡‡ç”¨å¤šä¸ªç§°ä¸º JournalNode çš„èŠ‚ç‚¹ç»„æˆçš„ JournalNode é›†ç¾¤æ¥å­˜å‚¨ EditLogã€‚æ¯ä¸ª JournalNode ä¿å­˜åŒæ ·çš„ EditLog å‰¯æœ¬ã€‚æ¯æ¬¡ NameNode å†™ EditLog çš„æ—¶å€™ï¼Œé™¤äº†å‘æœ¬åœ°ç£ç›˜å†™å…¥ EditLog ä¹‹å¤–ï¼Œä¹Ÿä¼šå¹¶è¡Œåœ°å‘ JournalNode é›†ç¾¤ä¹‹ä¸­çš„æ¯ä¸€ä¸ª JournalNode å‘é€å†™è¯·æ±‚ï¼Œåªè¦å¤§å¤šæ•° (majority) çš„ JournalNode èŠ‚ç‚¹è¿”å›æˆåŠŸå°±è®¤ä¸ºå‘ JournalNode é›†ç¾¤å†™å…¥ EditLog æˆåŠŸã€‚å¦‚æœæœ‰ 2N+1 å° JournalNodeï¼Œé‚£ä¹ˆæ ¹æ®å¤§å¤šæ•°çš„åŸåˆ™ï¼Œæœ€å¤šå¯ä»¥å®¹å¿æœ‰ N å° JournalNode èŠ‚ç‚¹æŒ‚æ‰ã€‚åŸºäº QJM çš„å…±äº«å­˜å‚¨ç³»ç»Ÿçš„å†…éƒ¨å®ç°æ¶æ„å›¾å¦‚å›¾ 4 æ‰€ç¤ºï¼Œä¸»è¦åŒ…å«ä¸‹é¢å‡ ä¸ªä¸»è¦çš„ç»„ä»¶ï¼šå›¾ 4 . åŸºäº QJM çš„å…±äº«å­˜å‚¨ç³»ç»Ÿçš„å†…éƒ¨å®ç°æ¶æ„å›¾FSEditLogï¼šè¿™ä¸ªç±»å°è£…äº†å¯¹ EditLog çš„æ‰€æœ‰æ“ä½œï¼Œæ˜¯ NameNode å¯¹ EditLog çš„æ‰€æœ‰æ“ä½œçš„å…¥å£ã€‚JournalSetï¼š è¿™ä¸ªç±»å°è£…äº†å¯¹æœ¬åœ°ç£ç›˜å’Œ JournalNode é›†ç¾¤ä¸Šçš„ EditLog çš„æ“ä½œï¼Œå†…éƒ¨åŒ…å«äº†ä¸¤ç±» JournalManagerï¼Œä¸€ç±»ä¸º FileJournalManagerï¼Œç”¨äºå®ç°å¯¹æœ¬åœ°ç£ç›˜ä¸Š EditLog çš„æ“ä½œã€‚ä¸€ç±»ä¸º QuorumJournalManagerï¼Œç”¨äºå®ç°å¯¹ JournalNode é›†ç¾¤ä¸Šå…±äº«ç›®å½•çš„ EditLog çš„æ“ä½œã€‚FSEditLog åªä¼šè°ƒç”¨ JournalSet çš„ç›¸å…³æ–¹æ³•ï¼Œè€Œä¸ä¼šç›´æ¥ä½¿ç”¨ FileJournalManager å’Œ QuorumJournalManagerã€‚FileJournalManagerï¼šå°è£…äº†å¯¹æœ¬åœ°ç£ç›˜ä¸Šçš„ EditLog æ–‡ä»¶çš„æ“ä½œï¼Œä¸ä»… NameNode åœ¨å‘æœ¬åœ°ç£ç›˜ä¸Šå†™å…¥ EditLog çš„æ—¶å€™ä½¿ç”¨ FileJournalManagerï¼ŒJournalNode åœ¨å‘æœ¬åœ°ç£ç›˜å†™å…¥ EditLog çš„æ—¶å€™ä¹Ÿå¤ç”¨äº† FileJournalManager çš„ä»£ç å’Œé€»è¾‘ã€‚QuorumJournalManagerï¼šå°è£…äº†å¯¹ JournalNode é›†ç¾¤ä¸Šçš„ EditLog çš„æ“ä½œï¼Œå®ƒä¼šæ ¹æ® JournalNode é›†ç¾¤çš„ URI åˆ›å»ºè´Ÿè´£ä¸ JournalNode é›†ç¾¤é€šä¿¡çš„ç±» AsyncLoggerSetï¼Œ QuorumJournalManager é€šè¿‡ AsyncLoggerSet æ¥å®ç°å¯¹ JournalNode é›†ç¾¤ä¸Šçš„ EditLog çš„å†™æ“ä½œï¼Œå¯¹äºè¯»æ“ä½œï¼ŒQuorumJournalManager åˆ™æ˜¯é€šè¿‡ Http æ¥å£ä» JournalNode ä¸Šçš„ JournalNodeHttpServer è¯»å– EditLog çš„æ•°æ®ã€‚AsyncLoggerSetï¼šå†…éƒ¨åŒ…å«äº†ä¸ JournalNode é›†ç¾¤è¿›è¡Œé€šä¿¡çš„ AsyncLogger åˆ—è¡¨ï¼Œæ¯ä¸€ä¸ª AsyncLogger å¯¹åº”äºä¸€ä¸ª JournalNode èŠ‚ç‚¹ï¼Œå¦å¤– AsyncLoggerSet ä¹ŸåŒ…å«äº†ç”¨äºç­‰å¾…å¤§å¤šæ•° JournalNode è¿”å›ç»“æœçš„å·¥å…·ç±»æ–¹æ³•ç»™ QuorumJournalManager ä½¿ç”¨ã€‚AsyncLoggerï¼šå…·ä½“çš„å®ç°ç±»æ˜¯ IPCLoggerChannelï¼ŒIPCLoggerChannel åœ¨æ‰§è¡Œæ–¹æ³•è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šæŠŠè°ƒç”¨æäº¤åˆ°ä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± ä¹‹ä¸­ï¼Œç”±çº¿ç¨‹æ± çº¿ç¨‹æ¥è´Ÿè´£å‘å¯¹åº”çš„ JournalNode çš„ JournalNodeRpcServer å‘é€ RPC è¯·æ±‚ã€‚JournalNodeRpcServerï¼šè¿è¡Œåœ¨ JournalNode èŠ‚ç‚¹è¿›ç¨‹ä¸­çš„ RPC æœåŠ¡ï¼Œæ¥æ”¶ NameNode ç«¯çš„ AsyncLogger çš„ RPC è¯·æ±‚ã€‚JournalNodeHttpServerï¼šè¿è¡Œåœ¨ JournalNode èŠ‚ç‚¹è¿›ç¨‹ä¸­çš„ Http æœåŠ¡ï¼Œç”¨äºæ¥æ”¶å¤„äº Standby çŠ¶æ€çš„ NameNode å’Œå…¶å®ƒ JournalNode çš„åŒæ­¥ EditLog æ–‡ä»¶æµçš„è¯·æ±‚ã€‚ä¸‹é¢å¯¹åŸºäº QJM çš„å…±äº«å­˜å‚¨ç³»ç»Ÿçš„ä¸¤ä¸ªå…³é”®æ€§é—®é¢˜åŒæ­¥æ•°æ®å’Œæ¢å¤æ•°æ®è¿›è¡Œè¯¦ç»†åˆ†æã€‚åŸºäº QJM çš„å…±äº«å­˜å‚¨ç³»ç»Ÿçš„æ•°æ®åŒæ­¥æœºåˆ¶åˆ†æActive NameNode å’Œ StandbyNameNode ä½¿ç”¨ JouranlNode é›†ç¾¤æ¥è¿›è¡Œæ•°æ®åŒæ­¥çš„è¿‡ç¨‹å¦‚å›¾ 5 æ‰€ç¤ºï¼ŒActive NameNode é¦–å…ˆæŠŠ EditLog æäº¤åˆ° JournalNode é›†ç¾¤ï¼Œç„¶å Standby NameNode å†ä» JournalNode é›†ç¾¤å®šæ—¶åŒæ­¥ EditLogï¼šå›¾ 5 . åŸºäº QJM çš„å…±äº«å­˜å‚¨çš„æ•°æ®åŒæ­¥æœºåˆ¶Active NameNode æäº¤ EditLog åˆ° JournalNode é›†ç¾¤å½“å¤„äº Active çŠ¶æ€çš„ NameNode è°ƒç”¨ FSEditLog ç±»çš„ logSync æ–¹æ³•æ¥æäº¤ EditLog çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ JouranlSet åŒæ—¶å‘æœ¬åœ°ç£ç›˜ç›®å½•å’Œ JournalNode é›†ç¾¤ä¸Šçš„å…±äº«å­˜å‚¨ç›®å½•å†™å…¥ EditLogã€‚å†™å…¥ JournalNode é›†ç¾¤æ˜¯é€šè¿‡å¹¶è¡Œè°ƒç”¨æ¯ä¸€ä¸ª JournalNode çš„ QJournalProtocol RPC æ¥å£çš„ journal æ–¹æ³•å®ç°çš„ï¼Œå¦‚æœå¯¹å¤§å¤šæ•° JournalNode çš„ journal æ–¹æ³•è°ƒç”¨æˆåŠŸï¼Œé‚£ä¹ˆå°±è®¤ä¸ºæäº¤ EditLog æˆåŠŸï¼Œå¦åˆ™ NameNode å°±ä¼šè®¤ä¸ºè¿™æ¬¡æäº¤ EditLog å¤±è´¥ã€‚æäº¤ EditLog å¤±è´¥ä¼šå¯¼è‡´ Active NameNode å…³é—­ JournalSet ä¹‹åé€€å‡ºè¿›ç¨‹ï¼Œç•™å¾…å¤„äº Standby çŠ¶æ€çš„ NameNode æ¥ç®¡ä¹‹åè¿›è¡Œæ•°æ®æ¢å¤ã€‚ä»ä¸Šé¢çš„å™è¿°å¯ä»¥çœ‹å‡ºï¼ŒActive NameNode æäº¤ EditLog åˆ° JournalNode é›†ç¾¤çš„è¿‡ç¨‹å®é™…ä¸Šæ˜¯åŒæ­¥é˜»å¡çš„ï¼Œä½†æ˜¯å¹¶ä¸éœ€è¦æ‰€æœ‰çš„ JournalNode éƒ½è°ƒç”¨æˆåŠŸï¼Œåªè¦å¤§å¤šæ•° JournalNode è°ƒç”¨æˆåŠŸå°±å¯ä»¥äº†ã€‚å¦‚æœæ— æ³•å½¢æˆå¤§å¤šæ•°ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºæäº¤ EditLog å¤±è´¥ï¼ŒNameNode åœæ­¢æœåŠ¡é€€å‡ºè¿›ç¨‹ã€‚å¦‚æœå¯¹åº”åˆ°åˆ†å¸ƒå¼ç³»ç»Ÿçš„ CAP ç†è®ºçš„è¯ï¼Œè™½ç„¶é‡‡ç”¨äº† Paxos çš„â€œå¤§å¤šæ•°â€æ€æƒ³å¯¹ C(consistencyï¼Œä¸€è‡´æ€§) å’Œ A(availabilityï¼Œå¯ç”¨æ€§) è¿›è¡Œäº†æŠ˜è¡·ï¼Œä½†è¿˜æ˜¯å¯ä»¥è®¤ä¸º NameNode é€‰æ‹©äº† C è€Œæ”¾å¼ƒäº† Aï¼Œè¿™ä¹Ÿç¬¦åˆ NameNode å¯¹æ•°æ®ä¸€è‡´æ€§çš„è¦æ±‚ã€‚Standby NameNode ä» JournalNode é›†ç¾¤åŒæ­¥ EditLogå½“ NameNode è¿›å…¥ Standby çŠ¶æ€ä¹‹åï¼Œä¼šå¯åŠ¨ä¸€ä¸ª EditLogTailer çº¿ç¨‹ã€‚è¿™ä¸ªçº¿ç¨‹ä¼šå®šæœŸè°ƒç”¨ EditLogTailer ç±»çš„ doTailEdits æ–¹æ³•ä» JournalNode é›†ç¾¤ä¸ŠåŒæ­¥ EditLogï¼Œç„¶åæŠŠåŒæ­¥çš„ EditLog å›æ”¾åˆ°å†…å­˜ä¹‹ä¸­çš„æ–‡ä»¶ç³»ç»Ÿé•œåƒä¸Š (å¹¶ä¸ä¼šåŒæ—¶æŠŠ EditLog å†™å…¥åˆ°æœ¬åœ°ç£ç›˜ä¸Š)ã€‚è¿™é‡Œéœ€è¦å…³æ³¨çš„æ˜¯ï¼šä» JournalNode é›†ç¾¤ä¸ŠåŒæ­¥çš„ EditLog éƒ½æ˜¯å¤„äº finalized çŠ¶æ€çš„ EditLog Segmentã€‚â€œNameNode çš„å…ƒæ•°æ®å­˜å‚¨æ¦‚è¿°â€ä¸€èŠ‚è¯´è¿‡ EditLog Segment å®é™…ä¸Šæœ‰ä¸¤ç§çŠ¶æ€ï¼Œå¤„äº in-progress çŠ¶æ€çš„ Edit Log å½“å‰æ­£åœ¨è¢«å†™å…¥ï¼Œè¢«è®¤ä¸ºæ˜¯å¤„äºä¸ç¨³å®šçš„ä¸­é—´æ€ï¼Œæœ‰å¯èƒ½ä¼šåœ¨åç»­çš„è¿‡ç¨‹ä¹‹ä¸­å‘ç”Ÿä¿®æ”¹ï¼Œæ¯”å¦‚è¢«æˆªæ–­ã€‚Active NameNode åœ¨å®Œæˆä¸€ä¸ª EditLog Segment çš„å†™å…¥ä¹‹åï¼Œå°±ä¼šå‘ JournalNode é›†ç¾¤å‘é€ finalizeLogSegment RPC è¯·æ±‚ï¼Œå°†å®Œæˆå†™å…¥çš„ EditLog Segment finalizedï¼Œç„¶åå¼€å§‹ä¸‹ä¸€ä¸ªæ–°çš„ EditLog Segmentã€‚ä¸€æ—¦ finalizeLogSegment æ–¹æ³•åœ¨å¤§å¤šæ•°çš„ JournalNode ä¸Šè°ƒç”¨æˆåŠŸï¼Œè¡¨æ˜è¿™ä¸ª EditLog Segment å·²ç»åœ¨å¤§å¤šæ•°çš„ JournalNode ä¸Šè¾¾æˆä¸€è‡´ã€‚ä¸€ä¸ª EditLog Segment å¤„äº finalized çŠ¶æ€ä¹‹åï¼Œå¯ä»¥ä¿è¯å®ƒå†ä¹Ÿä¸ä¼šå˜åŒ–ã€‚ä»ä¸Šé¢æè¿°çš„è¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶ Active NameNode å‘ JournalNode é›†ç¾¤æäº¤ EditLog æ˜¯åŒæ­¥çš„ï¼Œä½† Standby NameNode é‡‡ç”¨çš„æ˜¯å®šæ—¶ä» JournalNode é›†ç¾¤ä¸ŠåŒæ­¥ EditLog çš„æ–¹å¼ï¼Œé‚£ä¹ˆ Standby NameNode å†…å­˜ä¸­æ–‡ä»¶ç³»ç»Ÿé•œåƒæœ‰å¾ˆå¤§çš„å¯èƒ½æ˜¯è½åäº Active NameNode çš„ï¼Œæ‰€ä»¥ Standby NameNode åœ¨è½¬æ¢ä¸º Active NameNode çš„æ—¶å€™éœ€è¦æŠŠè½åçš„ EditLog è¡¥ä¸Šæ¥ã€‚åŸºäº QJM çš„å…±äº«å­˜å‚¨ç³»ç»Ÿçš„æ•°æ®æ¢å¤æœºåˆ¶åˆ†æå¤„äº Standby çŠ¶æ€çš„ NameNode è½¬æ¢ä¸º Active çŠ¶æ€çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¸Šä¸€ä¸ª Active NameNode å‘ç”Ÿäº†å¼‚å¸¸é€€å‡ºï¼Œé‚£ä¹ˆ JournalNode é›†ç¾¤ä¸­å„ä¸ª JournalNode ä¸Šçš„ EditLog å°±å¯èƒ½ä¼šå¤„äºä¸ä¸€è‡´çš„çŠ¶æ€ï¼Œæ‰€ä»¥é¦–å…ˆè¦åšçš„äº‹æƒ…å°±æ˜¯è®© JournalNode é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹ä¸Šçš„ EditLog æ¢å¤ä¸ºä¸€è‡´ã€‚å¦å¤–å¦‚å‰æ‰€è¿°ï¼Œå½“å‰å¤„äº Standby çŠ¶æ€çš„ NameNode çš„å†…å­˜ä¸­çš„æ–‡ä»¶ç³»ç»Ÿé•œåƒæœ‰å¾ˆå¤§çš„å¯èƒ½æ˜¯è½åäºæ—§çš„ Active NameNode çš„ï¼Œæ‰€ä»¥åœ¨ JournalNode é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹ä¸Šçš„ EditLog è¾¾æˆä¸€è‡´ä¹‹åï¼Œæ¥ä¸‹æ¥è¦åšçš„äº‹æƒ…å°±æ˜¯ä» JournalNode é›†ç¾¤ä¸Šè¡¥é½è½åçš„ EditLogã€‚åªæœ‰åœ¨è¿™ä¸¤æ­¥å®Œæˆä¹‹åï¼Œå½“å‰æ–°çš„ Active NameNode æ‰èƒ½å®‰å…¨åœ°å¯¹å¤–æä¾›æœåŠ¡ã€‚è¡¥é½è½åçš„ EditLog çš„è¿‡ç¨‹å¤ç”¨äº†å‰é¢æè¿°çš„ Standby NameNode ä» JournalNode é›†ç¾¤åŒæ­¥ EditLog çš„é€»è¾‘å’Œä»£ç ï¼Œæœ€ç»ˆè°ƒç”¨ EditLogTailer ç±»çš„ doTailEdits æ–¹æ³•æ¥å®Œæˆ EditLog çš„è¡¥é½ã€‚ä½¿ JournalNode é›†ç¾¤ä¸Šçš„ EditLog è¾¾æˆä¸€è‡´çš„è¿‡ç¨‹æ˜¯ä¸€è‡´æ€§ç®—æ³• Paxos çš„å…¸å‹åº”ç”¨åœºæ™¯ï¼ŒQJM å¯¹è¿™éƒ¨åˆ†çš„å¤„ç†å¯ä»¥çœ‹åšæ˜¯ Single Instance Paxos(å‚è§å‚è€ƒæ–‡çŒ® [3]) ç®—æ³•çš„ä¸€ä¸ªå®ç°ï¼Œåœ¨è¾¾æˆä¸€è‡´çš„è¿‡ç¨‹ä¸­ï¼ŒActive NameNode å’Œ JournalNode é›†ç¾¤ä¹‹é—´çš„äº¤äº’æµç¨‹å¦‚å›¾ 6 æ‰€ç¤ºï¼Œå…·ä½“æè¿°å¦‚ä¸‹ï¼šå›¾ 6.Active NameNode å’Œ JournalNode é›†ç¾¤çš„äº¤äº’æµç¨‹å›¾ç”Ÿæˆä¸€ä¸ªæ–°çš„ EpochEpoch æ˜¯ä¸€ä¸ªå•è°ƒé€’å¢çš„æ•´æ•°ï¼Œç”¨æ¥æ ‡è¯†æ¯ä¸€æ¬¡ Active NameNode çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¯å‘ç”Ÿä¸€æ¬¡ NameNode çš„ä¸»å¤‡åˆ‡æ¢ï¼ŒEpoch å°±ä¼šåŠ  1ã€‚è¿™å®é™…ä¸Šæ˜¯ä¸€ç§ fencing æœºåˆ¶ï¼Œä¸ºä»€ä¹ˆéœ€è¦ fencing å·²ç»åœ¨å‰é¢â€œActiveStandbyElector å®ç°åˆ†æâ€ä¸€èŠ‚çš„â€œé˜²æ­¢è„‘è£‚â€éƒ¨åˆ†è¿›è¡Œäº†è¯´æ˜ã€‚äº§ç”Ÿæ–° Epoch çš„æµç¨‹ä¸ Zookeeper çš„ ZAB(Zookeeper Atomic Broadcast) åè®®åœ¨è¿›è¡Œæ•°æ®æ¢å¤ä¹‹å‰äº§ç”Ÿæ–° Epoch çš„è¿‡ç¨‹å®Œå…¨ç±»ä¼¼ï¼šActive NameNode é¦–å…ˆå‘ JournalNode é›†ç¾¤å‘é€ getJournalState RPC è¯·æ±‚ï¼Œæ¯ä¸ª JournalNode ä¼šè¿”å›è‡ªå·±ä¿å­˜çš„æœ€è¿‘çš„é‚£ä¸ª Epoch(ä»£ç ä¸­å« lastPromisedEpoch)ã€‚NameNode æ”¶åˆ°å¤§å¤šæ•°çš„ JournalNode è¿”å›çš„ Epoch ä¹‹åï¼Œåœ¨å…¶ä¸­é€‰æ‹©æœ€å¤§çš„ä¸€ä¸ªåŠ  1 ä½œä¸ºå½“å‰çš„æ–° Epochï¼Œç„¶åå‘å„ä¸ª JournalNode å‘é€ newEpoch RPC è¯·æ±‚ï¼ŒæŠŠè¿™ä¸ªæ–°çš„ Epoch å‘ç»™å„ä¸ª JournalNodeã€‚æ¯ä¸€ä¸ª JournalNode åœ¨æ”¶åˆ°æ–°çš„ Epoch ä¹‹åï¼Œé¦–å…ˆæ£€æŸ¥è¿™ä¸ªæ–°çš„ Epoch æ˜¯å¦æ¯”å®ƒæœ¬åœ°ä¿å­˜çš„ lastPromisedEpoch å¤§ï¼Œå¦‚æœå¤§çš„è¯å°±æŠŠ lastPromisedEpoch æ›´æ–°ä¸ºè¿™ä¸ªæ–°çš„ Epochï¼Œå¹¶ä¸”å‘ NameNode è¿”å›å®ƒè‡ªå·±çš„æœ¬åœ°ç£ç›˜ä¸Šæœ€æ–°çš„ä¸€ä¸ª EditLogSegment çš„èµ·å§‹äº‹åŠ¡ idï¼Œä¸ºåé¢çš„æ•°æ®æ¢å¤è¿‡ç¨‹åšå¥½å‡†å¤‡ã€‚å¦‚æœå°äºæˆ–ç­‰äºçš„è¯å°±å‘ NameNode è¿”å›é”™è¯¯ã€‚NameNode æ”¶åˆ°å¤§å¤šæ•° JournalNode å¯¹ newEpoch çš„æˆåŠŸå“åº”ä¹‹åï¼Œå°±ä¼šè®¤ä¸ºç”Ÿæˆæ–°çš„ Epoch æˆåŠŸã€‚åœ¨ç”Ÿæˆæ–°çš„ Epoch ä¹‹åï¼Œæ¯æ¬¡ NameNode åœ¨å‘ JournalNode é›†ç¾¤æäº¤ EditLog çš„æ—¶å€™ï¼Œéƒ½ä¼šæŠŠè¿™ä¸ª Epoch ä½œä¸ºå‚æ•°ä¼ é€’è¿‡å»ã€‚æ¯ä¸ª JournalNode ä¼šæ¯”è¾ƒä¼ è¿‡æ¥çš„ Epoch å’Œå®ƒè‡ªå·±ä¿å­˜çš„ lastPromisedEpoch çš„å¤§å°ï¼Œå¦‚æœä¼ è¿‡æ¥çš„ epoch çš„å€¼æ¯”å®ƒè‡ªå·±ä¿å­˜çš„ lastPromisedEpoch å°çš„è¯ï¼Œé‚£ä¹ˆè¿™æ¬¡å†™ç›¸å…³æ“ä½œä¼šè¢«æ‹’ç»ã€‚ä¸€æ—¦å¤§å¤šæ•° JournalNode éƒ½æ‹’ç»äº†è¿™æ¬¡å†™æ“ä½œï¼Œé‚£ä¹ˆè¿™æ¬¡å†™æ“ä½œå°±å¤±è´¥äº†ã€‚å¦‚æœåŸæ¥çš„ Active NameNode æ¢å¤æ­£å¸¸ä¹‹åå†å‘ JournalNode å†™ EditLogï¼Œé‚£ä¹ˆå› ä¸ºå®ƒçš„ Epoch è‚¯å®šæ¯”æ–°ç”Ÿæˆçš„ Epoch å°ï¼Œå¹¶ä¸”å¤§å¤šæ•°çš„ JournalNode éƒ½æ¥å—äº†è¿™ä¸ªæ–°ç”Ÿæˆçš„ Epochï¼Œæ‰€ä»¥æ‹’ç»å†™å…¥çš„ JournalNode æ•°ç›®è‡³å°‘æ˜¯å¤§å¤šæ•°ï¼Œè¿™æ ·åŸæ¥çš„ Active NameNode å†™ EditLog å°±è‚¯å®šä¼šå¤±è´¥ï¼Œå¤±è´¥ä¹‹åè¿™ä¸ª NameNode è¿›ç¨‹ä¼šç›´æ¥é€€å‡ºï¼Œè¿™æ ·å°±å®ç°äº†å¯¹åŸæ¥çš„ Active NameNode çš„éš”ç¦»äº†ã€‚é€‰æ‹©éœ€è¦æ•°æ®æ¢å¤çš„ EditLog Segment çš„ idéœ€è¦æ¢å¤çš„ Edit Log åªå¯èƒ½æ˜¯å„ä¸ª JournalNode ä¸Šçš„æœ€åä¸€ä¸ª Edit Log Segmentï¼Œå¦‚å‰æ‰€è¿°ï¼ŒJournalNode åœ¨å¤„ç†å®Œ newEpoch RPC è¯·æ±‚ä¹‹åï¼Œä¼šå‘ NameNode è¿”å›å®ƒè‡ªå·±çš„æœ¬åœ°ç£ç›˜ä¸Šæœ€æ–°çš„ä¸€ä¸ª EditLog Segment çš„èµ·å§‹äº‹åŠ¡ idï¼Œè¿™ä¸ªèµ·å§‹äº‹åŠ¡ id å®é™…ä¸Šä¹Ÿä½œä¸ºè¿™ä¸ª EditLog Segment çš„ idã€‚NameNode ä¼šåœ¨æ‰€æœ‰è¿™äº› id ä¹‹ä¸­é€‰æ‹©ä¸€ä¸ªæœ€å¤§çš„ id ä½œä¸ºè¦è¿›è¡Œæ•°æ®æ¢å¤çš„ EditLog Segment çš„ idã€‚å‘ JournalNode é›†ç¾¤å‘é€ prepareRecovery RPC è¯·æ±‚NameNode æ¥ä¸‹æ¥å‘ JournalNode é›†ç¾¤å‘é€ prepareRecovery RPC è¯·æ±‚ï¼Œè¯·æ±‚çš„å‚æ•°å°±æ˜¯é€‰å‡ºçš„ EditLog Segment çš„ idã€‚JournalNode æ”¶åˆ°è¯·æ±‚åè¿”å›æœ¬åœ°ç£ç›˜ä¸Šè¿™ä¸ª Segment çš„èµ·å§‹äº‹åŠ¡ idã€ç»“æŸäº‹åŠ¡ id å’ŒçŠ¶æ€ (in-progress æˆ– finalized)ã€‚è¿™ä¸€æ­¥å¯¹åº”äº Paxos ç®—æ³•çš„ Phase 1a å’Œ Phase 1b(å‚è§å‚è€ƒæ–‡çŒ® [3]) ä¸¤æ­¥ã€‚Paxos ç®—æ³•çš„ Phase1 æ˜¯ prepare é˜¶æ®µï¼Œè¿™ä¹Ÿä¸æ–¹æ³•å prepareRecovery ç›¸å¯¹åº”ã€‚å¹¶ä¸”è¿™é‡Œä»¥å‰é¢äº§ç”Ÿçš„æ–°çš„ Epoch ä½œä¸º Paxos ç®—æ³•ä¸­çš„ææ¡ˆç¼–å· (proposal number)ã€‚åªè¦å¤§å¤šæ•°çš„ JournalNode çš„ prepareRecovery RPC è°ƒç”¨æˆåŠŸè¿”å›ï¼ŒNameNode å°±è®¤ä¸ºæˆåŠŸã€‚é€‰æ‹©è¿›è¡ŒåŒæ­¥çš„åŸºå‡†æ•°æ®æºï¼Œå‘ JournalNode é›†ç¾¤å‘é€ acceptRecovery RPC è¯·æ±‚ NameNode æ ¹æ® prepareRecovery çš„è¿”å›ç»“æœï¼Œé€‰æ‹©ä¸€ä¸ª JournalNode ä¸Šçš„ EditLog Segment ä½œä¸ºåŒæ­¥çš„åŸºå‡†æ•°æ®æºã€‚é€‰æ‹©åŸºå‡†æ•°æ®æºçš„åŸåˆ™å¤§è‡´æ˜¯ï¼šåœ¨ in-progress çŠ¶æ€å’Œ finalized çŠ¶æ€çš„ Segment ä¹‹é—´ä¼˜å…ˆé€‰æ‹© finalized çŠ¶æ€çš„ Segmentã€‚å¦‚æœéƒ½æ˜¯ in-progress çŠ¶æ€çš„è¯ï¼Œé‚£ä¹ˆä¼˜å…ˆé€‰æ‹© Epoch æ¯”è¾ƒé«˜çš„ Segment(ä¹Ÿå°±æ˜¯ä¼˜å…ˆé€‰æ‹©æ›´æ–°çš„)ï¼Œå¦‚æœ Epoch ä¹Ÿä¸€æ ·ï¼Œé‚£ä¹ˆä¼˜å…ˆé€‰æ‹©åŒ…å«çš„äº‹åŠ¡æ•°æ›´å¤šçš„ Segmentã€‚åœ¨é€‰å®šäº†åŒæ­¥çš„åŸºå‡†æ•°æ®æºä¹‹åï¼ŒNameNode å‘ JournalNode é›†ç¾¤å‘é€ acceptRecovery RPC è¯·æ±‚ï¼Œå°†é€‰å®šçš„åŸºå‡†æ•°æ®æºä½œä¸ºå‚æ•°ã€‚JournalNode æ¥æ”¶åˆ° acceptRecovery RPC è¯·æ±‚ä¹‹åï¼Œä»åŸºå‡†æ•°æ®æº JournalNode çš„ JournalNodeHttpServer ä¸Šä¸‹è½½ EditLog Segmentï¼Œå°†æœ¬åœ°çš„ EditLog Segment æ›¿æ¢ä¸ºä¸‹è½½çš„ EditLog Segmentã€‚è¿™ä¸€æ­¥å¯¹åº”äº Paxos ç®—æ³•çš„ Phase 2a å’Œ Phase 2b(å‚è§å‚è€ƒæ–‡çŒ® [3]) ä¸¤æ­¥ã€‚Paxos ç®—æ³•çš„ Phase2 æ˜¯ accept é˜¶æ®µï¼Œè¿™ä¹Ÿä¸æ–¹æ³•å acceptRecovery ç›¸å¯¹åº”ã€‚åªè¦å¤§å¤šæ•° JournalNode çš„ acceptRecovery RPC è°ƒç”¨æˆåŠŸè¿”å›ï¼ŒNameNode å°±è®¤ä¸ºæˆåŠŸã€‚å‘ JournalNode é›†ç¾¤å‘é€ finalizeLogSegment RPC è¯·æ±‚ï¼Œæ•°æ®æ¢å¤å®Œæˆä¸Šä¸€æ­¥æ‰§è¡Œå®Œæˆä¹‹åï¼ŒNameNode ç¡®è®¤å¤§å¤šæ•° JournalNode ä¸Šçš„ EditLog Segment å·²ç»ä»åŸºå‡†æ•°æ®æºè¿›è¡Œäº†åŒæ­¥ã€‚æ¥ä¸‹æ¥ï¼ŒNameNode å‘ JournalNode é›†ç¾¤å‘é€ finalizeLogSegment RPC è¯·æ±‚ï¼ŒJournalNode æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œå°†å¯¹åº”çš„ EditLog Segment ä» in-progress çŠ¶æ€è½¬æ¢ä¸º finalized çŠ¶æ€ï¼Œå®é™…ä¸Šå°±æ˜¯å°†æ–‡ä»¶åä» edits_inprogress_${startTxid} é‡å‘½åä¸º edits_${startTxid}-${endTxid}ï¼Œè§â€œNameNode çš„å…ƒæ•°æ®å­˜å‚¨æ¦‚è¿°â€ä¸€èŠ‚çš„æè¿°ã€‚åªè¦å¤§å¤šæ•° JournalNode çš„ finalizeLogSegment RPC è°ƒç”¨æˆåŠŸè¿”å›ï¼ŒNameNode å°±è®¤ä¸ºæˆåŠŸã€‚æ­¤æ—¶å¯ä»¥ä¿è¯ JournalNode é›†ç¾¤çš„å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šçš„ EditLog å·²ç»å¤„äºä¸€è‡´çš„çŠ¶æ€ï¼Œè¿™æ · NameNode æ‰èƒ½å®‰å…¨åœ°ä» JournalNode é›†ç¾¤ä¸Šè¡¥é½è½åçš„ EditLog æ•°æ®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡åŸºäº QJM çš„å…±äº«å­˜å‚¨æ–¹æ¡ˆçœ‹èµ·æ¥ç†è®ºå®Œå¤‡ï¼Œè®¾è®¡ç²¾å·§ï¼Œä½†æ˜¯ä»ç„¶æ— æ³•ä¿è¯æ•°æ®çš„ç»å¯¹å¼ºä¸€è‡´ï¼Œä¸‹é¢é€‰å–å‚è€ƒæ–‡çŒ® [2] ä¸­çš„ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ï¼šå‡è®¾æœ‰ 3 ä¸ª JournalNodeï¼šJN1ã€JN2 å’Œ JN3ï¼ŒActive NameNode å‘é€äº†äº‹åŠ¡ id ä¸º 151ã€152 å’Œ 153 çš„ 3 ä¸ªäº‹åŠ¡åˆ° JournalNode é›†ç¾¤ï¼Œè¿™ 3 ä¸ªäº‹åŠ¡æˆåŠŸåœ°å†™å…¥äº† JN2ï¼Œä½†æ˜¯åœ¨è¿˜æ²¡èƒ½å†™å…¥ JN1 å’Œ JN3 ä¹‹å‰ï¼ŒActive NameNode å°±å®•æœºäº†ã€‚åŒæ—¶ï¼ŒJN3 åœ¨æ•´ä¸ªå†™å…¥çš„è¿‡ç¨‹ä¸­å»¶è¿Ÿè¾ƒå¤§ï¼Œè½åäº JN1 å’Œ JN2ã€‚æœ€ç»ˆæˆåŠŸå†™å…¥ JN1 çš„äº‹åŠ¡ id ä¸º 150ï¼ŒæˆåŠŸå†™å…¥ JN2 çš„äº‹åŠ¡ id ä¸º 153ï¼Œè€Œå†™å…¥åˆ° JN3 çš„äº‹åŠ¡ id ä»…ä¸º 125ï¼Œå¦‚å›¾ 7 æ‰€ç¤º (å›¾ç‰‡æ¥æºäºå‚è€ƒæ–‡çŒ® [2])ã€‚æŒ‰ç…§å‰é¢æè¿°çš„åªæœ‰æˆåŠŸåœ°å†™å…¥äº†å¤§å¤šæ•°çš„ JournalNode æ‰è®¤ä¸ºå†™å…¥æˆåŠŸçš„åŸåˆ™ï¼Œæ˜¾ç„¶äº‹åŠ¡ id ä¸º 151ã€152 å’Œ 153 çš„è¿™ 3 ä¸ªäº‹åŠ¡åªèƒ½ç®—ä½œå†™å…¥å¤±è´¥ã€‚åœ¨è¿›è¡Œæ•°æ®æ¢å¤çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå‘ç”Ÿä¸‹é¢ä¸¤ç§æƒ…å†µï¼šå›¾ 7.JournalNode é›†ç¾¤å†™å…¥çš„äº‹åŠ¡ id æƒ…å†µå¦‚æœéšåçš„ Active NameNode è¿›è¡Œæ•°æ®æ¢å¤æ—¶åœ¨ prepareRecovery é˜¶æ®µæ”¶åˆ°äº† JN2 çš„å›å¤ï¼Œé‚£ä¹ˆè‚¯å®šä¼šä»¥ JN2 å¯¹åº”çš„ EditLog Segment ä¸ºåŸºå‡†æ¥è¿›è¡Œæ•°æ®æ¢å¤ï¼Œè¿™æ ·æœ€ååœ¨å¤šæ•° JournalNode ä¸Šçš„ EditLog Segment ä¼šæ¢å¤åˆ°äº‹åŠ¡ 153ã€‚ä»æ¢å¤çš„ç»“æœæ¥çœ‹ï¼Œå®é™…ä¸Šå¯ä»¥è®¤ä¸ºå‰é¢å®•æœºçš„ Active NameNode å¯¹äº‹åŠ¡ id ä¸º 151ã€152 å’Œ 153 çš„è¿™ 3 ä¸ªäº‹åŠ¡çš„å†™å…¥æˆåŠŸäº†ã€‚ä½†æ˜¯å¦‚æœä» NameNode è‡ªèº«çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¾ç„¶å°±å‘ç”Ÿäº†æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚å¦‚æœéšåçš„ Active NameNode è¿›è¡Œæ•°æ®æ¢å¤æ—¶åœ¨ prepareRecovery é˜¶æ®µæ²¡æœ‰æ”¶åˆ° JN2 çš„å›å¤ï¼Œé‚£ä¹ˆè‚¯å®šä¼šä»¥ JN1 å¯¹åº”çš„ EditLog Segment ä¸ºåŸºå‡†æ¥è¿›è¡Œæ•°æ®æ¢å¤ï¼Œè¿™æ ·æœ€ååœ¨å¤šæ•° JournalNode ä¸Šçš„ EditLog Segment ä¼šæ¢å¤åˆ°äº‹åŠ¡ 150ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä» NameNode è‡ªèº«çš„è§’åº¦æ¥çœ‹çš„è¯ï¼Œæ•°æ®å°±æ˜¯ä¸€è‡´çš„äº†ã€‚äº‹å®ä¸Šä¸å…‰æœ¬æ–‡æè¿°çš„åŸºäº QJM çš„å…±äº«å­˜å‚¨æ–¹æ¡ˆæ— æ³•ä¿è¯æ•°æ®çš„ç»å¯¹ä¸€è‡´ï¼Œå¤§å®¶é€šå¸¸è®¤ä¸ºçš„ä¸€è‡´æ€§ç¨‹åº¦éå¸¸é«˜çš„ Zookeeper ä¹Ÿä¼šå‘ç”Ÿç±»ä¼¼çš„æƒ…å†µï¼Œè¿™ä¹Ÿä»ä¾§é¢è¯´æ˜äº†è¦å®ç°ä¸€ä¸ªæ•°æ®ç»å¯¹ä¸€è‡´çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿçš„ç¡®éå¸¸å›°éš¾ã€‚NameNode åœ¨è¿›è¡ŒçŠ¶æ€è½¬æ¢æ—¶å¯¹å…±äº«å­˜å‚¨çš„å¤„ç†ä¸‹é¢å¯¹ NameNode åœ¨è¿›è¡ŒçŠ¶æ€è½¬æ¢çš„è¿‡ç¨‹ä¸­å¯¹å…±äº«å­˜å‚¨çš„å¤„ç†è¿›è¡Œæè¿°ï¼Œä½¿å¾—å¤§å®¶å¯¹åŸºäº QJM çš„å…±äº«å­˜å‚¨æ–¹æ¡ˆæœ‰ä¸€ä¸ªå®Œæ•´çš„äº†è§£ï¼ŒåŒæ—¶ä¹Ÿä½œä¸ºæœ¬éƒ¨åˆ†çš„æ€»ç»“ã€‚NameNode åˆå§‹åŒ–å¯åŠ¨ï¼Œè¿›å…¥ Standby çŠ¶æ€åœ¨ NameNode ä»¥ HA æ¨¡å¼å¯åŠ¨çš„æ—¶å€™ï¼ŒNameNode ä¼šè®¤ä¸ºè‡ªå·±å¤„äº Standby æ¨¡å¼ï¼Œåœ¨ NameNode çš„æ„é€ å‡½æ•°ä¸­ä¼šåŠ è½½ FSImage æ–‡ä»¶å’Œ EditLog Segment æ–‡ä»¶æ¥æ¢å¤è‡ªå·±çš„å†…å­˜æ–‡ä»¶ç³»ç»Ÿé•œåƒã€‚åœ¨åŠ è½½ EditLog Segment çš„æ—¶å€™ï¼Œè°ƒç”¨ FSEditLog ç±»çš„ initSharedJournalsForRead æ–¹æ³•æ¥åˆ›å»ºåªåŒ…å«äº†åœ¨ JournalNode é›†ç¾¤ä¸Šçš„å…±äº«ç›®å½•çš„ JournalSetï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ—¶å€™åªä¼šä» JournalNode é›†ç¾¤ä¹‹ä¸­åŠ è½½ EditLogï¼Œè€Œä¸ä¼šåŠ è½½æœ¬åœ°ç£ç›˜ä¸Šçš„ EditLogã€‚å¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒåŠ è½½çš„ EditLog Segment åªæ˜¯å¤„äº finalized çŠ¶æ€çš„ EditLog Segmentï¼Œè€Œå¤„äº in-progress çŠ¶æ€çš„ Segment éœ€è¦åç»­åœ¨åˆ‡æ¢ä¸º Active çŠ¶æ€çš„æ—¶å€™ï¼Œè¿›è¡Œä¸€æ¬¡æ•°æ®æ¢å¤è¿‡ç¨‹ï¼Œå°† in-progress çŠ¶æ€çš„ Segment è½¬æ¢ä¸º finalized çŠ¶æ€çš„ Segment ä¹‹åå†è¿›è¡Œè¯»å–ã€‚åŠ è½½å®Œ FSImage æ–‡ä»¶å’Œå…±äº«ç›®å½•ä¸Šçš„ EditLog Segment æ–‡ä»¶ä¹‹åï¼ŒNameNode ä¼šå¯åŠ¨ EditLogTailer çº¿ç¨‹å’Œ StandbyCheckpointer çº¿ç¨‹ï¼Œæ­£å¼è¿›å…¥ Standby æ¨¡å¼ã€‚å¦‚å‰æ‰€è¿°ï¼ŒEditLogTailer çº¿ç¨‹çš„ä½œç”¨æ˜¯å®šæ—¶ä» JournalNode é›†ç¾¤ä¸ŠåŒæ­¥ EditLogã€‚è€Œ StandbyCheckpointer çº¿ç¨‹çš„ä½œç”¨å…¶å®æ˜¯ä¸ºäº†æ›¿ä»£ Hadoop 1.x ç‰ˆæœ¬ä¹‹ä¸­çš„ Secondary NameNode çš„åŠŸèƒ½ï¼ŒStandbyCheckpointer çº¿ç¨‹ä¼šåœ¨ Standby NameNode èŠ‚ç‚¹ä¸Šå®šæœŸè¿›è¡Œ Checkpointï¼Œå°† Checkpoint ä¹‹åçš„ FSImage æ–‡ä»¶ä¸Šä¼ åˆ° Active NameNode èŠ‚ç‚¹ã€‚NameNode ä» Standby çŠ¶æ€åˆ‡æ¢ä¸º Active çŠ¶æ€å½“ NameNode ä» Standby çŠ¶æ€åˆ‡æ¢ä¸º Active çŠ¶æ€çš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦åšçš„å°±æ˜¯åœæ­¢å®ƒåœ¨ Standby çŠ¶æ€çš„æ—¶å€™å¯åŠ¨çš„çº¿ç¨‹å’Œç›¸å…³çš„æœåŠ¡ï¼ŒåŒ…æ‹¬ä¸Šé¢æåˆ°çš„ EditLogTailer çº¿ç¨‹å’Œ StandbyCheckpointer çº¿ç¨‹ï¼Œç„¶åå…³é—­ç”¨äºè¯»å– JournalNode é›†ç¾¤çš„å…±äº«ç›®å½•ä¸Šçš„ EditLog çš„ JournalSetï¼Œæ¥ä¸‹æ¥ä¼šè°ƒç”¨ FSEditLog çš„ initJournalSetForWrite æ–¹æ³•é‡æ–°æ‰“å¼€ JournalSetã€‚ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ª JournalSet å†…éƒ¨åŒæ—¶åŒ…å«äº†æœ¬åœ°ç£ç›˜ç›®å½•å’Œ JournalNode é›†ç¾¤ä¸Šçš„å…±äº«ç›®å½•ã€‚è¿™äº›å·¥ä½œå®Œæˆä¹‹åï¼Œå°±å¼€å§‹æ‰§è¡Œâ€œåŸºäº QJM çš„å…±äº«å­˜å‚¨ç³»ç»Ÿçš„æ•°æ®æ¢å¤æœºåˆ¶åˆ†æâ€ä¸€èŠ‚æ‰€æè¿°çš„æµç¨‹ï¼Œè°ƒç”¨ FSEditLog ç±»çš„ recoverUnclosedStreams æ–¹æ³•è®© JournalNode é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹ä¸Šçš„ EditLog è¾¾æˆä¸€è‡´ã€‚ç„¶åè°ƒç”¨ EditLogTailer ç±»çš„ catchupDuringFailover æ–¹æ³•ä» JournalNode é›†ç¾¤ä¸Šè¡¥é½è½åçš„ EditLogã€‚æœ€åæ‰“å¼€ä¸€ä¸ªæ–°çš„ EditLog Segment ç”¨äºæ–°å†™å…¥æ•°æ®ï¼ŒåŒæ—¶å¯åŠ¨ Active NameNode æ‰€éœ€è¦çš„çº¿ç¨‹å’ŒæœåŠ¡ã€‚NameNode ä» Active çŠ¶æ€åˆ‡æ¢ä¸º Standby çŠ¶æ€å½“ NameNode ä» Active çŠ¶æ€åˆ‡æ¢ä¸º Standby çŠ¶æ€çš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦åšçš„å°±æ˜¯åœæ­¢å®ƒåœ¨ Active çŠ¶æ€çš„æ—¶å€™å¯åŠ¨çš„çº¿ç¨‹å’ŒæœåŠ¡ï¼Œç„¶åå…³é—­ç”¨äºè¯»å–æœ¬åœ°ç£ç›˜ç›®å½•å’Œ JournalNode é›†ç¾¤ä¸Šçš„å…±äº«ç›®å½•çš„ EditLog çš„ JournalSetã€‚æ¥ä¸‹æ¥ä¼šè°ƒç”¨ FSEditLog çš„ initSharedJournalsForRead æ–¹æ³•é‡æ–°æ‰“å¼€ç”¨äºè¯»å– JournalNode é›†ç¾¤ä¸Šçš„å…±äº«ç›®å½•çš„ JournalSetã€‚è¿™äº›å·¥ä½œå®Œæˆä¹‹åï¼Œå°±ä¼šå¯åŠ¨ EditLogTailer çº¿ç¨‹å’Œ StandbyCheckpointer çº¿ç¨‹ï¼ŒEditLogTailer çº¿ç¨‹ä¼šå®šæ—¶ä» JournalNode é›†ç¾¤ä¸ŠåŒæ­¥ Edit Logã€‚NameNode é«˜å¯ç”¨è¿ç»´ä¸­çš„æ³¨æ„äº‹é¡¹æœ¬èŠ‚ç»“åˆç¬”è€…çš„å®è·µï¼Œä»åˆå§‹åŒ–éƒ¨ç½²å’Œæ—¥å¸¸è¿ç»´ä¸¤ä¸ªæ–¹é¢ä»‹ç»ä¸€äº›åœ¨ NameNode é«˜å¯ç”¨è¿ç»´ä¸­çš„æ³¨æ„äº‹é¡¹ã€‚åˆå§‹åŒ–éƒ¨ç½²å¦‚æœåœ¨å¼€å§‹éƒ¨ç½² Hadoop é›†ç¾¤çš„æ—¶å€™å°±å¯ç”¨ NameNode çš„é«˜å¯ç”¨çš„è¯ï¼Œé‚£ä¹ˆç›¸å¯¹ä¼šæ¯”è¾ƒå®¹æ˜“ã€‚ä½†æ˜¯å¦‚æœåœ¨é‡‡ç”¨ä¼ ç»Ÿçš„å• NameNode çš„æ¶æ„è¿è¡Œäº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œå‡çº§ä¸º NameNode çš„é«˜å¯ç”¨æ¶æ„çš„è¯ï¼Œå°±è¦ç‰¹åˆ«æ³¨æ„åœ¨å‡çº§çš„æ—¶å€™éœ€è¦æŒ‰ç…§ä»¥ä¸‹çš„æ­¥éª¤è¿›è¡Œæ“ä½œï¼šå¯¹ Zookeeper è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ›å»º Zookeeper ä¸Šçš„/hadoop-ha/${dfs.nameservices} èŠ‚ç‚¹ã€‚åˆ›å»ºèŠ‚ç‚¹æ˜¯ä¸ºéšåé€šè¿‡ Zookeeper è¿›è¡Œä¸»å¤‡é€‰ä¸¾åšå¥½å‡†å¤‡ï¼Œåœ¨è¿›è¡Œä¸»å¤‡é€‰ä¸¾çš„æ—¶å€™ä¼šåœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸‹é¢åˆ›å»ºå­èŠ‚ç‚¹ (å…·ä½“å¯å‚ç…§â€œActiveStandbyElector å®ç°åˆ†æâ€ä¸€èŠ‚çš„å™è¿°)ã€‚è¿™ä¸€æ­¥é€šè¿‡åœ¨åŸæœ‰çš„ NameNode ä¸Šæ‰§è¡Œå‘½ä»¤ hdfs zkfc -formatZK æ¥å®Œæˆã€‚å¯åŠ¨æ‰€æœ‰çš„ JournalNodeï¼Œè¿™é€šè¿‡è„šæœ¬å‘½ä»¤ hadoop-daemon.sh start journalnode æ¥å®Œæˆã€‚å¯¹ JouranlNode é›†ç¾¤çš„å…±äº«å­˜å‚¨ç›®å½•è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¹¶ä¸”å°†åŸæœ‰çš„ NameNode æœ¬åœ°ç£ç›˜ä¸Šæœ€è¿‘ä¸€æ¬¡ checkpoint æ“ä½œç”Ÿæˆ FSImage æ–‡ä»¶ (å…·ä½“å¯å‚ç…§â€œNameNode çš„å…ƒæ•°æ®å­˜å‚¨æ¦‚è¿°â€ä¸€èŠ‚çš„å™è¿°) ä¹‹åçš„ EditLog æ‹·è´åˆ° JournalNode é›†ç¾¤ä¸Šçš„å…±äº«ç›®å½•ä¹‹ä¸­ï¼Œè¿™é€šè¿‡åœ¨åŸæœ‰çš„ NameNode ä¸Šæ‰§è¡Œå‘½ä»¤ hdfs namenode -initializeSharedEdits æ¥å®Œæˆã€‚å¯åŠ¨åŸæœ‰çš„ NameNode èŠ‚ç‚¹ï¼Œè¿™é€šè¿‡è„šæœ¬å‘½ä»¤ hadoop-daemon.sh start namenode å®Œæˆã€‚å¯¹æ–°å¢çš„ NameNode èŠ‚ç‚¹è¿›è¡Œåˆå§‹åŒ–ï¼Œå°†åŸæœ‰çš„ NameNode æœ¬åœ°ç£ç›˜ä¸Šæœ€è¿‘ä¸€æ¬¡ checkpoint æ“ä½œç”Ÿæˆ FSImage æ–‡ä»¶æ‹·è´åˆ°è¿™ä¸ªæ–°å¢çš„ NameNode çš„æœ¬åœ°ç£ç›˜ä¸Šï¼ŒåŒæ—¶éœ€è¦éªŒè¯ JournalNode é›†ç¾¤çš„å…±äº«å­˜å‚¨ç›®å½•ä¸Šå·²ç»å…·æœ‰äº†è¿™ä¸ª FSImage æ–‡ä»¶ä¹‹åçš„ EditLog(å·²ç»åœ¨ç¬¬ 3 æ­¥å®Œæˆäº†)ã€‚è¿™ä¸€æ­¥é€šè¿‡åœ¨æ–°å¢çš„ NameNode ä¸Šæ‰§è¡Œå‘½ä»¤ hdfs namenode -bootstrapStandby æ¥å®Œæˆã€‚å¯åŠ¨æ–°å¢çš„ NameNode èŠ‚ç‚¹ï¼Œè¿™é€šè¿‡è„šæœ¬å‘½ä»¤ hadoop-daemon.sh start namenode å®Œæˆã€‚åœ¨è¿™ä¸¤ä¸ª NameNode ä¸Šå¯åŠ¨ zkfc(ZKFailoverController) è¿›ç¨‹ï¼Œè°é€šè¿‡ Zookeeper é€‰ä¸»æˆåŠŸï¼Œè°å°±æ˜¯ä¸» NameNodeï¼Œå¦ä¸€ä¸ªä¸ºå¤‡ NameNodeã€‚è¿™é€šè¿‡è„šæœ¬å‘½ä»¤ hadoop-daemon.sh start zkfc å®Œæˆã€‚æ—¥å¸¸ç»´æŠ¤ç¬”è€…åœ¨æ—¥å¸¸çš„ç»´æŠ¤ä¹‹ä¸­ä¸»è¦é‡åˆ°è¿‡ä¸‹é¢ä¸¤ç§é—®é¢˜ï¼šZookeeper è¿‡äºæ•æ„Ÿï¼šHadoop çš„é…ç½®é¡¹ä¸­ Zookeeper çš„ session timeout çš„é…ç½®å‚æ•° ha.zookeeper.session-timeout.ms çš„é»˜è®¤å€¼ä¸º 5000ï¼Œä¹Ÿå°±æ˜¯ 5sï¼Œè¿™ä¸ªå€¼æ¯”è¾ƒå°ï¼Œä¼šå¯¼è‡´ Zookeeper æ¯”è¾ƒæ•æ„Ÿï¼Œå¯ä»¥æŠŠè¿™ä¸ªå€¼å°½é‡è®¾ç½®å¾—å¤§ä¸€äº›ï¼Œé¿å…å› ä¸ºç½‘ç»œæŠ–åŠ¨ç­‰åŸå› å¼•èµ· NameNode è¿›è¡Œæ— è°“çš„ä¸»å¤‡åˆ‡æ¢ã€‚å•å° JouranlNode æ•…éšœæ—¶ä¼šå¯¼è‡´ä¸»å¤‡æ— æ³•åˆ‡æ¢ï¼šåœ¨ç†è®ºä¸Šï¼Œå¦‚æœæœ‰ 3 å°æˆ–è€…æ›´å¤šçš„ JournalNodeï¼Œé‚£ä¹ˆæŒ‚æ‰ä¸€å° JouranlNode åº”è¯¥ä»ç„¶å¯ä»¥è¿›è¡Œæ­£å¸¸çš„ä¸»å¤‡åˆ‡æ¢ã€‚ä½†æ˜¯ç¬”è€…åœ¨æŸæ¬¡ NameNode é‡å¯çš„æ—¶å€™ï¼Œæ­£å¥½èµ¶ä¸Šä¸€å° JournalNode æŒ‚æ‰å®•æœºäº†ï¼Œè¿™ä¸ªæ—¶å€™è™½ç„¶æŸä¸€å° NameNode é€šè¿‡ Zookeeper é€‰ä¸»æˆåŠŸï¼Œä½†æ˜¯è¿™å°è¢«é€‰ä¸ºä¸»çš„ NameNode æ— æ³•æˆåŠŸåœ°ä» Standby çŠ¶æ€åˆ‡æ¢ä¸º Active çŠ¶æ€ã€‚äº‹åè¿½æŸ¥åŸå› å‘ç°ï¼Œè¢«é€‰ä¸ºä¸»çš„ NameNode å¡åœ¨é€€å‡º Standby çŠ¶æ€çš„æœ€åä¸€æ­¥ï¼Œè¿™ä¸ªæ—¶å€™å®ƒéœ€è¦ç­‰å¾…åˆ° JournalNode çš„è¯·æ±‚å…¨éƒ¨å®Œæˆä¹‹åæ‰èƒ½é€€å‡ºã€‚ä½†æ˜¯ç”±äºæœ‰ä¸€å° JouranlNode å®•æœºï¼Œåˆ°è¿™å° JournalNode çš„è¯·æ±‚éƒ½ç§¯å‹åœ¨ä¸€èµ·å¹¶ä¸”åœ¨ä¸æ–­åœ°è¿›è¡Œé‡è¯•ï¼ŒåŒæ—¶åœ¨ Hadoop çš„é…ç½®é¡¹ä¸­é‡è¯•æ¬¡æ•°çš„é»˜è®¤å€¼éå¸¸å¤§ï¼Œæ‰€ä»¥å°±ä¼šå¯¼è‡´è¢«é€‰ä¸ºä¸»çš„ NameNode æ— æ³•åŠæ—¶é€€å‡º Standby çŠ¶æ€ã€‚è¿™ä¸ªé—®é¢˜ä¸»è¦æ˜¯ Hadoop å†…éƒ¨çš„ RPC é€šä¿¡æ¡†æ¶çš„è®¾è®¡ç¼ºé™·å¼•èµ·çš„ï¼ŒHadoop HA çš„æºä»£ç  IPCLoggerChannel ç±»ä¸­æœ‰å…³äºè¿™ä¸ªé—®é¢˜çš„ TODOï¼Œä½†æ˜¯æˆªæ­¢åˆ°ç¤¾åŒºå‘å¸ƒçš„ 2.7.1 ç‰ˆæœ¬è¿™ä¸ªé—®é¢˜ä»ç„¶å­˜åœ¨ã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"hdfs","slug":"hdfs","permalink":"cpeixin.cn/tags/hdfs/"}]},{"title":"ç®—æ³• - æ’åºæ€»ç»“","slug":"ç®—æ³•-æ’åºæ€»ç»“","date":"2016-10-05T07:56:14.000Z","updated":"2020-05-22T08:00:46.964Z","comments":true,"path":"2016/10/05/ç®—æ³•-æ’åºæ€»ç»“/","link":"","permalink":"cpeixin.cn/2016/10/05/%E7%AE%97%E6%B3%95-%E6%8E%92%E5%BA%8F%E6%80%BB%E7%BB%93/","excerpt":"","text":"å¦‚ä½•é€‰æ‹©åˆé€‚çš„æ’åºç®—æ³•ï¼Ÿå¦‚æœè¦å®ç°ä¸€ä¸ªé€šç”¨çš„ã€é«˜æ•ˆç‡çš„æ’åºå‡½æ•°ï¼Œæˆ‘ä»¬åº”è¯¥é€‰æ‹©å“ªç§æ’åºç®—æ³•ï¼Ÿæˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹å‰é¢è®²è¿‡çš„å‡ ç§æ’åºç®—æ³•ã€‚æˆ‘ä»¬å‰é¢è®²è¿‡ï¼Œçº¿æ€§æ’åºç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ¯”è¾ƒä½ï¼Œé€‚ç”¨åœºæ™¯æ¯”è¾ƒç‰¹æ®Šã€‚æ‰€ä»¥å¦‚æœè¦å†™ä¸€ä¸ªé€šç”¨çš„æ’åºå‡½æ•°ï¼Œä¸èƒ½é€‰æ‹©çº¿æ€§æ’åºç®—æ³•ã€‚å¦‚æœå¯¹å°è§„æ¨¡æ•°æ®è¿›è¡Œæ’åºï¼Œå¯ä»¥é€‰æ‹©æ—¶é—´å¤æ‚åº¦æ˜¯ O(n2) çš„ç®—æ³•ï¼›å¦‚æœå¯¹å¤§è§„æ¨¡æ•°æ®è¿›è¡Œæ’åºï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn) çš„ç®—æ³•æ›´åŠ é«˜æ•ˆã€‚æ‰€ä»¥ï¼Œä¸ºäº†å…¼é¡¾ä»»æ„è§„æ¨¡æ•°æ®çš„æ’åºï¼Œä¸€èˆ¬éƒ½ä¼šé¦–é€‰æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn) çš„æ’åºç®—æ³•æ¥å®ç°æ’åºå‡½æ•°ã€‚æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn) çš„æ’åºç®—æ³•ä¸æ­¢ä¸€ä¸ªï¼Œæˆ‘ä»¬å·²ç»è®²è¿‡çš„æœ‰å½’å¹¶æ’åºã€å¿«é€Ÿæ’åºï¼Œåé¢è®²å †çš„æ—¶å€™æˆ‘ä»¬è¿˜ä¼šè®²åˆ°å †æ’åºã€‚å †æ’åºå’Œå¿«é€Ÿæ’åºéƒ½æœ‰æ¯”è¾ƒå¤šçš„åº”ç”¨ï¼Œæ¯”å¦‚ Java è¯­è¨€é‡‡ç”¨å †æ’åºå®ç°æ’åºå‡½æ•°ï¼ŒC è¯­è¨€ä½¿ç”¨å¿«é€Ÿæ’åºå®ç°æ’åºå‡½æ•°ã€‚ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œä½¿ç”¨å½’å¹¶æ’åºçš„æƒ…å†µå…¶å®å¹¶ä¸å¤šã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå¿«æ’åœ¨æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n2)ï¼Œè€Œå½’å¹¶æ’åºå¯ä»¥åšåˆ°å¹³å‡æƒ…å†µã€æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(nlogn)ï¼Œä»è¿™ç‚¹ä¸Šçœ‹èµ·æ¥å¾ˆè¯±äººï¼Œé‚£ä¸ºä»€ä¹ˆå®ƒè¿˜æ˜¯æ²¡èƒ½å¾—åˆ°â€œå® ä¿¡â€å‘¢ï¼Ÿè¿˜è®°å¾—æˆ‘ä»¬ä¸Šä¸€èŠ‚è®²çš„å½’å¹¶æ’åºçš„ç©ºé—´å¤æ‚åº¦å—ï¼Ÿå½’å¹¶æ’åºå¹¶ä¸æ˜¯åŸåœ°æ’åºç®—æ³•ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯ O(n)ã€‚æ‰€ä»¥ï¼Œç²—ç•¥ç‚¹ã€å¤¸å¼ ç‚¹è®²ï¼Œå¦‚æœè¦æ’åº 100MB çš„æ•°æ®ï¼Œé™¤äº†æ•°æ®æœ¬èº«å ç”¨çš„å†…å­˜ä¹‹å¤–ï¼Œæ’åºç®—æ³•è¿˜è¦é¢å¤–å†å ç”¨ 100MB çš„å†…å­˜ç©ºé—´ï¼Œç©ºé—´è€—è´¹å°±ç¿»å€äº†ã€‚å‰é¢æˆ‘ä»¬è®²åˆ°ï¼Œå¿«é€Ÿæ’åºæ¯”è¾ƒé€‚åˆæ¥å®ç°æ’åºå‡½æ•°ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“ï¼Œå¿«é€Ÿæ’åºåœ¨æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n2)ï¼Œå¦‚ä½•æ¥è§£å†³è¿™ä¸ªâ€œå¤æ‚åº¦æ¶åŒ–â€çš„é—®é¢˜å‘¢ï¼Ÿå¦‚ä½•ä¼˜åŒ–å¿«é€Ÿæ’åºï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ï¼Œä¸ºä»€ä¹ˆæœ€åæƒ…å†µä¸‹å¿«é€Ÿæ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n2) å‘¢ï¼Ÿæˆ‘ä»¬å‰é¢è®²è¿‡ï¼Œå¦‚æœæ•°æ®åŸæ¥å°±æ˜¯æœ‰åºçš„æˆ–è€…æ¥è¿‘æœ‰åºçš„ï¼Œæ¯æ¬¡åˆ†åŒºç‚¹éƒ½é€‰æ‹©æœ€åä¸€ä¸ªæ•°æ®ï¼Œé‚£å¿«é€Ÿæ’åºç®—æ³•å°±ä¼šå˜å¾—éå¸¸ç³Ÿç³•ï¼Œæ—¶é—´å¤æ‚åº¦å°±ä¼šé€€åŒ–ä¸º O(n2)ã€‚å®é™…ä¸Šï¼Œè¿™ç§ O(n2) æ—¶é—´å¤æ‚åº¦å‡ºç°çš„ä¸»è¦åŸå› è¿˜æ˜¯å› ä¸ºæˆ‘ä»¬åˆ†åŒºç‚¹é€‰çš„ä¸å¤Ÿåˆç†ã€‚é‚£ä»€ä¹ˆæ ·çš„åˆ†åŒºç‚¹æ˜¯å¥½çš„åˆ†åŒºç‚¹å‘¢ï¼Ÿæˆ–è€…è¯´å¦‚ä½•æ¥é€‰æ‹©åˆ†åŒºç‚¹å‘¢ï¼Ÿæœ€ç†æƒ³çš„åˆ†åŒºç‚¹æ˜¯ï¼šè¢«åˆ†åŒºç‚¹åˆ†å¼€çš„ä¸¤ä¸ªåˆ†åŒºä¸­ï¼Œæ•°æ®çš„æ•°é‡å·®ä¸å¤šã€‚å¦‚æœå¾ˆç²—æš´åœ°ç›´æ¥é€‰æ‹©ç¬¬ä¸€ä¸ªæˆ–è€…æœ€åä¸€ä¸ªæ•°æ®ä½œä¸ºåˆ†åŒºç‚¹ï¼Œä¸è€ƒè™‘æ•°æ®çš„ç‰¹ç‚¹ï¼Œè‚¯å®šä¼šå‡ºç°ä¹‹å‰è®²çš„é‚£æ ·ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ’åºçš„æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦æ˜¯ O(n2)ã€‚ä¸ºäº†æé«˜æ’åºç®—æ³•çš„æ€§èƒ½ï¼Œæˆ‘ä»¬ä¹Ÿè¦å°½å¯èƒ½åœ°è®©æ¯æ¬¡åˆ†åŒºéƒ½æ¯”è¾ƒå¹³å‡ã€‚æˆ‘è¿™é‡Œä»‹ç»ä¸¤ä¸ªæ¯”è¾ƒå¸¸ç”¨ã€æ¯”è¾ƒç®€å•çš„åˆ†åŒºç®—æ³•ï¼Œä½ å¯ä»¥ç›´è§‚åœ°æ„Ÿå—ä¸€ä¸‹ã€‚1. ä¸‰æ•°å–ä¸­æ³•æˆ‘ä»¬ä»åŒºé—´çš„é¦–ã€å°¾ã€ä¸­é—´ï¼Œåˆ†åˆ«å–å‡ºä¸€ä¸ªæ•°ï¼Œç„¶åå¯¹æ¯”å¤§å°ï¼Œå–è¿™ 3 ä¸ªæ•°çš„ä¸­é—´å€¼ä½œä¸ºåˆ†åŒºç‚¹ã€‚è¿™æ ·æ¯é—´éš”æŸä¸ªå›ºå®šçš„é•¿åº¦ï¼Œå–æ•°æ®å‡ºæ¥æ¯”è¾ƒï¼Œå°†ä¸­é—´å€¼ä½œä¸ºåˆ†åŒºç‚¹çš„åˆ†åŒºç®—æ³•ï¼Œè‚¯å®šè¦æ¯”å•çº¯å–æŸä¸€ä¸ªæ•°æ®æ›´å¥½ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦æ’åºçš„æ•°ç»„æ¯”è¾ƒå¤§ï¼Œé‚£â€œä¸‰æ•°å–ä¸­â€å¯èƒ½å°±ä¸å¤Ÿäº†ï¼Œå¯èƒ½è¦â€œäº”æ•°å–ä¸­â€æˆ–è€…â€œåæ•°å–ä¸­â€ã€‚2. éšæœºæ³•éšæœºæ³•å°±æ˜¯æ¯æ¬¡ä»è¦æ’åºçš„åŒºé—´ä¸­ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ ä½œä¸ºåˆ†åŒºç‚¹ã€‚è¿™ç§æ–¹æ³•å¹¶ä¸èƒ½ä¿è¯æ¯æ¬¡åˆ†åŒºç‚¹éƒ½é€‰çš„æ¯”è¾ƒå¥½ï¼Œä½†æ˜¯ä»æ¦‚ç‡çš„è§’åº¦æ¥çœ‹ï¼Œä¹Ÿä¸å¤§å¯èƒ½ä¼šå‡ºç°æ¯æ¬¡åˆ†åŒºç‚¹éƒ½é€‰çš„å¾ˆå·®çš„æƒ…å†µï¼Œæ‰€ä»¥å¹³å‡æƒ…å†µä¸‹ï¼Œè¿™æ ·é€‰çš„åˆ†åŒºç‚¹æ˜¯æ¯”è¾ƒå¥½çš„ã€‚æ—¶é—´å¤æ‚åº¦é€€åŒ–ä¸ºæœ€ç³Ÿç³•çš„ O(n2) çš„æƒ…å†µï¼Œå‡ºç°çš„å¯èƒ½æ€§ä¸å¤§ã€‚å¿«é€Ÿæ’åºæ˜¯ç”¨é€’å½’æ¥å®ç°çš„ã€‚æˆ‘ä»¬åœ¨é€’å½’é‚£ä¸€èŠ‚è®²è¿‡ï¼Œé€’å½’è¦è­¦æƒ•å †æ ˆæº¢å‡ºã€‚ä¸ºäº†é¿å…å¿«é€Ÿæ’åºé‡Œï¼Œé€’å½’è¿‡æ·±è€Œå †æ ˆè¿‡å°ï¼Œå¯¼è‡´å †æ ˆæº¢å‡ºï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼šç¬¬ä¸€ç§æ˜¯é™åˆ¶é€’å½’æ·±åº¦ã€‚ä¸€æ—¦é€’å½’è¿‡æ·±ï¼Œè¶…è¿‡äº†æˆ‘ä»¬äº‹å…ˆè®¾å®šçš„é˜ˆå€¼ï¼Œå°±åœæ­¢é€’å½’ã€‚ç¬¬äºŒç§æ˜¯é€šè¿‡åœ¨å †ä¸Šæ¨¡æ‹Ÿå®ç°ä¸€ä¸ªå‡½æ•°è°ƒç”¨æ ˆï¼Œæ‰‹åŠ¨æ¨¡æ‹Ÿé€’å½’å‹æ ˆã€å‡ºæ ˆçš„è¿‡ç¨‹ï¼Œè¿™æ ·å°±æ²¡æœ‰äº†ç³»ç»Ÿæ ˆå¤§å°çš„é™åˆ¶ã€‚Pythonä¸­çš„æ’åºpythonçš„ sort å†…éƒ¨å®ç°æœºåˆ¶ä¸ºï¼šTimesortæœ€åæ—¶é—´å¤æ‚åº¦ä¸ºï¼šOï¼ˆn log nï¼‰ç©ºé—´å¤æ‚åº¦ä¸ºï¼šOï¼ˆnï¼‰Timsortæ˜¯ç»“åˆäº†å½’å¹¶æ’åºï¼ˆmerge sortï¼‰å’Œæ’å…¥æ’åºï¼ˆinsertion sortï¼‰è€Œå¾—å‡ºçš„æ’åºç®—æ³•ï¼Œå®ƒåœ¨ç°å®ä¸­æœ‰å¾ˆå¥½çš„æ•ˆç‡ã€‚Tim Petersåœ¨2002å¹´è®¾è®¡äº†è¯¥ç®—æ³•å¹¶åœ¨Pythonä¸­ä½¿ç”¨ï¼ˆTimSort æ˜¯ Python ä¸­ list.sort çš„é»˜è®¤å®ç°ï¼‰ã€‚è¯¥ç®—æ³•æ‰¾åˆ°æ•°æ®ä¸­å·²ç»æ’å¥½åºçš„å—-åˆ†åŒºï¼Œæ¯ä¸€ä¸ªåˆ†åŒºå«ä¸€ä¸ªrunï¼Œç„¶åæŒ‰è§„åˆ™åˆå¹¶è¿™äº›runã€‚Pyhtonè‡ªä»2.3ç‰ˆä»¥æ¥ä¸€ç›´é‡‡ç”¨Timsortç®—æ³•æ’åºï¼Œç°åœ¨Java SE7å’ŒAndroidä¹Ÿé‡‡ç”¨Timsortç®—æ³•å¯¹æ•°ç»„æ’åºã€‚Timsortæ˜¯ç¨³å®šçš„ç®—æ³•ï¼Œå½“å¾…æ’åºçš„æ•°ç»„ä¸­å·²ç»æœ‰æ’åºå¥½çš„æ•°ï¼Œå®ƒçš„æ—¶é—´å¤æ‚åº¦ä¼šå°äºn lognã€‚ä¸å…¶ä»–åˆå¹¶æ’åºä¸€æ ·ï¼ŒTimesrotæ˜¯ç¨³å®šçš„æ’åºç®—æ³•ï¼Œæœ€åæ—¶é—´å¤æ‚åº¦æ˜¯Oï¼ˆn log nï¼‰ã€‚åœ¨æœ€åæƒ…å†µä¸‹ï¼ŒTimsortç®—æ³•éœ€è¦çš„ä¸´æ—¶ç©ºé—´æ˜¯n/2ï¼Œåœ¨æœ€å¥½æƒ…å†µä¸‹ï¼Œå®ƒåªéœ€è¦ä¸€ä¸ªå¾ˆå°çš„ä¸´æ—¶å­˜å‚¨ç©ºé—´Java è¯­è¨€æ’åºå‡½æ•°å †æ’åºå®ç°C è¯­è¨€æ’åºå‡½æ•°å¿«é€Ÿæ’åºå®ç°","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"æ’åº","slug":"æ’åº","permalink":"cpeixin.cn/tags/%E6%8E%92%E5%BA%8F/"}]},{"title":"Hadoop 2.x - Yarn","slug":"Hadoop-2-x-Yarn","date":"2016-10-04T05:30:26.000Z","updated":"2020-04-04T17:25:59.731Z","comments":true,"path":"2016/10/04/Hadoop-2-x-Yarn/","link":"","permalink":"cpeixin.cn/2016/10/04/Hadoop-2-x-Yarn/","excerpt":"","text":"What - YarnYARNæ˜¯Hadoop 2.0ä¸­çš„èµ„æºç®¡ç†ç³»ç»Ÿï¼Œå®ƒçš„åŸºæœ¬è®¾è®¡æ€æƒ³æ˜¯å°†MRv1ä¸­çš„JobTrackeræ‹†åˆ†æˆäº†ä¸¤ä¸ªç‹¬ç«‹çš„æœåŠ¡ï¼šä¸€ä¸ªå…¨å±€çš„èµ„æºç®¡ç†å™¨ResourceManagerå’Œæ¯ä¸ªåº”ç”¨ç¨‹åºç‰¹æœ‰çš„ApplicationMasterã€‚å…¶ä¸­ResourceManagerè´Ÿè´£æ•´ä¸ªç³»ç»Ÿçš„èµ„æºç®¡ç†å’Œåˆ†é…ï¼Œè€ŒApplicationMasterè´Ÿè´£å•ä¸ªåº”ç”¨ç¨‹åºçš„ç®¡ç†ã€‚Why - Yarnéšç€äº’è”ç½‘çš„é«˜é€Ÿå‘å±•ï¼Œæ–°çš„è®¡ç®—æ¡†æ¶ä¸æ–­å‡ºç°ï¼Œå¦‚å†…å­˜è®¡ç®—æ¡†æ¶ã€æµå¼è®¡ç®—æ¡†æ¶ã€è¿­ä»£è®¡ç®—èµ„æºæ¡†æ¶ã€è¿™å‡ ç§æ¡†æ¶é€šå¸¸éƒ½ä¼šè¢«ç”¨åˆ°è€ƒè™‘åˆ°èµ„æºçš„åˆ©ç”¨ç‡è¿ç»´å’Œæ•°æ®å…±äº«ç­‰å› ç´ ï¼Œä¼ä¸šé€šå¸¸å¸Œæœ›å°†æ‰€æœ‰çš„è®¡ç®—æ¡†æ¶éƒ¨ç½²åˆ°ä¸€ä¸ª å…¬å…±é›†ç¾¤ä¸­ï¼Œè®©ä»–ä»¬å…±äº«é›†ç¾¤çš„è®¡ç®—èµ„æºï¼Œå¹¶å¯¹èµ„æºè¿›è¡ŒåŒæ„ä½¿ç”¨ï¼ŒåŒæ—¶åˆèƒ½é‡‡ç”¨ç®€å•çš„èµ„æºéš”ç¦»æ–¹æ¡ˆï¼Œè¿™æ ·ä¾¿å‚¬ç”Ÿäº†è½»é‡å¼¹æ€§è®¡ç®—å¹³å°éœ€æ±‚Yarnçš„è®¾è®¡æ˜¯ä¸€ä¸ªå¼¹æ€§è®¡ç®—å¹³å°ï¼Œä¸ä»…ä»…æ”¯æŒMapreduceè®¡ç®—æ¡†æ¶è€Œæ˜¯æœç€å¯¹å¤šç§è®¡ç®—æ¡†æ¶è¿›è¡Œç»Ÿä¸€ç®¡ç†æ–¹å‘å‘å±•ã€‚ä¼˜ç‚¹:èµ„æºåˆ©åˆ©ç”¨ç‡é«˜ï¼ŒæŒ‰ç…§æ¡†æ¶è§’åº¦è¿›è¡Œèµ„æºåˆ’åˆ†ï¼Œå¾€å¾€å­˜åœ¨åº”ç”¨ç¨‹åºæ•°æ®å’Œè®¡ç®—èµ„æºéœ€æ±‚çš„ä¸å‡è¡¡æ€§ï¼Œä½¿å¾—æŸæ®µæ—¶é—´å†…è®¡ç®—èµ„æºç´§å¼ ï¼Œè€Œå¦å¤–ä¸€ç§è®¡ç®—æ–¹å¼çš„èµ„æºç©ºé—²ï¼Œå…±äº«é›†ç¾¤æ¨¡å¼åˆ™é€šè¿‡æ¡†æ¶å…±äº«å…¨éƒ¨çš„è®¡ç®—èµ„æºï¼Œä½¿å¾—é›†ç¾¤ä¸­çš„èµ„æºæ›´åŠ å……åˆ†åˆç†çš„åˆ©ç”¨ã€‚è¿ç»´æˆæœ¬ä½ï¼Œå¦‚æœä½¿ç”¨ï¼šâ€ä¸€ä¸ªæ¡†æ¶ä¸€ä¸ªé›†ç¾¤â€œçš„æ¨¡å¼ï¼Œè¿ç»´äººå‘˜éœ€è¦ç‹¬ç«‹ç®¡ç†å¤šä¸ªæ¡†æ¶ï¼Œè¿›è€Œå¢åŠ è¿ç»´çš„éš¾åº¦ï¼Œå…±äº«æ¨¡å¼é€šå¸¸åªéœ€è¦å°‘æ•°ç®¡ç†å‘˜å¯ä»¥å®Œæˆå¤šä¸ªæ¡†æ¶çš„ç®¡ç†ã€‚æ•°æ®å…±äº«ï¼Œéšç€æ•°æ®é‡çš„å¢åŠ ï¼Œè·¨é›†ç¾¤ä¹‹é—´çš„æ•°æ®ä¸ä»…å¢åŠ äº†ç¡¬ä»¶æˆæœ¬ï¼Œè€Œä¸”è€—è´¹æ—¶é—´ï¼Œå…±äº«é›†ç¾¤æ¨¡å¼å¯ä»¥å…±äº«æ¡†æ¶å’Œç¡¬ä»¶èµ„æºï¼Œå¤§å¤§é™ä½äº†æ•°æ®ç§»åŠ¨å¸¦æ¥çš„æˆæœ¬ã€‚How - Yarnyarnæ˜¯å†…ç½®åœ¨Hadoopå¹³å°ä¸­çš„ï¼Œæ‰€ä»¥åœ¨å·²ç»æ­å»ºå¥½çš„Hadoopé›†ç¾¤ä¸­å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚å¯¹äºå…¶ä»–è®¡ç®—æ¡†æ¶ï¼Œåœ¨é…ç½®æ–‡æ¡£é…ç½®åå³å¯ä½¿ç”¨ï¼Œä¾‹å¦‚sparkçš„ä»»åŠ¡æäº¤æ–¹å¼åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸€å®šæ˜¯è¦ç”¨yarnæ–¹å¼æ¥æäº¤ï¼Œä¾‹å¦‚ï¼šspark-submit â€“master yarn â€“class com.xx.xx.classname spark_job_name.jarYarn - ç»„æˆYARNæ€»ä½“ä¸Šä»ç„¶æ˜¯master/slaveç»“æ„ï¼Œåœ¨æ•´ä¸ªèµ„æºç®¡ç†æ¡†æ¶ä¸­ï¼Œresourcemanagerä¸ºmasterï¼Œnodemanageræ˜¯slaveã€‚Resourcemanagerè´Ÿè´£å¯¹å„ä¸ªnademangerä¸Šèµ„æºè¿›è¡Œç»Ÿä¸€ç®¡ç†å’Œè°ƒåº¦ã€‚å½“ç”¨æˆ·æäº¤ä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¶ï¼Œéœ€è¦æä¾›ä¸€ä¸ªç”¨ä»¥è·Ÿè¸ªå’Œç®¡ç†è¿™ä¸ªç¨‹åºçš„ApplicationMasterï¼Œå®ƒè´Ÿè´£å‘ResourceManagerç”³è¯·èµ„æºï¼Œå¹¶è¦æ±‚NodeMangerå¯åŠ¨å¯ä»¥å ç”¨ä¸€å®šèµ„æºçš„ä»»åŠ¡ã€‚ç”±äºä¸åŒçš„ApplicationMasterè¢«åˆ†å¸ƒåˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œå› æ­¤å®ƒä»¬ä¹‹é—´ä¸ä¼šç›¸äº’å½±å“ã€‚YARNçš„åŸºæœ¬ç»„æˆç»“æ„ï¼ŒYARNä¸»è¦ç”±ResourceManagerã€NodeManagerã€ApplicationMasterå’ŒContainerç­‰å‡ ä¸ªç»„ä»¶æ„æˆã€‚ResourceManageræ˜¯Masterä¸Šä¸€ä¸ªç‹¬ç«‹è¿è¡Œçš„è¿›ç¨‹ï¼Œè´Ÿè´£é›†ç¾¤ç»Ÿä¸€çš„èµ„æºç®¡ç†ã€è°ƒåº¦ã€åˆ†é…ç­‰ç­‰ï¼›NodeManageræ˜¯Slaveä¸Šä¸€ä¸ªç‹¬ç«‹è¿è¡Œçš„è¿›ç¨‹ï¼Œè´Ÿè´£ä¸ŠæŠ¥èŠ‚ç‚¹çš„çŠ¶æ€ï¼›App Masterå’ŒContaineræ˜¯è¿è¡Œåœ¨Slaveä¸Šçš„ç»„ä»¶ï¼ŒContaineræ˜¯yarnä¸­åˆ†é…èµ„æºçš„ä¸€ä¸ªå•ä½ï¼ŒåŒ…æ¶µå†…å­˜ã€CPUç­‰ç­‰èµ„æºï¼Œyarnä»¥Containerä¸ºå•ä½åˆ†é…èµ„æºã€‚Clientå‘ResourceManageræäº¤çš„æ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºéƒ½å¿…é¡»æœ‰ä¸€ä¸ªApplication Masterï¼Œå®ƒç»è¿‡ResourceManageråˆ†é…èµ„æºåï¼Œè¿è¡ŒäºæŸä¸€ä¸ªSlaveèŠ‚ç‚¹çš„Containerä¸­ï¼Œå…·ä½“åšäº‹æƒ…çš„Taskï¼ŒåŒæ ·ä¹Ÿè¿è¡Œä¸æŸä¸€ä¸ªSlaveèŠ‚ç‚¹çš„Containerä¸­ã€‚RMï¼ŒNMï¼ŒAMä¹ƒè‡³æ™®é€šçš„Containerä¹‹é—´çš„é€šä¿¡ï¼Œéƒ½æ˜¯ç”¨RPCæœºåˆ¶ã€‚YARNçš„æ¶æ„è®¾è®¡ä½¿å…¶è¶Šæ¥è¶Šåƒæ˜¯ä¸€ä¸ªäº‘æ“ä½œç³»ç»Ÿï¼Œæ•°æ®å¤„ç†æ“ä½œç³»ç»Ÿã€‚Yarn - æ¶æ„ResourcemanagerRMæ˜¯ä¸€ä¸ªå…¨å±€çš„èµ„æºç®¡ç†å™¨ï¼Œé›†ç¾¤åªæœ‰ä¸€ä¸ªï¼Œè´Ÿè´£æ•´ä¸ªç³»ç»Ÿçš„èµ„æºç®¡ç†å’Œåˆ†é…ï¼ŒåŒ…æ‹¬å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ã€å¯åŠ¨/ç›‘æ§APP masterã€ç›‘æ§nodemanagerã€èµ„æºçš„åˆ†é…ä¸è°ƒåº¦ã€‚å®ƒä¸»è¦ç”±ä¸¤ä¸ªç»„ä»¶æ„æˆï¼šè°ƒåº¦å™¨ï¼ˆSchedulerï¼‰å’Œåº”ç”¨ç¨‹åºç®¡ç†å™¨ï¼ˆApplications Managerï¼ŒASMï¼‰ã€‚è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰è°ƒåº¦å™¨æ ¹æ®å®¹é‡ã€é˜Ÿåˆ—ç­‰é™åˆ¶æ¡ä»¶ï¼ˆå¦‚æ¯ä¸ªé˜Ÿåˆ—åˆ†é…ä¸€å®šçš„èµ„æºï¼Œæœ€å¤šæ‰§è¡Œä¸€å®šæ•°é‡çš„ä½œä¸šç­‰ï¼‰ï¼Œå°†ç³»ç»Ÿä¸­çš„èµ„æºåˆ†é…ç»™å„ä¸ªæ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥è°ƒåº¦å™¨æ˜¯ä¸€ä¸ªâ€œçº¯è°ƒåº¦å™¨â€ï¼Œå®ƒä¸å†ä»äº‹ä»»ä½•ä¸å…·ä½“åº”ç”¨ç¨‹åºç›¸å…³çš„å·¥ä½œï¼Œæ¯”å¦‚ä¸è´Ÿè´£ç›‘æ§æˆ–è€…è·Ÿè¸ªåº”ç”¨çš„æ‰§è¡ŒçŠ¶æ€ç­‰ï¼Œä¹Ÿä¸è´Ÿè´£é‡æ–°å¯åŠ¨å› åº”ç”¨æ‰§è¡Œå¤±è´¥æˆ–è€…ç¡¬ä»¶æ•…éšœè€Œäº§ç”Ÿçš„å¤±è´¥ä»»åŠ¡ï¼Œè¿™äº›å‡äº¤ç”±åº”ç”¨ç¨‹åºç›¸å…³çš„ApplicationMasterå®Œæˆã€‚è°ƒåº¦å™¨ä»…æ ¹æ®å„ä¸ªåº”ç”¨ç¨‹åºçš„èµ„æºéœ€æ±‚è¿›è¡Œèµ„æºåˆ†é…ï¼Œè€Œèµ„æºåˆ†é…å•ä½ç”¨ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µâ€œèµ„æºå®¹å™¨â€ï¼ˆResource Containerï¼Œç®€ç§°Containerï¼‰è¡¨ç¤ºï¼ŒContaineræ˜¯ä¸€ä¸ªåŠ¨æ€èµ„æºåˆ†é…å•ä½ï¼Œå®ƒå°†å†…å­˜ã€CPUã€ç£ç›˜ã€ç½‘ç»œç­‰èµ„æºå°è£…åœ¨ä¸€èµ·ï¼Œä»è€Œé™å®šæ¯ä¸ªä»»åŠ¡ä½¿ç”¨çš„èµ„æºé‡ã€‚æ­¤å¤–ï¼Œè¯¥è°ƒåº¦å™¨æ˜¯ä¸€ä¸ªå¯æ’æ‹”çš„ç»„ä»¶ï¼Œç”¨æˆ·å¯æ ¹æ®è‡ªå·±çš„éœ€è¦è®¾è®¡æ–°çš„è°ƒåº¦å™¨ï¼ŒYARNæä¾›äº†å¤šç§ç›´æ¥å¯ç”¨çš„è°ƒåº¦å™¨ï¼Œæ¯”å¦‚Fair Schedulerå’ŒCapacity Schedulerç­‰ã€‚åº”ç”¨ç¨‹åºç®¡ç†å™¨ï¼ˆApplications Managerï¼ŒASMï¼‰åº”ç”¨ç¨‹åºç®¡ç†å™¨è´Ÿè´£ç®¡ç†æ•´ä¸ªç³»ç»Ÿä¸­æ‰€æœ‰åº”ç”¨ç¨‹åºï¼ŒåŒ…æ‹¬åº”ç”¨ç¨‹åºæäº¤ã€ä¸è°ƒåº¦å™¨åå•†èµ„æºä»¥å¯åŠ¨ApplicationMasterã€ç›‘æ§ApplicationMasterè¿è¡ŒçŠ¶æ€å¹¶åœ¨å¤±è´¥æ—¶é‡æ–°å¯åŠ¨å®ƒç­‰ã€‚ApplicationMasterï¼ˆAMï¼‰** **ç®¡ç†YARNå†…è¿è¡Œçš„åº”ç”¨ç¨‹åºçš„æ¯ä¸ªå®ä¾‹ã€‚åŠŸèƒ½ï¼šæ•°æ®åˆ‡åˆ†ä¸ºåº”ç”¨ç¨‹åºç”³è¯·èµ„æºå¹¶è¿›ä¸€æ­¥åˆ†é…ç»™å†…éƒ¨ä»»åŠ¡ã€‚ä»»åŠ¡ç›‘æ§ä¸å®¹é”™è´Ÿè´£åè°ƒæ¥è‡ªresourcemanagerçš„èµ„æºï¼Œå¹¶é€šè¿‡nodemanagerç›‘è§†å®¹æ˜“çš„æ‰§è¡Œå’Œèµ„æºä½¿ç”¨æƒ…å†µã€‚NodeManagerï¼ˆNMï¼‰Nodemanageræ•´ä¸ªé›†ç¾¤æœ‰å¤šä¸ªï¼Œè´Ÿè´£æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„èµ„æºå’Œä½¿ç”¨ã€‚åŠŸèƒ½ï¼šå•ä¸ªèŠ‚ç‚¹ä¸Šçš„èµ„æºç®¡ç†å’Œä»»åŠ¡ã€‚å¤„ç†æ¥è‡ªäºresourcemanagerçš„å‘½ä»¤ã€‚å¤„ç†æ¥è‡ªåŸŸapp masterçš„å‘½ä»¤ã€‚Nodemanagerç®¡ç†ç€æŠ½è±¡å®¹å™¨ï¼Œè¿™äº›æŠ½è±¡å®¹å™¨ä»£è¡¨ç€ä¸€äº›ç‰¹å®šç¨‹åºä½¿ç”¨é’ˆå¯¹æ¯ä¸ªèŠ‚ç‚¹çš„èµ„æºã€‚Nodemanagerå®šæ—¶åœ°å‘RMæ±‡æŠ¥æœ¬èŠ‚ç‚¹ä¸Šçš„èµ„æºä½¿ç”¨æƒ…å†µå’Œå„ä¸ªContainerçš„è¿è¡ŒçŠ¶æ€ï¼ˆcpuå’Œå†…å­˜ç­‰èµ„æºï¼‰ContainerContaineræ˜¯YARNä¸­çš„èµ„æºæŠ½è±¡ï¼Œå®ƒå°è£…äº†æŸä¸ªèŠ‚ç‚¹ä¸Šçš„å¤šç»´åº¦èµ„æºï¼Œå¦‚å†…å­˜ã€CPUã€ç£ç›˜ã€ç½‘ç»œç­‰ï¼Œå½“AMå‘RMç”³è¯·èµ„æºæ—¶ï¼ŒRMä¸ºAMè¿”å›çš„èµ„æºä¾¿æ˜¯ç”¨Containerè¡¨ç¤ºçš„ã€‚YARNä¼šä¸ºæ¯ä¸ªä»»åŠ¡åˆ†é…ä¸€ä¸ªContainerï¼Œä¸”è¯¥ä»»åŠ¡åªèƒ½ä½¿ç”¨è¯¥Containerä¸­æè¿°çš„èµ„æºã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒContainerä¸åŒäºMRv1ä¸­çš„slotï¼Œå®ƒæ˜¯ä¸€ä¸ªåŠ¨æ€èµ„æºåˆ’åˆ†å•ä½ï¼Œæ˜¯æ ¹æ®åº”ç”¨ç¨‹åºçš„éœ€æ±‚åŠ¨æ€ç”Ÿæˆçš„ã€‚ç›®å‰ä¸ºæ­¢ï¼ŒYARNä»…æ”¯æŒCPUå’Œå†…å­˜ä¸¤ç§èµ„æºï¼Œä¸”ä½¿ç”¨äº†è½»é‡çº§èµ„æºéš”ç¦»æœºåˆ¶Cgroupsè¿›è¡Œèµ„æºéš”ç¦»ã€‚åŠŸèƒ½ï¼šå¯¹taskç¯å¢ƒçš„æŠ½è±¡æè¿°ä¸€ç³»åˆ—ä¿¡æ¯ä»»åŠ¡è¿è¡Œèµ„æºçš„é›†åˆï¼ˆcpuã€å†…å­˜ã€ioç­‰ï¼‰ä»»åŠ¡è¿è¡Œç¯å¢ƒYarn - èµ„æºç®¡ç†èµ„æºè°ƒåº¦å’Œéš”ç¦»æ˜¯yarnä½œä¸ºä¸€ä¸ªèµ„æºç®¡ç†ç³»ç»Ÿï¼Œæœ€é‡è¦ä¸”æœ€åŸºç¡€çš„ä¸¤ä¸ªåŠŸèƒ½ã€‚èµ„æºè°ƒåº¦ç”±resourcemanagerå®Œæˆï¼Œè€Œèµ„æºéš”ç¦»ç”±å„ä¸ªnodemanagerå®ç°ã€‚Resourcemanagerå°†æŸä¸ªnodemanagerä¸Šèµ„æºåˆ†é…ç»™ä»»åŠ¡ï¼ˆè¿™å°±æ˜¯æ‰€è°“çš„â€œèµ„æºè°ƒåº¦â€ï¼‰åï¼Œnodemanageréœ€æŒ‰ç…§è¦æ±‚ä¸ºä»»åŠ¡æä¾›ç›¸åº”çš„èµ„æºï¼Œç”šè‡³ä¿è¯è¿™äº›èµ„æºåº”å…·æœ‰ç‹¬å æ€§ï¼Œä¸ºä»»åŠ¡è¿è¡Œæä¾›åŸºç¡€å’Œä¿è¯ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„èµ„æºéš”ç¦»ã€‚å½“è°ˆåŠåˆ°èµ„æºæ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æŒ‡å†…å­˜ã€cpuã€ioä¸‰ç§èµ„æºã€‚Hadoop yarnç›®å‰ä¸ºæ­¢ä»…æ”¯æŒcpuå’Œå†…å­˜ä¸¤ç§èµ„æºç®¡ç†å’Œè°ƒåº¦ã€‚å†…å­˜èµ„æºå¤šå°‘å†³å®šä»»åŠ¡çš„ç”Ÿæ­»ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿï¼Œä»»åŠ¡å¯èƒ½è¿è¡Œå¤±è´¥ï¼›ç›¸æ¯”ä¹‹ä¸‹ï¼Œcpuèµ„æºåˆ™ä¸åŒï¼Œå®ƒåªä¼šå†³å®šä»»åŠ¡çš„å¿«æ…¢ï¼Œä¸ä¼šå¯¹ä»»åŠ¡çš„ç”Ÿæ­»äº§ç”Ÿå½±å“ã€‚ #### Yarn - é˜Ÿåˆ—è°ƒåº¦ç­–ç•¥Yarnçš„é˜Ÿåˆ—è°ƒåº¦ç­–ç•¥ä¸»è¦åˆ†ä¸‰ç§ï¼šFIFOã€Capacityè°ƒåº¦ã€Fairè°ƒåº¦ã€‚FIFOè°ƒåº¦ç­–ç•¥ï¼šä¸ºå…ˆè¿›å»çš„ä»»åŠ¡åˆ†é…èµ„æºï¼Œåå…¥çš„ä»»åŠ¡ç­‰å¾…å‰é¢ä»»åŠ¡å®Œæˆæ‰èƒ½è·å¾—èµ„æºã€‚(å¤§ä»»åŠ¡å¯èƒ½å¯¼è‡´åç»­ä»»åŠ¡é¥¿æ­»)Capacityè°ƒåº¦ç­–ç•¥ï¼šå°†é›†ç¾¤èµ„æºåˆ†ä¸ºä¸€æ¡æ¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—åŒ…å«ä¸€å®šç™¾åˆ†æ¯”èµ„æºã€‚æ¯ä¸ªé˜Ÿåˆ—ä¸­ä»»åŠ¡é‡‡å–FIFOçš„è°ƒåº¦ç­–ç•¥ã€‚åœ¨æŸäº›é˜Ÿåˆ—èµ„æºå®½è£•çš„æƒ…å†µä¸‹ï¼Œå…è®¸è·¨é˜Ÿåˆ—ç”³è¯·èµ„æºï¼ŒåŒæ—¶å…è®¸æŠ¢å æœºåˆ¶ã€‚å½“å…¶ä»–é˜Ÿåˆ—ä»»åŠ¡ä½¿ç”¨äº†å½“å‰é˜Ÿåˆ—ä»»åŠ¡èµ„æºæ—¶ï¼Œå½“å‰é˜Ÿåˆ—ä»»åŠ¡åœ¨ç­‰å¾…ä¸€å®šæ—¶é—´åï¼Œå…è®¸æŠ¢å è¯¥é˜Ÿåˆ—èµ„æº(å°†æ”¹é˜Ÿåˆ—å†…ä¸å±äºå…¶ä»–é˜Ÿåˆ—ä»»åŠ¡çš„Containeræ€æ­»)ã€‚Fairè°ƒåº¦ç­–ç•¥ï¼šnä¸ªä»»åŠ¡æƒ…å†µä¸‹ï¼Œæ¯ä¸ªä»»åŠ¡å æ®1/nä»½é¢çš„èµ„æºã€‚åœ¨æŸä»»åŠ¡ç»“æŸåï¼Œè¯¥ä»»åŠ¡èµ„æºä¼šè¢«å…¶ä½™èµ„æºç“œåˆ†ï¼Œæ¯ä¸ªä»»åŠ¡å æ®1/(n-1)ä»½èµ„æºã€‚ä¸Capacityä¸€æ ·ä¹Ÿå°†é›†ç¾¤åˆ†ä¸ºé˜Ÿåˆ—ä¸”å…è®¸æŠ¢å æœºåˆ¶ã€‚ä¸åŒçš„æ˜¯é˜Ÿåˆ—å†…éƒ¨çš„èµ„æºè°ƒåº¦åŒæ—¶å…è®¸FIFOå’ŒFairè°ƒåº¦ã€‚Yarn - å†…å­˜ç®¡ç†yarnå…è®¸ç”¨æˆ·é…ç½®æ¯ä¸ªèŠ‚ç‚¹ä¸Šå¯ç”¨çš„ç‰©ç†å†…å­˜èµ„æºï¼Œæ³¨æ„ï¼Œè¿™é‡Œæ˜¯â€œå¯ç”¨çš„â€ï¼Œå› ä¸ºä¸€ä¸ªèŠ‚ç‚¹ä¸Šå†…å­˜ä¼šè¢«è‹¥å¹²ä¸ªæœåŠ¡å…±äº«ï¼Œæ¯”å¦‚ä¸€éƒ¨åˆ†ç»™äº†yarnï¼Œä¸€éƒ¨åˆ†ç»™äº†hdfsï¼Œä¸€éƒ¨åˆ†ç»™äº†hbaseç­‰ï¼Œyarné…ç½®çš„åªæ˜¯è‡ªå·±å¯ç”¨çš„ï¼Œé…ç½®å‚æ•°å¦‚ä¸‹ï¼šyarn.nodemanager.resource.memory-mbè¡¨ç¤ºè¯¥èŠ‚ç‚¹ä¸Šyarnå¯ä»¥ä½¿ç”¨çš„ç‰©ç†å†…å­˜æ€»é‡ï¼Œé»˜è®¤æ˜¯8192mï¼Œæ³¨æ„ï¼Œå¦‚æœä½ çš„èŠ‚ç‚¹å†…å­˜èµ„æºä¸å¤Ÿ8gï¼Œåˆ™éœ€è¦è°ƒå‡è¿™ä¸ªå€¼ï¼Œyarnä¸ä¼šæ™ºèƒ½çš„æ¢æµ‹èŠ‚ç‚¹ç‰©ç†å†…å­˜æ€»é‡ã€‚yarn.nodemanager.vmem-pmem-ratioä»»åŠ¡ä½¿ç”¨1mç‰©ç†å†…å­˜æœ€å¤šå¯ä»¥ä½¿ç”¨è™šæ‹Ÿå†…å­˜é‡ï¼Œé»˜è®¤æ˜¯2.1yarn.nodemanager.pmem-check-enabledæ˜¯å¦å¯ç”¨ä¸€ä¸ªçº¿ç¨‹æ£€æŸ¥æ¯ä¸ªä»»åŠ¡è¯ä½¿ç”¨çš„ç‰©ç†å†…å­˜é‡ï¼Œå¦‚æœä»»åŠ¡è¶…å‡ºäº†åˆ†é…å€¼ï¼Œåˆ™ç›´æ¥å°†å…¶killï¼Œé»˜è®¤æ˜¯trueã€‚yarn.nodemanager.vmem-check-enabledæ˜¯å¦å¯ç”¨ä¸€ä¸ªçº¿ç¨‹æ£€æŸ¥æ¯ä¸ªä»»åŠ¡è¯ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜é‡ï¼Œå¦‚æœä»»åŠ¡è¶…å‡ºäº†åˆ†é…å€¼ï¼Œåˆ™ç›´æ¥å°†å…¶killï¼Œé»˜è®¤æ˜¯trueã€‚yarn.scheduler.minimum-allocation-mbå•ä¸ªä»»åŠ¡å¯ä»¥ä½¿ç”¨æœ€å°ç‰©ç†å†…å­˜é‡ï¼Œé»˜è®¤1024mï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡ç”³è¯·ç‰©ç†å†…å­˜é‡å°‘äºè¯¥å€¼ï¼Œåˆ™è¯¥å¯¹åº”å€¼æ”¹ä¸ºè¿™ä¸ªæ•°ã€‚yarn.scheduler.maximum-allocation-mbå•ä¸ªä»»åŠ¡å¯ä»¥ç”³è¯·çš„æœ€å¤šçš„å†…å­˜é‡ï¼Œé»˜è®¤8192mYarn - cpuç®¡ç†ç›®å‰cpuè¢«åˆ’åˆ†ä¸ºè™šæ‹Ÿcpuï¼Œè¿™é‡Œçš„è™šæ‹Ÿcpuæ˜¯yarnè‡ªå·±å¼•å…¥çš„æ¦‚å¿µï¼Œåˆè¡·æ˜¯è€ƒè™‘åˆ°ä¸åŒèŠ‚ç‚¹cpuæ€§èƒ½å¯èƒ½ä¸åŒï¼Œæ¯ä¸ªcpuå…·æœ‰è®¡ç®—èƒ½åŠ›ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚ï¼ŒæŸä¸ªç‰©ç†cpuè®¡ç®—èƒ½åŠ›å¯èƒ½æ˜¯å¦å¤–ä¸€ä¸ªç‰©ç†cpuçš„2å€ï¼Œè¿™æ—¶å€™ï¼Œä½ å¯ä»¥é€šè¿‡ä¸ºç¬¬ä¸€ä¸ªç‰©ç†cpuå¤šé…ç½®å‡ ä¸ªè™šæ‹Ÿcpuå¼¥è¡¥è¿™ç§å·®å¼‚ã€‚ç”¨æˆ·æäº¤ä½œä¸šæ—¶ï¼Œå¯ä»¥æŒ‡å®šæ¯ä¸ªä»»åŠ¡éœ€è¦çš„è™šæ‹Ÿcpuä¸ªæ•°ã€‚åœ¨yarnä¸­ï¼Œcpuç›¸å…³é…ç½®å‚æ•°å¦‚ä¸‹ï¼šyarn.nodemanager.resource.cpu-vcoresè¡¨ç¤ºè¯¥èŠ‚ç‚¹ä¸Šyarnå¯ä½¿ç”¨çš„è™šæ‹Ÿcpuä¸ªæ•°ï¼Œé»˜è®¤æ˜¯8ä¸ªï¼Œæ³¨æ„ï¼Œç›®å‰æ¨èå°†è¯¥å€¼ä¸ºä¸ç‰©ç†cpuæ ¸æ•°ç›¸åŒã€‚å¦‚æœä½ çš„èŠ‚ç‚¹cpuåˆæ•°ä¸å¤Ÿ8ä¸ªï¼Œåˆ™éœ€è¦è°ƒå‡å°è¿™ä¸ªå€¼ï¼Œè€Œyarnä¸ä¼šæ™ºèƒ½çš„æ¢æµ‹èŠ‚ç‚¹ç‰©ç†cpuæ€»æ•°ã€‚yarn.scheduler.minimum-allocation-vcoreså•ä¸ªä»»åŠ¡å¯ç”³è¯·æœ€å°cpuä¸ªæ•°ï¼Œé»˜è®¤1ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡ç”³è¯·çš„cpuä¸ªæ•°å°‘äºè¯¥æ•°ï¼Œåˆ™è¯¥å¯¹åº”å€¼è¢«ä¿®æ”¹ä¸ºè¿™ä¸ªæ•°yarn.scheduler.maximum-allocation-vcoreså•ä¸ªä»»åŠ¡å¯ä»¥ç”³è¯·æœ€å¤šè™šæ‹Ÿcpuä¸ªæ•°ï¼Œé»˜è®¤æ˜¯32.","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"yarn","slug":"yarn","permalink":"cpeixin.cn/tags/yarn/"}]},{"title":"Hadoop 2.x - MapReduce","slug":"Hadoop-2-x-MapReduce","date":"2016-10-02T06:30:21.000Z","updated":"2020-04-04T17:26:12.269Z","comments":true,"path":"2016/10/02/Hadoop-2-x-MapReduce/","link":"","permalink":"cpeixin.cn/2016/10/02/Hadoop-2-x-MapReduce/","excerpt":"","text":"MapReduce å·¥ä½œåŸç†What - MapReduceHadoopä¸»è¦è§£å†³äº†ä¸¤ä¸ªé—®é¢˜ï¼Œæµ·é‡æ•°æ®çš„å­˜å‚¨å’Œæµ·é‡æ•°æ®çš„è®¡ç®—ã€‚MapReduceå°±æ˜¯Hadoopå¤§æ•°æ®æ¡†æ¶ä¸‹çš„åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ï¼Œæ˜¯åŸºäºHadoopæ•°æ®åˆ†æä¸­çš„æ ¸å¿ƒè®¡ç®—æ¡†æ¶ã€‚åŒæ—¶ï¼ŒMapreduceæ˜¯ä¸€ç§ç¼–ç¨‹æ¨¡å‹ï¼Œæ˜¯ä¸€ç§ç¼–ç¨‹æ–¹æ³•ï¼ŒæŠ½è±¡ç†è®ºWhy - MapReduceç”¨ç®€æ´çš„æ–¹å¼ï¼Œå°±èƒ½å®ç° TBï¼ŒPBçº§åˆ«æ•°æ®åœ¨ç™¾å°ï¼Œåƒå°ï¼Œä¸‡å°æœåŠ¡å™¨ä¸Šçš„å¹¶è¡Œè¿ç®—ï¼Œç¨‹åºäººå‘˜å¹¶ä¸éœ€è¦å…³å¿ƒå¦‚ä½•å¤„ç†å¹¶è¡Œè®¡ç®—ã€å¦‚ä½•åˆ†å‘æ•°æ®ã€å¦‚ä½•å¤„ç†é”™è¯¯ï¼Œè¿™äº›é—®é¢˜éƒ½å·²ç»ç”±mapreduceæ¡†æ¶æ¥å¤„ç†ã€‚How - MapReduceæˆ‘ä»¬è¦å­¦ä¹ çš„å°±æ˜¯è¿™ä¸ªè®¡ç®—æ¨¡å‹çš„è¿è¡Œè§„åˆ™ã€‚åœ¨è¿è¡Œä¸€ä¸ªmapreduceè®¡ç®—ä»»åŠ¡æ—¶å€™ï¼Œä»»åŠ¡è¿‡ç¨‹è¢«åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šmapé˜¶æ®µå’Œreduceé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æ˜¯ç”¨é”®å€¼å¯¹ï¼ˆkey/valueï¼‰ä½œä¸ºè¾“å…¥ï¼ˆinputï¼‰å’Œè¾“å‡ºï¼ˆoutputï¼‰ã€‚è€Œç¨‹åºå‘˜è¦åšçš„å°±æ˜¯å®šä¹‰å¥½è¿™ä¸¤ä¸ªé˜¶æ®µçš„å‡½æ•°ï¼šmapå‡½æ•°å’Œreduceå‡½æ•°ã€‚MapReduce ä¼˜ç¼ºç‚¹ä¼˜ç‚¹Mapreduceæ˜“äºç¼–ç¨‹å®ƒç®€å•çš„å®ç°ä¸€äº›æ¥å£ï¼Œå°±å¯ä»¥å®Œæˆä¸€ä¸ªåˆ†å¸ƒå¼ç¨‹åºï¼Œè¿™ä¸ªç¨‹åºå¯ä»¥åˆ†å¸ƒåˆ°å¤§é‡çš„å»‰ä»·çš„pcæœºå™¨ä¸Šè¿è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ä½ å†™ä¸€ä¸ªåˆ†å¸ƒå¼ç¨‹åºï¼Œè·Ÿå†™ä¸€ä¸ªç®€å•çš„ä¸²è¡Œç¨‹åºæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚å°±æ˜¯å› ä¸ºè¿™ä¸ªç‰¹æ€§ä½¿çš„Mapreduceç¼–ç¨‹å˜å¾—éå¸¸æµè¡Œã€‚è‰¯å¥½çš„æ‰©å±•æ€§é¡¹ç›®å½“ä½ çš„è®¡ç®—èµ„æºå¾—ä¸åˆ°æ»¡è¶³çš„æ—¶å€™ï¼Œä½ å¯ä»¥é€šè¿‡ç®€å•çš„é€šè¿‡å¢åŠ æœºå™¨æ¥æ‰©å±•å®ƒçš„è®¡ç®—èƒ½åŠ›é«˜å®¹é”™æ€§Mapreduceçš„è®¾è®¡åˆè¡·å°±æ˜¯ä½¿ç¨‹åºèƒ½å¤Ÿéƒ¨ç½²åœ¨å»‰ä»·çš„pcæœºå™¨ä¸Šï¼Œè¿™å°±è¦æ±‚å®ƒå…·æœ‰å¾ˆé«˜çš„å®¹é”™æ€§ã€‚æ¯”å¦‚ä¸€ä¸ªæœºå™¨æŒ‚äº†ï¼Œå®ƒå¯ä»¥æŠŠä¸Šé¢çš„è®¡ç®—ä»»åŠ¡è½¬ç§»åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œä¸è‡³äºè¿™ä¸ªä»»åŠ¡è¿è¡Œå¤±è´¥ï¼Œè€Œä¸”è¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦äººå·¥å‚ä¸ï¼Œè€Œå®Œå…¨æ˜¯ç”±hadoopå†…éƒ¨å®Œæˆçš„ã€‚é€‚åˆPBçº§ä»¥ä¸Šæµ·é‡æ•°æ®çš„ç¦»çº¿å¤„ç†**ç¼ºç‚¹ä¸æ“…é•¿å®æ—¶è®¡ç®—Mapreduceæ— æ³•åšåˆ°åƒMysqlé‚£æ ·åšåˆ°æ¯«ç§’æˆ–è€…ç§’çº§çš„è¿”å›ç»“æœä¸æ“…é•¿æµå¼è®¡ç®—æµå¼è®¡ç®—çš„è¾“å…¥æ•°æ®æ˜¯åŠ¨æ€çš„ï¼Œè€ŒMapreduceçš„è¾“å…¥æ•°æ®é›†æ˜¯é™æ€çš„ï¼Œä¸èƒ½æµæ€å˜åŒ–ã€‚è¿™æ˜¯Mapreduceè‡ªèº«çš„è®¾è®¡ç‰¹ç‚¹å†³å®šäº†æ•°æ®æºå¿…é¡»æ˜¯é™æ€çš„ã€‚ä¸æ“…é•¿DAG(æœ‰å‘å›¾)è®¡ç®—å¤šä¸ªåº”ç”¨ç¨‹åºå­˜åœ¨ä¾èµ–å…³ç³»ï¼Œåä¸€ä¸ªåº”ç”¨ç¨‹åºçš„è¾“å…¥ä¸ºå‰ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„è¾“å‡ºï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒMapreduceå¹¶ä¸æ˜¯ä¸èƒ½åšï¼Œè€Œæ˜¯ä½¿ç”¨åæ¯ä¸ªMapreduceä½œä¸šçš„è¾“å‡ºç»“æœéƒ½ä¼šå†™å…¥åˆ°ç£ç›˜ï¼Œä¼šé€ æˆå¤§é‡çš„ç£ç›˜IOï¼Œå¯¼è‡´æ€§èƒ½éå¸¸ä½ä¸‹ã€‚MapReduce å·¥ä½œæµç¨‹MapReduceæ•´ä½“æµç¨‹å›¾input fileçš„åˆ‡åˆ†æˆå°æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯æŒ‰ç…§hdfs blockå—å¤§å°ä¸€è‡´ä¸º128Må¯¹æ–‡ä»¶è¿›è¡Œåˆ‡åˆ†ã€‚Mapçš„æ•°é‡ï¼šinput fileæ–‡ä»¶æŒ‰ç…§128Msplitåï¼Œæœ‰å¤šå°‘ä¸ªæ•°æ®å—ï¼Œå°±å¯¹åº”ç€æœ‰å¤šå°‘ä¸ªMapã€‚Reduceçš„æ•°é‡ï¼š ä¸Mapé˜¶æ®µå®šä¹‰çš„Partitionæ•°é‡ä¸€è‡´ã€‚MapReduce shuffleé˜¶æ®µï¼šä¸‹å›¾å…ˆä»æ•´ä½“æ¥çœ‹ï¼Œother mapsã€ other reducesçš„æŒ‡å‘ï¼Œå¯ä»¥çœ‹å‡ºï¼Œä¸€å…±æœ‰4ä¸ªMap å’Œ 3ä¸ª reducesã€‚é‚£ä¹ˆç°åœ¨å†ç»†åˆ†æ¥çœ‹ï¼Œä¸‹å›¾è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ª map task å’Œ reduce task ä»¥åŠ map å’Œ reduceä¹‹é—´çš„shuffleæ‰§è¡Œæµç¨‹map é˜¶æ®µå¼€å§‹åï¼Œä¼šç»è¿‡ç”¨æˆ·è‡ªå®šä¹‰é€»è¾‘å¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚å®Œæˆmapç«¯å¤„ç†å®Œçš„æ•°æ®ï¼Œä¼šè¢«å†™å…¥åˆ°ç¯å½¢ç¼“å†²åŒºï¼ˆbuffer in memoryï¼‰ã€‚è¿™é‡Œçš„ç¯å½¢ç¼“å†²åŒºéœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œç¯å½¢ç¼“å†²åŒºçš„åº•å±‚å®ç°ä¸ºç¯å½¢é˜Ÿåˆ—ï¼Œ é»˜è®¤å¤§å°ä¸º100MBæ•°æ®åœ¨å†™å…¥ç¯å½¢ç¼“å†²åŒºåï¼Œé¦–å…ˆè¿›è¡Œåˆ†åŒºï¼ˆpartitionï¼‰, éšåå¯¹æ¯ä¸ªpartitionå†…çš„æ•°æ®è¿›è¡Œsortæ“ä½œï¼Œè¿™é‡Œçš„æ’åºæ–¹å¼æ˜¯æŒ‰ç…§å­—å…¸æ’åºï¼Œé‡‡ç”¨å¿«é€Ÿæ’åºç®—æ³•è¿›è¡Œæ’åºã€‚å½“mapé˜¶æ®µæ•°æ®ä¸æ–­çš„å‘ç¯å½¢ç¼“å†²åŒºå†™çš„è¿‡ç¨‹ä¸­ï¼Œç¯å½¢ç¼“å†²åŒºæœ‰ä¸€ä¸ªé˜ˆå€¼ï¼Œé»˜è®¤ä¸º80%ï¼Œå½“æ•°æ®é‡è¾¾åˆ°80%åï¼Œç¼“å†²åŒºçš„æ•°æ®ä¼šæº¢å†™åˆ°ç£ç›˜ä¸Šï¼ˆmerge on diskï¼‰æº¢å†™åˆ°ç£ç›˜ä¸Šåï¼Œå¯ä»¥æƒ³åƒæˆç£ç›˜ä¸Šå­˜æ”¾äº†å¾ˆå¤šå†…éƒ¨å·²ç»æ’åºå¥½ï¼Œå¹¶ä¸”å¸¦æœ‰åˆ†åŒºä¿¡æ¯çš„å°æ–‡ä»¶ï¼Œè¿™æ—¶å€™è¦å¯¹å±äºåŒä¸€åˆ†åŒºçš„å°æ–‡ä»¶è¿›è¡Œmergeï¼Œå¹¶åŒæ—¶è¿›è¡Œæ’åºï¼Œè¿™é‡Œçš„æ’åºç®—æ³•é€‰æ‹©çš„æ˜¯å½’å¹¶æ’åºæ­¤æ—¶ï¼Œæ¯ä¸ªMapç«¯ï¼Œéƒ½å·²ç»å‡†å¤‡å¥½äº†æ¯ä¸ªpartitionçš„æ–‡ä»¶ã€‚ä¸Šå›¾ä¸­ï¼Œç»¿è‰²ç®­å¤´çš„æŒ‡å‘ï¼Œå„ä¸ªMapç«¯ï¼Œå¸¦æœ‰partitionä¿¡æ¯çš„æ–‡ä»¶ï¼Œfetchåˆ°å¯¹åº”çš„reduceç«¯ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œçº¢è‰²è™šçº¿ç®­å¤´ other reduceså¯¹åº”çš„ç£ç›˜æ–‡ä»¶åˆ™æŒ‡å‘å…¶ä»–çš„ä¸¤ä¸ªreduceç«¯ã€‚fetchåˆ°åŒä¸€reduceç«¯çš„partitionæ•°æ®ï¼Œåˆ™å±äºåŒä¸€åˆ†åŒºæ•°æ®ï¼Œè¿™æ—¶è¿˜è¦è¿›è¡Œä¸€æ¬¡mergeåˆå¹¶æ’åºæ“ä½œï¼Œæ’åºç®—æ³•é€‰æ‹©çš„æ˜¯å½’å¹¶æ’åºï¼Œæ¥åˆå¹¶æˆå¤§æ–‡ä»¶æœ€åï¼Œreduceç«¯çš„shuffleé˜¶æ®µå®Œæˆï¼Œåˆå¹¶å¥½çš„å¤§æ–‡ä»¶ç”±reduceå‡½æ•°è¿›è¡Œå¤„ç†ï¼Œæœ€ååˆ°outputè¾“å‡ºç»“æœã€‚è¶…è¶…è¶…è¶…è¶…è¶…è¶…è¶…è¯¦ç»†çš„å·¥ä½œæµç¨‹å›¾","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"mapreduce","slug":"mapreduce","permalink":"cpeixin.cn/tags/mapreduce/"}]},{"title":"Hadoop 1.x - HDFS","slug":"Hadoop-1-x-HDFS","date":"2016-10-01T07:36:21.000Z","updated":"2020-04-04T17:26:36.675Z","comments":true,"path":"2016/10/01/Hadoop-1-x-HDFS/","link":"","permalink":"cpeixin.cn/2016/10/01/Hadoop-1-x-HDFS/","excerpt":"","text":"ä»‹ç»HDFS ï¼ˆHadoop Distributed File Systemï¼‰æ˜¯ Hadoop ä¸‹çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå…·æœ‰é«˜å®¹é”™ã€é«˜ååé‡ç­‰ç‰¹æ€§ï¼Œå¯ä»¥éƒ¨ç½²åœ¨ä½æˆæœ¬çš„ç¡¬ä»¶ä¸Šã€‚å‡è®¾ä¸ç›®æ ‡ç¡¬ä»¶æ•…éšœç¡¬ä»¶æ•…éšœæ˜¯æ­£å¸¸ç°è±¡ï¼Œè€Œéä¾‹å¤–ã€‚HDFSå®ä¾‹å¯èƒ½åŒ…å«æ•°ç™¾æˆ–æ•°åƒä¸ªæœåŠ¡å™¨è®¡ç®—æœºï¼Œæ¯ä¸ªæœåŠ¡å™¨è®¡ç®—æœºéƒ½å­˜å‚¨æ–‡ä»¶ç³»ç»Ÿæ•°æ®çš„ä¸€éƒ¨åˆ†ã€‚å­˜åœ¨å¤§é‡ç»„ä»¶å¹¶ä¸”æ¯ä¸ªç»„ä»¶çš„æ•…éšœæ¦‚ç‡éƒ½å¾ˆä½çš„äº‹å®æ„å‘³ç€HDFSçš„æŸäº›ç»„ä»¶å§‹ç»ˆæ— æ³•è¿è¡Œã€‚å› æ­¤ï¼Œæ£€æµ‹æ•…éšœå¹¶å¿«é€Ÿï¼Œè‡ªåŠ¨åœ°ä»æ•…éšœä¸­æ¢å¤æ˜¯HDFSçš„æ ¸å¿ƒç›®æ ‡ã€‚æµæ•°æ®è®¿é—®åœ¨HDFSä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºéœ€è¦å¯¹å…¶æ•°æ®é›†è¿›è¡Œæµå¼è®¿é—®ã€‚å®ƒä»¬ä¸æ˜¯é€šå¸¸åœ¨é€šç”¨æ–‡ä»¶ç³»ç»Ÿä¸Šè¿è¡Œçš„é€šç”¨åº”ç”¨ç¨‹åºã€‚HDFSè®¾è®¡ç”¨äºæ‰¹å¤„ç†ï¼Œè€Œä¸æ˜¯ç”¨æˆ·äº¤äº’ä½¿ç”¨ã€‚é‡ç‚¹åœ¨äºæ•°æ®è®¿é—®çš„é«˜ååé‡ï¼Œè€Œä¸æ˜¯æ•°æ®è®¿é—®çš„ä½å»¶è¿Ÿã€‚POSIXæå‡ºäº†è®¸å¤šé’ˆå¯¹HDFSçš„åº”ç”¨ç¨‹åºä¸éœ€è¦çš„ç¡¬æ€§è¦æ±‚ã€‚åœ¨ä¸€äº›å…³é”®é¢†åŸŸä¸­ï¼ŒPOSIXè¯­ä¹‰å·²ç»è¢«äº¤æ˜“ä»¥æé«˜æ•°æ®ååç‡ã€‚å¤§æ•°æ®é›†åœ¨HDFSä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºå…·æœ‰å¤§é‡æ•°æ®é›†ã€‚HDFSä¸­çš„å…¸å‹æ–‡ä»¶å¤§å°ä¸ºGBåˆ°TBã€‚å› æ­¤ï¼ŒHDFSå·²è°ƒæ•´ä¸ºæ”¯æŒå¤§æ–‡ä»¶ã€‚å®ƒåº”æä¾›è¾ƒé«˜çš„èšåˆæ•°æ®å¸¦å®½ï¼Œå¹¶å¯ä»¥æ‰©å±•åˆ°å•ä¸ªç¾¤é›†ä¸­çš„æ•°ç™¾ä¸ªèŠ‚ç‚¹ã€‚å®ƒåº”è¯¥åœ¨å•ä¸ªå®ä¾‹ä¸­æ”¯æŒæ•°åƒä¸‡ä¸ªæ–‡ä»¶ã€‚ç®€å•ä¸€è‡´æ€§æ¨¡å‹HDFSåº”ç”¨ç¨‹åºéœ€è¦æ–‡ä»¶ä¸€æ¬¡å†™å…¥å¤šæ¬¡è¯»å–è®¿é—®æ¨¡å‹ã€‚ä¸€æ—¦åˆ›å»ºï¼Œå†™å…¥å’Œå…³é—­æ–‡ä»¶ï¼Œé™¤äº†è¿½åŠ å’Œæˆªæ–­å¤–ï¼Œæ— éœ€æ›´æ”¹ã€‚æ”¯æŒå°†å†…å®¹è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ï¼Œä½†ä¸èƒ½åœ¨ä»»æ„ç‚¹æ›´æ–°ã€‚è¯¥å‡è®¾ç®€åŒ–äº†æ•°æ®ä¸€è‡´æ€§é—®é¢˜å¹¶å®ç°äº†é«˜ååé‡æ•°æ®è®¿é—®ã€‚MapReduceåº”ç”¨ç¨‹åºæˆ–Webçˆ¬ç½‘ç¨‹åºåº”ç”¨ç¨‹åºéå¸¸é€‚åˆæ­¤æ¨¡å‹ã€‚ç§»åŠ¨è®¡ç®—æ¯”ç§»åŠ¨æ•°æ®ä¾¿å®œå¦‚æœåº”ç”¨ç¨‹åºæ‰€è¯·æ±‚çš„è®¡ç®—åœ¨å…¶æ‰€æ“ä½œçš„æ•°æ®é™„è¿‘æ‰§è¡Œï¼Œåˆ™æ•ˆç‡ä¼šæ›´é«˜ã€‚å½“æ•°æ®é›†çš„å¤§å°å·¨å¤§æ—¶ï¼Œå°¤å…¶å¦‚æ­¤ã€‚è¿™æ ·å¯ä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘ç½‘ç»œæ‹¥å¡ï¼Œå¹¶æé«˜ç³»ç»Ÿçš„æ•´ä½“ååé‡ã€‚å‡è®¾é€šå¸¸æ˜¯å°†è®¡ç®—è¿ç§»åˆ°æ›´é è¿‘æ•°æ®çš„ä½ç½®ï¼Œè€Œä¸æ˜¯å°†æ•°æ®ç§»åŠ¨åˆ°åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œçš„ä½ç½®ã€‚HDFSä¸ºåº”ç”¨ç¨‹åºæä¾›äº†æ¥å£ï¼Œä½¿å®ƒä»¬è‡ªå·±æ›´é è¿‘æ•°æ®æ‰€åœ¨çš„ä½ç½®ã€‚è·¨å¼‚æ„ç¡¬ä»¶å’Œè½¯ä»¶å¹³å°çš„å¯ç§»æ¤æ€§HDFSçš„è®¾è®¡ç›®çš„æ˜¯å¯ä»¥è½»æ¾åœ°ä»ä¸€ä¸ªå¹³å°ç§»æ¤åˆ°å¦ä¸€ä¸ªå¹³å°ã€‚è¿™æœ‰åŠ©äºå°†HDFSå¹¿æ³›ç”¨ä½œå¤§é‡åº”ç”¨ç¨‹åºçš„é¦–é€‰å¹³å°ã€‚HDFS è®¾è®¡åŸç†2.1 HDFS æ¶æ„HDFS éµå¾ªä¸»/ä»æ¶æ„ï¼Œç”±å•ä¸ª NameNode(NN) å’Œå¤šä¸ª DataNode(DN) ç»„æˆï¼šNameNode : è´Ÿè´£æ‰§è¡Œæœ‰å…³ æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ çš„æ“ä½œï¼Œä¾‹å¦‚æ‰“å¼€ï¼Œå…³é—­ã€é‡å‘½åæ–‡ä»¶å’Œç›®å½•ç­‰ã€‚å®ƒåŒæ—¶è¿˜è´Ÿè´£é›†ç¾¤å…ƒæ•°æ®çš„å­˜å‚¨ï¼Œè®°å½•ç€æ–‡ä»¶ä¸­å„ä¸ªæ•°æ®å—çš„ä½ç½®ä¿¡æ¯ã€‚DataNodeï¼šè´Ÿè´£æä¾›æ¥è‡ªæ–‡ä»¶ç³»ç»Ÿå®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ï¼Œæ‰§è¡Œå—çš„åˆ›å»ºï¼Œåˆ é™¤ç­‰æ“ä½œã€‚æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´HDFS çš„ æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ çš„å±‚æ¬¡ç»“æ„ä¸å¤§å¤šæ•°æ–‡ä»¶ç³»ç»Ÿç±»ä¼¼ (å¦‚ Linux)ï¼Œ æ”¯æŒç›®å½•å’Œæ–‡ä»¶çš„åˆ›å»ºã€ç§»åŠ¨ã€åˆ é™¤å’Œé‡å‘½åç­‰æ“ä½œï¼Œæ”¯æŒé…ç½®ç”¨æˆ·å’Œè®¿é—®æƒé™ï¼Œä½†ä¸æ”¯æŒç¡¬é“¾æ¥å’Œè½¯è¿æ¥ã€‚NameNode è´Ÿè´£ç»´æŠ¤æ–‡ä»¶ç³»ç»Ÿåç§°ç©ºé—´ï¼Œè®°å½•å¯¹åç§°ç©ºé—´æˆ–å…¶å±æ€§çš„ä»»ä½•æ›´æ”¹ã€‚æ•°æ®å¤åˆ¶ç”±äº Hadoop è¢«è®¾è®¡è¿è¡Œåœ¨å»‰ä»·çš„æœºå™¨ä¸Šï¼Œè¿™æ„å‘³ç€ç¡¬ä»¶æ˜¯ä¸å¯é çš„ï¼Œä¸ºäº†ä¿è¯å®¹é”™æ€§ï¼ŒHDFS æä¾›äº†æ•°æ®å¤åˆ¶æœºåˆ¶ã€‚HDFS å°†æ¯ä¸€ä¸ªæ–‡ä»¶å­˜å‚¨ä¸ºä¸€ç³»åˆ—å—ï¼Œæ¯ä¸ªå—ç”±å¤šä¸ªå‰¯æœ¬æ¥ä¿è¯å®¹é”™ï¼Œå—çš„å¤§å°å’Œå¤åˆ¶å› å­å¯ä»¥è‡ªè¡Œé…ç½®ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œå—å¤§å°æ˜¯ 128Mï¼Œé»˜è®¤å¤åˆ¶å› å­æ˜¯ 3ï¼‰ã€‚æ•°æ®å¤åˆ¶çš„å®ç°åŸç†å¤§å‹çš„ HDFS å®ä¾‹åœ¨é€šå¸¸åˆ†å¸ƒåœ¨å¤šä¸ªæœºæ¶çš„å¤šå°æœåŠ¡å™¨ä¸Šï¼Œä¸åŒæœºæ¶ä¸Šçš„ä¸¤å°æœåŠ¡å™¨ä¹‹é—´é€šè¿‡äº¤æ¢æœºè¿›è¡Œé€šè®¯ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒåŒä¸€æœºæ¶ä¸­çš„æœåŠ¡å™¨é—´çš„ç½‘ç»œå¸¦å®½å¤§äºä¸åŒæœºæ¶ä¸­çš„æœåŠ¡å™¨ä¹‹é—´çš„å¸¦å®½ã€‚å› æ­¤ HDFS é‡‡ç”¨æœºæ¶æ„ŸçŸ¥å‰¯æœ¬æ”¾ç½®ç­–ç•¥ï¼Œå¯¹äºå¸¸è§æƒ…å†µï¼Œå½“å¤åˆ¶å› å­ä¸º 3 æ—¶ï¼ŒHDFS çš„æ”¾ç½®ç­–ç•¥æ˜¯ï¼šåœ¨å†™å…¥ç¨‹åºä½äº datanode ä¸Šæ—¶ï¼Œå°±ä¼˜å…ˆå°†å†™å…¥æ–‡ä»¶çš„ä¸€ä¸ªå‰¯æœ¬æ”¾ç½®åœ¨è¯¥ datanode ä¸Šï¼Œå¦åˆ™æ”¾åœ¨éšæœº datanode ä¸Šã€‚ä¹‹ååœ¨å¦ä¸€ä¸ªè¿œç¨‹æœºæ¶ä¸Šçš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ”¾ç½®å¦ä¸€ä¸ªå‰¯æœ¬ï¼Œå¹¶åœ¨è¯¥æœºæ¶ä¸Šçš„å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ”¾ç½®æœ€åä¸€ä¸ªå‰¯æœ¬ã€‚æ­¤ç­–ç•¥å¯ä»¥å‡å°‘æœºæ¶é—´çš„å†™å…¥æµé‡ï¼Œä»è€Œæé«˜å†™å…¥æ€§èƒ½ã€‚å¦‚æœå¤åˆ¶å› å­å¤§äº 3ï¼Œåˆ™éšæœºç¡®å®šç¬¬ 4 ä¸ªå’Œä¹‹åå‰¯æœ¬çš„æ”¾ç½®ä½ç½®ï¼ŒåŒæ—¶ä¿æŒæ¯ä¸ªæœºæ¶çš„å‰¯æœ¬æ•°é‡ä½äºä¸Šé™ï¼Œä¸Šé™å€¼é€šå¸¸ä¸º ï¼ˆå¤åˆ¶ç³»æ•° - 1ï¼‰/æœºæ¶æ•°é‡ + 2ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä¸å…è®¸åŒä¸€ä¸ª dataNode ä¸Šå…·æœ‰åŒä¸€ä¸ªå—çš„å¤šä¸ªå‰¯æœ¬ã€‚å‰¯æœ¬çš„é€‰æ‹©ä¸ºäº†æœ€å¤§é™åº¦åœ°å‡å°‘å¸¦å®½æ¶ˆè€—å’Œè¯»å–å»¶è¿Ÿï¼ŒHDFS åœ¨æ‰§è¡Œè¯»å–è¯·æ±‚æ—¶ï¼Œä¼˜å…ˆè¯»å–è·ç¦»è¯»å–å™¨æœ€è¿‘çš„å‰¯æœ¬ã€‚å¦‚æœåœ¨ä¸è¯»å–å™¨èŠ‚ç‚¹ç›¸åŒçš„æœºæ¶ä¸Šå­˜åœ¨å‰¯æœ¬ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹©è¯¥å‰¯æœ¬ã€‚å¦‚æœ HDFS ç¾¤é›†è·¨è¶Šå¤šä¸ªæ•°æ®ä¸­å¿ƒï¼Œåˆ™ä¼˜å…ˆé€‰æ‹©æœ¬åœ°æ•°æ®ä¸­å¿ƒä¸Šçš„å‰¯æœ¬ã€‚æ¶æ„çš„ç¨³å®šæ€§å¿ƒè·³æœºåˆ¶å’Œé‡æ–°å¤åˆ¶æ¯ä¸ª DataNode å®šæœŸå‘ NameNode å‘é€å¿ƒè·³æ¶ˆæ¯ï¼Œå¦‚æœè¶…è¿‡æŒ‡å®šæ—¶é—´æ²¡æœ‰æ”¶åˆ°å¿ƒè·³æ¶ˆæ¯ï¼Œåˆ™å°† DataNode æ ‡è®°ä¸ºæ­»äº¡ã€‚NameNode ä¸ä¼šå°†ä»»ä½•æ–°çš„ IO è¯·æ±‚è½¬å‘ç»™æ ‡è®°ä¸ºæ­»äº¡çš„ DataNodeï¼Œä¹Ÿä¸ä¼šå†ä½¿ç”¨è¿™äº› DataNode ä¸Šçš„æ•°æ®ã€‚ ç”±äºæ•°æ®ä¸å†å¯ç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´æŸäº›å—çš„å¤åˆ¶å› å­å°äºå…¶æŒ‡å®šå€¼ï¼ŒNameNode ä¼šè·Ÿè¸ªè¿™äº›å—ï¼Œå¹¶åœ¨å¿…è¦çš„æ—¶å€™è¿›è¡Œé‡æ–°å¤åˆ¶ã€‚æ•°æ®çš„å®Œæ•´æ€§ç”±äºå­˜å‚¨è®¾å¤‡æ•…éšœç­‰åŸå› ï¼Œå­˜å‚¨åœ¨ DataNode ä¸Šçš„æ•°æ®å—ä¹Ÿä¼šå‘ç”ŸæŸåã€‚ä¸ºäº†é¿å…è¯»å–åˆ°å·²ç»æŸåçš„æ•°æ®è€Œå¯¼è‡´é”™è¯¯ï¼ŒHDFS æä¾›äº†æ•°æ®å®Œæ•´æ€§æ ¡éªŒæœºåˆ¶æ¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼šå½“å®¢æˆ·ç«¯åˆ›å»º HDFS æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šè®¡ç®—æ–‡ä»¶çš„æ¯ä¸ªå—çš„ æ ¡éªŒå’Œï¼Œå¹¶å°† æ ¡éªŒå’Œ å­˜å‚¨åœ¨åŒä¸€ HDFS å‘½åç©ºé—´ä¸‹çš„å•ç‹¬çš„éšè—æ–‡ä»¶ä¸­ã€‚å½“å®¢æˆ·ç«¯æ£€ç´¢æ–‡ä»¶å†…å®¹æ—¶ï¼Œå®ƒä¼šéªŒè¯ä»æ¯ä¸ª DataNode æ¥æ”¶çš„æ•°æ®æ˜¯å¦ä¸å­˜å‚¨åœ¨å…³è”æ ¡éªŒå’Œæ–‡ä»¶ä¸­çš„ æ ¡éªŒå’Œ åŒ¹é…ã€‚å¦‚æœåŒ¹é…å¤±è´¥ï¼Œåˆ™è¯æ˜æ•°æ®å·²ç»æŸåï¼Œæ­¤æ—¶å®¢æˆ·ç«¯ä¼šé€‰æ‹©ä»å…¶ä»– DataNode è·å–è¯¥å—çš„å…¶ä»–å¯ç”¨å‰¯æœ¬ã€‚å…ƒæ•°æ®çš„ç£ç›˜æ•…éšœFsImage å’Œ EditLog æ˜¯ HDFS çš„æ ¸å¿ƒæ•°æ®ï¼Œè¿™äº›æ•°æ®çš„æ„å¤–ä¸¢å¤±å¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ª HDFS æœåŠ¡ä¸å¯ç”¨ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é…ç½® NameNode ä½¿å…¶æ”¯æŒ FsImage å’Œ EditLog å¤šå‰¯æœ¬åŒæ­¥ï¼Œè¿™æ · FsImage æˆ– EditLog çš„ä»»ä½•æ”¹å˜éƒ½ä¼šå¼•èµ·æ¯ä¸ªå‰¯æœ¬ FsImage å’Œ EditLog çš„åŒæ­¥æ›´æ–°ã€‚æ”¯æŒå¿«ç…§å¿«ç…§æ”¯æŒåœ¨ç‰¹å®šæ—¶åˆ»å­˜å‚¨æ•°æ®å‰¯æœ¬ï¼Œåœ¨æ•°æ®æ„å¤–æŸåæ—¶ï¼Œå¯ä»¥é€šè¿‡å›æ»šæ“ä½œæ¢å¤åˆ°å¥åº·çš„æ•°æ®çŠ¶æ€ã€‚HDFS çš„ç‰¹ç‚¹é«˜å®¹é”™ç”±äº HDFS é‡‡ç”¨æ•°æ®çš„å¤šå‰¯æœ¬æ–¹æ¡ˆï¼Œæ‰€ä»¥éƒ¨åˆ†ç¡¬ä»¶çš„æŸåä¸ä¼šå¯¼è‡´å…¨éƒ¨æ•°æ®çš„ä¸¢å¤±ã€‚é«˜ååé‡HDFS è®¾è®¡çš„é‡ç‚¹æ˜¯æ”¯æŒé«˜ååé‡çš„æ•°æ®è®¿é—®ï¼Œè€Œä¸æ˜¯ä½å»¶è¿Ÿçš„æ•°æ®è®¿é—®ã€‚å¤§æ–‡ä»¶æ”¯æŒHDFS é€‚åˆäºå¤§æ–‡ä»¶çš„å­˜å‚¨ï¼Œæ–‡æ¡£çš„å¤§å°åº”è¯¥æ˜¯æ˜¯ GB åˆ° TB çº§åˆ«çš„ã€‚ç®€å•ä¸€è‡´æ€§æ¨¡å‹HDFS æ›´é€‚åˆäºä¸€æ¬¡å†™å…¥å¤šæ¬¡è¯»å– (write-once-read-many) çš„è®¿é—®æ¨¡å‹ã€‚æ”¯æŒå°†å†…å®¹è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ï¼Œä½†ä¸æ”¯æŒæ•°æ®çš„éšæœºè®¿é—®ï¼Œä¸èƒ½ä»æ–‡ä»¶ä»»æ„ä½ç½®æ–°å¢æ•°æ®ã€‚è·¨å¹³å°ç§»æ¤æ€§HDFS å…·æœ‰è‰¯å¥½çš„è·¨å¹³å°ç§»æ¤æ€§ï¼Œè¿™ä½¿å¾—å…¶ä»–å¤§æ•°æ®è®¡ç®—æ¡†æ¶éƒ½å°†å…¶ä½œä¸ºæ•°æ®æŒä¹…åŒ–å­˜å‚¨çš„é¦–é€‰æ–¹æ¡ˆã€‚é™„ï¼šå›¾è§£HDFSå­˜å‚¨åŸç†è¯´æ˜ï¼šä»¥ä¸‹å›¾ç‰‡å¼•ç”¨è‡ªåšå®¢ï¼šç¿»è¯‘ç»å…¸ HDFS åŸç†è®²è§£æ¼«ç”»HDFSå†™æ•°æ®åŸç†HDFSè¯»æ•°æ®åŸç†HDFSæ•…éšœç±»å‹å’Œå…¶æ£€æµ‹æ–¹æ³•æ£€æµ‹æ•…éšœå¹¶å¿«é€Ÿï¼Œè‡ªåŠ¨åœ°ä»æ•…éšœä¸­æ¢å¤æ˜¯HDFSçš„æ ¸å¿ƒç›®æ ‡ã€‚ç¬¬äºŒéƒ¨åˆ†ï¼šè¯»å†™æ•…éšœçš„å¤„ç†ç¬¬ä¸‰éƒ¨åˆ†ï¼šDataNode æ•…éšœå¤„ç†å‰¯æœ¬å¸ƒå±€ç­–ç•¥ï¼šHDFS shell-lsæŸ¥çœ‹ç›®å½•hdfs dfs -ls /-mkdiråˆ›å»ºç›®å½•hdfs dfs -mkdir -p /aaa/bbb/cc/dd-rmåˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹hdfs dfs -rm -r /aaa/bbb/cc/dd-rmdiråˆ é™¤ç©ºç›®å½•hdfs dfs -rmdir /aaa/bbb/cc/dd-puthdfs dfs -put /opt/jdk-8u181-linux-x64.tar.gz /opt/-gethdfs dfs -get /aaa/jdk.tar.gz-cpä»hdfsçš„ä¸€ä¸ªè·¯å¾„æ‹·è´hdfsçš„å¦ä¸€ä¸ªè·¯å¾„hdfs dfs -cp /aaa/jdk.tar.gz /bbb/jdk.tar.gz.2-countç»Ÿè®¡ä¸€ä¸ªæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶èŠ‚ç‚¹æ•°é‡hdfs dfs -count /-dfç»Ÿè®¡æ–‡ä»¶ç³»ç»Ÿçš„å¯ç”¨ç©ºé—´ä¿¡æ¯hdfs dfs -df -h /-setrepè®¾ç½®hdfsä¸­æ–‡ä»¶çš„å‰¯æœ¬æ•°é‡hdfs dfs -setrep 3 /aaa/jdk.tar.gzdifference between hdfs dfs and hadoop fshadoop fsæ˜¯ä¸€ç§æ›´â€œé€šç”¨â€çš„å‘½ä»¤ï¼Œå®ƒä½¿æ‚¨å¯ä»¥ä¸åŒ…æ‹¬Hadoopåœ¨å†…çš„å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œè€Œhdfs dfsè¯¥å‘½ä»¤ä¸“ç”¨äºHDFSã€‚è¯·æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯HDFS ï¼Œåˆ™hdfs dfs and hadoop fså‘½ä»¤æˆä¸ºåŒä¹‰è¯ã€‚å®é™…ä¸Šï¼Œå¦‚æœæ‚¨å‘å‡ºå‘½ä»¤ï¼Œå®ƒå°†å‘Šè¯‰æ‚¨è¯¥å‘½ä»¤å·²è¢«å¼ƒç”¨ï¼Œæ‚¨åº”è¯¥æ”¹ç”¨hdfs dfsä½†æ˜¯ï¼Œå½“æ‚¨è°ƒç”¨è¿™äº›å‘½ä»¤æ—¶ï¼Œå®é™…æ–‡ä»¶å°†åœ¨hadoopå®‰è£…ç›®å½•çš„binç›®å½•ä¸­æ‰§è¡Œã€‚å¦‚æœè¿è¡Œhdfs dfså‘½ä»¤ï¼Œå®ƒå°†è°ƒç”¨hadoopå®‰è£…ç›®å½•ä¸­binç›®å½•ä¸­çš„hdfsæ–‡ä»¶ï¼Œåè·Ÿç¬¬ä¸€ä¸ªå‚æ•°dfs å‘Šè¯‰hdfså‘½ä»¤æˆ‘ä»¬è¦ä½¿ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆhdfsï¼‰è€Œä¸æ˜¯æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œè¿™æ˜¯é»˜è®¤é€‰é¡¹ã€‚ç¬¬äºŒä¸ªå‘½ä»¤hadoop fsã€‚å®ƒå°†åœ¨hadoopå®‰è£…ç›®å½•çš„binç›®å½•ä¸­è°ƒç”¨hadoopæ–‡ä»¶ã€‚å®ƒå°†é€šè¿‡å‘é€fsä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°æ¥è·Ÿè¿›è¯¥å‘½ä»¤/æ–‡ä»¶ã€‚å®ƒä¼šå‘Šè¯‰â€œ HADOOPâ€ï¼Œæˆ‘ä»¬æƒ³è¦åšçš„ä»»ä½•æ“ä½œéƒ½åº”è¯¥åœ¨è¯¥ç‰¹å®šç¾¤é›†ï¼ˆå³HDFSï¼‰ä¸Šç”±HADOOPå®‰è£…ç®¡ç†çš„æ–‡ä»¶ç³»ç»Ÿä¸Šå®Œæˆã€‚","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"hdfs","slug":"hdfs","permalink":"cpeixin.cn/tags/hdfs/"}]},{"title":"ç®—æ³• - åŸºæ•°æ’åº","slug":"ç®—æ³•-åŸºæ•°æ’åº","date":"2016-09-26T05:56:15.000Z","updated":"2020-05-22T06:12:46.151Z","comments":true,"path":"2016/09/26/ç®—æ³•-åŸºæ•°æ’åº/","link":"","permalink":"cpeixin.cn/2016/09/26/%E7%AE%97%E6%B3%95-%E5%9F%BA%E6%95%B0%E6%8E%92%E5%BA%8F/","excerpt":"","text":"åŸºæ•°æ’åºæ˜¯ä¸€ç§éæ¯”è¾ƒå‹æ•´æ•°æ’åºç®—æ³•ï¼Œå…¶åŸç†æ˜¯å°†æ•´æ•°æŒ‰ä½æ•°åˆ‡å‰²æˆä¸åŒçš„æ•°å­—ï¼Œç„¶åæŒ‰æ¯ä¸ªä½æ•°åˆ†åˆ«æ¯”è¾ƒã€‚ç”±äºæ•´æ•°ä¹Ÿå¯ä»¥è¡¨è¾¾å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚åå­—æˆ–æ—¥æœŸï¼‰å’Œç‰¹å®šæ ¼å¼çš„æµ®ç‚¹æ•°ï¼Œæ‰€ä»¥åŸºæ•°æ’åºä¹Ÿä¸æ˜¯åªèƒ½ä½¿ç”¨äºæ•´æ•°ã€‚æˆ‘ä»¬å†æ¥çœ‹è¿™æ ·ä¸€ä¸ªæ’åºé—®é¢˜ã€‚å‡è®¾æˆ‘ä»¬æœ‰ 10 ä¸‡ä¸ªæ‰‹æœºå·ç ï¼Œå¸Œæœ›å°†è¿™ 10 ä¸‡ä¸ªæ‰‹æœºå·ç ä»å°åˆ°å¤§æ’åºï¼Œä½ æœ‰ä»€ä¹ˆæ¯”è¾ƒå¿«é€Ÿçš„æ’åºæ–¹æ³•å‘¢ï¼Ÿæˆ‘ä»¬ä¹‹å‰è®²çš„å¿«æ’ï¼Œæ—¶é—´å¤æ‚åº¦å¯ä»¥åšåˆ° O(nlogn)ï¼Œè¿˜æœ‰æ›´é«˜æ•ˆçš„æ’åºç®—æ³•å—ï¼Ÿæ¡¶æ’åºã€è®¡æ•°æ’åºèƒ½æ´¾ä¸Šç”¨åœºå—ï¼Ÿæ‰‹æœºå·ç æœ‰ 11 ä½ï¼ŒèŒƒå›´å¤ªå¤§ï¼Œæ˜¾ç„¶ä¸é€‚åˆç”¨è¿™ä¸¤ç§æ’åºç®—æ³•ã€‚é’ˆå¯¹è¿™ä¸ªæ’åºé—®é¢˜ï¼Œæœ‰æ²¡æœ‰æ—¶é—´å¤æ‚åº¦æ˜¯ O(n) çš„ç®—æ³•å‘¢ï¼Ÿç°åœ¨æˆ‘å°±æ¥ä»‹ç»ä¸€ç§æ–°çš„æ’åºç®—æ³•ï¼ŒåŸºæ•°æ’åºã€‚åˆšåˆšè¿™ä¸ªé—®é¢˜é‡Œæœ‰è¿™æ ·çš„è§„å¾‹ï¼šå‡è®¾è¦æ¯”è¾ƒä¸¤ä¸ªæ‰‹æœºå·ç  aï¼Œb çš„å¤§å°ï¼Œå¦‚æœåœ¨å‰é¢å‡ ä½ä¸­ï¼Œa æ‰‹æœºå·ç å·²ç»æ¯” b æ‰‹æœºå·ç å¤§äº†ï¼Œé‚£åé¢çš„å‡ ä½å°±ä¸ç”¨çœ‹äº†ã€‚å€ŸåŠ©ç¨³å®šæ’åºç®—æ³•ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå·§å¦™çš„å®ç°æ€è·¯ï¼Œå…ˆæŒ‰ç…§æœ€åä¸€ä½æ¥æ’åºæ‰‹æœºå·ç ï¼Œç„¶åï¼Œå†æŒ‰ç…§å€’æ•°ç¬¬äºŒä½é‡æ–°æ’åºï¼Œä»¥æ­¤ç±»æ¨ï¼Œæœ€åæŒ‰ç…§ç¬¬ä¸€ä½é‡æ–°æ’åºã€‚ç»è¿‡ 11 æ¬¡æ’åºä¹‹åï¼Œæ‰‹æœºå·ç å°±éƒ½æœ‰åºäº†ã€‚æ‰‹æœºå·ç ç¨å¾®æœ‰ç‚¹é•¿ï¼Œç”»å›¾æ¯”è¾ƒä¸å®¹æ˜“çœ‹æ¸…æ¥šï¼Œæˆ‘ç”¨å­—ç¬¦ä¸²æ’åºçš„ä¾‹å­ï¼Œç”»äº†ä¸€å¼ åŸºæ•°æ’åºçš„è¿‡ç¨‹åˆ†è§£å›¾ï¼Œä½ å¯ä»¥çœ‹ä¸‹ã€‚æ³¨æ„ï¼Œè¿™é‡ŒæŒ‰ç…§æ¯ä½æ¥æ’åºçš„æ’åºç®—æ³•è¦æ˜¯ç¨³å®šçš„ï¼Œå¦åˆ™è¿™ä¸ªå®ç°æ€è·¯å°±æ˜¯ä¸æ­£ç¡®çš„ã€‚å› ä¸ºå¦‚æœæ˜¯éç¨³å®šæ’åºç®—æ³•ï¼Œé‚£æœ€åä¸€æ¬¡æ’åºåªä¼šè€ƒè™‘æœ€é«˜ä½çš„å¤§å°é¡ºåºï¼Œå®Œå…¨ä¸ç®¡å…¶ä»–ä½çš„å¤§å°å…³ç³»ï¼Œé‚£ä¹ˆä½ä½çš„æ’åºå°±å®Œå…¨æ²¡æœ‰æ„ä¹‰äº†ã€‚æ ¹æ®æ¯ä¸€ä½æ¥æ’åºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åˆšè®²è¿‡çš„æ¡¶æ’åºæˆ–è€…è®¡æ•°æ’åºï¼Œå®ƒä»¬çš„æ—¶é—´å¤æ‚åº¦å¯ä»¥åšåˆ° O(n)ã€‚å¦‚æœè¦æ’åºçš„æ•°æ®æœ‰ k ä½ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦ k æ¬¡æ¡¶æ’åºæˆ–è€…è®¡æ•°æ’åºï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(k*n)ã€‚å½“ k ä¸å¤§çš„æ—¶å€™ï¼Œæ¯”å¦‚æ‰‹æœºå·ç æ’åºçš„ä¾‹å­ï¼Œk æœ€å¤§å°±æ˜¯ 11ï¼Œæ‰€ä»¥åŸºæ•°æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±è¿‘ä¼¼äº O(n)ã€‚å®é™…ä¸Šï¼Œæœ‰æ—¶å€™è¦æ’åºçš„æ•°æ®å¹¶ä¸éƒ½æ˜¯ç­‰é•¿çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬æ’åºç‰›æ´¥å­—å…¸ä¸­çš„ 20 ä¸‡ä¸ªè‹±æ–‡å•è¯ï¼Œæœ€çŸ­çš„åªæœ‰ 1 ä¸ªå­—æ¯ï¼Œæœ€é•¿çš„æˆ‘ç‰¹æ„å»æŸ¥äº†ä¸‹ï¼Œæœ‰ 45 ä¸ªå­—æ¯ï¼Œä¸­æ–‡ç¿»è¯‘æ˜¯å°˜è‚ºç—…ã€‚å¯¹äºè¿™ç§ä¸ç­‰é•¿çš„æ•°æ®ï¼ŒåŸºæ•°æ’åºè¿˜é€‚ç”¨å—ï¼Ÿå®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰çš„å•è¯è¡¥é½åˆ°ç›¸åŒé•¿åº¦ï¼Œä½æ•°ä¸å¤Ÿçš„å¯ä»¥åœ¨åé¢è¡¥â€œ0â€ï¼Œå› ä¸ºæ ¹æ®ASCII å€¼ï¼Œæ‰€æœ‰å­—æ¯éƒ½å¤§äºâ€œ0â€ï¼Œæ‰€ä»¥è¡¥â€œ0â€ä¸ä¼šå½±å“åˆ°åŸæœ‰çš„å¤§å°é¡ºåºã€‚è¿™æ ·å°±å¯ä»¥ç»§ç»­ç”¨åŸºæ•°æ’åºäº†ã€‚æˆ‘æ¥æ€»ç»“ä¸€ä¸‹ï¼ŒåŸºæ•°æ’åºå¯¹è¦æ’åºçš„æ•°æ®æ˜¯æœ‰è¦æ±‚çš„ï¼Œéœ€è¦å¯ä»¥åˆ†å‰²å‡ºç‹¬ç«‹çš„â€œä½â€æ¥æ¯”è¾ƒï¼Œè€Œä¸”ä½ä¹‹é—´æœ‰é€’è¿›çš„å…³ç³»ï¼Œå¦‚æœ a æ•°æ®çš„é«˜ä½æ¯” b æ•°æ®å¤§ï¼Œé‚£å‰©ä¸‹çš„ä½ä½å°±ä¸ç”¨æ¯”è¾ƒäº†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ¯ä¸€ä½çš„æ•°æ®èŒƒå›´ä¸èƒ½å¤ªå¤§ï¼Œè¦å¯ä»¥ç”¨çº¿æ€§æ’åºç®—æ³•æ¥æ’åºï¼Œå¦åˆ™ï¼ŒåŸºæ•°æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±æ— æ³•åšåˆ° O(n) äº†ã€‚åŸºæ•°æ’åº vs è®¡æ•°æ’åº vs æ¡¶æ’åºåŸºæ•°æ’åºæœ‰ä¸¤ç§æ–¹æ³•ï¼šè¿™ä¸‰ç§æ’åºç®—æ³•éƒ½åˆ©ç”¨äº†æ¡¶çš„æ¦‚å¿µï¼Œä½†å¯¹æ¡¶çš„ä½¿ç”¨æ–¹æ³•ä¸Šæœ‰æ˜æ˜¾å·®å¼‚ï¼šåŸºæ•°æ’åºï¼šæ ¹æ®é”®å€¼çš„æ¯ä½æ•°å­—æ¥åˆ†é…æ¡¶ï¼›è®¡æ•°æ’åºï¼šæ¯ä¸ªæ¡¶åªå­˜å‚¨å•ä¸€é”®å€¼ï¼›æ¡¶æ’åºï¼šæ¯ä¸ªæ¡¶å­˜å‚¨ä¸€å®šèŒƒå›´çš„æ•°å€¼ï¼›æˆ‘ä»¬å­¦ä¹ äº† 3 ç§çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„æ’åºç®—æ³•ï¼Œæœ‰æ¡¶æ’åºã€è®¡æ•°æ’åºã€åŸºæ•°æ’åºã€‚å®ƒä»¬å¯¹è¦æ’åºçš„æ•°æ®éƒ½æœ‰æ¯”è¾ƒè‹›åˆ»çš„è¦æ±‚ï¼Œåº”ç”¨ä¸æ˜¯éå¸¸å¹¿æ³›ã€‚ä½†æ˜¯å¦‚æœæ•°æ®ç‰¹å¾æ¯”è¾ƒç¬¦åˆè¿™äº›æ’åºç®—æ³•çš„è¦æ±‚ï¼Œåº”ç”¨è¿™äº›ç®—æ³•ï¼Œä¼šéå¸¸é«˜æ•ˆï¼Œçº¿æ€§æ—¶é—´å¤æ‚åº¦å¯ä»¥è¾¾åˆ° O(n)ã€‚æ¡¶æ’åºå’Œè®¡æ•°æ’åºçš„æ’åºæ€æƒ³æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œéƒ½æ˜¯é’ˆå¯¹èŒƒå›´ä¸å¤§çš„æ•°æ®ï¼Œå°†æ•°æ®åˆ’åˆ†æˆä¸åŒçš„æ¡¶æ¥å®ç°æ’åºã€‚åŸºæ•°æ’åºè¦æ±‚æ•°æ®å¯ä»¥åˆ’åˆ†æˆé«˜ä½ä½ï¼Œä½ä¹‹é—´æœ‰é€’è¿›å…³ç³»ã€‚æ¯”è¾ƒä¸¤ä¸ªæ•°ï¼Œæˆ‘ä»¬åªéœ€è¦æ¯”è¾ƒé«˜ä½ï¼Œé«˜ä½ç›¸åŒçš„å†æ¯”è¾ƒä½ä½ã€‚è€Œä¸”æ¯ä¸€ä½çš„æ•°æ®èŒƒå›´ä¸èƒ½å¤ªå¤§ï¼Œå› ä¸ºåŸºæ•°æ’åºç®—æ³•éœ€è¦å€ŸåŠ©æ¡¶æ’åºæˆ–è€…è®¡æ•°æ’åºæ¥å®Œæˆæ¯ä¸€ä¸ªä½çš„æ’åºå·¥ä½œã€‚","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"æ’åº","slug":"æ’åº","permalink":"cpeixin.cn/tags/%E6%8E%92%E5%BA%8F/"}]},{"title":"ç®—æ³• - é€’å½’","slug":"ç®—æ³•-é€’å½’","date":"2016-09-15T13:01:56.000Z","updated":"2020-05-21T15:13:08.403Z","comments":true,"path":"2016/09/15/ç®—æ³•-é€’å½’/","link":"","permalink":"cpeixin.cn/2016/09/15/%E7%AE%97%E6%B3%95-%E9%80%92%E5%BD%92/","excerpt":"","text":"é€’å½’å¯¹æˆ‘æ¥è¯´çœŸçš„æ˜¯æ™¦æ¶©éš¾æ‡‚å•Šï¼Œçœ‹ä¼¼ç®€å•ï¼Œä½†æ˜¯å½“åŠ¨æ‰‹å†™ä»£ç æƒ³é€»è¾‘çš„æ—¶å€™ï¼Œæ— ä»ä¸‹æ‰‹çš„æ„Ÿè§‰ã€‚ä¸€æœ¬ä¹¦ä¸Šè¯´ï¼Œçˆ±é€’å½’çš„äººçˆ±çš„è¦æ­»ï¼Œä¸çˆ±é€’å½’çš„äººæ¨çš„è¦æ­»ï¼Œè¿˜æœ‰ä¸€ç§ä¸çˆ±é€’å½’ä½†æ˜¯éšååˆçˆ±çš„è¦æ­»ã€‚leigh caldwell åœ¨ stack overflowä¸Šè¯´ï¼Œå¦‚æœä½¿ç”¨å¾ªç¯ï¼Œç¨‹åºçš„æ•ˆç‡å¯èƒ½æ›´é«˜ï¼Œä½†æ˜¯ä½¿ç”¨é€’å½’ï¼Œç¨‹åºæ›´å®¹æ˜“ç†è§£ã€‚å­˜åœ¨å³åˆç†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹é€’å½’æ¨èæ³¨å†Œè¿”ä½£é‡‘çš„è¿™ä¸ªåŠŸèƒ½æˆ‘æƒ³ä½ åº”è¯¥ä¸é™Œç”Ÿå§ï¼Ÿç°åœ¨å¾ˆå¤š App éƒ½æœ‰è¿™ä¸ªåŠŸèƒ½ã€‚è¿™ä¸ªåŠŸèƒ½ä¸­ï¼Œç”¨æˆ· A æ¨èç”¨æˆ· B æ¥æ³¨å†Œï¼Œç”¨æˆ· B åˆæ¨èäº†ç”¨æˆ· C æ¥æ³¨å†Œã€‚æˆ‘ä»¬å¯ä»¥è¯´ï¼Œç”¨æˆ· C çš„â€œæœ€ç»ˆæ¨èäººâ€ä¸ºç”¨æˆ· Aï¼Œç”¨æˆ· B çš„â€œæœ€ç»ˆæ¨èäººâ€ä¹Ÿä¸ºç”¨æˆ· Aï¼Œè€Œç”¨æˆ· A æ²¡æœ‰â€œæœ€ç»ˆæ¨èäººâ€ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡æ•°æ®åº“æ¥è®°å½•è¿™ç§æ¨èå…³ç³»ã€‚åœ¨æ•°æ®åº“è¡¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®°å½•ä¸¤è¡Œæ•°æ®ï¼Œå…¶ä¸­ actor_id è¡¨ç¤ºç”¨æˆ· idï¼Œreferrer_id è¡¨ç¤ºæ¨èäºº idã€‚åŸºäºè¿™ä¸ªèƒŒæ™¯ï¼Œæˆ‘çš„é—®é¢˜æ˜¯ï¼Œç»™å®šä¸€ä¸ªç”¨æˆ· IDï¼Œå¦‚ä½•æŸ¥æ‰¾è¿™ä¸ªç”¨æˆ·çš„â€œæœ€ç»ˆæ¨èäººâ€ï¼Ÿ å¸¦ç€è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ä»Šå¤©çš„å†…å®¹ï¼Œé€’å½’ï¼ˆRecursionï¼‰ï¼å¦‚ä½•ç†è§£â€œé€’å½’â€ï¼Ÿä»æˆ‘è‡ªå·±å­¦ä¹ æ•°æ®ç»“æ„å’Œç®—æ³•çš„ç»å†æ¥çœ‹ï¼Œæˆ‘ä¸ªäººè§‰å¾—ï¼Œæœ‰ä¸¤ä¸ªæœ€éš¾ç†è§£çš„çŸ¥è¯†ç‚¹ï¼Œä¸€ä¸ªæ˜¯åŠ¨æ€è§„åˆ’ï¼Œå¦ä¸€ä¸ªå°±æ˜¯é€’å½’ã€‚é€’å½’æ˜¯ä¸€ç§åº”ç”¨éå¸¸å¹¿æ³›çš„ç®—æ³•ï¼ˆæˆ–è€…ç¼–ç¨‹æŠ€å·§ï¼‰ã€‚ä¹‹åæˆ‘ä»¬è¦è®²çš„å¾ˆå¤šæ•°æ®ç»“æ„å’Œç®—æ³•çš„ç¼–ç å®ç°éƒ½è¦ç”¨åˆ°é€’å½’ï¼Œæ¯”å¦‚ DFS æ·±åº¦ä¼˜å…ˆæœç´¢ã€å‰ä¸­ååºäºŒå‰æ ‘éå†ç­‰ç­‰ã€‚æ‰€ä»¥ï¼Œææ‡‚é€’å½’éå¸¸é‡è¦ï¼Œå¦åˆ™ï¼Œåé¢å¤æ‚ä¸€äº›çš„æ•°æ®ç»“æ„å’Œç®—æ³•å­¦èµ·æ¥å°±ä¼šæ¯”è¾ƒåƒåŠ›ã€‚ä¸è¿‡ï¼Œåˆ«çœ‹æˆ‘è¯´äº†è¿™ä¹ˆå¤šï¼Œé€’å½’æœ¬èº«å¯æ˜¯ä¸€ç‚¹å„¿éƒ½ä¸â€œé«˜å†·â€ï¼Œå’±ä»¬ç”Ÿæ´»ä¸­å°±æœ‰å¾ˆå¤šç”¨åˆ°é€’å½’çš„ä¾‹å­ã€‚å‘¨æœ«ä½ å¸¦ç€å¥³æœ‹å‹å»ç”µå½±é™¢çœ‹ç”µå½±ï¼Œå¥³æœ‹å‹é—®ä½ ï¼Œå’±ä»¬ç°åœ¨ååœ¨ç¬¬å‡ æ’å•Šï¼Ÿç”µå½±é™¢é‡Œé¢å¤ªé»‘äº†ï¼Œçœ‹ä¸æ¸…ï¼Œæ²¡æ³•æ•°ï¼Œç°åœ¨ä½ æ€ä¹ˆåŠï¼Ÿåˆ«å¿˜äº†ä½ æ˜¯ç¨‹åºå‘˜ï¼Œè¿™ä¸ªå¯éš¾ä¸å€’ä½ ï¼Œé€’å½’å°±å¼€å§‹æ’ä¸Šç”¨åœºäº†ã€‚äºæ˜¯ä½ å°±é—®å‰é¢ä¸€æ’çš„äººä»–æ˜¯ç¬¬å‡ æ’ï¼Œä½ æƒ³åªè¦åœ¨ä»–çš„æ•°å­—ä¸ŠåŠ ä¸€ï¼Œå°±çŸ¥é“è‡ªå·±åœ¨å“ªä¸€æ’äº†ã€‚ä½†æ˜¯ï¼Œå‰é¢çš„äººä¹Ÿçœ‹ä¸æ¸…å•Šï¼Œæ‰€ä»¥ä»–ä¹Ÿé—®ä»–å‰é¢çš„äººã€‚å°±è¿™æ ·ä¸€æ’ä¸€æ’å¾€å‰é—®ï¼Œç›´åˆ°é—®åˆ°ç¬¬ä¸€æ’çš„äººï¼Œè¯´æˆ‘åœ¨ç¬¬ä¸€æ’ï¼Œç„¶åå†è¿™æ ·ä¸€æ’ä¸€æ’å†æŠŠæ•°å­—ä¼ å›æ¥ã€‚ç›´åˆ°ä½ å‰é¢çš„äººå‘Šè¯‰ä½ ä»–åœ¨å“ªä¸€æ’ï¼Œäºæ˜¯ä½ å°±çŸ¥é“ç­”æ¡ˆäº†ã€‚è¿™å°±æ˜¯ä¸€ä¸ªéå¸¸æ ‡å‡†çš„é€’å½’æ±‚è§£é—®é¢˜çš„åˆ†è§£è¿‡ç¨‹ï¼Œå»çš„è¿‡ç¨‹å«â€œé€’â€ï¼Œå›æ¥çš„è¿‡ç¨‹å«â€œå½’â€ã€‚åŸºæœ¬ä¸Šï¼Œæ‰€æœ‰çš„é€’å½’é—®é¢˜éƒ½å¯ä»¥ç”¨é€’æ¨å…¬å¼æ¥è¡¨ç¤ºã€‚åˆšåˆšè¿™ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼Œæˆ‘ä»¬ç”¨é€’æ¨å…¬å¼å°†å®ƒè¡¨ç¤ºå‡ºæ¥å°±æ˜¯è¿™æ ·çš„ï¼š1f(n)=f(n-1)+1 å…¶ä¸­ï¼Œf(1)=1f(n) è¡¨ç¤ºä½ æƒ³çŸ¥é“è‡ªå·±åœ¨å“ªä¸€æ’ï¼Œf(n-1) è¡¨ç¤ºå‰é¢ä¸€æ’æ‰€åœ¨çš„æ’æ•°ï¼Œf(1)=1 è¡¨ç¤ºç¬¬ä¸€æ’çš„äººçŸ¥é“è‡ªå·±åœ¨ç¬¬ä¸€æ’ã€‚æœ‰äº†è¿™ä¸ªé€’æ¨å…¬å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆè½»æ¾åœ°å°†å®ƒæ”¹ä¸ºé€’å½’ä»£ç ï¼Œå¦‚ä¸‹ï¼š1234int f(int n) &#123; if (n == 1) return 1; return f(n-1) + 1;&#125;å¦‚æœä¸Šé¢æ‰¾åº§ä½çš„ä¾‹å­ä½ æ²¡æœ‰æ˜ç™½é€’å½’æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œé‚£ä¹ˆè¯·è¯»ä¸€è¯»ä¸‹é¢çš„é—®é¢˜ï¼šå¦‚ä½•ç»™ä¸€å †æ•°å­—æ’åºï¼Ÿ ç­”ï¼šåˆ†æˆä¸¤åŠï¼Œå…ˆæ’å·¦åŠè¾¹å†æ’å³åŠè¾¹ï¼Œæœ€ååˆå¹¶å°±è¡Œäº†ï¼Œè‡³äºæ€ä¹ˆæ’å·¦è¾¹å’Œå³è¾¹ï¼Œè¯·é‡æ–°é˜…è¯»è¿™å¥è¯ã€‚å­™æ‚Ÿç©ºèº«ä¸Šæœ‰å¤šå°‘æ ¹æ¯›ï¼Ÿ ç­”ï¼šä¸€æ ¹æ¯›åŠ å‰©ä¸‹çš„æ¯›ã€‚ä½ ä»Šå¹´å‡ å²ï¼Ÿ ç­”ï¼šå»å¹´çš„å²æ•°åŠ ä¸€å²,1999 å¹´æˆ‘å‡ºç”Ÿã€‚é€’å½’éœ€è¦æ»¡è¶³çš„ä¸‰ä¸ªæ¡ä»¶åˆšåˆšè¿™ä¸ªä¾‹å­æ˜¯éå¸¸å…¸å‹çš„é€’å½’ï¼Œé‚£ç©¶ç«Ÿä»€ä¹ˆæ ·çš„é—®é¢˜å¯ä»¥ç”¨é€’å½’æ¥è§£å†³å‘¢ï¼Ÿæˆ‘æ€»ç»“äº†ä¸‰ä¸ªæ¡ä»¶ï¼Œåªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼Œå°±å¯ä»¥ç”¨é€’å½’æ¥è§£å†³ã€‚1. ä¸€ä¸ªé—®é¢˜çš„è§£å¯ä»¥åˆ†è§£ä¸ºå‡ ä¸ªå­é—®é¢˜çš„è§£ä½•ä¸ºå­é—®é¢˜ï¼Ÿå­é—®é¢˜å°±æ˜¯æ•°æ®è§„æ¨¡æ›´å°çš„é—®é¢˜ã€‚æ¯”å¦‚ï¼Œå‰é¢è®²çš„ç”µå½±é™¢çš„ä¾‹å­ï¼Œä½ è¦çŸ¥é“ï¼Œâ€œè‡ªå·±åœ¨å“ªä¸€æ’â€çš„é—®é¢˜ï¼Œå¯ä»¥åˆ†è§£ä¸ºâ€œå‰ä¸€æ’çš„äººåœ¨å“ªä¸€æ’â€è¿™æ ·ä¸€ä¸ªå­é—®é¢˜ã€‚2. è¿™ä¸ªé—®é¢˜ä¸åˆ†è§£ä¹‹åçš„å­é—®é¢˜ï¼Œé™¤äº†æ•°æ®è§„æ¨¡ä¸åŒï¼Œæ±‚è§£æ€è·¯å®Œå…¨ä¸€æ ·æ¯”å¦‚ç”µå½±é™¢é‚£ä¸ªä¾‹å­ï¼Œä½ æ±‚è§£â€œè‡ªå·±åœ¨å“ªä¸€æ’â€çš„æ€è·¯ï¼Œå’Œå‰é¢ä¸€æ’äººæ±‚è§£â€œè‡ªå·±åœ¨å“ªä¸€æ’â€çš„æ€è·¯ï¼Œæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚3. å­˜åœ¨é€’å½’ç»ˆæ­¢æ¡ä»¶æŠŠé—®é¢˜åˆ†è§£ä¸ºå­é—®é¢˜ï¼ŒæŠŠå­é—®é¢˜å†åˆ†è§£ä¸ºå­å­é—®é¢˜ï¼Œä¸€å±‚ä¸€å±‚åˆ†è§£ä¸‹å»ï¼Œä¸èƒ½å­˜åœ¨æ— é™å¾ªç¯ï¼Œè¿™å°±éœ€è¦æœ‰ç»ˆæ­¢æ¡ä»¶ã€‚è¿˜æ˜¯ç”µå½±é™¢çš„ä¾‹å­ï¼Œç¬¬ä¸€æ’çš„äººä¸éœ€è¦å†ç»§ç»­è¯¢é—®ä»»ä½•äººï¼Œå°±çŸ¥é“è‡ªå·±åœ¨å“ªä¸€æ’ï¼Œä¹Ÿå°±æ˜¯ f(1)=1ï¼Œè¿™å°±æ˜¯é€’å½’çš„ç»ˆæ­¢æ¡ä»¶ã€‚å¦‚ä½•ç¼–å†™é€’å½’ä»£ç ï¼Ÿåˆšåˆšé“ºå«äº†è¿™ä¹ˆå¤šï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹ï¼Œå¦‚ä½•æ¥å†™é€’å½’ä»£ç ï¼Ÿæˆ‘ä¸ªäººè§‰å¾—ï¼Œå†™é€’å½’ä»£ç æœ€å…³é”®çš„æ˜¯å†™å‡ºé€’æ¨å…¬å¼ï¼Œæ‰¾åˆ°ç»ˆæ­¢æ¡ä»¶ï¼Œå‰©ä¸‹å°†é€’æ¨å…¬å¼è½¬åŒ–ä¸ºä»£ç å°±å¾ˆç®€å•äº†ã€‚ä½ å…ˆè®°ä½è¿™ä¸ªç†è®ºã€‚æˆ‘ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå¸¦ä½ ä¸€æ­¥ä¸€æ­¥å®ç°ä¸€ä¸ªé€’å½’ä»£ç ï¼Œå¸®ä½ ç†è§£ã€‚å‡å¦‚è¿™é‡Œæœ‰ n ä¸ªå°é˜¶ï¼Œæ¯æ¬¡ä½ å¯ä»¥è·¨ 1 ä¸ªå°é˜¶æˆ–è€… 2 ä¸ªå°é˜¶ï¼Œè¯·é—®èµ°è¿™ n ä¸ªå°é˜¶æœ‰å¤šå°‘ç§èµ°æ³•ï¼Ÿå¦‚æœæœ‰ 7 ä¸ªå°é˜¶ï¼Œä½ å¯ä»¥ 2ï¼Œ2ï¼Œ2ï¼Œ1 è¿™æ ·å­ä¸Šå»ï¼Œä¹Ÿå¯ä»¥ 1ï¼Œ2ï¼Œ1ï¼Œ1ï¼Œ2 è¿™æ ·å­ä¸Šå»ï¼Œæ€»ä¹‹èµ°æ³•æœ‰å¾ˆå¤šï¼Œé‚£å¦‚ä½•ç”¨ç¼–ç¨‹æ±‚å¾—æ€»å…±æœ‰å¤šå°‘ç§èµ°æ³•å‘¢ï¼Ÿæˆ‘ä»¬ä»”ç»†æƒ³ä¸‹ï¼Œå®é™…ä¸Šï¼Œå¯ä»¥æ ¹æ®ç¬¬ä¸€æ­¥çš„èµ°æ³•æŠŠæ‰€æœ‰èµ°æ³•åˆ†ä¸ºä¸¤ç±»ï¼Œç¬¬ä¸€ç±»æ˜¯ç¬¬ä¸€æ­¥èµ°äº† 1 ä¸ªå°é˜¶ï¼Œå¦ä¸€ç±»æ˜¯ç¬¬ä¸€æ­¥èµ°äº† 2 ä¸ªå°é˜¶ã€‚æ‰€ä»¥ n ä¸ªå°é˜¶çš„èµ°æ³•å°±ç­‰äºå…ˆèµ° 1 é˜¶åï¼Œn-1 ä¸ªå°é˜¶çš„èµ°æ³• åŠ ä¸Šå…ˆèµ° 2 é˜¶åï¼Œn-2 ä¸ªå°é˜¶çš„èµ°æ³•ã€‚ç”¨å…¬å¼è¡¨ç¤ºå°±æ˜¯ï¼š12f(n) = f(n-1)+f(n-2)æœ‰äº†é€’æ¨å…¬å¼ï¼Œé€’å½’ä»£ç åŸºæœ¬ä¸Šå°±å®Œæˆäº†ä¸€åŠã€‚æˆ‘ä»¬å†æ¥çœ‹ä¸‹ç»ˆæ­¢æ¡ä»¶ã€‚å½“æœ‰ä¸€ä¸ªå°é˜¶æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†ç»§ç»­é€’å½’ï¼Œå°±åªæœ‰ä¸€ç§èµ°æ³•ã€‚æ‰€ä»¥ f(1)=1ã€‚è¿™ä¸ªé€’å½’ç»ˆæ­¢æ¡ä»¶è¶³å¤Ÿå—ï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨ n=2ï¼Œn=3 è¿™æ ·æ¯”è¾ƒå°çš„æ•°è¯•éªŒä¸€ä¸‹ã€‚n=2 æ—¶ï¼Œf(2)=f(1)+f(0)ã€‚å¦‚æœé€’å½’ç»ˆæ­¢æ¡ä»¶åªæœ‰ä¸€ä¸ª f(1)=1ï¼Œé‚£ f(2) å°±æ— æ³•æ±‚è§£äº†ã€‚æ‰€ä»¥é™¤äº† f(1)=1 è¿™ä¸€ä¸ªé€’å½’ç»ˆæ­¢æ¡ä»¶å¤–ï¼Œè¿˜è¦æœ‰ f(0)=1ï¼Œè¡¨ç¤ºèµ° 0 ä¸ªå°é˜¶æœ‰ä¸€ç§èµ°æ³•ï¼Œä¸è¿‡è¿™æ ·å­çœ‹èµ·æ¥å°±ä¸ç¬¦åˆæ­£å¸¸çš„é€»è¾‘æ€ç»´äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ f(2)=2 ä½œä¸ºä¸€ç§ç»ˆæ­¢æ¡ä»¶ï¼Œè¡¨ç¤ºèµ° 2 ä¸ªå°é˜¶ï¼Œæœ‰ä¸¤ç§èµ°æ³•ï¼Œä¸€æ­¥èµ°å®Œæˆ–è€…åˆ†ä¸¤æ­¥æ¥èµ°ã€‚æ‰€ä»¥ï¼Œé€’å½’ç»ˆæ­¢æ¡ä»¶å°±æ˜¯ f(1)=1ï¼Œf(2)=2ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä½ å¯ä»¥å†æ‹¿ n=3ï¼Œn=4 æ¥éªŒè¯ä¸€ä¸‹ï¼Œè¿™ä¸ªç»ˆæ­¢æ¡ä»¶æ˜¯å¦è¶³å¤Ÿå¹¶ä¸”æ­£ç¡®ã€‚æˆ‘ä»¬æŠŠé€’å½’ç»ˆæ­¢æ¡ä»¶å’Œåˆšåˆšå¾—åˆ°çš„é€’æ¨å…¬å¼æ”¾åˆ°ä¸€èµ·å°±æ˜¯è¿™æ ·çš„ï¼š123f(1) = 1;f(2) = 2;f(n) = f(n-1)+f(n-2)æœ‰äº†è¿™ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬è½¬åŒ–æˆé€’å½’ä»£ç å°±ç®€å•å¤šäº†ã€‚æœ€ç»ˆçš„é€’å½’ä»£ç æ˜¯è¿™æ ·çš„ï¼š12345int f(int n) &#123; if (n == 1) return 1; if (n == 2) return 2; return f(n-1) + f(n-2);&#125;æˆ‘æ€»ç»“ä¸€ä¸‹ï¼Œå†™é€’å½’ä»£ç çš„å…³é”®å°±æ˜¯æ‰¾åˆ°å¦‚ä½•å°†å¤§é—®é¢˜åˆ†è§£ä¸ºå°é—®é¢˜çš„è§„å¾‹ï¼Œå¹¶ä¸”åŸºäºæ­¤å†™å‡ºé€’æ¨å…¬å¼ï¼Œç„¶åå†æ¨æ•²ç»ˆæ­¢æ¡ä»¶ï¼Œæœ€åå°†é€’æ¨å…¬å¼å’Œç»ˆæ­¢æ¡ä»¶ç¿»è¯‘æˆä»£ç ã€‚è®¡ç®—æœºæ“…é•¿åšé‡å¤çš„äº‹æƒ…ï¼Œæ‰€ä»¥é€’å½’æ­£å’Œå®ƒçš„èƒƒå£ã€‚è€Œæˆ‘ä»¬äººè„‘æ›´å–œæ¬¢å¹³é“ºç›´å™çš„æ€ç»´æ–¹å¼ã€‚å½“æˆ‘ä»¬çœ‹åˆ°é€’å½’æ—¶ï¼Œæˆ‘ä»¬æ€»æƒ³æŠŠé€’å½’å¹³é“ºå±•å¼€ï¼Œè„‘å­é‡Œå°±ä¼šå¾ªç¯ï¼Œä¸€å±‚ä¸€å±‚å¾€ä¸‹è°ƒï¼Œç„¶åå†ä¸€å±‚ä¸€å±‚è¿”å›ï¼Œè¯•å›¾æƒ³ææ¸…æ¥šè®¡ç®—æœºæ¯ä¸€æ­¥éƒ½æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“è¢«ç»•è¿›å»ã€‚å¯¹äºé€’å½’ä»£ç ï¼Œè¿™ç§è¯•å›¾æƒ³æ¸…æ¥šæ•´ä¸ªé€’å’Œå½’è¿‡ç¨‹çš„åšæ³•ï¼Œå®é™…ä¸Šæ˜¯è¿›å…¥äº†ä¸€ä¸ªæ€ç»´è¯¯åŒºã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ç†è§£èµ·æ¥æ¯”è¾ƒåƒåŠ›ï¼Œä¸»è¦åŸå› å°±æ˜¯è‡ªå·±ç»™è‡ªå·±åˆ¶é€ äº†è¿™ç§ç†è§£éšœç¢ã€‚é‚£æ­£ç¡®çš„æ€ç»´æ–¹å¼åº”è¯¥æ˜¯æ€æ ·çš„å‘¢ï¼Ÿå¦‚æœä¸€ä¸ªé—®é¢˜ A å¯ä»¥åˆ†è§£ä¸ºè‹¥å¹²å­é—®é¢˜ Bã€Cã€Dï¼Œä½ å¯ä»¥å‡è®¾å­é—®é¢˜ Bã€Cã€D å·²ç»è§£å†³ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæ€è€ƒå¦‚ä½•è§£å†³é—®é¢˜ Aã€‚è€Œä¸”ï¼Œä½ åªéœ€è¦æ€è€ƒé—®é¢˜ A ä¸å­é—®é¢˜ Bã€Cã€D ä¸¤å±‚ä¹‹é—´çš„å…³ç³»å³å¯ï¼Œä¸éœ€è¦ä¸€å±‚ä¸€å±‚å¾€ä¸‹æ€è€ƒå­é—®é¢˜ä¸å­å­é—®é¢˜ï¼Œå­å­é—®é¢˜ä¸å­å­å­é—®é¢˜ä¹‹é—´çš„å…³ç³»ã€‚å±è”½æ‰é€’å½’ç»†èŠ‚ï¼Œè¿™æ ·å­ç†è§£èµ·æ¥å°±ç®€å•å¤šäº†ã€‚å› æ­¤ï¼Œç¼–å†™é€’å½’ä»£ç çš„å…³é”®æ˜¯ï¼Œåªè¦é‡åˆ°é€’å½’ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒæŠ½è±¡æˆä¸€ä¸ªé€’æ¨å…¬å¼ï¼Œä¸ç”¨æƒ³ä¸€å±‚å±‚çš„è°ƒç”¨å…³ç³»ï¼Œä¸è¦è¯•å›¾ç”¨äººè„‘å»åˆ†è§£é€’å½’çš„æ¯ä¸ªæ­¥éª¤ã€‚é€’å½’ä»£ç è¦è­¦æƒ•å †æ ˆæº¢å‡ºåœ¨å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œç¼–å†™é€’å½’ä»£ç æ—¶ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚å †æ ˆæº¢å‡ºã€‚è€Œå †æ ˆæº¢å‡ºä¼šé€ æˆç³»ç»Ÿæ€§å´©æºƒï¼Œåæœä¼šéå¸¸ä¸¥é‡ã€‚ä¸ºä»€ä¹ˆé€’å½’ä»£ç å®¹æ˜“é€ æˆå †æ ˆæº¢å‡ºå‘¢ï¼Ÿæˆ‘ä»¬åˆè¯¥å¦‚ä½•é¢„é˜²å †æ ˆæº¢å‡ºå‘¢ï¼Ÿæˆ‘åœ¨â€œæ ˆâ€é‚£ä¸€èŠ‚è®²è¿‡ï¼Œå‡½æ•°è°ƒç”¨ä¼šä½¿ç”¨æ ˆæ¥ä¿å­˜ä¸´æ—¶å˜é‡ã€‚æ¯è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œéƒ½ä¼šå°†ä¸´æ—¶å˜é‡å°è£…ä¸ºæ ˆå¸§å‹å…¥å†…å­˜æ ˆï¼Œç­‰å‡½æ•°æ‰§è¡Œå®Œæˆè¿”å›æ—¶ï¼Œæ‰å‡ºæ ˆã€‚ç³»ç»Ÿæ ˆæˆ–è€…è™šæ‹Ÿæœºæ ˆç©ºé—´ä¸€èˆ¬éƒ½ä¸å¤§ã€‚å¦‚æœé€’å½’æ±‚è§£çš„æ•°æ®è§„æ¨¡å¾ˆå¤§ï¼Œè°ƒç”¨å±‚æ¬¡å¾ˆæ·±ï¼Œä¸€ç›´å‹å…¥æ ˆï¼Œå°±ä¼šæœ‰å †æ ˆæº¢å‡ºçš„é£é™©ã€‚æ¯”å¦‚å‰é¢çš„è®²åˆ°çš„ç”µå½±é™¢çš„ä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬å°†ç³»ç»Ÿæ ˆæˆ–è€… JVM å †æ ˆå¤§å°è®¾ç½®ä¸º 1KBï¼Œåœ¨æ±‚è§£ f(19999) æ—¶ä¾¿ä¼šå‡ºç°å¦‚ä¸‹å †æ ˆæŠ¥é”™ï¼š12Exception in thread \"main\" java.lang.StackOverflowErroré€’å½’ä»£ç è¦è­¦æƒ•é‡å¤è®¡ç®—é™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨é€’å½’æ—¶è¿˜ä¼šå‡ºç°é‡å¤è®¡ç®—çš„é—®é¢˜ã€‚åˆšæ‰æˆ‘è®²çš„ç¬¬äºŒä¸ªé€’å½’ä»£ç çš„ä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æŠŠæ•´ä¸ªé€’å½’è¿‡ç¨‹åˆ†è§£ä¸€ä¸‹çš„è¯ï¼Œé‚£å°±æ˜¯è¿™æ ·çš„ï¼šä»å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°ï¼Œæƒ³è¦è®¡ç®— f(5)ï¼Œéœ€è¦å…ˆè®¡ç®— f(4) å’Œ f(3)ï¼Œè€Œè®¡ç®— f(4) è¿˜éœ€è¦è®¡ç®— f(3)ï¼Œå› æ­¤ï¼Œf(3) å°±è¢«è®¡ç®—äº†å¾ˆå¤šæ¬¡ï¼Œè¿™å°±æ˜¯é‡å¤è®¡ç®—é—®é¢˜ã€‚ä¸ºäº†é¿å…é‡å¤è®¡ç®—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªæ•°æ®ç»“æ„ï¼ˆæ¯”å¦‚æ•£åˆ—è¡¨ï¼‰æ¥ä¿å­˜å·²ç»æ±‚è§£è¿‡çš„ f(k)ã€‚å½“é€’å½’è°ƒç”¨åˆ° f(k) æ—¶ï¼Œå…ˆçœ‹ä¸‹æ˜¯å¦å·²ç»æ±‚è§£è¿‡äº†ã€‚å¦‚æœæ˜¯ï¼Œåˆ™ç›´æ¥ä»æ•£åˆ—è¡¨ä¸­å–å€¼è¿”å›ï¼Œä¸éœ€è¦é‡å¤è®¡ç®—ï¼Œè¿™æ ·å°±èƒ½é¿å…åˆšè®²çš„é—®é¢˜äº†ã€‚é™¤äº†å †æ ˆæº¢å‡ºã€é‡å¤è®¡ç®—è¿™ä¸¤ä¸ªå¸¸è§çš„é—®é¢˜ã€‚é€’å½’ä»£ç è¿˜æœ‰å¾ˆå¤šåˆ«çš„é—®é¢˜ã€‚åœ¨æ—¶é—´æ•ˆç‡ä¸Šï¼Œé€’å½’ä»£ç é‡Œå¤šäº†å¾ˆå¤šå‡½æ•°è°ƒç”¨ï¼Œå½“è¿™äº›å‡½æ•°è°ƒç”¨çš„æ•°é‡è¾ƒå¤§æ—¶ï¼Œå°±ä¼šç§¯èšæˆä¸€ä¸ªå¯è§‚çš„æ—¶é—´æˆæœ¬ã€‚åœ¨ç©ºé—´å¤æ‚åº¦ä¸Šï¼Œå› ä¸ºé€’å½’è°ƒç”¨ä¸€æ¬¡å°±ä¼šåœ¨å†…å­˜æ ˆä¸­ä¿å­˜ä¸€æ¬¡ç°åœºæ•°æ®ï¼Œæ‰€ä»¥åœ¨åˆ†æé€’å½’ä»£ç ç©ºé—´å¤æ‚åº¦æ—¶ï¼Œéœ€è¦é¢å¤–è€ƒè™‘è¿™éƒ¨åˆ†çš„å¼€é”€ï¼Œæ¯”å¦‚æˆ‘ä»¬å‰é¢è®²åˆ°çš„ç”µå½±é™¢é€’å½’ä»£ç ï¼Œç©ºé—´å¤æ‚åº¦å¹¶ä¸æ˜¯ O(1)ï¼Œè€Œæ˜¯ O(n)ã€‚æ€ä¹ˆå°†é€’å½’ä»£ç æ”¹å†™ä¸ºéé€’å½’ä»£ç ï¼Ÿæˆ‘ä»¬åˆšè¯´äº†ï¼Œé€’å½’æœ‰åˆ©æœ‰å¼Šï¼Œåˆ©æ˜¯é€’å½’ä»£ç çš„è¡¨è¾¾åŠ›å¾ˆå¼ºï¼Œå†™èµ·æ¥éå¸¸ç®€æ´ï¼›è€Œå¼Šå°±æ˜¯ç©ºé—´å¤æ‚åº¦é«˜ã€æœ‰å †æ ˆæº¢å‡ºçš„é£é™©ã€å­˜åœ¨é‡å¤è®¡ç®—ã€è¿‡å¤šçš„å‡½æ•°è°ƒç”¨ä¼šè€—æ—¶è¾ƒå¤šç­‰é—®é¢˜ã€‚æ‰€ä»¥ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¦æ ¹æ®å®é™…æƒ…å†µæ¥é€‰æ‹©æ˜¯å¦éœ€è¦ç”¨é€’å½’çš„æ–¹å¼æ¥å®ç°ã€‚é‚£æˆ‘ä»¬æ˜¯å¦å¯ä»¥æŠŠé€’å½’ä»£ç æ”¹å†™ä¸ºéé€’å½’ä»£ç å‘¢ç¬¼ç»Ÿåœ°è®²ï¼Œæ˜¯çš„ã€‚å› ä¸ºé€’å½’æœ¬èº«å°±æ˜¯å€ŸåŠ©æ ˆæ¥å®ç°çš„ï¼Œåªä¸è¿‡æˆ‘ä»¬ä½¿ç”¨çš„æ ˆæ˜¯ç³»ç»Ÿæˆ–è€…è™šæ‹Ÿæœºæœ¬èº«æä¾›çš„ï¼Œæˆ‘ä»¬æ²¡æœ‰æ„ŸçŸ¥ç½¢äº†ã€‚å¦‚æœæˆ‘ä»¬è‡ªå·±åœ¨å†…å­˜å †ä¸Šå®ç°æ ˆï¼Œæ‰‹åŠ¨æ¨¡æ‹Ÿå…¥æ ˆã€å‡ºæ ˆè¿‡ç¨‹ï¼Œè¿™æ ·ä»»ä½•é€’å½’ä»£ç éƒ½å¯ä»¥æ”¹å†™æˆçœ‹ä¸Šå»ä¸æ˜¯é€’å½’ä»£ç çš„æ ·å­ã€‚ä½†æ˜¯è¿™ç§æ€è·¯å®é™…ä¸Šæ˜¯å°†é€’å½’æ”¹ä¸ºäº†â€œæ‰‹åŠ¨â€é€’å½’ï¼Œæœ¬è´¨å¹¶æ²¡æœ‰å˜ï¼Œè€Œä¸”ä¹Ÿå¹¶æ²¡æœ‰è§£å†³å‰é¢è®²åˆ°çš„æŸäº›é—®é¢˜ï¼Œå¾’å¢äº†å®ç°çš„å¤æ‚åº¦ã€‚","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"é€’å½’","slug":"é€’å½’","permalink":"cpeixin.cn/tags/%E9%80%92%E5%BD%92/"}]},{"title":"ç®—æ³• - è®¡æ•°æ’åº","slug":"ç®—æ³•-è®¡æ•°æ’åº","date":"2016-09-15T05:26:20.000Z","updated":"2020-05-22T06:12:37.856Z","comments":true,"path":"2016/09/15/ç®—æ³•-è®¡æ•°æ’åº/","link":"","permalink":"cpeixin.cn/2016/09/15/%E7%AE%97%E6%B3%95-%E8%AE%A1%E6%95%B0%E6%8E%92%E5%BA%8F/","excerpt":"","text":"æˆ‘ä¸ªäººè§‰å¾—ï¼Œè®¡æ•°æ’åºå…¶å®æ˜¯æ¡¶æ’åºçš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚å½“è¦æ’åºçš„ n ä¸ªæ•°æ®ï¼Œæ‰€å¤„çš„èŒƒå›´å¹¶ä¸å¤§çš„æ—¶å€™ï¼Œæ¯”å¦‚æœ€å¤§å€¼æ˜¯ kï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠæ•°æ®åˆ’åˆ†æˆ k ä¸ªæ¡¶ã€‚æ¯ä¸ªæ¡¶å†…çš„æ•°æ®å€¼éƒ½æ˜¯ç›¸åŒçš„ï¼Œçœæ‰äº†æ¡¶å†…æ’åºçš„æ—¶é—´ã€‚æˆ‘ä»¬éƒ½ç»å†è¿‡é«˜è€ƒï¼Œé«˜è€ƒæŸ¥åˆ†æ•°ç³»ç»Ÿä½ è¿˜è®°å¾—å—ï¼Ÿæˆ‘ä»¬æŸ¥åˆ†æ•°çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºæˆ‘ä»¬çš„æˆç»©ä»¥åŠæ‰€åœ¨çœçš„æ’åã€‚å¦‚æœä½ æ‰€åœ¨çš„çœæœ‰ 50 ä¸‡è€ƒç”Ÿï¼Œå¦‚ä½•é€šè¿‡æˆç»©å¿«é€Ÿæ’åºå¾—å‡ºåæ¬¡å‘¢ï¼Ÿè€ƒç”Ÿçš„æ»¡åˆ†æ˜¯ 900 åˆ†ï¼Œæœ€å°æ˜¯ 0 åˆ†ï¼Œè¿™ä¸ªæ•°æ®çš„èŒƒå›´å¾ˆå°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ†æˆ 901 ä¸ªæ¡¶ï¼Œå¯¹åº”åˆ†æ•°ä» 0 åˆ†åˆ° 900 åˆ†ã€‚æ ¹æ®è€ƒç”Ÿçš„æˆç»©ï¼Œæˆ‘ä»¬å°†è¿™ 50 ä¸‡è€ƒç”Ÿåˆ’åˆ†åˆ°è¿™ 901 ä¸ªæ¡¶é‡Œã€‚æ¡¶å†…çš„æ•°æ®éƒ½æ˜¯åˆ†æ•°ç›¸åŒçš„è€ƒç”Ÿï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦å†è¿›è¡Œæ’åºã€‚æˆ‘ä»¬åªéœ€è¦ä¾æ¬¡æ‰«ææ¯ä¸ªæ¡¶ï¼Œå°†æ¡¶å†…çš„è€ƒç”Ÿä¾æ¬¡è¾“å‡ºåˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œå°±å®ç°äº† 50 ä¸‡è€ƒç”Ÿçš„æ’åºã€‚å› ä¸ºåªæ¶‰åŠæ‰«æéå†æ“ä½œï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚è®¡æ•°æ’åºçš„ç®—æ³•æ€æƒ³å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œè·Ÿæ¡¶æ’åºéå¸¸ç±»ä¼¼ï¼Œåªæ˜¯æ¡¶çš„å¤§å°ç²’åº¦ä¸ä¸€æ ·ã€‚ä¸è¿‡ï¼Œä¸ºä»€ä¹ˆè¿™ä¸ªæ’åºç®—æ³•å«â€œè®¡æ•°â€æ’åºå‘¢ï¼Ÿâ€œè®¡æ•°â€çš„å«ä¹‰æ¥è‡ªå“ªé‡Œå‘¢ï¼Ÿæƒ³å¼„æ˜ç™½è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±è¦æ¥çœ‹è®¡æ•°æ’åºç®—æ³•çš„å®ç°æ–¹æ³•ã€‚æˆ‘è¿˜æ‹¿è€ƒç”Ÿé‚£ä¸ªä¾‹å­æ¥è§£é‡Šã€‚ä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œæˆ‘å¯¹æ•°æ®è§„æ¨¡åšäº†ç®€åŒ–ã€‚å‡è®¾åªæœ‰ 8 ä¸ªè€ƒç”Ÿï¼Œåˆ†æ•°åœ¨ 0 åˆ° 5 åˆ†ä¹‹é—´ã€‚è¿™ 8 ä¸ªè€ƒç”Ÿçš„æˆç»©æˆ‘ä»¬æ”¾åœ¨ä¸€ä¸ªæ•°ç»„ A[8]ä¸­ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š2ï¼Œ5ï¼Œ3ï¼Œ0ï¼Œ2ï¼Œ3ï¼Œ0ï¼Œ3ã€‚è€ƒç”Ÿçš„æˆç»©ä» 0 åˆ° 5 åˆ†ï¼Œæˆ‘ä»¬ä½¿ç”¨å¤§å°ä¸º 6 çš„æ•°ç»„ C[6]è¡¨ç¤ºæ¡¶ï¼Œå…¶ä¸­ä¸‹æ ‡å¯¹åº”åˆ†æ•°ã€‚ä¸è¿‡ï¼ŒC[6]å†…å­˜å‚¨çš„å¹¶ä¸æ˜¯è€ƒç”Ÿï¼Œè€Œæ˜¯å¯¹åº”çš„è€ƒç”Ÿä¸ªæ•°ã€‚åƒæˆ‘åˆšåˆšä¸¾çš„é‚£ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åªéœ€è¦éå†ä¸€éè€ƒç”Ÿåˆ†æ•°ï¼Œå°±å¯ä»¥å¾—åˆ° C[6]çš„å€¼ã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œåˆ†æ•°ä¸º 3 åˆ†çš„è€ƒç”Ÿæœ‰ 3 ä¸ªï¼Œå°äº 3 åˆ†çš„è€ƒç”Ÿæœ‰ 4 ä¸ªï¼Œæ‰€ä»¥ï¼Œæˆç»©ä¸º 3 åˆ†çš„è€ƒç”Ÿåœ¨æ’åºä¹‹åçš„æœ‰åºæ•°ç»„ R[8]ä¸­ï¼Œä¼šä¿å­˜ä¸‹æ ‡ 4ï¼Œ5ï¼Œ6 çš„ä½ç½®ã€‚é‚£æˆ‘ä»¬å¦‚ä½•å¿«é€Ÿè®¡ç®—å‡ºï¼Œæ¯ä¸ªåˆ†æ•°çš„è€ƒç”Ÿåœ¨æœ‰åºæ•°ç»„ä¸­å¯¹åº”çš„å­˜å‚¨ä½ç½®å‘¢ï¼Ÿè¿™ä¸ªå¤„ç†æ–¹æ³•éå¸¸å·§å¦™ï¼Œå¾ˆä¸å®¹æ˜“æƒ³åˆ°ã€‚æ€è·¯æ˜¯è¿™æ ·çš„ï¼šæˆ‘ä»¬å¯¹ C[6]æ•°ç»„é¡ºåºæ±‚å’Œï¼ŒC[6]å­˜å‚¨çš„æ•°æ®å°±å˜æˆäº†ä¸‹é¢è¿™æ ·å­ã€‚C[k]é‡Œå­˜å‚¨å°äºç­‰äºåˆ†æ•° k çš„è€ƒç”Ÿä¸ªæ•°ã€‚æœ‰äº†å‰é¢çš„æ•°æ®å‡†å¤‡ä¹‹åï¼Œç°åœ¨æˆ‘å°±è¦è®²è®¡æ•°æ’åºä¸­æœ€å¤æ‚ã€æœ€éš¾ç†è§£çš„ä¸€éƒ¨åˆ†äº†ï¼Œè¯·é›†ä¸­ç²¾åŠ›è·Ÿç€æˆ‘çš„æ€è·¯ï¼æˆ‘ä»¬ä»ååˆ°å‰ä¾æ¬¡æ‰«ææ•°ç»„ Aã€‚æ¯”å¦‚ï¼Œå½“æ‰«æåˆ° 3 æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ•°ç»„ C ä¸­å–å‡ºä¸‹æ ‡ä¸º 3 çš„å€¼ 7ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼ŒåŒ…æ‹¬è‡ªå·±åœ¨å†…ï¼Œåˆ†æ•°å°äºç­‰äº 3 çš„è€ƒç”Ÿæœ‰ 7 ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´ 3 æ˜¯æ•°ç»„ R ä¸­çš„ç¬¬ 7 ä¸ªå…ƒç´ ï¼ˆä¹Ÿå°±æ˜¯æ•°ç»„ R ä¸­ä¸‹æ ‡ä¸º 6 çš„ä½ç½®ï¼‰ã€‚å½“ 3 æ”¾å…¥åˆ°æ•°ç»„ R ä¸­åï¼Œå°äºç­‰äº 3 çš„å…ƒç´ å°±åªå‰©ä¸‹äº† 6 ä¸ªäº†ï¼Œæ‰€ä»¥ç›¸åº”çš„ C[3]è¦å‡ 1ï¼Œå˜æˆ 6ã€‚ä»¥æ­¤ç±»æ¨ï¼Œå½“æˆ‘ä»¬æ‰«æåˆ°ç¬¬ 2 ä¸ªåˆ†æ•°ä¸º 3 çš„è€ƒç”Ÿçš„æ—¶å€™ï¼Œå°±ä¼šæŠŠå®ƒæ”¾å…¥æ•°ç»„ R ä¸­çš„ç¬¬ 6 ä¸ªå…ƒç´ çš„ä½ç½®ï¼ˆä¹Ÿå°±æ˜¯ä¸‹æ ‡ä¸º 5 çš„ä½ç½®ï¼‰ã€‚å½“æˆ‘ä»¬æ‰«æå®Œæ•´ä¸ªæ•°ç»„ A åï¼Œæ•°ç»„ R å†…çš„æ•°æ®å°±æ˜¯æŒ‰ç…§åˆ†æ•°ä»å°åˆ°å¤§æœ‰åºæ’åˆ—çš„äº†ã€‚è¿™ç§åˆ©ç”¨å¦å¤–ä¸€ä¸ªæ•°ç»„æ¥è®¡æ•°çš„å®ç°æ–¹å¼æ˜¯ä¸æ˜¯å¾ˆå·§å¦™å‘¢ï¼Ÿè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿™ç§æ’åºç®—æ³•å«è®¡æ•°æ’åºçš„åŸå› ã€‚ä¸è¿‡ï¼Œä½ åƒä¸‡ä¸è¦æ­»è®°ç¡¬èƒŒä¸Šé¢çš„æ’åºè¿‡ç¨‹ï¼Œé‡è¦çš„æ˜¯ç†è§£å’Œä¼šç”¨ã€‚æˆ‘æ€»ç»“ä¸€ä¸‹ï¼Œè®¡æ•°æ’åºåªèƒ½ç”¨åœ¨æ•°æ®èŒƒå›´ä¸å¤§çš„åœºæ™¯ä¸­ï¼Œå¦‚æœæ•°æ®èŒƒå›´ k æ¯”è¦æ’åºçš„æ•°æ® n å¤§å¾ˆå¤šï¼Œå°±ä¸é€‚åˆç”¨è®¡æ•°æ’åºäº†ã€‚è€Œä¸”ï¼Œè®¡æ•°æ’åºåªèƒ½ç»™éè´Ÿæ•´æ•°æ’åºï¼Œå¦‚æœè¦æ’åºçš„æ•°æ®æ˜¯å…¶ä»–ç±»å‹çš„ï¼Œè¦å°†å…¶åœ¨ä¸æ”¹å˜ç›¸å¯¹å¤§å°çš„æƒ…å†µä¸‹ï¼Œè½¬åŒ–ä¸ºéè´Ÿæ•´æ•°ã€‚æ¯”å¦‚ï¼Œè¿˜æ˜¯æ‹¿è€ƒç”Ÿè¿™ä¸ªä¾‹å­ã€‚å¦‚æœè€ƒç”Ÿæˆç»©ç²¾ç¡®åˆ°å°æ•°åä¸€ä½ï¼Œæˆ‘ä»¬å°±éœ€è¦å°†æ‰€æœ‰çš„åˆ†æ•°éƒ½å…ˆä¹˜ä»¥ 10ï¼Œè½¬åŒ–æˆæ•´æ•°ï¼Œç„¶åå†æ”¾åˆ° 9010 ä¸ªæ¡¶å†…ã€‚å†æ¯”å¦‚ï¼Œå¦‚æœè¦æ’åºçš„æ•°æ®ä¸­æœ‰è´Ÿæ•°ï¼Œæ•°æ®çš„èŒƒå›´æ˜¯[-1000, 1000]ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦å…ˆå¯¹æ¯ä¸ªæ•°æ®éƒ½åŠ  1000ï¼Œè½¬åŒ–æˆéè´Ÿæ•´æ•°ã€‚è®¡æ•°æ’åºçš„æ ¸å¿ƒåœ¨äºå°†è¾“å…¥çš„æ•°æ®å€¼è½¬åŒ–ä¸ºé”®å­˜å‚¨åœ¨é¢å¤–å¼€è¾Ÿçš„æ•°ç»„ç©ºé—´ä¸­ã€‚ä½œä¸ºä¸€ç§çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„æ’åºï¼Œè®¡æ•°æ’åºè¦æ±‚è¾“å…¥çš„æ•°æ®å¿…é¡»æ˜¯æœ‰ç¡®å®šèŒƒå›´çš„æ•´æ•°ã€‚**å½“è¾“å…¥çš„å…ƒç´ æ˜¯ n ä¸ª 0 åˆ° k ä¹‹é—´çš„æ•´æ•°æ—¶ï¼Œå®ƒçš„è¿è¡Œæ—¶é—´æ˜¯ Î˜(n + k)ã€‚è®¡æ•°æ’åºä¸æ˜¯æ¯”è¾ƒæ’åºï¼Œæ’åºçš„é€Ÿåº¦å¿«äºä»»ä½•æ¯”è¾ƒæ’åºç®—æ³•ã€‚ç”±äºç”¨æ¥è®¡æ•°çš„æ•°ç»„Cçš„é•¿åº¦å–å†³äºå¾…æ’åºæ•°ç»„ä¸­æ•°æ®çš„èŒƒå›´ï¼ˆç­‰äºå¾…æ’åºæ•°ç»„çš„æœ€å¤§å€¼ä¸æœ€å°å€¼çš„å·®åŠ ä¸Š1ï¼‰ï¼Œè¿™ä½¿å¾—è®¡æ•°æ’åºå¯¹äºæ•°æ®èŒƒå›´å¾ˆå¤§çš„æ•°ç»„ï¼Œéœ€è¦å¤§é‡æ—¶é—´å’Œå†…å­˜ã€‚ä¾‹å¦‚ï¼šè®¡æ•°æ’åºæ˜¯ç”¨æ¥æ’åº0åˆ°100ä¹‹é—´çš„æ•°å­—çš„æœ€å¥½çš„ç®—æ³•ï¼Œä½†æ˜¯å®ƒä¸é€‚åˆæŒ‰å­—æ¯é¡ºåºæ’åºäººåã€‚ä½†æ˜¯ï¼Œè®¡æ•°æ’åºå¯ä»¥ç”¨åœ¨åŸºæ•°æ’åºä¸­çš„ç®—æ³•æ¥æ’åºæ•°æ®èŒƒå›´å¾ˆå¤§çš„æ•°ç»„ã€‚é€šä¿—åœ°ç†è§£ï¼Œä¾‹å¦‚æœ‰ 10 ä¸ªå¹´é¾„ä¸åŒçš„äººï¼Œç»Ÿè®¡å‡ºæœ‰ 8 ä¸ªäººçš„å¹´é¾„æ¯” A å°ï¼Œé‚£ A çš„å¹´é¾„å°±æ’åœ¨ç¬¬ 9 ä½,ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥å¾—åˆ°å…¶ä»–æ¯ä¸ªäººçš„ä½ç½®,ä¹Ÿå°±æ’å¥½äº†åºã€‚å½“ç„¶ï¼Œå¹´é¾„æœ‰é‡å¤æ—¶éœ€è¦ç‰¹æ®Šå¤„ç†ï¼ˆä¿è¯ç¨³å®šæ€§ï¼‰ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ€åè¦åå‘å¡«å……ç›®æ ‡æ•°ç»„ï¼Œä»¥åŠå°†æ¯ä¸ªæ•°å­—çš„ç»Ÿè®¡å‡å» 1 çš„åŸå› ã€‚ç®—æ³•çš„æ­¥éª¤å¦‚ä¸‹ï¼šï¼ˆ1ï¼‰æ‰¾å‡ºå¾…æ’åºçš„æ•°ç»„ä¸­æœ€å¤§å’Œæœ€å°çš„å…ƒç´ ï¼ˆ2ï¼‰ç»Ÿè®¡æ•°ç»„ä¸­æ¯ä¸ªå€¼ä¸ºiçš„å…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œå­˜å…¥æ•°ç»„Cçš„ç¬¬ié¡¹ï¼ˆ3ï¼‰å¯¹æ‰€æœ‰çš„è®¡æ•°ç´¯åŠ ï¼ˆä»Cä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œæ¯ä¸€é¡¹å’Œå‰ä¸€é¡¹ç›¸åŠ ï¼‰ï¼ˆ4ï¼‰åå‘å¡«å……ç›®æ ‡æ•°ç»„ï¼šå°†æ¯ä¸ªå…ƒç´ iæ”¾åœ¨æ–°æ•°ç»„çš„ç¬¬C(i)é¡¹ï¼Œæ¯æ”¾ä¸€ä¸ªå…ƒç´ å°±å°†C(i)å‡å»1åŠ¨å›¾ä»£ç **123456789101112131415def countingSort(arr, maxValue): bucketLen = maxValue+1 bucket = [0]*bucketLen sortedIndex =0 arrLen = len(arr) for i in range(arrLen): if not bucket[arr[i]]: bucket[arr[i]]=0 bucket[arr[i]]+=1 for j in range(bucketLen): while bucket[j]&gt;0: arr[sortedIndex] = j sortedIndex+=1 bucket[j]-=1 return arr","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"æ’åº","slug":"æ’åº","permalink":"cpeixin.cn/tags/%E6%8E%92%E5%BA%8F/"}]},{"title":"ç®—æ³• - æ¡¶æ’åº","slug":"ç®—æ³•-æ¡¶æ’åº","date":"2016-09-12T05:01:27.000Z","updated":"2020-05-22T06:12:41.814Z","comments":true,"path":"2016/09/12/ç®—æ³•-æ¡¶æ’åº/","link":"","permalink":"cpeixin.cn/2016/09/12/%E7%AE%97%E6%B3%95-%E6%A1%B6%E6%8E%92%E5%BA%8F/","excerpt":"","text":"å‰é¢åˆ†æäº†å‡ ç§å¸¸ç”¨æ’åºç®—æ³•çš„åŸç†ã€æ—¶é—´å¤æ‚åº¦ã€ç©ºé—´å¤æ‚åº¦ã€ç¨³å®šæ€§ç­‰ã€‚æ¥ä¸‹æ¥æˆ‘ä¼šè®²ä¸‰ç§æ—¶é—´å¤æ‚åº¦æ˜¯ O(n) çš„æ’åºç®—æ³•ï¼šæ¡¶æ’åºã€è®¡æ•°æ’åºã€åŸºæ•°æ’åºã€‚å› ä¸ºè¿™äº›æ’åºç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯çº¿æ€§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ç±»æ’åºç®—æ³•å«ä½œçº¿æ€§æ’åºï¼ˆLinear sortï¼‰ã€‚ä¹‹æ‰€ä»¥èƒ½åšåˆ°çº¿æ€§çš„æ—¶é—´å¤æ‚åº¦ï¼Œä¸»è¦åŸå› æ˜¯ï¼Œè¿™ä¸‰ä¸ªç®—æ³•æ˜¯éåŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•ï¼Œéƒ½ä¸æ¶‰åŠå…ƒç´ ä¹‹é—´çš„æ¯”è¾ƒæ“ä½œã€‚è¿™å‡ ç§æ’åºç®—æ³•ç†è§£èµ·æ¥éƒ½ä¸éš¾ï¼Œæ—¶é—´ã€ç©ºé—´å¤æ‚åº¦åˆ†æèµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œä½†æ˜¯å¯¹è¦æ’åºçš„æ•°æ®è¦æ±‚å¾ˆè‹›åˆ»ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»Šå¤©å­¦ä¹ é‡ç‚¹çš„æ˜¯æŒæ¡è¿™äº›æ’åºç®—æ³•çš„é€‚ç”¨åœºæ™¯ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘å…ˆç»™ä½ å‡ºä¸€é“æ€è€ƒé¢˜ï¼šå¦‚ä½•æ ¹æ®å¹´é¾„ç»™ 100 ä¸‡ç”¨æˆ·æ’åºï¼Ÿ ä½ å¯èƒ½ä¼šè¯´ï¼Œæˆ‘ç”¨ä¸Šä¸€èŠ‚è¯¾è®²çš„å½’å¹¶ã€å¿«æ’å°±å¯ä»¥æå®šå•Šï¼æ˜¯çš„ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥å®ŒæˆåŠŸèƒ½ï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦æœ€ä½ä¹Ÿæ˜¯ O(nlogn)ã€‚æœ‰æ²¡æœ‰æ›´å¿«çš„æ’åºæ–¹æ³•å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·è¿›å…¥ä»Šå¤©çš„å†…å®¹ï¼æ¡¶æ’åºï¼ˆBucket sortï¼‰é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹æ¡¶æ’åºã€‚æ¡¶æ’åºï¼Œé¡¾åæ€ä¹‰ï¼Œä¼šç”¨åˆ°â€œæ¡¶â€ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å°†è¦æ’åºçš„æ•°æ®åˆ†åˆ°å‡ ä¸ªæœ‰åºçš„æ¡¶é‡Œï¼Œæ¯ä¸ªæ¡¶é‡Œçš„æ•°æ®å†å•ç‹¬è¿›è¡Œæ’åºã€‚æ¡¶å†…æ’å®Œåºä¹‹åï¼Œå†æŠŠæ¯ä¸ªæ¡¶é‡Œçš„æ•°æ®æŒ‰ç…§é¡ºåºä¾æ¬¡å–å‡ºï¼Œç»„æˆçš„åºåˆ—å°±æ˜¯æœ‰åºçš„äº†ã€‚ï¼ˆæœ‰æœ¨æœ‰ç‚¹åƒå½’å¹¶æ’åºï¼‰æ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸ºä»€ä¹ˆæ˜¯ O(n) å‘¢ï¼Ÿæˆ‘ä»¬ä¸€å—å„¿æ¥åˆ†æä¸€ä¸‹ã€‚å¦‚æœè¦æ’åºçš„æ•°æ®æœ‰ n ä¸ªï¼Œæˆ‘ä»¬æŠŠå®ƒä»¬å‡åŒ€åœ°åˆ’åˆ†åˆ° m ä¸ªæ¡¶å†…ï¼Œæ¯ä¸ªæ¡¶é‡Œå°±æœ‰ k=n/m ä¸ªå…ƒç´ ã€‚æ¯ä¸ªæ¡¶å†…éƒ¨ä½¿ç”¨å¿«é€Ÿæ’åºï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(k * logk)ã€‚m ä¸ªæ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(m * k * logk)ï¼Œå› ä¸º k=n/mï¼Œæ‰€ä»¥æ•´ä¸ªæ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(nlog(n/m))ã€‚å½“æ¡¶çš„ä¸ªæ•° m æ¥è¿‘æ•°æ®ä¸ªæ•° n æ—¶ï¼Œlog(n/m) å°±æ˜¯ä¸€ä¸ªéå¸¸å°çš„å¸¸é‡ï¼Œè¿™ä¸ªæ—¶å€™æ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦æ¥è¿‘ O(n)ã€‚æ¡¶æ’åºçœ‹èµ·æ¥å¾ˆä¼˜ç§€ï¼Œé‚£å®ƒæ˜¯ä¸æ˜¯å¯ä»¥æ›¿ä»£æˆ‘ä»¬ä¹‹å‰è®²çš„æ’åºç®—æ³•å‘¢ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯å¦å®šçš„ã€‚ä¸ºäº†è®©ä½ è½»æ¾ç†è§£æ¡¶æ’åºçš„æ ¸å¿ƒæ€æƒ³ï¼Œæˆ‘åˆšæ‰åšäº†å¾ˆå¤šå‡è®¾ã€‚å®é™…ä¸Šï¼Œæ¡¶æ’åºå¯¹è¦æ’åºæ•°æ®çš„è¦æ±‚æ˜¯éå¸¸è‹›åˆ»çš„ã€‚*é¦–å…ˆï¼Œè¦æ’åºçš„æ•°æ®éœ€è¦å¾ˆå®¹æ˜“å°±èƒ½åˆ’åˆ†æˆ m ä¸ªæ¡¶ï¼Œå¹¶ä¸”ï¼Œæ¡¶ä¸æ¡¶ä¹‹é—´æœ‰ç€å¤©ç„¶çš„å¤§å°é¡ºåºã€‚è¿™æ ·æ¯ä¸ªæ¡¶å†…çš„æ•°æ®éƒ½æ’åºå®Œä¹‹åï¼Œæ¡¶ä¸æ¡¶ä¹‹é—´çš„æ•°æ®ä¸éœ€è¦å†è¿›è¡Œæ’åºã€‚å…¶æ¬¡ï¼Œæ•°æ®åœ¨å„ä¸ªæ¡¶ä¹‹é—´çš„åˆ†å¸ƒæ˜¯æ¯”è¾ƒå‡åŒ€çš„ã€‚å¦‚æœæ•°æ®ç»è¿‡æ¡¶çš„åˆ’åˆ†ä¹‹åï¼Œæœ‰äº›æ¡¶é‡Œçš„æ•°æ®éå¸¸å¤šï¼Œæœ‰äº›éå¸¸å°‘ï¼Œå¾ˆä¸å¹³å‡ï¼Œé‚£æ¡¶å†…æ•°æ®æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±ä¸æ˜¯å¸¸é‡çº§äº†ã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¦‚æœæ•°æ®éƒ½è¢«åˆ’åˆ†åˆ°ä¸€ä¸ªæ¡¶é‡Œï¼Œé‚£å°±é€€åŒ–ä¸º O(nlogn) çš„æ’åºç®—æ³•äº†ã€‚æ¡¶æ’åºæ¯”è¾ƒé€‚åˆç”¨åœ¨å¤–éƒ¨æ’åº**ä¸­ã€‚æ‰€è°“çš„å¤–éƒ¨æ’åºå°±æ˜¯æ•°æ®å­˜å‚¨åœ¨å¤–éƒ¨ç£ç›˜ä¸­ï¼Œæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œå†…å­˜æœ‰é™ï¼Œæ— æ³•å°†æ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬æœ‰ 10GB çš„è®¢å•æ•°æ®ï¼Œæˆ‘ä»¬å¸Œæœ›æŒ‰è®¢å•é‡‘é¢ï¼ˆå‡è®¾é‡‘é¢éƒ½æ˜¯æ­£æ•´æ•°ï¼‰è¿›è¡Œæ’åºï¼Œä½†æ˜¯æˆ‘ä»¬çš„å†…å­˜æœ‰é™ï¼Œåªæœ‰å‡ ç™¾ MBï¼Œæ²¡åŠæ³•ä¸€æ¬¡æ€§æŠŠ 10GB çš„æ•°æ®éƒ½åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™ä¸ªæ—¶å€™è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿç°åœ¨æˆ‘æ¥è®²ä¸€ä¸‹ï¼Œå¦‚ä½•å€ŸåŠ©æ¡¶æ’åºçš„å¤„ç†æ€æƒ³æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥å…ˆæ‰«æä¸€éæ–‡ä»¶ï¼Œçœ‹è®¢å•é‡‘é¢æ‰€å¤„çš„æ•°æ®èŒƒå›´ã€‚å‡è®¾ç»è¿‡æ‰«æä¹‹åæˆ‘ä»¬å¾—åˆ°ï¼Œè®¢å•é‡‘é¢æœ€å°æ˜¯ 1 å…ƒï¼Œæœ€å¤§æ˜¯ 10 ä¸‡å…ƒã€‚æˆ‘ä»¬å°†æ‰€æœ‰è®¢å•æ ¹æ®é‡‘é¢åˆ’åˆ†åˆ° 100 ä¸ªæ¡¶é‡Œï¼Œç¬¬ä¸€ä¸ªæ¡¶æˆ‘ä»¬å­˜å‚¨é‡‘é¢åœ¨ 1 å…ƒåˆ° 1000 å…ƒä¹‹å†…çš„è®¢å•ï¼Œç¬¬äºŒæ¡¶å­˜å‚¨é‡‘é¢åœ¨ 1001 å…ƒåˆ° 2000 å…ƒä¹‹å†…çš„è®¢å•ï¼Œä»¥æ­¤ç±»æ¨ã€‚æ¯ä¸€ä¸ªæ¡¶å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æŒ‰ç…§é‡‘é¢èŒƒå›´çš„å¤§å°é¡ºåºç¼–å·å‘½åï¼ˆ00ï¼Œ01ï¼Œ02â€¦99ï¼‰ã€‚ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè®¢å•é‡‘é¢åœ¨ 1 åˆ° 10 ä¸‡ä¹‹é—´å‡åŒ€åˆ†å¸ƒï¼Œé‚£è®¢å•ä¼šè¢«å‡åŒ€åˆ’åˆ†åˆ° 100 ä¸ªæ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªå°æ–‡ä»¶ä¸­å­˜å‚¨å¤§çº¦ 100MB çš„è®¢å•æ•°æ®ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†è¿™ 100 ä¸ªå°æ–‡ä»¶ä¾æ¬¡æ”¾åˆ°å†…å­˜ä¸­ï¼Œç”¨å¿«æ’æ¥æ’åºã€‚ç­‰æ‰€æœ‰æ–‡ä»¶éƒ½æ’å¥½åºä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‰ç…§æ–‡ä»¶ç¼–å·ï¼Œä»å°åˆ°å¤§ä¾æ¬¡è¯»å–æ¯ä¸ªå°æ–‡ä»¶ä¸­çš„è®¢å•æ•°æ®ï¼Œå¹¶å°†å…¶å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œé‚£è¿™ä¸ªæ–‡ä»¶ä¸­å­˜å‚¨çš„å°±æ˜¯æŒ‰ç…§é‡‘é¢ä»å°åˆ°å¤§æ’åºçš„è®¢å•æ•°æ®äº†ã€‚ä¸è¿‡ï¼Œä½ å¯èƒ½ä¹Ÿå‘ç°äº†ï¼Œè®¢å•æŒ‰ç…§é‡‘é¢åœ¨ 1 å…ƒåˆ° 10 ä¸‡å…ƒä¹‹é—´å¹¶ä¸ä¸€å®šæ˜¯å‡åŒ€åˆ†å¸ƒçš„ ï¼Œæ‰€ä»¥ 10GB è®¢å•æ•°æ®æ˜¯æ— æ³•å‡åŒ€åœ°è¢«åˆ’åˆ†åˆ° 100 ä¸ªæ–‡ä»¶ä¸­çš„ã€‚æœ‰å¯èƒ½æŸä¸ªé‡‘é¢åŒºé—´çš„æ•°æ®ç‰¹åˆ«å¤šï¼Œåˆ’åˆ†ä¹‹åå¯¹åº”çš„æ–‡ä»¶å°±ä¼šå¾ˆå¤§ï¼Œæ²¡æ³•ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ã€‚è¿™åˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿé’ˆå¯¹è¿™äº›åˆ’åˆ†ä¹‹åè¿˜æ˜¯æ¯”è¾ƒå¤§çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­åˆ’åˆ†ï¼Œæ¯”å¦‚ï¼Œè®¢å•é‡‘é¢åœ¨ 1 å…ƒåˆ° 1000 å…ƒä¹‹é—´çš„æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬å°±å°†è¿™ä¸ªåŒºé—´ç»§ç»­åˆ’åˆ†ä¸º 10 ä¸ªå°åŒºé—´ï¼Œ1 å…ƒåˆ° 100 å…ƒï¼Œ101 å…ƒåˆ° 200 å…ƒï¼Œ201 å…ƒåˆ° 300 å…ƒâ€¦901 å…ƒåˆ° 1000 å…ƒã€‚å¦‚æœåˆ’åˆ†ä¹‹åï¼Œ101 å…ƒåˆ° 200 å…ƒä¹‹é—´çš„è®¢å•è¿˜æ˜¯å¤ªå¤šï¼Œæ— æ³•ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ï¼Œé‚£å°±ç»§ç»­å†åˆ’åˆ†ï¼Œç›´åˆ°æ‰€æœ‰çš„æ–‡ä»¶éƒ½èƒ½è¯»å…¥å†…å­˜ä¸ºæ­¢ã€‚æ¡¶æ’åºæ˜¯è®¡æ•°æ’åºçš„å‡çº§ç‰ˆã€‚å®ƒåˆ©ç”¨äº†å‡½æ•°çš„æ˜ å°„å…³ç³»ï¼Œé«˜æ•ˆä¸å¦çš„å…³é”®å°±åœ¨äºè¿™ä¸ªæ˜ å°„å‡½æ•°çš„ç¡®å®šã€‚ä¸ºäº†ä½¿æ¡¶æ’åºæ›´åŠ é«˜æ•ˆï¼Œæˆ‘ä»¬éœ€è¦åšåˆ°è¿™ä¸¤ç‚¹ï¼šåœ¨é¢å¤–ç©ºé—´å……è¶³çš„æƒ…å†µä¸‹ï¼Œå°½é‡å¢å¤§æ¡¶çš„æ•°é‡ä½¿ç”¨çš„æ˜ å°„å‡½æ•°èƒ½å¤Ÿå°†è¾“å…¥çš„ N ä¸ªæ•°æ®å‡åŒ€çš„åˆ†é…åˆ° K ä¸ªæ¡¶ä¸­åŒæ—¶ï¼Œå¯¹äºæ¡¶ä¸­å…ƒç´ çš„æ’åºï¼Œé€‰æ‹©ä½•ç§æ¯”è¾ƒæ’åºç®—æ³•å¯¹äºæ€§èƒ½çš„å½±å“è‡³å…³é‡è¦ã€‚1. ä»€ä¹ˆæ—¶å€™æœ€å¿«å½“è¾“å…¥çš„æ•°æ®å¯ä»¥å‡åŒ€çš„åˆ†é…åˆ°æ¯ä¸€ä¸ªæ¡¶ä¸­ã€‚2. ä»€ä¹ˆæ—¶å€™æœ€æ…¢å½“è¾“å…¥çš„æ•°æ®è¢«åˆ†é…åˆ°äº†åŒä¸€ä¸ªæ¡¶ä¸­ã€‚å…ƒç´ åˆ†å¸ƒåœ¨æ¡¶ä¸­ç„¶åï¼Œå…ƒç´ åœ¨æ¯ä¸ªæ¡¶ä¸­æ’åºï¼šä»£ç æ’åºä¸€ä¸ªæ•°ç»„[5,3,6,1,2,7,5,10]ï¼Œ å€¼éƒ½åœ¨1-10ä¹‹é—´ï¼Œå»ºç«‹10ä¸ªæ¡¶ï¼š[0 0 0 0 0 0 0 0 0 0] æ¡¶ï¼Œåä¸ªç©ºæ¡¶[1 2 3 4 5 6 7 8 9 10] æ¡¶ä»£è¡¨çš„å€¼éå†æ•°ç»„ï¼Œç¬¬ä¸€ä¸ªæ•°å­—5ï¼Œç¬¬äº”ä¸ªæ¡¶åŠ 11[0 0 0 0 1 0 0 0 0 0]ç¬¬äºŒä¸ªæ•°å­—3ï¼Œç¬¬ä¸‰ä¸ªæ¡¶åŠ 11[0 0 1 0 1 0 0 0 0 0]éå†å1[1 1 1 0 2 1 1 0 0 1]è¾“å‡º1[1 2 3 5 5 6 7 10]ä»£ç ï¼š**1234567891011121314151617181920def bucket_sort(lst): \"\"\"åˆ›å»ºæ¡¶\"\"\" buckets = [0] * ((max(lst) - min(lst))+1) for i in range(len(lst)): \"\"\"å¯¹åº”ä¸‹æ ‡æ·»åŠ æ ‡è¯†ä½\"\"\" buckets[lst[i]-min(lst)] += 1 res=[] for i in range(len(buckets)): if buckets[i] != 0: res += [i+min(lst)]*buckets[i] print(res)def main(): array = [5,3,6,2,7,5,10,11,20] bucket_sort(array)if __name__ == '__main__': main()","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"æ’åº","slug":"æ’åº","permalink":"cpeixin.cn/tags/%E6%8E%92%E5%BA%8F/"}]},{"title":"ç®—æ³• - å¿«é€Ÿæ’åº","slug":"ç®—æ³•-å¿«é€Ÿæ’åº","date":"2016-09-10T15:05:47.000Z","updated":"2020-05-21T15:07:21.682Z","comments":true,"path":"2016/09/10/ç®—æ³•-å¿«é€Ÿæ’åº/","link":"","permalink":"cpeixin.cn/2016/09/10/%E7%AE%97%E6%B3%95-%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/","excerpt":"","text":"å¿«é€Ÿæ’åºæ˜¯ç”±ä¸œå°¼Â·éœå°”æ‰€å‘å±•çš„ä¸€ç§æ’åºç®—æ³•ã€‚åœ¨å¹³å‡çŠ¶å†µä¸‹ï¼Œæ’åº n ä¸ªé¡¹ç›®è¦ ÎŸ(nlogn) æ¬¡æ¯”è¾ƒã€‚åœ¨æœ€åçŠ¶å†µä¸‹åˆ™éœ€è¦ ÎŸ(n2) æ¬¡æ¯”è¾ƒï¼Œä½†è¿™ç§çŠ¶å†µå¹¶ä¸å¸¸è§ã€‚äº‹å®ä¸Šï¼Œå¿«é€Ÿæ’åºé€šå¸¸æ˜æ˜¾æ¯”å…¶ä»– ÎŸ(nlogn) ç®—æ³•æ›´å¿«ï¼Œå› ä¸ºå®ƒçš„å†…éƒ¨å¾ªç¯ï¼ˆinner loopï¼‰å¯ä»¥åœ¨å¤§éƒ¨åˆ†çš„æ¶æ„ä¸Šå¾ˆæœ‰æ•ˆç‡åœ°è¢«å®ç°å‡ºæ¥ã€‚å¿«æ’çš„æ€æƒ³æ˜¯è¿™æ ·çš„ï¼šå¦‚æœè¦æ’åºæ•°ç»„ä¸­ä¸‹æ ‡ä» p åˆ° r ä¹‹é—´çš„ä¸€ç»„æ•°æ®ï¼Œæˆ‘ä»¬é€‰æ‹© p åˆ° r ä¹‹é—´çš„ä»»æ„ä¸€ä¸ªæ•°æ®ä½œä¸º pivotï¼ˆåˆ†åŒºç‚¹ï¼‰ã€‚æˆ‘ä»¬éå† p åˆ° r ä¹‹é—´çš„æ•°æ®ï¼Œå°†å°äº pivot çš„æ”¾åˆ°å·¦è¾¹ï¼Œå°†å¤§äº pivot çš„æ”¾åˆ°å³è¾¹ï¼Œå°† pivot æ”¾åˆ°ä¸­é—´ã€‚ç»è¿‡è¿™ä¸€æ­¥éª¤ä¹‹åï¼Œæ•°ç»„ p åˆ° r ä¹‹é—´çš„æ•°æ®å°±è¢«åˆ†æˆäº†ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå‰é¢ p åˆ° q-1 ä¹‹é—´éƒ½æ˜¯å°äº pivot çš„ï¼Œä¸­é—´æ˜¯ pivotï¼Œåé¢çš„ q+1 åˆ° r ä¹‹é—´æ˜¯å¤§äº pivot çš„ã€‚å¿«é€Ÿæ’åºåˆæ˜¯ä¸€ç§åˆ†è€Œæ²»ä¹‹æ€æƒ³åœ¨æ’åºç®—æ³•ä¸Šçš„å…¸å‹åº”ç”¨ã€‚æœ¬è´¨ä¸Šæ¥çœ‹ï¼Œå¿«é€Ÿæ’åºåº”è¯¥ç®—æ˜¯åœ¨å†’æ³¡æ’åºåŸºç¡€ä¸Šçš„é€’å½’åˆ†æ²»æ³•ã€‚å¿«é€Ÿæ’åºçš„åå­—èµ·çš„æ˜¯ç®€å•ç²—æš´ï¼Œå› ä¸ºä¸€å¬åˆ°è¿™ä¸ªåå­—ä½ å°±çŸ¥é“å®ƒå­˜åœ¨çš„æ„ä¹‰ï¼Œå°±æ˜¯å¿«ï¼Œè€Œä¸”æ•ˆç‡é«˜ï¼å®ƒæ˜¯å¤„ç†å¤§æ•°æ®æœ€å¿«çš„æ’åºç®—æ³•ä¹‹ä¸€äº†ã€‚è™½ç„¶ Worst Case çš„æ—¶é—´å¤æ‚åº¦è¾¾åˆ°äº† O(nÂ²)ï¼Œä½†æ˜¯äººå®¶å°±æ˜¯ä¼˜ç§€ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ¯”å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(n logn) çš„æ’åºç®—æ³•è¡¨ç°è¦æ›´å¥½ï¼Œå¯æ˜¯è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ã€‚å¥½åœ¨æˆ‘çš„å¼ºè¿«ç—‡åˆçŠ¯äº†ï¼ŒæŸ¥äº† N å¤šèµ„æ–™ç»ˆäºåœ¨ã€Šç®—æ³•è‰ºæœ¯ä¸ä¿¡æ¯å­¦ç«èµ›ã€‹ä¸Šæ‰¾åˆ°äº†æ»¡æ„çš„ç­”æ¡ˆï¼šå¿«é€Ÿæ’åºçš„æœ€åè¿è¡Œæƒ…å†µæ˜¯ O(nÂ²)ï¼Œæ¯”å¦‚è¯´é¡ºåºæ•°åˆ—çš„å¿«æ’ã€‚ä½†å®ƒçš„å¹³æ‘ŠæœŸæœ›æ—¶é—´æ˜¯ O(nlogn)ï¼Œä¸” O(nlogn) è®°å·ä¸­éšå«çš„å¸¸æ•°å› å­å¾ˆå°ï¼Œæ¯”å¤æ‚åº¦ç¨³å®šç­‰äº O(nlogn) çš„å½’å¹¶æ’åºè¦å°å¾ˆå¤šã€‚æ‰€ä»¥ï¼Œå¯¹ç»å¤§å¤šæ•°é¡ºåºæ€§è¾ƒå¼±çš„éšæœºæ•°åˆ—è€Œè¨€ï¼Œå¿«é€Ÿæ’åºæ€»æ˜¯ä¼˜äºå½’å¹¶æ’åºã€‚æ ¹æ®åˆ†æ²»ã€é€’å½’çš„å¤„ç†æ€æƒ³ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨é€’å½’æ’åºä¸‹æ ‡ä» p åˆ° q-1 ä¹‹é—´çš„æ•°æ®å’Œä¸‹æ ‡ä» q+1 åˆ° r ä¹‹é—´çš„æ•°æ®ï¼Œç›´åˆ°åŒºé—´ç¼©å°ä¸º 1ï¼Œå°±è¯´æ˜æ‰€æœ‰çš„æ•°æ®éƒ½æœ‰åºäº†ã€‚å¦‚æœæˆ‘ä»¬ç”¨é€’æ¨å…¬å¼æ¥å°†ä¸Šé¢çš„è¿‡ç¨‹å†™å‡ºæ¥çš„è¯ï¼Œå°±æ˜¯è¿™æ ·ï¼š123456é€’æ¨å…¬å¼ï¼šquick_sort(pâ€¦r) = quick_sort(pâ€¦q-1) + quick_sort(q+1â€¦ r)ç»ˆæ­¢æ¡ä»¶ï¼šp &gt;= ræˆ‘å°†é€’æ¨å…¬å¼è½¬åŒ–æˆé€’å½’ä»£ç ã€‚è·Ÿå½’å¹¶æ’åºä¸€æ ·ï¼Œæˆ‘è¿˜æ˜¯ç”¨ä¼ªä»£ç æ¥å®ç°ï¼Œä½ å¯ä»¥ç¿»è¯‘æˆä½ ç†Ÿæ‚‰çš„ä»»ä½•è¯­è¨€ã€‚12345678910111213// å¿«é€Ÿæ’åºï¼ŒAæ˜¯æ•°ç»„ï¼Œnè¡¨ç¤ºæ•°ç»„çš„å¤§å°quick_sort(A, n) &#123; quick_sort_c(A, 0, n-1)&#125;// å¿«é€Ÿæ’åºé€’å½’å‡½æ•°ï¼Œp,rä¸ºä¸‹æ ‡quick_sort_c(A, p, r) &#123; if p &gt;= r then return q = partition(A, p, r) // è·å–åˆ†åŒºç‚¹ quick_sort_c(A, p, q-1) quick_sort_c(A, q+1, r)&#125;å½’å¹¶æ’åºä¸­æœ‰ä¸€ä¸ª merge() åˆå¹¶å‡½æ•°ï¼Œæˆ‘ä»¬è¿™é‡Œæœ‰ä¸€ä¸ª partition() åˆ†åŒºå‡½æ•°ã€‚partition() åˆ†åŒºå‡½æ•°å®é™…ä¸Šæˆ‘ä»¬å‰é¢å·²ç»è®²è¿‡äº†ï¼Œå°±æ˜¯éšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ ä½œä¸º pivotï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯ä»¥é€‰æ‹© p åˆ° r åŒºé—´çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œç„¶åå¯¹ A[pâ€¦r]åˆ†åŒºï¼Œå‡½æ•°è¿”å› pivot çš„ä¸‹æ ‡ã€‚å¦‚æœæˆ‘ä»¬ä¸è€ƒè™‘ç©ºé—´æ¶ˆè€—çš„è¯ï¼Œpartition() åˆ†åŒºå‡½æ•°å¯ä»¥å†™å¾—éå¸¸ç®€å•ã€‚æˆ‘ä»¬ç”³è¯·ä¸¤ä¸ªä¸´æ—¶æ•°ç»„ X å’Œ Yï¼Œéå† A[pâ€¦r]ï¼Œå°†å°äº pivot çš„å…ƒç´ éƒ½æ‹·è´åˆ°ä¸´æ—¶æ•°ç»„ Xï¼Œå°†å¤§äº pivot çš„å…ƒç´ éƒ½æ‹·è´åˆ°ä¸´æ—¶æ•°ç»„ Yï¼Œæœ€åå†å°†æ•°ç»„ X å’Œæ•°ç»„ Y ä¸­æ•°æ®é¡ºåºæ‹·è´åˆ° A[pâ€¦r]ã€‚ä½†æ˜¯ï¼Œå¦‚æœæŒ‰ç…§è¿™ç§æ€è·¯å®ç°çš„è¯ï¼Œpartition() å‡½æ•°å°±éœ€è¦å¾ˆå¤šé¢å¤–çš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥å¿«æ’å°±ä¸æ˜¯åŸåœ°æ’åºç®—æ³•äº†ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›å¿«æ’æ˜¯åŸåœ°æ’åºç®—æ³•ï¼Œé‚£å®ƒçš„ç©ºé—´å¤æ‚åº¦å¾—æ˜¯ O(1)ï¼Œé‚£ partition() åˆ†åŒºå‡½æ•°å°±ä¸èƒ½å ç”¨å¤ªå¤šé¢å¤–çš„å†…å­˜ç©ºé—´ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨ A[pâ€¦r]çš„åŸåœ°å®Œæˆåˆ†åŒºæ“ä½œã€‚åŸåœ°åˆ†åŒºå‡½æ•°çš„å®ç°æ€è·¯éå¸¸å·§å¦™ï¼Œæˆ‘å†™æˆäº†ä¼ªä»£ç ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ã€‚1234567891011partition(A, p, r) &#123; pivot := A[r] i := p for j := p to r-1 do &#123; if A[j] &lt; pivot &#123; swap A[i] with A[j] i := i+1 &#125; &#125; swap A[i] with A[r] return iè¿™é‡Œçš„å¤„ç†æœ‰ç‚¹ç±»ä¼¼é€‰æ‹©æ’åºã€‚æˆ‘ä»¬é€šè¿‡æ¸¸æ ‡ i æŠŠ A[pâ€¦r-1]åˆ†æˆä¸¤éƒ¨åˆ†ã€‚A[pâ€¦i-1]çš„å…ƒç´ éƒ½æ˜¯å°äº pivot çš„ï¼Œæˆ‘ä»¬æš‚ä¸”å«å®ƒâ€œå·²å¤„ç†åŒºé—´â€ï¼ŒA[iâ€¦r-1]æ˜¯â€œæœªå¤„ç†åŒºé—´â€ã€‚æˆ‘ä»¬æ¯æ¬¡éƒ½ä»æœªå¤„ç†çš„åŒºé—´ A[iâ€¦r-1]ä¸­å–ä¸€ä¸ªå…ƒç´  A[j]ï¼Œä¸ pivot å¯¹æ¯”ï¼Œå¦‚æœå°äº pivotï¼Œåˆ™å°†å…¶åŠ å…¥åˆ°å·²å¤„ç†åŒºé—´çš„å°¾éƒ¨ï¼Œä¹Ÿå°±æ˜¯ A[i]çš„ä½ç½®ã€‚æ•°ç»„çš„æ’å…¥æ“ä½œè¿˜è®°å¾—å—ï¼Ÿåœ¨æ•°ç»„æŸä¸ªä½ç½®æ’å…¥å…ƒç´ ï¼Œéœ€è¦æ¬ç§»æ•°æ®ï¼Œéå¸¸è€—æ—¶ã€‚å½“æ—¶æˆ‘ä»¬ä¹Ÿè®²äº†ä¸€ç§å¤„ç†æŠ€å·§ï¼Œå°±æ˜¯äº¤æ¢ï¼Œåœ¨ O(1) çš„æ—¶é—´å¤æ‚åº¦å†…å®Œæˆæ’å…¥æ“ä½œã€‚è¿™é‡Œæˆ‘ä»¬ä¹Ÿå€ŸåŠ©è¿™ä¸ªæ€æƒ³ï¼Œåªéœ€è¦å°† A[i]ä¸ A[j]äº¤æ¢ï¼Œå°±å¯ä»¥åœ¨ O(1) æ—¶é—´å¤æ‚åº¦å†…å°† A[j]æ”¾åˆ°ä¸‹æ ‡ä¸º i çš„ä½ç½®ã€‚æ–‡å­—ä¸å¦‚å›¾ç›´è§‚ï¼Œæ‰€ä»¥æˆ‘ç”»äº†ä¸€å¼ å›¾æ¥å±•ç¤ºåˆ†åŒºçš„æ•´ä¸ªè¿‡ç¨‹ã€‚å› ä¸ºåˆ†åŒºçš„è¿‡ç¨‹æ¶‰åŠäº¤æ¢æ“ä½œï¼Œå¦‚æœæ•°ç»„ä¸­æœ‰ä¸¤ä¸ªç›¸åŒçš„å…ƒç´ ï¼Œæ¯”å¦‚åºåˆ— 6ï¼Œ8ï¼Œ7ï¼Œ6ï¼Œ3ï¼Œ5ï¼Œ9ï¼Œ4ï¼Œåœ¨ç»è¿‡ç¬¬ä¸€æ¬¡åˆ†åŒºæ“ä½œä¹‹åï¼Œä¸¤ä¸ª 6 çš„ç›¸å¯¹å…ˆåé¡ºåºå°±ä¼šæ”¹å˜ã€‚æ‰€ä»¥ï¼Œå¿«é€Ÿæ’åºå¹¶ä¸æ˜¯ä¸€ä¸ªç¨³å®šçš„æ’åºç®—æ³•ã€‚åˆ°æ­¤ï¼Œå¿«é€Ÿæ’åºçš„åŸç†ä½ åº”è¯¥ä¹ŸæŒæ¡äº†ã€‚ç°åœ¨ï¼Œæˆ‘å†æ¥çœ‹å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šå¿«æ’å’Œå½’å¹¶ç”¨çš„éƒ½æ˜¯åˆ†æ²»æ€æƒ³ï¼Œé€’æ¨å…¬å¼å’Œé€’å½’ä»£ç ä¹Ÿéå¸¸ç›¸ä¼¼ï¼Œé‚£å®ƒä»¬çš„åŒºåˆ«åœ¨å“ªé‡Œå‘¢ï¼Ÿå¯ä»¥å‘ç°ï¼Œå½’å¹¶æ’åºçš„å¤„ç†è¿‡ç¨‹æ˜¯ç”±ä¸‹åˆ°ä¸Šçš„ï¼Œå…ˆå¤„ç†å­é—®é¢˜ï¼Œç„¶åå†åˆå¹¶ã€‚è€Œå¿«æ’æ­£å¥½ç›¸åï¼Œå®ƒçš„å¤„ç†è¿‡ç¨‹æ˜¯ç”±ä¸Šåˆ°ä¸‹çš„ï¼Œå…ˆåˆ†åŒºï¼Œç„¶åå†å¤„ç†å­é—®é¢˜ã€‚å½’å¹¶æ’åºè™½ç„¶æ˜¯ç¨³å®šçš„ã€æ—¶é—´å¤æ‚åº¦ä¸º O(nlogn) çš„æ’åºç®—æ³•ï¼Œä½†æ˜¯å®ƒæ˜¯éåŸåœ°æ’åºç®—æ³•ã€‚æˆ‘ä»¬å‰é¢è®²è¿‡ï¼Œå½’å¹¶ä¹‹æ‰€ä»¥æ˜¯éåŸåœ°æ’åºç®—æ³•ï¼Œä¸»è¦åŸå› æ˜¯åˆå¹¶å‡½æ•°æ— æ³•åœ¨åŸåœ°æ‰§è¡Œã€‚å¿«é€Ÿæ’åºé€šè¿‡è®¾è®¡å·§å¦™çš„åŸåœ°åˆ†åŒºå‡½æ•°ï¼Œå¯ä»¥å®ç°åŸåœ°æ’åºï¼Œè§£å†³äº†å½’å¹¶æ’åºå ç”¨å¤ªå¤šå†…å­˜çš„é—®é¢˜ã€‚ç®—æ³•æ­¥éª¤ä»æ•°åˆ—ä¸­æŒ‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç§°ä¸º â€œåŸºå‡†â€ï¼ˆpivotï¼‰;é‡æ–°æ’åºæ•°åˆ—ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å°çš„æ‘†æ”¾åœ¨åŸºå‡†å‰é¢ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å¤§çš„æ‘†åœ¨åŸºå‡†çš„åé¢ï¼ˆç›¸åŒçš„æ•°å¯ä»¥åˆ°ä»»ä¸€è¾¹ï¼‰ã€‚åœ¨è¿™ä¸ªåˆ†åŒºé€€å‡ºä¹‹åï¼Œè¯¥åŸºå‡†å°±å¤„äºæ•°åˆ—çš„ä¸­é—´ä½ç½®ã€‚è¿™ä¸ªç§°ä¸ºåˆ†åŒºï¼ˆpartitionï¼‰æ“ä½œï¼›é€’å½’åœ°ï¼ˆrecursiveï¼‰æŠŠå°äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—å’Œå¤§äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—æ’åºï¼›åŠ¨å›¾ä»£ç 1234567891011121314151617181920212223def quickSort(arr, left=None, right=None): left = 0 if not isinstance(left,(int, float)) else left right = len(arr)-1 if not isinstance(right,(int, float)) else right if left &lt; right: partitionIndex = partition(arr, left, right) quickSort(arr, left, partitionIndex-1) quickSort(arr, partitionIndex+1, right) return arrdef partition(arr, left, right): pivot = left index = pivot+1 i = index while i &lt;= right: if arr[i] &lt; arr[pivot]: swap(arr, i, index) index+=1 i+=1 swap(arr,pivot,index-1) return index-1def swap(arr, i, j): arr[i], arr[j] = arr[j], arr[i]å¿«é€Ÿæ’åºçš„æ€§èƒ½åˆ†æç°åœ¨ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å¿«é€Ÿæ’åºçš„æ€§èƒ½ã€‚æˆ‘åœ¨è®²è§£å¿«æ’çš„å®ç°åŸç†çš„æ—¶å€™ï¼Œå·²ç»åˆ†æäº†ç¨³å®šæ€§å’Œç©ºé—´å¤æ‚åº¦ã€‚å¿«æ’æ˜¯ä¸€ç§åŸåœ°ã€ä¸ç¨³å®šçš„æ’åºç®—æ³•ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬é›†ä¸­ç²¾åŠ›æ¥çœ‹å¿«æ’çš„æ—¶é—´å¤æ‚åº¦ã€‚å¿«æ’ä¹Ÿæ˜¯ç”¨é€’å½’æ¥å®ç°çš„ã€‚å¯¹äºé€’å½’ä»£ç çš„æ—¶é—´å¤æ‚åº¦ï¼Œæˆ‘å‰é¢æ€»ç»“çš„å…¬å¼ï¼Œè¿™é‡Œä¹Ÿè¿˜æ˜¯é€‚ç”¨çš„ã€‚å¦‚æœæ¯æ¬¡åˆ†åŒºæ“ä½œï¼Œéƒ½èƒ½æ­£å¥½æŠŠæ•°ç»„åˆ†æˆå¤§å°æ¥è¿‘ç›¸ç­‰çš„ä¸¤ä¸ªå°åŒºé—´ï¼Œé‚£å¿«æ’çš„æ—¶é—´å¤æ‚åº¦é€’æ¨æ±‚è§£å…¬å¼è·Ÿå½’å¹¶æ˜¯ç›¸åŒçš„ã€‚æ‰€ä»¥ï¼Œå¿«æ’çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(nlogn)ã€‚123T(1) = Cï¼› n=1æ—¶ï¼Œåªéœ€è¦å¸¸é‡çº§çš„æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä»¥è¡¨ç¤ºä¸ºCã€‚T(n) = 2*T(n/2) + nï¼› n&gt;1ä½†æ˜¯ï¼Œå…¬å¼æˆç«‹çš„å‰ææ˜¯æ¯æ¬¡åˆ†åŒºæ“ä½œï¼Œæˆ‘ä»¬é€‰æ‹©çš„ pivot éƒ½å¾ˆåˆé€‚ï¼Œæ­£å¥½èƒ½å°†å¤§åŒºé—´å¯¹ç­‰åœ°ä¸€åˆ†ä¸ºäºŒã€‚ä½†å®é™…ä¸Šè¿™ç§æƒ…å†µæ˜¯å¾ˆéš¾å®ç°çš„ã€‚æˆ‘ä¸¾ä¸€ä¸ªæ¯”è¾ƒæç«¯çš„ä¾‹å­ã€‚å¦‚æœæ•°ç»„ä¸­çš„æ•°æ®åŸæ¥å·²ç»æ˜¯æœ‰åºçš„äº†ï¼Œæ¯”å¦‚ 1ï¼Œ3ï¼Œ5ï¼Œ6ï¼Œ8ã€‚å¦‚æœæˆ‘ä»¬æ¯æ¬¡é€‰æ‹©æœ€åä¸€ä¸ªå…ƒç´ ä½œä¸º pivotï¼Œé‚£æ¯æ¬¡åˆ†åŒºå¾—åˆ°çš„ä¸¤ä¸ªåŒºé—´éƒ½æ˜¯ä¸å‡ç­‰çš„ã€‚æˆ‘ä»¬éœ€è¦è¿›è¡Œå¤§çº¦ n æ¬¡åˆ†åŒºæ“ä½œï¼Œæ‰èƒ½å®Œæˆå¿«æ’çš„æ•´ä¸ªè¿‡ç¨‹ã€‚æ¯æ¬¡åˆ†åŒºæˆ‘ä»¬å¹³å‡è¦æ‰«æå¤§çº¦ n/2 ä¸ªå…ƒç´ ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¿«æ’çš„æ—¶é—´å¤æ‚åº¦å°±ä» O(nlogn) é€€åŒ–æˆäº† O(n2)ã€‚æˆ‘ä»¬åˆšåˆšè®²äº†ä¸¤ä¸ªæç«¯æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ï¼Œä¸€ä¸ªæ˜¯åˆ†åŒºæå…¶å‡è¡¡ï¼Œä¸€ä¸ªæ˜¯åˆ†åŒºæå…¶ä¸å‡è¡¡ã€‚å®ƒä»¬åˆ†åˆ«å¯¹åº”å¿«æ’çš„æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦å’Œæœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦ã€‚é‚£å¿«æ’çš„å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿæˆ‘ä»¬å‡è®¾æ¯æ¬¡åˆ†åŒºæ“ä½œéƒ½å°†åŒºé—´åˆ†æˆå¤§å°ä¸º 9:1 çš„ä¸¤ä¸ªå°åŒºé—´ã€‚æˆ‘ä»¬ç»§ç»­å¥—ç”¨é€’å½’æ—¶é—´å¤æ‚åº¦çš„é€’æ¨å…¬å¼ï¼Œå°±ä¼šå˜æˆè¿™æ ·ï¼š1234T(1) = Cï¼› n=1æ—¶ï¼Œåªéœ€è¦å¸¸é‡çº§çš„æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä»¥è¡¨ç¤ºä¸ºCã€‚T(n) = T(n/10) + T(9*n/10) + nï¼› n&gt;1è¿™ä¸ªå…¬å¼çš„é€’æ¨æ±‚è§£çš„è¿‡ç¨‹éå¸¸å¤æ‚ï¼Œè™½ç„¶å¯ä»¥æ±‚è§£ï¼Œä½†æˆ‘ä¸æ¨èç”¨è¿™ç§æ–¹æ³•ã€‚å®é™…ä¸Šï¼Œé€’å½’çš„æ—¶é—´å¤æ‚åº¦çš„æ±‚è§£æ–¹æ³•é™¤äº†é€’æ¨å…¬å¼ä¹‹å¤–ï¼Œè¿˜æœ‰é€’å½’æ ‘ï¼Œåœ¨æ ‘é‚£ä¸€èŠ‚æˆ‘å†è®²ï¼Œè¿™é‡Œæš‚æ—¶ä¸è¯´ã€‚æˆ‘è¿™é‡Œç›´æ¥ç»™ä½ ç»“è®ºï¼šT(n) åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦éƒ½å¯ä»¥åšåˆ° O(nlogn)ï¼Œåªæœ‰åœ¨æç«¯æƒ…å†µä¸‹ï¼Œæ‰ä¼šé€€åŒ–åˆ° O(n2)ã€‚","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"æ’åº","slug":"æ’åº","permalink":"cpeixin.cn/tags/%E6%8E%92%E5%BA%8F/"}]},{"title":"ç®—æ³• - äºŒåˆ†æŸ¥æ‰¾_é‡å¤æ•°æ®æƒ…å†µ","slug":"ç®—æ³•-äºŒåˆ†æŸ¥æ‰¾-é‡å¤æ•°æ®æƒ…å†µ","date":"2016-09-02T16:37:00.000Z","updated":"2020-05-15T14:58:27.795Z","comments":true,"path":"2016/09/03/ç®—æ³•-äºŒåˆ†æŸ¥æ‰¾-é‡å¤æ•°æ®æƒ…å†µ/","link":"","permalink":"cpeixin.cn/2016/09/03/%E7%AE%97%E6%B3%95-%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE-%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE%E6%83%85%E5%86%B5/","excerpt":"","text":"ä¸Šä¸€ç¯‡è®²è§£äº†äºŒåˆ†æŸ¥æ‰¾çš„åŸç†ï¼Œå¹¶ä¸”ä»‹ç»äº†æœ€ç®€å•çš„ä¸€ç§äºŒåˆ†æŸ¥æ‰¾çš„ä»£ç å®ç°ã€‚ä»Šå¤©æˆ‘ä»¬æ¥è®²å‡ ç§äºŒåˆ†æŸ¥æ‰¾çš„å˜å½¢é—®é¢˜ã€‚ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å¬è¿‡è¿™æ ·ä¸€ä¸ªè¯´æ³•ï¼šâ€œåä¸ªäºŒåˆ†ä¹ä¸ªé”™â€ã€‚äºŒåˆ†æŸ¥æ‰¾è™½ç„¶åŸç†æå…¶ç®€å•ï¼Œä½†æ˜¯æƒ³è¦å†™å‡ºæ²¡æœ‰ Bug çš„äºŒåˆ†æŸ¥æ‰¾å¹¶ä¸å®¹æ˜“ã€‚å”çº³å¾·Â·å…‹åŠªç‰¹ï¼ˆDonald E.Knuthï¼‰åœ¨ã€Šè®¡ç®—æœºç¨‹åºè®¾è®¡è‰ºæœ¯ã€‹çš„ç¬¬ 3 å·ã€Šæ’åºå’ŒæŸ¥æ‰¾ã€‹ä¸­è¯´åˆ°ï¼šâ€œå°½ç®¡ç¬¬ä¸€ä¸ªäºŒåˆ†æŸ¥æ‰¾ç®—æ³•äº 1946 å¹´å‡ºç°ï¼Œç„¶è€Œç¬¬ä¸€ä¸ªå®Œå…¨æ­£ç¡®çš„äºŒåˆ†æŸ¥æ‰¾ç®—æ³•å®ç°ç›´åˆ° 1962 å¹´æ‰å‡ºç°ã€‚â€ä½ å¯èƒ½ä¼šè¯´ï¼Œæˆ‘ä»¬ä¸Šä¸€èŠ‚å­¦çš„äºŒåˆ†æŸ¥æ‰¾çš„ä»£ç å®ç°å¹¶ä¸éš¾å†™å•Šã€‚é‚£æ˜¯å› ä¸ºä¸Šä¸€èŠ‚è®²çš„åªæ˜¯äºŒåˆ†æŸ¥æ‰¾ä¸­æœ€ç®€å•çš„ä¸€ç§æƒ…å†µï¼Œåœ¨ä¸å­˜åœ¨é‡å¤å…ƒç´ çš„æœ‰åºæ•°ç»„ä¸­ï¼ŒæŸ¥æ‰¾å€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚æœ€ç®€å•çš„äºŒåˆ†æŸ¥æ‰¾å†™èµ·æ¥ç¡®å®ä¸éš¾ï¼Œä½†æ˜¯ï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„å˜å½¢é—®é¢˜å°±æ²¡é‚£ä¹ˆå¥½å†™äº†ã€‚äºŒåˆ†æŸ¥æ‰¾çš„å˜å½¢é—®é¢˜å¾ˆå¤šï¼Œæˆ‘åªé€‰æ‹©å‡ ä¸ªå…¸å‹çš„æ¥è®²è§£ï¼Œå…¶ä»–çš„ä½ å¯ä»¥å€ŸåŠ©æˆ‘ä»Šå¤©è®²çš„æ€è·¯è‡ªå·±æ¥åˆ†æå˜ä½“ä¸€ï¼šæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ä¸Šä¸€èŠ‚ä¸­çš„äºŒåˆ†æŸ¥æ‰¾æ˜¯æœ€ç®€å•çš„ä¸€ç§ï¼Œå³æœ‰åºæ•°æ®é›†åˆä¸­ä¸å­˜åœ¨é‡å¤çš„æ•°æ®ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­æŸ¥æ‰¾å€¼ç­‰äºæŸä¸ªç»™å®šå€¼çš„æ•°æ®ã€‚å¦‚æœæˆ‘ä»¬å°†è¿™ä¸ªé—®é¢˜ç¨å¾®ä¿®æ”¹ä¸‹ï¼Œæœ‰åºæ•°æ®é›†åˆä¸­å­˜åœ¨é‡å¤çš„æ•°æ®ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„æ•°æ®1234567891011121314151617def binarySearch_first(array, array_size, search_value): \"\"\"æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ \"\"\" low = 0 high = array_size - 1 while low &lt;= high: mid = low + ((high - low) &gt;&gt; 1) if array[mid] == search_value: while array[mid-1] == search_value: if mid - 1 == 0: return 0 mid -= 1 return mid elif array[mid] &lt; search_value: low = mid + 1 else: high = mid - 1è¿™é‡Œè¿˜æœ‰ä¸€ç§æ›´å¥½çš„å†™æ³•ï¼š123456789101112131415def binarySearch_first_better(array, array_size, search_value): \"\"\"æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ \"\"\" low = 0 high = array_size - 1 while low &lt;= high: mid = low + ((high - low) &gt;&gt; 1) if array[mid] &lt; search_value: low = mid + 1 elif array[mid] &gt; search_value: high = mid - 1 else: if mid == 0 or array[mid - 1] != search_value: return mid high = mid - 1å˜ä½“äºŒï¼šæŸ¥æ‰¾æœ€åä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ å‰é¢çš„é—®é¢˜æ˜¯æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ï¼Œæˆ‘ç°åœ¨æŠŠé—®é¢˜ç¨å¾®æ”¹ä¸€ä¸‹ï¼ŒæŸ¥æ‰¾æœ€åä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ï¼Œåˆè¯¥å¦‚ä½•åšå‘¢ï¼Ÿ123456789101112131415def binarySearch_last(array, array_size, search_value): \"\"\"æŸ¥æ‰¾æœ€åä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ \"\"\" low = 0 high = array_size - 1 while low &lt;= high: mid = low + ((high - low) &gt;&gt; 1) if array[mid] &lt; search_value: low = mid + 1 elif array[mid] &gt; search_value: high = mid - 1 else: if mid == array_size-1 or array[mid + 1] != search_value: return mid low = mid + 1å˜ä½“ä¸‰ï¼šæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºç»™å®šå€¼çš„å…ƒç´ ç°åœ¨æˆ‘ä»¬å†æ¥çœ‹å¦å¤–ä¸€ç±»å˜å½¢é—®é¢˜ã€‚åœ¨æœ‰åºæ•°ç»„ä¸­ï¼ŒæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚æ¯”å¦‚ï¼Œæ•°ç»„ä¸­å­˜å‚¨çš„è¿™æ ·ä¸€ä¸ªåºåˆ—ï¼š3ï¼Œ4ï¼Œ6ï¼Œ7ï¼Œ10ã€‚å¦‚æœæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äº 5 çš„å…ƒç´ ï¼Œé‚£å°±æ˜¯ 6ã€‚123456789101112131415public int bsearch(int[] a, int n, int value) &#123; int low = 0; int high = n - 1; while (low &lt;= high) &#123; int mid = low + ((high - low) &gt;&gt; 1); if (a[mid] &gt;= value) &#123; if ((mid == 0) || (a[mid - 1] &lt; value)) return mid; else high = mid - 1; &#125; else &#123; low = mid + 1; &#125; &#125; return -1;&#125;å˜ä½“å››ï¼šæŸ¥æ‰¾æœ€åä¸€ä¸ªå°äºç­‰äºç»™å®šå€¼çš„å…ƒç´ 123456789101112131415public int bsearch7(int[] a, int n, int value) &#123; int low = 0; int high = n - 1; while (low &lt;= high) &#123; int mid = low + ((high - low) &gt;&gt; 1); if (a[mid] &gt; value) &#123; high = mid - 1; &#125; else &#123; if ((mid == n - 1) || (a[mid + 1] &gt; value)) return mid; else low = mid + 1; &#125; &#125; return -1;&#125;å®é™…ä¸Šï¼Œå¾ˆå¤šäººéƒ½è§‰å¾—å˜å½¢çš„äºŒåˆ†æŸ¥æ‰¾å¾ˆéš¾å†™ï¼Œä¸»è¦åŸå› æ˜¯å¤ªè¿½æ±‚ç¬¬ä¸€ç§é‚£æ ·å®Œç¾ã€ç®€æ´çš„å†™æ³•ã€‚","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"äºŒåˆ†æŸ¥æ‰¾","slug":"äºŒåˆ†æŸ¥æ‰¾","permalink":"cpeixin.cn/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/"}]},{"title":"ç®—æ³• - å½’å¹¶æ’åº","slug":"ç®—æ³•-å½’å¹¶æ’åº","date":"2016-09-01T14:16:42.000Z","updated":"2020-05-22T06:12:39.910Z","comments":true,"path":"2016/09/01/ç®—æ³•-å½’å¹¶æ’åº/","link":"","permalink":"cpeixin.cn/2016/09/01/%E7%AE%97%E6%B3%95-%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/","excerpt":"","text":"å½’å¹¶æ’åºï¼ˆMerge sortï¼‰æ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•ã€‚è¯¥ç®—æ³•æ˜¯é‡‡ç”¨åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚ä½œä¸ºä¸€ç§å…¸å‹çš„åˆ†è€Œæ²»ä¹‹æ€æƒ³çš„ç®—æ³•åº”ç”¨ï¼Œå½’å¹¶æ’åºçš„å®ç°ç”±ä¸¤ç§æ–¹æ³•ï¼šè‡ªä¸Šè€Œä¸‹çš„é€’å½’ï¼ˆæ‰€æœ‰é€’å½’çš„æ–¹æ³•éƒ½å¯ä»¥ç”¨è¿­ä»£é‡å†™ï¼Œæ‰€ä»¥å°±æœ‰äº†ç¬¬ 2 ç§æ–¹æ³•ï¼‰ï¼›è‡ªä¸‹è€Œä¸Šçš„è¿­ä»£ï¼›åœ¨ã€Šæ•°æ®ç»“æ„ä¸ç®—æ³• JavaScript æè¿°ã€‹ä¸­ï¼Œä½œè€…ç»™å‡ºäº†è‡ªä¸‹è€Œä¸Šçš„è¿­ä»£æ–¹æ³•ã€‚ä½†æ˜¯å¯¹äºé€’å½’æ³•ï¼Œä½œè€…å´è®¤ä¸ºï¼šHowever, it is not possible to do so in JavaScript, as the recursion goes too deep for the language to handle.ç„¶è€Œï¼Œåœ¨ JavaScript ä¸­è¿™ç§æ–¹å¼ä¸å¤ªå¯è¡Œï¼Œå› ä¸ºè¿™ä¸ªç®—æ³•çš„é€’å½’æ·±åº¦å¯¹å®ƒæ¥è®²å¤ªæ·±äº†ã€‚å’Œé€‰æ‹©æ’åºä¸€æ ·ï¼Œå½’å¹¶æ’åºçš„æ€§èƒ½ä¸å—è¾“å…¥æ•°æ®çš„å½±å“ï¼Œä½†è¡¨ç°æ¯”é€‰æ‹©æ’åºå¥½çš„å¤šï¼Œå› ä¸ºå§‹ç»ˆéƒ½æ˜¯ O(nlogn) çš„æ—¶é—´å¤æ‚åº¦ã€‚ä»£ä»·æ˜¯éœ€è¦é¢å¤–çš„å†…å­˜ç©ºé—´ã€‚å½’å¹¶æ’åºï¼ˆMerge Sortï¼‰çš„æ ¸å¿ƒæ€æƒ³è¿˜æ˜¯è›®ç®€å•çš„ã€‚å¦‚æœè¦æ’åºä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬å…ˆæŠŠæ•°ç»„ä»ä¸­é—´åˆ†æˆå‰åä¸¤éƒ¨åˆ†ï¼Œç„¶åå¯¹å‰åä¸¤éƒ¨åˆ†åˆ†åˆ«æ’åºï¼Œå†å°†æ’å¥½åºçš„ä¸¤éƒ¨åˆ†åˆå¹¶åœ¨ä¸€èµ·ï¼Œè¿™æ ·æ•´ä¸ªæ•°ç»„å°±éƒ½æœ‰åºäº†ã€‚å½’å¹¶æ’åºä½¿ç”¨çš„å°±æ˜¯åˆ†æ²»æ€æƒ³ã€‚åˆ†æ²»ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åˆ†è€Œæ²»ä¹‹ï¼Œå°†ä¸€ä¸ªå¤§é—®é¢˜åˆ†è§£æˆå°çš„å­é—®é¢˜æ¥è§£å†³ã€‚å°çš„å­é—®é¢˜è§£å†³äº†ï¼Œå¤§é—®é¢˜ä¹Ÿå°±è§£å†³äº†ã€‚ä»æˆ‘åˆšæ‰çš„æè¿°ï¼Œä½ æœ‰æ²¡æœ‰æ„Ÿè§‰åˆ°ï¼Œåˆ†æ²»æ€æƒ³è·Ÿæˆ‘ä»¬å‰é¢è®²çš„é€’å½’æ€æƒ³å¾ˆåƒã€‚æ˜¯çš„ï¼Œåˆ†æ²»ç®—æ³•ä¸€èˆ¬éƒ½æ˜¯ç”¨é€’å½’æ¥å®ç°çš„ã€‚åˆ†æ²»æ˜¯ä¸€ç§è§£å†³é—®é¢˜çš„å¤„ç†æ€æƒ³ï¼Œé€’å½’æ˜¯ä¸€ç§ç¼–ç¨‹æŠ€å·§ï¼Œè¿™ä¸¤è€…å¹¶ä¸å†²çªã€‚å‰é¢æˆ‘é€šè¿‡ä¸¾ä¾‹è®©ä½ å¯¹å½’å¹¶æœ‰äº†ä¸€ä¸ªæ„Ÿæ€§çš„è®¤è¯†ï¼Œåˆå‘Šè¯‰ä½ ï¼Œå½’å¹¶æ’åºç”¨çš„æ˜¯åˆ†æ²»æ€æƒ³ï¼Œå¯ä»¥ç”¨é€’å½’æ¥å®ç°ã€‚æˆ‘ä»¬ç°åœ¨å°±æ¥çœ‹çœ‹å¦‚ä½•ç”¨é€’å½’ä»£ç æ¥å®ç°å½’å¹¶æ’åºã€‚å†™é€’å½’ä»£ç çš„æŠ€å·§å°±æ˜¯ï¼Œåˆ†æå¾—å‡ºé€’æ¨å…¬å¼ï¼Œç„¶åæ‰¾åˆ°ç»ˆæ­¢æ¡ä»¶ï¼Œæœ€åå°†é€’æ¨å…¬å¼ç¿»è¯‘æˆé€’å½’ä»£ç ã€‚æ‰€ä»¥ï¼Œè¦æƒ³å†™å‡ºå½’å¹¶æ’åºçš„ä»£ç ï¼Œæˆ‘ä»¬å…ˆå†™å‡ºå½’å¹¶æ’åºçš„é€’æ¨å…¬å¼ã€‚123456é€’æ¨å…¬å¼ï¼šmerge_sort(pâ€¦r) = merge(merge_sort(pâ€¦q), merge_sort(q+1â€¦r))ç»ˆæ­¢æ¡ä»¶ï¼šp &gt;= r ä¸ç”¨å†ç»§ç»­åˆ†è§£æˆ‘æ¥è§£é‡Šä¸€ä¸‹è¿™ä¸ªé€’æ¨å…¬å¼ã€‚merge_sort(pâ€¦r) è¡¨ç¤ºï¼Œç»™ä¸‹æ ‡ä» p åˆ° r ä¹‹é—´çš„æ•°ç»„æ’åºã€‚æˆ‘ä»¬å°†è¿™ä¸ªæ’åºé—®é¢˜è½¬åŒ–ä¸ºäº†ä¸¤ä¸ªå­é—®é¢˜ï¼Œmerge_sort(pâ€¦q) å’Œ merge_sort(q+1â€¦r)ï¼Œå…¶ä¸­ä¸‹æ ‡ q ç­‰äº p å’Œ r çš„ä¸­é—´ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ (p+r)/2ã€‚å½“ä¸‹æ ‡ä» p åˆ° q å’Œä» q+1 åˆ° r è¿™ä¸¤ä¸ªå­æ•°ç»„éƒ½æ’å¥½åºä¹‹åï¼Œæˆ‘ä»¬å†å°†ä¸¤ä¸ªæœ‰åºçš„å­æ•°ç»„åˆå¹¶åœ¨ä¸€èµ·mergeï¼Œè¿™æ ·ä¸‹æ ‡ä» p åˆ° r ä¹‹é—´çš„æ•°æ®å°±ä¹Ÿæ’å¥½åºäº†ã€‚æœ‰äº†é€’æ¨å…¬å¼ï¼Œè½¬åŒ–æˆä»£ç å°±ç®€å•å¤šäº†ã€‚ä¸ºäº†é˜…è¯»æ–¹ä¾¿ï¼Œæˆ‘è¿™é‡Œåªç»™å‡ºä¼ªä»£ç ï¼Œä½ å¯ä»¥ç¿»è¯‘æˆä½ ç†Ÿæ‚‰çš„ç¼–ç¨‹è¯­è¨€ã€‚ç®—æ³•æ­¥éª¤ç”³è¯·ç©ºé—´ï¼Œä½¿å…¶å¤§å°ä¸ºä¸¤ä¸ªå·²ç»æ’åºåºåˆ—ä¹‹å’Œï¼Œè¯¥ç©ºé—´ç”¨æ¥å­˜æ”¾åˆå¹¶åçš„åºåˆ—ï¼›è®¾å®šä¸¤ä¸ªæŒ‡é’ˆï¼Œæœ€åˆä½ç½®åˆ†åˆ«ä¸ºä¸¤ä¸ªå·²ç»æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ï¼›æ¯”è¾ƒä¸¤ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ ï¼Œé€‰æ‹©ç›¸å¯¹å°çš„å…ƒç´ æ”¾å…¥åˆ°åˆå¹¶ç©ºé—´ï¼Œå¹¶ç§»åŠ¨æŒ‡é’ˆåˆ°ä¸‹ä¸€ä½ç½®ï¼›é‡å¤æ­¥éª¤ 3 ç›´åˆ°æŸä¸€æŒ‡é’ˆè¾¾åˆ°åºåˆ—å°¾ï¼›å°†å¦ä¸€åºåˆ—å‰©ä¸‹çš„æ‰€æœ‰å…ƒç´ ç›´æ¥å¤åˆ¶åˆ°åˆå¹¶åºåˆ—å°¾ã€‚åŠ¨å›¾æ ¹æ®ç›´æ–¹å›¾çš„é¢œè‰²æ¥å¯¹åº”ç›¸åº”åˆ’åˆ†çš„ç»„æ›´å…·ä½“çš„åˆ†è§£æ­¥éª¤å¯ä»¥çœ‹åˆ°è¿™ç§ç»“æ„å¾ˆåƒä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼Œæœ¬æ–‡çš„å½’å¹¶æ’åºæˆ‘ä»¬é‡‡ç”¨é€’å½’å»å®ç°ï¼ˆä¹Ÿå¯é‡‡ç”¨è¿­ä»£çš„æ–¹å¼å»å®ç°ï¼‰ã€‚åˆ†é˜¶æ®µå¯ä»¥ç†è§£ä¸ºå°±æ˜¯é€’å½’æ‹†åˆ†å­åºåˆ—çš„è¿‡ç¨‹ï¼Œé€’å½’æ·±åº¦ä¸ºlognã€‚åˆå¹¶ç›¸é‚»æœ‰åºå­åºåˆ—å†æ¥çœ‹çœ‹æ²»**é˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸¤ä¸ªå·²ç»æœ‰åºçš„å­åºåˆ—åˆå¹¶æˆä¸€ä¸ªæœ‰åºåºåˆ—ï¼Œæ¯”å¦‚ä¸Šå›¾ä¸­çš„æœ€åä¸€æ¬¡åˆå¹¶ï¼Œè¦å°†[4,5,7,8]å’Œ[1,2,3,6]ä¸¤ä¸ªå·²ç»æœ‰åºçš„å­åºåˆ—ï¼Œåˆå¹¶ä¸ºæœ€ç»ˆåºåˆ—[1,2,3,4,5,6,7,8]ï¼Œæ¥çœ‹ä¸‹å®ç°æ­¥éª¤ã€‚ä»£ç 123456789101112131415161718192021def mergeSort(arr): import math if(len(arr)&lt;2): return arr middle = math.floor(len(arr)/2) left, right = arr[0:middle], arr[middle:] return merge(mergeSort(left), mergeSort(right))def merge(left,right): result = [] while left and right: if left[0] &lt;= right[0]: result.append(left.pop(0)) else: result.append(right.pop(0)); //é’ˆå¯¹ä¸€æ–¹ä¸ºç©ºçš„æƒ…å†µ while left: result.append(left.pop(0)) while right: result.append(right.pop(0)); return resultå½’å¹¶æ’åºçš„æ€§èƒ½åˆ†æè¿™æ ·è·Ÿç€æˆ‘ä¸€æ­¥ä¸€æ­¥åˆ†æï¼Œå½’å¹¶æ’åºæ˜¯ä¸æ˜¯æ²¡é‚£ä¹ˆéš¾å•¦ï¼Ÿæˆ‘ä»¬æ¥çœ‹å½’å¹¶æ’åºçš„ä¸‰ä¸ªé—®é¢˜ã€‚ç¬¬ä¸€ï¼Œå½’å¹¶æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿç»“åˆæˆ‘å‰é¢ç”»çš„é‚£å¼ å›¾å’Œå½’å¹¶æ’åºçš„ä¼ªä»£ç ï¼Œä½ åº”è¯¥èƒ½å‘ç°ï¼Œå½’å¹¶æ’åºç¨³ä¸ç¨³å®šå…³é”®è¦çœ‹ merge() å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªæœ‰åºå­æ•°ç»„åˆå¹¶æˆä¸€ä¸ªæœ‰åºæ•°ç»„çš„é‚£éƒ¨åˆ†ä»£ç ã€‚åœ¨åˆå¹¶çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœ A[pâ€¦q]å’Œ A[q+1â€¦r]ä¹‹é—´æœ‰å€¼ç›¸åŒçš„å…ƒç´ ï¼Œé‚£æˆ‘ä»¬å¯ä»¥åƒä¼ªä»£ç ä¸­é‚£æ ·ï¼Œå…ˆæŠŠ A[pâ€¦q]ä¸­çš„å…ƒç´ æ”¾å…¥ tmp æ•°ç»„ã€‚è¿™æ ·å°±ä¿è¯äº†å€¼ç›¸åŒçš„å…ƒç´ ï¼Œåœ¨åˆå¹¶å‰åçš„å…ˆåé¡ºåºä¸å˜ã€‚æ‰€ä»¥ï¼Œå½’å¹¶æ’åºæ˜¯ä¸€ä¸ªç¨³å®šçš„æ’åºç®—æ³•ã€‚ç¬¬äºŒï¼Œå½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿå½’å¹¶æ’åºæ¶‰åŠé€’å½’ï¼Œæ—¶é—´å¤æ‚åº¦çš„åˆ†æç¨å¾®æœ‰ç‚¹å¤æ‚ã€‚æˆ‘ä»¬æ­£å¥½å€Ÿæ­¤æœºä¼šæ¥å­¦ä¹ ä¸€ä¸‹ï¼Œå¦‚ä½•åˆ†æé€’å½’ä»£ç çš„æ—¶é—´å¤æ‚åº¦ã€‚åœ¨é€’å½’é‚£ä¸€èŠ‚æˆ‘ä»¬è®²è¿‡ï¼Œé€’å½’çš„é€‚ç”¨åœºæ™¯æ˜¯ï¼Œä¸€ä¸ªé—®é¢˜ a å¯ä»¥åˆ†è§£ä¸ºå¤šä¸ªå­é—®é¢˜ bã€cï¼Œé‚£æ±‚è§£é—®é¢˜ a å°±å¯ä»¥åˆ†è§£ä¸ºæ±‚è§£é—®é¢˜ bã€cã€‚é—®é¢˜ bã€c è§£å†³ä¹‹åï¼Œæˆ‘ä»¬å†æŠŠ bã€c çš„ç»“æœåˆå¹¶æˆ a çš„ç»“æœã€‚å¦‚æœæˆ‘ä»¬å®šä¹‰æ±‚è§£é—®é¢˜ a çš„æ—¶é—´æ˜¯ T(a)ï¼Œæ±‚è§£é—®é¢˜ bã€c çš„æ—¶é—´åˆ†åˆ«æ˜¯ T(b) å’Œ T( c)ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°è¿™æ ·çš„é€’æ¨å…³ç³»å¼ï¼š12T(a) = T(b) + T(c) + Kå…¶ä¸­ K ç­‰äºå°†ä¸¤ä¸ªå­é—®é¢˜ bã€c çš„ç»“æœåˆå¹¶æˆé—®é¢˜ a çš„ç»“æœæ‰€æ¶ˆè€—çš„æ—¶é—´ã€‚ä»åˆšåˆšçš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªé‡è¦çš„ç»“è®ºï¼šä¸ä»…é€’å½’æ±‚è§£çš„é—®é¢˜å¯ä»¥å†™æˆé€’æ¨å…¬å¼ï¼Œé€’å½’ä»£ç çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿå¯ä»¥å†™æˆé€’æ¨å…¬å¼ã€‚å¥—ç”¨è¿™ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ã€‚æˆ‘ä»¬å‡è®¾å¯¹ n ä¸ªå…ƒç´ è¿›è¡Œå½’å¹¶æ’åºéœ€è¦çš„æ—¶é—´æ˜¯ T(n)ï¼Œé‚£åˆ†è§£æˆä¸¤ä¸ªå­æ•°ç»„æ’åºçš„æ—¶é—´éƒ½æ˜¯ T(n/2)ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œmerge() å‡½æ•°åˆå¹¶ä¸¤ä¸ªæœ‰åºå­æ•°ç»„çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚æ‰€ä»¥ï¼Œå¥—ç”¨å‰é¢çš„å…¬å¼ï¼Œå½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦çš„è®¡ç®—å…¬å¼å°±æ˜¯ï¼š123T(1) = Cï¼› n=1æ—¶ï¼Œåªéœ€è¦å¸¸é‡çº§çš„æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä»¥è¡¨ç¤ºä¸ºCã€‚T(n) = 2*T(n/2) + nï¼› n&gt;1é€šè¿‡è¿™ä¸ªå…¬å¼ï¼Œå¦‚ä½•æ¥æ±‚è§£ T(n) å‘¢ï¼Ÿè¿˜ä¸å¤Ÿç›´è§‚ï¼Ÿé‚£æˆ‘ä»¬å†è¿›ä¸€æ­¥åˆ†è§£ä¸€ä¸‹è®¡ç®—è¿‡ç¨‹ã€‚12345678T(n) = 2*T(n/2) + n = 2*(2*T(n/4) + n/2) + n = 4*T(n/4) + 2*n = 4*(2*T(n/8) + n/4) + 2*n = 8*T(n/8) + 3*n = 8*(2*T(n/16) + n/8) + 3*n = 16*T(n/16) + 4*n ...... = 2^k * T(n/2^k) + k * n ......é€šè¿‡è¿™æ ·ä¸€æ­¥ä¸€æ­¥åˆ†è§£æ¨å¯¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° T(n) = 2^kT(n/2^k)+knã€‚å½“ T(n/2^k)=T(1) æ—¶ï¼Œä¹Ÿå°±æ˜¯ n/2^k=1ï¼Œæˆ‘ä»¬å¾—åˆ° k=log2n ã€‚æˆ‘ä»¬å°† k å€¼ä»£å…¥ä¸Šé¢çš„å…¬å¼ï¼Œå¾—åˆ° T(n)=Cn+nlog2n ã€‚å¦‚æœæˆ‘ä»¬ç”¨å¤§ O æ ‡è®°æ³•æ¥è¡¨ç¤ºçš„è¯ï¼ŒT(n) å°±ç­‰äº O(nlogn)ã€‚æ‰€ä»¥å½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn)ã€‚ä»æˆ‘ä»¬çš„åŸç†åˆ†æå’Œä¼ªä»£ç å¯ä»¥çœ‹å‡ºï¼Œå½’å¹¶æ’åºçš„æ‰§è¡Œæ•ˆç‡ä¸è¦æ’åºçš„åŸå§‹æ•°ç»„çš„æœ‰åºç¨‹åº¦æ— å…³ï¼Œæ‰€ä»¥å…¶æ—¶é—´å¤æ‚åº¦æ˜¯éå¸¸ç¨³å®šçš„ï¼Œä¸ç®¡æ˜¯æœ€å¥½æƒ…å†µã€æœ€åæƒ…å†µï¼Œè¿˜æ˜¯å¹³å‡æƒ…å†µï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(nlogn)ã€‚ç¬¬ä¸‰ï¼Œå½’å¹¶æ’åºçš„ç©ºé—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿå½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ä»»ä½•æƒ…å†µä¸‹éƒ½æ˜¯ O(nlogn)ï¼Œçœ‹èµ·æ¥éå¸¸ä¼˜ç§€ã€‚ï¼ˆå¾…ä¼šå„¿ä½ ä¼šå‘ç°ï¼Œå³ä¾¿æ˜¯å¿«é€Ÿæ’åºï¼Œæœ€åæƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(n2)ã€‚ï¼‰ä½†æ˜¯ï¼Œå½’å¹¶æ’åºå¹¶æ²¡æœ‰åƒå¿«æ’é‚£æ ·ï¼Œåº”ç”¨å¹¿æ³›ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºå®ƒæœ‰ä¸€ä¸ªè‡´å‘½çš„â€œå¼±ç‚¹â€ï¼Œé‚£å°±æ˜¯å½’å¹¶æ’åºä¸æ˜¯åŸåœ°æ’åºç®—æ³•ã€‚è¿™æ˜¯å› ä¸ºå½’å¹¶æ’åºçš„åˆå¹¶å‡½æ•°ï¼Œåœ¨åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„ä¸ºä¸€ä¸ªæœ‰åºæ•°ç»„æ—¶ï¼Œéœ€è¦å€ŸåŠ©é¢å¤–çš„å­˜å‚¨ç©ºé—´ã€‚è¿™ä¸€ç‚¹ä½ åº”è¯¥å¾ˆå®¹æ˜“ç†è§£ã€‚é‚£æˆ‘ç°åœ¨é—®ä½ ï¼Œå½’å¹¶æ’åºçš„ç©ºé—´å¤æ‚åº¦åˆ°åº•æ˜¯å¤šå°‘å‘¢ï¼Ÿæ˜¯ O(n)ï¼Œè¿˜æ˜¯ O(nlogn)ï¼Œåº”è¯¥å¦‚ä½•åˆ†æå‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬ç»§ç»­æŒ‰ç…§åˆ†æé€’å½’æ—¶é—´å¤æ‚åº¦çš„æ–¹æ³•ï¼Œé€šè¿‡é€’æ¨å…¬å¼æ¥æ±‚è§£ï¼Œé‚£æ•´ä¸ªå½’å¹¶è¿‡ç¨‹éœ€è¦çš„ç©ºé—´å¤æ‚åº¦å°±æ˜¯ O(nlogn)ã€‚ä¸è¿‡ï¼Œç±»ä¼¼åˆ†ææ—¶é—´å¤æ‚åº¦é‚£æ ·æ¥åˆ†æç©ºé—´å¤æ‚åº¦ï¼Œè¿™ä¸ªæ€è·¯å¯¹å—ï¼Ÿå®é™…ä¸Šï¼Œé€’å½’ä»£ç çš„ç©ºé—´å¤æ‚åº¦å¹¶ä¸èƒ½åƒæ—¶é—´å¤æ‚åº¦é‚£æ ·ç´¯åŠ ã€‚åˆšåˆšæˆ‘ä»¬å¿˜è®°äº†æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯ï¼Œå°½ç®¡æ¯æ¬¡åˆå¹¶æ“ä½œéƒ½éœ€è¦ç”³è¯·é¢å¤–çš„å†…å­˜ç©ºé—´ï¼Œä½†åœ¨åˆå¹¶å®Œæˆä¹‹åï¼Œä¸´æ—¶å¼€è¾Ÿçš„å†…å­˜ç©ºé—´å°±è¢«é‡Šæ”¾æ‰äº†ã€‚åœ¨ä»»æ„æ—¶åˆ»ï¼ŒCPU åªä¼šæœ‰ä¸€ä¸ªå‡½æ•°åœ¨æ‰§è¡Œï¼Œä¹Ÿå°±åªä¼šæœ‰ä¸€ä¸ªä¸´æ—¶çš„å†…å­˜ç©ºé—´åœ¨ä½¿ç”¨ã€‚ä¸´æ—¶å†…å­˜ç©ºé—´æœ€å¤§ä¹Ÿä¸ä¼šè¶…è¿‡ n ä¸ªæ•°æ®çš„å¤§å°ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦æ˜¯ O(n)ã€‚","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"æ’åº","slug":"æ’åº","permalink":"cpeixin.cn/tags/%E6%8E%92%E5%BA%8F/"}]},{"title":"ç®—æ³• - äºŒåˆ†æŸ¥æ‰¾","slug":"ç®—æ³•-äºŒåˆ†æŸ¥æ‰¾","date":"2016-08-31T16:37:00.000Z","updated":"2020-05-13T16:40:10.208Z","comments":true,"path":"2016/09/01/ç®—æ³•-äºŒåˆ†æŸ¥æ‰¾/","link":"","permalink":"cpeixin.cn/2016/09/01/%E7%AE%97%E6%B3%95-%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/","excerpt":"","text":"é’ˆå¯¹æœ‰åºæ•°æ®é›†åˆçš„æŸ¥æ‰¾ç®—æ³•ï¼šäºŒåˆ†æŸ¥æ‰¾ï¼ˆBinary Searchï¼‰ç®—æ³•ï¼Œä¹Ÿå«æŠ˜åŠæŸ¥æ‰¾ç®—æ³•ã€‚äºŒåˆ†æŸ¥æ‰¾çš„æ€æƒ³éå¸¸ç®€å•ï¼Œå¾ˆå¤šéè®¡ç®—æœºä¸“ä¸šçš„åŒå­¦å¾ˆå®¹æ˜“å°±èƒ½ç†è§£ï¼Œä½†æ˜¯çœ‹ä¼¼è¶Šç®€å•çš„ä¸œè¥¿å¾€å¾€è¶Šéš¾æŒæ¡å¥½ï¼Œæƒ³è¦çµæ´»åº”ç”¨å°±æ›´åŠ å›°éš¾ã€‚å‡è®¾æˆ‘ä»¬æœ‰ 1000 ä¸‡ä¸ªæ•´æ•°æ•°æ®ï¼Œæ¯ä¸ªæ•°æ®å  8 ä¸ªå­—èŠ‚ï¼Œå¦‚ä½•è®¾è®¡æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œå¿«é€Ÿåˆ¤æ–­æŸä¸ªæ•´æ•°æ˜¯å¦å‡ºç°åœ¨è¿™ 1000 ä¸‡æ•°æ®ä¸­ï¼Ÿ æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªåŠŸèƒ½ä¸è¦å ç”¨å¤ªå¤šçš„å†…å­˜ç©ºé—´ï¼Œæœ€å¤šä¸è¦è¶…è¿‡ 100MBï¼Œä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿæ— å¤„ä¸åœ¨çš„äºŒåˆ†æ€æƒ³äºŒåˆ†æŸ¥æ‰¾æ˜¯ä¸€ç§éå¸¸ç®€å•æ˜“æ‡‚çš„å¿«é€ŸæŸ¥æ‰¾ç®—æ³•ï¼Œç”Ÿæ´»ä¸­åˆ°å¤„å¯è§ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬ç°åœ¨æ¥åšä¸€ä¸ªçŒœå­—æ¸¸æˆã€‚æˆ‘éšæœºå†™ä¸€ä¸ª 0 åˆ° 99 ä¹‹é—´çš„æ•°å­—ï¼Œç„¶åä½ æ¥çŒœæˆ‘å†™çš„æ˜¯ä»€ä¹ˆã€‚çŒœçš„è¿‡ç¨‹ä¸­ï¼Œä½ æ¯çŒœä¸€æ¬¡ï¼Œæˆ‘å°±ä¼šå‘Šè¯‰ä½ çŒœçš„å¤§äº†è¿˜æ˜¯å°äº†ï¼Œç›´åˆ°çŒœä¸­ä¸ºæ­¢ã€‚ä½ æ¥æƒ³æƒ³ï¼Œå¦‚ä½•å¿«é€ŸçŒœä¸­æˆ‘å†™çš„æ•°å­—å‘¢ï¼Ÿå‡è®¾æˆ‘å†™çš„æ•°å­—æ˜¯ 23ï¼Œä½ å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ¥è¯•ä¸€è¯•ã€‚ï¼ˆå¦‚æœçŒœæµ‹èŒƒå›´çš„æ•°å­—æœ‰å¶æ•°ä¸ªï¼Œä¸­é—´æ•°æœ‰ä¸¤ä¸ªï¼Œå°±é€‰æ‹©è¾ƒå°çš„é‚£ä¸ªã€‚ï¼‰7 æ¬¡å°±çŒœå‡ºæ¥äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆå¿«ï¼Ÿè¿™ä¸ªä¾‹å­ç”¨çš„å°±æ˜¯äºŒåˆ†æ€æƒ³ï¼ŒæŒ‰ç…§è¿™ä¸ªæ€æƒ³ï¼Œå³ä¾¿æˆ‘è®©ä½ çŒœçš„æ˜¯ 0 åˆ° 999 çš„æ•°å­—ï¼Œæœ€å¤šä¹Ÿåªè¦ 10 æ¬¡å°±èƒ½çŒœä¸­ã€‚ä¸ä¿¡çš„è¯ï¼Œä½ å¯ä»¥è¯•ä¸€è¯•ã€‚è¿™æ˜¯ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼Œæˆ‘ä»¬ç°åœ¨å›åˆ°å®é™…çš„å¼€å‘åœºæ™¯ä¸­ã€‚å‡è®¾æœ‰ 1000 æ¡è®¢å•æ•°æ®ï¼Œå·²ç»æŒ‰ç…§è®¢å•é‡‘é¢ä»å°åˆ°å¤§æ’åºï¼Œæ¯ä¸ªè®¢å•é‡‘é¢éƒ½ä¸åŒï¼Œå¹¶ä¸”æœ€å°å•ä½æ˜¯å…ƒã€‚æˆ‘ä»¬ç°åœ¨æƒ³çŸ¥é“æ˜¯å¦å­˜åœ¨é‡‘é¢ç­‰äº 19 å…ƒçš„è®¢å•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›è®¢å•æ•°æ®ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å› nullã€‚æœ€ç®€å•çš„åŠæ³•å½“ç„¶æ˜¯ä»ç¬¬ä¸€ä¸ªè®¢å•å¼€å§‹ï¼Œä¸€ä¸ªä¸€ä¸ªéå†è¿™ 1000 ä¸ªè®¢å•ï¼Œç›´åˆ°æ‰¾åˆ°é‡‘é¢ç­‰äº 19 å…ƒçš„è®¢å•ä¸ºæ­¢ã€‚ä½†è¿™æ ·æŸ¥æ‰¾ä¼šæ¯”è¾ƒæ…¢ï¼Œæœ€åæƒ…å†µä¸‹ï¼Œå¯èƒ½è¦éå†å®Œè¿™ 1000 æ¡è®°å½•æ‰èƒ½æ‰¾åˆ°ã€‚é‚£ç”¨äºŒåˆ†æŸ¥æ‰¾èƒ½ä¸èƒ½æ›´å¿«é€Ÿåœ°è§£å†³å‘¢ï¼Ÿä¸ºäº†æ–¹ä¾¿è®²è§£ï¼Œæˆ‘ä»¬å‡è®¾åªæœ‰ 10 ä¸ªè®¢å•ï¼Œè®¢å•é‡‘é¢åˆ†åˆ«æ˜¯ï¼š8ï¼Œ11ï¼Œ19ï¼Œ23ï¼Œ27ï¼Œ33ï¼Œ45ï¼Œ55ï¼Œ67ï¼Œ98ã€‚è¿˜æ˜¯åˆ©ç”¨äºŒåˆ†æ€æƒ³ï¼Œæ¯æ¬¡éƒ½ä¸åŒºé—´çš„ä¸­é—´æ•°æ®æ¯”å¯¹å¤§å°ï¼Œç¼©å°æŸ¥æ‰¾åŒºé—´çš„èŒƒå›´ã€‚ä¸ºäº†æ›´åŠ ç›´è§‚ï¼Œæˆ‘ç”»äº†ä¸€å¼ æŸ¥æ‰¾è¿‡ç¨‹çš„å›¾ã€‚å…¶ä¸­ï¼Œlow å’Œ high è¡¨ç¤ºå¾…æŸ¥æ‰¾åŒºé—´çš„ä¸‹æ ‡ï¼Œmid è¡¨ç¤ºå¾…æŸ¥æ‰¾åŒºé—´çš„ä¸­é—´å…ƒç´ ä¸‹æ ‡ã€‚çœ‹æ‡‚è¿™ä¸¤ä¸ªä¾‹å­ï¼Œä½ ç°åœ¨å¯¹äºŒåˆ†çš„æ€æƒ³åº”è¯¥æŒæ¡å¾—å¦¥å¦¥çš„äº†ã€‚æˆ‘è¿™é‡Œç¨å¾®æ€»ç»“å‡åä¸€ä¸‹ï¼ŒäºŒåˆ†æŸ¥æ‰¾é’ˆå¯¹çš„æ˜¯ä¸€ä¸ªæœ‰åºçš„æ•°æ®é›†åˆï¼ŒæŸ¥æ‰¾æ€æƒ³æœ‰ç‚¹ç±»ä¼¼åˆ†æ²»æ€æƒ³ã€‚æ¯æ¬¡éƒ½é€šè¿‡è·ŸåŒºé—´çš„ä¸­é—´å…ƒç´ å¯¹æ¯”ï¼Œå°†å¾…æŸ¥æ‰¾çš„åŒºé—´ç¼©å°ä¸ºä¹‹å‰çš„ä¸€åŠï¼Œç›´åˆ°æ‰¾åˆ°è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œæˆ–è€…åŒºé—´è¢«ç¼©å°ä¸º 0ã€‚O(logn) æƒŠäººçš„æŸ¥æ‰¾é€Ÿåº¦äºŒåˆ†æŸ¥æ‰¾æ˜¯ä¸€ç§éå¸¸é«˜æ•ˆçš„æŸ¥æ‰¾ç®—æ³•ï¼Œé«˜æ•ˆåˆ°ä»€ä¹ˆç¨‹åº¦å‘¢ï¼Ÿæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å®ƒçš„æ—¶é—´å¤æ‚åº¦ã€‚æˆ‘ä»¬å‡è®¾æ•°æ®å¤§å°æ˜¯ nï¼Œæ¯æ¬¡æŸ¥æ‰¾åæ•°æ®éƒ½ä¼šç¼©å°ä¸ºåŸæ¥çš„ä¸€åŠï¼Œä¹Ÿå°±æ˜¯ä¼šé™¤ä»¥ 2ã€‚æœ€åæƒ…å†µä¸‹ï¼Œç›´åˆ°æŸ¥æ‰¾åŒºé—´è¢«ç¼©å°ä¸ºç©ºï¼Œæ‰åœæ­¢ã€‚å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªç­‰æ¯”æ•°åˆ—ã€‚å…¶ä¸­ n/2k=1 æ—¶ï¼Œk çš„å€¼å°±æ˜¯æ€»å…±ç¼©å°çš„æ¬¡æ•°ã€‚è€Œæ¯ä¸€æ¬¡ç¼©å°æ“ä½œåªæ¶‰åŠä¸¤ä¸ªæ•°æ®çš„å¤§å°æ¯”è¾ƒï¼Œæ‰€ä»¥ï¼Œç»è¿‡äº† k æ¬¡åŒºé—´ç¼©å°æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(k)ã€‚é€šè¿‡ n/2k=1ï¼Œæˆ‘ä»¬å¯ä»¥æ±‚å¾— k=log2nï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(logn)ã€‚äºŒåˆ†æŸ¥æ‰¾æ˜¯æˆ‘ä»¬ç›®å‰ä¸ºæ­¢é‡åˆ°çš„ç¬¬ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ä¸º O(logn) çš„ç®—æ³•ã€‚åé¢ç« èŠ‚æˆ‘ä»¬è¿˜ä¼šè®²å †ã€äºŒå‰æ ‘çš„æ“ä½œç­‰ç­‰ï¼Œå®ƒä»¬çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(logn)ã€‚æˆ‘è¿™é‡Œå°±å†æ·±å…¥åœ°è®²è®² O(logn) è¿™ç§å¯¹æ•°æ—¶é—´å¤æ‚åº¦ã€‚è¿™æ˜¯ä¸€ç§æå…¶é«˜æ•ˆçš„æ—¶é—´å¤æ‚åº¦ï¼Œæœ‰çš„æ—¶å€™ç”šè‡³æ¯”æ—¶é—´å¤æ‚åº¦æ˜¯å¸¸é‡çº§ O(1) çš„ç®—æ³•è¿˜è¦é«˜æ•ˆã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿå› ä¸º logn æ˜¯ä¸€ä¸ªéå¸¸â€œææ€–â€çš„æ•°é‡çº§ï¼Œå³ä¾¿ n éå¸¸éå¸¸å¤§ï¼Œå¯¹åº”çš„ logn ä¹Ÿå¾ˆå°ã€‚æ¯”å¦‚ n ç­‰äº 2 çš„ 32 æ¬¡æ–¹ï¼Œè¿™ä¸ªæ•°å¾ˆå¤§äº†å§ï¼Ÿå¤§çº¦æ˜¯ 42 äº¿ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ 42 äº¿ä¸ªæ•°æ®ä¸­ç”¨äºŒåˆ†æŸ¥æ‰¾ä¸€ä¸ªæ•°æ®ï¼Œæœ€å¤šéœ€è¦æ¯”è¾ƒ 32 æ¬¡ã€‚æˆ‘ä»¬å‰é¢è®²è¿‡ï¼Œç”¨å¤§ O æ ‡è®°æ³•è¡¨ç¤ºæ—¶é—´å¤æ‚åº¦çš„æ—¶å€™ï¼Œä¼šçœç•¥æ‰å¸¸æ•°ã€ç³»æ•°å’Œä½é˜¶ã€‚å¯¹äºå¸¸é‡çº§æ—¶é—´å¤æ‚åº¦çš„ç®—æ³•æ¥è¯´ï¼ŒO(1) æœ‰å¯èƒ½è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„å¸¸é‡å€¼ï¼Œæ¯”å¦‚ O(1000)ã€O(10000)ã€‚æ‰€ä»¥ï¼Œå¸¸é‡çº§æ—¶é—´å¤æ‚åº¦çš„ç®—æ³•æœ‰æ—¶å€™å¯èƒ½è¿˜æ²¡æœ‰ O(logn) çš„ç®—æ³•æ‰§è¡Œæ•ˆç‡é«˜ã€‚åè¿‡æ¥ï¼Œå¯¹æ•°å¯¹åº”çš„å°±æ˜¯æŒ‡æ•°ã€‚æœ‰ä¸€ä¸ªéå¸¸è‘—åçš„â€œé˜¿åŸºç±³å¾·ä¸å›½ç‹ä¸‹æ£‹çš„æ•…äº‹â€ï¼Œä½ å¯ä»¥è‡ªè¡Œæœç´¢ä¸€ä¸‹ï¼Œæ„Ÿå—ä¸€ä¸‹æŒ‡æ•°çš„â€œææ€–â€ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¯´ï¼ŒæŒ‡æ•°æ—¶é—´å¤æ‚åº¦çš„ç®—æ³•åœ¨å¤§è§„æ¨¡æ•°æ®é¢å‰æ˜¯æ— æ•ˆçš„ã€‚äºŒåˆ†æŸ¥æ‰¾çš„é€’å½’ä¸éé€’å½’å®ç°å®é™…ä¸Šï¼Œç®€å•çš„äºŒåˆ†æŸ¥æ‰¾å¹¶ä¸éš¾å†™ï¼Œæ³¨æ„æˆ‘è¿™é‡Œçš„â€œç®€å•â€äºŒå­—ã€‚ä¸‹ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä¼šè®²åˆ°äºŒåˆ†æŸ¥æ‰¾çš„å˜ä½“é—®é¢˜ï¼Œé‚£æ‰æ˜¯çœŸæ­£çƒ§è„‘çš„ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬æ¥çœ‹å¦‚ä½•æ¥å†™æœ€ç®€å•çš„äºŒåˆ†æŸ¥æ‰¾ã€‚æœ€ç®€å•çš„æƒ…å†µå°±æ˜¯æœ‰åºæ•°ç»„ä¸­ä¸å­˜åœ¨é‡å¤å…ƒç´ ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­ç”¨äºŒåˆ†æŸ¥æ‰¾å€¼ç­‰äºç»™å®šå€¼çš„æ•°æ®ã€‚æˆ‘ç”¨ python ä»£ç å®ç°äº†ä¸€ä¸ªæœ€ç®€å•çš„äºŒåˆ†æŸ¥æ‰¾ç®—æ³•ã€‚12345678910111213141516171819202122232425def binarySearch(array, array_size, search_value): low = 0 high = array_size - 1 while low &lt;= high: mid = low+((high-low)&gt;&gt;1) if array[mid] == search_value: return mid elif mid &lt; search_value: low = mid+1 else: high = mid-1def main(): array = [] for i in range(100): array.append(i) mid_num = binarySearch(array,len(array),57) print(mid_num)if __name__ == '__main__': main()å®é™…ä¸Šï¼Œmid=(low+high)/2 è¿™ç§å†™æ³•æ˜¯æœ‰é—®é¢˜çš„ã€‚å› ä¸ºå¦‚æœ low å’Œ high æ¯”è¾ƒå¤§çš„è¯ï¼Œä¸¤è€…ä¹‹å’Œå°±æœ‰å¯èƒ½ä¼šæº¢å‡ºã€‚æ”¹è¿›çš„æ–¹æ³•æ˜¯å°† mid çš„è®¡ç®—æ–¹å¼å†™æˆ low+(high-low)/2ã€‚æ›´è¿›ä¸€æ­¥ï¼Œå¦‚æœè¦å°†æ€§èƒ½ä¼˜åŒ–åˆ°æè‡´çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™é‡Œçš„é™¤ä»¥ 2 æ“ä½œè½¬åŒ–æˆä½è¿ç®— low+((high-low)&gt;&gt;1)ã€‚å› ä¸ºç›¸æ¯”é™¤æ³•è¿ç®—æ¥è¯´ï¼Œè®¡ç®—æœºå¤„ç†ä½è¿ç®—è¦å¿«å¾—å¤šã€‚äºŒåˆ†æŸ¥æ‰¾åº”ç”¨åœºæ™¯çš„å±€é™æ€§å‰é¢æˆ‘ä»¬åˆ†æè¿‡ï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ï¼ŒæŸ¥æ‰¾æ•°æ®çš„æ•ˆç‡éå¸¸é«˜ã€‚ä¸è¿‡ï¼Œå¹¶ä¸æ˜¯ä»€ä¹ˆæƒ…å†µä¸‹éƒ½å¯ä»¥ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œå®ƒçš„åº”ç”¨åœºæ™¯æ˜¯æœ‰å¾ˆå¤§å±€é™æ€§çš„ã€‚é‚£ä»€ä¹ˆæƒ…å†µä¸‹é€‚åˆç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¸é€‚åˆå‘¢ï¼Ÿé¦–å…ˆï¼ŒäºŒåˆ†æŸ¥æ‰¾ä¾èµ–çš„æ˜¯é¡ºåºè¡¨ç»“æ„ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯æ•°ç»„ã€‚é‚£äºŒåˆ†æŸ¥æ‰¾èƒ½å¦ä¾èµ–å…¶ä»–æ•°æ®ç»“æ„å‘¢ï¼Ÿæ¯”å¦‚é“¾è¡¨ã€‚ç­”æ¡ˆæ˜¯ä¸å¯ä»¥çš„ï¼Œä¸»è¦åŸå› æ˜¯äºŒåˆ†æŸ¥æ‰¾ç®—æ³•éœ€è¦æŒ‰ç…§ä¸‹æ ‡éšæœºè®¿é—®å…ƒç´ ã€‚æˆ‘ä»¬åœ¨æ•°ç»„å’Œé“¾è¡¨é‚£ä¸¤èŠ‚è®²è¿‡ï¼Œæ•°ç»„æŒ‰ç…§ä¸‹æ ‡éšæœºè®¿é—®æ•°æ®çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œè€Œé“¾è¡¨éšæœºè®¿é—®çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ•°æ®ä½¿ç”¨é“¾è¡¨å­˜å‚¨ï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚å°±ä¼šå˜å¾—å¾ˆé«˜ã€‚äºŒåˆ†æŸ¥æ‰¾åªèƒ½ç”¨åœ¨æ•°æ®æ˜¯é€šè¿‡é¡ºåºè¡¨æ¥å­˜å‚¨çš„æ•°æ®ç»“æ„ä¸Šã€‚å¦‚æœä½ çš„æ•°æ®æ˜¯é€šè¿‡å…¶ä»–æ•°æ®ç»“æ„å­˜å‚¨çš„ï¼Œåˆ™æ— æ³•åº”ç”¨äºŒåˆ†æŸ¥æ‰¾ã€‚å…¶æ¬¡ï¼ŒäºŒåˆ†æŸ¥æ‰¾é’ˆå¯¹çš„æ˜¯æœ‰åºæ•°æ®ã€‚äºŒåˆ†æŸ¥æ‰¾å¯¹è¿™ä¸€ç‚¹çš„è¦æ±‚æ¯”è¾ƒè‹›åˆ»ï¼Œæ•°æ®å¿…é¡»æ˜¯æœ‰åºçš„ã€‚å¦‚æœæ•°æ®æ²¡æœ‰åºï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ’åºã€‚å‰é¢ç« èŠ‚é‡Œæˆ‘ä»¬è®²åˆ°ï¼Œæ’åºçš„æ—¶é—´å¤æ‚åº¦æœ€ä½æ˜¯ O(nlogn)ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬é’ˆå¯¹çš„æ˜¯ä¸€ç»„é™æ€çš„æ•°æ®ï¼Œæ²¡æœ‰é¢‘ç¹åœ°æ’å…¥ã€åˆ é™¤ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€æ¬¡æ’åºï¼Œå¤šæ¬¡äºŒåˆ†æŸ¥æ‰¾ã€‚è¿™æ ·æ’åºçš„æˆæœ¬å¯è¢«å‡æ‘Šï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„è¾¹é™…æˆæœ¬å°±ä¼šæ¯”è¾ƒä½ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„æ•°æ®é›†åˆæœ‰é¢‘ç¹çš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œè¦æƒ³ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œè¦ä¹ˆæ¯æ¬¡æ’å…¥ã€åˆ é™¤æ“ä½œä¹‹åä¿è¯æ•°æ®ä»ç„¶æœ‰åºï¼Œè¦ä¹ˆåœ¨æ¯æ¬¡äºŒåˆ†æŸ¥æ‰¾ä¹‹å‰éƒ½å…ˆè¿›è¡Œæ’åºã€‚é’ˆå¯¹è¿™ç§åŠ¨æ€æ•°æ®é›†åˆï¼Œæ— è®ºå“ªç§æ–¹æ³•ï¼Œç»´æŠ¤æœ‰åºçš„æˆæœ¬éƒ½æ˜¯å¾ˆé«˜çš„ã€‚æ‰€ä»¥ï¼ŒäºŒåˆ†æŸ¥æ‰¾åªèƒ½ç”¨åœ¨æ’å…¥ã€åˆ é™¤æ“ä½œä¸é¢‘ç¹ï¼Œä¸€æ¬¡æ’åºå¤šæ¬¡æŸ¥æ‰¾çš„åœºæ™¯ä¸­ã€‚é’ˆå¯¹åŠ¨æ€å˜åŒ–çš„æ•°æ®é›†åˆï¼ŒäºŒåˆ†æŸ¥æ‰¾å°†ä¸å†é€‚ç”¨ã€‚é‚£é’ˆå¯¹åŠ¨æ€æ•°æ®é›†åˆï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©äºŒå‰æ ‘ã€‚å†æ¬¡ï¼Œæ•°æ®é‡å¤ªå°ä¸é€‚åˆäºŒåˆ†æŸ¥æ‰¾ã€‚å¦‚æœè¦å¤„ç†çš„æ•°æ®é‡å¾ˆå°ï¼Œå®Œå…¨æ²¡æœ‰å¿…è¦ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œé¡ºåºéå†å°±è¶³å¤Ÿäº†ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨ä¸€ä¸ªå¤§å°ä¸º 10 çš„æ•°ç»„ä¸­æŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ ï¼Œä¸ç®¡ç”¨äºŒåˆ†æŸ¥æ‰¾è¿˜æ˜¯é¡ºåºéå†ï¼ŒæŸ¥æ‰¾é€Ÿåº¦éƒ½å·®ä¸å¤šã€‚åªæœ‰æ•°æ®é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„ä¼˜åŠ¿æ‰ä¼šæ¯”è¾ƒæ˜æ˜¾ã€‚ä¸è¿‡ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å¤–ã€‚å¦‚æœæ•°æ®ä¹‹é—´çš„æ¯”è¾ƒæ“ä½œéå¸¸è€—æ—¶ï¼Œä¸ç®¡æ•°æ®é‡å¤§å°ï¼Œæˆ‘éƒ½æ¨èä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ã€‚æ¯”å¦‚ï¼Œæ•°ç»„ä¸­å­˜å‚¨çš„éƒ½æ˜¯é•¿åº¦è¶…è¿‡ 300 çš„å­—ç¬¦ä¸²ï¼Œå¦‚æ­¤é•¿çš„ä¸¤ä¸ªå­—ç¬¦ä¸²ä¹‹é—´æ¯”å¯¹å¤§å°ï¼Œå°±ä¼šéå¸¸è€—æ—¶ã€‚æˆ‘ä»¬éœ€è¦å°½å¯èƒ½åœ°å‡å°‘æ¯”è¾ƒæ¬¡æ•°ï¼Œè€Œæ¯”è¾ƒæ¬¡æ•°çš„å‡å°‘ä¼šå¤§å¤§æé«˜æ€§èƒ½ï¼Œè¿™ä¸ªæ—¶å€™äºŒåˆ†æŸ¥æ‰¾å°±æ¯”é¡ºåºéå†æ›´æœ‰ä¼˜åŠ¿ã€‚æœ€åï¼Œæ•°æ®é‡å¤ªå¤§ä¹Ÿä¸é€‚åˆäºŒåˆ†æŸ¥æ‰¾ã€‚äºŒåˆ†æŸ¥æ‰¾çš„åº•å±‚éœ€è¦ä¾èµ–æ•°ç»„è¿™ç§æ•°æ®ç»“æ„ï¼Œè€Œæ•°ç»„ä¸ºäº†æ”¯æŒéšæœºè®¿é—®çš„ç‰¹æ€§ï¼Œè¦æ±‚å†…å­˜ç©ºé—´è¿ç»­ï¼Œå¯¹å†…å­˜çš„è¦æ±‚æ¯”è¾ƒè‹›åˆ»ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æœ‰ 1GB å¤§å°çš„æ•°æ®ï¼Œå¦‚æœå¸Œæœ›ç”¨æ•°ç»„æ¥å­˜å‚¨ï¼Œé‚£å°±éœ€è¦ 1GB çš„è¿ç»­å†…å­˜ç©ºé—´ã€‚æ³¨æ„è¿™é‡Œçš„â€œè¿ç»­â€äºŒå­—ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä¾¿æœ‰ 2GB çš„å†…å­˜ç©ºé—´å‰©ä½™ï¼Œä½†æ˜¯å¦‚æœè¿™å‰©ä½™çš„ 2GB å†…å­˜ç©ºé—´éƒ½æ˜¯é›¶æ•£çš„ï¼Œæ²¡æœ‰è¿ç»­çš„ 1GB å¤§å°çš„å†…å­˜ç©ºé—´ï¼Œé‚£ç…§æ ·æ— æ³•ç”³è¯·ä¸€ä¸ª 1GB å¤§å°çš„æ•°ç»„ã€‚è€Œæˆ‘ä»¬çš„äºŒåˆ†æŸ¥æ‰¾æ˜¯ä½œç”¨åœ¨æ•°ç»„è¿™ç§æ•°æ®ç»“æ„ä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥å¤ªå¤§çš„æ•°æ®ç”¨æ•°ç»„å­˜å‚¨å°±æ¯”è¾ƒåƒåŠ›äº†ï¼Œä¹Ÿå°±ä¸èƒ½ç”¨äºŒåˆ†æŸ¥æ‰¾äº†ã€‚è§£ç­”å¼€ç¯‡äºŒåˆ†æŸ¥æ‰¾çš„ç†è®ºçŸ¥è¯†ä½ åº”è¯¥å·²ç»æŒæ¡äº†ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹å¼€ç¯‡çš„æ€è€ƒé¢˜ï¼šå¦‚ä½•åœ¨ 1000 ä¸‡ä¸ªæ•´æ•°ä¸­å¿«é€ŸæŸ¥æ‰¾æŸä¸ªæ•´æ•°ï¼Ÿè¿™ä¸ªé—®é¢˜å¹¶ä¸éš¾ã€‚æˆ‘ä»¬çš„å†…å­˜é™åˆ¶æ˜¯ 100MBï¼Œæ¯ä¸ªæ•°æ®å¤§å°æ˜¯ 8 å­—èŠ‚ï¼Œæœ€ç®€å•çš„åŠæ³•å°±æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨æ•°ç»„ä¸­ï¼Œå†…å­˜å ç”¨å·®ä¸å¤šæ˜¯ 80MBï¼Œç¬¦åˆå†…å­˜çš„é™åˆ¶ã€‚å€ŸåŠ©ä»Šå¤©è®²çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå¯¹è¿™ 1000 ä¸‡æ•°æ®ä»å°åˆ°å¤§æ’åºï¼Œç„¶åå†åˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾ç®—æ³•ï¼Œå°±å¯ä»¥å¿«é€Ÿåœ°æŸ¥æ‰¾æƒ³è¦çš„æ•°æ®äº†ã€‚çœ‹èµ·æ¥è¿™ä¸ªé—®é¢˜å¹¶ä¸éš¾ï¼Œå¾ˆè½»æ¾å°±èƒ½è§£å†³ã€‚å®é™…ä¸Šï¼Œå®ƒæš—è—äº†â€œç„æœºâ€ã€‚å¦‚æœä½ å¯¹æ•°æ®ç»“æ„å’Œç®—æ³•æœ‰ä¸€å®šäº†è§£ï¼ŒçŸ¥é“æ•£åˆ—è¡¨ã€äºŒå‰æ ‘è¿™äº›æ”¯æŒå¿«é€ŸæŸ¥æ‰¾çš„åŠ¨æ€æ•°æ®ç»“æ„ã€‚ä½ å¯èƒ½ä¼šè§‰å¾—ï¼Œç”¨æ•£åˆ—è¡¨å’ŒäºŒå‰æ ‘ä¹Ÿå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®é™…ä¸Šæ˜¯ä¸è¡Œçš„ã€‚è™½ç„¶å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œç”¨äºŒåˆ†æŸ¥æ‰¾å¯ä»¥è§£å†³çš„é—®é¢˜ï¼Œç”¨æ•£åˆ—è¡¨ã€äºŒå‰æ ‘éƒ½å¯ä»¥è§£å†³ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬åé¢ä¼šè®²ï¼Œä¸ç®¡æ˜¯æ•£åˆ—è¡¨è¿˜æ˜¯äºŒå‰æ ‘ï¼Œéƒ½ä¼šéœ€è¦æ¯”è¾ƒå¤šçš„é¢å¤–çš„å†…å­˜ç©ºé—´ã€‚å¦‚æœç”¨æ•£åˆ—è¡¨æˆ–è€…äºŒå‰æ ‘æ¥å­˜å‚¨è¿™ 1000 ä¸‡çš„æ•°æ®ï¼Œç”¨ 100MB çš„å†…å­˜è‚¯å®šæ˜¯å­˜ä¸ä¸‹çš„ã€‚è€ŒäºŒåˆ†æŸ¥æ‰¾åº•å±‚ä¾èµ–çš„æ˜¯æ•°ç»„ï¼Œé™¤äº†æ•°æ®æœ¬èº«ä¹‹å¤–ï¼Œä¸éœ€è¦é¢å¤–å­˜å‚¨å…¶ä»–ä¿¡æ¯ï¼Œæ˜¯æœ€çœå†…å­˜ç©ºé—´çš„å­˜å‚¨æ–¹å¼ï¼Œæ‰€ä»¥åˆšå¥½èƒ½åœ¨é™å®šçš„å†…å­˜å¤§å°ä¸‹è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ€»ç»“äºŒåˆ†æŸ¥æ‰¾è™½ç„¶æ€§èƒ½æ¯”è¾ƒä¼˜ç§€ï¼Œä½†åº”ç”¨åœºæ™¯ä¹Ÿæ¯”è¾ƒæœ‰é™ã€‚åº•å±‚å¿…é¡»ä¾èµ–æ•°ç»„ï¼Œå¹¶ä¸”è¿˜è¦æ±‚æ•°æ®æ˜¯æœ‰åºçš„ã€‚å¯¹äºè¾ƒå°è§„æ¨¡çš„æ•°æ®æŸ¥æ‰¾ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨é¡ºåºéå†å°±å¯ä»¥äº†ï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„ä¼˜åŠ¿å¹¶ä¸æ˜æ˜¾ã€‚äºŒåˆ†æŸ¥æ‰¾æ›´é€‚åˆå¤„ç†é™æ€æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰é¢‘ç¹çš„æ•°æ®æ’å…¥ã€åˆ é™¤æ“ä½œã€‚","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"äºŒåˆ†æŸ¥æ‰¾","slug":"äºŒåˆ†æŸ¥æ‰¾","permalink":"cpeixin.cn/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/"}]},{"title":"ç®—æ³• - é€‰æ‹©æ’åº","slug":"ç®—æ³•-é€‰æ‹©æ’åº","date":"2016-08-22T15:22:43.000Z","updated":"2020-05-21T09:13:39.426Z","comments":true,"path":"2016/08/22/ç®—æ³•-é€‰æ‹©æ’åº/","link":"","permalink":"cpeixin.cn/2016/08/22/%E7%AE%97%E6%B3%95-%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F/","excerpt":"","text":"é€‰æ‹©æ’åºæ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ï¼Œæ— è®ºä»€ä¹ˆæ•°æ®è¿›å»éƒ½æ˜¯ O(nÂ²) çš„æ—¶é—´å¤æ‚åº¦ã€‚æ‰€ä»¥ç”¨åˆ°å®ƒçš„æ—¶å€™ï¼Œæ•°æ®è§„æ¨¡è¶Šå°è¶Šå¥½ã€‚å”¯ä¸€çš„å¥½å¤„å¯èƒ½å°±æ˜¯ä¸å ç”¨é¢å¤–çš„å†…å­˜ç©ºé—´äº†å§ã€‚é€‰æ‹©æ’åºç®—æ³•çš„å®ç°æ€è·¯æœ‰ç‚¹ç±»ä¼¼æ’å…¥æ’åºï¼Œä¹Ÿåˆ†å·²æ’åºåŒºé—´å’Œæœªæ’åºåŒºé—´ã€‚ä½†æ˜¯é€‰æ‹©æ’åºæ¯æ¬¡ä¼šä»æœªæ’åºåŒºé—´ä¸­æ‰¾åˆ°æœ€å°çš„å…ƒç´ ï¼Œå°†å…¶æ”¾åˆ°å·²æ’åºåŒºé—´çš„æœ«å°¾ã€‚åŠ¨æ€ç¤ºä¾‹å›¾ç®—æ³•æ­¥éª¤é¦–å…ˆåœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ã€‚å†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚é‡å¤ç¬¬äºŒæ­¥ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚ä»£ç 12345678def selection_sort(array): for i in range(0, len(array)-1): min_index = i for j in range(i+1, len(array)): if array[j] &lt; array[min_index]: min_index = j if i != min_index: array[i], array[min_index] = array[min_index], array[i]ç…§ä¾‹ï¼Œä¹Ÿæœ‰ä¸‰ä¸ªé—®é¢˜éœ€è¦ä½ æ€è€ƒé¦–å…ˆï¼Œé€‰æ‹©æ’åºç©ºé—´å¤æ‚åº¦ä¸º O(1)ï¼Œæ˜¯ä¸€ç§åŸåœ°æ’åºç®—æ³•ã€‚é€‰æ‹©æ’åºçš„æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ã€æœ€åæƒ…å†µå’Œå¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦éƒ½ä¸º O(n2)ã€‚ä½ å¯ä»¥è‡ªå·±æ¥åˆ†æçœ‹çœ‹ã€‚é‚£é€‰æ‹©æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿè¿™ä¸ªé—®é¢˜æˆ‘ç€é‡æ¥è¯´ä¸€ä¸‹ã€‚ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œé€‰æ‹©æ’åºæ˜¯ä¸€ç§ä¸ç¨³å®šçš„æ’åºç®—æ³•ã€‚ä»æˆ‘å‰é¢ç”»çš„é‚£å¼ å›¾ä¸­ï¼Œä½ å¯ä»¥çœ‹å‡ºæ¥ï¼Œé€‰æ‹©æ’åºæ¯æ¬¡éƒ½è¦æ‰¾å‰©ä½™æœªæ’åºå…ƒç´ ä¸­çš„æœ€å°å€¼ï¼Œå¹¶å’Œå‰é¢çš„å…ƒç´ äº¤æ¢ä½ç½®ï¼Œè¿™æ ·ç ´åäº†ç¨³å®šæ€§ã€‚æ¯”å¦‚ 5ï¼Œ8ï¼Œ5ï¼Œ2ï¼Œ9 è¿™æ ·ä¸€ç»„æ•°æ®ï¼Œä½¿ç”¨é€‰æ‹©æ’åºç®—æ³•æ¥æ’åºçš„è¯ï¼Œç¬¬ä¸€æ¬¡æ‰¾åˆ°æœ€å°å…ƒç´  2ï¼Œä¸ç¬¬ä¸€ä¸ª 5 äº¤æ¢ä½ç½®ï¼Œé‚£ç¬¬ä¸€ä¸ª 5 å’Œä¸­é—´çš„ 5 é¡ºåºå°±å˜äº†ï¼Œæ‰€ä»¥å°±ä¸ç¨³å®šäº†ã€‚æ­£æ˜¯å› æ­¤ï¼Œç›¸å¯¹äºå†’æ³¡æ’åºå’Œæ’å…¥æ’åºï¼Œé€‰æ‹©æ’åºå°±ç¨å¾®é€Šè‰²äº†ã€‚","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"æ’åº","slug":"æ’åº","permalink":"cpeixin.cn/tags/%E6%8E%92%E5%BA%8F/"}]},{"title":"æ•°æ®ç»“æ„ - æ•£åˆ—è¡¨åŸç†","slug":"æ•°æ®ç»“æ„-æ•£åˆ—è¡¨åŸç†","date":"2016-08-22T01:31:55.000Z","updated":"2020-06-15T05:48:21.751Z","comments":true,"path":"2016/08/22/æ•°æ®ç»“æ„-æ•£åˆ—è¡¨åŸç†/","link":"","permalink":"cpeixin.cn/2016/08/22/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%95%A3%E5%88%97%E8%A1%A8%E5%8E%9F%E7%90%86/","excerpt":"","text":"Word è¿™ç§æ–‡æœ¬ç¼–è¾‘å™¨ä½ å¹³æ—¶åº”è¯¥ç»å¸¸ç”¨å§ï¼Œé‚£ä½ æœ‰æ²¡æœ‰ç•™æ„è¿‡å®ƒçš„æ‹¼å†™æ£€æŸ¥åŠŸèƒ½å‘¢ï¼Ÿä¸€æ—¦æˆ‘ä»¬åœ¨ Word é‡Œè¾“å…¥ä¸€ä¸ªé”™è¯¯çš„è‹±æ–‡å•è¯ï¼Œå®ƒå°±ä¼šç”¨æ ‡çº¢çš„æ–¹å¼æç¤ºâ€œæ‹¼å†™é”™è¯¯â€ã€‚Word çš„è¿™ä¸ªå•è¯æ‹¼å†™æ£€æŸ¥åŠŸèƒ½ï¼Œè™½ç„¶å¾ˆå°ä½†å´éå¸¸å®ç”¨ã€‚ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿå…¶å®å•Šï¼Œä¸€ç‚¹å„¿éƒ½ä¸éš¾ã€‚åªè¦ä½ å­¦ä¼šæ•£åˆ—è¡¨ï¼ˆHash Tableï¼‰ã€‚ä½ å°±èƒ½åƒå¾®è½¯ Office çš„å·¥ç¨‹å¸ˆä¸€æ ·ï¼Œè½»æ¾å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚æ•£åˆ—æ€æƒ³æ•£åˆ—è¡¨çš„è‹±æ–‡å«â€œHash Tableâ€ï¼Œæˆ‘ä»¬å¹³æ—¶ä¹Ÿå«å®ƒâ€œå“ˆå¸Œè¡¨â€æˆ–è€…â€œHash è¡¨â€ï¼Œä½ ä¸€å®šä¹Ÿç»å¸¸å¬è¿‡å®ƒã€‚æ•£åˆ—è¡¨ç”¨çš„æ˜¯æ•°ç»„æ”¯æŒæŒ‰ç…§ä¸‹æ ‡éšæœºè®¿é—®æ•°æ®çš„ç‰¹æ€§ï¼Œæ‰€ä»¥æ•£åˆ—è¡¨å…¶å®å°±æ˜¯æ•°ç»„çš„ä¸€ç§æ‰©å±•ï¼Œç”±æ•°ç»„æ¼”åŒ–è€Œæ¥ã€‚å¯ä»¥è¯´ï¼Œå¦‚æœæ²¡æœ‰æ•°ç»„ï¼Œå°±æ²¡æœ‰æ•£åˆ—è¡¨ã€‚æˆ‘ç”¨ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šä¸€ä¸‹ã€‚å‡å¦‚æˆ‘ä»¬æœ‰ 89 åé€‰æ‰‹å‚åŠ å­¦æ ¡è¿åŠ¨ä¼šã€‚ä¸ºäº†æ–¹ä¾¿è®°å½•æˆç»©ï¼Œæ¯ä¸ªé€‰æ‰‹èƒ¸å‰éƒ½ä¼šè´´ä¸Šè‡ªå·±çš„å‚èµ›å·ç ã€‚è¿™ 89 åé€‰æ‰‹çš„ç¼–å·ä¾æ¬¡æ˜¯ 1 åˆ° 89ã€‚ç°åœ¨æˆ‘ä»¬å¸Œæœ›ç¼–ç¨‹å®ç°è¿™æ ·ä¸€ä¸ªåŠŸèƒ½ï¼Œé€šè¿‡ç¼–å·å¿«é€Ÿæ‰¾åˆ°å¯¹åº”çš„é€‰æ‰‹ä¿¡æ¯ã€‚ä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠè¿™ 89 åé€‰æ‰‹çš„ä¿¡æ¯æ”¾åœ¨æ•°ç»„é‡Œã€‚ç¼–å·ä¸º 1 çš„é€‰æ‰‹ï¼Œæˆ‘ä»¬æ”¾åˆ°æ•°ç»„ä¸­ä¸‹æ ‡ä¸º 1 çš„ä½ç½®ï¼›ç¼–å·ä¸º 2 çš„é€‰æ‰‹ï¼Œæˆ‘ä»¬æ”¾åˆ°æ•°ç»„ä¸­ä¸‹æ ‡ä¸º 2 çš„ä½ç½®ã€‚ä»¥æ­¤ç±»æ¨ï¼Œç¼–å·ä¸º k çš„é€‰æ‰‹æ”¾åˆ°æ•°ç»„ä¸­ä¸‹æ ‡ä¸º k çš„ä½ç½®ã€‚å› ä¸ºå‚èµ›ç¼–å·è·Ÿæ•°ç»„ä¸‹æ ‡ä¸€ä¸€å¯¹åº”ï¼Œå½“æˆ‘ä»¬éœ€è¦æŸ¥è¯¢å‚èµ›ç¼–å·ä¸º x çš„é€‰æ‰‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦å°†ä¸‹æ ‡ä¸º x çš„æ•°ç»„å…ƒç´ å–å‡ºæ¥å°±å¯ä»¥äº†ï¼Œæ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(1)ã€‚è¿™æ ·æŒ‰ç…§ç¼–å·æŸ¥æ‰¾é€‰æ‰‹ä¿¡æ¯ï¼Œæ•ˆç‡æ˜¯ä¸æ˜¯å¾ˆé«˜ï¼Ÿå®é™…ä¸Šï¼Œè¿™ä¸ªä¾‹å­å·²ç»ç”¨åˆ°äº†æ•£åˆ—çš„æ€æƒ³ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œå‚èµ›ç¼–å·æ˜¯è‡ªç„¶æ•°ï¼Œå¹¶ä¸”ä¸æ•°ç»„çš„ä¸‹æ ‡å½¢æˆä¸€ä¸€æ˜ å°„ï¼Œæ‰€ä»¥åˆ©ç”¨æ•°ç»„æ”¯æŒæ ¹æ®ä¸‹æ ‡éšæœºè®¿é—®çš„æ—¶å€™ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1) è¿™ä¸€ç‰¹æ€§ï¼Œå°±å¯ä»¥å®ç°å¿«é€ŸæŸ¥æ‰¾ç¼–å·å¯¹åº”çš„é€‰æ‰‹ä¿¡æ¯ã€‚ä½ å¯èƒ½è¦è¯´äº†ï¼Œè¿™ä¸ªä¾‹å­ä¸­è•´å«çš„æ•£åˆ—æ€æƒ³è¿˜ä¸å¤Ÿæ˜æ˜¾ï¼Œé‚£æˆ‘æ¥æ”¹é€ ä¸€ä¸‹è¿™ä¸ªä¾‹å­ã€‚å‡è®¾æ ¡é•¿è¯´ï¼Œå‚èµ›ç¼–å·ä¸èƒ½è®¾ç½®å¾—è¿™ä¹ˆç®€å•ï¼Œè¦åŠ ä¸Šå¹´çº§ã€ç­çº§è¿™äº›æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠç¼–å·çš„è§„åˆ™ç¨å¾®ä¿®æ”¹äº†ä¸€ä¸‹ï¼Œç”¨ 6 ä½æ•°å­—æ¥è¡¨ç¤ºã€‚æ¯”å¦‚ 051167ï¼Œå…¶ä¸­ï¼Œå‰ä¸¤ä½ 05 è¡¨ç¤ºå¹´çº§ï¼Œä¸­é—´ä¸¤ä½ 11 è¡¨ç¤ºç­çº§ï¼Œæœ€åä¸¤ä½è¿˜æ˜¯åŸæ¥çš„ç¼–å· 1 åˆ° 89ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¯¥å¦‚ä½•å­˜å‚¨é€‰æ‰‹ä¿¡æ¯ï¼Œæ‰èƒ½å¤Ÿæ”¯æŒé€šè¿‡ç¼–å·æ¥å¿«é€ŸæŸ¥æ‰¾é€‰æ‰‹ä¿¡æ¯å‘¢ï¼Ÿæ€è·¯è¿˜æ˜¯è·Ÿå‰é¢ç±»ä¼¼ã€‚å°½ç®¡æˆ‘ä»¬ä¸èƒ½ç›´æ¥æŠŠç¼–å·ä½œä¸ºæ•°ç»„ä¸‹æ ‡ï¼Œä½†æˆ‘ä»¬å¯ä»¥æˆªå–å‚èµ›ç¼–å·çš„åä¸¤ä½ä½œä¸ºæ•°ç»„ä¸‹æ ‡ï¼Œæ¥å­˜å–é€‰æ‰‹ä¿¡æ¯æ•°æ®ã€‚å½“é€šè¿‡å‚èµ›ç¼–å·æŸ¥è¯¢é€‰æ‰‹ä¿¡æ¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œå–å‚èµ›ç¼–å·çš„åä¸¤ä½ï¼Œä½œä¸ºæ•°ç»„ä¸‹æ ‡ï¼Œæ¥è¯»å–æ•°ç»„ä¸­çš„æ•°æ®ã€‚è¿™å°±æ˜¯å…¸å‹çš„æ•£åˆ—æ€æƒ³ã€‚å…¶ä¸­ï¼Œå‚èµ›é€‰æ‰‹çš„ç¼–å·æˆ‘ä»¬å«ä½œé”®ï¼ˆkeyï¼‰æˆ–è€…å…³é”®å­—ã€‚æˆ‘ä»¬ç”¨å®ƒæ¥æ ‡è¯†ä¸€ä¸ªé€‰æ‰‹ã€‚æˆ‘ä»¬æŠŠå‚èµ›ç¼–å·è½¬åŒ–ä¸ºæ•°ç»„ä¸‹æ ‡çš„æ˜ å°„æ–¹æ³•å°±å«ä½œæ•£åˆ—å‡½æ•°ï¼ˆæˆ–â€œHash å‡½æ•°â€â€œå“ˆå¸Œå‡½æ•°â€ï¼‰ï¼Œè€Œæ•£åˆ—å‡½æ•°è®¡ç®—å¾—åˆ°çš„å€¼å°±å«ä½œæ•£åˆ—å€¼ï¼ˆæˆ–â€œHash å€¼â€â€œå“ˆå¸Œå€¼â€ï¼‰ã€‚é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºè¿™æ ·çš„è§„å¾‹ï¼šæ•£åˆ—è¡¨ç”¨çš„å°±æ˜¯æ•°ç»„æ”¯æŒæŒ‰ç…§ä¸‹æ ‡éšæœºè®¿é—®çš„æ—¶å€™ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1) çš„ç‰¹æ€§ã€‚æˆ‘ä»¬é€šè¿‡æ•£åˆ—å‡½æ•°æŠŠå…ƒç´ çš„é”®å€¼æ˜ å°„ä¸ºä¸‹æ ‡ï¼Œç„¶åå°†æ•°æ®å­˜å‚¨åœ¨æ•°ç»„ä¸­å¯¹åº”ä¸‹æ ‡çš„ä½ç½®ã€‚å½“æˆ‘ä»¬æŒ‰ç…§é”®å€¼æŸ¥è¯¢å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬ç”¨åŒæ ·çš„æ•£åˆ—å‡½æ•°ï¼Œå°†é”®å€¼è½¬åŒ–æ•°ç»„ä¸‹æ ‡ï¼Œä»å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡çš„ä½ç½®å–æ•°æ®ã€‚æ•£åˆ—å‡½æ•°ä»ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ•£åˆ—å‡½æ•°åœ¨æ•£åˆ—è¡¨ä¸­èµ·ç€éå¸¸å…³é”®çš„ä½œç”¨ã€‚ç°åœ¨æˆ‘ä»¬å°±æ¥å­¦ä¹ ä¸‹æ•£åˆ—å‡½æ•°ã€‚æ•£åˆ—å‡½æ•°ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒå®šä¹‰æˆ hash(key)ï¼Œå…¶ä¸­ key è¡¨ç¤ºå…ƒç´ çš„é”®å€¼ï¼Œhash(key) çš„å€¼è¡¨ç¤ºç»è¿‡æ•£åˆ—å‡½æ•°è®¡ç®—å¾—åˆ°çš„æ•£åˆ—å€¼ã€‚é‚£ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œç¼–å·å°±æ˜¯æ•°ç»„ä¸‹æ ‡ï¼Œæ‰€ä»¥ hash(key) å°±ç­‰äº keyã€‚æ”¹é€ åçš„ä¾‹å­ï¼Œå†™æˆæ•£åˆ—å‡½æ•°ç¨å¾®æœ‰ç‚¹å¤æ‚ã€‚æˆ‘ç”¨ä¼ªä»£ç å°†å®ƒå†™æˆå‡½æ•°å°±æ˜¯ä¸‹é¢è¿™æ ·ï¼š12345678int hash(String key) &#123; // è·å–åä¸¤ä½å­—ç¬¦ string lastTwoChars = key.substr(length-2, length); // å°†åä¸¤ä½å­—ç¬¦è½¬æ¢ä¸ºæ•´æ•° int hashValue = convert lastTwoChas to int-type; return hashValue;&#125;åˆšåˆšä¸¾çš„å­¦æ ¡è¿åŠ¨ä¼šçš„ä¾‹å­ï¼Œæ•£åˆ—å‡½æ•°æ¯”è¾ƒç®€å•ï¼Œä¹Ÿæ¯”è¾ƒå®¹æ˜“æƒ³åˆ°ã€‚ä½†æ˜¯ï¼Œå¦‚æœå‚èµ›é€‰æ‰‹çš„ç¼–å·æ˜¯éšæœºç”Ÿæˆçš„ 6 ä½æ•°å­—ï¼Œåˆæˆ–è€…ç”¨çš„æ˜¯ a åˆ° z ä¹‹é—´çš„å­—ç¬¦ä¸²ï¼Œè¯¥å¦‚ä½•æ„é€ æ•£åˆ—å‡½æ•°å‘¢ï¼Ÿæˆ‘æ€»ç»“äº†ä¸‰ç‚¹æ•£åˆ—å‡½æ•°è®¾è®¡çš„åŸºæœ¬è¦æ±‚ï¼šæ•£åˆ—å‡½æ•°è®¡ç®—å¾—åˆ°çš„æ•£åˆ—å€¼æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼›å¦‚æœ key1 = key2ï¼Œé‚£ hash(key1) == hash(key2)ï¼›å¦‚æœ key1 â‰  key2ï¼Œé‚£ hash(key1) â‰  hash(key2)ã€‚æˆ‘æ¥è§£é‡Šä¸€ä¸‹è¿™ä¸‰ç‚¹ã€‚å…¶ä¸­ï¼Œç¬¬ä¸€ç‚¹ç†è§£èµ·æ¥åº”è¯¥æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚å› ä¸ºæ•°ç»„ä¸‹æ ‡æ˜¯ä» 0 å¼€å§‹çš„ï¼Œæ‰€ä»¥æ•£åˆ—å‡½æ•°ç”Ÿæˆçš„æ•£åˆ—å€¼ä¹Ÿè¦æ˜¯éè´Ÿæ•´æ•°ã€‚ç¬¬äºŒç‚¹ä¹Ÿå¾ˆå¥½ç†è§£ã€‚ç›¸åŒçš„ keyï¼Œç»è¿‡æ•£åˆ—å‡½æ•°å¾—åˆ°çš„æ•£åˆ—å€¼ä¹Ÿåº”è¯¥æ˜¯ç›¸åŒçš„ã€‚ç¬¬ä¸‰ç‚¹ç†è§£èµ·æ¥å¯èƒ½ä¼šæœ‰é—®é¢˜ï¼Œæˆ‘ç€é‡è¯´ä¸€ä¸‹ã€‚è¿™ä¸ªè¦æ±‚çœ‹èµ·æ¥åˆæƒ…åˆç†ï¼Œä½†æ˜¯åœ¨çœŸå®çš„æƒ…å†µä¸‹ï¼Œè¦æƒ³æ‰¾åˆ°ä¸€ä¸ªä¸åŒçš„ key å¯¹åº”çš„æ•£åˆ—å€¼éƒ½ä¸ä¸€æ ·çš„æ•£åˆ—å‡½æ•°ï¼Œå‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚å³ä¾¿åƒä¸šç•Œè‘—åçš„MD5ã€SHAã€CRCç­‰å“ˆå¸Œç®—æ³•ï¼Œä¹Ÿæ— æ³•å®Œå…¨é¿å…è¿™ç§æ•£åˆ—å†²çªã€‚è€Œä¸”ï¼Œå› ä¸ºæ•°ç»„çš„å­˜å‚¨ç©ºé—´æœ‰é™ï¼Œä¹Ÿä¼šåŠ å¤§æ•£åˆ—å†²çªçš„æ¦‚ç‡ã€‚æ‰€ä»¥æˆ‘ä»¬å‡ ä¹æ— æ³•æ‰¾åˆ°ä¸€ä¸ªå®Œç¾çš„æ— å†²çªçš„æ•£åˆ—å‡½æ•°ï¼Œå³ä¾¿èƒ½æ‰¾åˆ°ï¼Œä»˜å‡ºçš„æ—¶é—´æˆæœ¬ã€è®¡ç®—æˆæœ¬ä¹Ÿæ˜¯å¾ˆå¤§çš„ï¼Œæ‰€ä»¥é’ˆå¯¹æ•£åˆ—å†²çªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å…¶ä»–é€”å¾„æ¥è§£å†³ã€‚æ•£åˆ—å†²çªå†å¥½çš„æ•£åˆ—å‡½æ•°ä¹Ÿæ— æ³•é¿å…æ•£åˆ—å†²çªã€‚é‚£ç©¶ç«Ÿè¯¥å¦‚ä½•è§£å†³æ•£åˆ—å†²çªé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬å¸¸ç”¨çš„æ•£åˆ—å†²çªè§£å†³æ–¹æ³•æœ‰ä¸¤ç±»ï¼Œå¼€æ”¾å¯»å€æ³•ï¼ˆopen addressingï¼‰å’Œé“¾è¡¨æ³•ï¼ˆchainingï¼‰ã€‚å¼€æ”¾å¯»å€æ³•å¼€æ”¾å¯»å€æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¦‚æœå‡ºç°äº†æ•£åˆ—å†²çªï¼Œæˆ‘ä»¬å°±é‡æ–°æ¢æµ‹ä¸€ä¸ªç©ºé—²ä½ç½®ï¼Œå°†å…¶æ’å…¥ã€‚é‚£å¦‚ä½•é‡æ–°æ¢æµ‹æ–°çš„ä½ç½®å‘¢ï¼Ÿæˆ‘å…ˆè®²ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æ¢æµ‹æ–¹æ³•ï¼Œçº¿æ€§æ¢æµ‹ï¼ˆLinear Probingï¼‰ã€‚å½“æˆ‘ä»¬å¾€æ•£åˆ—è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œå¦‚æœæŸä¸ªæ•°æ®ç»è¿‡æ•£åˆ—å‡½æ•°æ•£åˆ—ä¹‹åï¼Œå­˜å‚¨ä½ç½®å·²ç»è¢«å ç”¨äº†ï¼Œæˆ‘ä»¬å°±ä»å½“å‰ä½ç½®å¼€å§‹ï¼Œä¾æ¬¡å¾€åæŸ¥æ‰¾ï¼Œçœ‹æ˜¯å¦æœ‰ç©ºé—²ä½ç½®ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚æˆ‘è¯´çš„å¯èƒ½æ¯”è¾ƒæŠ½è±¡ï¼Œæˆ‘ä¸¾ä¸€ä¸ªä¾‹å­å…·ä½“ç»™ä½ è¯´æ˜ä¸€ä¸‹ã€‚è¿™é‡Œé¢é»„è‰²çš„è‰²å—è¡¨ç¤ºç©ºé—²ä½ç½®ï¼Œæ©™è‰²çš„è‰²å—è¡¨ç¤ºå·²ç»å­˜å‚¨äº†æ•°æ®ã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ•£åˆ—è¡¨çš„å¤§å°ä¸º 10ï¼Œåœ¨å…ƒç´  x æ’å…¥æ•£åˆ—è¡¨ä¹‹å‰ï¼Œå·²ç» 6 ä¸ªå…ƒç´ æ’å…¥åˆ°æ•£åˆ—è¡¨ä¸­ã€‚x ç»è¿‡ Hash ç®—æ³•ä¹‹åï¼Œè¢«æ•£åˆ—åˆ°ä½ç½®ä¸‹æ ‡ä¸º 7 çš„ä½ç½®ï¼Œä½†æ˜¯è¿™ä¸ªä½ç½®å·²ç»æœ‰æ•°æ®äº†ï¼Œæ‰€ä»¥å°±äº§ç”Ÿäº†å†²çªã€‚äºæ˜¯æˆ‘ä»¬å°±é¡ºåºåœ°å¾€åä¸€ä¸ªä¸€ä¸ªæ‰¾ï¼Œçœ‹æœ‰æ²¡æœ‰ç©ºé—²çš„ä½ç½®ï¼Œéå†åˆ°å°¾éƒ¨éƒ½æ²¡æœ‰æ‰¾åˆ°ç©ºé—²çš„ä½ç½®ï¼Œäºæ˜¯æˆ‘ä»¬å†ä»è¡¨å¤´å¼€å§‹æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ç©ºé—²ä½ç½® 2ï¼Œäºæ˜¯å°†å…¶æ’å…¥åˆ°è¿™ä¸ªä½ç½®ã€‚åœ¨æ•£åˆ—è¡¨ä¸­æŸ¥æ‰¾å…ƒç´ çš„è¿‡ç¨‹æœ‰ç‚¹å„¿ç±»ä¼¼æ’å…¥è¿‡ç¨‹ã€‚æˆ‘ä»¬é€šè¿‡æ•£åˆ—å‡½æ•°æ±‚å‡ºè¦æŸ¥æ‰¾å…ƒç´ çš„é”®å€¼å¯¹åº”çš„æ•£åˆ—å€¼ï¼Œç„¶åæ¯”è¾ƒæ•°ç»„ä¸­ä¸‹æ ‡ä¸ºæ•£åˆ—å€¼çš„å…ƒç´ å’Œè¦æŸ¥æ‰¾çš„å…ƒç´ ã€‚å¦‚æœç›¸ç­‰ï¼Œåˆ™è¯´æ˜å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å…ƒç´ ï¼›å¦åˆ™å°±é¡ºåºå¾€åä¾æ¬¡æŸ¥æ‰¾ã€‚å¦‚æœéå†åˆ°æ•°ç»„ä¸­çš„ç©ºé—²ä½ç½®ï¼Œè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±è¯´æ˜è¦æŸ¥æ‰¾çš„å…ƒç´ å¹¶æ²¡æœ‰åœ¨æ•£åˆ—è¡¨ä¸­ã€‚æ•£åˆ—è¡¨è·Ÿæ•°ç»„ä¸€æ ·ï¼Œä¸ä»…æ”¯æŒæ’å…¥ã€æŸ¥æ‰¾æ“ä½œï¼Œè¿˜æ”¯æŒåˆ é™¤æ“ä½œã€‚å¯¹äºä½¿ç”¨çº¿æ€§æ¢æµ‹æ³•è§£å†³å†²çªçš„æ•£åˆ—è¡¨ï¼Œåˆ é™¤æ“ä½œç¨å¾®æœ‰äº›ç‰¹åˆ«ã€‚æˆ‘ä»¬ä¸èƒ½å•çº¯åœ°æŠŠè¦åˆ é™¤çš„å…ƒç´ è®¾ç½®ä¸ºç©ºã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿˜è®°å¾—æˆ‘ä»¬åˆšè®²çš„æŸ¥æ‰¾æ“ä½œå—ï¼Ÿåœ¨æŸ¥æ‰¾çš„æ—¶å€™ï¼Œä¸€æ—¦æˆ‘ä»¬é€šè¿‡çº¿æ€§æ¢æµ‹æ–¹æ³•ï¼Œæ‰¾åˆ°ä¸€ä¸ªç©ºé—²ä½ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¤å®šæ•£åˆ—è¡¨ä¸­ä¸å­˜åœ¨è¿™ä¸ªæ•°æ®ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™ä¸ªç©ºé—²ä½ç½®æ˜¯æˆ‘ä»¬åæ¥åˆ é™¤çš„ï¼Œå°±ä¼šå¯¼è‡´åŸæ¥çš„æŸ¥æ‰¾ç®—æ³•å¤±æ•ˆã€‚æœ¬æ¥å­˜åœ¨çš„æ•°æ®ï¼Œä¼šè¢«è®¤å®šä¸ºä¸å­˜åœ¨ã€‚è¿™ä¸ªé—®é¢˜å¦‚ä½•è§£å†³å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å°†åˆ é™¤çš„å…ƒç´ ï¼Œç‰¹æ®Šæ ‡è®°ä¸º deletedã€‚å½“çº¿æ€§æ¢æµ‹æŸ¥æ‰¾çš„æ—¶å€™ï¼Œé‡åˆ°æ ‡è®°ä¸º deleted çš„ç©ºé—´ï¼Œå¹¶ä¸æ˜¯åœä¸‹æ¥ï¼Œè€Œæ˜¯ç»§ç»­å¾€ä¸‹æ¢æµ‹ã€‚ä½ å¯èƒ½å·²ç»å‘ç°äº†ï¼Œçº¿æ€§æ¢æµ‹æ³•å…¶å®å­˜åœ¨å¾ˆå¤§é—®é¢˜ã€‚å½“æ•£åˆ—è¡¨ä¸­æ’å…¥çš„æ•°æ®è¶Šæ¥è¶Šå¤šæ—¶ï¼Œæ•£åˆ—å†²çªå‘ç”Ÿçš„å¯èƒ½æ€§å°±ä¼šè¶Šæ¥è¶Šå¤§ï¼Œç©ºé—²ä½ç½®ä¼šè¶Šæ¥è¶Šå°‘ï¼Œçº¿æ€§æ¢æµ‹çš„æ—¶é—´å°±ä¼šè¶Šæ¥è¶Šä¹…ã€‚æç«¯æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ¢æµ‹æ•´ä¸ªæ•£åˆ—è¡¨ï¼Œæ‰€ä»¥æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚åŒç†ï¼Œåœ¨åˆ é™¤å’ŒæŸ¥æ‰¾æ—¶ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šçº¿æ€§æ¢æµ‹æ•´å¼ æ•£åˆ—è¡¨ï¼Œæ‰èƒ½æ‰¾åˆ°è¦æŸ¥æ‰¾æˆ–è€…åˆ é™¤çš„æ•°æ®ã€‚å¯¹äºå¼€æ”¾å¯»å€å†²çªè§£å†³æ–¹æ³•ï¼Œé™¤äº†çº¿æ€§æ¢æµ‹æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸¤ç§æ¯”è¾ƒç»å…¸çš„æ¢æµ‹æ–¹æ³•ï¼ŒäºŒæ¬¡æ¢æµ‹ï¼ˆQuadratic probingï¼‰å’ŒåŒé‡æ•£åˆ—ï¼ˆDouble hashingï¼‰ã€‚æ‰€è°“äºŒæ¬¡æ¢æµ‹ï¼Œè·Ÿçº¿æ€§æ¢æµ‹å¾ˆåƒï¼Œçº¿æ€§æ¢æµ‹æ¯æ¬¡æ¢æµ‹çš„æ­¥é•¿æ˜¯ 1ï¼Œé‚£å®ƒæ¢æµ‹çš„ä¸‹æ ‡åºåˆ—å°±æ˜¯ hash(key)+0ï¼Œhash(key)+1ï¼Œhash(key)+2â€¦â€¦è€ŒäºŒæ¬¡æ¢æµ‹æ¢æµ‹çš„æ­¥é•¿å°±å˜æˆäº†åŸæ¥çš„â€œäºŒæ¬¡æ–¹â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ¢æµ‹çš„ä¸‹æ ‡åºåˆ—å°±æ˜¯ hash(key)+0ï¼Œhash(key)+12ï¼Œhash(key)+22â€¦â€¦æ‰€è°“åŒé‡æ•£åˆ—ï¼Œæ„æ€å°±æ˜¯ä¸ä»…è¦ä½¿ç”¨ä¸€ä¸ªæ•£åˆ—å‡½æ•°ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ç»„æ•£åˆ—å‡½æ•° hash1(key)ï¼Œhash2(key)ï¼Œhash3(key)â€¦â€¦æˆ‘ä»¬å…ˆç”¨ç¬¬ä¸€ä¸ªæ•£åˆ—å‡½æ•°ï¼Œå¦‚æœè®¡ç®—å¾—åˆ°çš„å­˜å‚¨ä½ç½®å·²ç»è¢«å ç”¨ï¼Œå†ç”¨ç¬¬äºŒä¸ªæ•£åˆ—å‡½æ•°ï¼Œä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°æ‰¾åˆ°ç©ºé—²çš„å­˜å‚¨ä½ç½®ã€‚ä¸ç®¡é‡‡ç”¨å“ªç§æ¢æµ‹æ–¹æ³•ï¼Œå½“æ•£åˆ—è¡¨ä¸­ç©ºé—²ä½ç½®ä¸å¤šçš„æ—¶å€™ï¼Œæ•£åˆ—å†²çªçš„æ¦‚ç‡å°±ä¼šå¤§å¤§æé«˜ã€‚ä¸ºäº†å°½å¯èƒ½ä¿è¯æ•£åˆ—è¡¨çš„æ“ä½œæ•ˆç‡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå°½å¯èƒ½ä¿è¯æ•£åˆ—è¡¨ä¸­æœ‰ä¸€å®šæ¯”ä¾‹çš„ç©ºé—²æ§½ä½ã€‚æˆ‘ä»¬ç”¨è£…è½½å› å­ï¼ˆload factorï¼‰æ¥è¡¨ç¤ºç©ºä½çš„å¤šå°‘ã€‚è£…è½½å› å­çš„è®¡ç®—å…¬å¼æ˜¯ï¼š1æ•£åˆ—è¡¨çš„è£…è½½å› å­=å¡«å…¥è¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°/æ•£åˆ—è¡¨çš„é•¿åº¦è£…è½½å› å­è¶Šå¤§ï¼Œè¯´æ˜ç©ºé—²ä½ç½®è¶Šå°‘ï¼Œå†²çªè¶Šå¤šï¼Œæ•£åˆ—è¡¨çš„æ€§èƒ½ä¼šä¸‹é™ã€‚é“¾è¡¨æ³•é“¾è¡¨æ³•æ˜¯ä¸€ç§æ›´åŠ å¸¸ç”¨çš„æ•£åˆ—å†²çªè§£å†³åŠæ³•ï¼Œç›¸æ¯”å¼€æ”¾å¯»å€æ³•ï¼Œå®ƒè¦ç®€å•å¾ˆå¤šã€‚æˆ‘ä»¬æ¥çœ‹è¿™ä¸ªå›¾ï¼Œåœ¨æ•£åˆ—è¡¨ä¸­ï¼Œæ¯ä¸ªâ€œæ¡¶ï¼ˆbucketï¼‰â€æˆ–è€…â€œæ§½ï¼ˆslotï¼‰â€ä¼šå¯¹åº”ä¸€æ¡é“¾è¡¨ï¼Œæ‰€æœ‰æ•£åˆ—å€¼ç›¸åŒçš„å…ƒç´ æˆ‘ä»¬éƒ½æ”¾åˆ°ç›¸åŒæ§½ä½å¯¹åº”çš„é“¾è¡¨ä¸­ã€‚å½“æ’å…¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡æ•£åˆ—å‡½æ•°è®¡ç®—å‡ºå¯¹åº”çš„æ•£åˆ—æ§½ä½ï¼Œå°†å…¶æ’å…¥åˆ°å¯¹åº”é“¾è¡¨ä¸­å³å¯ï¼Œæ‰€ä»¥æ’å…¥çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚å½“æŸ¥æ‰¾ã€åˆ é™¤ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæˆ‘ä»¬åŒæ ·é€šè¿‡æ•£åˆ—å‡½æ•°è®¡ç®—å‡ºå¯¹åº”çš„æ§½ï¼Œç„¶åéå†é“¾è¡¨æŸ¥æ‰¾æˆ–è€…åˆ é™¤ã€‚é‚£æŸ¥æ‰¾æˆ–åˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿå®é™…ä¸Šï¼Œè¿™ä¸¤ä¸ªæ“ä½œçš„æ—¶é—´å¤æ‚åº¦è·Ÿé“¾è¡¨çš„é•¿åº¦ k æˆæ­£æ¯”ï¼Œä¹Ÿå°±æ˜¯ O(k)ã€‚å¯¹äºæ•£åˆ—æ¯”è¾ƒå‡åŒ€çš„æ•£åˆ—å‡½æ•°æ¥è¯´ï¼Œç†è®ºä¸Šè®²ï¼Œk=n/mï¼Œå…¶ä¸­ n è¡¨ç¤ºæ•£åˆ—ä¸­æ•°æ®çš„ä¸ªæ•°ï¼Œm è¡¨ç¤ºæ•£åˆ—è¡¨ä¸­â€œæ§½â€çš„ä¸ªæ•°ã€‚è§£ç­”å¼€ç¯‡æœ‰äº†å‰é¢è¿™äº›åŸºæœ¬çŸ¥è¯†å‚¨å¤‡ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¼€ç¯‡çš„æ€è€ƒé¢˜ï¼šWord æ–‡æ¡£ä¸­å•è¯æ‹¼å†™æ£€æŸ¥åŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå¸¸ç”¨çš„è‹±æ–‡å•è¯æœ‰ 20 ä¸‡ä¸ªå·¦å³ï¼Œå‡è®¾å•è¯çš„å¹³å‡é•¿åº¦æ˜¯ 10 ä¸ªå­—æ¯ï¼Œå¹³å‡ä¸€ä¸ªå•è¯å ç”¨ 10 ä¸ªå­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼Œé‚£ 20 ä¸‡è‹±æ–‡å•è¯å¤§çº¦å  2MB çš„å­˜å‚¨ç©ºé—´ï¼Œå°±ç®—æ”¾å¤§ 10 å€ä¹Ÿå°±æ˜¯ 20MBã€‚å¯¹äºç°åœ¨çš„è®¡ç®—æœºæ¥è¯´ï¼Œè¿™ä¸ªå¤§å°å®Œå…¨å¯ä»¥æ”¾åœ¨å†…å­˜é‡Œé¢ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨æ•£åˆ—è¡¨æ¥å­˜å‚¨æ•´ä¸ªè‹±æ–‡å•è¯è¯å…¸ã€‚å½“ç”¨æˆ·è¾“å…¥æŸä¸ªè‹±æ–‡å•è¯æ—¶ï¼Œæˆ‘ä»¬æ‹¿ç”¨æˆ·è¾“å…¥çš„å•è¯å»æ•£åˆ—è¡¨ä¸­æŸ¥æ‰¾ã€‚å¦‚æœæŸ¥åˆ°ï¼Œåˆ™è¯´æ˜æ‹¼å†™æ­£ç¡®ï¼›å¦‚æœæ²¡æœ‰æŸ¥åˆ°ï¼Œåˆ™è¯´æ˜æ‹¼å†™å¯èƒ½æœ‰è¯¯ï¼Œç»™äºˆæç¤ºã€‚å€ŸåŠ©æ•£åˆ—è¡¨è¿™ç§æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å°±å¯ä»¥è½»æ¾å®ç°å¿«é€Ÿåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ‹¼å†™é”™è¯¯ã€‚å†…å®¹å°ç»“ä»Šå¤©æˆ‘è®²äº†ä¸€äº›æ¯”è¾ƒåŸºç¡€ã€æ¯”è¾ƒåç†è®ºçš„æ•£åˆ—è¡¨çŸ¥è¯†ï¼ŒåŒ…æ‹¬æ•£åˆ—è¡¨çš„ç”±æ¥ã€æ•£åˆ—å‡½æ•°ã€æ•£åˆ—å†²çªçš„è§£å†³æ–¹æ³•ã€‚æ•£åˆ—è¡¨æ¥æºäºæ•°ç»„ï¼Œå®ƒå€ŸåŠ©æ•£åˆ—å‡½æ•°å¯¹æ•°ç»„è¿™ç§æ•°æ®ç»“æ„è¿›è¡Œæ‰©å±•ï¼Œåˆ©ç”¨çš„æ˜¯æ•°ç»„æ”¯æŒæŒ‰ç…§ä¸‹æ ‡éšæœºè®¿é—®å…ƒç´ çš„ç‰¹æ€§ã€‚æ•£åˆ—è¡¨ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜æ˜¯æ•£åˆ—å‡½æ•°è®¾è®¡å’Œæ•£åˆ—å†²çªè§£å†³ã€‚æ•£åˆ—å†²çªæœ‰ä¸¤ç§å¸¸ç”¨çš„è§£å†³æ–¹æ³•ï¼Œå¼€æ”¾å¯»å€æ³•å’Œé“¾è¡¨æ³•ã€‚æ•£åˆ—å‡½æ•°è®¾è®¡çš„å¥½åå†³å®šäº†æ•£åˆ—å†²çªçš„æ¦‚ç‡ï¼Œä¹Ÿå°±å†³å®šæ•£åˆ—è¡¨çš„æ€§èƒ½ã€‚é’ˆå¯¹æ•£åˆ—å‡½æ•°å’Œæ•£åˆ—å†²çªã€‚","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"cpeixin.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•£åˆ—è¡¨","slug":"æ•£åˆ—è¡¨","permalink":"cpeixin.cn/tags/%E6%95%A3%E5%88%97%E8%A1%A8/"}]},{"title":"ç®—æ³•-æ’å…¥æ’åº","slug":"ç®—æ³•-æ’å…¥æ’åº","date":"2016-08-21T15:22:43.000Z","updated":"2020-05-21T09:12:58.909Z","comments":true,"path":"2016/08/21/ç®—æ³•-æ’å…¥æ’åº/","link":"","permalink":"cpeixin.cn/2016/08/21/%E7%AE%97%E6%B3%95-%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/","excerpt":"","text":"æ’å…¥æ’åºçš„ä»£ç å®ç°è™½ç„¶æ²¡æœ‰å†’æ³¡æ’åºå’Œé€‰æ‹©æ’åºé‚£ä¹ˆç®€å•ç²—æš´ï¼Œä½†å®ƒçš„åŸç†åº”è¯¥æ˜¯æœ€å®¹æ˜“ç†è§£çš„äº†ï¼Œå› ä¸ºåªè¦æ‰“è¿‡æ‰‘å…‹ç‰Œçš„äººéƒ½åº”è¯¥èƒ½å¤Ÿç§’æ‡‚ã€‚æ’å…¥æ’åºæ˜¯ä¸€ç§æœ€ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ï¼Œå®ƒçš„å·¥ä½œåŸç†æ˜¯é€šè¿‡æ„å»ºæœ‰åºåºåˆ—ï¼Œå¯¹äºæœªæ’åºæ•°æ®ï¼Œåœ¨å·²æ’åºåºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼Œæ‰¾åˆ°ç›¸åº”ä½ç½®å¹¶æ’å…¥ã€‚æ’å…¥æ’åºå’Œå†’æ³¡æ’åºä¸€æ ·ï¼Œä¹Ÿæœ‰ä¸€ç§ä¼˜åŒ–ç®—æ³•ï¼Œå«åšæ‹†åŠæ’å…¥ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªé—®é¢˜ã€‚ä¸€ä¸ªæœ‰åºçš„æ•°ç»„ï¼Œæˆ‘ä»¬å¾€é‡Œé¢æ·»åŠ ä¸€ä¸ªæ–°çš„æ•°æ®åï¼Œå¦‚ä½•ç»§ç»­ä¿æŒæ•°æ®æœ‰åºå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªè¦éå†æ•°ç»„ï¼Œæ‰¾åˆ°æ•°æ®åº”è¯¥æ’å…¥çš„ä½ç½®å°†å…¶æ’å…¥å³å¯ã€‚è¿™æ˜¯ä¸€ä¸ªåŠ¨æ€æ’åºçš„è¿‡ç¨‹ï¼Œå³åŠ¨æ€åœ°å¾€æœ‰åºé›†åˆä¸­æ·»åŠ æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•ä¿æŒé›†åˆä¸­çš„æ•°æ®ä¸€ç›´æœ‰åºã€‚è€Œå¯¹äºä¸€ç»„é™æ€æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å€Ÿé‰´ä¸Šé¢è®²çš„æ’å…¥æ–¹æ³•ï¼Œæ¥è¿›è¡Œæ’åºï¼Œäºæ˜¯å°±æœ‰äº†æ’å…¥æ’åºç®—æ³•ã€‚é‚£æ’å…¥æ’åºå…·ä½“æ˜¯å¦‚ä½•å€ŸåŠ©ä¸Šé¢çš„æ€æƒ³æ¥å®ç°æ’åºçš„å‘¢ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬å°†æ•°ç»„ä¸­çš„æ•°æ®åˆ†ä¸ºä¸¤ä¸ªåŒºé—´ï¼Œå·²æ’åºåŒºé—´å’Œæœªæ’åºåŒºé—´ã€‚åˆå§‹å·²æ’åºåŒºé—´åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå°±æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚æ’å…¥ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯å–æœªæ’åºåŒºé—´ä¸­çš„å…ƒç´ ï¼Œåœ¨å·²æ’åºåŒºé—´ä¸­æ‰¾åˆ°åˆé€‚çš„æ’å…¥ä½ç½®å°†å…¶æ’å…¥ï¼Œå¹¶ä¿è¯å·²æ’åºåŒºé—´æ•°æ®ä¸€ç›´æœ‰åºã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æœªæ’åºåŒºé—´ä¸­å…ƒç´ ä¸ºç©ºï¼Œç®—æ³•ç»“æŸã€‚å¦‚å›¾æ‰€ç¤ºï¼Œè¦æ’åºçš„æ•°æ®æ˜¯ 4ï¼Œ5ï¼Œ6ï¼Œ1ï¼Œ3ï¼Œ2ï¼Œå…¶ä¸­å·¦ä¾§ä¸ºå·²æ’åºåŒºé—´ï¼Œå³ä¾§æ˜¯æœªæ’åºåŒºé—´ã€‚æ’å…¥æ’åºä¹ŸåŒ…å«ä¸¤ç§æ“ä½œï¼Œä¸€ç§æ˜¯å…ƒç´ çš„æ¯”è¾ƒï¼Œä¸€ç§æ˜¯å…ƒç´ çš„ç§»åŠ¨ã€‚å½“æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªæ•°æ® a æ’å…¥åˆ°å·²æ’åºåŒºé—´æ—¶ï¼Œéœ€è¦æ‹¿ a ä¸å·²æ’åºåŒºé—´çš„å…ƒç´ ä¾æ¬¡æ¯”è¾ƒå¤§å°ï¼Œæ‰¾åˆ°åˆé€‚çš„æ’å…¥ä½ç½®ã€‚æ‰¾åˆ°æ’å…¥ç‚¹ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†æ’å…¥ç‚¹ä¹‹åçš„å…ƒç´ é¡ºåºå¾€åç§»åŠ¨ä¸€ä½ï¼Œè¿™æ ·æ‰èƒ½è…¾å‡ºä½ç½®ç»™å…ƒç´  a æ’å…¥ã€‚å¯¹äºä¸åŒçš„æŸ¥æ‰¾æ’å…¥ç‚¹æ–¹æ³•ï¼ˆä»å¤´åˆ°å°¾ã€ä»å°¾åˆ°å¤´ï¼‰ï¼Œå…ƒç´ çš„æ¯”è¾ƒæ¬¡æ•°æ˜¯æœ‰åŒºåˆ«çš„ã€‚ä½†å¯¹äºä¸€ä¸ªç»™å®šçš„åˆå§‹åºåˆ—ï¼Œç§»åŠ¨æ“ä½œçš„æ¬¡æ•°æ€»æ˜¯å›ºå®šçš„ï¼Œå°±ç­‰äºé€†åºåº¦ã€‚ä¸ºä»€ä¹ˆè¯´ç§»åŠ¨æ¬¡æ•°å°±ç­‰äºé€†åºåº¦å‘¢ï¼Ÿæˆ‘æ‹¿åˆšæ‰çš„ä¾‹å­ç”»äº†ä¸€ä¸ªå›¾è¡¨ï¼Œä½ ä¸€çœ‹å°±æ˜ç™½äº†ã€‚æ»¡æœ‰åºåº¦æ˜¯ n*(n-1)/2=15ï¼Œåˆå§‹åºåˆ—çš„æœ‰åºåº¦æ˜¯ 5ï¼Œæ‰€ä»¥é€†åºåº¦æ˜¯ 10ã€‚æ’å…¥æ’åºä¸­ï¼Œæ•°æ®ç§»åŠ¨çš„ä¸ªæ•°æ€»å’Œä¹Ÿç­‰äº 10=3+3+4ã€‚ä¸‹é¢ç»™å‡ºæ’å…¥æ’åºçš„åŠ¨å›¾ä»£ç å¦‚ä¸‹ï¼š123456789def insert_sort_1(arr): for i in range(len(arr)): preIndex = i-1 current = arr[i] while preIndex &gt;= 0 and arr[preIndex] &gt; current: arr[preIndex+1] = arr[preIndex] preIndex-=1 arr[preIndex+1] = current return arrè¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå¦‚ä¸Šé¢çš„ä»£ç ï¼Œcurrentæ˜¯æˆ‘ä»¬æ¯æ¬¡è¿›è¡Œæ¯”è¾ƒçš„å€¼ï¼Œæ¯æ¬¡ä¸å‰é¢çš„preIndexå€¼æ¯”è¾ƒï¼Œå¦‚æœæ¯”preIndexå€¼å°ï¼Œåˆ™preIndexå€¼åç§»ï¼Œcurrentå€¼è¿™æ—¶å€™ä¸è¦ä¸preIndexçš„å€¼è¿›è¡Œäº¤æ¢ï¼Œè¿™æ ·å°±å†™æˆäº†å†’æ³¡æ’åºğŸ˜„ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ç‚¹ç¨å¾®å¤æ‚çš„ä¸œè¥¿ã€‚æˆ‘è¿™é‡Œè¿˜æ˜¯æœ‰ä¸‰ä¸ªé—®é¢˜è¦é—®ä½ ã€‚ç¬¬ä¸€ï¼Œæ’å…¥æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•å—ï¼Ÿä»å®ç°è¿‡ç¨‹å¯ä»¥å¾ˆæ˜æ˜¾åœ°çœ‹å‡ºï¼Œæ’å…¥æ’åºç®—æ³•çš„è¿è¡Œå¹¶ä¸éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸåœ°æ’åºç®—æ³•ã€‚ç¬¬äºŒï¼Œæ’å…¥æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿåœ¨æ’å…¥æ’åºä¸­ï¼Œå¯¹äºå€¼ç›¸åŒçš„å…ƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å°†åé¢å‡ºç°çš„å…ƒç´ ï¼Œæ’å…¥åˆ°å‰é¢å‡ºç°å…ƒç´ çš„åé¢ï¼Œè¿™æ ·å°±å¯ä»¥ä¿æŒåŸæœ‰çš„å‰åé¡ºåºä¸å˜ï¼Œæ‰€ä»¥æ’å…¥æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•ã€‚ç¬¬ä¸‰ï¼Œæ’å…¥æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿå¦‚æœè¦æ’åºçš„æ•°æ®å·²ç»æ˜¯æœ‰åºçš„ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦æ¬ç§»ä»»ä½•æ•°æ®ã€‚å¦‚æœæˆ‘ä»¬ä»å°¾åˆ°å¤´åœ¨æœ‰åºæ•°æ®ç»„é‡Œé¢æŸ¥æ‰¾æ’å…¥ä½ç½®ï¼Œæ¯æ¬¡åªéœ€è¦æ¯”è¾ƒä¸€ä¸ªæ•°æ®å°±èƒ½ç¡®å®šæ’å…¥çš„ä½ç½®ã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½æ˜¯æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚æ³¨æ„ï¼Œè¿™é‡Œæ˜¯ä»å°¾åˆ°å¤´éå†å·²ç»æœ‰åºçš„æ•°æ®ã€‚å¦‚æœæ•°ç»„æ˜¯å€’åºçš„ï¼Œæ¯æ¬¡æ’å…¥éƒ½ç›¸å½“äºåœ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®æ’å…¥æ–°çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦ç§»åŠ¨å¤§é‡çš„æ•°æ®ï¼Œæ‰€ä»¥æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸º O(n2)ã€‚è¿˜è®°å¾—æˆ‘ä»¬åœ¨æ•°ç»„ä¸­æ’å…¥ä¸€ä¸ªæ•°æ®çš„å¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘å—ï¼Ÿæ²¡é”™ï¼Œæ˜¯ O(n)ã€‚æ‰€ä»¥ï¼Œå¯¹äºæ’å…¥æ’åºæ¥è¯´ï¼Œæ¯æ¬¡æ’å…¥æ“ä½œéƒ½ç›¸å½“äºåœ¨æ•°ç»„ä¸­æ’å…¥ä¸€ä¸ªæ•°æ®ï¼Œå¾ªç¯æ‰§è¡Œ n æ¬¡æ’å…¥æ“ä½œï¼Œæ‰€ä»¥å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(n2)ã€‚å†’æ³¡æ’åºå’Œæ’å…¥æ’åºçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(n2)ï¼Œéƒ½æ˜¯åŸåœ°æ’åºç®—æ³•ï¼Œä¸ºä»€ä¹ˆæ’å…¥æ’åºè¦æ¯”å†’æ³¡æ’åºæ›´å—æ¬¢è¿å‘¢ï¼Ÿæˆ‘ä»¬å‰é¢åˆ†æå†’æ³¡æ’åºå’Œæ’å…¥æ’åºçš„æ—¶å€™è®²åˆ°ï¼Œå†’æ³¡æ’åºä¸ç®¡æ€ä¹ˆä¼˜åŒ–ï¼Œå…ƒç´ äº¤æ¢çš„æ¬¡æ•°æ˜¯ä¸€ä¸ªå›ºå®šå€¼ï¼Œæ˜¯åŸå§‹æ•°æ®çš„é€†åºåº¦ã€‚æ’å…¥æ’åºæ˜¯åŒæ ·çš„ï¼Œä¸ç®¡æ€ä¹ˆä¼˜åŒ–ï¼Œå…ƒç´ ç§»åŠ¨çš„æ¬¡æ•°ä¹Ÿç­‰äºåŸå§‹æ•°æ®çš„é€†åºåº¦ã€‚ä½†æ˜¯ï¼Œä»å‰é¢çš„ä»£ç å®ç°ä¸Šæ¥çœ‹ï¼Œå†’æ³¡æ’åºçš„æ•°æ®äº¤æ¢è¦æ¯”æ’å…¥æ’åºçš„æ•°æ®ç§»åŠ¨è¦å¤æ‚ï¼Œå†’æ³¡æ’åºéœ€è¦ 3 ä¸ªèµ‹å€¼æ“ä½œï¼Œè€Œæ’å…¥æ’åºåªéœ€è¦ 1 ä¸ªã€‚æˆ‘ä»¬æŠŠæ‰§è¡Œä¸€ä¸ªèµ‹å€¼è¯­å¥çš„æ—¶é—´ç²—ç•¥åœ°è®¡ä¸ºå•ä½æ—¶é—´ï¼ˆunit_timeï¼‰ï¼Œç„¶ååˆ†åˆ«ç”¨å†’æ³¡æ’åºå’Œæ’å…¥æ’åºå¯¹åŒä¸€ä¸ªé€†åºåº¦æ˜¯ K çš„æ•°ç»„è¿›è¡Œæ’åºã€‚ç”¨å†’æ³¡æ’åºï¼Œéœ€è¦ K æ¬¡äº¤æ¢æ“ä½œï¼Œæ¯æ¬¡éœ€è¦ 3 ä¸ªèµ‹å€¼è¯­å¥ï¼Œæ‰€ä»¥äº¤æ¢æ“ä½œæ€»è€—æ—¶å°±æ˜¯ 3*K å•ä½æ—¶é—´ã€‚è€Œæ’å…¥æ’åºä¸­æ•°æ®ç§»åŠ¨æ“ä½œåªéœ€è¦ K ä¸ªå•ä½æ—¶é—´ã€‚è¿™ä¸ªåªæ˜¯æˆ‘ä»¬éå¸¸ç†è®ºçš„åˆ†æï¼Œå¯¹ä¸¤ç§æ’åºæ€§èƒ½å¯¹æ¯”æµ‹è¯•ç¨‹åºï¼Œéšæœºç”Ÿæˆ 10000 ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„ä¸­åŒ…å« 200 ä¸ªæ•°æ®ï¼Œç„¶ååœ¨æˆ‘çš„æœºå™¨ä¸Šåˆ†åˆ«ç”¨å†’æ³¡å’Œæ’å…¥æ’åºç®—æ³•æ¥æ’åºï¼Œå†’æ³¡æ’åºç®—æ³•å¤§çº¦ 700ms æ‰èƒ½æ‰§è¡Œå®Œæˆï¼Œè€Œæ’å…¥æ’åºåªéœ€è¦ 100ms å·¦å³å°±èƒ½æå®šï¼æ‰€ä»¥ï¼Œè™½ç„¶å†’æ³¡æ’åºå’Œæ’å…¥æ’åºåœ¨æ—¶é—´å¤æ‚åº¦ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ O(n2)ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬å¸Œæœ›æŠŠæ€§èƒ½ä¼˜åŒ–åšåˆ°æè‡´ï¼Œé‚£è‚¯å®šé¦–é€‰æ’å…¥æ’åºã€‚æ’å…¥æ’åºçš„ç®—æ³•æ€è·¯ä¹Ÿæœ‰å¾ˆå¤§çš„ä¼˜åŒ–ç©ºé—´ï¼Œæˆ‘ä»¬åªæ˜¯è®²äº†æœ€åŸºç¡€çš„ä¸€ç§ã€‚","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"æ’åº","slug":"æ’åº","permalink":"cpeixin.cn/tags/%E6%8E%92%E5%BA%8F/"}]},{"title":"ç®—æ³•-å†’æ³¡æ’åº","slug":"ç®—æ³•-å†’æ³¡æ’åº","date":"2016-08-20T15:22:43.000Z","updated":"2020-05-22T06:12:49.940Z","comments":true,"path":"2016/08/20/ç®—æ³•-å†’æ³¡æ’åº/","link":"","permalink":"cpeixin.cn/2016/08/20/%E7%AE%97%E6%B3%95-%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/","excerpt":"","text":"æ’åºå¯¹äºä»»ä½•ä¸€ä¸ªç¨‹åºå‘˜æ¥è¯´ï¼Œå¯èƒ½éƒ½ä¸ä¼šé™Œç”Ÿã€‚ä½ å­¦çš„ç¬¬ä¸€ä¸ªç®—æ³•ï¼Œå¯èƒ½å°±æ˜¯æ’åºã€‚å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œä¹Ÿéƒ½æä¾›äº†æ’åºå‡½æ•°ã€‚åœ¨å¹³å¸¸çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿç»å¸¸ä¼šç”¨åˆ°æ’åºã€‚æ’åºéå¸¸é‡è¦ï¼Œæ‰€ä»¥æˆ‘ä¼šèŠ±å¤šä¸€ç‚¹æ—¶é—´æ¥è¯¦ç»†è®²ä¸€è®²ç»å…¸çš„æ’åºç®—æ³•ã€‚æ’åºç®—æ³•å¤ªå¤šäº†ï¼Œæœ‰å¾ˆå¤šå¯èƒ½ä½ è¿åå­—éƒ½æ²¡å¬è¯´è¿‡ï¼Œæ¯”å¦‚çŒ´å­æ’åºã€ç¡çœ æ’åºã€é¢æ¡æ’åºç­‰ã€‚æˆ‘åªè®²ä¼—å¤šæ’åºç®—æ³•ä¸­çš„ä¸€å°æ’®ï¼Œä¹Ÿæ˜¯æœ€ç»å…¸çš„ã€æœ€å¸¸ç”¨çš„ï¼šå†’æ³¡æ’åºã€æ’å…¥æ’åºã€é€‰æ‹©æ’åºã€å½’å¹¶æ’åºã€å¿«é€Ÿæ’åºã€è®¡æ•°æ’åºã€åŸºæ•°æ’åºã€æ¡¶æ’åºã€‚æ›´ä¸ºç²¾ç®€çš„ï¼Œåœ¨ã€Šç®—æ³•å›¾è§£ã€‹è¿™æœ¬ä¹¦ä¸­ï¼Œæ’åºæ¨¡å—åªæ‹¿é€‰æ‹©æ’åºä½œä¸ºå…¸å‹è¿›è¡Œäº†è®²è§£æˆ‘æŒ‰ç…§æ—¶é—´å¤æ‚åº¦æŠŠå®ƒä»¬åˆ†æˆäº†ä¸‰ç±»ï¼Œå¸¦ç€é—®é¢˜å»å­¦ä¹ ï¼Œæ˜¯æœ€æœ‰æ•ˆçš„å­¦ä¹ æ–¹æ³•ã€‚æ‰€ä»¥æŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘è¿˜æ˜¯å…ˆç»™ä½ å‡ºä¸€ä¸ªæ€è€ƒé¢˜ï¼šæ’å…¥æ’åºå’Œå†’æ³¡æ’åºçš„æ—¶é—´å¤æ‚åº¦ç›¸åŒï¼Œéƒ½æ˜¯ O(n2)ï¼Œåœ¨å®é™…çš„è½¯ä»¶å¼€å‘é‡Œï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬æ›´å€¾å‘äºä½¿ç”¨æ’å…¥æ’åºç®—æ³•è€Œä¸æ˜¯å†’æ³¡æ’åºç®—æ³•å‘¢ï¼Ÿä½ å¯ä»¥å…ˆæ€è€ƒä¸€ä¸¤åˆ†é’Ÿï¼Œå¸¦ç€è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼€å§‹ä»Šå¤©çš„å†…å®¹ï¼å¦‚ä½•åˆ†æä¸€ä¸ªâ€œæ’åºç®—æ³•â€ï¼Ÿå­¦ä¹ æ’åºç®—æ³•ï¼Œæˆ‘ä»¬é™¤äº†å­¦ä¹ å®ƒçš„ç®—æ³•åŸç†ã€ä»£ç å®ç°ä¹‹å¤–ï¼Œæ›´é‡è¦çš„æ˜¯è¦å­¦ä¼šå¦‚ä½•è¯„ä»·ã€åˆ†æä¸€ä¸ªæ’åºç®—æ³•ã€‚é‚£åˆ†æä¸€ä¸ªæ’åºç®—æ³•ï¼Œè¦ä»å“ªå‡ ä¸ªæ–¹é¢å…¥æ‰‹å‘¢ï¼Ÿæ’åºç®—æ³•çš„æ‰§è¡Œæ•ˆç‡å¯¹äºæ’åºç®—æ³•æ‰§è¡Œæ•ˆç‡çš„åˆ†æï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä»è¿™å‡ ä¸ªæ–¹é¢æ¥è¡¡é‡ï¼š1. æœ€å¥½æƒ…å†µã€æœ€åæƒ…å†µã€å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦æˆ‘ä»¬åœ¨åˆ†ææ’åºç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ—¶ï¼Œè¦åˆ†åˆ«ç»™å‡ºæœ€å¥½æƒ…å†µã€æœ€åæƒ…å†µã€å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜è¦è¯´å‡ºæœ€å¥½ã€æœ€åæ—¶é—´å¤æ‚åº¦å¯¹åº”çš„è¦æ’åºçš„åŸå§‹æ•°æ®æ˜¯ä»€ä¹ˆæ ·çš„ã€‚ä¸ºä»€ä¹ˆè¦åŒºåˆ†è¿™ä¸‰ç§æ—¶é—´å¤æ‚åº¦å‘¢ï¼Ÿç¬¬ä¸€ï¼Œæœ‰äº›æ’åºç®—æ³•ä¼šåŒºåˆ†ï¼Œä¸ºäº†å¥½å¯¹æ¯”ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¥½éƒ½åšä¸€ä¸‹åŒºåˆ†ã€‚ç¬¬äºŒï¼Œå¯¹äºè¦æ’åºçš„æ•°æ®ï¼Œæœ‰çš„æ¥è¿‘æœ‰åºï¼Œæœ‰çš„å®Œå…¨æ— åºã€‚æœ‰åºåº¦ä¸åŒçš„æ•°æ®ï¼Œå¯¹äºæ’åºçš„æ‰§è¡Œæ—¶é—´è‚¯å®šæ˜¯æœ‰å½±å“çš„ï¼Œæˆ‘ä»¬è¦çŸ¥é“æ’åºç®—æ³•åœ¨ä¸åŒæ•°æ®ä¸‹çš„æ€§èƒ½è¡¨ç°ã€‚2. æ—¶é—´å¤æ‚åº¦çš„ç³»æ•°ã€å¸¸æ•° ã€ä½é˜¶æˆ‘ä»¬çŸ¥é“ï¼Œæ—¶é—´å¤æ‚åº¦ååº”çš„æ˜¯æ•°æ®è§„æ¨¡ n å¾ˆå¤§çš„æ—¶å€™çš„ä¸€ä¸ªå¢é•¿è¶‹åŠ¿ï¼Œæ‰€ä»¥å®ƒè¡¨ç¤ºçš„æ—¶å€™ä¼šå¿½ç•¥ç³»æ•°ã€å¸¸æ•°ã€ä½é˜¶ã€‚ä½†æ˜¯å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ’åºçš„å¯èƒ½æ˜¯ 10 ä¸ªã€100 ä¸ªã€1000 ä¸ªè¿™æ ·è§„æ¨¡å¾ˆå°çš„æ•°æ®ï¼Œæ‰€ä»¥ï¼Œåœ¨å¯¹åŒä¸€é˜¶æ—¶é—´å¤æ‚åº¦çš„æ’åºç®—æ³•æ€§èƒ½å¯¹æ¯”çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦æŠŠç³»æ•°ã€å¸¸æ•°ã€ä½é˜¶ä¹Ÿè€ƒè™‘è¿›æ¥ã€‚3. æ¯”è¾ƒæ¬¡æ•°å’Œäº¤æ¢ï¼ˆæˆ–ç§»åŠ¨ï¼‰æ¬¡æ•°åŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼šæ¶‰åŠä¸¤ç§æ“ä½œï¼Œä¸€ç§æ˜¯å…ƒç´ æ¯”è¾ƒå¤§å°ï¼Œå¦ä¸€ç§æ˜¯å…ƒç´ äº¤æ¢æˆ–ç§»åŠ¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬åœ¨åˆ†ææ’åºç®—æ³•çš„æ‰§è¡Œæ•ˆç‡çš„æ—¶å€™ï¼Œåº”è¯¥æŠŠæ¯”è¾ƒæ¬¡æ•°å’Œäº¤æ¢ï¼ˆæˆ–ç§»åŠ¨ï¼‰æ¬¡æ•°ä¹Ÿè€ƒè™‘è¿›å»ã€‚æ’åºç®—æ³•çš„å†…å­˜æ¶ˆè€—æˆ‘ä»¬å‰é¢è®²è¿‡ï¼Œç®—æ³•çš„å†…å­˜æ¶ˆè€—å¯ä»¥é€šè¿‡ç©ºé—´å¤æ‚åº¦æ¥è¡¡é‡ï¼Œæ’åºç®—æ³•ä¹Ÿä¸ä¾‹å¤–ã€‚ä¸è¿‡ï¼Œé’ˆå¯¹æ’åºç®—æ³•çš„ç©ºé—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬è¿˜å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼ŒåŸåœ°æ’åºï¼ˆSorted in placeï¼‰ã€‚åŸåœ°æ’åºç®—æ³•ï¼Œå°±æ˜¯ç‰¹æŒ‡ç©ºé—´å¤æ‚åº¦æ˜¯ O(1) çš„æ’åºç®—æ³•ã€‚æ’å…¥æ’åºã€å†’æ³¡æ’åºã€é€‰æ‹©æ’åºéƒ½æ˜¯åŸåœ°æ’åºç®—æ³•ã€‚**æ’åºç®—æ³•çš„ç¨³å®šæ€§ä»…ä»…ç”¨æ‰§è¡Œæ•ˆç‡å’Œå†…å­˜æ¶ˆè€—æ¥è¡¡é‡æ’åºç®—æ³•çš„å¥½åæ˜¯ä¸å¤Ÿçš„ã€‚é’ˆå¯¹æ’åºç®—æ³•ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åº¦é‡æŒ‡æ ‡ï¼Œç¨³å®šæ€§ã€‚è¿™ä¸ªæ¦‚å¿µæ˜¯è¯´ï¼Œå¦‚æœå¾…æ’åºçš„åºåˆ—ä¸­å­˜åœ¨å€¼ç›¸ç­‰çš„å…ƒç´ ï¼Œç»è¿‡æ’åºä¹‹åï¼Œç›¸ç­‰å…ƒç´ ä¹‹é—´åŸæœ‰çš„å…ˆåé¡ºåºä¸å˜ã€‚æˆ‘é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šä¸€ä¸‹ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ç»„æ•°æ® 2ï¼Œ9ï¼Œ3ï¼Œ4ï¼Œ8ï¼Œ3ï¼ŒæŒ‰ç…§å¤§å°æ’åºä¹‹åå°±æ˜¯ 2ï¼Œ3ï¼Œ3ï¼Œ4ï¼Œ8ï¼Œ9ã€‚è¿™ç»„æ•°æ®é‡Œæœ‰ä¸¤ä¸ª 3ã€‚ç»è¿‡æŸç§æ’åºç®—æ³•æ’åºä¹‹åï¼Œå¦‚æœä¸¤ä¸ª 3 çš„å‰åé¡ºåºæ²¡æœ‰æ”¹å˜ï¼Œé‚£æˆ‘ä»¬å°±æŠŠè¿™ç§æ’åºç®—æ³•å«ä½œç¨³å®šçš„æ’åºç®—æ³•ï¼›å¦‚æœå‰åé¡ºåºå‘ç”Ÿå˜åŒ–ï¼Œé‚£å¯¹åº”çš„æ’åºç®—æ³•å°±å«ä½œä¸ç¨³å®šçš„æ’åºç®—æ³•ã€‚ä½ å¯èƒ½è¦é—®äº†ï¼Œä¸¤ä¸ª 3 å“ªä¸ªåœ¨å‰ï¼Œå“ªä¸ªåœ¨åæœ‰ä»€ä¹ˆå…³ç³»å•Šï¼Œç¨³ä¸ç¨³å®šåˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿä¸ºä»€ä¹ˆè¦è€ƒå¯Ÿæ’åºç®—æ³•çš„ç¨³å®šæ€§å‘¢ï¼Ÿå¾ˆå¤šæ•°æ®ç»“æ„å’Œç®—æ³•è¯¾ç¨‹ï¼Œåœ¨è®²æ’åºçš„æ—¶å€™ï¼Œéƒ½æ˜¯ç”¨æ•´æ•°æ¥ä¸¾ä¾‹ï¼Œä½†åœ¨çœŸæ­£è½¯ä»¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬è¦æ’åºçš„å¾€å¾€ä¸æ˜¯å•çº¯çš„æ•´æ•°ï¼Œè€Œæ˜¯ä¸€ç»„å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ç…§å¯¹è±¡çš„æŸä¸ª key æ¥æ’åºã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬ç°åœ¨è¦ç»™ç”µå•†äº¤æ˜“ç³»ç»Ÿä¸­çš„â€œè®¢å•â€æ’åºã€‚è®¢å•æœ‰ä¸¤ä¸ªå±æ€§ï¼Œä¸€ä¸ªæ˜¯ä¸‹å•æ—¶é—´ï¼Œå¦ä¸€ä¸ªæ˜¯è®¢å•é‡‘é¢ã€‚å¦‚æœæˆ‘ä»¬ç°åœ¨æœ‰ 10 ä¸‡æ¡è®¢å•æ•°æ®ï¼Œæˆ‘ä»¬å¸Œæœ›æŒ‰ç…§é‡‘é¢ä»å°åˆ°å¤§å¯¹è®¢å•æ•°æ®æ’åºã€‚å¯¹äºé‡‘é¢ç›¸åŒçš„è®¢å•ï¼Œæˆ‘ä»¬å¸Œæœ›æŒ‰ç…§ä¸‹å•æ—¶é—´ä»æ—©åˆ°æ™šæœ‰åºã€‚å¯¹äºè¿™æ ·ä¸€ä¸ªæ’åºéœ€æ±‚ï¼Œæˆ‘ä»¬æ€ä¹ˆæ¥åšå‘¢ï¼Ÿæœ€å…ˆæƒ³åˆ°çš„æ–¹æ³•æ˜¯ï¼šæˆ‘ä»¬å…ˆæŒ‰ç…§é‡‘é¢å¯¹è®¢å•æ•°æ®è¿›è¡Œæ’åºï¼Œç„¶åï¼Œå†éå†æ’åºä¹‹åçš„è®¢å•æ•°æ®ï¼Œå¯¹äºæ¯ä¸ªé‡‘é¢ç›¸åŒçš„å°åŒºé—´å†æŒ‰ç…§ä¸‹å•æ—¶é—´æ’åºã€‚è¿™ç§æ’åºæ€è·¯ç†è§£èµ·æ¥ä¸éš¾ï¼Œä½†æ˜¯å®ç°èµ·æ¥ä¼šå¾ˆå¤æ‚ã€‚å€ŸåŠ©ç¨³å®šæ’åºç®—æ³•ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥éå¸¸ç®€æ´åœ°è§£å†³ã€‚è§£å†³æ€è·¯æ˜¯è¿™æ ·çš„ï¼šæˆ‘ä»¬å…ˆæŒ‰ç…§ä¸‹å•æ—¶é—´ç»™è®¢å•æ’åºï¼Œæ³¨æ„æ˜¯æŒ‰ç…§ä¸‹å•æ—¶é—´ï¼Œä¸æ˜¯é‡‘é¢ã€‚æ’åºå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ç”¨ç¨³å®šæ’åºç®—æ³•ï¼ŒæŒ‰ç…§è®¢å•é‡‘é¢é‡æ–°æ’åºã€‚ä¸¤éæ’åºä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°çš„è®¢å•æ•°æ®å°±æ˜¯æŒ‰ç…§é‡‘é¢ä»å°åˆ°å¤§æ’åºï¼Œé‡‘é¢ç›¸åŒçš„è®¢å•æŒ‰ç…§ä¸‹å•æ—¶é—´ä»æ—©åˆ°æ™šæ’åºçš„ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿç¨³å®šæ’åºç®—æ³•å¯ä»¥ä¿æŒé‡‘é¢ç›¸åŒçš„ä¸¤ä¸ªå¯¹è±¡ï¼Œåœ¨æ’åºä¹‹åçš„å‰åé¡ºåºä¸å˜ã€‚ç¬¬ä¸€æ¬¡æ’åºä¹‹åï¼Œæ‰€æœ‰çš„è®¢å•æŒ‰ç…§ä¸‹å•æ—¶é—´ä»æ—©åˆ°æ™šæœ‰åºäº†ã€‚åœ¨ç¬¬äºŒæ¬¡æ’åºä¸­ï¼Œæˆ‘ä»¬ç”¨çš„æ˜¯ç¨³å®šçš„æ’åºç®—æ³•ï¼Œæ‰€ä»¥ç»è¿‡ç¬¬äºŒæ¬¡æ’åºä¹‹åï¼Œç›¸åŒé‡‘é¢çš„è®¢å•ä»ç„¶ä¿æŒä¸‹å•æ—¶é—´ä»æ—©åˆ°æ™šæœ‰åºã€‚å†’æ³¡æ’åºï¼ˆBubble Sortï¼‰æˆ‘ä»¬ä»å†’æ³¡æ’åºå¼€å§‹ï¼Œå†’æ³¡æ’åºåªä¼šæ“ä½œç›¸é‚»çš„ä¸¤ä¸ªæ•°æ®ã€‚æ¯æ¬¡å†’æ³¡æ“ä½œéƒ½ä¼šå¯¹ç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œçœ‹æ˜¯å¦æ»¡è¶³å¤§å°å…³ç³»è¦æ±‚ã€‚å¦‚æœä¸æ»¡è¶³å°±è®©å®ƒä¿©äº’æ¢ã€‚ä¸€æ¬¡å†’æ³¡ä¼šè®©è‡³å°‘ä¸€ä¸ªå…ƒç´ ç§»åŠ¨åˆ°å®ƒåº”è¯¥åœ¨çš„ä½ç½®ï¼Œé‡å¤ n æ¬¡ï¼Œå°±å®Œæˆäº† n ä¸ªæ•°æ®çš„æ’åºå·¥ä½œã€‚ä¸‹é¢å°±ä¸è®²å…·ä½“çš„æ’åºè¿‡ç¨‹äº†ï¼Œä¸€å¼ å†’æ³¡æ’åºåŠ¨å›¾ï¼Œå¸¦ä½ çœ‹ä¸‹å†’æ³¡æ’åºçš„æ•´ä¸ªè¿‡ç¨‹ã€‚å†’æ³¡æ’åºç®—æ³•çš„åŸç†æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå…·ä½“çš„ä»£ç æˆ‘è´´åˆ°ä¸‹é¢ï¼Œä½ å¯ä»¥ç»“åˆç€ä»£ç æ¥çœ‹æˆ‘å‰é¢è®²çš„åŸç†ã€‚12345678910111213141516171819202122232425262728293031323334353637import time\"\"\"ç¬¬ä¸€ä¸ª(å¤–å±‚)forå¾ªç¯ä½œç”¨ï¼šæ§åˆ¶æ’åºçš„è½®æ•°ç¬¬äºŒä¸ª(å†…å±‚)forå¾ªç¯ä½œç”¨ï¼šæ§åˆ¶æ¯ä¸€è½®é‡Œçš„æ¯ä¸€ä¸ªæ¯”è¾ƒæ­¥éª¤\"\"\"def bubble_sort(arr): for i in range(1, len(arr)): for j in range(0, len(arr)-i): if arr[j] &gt; arr[j+1]: arr[j], arr[j + 1] = arr[j + 1], arr[j] # å¯ä»¥é…åˆæ‰“å°i,jæ¥æ›´å¥½çš„ç†è§£ # print(i,j) # time.sleep(2) return arrdef bubble_sort_v2(arr): \"\"\"æ”¹è¿›ç‰ˆï¼Œé¿å…å³ä¾§æœ€å¤§å€¼é‡å¤æ¯”è¾ƒ\"\"\" for i in range(len(arr) - 1, 0, -1): # åå‘éå† for j in range(0, i): # ç”±äºæœ€å³ä¾§çš„å€¼å·²ç»æœ‰åºï¼Œä¸å†æ¯”è¾ƒï¼Œæ¯æ¬¡éƒ½å‡å°‘éå†æ¬¡æ•° if arr[j] &gt; arr[j + 1]: arr[j], arr[j + 1] = arr[j + 1], arr[j] return arrdef main(): array = [3,4,1,2,5,6] result_array = bubble_sort(array) print(result_array)if __name__ == '__main__': main()ç°åœ¨ï¼Œç»“åˆåˆšæ‰æˆ‘åˆ†ææ’åºç®—æ³•çš„ä¸‰ä¸ªæ–¹é¢ï¼Œæˆ‘æœ‰ä¸‰ä¸ªé—®é¢˜è¦é—®ä½ ã€‚ç¬¬ä¸€ï¼Œå†’æ³¡æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•å—ï¼Ÿå†’æ³¡çš„è¿‡ç¨‹åªæ¶‰åŠç›¸é‚»æ•°æ®çš„äº¤æ¢æ“ä½œï¼Œåªéœ€è¦å¸¸é‡çº§çš„ä¸´æ—¶ç©ºé—´ï¼Œæ‰€ä»¥å®ƒçš„ç©ºé—´å¤æ‚åº¦ä¸º O(1)ï¼Œæ˜¯ä¸€ä¸ªåŸåœ°æ’åºç®—æ³•ã€‚ç¬¬äºŒï¼Œå†’æ³¡æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å—ï¼Ÿåœ¨å†’æ³¡æ’åºä¸­ï¼Œåªæœ‰äº¤æ¢æ‰å¯ä»¥æ”¹å˜ä¸¤ä¸ªå…ƒç´ çš„å‰åé¡ºåºã€‚ä¸ºäº†ä¿è¯å†’æ³¡æ’åºç®—æ³•çš„ç¨³å®šæ€§ï¼Œå½“æœ‰ç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ å¤§å°ç›¸ç­‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸åšäº¤æ¢ï¼Œç›¸åŒå¤§å°çš„æ•°æ®åœ¨æ’åºå‰åä¸ä¼šæ”¹å˜é¡ºåºï¼Œæ‰€ä»¥å†’æ³¡æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•ã€‚ç¬¬ä¸‰ï¼Œå†’æ³¡æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿæœ€å¥½æƒ…å†µä¸‹ï¼Œè¦æ’åºçš„æ•°æ®å·²ç»æ˜¯æœ‰åºçš„äº†ï¼Œæˆ‘ä»¬åªéœ€è¦è¿›è¡Œä¸€æ¬¡å†’æ³¡æ“ä½œï¼Œå°±å¯ä»¥ç»“æŸäº†ï¼Œæ‰€ä»¥æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚è€Œæœ€åçš„æƒ…å†µæ˜¯ï¼Œè¦æ’åºçš„æ•°æ®åˆšå¥½æ˜¯å€’åºæ’åˆ—çš„ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œ n æ¬¡å†’æ³¡æ“ä½œï¼Œæ‰€ä»¥æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸º O(n2)ã€‚æœ€å¥½ã€æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦å¾ˆå®¹æ˜“åˆ†æï¼Œé‚£å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚æ˜¯å¤šå°‘å‘¢ï¼Ÿæˆ‘ä»¬å‰é¢è®²è¿‡ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦å°±æ˜¯åŠ æƒå¹³å‡æœŸæœ›æ—¶é—´å¤æ‚åº¦ï¼Œåˆ†æçš„æ—¶å€™è¦ç»“åˆæ¦‚ç‡è®ºçš„çŸ¥è¯†ã€‚å¯¹äºåŒ…å« n ä¸ªæ•°æ®çš„æ•°ç»„ï¼Œè¿™ n ä¸ªæ•°æ®å°±æœ‰ n! ç§æ’åˆ—æ–¹å¼ã€‚ä¸åŒçš„æ’åˆ—æ–¹å¼ï¼Œå†’æ³¡æ’åºæ‰§è¡Œçš„æ—¶é—´è‚¯å®šæ˜¯ä¸åŒçš„ã€‚æ¯”å¦‚æˆ‘ä»¬å‰é¢ä¸¾çš„é‚£ä¸¤ä¸ªä¾‹å­ï¼Œå…¶ä¸­ä¸€ä¸ªè¦è¿›è¡Œ 6 æ¬¡å†’æ³¡ï¼Œè€Œå¦ä¸€ä¸ªåªéœ€è¦ 4 æ¬¡ã€‚å¦‚æœç”¨æ¦‚ç‡è®ºæ–¹æ³•å®šé‡åˆ†æå¹³å‡æ—¶é—´å¤æ‚åº¦ï¼Œæ¶‰åŠçš„æ•°å­¦æ¨ç†å’Œè®¡ç®—å°±ä¼šå¾ˆå¤æ‚ã€‚æˆ‘è¿™é‡Œè¿˜æœ‰ä¸€ç§æ€è·¯ï¼Œé€šè¿‡â€œæœ‰åºåº¦â€å’Œâ€œé€†åºåº¦â€è¿™ä¸¤ä¸ªæ¦‚å¿µæ¥è¿›è¡Œåˆ†æã€‚æœ‰åºåº¦æ˜¯æ•°ç»„ä¸­å…·æœ‰æœ‰åºå…³ç³»çš„å…ƒç´ å¯¹çš„ä¸ªæ•°ã€‚æœ‰åºå…ƒç´ å¯¹ç”¨æ•°å­¦è¡¨è¾¾å¼è¡¨ç¤ºå°±æ˜¯è¿™æ ·ï¼š12æœ‰åºå…ƒç´ å¯¹ï¼ša[i] &lt;= a[j], å¦‚æœi &lt; jã€‚åŒç†ï¼Œå¯¹äºä¸€ä¸ªå€’åºæ’åˆ—çš„æ•°ç»„ï¼Œæ¯”å¦‚ 6ï¼Œ5ï¼Œ4ï¼Œ3ï¼Œ2ï¼Œ1ï¼Œæœ‰åºåº¦æ˜¯ 0ï¼›å¯¹äºä¸€ä¸ªå®Œå…¨æœ‰åºçš„æ•°ç»„ï¼Œæ¯”å¦‚ 1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œæœ‰åºåº¦å°±æ˜¯ n(n-1)/2ï¼Œä¹Ÿå°±æ˜¯ 15ã€‚æˆ‘ä»¬æŠŠè¿™ç§å®Œå…¨æœ‰åºçš„æ•°ç»„çš„æœ‰åºåº¦å«ä½œ*æ»¡æœ‰åºåº¦**ã€‚é€†åºåº¦çš„å®šä¹‰æ­£å¥½è·Ÿæœ‰åºåº¦ç›¸åï¼ˆé»˜è®¤ä»å°åˆ°å¤§ä¸ºæœ‰åºï¼‰ï¼Œæˆ‘æƒ³ä½ åº”è¯¥å·²ç»æƒ³åˆ°äº†ã€‚å…³äºé€†åºåº¦ï¼Œæˆ‘å°±ä¸ä¸¾ä¾‹å­è®²äº†ã€‚ä½ å¯ä»¥å¯¹ç…§æˆ‘è®²çš„æœ‰åºåº¦çš„ä¾‹å­è‡ªå·±çœ‹ä¸‹ã€‚12é€†åºå…ƒç´ å¯¹ï¼ša[i] &gt; a[j], å¦‚æœi &lt; jã€‚å…³äºè¿™ä¸‰ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¾—åˆ°ä¸€ä¸ªå…¬å¼ï¼šé€†åºåº¦ = æ»¡æœ‰åºåº¦ - æœ‰åºåº¦ã€‚æˆ‘ä»¬æ’åºçš„è¿‡ç¨‹å°±æ˜¯ä¸€ç§å¢åŠ æœ‰åºåº¦ï¼Œå‡å°‘é€†åºåº¦çš„è¿‡ç¨‹ï¼Œæœ€åè¾¾åˆ°æ»¡æœ‰åºåº¦ï¼Œå°±è¯´æ˜æ’åºå®Œæˆäº†ã€‚æˆ‘è¿˜æ˜¯æ‹¿å‰é¢ä¸¾çš„é‚£ä¸ªå†’æ³¡æ’åºçš„ä¾‹å­æ¥è¯´æ˜ã€‚è¦æ’åºçš„æ•°ç»„çš„åˆå§‹çŠ¶æ€æ˜¯ 4ï¼Œ5ï¼Œ6ï¼Œ3ï¼Œ2ï¼Œ1 ï¼Œå…¶ä¸­ï¼Œæœ‰åºå…ƒç´ å¯¹æœ‰ (4ï¼Œ5) (4ï¼Œ6)(5ï¼Œ6)ï¼Œæ‰€ä»¥æœ‰åºåº¦æ˜¯ 3ã€‚n=6ï¼Œæ‰€ä»¥æ’åºå®Œæˆä¹‹åç»ˆæ€çš„æ»¡æœ‰åºåº¦ä¸º n(n-1)/2=15ã€‚å†’æ³¡æ’åºåŒ…å«ä¸¤ä¸ªæ“ä½œåŸå­ï¼Œæ¯”è¾ƒå’Œäº¤æ¢ã€‚æ¯äº¤æ¢ä¸€æ¬¡ï¼Œæœ‰åºåº¦å°±åŠ  1ã€‚ä¸ç®¡ç®—æ³•æ€ä¹ˆæ”¹è¿›ï¼Œäº¤æ¢æ¬¡æ•°æ€»æ˜¯ç¡®å®šçš„ï¼Œå³ä¸ºé€†åºåº¦ï¼Œä¹Ÿå°±æ˜¯n(n-1)/2â€“åˆå§‹æœ‰åºåº¦ã€‚æ­¤ä¾‹ä¸­å°±æ˜¯ 15â€“3=12ï¼Œè¦è¿›è¡Œ 12 æ¬¡äº¤æ¢æ“ä½œã€‚å¯¹äºåŒ…å« n ä¸ªæ•°æ®çš„æ•°ç»„è¿›è¡Œå†’æ³¡æ’åºï¼Œå¹³å‡äº¤æ¢æ¬¡æ•°æ˜¯å¤šå°‘å‘¢ï¼Ÿæœ€åæƒ…å†µä¸‹ï¼Œåˆå§‹çŠ¶æ€çš„æœ‰åºåº¦æ˜¯ 0ï¼Œæ‰€ä»¥è¦è¿›è¡Œ n(n-1)/2 æ¬¡äº¤æ¢ã€‚æœ€å¥½æƒ…å†µä¸‹ï¼Œåˆå§‹çŠ¶æ€çš„æœ‰åºåº¦æ˜¯ n(n-1)/2ï¼Œå°±ä¸éœ€è¦è¿›è¡Œäº¤æ¢ã€‚æˆ‘ä»¬å¯ä»¥å–ä¸ªä¸­é—´å€¼ n(n-1)/4ï¼Œæ¥è¡¨ç¤ºåˆå§‹æœ‰åºåº¦æ—¢ä¸æ˜¯å¾ˆé«˜ä¹Ÿä¸æ˜¯å¾ˆä½çš„å¹³å‡æƒ…å†µã€‚æ¢å¥è¯è¯´ï¼Œå¹³å‡æƒ…å†µä¸‹ï¼Œéœ€è¦ n(n-1)/4 æ¬¡äº¤æ¢æ“ä½œï¼Œæ¯”è¾ƒæ“ä½œè‚¯å®šè¦æ¯”äº¤æ¢æ“ä½œå¤šï¼Œè€Œå¤æ‚åº¦çš„ä¸Šé™æ˜¯ O(n2)ï¼Œæ‰€ä»¥å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(n2)ã€‚è¿™ä¸ªå¹³å‡æ—¶é—´å¤æ‚åº¦æ¨å¯¼è¿‡ç¨‹å…¶å®å¹¶ä¸ä¸¥æ ¼ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™å¾ˆå®ç”¨ï¼Œæ¯•ç«Ÿæ¦‚ç‡è®ºçš„å®šé‡åˆ†æå¤ªå¤æ‚ï¼Œä¸å¤ªå¥½ç”¨ã€‚ç­‰æˆ‘ä»¬è®²åˆ°å¿«æ’çš„æ—¶å€™ï¼Œæˆ‘è¿˜ä¼šå†æ¬¡ç”¨è¿™ç§â€œä¸ä¸¥æ ¼â€çš„æ–¹æ³•æ¥åˆ†æå¹³å‡æ—¶é—´å¤æ‚åº¦ã€‚","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"æ’åº","slug":"æ’åº","permalink":"cpeixin.cn/tags/%E6%8E%92%E5%BA%8F/"}]},{"title":"æ•°æ®ç»“æ„-é“¾è¡¨åè½¬","slug":"æ•°æ®ç»“æ„-é“¾è¡¨åè½¬","date":"2016-08-18T14:16:51.000Z","updated":"2020-04-04T17:34:24.764Z","comments":true,"path":"2016/08/18/æ•°æ®ç»“æ„-é“¾è¡¨åè½¬/","link":"","permalink":"cpeixin.cn/2016/08/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E9%93%BE%E8%A1%A8%E5%8F%8D%E8%BD%AC/","excerpt":"","text":"é¢˜ç›®ï¼šè¾“å…¥: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULLè¾“å‡º: 5-&gt;4-&gt;3-&gt;2-&gt;1-&gt;NULLè¿™é“é¢˜ç›®å¯ä»¥ç”¨è¿­ä»£ï¼Œé€’å½’ä¸¤ç§æ–¹æ³•æ¥å®ç°è¿­ä»£å‡è®¾å­˜åœ¨é“¾è¡¨ 1 â†’ 2 â†’ 3 â†’ 4 â†’ 5 â†’ Ã˜ï¼Œæˆ‘ä»¬æƒ³è¦æŠŠå®ƒæ”¹æˆ Ã˜ â† 1 â† 2 â† 3 â† 4 â† 5ã€‚åœ¨éå†åˆ—è¡¨æ—¶ï¼Œå°†å½“å‰èŠ‚ç‚¹çš„ next æŒ‡é’ˆæ”¹ä¸ºæŒ‡å‘å‰ä¸€ä¸ªå…ƒç´ ã€‚ç”±äºèŠ‚ç‚¹æ²¡æœ‰å¼•ç”¨å…¶ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤å¿…é¡»äº‹å…ˆå­˜å‚¨å…¶å‰ä¸€ä¸ªå…ƒç´ ã€‚åœ¨æ›´æ”¹å¼•ç”¨ä¹‹å‰ï¼Œè¿˜éœ€è¦å¦ä¸€ä¸ªæŒ‡é’ˆæ¥å­˜å‚¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚ä¸è¦å¿˜è®°åœ¨æœ€åè¿”å›æ–°çš„å¤´å¼•ç”¨ï¼æ ¹æ®é¢˜ç›®æ€»ç»“ä¸€ä¸‹æ ¸å¿ƒçš„æ“ä½œé€»è¾‘ï¼šä»å¤´èŠ‚ç‚¹ 1 å¼€å§‹ï¼Œ1 æŒ‡å‘ 2ï¼Œæ›´æ”¹æŒ‡å‘é¡ºåºï¼Œéœ€è¦å°† 2 çš„æŒ‡é’ˆæŒ‡å‘ 1 (æ­¤æ—¶ï¼Œè™½ç„¶ 2 çš„æŒ‡é’ˆæ–¹å‘å·²ç»æŒ‡å‘ 1ï¼Œä½†æ˜¯ 1 çš„æŒ‡é’ˆæ–¹å‘æ²¡æœ‰æ”¹å˜ï¼Œä¾ç„¶æŒ‡å‘ 2ï¼Œåˆ™æ˜¯ 2 â†’ 1 â†’ 2 â†’ 1â€¦.. ), åŒæ—¶ä¹Ÿè¦å­˜å‚¨ 2 çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ 3ï¼Œä»¥ä¾¿æ¥ä¸‹æ¥è¿­ä»£æ“ä½œ 2 å’Œ 3 èŠ‚ç‚¹ä¹‹é—´çš„æŒ‡é’ˆåè½¬ï¼Œæ¯ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹è¿›è¡Œç›¸åŒçš„æ“ä½œã€‚è¿­ä»£æœ€åï¼Œå°¾èŠ‚ç‚¹ 5 æ— åç»­èŠ‚ç‚¹ï¼Œåˆ™è·³å‡ºè¿­ä»£ã€‚åœ¨è¿­ä»£å®Œç›¸é‚»èŠ‚ç‚¹çš„æŒ‡é’ˆåè½¬åï¼Œè¿˜éœ€è¦åšçš„ä¸¤æ­¥åŸå¤´èŠ‚ç‚¹æŒ‡å‘ Noneï¼Œå˜æˆå°¾èŠ‚ç‚¹å°†åŸå°¾èŠ‚ç‚¹è®¾ç½®æˆæ–°çš„å¤´èŠ‚ç‚¹æ“ä½œå®Œæˆï½ï½ï¼ï¼12345678910111213141516171819202122232425262728293031323334def reversed_self(self): \"\"\"ç¿»è½¬é“¾è¡¨è‡ªèº«.\"\"\" if self.head is None or self.head.next_node is None: return pre = self.head node = self.head.next_node while node is not None: pre,node = self.__reversed_with_two_node(pre,node) \"\"\"å¾ªç¯åˆ°æœ€åä¸€ä½ node is Noneé€€å‡º\"\"\" \"\"\"å°†åŸé“¾è¡¨çš„å¤´èŠ‚ç‚¹æŒ‡å‘ä¸ºä¸‹ä¸€èŠ‚ç‚¹ æ”¹ä¸º æŒ‡å‘ä¸ºNone\"\"\" self.head.next_node = None \"\"\"å°†å¤´èŠ‚ç‚¹è®¾ç½®ä¸ºåŸé“¾è¡¨çš„å°¾èŠ‚ç‚¹,é“¾è¡¨åè½¬åˆ™æˆåŠŸã€‚é“¾è¡¨å…ƒç´ ä½ç½®ä¸å˜ï¼Œä½†æ˜¯å…ƒç´ ä¹‹é—´çš„æŒ‡å‘æ”¹å˜\"\"\" self.head = predef __reversed_with_two_node(self, pre, node): \"\"\"ç¿»è½¬ç›¸é‚»ä¸¤ä¸ªèŠ‚ç‚¹. å‚æ•°: pre:å‰ä¸€ä¸ªèŠ‚ç‚¹ node:å½“å‰èŠ‚ç‚¹ è¿”å›: *******(pre,node):ä¸‹ä¸€ä¸ªç›¸é‚»èŠ‚ç‚¹çš„å…ƒç»„ \"\"\" tmp = node.next_node node.next_node = pre pre = node node = tmp return pre, nodeè°ƒè¯•å›¾ï¼š123while node is not None: pre,node = self.__reversed_with_two_node(pre,node)æ ¸å¿ƒæ­¥éª¤è¿­ä»£å®Œï¼Œé“¾è¡¨ä¸­çš„èŠ‚ç‚¹æŒ‡å‘å·²ç»åè½¬ä¸Šå›¾ã€‚æ­¤æ—¶ï¼ŒèŠ‚ç‚¹ä¹‹é—´æŒ‡é’ˆåè½¬å®Œæ¯•ï¼Œè™½ç„¶æŒ‡é’ˆåè½¬äº†ï¼Œä½†æ˜¯å¤´èŠ‚ç‚¹è¿˜æ˜¯ 1 ï¼Œ å› ä¸º 1 æŒ‡å‘ä»ç„¶ä¸º 2 è¿˜æ²¡æœ‰å¤„ç†ã€‚å¹¶ä¸” 5 è¿˜ä¸æ˜¯å¤´èŠ‚ç‚¹ï¼Œå¯¹åº”çš„è¿˜æ²¡æœ‰æ‰§è¡Œ12self.head.next_node = Noneself.head = preæ“ä½œå®Œä¸‹é¢ä¸¤æ­¥åï¼Œä¸Šå›¾ä¸­ï¼Œ1 çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆå˜æˆNoneï¼Œ å¤´èŠ‚ç‚¹èµ‹å€¼ä¸º 512self.head.next_node = Noneself.head = pre","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"cpeixin.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"é“¾è¡¨","slug":"é“¾è¡¨","permalink":"cpeixin.cn/tags/%E9%93%BE%E8%A1%A8/"}]},{"title":"æ•°æ®ç»“æ„-å¦‚ä½•å†™å¥½é“¾è¡¨ä»£ç ","slug":"æ•°æ®ç»“æ„-å¦‚ä½•å†™å¥½é“¾è¡¨ä»£ç ","date":"2016-08-17T14:15:49.000Z","updated":"2020-04-04T11:59:24.090Z","comments":true,"path":"2016/08/17/æ•°æ®ç»“æ„-å¦‚ä½•å†™å¥½é“¾è¡¨ä»£ç /","link":"","permalink":"cpeixin.cn/2016/08/17/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%A6%82%E4%BD%95%E5%86%99%E5%A5%BD%E9%93%BE%E8%A1%A8%E4%BB%A3%E7%A0%81/","excerpt":"","text":"å¦‚ä½•å†™å¥½é“¾è¡¨ä»£ç ï¼Ÿç†è§£æŒ‡é’ˆæˆ–å¼•ç”¨çš„å«ä¹‰ä»€ä¹ˆæ˜¯æŒ‡é’ˆï¼ŸæŒ‡é’ˆæ˜¯ä¸€ä¸ªå˜é‡å°†æŸä¸ªå˜é‡èµ‹å€¼ç»™æŒ‡é’ˆï¼Œå®é™…ä¸Šå°±æ˜¯å°†è¿™ä¸ªå˜é‡çš„åœ°å€èµ‹å€¼ç»™æŒ‡é’ˆï¼Œæˆ–è€…åè¿‡æ¥è¯´ï¼ŒæŒ‡é’ˆä¸­å­˜å‚¨äº†è¿™ä¸ªå˜é‡çš„å†…å­˜åœ°å€ï¼ŒæŒ‡å‘äº†è¿™ä¸ªå˜é‡ï¼Œé€šè¿‡æŒ‡é’ˆå°±èƒ½æ‰¾åˆ°è¿™ä¸ªå˜é‡ã€‚è­¦æƒ•æŒ‡é’ˆä¸¢å¤±å’Œå†…å­˜æ³„æ¼åœ¨æ’å…¥å’Œåˆ é™¤ç»“ç‚¹æ—¶ï¼Œè¦æ³¨æ„å…ˆæŒæœ‰åé¢çš„ç»“ç‚¹å†æ“ä½œï¼Œå¦è€…ä¸€æ—¦åé¢ç»“ç‚¹çš„å‰ç»§æŒ‡é’ˆè¢«æ–­å¼€ï¼Œå°±æ— æ³•å†è®¿é—®ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚æ’å…¥ç»“ç‚¹æ—¶ï¼Œä¸€å®šè¦æ³¨æ„æ“ä½œçš„é¡ºåºåˆ é™¤é“¾è¡¨ç»“ç‚¹æ—¶ï¼Œä¹Ÿä¸€å®šè¦è®°å¾—æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ç©ºé—´åˆ©ç”¨å“¨å…µç®€åŒ–éš¾åº¦é“¾è¡¨çš„æ’å…¥ã€åˆ é™¤æ“ä½œï¼Œéœ€è¦å¯¹æ’å…¥ç¬¬ä¸€ä¸ªç»“ç‚¹å’Œåˆ é™¤æœ€åä¸€ä¸ªèŠ‚ç‚¹åšç‰¹æ®Šå¤„ç†ã€‚åˆ©ç”¨å“¨å…µå¯¹è±¡å¯ä»¥ä¸ç”¨è¾¹ç•Œåˆ¤æ–­ï¼Œé“¾è¡¨çš„å“¨å…µå¯¹è±¡æ˜¯åªå­˜æŒ‡é’ˆä¸å­˜æ•°æ®çš„å¤´ç»“ç‚¹ã€‚é‡ç‚¹ç•™æ„è¾¹ç•Œæ¡ä»¶å¤„ç†æ“ä½œé“¾è¡¨æ—¶è¦è€ƒè™‘å¦‚æœé“¾è¡¨ä¸ºç©ºæ—¶ï¼Œä»£ç æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œï¼Ÿå¦‚æœé“¾è¡¨åªåŒ…å«ä¸€ä¸ªç»“ç‚¹æ—¶ï¼Œä»£ç æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œï¼Ÿå¦‚æœé“¾è¡¨åªåŒ…å«ä¸¤ä¸ªç»“ç‚¹æ—¶ï¼Œä»£ç æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œï¼Ÿä»£ç é€»è¾‘åœ¨å¤„ç†å¤´ç»“ç‚¹å’Œå°¾ç»“ç‚¹çš„æ—¶å€™ï¼Œæ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œï¼Ÿå­¦ä¹ æ•°æ®ç»“æ„å’Œç®—æ³•ä¸»è¦æ˜¯æŒæ¡ä¸€ç³»åˆ—æ€æƒ³ï¼Œèƒ½åœ¨å…¶å®ƒçš„ç¼–ç ä¸­ä¹Ÿå…»æˆè€ƒè™‘è¾¹ç•Œçš„ä¹ æƒ¯ã€‚ä¸¾ä¾‹ç”»å›¾ï¼Œè¾…åŠ©æ€è€ƒå¯¹äºæ¯”è¾ƒå¤æ‚çš„æ“ä½œï¼Œå¯ä»¥ç”¨çº¸ç¬”ç”»ä¸€ç”»ï¼Œé‡Šæ”¾è„‘å®¹é‡æ¥åšé€»è¾‘å¤„ç†ï¼ˆæ—¶é—´æ¢ç©ºé—´æ€æƒ³ï¼‰ï¼Œä¹Ÿä¾¿äºå®Œæˆåçš„æ£€æŸ¥ã€‚å¤šå†™å¤šç»ƒï¼Œæ²¡æœ‰æ·å¾„å­°èƒ½ç”Ÿå·§ï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆç®—æ³•ï¼Œåªæœ‰ç»è¿‡åå¤çš„ç»ƒä¹ ï¼Œæ‰èƒ½ä¿¡æ‰‹æ‹ˆæ¥ã€‚å“¨å…µå¯¹è±¡æ€æƒ³ï¼Œåœ¨ iOS AutoreleasePool ä¸­æœ‰ç”¨åˆ°ï¼Œåœ¨ AutoreleasePoolPush æ—¶æ·»åŠ ä¸€ä¸ªå“¨å…µå¯¹è±¡ï¼ŒPop æ—¶å°†åˆ°å“¨å…µå¯¹è±¡ä¹‹é—´çš„æ‰€æœ‰ Autorelease å¯¹è±¡å‘é€ release æ¶ˆæ¯ã€‚","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"cpeixin.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"é“¾è¡¨","slug":"é“¾è¡¨","permalink":"cpeixin.cn/tags/%E9%93%BE%E8%A1%A8/"}]},{"title":"æ•°æ®ç»“æ„-å¦‚ä½•å®ç°LRUç¼“å­˜æ·˜æ±°ç®—æ³•","slug":"æ•°æ®ç»“æ„-å¦‚ä½•å®ç°LRUç¼“å­˜æ·˜æ±°ç®—æ³•","date":"2016-08-16T07:30:21.000Z","updated":"2020-04-04T11:59:17.945Z","comments":true,"path":"2016/08/16/æ•°æ®ç»“æ„-å¦‚ä½•å®ç°LRUç¼“å­˜æ·˜æ±°ç®—æ³•/","link":"","permalink":"cpeixin.cn/2016/08/16/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0LRU%E7%BC%93%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AE%97%E6%B3%95/","excerpt":"","text":"ä»Šå¤©æˆ‘ä»¬æ¥èŠèŠâ€œé“¾è¡¨ï¼ˆLinked listï¼‰â€è¿™ä¸ªæ•°æ®ç»“æ„ã€‚å­¦ä¹ é“¾è¡¨æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å…ˆæ¥è®¨è®ºä¸€ä¸ªç»å…¸çš„é“¾è¡¨åº”ç”¨åœºæ™¯ï¼Œé‚£å°±æ˜¯ LRU ç¼“å­˜æ·˜æ±°ç®—æ³•ã€‚ç¼“å­˜æ˜¯ä¸€ç§æé«˜æ•°æ®è¯»å–æ€§èƒ½çš„æŠ€æœ¯ï¼Œåœ¨ç¡¬ä»¶è®¾è®¡ã€è½¯ä»¶å¼€å‘ä¸­éƒ½æœ‰ç€éå¸¸å¹¿æ³›çš„åº”ç”¨ï¼Œæ¯”å¦‚å¸¸è§çš„ CPU ç¼“å­˜ã€æ•°æ®åº“ç¼“å­˜ã€æµè§ˆå™¨ç¼“å­˜ç­‰ç­‰ã€‚ç¼“å­˜çš„å¤§å°æœ‰é™ï¼Œå½“ç¼“å­˜è¢«ç”¨æ»¡æ—¶ï¼Œå“ªäº›æ•°æ®åº”è¯¥è¢«æ¸…ç†å‡ºå»ï¼Œå“ªäº›æ•°æ®åº”è¯¥è¢«ä¿ç•™ï¼Ÿè¿™å°±éœ€è¦ç¼“å­˜æ·˜æ±°ç­–ç•¥æ¥å†³å®šã€‚å¸¸è§çš„ç­–ç•¥æœ‰ä¸‰ç§ï¼šå…ˆè¿›å…ˆå‡ºç­–ç•¥ FIFOï¼ˆFirst Inï¼ŒFirst Outï¼‰æœ€å°‘ä½¿ç”¨ç­–ç•¥ LFUï¼ˆLeast Frequently Usedï¼‰æœ€è¿‘æœ€å°‘ä½¿ç”¨ç­–ç•¥ LRUï¼ˆLeast Recently Usedï¼‰è¿™äº›ç­–ç•¥ä½ ä¸ç”¨æ­»è®°ï¼Œæˆ‘æ‰“ä¸ªæ¯”æ–¹ä½ å¾ˆå®¹æ˜“å°±æ˜ç™½äº†ã€‚å‡å¦‚è¯´ï¼Œä½ ä¹°äº†å¾ˆå¤šæœ¬æŠ€æœ¯ä¹¦ï¼Œä½†æœ‰ä¸€å¤©ä½ å‘ç°ï¼Œè¿™äº›ä¹¦å¤ªå¤šäº†ï¼Œå¤ªå ä¹¦æˆ¿ç©ºé—´äº†ï¼Œä½ è¦åšä¸ªå¤§æ‰«é™¤ï¼Œæ‰”æ‰ä¸€äº›ä¹¦ç±ã€‚é‚£è¿™ä¸ªæ—¶å€™ï¼Œä½ ä¼šé€‰æ‹©æ‰”æ‰å“ªäº›ä¹¦å‘¢ï¼Ÿå¯¹åº”ä¸€ä¸‹ï¼Œä½ çš„é€‰æ‹©æ ‡å‡†æ˜¯ä¸æ˜¯å’Œä¸Šé¢çš„ä¸‰ç§ç­–ç•¥ç¥ä¼¼å‘¢ï¼Ÿå¥½äº†ï¼Œå›åˆ°æ­£é¢˜ï¼Œæˆ‘ä»¬ä»Šå¤©çš„å¼€ç¯‡é—®é¢˜å°±æ˜¯ï¼šå¦‚ä½•ç”¨é“¾è¡¨æ¥å®ç° LRU ç¼“å­˜æ·˜æ±°ç­–ç•¥å‘¢ï¼Ÿ å¸¦ç€è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼€å§‹ä»Šå¤©çš„å†…å®¹å§ï¼äº”èŠ±å…«é—¨çš„é“¾è¡¨ç»“æ„ç›¸æ¯”æ•°ç»„ï¼Œé“¾è¡¨æ˜¯ä¸€ç§ç¨å¾®å¤æ‚ä¸€ç‚¹çš„æ•°æ®ç»“æ„ã€‚å¯¹äºåˆå­¦è€…æ¥è¯´ï¼ŒæŒæ¡èµ·æ¥ä¹Ÿè¦æ¯”æ•°ç»„ç¨éš¾ä¸€äº›ã€‚è¿™ä¸¤ä¸ªéå¸¸åŸºç¡€ã€éå¸¸å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¸¸å¸¸å°†ä¼šæ”¾åˆ°ä¸€å—å„¿æ¥æ¯”è¾ƒã€‚æ‰€ä»¥æˆ‘ä»¬å…ˆæ¥çœ‹ï¼Œè¿™ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚æˆ‘ä»¬å…ˆä»åº•å±‚çš„å­˜å‚¨ç»“æ„ä¸Šæ¥çœ‹ä¸€çœ‹ã€‚ä¸ºäº†ç›´è§‚åœ°å¯¹æ¯”ï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾ã€‚ä»å›¾ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œæ•°ç»„éœ€è¦ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´æ¥å­˜å‚¨ï¼Œå¯¹å†…å­˜çš„è¦æ±‚æ¯”è¾ƒé«˜ã€‚å¦‚æœæˆ‘ä»¬ç”³è¯·ä¸€ä¸ª 100MB å¤§å°çš„æ•°ç»„ï¼Œå½“å†…å­˜ä¸­æ²¡æœ‰è¿ç»­çš„ã€è¶³å¤Ÿå¤§çš„å­˜å‚¨ç©ºé—´æ—¶ï¼Œå³ä¾¿å†…å­˜çš„å‰©ä½™æ€»å¯ç”¨ç©ºé—´å¤§äº 100MBï¼Œä»ç„¶ä¼šç”³è¯·å¤±è´¥ã€‚è€Œé“¾è¡¨æ°æ°ç›¸åï¼Œå®ƒå¹¶ä¸éœ€è¦ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå®ƒé€šè¿‡â€œæŒ‡é’ˆâ€å°†ä¸€ç»„é›¶æ•£çš„å†…å­˜å—ä¸²è”èµ·æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ç”³è¯·çš„æ˜¯ 100MB å¤§å°çš„é“¾è¡¨ï¼Œæ ¹æœ¬ä¸ä¼šæœ‰é—®é¢˜ã€‚é“¾è¡¨ç»“æ„äº”èŠ±å…«é—¨ï¼Œä»Šå¤©æˆ‘é‡ç‚¹ç»™ä½ ä»‹ç»ä¸‰ç§æœ€å¸¸è§çš„é“¾è¡¨ç»“æ„ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šå•é“¾è¡¨åŒå‘é“¾è¡¨å¾ªç¯é“¾è¡¨æˆ‘ä»¬é¦–å…ˆæ¥çœ‹æœ€ç®€å•ã€æœ€å¸¸ç”¨çš„å•é“¾è¡¨ã€‚æˆ‘ä»¬åˆšåˆšè®²åˆ°ï¼Œé“¾è¡¨é€šè¿‡æŒ‡é’ˆå°†ä¸€ç»„é›¶æ•£çš„å†…å­˜å—ä¸²è”åœ¨ä¸€èµ·ã€‚å…¶ä¸­ï¼Œæˆ‘ä»¬æŠŠå†…å­˜å—ç§°ä¸ºé“¾è¡¨çš„â€œç»“ç‚¹â€ã€‚ä¸ºäº†å°†æ‰€æœ‰çš„ç»“ç‚¹ä¸²èµ·æ¥ï¼Œæ¯ä¸ªé“¾è¡¨çš„ç»“ç‚¹é™¤äº†å­˜å‚¨æ•°æ®ä¹‹å¤–ï¼Œè¿˜éœ€è¦è®°å½•é“¾ä¸Šçš„ä¸‹ä¸€ä¸ªç»“ç‚¹çš„åœ°å€ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªè®°å½•ä¸‹ä¸ªç»“ç‚¹åœ°å€çš„æŒ‡é’ˆå«ä½œåç»§æŒ‡é’ˆ nextã€‚ä»æˆ‘ç”»çš„å•é“¾è¡¨å›¾ä¸­ï¼Œä½ åº”è¯¥å¯ä»¥å‘ç°ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªç»“ç‚¹æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ç¬¬ä¸€ä¸ªç»“ç‚¹å’Œæœ€åä¸€ä¸ªç»“ç‚¹ã€‚æˆ‘ä»¬ä¹ æƒ¯æ€§åœ°æŠŠç¬¬ä¸€ä¸ªç»“ç‚¹å«ä½œå¤´ç»“ç‚¹ï¼ŒæŠŠæœ€åä¸€ä¸ªç»“ç‚¹å«ä½œå°¾ç»“ç‚¹ã€‚å…¶ä¸­ï¼Œå¤´ç»“ç‚¹ç”¨æ¥è®°å½•é“¾è¡¨çš„åŸºåœ°å€ã€‚æœ‰äº†å®ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥éå†å¾—åˆ°æ•´æ¡é“¾è¡¨ã€‚è€Œå°¾ç»“ç‚¹ç‰¹æ®Šçš„åœ°æ–¹æ˜¯ï¼šæŒ‡é’ˆä¸æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œè€Œæ˜¯æŒ‡å‘ä¸€ä¸ªç©ºåœ°å€ NULLï¼Œè¡¨ç¤ºè¿™æ˜¯é“¾è¡¨ä¸Šæœ€åä¸€ä¸ªç»“ç‚¹ã€‚ä¸æ•°ç»„ä¸€æ ·ï¼Œé“¾è¡¨ä¹Ÿæ”¯æŒæ•°æ®çš„æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨è¿›è¡Œæ•°ç»„çš„æ’å…¥ã€åˆ é™¤æ“ä½œæ—¶ï¼Œä¸ºäº†ä¿æŒå†…å­˜æ•°æ®çš„è¿ç»­æ€§ï¼Œéœ€è¦åšå¤§é‡çš„æ•°æ®æ¬ç§»ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚è€Œåœ¨é“¾è¡¨ä¸­æ’å…¥æˆ–è€…åˆ é™¤ä¸€ä¸ªæ•°æ®ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ä¸ºäº†ä¿æŒå†…å­˜çš„è¿ç»­æ€§è€Œæ¬ç§»ç»“ç‚¹ï¼Œå› ä¸ºé“¾è¡¨çš„å­˜å‚¨ç©ºé—´æœ¬èº«å°±ä¸æ˜¯è¿ç»­çš„ã€‚æ‰€ä»¥ï¼Œåœ¨é“¾è¡¨ä¸­æ’å…¥å’Œåˆ é™¤ä¸€ä¸ªæ•°æ®æ˜¯éå¸¸å¿«é€Ÿçš„ã€‚ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾ï¼Œä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œé’ˆå¯¹é“¾è¡¨çš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘ç›¸é‚»ç»“ç‚¹çš„æŒ‡é’ˆæ”¹å˜ï¼Œæ‰€ä»¥å¯¹åº”çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ã€‚ä½†æ˜¯ï¼Œæœ‰åˆ©å°±æœ‰å¼Šã€‚é“¾è¡¨è¦æƒ³éšæœºè®¿é—®ç¬¬ k ä¸ªå…ƒç´ ï¼Œå°±æ²¡æœ‰æ•°ç»„é‚£ä¹ˆé«˜æ•ˆäº†ã€‚å› ä¸ºé“¾è¡¨ä¸­çš„æ•°æ®å¹¶éè¿ç»­å­˜å‚¨çš„ï¼Œæ‰€ä»¥æ— æ³•åƒæ•°ç»„é‚£æ ·ï¼Œæ ¹æ®é¦–åœ°å€å’Œä¸‹æ ‡ï¼Œé€šè¿‡å¯»å€å…¬å¼å°±èƒ½ç›´æ¥è®¡ç®—å‡ºå¯¹åº”çš„å†…å­˜åœ°å€ï¼Œè€Œæ˜¯éœ€è¦æ ¹æ®æŒ‡é’ˆä¸€ä¸ªç»“ç‚¹ä¸€ä¸ªç»“ç‚¹åœ°ä¾æ¬¡éå†ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸åº”çš„ç»“ç‚¹ã€‚ä½ å¯ä»¥æŠŠé“¾è¡¨æƒ³è±¡æˆä¸€ä¸ªé˜Ÿä¼ï¼Œé˜Ÿä¼ä¸­çš„æ¯ä¸ªäººéƒ½åªçŸ¥é“è‡ªå·±åé¢çš„äººæ˜¯è°ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬å¸Œæœ›çŸ¥é“æ’åœ¨ç¬¬ k ä½çš„äººæ˜¯è°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ä»ç¬¬ä¸€ä¸ªäººå¼€å§‹ï¼Œä¸€ä¸ªä¸€ä¸ªåœ°å¾€ä¸‹æ•°ã€‚æ‰€ä»¥ï¼Œé“¾è¡¨éšæœºè®¿é—®çš„æ€§èƒ½æ²¡æœ‰æ•°ç»„å¥½ï¼Œéœ€è¦ O(n) çš„æ—¶é—´å¤æ‚åº¦ã€‚å¥½äº†ï¼Œå•é“¾è¡¨æˆ‘ä»¬å°±ç®€å•ä»‹ç»å®Œäº†ï¼Œæ¥ç€æ¥çœ‹å¦å¤–ä¸¤ä¸ªå¤æ‚çš„å‡çº§ç‰ˆï¼Œå¾ªç¯é“¾è¡¨å’ŒåŒå‘é“¾è¡¨ã€‚å¾ªç¯é“¾è¡¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„å•é“¾è¡¨ã€‚å®é™…ä¸Šï¼Œå¾ªç¯é“¾è¡¨ä¹Ÿå¾ˆç®€å•ã€‚å®ƒè·Ÿå•é“¾è¡¨å”¯ä¸€çš„åŒºåˆ«å°±åœ¨å°¾ç»“ç‚¹ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå•é“¾è¡¨çš„å°¾ç»“ç‚¹æŒ‡é’ˆæŒ‡å‘ç©ºåœ°å€ï¼Œè¡¨ç¤ºè¿™å°±æ˜¯æœ€åçš„ç»“ç‚¹äº†ã€‚è€Œå¾ªç¯é“¾è¡¨çš„å°¾ç»“ç‚¹æŒ‡é’ˆæ˜¯æŒ‡å‘é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚ä»æˆ‘ç”»çš„å¾ªç¯é“¾è¡¨å›¾ä¸­ï¼Œä½ åº”è¯¥å¯ä»¥çœ‹å‡ºæ¥ï¼Œå®ƒåƒä¸€ä¸ªç¯ä¸€æ ·é¦–å°¾ç›¸è¿ï¼Œæ‰€ä»¥å«ä½œâ€œå¾ªç¯â€é“¾è¡¨ã€‚å’Œå•é“¾è¡¨ç›¸æ¯”ï¼Œå¾ªç¯é“¾è¡¨çš„ä¼˜ç‚¹æ˜¯ä»é“¾å°¾åˆ°é“¾å¤´æ¯”è¾ƒæ–¹ä¾¿ã€‚å½“è¦å¤„ç†çš„æ•°æ®å…·æœ‰ç¯å‹ç»“æ„ç‰¹ç‚¹æ—¶ï¼Œå°±ç‰¹åˆ«é€‚åˆé‡‡ç”¨å¾ªç¯é“¾è¡¨ã€‚æ¯”å¦‚è‘—åçš„çº¦ç‘Ÿå¤«é—®é¢˜ã€‚å°½ç®¡ç”¨å•é“¾è¡¨ä¹Ÿå¯ä»¥å®ç°ï¼Œä½†æ˜¯ç”¨å¾ªç¯é“¾è¡¨å®ç°çš„è¯ï¼Œä»£ç å°±ä¼šç®€æ´å¾ˆå¤šã€‚å•é“¾è¡¨å’Œå¾ªç¯é“¾è¡¨æ˜¯ä¸æ˜¯éƒ½ä¸éš¾ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚çš„ï¼Œåœ¨å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œä¹Ÿæ›´åŠ å¸¸ç”¨çš„é“¾è¡¨ç»“æ„ï¼šåŒå‘é“¾è¡¨ã€‚å•å‘é“¾è¡¨åªæœ‰ä¸€ä¸ªæ–¹å‘ï¼Œç»“ç‚¹åªæœ‰ä¸€ä¸ªåç»§æŒ‡é’ˆ next æŒ‡å‘åé¢çš„ç»“ç‚¹ã€‚è€ŒåŒå‘é“¾è¡¨ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒæ”¯æŒä¸¤ä¸ªæ–¹å‘ï¼Œæ¯ä¸ªç»“ç‚¹ä¸æ­¢æœ‰ä¸€ä¸ªåç»§æŒ‡é’ˆ next æŒ‡å‘åé¢çš„ç»“ç‚¹ï¼Œè¿˜æœ‰ä¸€ä¸ªå‰é©±æŒ‡é’ˆ prev æŒ‡å‘å‰é¢çš„ç»“ç‚¹ã€‚ä»æˆ‘ç”»çš„å›¾ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼ŒåŒå‘é“¾è¡¨éœ€è¦é¢å¤–çš„ä¸¤ä¸ªç©ºé—´æ¥å­˜å‚¨åç»§ç»“ç‚¹å’Œå‰é©±ç»“ç‚¹çš„åœ°å€ã€‚æ‰€ä»¥ï¼Œå¦‚æœå­˜å‚¨åŒæ ·å¤šçš„æ•°æ®ï¼ŒåŒå‘é“¾è¡¨è¦æ¯”å•é“¾è¡¨å ç”¨æ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚è™½ç„¶ä¸¤ä¸ªæŒ‡é’ˆæ¯”è¾ƒæµªè´¹å­˜å‚¨ç©ºé—´ï¼Œä½†å¯ä»¥æ”¯æŒåŒå‘éå†ï¼Œè¿™æ ·ä¹Ÿå¸¦æ¥äº†åŒå‘é“¾è¡¨æ“ä½œçš„çµæ´»æ€§ã€‚é‚£ç›¸æ¯”å•é“¾è¡¨ï¼ŒåŒå‘é“¾è¡¨é€‚åˆè§£å†³å“ªç§é—®é¢˜å‘¢ï¼Ÿä»ç»“æ„ä¸Šæ¥çœ‹ï¼ŒåŒå‘é“¾è¡¨å¯ä»¥æ”¯æŒ O(1) æ—¶é—´å¤æ‚åº¦çš„æƒ…å†µä¸‹æ‰¾åˆ°å‰é©±ç»“ç‚¹ï¼Œæ­£æ˜¯è¿™æ ·çš„ç‰¹ç‚¹ï¼Œä¹Ÿä½¿åŒå‘é“¾è¡¨åœ¨æŸäº›æƒ…å†µä¸‹çš„æ’å…¥ã€åˆ é™¤ç­‰æ“ä½œéƒ½è¦æ¯”å•é“¾è¡¨ç®€å•ã€é«˜æ•ˆã€‚ä½ å¯èƒ½ä¼šè¯´ï¼Œæˆ‘åˆšè®²åˆ°å•é“¾è¡¨çš„æ’å…¥ã€åˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å·²ç»æ˜¯ O(1) äº†ï¼ŒåŒå‘é“¾è¡¨è¿˜èƒ½å†æ€ä¹ˆé«˜æ•ˆå‘¢ï¼Ÿåˆ«ç€æ€¥ï¼Œåˆšåˆšçš„åˆ†ææ¯”è¾ƒåç†è®ºï¼Œå¾ˆå¤šæ•°æ®ç»“æ„å’Œç®—æ³•ä¹¦ç±ä¸­éƒ½ä¼šè¿™ä¹ˆè®²ï¼Œä½†æ˜¯è¿™ç§è¯´æ³•å®é™…ä¸Šæ˜¯ä¸å‡†ç¡®çš„ï¼Œæˆ–è€…è¯´æ˜¯æœ‰å…ˆå†³æ¡ä»¶çš„ã€‚æˆ‘å†æ¥å¸¦ä½ åˆ†æä¸€ä¸‹é“¾è¡¨çš„ä¸¤ä¸ªæ“ä½œã€‚æˆ‘ä»¬å…ˆæ¥çœ‹åˆ é™¤æ“ä½œã€‚åœ¨å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œä»é“¾è¡¨ä¸­åˆ é™¤ä¸€ä¸ªæ•°æ®æ— å¤–ä¹è¿™ä¸¤ç§æƒ…å†µï¼šåˆ é™¤ç»“ç‚¹ä¸­â€œå€¼ç­‰äºæŸä¸ªç»™å®šå€¼â€çš„ç»“ç‚¹ï¼›åˆ é™¤ç»™å®šæŒ‡é’ˆæŒ‡å‘çš„ç»“ç‚¹ã€‚å¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œä¸ç®¡æ˜¯å•é“¾è¡¨è¿˜æ˜¯åŒå‘é“¾è¡¨ï¼Œä¸ºäº†æŸ¥æ‰¾åˆ°å€¼ç­‰äºç»™å®šå€¼çš„ç»“ç‚¹ï¼Œéƒ½éœ€è¦ä»å¤´ç»“ç‚¹å¼€å§‹ä¸€ä¸ªä¸€ä¸ªä¾æ¬¡éå†å¯¹æ¯”ï¼Œç›´åˆ°æ‰¾åˆ°å€¼ç­‰äºç»™å®šå€¼çš„ç»“ç‚¹ï¼Œç„¶åå†é€šè¿‡æˆ‘å‰é¢è®²çš„æŒ‡é’ˆæ“ä½œå°†å…¶åˆ é™¤ã€‚å°½ç®¡å•çº¯çš„åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œä½†éå†æŸ¥æ‰¾çš„æ—¶é—´æ˜¯ä¸»è¦çš„è€—æ—¶ç‚¹ï¼Œå¯¹åº”çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚æ ¹æ®æ—¶é—´å¤æ‚åº¦åˆ†æä¸­çš„åŠ æ³•æ³•åˆ™ï¼Œåˆ é™¤å€¼ç­‰äºç»™å®šå€¼çš„ç»“ç‚¹å¯¹åº”çš„é“¾è¡¨æ“ä½œçš„æ€»æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚å¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œæˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†è¦åˆ é™¤çš„ç»“ç‚¹ï¼Œä½†æ˜¯åˆ é™¤æŸä¸ªç»“ç‚¹ q éœ€è¦çŸ¥é“å…¶å‰é©±ç»“ç‚¹ï¼Œè€Œå•é“¾è¡¨å¹¶ä¸æ”¯æŒç›´æ¥è·å–å‰é©±ç»“ç‚¹ï¼Œæ‰€ä»¥ï¼Œä¸ºäº†æ‰¾åˆ°å‰é©±ç»“ç‚¹ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦ä»å¤´ç»“ç‚¹å¼€å§‹éå†é“¾è¡¨ï¼Œç›´åˆ° p-&gt;next=qï¼Œè¯´æ˜ p æ˜¯ q çš„å‰é©±ç»“ç‚¹ã€‚ä½†æ˜¯å¯¹äºåŒå‘é“¾è¡¨æ¥è¯´ï¼Œè¿™ç§æƒ…å†µå°±æ¯”è¾ƒæœ‰ä¼˜åŠ¿äº†ã€‚å› ä¸ºåŒå‘é“¾è¡¨ä¸­çš„ç»“ç‚¹å·²ç»ä¿å­˜äº†å‰é©±ç»“ç‚¹çš„æŒ‡é’ˆï¼Œä¸éœ€è¦åƒå•é“¾è¡¨é‚£æ ·éå†ã€‚æ‰€ä»¥ï¼Œé’ˆå¯¹ç¬¬äºŒç§æƒ…å†µï¼Œå•é“¾è¡¨åˆ é™¤æ“ä½œéœ€è¦ O(n) çš„æ—¶é—´å¤æ‚åº¦ï¼Œè€ŒåŒå‘é“¾è¡¨åªéœ€è¦åœ¨ O(1) çš„æ—¶é—´å¤æ‚åº¦å†…å°±æå®šäº†ï¼åŒç†ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨é“¾è¡¨çš„æŸä¸ªæŒ‡å®šç»“ç‚¹å‰é¢æ’å…¥ä¸€ä¸ªç»“ç‚¹ï¼ŒåŒå‘é“¾è¡¨æ¯”å•é“¾è¡¨æœ‰å¾ˆå¤§çš„ä¼˜åŠ¿ã€‚åŒå‘é“¾è¡¨å¯ä»¥åœ¨ O(1) æ—¶é—´å¤æ‚åº¦æå®šï¼Œè€Œå•å‘é“¾è¡¨éœ€è¦ O(n) çš„æ—¶é—´å¤æ‚åº¦ã€‚ä½ å¯ä»¥å‚ç…§æˆ‘åˆšåˆšè®²è¿‡çš„åˆ é™¤æ“ä½œè‡ªå·±åˆ†æä¸€ä¸‹ã€‚é™¤äº†æ’å…¥ã€åˆ é™¤æ“ä½œæœ‰ä¼˜åŠ¿ä¹‹å¤–ï¼Œå¯¹äºä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼ŒåŒå‘é“¾è¡¨çš„æŒ‰å€¼æŸ¥è¯¢çš„æ•ˆç‡ä¹Ÿè¦æ¯”å•é“¾è¡¨é«˜ä¸€äº›ã€‚å› ä¸ºï¼Œæˆ‘ä»¬å¯ä»¥è®°å½•ä¸Šæ¬¡æŸ¥æ‰¾çš„ä½ç½® pï¼Œæ¯æ¬¡æŸ¥è¯¢æ—¶ï¼Œæ ¹æ®è¦æŸ¥æ‰¾çš„å€¼ä¸ p çš„å¤§å°å…³ç³»ï¼Œå†³å®šæ˜¯å¾€å‰è¿˜æ˜¯å¾€åæŸ¥æ‰¾ï¼Œæ‰€ä»¥å¹³å‡åªéœ€è¦æŸ¥æ‰¾ä¸€åŠçš„æ•°æ®ã€‚ç°åœ¨ï¼Œä½ æœ‰æ²¡æœ‰è§‰å¾—åŒå‘é“¾è¡¨è¦æ¯”å•é“¾è¡¨æ›´åŠ é«˜æ•ˆå‘¢ï¼Ÿè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼ŒåŒå‘é“¾è¡¨å°½ç®¡æ¯”è¾ƒè´¹å†…å­˜ï¼Œä½†è¿˜æ˜¯æ¯”å•é“¾è¡¨çš„åº”ç”¨æ›´åŠ å¹¿æ³›çš„åŸå› ã€‚å¦‚æœä½ ç†Ÿæ‚‰ Java è¯­è¨€ï¼Œä½ è‚¯å®šç”¨è¿‡ LinkedHashMap è¿™ä¸ªå®¹å™¨ã€‚å¦‚æœä½ æ·±å…¥ç ”ç©¶ LinkedHashMap çš„å®ç°åŸç†ï¼Œå°±ä¼šå‘ç°å…¶ä¸­å°±ç”¨åˆ°äº†åŒå‘é“¾è¡¨è¿™ç§æ•°æ®ç»“æ„ã€‚å®é™…ä¸Šï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ›´åŠ é‡è¦çš„çŸ¥è¯†ç‚¹éœ€è¦ä½ æŒæ¡ï¼Œé‚£å°±æ˜¯ç”¨ç©ºé—´æ¢æ—¶é—´çš„è®¾è®¡æ€æƒ³ã€‚**å½“å†…å­˜ç©ºé—´å……è¶³çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬æ›´åŠ è¿½æ±‚ä»£ç çš„æ‰§è¡Œé€Ÿåº¦ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€‰æ‹©ç©ºé—´å¤æ‚åº¦ç›¸å¯¹è¾ƒé«˜ã€ä½†æ—¶é—´å¤æ‚åº¦ç›¸å¯¹å¾ˆä½çš„ç®—æ³•æˆ–è€…æ•°æ®ç»“æ„ã€‚ç›¸åï¼Œå¦‚æœå†…å­˜æ¯”è¾ƒç´§ç¼ºï¼Œæ¯”å¦‚ä»£ç è·‘åœ¨æ‰‹æœºæˆ–è€…å•ç‰‡æœºä¸Šï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±è¦åè¿‡æ¥ç”¨æ—¶é—´æ¢ç©ºé—´çš„è®¾è®¡æ€è·¯ã€‚è¿˜æ˜¯å¼€ç¯‡ç¼“å­˜çš„ä¾‹å­ã€‚ç¼“å­˜å®é™…ä¸Šå°±æ˜¯åˆ©ç”¨äº†ç©ºé—´æ¢æ—¶é—´çš„è®¾è®¡æ€æƒ³ã€‚å¦‚æœæˆ‘ä»¬æŠŠæ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šï¼Œä¼šæ¯”è¾ƒèŠ‚çœå†…å­˜ï¼Œä½†æ¯æ¬¡æŸ¥æ‰¾æ•°æ®éƒ½è¦è¯¢é—®ä¸€æ¬¡ç¡¬ç›˜ï¼Œä¼šæ¯”è¾ƒæ…¢ã€‚ä½†å¦‚æœæˆ‘ä»¬é€šè¿‡ç¼“å­˜æŠ€æœ¯ï¼Œäº‹å…ˆå°†æ•°æ®åŠ è½½åœ¨å†…å­˜ä¸­ï¼Œè™½ç„¶ä¼šæ¯”è¾ƒè€—è´¹å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯æ¯æ¬¡æ•°æ®æŸ¥è¯¢çš„é€Ÿåº¦å°±å¤§å¤§æé«˜äº†ã€‚æ‰€ä»¥æˆ‘æ€»ç»“ä¸€ä¸‹ï¼Œå¯¹äºæ‰§è¡Œè¾ƒæ…¢çš„ç¨‹åºï¼Œå¯ä»¥é€šè¿‡æ¶ˆè€—æ›´å¤šçš„å†…å­˜ï¼ˆç©ºé—´æ¢æ—¶é—´ï¼‰æ¥è¿›è¡Œä¼˜åŒ–ï¼›è€Œæ¶ˆè€—è¿‡å¤šå†…å­˜çš„ç¨‹åºï¼Œå¯ä»¥é€šè¿‡æ¶ˆè€—æ›´å¤šçš„æ—¶é—´ï¼ˆæ—¶é—´æ¢ç©ºé—´ï¼‰æ¥é™ä½å†…å­˜çš„æ¶ˆè€—ã€‚ä½ è¿˜èƒ½æƒ³åˆ°å…¶ä»–æ—¶é—´æ¢ç©ºé—´æˆ–è€…ç©ºé—´æ¢æ—¶é—´çš„ä¾‹å­å—ï¼Ÿäº†è§£äº†å¾ªç¯é“¾è¡¨å’ŒåŒå‘é“¾è¡¨ï¼Œå¦‚æœæŠŠè¿™ä¸¤ç§é“¾è¡¨æ•´åˆåœ¨ä¸€èµ·å°±æ˜¯ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼šåŒå‘å¾ªç¯é“¾è¡¨ã€‚æˆ‘æƒ³ä¸ç”¨æˆ‘å¤šè®²ï¼Œä½ åº”è¯¥çŸ¥é“åŒå‘å¾ªç¯é“¾è¡¨é•¿ä»€ä¹ˆæ ·å­äº†å§ï¼Ÿä½ å¯ä»¥è‡ªå·±è¯•ç€åœ¨çº¸ä¸Šç”»ä¸€ç”»ã€‚é“¾è¡¨ VS æ•°ç»„æ€§èƒ½å¤§æ¯”æ‹¼é€šè¿‡å‰é¢å†…å®¹çš„å­¦ä¹ ï¼Œä½ åº”è¯¥å·²ç»çŸ¥é“ï¼Œæ•°ç»„å’Œé“¾è¡¨æ˜¯ä¸¤ç§æˆªç„¶ä¸åŒçš„å†…å­˜ç»„ç»‡æ–¹å¼ã€‚æ­£æ˜¯å› ä¸ºå†…å­˜å­˜å‚¨çš„åŒºåˆ«ï¼Œå®ƒä»¬æ’å…¥ã€åˆ é™¤ã€éšæœºè®¿é—®æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ­£å¥½ç›¸åã€‚ä¸è¿‡ï¼Œæ•°ç»„å’Œé“¾è¡¨çš„å¯¹æ¯”ï¼Œå¹¶ä¸èƒ½å±€é™äºæ—¶é—´å¤æ‚åº¦ã€‚è€Œä¸”ï¼Œåœ¨å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œä¸èƒ½ä»…ä»…åˆ©ç”¨å¤æ‚åº¦åˆ†æå°±å†³å®šä½¿ç”¨å“ªä¸ªæ•°æ®ç»“æ„æ¥å­˜å‚¨æ•°æ®ã€‚æ•°ç»„ç®€å•æ˜“ç”¨ï¼Œåœ¨å®ç°ä¸Šä½¿ç”¨çš„æ˜¯è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥å€ŸåŠ© CPU çš„ç¼“å­˜æœºåˆ¶ï¼Œé¢„è¯»æ•°ç»„ä¸­çš„æ•°æ®ï¼Œæ‰€ä»¥è®¿é—®æ•ˆç‡æ›´é«˜ã€‚è€Œé“¾è¡¨åœ¨å†…å­˜ä¸­å¹¶ä¸æ˜¯è¿ç»­å­˜å‚¨ï¼Œæ‰€ä»¥å¯¹ CPU ç¼“å­˜ä¸å‹å¥½ï¼Œæ²¡åŠæ³•æœ‰æ•ˆé¢„è¯»ã€‚æ•°ç»„çš„ç¼ºç‚¹æ˜¯å¤§å°å›ºå®šï¼Œä¸€ç»å£°æ˜å°±è¦å ç”¨æ•´å—è¿ç»­å†…å­˜ç©ºé—´ã€‚å¦‚æœå£°æ˜çš„æ•°ç»„è¿‡å¤§ï¼Œç³»ç»Ÿå¯èƒ½æ²¡æœ‰è¶³å¤Ÿçš„è¿ç»­å†…å­˜ç©ºé—´åˆ†é…ç»™å®ƒï¼Œå¯¼è‡´â€œå†…å­˜ä¸è¶³ï¼ˆout of memoryï¼‰â€ã€‚å¦‚æœå£°æ˜çš„æ•°ç»„è¿‡å°ï¼Œåˆ™å¯èƒ½å‡ºç°ä¸å¤Ÿç”¨çš„æƒ…å†µã€‚è¿™æ—¶åªèƒ½å†ç”³è¯·ä¸€ä¸ªæ›´å¤§çš„å†…å­˜ç©ºé—´ï¼ŒæŠŠåŸæ•°ç»„æ‹·è´è¿›å»ï¼Œéå¸¸è´¹æ—¶ã€‚é“¾è¡¨æœ¬èº«æ²¡æœ‰å¤§å°çš„é™åˆ¶ï¼Œå¤©ç„¶åœ°æ”¯æŒåŠ¨æ€æ‰©å®¹ï¼Œæˆ‘è§‰å¾—è¿™ä¹Ÿæ˜¯å®ƒä¸æ•°ç»„æœ€å¤§çš„åŒºåˆ«ã€‚ä½ å¯èƒ½ä¼šè¯´ï¼Œæˆ‘ä»¬ Java ä¸­çš„ ArrayList å®¹å™¨ï¼Œä¹Ÿå¯ä»¥æ”¯æŒåŠ¨æ€æ‰©å®¹å•Šï¼Ÿæˆ‘ä»¬ä¸Šä¸€èŠ‚è¯¾è®²è¿‡ï¼Œå½“æˆ‘ä»¬å¾€æ”¯æŒåŠ¨æ€æ‰©å®¹çš„æ•°ç»„ä¸­æ’å…¥ä¸€ä¸ªæ•°æ®æ—¶ï¼Œå¦‚æœæ•°ç»„ä¸­æ²¡æœ‰ç©ºé—²ç©ºé—´äº†ï¼Œå°±ä¼šç”³è¯·ä¸€ä¸ªæ›´å¤§çš„ç©ºé—´ï¼Œå°†æ•°æ®æ‹·è´è¿‡å»ï¼Œè€Œæ•°æ®æ‹·è´çš„æ“ä½œæ˜¯éå¸¸è€—æ—¶çš„ã€‚æˆ‘ä¸¾ä¸€ä¸ªç¨å¾®æç«¯çš„ä¾‹å­ã€‚å¦‚æœæˆ‘ä»¬ç”¨ ArrayList å­˜å‚¨äº†äº† 1GB å¤§å°çš„æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™å·²ç»æ²¡æœ‰ç©ºé—²ç©ºé—´äº†ï¼Œå½“æˆ‘ä»¬å†æ’å…¥æ•°æ®çš„æ—¶å€™ï¼ŒArrayList ä¼šç”³è¯·ä¸€ä¸ª 1.5GB å¤§å°çš„å­˜å‚¨ç©ºé—´ï¼Œå¹¶ä¸”æŠŠåŸæ¥é‚£ 1GB çš„æ•°æ®æ‹·è´åˆ°æ–°ç”³è¯·çš„ç©ºé—´ä¸Šã€‚å¬èµ·æ¥æ˜¯ä¸æ˜¯å°±å¾ˆè€—æ—¶ï¼Ÿé™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœä½ çš„ä»£ç å¯¹å†…å­˜çš„ä½¿ç”¨éå¸¸è‹›åˆ»ï¼Œé‚£æ•°ç»„å°±æ›´é€‚åˆä½ ã€‚å› ä¸ºé“¾è¡¨ä¸­çš„æ¯ä¸ªç»“ç‚¹éƒ½éœ€è¦æ¶ˆè€—é¢å¤–çš„å­˜å‚¨ç©ºé—´å»å­˜å‚¨ä¸€ä»½æŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹çš„æŒ‡é’ˆï¼Œæ‰€ä»¥å†…å­˜æ¶ˆè€—ä¼šç¿»å€ã€‚è€Œä¸”ï¼Œå¯¹é“¾è¡¨è¿›è¡Œé¢‘ç¹çš„æ’å…¥ã€åˆ é™¤æ“ä½œï¼Œè¿˜ä¼šå¯¼è‡´é¢‘ç¹çš„å†…å­˜ç”³è¯·å’Œé‡Šæ”¾ï¼Œå®¹æ˜“é€ æˆå†…å­˜ç¢ç‰‡ï¼Œå¦‚æœæ˜¯ Java è¯­è¨€ï¼Œå°±æœ‰å¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„ GCï¼ˆGarbage Collectionï¼Œåƒåœ¾å›æ”¶ï¼‰ã€‚æ‰€ä»¥ï¼Œåœ¨æˆ‘ä»¬å®é™…çš„å¼€å‘ä¸­ï¼Œé’ˆå¯¹ä¸åŒç±»å‹çš„é¡¹ç›®ï¼Œè¦æ ¹æ®å…·ä½“æƒ…å†µï¼Œæƒè¡¡ç©¶ç«Ÿæ˜¯é€‰æ‹©æ•°ç»„è¿˜æ˜¯é“¾è¡¨ã€‚è§£ç­”å¼€ç¯‡å¥½äº†ï¼Œå…³äºé“¾è¡¨çš„çŸ¥è¯†æˆ‘ä»¬å°±è®²å®Œäº†ã€‚æˆ‘ä»¬ç°åœ¨å›è¿‡å¤´æ¥çœ‹ä¸‹å¼€ç¯‡ç•™ç»™ä½ çš„æ€è€ƒé¢˜ã€‚å¦‚ä½•åŸºäºé“¾è¡¨å®ç° LRU ç¼“å­˜æ·˜æ±°ç®—æ³•ï¼Ÿæˆ‘çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼šæˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªæœ‰åºå•é“¾è¡¨ï¼Œè¶Šé è¿‘é“¾è¡¨å°¾éƒ¨çš„ç»“ç‚¹æ˜¯è¶Šæ—©ä¹‹å‰è®¿é—®çš„ã€‚å½“æœ‰ä¸€ä¸ªæ–°çš„æ•°æ®è¢«è®¿é—®æ—¶ï¼Œæˆ‘ä»¬ä»é“¾è¡¨å¤´å¼€å§‹é¡ºåºéå†é“¾è¡¨ã€‚å¦‚æœæ­¤æ•°æ®ä¹‹å‰å·²ç»è¢«ç¼“å­˜åœ¨é“¾è¡¨ä¸­äº†ï¼Œæˆ‘ä»¬éå†å¾—åˆ°è¿™ä¸ªæ•°æ®å¯¹åº”çš„ç»“ç‚¹ï¼Œå¹¶å°†å…¶ä»åŸæ¥çš„ä½ç½®åˆ é™¤ï¼Œç„¶åå†æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ã€‚å¦‚æœæ­¤æ•°æ®æ²¡æœ‰åœ¨ç¼“å­˜é“¾è¡¨ä¸­ï¼Œåˆå¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼šå¦‚æœæ­¤æ—¶ç¼“å­˜æœªæ»¡ï¼Œåˆ™å°†æ­¤ç»“ç‚¹ç›´æ¥æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ï¼›å¦‚æœæ­¤æ—¶ç¼“å­˜å·²æ»¡ï¼Œåˆ™é“¾è¡¨å°¾ç»“ç‚¹åˆ é™¤ï¼Œå°†æ–°çš„æ•°æ®ç»“ç‚¹æ’å…¥é“¾è¡¨çš„å¤´éƒ¨ã€‚è¿™æ ·æˆ‘ä»¬å°±ç”¨é“¾è¡¨å®ç°äº†ä¸€ä¸ª LRU ç¼“å­˜ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸‹ m ç¼“å­˜è®¿é—®çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ã€‚å› ä¸ºä¸ç®¡ç¼“å­˜æœ‰æ²¡æœ‰æ»¡ï¼Œæˆ‘ä»¬éƒ½éœ€è¦éå†ä¸€éé“¾è¡¨ï¼Œæ‰€ä»¥è¿™ç§åŸºäºé“¾è¡¨çš„å®ç°æ€è·¯ï¼Œç¼“å­˜è®¿é—®çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­ä¼˜åŒ–è¿™ä¸ªå®ç°æ€è·¯ï¼Œæ¯”å¦‚å¼•å…¥æ•£åˆ—è¡¨ï¼ˆHash tableï¼‰æ¥è®°å½•æ¯ä¸ªæ•°æ®çš„ä½ç½®ï¼Œå°†ç¼“å­˜è®¿é—®çš„æ—¶é—´å¤æ‚åº¦é™åˆ° O(1)ã€‚å› ä¸ºè¦æ¶‰åŠæˆ‘ä»¬è¿˜æ²¡æœ‰è®²åˆ°çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥è¿™ä¸ªä¼˜åŒ–æ–¹æ¡ˆï¼Œæˆ‘ç°åœ¨å°±ä¸è¯¦ç»†è¯´äº†ï¼Œç­‰è®²åˆ°æ•£åˆ—è¡¨çš„æ—¶å€™ï¼Œæˆ‘ä¼šå†æ‹¿å‡ºæ¥è®²ã€‚é™¤äº†åŸºäºé“¾è¡¨çš„å®ç°æ€è·¯ï¼Œå®é™…ä¸Šè¿˜å¯ä»¥ç”¨æ•°ç»„æ¥å®ç° LRU ç¼“å­˜æ·˜æ±°ç­–ç•¥ã€‚å¦‚ä½•åˆ©ç”¨æ•°ç»„å®ç° LRU ç¼“å­˜æ·˜æ±°ç­–ç•¥å‘¢ï¼Ÿæˆ‘æŠŠè¿™ä¸ªé—®é¢˜ç•™ç»™ä½ æ€è€ƒã€‚LRUæœ€åå›åˆ°å‰é¢˜ï¼Œæ¥å®ç°LRUç¼“å­˜æœºåˆ¶è®¾è®¡å’Œå®ç°ä¸€ä¸ª LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜æœºåˆ¶ã€‚å®ƒåº”è¯¥æ”¯æŒä»¥ä¸‹æ“ä½œï¼š è·å–æ•°æ® get å’Œ å†™å…¥æ•°æ® put ã€‚è·å–æ•°æ® get(key) - å¦‚æœå¯†é’¥ (key) å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è·å–å¯†é’¥çš„å€¼ï¼ˆæ€»æ˜¯æ­£æ•°ï¼‰ï¼Œå¦åˆ™è¿”å› -1ã€‚å†™å…¥æ•°æ® put(key, value) - å¦‚æœå¯†é’¥ä¸å­˜åœ¨ï¼Œåˆ™å†™å…¥å…¶æ•°æ®å€¼ã€‚å½“ç¼“å­˜å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå®ƒåº”è¯¥åœ¨å†™å…¥æ–°æ•°æ®ä¹‹å‰åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®å€¼ï¼Œä»è€Œä¸ºæ–°çš„æ•°æ®å€¼ç•™å‡ºç©ºé—´ã€‚O(1) æ—¶é—´å¤æ‚åº¦å†…å®Œæˆè¿™ä¸¤ç§æ“ä½œã€‚è®¾è®¡lruç®—æ³•çš„æ€è·¯å¦‚ä½•è¡¨ç¤ºæœ€è¿‘è®¿é—®çš„æ•°æ®å’Œæœ€æ—©è®¿é—®çš„æ•°æ®å¦‚ä½•æŸ¥æ‰¾æ˜¯å¦ç¼“å­˜äº†æ•°æ®æœ‰ç¼“å­˜ï¼Œå¦‚ä½•å¤„ç†æ•°æ®æ²¡æœ‰ç¼“å­˜ï¼Œå¦‚ä½•å¤„ç†ç¼“å­˜æœªæ»¡ç¼“å­˜å·²æ»¡å®ç°LRUæ•°æ®ç»“æ„é€‰å‹æœ‰åºå­—å…¸é¢˜ç›®è¦æ±‚å®ç° LRU ç¼“å­˜æœºåˆ¶ï¼Œéœ€è¦åœ¨ O(1)O(1) æ—¶é—´å†…å®Œæˆå¦‚ä¸‹æ“ä½œï¼šè·å–é”® / æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨è®¾ç½®é”®åˆ é™¤æœ€å…ˆæ’å…¥çš„é”®å‰ä¸¤ä¸ªæ“ä½œå¯ä»¥ç”¨æ ‡å‡†çš„å“ˆå¸Œè¡¨åœ¨ O(1)O(1) æ—¶é—´å†…å®Œæˆã€‚æœ‰ä¸€ç§å«åšæœ‰åºå­—å…¸çš„æ•°æ®ç»“æ„ï¼Œç»¼åˆäº†å“ˆå¸Œè¡¨å’Œé“¾è¡¨ï¼Œåœ¨ Python ä¸­ä¸º OrderedDictï¼Œåœ¨ Java ä¸­ä¸º LinkedHashMapã€‚å“ˆå¸Œè¡¨ + åŒå‘é“¾è¡¨è¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨å“ˆå¸Œè¡¨ï¼Œè¾…ä»¥åŒå‘é“¾è¡¨è®°å½•é”®å€¼å¯¹çš„ä¿¡æ¯ã€‚æ‰€ä»¥å¯ä»¥åœ¨ O(1) æ—¶é—´å†…å®Œæˆ put å’Œ get æ“ä½œï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ O(1) åˆ é™¤ç¬¬ä¸€ä¸ªæ·»åŠ çš„èŠ‚ç‚¹ã€‚ä½¿ç”¨åŒå‘é“¾è¡¨çš„ä¸€ä¸ªå¥½å¤„æ˜¯ä¸éœ€è¦é¢å¤–ä¿¡æ¯åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒåŒæ—¶å¯ä»¥åœ¨å¸¸æ•°æ—¶é—´å†…ä»å¤´éƒ¨æˆ–å°¾éƒ¨æ’å…¥åˆ é™¤èŠ‚ç‚¹ã€‚ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨åŒå‘é“¾è¡¨å®ç°ä¸­ï¼Œè¿™é‡Œä½¿ç”¨ä¸€ä¸ªä¼ªå¤´éƒ¨å’Œä¼ªå°¾éƒ¨æ ‡è®°ç•Œé™ï¼Œè¿™æ ·åœ¨æ›´æ–°çš„æ—¶å€™å°±ä¸éœ€è¦æ£€æŸ¥æ˜¯å¦æ˜¯ null èŠ‚ç‚¹ã€‚å®ç°ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125class DbListNode(object): def __init__(self, x, y): \"\"\" èŠ‚ç‚¹ä¸ºå“ˆå¸Œè¡¨+åŒå‘é“¾è¡¨ :param x: :param y: \"\"\" self.key = x self.value = y self.next = None self.prev = Noneclass LRUCache(object): def __init__(self, capacity): \"\"\" åˆå§‹åŒ–ä¸€ä¸ªç©ºåŒå‘é“¾è¡¨ :type capacity: int \"\"\" self.cap = capacity self.catche = &#123;&#125; self.top = DbListNode(None, -1) self.tail = DbListNode(None, -1) self.top.next = self.tail self.tail.prev = self.top def get(self, key): \"\"\" :type key: int :rtype: int \"\"\" \"\"\"åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨\"\"\" if key in self.catche.keys(): cur = self.catche[key] \"\"\"é¦–å…ˆè·³å‡ºåŸæ¥çš„ä½ç½®\"\"\" cur.prev.next = cur.next cur.next.prev = cur.prev \"\"\"top,tailä¸ºå“¨å…µèŠ‚ç‚¹\"\"\" top_node = self.top.next cur.next = top_node top_node.prev = cur self.top.next = cur cur.prev = self.top return cur.value return -1 def put(self, key, value): \"\"\" :type key: int :type value: int :rtype: None \"\"\" if key in self.catche.keys(): \"\"\"å¦‚æœæ’å…¥èŠ‚ç‚¹å­˜åœ¨ï¼Œåˆ™å°†æ’å…¥èŠ‚ç‚¹è°ƒæ¢ä¸ºä½ï¼Œæ’å…¥åˆ°å“¨å…µèŠ‚ç‚¹åçš„å¤´èŠ‚ç‚¹ã€‚æ­¤æ—¶ä¸å­˜åœ¨å¢åˆ èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¸ç”¨åˆ¤æ–­é“¾è¡¨é•¿åº¦\"\"\" cur = self.catche[key] \"\"\"é¦–å…ˆè·³å‡ºåŸæ¥çš„ä½ç½®\"\"\" cur.prev.next = cur.next cur.next.prev = cur.prev \"\"\"top,tailä¸ºå“¨å…µèŠ‚ç‚¹\"\"\" top_node = self.top.next cur.next = top_node top_node.prev = cur self.top.next = cur cur.prev = self.top else: # å¢åŠ æ–°ç»“ç‚¹è‡³é¦–éƒ¨ cur = DbListNode(key, value) self.catche[key] = cur # æœ€è¿‘ç”¨è¿‡çš„ç½®äºé“¾è¡¨é¦–éƒ¨ top_node = self.top.next self.top.next = cur cur.prev = self.top cur.next = top_node top_node.prev = cur \"\"\"åˆ¤æ–­é•¿åº¦åˆ é™¤å°¾èŠ‚ç‚¹\"\"\" if len(self.catche.keys()) &gt; self.cap: self.catche.pop(self.tail.prev.key) # å»æ‰åŸå°¾ç»“ç‚¹ self.tail.prev.prev.next = self.tail self.tail.prev = self.tail.prev.prev def __repr__(self): vals = [] p = self.top.next while p.next: vals.append(str(p.value)) p = p.next return '-&gt;'.join(vals)if __name__ == '__main__': cache = LRUCache(2) cache.put(1, 1) cache.put(2, 2) print(cache) cache.get(1) # è¿”å› 1 print(cache) cache.put(3, 3) # è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 2 ä½œåºŸ print(cache) cache.get(2) # è¿”å› -1 (æœªæ‰¾åˆ°) print(cache) cache.put(4, 4) # è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 1 ä½œåºŸ print(cache) cache.get(1) # è¿”å› -1 (æœªæ‰¾åˆ°) cache.get(3) # è¿”å› 3 print(cache) cache.get(4) # è¿”å› 4 print(cache)å†…å®¹å°ç»“ä»Šå¤©æˆ‘ä»¬è®²äº†ä¸€ç§è·Ÿæ•°ç»„â€œç›¸åâ€çš„æ•°æ®ç»“æ„ï¼Œé“¾è¡¨ã€‚å®ƒè·Ÿæ•°ç»„ä¸€æ ·ï¼Œä¹Ÿæ˜¯éå¸¸åŸºç¡€ã€éå¸¸å¸¸ç”¨çš„æ•°æ®ç»“æ„ã€‚ä¸è¿‡é“¾è¡¨è¦æ¯”æ•°ç»„ç¨å¾®å¤æ‚ï¼Œä»æ™®é€šçš„å•é“¾è¡¨è¡ç”Ÿå‡ºæ¥å¥½å‡ ç§é“¾è¡¨ç»“æ„ï¼Œæ¯”å¦‚åŒå‘é“¾è¡¨ã€å¾ªç¯é“¾è¡¨ã€åŒå‘å¾ªç¯é“¾è¡¨ã€‚å’Œæ•°ç»„ç›¸æ¯”ï¼Œé“¾è¡¨æ›´é€‚åˆæ’å…¥ã€åˆ é™¤æ“ä½œé¢‘ç¹çš„åœºæ™¯ï¼ŒæŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦è¾ƒé«˜ã€‚ä¸è¿‡ï¼Œåœ¨å…·ä½“è½¯ä»¶å¼€å‘ä¸­ï¼Œè¦å¯¹æ•°ç»„å’Œé“¾è¡¨çš„å„ç§æ€§èƒ½è¿›è¡Œå¯¹æ¯”ï¼Œç»¼åˆæ¥é€‰æ‹©ä½¿ç”¨ä¸¤è€…ä¸­çš„å“ªä¸€ä¸ªã€‚è¯¾åæ€è€ƒå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦æ˜¯å›æ–‡å­—ç¬¦ä¸²çš„é—®é¢˜ï¼Œæˆ‘æƒ³ä½ åº”è¯¥å¬è¿‡ï¼Œæˆ‘ä»¬ä»Šå¤©çš„é¢˜ç›®å°±æ˜¯åŸºäºè¿™ä¸ªé—®é¢˜çš„æ”¹é€ ç‰ˆæœ¬ã€‚å¦‚æœå­—ç¬¦ä¸²æ˜¯é€šè¿‡å•é“¾è¡¨æ¥å­˜å‚¨çš„ï¼Œé‚£è¯¥å¦‚ä½•æ¥åˆ¤æ–­æ˜¯ä¸€ä¸ªå›æ–‡ä¸²å‘¢ï¼Ÿä½ æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ€è·¯å‘¢ï¼Ÿç›¸åº”çš„æ—¶é—´ç©ºé—´å¤æ‚åº¦åˆæ˜¯å¤šå°‘å‘¢ï¼Ÿæ¬¢è¿ç•™è¨€å’Œæˆ‘åˆ†äº«ï¼Œæˆ‘ä¼šç¬¬ä¸€æ—¶é—´ç»™ä½ åé¦ˆã€‚Q&amp;Aå…³äºCPUç¼“å­˜æœºåˆ¶CPUåœ¨ä»å†…å­˜è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠè¯»å–åˆ°çš„æ•°æ®åŠ è½½åˆ°CPUçš„ç¼“å­˜ä¸­ã€‚è€ŒCPUæ¯æ¬¡ä»å†…å­˜è¯»å–æ•°æ®å¹¶ä¸æ˜¯åªè¯»å–é‚£ä¸ªç‰¹å®šè¦è®¿é—®çš„åœ°å€ï¼Œè€Œæ˜¯è¯»å–ä¸€ä¸ªæ•°æ®å—(è¿™ä¸ªå¤§å°æˆ‘ä¸å¤ªç¡®å®šã€‚ã€‚)å¹¶ä¿å­˜åˆ°CPUç¼“å­˜ä¸­ï¼Œç„¶åä¸‹æ¬¡è®¿é—®å†…å­˜æ•°æ®çš„æ—¶å€™å°±ä¼šå…ˆä»CPUç¼“å­˜å¼€å§‹æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°å°±ä¸éœ€è¦å†ä»å†…å­˜ä¸­å–ã€‚è¿™æ ·å°±å®ç°äº†æ¯”å†…å­˜è®¿é—®é€Ÿåº¦æ›´å¿«çš„æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯CPUç¼“å­˜å­˜åœ¨çš„æ„ä¹‰:ä¸ºäº†å¼¥è¡¥å†…å­˜è®¿é—®é€Ÿåº¦è¿‡æ…¢ä¸CPUæ‰§è¡Œé€Ÿåº¦å¿«ä¹‹é—´çš„å·®å¼‚è€Œå¼•å…¥ã€‚","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"LRUæ·˜æ±°ç®—æ³•","slug":"LRUæ·˜æ±°ç®—æ³•","permalink":"cpeixin.cn/tags/LRU%E6%B7%98%E6%B1%B0%E7%AE%97%E6%B3%95/"}]},{"title":"æ•°æ®ç»“æ„-æ ˆ","slug":"æ•°æ®ç»“æ„-æ ˆ","date":"2016-08-14T09:27:21.000Z","updated":"2020-06-10T10:16:45.266Z","comments":true,"path":"2016/08/14/æ•°æ®ç»“æ„-æ ˆ/","link":"","permalink":"cpeixin.cn/2016/08/14/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%88/","excerpt":"","text":"æµè§ˆå™¨çš„å‰è¿›ã€åé€€åŠŸèƒ½ï¼Œæˆ‘æƒ³ä½ è‚¯å®šå¾ˆç†Ÿæ‚‰å§ï¼Ÿå½“ä½ ä¾æ¬¡è®¿é—®å®Œä¸€ä¸²é¡µé¢ a-b-c ä¹‹åï¼Œç‚¹å‡»æµè§ˆå™¨çš„åé€€æŒ‰é’®ï¼Œå°±å¯ä»¥æŸ¥çœ‹ä¹‹å‰æµè§ˆè¿‡çš„é¡µé¢ b å’Œ aã€‚å½“ä½ åé€€åˆ°é¡µé¢ aï¼Œç‚¹å‡»å‰è¿›æŒ‰é’®ï¼Œå°±å¯ä»¥é‡æ–°æŸ¥çœ‹é¡µé¢ b å’Œ cã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åé€€åˆ°é¡µé¢ b åï¼Œç‚¹å‡»äº†æ–°çš„é¡µé¢ dï¼Œé‚£å°±æ— æ³•å†é€šè¿‡å‰è¿›ã€åé€€åŠŸèƒ½æŸ¥çœ‹é¡µé¢ c äº†ã€‚å‡è®¾ä½ æ˜¯ Chrome æµè§ˆå™¨çš„å¼€å‘å·¥ç¨‹å¸ˆï¼Œä½ ä¼šå¦‚ä½•å®ç°è¿™ä¸ªåŠŸèƒ½å‘¢ï¼Ÿè¿™å°±è¦ç”¨åˆ°æˆ‘ä»¬ä»Šå¤©è¦è®²çš„â€œæ ˆâ€è¿™ç§æ•°æ®ç»“æ„ã€‚å¸¦ç€è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ä»Šå¤©çš„å†…å®¹ã€‚å¦‚ä½•ç†è§£â€œæ ˆâ€ï¼Ÿå…³äºâ€œæ ˆâ€ï¼Œæˆ‘æœ‰ä¸€ä¸ªéå¸¸è´´åˆ‡çš„ä¾‹å­ï¼Œå°±æ˜¯ä¸€æ‘å åœ¨ä¸€èµ·çš„ç›˜å­ã€‚æˆ‘ä»¬å¹³æ—¶æ”¾ç›˜å­çš„æ—¶å€™ï¼Œéƒ½æ˜¯ä»ä¸‹å¾€ä¸Šä¸€ä¸ªä¸€ä¸ªæ”¾ï¼›å–çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯ä»ä¸Šå¾€ä¸‹ä¸€ä¸ªä¸€ä¸ªåœ°ä¾æ¬¡å–ï¼Œä¸èƒ½ä»ä¸­é—´ä»»æ„æŠ½å‡ºã€‚åè¿›è€…å…ˆå‡ºï¼Œå…ˆè¿›è€…åå‡ºï¼Œè¿™å°±æ˜¯å…¸å‹çš„â€œæ ˆâ€ç»“æ„ã€‚ä»æ ˆçš„æ“ä½œç‰¹æ€§ä¸Šæ¥çœ‹ï¼Œæ ˆæ˜¯ä¸€ç§â€œæ“ä½œå—é™â€çš„çº¿æ€§è¡¨ï¼Œåªå…è®¸åœ¨ä¸€ç«¯æ’å…¥å’Œåˆ é™¤æ•°æ®ã€‚æˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦è¿™ç§æ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œå°±å¯¹å®ƒå­˜åœ¨çš„æ„ä¹‰äº§ç”Ÿäº†å¾ˆå¤§çš„ç–‘æƒ‘ã€‚å› ä¸ºæˆ‘è§‰å¾—ï¼Œç›¸æ¯”æ•°ç»„å’Œé“¾è¡¨ï¼Œæ ˆå¸¦ç»™æˆ‘çš„åªæœ‰é™åˆ¶ï¼Œå¹¶æ²¡æœ‰ä»»ä½•ä¼˜åŠ¿ã€‚é‚£æˆ‘ç›´æ¥ä½¿ç”¨æ•°ç»„æˆ–è€…é“¾è¡¨ä¸å°±å¥½äº†å—ï¼Ÿä¸ºä»€ä¹ˆè¿˜è¦ç”¨è¿™ä¸ªâ€œæ“ä½œå—é™â€çš„â€œæ ˆâ€å‘¢ï¼Ÿäº‹å®ä¸Šï¼Œä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼Œæ•°ç»„æˆ–é“¾è¡¨ç¡®å®å¯ä»¥æ›¿ä»£æ ˆï¼Œä½†ä½ è¦çŸ¥é“ï¼Œç‰¹å®šçš„æ•°æ®ç»“æ„æ˜¯å¯¹ç‰¹å®šåœºæ™¯çš„æŠ½è±¡ï¼Œè€Œä¸”ï¼Œæ•°ç»„æˆ–é“¾è¡¨æš´éœ²äº†å¤ªå¤šçš„æ“ä½œæ¥å£ï¼Œæ“ä½œä¸Šçš„ç¡®çµæ´»è‡ªç”±ï¼Œä½†ä½¿ç”¨æ—¶å°±æ¯”è¾ƒä¸å¯æ§ï¼Œè‡ªç„¶ä¹Ÿå°±æ›´å®¹æ˜“å‡ºé”™ã€‚å½“æŸä¸ªæ•°æ®é›†åˆåªæ¶‰åŠåœ¨ä¸€ç«¯æ’å…¥å’Œåˆ é™¤æ•°æ®ï¼Œå¹¶ä¸”æ»¡è¶³åè¿›å…ˆå‡ºã€å…ˆè¿›åå‡ºçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å°±åº”è¯¥é¦–é€‰â€œæ ˆâ€è¿™ç§æ•°æ®ç»“æ„ã€‚å¦‚ä½•å®ç°ä¸€ä¸ªâ€œæ ˆâ€ï¼Ÿä»åˆšæ‰æ ˆçš„å®šä¹‰é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ ˆä¸»è¦åŒ…å«ä¸¤ä¸ªæ“ä½œï¼Œå…¥æ ˆå’Œå‡ºæ ˆï¼Œä¹Ÿå°±æ˜¯åœ¨æ ˆé¡¶æ’å…¥ä¸€ä¸ªæ•°æ®å’Œä»æ ˆé¡¶åˆ é™¤ä¸€ä¸ªæ•°æ®ã€‚ç†è§£äº†æ ˆçš„å®šä¹‰ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€çœ‹å¦‚ä½•ç”¨ä»£ç å®ç°ä¸€ä¸ªæ ˆã€‚å®é™…ä¸Šï¼Œæ ˆæ—¢å¯ä»¥ç”¨æ•°ç»„æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨é“¾è¡¨æ¥å®ç°ã€‚ç”¨æ•°ç»„å®ç°çš„æ ˆï¼Œæˆ‘ä»¬å«ä½œé¡ºåºæ ˆï¼Œç”¨é“¾è¡¨å®ç°çš„æ ˆï¼Œæˆ‘ä»¬å«ä½œé“¾å¼æ ˆã€‚æˆ‘è¿™é‡Œå®ç°ä¸€ä¸ªåŸºäºæ•°ç»„çš„é¡ºåºæ ˆã€‚åŸºäºæ•°ç»„12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849class stack: def __init__(self, size): \"\"\" æ ˆç»“æ„ :param size: æ ˆå¤§å° \"\"\" self.count = 0 self.size = size self.array = [] def push(self, value): \"\"\" å…¥æ ˆ å…¥æ ˆåˆ¤æ»¡ :param value: \"\"\" if self.count == self.size: return False self.array.append(value) self.count += 1 return True def pop(self): \"\"\" å‡ºæ ˆ å‡ºæ ˆåˆ¤ç©º :return: \"\"\" if self.count == 0: return False data = self.array[self.count - 1] self.count -= 1 return dataif __name__ == '__main__': st = stack(4) st.push(1) st.push(2) st.push(3) st.push(4) st.pop() st.pop() st.pop() data = st.pop() print(data) st.pop()åŸºäºé“¾è¡¨å®ç°çš„é“¾å¼æ ˆçš„ä»£ç åŸºäºé“¾è¡¨12345678910111213141516171819202122232425262728293031323334353637383940414243from typing import Optionalclass Node: def __init__(self, data: int, next=None): self.data = data self.next = nextclass linkstack: def __init__(self): self.top: Node = None def push(self, value: int): new_node = Node(value) new_node.next = self.top self.top = new_node def pop(self)-&gt;Optional[int]: if self.top: data = self.top.data self.top = self.top.next return data def __repr__(self) -&gt; str: current = self._top nums = [] while current: nums.append(current._data) current = current._next return \" \".join(f\"&#123;num&#125;]\" for num in nums)if __name__ == \"__main__\": stack = linkstack() for i in range(9): stack.push(i) print(stack) for _ in range(3): stack.pop() print(stack)äº†è§£äº†å®šä¹‰å’ŒåŸºæœ¬æ“ä½œï¼Œé‚£å®ƒçš„æ“ä½œçš„æ—¶é—´ã€ç©ºé—´å¤æ‚åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿä¸ç®¡æ˜¯é¡ºåºæ ˆè¿˜æ˜¯é“¾å¼æ ˆï¼Œæˆ‘ä»¬å­˜å‚¨æ•°æ®åªéœ€è¦ä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„å°±å¤Ÿäº†ã€‚åœ¨å…¥æ ˆå’Œå‡ºæ ˆè¿‡ç¨‹ä¸­ï¼Œåªéœ€è¦ä¸€ä¸¤ä¸ªä¸´æ—¶å˜é‡å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦æ˜¯ O(1)ã€‚æ³¨æ„ï¼Œè¿™é‡Œå­˜å‚¨æ•°æ®éœ€è¦ä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ï¼Œå¹¶ä¸æ˜¯è¯´ç©ºé—´å¤æ‚åº¦å°±æ˜¯ O(n)ã€‚å› ä¸ºï¼Œè¿™ n ä¸ªç©ºé—´æ˜¯å¿…é¡»çš„ï¼Œæ— æ³•çœæ‰ã€‚æ‰€ä»¥æˆ‘ä»¬è¯´ç©ºé—´å¤æ‚åº¦çš„æ—¶å€™ï¼Œæ˜¯æŒ‡é™¤äº†åŸæœ¬çš„æ•°æ®å­˜å‚¨ç©ºé—´å¤–ï¼Œç®—æ³•è¿è¡Œè¿˜éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ã€‚ç©ºé—´å¤æ‚åº¦åˆ†ææ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿæ—¶é—´å¤æ‚åº¦ä¹Ÿä¸éš¾ã€‚ä¸ç®¡æ˜¯é¡ºåºæ ˆè¿˜æ˜¯é“¾å¼æ ˆï¼Œå…¥æ ˆã€å‡ºæ ˆåªæ¶‰åŠæ ˆé¡¶ä¸ªåˆ«æ•°æ®çš„æ“ä½œï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(1)ã€‚æ”¯æŒåŠ¨æ€æ‰©å®¹çš„é¡ºåºæ ˆåˆšæ‰é‚£ä¸ªåŸºäºæ•°ç»„å®ç°çš„æ ˆï¼Œæ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„æ ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åˆå§‹åŒ–æ ˆæ—¶éœ€è¦äº‹å…ˆæŒ‡å®šæ ˆçš„å¤§å°ã€‚å½“æ ˆæ»¡ä¹‹åï¼Œå°±æ— æ³•å†å¾€æ ˆé‡Œæ·»åŠ æ•°æ®äº†ã€‚å°½ç®¡é“¾å¼æ ˆçš„å¤§å°ä¸å—é™ï¼Œä½†è¦å­˜å‚¨ next æŒ‡é’ˆï¼Œå†…å­˜æ¶ˆè€—ç›¸å¯¹è¾ƒå¤šã€‚é‚£æˆ‘ä»¬å¦‚ä½•åŸºäºæ•°ç»„å®ç°ä¸€ä¸ªå¯ä»¥æ”¯æŒåŠ¨æ€æ‰©å®¹çš„æ ˆå‘¢ï¼Ÿä½ è¿˜è®°å¾—ï¼Œæˆ‘ä»¬åœ¨æ•°ç»„é‚£ä¸€èŠ‚ï¼Œæ˜¯å¦‚ä½•æ¥å®ç°ä¸€ä¸ªæ”¯æŒåŠ¨æ€æ‰©å®¹çš„æ•°ç»„çš„å—ï¼Ÿå½“æ•°ç»„ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œæˆ‘ä»¬å°±é‡æ–°ç”³è¯·ä¸€å—æ›´å¤§çš„å†…å­˜ï¼Œå°†åŸæ¥æ•°ç»„ä¸­æ•°æ®ç»Ÿç»Ÿæ‹·è´è¿‡å»ã€‚è¿™æ ·å°±å®ç°äº†ä¸€ä¸ªæ”¯æŒåŠ¨æ€æ‰©å®¹çš„æ•°ç»„ã€‚æ‰€ä»¥ï¼Œå¦‚æœè¦å®ç°ä¸€ä¸ªæ”¯æŒåŠ¨æ€æ‰©å®¹çš„æ ˆï¼Œæˆ‘ä»¬åªéœ€è¦åº•å±‚ä¾èµ–ä¸€ä¸ªæ”¯æŒåŠ¨æ€æ‰©å®¹çš„æ•°ç»„å°±å¯ä»¥äº†ã€‚å½“æ ˆæ»¡äº†ä¹‹åï¼Œæˆ‘ä»¬å°±ç”³è¯·ä¸€ä¸ªæ›´å¤§çš„æ•°ç»„ï¼Œå°†åŸæ¥çš„æ•°æ®æ¬ç§»åˆ°æ–°æ•°ç»„ä¸­ã€‚æˆ‘ç”»äº†ä¸€å¼ å›¾ï¼Œä½ å¯ä»¥å¯¹ç…§ç€ç†è§£ä¸€ä¸‹ã€‚å®é™…ä¸Šï¼Œæ”¯æŒåŠ¨æ€æ‰©å®¹çš„é¡ºåºæ ˆï¼Œæˆ‘ä»¬å¹³æ—¶å¼€å‘ä¸­å¹¶ä¸å¸¸ç”¨åˆ°ã€‚æˆ‘è®²è¿™ä¸€å—çš„ç›®çš„ï¼Œä¸»è¦è¿˜æ˜¯å¸Œæœ›å¸¦ä½ ç»ƒä¹ ä¸€ä¸‹å‰é¢è®²çš„å¤æ‚åº¦åˆ†ææ–¹æ³•ã€‚æ‰€ä»¥è¿™ä¸€å°èŠ‚çš„é‡ç‚¹æ˜¯å¤æ‚åº¦åˆ†æã€‚ä½ ä¸ç”¨æ­»è®°ç¡¬èƒŒå…¥æ ˆã€å‡ºæ ˆçš„æ—¶é—´å¤æ‚åº¦ï¼Œä½ éœ€è¦æŒæ¡çš„æ˜¯åˆ†ææ–¹æ³•ã€‚èƒ½å¤Ÿè‡ªå·±åˆ†ææ‰ç®—æ˜¯çœŸæ­£æŒæ¡äº†ã€‚ç°åœ¨æˆ‘å°±å¸¦ä½ åˆ†æä¸€ä¸‹æ”¯æŒåŠ¨æ€æ‰©å®¹çš„é¡ºåºæ ˆçš„å…¥æ ˆã€å‡ºæ ˆæ“ä½œçš„æ—¶é—´å¤æ‚åº¦ã€‚å¯¹äºå‡ºæ ˆæ“ä½œæ¥è¯´ï¼Œæˆ‘ä»¬ä¸ä¼šæ¶‰åŠå†…å­˜çš„é‡æ–°ç”³è¯·å’Œæ•°æ®çš„æ¬ç§»ï¼Œæ‰€ä»¥å‡ºæ ˆçš„æ—¶é—´å¤æ‚åº¦ä»ç„¶æ˜¯ O(1)ã€‚ä½†æ˜¯ï¼Œå¯¹äºå…¥æ ˆæ“ä½œæ¥è¯´ï¼Œæƒ…å†µå°±ä¸ä¸€æ ·äº†ã€‚å½“æ ˆä¸­æœ‰ç©ºé—²ç©ºé—´æ—¶ï¼Œå…¥æ ˆæ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚ä½†å½“ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œå°±éœ€è¦é‡æ–°ç”³è¯·å†…å­˜å’Œæ•°æ®æ¬ç§»ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦å°±å˜æˆäº† O(n)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºå…¥æ ˆæ“ä½œæ¥è¯´ï¼Œæœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œæœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚é‚£å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦åˆæ˜¯å¤šå°‘å‘¢ï¼Ÿè¿˜è®°å¾—æˆ‘ä»¬åœ¨å¤æ‚åº¦åˆ†æé‚£ä¸€èŠ‚ä¸­è®²çš„æ‘Šè¿˜åˆ†ææ³•å—ï¼Ÿè¿™ä¸ªå…¥æ ˆæ“ä½œçš„å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦å¯ä»¥ç”¨æ‘Šè¿˜åˆ†ææ³•æ¥åˆ†æã€‚æˆ‘ä»¬ä¹Ÿæ­£å¥½å€Ÿæ­¤æ¥å®æˆ˜ä¸€ä¸‹æ‘Šè¿˜åˆ†ææ³•ã€‚ä¸ºäº†åˆ†æçš„æ–¹ä¾¿ï¼Œæˆ‘ä»¬éœ€è¦äº‹å…ˆåšä¸€äº›å‡è®¾å’Œå®šä¹‰ï¼šæ ˆç©ºé—´ä¸å¤Ÿæ—¶ï¼Œæˆ‘ä»¬é‡æ–°ç”³è¯·ä¸€ä¸ªæ˜¯åŸæ¥å¤§å°ä¸¤å€çš„æ•°ç»„ï¼›ä¸ºäº†ç®€åŒ–åˆ†æï¼Œå‡è®¾åªæœ‰å…¥æ ˆæ“ä½œæ²¡æœ‰å‡ºæ ˆæ“ä½œï¼›å®šä¹‰ä¸æ¶‰åŠå†…å­˜æ¬ç§»çš„å…¥æ ˆæ“ä½œä¸º simple-push æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚å¦‚æœå½“å‰æ ˆå¤§å°ä¸º Kï¼Œå¹¶ä¸”å·²æ»¡ï¼Œå½“å†æœ‰æ–°çš„æ•°æ®è¦å…¥æ ˆæ—¶ï¼Œå°±éœ€è¦é‡æ–°ç”³è¯· 2 å€å¤§å°çš„å†…å­˜ï¼Œå¹¶ä¸”åš K ä¸ªæ•°æ®çš„æ¬ç§»æ“ä½œï¼Œç„¶åå†å…¥æ ˆã€‚ä½†æ˜¯ï¼Œæ¥ä¸‹æ¥çš„ K-1 æ¬¡å…¥æ ˆæ“ä½œï¼Œæˆ‘ä»¬éƒ½ä¸éœ€è¦å†é‡æ–°ç”³è¯·å†…å­˜å’Œæ¬ç§»æ•°æ®ï¼Œæ‰€ä»¥è¿™ K-1 æ¬¡å…¥æ ˆæ“ä½œéƒ½åªéœ€è¦ä¸€ä¸ª simple-push æ“ä½œå°±å¯ä»¥å®Œæˆã€‚ä¸ºäº†è®©ä½ æ›´åŠ ç›´è§‚åœ°ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾ã€‚ä½ åº”è¯¥å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ K æ¬¡å…¥æ ˆæ“ä½œï¼Œæ€»å…±æ¶‰åŠäº† K ä¸ªæ•°æ®çš„æ¬ç§»ï¼Œä»¥åŠ K æ¬¡ simple-push æ“ä½œã€‚å°† K ä¸ªæ•°æ®æ¬ç§»å‡æ‘Šåˆ° K æ¬¡å…¥æ ˆæ“ä½œï¼Œé‚£æ¯ä¸ªå…¥æ ˆæ“ä½œåªéœ€è¦ä¸€ä¸ªæ•°æ®æ¬ç§»å’Œä¸€ä¸ª simple-push æ“ä½œã€‚ä»¥æ­¤ç±»æ¨ï¼Œå…¥æ ˆæ“ä½œçš„å‡æ‘Šæ—¶é—´å¤æ‚åº¦å°±ä¸º O(1)ã€‚é€šè¿‡è¿™ä¸ªä¾‹å­çš„å®æˆ˜åˆ†æï¼Œä¹Ÿå°è¯äº†å‰é¢è®²åˆ°çš„ï¼Œå‡æ‘Šæ—¶é—´å¤æ‚åº¦ä¸€èˆ¬éƒ½ç­‰äºæœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ã€‚å› ä¸ºåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå…¥æ ˆæ“ä½œçš„æ—¶é—´å¤æ‚åº¦ O éƒ½æ˜¯ O(1)ï¼Œåªæœ‰åœ¨ä¸ªåˆ«æ—¶åˆ»æ‰ä¼šé€€åŒ–ä¸º O(n)ï¼Œæ‰€ä»¥æŠŠè€—æ—¶å¤šçš„å…¥æ ˆæ“ä½œçš„æ—¶é—´å‡æ‘Šåˆ°å…¶ä»–å…¥æ ˆæ“ä½œä¸Šï¼Œå¹³å‡æƒ…å†µä¸‹çš„è€—æ—¶å°±æ¥è¿‘ O(1)ã€‚æ ˆåœ¨å‡½æ•°è°ƒç”¨ä¸­çš„åº”ç”¨å‰é¢æˆ‘è®²çš„éƒ½æ¯”è¾ƒåç†è®ºï¼Œæˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸‹ï¼Œæ ˆåœ¨è½¯ä»¶å·¥ç¨‹ä¸­çš„å®é™…åº”ç”¨ã€‚æ ˆä½œä¸ºä¸€ä¸ªæ¯”è¾ƒåŸºç¡€çš„æ•°æ®ç»“æ„ï¼Œåº”ç”¨åœºæ™¯è¿˜æ˜¯è›®å¤šçš„ã€‚å…¶ä¸­ï¼Œæ¯”è¾ƒç»å…¸çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯å°±æ˜¯å‡½æ•°è°ƒç”¨æ ˆã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæ“ä½œç³»ç»Ÿç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…äº†ä¸€å—ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œè¿™å—å†…å­˜è¢«ç»„ç»‡æˆâ€œæ ˆâ€è¿™ç§ç»“æ„, ç”¨æ¥å­˜å‚¨å‡½æ•°è°ƒç”¨æ—¶çš„ä¸´æ—¶å˜é‡ã€‚æ¯è¿›å…¥ä¸€ä¸ªå‡½æ•°ï¼Œå°±ä¼šå°†ä¸´æ—¶å˜é‡ä½œä¸ºä¸€ä¸ªæ ˆå¸§å…¥æ ˆï¼Œå½“è¢«è°ƒç”¨å‡½æ•°æ‰§è¡Œå®Œæˆï¼Œè¿”å›ä¹‹åï¼Œå°†è¿™ä¸ªå‡½æ•°å¯¹åº”çš„æ ˆå¸§å‡ºæ ˆã€‚ä¸ºäº†è®©ä½ æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ä»¬ä¸€å—æ¥çœ‹ä¸‹è¿™æ®µä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ã€‚123456789101112131415int main() &#123; int a = 1; int ret = 0; int res = 0; ret = add(3, 5); res = a + ret; printf(\"%d\", res); reuturn 0;&#125;int add(int x, int y) &#123; int sum = 0; sum = x + y; return sum;&#125;ä»ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œmain() å‡½æ•°è°ƒç”¨äº† add() å‡½æ•°ï¼Œè·å–è®¡ç®—ç»“æœï¼Œå¹¶ä¸”ä¸ä¸´æ—¶å˜é‡ a ç›¸åŠ ï¼Œæœ€åæ‰“å° res çš„å€¼ã€‚ä¸ºäº†è®©ä½ æ¸…æ™°åœ°çœ‹åˆ°è¿™ä¸ªè¿‡ç¨‹å¯¹åº”çš„å‡½æ•°æ ˆé‡Œå‡ºæ ˆã€å…¥æ ˆçš„æ“ä½œï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾ã€‚å›¾ä¸­æ˜¾ç¤ºçš„æ˜¯ï¼Œåœ¨æ‰§è¡Œåˆ° add() å‡½æ•°æ—¶ï¼Œå‡½æ•°è°ƒç”¨æ ˆçš„æƒ…å†µã€‚æ ˆåœ¨è¡¨è¾¾å¼æ±‚å€¼ä¸­çš„åº”ç”¨æˆ‘ä»¬å†æ¥çœ‹æ ˆçš„å¦ä¸€ä¸ªå¸¸è§çš„åº”ç”¨åœºæ™¯ï¼Œç¼–è¯‘å™¨å¦‚ä½•åˆ©ç”¨æ ˆæ¥å®ç°è¡¨è¾¾å¼æ±‚å€¼ã€‚ä¸ºäº†æ–¹ä¾¿è§£é‡Šï¼Œæˆ‘å°†ç®—æœ¯è¡¨è¾¾å¼ç®€åŒ–ä¸ºåªåŒ…å«åŠ å‡ä¹˜é™¤å››åˆ™è¿ç®—ï¼Œæ¯”å¦‚ï¼š34+139+44-12/3ã€‚å¯¹äºè¿™ä¸ªå››åˆ™è¿ç®—ï¼Œæˆ‘ä»¬äººè„‘å¯ä»¥å¾ˆå¿«æ±‚è§£å‡ºç­”æ¡ˆï¼Œä½†æ˜¯å¯¹äºè®¡ç®—æœºæ¥è¯´ï¼Œç†è§£è¿™ä¸ªè¡¨è¾¾å¼æœ¬èº«å°±æ˜¯ä¸ªæŒºéš¾çš„äº‹å„¿ã€‚å¦‚æœæ¢ä½œä½ ï¼Œè®©ä½ æ¥å®ç°è¿™æ ·ä¸€ä¸ªè¡¨è¾¾å¼æ±‚å€¼çš„åŠŸèƒ½ï¼Œä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿå®é™…ä¸Šï¼Œç¼–è¯‘å™¨å°±æ˜¯é€šè¿‡ä¸¤ä¸ªæ ˆæ¥å®ç°çš„ã€‚å…¶ä¸­ä¸€ä¸ªä¿å­˜æ“ä½œæ•°çš„æ ˆï¼Œå¦ä¸€ä¸ªæ˜¯ä¿å­˜è¿ç®—ç¬¦çš„æ ˆã€‚æˆ‘ä»¬ä»å·¦å‘å³éå†è¡¨è¾¾å¼å½“é‡åˆ°æ•°å­—ï¼Œæˆ‘ä»¬å°±ç›´æ¥å‹å…¥æ“ä½œæ•°æ ˆï¼›å½“é‡åˆ°è¿ç®—ç¬¦ï¼Œå°±ä¸è¿ç®—ç¬¦æ ˆçš„æ ˆé¡¶å…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ¯”è¿ç®—ç¬¦æ ˆé¡¶å…ƒç´ çš„ä¼˜å…ˆçº§é«˜ï¼Œå°±å°†å½“å‰è¿ç®—ç¬¦å‹å…¥æ ˆï¼›å¦‚æœæ¯”è¿ç®—ç¬¦æ ˆé¡¶å…ƒç´ çš„ä¼˜å…ˆçº§ä½æˆ–è€…ç›¸åŒï¼Œä»è¿ç®—ç¬¦æ ˆä¸­å–æ ˆé¡¶è¿ç®—ç¬¦ï¼Œä»æ“ä½œæ•°æ ˆçš„æ ˆé¡¶å– 2 ä¸ªæ“ä½œæ•°ï¼Œç„¶åè¿›è¡Œè®¡ç®—ï¼Œå†æŠŠè®¡ç®—å®Œçš„ç»“æœå‹å…¥æ“ä½œæ•°æ ˆï¼Œç»§ç»­æ¯”è¾ƒã€‚æˆ‘å°† 3+58-6 è¿™ä¸ªè¡¨è¾¾å¼çš„è®¡ç®—è¿‡ç¨‹ç”»æˆäº†ä¸€å¼ å›¾ï¼Œä½ å¯ä»¥ç»“åˆå›¾æ¥ç†è§£æˆ‘åˆšè®²çš„è®¡ç®—è¿‡ç¨‹ã€‚è¿™æ ·ç”¨ä¸¤ä¸ªæ ˆæ¥è§£å†³çš„æ€è·¯æ˜¯ä¸æ˜¯éå¸¸å·§å¦™ï¼Ÿä½ æœ‰æ²¡æœ‰æƒ³åˆ°å‘¢ï¼Ÿæ ˆåœ¨æ‹¬å·åŒ¹é…ä¸­çš„åº”ç”¨é™¤äº†ç”¨æ ˆæ¥å®ç°è¡¨è¾¾å¼æ±‚å€¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å€ŸåŠ©æ ˆæ¥æ£€æŸ¥è¡¨è¾¾å¼ä¸­çš„æ‹¬å·æ˜¯å¦åŒ¹é…ã€‚æˆ‘ä»¬åŒæ ·ç®€åŒ–ä¸€ä¸‹èƒŒæ™¯ã€‚æˆ‘ä»¬å‡è®¾è¡¨è¾¾å¼ä¸­åªåŒ…å«ä¸‰ç§æ‹¬å·ï¼Œåœ†æ‹¬å· ()ã€æ–¹æ‹¬å·[]å’ŒèŠ±æ‹¬å·{}ï¼Œå¹¶ä¸”å®ƒä»¬å¯ä»¥ä»»æ„åµŒå¥—ã€‚æ¯”å¦‚ï¼Œ{[] ()[{}]}æˆ–[{()}([])]ç­‰éƒ½ä¸ºåˆæ³•æ ¼å¼ï¼Œè€Œ{[}()]æˆ–[({)]ä¸ºä¸åˆæ³•çš„æ ¼å¼ã€‚é‚£æˆ‘ç°åœ¨ç»™ä½ ä¸€ä¸ªåŒ…å«ä¸‰ç§æ‹¬å·çš„è¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œå¦‚ä½•æ£€æŸ¥å®ƒæ˜¯å¦åˆæ³•å‘¢ï¼Ÿè¿™é‡Œä¹Ÿå¯ä»¥ç”¨æ ˆæ¥è§£å†³ã€‚æˆ‘ä»¬ç”¨æ ˆæ¥ä¿å­˜æœªåŒ¹é…çš„å·¦æ‹¬å·ï¼Œä»å·¦åˆ°å³ä¾æ¬¡æ‰«æå­—ç¬¦ä¸²ã€‚å½“æ‰«æåˆ°å·¦æ‹¬å·æ—¶ï¼Œåˆ™å°†å…¶å‹å…¥æ ˆä¸­ï¼›å½“æ‰«æåˆ°å³æ‹¬å·æ—¶ï¼Œä»æ ˆé¡¶å–å‡ºä¸€ä¸ªå·¦æ‹¬å·ã€‚å¦‚æœèƒ½å¤ŸåŒ¹é…ï¼Œæ¯”å¦‚â€œ(â€è·Ÿâ€œ)â€åŒ¹é…ï¼Œâ€œ[â€è·Ÿâ€œ]â€åŒ¹é…ï¼Œâ€œ{â€è·Ÿâ€œ}â€åŒ¹é…ï¼Œåˆ™ç»§ç»­æ‰«æå‰©ä¸‹çš„å­—ç¬¦ä¸²ã€‚å¦‚æœæ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ä¸èƒ½é…å¯¹çš„å³æ‹¬å·ï¼Œæˆ–è€…æ ˆä¸­æ²¡æœ‰æ•°æ®ï¼Œåˆ™è¯´æ˜ä¸ºéæ³•æ ¼å¼ã€‚å½“æ‰€æœ‰çš„æ‹¬å·éƒ½æ‰«æå®Œæˆä¹‹åï¼Œå¦‚æœæ ˆä¸ºç©ºï¼Œåˆ™è¯´æ˜å­—ç¬¦ä¸²ä¸ºåˆæ³•æ ¼å¼ï¼›å¦åˆ™ï¼Œè¯´æ˜æœ‰æœªåŒ¹é…çš„å·¦æ‹¬å·ï¼Œä¸ºéæ³•æ ¼å¼ã€‚è§£ç­”å¼€ç¯‡å¥½äº†ï¼Œæˆ‘æƒ³ç°åœ¨ä½ å·²ç»å®Œå…¨ç†è§£äº†æ ˆçš„æ¦‚å¿µã€‚æˆ‘ä»¬å†å›æ¥çœ‹çœ‹å¼€ç¯‡çš„æ€è€ƒé¢˜ï¼Œå¦‚ä½•å®ç°æµè§ˆå™¨çš„å‰è¿›ã€åé€€åŠŸèƒ½ï¼Ÿå…¶å®ï¼Œç”¨ä¸¤ä¸ªæ ˆå°±å¯ä»¥éå¸¸å®Œç¾åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªæ ˆï¼ŒX å’Œ Yï¼Œæˆ‘ä»¬æŠŠé¦–æ¬¡æµè§ˆçš„é¡µé¢ä¾æ¬¡å‹å…¥æ ˆ Xï¼Œå½“ç‚¹å‡»åé€€æŒ‰é’®æ—¶ï¼Œå†ä¾æ¬¡ä»æ ˆ X ä¸­å‡ºæ ˆï¼Œå¹¶å°†å‡ºæ ˆçš„æ•°æ®ä¾æ¬¡æ”¾å…¥æ ˆ Yã€‚å½“æˆ‘ä»¬ç‚¹å‡»å‰è¿›æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬ä¾æ¬¡ä»æ ˆ Y ä¸­å–å‡ºæ•°æ®ï¼Œæ”¾å…¥æ ˆ X ä¸­ã€‚å½“æ ˆ X ä¸­æ²¡æœ‰æ•°æ®æ—¶ï¼Œé‚£å°±è¯´æ˜æ²¡æœ‰é¡µé¢å¯ä»¥ç»§ç»­åé€€æµè§ˆäº†ã€‚å½“æ ˆ Y ä¸­æ²¡æœ‰æ•°æ®ï¼Œé‚£å°±è¯´æ˜æ²¡æœ‰é¡µé¢å¯ä»¥ç‚¹å‡»å‰è¿›æŒ‰é’®æµè§ˆäº†ã€‚æ¯”å¦‚ä½ é¡ºåºæŸ¥çœ‹äº† aï¼Œbï¼Œc ä¸‰ä¸ªé¡µé¢ï¼Œæˆ‘ä»¬å°±ä¾æ¬¡æŠŠ aï¼Œbï¼Œc å‹å…¥æ ˆï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¸¤ä¸ªæ ˆçš„æ•°æ®å°±æ˜¯å½“ä½ é€šè¿‡æµè§ˆå™¨çš„åé€€æŒ‰é’®ï¼Œä»é¡µé¢ c åé€€åˆ°é¡µé¢ a ä¹‹åï¼Œæˆ‘ä»¬å°±ä¾æ¬¡æŠŠ c å’Œ b ä»æ ˆ X ä¸­å¼¹å‡ºï¼Œå¹¶ä¸”ä¾æ¬¡æ”¾å…¥åˆ°æ ˆ Yã€‚è¿™ä¸ªæ—¶å€™ï¼Œä¸¤ä¸ªæ ˆçš„æ•°æ®å°±æ˜¯è¿™ä¸ªæ ·å­ï¼šè¿™ä¸ªæ—¶å€™ä½ åˆæƒ³çœ‹é¡µé¢ bï¼Œäºæ˜¯ä½ åˆç‚¹å‡»å‰è¿›æŒ‰é’®å›åˆ° b é¡µé¢ï¼Œæˆ‘ä»¬å°±æŠŠ b å†ä»æ ˆ Y ä¸­å‡ºæ ˆï¼Œæ”¾å…¥æ ˆ X ä¸­ã€‚æ­¤æ—¶ä¸¤ä¸ªæ ˆçš„æ•°æ®æ˜¯è¿™ä¸ªæ ·å­ï¼šè¿™ä¸ªæ—¶å€™ï¼Œä½ é€šè¿‡é¡µé¢ b åˆè·³è½¬åˆ°æ–°çš„é¡µé¢ d äº†ï¼Œé¡µé¢ c å°±æ— æ³•å†é€šè¿‡å‰è¿›ã€åé€€æŒ‰é’®é‡å¤æŸ¥çœ‹äº†ï¼Œæ‰€ä»¥éœ€è¦æ¸…ç©ºæ ˆ Yã€‚æ­¤æ—¶ä¸¤ä¸ªæ ˆçš„æ•°æ®è¿™ä¸ªæ ·å­ï¼šå†…å®¹å°ç»“æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ä»Šå¤©è®²çš„å†…å®¹ã€‚æ ˆæ˜¯ä¸€ç§æ“ä½œå—é™çš„æ•°æ®ç»“æ„ï¼Œåªæ”¯æŒå…¥æ ˆå’Œå‡ºæ ˆæ“ä½œã€‚åè¿›å…ˆå‡ºæ˜¯å®ƒæœ€å¤§çš„ç‰¹ç‚¹ã€‚æ ˆæ—¢å¯ä»¥é€šè¿‡æ•°ç»„å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é“¾è¡¨æ¥å®ç°ã€‚ä¸ç®¡åŸºäºæ•°ç»„è¿˜æ˜¯é“¾è¡¨ï¼Œå…¥æ ˆã€å‡ºæ ˆçš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸º O(1)ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è®²äº†ä¸€ç§æ”¯æŒåŠ¨æ€æ‰©å®¹çš„é¡ºåºæ ˆï¼Œä½ éœ€è¦é‡ç‚¹æŒæ¡å®ƒçš„å‡æ‘Šæ—¶é—´å¤æ‚åº¦åˆ†ææ–¹æ³•ã€‚è¯¾åæ€è€ƒä¸ºä»€ä¹ˆå‡½æ•°è°ƒç”¨è¦ç”¨â€œæ ˆâ€æ¥ä¿å­˜ä¸´æ—¶å˜é‡å‘¢ï¼Ÿç”¨å…¶ä»–æ•°æ®ç»“æ„ä¸è¡Œå—ï¼Ÿå…¶å®ï¼Œæˆ‘ä»¬ä¸ä¸€å®šéè¦ç”¨æ ˆæ¥ä¿å­˜ä¸´æ—¶å˜é‡ï¼Œåªä¸è¿‡å¦‚æœè¿™ä¸ªå‡½æ•°è°ƒç”¨ç¬¦åˆåè¿›å…ˆå‡ºçš„ç‰¹æ€§ï¼Œç”¨æ ˆè¿™ç§æ•°æ®ç»“æ„æ¥å®ç°ï¼Œæ˜¯æœ€é¡ºç†æˆç« çš„é€‰æ‹©ã€‚ä»è°ƒç”¨å‡½æ•°è¿›å…¥è¢«è°ƒç”¨å‡½æ•°ï¼Œå¯¹äºæ•°æ®æ¥è¯´ï¼Œå˜åŒ–çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯ä½œç”¨åŸŸã€‚æ‰€ä»¥æ ¹æœ¬ä¸Šï¼Œåªè¦èƒ½ä¿è¯æ¯è¿›å…¥ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œéƒ½æ˜¯ä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸå°±å¯ä»¥ã€‚è€Œè¦å®ç°è¿™ä¸ªï¼Œç”¨æ ˆå°±éå¸¸æ–¹ä¾¿ã€‚åœ¨è¿›å…¥è¢«è°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼Œåˆ†é…ä¸€æ®µæ ˆç©ºé—´ç»™è¿™ä¸ªå‡½æ•°çš„å˜é‡ï¼Œåœ¨å‡½æ•°ç»“æŸçš„æ—¶å€™ï¼Œå°†æ ˆé¡¶å¤ä½ï¼Œæ­£å¥½å›åˆ°è°ƒç”¨å‡½æ•°çš„ä½œç”¨åŸŸå†…ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒJVM å†…å­˜ç®¡ç†ä¸­æœ‰ä¸ªâ€œå †æ ˆâ€çš„æ¦‚å¿µã€‚æ ˆå†…å­˜ç”¨æ¥å­˜å‚¨å±€éƒ¨å˜é‡å’Œæ–¹æ³•è°ƒç”¨ï¼Œå †å†…å­˜ç”¨æ¥å­˜å‚¨ Java ä¸­çš„å¯¹è±¡ã€‚é‚£ JVM é‡Œé¢çš„â€œæ ˆâ€è·Ÿæˆ‘ä»¬è¿™é‡Œè¯´çš„â€œæ ˆâ€æ˜¯ä¸æ˜¯ä¸€å›äº‹å‘¢ï¼Ÿå¦‚æœä¸æ˜¯ï¼Œé‚£å®ƒä¸ºä»€ä¹ˆåˆå«ä½œâ€œæ ˆâ€å‘¢ï¼Ÿå†…å­˜ä¸­çš„å †æ ˆå’Œæ•°æ®ç»“æ„å †æ ˆä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œå¯ä»¥è¯´å†…å­˜ä¸­çš„å †æ ˆæ˜¯çœŸå®å­˜åœ¨çš„ç‰©ç†åŒºï¼Œæ•°æ®ç»“æ„ä¸­çš„å †æ ˆæ˜¯æŠ½è±¡çš„æ•°æ®å­˜å‚¨ç»“æ„ã€‚å†…å­˜ç©ºé—´åœ¨é€»è¾‘ä¸Šåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šä»£ç åŒºã€é™æ€æ•°æ®åŒºå’ŒåŠ¨æ€æ•°æ®åŒºï¼ŒåŠ¨æ€æ•°æ®åŒºåˆåˆ†ä¸ºæ ˆåŒºå’Œå †åŒºã€‚ä»£ç åŒºï¼šå­˜å‚¨æ–¹æ³•ä½“çš„äºŒè¿›åˆ¶ä»£ç ã€‚é«˜çº§è°ƒåº¦ï¼ˆä½œä¸šè°ƒåº¦ï¼‰ã€ä¸­çº§è°ƒåº¦ï¼ˆå†…å­˜è°ƒåº¦ï¼‰ã€ä½çº§è°ƒåº¦ï¼ˆè¿›ç¨‹è°ƒåº¦ï¼‰æ§åˆ¶ä»£ç åŒºæ‰§è¡Œä»£ç çš„åˆ‡æ¢ã€‚é™æ€æ•°æ®åŒºï¼šå­˜å‚¨å…¨å±€å˜é‡ã€é™æ€å˜é‡ã€å¸¸é‡ï¼Œå¸¸é‡åŒ…æ‹¬finalä¿®é¥°çš„å¸¸é‡å’ŒStringå¸¸é‡ã€‚ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å’Œå›æ”¶ã€‚æ ˆåŒºï¼šå­˜å‚¨è¿è¡Œæ–¹æ³•çš„å½¢å‚ã€å±€éƒ¨å˜é‡ã€è¿”å›å€¼ã€‚ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å’Œå›æ”¶ã€‚å †åŒºï¼šnewä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æˆ–åœ°å€å­˜å‚¨åœ¨æ ˆåŒºï¼ŒæŒ‡å‘è¯¥å¯¹è±¡å­˜å‚¨åœ¨å †åŒºä¸­çš„çœŸå®æ•°æ®ã€‚","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"cpeixin.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ ˆ","slug":"æ ˆ","permalink":"cpeixin.cn/tags/%E6%A0%88/"}]},{"title":"æ•°æ®ç»“æ„-é˜Ÿåˆ—","slug":"æ•°æ®ç»“æ„-é˜Ÿåˆ—","date":"2016-08-13T10:30:21.000Z","updated":"2020-06-10T10:44:50.676Z","comments":true,"path":"2016/08/13/æ•°æ®ç»“æ„-é˜Ÿåˆ—/","link":"","permalink":"cpeixin.cn/2016/08/13/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E9%98%9F%E5%88%97/","excerpt":"","text":"æˆ‘ä»¬çŸ¥é“ï¼ŒCPU èµ„æºæ˜¯æœ‰é™çš„ï¼Œä»»åŠ¡çš„å¤„ç†é€Ÿåº¦ä¸çº¿ç¨‹ä¸ªæ•°å¹¶ä¸æ˜¯çº¿æ€§æ­£ç›¸å…³ã€‚ç›¸åï¼Œè¿‡å¤šçš„çº¿ç¨‹åè€Œä¼šå¯¼è‡´ CPU é¢‘ç¹åˆ‡æ¢ï¼Œå¤„ç†æ€§èƒ½ä¸‹é™ã€‚æ‰€ä»¥ï¼Œçº¿ç¨‹æ± çš„å¤§å°ä¸€èˆ¬éƒ½æ˜¯ç»¼åˆè€ƒè™‘è¦å¤„ç†ä»»åŠ¡çš„ç‰¹ç‚¹å’Œç¡¬ä»¶ç¯å¢ƒï¼Œæ¥äº‹å…ˆè®¾ç½®çš„ã€‚å½“æˆ‘ä»¬å‘å›ºå®šå¤§å°çš„çº¿ç¨‹æ± ä¸­è¯·æ±‚ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­æ²¡æœ‰ç©ºé—²èµ„æºäº†ï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹æ± å¦‚ä½•å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Ÿæ˜¯æ‹’ç»è¯·æ±‚è¿˜æ˜¯æ’é˜Ÿè¯·æ±‚ï¼Ÿå„ç§å¤„ç†ç­–ç•¥åˆæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿå®é™…ä¸Šï¼Œè¿™äº›é—®é¢˜å¹¶ä¸å¤æ‚ï¼Œå…¶åº•å±‚çš„æ•°æ®ç»“æ„å°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦å­¦çš„å†…å®¹ï¼Œé˜Ÿåˆ—ï¼ˆqueueï¼‰ã€‚å¦‚ä½•ç†è§£â€œé˜Ÿåˆ—â€é˜Ÿåˆ—è¿™ä¸ªæ¦‚å¿µéå¸¸å¥½ç†è§£ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆæ’é˜Ÿä¹°ç¥¨ï¼Œå…ˆæ¥çš„å…ˆä¹°ï¼Œåæ¥çš„äººåªèƒ½ç«™æœ«å°¾ï¼Œä¸å…è®¸æ’é˜Ÿã€‚å…ˆè¿›è€…å…ˆå‡ºï¼Œè¿™å°±æ˜¯å…¸å‹çš„ â€œé˜Ÿåˆ—â€ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæ ˆåªæ”¯æŒä¸¤ä¸ªåŸºæœ¬æ“ä½œï¼š å…¥æ ˆ push()å’Œå‡ºæ ˆ pop()ã€‚é˜Ÿåˆ—è·Ÿæ ˆéå¸¸ç›¸ä¼¼ï¼Œæ”¯æŒçš„æ“ä½œä¹Ÿå¾ˆæœ‰é™ï¼Œæœ€åŸºæœ¬çš„æ“ä½œä¹Ÿæ˜¯ä¸¤ä¸ªï¼šå…¥é˜Ÿ enqueue()ï¼Œæ”¾ä¸€ä¸ªæ•°æ®åˆ°é˜Ÿåˆ—å°¾éƒ¨ï¼›å‡ºé˜Ÿ dequeue()ï¼Œä»é˜Ÿåˆ—å¤´éƒ¨å–ä¸€ä¸ªå…ƒç´ ã€‚æ‰€ä»¥ï¼Œé˜Ÿåˆ—è·Ÿæ ˆä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ç§æ“ä½œå—é™çš„çº¿æ€§è¡¨æ•°æ®ç»“æ„ã€‚é˜Ÿåˆ—çš„æ¦‚å¿µå¾ˆå¥½ç†è§£ï¼ŒåŸºæœ¬æ“ä½œä¹Ÿå¾ˆå®¹æ˜“æŒæ¡ã€‚ä½œä¸ºä¸€ç§éå¸¸åŸºç¡€çš„æ•°æ®ç»“æ„ï¼Œé˜Ÿåˆ—çš„åº”ç”¨ä¹Ÿéå¸¸å¹¿æ³›ï¼Œç‰¹åˆ«æ˜¯ä¸€äº›å…·æœ‰æŸäº›é¢å¤–ç‰¹æ€§çš„é˜Ÿåˆ—ï¼Œæ¯”å¦‚å¾ªç¯é˜Ÿåˆ—ã€é˜»å¡é˜Ÿåˆ—ã€å¹¶å‘é˜Ÿåˆ—ã€‚å®ƒä»¬åœ¨å¾ˆå¤šååº•å±‚ç³»ç»Ÿã€æ¡†æ¶ã€ä¸­é—´ä»¶çš„å¼€å‘ä¸­ï¼Œèµ·ç€å…³é”®æ€§çš„ä½œç”¨ã€‚æ¯”å¦‚é«˜æ€§èƒ½é˜Ÿåˆ— Disruptorã€Linux ç¯å½¢ç¼“å­˜ï¼Œéƒ½ç”¨åˆ°äº†å¾ªç¯å¹¶å‘é˜Ÿåˆ—ï¼›Java concurrent å¹¶å‘åŒ…åˆ©ç”¨ ArrayBlockingQueue æ¥å®ç°å…¬å¹³é”ç­‰ã€‚é¡ºåºé˜Ÿåˆ—å’Œé“¾å¼é˜Ÿåˆ—æˆ‘ä»¬çŸ¥é“äº†ï¼Œé˜Ÿåˆ—è·Ÿæ ˆä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ç§æŠ½è±¡çš„æ•°æ®ç»“æ„ã€‚å®ƒå…·æœ‰å…ˆè¿›å…ˆå‡ºçš„ç‰¹æ€§ï¼Œæ”¯æŒåœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ ï¼Œåœ¨é˜Ÿå¤´åˆ é™¤å…ƒç´ ï¼Œé‚£ç©¶ç«Ÿè¯¥å¦‚ä½•å®ç°ä¸€ä¸ªé˜Ÿåˆ—å‘¢ï¼Ÿè·Ÿæ ˆä¸€æ ·ï¼Œé˜Ÿåˆ—å¯ä»¥ç”¨æ•°ç»„æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨é“¾è¡¨æ¥å®ç°ã€‚ç”¨æ•°ç»„å®ç°çš„æ ˆå«ä½œé¡ºåºæ ˆï¼Œç”¨é“¾è¡¨å®ç°çš„æ ˆå«ä½œé“¾å¼æ ˆã€‚åŒæ ·ï¼Œç”¨æ•°ç»„å®ç°çš„é˜Ÿåˆ—å«ä½œé¡ºåºé˜Ÿåˆ—ï¼Œç”¨é“¾è¡¨å®ç°çš„é˜Ÿåˆ—å«ä½œé“¾å¼é˜Ÿåˆ—ã€‚é¡ºåºé˜Ÿåˆ—æ•°ç»„å®ç°**æˆ‘ä»¬å…ˆæ¥æ€è€ƒä¸€ä¸‹ç”¨æ•°ç»„å®ç°é˜Ÿåˆ—ï¼Œå¯¹äºæ ˆæ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªæ ˆé¡¶æŒ‡é’ˆå°±å¯ä»¥äº†ã€‚ä½†æ˜¯é˜Ÿåˆ—éœ€è¦ä¸¤ä¸ªæŒ‡é’ˆï¼šä¸€ä¸ªæ˜¯ head æŒ‡é’ˆï¼ŒæŒ‡å‘é˜Ÿå¤´ï¼›ä¸€ä¸ªæ˜¯ tail æŒ‡é’ˆï¼ŒæŒ‡å‘é˜Ÿå°¾ã€‚ä½ å¯ä»¥ç»“åˆä¸‹é¢è¿™å¹…å›¾æ¥ç†è§£ã€‚å½“ aã€bã€cã€d ä¾æ¬¡å…¥é˜Ÿä¹‹åï¼Œé˜Ÿåˆ—ä¸­çš„ head æŒ‡é’ˆæŒ‡å‘ä¸‹æ ‡ä¸º 0 çš„ä½ç½®ï¼Œtail æŒ‡é’ˆæŒ‡å‘ä¸‹æ ‡ä¸º 4 çš„ä½ç½®ã€‚å½“æˆ‘ä»¬è°ƒç”¨ä¸¤æ¬¡å‡ºé˜Ÿæ“ä½œä¹‹åï¼Œé˜Ÿåˆ—ä¸­ head æŒ‡é’ˆæŒ‡å‘ä¸‹æ ‡ä¸º 2 çš„ä½ç½®ï¼Œtail æŒ‡é’ˆä»ç„¶æŒ‡å‘ä¸‹æ ‡ä¸º 4 çš„ä½ç½®ã€‚ä½ è‚¯å®šå·²ç»å‘ç°äº†ï¼Œåœ¨å›ºå®šé•¿åº¦çš„æ•°ç»„ä¸­ï¼Œéšç€ä¸åœåœ°è¿›è¡Œå…¥é˜Ÿã€å‡ºé˜Ÿæ“ä½œï¼Œhead å’Œ tail éƒ½ä¼šæŒç»­å¾€åç§»åŠ¨ã€‚å½“ tail ç§»åŠ¨åˆ°æœ€å³è¾¹ï¼Œå³ä½¿æ•°ç»„ä¸­è¿˜æœ‰ç©ºé—²ç©ºé—´ï¼Œä¹Ÿæ— æ³•ç»§ç»­å¾€é˜Ÿåˆ—ä¸­æ·»åŠ æ•°æ®äº†ã€‚å†å‘ååŠ ï¼Œå°±ä¼šäº§ç”Ÿæ•°ç»„è¶Šç•Œçš„é”™è¯¯ã€‚å¯å®é™…ä¸Šï¼Œæˆ‘ä»¬çš„é˜Ÿåˆ—åœ¨ä¸‹æ ‡ä¸º0å’Œ1çš„åœ°æ–¹è¿˜æ˜¯ç©ºé—²çš„ã€‚æ­¤æ—¶åˆä¸åº”è¯¥æ‰©å……æ•°ç»„ï¼Œæˆ‘ä»¬æŠŠè¿™ç§ç°è±¡å«åšâ€œå‡æº¢å‡ºâ€ã€‚å¦åˆ™ä¼šé€ æˆæ•°ç»„è¶Šç•Œè€Œé­è‡´ç¨‹åºå‡ºé”™ã€‚è¿™ä¸ªé—®é¢˜è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿä½ æ˜¯å¦è¿˜è®°å¾—ï¼Œåœ¨æ•°ç»„é‚£ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä¹Ÿé‡åˆ°è¿‡ç±»ä¼¼çš„é—®é¢˜ï¼Œå°±æ˜¯æ•°ç»„çš„åˆ é™¤æ“ä½œä¼šå¯¼è‡´æ•°ç»„ä¸­çš„æ•°æ®ä¸è¿ç»­ã€‚ä½ è¿˜è®°å¾—æˆ‘ä»¬å½“æ—¶æ˜¯æ€ä¹ˆè§£å†³çš„å—ï¼Ÿå¯¹ï¼Œç”¨æ•°æ®æ¬ç§»ï¼ä½†æ˜¯ï¼Œæ¯æ¬¡è¿›è¡Œå‡ºé˜Ÿæ“ä½œéƒ½ç›¸å½“äºåˆ é™¤æ•°ç»„ä¸‹æ ‡ä¸º 0 çš„æ•°æ®ï¼Œè¦æ¬ç§»æ•´ä¸ªé˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œè¿™æ ·å‡ºé˜Ÿæ“ä½œçš„æ—¶é—´å¤æ‚åº¦å°±ä¼šä»åŸæ¥çš„ O(1) å˜ä¸º O(n)ã€‚èƒ½ä¸èƒ½ä¼˜åŒ–ä¸€ä¸‹å‘¢ï¼Ÿå®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨å‡ºé˜Ÿæ—¶å¯ä»¥ä¸ç”¨æ¬ç§»æ•°æ®ã€‚å¦‚æœæ²¡æœ‰ç©ºé—²ç©ºé—´äº†ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å…¥é˜Ÿæ—¶ï¼Œå†é›†ä¸­è§¦å‘ä¸€æ¬¡æ•°æ®çš„æ¬ç§»æ“ä½œã€‚å€ŸåŠ©è¿™ä¸ªæ€æƒ³ï¼Œå‡ºé˜Ÿå‡½æ•° dequeue() ä¿æŒä¸å˜ï¼Œæˆ‘ä»¬ç¨åŠ æ”¹é€ ä¸€ä¸‹å…¥é˜Ÿå‡½æ•° enqueue() çš„å®ç°ï¼Œå°±å¯ä»¥è½»æ¾è§£å†³åˆšæ‰çš„é—®é¢˜äº†ã€‚ä¸‹é¢æ˜¯å…·ä½“çš„ä»£ç ï¼šæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹åŸºäºæ•°ç»„ï¼Œéœ€è¦è¿›è¡Œæ•°æ®è¿ç§»çš„å®ç°æ–¹æ³•ã€‚12345678910111213141516171819202122232425262728293031from typing import Optionalclass ArrayQueue: def __init__(self, capacity: int): self._items = [] self._capacity = capacity self._head = 0 self._tail = 0 def enqueue(self, item: str) -&gt; bool: if self._tail == self._capacity: if self._head == 0: return False else: for i in range(0, self._tail - self._head): self._items[i] = self._items[i + self._head] self._tail = self._tail - self._head self._head = 0 self._items.insert(self._tail, item) self._tail += 1 return True def dequeue(self) -&gt; Optional[str]: if self._head != self._tail: item = self._items[self._head] self._head += 1 return item else: return Noneä»ä»£ç ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œå½“é˜Ÿåˆ—çš„ tail æŒ‡é’ˆç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³è¾¹åï¼Œå¦‚æœæœ‰æ–°çš„æ•°æ®å…¥é˜Ÿï¼Œæˆ‘ä»¬å¯ä»¥å°† head åˆ° tail ä¹‹é—´çš„æ•°æ®ï¼Œæ•´ä½“æ¬ç§»åˆ°æ•°ç»„ä¸­ 0 åˆ° tail-head çš„ä½ç½®ã€‚é“¾å¼é˜Ÿåˆ—é“¾è¡¨å®ç°æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹åŸºäºé“¾è¡¨çš„é˜Ÿåˆ—å®ç°æ–¹æ³•ã€‚åŸºäºé“¾è¡¨çš„å®ç°ï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦ä¸¤ä¸ªæŒ‡é’ˆï¼šhead æŒ‡é’ˆå’Œ tail æŒ‡é’ˆã€‚å®ƒä»¬åˆ†åˆ«æŒ‡å‘é“¾è¡¨çš„ç¬¬ä¸€ä¸ªç»“ç‚¹å’Œæœ€åä¸€ä¸ªç»“ç‚¹ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œå…¥é˜Ÿæ—¶ï¼Œtail-&gt;next= new_node, tail = tail-&gt;nextï¼›å‡ºé˜Ÿæ—¶ï¼Œhead = head-&gt;nextã€‚123456789101112131415161718192021222324252627282930313233343536373839404142class Node: def __init__(self, data, next_node=None): self.data = data self.next = next_nodeclass LinkedQueue: def __init__(self): self.head = None self.tail = None def enqueue(self, data): new_node = Node(data) if self.tail: self.tail.next = new_node else: self.head = new_node self.tail = new_node def dequeue(self): if self.head is None: return False self.head = self.head.next \"\"\"ç§»é™¤å¤´èŠ‚ç‚¹åï¼Œå¦‚æœå¤´èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™å°¾èŠ‚ç‚¹ä¹Ÿ\"\"\" if not self.head: self.tail = Noneif __name__ == '__main__': linked_queue = LinkedQueue() linked_queue.enqueue(1) linked_queue.enqueue(2) linked_queue.enqueue(3) linked_queue.dequeue() linked_queue.dequeue() linked_queue.dequeue() print(linked_queue.tail)å¾ªç¯é˜Ÿåˆ—å¾ªç¯é˜Ÿåˆ—åŠ¨æ€æ•ˆæœå¦‚ä¸‹å›¾ï¼šæˆ‘ä»¬åˆšæ‰ç”¨æ•°ç»„æ¥å®ç°é˜Ÿåˆ—çš„æ—¶å€™ï¼Œåœ¨ tail==n æ—¶ï¼Œä¼šæœ‰æ•°æ®æ¬ç§»æ“ä½œï¼Œè¿™æ ·å…¥é˜Ÿæ“ä½œæ€§èƒ½å°±ä¼šå—åˆ°å½±å“ã€‚é‚£æœ‰æ²¡æœ‰åŠæ³•èƒ½å¤Ÿé¿å…æ•°æ®æ¬ç§»å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹å¾ªç¯é˜Ÿåˆ—çš„è§£å†³æ€è·¯ã€‚å¾ªç¯é˜Ÿåˆ—ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒé•¿å¾—åƒä¸€ä¸ªç¯ã€‚åŸæœ¬æ•°ç»„æ˜¯æœ‰å¤´æœ‰å°¾çš„ï¼Œæ˜¯ä¸€æ¡ç›´çº¿ã€‚ç°åœ¨æˆ‘ä»¬æŠŠé¦–å°¾ç›¸è¿ï¼Œæ‰³æˆäº†ä¸€ä¸ªç¯, å¯ä»¥æƒ³åƒåƒé’Ÿè¡¨ä¸€æ ·ï¼Œenqueueå’ŒdequeueèŠ‚ç‚¹æ—¶ï¼Œtail, headæŒ‡é’ˆéƒ½æ˜¯é€†æ—¶é’ˆè¿åŠ¨ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå›¾ä¸­è¿™ä¸ªé˜Ÿåˆ—çš„å¤§å°ä¸º 8ï¼Œå½“å‰ head=4ï¼Œtail=7ã€‚å½“æœ‰ä¸€ä¸ªæ–°çš„å…ƒç´  a å…¥é˜Ÿæ—¶ï¼Œæˆ‘ä»¬æ”¾å…¥ä¸‹æ ‡ä¸º 7 çš„ä½ç½®ã€‚ä½†è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸æŠŠ tail æ›´æ–°ä¸º 8ï¼Œè€Œæ˜¯å°†å…¶åœ¨ç¯ä¸­åç§»ä¸€ä½ï¼Œåˆ°ä¸‹æ ‡ä¸º 0 çš„ä½ç½®ã€‚å½“å†æœ‰ä¸€ä¸ªå…ƒç´  b å…¥é˜Ÿæ—¶ï¼Œæˆ‘ä»¬å°† b æ”¾å…¥ä¸‹æ ‡ä¸º 0 çš„ä½ç½®ï¼Œç„¶å tail åŠ  1 æ›´æ–°ä¸º 1ã€‚æ‰€ä»¥ï¼Œåœ¨ aï¼Œb ä¾æ¬¡å…¥é˜Ÿä¹‹åï¼Œå¾ªç¯é˜Ÿåˆ—ä¸­çš„å…ƒç´ å°±å˜æˆäº†ä¸‹é¢çš„æ ·å­ï¼šé€šè¿‡è¿™æ ·çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æˆåŠŸé¿å…äº†æ•°æ®æ¬ç§»æ“ä½œã€‚çœ‹èµ·æ¥ä¸éš¾ç†è§£ï¼Œä½†æ˜¯å¾ªç¯é˜Ÿåˆ—çš„ä»£ç å®ç°éš¾åº¦è¦æ¯”å‰é¢è®²çš„éå¾ªç¯é˜Ÿåˆ—éš¾å¤šäº†ã€‚è¦æƒ³å†™å‡ºæ²¡æœ‰ bug çš„å¾ªç¯é˜Ÿåˆ—çš„å®ç°ä»£ç ï¼Œæˆ‘ä¸ªäººè§‰å¾—ï¼Œæœ€å…³é”®çš„æ˜¯ï¼Œç¡®å®šå¥½é˜Ÿç©ºå’Œé˜Ÿæ»¡çš„åˆ¤å®šæ¡ä»¶ã€‚åœ¨ç”¨æ•°ç»„å®ç°çš„éå¾ªç¯é˜Ÿåˆ—ä¸­ï¼Œé˜Ÿæ»¡çš„åˆ¤æ–­æ¡ä»¶æ˜¯ tail == nï¼Œé˜Ÿç©ºçš„åˆ¤æ–­æ¡ä»¶æ˜¯ head == tailã€‚é‚£é’ˆå¯¹å¾ªç¯é˜Ÿåˆ—ï¼Œå¦‚ä½•åˆ¤æ–­é˜Ÿç©ºå’Œé˜Ÿæ»¡å‘¢ï¼Ÿé˜Ÿåˆ—ä¸ºç©ºçš„åˆ¤æ–­æ¡ä»¶ä»ç„¶æ˜¯ head == tailã€‚ä½†é˜Ÿåˆ—æ»¡çš„åˆ¤æ–­æ¡ä»¶å°±ç¨å¾®æœ‰ç‚¹å¤æ‚äº†ã€‚æˆ‘ç”»äº†ä¸€å¼ é˜Ÿåˆ—æ»¡çš„å›¾ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œè¯•ç€æ€»ç»“ä¸€ä¸‹è§„å¾‹ã€‚å°±åƒæˆ‘å›¾ä¸­ç”»çš„é˜Ÿæ»¡çš„æƒ…å†µï¼Œtail=3ï¼Œhead=4ï¼Œn=8ï¼Œæ‰€ä»¥æ€»ç»“ä¸€ä¸‹è§„å¾‹å°±æ˜¯ï¼š(3+1)%8=4ã€‚å¤šç”»å‡ å¼ é˜Ÿæ»¡çš„å›¾ï¼Œä½ å°±ä¼šå‘ç°ï¼Œå½“é˜Ÿæ»¡æ—¶ï¼Œ(tail+1)%n=headã€‚**ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œå½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå›¾ä¸­çš„ tail æŒ‡å‘çš„ä½ç½®å®é™…ä¸Šæ˜¯æ²¡æœ‰å­˜å‚¨æ•°æ®çš„ã€‚æ‰€ä»¥ï¼Œå¾ªç¯é˜Ÿåˆ—ä¼šæµªè´¹ä¸€ä¸ªæ•°ç»„çš„å­˜å‚¨ç©ºé—´ã€‚12345678910111213141516171819202122232425262728293031323334class circular_queue(): def __init__(self, size): self.array = [] self.head = 0 self.tail = 0 self.size = size def enqueue(self, value): \"\"\"å…¥é˜Ÿåˆ¤æ»¡\"\"\" if (self.tail + 1) % self.size == self.head: return False self.array.append(value) \"\"\"å…¥é˜Ÿï¼Œå°¾èŠ‚ç‚¹ä¸‹æ ‡å˜åŒ–\"\"\" self.tail = (self.tail + 1) % self.size return True def dequeue(self): \"\"\"å‡ºé˜Ÿåˆ¤ç©º\"\"\" if self.head != self.tail: item = self.array[self.head] \"\"\"å‡ºé˜Ÿï¼Œå¤´èŠ‚ç‚¹ä¸‹æ ‡å˜åŒ–\"\"\" self.head = (self.head + 1) % self.size return itemif __name__ == '__main__': q = circular_queue(5) for i in range(5): q.enqueue(i) q.dequeue() q.dequeue() q.enqueue(1) print(q)é˜Ÿåˆ—æ»¡çš„è¡¨è¾¾å¼è¿™é‡Œè®²ä¸€ä¸‹ï¼Œè¿™ä¸ªè¡¨è¾¾å¼æ˜¯æ€ä¹ˆæ¥çš„ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œå½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œtail+1=headã€‚ä½†æ˜¯ï¼Œæœ‰ä¸ªç‰¹æ®Šæƒ…å†µï¼Œå°±æ˜¯tail=n-1ï¼Œè€Œhead=0æ—¶ï¼Œè¿™æ—¶å€™ï¼Œtail+1=nï¼Œè€Œhead=0ï¼Œæ‰€ä»¥ç”¨(tail+1)%n == n%n == 0ã€‚è€Œä¸”ï¼Œtail+1æœ€å¤§çš„æƒ…å†µå°±æ˜¯ n ï¼Œä¸ä¼šå¤§äº nï¼Œè¿™æ ·ï¼Œtail+1 é™¤äº†æœ€å¤§æƒ…å†µï¼Œä¸ç„¶æ€ä¹ˆä½™ n éƒ½æ˜¯ tail+1 æœ¬èº«ï¼Œä¹Ÿå°±æ˜¯ headã€‚è¿™æ ·ï¼Œè¡¨è¾¾å¼å°±å‡ºç°äº†ã€‚é˜»å¡é˜Ÿåˆ—å’Œå¹¶å‘é˜Ÿåˆ—å‰é¢è®²çš„å†…å®¹ç†è®ºæ¯”è¾ƒå¤šï¼Œçœ‹èµ·æ¥å¾ˆéš¾è·Ÿå®é™…çš„é¡¹ç›®å¼€å‘æ‰¯ä¸Šå…³ç³»ã€‚ç¡®å®ï¼Œé˜Ÿåˆ—è¿™ç§æ•°æ®ç»“æ„å¾ˆåŸºç¡€ï¼Œå¹³æ—¶çš„ä¸šåŠ¡å¼€å‘ä¸å¤§å¯èƒ½ä»é›¶å®ç°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”šè‡³éƒ½ä¸ä¼šç›´æ¥ç”¨åˆ°ã€‚è€Œä¸€äº›å…·æœ‰ç‰¹æ®Šç‰¹æ€§çš„é˜Ÿåˆ—åº”ç”¨å´æ¯”è¾ƒå¹¿æ³›ï¼Œæ¯”å¦‚é˜»å¡é˜Ÿåˆ—å’Œå¹¶å‘é˜Ÿåˆ—ã€‚é˜»å¡é˜Ÿåˆ—å…¶å®å°±æ˜¯åœ¨é˜Ÿåˆ—åŸºç¡€ä¸Šå¢åŠ äº†é˜»å¡æ“ä½œã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™ï¼Œä»é˜Ÿå¤´å–æ•°æ®ä¼šè¢«é˜»å¡ã€‚å› ä¸ºæ­¤æ—¶è¿˜æ²¡æœ‰æ•°æ®å¯å–ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰äº†æ•°æ®æ‰èƒ½è¿”å›ï¼›å¦‚æœé˜Ÿåˆ—å·²ç»æ»¡äº†ï¼Œé‚£ä¹ˆæ’å…¥æ•°æ®çš„æ“ä½œå°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰ç©ºé—²ä½ç½®åå†æ’å…¥æ•°æ®ï¼Œç„¶åå†è¿”å›ã€‚ä½ åº”è¯¥å·²ç»å‘ç°äº†ï¼Œä¸Šè¿°çš„å®šä¹‰å°±æ˜¯ä¸€ä¸ªâ€œç”Ÿäº§è€… - æ¶ˆè´¹è€…æ¨¡å‹â€ï¼æ˜¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é˜»å¡é˜Ÿåˆ—ï¼Œè½»æ¾å®ç°ä¸€ä¸ªâ€œç”Ÿäº§è€… - æ¶ˆè´¹è€…æ¨¡å‹â€ï¼å¯ä»¥æœ‰æ•ˆåœ°åè°ƒç”Ÿäº§å’Œæ¶ˆè´¹çš„é€Ÿåº¦ã€‚å½“â€œç”Ÿäº§è€…â€ç”Ÿäº§æ•°æ®çš„é€Ÿåº¦è¿‡å¿«ï¼Œâ€œæ¶ˆè´¹è€…â€æ¥ä¸åŠæ¶ˆè´¹æ—¶ï¼Œå­˜å‚¨æ•°æ®çš„é˜Ÿåˆ—å¾ˆå¿«å°±ä¼šæ»¡äº†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œç”Ÿäº§è€…å°±é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°â€œæ¶ˆè´¹è€…â€æ¶ˆè´¹äº†æ•°æ®ï¼Œâ€œç”Ÿäº§è€…â€æ‰ä¼šè¢«å”¤é†’ç»§ç»­â€œç”Ÿäº§â€ã€‚è€Œä¸”ä¸ä»…å¦‚æ­¤ï¼ŒåŸºäºé˜»å¡é˜Ÿåˆ—ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡åè°ƒâ€œç”Ÿäº§è€…â€å’Œâ€œæ¶ˆè´¹è€…â€çš„ä¸ªæ•°ï¼Œæ¥æé«˜æ•°æ®çš„å¤„ç†æ•ˆç‡ã€‚æ¯”å¦‚å‰é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å¤šé…ç½®å‡ ä¸ªâ€œæ¶ˆè´¹è€…â€ï¼Œæ¥åº”å¯¹ä¸€ä¸ªâ€œç”Ÿäº§è€…â€ã€‚å‰é¢æˆ‘ä»¬è®²äº†é˜»å¡é˜Ÿåˆ—ï¼Œåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œä¼šæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œé˜Ÿåˆ—ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œé‚£å¦‚ä½•å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—å‘¢ï¼Ÿçº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—æˆ‘ä»¬å«ä½œå¹¶å‘é˜Ÿåˆ—ã€‚æœ€ç®€å•ç›´æ¥çš„å®ç°æ–¹å¼æ˜¯ç›´æ¥åœ¨ enqueue()ã€dequeue() æ–¹æ³•ä¸ŠåŠ é”ï¼Œä½†æ˜¯é”ç²’åº¦å¤§å¹¶å‘åº¦ä¼šæ¯”è¾ƒä½ï¼ŒåŒä¸€æ—¶åˆ»ä»…å…è®¸ä¸€ä¸ªå­˜æˆ–è€…å–æ“ä½œã€‚å®é™…ä¸Šï¼ŒåŸºäºæ•°ç»„çš„å¾ªç¯é˜Ÿåˆ—ï¼Œåˆ©ç”¨ CAS åŸå­æ“ä½œï¼Œå¯ä»¥å®ç°éå¸¸é«˜æ•ˆçš„å¹¶å‘é˜Ÿåˆ—ã€‚è¿™ä¹Ÿæ˜¯å¾ªç¯é˜Ÿåˆ—æ¯”é“¾å¼é˜Ÿåˆ—åº”ç”¨æ›´åŠ å¹¿æ³›çš„åŸå› ã€‚é˜Ÿåˆ—çš„çŸ¥è¯†å°±è®²å®Œäº†ï¼Œæˆ‘ä»¬ç°åœ¨å›è¿‡æ¥çœ‹ä¸‹å¼€ç¯‡çš„é—®é¢˜ã€‚çº¿ç¨‹æ± æ²¡æœ‰ç©ºé—²çº¿ç¨‹æ—¶ï¼Œæ–°çš„ä»»åŠ¡è¯·æ±‚çº¿ç¨‹èµ„æºæ—¶ï¼Œçº¿ç¨‹æ± è¯¥å¦‚ä½•å¤„ç†ï¼Ÿå„ç§å¤„ç†ç­–ç•¥åˆæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿæˆ‘ä»¬ä¸€èˆ¬æœ‰ä¸¤ç§å¤„ç†ç­–ç•¥ã€‚ç¬¬ä¸€ç§æ˜¯éé˜»å¡çš„å¤„ç†æ–¹å¼ï¼Œç›´æ¥æ‹’ç»ä»»åŠ¡è¯·æ±‚ï¼›å¦ä¸€ç§æ˜¯é˜»å¡çš„å¤„ç†æ–¹å¼ï¼Œå°†è¯·æ±‚æ’é˜Ÿï¼Œç­‰åˆ°æœ‰ç©ºé—²çº¿ç¨‹æ—¶ï¼Œå–å‡ºæ’é˜Ÿçš„è¯·æ±‚ç»§ç»­å¤„ç†ã€‚é‚£å¦‚ä½•å­˜å‚¨æ’é˜Ÿçš„è¯·æ±‚å‘¢ï¼Ÿæˆ‘ä»¬å¸Œæœ›å…¬å¹³åœ°å¤„ç†æ¯ä¸ªæ’é˜Ÿçš„è¯·æ±‚ï¼Œå…ˆè¿›è€…å…ˆæœåŠ¡ï¼Œæ‰€ä»¥é˜Ÿåˆ—è¿™ç§æ•°æ®ç»“æ„å¾ˆé€‚åˆæ¥å­˜å‚¨æ’é˜Ÿè¯·æ±‚ã€‚æˆ‘ä»¬å‰é¢è¯´è¿‡ï¼Œé˜Ÿåˆ—æœ‰åŸºäºé“¾è¡¨å’ŒåŸºäºæ•°ç»„è¿™ä¸¤ç§å®ç°æ–¹å¼ã€‚è¿™ä¸¤ç§å®ç°æ–¹å¼å¯¹äºæ’é˜Ÿè¯·æ±‚åˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼ŸåŸºäºé“¾è¡¨çš„å®ç°æ–¹å¼ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªæ”¯æŒæ— é™æ’é˜Ÿçš„æ— ç•Œé˜Ÿåˆ—ï¼ˆunbounded queueï¼‰ï¼Œä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´è¿‡å¤šçš„è¯·æ±‚æ’é˜Ÿç­‰å¾…ï¼Œè¯·æ±‚å¤„ç†çš„å“åº”æ—¶é—´è¿‡é•¿ã€‚æ‰€ä»¥ï¼Œé’ˆå¯¹å“åº”æ—¶é—´æ¯”è¾ƒæ•æ„Ÿçš„ç³»ç»Ÿï¼ŒåŸºäºé“¾è¡¨å®ç°çš„æ— é™æ’é˜Ÿçš„çº¿ç¨‹æ± æ˜¯ä¸åˆé€‚çš„ã€‚è€ŒåŸºäºæ•°ç»„å®ç°çš„æœ‰ç•Œé˜Ÿåˆ—ï¼ˆbounded queueï¼‰ï¼Œé˜Ÿåˆ—çš„å¤§å°æœ‰é™ï¼Œæ‰€ä»¥çº¿ç¨‹æ± ä¸­æ’é˜Ÿçš„è¯·æ±‚è¶…è¿‡é˜Ÿåˆ—å¤§å°æ—¶ï¼Œæ¥ä¸‹æ¥çš„è¯·æ±‚å°±ä¼šè¢«æ‹’ç»ï¼Œè¿™ç§æ–¹å¼å¯¹å“åº”æ—¶é—´æ•æ„Ÿçš„ç³»ç»Ÿæ¥è¯´ï¼Œå°±ç›¸å¯¹æ›´åŠ åˆç†ã€‚ä¸è¿‡ï¼Œè®¾ç½®ä¸€ä¸ªåˆç†çš„é˜Ÿåˆ—å¤§å°ï¼Œä¹Ÿæ˜¯éå¸¸æœ‰è®²ç©¶çš„ã€‚é˜Ÿåˆ—å¤ªå¤§å¯¼è‡´ç­‰å¾…çš„è¯·æ±‚å¤ªå¤šï¼Œé˜Ÿåˆ—å¤ªå°ä¼šå¯¼è‡´æ— æ³•å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºã€å‘æŒ¥æœ€å¤§æ€§èƒ½ã€‚é™¤äº†å‰é¢è®²åˆ°é˜Ÿåˆ—åº”ç”¨åœ¨çº¿ç¨‹æ± è¯·æ±‚æ’é˜Ÿçš„åœºæ™¯ä¹‹å¤–ï¼Œé˜Ÿåˆ—å¯ä»¥åº”ç”¨åœ¨ä»»ä½•æœ‰é™èµ„æºæ± ä¸­ï¼Œç”¨äºæ’é˜Ÿè¯·æ±‚ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥æ± ç­‰ã€‚å®é™…ä¸Šï¼Œå¯¹äºå¤§éƒ¨åˆ†èµ„æºæœ‰é™çš„åœºæ™¯ï¼Œå½“æ²¡æœ‰ç©ºé—²èµ„æºæ—¶ï¼ŒåŸºæœ¬ä¸Šéƒ½å¯ä»¥é€šè¿‡â€œé˜Ÿåˆ—â€è¿™ç§æ•°æ®ç»“æ„æ¥å®ç°è¯·æ±‚æ’é˜Ÿã€‚**å†…å®¹å°ç»“ä»Šå¤©æˆ‘ä»¬è®²äº†ä¸€ç§è·Ÿæ ˆå¾ˆç›¸ä¼¼çš„æ•°æ®ç»“æ„ï¼Œé˜Ÿåˆ—ã€‚å…³äºé˜Ÿåˆ—ï¼Œä½ èƒ½æŒæ¡ä¸‹é¢çš„å†…å®¹ï¼Œè¿™èŠ‚å°±æ²¡é—®é¢˜äº†ã€‚é˜Ÿåˆ—æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å…ˆè¿›å…ˆå‡ºï¼Œä¸»è¦çš„ä¸¤ä¸ªæ“ä½œæ˜¯å…¥é˜Ÿå’Œå‡ºé˜Ÿã€‚è·Ÿæ ˆä¸€æ ·ï¼Œå®ƒæ—¢å¯ä»¥ç”¨æ•°ç»„æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨é“¾è¡¨æ¥å®ç°ã€‚ç”¨æ•°ç»„å®ç°çš„å«é¡ºåºé˜Ÿåˆ—ï¼Œç”¨é“¾è¡¨å®ç°çš„å«é“¾å¼é˜Ÿåˆ—ã€‚ç‰¹åˆ«æ˜¯é•¿å¾—åƒä¸€ä¸ªç¯çš„å¾ªç¯é˜Ÿåˆ—ã€‚åœ¨æ•°ç»„å®ç°é˜Ÿåˆ—çš„æ—¶å€™ï¼Œä¼šæœ‰æ•°æ®æ¬ç§»æ“ä½œï¼Œè¦æƒ³è§£å†³æ•°æ®æ¬ç§»çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦åƒç¯ä¸€æ ·çš„å¾ªç¯é˜Ÿåˆ—ã€‚å¾ªç¯é˜Ÿåˆ—æ˜¯æˆ‘ä»¬è¿™èŠ‚çš„é‡ç‚¹ã€‚è¦æƒ³å†™å‡ºæ²¡æœ‰ bug çš„å¾ªç¯é˜Ÿåˆ—å®ç°ä»£ç ï¼Œå…³é”®è¦ç¡®å®šå¥½é˜Ÿç©ºå’Œé˜Ÿæ»¡çš„åˆ¤å®šæ¡ä»¶ï¼Œå…·ä½“çš„ä»£ç ä½ è¦èƒ½å†™å‡ºæ¥ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è®²äº†å‡ ç§é«˜çº§çš„é˜Ÿåˆ—ç»“æ„ï¼Œé˜»å¡é˜Ÿåˆ—ã€å¹¶å‘é˜Ÿåˆ—ï¼Œåº•å±‚éƒ½è¿˜æ˜¯é˜Ÿåˆ—è¿™ç§æ•°æ®ç»“æ„ï¼Œåªä¸è¿‡åœ¨ä¹‹ä¸Šé™„åŠ äº†å¾ˆå¤šå…¶ä»–åŠŸèƒ½ã€‚é˜»å¡é˜Ÿåˆ—å°±æ˜¯å…¥é˜Ÿã€å‡ºé˜Ÿæ“ä½œå¯ä»¥é˜»å¡ï¼Œå¹¶å‘é˜Ÿåˆ—å°±æ˜¯é˜Ÿåˆ—çš„æ“ä½œå¤šçº¿ç¨‹å®‰å…¨é˜Ÿåˆ—åº”ç”¨åœ¨ç°å®ç”Ÿæ´»ä¸­Queueçš„åº”ç”¨ä¹Ÿå¾ˆå¹¿æ³›ï¼Œæœ€å¹¿æ³›çš„å°±æ˜¯æ’é˜Ÿäº†ï¼Œâ€å…ˆæ¥ååˆ°â€ First come first service ï¼Œä»¥åŠQueueè¿™ä¸ªå•è¯å°±æœ‰æ’é˜Ÿçš„æ„æ€ã€‚è¿˜æœ‰ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„æ’­æ”¾å™¨ä¸Šçš„æ’­æ”¾åˆ—è¡¨ï¼Œæˆ‘ä»¬çš„æ•°æ®æµå¯¹è±¡ï¼Œå¼‚æ­¥çš„æ•°æ®ä¼ è¾“ç»“æ„(æ–‡ä»¶IOï¼Œç®¡é“é€šè®¯ï¼Œå¥—æ¥å­—ç­‰)è¿˜æœ‰ä¸€äº›è§£å†³å¯¹å…±äº«èµ„æºçš„å†²çªè®¿é—®ï¼Œæ¯”å¦‚æ‰“å°æœºçš„æ‰“å°é˜Ÿåˆ—ç­‰ã€‚æ¶ˆæ¯é˜Ÿåˆ—ç­‰ã€‚äº¤é€šçŠ¶å†µæ¨¡æ‹Ÿï¼Œå‘¼å«ä¸­å¿ƒç”¨æˆ·ç­‰å¾…çš„æ—¶é—´çš„æ¨¡æ‹Ÿç­‰ç­‰ã€‚æœ€åï¼Œå…³äºé˜Ÿåˆ—ï¼Œå…¥é˜Ÿè¦åˆ¤æ»¡ï¼Œå‡ºé˜Ÿè¦åˆ¤ç©º**","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"cpeixin.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"é˜Ÿåˆ—","slug":"é˜Ÿåˆ—","permalink":"cpeixin.cn/tags/%E9%98%9F%E5%88%97/"}]},{"title":"æ•°æ®ç»“æ„-çº¿æ€§è¡¨","slug":"æ•°æ®ç»“æ„-çº¿æ€§è¡¨","date":"2016-08-12T02:39:21.000Z","updated":"2020-06-08T08:45:14.641Z","comments":true,"path":"2016/08/12/æ•°æ®ç»“æ„-çº¿æ€§è¡¨/","link":"","permalink":"cpeixin.cn/2016/08/12/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%BA%BF%E6%80%A7%E8%A1%A8/","excerpt":"","text":"çº¿æ€§è¡¨åŠå…¶é€»è¾‘ç»“æ„çº¿æ€§è¡¨æ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚è‹±æ–‡å­—æ¯è¡¨ï¼ˆAã€Bã€â€¦ã€Zï¼‰æ˜¯ä¸€ä¸ªçº¿æ€§è¡¨ï¼Œè¡¨ä¸­æ¯ä¸ªè‹±æ–‡å­—æ¯æ˜¯ä¸€ä¸ªæ•°æ®å…ƒç´ ï¼›æˆç»©å•æ˜¯ä¸€ä¸ªçº¿æ€§è¡¨ï¼Œè¡¨ä¸­æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªæ•°æ®å…ƒç´ ï¼Œæ¯ä¸ªæ•°æ®å…ƒç´ åˆç”±å­¦å·ã€å§“åã€æˆç»©ç­‰æ•°æ®é¡¹ç»„æˆã€‚çº¿æ€§è¡¨çš„å®šä¹‰çº¿æ€§è¡¨æ˜¯å…·æœ‰ç›¸åŒç‰¹æ€§çš„æ•°æ®å…ƒç´ çš„ä¸€ä¸ªæœ‰é™åºåˆ—ã€‚çº¿æ€§è¡¨ä¸€èˆ¬è¡¨ç¤ºä¸ºï¼š1 L = (a1, a2, â€¦, ai,ai+1 ,â€¦, an)çº¿æ€§è¡¨ä¸­å…ƒç´ åœ¨ä½ç½®ä¸Šæ˜¯æœ‰åºçš„ï¼Œè¿™ç§ä½ç½®ä¸Šæœ‰åºæ€§å°±æ˜¯ä¸€ç§çº¿æ€§å…³ç³»ï¼Œç”¨äºŒå…ƒç»„è¡¨ç¤ºï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110L = (D, R) D = &#123;ai| 1â‰¤iâ‰¤n, nâ‰¥0&#125; R = &#123;r&#125; r = &#123;&lt;ai, ai+1&gt; | 1â‰¤iâ‰¤n-1&#125;``` ### çº¿æ€§è¡¨çš„æŠ½è±¡æ•°æ®ç±»å‹æè¿° å°†çº¿æ€§è¡¨æ•°æ®ç»“æ„æŠ½è±¡æˆä¸ºä¸€ç§æ•°æ®ç±»å‹ï¼Œè¿™ä¸ªæ•°æ®ç±»å‹ä¸­åŒ…å«æ•°æ®å…ƒç´ ã€å…ƒç´ ä¹‹é—´çš„å…³ç³»ã€æ“ä½œå…ƒç´ çš„åŸºæœ¬ç®—æ³•ã€‚ å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆintã€floatã€booleanç­‰ç­‰ï¼‰javaå·²ç»å¸®æˆ‘ä»¬å®ç°äº†ç”¨äºæ“ä½œä»–ä»¬çš„åŸºæœ¬è¿ç®—ï¼Œ æˆ‘ä»¬éœ€è¦åŸºäºè¿™äº›åŸºæœ¬è¿ç®—ï¼Œä¸ºæˆ‘ä»¬å°è£…çš„è‡ªå®šä¹‰æ•°æ®ç±»å‹æä¾›æ“ä½œå®ƒä»¬çš„ç®—æ³•ã€‚ æ¯”å¦‚æ•°ç»„å°±æ˜¯ä¸€ç§è¢«æŠ½è±¡å‡ºæ¥çš„çº¿æ€§è¡¨æ•°æ®ç±»å‹ï¼Œæ•°ç»„è‡ªå¸¦å¾ˆå¤šåŸºæœ¬æ–¹æ³•ç”¨äºæ“ä½œæ•°æ®å…ƒç´ ã€‚ Javaä¸­çš„Listæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨åˆ°ï¼Œä½†æ˜¯å¾ˆå°‘å…³æ³¨å…¶å†…éƒ¨å®ç°ï¼ŒListæ˜¯ä¸€ä¸ªæ¥å£ï¼Œ é‡Œé¢å®šä¹‰äº†ä¸€äº›æŠ½è±¡çš„æ–¹æ³•ï¼Œå…¶ç›®çš„å°±æ˜¯å¯¹çº¿æ€§è¡¨çš„æŠ½è±¡ï¼Œå…¶ä¸­çš„æ–¹æ³•å°±æ˜¯çº¿æ€§è¡¨çš„ä¸€äº›å¸¸ç”¨åŸºæœ¬è¿ç®—ã€‚ è€Œå¯¹äºçº¿æ€§è¡¨çš„ä¸åŒ**å­˜å‚¨ç»“æ„**å…¶å®ç°æ–¹å¼å°±æœ‰æ‰€ä¸åŒäº†ï¼Œ æ¯”å¦‚**ArrayList**æ˜¯å¯¹çº¿æ€§è¡¨é¡ºåºå­˜å‚¨ç»“æ„çš„å®ç°ï¼Œ **LinkedList**æ˜¯çº¿æ€§è¡¨é“¾å¼å­˜å‚¨ç»“æ„çš„å®ç°ç­‰ã€‚ å­˜å‚¨ç»“æ„æ²¡æœ‰ç¡®å®šæˆ‘ä»¬å°±ä¸çŸ¥é“æ•°æ®æ€ä¹ˆå­˜å‚¨ï¼Œä½†æ˜¯å¯¹äºçº¿æ€§è¡¨è¿™ç§é€»è¾‘ç»“æ„ä¸­æ•°æ®çš„åŸºæœ¬æ“ä½œæˆ‘ä»¬å¯ä»¥é¢„çŸ¥ï¼Œ æ— éå°±æ˜¯è·å–é•¿åº¦ã€è·å–æŒ‡å®šä½ç½®çš„æ•°æ®ã€æ’å…¥æ•°æ®ã€åˆ é™¤æ•°æ®ç­‰ç­‰æ“ä½œï¼Œå¯ä»¥å‚è€ƒListã€‚ å¯¹äºæœ¬ç³»åˆ—æ–‡ç« ï¼Œåªæ˜¯å¯¹æ•°æ®ç»“æ„å’Œä¸€äº›å¸¸ç”¨ç®—æ³•å­¦ä¹ ï¼Œæ¥ä¸‹æ¥çš„ä»£ç å°†é€‰æ‹©æ€§å®ç°å¹¶åˆ†æç®—æ³•ã€‚ å¯¹çº¿æ€§è¡¨çš„æŠ½è±¡æ•°æ®ç±»å‹æè¿°å¦‚ä¸‹ï¼š```javapublic interface IList&lt;T&gt; &#123; /** * åˆ¤æ–­çº¿æ€§è¡¨æ˜¯å¦ä¸ºç©º * @return */ boolean isEmpty(); /** * è·å–é•¿åº¦ * @return */ int length(); /** * å°†ç»“ç‚¹æ·»åŠ åˆ°æŒ‡å®šåºåˆ—çš„ä½ç½® * @param index * @param data * @return */ boolean add(int index, T data); /** * å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°åˆ—è¡¨çš„æœ«å°¾ * @param data * @return */ boolean add(T data); /** * æ ¹æ®indexç§»é™¤å…ƒç´  * @param index * @return */ T remove(int index); /** * ç§»é™¤å€¼ä¸ºdataçš„ç¬¬ä¸€ä¸ªç»“ç‚¹ * @param data * @return */ boolean remove(T data); /** * ç§»é™¤æ‰€æœ‰å€¼ä¸ºdataçš„ç»“ç‚¹ * @param data * @return */ boolean removeAll(T data); /** * æ¸…ç©ºè¡¨ */ void clear(); /** * è®¾ç½®æŒ‡å®šåºåˆ—å…ƒç´ çš„å€¼ * @param index * @param data * @return */ T set(int index, T data); /** * æ˜¯å¦åŒ…å«å€¼ä¸ºdataçš„ç»“ç‚¹ * @param data * @return */ boolean contains(T data); /** * æ ¹æ®å€¼æŸ¥è¯¢ç´¢å¼• * @param data * @return */ int indexOf(T data); /** * æ ¹æ®dataå€¼æŸ¥è¯¢æœ€åä¸€æ¬¡å‡ºç°åœ¨è¡¨ä¸­çš„ç´¢å¼• * @param data * @return */ int lastIndexOf(T data); /** * è·å–æŒ‡å®šåºåˆ—çš„å…ƒç´  * @param index * @return */ T get(int index); /** * è¾“å‡ºæ ¼å¼ * @return */ String toString();&#125;çº¿æ€§è¡¨çš„é¡ºåºå­˜å‚¨ç»“æ„é¡ºåºè¡¨æŠŠçº¿æ€§è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ æŒ‰ç…§å…¶é€»è¾‘é¡ºåºä¾æ¬¡å­˜å‚¨åœ¨è®¡ç®—æœºå­˜å‚¨å™¨ä¸­æŒ‡å®šå­˜å‚¨ä½ç½®å¼€å§‹çš„ä¸€å—è¿ç»­çš„å­˜å‚¨ç©ºé—´ä¸­ã€‚åœ¨Javaä¸­åˆ›å»ºä¸€ä¸ªæ•°ç»„å¯¹è±¡å°±æ˜¯åˆ†é…äº†ä¸€å—å¯ä¾›ç”¨æˆ·ä½¿ç”¨çš„è¿ç»­çš„å­˜å‚¨ç©ºé—´ï¼Œè¯¥å­˜å‚¨ç©ºé—´çš„èµ·å§‹ä½ç½®å°±æ˜¯ç”±æ•°ç»„åè¡¨ç¤ºçš„åœ°å€å¸¸é‡ã€‚çº¿æ€§è¡¨çš„é¡ºåºå­˜å‚¨ç»“æ„æ˜¯åˆ©ç”¨æ•°ç»„æ¥å®ç°çš„ã€‚åœ¨Javaä¸­ï¼Œæˆ‘ä»¬é€šå¸¸åˆ©ç”¨ä¸‹é¢çš„æ–¹å¼æ¥ä½¿ç”¨æ•°ç»„ï¼š123int[] array = new int[]&#123;1,2,3&#125;; //åˆ›å»ºä¸€ä¸ªæ•°ç»„Array.getInt(array, 0); //è·å–æ•°ç»„ä¸­åºåˆ—ä¸º0çš„å…ƒç´ Array.set(array, 0, 1); //è®¾ç½®åºåˆ—ä¸º0çš„å…ƒç´ å€¼ä¸º1Arrayè¿™ç§æ–¹å¼åˆ›å»ºçš„æ•°ç»„æ˜¯å›ºå®šé•¿åº¦çš„ï¼Œå…¶å®¹é‡æ— æ³•ä¿®æ”¹ï¼Œå½“arrayè¢«åˆ›å»ºå‡ºæ¥çš„æ—¶å€™ï¼Œç³»ç»Ÿåªä¸ºå…¶åˆ†é…3ä¸ªå­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•å¯¹å…¶è¿›è¡Œæ·»åŠ å’Œåˆ é™¤æ“ä½œã€‚Arrayè¿™ä¸ªç±»é‡Œé¢æä¾›äº†å¾ˆå¤šæ–¹æ³•ç”¨äºæ“ä½œæ•°ç»„ï¼Œè¿™äº›æ–¹æ³•éƒ½æ˜¯é™æ€çš„ï¼Œæ‰€ä»¥Arrayæ˜¯ä¸€ä¸ªç”¨äºæ“ä½œæ•°ç»„çš„å·¥å…·ç±»ï¼Œè¿™ä¸ªç±»æä¾›çš„æ–¹æ³•åªæœ‰ä¸¤ç§ï¼šgetå’Œsetï¼Œæ‰€ä»¥åªèƒ½è·å–å’Œè®¾ç½®æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œç„¶åå¯¹äºè¿™ä¸¤ç§æ“ä½œï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨array[i]ã€array[i] = 0çš„ç®€åŒ–æ–¹å¼ï¼Œæ‰€ä»¥Arrayè¿™ä¸ªç±»ç”¨çš„æ¯”è¾ƒå°‘ã€‚å¦å¤–ä¸€ç§æ•°ç»„ArrayListï¼Œå…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šä¹Ÿæ˜¯æ•°ç»„ï¼Œå…¶æ“ä½œéƒ½æ˜¯å¯¹æ•°ç»„çš„æ“ä½œï¼Œä¸ä¸Šè¿°æ•°ç»„ä¸åŒçš„æ˜¯ï¼ŒArrayListæ˜¯ä¸€ç§å¯å˜é•¿åº¦çš„æ•°ç»„ã€‚æ—¢ç„¶æ•°ç»„åˆ›å»ºæ—¶å°±å·²ç»åˆ†é…äº†å­˜å‚¨ç©ºé—´ï¼Œä¸ºä»€ä¹ˆArrayListæ˜¯é•¿åº¦å¯å˜çš„å‘¢ï¼Ÿé•¿åº¦å¯å˜æ„å‘³ç€å¯ä»¥ä»æ•°ç»„ä¸­æ·»åŠ ã€åˆ é™¤å…ƒç´ ï¼Œå‘ArrayListä¸­æ·»åŠ æ•°æ®æ—¶ï¼Œå®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå°†åŸæ•°ç»„ä¸­å…ƒç´ ä¸€ä¸ªä¸ªå¤åˆ¶åˆ°æ–°æ•°ç»„åï¼Œå°†æ–°å…ƒç´ æ·»åŠ è¿›æ¥ã€‚å¦‚æœArrayListä»…ä»…åšäº†è¿™ä¹ˆç®€å•çš„æ“ä½œï¼Œé‚£ä»–å°±ä¸åº”è¯¥å‡ºç°äº†ã€‚ArrayListä¸­çš„æ•°ç»„é•¿åº¦æ˜¯å¤§äºç­‰äºå…¶å…ƒç´ ä¸ªæ•°çš„ï¼Œå½“æ‰§è¡Œadd()æ“ä½œæ—¶é¦–å…ˆä¼šæ£€æŸ¥æ•°ç»„é•¿åº¦æ˜¯å¦å¤Ÿç”¨ï¼Œåªæœ‰å½“æ•°ç»„é•¿åº¦ä¸å¤Ÿç”¨æ—¶æ‰ä¼šåˆ›å»ºæ–°çš„æ•°ç»„ï¼Œç”±äºåˆ›å»ºæ–°æ•°ç»„æ„å‘³ç€è€æ•°æ®çš„æ¬è¿ï¼Œæ‰€ä»¥è¿™ä¸ªæœºåˆ¶ä¹Ÿç®—æ˜¯åˆ©ç”¨ç©ºé—´æ¢å–æ—¶é—´ä¸Šçš„æ•ˆç‡ã€‚ä½†æ˜¯å¦‚æœæ·»åŠ æ“ä½œå¹¶ä¸æ˜¯å°¾éƒ¨æ·»åŠ ï¼Œè€Œæ˜¯å¤´éƒ¨æˆ–è€…ä¸­é—´ä½ç½®æ’å…¥ï¼Œä¹Ÿé¿å…ä¸äº†å…ƒç´ ä½ç½®ç§»åŠ¨ã€‚é¡ºåºè¡¨åŸºæœ¬è¿ç®—çš„å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229public class LinearArray&lt;T&gt; implements IList&lt;T&gt;&#123; private Object[] datas; /** * é€šè¿‡ç»™å®šçš„æ•°ç»„ å»ºç«‹é¡ºåºè¡¨ * @param objs * @return */ public static &lt;T&gt; LinearArray&lt;T&gt; createArray(T[] objs)&#123; LinearArray&lt;T&gt; array = new LinearArray(); array.datas = new Object[objs.length]; for(int i = 0; i&lt;objs.length; i++) array.datas[i] = objs[i]; return array; &#125; private LinearArray()&#123; &#125; @Override public boolean isEmpty() &#123; return datas.length == 0; &#125; @Override public int length() &#123; return datas.length; &#125; /** * è·å–æŒ‡å®šä½ç½®çš„å…ƒç´  * åˆ†æï¼šæ—¶é—´å¤æ‚åº¦O(1) * ä»é¡ºåºè¡¨ä¸­æ£€ç´¢å€¼æ˜¯ç®€å•é«˜æ•ˆçš„ï¼Œå› ä¸ºé¡ºåºè¡¨å†…éƒ¨é‡‡ç”¨æ•°ç»„ä½œä¸ºå®¹å™¨ï¼Œæ•°ç»„å¯ç›´æ¥é€šè¿‡ç´¢å¼•å€¼è®¿é—®å…ƒç´  */ @Override public T get(int index) &#123; if (index&lt;0 || index &gt;= datas.length) throw new IndexOutOfBoundsException(); return (T) datas[index]; &#125; /** * ä¸ºæŒ‡å®šç´¢å¼•çš„ç»“ç‚¹è®¾ç½®å€¼ * åˆ†æï¼šæ—¶é—´å¤æ‚åº¦O(1) */ @Override public T set(int index, T data) &#123; if (index&lt;0 || index &gt;= datas.length) throw new IndexOutOfBoundsException(); T oldValue = (T) datas[index]; datas[index] = data; return oldValue; &#125; /** * åˆ¤æ–­æ˜¯å¦åŒ…å«æŸå€¼åªéœ€è¦åˆ¤æ–­è¯¥å€¼æœ‰æ²¡æœ‰å‡ºç°è¿‡ * åˆ†æï¼šæ—¶é—´å¤æ‚åº¦O(n) */ @Override public boolean contains(T data) &#123; return indexOf(data) &gt;= 0; &#125; /** * è·å–æŸå€¼ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼• * åˆ†æï¼šæ—¶é—´å¤æ‚åº¦O(n) */ @Override public int indexOf(T data) &#123; if (data == null) &#123; for (int i = 0; i &lt; datas.length; i++) if (datas[i]==null) return i; &#125; else &#123; for (int i = 0; i &lt; datas.length; i++) if (data.equals(datas[i])) return i; &#125; return -1; &#125; /** * è·å–æŸå€¼æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼• * åˆ†æï¼šæ—¶é—´å¤æ‚åº¦O(n) */ @Override public int lastIndexOf(T data) &#123; if (data == null) &#123; for (int i = datas.length-1; i &gt;= 0; i--) if (datas[i]==null) return i; &#125; else &#123; for (int i = datas.length-1; i &gt;= 0; i--) if (data.equals(datas[i])) return i; &#125; return -1; &#125; /** * æŒ‡å®šä½ç½®æ’å…¥å…ƒç´  * åˆ†æï¼šæ—¶é—´å¤æ‚åº¦O(n) * åœ¨æ•°ç»„ä¸­æ’å…¥å…ƒç´ æ—¶ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ¯”åŸæ•°ç»„å®¹é‡å¤§1çš„æ–°æ•°ç»„ï¼Œ * å°†åŸæ•°ç»„ä¸­(0,index-1)ä½ç½®çš„å…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„ï¼ŒæŒ‡å®šæ–°æ•°ç»„indexä½ç½®å…ƒç´ å€¼ä¸ºæ–°å€¼ï¼Œ * ç»§ç»­å°†åŸæ•°ç»„(index, length-1)çš„å…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„ * @param index * @param data * @return */ @Override public boolean add(int index, T data) &#123; if (index &gt; datas.length || index &lt; 0) throw new IndexOutOfBoundsException(); Object destination[] = new Object[datas.length + 1]; System.arraycopy(datas, 0, destination, 0, index); destination[index] = data; System.arraycopy(datas, index, destination, index + 1, datas.length - index); datas = destination; return true; &#125; /** * åœ¨é¡ºåºè¡¨æœ«å°¾å¤„æ’å…¥å…ƒç´  * åˆ†æï¼šæ—¶é—´å¤æ‚åº¦O(n) * åŒä¸Šé¢ä¸€æ ·ï¼Œä¹Ÿéœ€è¦åˆ›å»ºæ–°æ•°ç»„ * @param data * @return */ @Override public boolean add(T data) &#123; Object destination[] = new Object[datas.length + 1]; System.arraycopy(datas, 0, destination, 0, datas.length); destination[datas.length] = data; datas = destination; return true; &#125; /** * æœ‰åºè¡¨æ·»åŠ å…ƒç´  * @param data * @return */ public boolean addByOrder(int data) &#123; int index = 0; //æ‰¾åˆ°é¡ºåºè¡¨ä¸­ç¬¬ä¸€ä¸ªå¤§äºç­‰äºdataçš„å…ƒç´  while(index&lt;datas.length &amp;&amp; (int)datas[index]&lt;data) index++; if((int)datas[index] == data) //ä¸èƒ½æœ‰ç›¸åŒå…ƒç´  return false; Object destination[] = new Object[datas.length + 1]; System.arraycopy(datas, 0, destination, 0, index); //å°†datas[index]åŠåé¢å…ƒç´ åç§»ä¸€ä½ System.arraycopy(datas, index, destination, index+1, datas.length-index); destination[index] = data; datas = destination; return true; &#125; /** * ç§»é™¤æŒ‡å®šç´¢å¼•çš„å…ƒç´  * åˆ†æï¼šæ—¶é—´å¤æ‚åº¦O(n) * æ­¤å¤„ç”±äºæ•°ç»„å…ƒç´ æ•°é‡-1ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºæ–°æ•°ç»„ã€‚ * ArrayListç”±äºæ˜¯åŠ¨æ€æ•°ç»„ï¼ˆlist.size()â‰ data.lengthï¼‰ï¼Œæ‰€ä»¥åªéœ€è¦å°†åˆ é™¤çš„å…ƒç´ ä¹‹åçš„å‰ç§»ä¸€ä½ * @param index * @return */ @Override public T remove(int index) &#123; if (index &gt;= datas.length || index &lt; 0) throw new IndexOutOfBoundsException(); T oldValue = (T) datas[index]; fastRemove(index); return oldValue; &#125; /** * åˆ é™¤æŒ‡å®šå€¼çš„ç¬¬ä¸€ä¸ªå…ƒç´  * @param data * @return */ @Override public boolean remove(T data) &#123; if (data == null) &#123; for (int index = 0; index &lt; datas.length; index++) if (datas[index] == null) &#123; fastRemove(index); return true; &#125; &#125; else &#123; for (int index = 0; index &lt; datas.length; index++) if (data.equals(datas[index])) &#123; fastRemove(index); return true; &#125; &#125; return false; &#125; /** * ç§»é™¤æŒ‡å®šåºåˆ—çš„å…ƒç´  * @param index */ private void fastRemove(int index) &#123; Object destination[] = new Object[datas.length - 1]; System.arraycopy(datas, 0, destination, 0, index); System.arraycopy(datas, index+1, destination, index, datas.length - index-1); datas = destination; &#125; @Override public boolean removeAll(T data) &#123; return false; &#125; @Override public void clear() &#123; datas = new Object[]&#123;&#125;; &#125; @Override public String toString() &#123; if(isEmpty()) return \"\"; String str = \"[\"; for(int i = 0; i&lt;datas.length; i++)&#123; str += (datas[i]+\", \"); &#125; str = str.substring(0, str.lastIndexOf(\", \")); return str+\"]\"; &#125;&#125;ç®—æ³•åˆ†æï¼šæ’å…¥å…ƒç´ ï¼šåˆ é™¤å…ƒç´ ï¼š**çº¿æ€§è¡¨çš„é“¾å¼å­˜å‚¨ç»“æ„é¡ºåºè¡¨å¿…é¡»å ç”¨ä¸€æ•´å—äº‹å…ˆåˆ†é…å¤§å°å›ºå®šçš„å­˜å‚¨ç©ºé—´ï¼Œè¿™æ ·ä¸ä¾¿äºå­˜å‚¨ç©ºé—´çš„ç®¡ç†ã€‚ä¸ºæ­¤æå‡ºäº†å¯ä»¥å®ç°å­˜å‚¨ç©ºé—´åŠ¨æ€ç®¡ç†çš„é“¾å¼å­˜å‚¨æ–¹å¼â€“é“¾è¡¨ã€‚é“¾è¡¨åœ¨é“¾å¼å­˜å‚¨ä¸­ï¼Œæ¯ä¸ªå­˜å‚¨ç»“ç‚¹ä¸ä»…åŒ…å«å…ƒç´ æœ¬èº«çš„ä¿¡æ¯ï¼ˆæ•°æ®åŸŸï¼‰ï¼Œè¿˜åŒ…å«å…ƒç´ ä¹‹é—´é€»è¾‘å…³ç³»çš„ä¿¡æ¯ï¼Œå³ä¸€ä¸ªç»“ç‚¹ä¸­åŒ…å«æœ‰ç›´æ¥åç»§ç»“ç‚¹çš„åœ°å€ä¿¡æ¯ï¼Œè¿™ç§°ä¸ºæŒ‡é’ˆåŸŸã€‚è¿™æ ·å¯ä»¥é€šè¿‡ä¸€ä¸ªç»“ç‚¹çš„æŒ‡é’ˆåŸŸæ–¹ä¾¿çš„æ‰¾åˆ°åç»§ç»“ç‚¹çš„ä½ç½®ã€‚ç”±äºé¡ºåºè¡¨ä¸­æ¯ä¸ªå…ƒç´ è‡³å¤šåªæœ‰ä¸€ä¸ªç›´æ¥å‰é©±å…ƒç´ å’Œä¸€ä¸ªç›´æ¥åç»§å…ƒç´ ã€‚å½“é‡‡ç”¨é“¾å¼å­˜å‚¨æ—¶ï¼Œä¸€ç§æœ€ç®€å•ä¹Ÿæœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯ï¼šåœ¨æ¯ä¸ªç»“ç‚¹ä¸­é™¤åŒ…å«æ•°æ®åŸŸå¤–ï¼Œåªè®¾ç½®ä¸€ä¸ªæŒ‡é’ˆåŸŸç”¨ä»¥æŒ‡å‘å…¶ç›´æ¥åç»§ç»“ç‚¹ï¼Œè¿™ç§æ„æˆçš„é“¾æ¥è¡¨ç§°ä¸ºçº¿æ€§å•å‘é“¾æ¥è¡¨ï¼Œç®€ç§°å•é“¾è¡¨ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯ï¼Œåœ¨æ¯ä¸ªç»“ç‚¹ä¸­é™¤åŒ…å«æ•°å€¼åŸŸå¤–ï¼Œè®¾ç½®ä¸¤ä¸ªæŒ‡é’ˆåŸŸï¼Œåˆ†åˆ«ç”¨ä»¥æŒ‡å‘ç›´æ¥å‰é©±ç»“ç‚¹å’Œç›´æ¥åç»§ç»“ç‚¹ï¼Œè¿™æ ·æ„æˆçš„é“¾æ¥è¡¨ç§°ä¸ºçº¿æ€§åŒå‘é“¾æ¥è¡¨ï¼Œç®€ç§°åŒé“¾è¡¨ã€‚å•é“¾è¡¨å½“è®¿é—®ä¸€ä¸ªç»“ç‚¹åï¼Œåªèƒ½æ¥ç€è®¿é—®å®ƒçš„ç›´æ¥åç»§ç»“ç‚¹ï¼Œè€Œæ— æ³•è®¿é—®ä»–çš„ç›´æ¥å‰é©±ç»“ç‚¹ã€‚åŒé“¾è¡¨åˆ™æ—¢å¯ä»¥ä¾æ¬¡å‘åè®¿é—®æ¯ä¸ªç»“ç‚¹ï¼Œä¹Ÿå¯ä»¥ä¾æ¬¡å‘å‰è®¿é—®æ¯ä¸ªç»“ç‚¹ã€‚å•é“¾è¡¨ç»“ç‚¹å…ƒç´ ç±»å‹å®šä¹‰ï¼š1234public class LNode &#123; protected LNode next; //æŒ‡é’ˆåŸŸï¼ŒæŒ‡å‘ç›´æ¥åç»§ç»“ç‚¹ protected Object data; //æ•°æ®åŸŸ&#125;åŒé“¾è¡¨ç»“ç‚¹å…ƒç´ ç±»å‹å®šä¹‰ï¼š12345public class DNode &#123; protected DNode prior; //æŒ‡é’ˆåŸŸï¼ŒæŒ‡å‘ç›´æ¥å‰é©±ç»“ç‚¹ protected DNode next; //æŒ‡é’ˆåŸŸï¼ŒæŒ‡å‘ç›´æ¥åç»§ç»“ç‚¹ protected Object data; //æ•°æ®åŸŸ&#125;åœ¨é¡ºåºè¡¨ä¸­ï¼Œé€»è¾‘ä¸Šç›¸é‚»çš„å…ƒç´ ï¼Œå¯¹åº”çš„å­˜å‚¨ä½ç½®ä¹Ÿç›¸é‚»ï¼Œæ‰€ä»¥è¿›è¡Œæ’å…¥æˆ–åˆ é™¤æ“ä½œæ—¶ï¼Œé€šå¸¸éœ€è¦å¹³å‡ç§»åŠ¨åŠä¸ªè¡¨çš„å…ƒç´ ï¼Œè¿™æ˜¯ç›¸å½“è´¹æ—¶çš„æ“ä½œã€‚åœ¨é“¾è¡¨ä¸­ï¼Œæ¯ä¸ªç»“ç‚¹å­˜å‚¨ä½ç½®å¯ä»¥ä»»æ„å®‰æ’ï¼Œä¸å¿…è¦æ±‚ç›¸é‚»ï¼Œæ’å…¥æˆ–åˆ é™¤æ“ä½œåªéœ€è¦ä¿®æ”¹ç›¸å…³ç»“ç‚¹çš„æŒ‡é’ˆåŸŸå³å¯ï¼Œæ–¹ä¾¿çœæ—¶ã€‚å¯¹äºå•é“¾è¡¨ï¼Œå¦‚æœè¦åœ¨ç»“ç‚¹pä¹‹å‰æ’å…¥ä¸€ä¸ªæ–°ç»“ç‚¹ï¼Œç”±äºé€šè¿‡på¹¶ä¸èƒ½æ‰¾åˆ°å…¶å‰é©±ç»“ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä»é“¾è¡¨è¡¨å¤´éå†è‡³pçš„å‰é©±ç»“ç‚¹ç„¶åè¿›è¡Œæ’å…¥æ“ä½œï¼Œè¿™æ ·æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(n)ï¼Œè€Œé¡ºåºè¡¨æ’å…¥åˆ é™¤ç»“ç‚¹æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯O(n)ï¼Œé‚£ä¸ºä»€ä¹ˆè¯´é“¾è¡¨æ’å…¥åˆ é™¤æ“ä½œæ›´åŠ é«˜æ•ˆå‘¢ï¼Ÿå› ä¸ºå•é“¾è¡¨æ’å…¥åˆ é™¤æ“ä½œæ‰€æ¶ˆè€—çš„æ—¶é—´ä¸»è¦åœ¨äºæŸ¥æ‰¾å‰é©±ç»“ç‚¹ï¼Œè¿™ä¸ªæŸ¥æ‰¾å·¥ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œè€ŒçœŸæ­£è¶…å¦‚åˆ é™¤æ—¶é—´ä¸ºO(1)è¿˜æœ‰é¡ºåºè¡¨éœ€è¦ç§»åŠ¨ç»“ç‚¹ï¼Œç§»åŠ¨ç»“ç‚¹é€šå¸¸æ¯”å•çº¯çš„æŸ¥æ‰¾æ›´åŠ è´¹æ—¶ï¼Œé“¾è¡¨ä¸éœ€è¦è¿ç»­çš„ç©ºé—´ï¼Œä¸éœ€è¦æ‰©å®¹åˆ›å»ºæ–°è¡¨ï¼Œæ‰€ä»¥åŒæ ·æ—¶é—´å¤æ‚åº¦O(n)ï¼Œé“¾è¡¨æ›´é€‚åˆæ’å…¥å’Œåˆ é™¤æ“ä½œã€‚å¯¹äºéå†æŸ¥æ‰¾å‰é©±ç»“ç‚¹çš„é—®é¢˜ï¼Œåœ¨åŒé“¾è¡¨ä¸­å°±èƒ½å¾ˆå¥½çš„è§£å†³ï¼ŒåŒé“¾è¡¨åœ¨å·²çŸ¥æŸç»“ç‚¹çš„æ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦æ˜¯O(1)ã€‚ç”±äºé“¾è¡¨çš„æ¯ä¸ªç»“ç‚¹å¸¦æœ‰æŒ‡é’ˆåŸŸï¼Œä»å­˜å‚¨å¯†åº¦æ¥è®²ï¼Œè¿™æ˜¯ä¸ç»æµçš„ã€‚æ‰€è°“å­˜å‚¨å¯†åº¦æ˜¯æŒ‡ç»“ç‚¹æ•°æ®æœ¬èº«æ‰€å å­˜å‚¨é‡å’Œæ•´æ”¹ç»“ç‚¹ç»“æ„æ‰€å å­˜å‚¨é‡ä¹‹æ¯”ã€‚3.2 å•é“¾è¡¨åŸºæœ¬è¿ç®—çš„å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534public class LinkList&lt;T&gt; implements IList&lt;T&gt;&#123; public LNode&lt;T&gt; head; //å•é“¾è¡¨å¼€å§‹ç»“ç‚¹ /** * 1.1 åˆ›å»ºå•é“¾è¡¨ï¼ˆå¤´æ’æ³•ï¼šå€’åºï¼‰ * è§£ï¼šéå†æ•°ç»„ï¼Œåˆ›å»ºæ–°ç»“ç‚¹ï¼Œæ–°ç»“ç‚¹çš„æŒ‡é’ˆåŸŸæŒ‡å‘å¤´ç»“ç‚¹ï¼Œè®©æ–°ç»“ç‚¹ä½œä¸ºå¤´ç»“ç‚¹ * æ—¶é—´å¤æ‚åº¦O(n) * @param array * @return */ public static &lt;T&gt; LinkList&lt;T&gt; createListF(T[] array)&#123; LinkList llist = new LinkList(); if(array!=null &amp;&amp; array.length&gt;0) &#123; for (T obj : array) &#123; LNode&lt;T&gt; node = new LNode(); node.data = obj; node.next = llist.head; llist.head = node; &#125; &#125; return llist; &#125; /** * 1.2 åˆ›å»ºå•é“¾è¡¨ï¼ˆå°¾æ’æ³•ï¼šé¡ºåºï¼‰ * è§£ï¼š * æ—¶é—´å¤æ‚åº¦O(n) * @param array * @return */ public static &lt;T&gt; LinkList&lt;T&gt; createListR(T[] array)&#123; LinkList llist = new LinkList(); if(array!=null &amp;&amp; array.length&gt;0)&#123; llist.head = new LNode(); llist.head.data = array[0]; LNode&lt;T&gt; temp = llist.head; for(int i = 1; i &lt; array.length; i++)&#123; LNode node = new LNode(); node.data = array[i]; temp.next = node; temp = node; &#125; &#125; return llist; &#125; /** * åˆ¤æ–­å•é“¾è¡¨æ˜¯å¦ä¸ºç©ºè¡¨ * æ—¶é—´å¤æ‚åº¦O(1) * @return */ @Override public boolean isEmpty() &#123; return head==null; &#125; /** * 4 è·å–å•é“¾è¡¨é•¿åº¦ * æ—¶é—´å¤æ‚åº¦O(n) * @return */ @Override public int length() &#123; if(head==null) return 0; int l = 1; LNode node = head; while(node.next!=null) &#123; l++; node = node.next; &#125; return l; &#125; @Override public void clear() &#123; head = null; &#125; @Override public T set(int index, T data) &#123; return null; &#125; @Override public boolean contains(T data) &#123; return false; &#125; @Override public T get(int index) &#123; return getNode(index).data; &#125; /** * 6.1 è·å–æŒ‡å®šç´¢å¼•çš„ç»“ç‚¹ * æ—¶é—´å¤æ‚åº¦O(n) * @param index * @return */ public LNode&lt;T&gt; getNode(int index)&#123; LNode node = head; int j = 0; while(j &lt; index &amp;&amp; node!=null)&#123; j++; node = node.next; &#125; return node; &#125; /** * 6.2 è·å–æŒ‡å®šæ•°æ®å€¼ç»“ç‚¹çš„ç´¢å¼• * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(1) * @param data * @return */ @Override public int indexOf(T data) &#123; if(head==null) return -1; //æ²¡æœ‰æ­¤ç»“ç‚¹ LNode node = head; int j = 0; while(node!=null)&#123; if(node.data.equals(data)) return j; j++; node = node.next; &#125; return -1; &#125; @Override public int lastIndexOf(T data) &#123; if(head==null) return -1; int index = -1; LNode node = head; int j = 0; while(node!=null)&#123; if(node.data.equals(data)) &#123; index = j; &#125; j++; node = node.next; &#125; return index; &#125; /** * 6.3 å•é“¾è¡¨ä¸­çš„å€’æ•°ç¬¬kä¸ªç»“ç‚¹ï¼ˆk &gt; 0ï¼‰ * è§£ï¼šå…ˆæ‰¾åˆ°é¡ºæ•°ç¬¬kä¸ªç»“ç‚¹ï¼Œç„¶åä½¿ç”¨å‰åæŒ‡é’ˆç§»åŠ¨åˆ°ç»“å°¾å³å¯ * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(1) * @param k * @return */ public LNode&lt;T&gt; getReNode(int k)&#123; if(head==null) return null; int len = length(); if(k &gt; len) return null; LNode target = head; LNode next = head; for(int i=0;i &lt; k;i++) next = next.next; while(next!=null)&#123; target = target.next; next = next.next; &#125; return target; &#125; /** * 6.4 æŸ¥æ‰¾å•é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹ * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(1) * @return */ public LNode getMiddleNode()&#123; if(head == null|| head.next == null) return head; LNode target = head; LNode temp = head; while(temp != null &amp;&amp; temp.next != null)&#123; target = target.next; temp = temp.next.next; &#125; return target; &#125; /** * 2.1 å°†å•é“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªå•é“¾è¡¨ * è§£ï¼šéå†ç¬¬ä¸€ä¸ªè¡¨ï¼Œç”¨å…¶å°¾ç»“ç‚¹æŒ‡å‘ç¬¬äºŒä¸ªè¡¨å¤´ç»“ç‚¹ * æ—¶é—´å¤æ‚åº¦O(n) * @return */ public static LNode mergeList(LNode head1, LNode head2)&#123; if(head1==null) return head2; if(head2==null) return head1; LNode loop = head1; while(loop.next!=null) //æ‰¾åˆ°list1å°¾ç»“ç‚¹ loop = loop.next; loop.next = head2; //å°†list1å°¾ç»“ç‚¹æŒ‡å‘list2å¤´ç»“ç‚¹ return head1; &#125; /** * 2.1 é€šè¿‡é€’å½’ï¼Œåˆå¹¶ä¸¤ä¸ªæœ‰åºçš„å•é“¾è¡¨head1å’Œhead2 * * è§£ï¼šä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘ä¸¤ä¸ªå¤´ç»“ç‚¹ï¼Œæ¯”è¾ƒä¸¤ä¸ªç»“ç‚¹å¤§å°ï¼Œ * å°çš„ç»“ç‚¹æŒ‡å‘ä¸‹ä¸€æ¬¡æ¯”è¾ƒç»“æœï¼ˆä¸¤è€…ä¸­è¾ƒå°ï¼‰ï¼Œæœ€ç»ˆè¿”å›ç¬¬ä¸€æ¬¡é€’å½’çš„æœ€å°ç»“ç‚¹ * @param head1 * @param head2 * @return */ public static LNode mergeSortedListRec(LNode head1, LNode head2)&#123; if(head1==null)return head2; if(head2==null)return head1; if (((int)head1.data)&gt;((int)head2.data)) &#123; head2.next = mergeSortedListRec(head2.next, head1); return head2; &#125; else &#123; head1.next = mergeSortedListRec(head1.next, head2); return head1; &#125; &#125; /** * 3.1 å¾ªç¯çš„æ–¹å¼å°†å•é“¾è¡¨åè½¬ * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(1) */ public void reverseListByLoop() &#123; if (head == null || head.next == null) return; LNode pre = null; LNode nex = null; while (head != null) &#123; nex = head.next; head.next = pre; pre = head; head = nex; &#125; head = pre; &#125; /** * 3.2 é€’å½’çš„æ–¹å¼å°†å•é“¾è¡¨åè½¬,è¿”å›åè½¬åçš„é“¾è¡¨å¤´ç»“ç‚¹ * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(n) */ public LNode reverseListByRec(LNode head) &#123; if(head==null||head.next==null) return head; LNode reHead = reverseListByRec(head.next); head.next.next = head; head.next = null; return reHead; &#125; /** * 5.1 è·å–å•é“¾è¡¨å­—ç¬¦ä¸²è¡¨ç¤º * æ—¶é—´å¤æ‚åº¦O(n) */ @Override public String toString() &#123; if(head == null) return \"\"; LNode node = head; StringBuffer buffer = new StringBuffer(); while(node != null)&#123; buffer.append(node.data+\" -&gt; \"); node = node.next; &#125; return buffer.toString(); &#125; public static String display(LNode head)&#123; if(head == null) return \"\"; LNode node = head; StringBuffer buffer = new StringBuffer(); while(node != null)&#123; buffer.append(\" -&gt; \"+node.data); node = node.next; &#125; return buffer.toString(); &#125; /** * 5.2 ç”¨æ ˆçš„æ–¹å¼è·å–å•é“¾è¡¨ä»å°¾åˆ°å¤´å€’å™å­—ç¬¦ä¸²è¡¨ç¤º * è§£ï¼šç”±äºæ ˆå…·æœ‰å…ˆè¿›åå‡ºçš„ç‰¹æ€§ï¼Œç°å°†è¡¨ä¸­çš„å…ƒç´ æ”¾å…¥æ ˆä¸­ï¼Œç„¶åå–å‡ºå°±å€’åºäº† * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(1) * @return */ public String displayReverseStack()&#123; if(head == null) return \"\"; Stack &lt;LNode&gt; stack = new Stack &lt; &gt;(); //å †æ ˆ å…ˆè¿›å…ˆå‡º LNode head = this.head; while(head!=null)&#123; stack.push(head); head=head.next; &#125; StringBuffer buffer = new StringBuffer(); while(!stack.isEmpty())&#123; //pop()ç§»é™¤å †æ ˆé¡¶éƒ¨çš„å¯¹è±¡ï¼Œå¹¶å°†è¯¥å¯¹è±¡ä½œä¸ºè¯¥å‡½æ•°çš„å€¼è¿”å›ã€‚ buffer.append(\" -&gt; \"+stack.pop().data); &#125; return buffer.toString(); &#125; /** * 5.3 ç”¨é€’å½’çš„æ–¹å¼è·å–å•é“¾è¡¨ä»å°¾åˆ°å¤´å€’å™å­—ç¬¦ä¸²è¡¨ç¤º * @return */ public void displayReverseRec(StringBuffer buffer, LNode head)&#123; if(head==null) return; displayReverseRec(buffer, head.next); buffer.append(\" -&gt; \"); buffer.append(head.data); &#125; /** * 7.1 æ’å…¥ç»“ç‚¹ * è§£ï¼šå…ˆæ‰¾åˆ°ç¬¬i-1ä¸ªç»“ç‚¹ï¼Œè®©åˆ›å»ºçš„æ–°ç»“ç‚¹çš„æŒ‡é’ˆåŸŸæŒ‡å‘ç¬¬i-1ç»“ç‚¹æŒ‡é’ˆåŸŸæŒ‡å‘çš„ç»“ç‚¹ï¼Œ * ç„¶åå°†i-1ç»“ç‚¹çš„æŒ‡é’ˆåŸŸæŒ‡å‘æ–°ç»“ç‚¹ * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(1) * @param data * @param index */ @Override public boolean add(int index, T data) &#123; if(index==0)&#123; //æ’å…¥ä¸ºå¤´ç»“ç‚¹ LNode temp = new LNode(); temp.next = head; return true; &#125; int j = 0; LNode node = head; while(j &lt; index-1 &amp;&amp; node!=null)&#123; //æ‰¾åˆ°åºåˆ—å·ä¸ºindex-1çš„ç»“ç‚¹ j++; node = node.next; &#125; if(node==null) return false; LNode temp = new LNode(); //åˆ›å»ºæ–°ç»“ç‚¹ temp.data = data; temp.next = node.next; //æ–°ç»“ç‚¹æ’å…¥åˆ°Index-1ç»“ç‚¹ä¹‹å node.next = temp; return true; &#125; @Override public boolean add(T data) &#123; LNode node = head; while(node!=null &amp;&amp; node.next!=null) //æ‰¾åˆ°å°¾ç»“ç‚¹ node = node.next; LNode temp = new LNode(); //åˆ›å»ºæ–°ç»“ç‚¹ temp.data = data; node.next = temp; return false; &#125; @Override public T remove(int index) &#123; LNode&lt;T&gt; node = deleteNode(index); return node==null?null:node.data; &#125; /** * 7.2 åˆ é™¤ç»“ç‚¹ * è§£ï¼šè®©è¢«åˆ é™¤çš„ç»“ç‚¹å‰ä¸€ä¸ªç»“ç‚¹çš„æŒ‡é’ˆåŸŸæŒ‡å‘åä¸€ä¸ªç»“ç‚¹æŒ‡é’ˆåŸŸ * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(1) * @return */ public LNode deleteNode(int index)&#123; LNode node = head; if(index==0)&#123; //åˆ é™¤å¤´ç»“ç‚¹ if(node==null) return null; head = node.next; return node; &#125; //éå¤´ç»“ç‚¹ int j = 0; while(j &lt; index-1 &amp;&amp; node!=null)&#123; //æ‰¾åˆ°åºåˆ—å·ä¸ºindex-1çš„ç»“ç‚¹ j++; node = node.next; &#125; if(node==null) return null; LNode delete = node.next; if(delete==null) return null; //ä¸å­˜åœ¨ç¬¬indexä¸ªç»“ç‚¹ node.next = delete.next; return delete; &#125; @Override public boolean remove(T data) &#123; return false; &#125; @Override public boolean removeAll(T data) &#123; return false; &#125; /** * 7.3 ç»™å‡ºä¸€å•é“¾è¡¨å¤´æŒ‡é’ˆheadå’Œä¸€èŠ‚ç‚¹æŒ‡é’ˆdeleteï¼Œè¦æ±‚O(1)æ—¶é—´å¤æ‚åº¦åˆ é™¤èŠ‚ç‚¹delete * è§£ï¼šå°†deleteèŠ‚ç‚¹valueå€¼ä¸å®ƒä¸‹ä¸ªèŠ‚ç‚¹çš„å€¼äº’æ¢çš„æ–¹æ³•ï¼Œ * ä½†æ˜¯å¦‚æœdeleteæ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œä½†æ˜¯æ€»å¾—å¤æ‚åº¦è¿˜æ˜¯O(1) * @return */ public static void deleteNode(LNode head, LNode delete)&#123; if(delete==null) return; //é¦–å…ˆå¤„ç†deleteèŠ‚ç‚¹ä¸ºæœ€åä¸€ä¸ªèŠ‚ç‚¹çš„æƒ…å†µ if(delete.next==null)&#123; if(head==delete) //åªæœ‰ä¸€ä¸ªç»“ç‚¹ head = null; else&#123; //åˆ é™¤å°¾ç»“ç‚¹ LNode temp = head; while(temp.next!=delete) temp = temp.next; temp.next=null; &#125; &#125; else&#123; delete.data = delete.next.data; delete.next = delete.next.next; &#125; return; &#125; /** * 8.1 åˆ¤æ–­ä¸€ä¸ªå•é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ * è§£ï¼šä½¿ç”¨å¿«æ…¢æŒ‡é’ˆæ–¹æ³•ï¼Œå¦‚æœå­˜åœ¨ç¯ï¼Œä¸¤ä¸ªæŒ‡é’ˆå¿…å®šæŒ‡å‘åŒä¸€ç»“ç‚¹ * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(1) * @return */ public static boolean hasCycle(LNode head)&#123; LNode p1 = head; LNode p2 = head; while(p1!=null &amp;&amp; p2!=null)&#123; p1 = p1.next; //ä¸€æ¬¡è·³ä¸€æ­¥ p2 = p2.next.next; //ä¸€æ¬¡è·³ä¸¤æ­¥ if(p2 == p1) return true; &#125; return false; &#125; /** * 8.2ã€å·²çŸ¥ä¸€ä¸ªå•é“¾è¡¨ä¸­å­˜åœ¨ç¯ï¼Œæ±‚è¿›å…¥ç¯ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ * åˆ©ç”¨hashmapï¼Œä¸è¦ç”¨ArrayListï¼Œå› ä¸ºåˆ¤æ–­ArrayListæ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ çš„æ•ˆç‡ä¸é«˜ * @param head * @return */ public static LNode getFirstNodeInCycleHashMap(LNode head)&#123; LNode target = null; HashMap&lt;LNode,Boolean &gt; map=new HashMap&lt; &gt;(); while(head != null)&#123; if(map.containsKey(head)) &#123; target = head; break; &#125; else &#123; map.put(head, true); head = head.next; &#125; &#125; return target; &#125; /** * 8.3ã€å·²çŸ¥ä¸€ä¸ªå•é“¾è¡¨ä¸­å­˜åœ¨ç¯ï¼Œæ±‚è¿›å…¥ç¯ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹,ä¸ç”¨hashmap * ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œä¸åˆ¤æ–­ä¸€ä¸ªå•é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ä¸€æ ·ï¼Œæ‰¾åˆ°å¿«æ…¢æŒ‡é’ˆç¬¬ä¸€æ¬¡ç›¸äº¤çš„èŠ‚ç‚¹ï¼Œ * æ­¤æ—¶è¿™ä¸ªèŠ‚ç‚¹è·ç¦»ç¯å¼€å§‹èŠ‚ç‚¹çš„é•¿åº¦å’Œé“¾è¡¨å¤´è·ç¦»ç¯å¼€å§‹çš„èŠ‚ç‚¹çš„é•¿åº¦ç›¸ç­‰ * å‚è€ƒ https://www.cnblogs.com/fankongkong/p/7007869.html * @param head * @return */ public static LNode getFirstNodeInCycle(LNode head)&#123; LNode fast = head; LNode slow = head; while(fast != null &amp;&amp; fast.next != null)&#123; slow = slow.next; fast = fast.next.next; if(slow == fast) break; &#125; if(fast == null||fast.next == null) return null;//åˆ¤æ–­æ˜¯å¦åŒ…å«ç¯ //ç›¸é‡èŠ‚ç‚¹è·ç¦»ç¯å¼€å§‹èŠ‚ç‚¹çš„é•¿åº¦å’Œé“¾è¡¨æŠ•è·ç¦»ç¯å¼€å§‹çš„èŠ‚ç‚¹çš„é•¿åº¦ç›¸ç­‰ slow=head; while(slow!=fast)&#123; slow=slow.next; fast=fast.next; &#125;//åŒæ­¥èµ° return slow; &#125; /** * 9ã€åˆ¤æ–­ä¸¤ä¸ªå•é“¾è¡¨æ˜¯å¦ç›¸äº¤,å¦‚æœç›¸äº¤è¿”å›ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦åˆ™è¿”å›null * â‘ ã€æš´åŠ›éå†ä¸¤ä¸ªè¡¨ï¼Œæ˜¯å¦æœ‰ç›¸åŒçš„ç»“ç‚¹(æ—¶é—´å¤æ‚åº¦O(nÂ²)) * â‘¡ã€ç¬¬ä¸€ä¸ªè¡¨çš„å°¾ç»“ç‚¹æŒ‡å‘ç¬¬äºŒä¸ªè¡¨å¤´ç»“ç‚¹ï¼Œç„¶ååˆ¤æ–­ç¬¬äºŒä¸ªè¡¨æ˜¯å¦å­˜åœ¨ç¯ï¼Œä½†ä¸å®¹æ˜“æ‰¾å‡ºäº¤ç‚¹ï¼ˆæ—¶é—´å¤æ‚åº¦O(n)ï¼‰ * â‘¢ã€ä¸¤ä¸ªé“¾è¡¨ç›¸äº¤ï¼Œå¿…ç„¶ä¼šç»è¿‡åŒä¸€ä¸ªç»“ç‚¹ï¼Œè¿™ä¸ªç»“ç‚¹çš„åç»§ç»“ç‚¹ä¹Ÿæ˜¯ç›¸åŒçš„ï¼ˆé“¾è¡¨ç»“ç‚¹åªæœ‰ä¸€ä¸ªæŒ‡é’ˆåŸŸï¼Œåç»§ç»“ç‚¹åªèƒ½æœ‰ä¸€ä¸ªï¼‰ï¼Œ * æ‰€ä»¥ä»–ä»¬çš„å°¾ç»“ç‚¹å¿…ç„¶ç›¸åŒã€‚ä¸¤ä¸ªé“¾è¡¨ç›¸äº¤ï¼Œåªèƒ½æ˜¯å‰é¢çš„ç»“ç‚¹ä¸åŒï¼Œæ‰€ä»¥ï¼Œç æ‰è¾ƒé•¿é“¾è¡¨çš„å·®å€¼ååŒæ­¥éå†ï¼Œåˆ¤æ–­ç»“ç‚¹æ˜¯å¦ç›¸åŒï¼Œç›¸åŒçš„å°±æ˜¯äº¤ç‚¹äº†ã€‚ * æ—¶é—´å¤æ‚åº¦ï¼ˆæ—¶é—´å¤æ‚åº¦O(n)ï¼‰ * @param list1 * @param list2 * @return äº¤ç‚¹ */ public static LNode isIntersect(LinkList list1, LinkList list2)&#123; LNode head1 = list1.head; LNode head2 = list2.head; if(head1==null || head2==null)return null; int len1 = list1.length(); int len2 = list2.length(); //ç æ‰è¾ƒé•¿é“¾è¡¨çš„å·®å€¼ if(len1 &gt;= len2)&#123; for(int i=0;i &lt; len1-len2;i++)&#123; head1=head1.next; &#125; &#125;else&#123; for(int i=0;i &lt; len2-len1;i++)&#123; head2=head2.next; &#125; &#125; //åŒæ­¥éå† while(head1 != null&amp;&amp;head2 != null)&#123; if(head1 == head2) return head1; head1=head1.next; head2=head2.next; &#125; return null; &#125;&#125;ç®—æ³•åˆ†æåˆ¤æ–­ä¸€ä¸ªå•é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯æˆ‘ä»¬å¯ä»¥é€šè¿‡HashMapåˆ¤æ–­ï¼Œéå†ç»“ç‚¹ï¼Œå°†ç»“ç‚¹å€¼æ”¾å…¥HashMapï¼Œå¦‚æœæŸä¸€åˆ»å‘ç°å½“å‰ç»“ç‚¹åœ¨mapä¸­å·²ç»å­˜åœ¨ï¼Œåˆ™å­˜åœ¨ç¯ï¼Œå¹¶ä¸”æ­¤ç»“ç‚¹æ­£æ˜¯ç¯çš„å…¥å£ï¼Œæ­¤ç®—æ³•è§8.2æ–¹æ³•ã€‚ä½†æ˜¯æœ‰ä¸€ç§é—®æ³•æ˜¯ä¸é€šè¿‡ä»»ä½•å…¶ä»–æ•°æ®ç»“æ„æ€ä¹ˆåˆ¤æ–­å•é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯ã€‚è¿™æ ·æˆ‘ä»¬å¯åˆ©ç”¨çš„å°±åªæœ‰å•é“¾è¡¨æœ¬èº«ï¼Œä¸€ç§è§£æ³•æ˜¯é€šè¿‡å¿«æ…¢æŒ‡é’ˆï¼Œéå†é“¾è¡¨ï¼Œä¸€ä¸ªæŒ‡é’ˆè·³ä¸€æ­¥ï¼ˆæ…¢æŒ‡é’ˆæ­¥é•¿ä¸º1ï¼‰ï¼Œå¦ä¸€ä¸ªæŒ‡é’ˆè·³ä¸¤æ­¥ï¼ˆå¿«æŒ‡é’ˆæ­¥é•¿ä¸º2ï¼‰ï¼Œå¦‚æœå­˜åœ¨ç¯ï¼Œè¿™ä¸¤ä¸ªæŒ‡é’ˆå¿…å°†åœ¨æŸä¸€åˆ»æŒ‡å‘åŒä¸€ç»“ç‚¹ï¼Œå‡è®¾æ­¤æ—¶æ…¢æŒ‡é’ˆè·³äº†næ­¥ï¼Œåˆ™å¿«æŒ‡é’ˆè·³çš„æ­¥æ•°ä¸ºn/2æ­¥ï¼šåˆ¤æ–­ä¸¤ä¸ªå•é“¾è¡¨æ˜¯å¦ç›¸äº¤ç”±äºå•é“¾è¡¨çš„ç‰¹æ€§ï¼ˆåªæœ‰ä¸€ä¸ªæŒ‡é’ˆåŸŸï¼‰ï¼Œå¦‚æœä¸¤ä¸ªè¡¨ç›¸äº¤ï¼Œé‚£å¿…å®šæ˜¯Yå½¢ç›¸äº¤ï¼Œä¸ä¼šæ˜¯Xå½¢ç›¸äº¤ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚ä¸¤ä¸ªå•é“¾è¡¨åé¢çš„ç»“ç‚¹ç›¸åŒï¼Œä¸åŒçš„éƒ¨åˆ†åªæœ‰å‰é¢ï¼Œç æ‰è¾ƒé•¿çš„é“¾è¡¨çš„å‰é¢éƒ¨åˆ†ï¼Œç„¶åä¸¤ä¸ªé“¾è¡¨åŒæ­¥éå†ï¼Œå¿…å°†æŒ‡å‘åŒä¸€ä¸ªç»“ç‚¹ï¼Œè¿™ä¸ªç»“ç‚¹å°±æ˜¯äº¤ç‚¹ï¼šåŒé“¾è¡¨åŒé“¾è¡¨ä¸­æ¯ä¸ªç»“ç‚¹æœ‰ä¸¤ä¸ªæŒ‡é’ˆåŸŸï¼Œä¸€ä¸ªæŒ‡å‘å…¶ç›´æ¥åç»§ç»“ç‚¹ï¼Œä¸€ä¸ªæŒ‡å‘å…¶ç›´æ¥å‰é©±ç»“ç‚¹ã€‚å»ºç«‹åŒé“¾è¡¨ä¹Ÿæœ‰ä¸¤ç§æ–¹æ³•ï¼Œå¤´æ’æ³•å’Œå°¾æ’æ³•ï¼Œè¿™ä¸åˆ›å»ºå•é“¾è¡¨è¿‡ç¨‹ç›¸ä¼¼ã€‚åœ¨åŒé“¾è¡¨ä¸­ï¼Œæœ‰äº›ç®—æ³•å¦‚æ±‚é•¿åº¦ã€å–å…ƒç´ å€¼ã€æŸ¥æ‰¾å…ƒç´ ç­‰ç®—æ³•ä¸å•é“¾è¡¨ä¸­ç›¸åº”ç®—æ³•æ˜¯ç›¸åŒçš„ã€‚ä½†æ˜¯åœ¨å•é“¾è¡¨ä¸­ï¼Œè¿›è¡Œç»“ç‚¹æ’å…¥å’Œåˆ é™¤æ—¶æ¶‰åŠå‰åç»“ç‚¹çš„ä¸€ä¸ªæŒ‡é’ˆåŸŸçš„å˜åŒ–ï¼Œè€ŒåŒé“¾è¡¨ä¸­ç»“ç‚¹çš„æ’å…¥å’Œåˆ é™¤æ“ä½œæ¶‰åŠå‰åç»“ç‚¹çš„ä¸¤ä¸ªæŒ‡é’ˆåŸŸçš„å˜åŒ–ã€‚javaä¸­LinkedListæ­£æ˜¯å¯¹åŒé“¾è¡¨çš„å®ç°ï¼Œç®—æ³•å¯å‚è€ƒæ­¤ç±»ã€‚åŒé“¾è¡¨åŸºæœ¬è¿ç®—çš„å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327public class DLinkList&lt;T&gt; implements IList&lt;T&gt;&#123; transient DNode&lt;T&gt; first; //åŒé“¾è¡¨å¼€å§‹ç»“ç‚¹ transient DNode&lt;T&gt; last; //åŒé“¾è¡¨æœ«ç«¯ç»“ç‚¹ private int size; //ç»“ç‚¹æ•° /** * åˆ›å»ºå•é“¾è¡¨ï¼ˆå¤´æ’æ³•ï¼šå€’åºï¼‰ * æ—¶é—´å¤æ‚åº¦O(n) * @param array * @return */ public static &lt;T&gt; DLinkList&lt;T&gt; createListF(T[] array)&#123; DLinkList dlist = new DLinkList(); if(array!=null &amp;&amp; array.length&gt;0) &#123; dlist.size = array.length; for (T obj : array) &#123; DNode&lt;T&gt; node = new DNode(); node.data = obj; node.next = dlist.first; if(dlist.first!=null) dlist.first.prior = node; //ç›¸æ¯”å•é“¾è¡¨å¤šäº†æ­¤æ­¥ else dlist.last = node; dlist.first = node; &#125; &#125; return dlist; &#125; /** * 1.2 åˆ›å»ºå•é“¾è¡¨ï¼ˆå°¾æ’æ³•ï¼šé¡ºåºï¼‰ * æ—¶é—´å¤æ‚åº¦O(n) * @param array * @return */ public static &lt;T&gt; DLinkList&lt;T&gt; createListR(T[] array)&#123; DLinkList dlist = new DLinkList(); if(array!=null &amp;&amp; array.length&gt;0)&#123; dlist.size = array.length; dlist.first = new DNode&lt;T&gt;(); dlist.first.data = array[0]; dlist.last = dlist.first; for(int i = 1; i &lt; array.length; i++)&#123; DNode&lt;T&gt; node = new DNode(); node.data = array[i]; dlist.last.next = node; node.prior = dlist.last; //ç›¸æ¯”å•é“¾è¡¨å¤šäº†æ­¤æ­¥ dlist.last = node; &#125; &#125; return dlist; &#125; @Override public boolean isEmpty() &#123; return size==0; &#125; @Override public int length() &#123; return size; &#125; /**2 æ·»åŠ ç»“ç‚¹*/ @Override public boolean add(int index, T data) &#123; if(index &lt; 0 || index &gt; size) throw new IndexOutOfBoundsException(); DNode&lt;T&gt; newNode = new DNode(); newNode.data = data; if (index == size) &#123; //åœ¨æœ«å°¾æ·»åŠ ç»“ç‚¹ä¸éœ€è¦éå† final DNode&lt;T&gt; l = last; if (l == null) //ç©ºè¡¨ first = newNode; else &#123; l.next = newNode; newNode.prior = l; &#125; last = newNode; size++; &#125; else &#123; //å…¶ä»–ä½ç½®æ·»åŠ ç»“ç‚¹éœ€è¦éå†æ‰¾åˆ°indexä½ç½®çš„ç»“ç‚¹ DNode&lt;T&gt; indexNode = getNode(index); DNode&lt;T&gt; pred = indexNode.prior; newNode.prior = pred; newNode.next = indexNode; indexNode.prior = newNode; if (pred == null) first = newNode; else pred.next = newNode; size++; &#125; return false; &#125; @Override public boolean add(T data) &#123; return add(size, data); &#125; /**3 åˆ é™¤ç»“ç‚¹*/ @Override public T remove(int index) &#123; if(index &lt; 0 || index &gt;= size) throw new IndexOutOfBoundsException(); return unlink(getNode(index)); &#125; @Override public boolean remove(T data) &#123; if (data == null) &#123; for (DNode&lt;T&gt; x = first; x != null; x = x.next) &#123; if (x.data == null) &#123; unlink(x); return true; &#125; &#125; &#125; else &#123; for (DNode&lt;T&gt; x = first; x != null; x = x.next) &#123; if (data.equals(x.data)) &#123; unlink(x); return true; &#125; &#125; &#125; return false; &#125; @Override public boolean removeAll(T data) &#123; boolean result = false; if (data == null) &#123; for (DNode&lt;T&gt; x = first; x != null; x = x.next) &#123; if (x.data == null) &#123; unlink(x); result = true; &#125; &#125; &#125; else &#123; for (DNode&lt;T&gt; x = first; x != null; x = x.next) &#123; if (data.equals(x.data)) &#123; unlink(x); result = true; &#125; &#125; &#125; return result; &#125; /** * å°†æŒ‡å®šçš„ç»“ç‚¹è§£é™¤é“¾æ¥ * @param x * @return */ private T unlink(DNode&lt;T&gt; x) &#123; // assert x != null; final T element = x.data; final DNode&lt;T&gt; next = x.next; final DNode&lt;T&gt; prev = x.prior; if (prev == null) &#123; first = next; &#125; else &#123; prev.next = next; x.prior = null; &#125; if (next == null) &#123; last = prev; &#125; else &#123; next.prior = prev; x.next = null; &#125; x.data = null; size--; return element; &#125; /** * æ¸…ç©º */ @Override public void clear() &#123; for (DNode&lt;T&gt; x = first; x != null; ) &#123; DNode&lt;T&gt; next = x.next; x.data = null; x.next = null; x.prior = null; x = next; &#125; first = last = null; size = 0; &#125; /** * è®¾ç½®ç»“ç‚¹å€¼ * @param index * @param data * @return */ @Override public T set(int index, T data) &#123; if(index &lt; 0 || index &gt;= size) throw new IndexOutOfBoundsException(); DNode&lt;T&gt; x = getNode(index); T oldVal = x.data; x.data = data; return oldVal; &#125; /** * åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç»“ç‚¹å€¼ * @param data * @return */ @Override public boolean contains(T data) &#123; return indexOf(data) != -1; &#125; /** * æ£€ç´¢ç»“ç‚¹å€¼ * @param data * @return */ @Override public int indexOf(T data) &#123; int index = 0; if (data == null) &#123; for (DNode&lt;T&gt; x = first; x != null; x = x.next) &#123; if (x.data == null) return index; index++; &#125; &#125; else &#123; for (DNode&lt;T&gt; x = first; x != null; x = x.next) &#123; if (data.equals(x.data)) return index; index++; &#125; &#125; return -1; &#125; @Override public int lastIndexOf(T data) &#123; int index = size; if (data == null) &#123; for (DNode&lt;T&gt; x = last; x != null; x = x.prior) &#123; index--; if (x.data == null) return index; &#125; &#125; else &#123; for (DNode&lt;T&gt; x = last; x != null; x = x.prior) &#123; index--; if (data.equals(x.data)) return index; &#125; &#125; return -1; &#125; @Override public T get(int index) &#123; if(index &lt; 0 || index &gt;= size) throw new IndexOutOfBoundsException(); return getNode(index).data; &#125; /** * è·å–æŒ‡å®šç´¢å¼•çš„ç»“ç‚¹ * è§£ï¼šç”±äºåŒé“¾è¡¨èƒ½åŒå‘æ£€ç´¢ï¼Œåˆ¤æ–­indexç¦»å¼€å§‹ç»“ç‚¹è¿‘è¿˜æ˜¯ç»ˆç«¯ç»“ç‚¹è¿‘ï¼Œä»è¿‘çš„ä¸€æ®µå¼€å§‹éå† * æ—¶é—´å¤æ‚åº¦O(n) * @param index * @return */ private DNode&lt;T&gt; getNode(int index) &#123; if (index &lt; (size &gt;&gt; 1)) &#123; DNode&lt;T&gt; x = first; for (int i = 0; i &lt; index; i++) x = x.next; return x; &#125; else &#123; DNode&lt;T&gt; x = last; for (int i = size - 1; i &gt; index; i--) x = x.prior; return x; &#125; &#125; /** * å€’åº * éå†æ¯ä¸ªç»“ç‚¹ï¼Œè®©node.next = node.prior; node.prior = (node.nextæ­¤å€¼éœ€è¦ä½“ç°ä¿å­˜); */ public void reverse()&#123; last = first; //åè½¬åç»ˆç«¯ç»“ç‚¹=å¼€å§‹ç»“ç‚¹ DNode now = first; DNode next; while(now!=null)&#123; next = now.next; //ä¿å­˜å½“å‰ç»“ç‚¹çš„åç»§ç»“ç‚¹ now.next = now.prior; now.prior = next; first = now; now = next; &#125; &#125; @Override public String toString() &#123; if(size == 0) return \"\"; DNode node = first; StringBuffer buffer = new StringBuffer(); buffer.append(\" \"); while(node != null)&#123; buffer.append(node.data+\" -&gt; \"); node = node.next; &#125; buffer.append(\"next\\npre\"); node = last; int start = buffer.length(); LogUtil.i(getClass().getSimpleName(), \"bufferé•¿åº¦ï¼š\"+buffer.length()); while(node != null)&#123; buffer.insert(start ,\" &lt;- \"+node.data); node = node.prior; &#125; return buffer.toString(); &#125;&#125;ç®—æ³•åˆ†æåŒé“¾è¡¨ä¸å•é“¾è¡¨ä¸åŒä¹‹å¤„åœ¨äºï¼ŒåŒé“¾è¡¨èƒ½ä»ä¸¤ç«¯ä¾æ¬¡è®¿é—®å„ä¸ªç»“ç‚¹ã€‚å•é“¾è¡¨ç›¸å¯¹äºé¡ºåºè¡¨ä¼˜ç‚¹æ˜¯æ’å…¥ã€åˆ é™¤æ•°æ®æ›´æ–¹ä¾¿ï¼Œä½†æ˜¯è®¿é—®ç»“ç‚¹éœ€è¦éå†ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼›åŒé“¾è¡¨å°±æ˜¯åœ¨å•é“¾è¡¨åŸºç¡€ä¸Šåšäº†ä¸€ä¸ªä¼˜åŒ–ï¼Œä½¿å¾—è®¿é—®ç»“ç‚¹æ›´åŠ ä¾¿æ·ï¼ˆä»ä¸¤ç«¯ï¼‰ï¼Œè¿™æ ·ä»è¿‘çš„ä¸€ç«¯å‡ºå‘æ—¶é—´å¤æ‚åº¦å˜ä¸ºO(n/2)ï¼Œè™½ç„¶ä¸æ˜¯æŒ‡æ•°é˜¶çš„åŒºåˆ«ï¼Œä½†ä¹Ÿç®—æ˜¯ä¼˜åŒ–ã€‚åŒé“¾è¡¨åœ¨æ’å…¥ã€åˆ é™¤ç»“ç‚¹æ—¶é€»è¾‘æ¯”å•é“¾è¡¨ç¨éº»çƒ¦ï¼šå¾ªç¯é“¾è¡¨å¾ªç¯é“¾è¡¨æ˜¯å¦ä¸€ç§å½¢å¼çš„é“¾å¼å­˜å‚¨ç»“æ„ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯è¡¨ä¸­å°¾ç»“ç‚¹çš„æŒ‡é’ˆåŸŸä¸å†æ˜¯ç©ºï¼Œè€Œæ˜¯æŒ‡å‘å¤´ç»“ç‚¹ï¼Œæ•´ä¸ªé“¾è¡¨å½¢æˆä¸€ä¸ªç¯ã€‚ç”±æ­¤ï¼Œä»è¡¨ä¸­ä»»æ„ä¸€ç»“ç‚¹å‡ºå‘å‡å¯æ‰¾åˆ°é“¾è¡¨ä¸­å…¶ä»–ç»“ç‚¹ã€‚å¦‚å›¾æ‰€ç¤ºä¸ºå¸¦å¤´ç»“ç‚¹çš„å¾ªç¯å•é“¾è¡¨å’Œå¾ªç¯åŒé“¾è¡¨ï¼šæœ‰åºè¡¨æ‰€è°“æœ‰åºè¡¨ï¼Œæ˜¯æŒ‡æ‰€æœ‰ç»“ç‚¹å…ƒç´ å€¼ä»¥é€’å¢æˆ–é€’å‡æ–¹å¼æ’åˆ—çš„çº¿æ€§è¡¨ï¼Œå¹¶è§„å®šæœ‰åºè¡¨ä¸­ä¸å­˜åœ¨å…ƒç´ å€¼ç›¸åŒçš„ç»“ç‚¹ã€‚æœ‰åºè¡¨å¯ä»¥é‡‡ç”¨é¡ºåºè¡¨å’Œé“¾è¡¨è¿›è¡Œå­˜å‚¨ï¼Œè‹¥ä»¥é¡ºåºè¡¨å­˜å‚¨æœ‰åºè¡¨ï¼Œå…¶ç®—æ³•é™¤äº†add(T data)ä»¥å¤–ï¼Œå…¶ä»–å‡ä¸å‰é¢è¯´çš„é¡ºåºè¡¨å¯¹åº”çš„è¿ç®—ç›¸åŒã€‚æœ‰åºè¡¨çš„add(T data)æ“ä½œä¸æ˜¯æ’å…¥åˆ°æœ«å°¾ï¼Œè€Œéœ€è¦éå†æ¯”è¾ƒå¤§å°åæ’å…¥ç›¸åº”ä½ç½®ã€‚123456789101112131415public boolean addByOrder(int data) &#123; int index = 0; //æ‰¾åˆ°é¡ºåºè¡¨ä¸­ç¬¬ä¸€ä¸ªå¤§äºç­‰äºdataçš„å…ƒç´  while(index&lt;datas.length &amp;&amp; (int)datas[index]&lt;data) index++; if((int)datas[index] == data) //ä¸èƒ½æœ‰ç›¸åŒå…ƒç´  return false; Object destination[] = new Object[datas.length + 1]; System.arraycopy(datas, 0, destination, 0, index); //å°†datas[index]åŠåé¢å…ƒç´ åç§»ä¸€ä½ System.arraycopy(datas, index, destination, index+1, datas.length-index); destination[index] = data; datas = destination; return true;&#125;æœ€å æƒ³å¼ºè°ƒçš„æ˜¯ ç”±äºé¡ºåºè¡¨ç»“æ„çš„åº•å±‚å®ç°å€ŸåŠ©çš„å°±æ˜¯æ•°ç»„ï¼Œå› æ­¤å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œå¯ä»¥æŠŠé¡ºåºè¡¨å®Œå…¨ç­‰ä»·ä¸ºæ•°ç»„ï¼Œä½†å®åˆ™ä¸æ˜¯è¿™æ ·ã€‚æ•°æ®ç»“æ„æ˜¯ç ”ç©¶æ•°æ®å­˜å‚¨æ–¹å¼çš„ä¸€é—¨å­¦ç§‘ï¼Œå®ƒå›Šæ‹¬çš„éƒ½æ˜¯å„ç§å­˜å‚¨ç»“æ„ï¼Œè€Œæ•°ç»„åªæ˜¯å„ç§ç¼–ç¨‹è¯­è¨€ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¹¶ä¸å±äºæ•°æ®ç»“æ„çš„èŒƒç•´ã€‚æ•°æ®ç»“æ„ - çº¿æ€§è¡¨çº¿æ€§è¡¨åŠå…¶é€»è¾‘ç»“æ„çº¿æ€§è¡¨æ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚è‹±æ–‡å­—æ¯è¡¨ï¼ˆAã€Bã€â€¦ã€Zï¼‰æ˜¯ä¸€ä¸ªçº¿æ€§è¡¨ï¼Œè¡¨ä¸­æ¯ä¸ªè‹±æ–‡å­—æ¯æ˜¯ä¸€ä¸ªæ•°æ®å…ƒç´ ï¼›æˆç»©å•æ˜¯ä¸€ä¸ªçº¿æ€§è¡¨ï¼Œè¡¨ä¸­æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªæ•°æ®å…ƒç´ ï¼Œæ¯ä¸ªæ•°æ®å…ƒç´ åˆç”±å­¦å·ã€å§“åã€æˆç»©ç­‰æ•°æ®é¡¹ç»„æˆã€‚çº¿æ€§è¡¨çš„å®šä¹‰çº¿æ€§è¡¨æ˜¯å…·æœ‰ç›¸åŒç‰¹æ€§çš„æ•°æ®å…ƒç´ çš„ä¸€ä¸ªæœ‰é™åºåˆ—ã€‚çº¿æ€§è¡¨ä¸€èˆ¬è¡¨ç¤ºä¸ºï¼š1 L = (a1, a2, â€¦, ai,ai+1 ,â€¦, an)çº¿æ€§è¡¨ä¸­å…ƒç´ åœ¨ä½ç½®ä¸Šæ˜¯æœ‰åºçš„ï¼Œè¿™ç§ä½ç½®ä¸Šæœ‰åºæ€§å°±æ˜¯ä¸€ç§çº¿æ€§å…³ç³»ï¼Œç”¨äºŒå…ƒç»„è¡¨ç¤ºï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110L = (D, R) D = &#123;ai| 1â‰¤iâ‰¤n, nâ‰¥0&#125; R = &#123;r&#125; r = &#123;&lt;ai, ai+1&gt; | 1â‰¤iâ‰¤n-1&#125;``` ### çº¿æ€§è¡¨çš„æŠ½è±¡æ•°æ®ç±»å‹æè¿° å°†çº¿æ€§è¡¨æ•°æ®ç»“æ„æŠ½è±¡æˆä¸ºä¸€ç§æ•°æ®ç±»å‹ï¼Œè¿™ä¸ªæ•°æ®ç±»å‹ä¸­åŒ…å«æ•°æ®å…ƒç´ ã€å…ƒç´ ä¹‹é—´çš„å…³ç³»ã€æ“ä½œå…ƒç´ çš„åŸºæœ¬ç®—æ³•ã€‚ å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆintã€floatã€booleanç­‰ç­‰ï¼‰javaå·²ç»å¸®æˆ‘ä»¬å®ç°äº†ç”¨äºæ“ä½œä»–ä»¬çš„åŸºæœ¬è¿ç®—ï¼Œ æˆ‘ä»¬éœ€è¦åŸºäºè¿™äº›åŸºæœ¬è¿ç®—ï¼Œä¸ºæˆ‘ä»¬å°è£…çš„è‡ªå®šä¹‰æ•°æ®ç±»å‹æä¾›æ“ä½œå®ƒä»¬çš„ç®—æ³•ã€‚ æ¯”å¦‚æ•°ç»„å°±æ˜¯ä¸€ç§è¢«æŠ½è±¡å‡ºæ¥çš„çº¿æ€§è¡¨æ•°æ®ç±»å‹ï¼Œæ•°ç»„è‡ªå¸¦å¾ˆå¤šåŸºæœ¬æ–¹æ³•ç”¨äºæ“ä½œæ•°æ®å…ƒç´ ã€‚ Javaä¸­çš„Listæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨åˆ°ï¼Œä½†æ˜¯å¾ˆå°‘å…³æ³¨å…¶å†…éƒ¨å®ç°ï¼ŒListæ˜¯ä¸€ä¸ªæ¥å£ï¼Œ é‡Œé¢å®šä¹‰äº†ä¸€äº›æŠ½è±¡çš„æ–¹æ³•ï¼Œå…¶ç›®çš„å°±æ˜¯å¯¹çº¿æ€§è¡¨çš„æŠ½è±¡ï¼Œå…¶ä¸­çš„æ–¹æ³•å°±æ˜¯çº¿æ€§è¡¨çš„ä¸€äº›å¸¸ç”¨åŸºæœ¬è¿ç®—ã€‚ è€Œå¯¹äºçº¿æ€§è¡¨çš„ä¸åŒ**å­˜å‚¨ç»“æ„**å…¶å®ç°æ–¹å¼å°±æœ‰æ‰€ä¸åŒäº†ï¼Œ æ¯”å¦‚**ArrayList**æ˜¯å¯¹çº¿æ€§è¡¨é¡ºåºå­˜å‚¨ç»“æ„çš„å®ç°ï¼Œ **LinkedList**æ˜¯çº¿æ€§è¡¨é“¾å¼å­˜å‚¨ç»“æ„çš„å®ç°ç­‰ã€‚ å­˜å‚¨ç»“æ„æ²¡æœ‰ç¡®å®šæˆ‘ä»¬å°±ä¸çŸ¥é“æ•°æ®æ€ä¹ˆå­˜å‚¨ï¼Œä½†æ˜¯å¯¹äºçº¿æ€§è¡¨è¿™ç§é€»è¾‘ç»“æ„ä¸­æ•°æ®çš„åŸºæœ¬æ“ä½œæˆ‘ä»¬å¯ä»¥é¢„çŸ¥ï¼Œ æ— éå°±æ˜¯è·å–é•¿åº¦ã€è·å–æŒ‡å®šä½ç½®çš„æ•°æ®ã€æ’å…¥æ•°æ®ã€åˆ é™¤æ•°æ®ç­‰ç­‰æ“ä½œï¼Œå¯ä»¥å‚è€ƒListã€‚ å¯¹äºæœ¬ç³»åˆ—æ–‡ç« ï¼Œåªæ˜¯å¯¹æ•°æ®ç»“æ„å’Œä¸€äº›å¸¸ç”¨ç®—æ³•å­¦ä¹ ï¼Œæ¥ä¸‹æ¥çš„ä»£ç å°†é€‰æ‹©æ€§å®ç°å¹¶åˆ†æç®—æ³•ã€‚ å¯¹çº¿æ€§è¡¨çš„æŠ½è±¡æ•°æ®ç±»å‹æè¿°å¦‚ä¸‹ï¼š```javapublic interface IList&lt;T&gt; &#123; /** * åˆ¤æ–­çº¿æ€§è¡¨æ˜¯å¦ä¸ºç©º * @return */ boolean isEmpty(); /** * è·å–é•¿åº¦ * @return */ int length(); /** * å°†ç»“ç‚¹æ·»åŠ åˆ°æŒ‡å®šåºåˆ—çš„ä½ç½® * @param index * @param data * @return */ boolean add(int index, T data); /** * å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°åˆ—è¡¨çš„æœ«å°¾ * @param data * @return */ boolean add(T data); /** * æ ¹æ®indexç§»é™¤å…ƒç´  * @param index * @return */ T remove(int index); /** * ç§»é™¤å€¼ä¸ºdataçš„ç¬¬ä¸€ä¸ªç»“ç‚¹ * @param data * @return */ boolean remove(T data); /** * ç§»é™¤æ‰€æœ‰å€¼ä¸ºdataçš„ç»“ç‚¹ * @param data * @return */ boolean removeAll(T data); /** * æ¸…ç©ºè¡¨ */ void clear(); /** * è®¾ç½®æŒ‡å®šåºåˆ—å…ƒç´ çš„å€¼ * @param index * @param data * @return */ T set(int index, T data); /** * æ˜¯å¦åŒ…å«å€¼ä¸ºdataçš„ç»“ç‚¹ * @param data * @return */ boolean contains(T data); /** * æ ¹æ®å€¼æŸ¥è¯¢ç´¢å¼• * @param data * @return */ int indexOf(T data); /** * æ ¹æ®dataå€¼æŸ¥è¯¢æœ€åä¸€æ¬¡å‡ºç°åœ¨è¡¨ä¸­çš„ç´¢å¼• * @param data * @return */ int lastIndexOf(T data); /** * è·å–æŒ‡å®šåºåˆ—çš„å…ƒç´  * @param index * @return */ T get(int index); /** * è¾“å‡ºæ ¼å¼ * @return */ String toString();&#125;çº¿æ€§è¡¨çš„é¡ºåºå­˜å‚¨ç»“æ„é¡ºåºè¡¨æŠŠçº¿æ€§è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ æŒ‰ç…§å…¶é€»è¾‘é¡ºåºä¾æ¬¡å­˜å‚¨åœ¨è®¡ç®—æœºå­˜å‚¨å™¨ä¸­æŒ‡å®šå­˜å‚¨ä½ç½®å¼€å§‹çš„ä¸€å—è¿ç»­çš„å­˜å‚¨ç©ºé—´ä¸­ã€‚åœ¨Javaä¸­åˆ›å»ºä¸€ä¸ªæ•°ç»„å¯¹è±¡å°±æ˜¯åˆ†é…äº†ä¸€å—å¯ä¾›ç”¨æˆ·ä½¿ç”¨çš„è¿ç»­çš„å­˜å‚¨ç©ºé—´ï¼Œè¯¥å­˜å‚¨ç©ºé—´çš„èµ·å§‹ä½ç½®å°±æ˜¯ç”±æ•°ç»„åè¡¨ç¤ºçš„åœ°å€å¸¸é‡ã€‚çº¿æ€§è¡¨çš„é¡ºåºå­˜å‚¨ç»“æ„æ˜¯åˆ©ç”¨æ•°ç»„æ¥å®ç°çš„ã€‚åœ¨Javaä¸­ï¼Œæˆ‘ä»¬é€šå¸¸åˆ©ç”¨ä¸‹é¢çš„æ–¹å¼æ¥ä½¿ç”¨æ•°ç»„ï¼š123int[] array = new int[]&#123;1,2,3&#125;; //åˆ›å»ºä¸€ä¸ªæ•°ç»„Array.getInt(array, 0); //è·å–æ•°ç»„ä¸­åºåˆ—ä¸º0çš„å…ƒç´ Array.set(array, 0, 1); //è®¾ç½®åºåˆ—ä¸º0çš„å…ƒç´ å€¼ä¸º1Arrayè¿™ç§æ–¹å¼åˆ›å»ºçš„æ•°ç»„æ˜¯å›ºå®šé•¿åº¦çš„ï¼Œå…¶å®¹é‡æ— æ³•ä¿®æ”¹ï¼Œå½“arrayè¢«åˆ›å»ºå‡ºæ¥çš„æ—¶å€™ï¼Œç³»ç»Ÿåªä¸ºå…¶åˆ†é…3ä¸ªå­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•å¯¹å…¶è¿›è¡Œæ·»åŠ å’Œåˆ é™¤æ“ä½œã€‚Arrayè¿™ä¸ªç±»é‡Œé¢æä¾›äº†å¾ˆå¤šæ–¹æ³•ç”¨äºæ“ä½œæ•°ç»„ï¼Œè¿™äº›æ–¹æ³•éƒ½æ˜¯é™æ€çš„ï¼Œæ‰€ä»¥Arrayæ˜¯ä¸€ä¸ªç”¨äºæ“ä½œæ•°ç»„çš„å·¥å…·ç±»ï¼Œè¿™ä¸ªç±»æä¾›çš„æ–¹æ³•åªæœ‰ä¸¤ç§ï¼šgetå’Œsetï¼Œæ‰€ä»¥åªèƒ½è·å–å’Œè®¾ç½®æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œç„¶åå¯¹äºè¿™ä¸¤ç§æ“ä½œï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨array[i]ã€array[i] = 0çš„ç®€åŒ–æ–¹å¼ï¼Œæ‰€ä»¥Arrayè¿™ä¸ªç±»ç”¨çš„æ¯”è¾ƒå°‘ã€‚å¦å¤–ä¸€ç§æ•°ç»„ArrayListï¼Œå…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šä¹Ÿæ˜¯æ•°ç»„ï¼Œå…¶æ“ä½œéƒ½æ˜¯å¯¹æ•°ç»„çš„æ“ä½œï¼Œä¸ä¸Šè¿°æ•°ç»„ä¸åŒçš„æ˜¯ï¼ŒArrayListæ˜¯ä¸€ç§å¯å˜é•¿åº¦çš„æ•°ç»„ã€‚æ—¢ç„¶æ•°ç»„åˆ›å»ºæ—¶å°±å·²ç»åˆ†é…äº†å­˜å‚¨ç©ºé—´ï¼Œä¸ºä»€ä¹ˆArrayListæ˜¯é•¿åº¦å¯å˜çš„å‘¢ï¼Ÿé•¿åº¦å¯å˜æ„å‘³ç€å¯ä»¥ä»æ•°ç»„ä¸­æ·»åŠ ã€åˆ é™¤å…ƒç´ ï¼Œå‘ArrayListä¸­æ·»åŠ æ•°æ®æ—¶ï¼Œå®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå°†åŸæ•°ç»„ä¸­å…ƒç´ ä¸€ä¸ªä¸ªå¤åˆ¶åˆ°æ–°æ•°ç»„åï¼Œå°†æ–°å…ƒç´ æ·»åŠ è¿›æ¥ã€‚å¦‚æœArrayListä»…ä»…åšäº†è¿™ä¹ˆç®€å•çš„æ“ä½œï¼Œé‚£ä»–å°±ä¸åº”è¯¥å‡ºç°äº†ã€‚ArrayListä¸­çš„æ•°ç»„é•¿åº¦æ˜¯å¤§äºç­‰äºå…¶å…ƒç´ ä¸ªæ•°çš„ï¼Œå½“æ‰§è¡Œadd()æ“ä½œæ—¶é¦–å…ˆä¼šæ£€æŸ¥æ•°ç»„é•¿åº¦æ˜¯å¦å¤Ÿç”¨ï¼Œåªæœ‰å½“æ•°ç»„é•¿åº¦ä¸å¤Ÿç”¨æ—¶æ‰ä¼šåˆ›å»ºæ–°çš„æ•°ç»„ï¼Œç”±äºåˆ›å»ºæ–°æ•°ç»„æ„å‘³ç€è€æ•°æ®çš„æ¬è¿ï¼Œæ‰€ä»¥è¿™ä¸ªæœºåˆ¶ä¹Ÿç®—æ˜¯åˆ©ç”¨ç©ºé—´æ¢å–æ—¶é—´ä¸Šçš„æ•ˆç‡ã€‚ä½†æ˜¯å¦‚æœæ·»åŠ æ“ä½œå¹¶ä¸æ˜¯å°¾éƒ¨æ·»åŠ ï¼Œè€Œæ˜¯å¤´éƒ¨æˆ–è€…ä¸­é—´ä½ç½®æ’å…¥ï¼Œä¹Ÿé¿å…ä¸äº†å…ƒç´ ä½ç½®ç§»åŠ¨ã€‚é¡ºåºè¡¨åŸºæœ¬è¿ç®—çš„å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229public class LinearArray&lt;T&gt; implements IList&lt;T&gt;&#123; private Object[] datas; /** * é€šè¿‡ç»™å®šçš„æ•°ç»„ å»ºç«‹é¡ºåºè¡¨ * @param objs * @return */ public static &lt;T&gt; LinearArray&lt;T&gt; createArray(T[] objs)&#123; LinearArray&lt;T&gt; array = new LinearArray(); array.datas = new Object[objs.length]; for(int i = 0; i&lt;objs.length; i++) array.datas[i] = objs[i]; return array; &#125; private LinearArray()&#123; &#125; @Override public boolean isEmpty() &#123; return datas.length == 0; &#125; @Override public int length() &#123; return datas.length; &#125; /** * è·å–æŒ‡å®šä½ç½®çš„å…ƒç´  * åˆ†æï¼šæ—¶é—´å¤æ‚åº¦O(1) * ä»é¡ºåºè¡¨ä¸­æ£€ç´¢å€¼æ˜¯ç®€å•é«˜æ•ˆçš„ï¼Œå› ä¸ºé¡ºåºè¡¨å†…éƒ¨é‡‡ç”¨æ•°ç»„ä½œä¸ºå®¹å™¨ï¼Œæ•°ç»„å¯ç›´æ¥é€šè¿‡ç´¢å¼•å€¼è®¿é—®å…ƒç´  */ @Override public T get(int index) &#123; if (index&lt;0 || index &gt;= datas.length) throw new IndexOutOfBoundsException(); return (T) datas[index]; &#125; /** * ä¸ºæŒ‡å®šç´¢å¼•çš„ç»“ç‚¹è®¾ç½®å€¼ * åˆ†æï¼šæ—¶é—´å¤æ‚åº¦O(1) */ @Override public T set(int index, T data) &#123; if (index&lt;0 || index &gt;= datas.length) throw new IndexOutOfBoundsException(); T oldValue = (T) datas[index]; datas[index] = data; return oldValue; &#125; /** * åˆ¤æ–­æ˜¯å¦åŒ…å«æŸå€¼åªéœ€è¦åˆ¤æ–­è¯¥å€¼æœ‰æ²¡æœ‰å‡ºç°è¿‡ * åˆ†æï¼šæ—¶é—´å¤æ‚åº¦O(n) */ @Override public boolean contains(T data) &#123; return indexOf(data) &gt;= 0; &#125; /** * è·å–æŸå€¼ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼• * åˆ†æï¼šæ—¶é—´å¤æ‚åº¦O(n) */ @Override public int indexOf(T data) &#123; if (data == null) &#123; for (int i = 0; i &lt; datas.length; i++) if (datas[i]==null) return i; &#125; else &#123; for (int i = 0; i &lt; datas.length; i++) if (data.equals(datas[i])) return i; &#125; return -1; &#125; /** * è·å–æŸå€¼æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼• * åˆ†æï¼šæ—¶é—´å¤æ‚åº¦O(n) */ @Override public int lastIndexOf(T data) &#123; if (data == null) &#123; for (int i = datas.length-1; i &gt;= 0; i--) if (datas[i]==null) return i; &#125; else &#123; for (int i = datas.length-1; i &gt;= 0; i--) if (data.equals(datas[i])) return i; &#125; return -1; &#125; /** * æŒ‡å®šä½ç½®æ’å…¥å…ƒç´  * åˆ†æï¼šæ—¶é—´å¤æ‚åº¦O(n) * åœ¨æ•°ç»„ä¸­æ’å…¥å…ƒç´ æ—¶ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ¯”åŸæ•°ç»„å®¹é‡å¤§1çš„æ–°æ•°ç»„ï¼Œ * å°†åŸæ•°ç»„ä¸­(0,index-1)ä½ç½®çš„å…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„ï¼ŒæŒ‡å®šæ–°æ•°ç»„indexä½ç½®å…ƒç´ å€¼ä¸ºæ–°å€¼ï¼Œ * ç»§ç»­å°†åŸæ•°ç»„(index, length-1)çš„å…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„ * @param index * @param data * @return */ @Override public boolean add(int index, T data) &#123; if (index &gt; datas.length || index &lt; 0) throw new IndexOutOfBoundsException(); Object destination[] = new Object[datas.length + 1]; System.arraycopy(datas, 0, destination, 0, index); destination[index] = data; System.arraycopy(datas, index, destination, index + 1, datas.length - index); datas = destination; return true; &#125; /** * åœ¨é¡ºåºè¡¨æœ«å°¾å¤„æ’å…¥å…ƒç´  * åˆ†æï¼šæ—¶é—´å¤æ‚åº¦O(n) * åŒä¸Šé¢ä¸€æ ·ï¼Œä¹Ÿéœ€è¦åˆ›å»ºæ–°æ•°ç»„ * @param data * @return */ @Override public boolean add(T data) &#123; Object destination[] = new Object[datas.length + 1]; System.arraycopy(datas, 0, destination, 0, datas.length); destination[datas.length] = data; datas = destination; return true; &#125; /** * æœ‰åºè¡¨æ·»åŠ å…ƒç´  * @param data * @return */ public boolean addByOrder(int data) &#123; int index = 0; //æ‰¾åˆ°é¡ºåºè¡¨ä¸­ç¬¬ä¸€ä¸ªå¤§äºç­‰äºdataçš„å…ƒç´  while(index&lt;datas.length &amp;&amp; (int)datas[index]&lt;data) index++; if((int)datas[index] == data) //ä¸èƒ½æœ‰ç›¸åŒå…ƒç´  return false; Object destination[] = new Object[datas.length + 1]; System.arraycopy(datas, 0, destination, 0, index); //å°†datas[index]åŠåé¢å…ƒç´ åç§»ä¸€ä½ System.arraycopy(datas, index, destination, index+1, datas.length-index); destination[index] = data; datas = destination; return true; &#125; /** * ç§»é™¤æŒ‡å®šç´¢å¼•çš„å…ƒç´  * åˆ†æï¼šæ—¶é—´å¤æ‚åº¦O(n) * æ­¤å¤„ç”±äºæ•°ç»„å…ƒç´ æ•°é‡-1ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºæ–°æ•°ç»„ã€‚ * ArrayListç”±äºæ˜¯åŠ¨æ€æ•°ç»„ï¼ˆlist.size()â‰ data.lengthï¼‰ï¼Œæ‰€ä»¥åªéœ€è¦å°†åˆ é™¤çš„å…ƒç´ ä¹‹åçš„å‰ç§»ä¸€ä½ * @param index * @return */ @Override public T remove(int index) &#123; if (index &gt;= datas.length || index &lt; 0) throw new IndexOutOfBoundsException(); T oldValue = (T) datas[index]; fastRemove(index); return oldValue; &#125; /** * åˆ é™¤æŒ‡å®šå€¼çš„ç¬¬ä¸€ä¸ªå…ƒç´  * @param data * @return */ @Override public boolean remove(T data) &#123; if (data == null) &#123; for (int index = 0; index &lt; datas.length; index++) if (datas[index] == null) &#123; fastRemove(index); return true; &#125; &#125; else &#123; for (int index = 0; index &lt; datas.length; index++) if (data.equals(datas[index])) &#123; fastRemove(index); return true; &#125; &#125; return false; &#125; /** * ç§»é™¤æŒ‡å®šåºåˆ—çš„å…ƒç´  * @param index */ private void fastRemove(int index) &#123; Object destination[] = new Object[datas.length - 1]; System.arraycopy(datas, 0, destination, 0, index); System.arraycopy(datas, index+1, destination, index, datas.length - index-1); datas = destination; &#125; @Override public boolean removeAll(T data) &#123; return false; &#125; @Override public void clear() &#123; datas = new Object[]&#123;&#125;; &#125; @Override public String toString() &#123; if(isEmpty()) return \"\"; String str = \"[\"; for(int i = 0; i&lt;datas.length; i++)&#123; str += (datas[i]+\", \"); &#125; str = str.substring(0, str.lastIndexOf(\", \")); return str+\"]\"; &#125;&#125;ç®—æ³•åˆ†æï¼šæ’å…¥å…ƒç´ ï¼šåˆ é™¤å…ƒç´ ï¼š**çº¿æ€§è¡¨çš„é“¾å¼å­˜å‚¨ç»“æ„é¡ºåºè¡¨å¿…é¡»å ç”¨ä¸€æ•´å—äº‹å…ˆåˆ†é…å¤§å°å›ºå®šçš„å­˜å‚¨ç©ºé—´ï¼Œè¿™æ ·ä¸ä¾¿äºå­˜å‚¨ç©ºé—´çš„ç®¡ç†ã€‚ä¸ºæ­¤æå‡ºäº†å¯ä»¥å®ç°å­˜å‚¨ç©ºé—´åŠ¨æ€ç®¡ç†çš„é“¾å¼å­˜å‚¨æ–¹å¼â€“é“¾è¡¨ã€‚é“¾è¡¨åœ¨é“¾å¼å­˜å‚¨ä¸­ï¼Œæ¯ä¸ªå­˜å‚¨ç»“ç‚¹ä¸ä»…åŒ…å«å…ƒç´ æœ¬èº«çš„ä¿¡æ¯ï¼ˆæ•°æ®åŸŸï¼‰ï¼Œè¿˜åŒ…å«å…ƒç´ ä¹‹é—´é€»è¾‘å…³ç³»çš„ä¿¡æ¯ï¼Œå³ä¸€ä¸ªç»“ç‚¹ä¸­åŒ…å«æœ‰ç›´æ¥åç»§ç»“ç‚¹çš„åœ°å€ä¿¡æ¯ï¼Œè¿™ç§°ä¸ºæŒ‡é’ˆåŸŸã€‚è¿™æ ·å¯ä»¥é€šè¿‡ä¸€ä¸ªç»“ç‚¹çš„æŒ‡é’ˆåŸŸæ–¹ä¾¿çš„æ‰¾åˆ°åç»§ç»“ç‚¹çš„ä½ç½®ã€‚ç”±äºé¡ºåºè¡¨ä¸­æ¯ä¸ªå…ƒç´ è‡³å¤šåªæœ‰ä¸€ä¸ªç›´æ¥å‰é©±å…ƒç´ å’Œä¸€ä¸ªç›´æ¥åç»§å…ƒç´ ã€‚å½“é‡‡ç”¨é“¾å¼å­˜å‚¨æ—¶ï¼Œä¸€ç§æœ€ç®€å•ä¹Ÿæœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯ï¼šåœ¨æ¯ä¸ªç»“ç‚¹ä¸­é™¤åŒ…å«æ•°æ®åŸŸå¤–ï¼Œåªè®¾ç½®ä¸€ä¸ªæŒ‡é’ˆåŸŸç”¨ä»¥æŒ‡å‘å…¶ç›´æ¥åç»§ç»“ç‚¹ï¼Œè¿™ç§æ„æˆçš„é“¾æ¥è¡¨ç§°ä¸ºçº¿æ€§å•å‘é“¾æ¥è¡¨ï¼Œç®€ç§°å•é“¾è¡¨ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯ï¼Œåœ¨æ¯ä¸ªç»“ç‚¹ä¸­é™¤åŒ…å«æ•°å€¼åŸŸå¤–ï¼Œè®¾ç½®ä¸¤ä¸ªæŒ‡é’ˆåŸŸï¼Œåˆ†åˆ«ç”¨ä»¥æŒ‡å‘ç›´æ¥å‰é©±ç»“ç‚¹å’Œç›´æ¥åç»§ç»“ç‚¹ï¼Œè¿™æ ·æ„æˆçš„é“¾æ¥è¡¨ç§°ä¸ºçº¿æ€§åŒå‘é“¾æ¥è¡¨ï¼Œç®€ç§°åŒé“¾è¡¨ã€‚å•é“¾è¡¨å½“è®¿é—®ä¸€ä¸ªç»“ç‚¹åï¼Œåªèƒ½æ¥ç€è®¿é—®å®ƒçš„ç›´æ¥åç»§ç»“ç‚¹ï¼Œè€Œæ— æ³•è®¿é—®ä»–çš„ç›´æ¥å‰é©±ç»“ç‚¹ã€‚åŒé“¾è¡¨åˆ™æ—¢å¯ä»¥ä¾æ¬¡å‘åè®¿é—®æ¯ä¸ªç»“ç‚¹ï¼Œä¹Ÿå¯ä»¥ä¾æ¬¡å‘å‰è®¿é—®æ¯ä¸ªç»“ç‚¹ã€‚å•é“¾è¡¨ç»“ç‚¹å…ƒç´ ç±»å‹å®šä¹‰ï¼š1234public class LNode &#123; protected LNode next; //æŒ‡é’ˆåŸŸï¼ŒæŒ‡å‘ç›´æ¥åç»§ç»“ç‚¹ protected Object data; //æ•°æ®åŸŸ&#125;åŒé“¾è¡¨ç»“ç‚¹å…ƒç´ ç±»å‹å®šä¹‰ï¼š12345public class DNode &#123; protected DNode prior; //æŒ‡é’ˆåŸŸï¼ŒæŒ‡å‘ç›´æ¥å‰é©±ç»“ç‚¹ protected DNode next; //æŒ‡é’ˆåŸŸï¼ŒæŒ‡å‘ç›´æ¥åç»§ç»“ç‚¹ protected Object data; //æ•°æ®åŸŸ&#125;åœ¨é¡ºåºè¡¨ä¸­ï¼Œé€»è¾‘ä¸Šç›¸é‚»çš„å…ƒç´ ï¼Œå¯¹åº”çš„å­˜å‚¨ä½ç½®ä¹Ÿç›¸é‚»ï¼Œæ‰€ä»¥è¿›è¡Œæ’å…¥æˆ–åˆ é™¤æ“ä½œæ—¶ï¼Œé€šå¸¸éœ€è¦å¹³å‡ç§»åŠ¨åŠä¸ªè¡¨çš„å…ƒç´ ï¼Œè¿™æ˜¯ç›¸å½“è´¹æ—¶çš„æ“ä½œã€‚åœ¨é“¾è¡¨ä¸­ï¼Œæ¯ä¸ªç»“ç‚¹å­˜å‚¨ä½ç½®å¯ä»¥ä»»æ„å®‰æ’ï¼Œä¸å¿…è¦æ±‚ç›¸é‚»ï¼Œæ’å…¥æˆ–åˆ é™¤æ“ä½œåªéœ€è¦ä¿®æ”¹ç›¸å…³ç»“ç‚¹çš„æŒ‡é’ˆåŸŸå³å¯ï¼Œæ–¹ä¾¿çœæ—¶ã€‚å¯¹äºå•é“¾è¡¨ï¼Œå¦‚æœè¦åœ¨ç»“ç‚¹pä¹‹å‰æ’å…¥ä¸€ä¸ªæ–°ç»“ç‚¹ï¼Œç”±äºé€šè¿‡på¹¶ä¸èƒ½æ‰¾åˆ°å…¶å‰é©±ç»“ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä»é“¾è¡¨è¡¨å¤´éå†è‡³pçš„å‰é©±ç»“ç‚¹ç„¶åè¿›è¡Œæ’å…¥æ“ä½œï¼Œè¿™æ ·æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(n)ï¼Œè€Œé¡ºåºè¡¨æ’å…¥åˆ é™¤ç»“ç‚¹æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯O(n)ï¼Œé‚£ä¸ºä»€ä¹ˆè¯´é“¾è¡¨æ’å…¥åˆ é™¤æ“ä½œæ›´åŠ é«˜æ•ˆå‘¢ï¼Ÿå› ä¸ºå•é“¾è¡¨æ’å…¥åˆ é™¤æ“ä½œæ‰€æ¶ˆè€—çš„æ—¶é—´ä¸»è¦åœ¨äºæŸ¥æ‰¾å‰é©±ç»“ç‚¹ï¼Œè¿™ä¸ªæŸ¥æ‰¾å·¥ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œè€ŒçœŸæ­£è¶…å¦‚åˆ é™¤æ—¶é—´ä¸ºO(1)è¿˜æœ‰é¡ºåºè¡¨éœ€è¦ç§»åŠ¨ç»“ç‚¹ï¼Œç§»åŠ¨ç»“ç‚¹é€šå¸¸æ¯”å•çº¯çš„æŸ¥æ‰¾æ›´åŠ è´¹æ—¶ï¼Œé“¾è¡¨ä¸éœ€è¦è¿ç»­çš„ç©ºé—´ï¼Œä¸éœ€è¦æ‰©å®¹åˆ›å»ºæ–°è¡¨ï¼Œæ‰€ä»¥åŒæ ·æ—¶é—´å¤æ‚åº¦O(n)ï¼Œé“¾è¡¨æ›´é€‚åˆæ’å…¥å’Œåˆ é™¤æ“ä½œã€‚å¯¹äºéå†æŸ¥æ‰¾å‰é©±ç»“ç‚¹çš„é—®é¢˜ï¼Œåœ¨åŒé“¾è¡¨ä¸­å°±èƒ½å¾ˆå¥½çš„è§£å†³ï¼ŒåŒé“¾è¡¨åœ¨å·²çŸ¥æŸç»“ç‚¹çš„æ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦æ˜¯O(1)ã€‚ç”±äºé“¾è¡¨çš„æ¯ä¸ªç»“ç‚¹å¸¦æœ‰æŒ‡é’ˆåŸŸï¼Œä»å­˜å‚¨å¯†åº¦æ¥è®²ï¼Œè¿™æ˜¯ä¸ç»æµçš„ã€‚æ‰€è°“å­˜å‚¨å¯†åº¦æ˜¯æŒ‡ç»“ç‚¹æ•°æ®æœ¬èº«æ‰€å å­˜å‚¨é‡å’Œæ•´æ”¹ç»“ç‚¹ç»“æ„æ‰€å å­˜å‚¨é‡ä¹‹æ¯”ã€‚3.2 å•é“¾è¡¨åŸºæœ¬è¿ç®—çš„å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534public class LinkList&lt;T&gt; implements IList&lt;T&gt;&#123; public LNode&lt;T&gt; head; //å•é“¾è¡¨å¼€å§‹ç»“ç‚¹ /** * 1.1 åˆ›å»ºå•é“¾è¡¨ï¼ˆå¤´æ’æ³•ï¼šå€’åºï¼‰ * è§£ï¼šéå†æ•°ç»„ï¼Œåˆ›å»ºæ–°ç»“ç‚¹ï¼Œæ–°ç»“ç‚¹çš„æŒ‡é’ˆåŸŸæŒ‡å‘å¤´ç»“ç‚¹ï¼Œè®©æ–°ç»“ç‚¹ä½œä¸ºå¤´ç»“ç‚¹ * æ—¶é—´å¤æ‚åº¦O(n) * @param array * @return */ public static &lt;T&gt; LinkList&lt;T&gt; createListF(T[] array)&#123; LinkList llist = new LinkList(); if(array!=null &amp;&amp; array.length&gt;0) &#123; for (T obj : array) &#123; LNode&lt;T&gt; node = new LNode(); node.data = obj; node.next = llist.head; llist.head = node; &#125; &#125; return llist; &#125; /** * 1.2 åˆ›å»ºå•é“¾è¡¨ï¼ˆå°¾æ’æ³•ï¼šé¡ºåºï¼‰ * è§£ï¼š * æ—¶é—´å¤æ‚åº¦O(n) * @param array * @return */ public static &lt;T&gt; LinkList&lt;T&gt; createListR(T[] array)&#123; LinkList llist = new LinkList(); if(array!=null &amp;&amp; array.length&gt;0)&#123; llist.head = new LNode(); llist.head.data = array[0]; LNode&lt;T&gt; temp = llist.head; for(int i = 1; i &lt; array.length; i++)&#123; LNode node = new LNode(); node.data = array[i]; temp.next = node; temp = node; &#125; &#125; return llist; &#125; /** * åˆ¤æ–­å•é“¾è¡¨æ˜¯å¦ä¸ºç©ºè¡¨ * æ—¶é—´å¤æ‚åº¦O(1) * @return */ @Override public boolean isEmpty() &#123; return head==null; &#125; /** * 4 è·å–å•é“¾è¡¨é•¿åº¦ * æ—¶é—´å¤æ‚åº¦O(n) * @return */ @Override public int length() &#123; if(head==null) return 0; int l = 1; LNode node = head; while(node.next!=null) &#123; l++; node = node.next; &#125; return l; &#125; @Override public void clear() &#123; head = null; &#125; @Override public T set(int index, T data) &#123; return null; &#125; @Override public boolean contains(T data) &#123; return false; &#125; @Override public T get(int index) &#123; return getNode(index).data; &#125; /** * 6.1 è·å–æŒ‡å®šç´¢å¼•çš„ç»“ç‚¹ * æ—¶é—´å¤æ‚åº¦O(n) * @param index * @return */ public LNode&lt;T&gt; getNode(int index)&#123; LNode node = head; int j = 0; while(j &lt; index &amp;&amp; node!=null)&#123; j++; node = node.next; &#125; return node; &#125; /** * 6.2 è·å–æŒ‡å®šæ•°æ®å€¼ç»“ç‚¹çš„ç´¢å¼• * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(1) * @param data * @return */ @Override public int indexOf(T data) &#123; if(head==null) return -1; //æ²¡æœ‰æ­¤ç»“ç‚¹ LNode node = head; int j = 0; while(node!=null)&#123; if(node.data.equals(data)) return j; j++; node = node.next; &#125; return -1; &#125; @Override public int lastIndexOf(T data) &#123; if(head==null) return -1; int index = -1; LNode node = head; int j = 0; while(node!=null)&#123; if(node.data.equals(data)) &#123; index = j; &#125; j++; node = node.next; &#125; return index; &#125; /** * 6.3 å•é“¾è¡¨ä¸­çš„å€’æ•°ç¬¬kä¸ªç»“ç‚¹ï¼ˆk &gt; 0ï¼‰ * è§£ï¼šå…ˆæ‰¾åˆ°é¡ºæ•°ç¬¬kä¸ªç»“ç‚¹ï¼Œç„¶åä½¿ç”¨å‰åæŒ‡é’ˆç§»åŠ¨åˆ°ç»“å°¾å³å¯ * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(1) * @param k * @return */ public LNode&lt;T&gt; getReNode(int k)&#123; if(head==null) return null; int len = length(); if(k &gt; len) return null; LNode target = head; LNode next = head; for(int i=0;i &lt; k;i++) next = next.next; while(next!=null)&#123; target = target.next; next = next.next; &#125; return target; &#125; /** * 6.4 æŸ¥æ‰¾å•é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹ * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(1) * @return */ public LNode getMiddleNode()&#123; if(head == null|| head.next == null) return head; LNode target = head; LNode temp = head; while(temp != null &amp;&amp; temp.next != null)&#123; target = target.next; temp = temp.next.next; &#125; return target; &#125; /** * 2.1 å°†å•é“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªå•é“¾è¡¨ * è§£ï¼šéå†ç¬¬ä¸€ä¸ªè¡¨ï¼Œç”¨å…¶å°¾ç»“ç‚¹æŒ‡å‘ç¬¬äºŒä¸ªè¡¨å¤´ç»“ç‚¹ * æ—¶é—´å¤æ‚åº¦O(n) * @return */ public static LNode mergeList(LNode head1, LNode head2)&#123; if(head1==null) return head2; if(head2==null) return head1; LNode loop = head1; while(loop.next!=null) //æ‰¾åˆ°list1å°¾ç»“ç‚¹ loop = loop.next; loop.next = head2; //å°†list1å°¾ç»“ç‚¹æŒ‡å‘list2å¤´ç»“ç‚¹ return head1; &#125; /** * 2.1 é€šè¿‡é€’å½’ï¼Œåˆå¹¶ä¸¤ä¸ªæœ‰åºçš„å•é“¾è¡¨head1å’Œhead2 * * è§£ï¼šä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘ä¸¤ä¸ªå¤´ç»“ç‚¹ï¼Œæ¯”è¾ƒä¸¤ä¸ªç»“ç‚¹å¤§å°ï¼Œ * å°çš„ç»“ç‚¹æŒ‡å‘ä¸‹ä¸€æ¬¡æ¯”è¾ƒç»“æœï¼ˆä¸¤è€…ä¸­è¾ƒå°ï¼‰ï¼Œæœ€ç»ˆè¿”å›ç¬¬ä¸€æ¬¡é€’å½’çš„æœ€å°ç»“ç‚¹ * @param head1 * @param head2 * @return */ public static LNode mergeSortedListRec(LNode head1, LNode head2)&#123; if(head1==null)return head2; if(head2==null)return head1; if (((int)head1.data)&gt;((int)head2.data)) &#123; head2.next = mergeSortedListRec(head2.next, head1); return head2; &#125; else &#123; head1.next = mergeSortedListRec(head1.next, head2); return head1; &#125; &#125; /** * 3.1 å¾ªç¯çš„æ–¹å¼å°†å•é“¾è¡¨åè½¬ * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(1) */ public void reverseListByLoop() &#123; if (head == null || head.next == null) return; LNode pre = null; LNode nex = null; while (head != null) &#123; nex = head.next; head.next = pre; pre = head; head = nex; &#125; head = pre; &#125; /** * 3.2 é€’å½’çš„æ–¹å¼å°†å•é“¾è¡¨åè½¬,è¿”å›åè½¬åçš„é“¾è¡¨å¤´ç»“ç‚¹ * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(n) */ public LNode reverseListByRec(LNode head) &#123; if(head==null||head.next==null) return head; LNode reHead = reverseListByRec(head.next); head.next.next = head; head.next = null; return reHead; &#125; /** * 5.1 è·å–å•é“¾è¡¨å­—ç¬¦ä¸²è¡¨ç¤º * æ—¶é—´å¤æ‚åº¦O(n) */ @Override public String toString() &#123; if(head == null) return \"\"; LNode node = head; StringBuffer buffer = new StringBuffer(); while(node != null)&#123; buffer.append(node.data+\" -&gt; \"); node = node.next; &#125; return buffer.toString(); &#125; public static String display(LNode head)&#123; if(head == null) return \"\"; LNode node = head; StringBuffer buffer = new StringBuffer(); while(node != null)&#123; buffer.append(\" -&gt; \"+node.data); node = node.next; &#125; return buffer.toString(); &#125; /** * 5.2 ç”¨æ ˆçš„æ–¹å¼è·å–å•é“¾è¡¨ä»å°¾åˆ°å¤´å€’å™å­—ç¬¦ä¸²è¡¨ç¤º * è§£ï¼šç”±äºæ ˆå…·æœ‰å…ˆè¿›åå‡ºçš„ç‰¹æ€§ï¼Œç°å°†è¡¨ä¸­çš„å…ƒç´ æ”¾å…¥æ ˆä¸­ï¼Œç„¶åå–å‡ºå°±å€’åºäº† * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(1) * @return */ public String displayReverseStack()&#123; if(head == null) return \"\"; Stack &lt;LNode&gt; stack = new Stack &lt; &gt;(); //å †æ ˆ å…ˆè¿›å…ˆå‡º LNode head = this.head; while(head!=null)&#123; stack.push(head); head=head.next; &#125; StringBuffer buffer = new StringBuffer(); while(!stack.isEmpty())&#123; //pop()ç§»é™¤å †æ ˆé¡¶éƒ¨çš„å¯¹è±¡ï¼Œå¹¶å°†è¯¥å¯¹è±¡ä½œä¸ºè¯¥å‡½æ•°çš„å€¼è¿”å›ã€‚ buffer.append(\" -&gt; \"+stack.pop().data); &#125; return buffer.toString(); &#125; /** * 5.3 ç”¨é€’å½’çš„æ–¹å¼è·å–å•é“¾è¡¨ä»å°¾åˆ°å¤´å€’å™å­—ç¬¦ä¸²è¡¨ç¤º * @return */ public void displayReverseRec(StringBuffer buffer, LNode head)&#123; if(head==null) return; displayReverseRec(buffer, head.next); buffer.append(\" -&gt; \"); buffer.append(head.data); &#125; /** * 7.1 æ’å…¥ç»“ç‚¹ * è§£ï¼šå…ˆæ‰¾åˆ°ç¬¬i-1ä¸ªç»“ç‚¹ï¼Œè®©åˆ›å»ºçš„æ–°ç»“ç‚¹çš„æŒ‡é’ˆåŸŸæŒ‡å‘ç¬¬i-1ç»“ç‚¹æŒ‡é’ˆåŸŸæŒ‡å‘çš„ç»“ç‚¹ï¼Œ * ç„¶åå°†i-1ç»“ç‚¹çš„æŒ‡é’ˆåŸŸæŒ‡å‘æ–°ç»“ç‚¹ * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(1) * @param data * @param index */ @Override public boolean add(int index, T data) &#123; if(index==0)&#123; //æ’å…¥ä¸ºå¤´ç»“ç‚¹ LNode temp = new LNode(); temp.next = head; return true; &#125; int j = 0; LNode node = head; while(j &lt; index-1 &amp;&amp; node!=null)&#123; //æ‰¾åˆ°åºåˆ—å·ä¸ºindex-1çš„ç»“ç‚¹ j++; node = node.next; &#125; if(node==null) return false; LNode temp = new LNode(); //åˆ›å»ºæ–°ç»“ç‚¹ temp.data = data; temp.next = node.next; //æ–°ç»“ç‚¹æ’å…¥åˆ°Index-1ç»“ç‚¹ä¹‹å node.next = temp; return true; &#125; @Override public boolean add(T data) &#123; LNode node = head; while(node!=null &amp;&amp; node.next!=null) //æ‰¾åˆ°å°¾ç»“ç‚¹ node = node.next; LNode temp = new LNode(); //åˆ›å»ºæ–°ç»“ç‚¹ temp.data = data; node.next = temp; return false; &#125; @Override public T remove(int index) &#123; LNode&lt;T&gt; node = deleteNode(index); return node==null?null:node.data; &#125; /** * 7.2 åˆ é™¤ç»“ç‚¹ * è§£ï¼šè®©è¢«åˆ é™¤çš„ç»“ç‚¹å‰ä¸€ä¸ªç»“ç‚¹çš„æŒ‡é’ˆåŸŸæŒ‡å‘åä¸€ä¸ªç»“ç‚¹æŒ‡é’ˆåŸŸ * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(1) * @return */ public LNode deleteNode(int index)&#123; LNode node = head; if(index==0)&#123; //åˆ é™¤å¤´ç»“ç‚¹ if(node==null) return null; head = node.next; return node; &#125; //éå¤´ç»“ç‚¹ int j = 0; while(j &lt; index-1 &amp;&amp; node!=null)&#123; //æ‰¾åˆ°åºåˆ—å·ä¸ºindex-1çš„ç»“ç‚¹ j++; node = node.next; &#125; if(node==null) return null; LNode delete = node.next; if(delete==null) return null; //ä¸å­˜åœ¨ç¬¬indexä¸ªç»“ç‚¹ node.next = delete.next; return delete; &#125; @Override public boolean remove(T data) &#123; return false; &#125; @Override public boolean removeAll(T data) &#123; return false; &#125; /** * 7.3 ç»™å‡ºä¸€å•é“¾è¡¨å¤´æŒ‡é’ˆheadå’Œä¸€èŠ‚ç‚¹æŒ‡é’ˆdeleteï¼Œè¦æ±‚O(1)æ—¶é—´å¤æ‚åº¦åˆ é™¤èŠ‚ç‚¹delete * è§£ï¼šå°†deleteèŠ‚ç‚¹valueå€¼ä¸å®ƒä¸‹ä¸ªèŠ‚ç‚¹çš„å€¼äº’æ¢çš„æ–¹æ³•ï¼Œ * ä½†æ˜¯å¦‚æœdeleteæ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œä½†æ˜¯æ€»å¾—å¤æ‚åº¦è¿˜æ˜¯O(1) * @return */ public static void deleteNode(LNode head, LNode delete)&#123; if(delete==null) return; //é¦–å…ˆå¤„ç†deleteèŠ‚ç‚¹ä¸ºæœ€åä¸€ä¸ªèŠ‚ç‚¹çš„æƒ…å†µ if(delete.next==null)&#123; if(head==delete) //åªæœ‰ä¸€ä¸ªç»“ç‚¹ head = null; else&#123; //åˆ é™¤å°¾ç»“ç‚¹ LNode temp = head; while(temp.next!=delete) temp = temp.next; temp.next=null; &#125; &#125; else&#123; delete.data = delete.next.data; delete.next = delete.next.next; &#125; return; &#125; /** * 8.1 åˆ¤æ–­ä¸€ä¸ªå•é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ * è§£ï¼šä½¿ç”¨å¿«æ…¢æŒ‡é’ˆæ–¹æ³•ï¼Œå¦‚æœå­˜åœ¨ç¯ï¼Œä¸¤ä¸ªæŒ‡é’ˆå¿…å®šæŒ‡å‘åŒä¸€ç»“ç‚¹ * æ—¶é—´å¤æ‚åº¦O(n) ç©ºé—´å¤æ‚åº¦O(1) * @return */ public static boolean hasCycle(LNode head)&#123; LNode p1 = head; LNode p2 = head; while(p1!=null &amp;&amp; p2!=null)&#123; p1 = p1.next; //ä¸€æ¬¡è·³ä¸€æ­¥ p2 = p2.next.next; //ä¸€æ¬¡è·³ä¸¤æ­¥ if(p2 == p1) return true; &#125; return false; &#125; /** * 8.2ã€å·²çŸ¥ä¸€ä¸ªå•é“¾è¡¨ä¸­å­˜åœ¨ç¯ï¼Œæ±‚è¿›å…¥ç¯ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ * åˆ©ç”¨hashmapï¼Œä¸è¦ç”¨ArrayListï¼Œå› ä¸ºåˆ¤æ–­ArrayListæ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ çš„æ•ˆç‡ä¸é«˜ * @param head * @return */ public static LNode getFirstNodeInCycleHashMap(LNode head)&#123; LNode target = null; HashMap&lt;LNode,Boolean &gt; map=new HashMap&lt; &gt;(); while(head != null)&#123; if(map.containsKey(head)) &#123; target = head; break; &#125; else &#123; map.put(head, true); head = head.next; &#125; &#125; return target; &#125; /** * 8.3ã€å·²çŸ¥ä¸€ä¸ªå•é“¾è¡¨ä¸­å­˜åœ¨ç¯ï¼Œæ±‚è¿›å…¥ç¯ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹,ä¸ç”¨hashmap * ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œä¸åˆ¤æ–­ä¸€ä¸ªå•é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ä¸€æ ·ï¼Œæ‰¾åˆ°å¿«æ…¢æŒ‡é’ˆç¬¬ä¸€æ¬¡ç›¸äº¤çš„èŠ‚ç‚¹ï¼Œ * æ­¤æ—¶è¿™ä¸ªèŠ‚ç‚¹è·ç¦»ç¯å¼€å§‹èŠ‚ç‚¹çš„é•¿åº¦å’Œé“¾è¡¨å¤´è·ç¦»ç¯å¼€å§‹çš„èŠ‚ç‚¹çš„é•¿åº¦ç›¸ç­‰ * å‚è€ƒ https://www.cnblogs.com/fankongkong/p/7007869.html * @param head * @return */ public static LNode getFirstNodeInCycle(LNode head)&#123; LNode fast = head; LNode slow = head; while(fast != null &amp;&amp; fast.next != null)&#123; slow = slow.next; fast = fast.next.next; if(slow == fast) break; &#125; if(fast == null||fast.next == null) return null;//åˆ¤æ–­æ˜¯å¦åŒ…å«ç¯ //ç›¸é‡èŠ‚ç‚¹è·ç¦»ç¯å¼€å§‹èŠ‚ç‚¹çš„é•¿åº¦å’Œé“¾è¡¨æŠ•è·ç¦»ç¯å¼€å§‹çš„èŠ‚ç‚¹çš„é•¿åº¦ç›¸ç­‰ slow=head; while(slow!=fast)&#123; slow=slow.next; fast=fast.next; &#125;//åŒæ­¥èµ° return slow; &#125; /** * 9ã€åˆ¤æ–­ä¸¤ä¸ªå•é“¾è¡¨æ˜¯å¦ç›¸äº¤,å¦‚æœç›¸äº¤è¿”å›ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦åˆ™è¿”å›null * â‘ ã€æš´åŠ›éå†ä¸¤ä¸ªè¡¨ï¼Œæ˜¯å¦æœ‰ç›¸åŒçš„ç»“ç‚¹(æ—¶é—´å¤æ‚åº¦O(nÂ²)) * â‘¡ã€ç¬¬ä¸€ä¸ªè¡¨çš„å°¾ç»“ç‚¹æŒ‡å‘ç¬¬äºŒä¸ªè¡¨å¤´ç»“ç‚¹ï¼Œç„¶ååˆ¤æ–­ç¬¬äºŒä¸ªè¡¨æ˜¯å¦å­˜åœ¨ç¯ï¼Œä½†ä¸å®¹æ˜“æ‰¾å‡ºäº¤ç‚¹ï¼ˆæ—¶é—´å¤æ‚åº¦O(n)ï¼‰ * â‘¢ã€ä¸¤ä¸ªé“¾è¡¨ç›¸äº¤ï¼Œå¿…ç„¶ä¼šç»è¿‡åŒä¸€ä¸ªç»“ç‚¹ï¼Œè¿™ä¸ªç»“ç‚¹çš„åç»§ç»“ç‚¹ä¹Ÿæ˜¯ç›¸åŒçš„ï¼ˆé“¾è¡¨ç»“ç‚¹åªæœ‰ä¸€ä¸ªæŒ‡é’ˆåŸŸï¼Œåç»§ç»“ç‚¹åªèƒ½æœ‰ä¸€ä¸ªï¼‰ï¼Œ * æ‰€ä»¥ä»–ä»¬çš„å°¾ç»“ç‚¹å¿…ç„¶ç›¸åŒã€‚ä¸¤ä¸ªé“¾è¡¨ç›¸äº¤ï¼Œåªèƒ½æ˜¯å‰é¢çš„ç»“ç‚¹ä¸åŒï¼Œæ‰€ä»¥ï¼Œç æ‰è¾ƒé•¿é“¾è¡¨çš„å·®å€¼ååŒæ­¥éå†ï¼Œåˆ¤æ–­ç»“ç‚¹æ˜¯å¦ç›¸åŒï¼Œç›¸åŒçš„å°±æ˜¯äº¤ç‚¹äº†ã€‚ * æ—¶é—´å¤æ‚åº¦ï¼ˆæ—¶é—´å¤æ‚åº¦O(n)ï¼‰ * @param list1 * @param list2 * @return äº¤ç‚¹ */ public static LNode isIntersect(LinkList list1, LinkList list2)&#123; LNode head1 = list1.head; LNode head2 = list2.head; if(head1==null || head2==null)return null; int len1 = list1.length(); int len2 = list2.length(); //ç æ‰è¾ƒé•¿é“¾è¡¨çš„å·®å€¼ if(len1 &gt;= len2)&#123; for(int i=0;i &lt; len1-len2;i++)&#123; head1=head1.next; &#125; &#125;else&#123; for(int i=0;i &lt; len2-len1;i++)&#123; head2=head2.next; &#125; &#125; //åŒæ­¥éå† while(head1 != null&amp;&amp;head2 != null)&#123; if(head1 == head2) return head1; head1=head1.next; head2=head2.next; &#125; return null; &#125;&#125;ç®—æ³•åˆ†æåˆ¤æ–­ä¸€ä¸ªå•é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯æˆ‘ä»¬å¯ä»¥é€šè¿‡HashMapåˆ¤æ–­ï¼Œéå†ç»“ç‚¹ï¼Œå°†ç»“ç‚¹å€¼æ”¾å…¥HashMapï¼Œå¦‚æœæŸä¸€åˆ»å‘ç°å½“å‰ç»“ç‚¹åœ¨mapä¸­å·²ç»å­˜åœ¨ï¼Œåˆ™å­˜åœ¨ç¯ï¼Œå¹¶ä¸”æ­¤ç»“ç‚¹æ­£æ˜¯ç¯çš„å…¥å£ï¼Œæ­¤ç®—æ³•è§8.2æ–¹æ³•ã€‚ä½†æ˜¯æœ‰ä¸€ç§é—®æ³•æ˜¯ä¸é€šè¿‡ä»»ä½•å…¶ä»–æ•°æ®ç»“æ„æ€ä¹ˆåˆ¤æ–­å•é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯ã€‚è¿™æ ·æˆ‘ä»¬å¯åˆ©ç”¨çš„å°±åªæœ‰å•é“¾è¡¨æœ¬èº«ï¼Œä¸€ç§è§£æ³•æ˜¯é€šè¿‡å¿«æ…¢æŒ‡é’ˆï¼Œéå†é“¾è¡¨ï¼Œä¸€ä¸ªæŒ‡é’ˆè·³ä¸€æ­¥ï¼ˆæ…¢æŒ‡é’ˆæ­¥é•¿ä¸º1ï¼‰ï¼Œå¦ä¸€ä¸ªæŒ‡é’ˆè·³ä¸¤æ­¥ï¼ˆå¿«æŒ‡é’ˆæ­¥é•¿ä¸º2ï¼‰ï¼Œå¦‚æœå­˜åœ¨ç¯ï¼Œè¿™ä¸¤ä¸ªæŒ‡é’ˆå¿…å°†åœ¨æŸä¸€åˆ»æŒ‡å‘åŒä¸€ç»“ç‚¹ï¼Œå‡è®¾æ­¤æ—¶æ…¢æŒ‡é’ˆè·³äº†næ­¥ï¼Œåˆ™å¿«æŒ‡é’ˆè·³çš„æ­¥æ•°ä¸ºn/2æ­¥ï¼šåˆ¤æ–­ä¸¤ä¸ªå•é“¾è¡¨æ˜¯å¦ç›¸äº¤ç”±äºå•é“¾è¡¨çš„ç‰¹æ€§ï¼ˆåªæœ‰ä¸€ä¸ªæŒ‡é’ˆåŸŸï¼‰ï¼Œå¦‚æœä¸¤ä¸ªè¡¨ç›¸äº¤ï¼Œé‚£å¿…å®šæ˜¯Yå½¢ç›¸äº¤ï¼Œä¸ä¼šæ˜¯Xå½¢ç›¸äº¤ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚ä¸¤ä¸ªå•é“¾è¡¨åé¢çš„ç»“ç‚¹ç›¸åŒï¼Œä¸åŒçš„éƒ¨åˆ†åªæœ‰å‰é¢ï¼Œç æ‰è¾ƒé•¿çš„é“¾è¡¨çš„å‰é¢éƒ¨åˆ†ï¼Œç„¶åä¸¤ä¸ªé“¾è¡¨åŒæ­¥éå†ï¼Œå¿…å°†æŒ‡å‘åŒä¸€ä¸ªç»“ç‚¹ï¼Œè¿™ä¸ªç»“ç‚¹å°±æ˜¯äº¤ç‚¹ï¼šåŒé“¾è¡¨åŒé“¾è¡¨ä¸­æ¯ä¸ªç»“ç‚¹æœ‰ä¸¤ä¸ªæŒ‡é’ˆåŸŸï¼Œä¸€ä¸ªæŒ‡å‘å…¶ç›´æ¥åç»§ç»“ç‚¹ï¼Œä¸€ä¸ªæŒ‡å‘å…¶ç›´æ¥å‰é©±ç»“ç‚¹ã€‚å»ºç«‹åŒé“¾è¡¨ä¹Ÿæœ‰ä¸¤ç§æ–¹æ³•ï¼Œå¤´æ’æ³•å’Œå°¾æ’æ³•ï¼Œè¿™ä¸åˆ›å»ºå•é“¾è¡¨è¿‡ç¨‹ç›¸ä¼¼ã€‚åœ¨åŒé“¾è¡¨ä¸­ï¼Œæœ‰äº›ç®—æ³•å¦‚æ±‚é•¿åº¦ã€å–å…ƒç´ å€¼ã€æŸ¥æ‰¾å…ƒç´ ç­‰ç®—æ³•ä¸å•é“¾è¡¨ä¸­ç›¸åº”ç®—æ³•æ˜¯ç›¸åŒçš„ã€‚ä½†æ˜¯åœ¨å•é“¾è¡¨ä¸­ï¼Œè¿›è¡Œç»“ç‚¹æ’å…¥å’Œåˆ é™¤æ—¶æ¶‰åŠå‰åç»“ç‚¹çš„ä¸€ä¸ªæŒ‡é’ˆåŸŸçš„å˜åŒ–ï¼Œè€ŒåŒé“¾è¡¨ä¸­ç»“ç‚¹çš„æ’å…¥å’Œåˆ é™¤æ“ä½œæ¶‰åŠå‰åç»“ç‚¹çš„ä¸¤ä¸ªæŒ‡é’ˆåŸŸçš„å˜åŒ–ã€‚javaä¸­LinkedListæ­£æ˜¯å¯¹åŒé“¾è¡¨çš„å®ç°ï¼Œç®—æ³•å¯å‚è€ƒæ­¤ç±»ã€‚åŒé“¾è¡¨åŸºæœ¬è¿ç®—çš„å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327public class DLinkList&lt;T&gt; implements IList&lt;T&gt;&#123; transient DNode&lt;T&gt; first; //åŒé“¾è¡¨å¼€å§‹ç»“ç‚¹ transient DNode&lt;T&gt; last; //åŒé“¾è¡¨æœ«ç«¯ç»“ç‚¹ private int size; //ç»“ç‚¹æ•° /** * åˆ›å»ºå•é“¾è¡¨ï¼ˆå¤´æ’æ³•ï¼šå€’åºï¼‰ * æ—¶é—´å¤æ‚åº¦O(n) * @param array * @return */ public static &lt;T&gt; DLinkList&lt;T&gt; createListF(T[] array)&#123; DLinkList dlist = new DLinkList(); if(array!=null &amp;&amp; array.length&gt;0) &#123; dlist.size = array.length; for (T obj : array) &#123; DNode&lt;T&gt; node = new DNode(); node.data = obj; node.next = dlist.first; if(dlist.first!=null) dlist.first.prior = node; //ç›¸æ¯”å•é“¾è¡¨å¤šäº†æ­¤æ­¥ else dlist.last = node; dlist.first = node; &#125; &#125; return dlist; &#125; /** * 1.2 åˆ›å»ºå•é“¾è¡¨ï¼ˆå°¾æ’æ³•ï¼šé¡ºåºï¼‰ * æ—¶é—´å¤æ‚åº¦O(n) * @param array * @return */ public static &lt;T&gt; DLinkList&lt;T&gt; createListR(T[] array)&#123; DLinkList dlist = new DLinkList(); if(array!=null &amp;&amp; array.length&gt;0)&#123; dlist.size = array.length; dlist.first = new DNode&lt;T&gt;(); dlist.first.data = array[0]; dlist.last = dlist.first; for(int i = 1; i &lt; array.length; i++)&#123; DNode&lt;T&gt; node = new DNode(); node.data = array[i]; dlist.last.next = node; node.prior = dlist.last; //ç›¸æ¯”å•é“¾è¡¨å¤šäº†æ­¤æ­¥ dlist.last = node; &#125; &#125; return dlist; &#125; @Override public boolean isEmpty() &#123; return size==0; &#125; @Override public int length() &#123; return size; &#125; /**2 æ·»åŠ ç»“ç‚¹*/ @Override public boolean add(int index, T data) &#123; if(index &lt; 0 || index &gt; size) throw new IndexOutOfBoundsException(); DNode&lt;T&gt; newNode = new DNode(); newNode.data = data; if (index == size) &#123; //åœ¨æœ«å°¾æ·»åŠ ç»“ç‚¹ä¸éœ€è¦éå† final DNode&lt;T&gt; l = last; if (l == null) //ç©ºè¡¨ first = newNode; else &#123; l.next = newNode; newNode.prior = l; &#125; last = newNode; size++; &#125; else &#123; //å…¶ä»–ä½ç½®æ·»åŠ ç»“ç‚¹éœ€è¦éå†æ‰¾åˆ°indexä½ç½®çš„ç»“ç‚¹ DNode&lt;T&gt; indexNode = getNode(index); DNode&lt;T&gt; pred = indexNode.prior; newNode.prior = pred; newNode.next = indexNode; indexNode.prior = newNode; if (pred == null) first = newNode; else pred.next = newNode; size++; &#125; return false; &#125; @Override public boolean add(T data) &#123; return add(size, data); &#125; /**3 åˆ é™¤ç»“ç‚¹*/ @Override public T remove(int index) &#123; if(index &lt; 0 || index &gt;= size) throw new IndexOutOfBoundsException(); return unlink(getNode(index)); &#125; @Override public boolean remove(T data) &#123; if (data == null) &#123; for (DNode&lt;T&gt; x = first; x != null; x = x.next) &#123; if (x.data == null) &#123; unlink(x); return true; &#125; &#125; &#125; else &#123; for (DNode&lt;T&gt; x = first; x != null; x = x.next) &#123; if (data.equals(x.data)) &#123; unlink(x); return true; &#125; &#125; &#125; return false; &#125; @Override public boolean removeAll(T data) &#123; boolean result = false; if (data == null) &#123; for (DNode&lt;T&gt; x = first; x != null; x = x.next) &#123; if (x.data == null) &#123; unlink(x); result = true; &#125; &#125; &#125; else &#123; for (DNode&lt;T&gt; x = first; x != null; x = x.next) &#123; if (data.equals(x.data)) &#123; unlink(x); result = true; &#125; &#125; &#125; return result; &#125; /** * å°†æŒ‡å®šçš„ç»“ç‚¹è§£é™¤é“¾æ¥ * @param x * @return */ private T unlink(DNode&lt;T&gt; x) &#123; // assert x != null; final T element = x.data; final DNode&lt;T&gt; next = x.next; final DNode&lt;T&gt; prev = x.prior; if (prev == null) &#123; first = next; &#125; else &#123; prev.next = next; x.prior = null; &#125; if (next == null) &#123; last = prev; &#125; else &#123; next.prior = prev; x.next = null; &#125; x.data = null; size--; return element; &#125; /** * æ¸…ç©º */ @Override public void clear() &#123; for (DNode&lt;T&gt; x = first; x != null; ) &#123; DNode&lt;T&gt; next = x.next; x.data = null; x.next = null; x.prior = null; x = next; &#125; first = last = null; size = 0; &#125; /** * è®¾ç½®ç»“ç‚¹å€¼ * @param index * @param data * @return */ @Override public T set(int index, T data) &#123; if(index &lt; 0 || index &gt;= size) throw new IndexOutOfBoundsException(); DNode&lt;T&gt; x = getNode(index); T oldVal = x.data; x.data = data; return oldVal; &#125; /** * åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç»“ç‚¹å€¼ * @param data * @return */ @Override public boolean contains(T data) &#123; return indexOf(data) != -1; &#125; /** * æ£€ç´¢ç»“ç‚¹å€¼ * @param data * @return */ @Override public int indexOf(T data) &#123; int index = 0; if (data == null) &#123; for (DNode&lt;T&gt; x = first; x != null; x = x.next) &#123; if (x.data == null) return index; index++; &#125; &#125; else &#123; for (DNode&lt;T&gt; x = first; x != null; x = x.next) &#123; if (data.equals(x.data)) return index; index++; &#125; &#125; return -1; &#125; @Override public int lastIndexOf(T data) &#123; int index = size; if (data == null) &#123; for (DNode&lt;T&gt; x = last; x != null; x = x.prior) &#123; index--; if (x.data == null) return index; &#125; &#125; else &#123; for (DNode&lt;T&gt; x = last; x != null; x = x.prior) &#123; index--; if (data.equals(x.data)) return index; &#125; &#125; return -1; &#125; @Override public T get(int index) &#123; if(index &lt; 0 || index &gt;= size) throw new IndexOutOfBoundsException(); return getNode(index).data; &#125; /** * è·å–æŒ‡å®šç´¢å¼•çš„ç»“ç‚¹ * è§£ï¼šç”±äºåŒé“¾è¡¨èƒ½åŒå‘æ£€ç´¢ï¼Œåˆ¤æ–­indexç¦»å¼€å§‹ç»“ç‚¹è¿‘è¿˜æ˜¯ç»ˆç«¯ç»“ç‚¹è¿‘ï¼Œä»è¿‘çš„ä¸€æ®µå¼€å§‹éå† * æ—¶é—´å¤æ‚åº¦O(n) * @param index * @return */ private DNode&lt;T&gt; getNode(int index) &#123; if (index &lt; (size &gt;&gt; 1)) &#123; DNode&lt;T&gt; x = first; for (int i = 0; i &lt; index; i++) x = x.next; return x; &#125; else &#123; DNode&lt;T&gt; x = last; for (int i = size - 1; i &gt; index; i--) x = x.prior; return x; &#125; &#125; /** * å€’åº * éå†æ¯ä¸ªç»“ç‚¹ï¼Œè®©node.next = node.prior; node.prior = (node.nextæ­¤å€¼éœ€è¦ä½“ç°ä¿å­˜); */ public void reverse()&#123; last = first; //åè½¬åç»ˆç«¯ç»“ç‚¹=å¼€å§‹ç»“ç‚¹ DNode now = first; DNode next; while(now!=null)&#123; next = now.next; //ä¿å­˜å½“å‰ç»“ç‚¹çš„åç»§ç»“ç‚¹ now.next = now.prior; now.prior = next; first = now; now = next; &#125; &#125; @Override public String toString() &#123; if(size == 0) return \"\"; DNode node = first; StringBuffer buffer = new StringBuffer(); buffer.append(\" \"); while(node != null)&#123; buffer.append(node.data+\" -&gt; \"); node = node.next; &#125; buffer.append(\"next\\npre\"); node = last; int start = buffer.length(); LogUtil.i(getClass().getSimpleName(), \"bufferé•¿åº¦ï¼š\"+buffer.length()); while(node != null)&#123; buffer.insert(start ,\" &lt;- \"+node.data); node = node.prior; &#125; return buffer.toString(); &#125;&#125;ç®—æ³•åˆ†æåŒé“¾è¡¨ä¸å•é“¾è¡¨ä¸åŒä¹‹å¤„åœ¨äºï¼ŒåŒé“¾è¡¨èƒ½ä»ä¸¤ç«¯ä¾æ¬¡è®¿é—®å„ä¸ªç»“ç‚¹ã€‚å•é“¾è¡¨ç›¸å¯¹äºé¡ºåºè¡¨ä¼˜ç‚¹æ˜¯æ’å…¥ã€åˆ é™¤æ•°æ®æ›´æ–¹ä¾¿ï¼Œä½†æ˜¯è®¿é—®ç»“ç‚¹éœ€è¦éå†ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼›åŒé“¾è¡¨å°±æ˜¯åœ¨å•é“¾è¡¨åŸºç¡€ä¸Šåšäº†ä¸€ä¸ªä¼˜åŒ–ï¼Œä½¿å¾—è®¿é—®ç»“ç‚¹æ›´åŠ ä¾¿æ·ï¼ˆä»ä¸¤ç«¯ï¼‰ï¼Œè¿™æ ·ä»è¿‘çš„ä¸€ç«¯å‡ºå‘æ—¶é—´å¤æ‚åº¦å˜ä¸ºO(n/2)ï¼Œè™½ç„¶ä¸æ˜¯æŒ‡æ•°é˜¶çš„åŒºåˆ«ï¼Œä½†ä¹Ÿç®—æ˜¯ä¼˜åŒ–ã€‚åŒé“¾è¡¨åœ¨æ’å…¥ã€åˆ é™¤ç»“ç‚¹æ—¶é€»è¾‘æ¯”å•é“¾è¡¨ç¨éº»çƒ¦ï¼šå¾ªç¯é“¾è¡¨å¾ªç¯é“¾è¡¨æ˜¯å¦ä¸€ç§å½¢å¼çš„é“¾å¼å­˜å‚¨ç»“æ„ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯è¡¨ä¸­å°¾ç»“ç‚¹çš„æŒ‡é’ˆåŸŸä¸å†æ˜¯ç©ºï¼Œè€Œæ˜¯æŒ‡å‘å¤´ç»“ç‚¹ï¼Œæ•´ä¸ªé“¾è¡¨å½¢æˆä¸€ä¸ªç¯ã€‚ç”±æ­¤ï¼Œä»è¡¨ä¸­ä»»æ„ä¸€ç»“ç‚¹å‡ºå‘å‡å¯æ‰¾åˆ°é“¾è¡¨ä¸­å…¶ä»–ç»“ç‚¹ã€‚å¦‚å›¾æ‰€ç¤ºä¸ºå¸¦å¤´ç»“ç‚¹çš„å¾ªç¯å•é“¾è¡¨å’Œå¾ªç¯åŒé“¾è¡¨ï¼šæœ‰åºè¡¨æ‰€è°“æœ‰åºè¡¨ï¼Œæ˜¯æŒ‡æ‰€æœ‰ç»“ç‚¹å…ƒç´ å€¼ä»¥é€’å¢æˆ–é€’å‡æ–¹å¼æ’åˆ—çš„çº¿æ€§è¡¨ï¼Œå¹¶è§„å®šæœ‰åºè¡¨ä¸­ä¸å­˜åœ¨å…ƒç´ å€¼ç›¸åŒçš„ç»“ç‚¹ã€‚æœ‰åºè¡¨å¯ä»¥é‡‡ç”¨é¡ºåºè¡¨å’Œé“¾è¡¨è¿›è¡Œå­˜å‚¨ï¼Œè‹¥ä»¥é¡ºåºè¡¨å­˜å‚¨æœ‰åºè¡¨ï¼Œå…¶ç®—æ³•é™¤äº†add(T data)ä»¥å¤–ï¼Œå…¶ä»–å‡ä¸å‰é¢è¯´çš„é¡ºåºè¡¨å¯¹åº”çš„è¿ç®—ç›¸åŒã€‚æœ‰åºè¡¨çš„add(T data)æ“ä½œä¸æ˜¯æ’å…¥åˆ°æœ«å°¾ï¼Œè€Œéœ€è¦éå†æ¯”è¾ƒå¤§å°åæ’å…¥ç›¸åº”ä½ç½®ã€‚123456789101112131415public boolean addByOrder(int data) &#123; int index = 0; //æ‰¾åˆ°é¡ºåºè¡¨ä¸­ç¬¬ä¸€ä¸ªå¤§äºç­‰äºdataçš„å…ƒç´  while(index&lt;datas.length &amp;&amp; (int)datas[index]&lt;data) index++; if((int)datas[index] == data) //ä¸èƒ½æœ‰ç›¸åŒå…ƒç´  return false; Object destination[] = new Object[datas.length + 1]; System.arraycopy(datas, 0, destination, 0, index); //å°†datas[index]åŠåé¢å…ƒç´ åç§»ä¸€ä½ System.arraycopy(datas, index, destination, index+1, datas.length-index); destination[index] = data; datas = destination; return true;&#125;æœ€å æƒ³å¼ºè°ƒçš„æ˜¯ ç”±äºé¡ºåºè¡¨ç»“æ„çš„åº•å±‚å®ç°å€ŸåŠ©çš„å°±æ˜¯æ•°ç»„ï¼Œå› æ­¤å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œå¯ä»¥æŠŠé¡ºåºè¡¨å®Œå…¨ç­‰ä»·ä¸ºæ•°ç»„ï¼Œä½†å®åˆ™ä¸æ˜¯è¿™æ ·ã€‚æ•°æ®ç»“æ„æ˜¯ç ”ç©¶æ•°æ®å­˜å‚¨æ–¹å¼çš„ä¸€é—¨å­¦ç§‘ï¼Œå®ƒå›Šæ‹¬çš„éƒ½æ˜¯å„ç§å­˜å‚¨ç»“æ„ï¼Œè€Œæ•°ç»„åªæ˜¯å„ç§ç¼–ç¨‹è¯­è¨€ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¹¶ä¸å±äºæ•°æ®ç»“æ„çš„èŒƒç•´ã€‚","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"cpeixin.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"çº¿æ€§è¡¨","slug":"çº¿æ€§è¡¨","permalink":"cpeixin.cn/tags/%E7%BA%BF%E6%80%A7%E8%A1%A8/"}]},{"title":"æ•°æ®ç»“æ„-æ•°ç»„","slug":"æ•°æ®ç»“æ„-æ•°ç»„","date":"2016-08-11T07:30:21.000Z","updated":"2020-06-08T08:43:43.141Z","comments":true,"path":"2016/08/11/æ•°æ®ç»“æ„-æ•°ç»„/","link":"","permalink":"cpeixin.cn/2016/08/11/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%95%B0%E7%BB%84/","excerpt":"","text":"æ•°æ®ç»“æ„-æ•°ç»„æåˆ°æ•°ç»„ï¼Œæˆ‘æƒ³ä½ è‚¯å®šä¸é™Œç”Ÿï¼Œç”šè‡³è¿˜ä¼šè‡ªä¿¡åœ°è¯´ï¼Œå®ƒå¾ˆç®€å•å•Šã€‚æ˜¯çš„ï¼Œåœ¨æ¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ä¸­ï¼ŒåŸºæœ¬éƒ½ä¼šæœ‰æ•°ç»„è¿™ç§æ•°æ®ç±»å‹ã€‚ä¸è¿‡ï¼Œå®ƒä¸ä»…ä»…æ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ä¸­çš„æ•°æ®ç±»å‹ï¼Œè¿˜æ˜¯ä¸€ç§æœ€åŸºç¡€çš„æ•°æ®ç»“æ„ã€‚å°½ç®¡æ•°ç»„çœ‹èµ·æ¥éå¸¸åŸºç¡€ã€ç®€å•ï¼Œä½†æ˜¯æˆ‘ä¼°è®¡å¾ˆå¤šäººéƒ½å¹¶æ²¡æœ‰ç†è§£è¿™ä¸ªåŸºç¡€æ•°æ®ç»“æ„çš„ç²¾é«“ã€‚åœ¨å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæ•°ç»„éƒ½æ˜¯ä» 0 å¼€å§‹ç¼–å·çš„ï¼Œä½†ä½ æ˜¯å¦ä¸‹æ„è¯†åœ°æƒ³è¿‡ï¼Œä¸ºä»€ä¹ˆæ•°ç»„è¦ä» 0 å¼€å§‹ç¼–å·ï¼Œè€Œä¸æ˜¯ä» 1 å¼€å§‹å‘¢ï¼Ÿ ä» 1 å¼€å§‹ä¸æ˜¯æ›´ç¬¦åˆäººç±»çš„æ€ç»´ä¹ æƒ¯å—ï¼ŸTips: åœ¨Cï¼ŒJavaä¸­éƒ½æœ‰æ˜æ˜¾çš„æ•°ç»„å®ç°ï¼Œä½†æ˜¯åœ¨Pythonä¸­æœ‰listã€tupleã€setã€dict, å¹¶æ²¡æœ‰æ˜¾ç¤ºçš„æ•°ç»„å…³é”®å­—â€œæ•°ç»„â€å®é™…ä¸Šç¡®å®å­˜åœ¨äºpythonä¸­ã€‚å½“äººä»¬è°ˆè®ºæ•°ç»„æ—¶ï¼ŒPythonè‡³å°‘æœ‰ä¸‰ä»¶äº‹è¦è°ˆè®ºï¼šåœ¨Python listæœ‰è®¸å¤šåœ¨å…¶ä»–è¯­è¨€ï¼Œå¦‚Cæˆ–Javaä¸­ æ•°ç»„çš„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œå®ƒä¸éœ€è¦é¢„å…ˆåˆ†é…å†…å­˜ï¼Œåˆ†é…æ•°ç»„é•¿åº¦ï¼Œå®ƒå¸¦æœ‰è®¸å¤šä¾¿æ·çš„æ–¹æ³•ã€‚æ­¤å¤–ï¼Œå®ƒçš„åŸºç¡€æ•°æ®ç»“æ„é€šå¸¸æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚è¯·è®°ä½ï¼Œè¯­è¨€åªæ˜¯è¯­æ³•-å®ƒå¯ä»¥é€šè¿‡ä¸åŒçš„æ–¹å¼å®ç°ã€‚CPythonä¸­Pythonåˆ—è¡¨çš„åŸºç¡€æ•°æ®ç»“æ„æ˜¯Cæ•°ç»„ï¼Œåœ¨Jythonä¸­æ˜¯ArrayListï¼ˆæ¥æºï¼šPythonåˆ—è¡¨çš„åŸºç¡€æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿï¼‰åˆ—è¡¨å¯¹è±¡è¢«å®ç°ä¸ºæ•°ç»„ã€‚å®ƒä»¬é’ˆå¯¹å¿«é€Ÿçš„å›ºå®šé•¿åº¦æ“ä½œè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¹¶ä¸”ä¼šä¸ºpopï¼ˆ0ï¼‰å’Œinsertï¼ˆ0ï¼Œvï¼‰æ“ä½œäº§ç”ŸOï¼ˆnï¼‰å†…å­˜ç§»åŠ¨æˆæœ¬ï¼Œè¿™äº›æ“ä½œä¼šåŒæ—¶æ›´æ”¹åŸºç¡€æ•°æ®è¡¨ç¤ºçš„å¤§å°å’Œä½ç½®ã€‚æœ€åï¼Œè¿˜æœ‰NumPy æ•°ç»„ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å¿«é€Ÿï¼Œéå¸¸æœ‰ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¯è®©æ‚¨å¿«é€Ÿè¿›è¡Œè®¸å¤šæ•°å€¼è®¡ç®—ã€‚åœ¨æ­¤å¤„äº†è§£æœ‰å…³NumPyçš„æ›´å¤šä¿¡æ¯ï¼šNumPy-Numpyè¿™ä¸ªå®šä¹‰é‡Œæœ‰å‡ ä¸ªå…³é”®è¯ï¼Œç†è§£äº†è¿™å‡ ä¸ªå…³é”®è¯ï¼Œæˆ‘æƒ³ä½ å°±èƒ½å½»åº•æŒæ¡æ•°ç»„çš„æ¦‚å¿µäº†ã€‚ä¸‹é¢å°±ä»æˆ‘çš„è§’åº¦åˆ†åˆ«ç»™ä½ â€œç‚¹æ‹¨â€ä¸€ä¸‹ã€‚ç¬¬ä¸€æ˜¯çº¿æ€§è¡¨ï¼ˆLinear Listï¼‰ã€‚é¡¾åæ€ä¹‰ï¼Œçº¿æ€§è¡¨å°±æ˜¯æ•°æ®æ’æˆåƒä¸€æ¡çº¿ä¸€æ ·çš„ç»“æ„ã€‚æ¯ä¸ªçº¿æ€§è¡¨ä¸Šçš„æ•°æ®æœ€å¤šåªæœ‰å‰å’Œåä¸¤ä¸ªæ–¹å‘ã€‚å…¶å®é™¤äº†æ•°ç»„ï¼Œé“¾è¡¨ã€é˜Ÿåˆ—ã€æ ˆç­‰ä¹Ÿæ˜¯çº¿æ€§è¡¨ç»“æ„ã€‚è€Œä¸å®ƒç›¸å¯¹ç«‹çš„æ¦‚å¿µæ˜¯éçº¿æ€§è¡¨ï¼Œæ¯”å¦‚äºŒå‰æ ‘ã€å †ã€å›¾ç­‰ã€‚ä¹‹æ‰€ä»¥å«éçº¿æ€§ï¼Œæ˜¯å› ä¸ºï¼Œåœ¨éçº¿æ€§è¡¨ä¸­ï¼Œæ•°æ®ä¹‹é—´å¹¶ä¸æ˜¯ç®€å•çš„å‰åå…³ç³»ã€‚ç¬¬äºŒä¸ªæ˜¯è¿ç»­çš„å†…å­˜ç©ºé—´å’Œç›¸åŒç±»å‹çš„æ•°æ®ã€‚æ­£æ˜¯å› ä¸ºè¿™ä¸¤ä¸ªé™åˆ¶ï¼Œå®ƒæ‰æœ‰äº†ä¸€ä¸ªå ªç§°â€œæ€æ‰‹é”â€çš„ç‰¹æ€§ï¼šâ€œéšæœºè®¿é—®â€ã€‚ä½†æœ‰åˆ©å°±æœ‰å¼Šï¼Œè¿™ä¸¤ä¸ªé™åˆ¶ä¹Ÿè®©æ•°ç»„çš„å¾ˆå¤šæ“ä½œå˜å¾—éå¸¸ä½æ•ˆï¼Œæ¯”å¦‚è¦æƒ³åœ¨æ•°ç»„ä¸­åˆ é™¤ã€æ’å…¥ä¸€ä¸ªæ•°æ®ï¼Œä¸ºäº†ä¿è¯è¿ç»­æ€§ï¼Œå°±éœ€è¦åšå¤§é‡çš„æ•°æ®æ¬ç§»å·¥ä½œã€‚è¯´åˆ°æ•°æ®çš„è®¿é—®ï¼Œé‚£ä½ çŸ¥é“æ•°ç»„æ˜¯å¦‚ä½•å®ç°æ ¹æ®ä¸‹æ ‡éšæœºè®¿é—®æ•°ç»„å…ƒç´ çš„å—ï¼Ÿæˆ‘ä»¬æ‹¿ä¸€ä¸ªé•¿åº¦ä¸º 10 çš„ int ç±»å‹çš„æ•°ç»„ int[] a = new int[10]æ¥ä¸¾ä¾‹ã€‚åœ¨æˆ‘ç”»çš„è¿™ä¸ªå›¾ä¸­ï¼Œè®¡ç®—æœºç»™æ•°ç»„ a[10]ï¼Œåˆ†é…äº†ä¸€å—è¿ç»­å†…å­˜ç©ºé—´ 1000ï½1039ï¼Œå…¶ä¸­ï¼Œå†…å­˜å—çš„é¦–åœ°å€ä¸º base_address = 1000ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œè®¡ç®—æœºä¼šç»™æ¯ä¸ªå†…å­˜å•å…ƒåˆ†é…ä¸€ä¸ªåœ°å€ï¼Œè®¡ç®—æœºé€šè¿‡åœ°å€æ¥è®¿é—®å†…å­˜ä¸­çš„æ•°æ®ã€‚å½“è®¡ç®—æœºéœ€è¦éšæœºè®¿é—®æ•°ç»„ä¸­çš„æŸä¸ªå…ƒç´ æ—¶ï¼Œå®ƒä¼šé¦–å…ˆé€šè¿‡ä¸‹é¢çš„å¯»å€å…¬å¼ï¼Œè®¡ç®—å‡ºè¯¥å…ƒç´ å­˜å‚¨çš„å†…å­˜åœ°å€ï¼š1a[i]_address = base_address + i * data_type_sizeå…¶ä¸­ data_type_size è¡¨ç¤ºæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„å¤§å°ã€‚æˆ‘ä»¬ä¸¾çš„è¿™ä¸ªä¾‹å­é‡Œï¼Œæ•°ç»„ä¸­å­˜å‚¨çš„æ˜¯ int ç±»å‹æ•°æ®ï¼Œæ‰€ä»¥ data_type_size å°±ä¸º 4 ä¸ªå­—èŠ‚ã€‚è¿™ä¸ªå…¬å¼éå¸¸ç®€å•ï¼Œæˆ‘å°±ä¸å¤šåšè§£é‡Šäº†ã€‚è¿™é‡Œæˆ‘è¦ç‰¹åˆ«çº æ­£ä¸€ä¸ªâ€œé”™è¯¯â€ã€‚æˆ‘åœ¨é¢è¯•çš„æ—¶å€™ï¼Œå¸¸å¸¸ä¼šé—®æ•°ç»„å’Œé“¾è¡¨çš„åŒºåˆ«ï¼Œå¾ˆå¤šäººéƒ½å›ç­”è¯´ï¼Œâ€œé“¾è¡¨é€‚åˆæ’å…¥ã€åˆ é™¤ï¼Œæ—¶é—´å¤æ‚åº¦ O(1)ï¼›æ•°ç»„é€‚åˆæŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ä¸º O(1)â€ã€‚å®é™…ä¸Šï¼Œè¿™ç§è¡¨è¿°æ˜¯ä¸å‡†ç¡®çš„ã€‚æ•°ç»„æ˜¯é€‚åˆæŸ¥æ‰¾æ“ä½œï¼Œä½†æ˜¯æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦å¹¶ä¸ä¸º O(1)ã€‚å³ä¾¿æ˜¯æ’å¥½åºçš„æ•°ç»„ï¼Œä½ ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(logn)ã€‚æ‰€ä»¥ï¼Œæ­£ç¡®çš„è¡¨è¿°åº”è¯¥æ˜¯ï¼Œæ•°ç»„æ”¯æŒéšæœºè®¿é—®ï¼Œæ ¹æ®ä¸‹æ ‡éšæœºè®¿é—®çš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚Tips: é’ˆå¯¹ä¸Šé¢æåˆ°çš„ æ•°ç»„å­˜å‚¨çš„å¿…é¡»æ˜¯ç›¸åŒçš„æ•°æ®ç±»å‹ï¼Œåœ¨è¿™é‡Œæˆ‘è‡ªå·±çš„ç†è§£æ˜¯ï¼Œå¯¹äºæ•°ç»„å†…çš„å…ƒç´ ï¼Œè¿›è¡Œè®¿é—®çš„è¿‡ç¨‹ä¸­ï¼Œå®é™…ä¸Šæ˜¯æ ¹æ®æ¯ä¸ªå…ƒç´ çš„å†…å­˜åœ°å€æ¥è¿›è¡Œè®¿é—®çš„ã€‚å…ƒç´ çš„å†…å­˜åœ°å€ä¸æ˜¯éšæ„åˆ†é…çš„ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªå…¬å¼è®¡ç®—è€Œæ¥çš„ï¼Œæ¯ä¸ªå…ƒç´ çš„å†…å­˜åœ°å€åˆæˆä¸€æ®µè¿ç»­çš„å†…å­˜åœ°å€åŒºé—´æ®µã€‚å¦‚ä¸Šå›¾ï¼Œä¸åŒç±»å‹çš„å…ƒç´ æ‰€å å­—èŠ‚ä¸åŒï¼Œå¦‚æœæ•°ç»„ä¸­å­˜å‚¨ä¸åŒæ•°æ®ç±»å‹çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ç»Ÿä¸€çš„æŒ‰ç…§ å†…å­˜åœ°å€è®¡ç®—å…¬å¼æ¥è®¡ç®—ã€‚ä½æ•ˆçš„â€œæ’å…¥â€å’Œâ€œåˆ é™¤â€å‰é¢æ¦‚å¿µéƒ¨åˆ†æˆ‘ä»¬æåˆ°ï¼Œæ•°ç»„ä¸ºäº†ä¿æŒå†…å­˜æ•°æ®çš„è¿ç»­æ€§ï¼Œä¼šå¯¼è‡´æ’å…¥ã€åˆ é™¤è¿™ä¸¤ä¸ªæ“ä½œæ¯”è¾ƒä½æ•ˆã€‚ç°åœ¨æˆ‘ä»¬å°±æ¥è¯¦ç»†è¯´ä¸€ä¸‹ï¼Œç©¶ç«Ÿä¸ºä»€ä¹ˆä¼šå¯¼è‡´ä½æ•ˆï¼Ÿåˆæœ‰å“ªäº›æ”¹è¿›æ–¹æ³•å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹æ’å…¥æ“ä½œã€‚å‡è®¾æ•°ç»„çš„é•¿åº¦ä¸º nï¼Œç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªæ•°æ®æ’å…¥åˆ°æ•°ç»„ä¸­çš„ç¬¬ k ä¸ªä½ç½®ã€‚ä¸ºäº†æŠŠç¬¬ k ä¸ªä½ç½®è…¾å‡ºæ¥ï¼Œç»™æ–°æ¥çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å°†ç¬¬ kï½n è¿™éƒ¨åˆ†çš„å…ƒç´ éƒ½é¡ºåºåœ°å¾€åæŒªä¸€ä½ã€‚é‚£æ’å…¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿä½ å¯ä»¥è‡ªå·±å…ˆè¯•ç€åˆ†æä¸€ä¸‹ã€‚å¦‚æœåœ¨æ•°ç»„çš„æœ«å°¾æ’å…¥å…ƒç´ ï¼Œé‚£å°±ä¸éœ€è¦ç§»åŠ¨æ•°æ®äº†ï¼Œè¿™æ—¶çš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚ä½†å¦‚æœåœ¨æ•°ç»„çš„å¼€å¤´æ’å…¥å…ƒç´ ï¼Œé‚£æ‰€æœ‰çš„æ•°æ®éƒ½éœ€è¦ä¾æ¬¡å¾€åç§»åŠ¨ä¸€ä½ï¼Œæ‰€ä»¥æœ€åæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚å› ä¸ºæˆ‘ä»¬åœ¨æ¯ä¸ªä½ç½®æ’å…¥å…ƒç´ çš„æ¦‚ç‡æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸º (1+2+â€¦n)/n=O(n)ã€‚å¦‚æœæ•°ç»„ä¸­çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œæˆ‘ä»¬åœ¨æŸä¸ªä½ç½®æ’å…¥ä¸€ä¸ªæ–°çš„å…ƒç´ æ—¶ï¼Œå°±å¿…é¡»æŒ‰ç…§åˆšæ‰çš„æ–¹æ³•æ¬ç§» k ä¹‹åçš„æ•°æ®ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ•°ç»„ä¸­å­˜å‚¨çš„æ•°æ®å¹¶æ²¡æœ‰ä»»ä½•è§„å¾‹ï¼Œæ•°ç»„åªæ˜¯è¢«å½“ä½œä¸€ä¸ªå­˜å‚¨æ•°æ®çš„é›†åˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœè¦å°†æŸä¸ªæ•°æ®æ’å…¥åˆ°ç¬¬ k ä¸ªä½ç½®ï¼Œä¸ºäº†é¿å…å¤§è§„æ¨¡çš„æ•°æ®æ¬ç§»ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªç®€å•çš„åŠæ³•å°±æ˜¯ï¼Œç›´æ¥å°†ç¬¬ k ä½çš„æ•°æ®æ¬ç§»åˆ°æ•°ç»„å…ƒç´ çš„æœ€åï¼ŒæŠŠæ–°çš„å…ƒç´ ç›´æ¥æ”¾å…¥ç¬¬ k ä¸ªä½ç½®ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ä»¬ä¸¾ä¸€ä¸ªä¾‹å­ã€‚å‡è®¾æ•°ç»„ a[10]ä¸­å­˜å‚¨äº†å¦‚ä¸‹ 5 ä¸ªå…ƒç´ ï¼šaï¼Œbï¼Œcï¼Œdï¼Œeã€‚æˆ‘ä»¬ç°åœ¨éœ€è¦å°†å…ƒç´  x æ’å…¥åˆ°ç¬¬ 3 ä¸ªä½ç½®ã€‚æˆ‘ä»¬åªéœ€è¦å°† c æ”¾å…¥åˆ° a[5]ï¼Œå°† a[2]èµ‹å€¼ä¸º x å³å¯ã€‚æœ€åï¼Œæ•°ç»„ä¸­çš„å…ƒç´ å¦‚ä¸‹ï¼š aï¼Œbï¼Œxï¼Œdï¼Œeï¼Œcã€‚åˆ©ç”¨è¿™ç§å¤„ç†æŠ€å·§ï¼Œåœ¨ç‰¹å®šåœºæ™¯ä¸‹ï¼Œåœ¨ç¬¬ k ä¸ªä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´ çš„æ—¶é—´å¤æ‚åº¦å°±ä¼šé™ä¸º O(1)ã€‚è¿™ä¸ªå¤„ç†æ€æƒ³åœ¨å¿«æ’ä¸­ä¹Ÿä¼šç”¨åˆ°æˆ‘ä»¬å†æ¥çœ‹åˆ é™¤æ“ä½œã€‚è·Ÿæ’å…¥æ•°æ®ç±»ä¼¼ï¼Œå¦‚æœæˆ‘ä»¬è¦åˆ é™¤ç¬¬ k ä¸ªä½ç½®çš„æ•°æ®ï¼Œä¸ºäº†å†…å­˜çš„è¿ç»­æ€§ï¼Œä¹Ÿéœ€è¦æ¬ç§»æ•°æ®ï¼Œä¸ç„¶ä¸­é—´å°±ä¼šå‡ºç°ç©ºæ´ï¼Œå†…å­˜å°±ä¸è¿ç»­äº†ã€‚å’Œæ’å…¥ç±»ä¼¼ï¼Œå¦‚æœåˆ é™¤æ•°ç»„æœ«å°¾çš„æ•°æ®ï¼Œåˆ™æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼›å¦‚æœåˆ é™¤å¼€å¤´çš„æ•°æ®ï¼Œåˆ™æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼›å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦ä¹Ÿä¸º O(n)ã€‚å®é™…ä¸Šï¼Œåœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸ä¸€å®šéå¾—è¿½æ±‚æ•°ç»„ä¸­æ•°æ®çš„è¿ç»­æ€§ã€‚å¦‚æœæˆ‘ä»¬å°†å¤šæ¬¡åˆ é™¤æ“ä½œé›†ä¸­åœ¨ä¸€èµ·æ‰§è¡Œï¼Œåˆ é™¤çš„æ•ˆç‡æ˜¯ä¸æ˜¯ä¼šæé«˜å¾ˆå¤šå‘¢ï¼Ÿæˆ‘ä»¬ç»§ç»­æ¥çœ‹ä¾‹å­ã€‚æ•°ç»„ a[10]ä¸­å­˜å‚¨äº† 8 ä¸ªå…ƒç´ ï¼šaï¼Œbï¼Œcï¼Œdï¼Œeï¼Œfï¼Œgï¼Œhã€‚ç°åœ¨ï¼Œæˆ‘ä»¬è¦ä¾æ¬¡åˆ é™¤ aï¼Œbï¼Œc ä¸‰ä¸ªå…ƒç´ ã€‚ä¸ºäº†é¿å… dï¼Œeï¼Œfï¼Œgï¼Œh è¿™å‡ ä¸ªæ•°æ®ä¼šè¢«æ¬ç§»ä¸‰æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè®°å½•ä¸‹å·²ç»åˆ é™¤çš„æ•°æ®ã€‚æ¯æ¬¡çš„åˆ é™¤æ“ä½œå¹¶ä¸æ˜¯çœŸæ­£åœ°æ¬ç§»æ•°æ®ï¼Œåªæ˜¯è®°å½•æ•°æ®å·²ç»è¢«åˆ é™¤ã€‚å½“æ•°ç»„æ²¡æœ‰æ›´å¤šç©ºé—´å­˜å‚¨æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å†è§¦å‘æ‰§è¡Œä¸€æ¬¡çœŸæ­£çš„åˆ é™¤æ“ä½œï¼Œè¿™æ ·å°±å¤§å¤§å‡å°‘äº†åˆ é™¤æ“ä½œå¯¼è‡´çš„æ•°æ®æ¬ç§»ã€‚**å¦‚æœä½ äº†è§£ JVMï¼Œä½ ä¼šå‘ç°ï¼Œè¿™ä¸å°±æ˜¯ JVM æ ‡è®°æ¸…é™¤åƒåœ¾å›æ”¶ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³å—ï¼Ÿæ²¡é”™ï¼Œæ•°æ®ç»“æ„å’Œç®—æ³•çš„é­…åŠ›å°±åœ¨äºæ­¤ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¹¶ä¸æ˜¯è¦å»æ­»è®°ç¡¬èƒŒæŸä¸ªæ•°æ®ç»“æ„æˆ–è€…ç®—æ³•ï¼Œè€Œæ˜¯è¦å­¦ä¹ å®ƒèƒŒåçš„æ€æƒ³å’Œå¤„ç†æŠ€å·§ï¼Œè¿™äº›ä¸œè¥¿æ‰æ˜¯æœ€æœ‰ä»·å€¼çš„ã€‚å¦‚æœä½ ç»†å¿ƒç•™æ„ï¼Œä¸ç®¡æ˜¯åœ¨è½¯ä»¶å¼€å‘è¿˜æ˜¯æ¶æ„è®¾è®¡ä¸­ï¼Œæ€»èƒ½æ‰¾åˆ°æŸäº›ç®—æ³•å’Œæ•°æ®ç»“æ„çš„å½±å­ã€‚å®¹å™¨èƒ½å¦å®Œå…¨æ›¿ä»£æ•°ç»„è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘åœ¨åˆšå­¦ç¼–ç¨‹è¯­è¨€ä¹‹å¤„ï¼Œæ˜¯æ ¹æœ¬æ²¡æœ‰æƒ³è¿‡çš„ï¼Œåœ¨æˆ‘çœ¼é‡Œï¼Œç¨‹åºè¯­è¨€ä¸­é›†åˆå°±æ˜¯æ•°æ®ç»“æ„ä¸­çš„æ•°ç»„ï¼Œæ²¡æœ‰ä»»ä½•å·®åˆ«ï¼Œå®é™…æƒ…å†µä¸­ï¼Œé’ˆå¯¹æ•°ç»„ç±»å‹ï¼Œå¾ˆå¤šè¯­è¨€éƒ½æä¾›äº†å®¹å™¨ç±»ï¼Œæ¯”å¦‚ Java ä¸­çš„ ArrayListã€C++ STL ä¸­çš„ vectorã€‚åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œä»€ä¹ˆæ—¶å€™é€‚åˆç”¨æ•°ç»„ï¼Œä»€ä¹ˆæ—¶å€™é€‚åˆç”¨å®¹å™¨å‘¢ï¼Ÿè¿™é‡Œæˆ‘æ‹¿ Java è¯­è¨€æ¥ä¸¾ä¾‹ã€‚å¦‚æœä½ æ˜¯ Java å·¥ç¨‹å¸ˆï¼Œå‡ ä¹å¤©å¤©éƒ½åœ¨ç”¨ ArrayListï¼Œå¯¹å®ƒåº”è¯¥éå¸¸ç†Ÿæ‚‰ã€‚é‚£å®ƒä¸æ•°ç»„ç›¸æ¯”ï¼Œåˆ°åº•æœ‰å“ªäº›ä¼˜åŠ¿å‘¢ï¼Ÿæˆ‘ä¸ªäººè§‰å¾—ï¼ŒArrayList æœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯å¯ä»¥å°†å¾ˆå¤šæ•°ç»„æ“ä½œçš„ç»†èŠ‚å°è£…èµ·æ¥ã€‚æ¯”å¦‚å‰é¢æåˆ°çš„æ•°ç»„æ’å…¥ã€åˆ é™¤æ•°æ®æ—¶éœ€è¦æ¬ç§»å…¶ä»–æ•°æ®ç­‰ã€‚å¦å¤–ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªä¼˜åŠ¿ï¼Œå°±æ˜¯æ”¯æŒåŠ¨æ€æ‰©å®¹ã€‚æ•°ç»„æœ¬èº«åœ¨å®šä¹‰çš„æ—¶å€™éœ€è¦é¢„å…ˆæŒ‡å®šå¤§å°ï¼Œå› ä¸ºéœ€è¦åˆ†é…è¿ç»­çš„å†…å­˜ç©ºé—´ã€‚å¦‚æœæˆ‘ä»¬ç”³è¯·äº†å¤§å°ä¸º 10 çš„æ•°ç»„ï¼Œå½“ç¬¬ 11 ä¸ªæ•°æ®éœ€è¦å­˜å‚¨åˆ°æ•°ç»„ä¸­æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦é‡æ–°åˆ†é…ä¸€å—æ›´å¤§çš„ç©ºé—´ï¼Œå°†åŸæ¥çš„æ•°æ®å¤åˆ¶è¿‡å»ï¼Œç„¶åå†å°†æ–°çš„æ•°æ®æ’å…¥ã€‚å¦‚æœä½¿ç”¨ ArrayListï¼Œæˆ‘ä»¬å°±å®Œå…¨ä¸éœ€è¦å…³å¿ƒåº•å±‚çš„æ‰©å®¹é€»è¾‘ï¼ŒArrayList å·²ç»å¸®æˆ‘ä»¬å®ç°å¥½äº†ã€‚æ¯æ¬¡å­˜å‚¨ç©ºé—´ä¸å¤Ÿçš„æ—¶å€™ï¼Œå®ƒéƒ½ä¼šå°†ç©ºé—´è‡ªåŠ¨æ‰©å®¹ä¸º 1.5 å€å¤§å°ã€‚**ä¸è¿‡ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå› ä¸ºæ‰©å®¹æ“ä½œæ¶‰åŠå†…å­˜ç”³è¯·å’Œæ•°æ®æ¬ç§»ï¼Œæ˜¯æ¯”è¾ƒè€—æ—¶çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœäº‹å…ˆèƒ½ç¡®å®šéœ€è¦å­˜å‚¨çš„æ•°æ®å¤§å°ï¼Œæœ€å¥½åœ¨åˆ›å»º ArrayList çš„æ—¶å€™äº‹å…ˆæŒ‡å®šæ•°æ®å¤§å°ã€‚æ¯”å¦‚æˆ‘ä»¬è¦ä»æ•°æ®åº“ä¸­å–å‡º 10000 æ¡æ•°æ®æ”¾å…¥ ArrayListã€‚æˆ‘ä»¬çœ‹ä¸‹é¢è¿™å‡ è¡Œä»£ç ï¼Œä½ ä¼šå‘ç°ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼Œäº‹å…ˆæŒ‡å®šæ•°æ®å¤§å°å¯ä»¥çœæ‰å¾ˆå¤šæ¬¡å†…å­˜ç”³è¯·å’Œæ•°æ®æ¬ç§»æ“ä½œã€‚ä½œä¸ºé«˜çº§è¯­è¨€ç¼–ç¨‹è€…ï¼Œæ˜¯ä¸æ˜¯æ•°ç»„å°±æ— ç”¨æ­¦ä¹‹åœ°äº†å‘¢ï¼Ÿå½“ç„¶ä¸æ˜¯ï¼Œæœ‰äº›æ—¶å€™ï¼Œç”¨æ•°ç»„ä¼šæ›´åˆé€‚äº›ï¼Œæˆ‘æ€»ç»“äº†å‡ ç‚¹è‡ªå·±çš„ç»éªŒã€‚Java ArrayList æ— æ³•å­˜å‚¨åŸºæœ¬ç±»å‹ï¼Œæ¯”å¦‚ intã€longï¼Œéœ€è¦å°è£…ä¸º Integerã€Long ç±»ï¼Œè€Œ Autoboxingã€Unboxing åˆ™æœ‰ä¸€å®šçš„æ€§èƒ½æ¶ˆè€—ï¼Œæ‰€ä»¥å¦‚æœç‰¹åˆ«å…³æ³¨æ€§èƒ½ï¼Œæˆ–è€…å¸Œæœ›ä½¿ç”¨åŸºæœ¬ç±»å‹ï¼Œå°±å¯ä»¥é€‰ç”¨æ•°ç»„ã€‚å¦‚æœæ•°æ®å¤§å°äº‹å…ˆå·²çŸ¥ï¼Œå¹¶ä¸”å¯¹æ•°æ®çš„æ“ä½œéå¸¸ç®€å•ï¼Œç”¨ä¸åˆ° ArrayList æä¾›çš„å¤§éƒ¨åˆ†æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æ•°ç»„ã€‚è¿˜æœ‰ä¸€ä¸ªæ˜¯æˆ‘ä¸ªäººçš„å–œå¥½ï¼Œå½“è¦è¡¨ç¤ºå¤šç»´æ•°ç»„æ—¶ï¼Œç”¨æ•°ç»„å¾€å¾€ä¼šæ›´åŠ ç›´è§‚ã€‚æ¯”å¦‚ Object[][] arrayï¼›è€Œç”¨å®¹å™¨çš„è¯åˆ™éœ€è¦è¿™æ ·å®šä¹‰ï¼šArrayListarrayã€‚æˆ‘æ€»ç»“ä¸€ä¸‹ï¼Œå¯¹äºä¸šåŠ¡å¼€å‘ï¼Œç›´æ¥ä½¿ç”¨å®¹å™¨å°±è¶³å¤Ÿäº†ï¼Œçœæ—¶çœåŠ›ã€‚æ¯•ç«ŸæŸè€—ä¸€ä¸¢ä¸¢æ€§èƒ½ï¼Œå®Œå…¨ä¸ä¼šå½±å“åˆ°ç³»ç»Ÿæ•´ä½“çš„æ€§èƒ½ã€‚ä½†å¦‚æœä½ æ˜¯åšä¸€äº›éå¸¸åº•å±‚çš„å¼€å‘ï¼Œæ¯”å¦‚å¼€å‘ç½‘ç»œæ¡†æ¶ï¼Œæ€§èƒ½çš„ä¼˜åŒ–éœ€è¦åšåˆ°æè‡´ï¼Œè¿™ä¸ªæ—¶å€™æ•°ç»„å°±ä¼šä¼˜äºå®¹å™¨ï¼Œæˆä¸ºé¦–é€‰ã€‚è§£ç­”å¼€ç¯‡ç°åœ¨æˆ‘ä»¬æ¥æ€è€ƒå¼€ç¯‡çš„é—®é¢˜ï¼šä¸ºä»€ä¹ˆå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæ•°ç»„è¦ä» 0 å¼€å§‹ç¼–å·ï¼Œè€Œä¸æ˜¯ä» 1 å¼€å§‹å‘¢ï¼Ÿä»æ•°ç»„å­˜å‚¨çš„å†…å­˜æ¨¡å‹ä¸Šæ¥çœ‹ï¼Œâ€œä¸‹æ ‡â€æœ€ç¡®åˆ‡çš„å®šä¹‰åº”è¯¥æ˜¯â€œåç§»ï¼ˆoffsetï¼‰â€ã€‚å‰é¢ä¹Ÿè®²åˆ°ï¼Œå¦‚æœç”¨ a æ¥è¡¨ç¤ºæ•°ç»„çš„é¦–åœ°å€ï¼Œa[0]å°±æ˜¯åç§»ä¸º 0 çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯é¦–åœ°å€ï¼Œa[k]å°±è¡¨ç¤ºåç§» k ä¸ª type_size çš„ä½ç½®ï¼Œæ‰€ä»¥è®¡ç®— a[k]çš„å†…å­˜åœ°å€åªéœ€è¦ç”¨è¿™ä¸ªå…¬å¼ï¼ša[k]_address = base_address + k * type_sizeä½†æ˜¯ï¼Œå¦‚æœæ•°ç»„ä» 1 å¼€å§‹è®¡æ•°ï¼Œé‚£æˆ‘ä»¬è®¡ç®—æ•°ç»„å…ƒç´  a[k]çš„å†…å­˜åœ°å€å°±ä¼šå˜ä¸ºï¼ša[k]_address = base_address + (k-1)*type_sizeå¯¹æ¯”ä¸¤ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œä» 1 å¼€å§‹ç¼–å·ï¼Œæ¯æ¬¡éšæœºè®¿é—®æ•°ç»„å…ƒç´ éƒ½å¤šäº†ä¸€æ¬¡å‡æ³•è¿ç®—ï¼Œå¯¹äº CPU æ¥è¯´ï¼Œå°±æ˜¯å¤šäº†ä¸€æ¬¡å‡æ³•æŒ‡ä»¤ã€‚æ•°ç»„ä½œä¸ºéå¸¸åŸºç¡€çš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡ä¸‹æ ‡éšæœºè®¿é—®æ•°ç»„å…ƒç´ åˆæ˜¯å…¶éå¸¸åŸºç¡€çš„ç¼–ç¨‹æ“ä½œï¼Œæ•ˆç‡çš„ä¼˜åŒ–å°±è¦å°½å¯èƒ½åšåˆ°æè‡´ã€‚æ‰€ä»¥ä¸ºäº†å‡å°‘ä¸€æ¬¡å‡æ³•æ“ä½œï¼Œæ•°ç»„é€‰æ‹©äº†ä» 0 å¼€å§‹ç¼–å·ï¼Œè€Œä¸æ˜¯ä» 1 å¼€å§‹ã€‚ä¸è¿‡æˆ‘è®¤ä¸ºï¼Œä¸Šé¢è§£é‡Šå¾—å†å¤šå…¶å®éƒ½ç®—ä¸ä¸Šå‹å€’æ€§çš„è¯æ˜ï¼Œè¯´æ•°ç»„èµ·å§‹ç¼–å·é 0 å¼€å§‹ä¸å¯ã€‚æ‰€ä»¥æˆ‘è§‰å¾—æœ€ä¸»è¦çš„åŸå› å¯èƒ½æ˜¯å†å²åŸå› ã€‚C è¯­è¨€è®¾è®¡è€…ç”¨ 0 å¼€å§‹è®¡æ•°æ•°ç»„ä¸‹æ ‡ï¼Œä¹‹åçš„ Javaã€JavaScript ç­‰é«˜çº§è¯­è¨€éƒ½æ•ˆä»¿äº† C è¯­è¨€ï¼Œæˆ–è€…è¯´ï¼Œä¸ºäº†åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘ C è¯­è¨€ç¨‹åºå‘˜å­¦ä¹  Java çš„å­¦ä¹ æˆæœ¬ï¼Œå› æ­¤ç»§ç»­æ²¿ç”¨äº†ä» 0 å¼€å§‹è®¡æ•°çš„ä¹ æƒ¯ã€‚å®é™…ä¸Šï¼Œå¾ˆå¤šè¯­è¨€ä¸­æ•°ç»„ä¹Ÿå¹¶ä¸æ˜¯ä» 0 å¼€å§‹è®¡æ•°çš„ï¼Œæ¯”å¦‚ Matlabã€‚ç”šè‡³è¿˜æœ‰ä¸€äº›è¯­è¨€æ”¯æŒè´Ÿæ•°ä¸‹æ ‡ï¼Œæ¯”å¦‚ Pythonã€‚å†…å®¹å°ç»“æˆ‘ä»¬ä»Šå¤©å­¦ä¹ äº†æ•°ç»„ã€‚å®ƒå¯ä»¥è¯´æ˜¯æœ€åŸºç¡€ã€æœ€ç®€å•çš„æ•°æ®ç»“æ„äº†ã€‚æ•°ç»„ç”¨ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæ¥å­˜å‚¨ç›¸åŒç±»å‹çš„ä¸€ç»„æ•°æ®ï¼Œæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯æ”¯æŒéšæœºè®¿é—®ï¼Œä½†æ’å…¥ã€åˆ é™¤æ“ä½œä¹Ÿå› æ­¤å˜å¾—æ¯”è¾ƒä½æ•ˆï¼Œå¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚åœ¨å¹³æ—¶çš„ä¸šåŠ¡å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ç¼–ç¨‹è¯­è¨€æä¾›çš„å®¹å™¨ç±»ï¼Œä½†æ˜¯ï¼Œå¦‚æœæ˜¯ç‰¹åˆ«åº•å±‚çš„å¼€å‘ï¼Œç›´æ¥ä½¿ç”¨æ•°ç»„å¯èƒ½ä¼šæ›´åˆé€‚ã€‚","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"cpeixin.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"æ•°ç»„","slug":"æ•°ç»„","permalink":"cpeixin.cn/tags/%E6%95%B0%E7%BB%84/"}]},{"title":"æ•°æ®ç»“æ„ä¸ç®—æ³•-å¤ç›˜","slug":"æ•°æ®ç»“æ„ä¸ç®—æ³•-å¤ç›˜","date":"2016-08-10T07:30:21.000Z","updated":"2020-04-04T17:30:49.884Z","comments":true,"path":"2016/08/10/æ•°æ®ç»“æ„ä¸ç®—æ³•-å¤ç›˜/","link":"","permalink":"cpeixin.cn/2016/08/10/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95-%E5%A4%8D%E7%9B%98/","excerpt":"","text":"å¯¹äºè½¯ä»¶å·¥ç¨‹ä¸“ä¸šçš„åŒå­¦æ¥è¯´ï¼Œæ•°æ®ç»“æ„ä¸ç®—æ³•è¿™é—¨è¯¾ç¨‹æ˜¯å¿…ä¿®è¯¾ç¨‹ï¼Œè¯¾ç¨‹æ—¶é—´åº”è¯¥æ˜¯å¤§å­¦äºŒå¹´çº§ï¼Œåœ¨å­¦ä¹ å®Œäº†ä¸€é—¨ç¼–ç¨‹è¯­è¨€åï¼Œè¿›è¡Œå±•å¼€å­¦ä¹ çš„ã€‚æˆ‘æ˜¯åœ¨å­¦ä¹ å®ŒCè¯­è¨€åï¼Œè¿›è¡Œæ•°æ®ç»“æ„ä¸ç®—æ³•è¿™é—¨è¯¾ç¨‹çš„ã€‚ä¸ªäººæ„Ÿè§‰è¿™é—¨è¯¾ç¨‹ veryyyyyyyyy æ¯ç‡¥çš„ã€‚è€å¸ˆåœ¨è¯¾å ‚ä¸Šä¹Ÿæ²¡æœ‰åšç›¸å…³çŸ¥è¯†ç‚¹çš„æ‰©å±•ï¼Œå†åŠ ä¸Šé‚£æ—¶å€™æˆ‘ä»¬å¯¹äºçŸ¥è¯†çš„æ¸´æœ›åº¦ä¹Ÿæ²¡æœ‰é‚£ä¹ˆé«˜ å“ˆå“ˆå“ˆå“ˆï¼Œå•çº¯çš„å°±æ˜¯ä¸ºäº†è€ƒè¯•è€Œå­¦ä¹ ï¼Œä¹Ÿæ²¡æœ‰åˆ©ç”¨ç½‘ç»œèµ„æºæ¥å¯¹è¿™é—¨è¯¾ç¨‹è¿›è¡Œè¿›ä¸€æ­¥çš„æ‹“å±•ã€‚ç­‰åˆ°å·¥ä½œä¹‹åï¼Œæ‰æ…¢æ…¢å‘ç°ï¼Œè¿™é—¨è¯¾ç¨‹å°±æ˜¯åœ¨å¤§å­¦æ—¶å€™åŸ‹çš„é›·å•Š XDä½†æ˜¯æ¯•ç«Ÿè¿˜æ˜¯å­¦è¿‡çš„ï¼Œæ—¶é—´è¿˜ä¸æ™šï¼ŒçŸ¥è¯†å­¦åˆ°äº†ï¼Œå°±æ˜¯è‡ªå·±çš„ï¼Œå®šæœŸå¯¹è‡ªå·±å¤ç›˜ï¼Œé‡è§†è‡ªå·±ï¼ŒæŸ¥ç¼ºè¡¥æ¼ï¼Œå°±æ˜¯æœ€æ£’çš„ï¼å­¦å‰ä¸‰é—®ï¼šWHAT ï¼Ÿ HOW ï¼Ÿ WHYï¼Ÿåœ¨ä¹‹åå†™åšå®¢çš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿä¼šéµå¾ªç€ WWH æ³•åˆ™ä½œä¸ºæçº²ã€‚ç®€å•æ˜äº†ï¼Œç›´å…¥ä¸»é¢˜ã€‚WHAT - æ•°æ®ç»“æ„ ç®—æ³•æ•°æ®ç»“æ„ç®€å•ç›´ç™½çš„ç†è§£ ï¼š æ•°æ®ç»“æ„å°±æ˜¯æŒ‡ä¸€ç»„æ•°æ®çš„å­˜å‚¨ç»“æ„ã€‚ç™¾åº¦ç™¾ç§‘ï¼šæ•°æ®ç»“æ„æ˜¯è®¡ç®—æœºå­˜å‚¨ã€ç»„ç»‡æ•°æ®çš„æ–¹å¼ã€‚æ•°æ®ç»“æ„æ˜¯æŒ‡ç›¸äº’ä¹‹é—´å­˜åœ¨ä¸€ç§æˆ–å¤šç§ç‰¹å®šå…³ç³»çš„æ•°æ®å…ƒç´ çš„é›†åˆã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œç²¾å¿ƒé€‰æ‹©çš„æ•°æ®ç»“æ„å¯ä»¥å¸¦æ¥æ›´é«˜çš„è¿è¡Œæˆ–è€…å­˜å‚¨æ•ˆç‡ã€‚æ•°æ®ç»“æ„å¾€å¾€åŒé«˜æ•ˆçš„æ£€ç´¢ç®—æ³•å’Œç´¢å¼•æŠ€æœ¯æœ‰å…³ç®—æ³•ç®€å•ç›´ç™½çš„ç†è§£ ï¼š ç®—æ³•å°±æ˜¯æ“ä½œæ•°æ®çš„ä¸€ç»„æ–¹æ³•ã€‚ç™¾åº¦ç™¾ç§‘ï¼šç®—æ³•ï¼ˆAlgorithmï¼‰æ˜¯æŒ‡è§£é¢˜æ–¹æ¡ˆçš„å‡†ç¡®è€Œå®Œæ•´çš„æè¿°ï¼Œæ˜¯ä¸€ç³»åˆ—è§£å†³é—®é¢˜çš„æ¸…æ™°æŒ‡ä»¤ï¼Œç®—æ³•ä»£è¡¨ç€ç”¨ç³»ç»Ÿçš„æ–¹æ³•æè¿°è§£å†³é—®é¢˜çš„ç­–ç•¥æœºåˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œèƒ½å¤Ÿå¯¹ä¸€å®šè§„èŒƒçš„è¾“å…¥ï¼Œåœ¨æœ‰é™æ—¶é—´å†…è·å¾—æ‰€è¦æ±‚çš„è¾“å‡ºã€‚å¦‚æœä¸€ä¸ªç®—æ³•æœ‰ç¼ºé™·ï¼Œæˆ–ä¸é€‚åˆäºæŸä¸ªé—®é¢˜ï¼Œæ‰§è¡Œè¿™ä¸ªç®—æ³•å°†ä¸ä¼šè§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä¸åŒçš„ç®—æ³•å¯èƒ½ç”¨ä¸åŒçš„æ—¶é—´ã€ç©ºé—´æˆ–æ•ˆç‡æ¥å®ŒæˆåŒæ ·çš„ä»»åŠ¡ã€‚ä¸€ä¸ªç®—æ³•çš„ä¼˜åŠ£å¯ä»¥ç”¨ç©ºé—´å¤æ‚åº¦ä¸æ—¶é—´å¤æ‚åº¦æ¥è¡¡é‡ã€‚HOW - æ•°æ®ç»“æ„ ç®—æ³•æœ‰çš„äººå–œæ¬¢çœ‹ä¹¦ç¨³æ‰ç¨³æ‰“æœ‰çš„äººä¹ æƒ¯çœ‹è§†é¢‘ç”ŸåŠ¨ä¸€ç‚¹çš„è·å–çŸ¥è¯†ä¹Ÿæœ‰äººå€¾å‘äºç›´æ¥è¿›å…¥ä¸»é¢˜ï¼Œæ‰¾æ•™ç¨‹ï¼Œæ‰¾åšæ–‡æ”»ç ´å•ä¸ªçŸ¥è¯†ç‚¹æˆ‘è¿™é‡Œåªæ˜¯è¯´ä¸€ä¸‹æˆ‘çš„æ–¹æ³•é¦–å…ˆå°±æ˜¯è¿™ç¯‡åšæ–‡ï¼Œå…ˆææ¸…æ¥šWWHç„¶åå‘¢ï¼Œå¯¹æ•°æ®ç»“æ„å’Œç®—æ³•æ•´ä¸ªçŸ¥è¯†ä½“ç³»åˆ—ä¸€ä¸ªå¤§çº²æˆ–è€…æ€ç»´å¯¼å›¾æ¥ä¸‹æ¥å°±è¿›å…¥å­¦ä¹ çš„è¿‡ç¨‹äº†ï¼Œæˆ‘ä¸ªäººæ˜¯æ¯”è¾ƒå–œæ¬¢çœ‹è§† é¢‘å’Œè¯»å¥½çš„åšå®¢çš„ï¼Œæ¯ä¸€ä¸ªç‚¹å­¦å®Œåå•Šï¼Œå…ˆæ‰¾ä¹ é¢˜ï¼Œå®Œäº†æ‰“å¼€IDEA ï¼Œå†™ä¸€äº›Demoå»ç†è§£ï¼Œç„¶åå‘¢ï¼Œå¸¦ç€å­¦è¿‡çš„ç®—æ³•å’Œæ•°æ®ç»“æ„å•Šï¼Œè¿›å…¥å®æˆ˜åœºï¼Œçœ‹çœ‹ä¹‹å‰è‡ªå·±å†™è¿‡çš„é¡¹ç›®ï¼Œå¯ä¸å¯ä»¥é‡æ–°è£…ä¿®ä¸€ä¸‹ã€‚æœ€åä¸€ç‚¹ï¼Œæ‰¾ä¸€äº›æˆç†Ÿé¡¹ç›®ï¼Œè¯»æºç ï¼Œè¯»æºç ï¼Œè¯»æºç ï¼ï¼ï¼WHY - æ•°æ®ç»“æ„ ç®—æ³•è¿™ä¸€æ ä½çš„å†…å®¹ï¼Œæˆ‘æ‰¾äº†å¾ˆä¹…ï¼Œä¹Ÿæƒ³äº†å¾ˆä¹…æ€æ ·çš„å»å†™ï¼Œåæ¥åœ¨æœå¯»çš„æ—¶å€™ï¼Œå‘ç°å¾ˆå¤šåšä¸»å’Œå­¦ä¹ è®ºå›éƒ½å¼•ç”¨äº†çŸ¥ä¹ä¸Šæ¶›å´çš„è§‚ç‚¹ï¼ˆæ¶›å´ï¼ŒçŸ¥ä¹ä¸Šæœ€å—æ¬¢è¿ç¨‹åºå‘˜å‰ååğŸ‘ğŸ»ï¼‰ï¼Œå†™çš„ç¡®å®å¥½ï¼Œå¥½ä¸œè¥¿å°±è¦åˆ†äº«å‡ºæ¥ğŸ˜‚å¦‚æœè¯´ Java æ˜¯è‡ªåŠ¨æ¡£è½¿è½¦ï¼ŒC å°±æ˜¯æ‰‹åŠ¨æ¡£å‰æ™®ã€‚æ•°æ®ç»“æ„å‘¢ï¼Ÿæ˜¯å˜é€Ÿç®±çš„å·¥ä½œåŸç†ã€‚ä½ å®Œå…¨å¯ä»¥ä¸çŸ¥é“å˜é€Ÿç®±æ€æ ·å·¥ä½œï¼Œå°±æŠŠè‡ªåŠ¨æ¡£çš„è½¦å­ä» A å¼€åˆ° Bï¼Œè€Œä¸”æœªå¿…å°±æ¯”æ‡‚å¾—çš„äººæ…¢ã€‚å†™ç¨‹åºè¿™ä»¶äº‹ï¼Œå’Œå¼€è½¦ä¸€æ ·ï¼Œç»éªŒå¯ä»¥èµ·åˆ°å¾ˆå¤§ä½œç”¨ï¼Œä½†å¦‚æœä½ ä¸çŸ¥é“åº•å±‚æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Œå°±æ°¸è¿œåªèƒ½å¼€è½¦ï¼Œæ—¢ä¸ä¼šä¿®è½¦ï¼Œä¹Ÿä¸èƒ½é€ è½¦ã€‚å¦‚æœä½ å¯¹è¿™ä¸¤ä»¶äº‹éƒ½ä¸æ„Ÿå…´è¶£ä¹Ÿå°±ç½¢äº†ï¼Œæ•°æ®ç»“æ„æ‡‚å¾—ç”¨å°±å¥½ã€‚ä½†è‹¥ä½ æ­¤ç”Ÿåœ¨ç¼–ç¨‹é¢†åŸŸè¿˜æœ‰ç‚¹æ›´é«˜çš„è¿½æ±‚ï¼Œæ•°æ®ç»“æ„æ˜¯ç»•ä¸å¼€çš„è¯¾é¢˜ã€‚Java æ›¿ä½ åšäº†å¤ªå¤šäº‹æƒ…ï¼Œé‚£ä¹ˆå¤šåŠ¨ä¸åŠ¨è¿˜æ”¯æŒèŒƒå‹çš„å®¹å™¨ç±»ï¼ŒåŠ ä¸Šåƒåœ¾æ”¶é›†ï¼Œä¼šè®©ä½ è§‰å¾—ç¼–ç¨‹å¾ˆå®¹æ˜“ã€‚ä½†ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œé‚£äº›å®¹å™¨ç±»æ˜¯æ€ä¹ˆæ¥çš„ï¼Œä»¥åŠå®ƒå­˜åœ¨çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿæœ€ç²—æµ…çš„ï¼Œæ¯”å¦‚ ArrayList è¿™ä¸ªç±»ï¼Œä½ æƒ³è¿‡å®ƒçš„å­˜åœ¨æ˜¯å¤šä¹ˆå¤§çš„ç¦åˆ©å—â€”â€”ä¸€ä¸ªå¯ä»¥éšæœºè®¿é—®ã€è‡ªåŠ¨å¢åŠ å®¹é‡çš„æ•°ç»„ï¼Œè¿™ç§ä¸œè¥¿ C æ˜¯æ²¡æœ‰çš„ï¼Œè¦è‡ªå·±å®ç°ã€‚ä½†æ˜¯ï¼Œå…·ä½“æ€ä¹ˆå®ç°å‘¢ï¼Ÿå¦‚æœä½ å¯¹è¿™ç§é—®é¢˜æ„Ÿå…´è¶£ï¼Œé‚£æ•°æ®ç»“æ„æ˜¯ä¸€å®šè¦çœ‹çš„ã€‚ç”šè‡³ï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹èŒƒå¼æœ¬èº«ï¼Œå°±æ˜¯ä¸ªæ•°æ®ç»“æ„é—®é¢˜ï¼šæ€ä¹ˆæ‰èƒ½æŠŠæ•°æ®å’Œæ“ä½œæ•°æ®çš„æ–¹æ³•å°è£…åˆ°ä¸€èµ·ï¼Œæ¥é€ å‡º class / prototype è¿™ç§ä¸œè¥¿ï¼Ÿæ­¤å¤–ï¼Œå¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œæ•°æ®ç»“æ„ä¹Ÿæ˜¯é€šå‘å„ç§å®ç”¨ç®—æ³•çš„åŸºçŸ³ï¼Œæ‰€ä»¥å­¦ä¹ æ•°æ®ç»“æ„éƒ½æ˜¯æå‡å†…åŠ›çš„äº‹æƒ…ã€‚åŸæ–‡é“¾æ¥å­¦ Java æœ‰å¿…è¦çœ‹æ•°æ®ç»“æ„çš„ä¹¦å—ï¼Ÿå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆå“ªæœ¬ä¹¦æ¯”è¾ƒå¥½ï¼Ÿ - æ¶›å´çš„å›ç­” - çŸ¥ä¹å­¦æ•°æ®ç»“æ„å’Œç®—æ³•å¯ä»¥åº”ç”¨åœ¨å“ªäº›åœºæ™¯ï¼Ÿåœ¨å¤§å­¦çš„æ—¶å€™ï¼Œå­¦ä¹ æ•°æ®ç»“æ„ä¸ç®—æ³•ï¼Œå­¦çš„æ—¶å€™äº‘é‡Œé›¾é‡Œçš„ï¼Œæä¸æ¸…æ¥šè¿™äº›æ•°æ®ç»“æ„å’Œç®—æ³•åº”è¯¥ç”¨åœ¨å“ªé‡Œï¼Ÿèƒ½å¹²äº›ä»€ä¹ˆï¼Ÿè¿˜æ²¡æœ‰ä¸€ä¸ªé•¿é•¿çš„SQLå¸¦æ¥çš„æˆå°±æ„Ÿå¼ºçƒˆã€‚ä»¥ä¸ºè¿™é—¨è¯¾ç¨‹åªæ˜¯åº”è¯•æ•™è‚²ä¸­çš„å¿…é¡»è¿›è¡Œçš„ä¸€ç¯ï¼Œç°åœ¨æƒ³èµ·æ¥çœŸæ˜¯å•çº¯çš„å­©å­å•Š å“ˆå“ˆğŸ˜„ä¸‹é¢æˆ‘å¼•ç”¨InfoQä¸Šçš„ä¸€ç¯‡æ–‡ç« ï¼Œçœ‹å®Œä¹‹åï¼Œæœ‰ç§é†é†çŒé¡¶çš„æ„Ÿè§‰ï¼Œæˆ‘è§‰å¾—æˆ‘æ˜å¤©åº”è¯¥ä¼šå»ç¿»éæ‰€æœ‰çš„æºç å»çœ‹ï¼Œæœ‰ç‚¹è¿«ä¸åŠå¾…äº†â€¦â€¦å®é™…é¡¹ç›®ä¸­çš„å¸¸è§ç®—æ³•å…¶æ¬¡ï¼Œä»¥ä¸‹åœºæ™¯ä¸­ä½¿ç”¨äº†ä¸°å¯Œçš„æ•°æ®ç»“æ„æ¥å®ç°ï¼Œå¯ä»¥æ‹©ä¸€æ¥æ·±å…¥ç ”è¯»Linux å†…æ ¸SQLå¼•æ“ç½‘ç»œæ‹“æ‰‘ç»“æ„é›†ç¾¤èŠ‚ç‚¹å„ç§åè®®å­¦æ•°æ®ç»“æ„å’Œç®—æ³•çš„ç²¾é«“æ˜¯ä»€ä¹ˆï¼Ÿæƒ³è¦å­¦ä¹ æ•°æ®ç»“æ„ä¸ç®—æ³•ï¼Œé¦–å…ˆè¦æŒæ¡ä¸€ä¸ªæ•°æ®ç»“æ„ä¸ç®—æ³•ä¸­æœ€é‡è¦çš„æ¦‚å¿µâ€”â€”å¤æ‚åº¦åˆ†æã€‚æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦è¿™ä¸ªæ¦‚å¿µç©¶ç«Ÿæœ‰å¤šé‡è¦å‘¢ï¼Ÿå¯ä»¥è¿™ä¹ˆè¯´ï¼Œå®ƒå‡ ä¹å äº†æ•°æ®ç»“æ„å’Œç®—æ³•è¿™é—¨è¯¾çš„åŠå£æ±Ÿå±±ï¼Œæ˜¯æ•°æ®ç»“æ„å’Œç®—æ³•å­¦ä¹ çš„ç²¾é«“ã€‚æ•°æ®ç»“æ„å’Œç®—æ³•è§£å†³çš„æ˜¯å¦‚ä½•æ›´çœã€æ›´å¿«åœ°å­˜å‚¨å’Œå¤„ç†æ•°æ®çš„é—®é¢˜ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªè€ƒé‡æ•ˆç‡å’Œèµ„æºæ¶ˆè€—çš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯å¤æ‚åº¦åˆ†ææ–¹æ³•ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ åªæŒæ¡äº†æ•°æ®ç»“æ„å’Œç®—æ³•çš„ç‰¹ç‚¹ã€ç”¨æ³•ï¼Œä½†æ˜¯æ²¡æœ‰å­¦ä¼šå¤æ‚åº¦åˆ†æï¼Œé‚£å°±ç›¸å½“äºåªçŸ¥é“æ“ä½œå£è¯€ï¼Œè€Œæ²¡æŒæ¡å¿ƒæ³•ã€‚åªæœ‰æŠŠå¿ƒæ³•äº†ç„¶äºèƒ¸ï¼Œæ‰èƒ½åšåˆ°æ— æ‹›èƒœæœ‰æ‹›æ€æ ·å»é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„é¦–å…ˆï¼Œé€‰æ‹©æ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œç¬¬ä¸€ç‚¹å°±è¦çŸ¥é“ï¼Œæ•°æ®æ€ä¹ˆå»ç»„ç»‡ï¼Œå’Œæ•°æ®è§„æ¨¡æ˜¯æœ‰å…³çš„ã€‚ä¸ä¸€æ ·è§„æ¨¡çš„æ•°æ®ï¼Œéš¾åº¦ä¹Ÿå°±ä¸ä¸€æ ·ã€‚è§£å†³é—®é¢˜çš„æ•ˆç‡ï¼Œæ˜¯ä¸æ•°æ®ç»„ç»‡æ–¹å¼ç›¸å…³çš„ã€‚é¦–å…ˆä¸Šæ¥æˆ‘å…ˆPoå‡ºä¸€å¼ å›¾ï¼Œæ¥åº”å¯¹ç¬¬ä¸€æ­¥å¤§ç±»ç»“æ„çš„é€‰æ‹©æŸ¥è¯¢æ“ä½œæ›´å¤šçš„ç¨‹åºä¸­ï¼Œä½ åº”è¯¥ç”¨é¡ºåºè¡¨ä¿®æ”¹æ“ä½œæ›´å¤šçš„ç¨‹åºä¸­ï¼Œä½ è¦ä½¿ç”¨é“¾è¡¨å•å‘é“¾ åŒå‘é“¾è¡¨ å¾ªç¯é“¾è¡¨ã€‚æ ˆï¼Œæ¶‰åŠåå…¥å…ˆå‡ºçš„é—®é¢˜ï¼Œä¾‹å¦‚å‡½æ•°é€’å½’å°±æ˜¯ä¸ªæ ˆæ¨¡å‹ã€Androidçš„å±å¹•è·³è½¬å°±ç”¨åˆ°æ ˆï¼Œå¾ˆå¤šç±»ä¼¼çš„ä¸œè¥¿ï¼Œä½ å°±ä¼šç¬¬ä¸€æ—¶é—´æƒ³åˆ°ï¼šæˆ‘ä¼šç”¨è¿™ä¸œè¥¿æ¥å»å†™ç®—æ³•å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚é˜Ÿåˆ—ï¼Œå…ˆå…¥å…ˆå‡ºè¦æ’é˜Ÿçš„é—®é¢˜ï¼Œä½ å°±è¦ç”¨åˆ°é˜Ÿåˆ—ï¼Œä¾‹å¦‚å¤šä¸ªç½‘ç»œä¸‹è½½ä»»åŠ¡ï¼Œæˆ‘è¯¥æ€ä¹ˆå»è°ƒåº¦å®ƒä»¬å»è·å¾—ç½‘ç»œèµ„æºå‘¢ï¼Ÿå†ä¾‹å¦‚æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹ï¼ˆorçº¿ç¨‹ï¼‰è°ƒåº¦ï¼Œæˆ‘è¯¥æ€ä¹ˆå»åˆ†é…èµ„æºï¼ˆåƒ CPUï¼‰ç»™å¤šä¸ªä»»åŠ¡å‘¢ï¼Ÿè‚¯å®šä¸èƒ½å…¨éƒ¨ä¸€èµ·æ‹¥æœ‰çš„ï¼Œèµ„æºåªæœ‰ä¸€ä¸ªï¼Œé‚£å°±è¦æ’é˜Ÿï¼é‚£ä¹ˆæ€ä¹ˆæ’é˜Ÿå‘¢ï¼Ÿç”¨æ™®é€šçš„é˜Ÿåˆ—ï¼Ÿä½†æ˜¯å¯¹äºé‚£äº›ä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹æ€ä¹ˆåŠï¼Ÿè¿™æ—¶ï¼Œä½ å°±ä¼šæƒ³åˆ°äº†ä¼˜å…ˆé˜Ÿåˆ—ï¼Œä¼˜ å…ˆé˜Ÿåˆ—æ€ä¹ˆå®ç°ï¼Ÿç”¨å †ï¼Œç„¶åä½ å°±æœ‰ç–‘é—®äº†ï¼Œå †æ˜¯å•¥ç©æ„ï¼Ÿæ€æ ·è¯„æµ‹ç®—æ³•çš„å¥½åæ—¶é—´å¤æ‚åº¦ç©ºé—´å¤æ‚åº¦æ€æ ·å°†æ•°æ®ç»“æ„å’Œç®—æ³•åº”ç”¨åˆ°å®é™…ä¹‹ä¸­ï¼Ÿå†™ä¸€äº›ç¨‹åºï¼Œå°¤å…¶æ˜¯æ¯”è¾ƒåº•å±‚çš„ç¨‹åºã€‚æ•°æ®ç»“æ„å¦‚çº¢é»‘æ ‘,åç¼€æ ‘, ç®—æ³•å¦‚å¿«é€Ÿå‚…é‡Œå¶å˜æ¢,ç½‘ç»œæµç­‰â€¦ å¹³æ—¶å·¥ä½œæœ¬æ¥å°±å¾ˆéš¾ç¢°ä¸Šè¿™äº›ä¸œè¥¿(å¦‚æœç¡®å®ä»äº‹å°–ç«¯ç ”ç©¶é™¤å¤–)ï¼Œä¸ªäººç»å¸¸ç¢°åˆ°çš„ä¹Ÿæ— éå°±æ˜¯äº›æœç´¢, ä¼˜åŒ–å‰ªæâ€¦ç•™ä¸‹ä¸€ä¸ªé—®é¢˜å»ç»™å¤§å®¶æ€è€ƒï¼šå¦‚æœè®©ä½ å®ç°qqé‚£ç§åˆ†ç»„çš„å¥½å‹åˆ—è¡¨ï¼Œæ”¯æŒå„ç§qqé‡Œè¾¹çš„å¥½å‹æ“ä½œï¼Œä½ ä¼šæ€ä¹ˆåšï¼ŸSooooooooooo å­¦ä¹ æ•°æ®ç»“æ„ä¸ç®—æ³•æ˜¯æå‡è‡ªèº«å†…åŠ›ï¼Œå†…åŠ›æå‡äº†ï¼Œå­¦ä¹ å…¶ä»–æŠ€æœ¯å’Œæ¡†æ¶ï¼Œå°±ä¼šç®€å•å®¹æ˜“ä¸€äº›ğŸ¨","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"cpeixin.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[]},{"title":"å°è°ˆå¤šçº¿ç¨‹","slug":"å°è°ˆå¤šçº¿ç¨‹","date":"2016-08-09T07:30:21.000Z","updated":"2020-04-04T11:10:51.174Z","comments":true,"path":"2016/08/09/å°è°ˆå¤šçº¿ç¨‹/","link":"","permalink":"cpeixin.cn/2016/08/09/%E5%B0%8F%E8%B0%88%E5%A4%9A%E7%BA%BF%E7%A8%8B/","excerpt":"","text":"å¤šçº¿ç¨‹ç®€ä»‹Java ç»™å¤šçº¿ç¨‹ç¼–ç¨‹æä¾›äº†å†…ç½®çš„æ”¯æŒã€‚ ä¸€æ¡çº¿ç¨‹æŒ‡çš„æ˜¯è¿›ç¨‹ä¸­ä¸€ä¸ªå•ä¸€é¡ºåºçš„æ§åˆ¶æµï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¹¶å‘å¤šä¸ªçº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚å¤šçº¿ç¨‹æ˜¯å¤šä»»åŠ¡çš„ä¸€ç§ç‰¹åˆ«çš„å½¢å¼ï¼Œä½†å¤šçº¿ç¨‹ä½¿ç”¨äº†æ›´å°çš„èµ„æºå¼€é”€ã€‚è¿™é‡Œå®šä¹‰å’Œçº¿ç¨‹ç›¸å…³çš„å¦ä¸€ä¸ªæœ¯è¯­ - è¿›ç¨‹ï¼šä¸€ä¸ªè¿›ç¨‹åŒ…æ‹¬ç”±æ“ä½œç³»ç»Ÿåˆ†é…çš„å†…å­˜ç©ºé—´ï¼ŒåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚ä¸€ä¸ªçº¿ç¨‹ä¸èƒ½ç‹¬ç«‹çš„å­˜åœ¨ï¼Œå®ƒå¿…é¡»æ˜¯è¿›ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚ä¸€ä¸ªè¿›ç¨‹ä¸€ç›´è¿è¡Œï¼Œç›´åˆ°æ‰€æœ‰çš„éå®ˆæŠ¤çº¿ç¨‹éƒ½ç»“æŸè¿è¡Œåæ‰èƒ½ç»“æŸã€‚å¤šçº¿ç¨‹èƒ½æ»¡è¶³ç¨‹åºå‘˜ç¼–å†™é«˜æ•ˆç‡çš„ç¨‹åºæ¥è¾¾åˆ°å……åˆ†åˆ©ç”¨ CPU çš„ç›®çš„ã€‚å¤šçº¿ç¨‹çŠ¶æ€VMå¯åŠ¨æ—¶ä¼šæœ‰ä¸€ä¸ªç”±ä¸»æ–¹æ³•Mainæ‰€å®šä¹‰çš„ä¸»çº¿ç¨‹ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­å¯ä»¥é€šè¿‡Threadåˆ›å»ºå…¶å®ƒçº¿ç¨‹ã€‚Threadå¯¹è±¡çš„æ–¹æ³•run()ç§°ä¸ºçº¿ç¨‹ä½“ã€‚é€šè¿‡è°ƒç”¨Threadç±»çš„start()æ–¹æ³•æ¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ã€‚é€šä¿—çš„è¯´å°±æ˜¯åœ¨run()æ–¹æ³•ä¸­å®šä¹‰è¦åšä»€ä¹ˆäº‹æƒ…ï¼Œstart()æ–¹æ³•ç”¨æ¥å‘å‡ºå‘½ä»¤å¯ä»¥å¼€å§‹åšäº†ï¼Œä½†è¿™ä¸ä»£è¡¨JVMä¼šç«‹å³è¿è¡Œ run()æ–¹æ³•ä¸­çš„å†…å®¹ï¼Œè€Œåªæ˜¯è®©ä»–å…·å¤‡è¿è¡Œçš„èµ„æ ¼ï¼Œå…·ä½“ä»€ä¹ˆæ—¶ä¾¯å¼€å§‹çœŸæ­£è¿è¡Œrun()æ–¹æ³•ï¼Œéœ€è¦çœ‹JVMçš„è°ƒåº¦ã€‚åœ¨Javaå½“ä¸­ï¼Œçº¿ç¨‹é€šå¸¸éƒ½æœ‰äº”ç§çŠ¶æ€ï¼Œæ–°å»ºã€å°±ç»ªã€è¿è¡Œã€é˜»å¡å’Œæ­»äº¡ã€‚æ–°å»ºçŠ¶æ€ï¼ˆNewï¼‰ï¼šæ–°åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ã€‚å°±ç»ªçŠ¶æ€ï¼ˆRunnableï¼‰ï¼šçº¿ç¨‹å¯¹è±¡åˆ›å»ºåï¼Œå…¶ä»–çº¿ç¨‹è°ƒç”¨äº†è¯¥å¯¹è±¡çš„start()æ–¹æ³•ã€‚è¯¥çŠ¶æ€çš„çº¿ç¨‹ä½äºå¯è¿è¡Œçº¿ç¨‹æ± ä¸­ï¼Œå˜å¾—å¯è¿è¡Œï¼Œç­‰å¾…è·å–CPUçš„ä½¿ç”¨æƒã€‚è¿è¡ŒçŠ¶æ€ï¼ˆRunningï¼‰ï¼šå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹è·å–äº†CPUï¼Œæ‰§è¡Œç¨‹åºä»£ç ã€‚é˜»å¡çŠ¶æ€ï¼ˆBlockedï¼‰ï¼šé˜»å¡çŠ¶æ€æ˜¯çº¿ç¨‹å› ä¸ºæŸç§åŸå› æ”¾å¼ƒCPUä½¿ç”¨æƒï¼Œæš‚æ—¶åœæ­¢è¿è¡Œã€‚ç›´åˆ°çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œæ‰æœ‰æœºä¼šè½¬åˆ°è¿è¡ŒçŠ¶æ€ã€‚é˜»å¡çš„æƒ…å†µåˆ†ä¸‰ç§ï¼šï¼ˆä¸€ï¼‰ã€ç­‰å¾…é˜»å¡ï¼šè¿è¡Œçš„çº¿ç¨‹æ‰§è¡Œwait()æ–¹æ³•ï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥ç­‰å¾…æ± ä¸­ã€‚ï¼ˆäºŒï¼‰ã€åŒæ­¥é˜»å¡ï¼šè¿è¡Œçš„çº¿ç¨‹åœ¨è·å–å¯¹è±¡çš„åŒæ­¥é”æ—¶ï¼Œè‹¥è¯¥åŒæ­¥é”è¢«åˆ«çš„çº¿ç¨‹å ç”¨ï¼Œåˆ™JVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥é”æ± ä¸­ã€‚ï¼ˆä¸‰ï¼‰ã€å…¶ä»–é˜»å¡ï¼šè¿è¡Œçš„çº¿ç¨‹æ‰§è¡Œsleep()æˆ–join()æ–¹æ³•ï¼Œæˆ–è€…å‘å‡ºäº†I/Oè¯·æ±‚æ—¶ï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹ç½®ä¸ºé˜»å¡çŠ¶æ€ã€‚å½“sleep()çŠ¶æ€è¶…æ—¶ã€join()ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢æˆ–è€…è¶…æ—¶ã€æˆ–è€…I/Oå¤„ç†å®Œæ¯•æ—¶ï¼Œçº¿ç¨‹é‡æ–°è½¬å…¥å°±ç»ªçŠ¶æ€ã€‚æ­»äº¡çŠ¶æ€ï¼ˆDeadï¼‰ï¼šçº¿ç¨‹æ‰§è¡Œå®Œäº†æˆ–è€…å› å¼‚å¸¸é€€å‡ºäº†run()æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹ç»“æŸç”Ÿå‘½å‘¨æœŸã€‚åœ¨è¿™é‡Œæˆ‘è¦è¯´æ˜ä¸€ä¸‹start()å’Œrun()ä¹‹é—´çš„å…³ç³»ï¼Œå› ä¸ºåœ¨å¤šçº¿ç¨‹ç¼–ç¨‹çš„è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰å»è°ƒç”¨run()æ–¹æ³•ï¼Œä½†æ˜¯run()åˆæ˜¯ä¸»è¦çš„æ‰§è¡Œä½“ï¼Œé¦–å…ˆPoä¸Šæ¥start()ï¼Œrun()çš„æºç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970/** * Causes this thread to begin execution; the Java Virtual Machine * calls the &lt;code&gt;run&lt;/code&gt; method of this thread. * &lt;p&gt; * The result is that two threads are running concurrently: the * current thread (which returns from the call to the * &lt;code&gt;start&lt;/code&gt; method) and the other thread (which executes its * &lt;code&gt;run&lt;/code&gt; method). * &lt;p&gt; * It is never legal to start a thread more than once. * In particular, a thread may not be restarted once it has completed * execution. * * @exception IllegalThreadStateException if the thread was already * started. * @see #run() * @see #stop() */ public synchronized void start() &#123; /** * This method is not invoked for the main method thread or \"system\" * group threads created/set up by the VM. Any new functionality added * to this method in the future may have to also be added to the VM. * * A zero status value corresponds to state \"NEW\". */ if (threadStatus != 0) throw new IllegalThreadStateException(); /* Notify the group that this thread is about to be started * so that it can be added to the group's list of threads * and the group's unstarted count can be decremented. */ group.add(this); boolean started = false; try &#123; start0(); started = true; &#125; finally &#123; try &#123; if (!started) &#123; group.threadStartFailed(this); &#125; &#125; catch (Throwable ignore) &#123; /* do nothing. If start0 threw a Throwable then it will be passed up the call stack */ &#125; &#125; &#125; private native void start0(); /** * If this thread was constructed using a separate * &lt;code&gt;Runnable&lt;/code&gt; run object, then that * &lt;code&gt;Runnable&lt;/code&gt; object's &lt;code&gt;run&lt;/code&gt; method is called; * otherwise, this method does nothing and returns. * &lt;p&gt; * Subclasses of &lt;code&gt;Thread&lt;/code&gt; should override this method. * * @see #start() * @see #stop() * @see #Thread(ThreadGroup, Runnable, String) */ @Override public void run() &#123; if (target != null) &#123; target.run(); &#125; &#125;æ ¹æ®Java API ï¼š Causes this thread to begin execution; the Java Virtual Machine calls the run method of this thread.start()æ–¹æ³•ä¼šä½¿å¾—è¯¥çº¿ç¨‹å¼€å§‹æ‰§è¡Œï¼›javaè™šæ‹Ÿæœºä¼šè‡ªåŠ¨å»è°ƒç”¨è¯¥çº¿ç¨‹çš„run()æ–¹æ³•ã€‚å› æ­¤ï¼Œt.start()ä¼šå¯¼è‡´run()æ–¹æ³•è¢«è°ƒç”¨ï¼Œrun()æ–¹æ³•ä¸­çš„å†…å®¹ç§°ä¸ºçº¿ç¨‹ä½“ï¼Œå®ƒå°±æ˜¯è¿™ä¸ªçº¿ç¨‹éœ€è¦æ‰§è¡Œçš„å·¥ä½œã€‚åœ¨startæ–¹æ³•é‡Œè°ƒç”¨äº†ä¸€æ¬¡start0æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªåªå£°æ˜æœªå®šä¹‰çš„æ–¹æ³•ï¼Œå¹¶ä¸”ä½¿ç”¨äº†nativeå…³é”®å­—è¿›è¡Œå®šä¹‰nativeæŒ‡çš„æ˜¯è°ƒç”¨æœ¬æœºçš„åŸç”Ÿç³»ç»Ÿå‡½æ•°ã€‚æ‰€ä»¥ï¼Œè°ƒç”¨startæ–¹æ³•ï¼Œä¼šå‘Šè¯‰JVMå»åˆ†é…æœ¬æœºç³»ç»Ÿçš„èµ„æºï¼Œæ‰èƒ½å®ç°å¤šçº¿ç¨‹ã€‚è€Œå¦‚æœä½¿ç”¨run()æ¥å¯åŠ¨çº¿ç¨‹ï¼Œå°±ä¸æ˜¯å¼‚æ­¥æ‰§è¡Œäº†ï¼Œè€Œæ˜¯åŒæ­¥æ‰§è¡Œï¼Œä¸ä¼šè¾¾åˆ°ä½¿ç”¨çº¿ç¨‹çš„æ„ä¹‰ã€‚ç”¨start()æ¥å¯åŠ¨çº¿ç¨‹ï¼Œå®ç°äº†çœŸæ­£æ„ä¹‰ä¸Šçš„å¯åŠ¨çº¿ç¨‹ï¼Œæ­¤æ—¶ä¼šå‡ºç°å¼‚æ­¥æ‰§è¡Œçš„æ•ˆæœï¼Œå³åœ¨çº¿ç¨‹çš„åˆ›å»ºå’Œå¯åŠ¨ä¸­æ‰€è¿°çš„éšæœºæ€§ã€‚å¤šçº¿ç¨‹åˆ›å»ºJava æä¾›äº†ä¸‰ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•å®ç° Runnable æ¥å£æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„æ„é€ æ–¹æ³•ï¼ŒthreadObä¸ºåˆ›å»ºçš„å®ä¾‹å¯¹è±¡Thread(Runnable threadOb,String threadName);12345678910111213141516171819202122232425262728293031323334353637383940414243class RunnableDemo implements Runnable &#123; private Thread t; private String threadName; RunnableDemo( String name) &#123; threadName = name; System.out.println(\"Creating \" + threadName ); &#125; public void run() &#123; System.out.println(\"Running \" + threadName ); try &#123; for(int i = 4; i &gt; 0; i--) &#123; System.out.println(\"Thread: \" + threadName + \", \" + i); // è®©çº¿ç¨‹ç¡çœ ä¸€ä¼š Thread.sleep(50); &#125; &#125;catch (InterruptedException e) &#123; System.out.println(\"Thread \" + threadName + \" interrupted.\"); &#125; System.out.println(\"Thread \" + threadName + \" exiting.\"); &#125; public void start () &#123; System.out.println(\"Starting \" + threadName ); if (t == null) &#123; t = new Thread (this, threadName); t.start (); &#125; &#125;&#125; public class TestThread &#123; public static void main(String args[]) &#123; RunnableDemo R1 = new RunnableDemo( \"Thread-1\"); R1.start(); RunnableDemo R2 = new RunnableDemo( \"Thread-2\"); R2.start(); &#125; &#125;ç»§æ‰¿ Thread ç±»æœ¬èº«åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„ç¬¬äºŒç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œè¯¥ç±»ç»§æ‰¿ Thread ç±»ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªè¯¥ç±»çš„å®ä¾‹ã€‚ç»§æ‰¿ç±»å¿…é¡»é‡å†™ run() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯æ–°çº¿ç¨‹çš„å…¥å£ç‚¹ã€‚å®ƒä¹Ÿå¿…é¡»è°ƒç”¨ start() æ–¹æ³•æ‰èƒ½æ‰§è¡Œã€‚è¯¥æ–¹æ³•å°½ç®¡è¢«åˆ—ä¸ºä¸€ç§å¤šçº¿ç¨‹å®ç°æ–¹å¼ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šä¹Ÿæ˜¯å®ç°äº† Runnable æ¥å£çš„ä¸€ä¸ªå®ä¾‹ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142class ThreadDemo extends Thread &#123; private Thread t; private String threadName; ThreadDemo( String name) &#123; threadName = name; System.out.println(\"Creating \" + threadName ); &#125; public void run() &#123; System.out.println(\"Running \" + threadName ); try &#123; for(int i = 4; i &gt; 0; i--) &#123; System.out.println(\"Thread: \" + threadName + \", \" + i); // è®©çº¿ç¨‹ç¡çœ ä¸€ä¼š Thread.sleep(50); &#125; &#125;catch (InterruptedException e) &#123; System.out.println(\"Thread \" + threadName + \" interrupted.\"); &#125; System.out.println(\"Thread \" + threadName + \" exiting.\"); &#125; public void start () &#123; System.out.println(\"Starting \" + threadName ); if (t == null) &#123; t = new Thread (this, threadName); t.start (); &#125; &#125;&#125; public class TestThread &#123; public static void main(String args[]) &#123; ThreadDemo T1 = new ThreadDemo( \"Thread-1\"); T1.start(); ThreadDemo T2 = new ThreadDemo( \"Thread-2\"); T2.start(); &#125; &#125;Callableå’ŒFutureåˆ›å»ºçº¿ç¨‹åˆ›å»º Callable æ¥å£çš„å®ç°ç±»ï¼Œå¹¶å®ç° call() æ–¹æ³•ï¼Œè¯¥ call() æ–¹æ³•å°†ä½œä¸ºçº¿ç¨‹æ‰§è¡Œä½“ï¼Œå¹¶ä¸”æœ‰è¿”å›å€¼ã€‚åˆ›å»º Callable å®ç°ç±»çš„å®ä¾‹ï¼Œä½¿ç”¨ FutureTask ç±»æ¥åŒ…è£… Callable å¯¹è±¡ï¼Œè¯¥ FutureTask å¯¹è±¡å°è£…äº†è¯¥ Callable å¯¹è±¡çš„ call() æ–¹æ³•çš„è¿”å›å€¼ã€‚ä½¿ç”¨ FutureTask å¯¹è±¡ä½œä¸º Thread å¯¹è±¡çš„ target åˆ›å»ºå¹¶å¯åŠ¨æ–°çº¿ç¨‹ã€‚è°ƒç”¨ FutureTask å¯¹è±¡çš„ get() æ–¹æ³•æ¥è·å¾—å­çº¿ç¨‹æ‰§è¡Œç»“æŸåçš„è¿”å›å€¼ã€‚123456789101112131415161718192021222324252627282930313233343536public class CallableThreadTest implements Callable&lt;Integer&gt; &#123; public static void main(String[] args) &#123; CallableThreadTest ctt = new CallableThreadTest(); FutureTask&lt;Integer&gt; ft = new FutureTask&lt;&gt;(ctt); for(int i = 0;i &lt; 100;i++) &#123; System.out.println(Thread.currentThread().getName()+\" çš„å¾ªç¯å˜é‡içš„å€¼\"+i); if(i==20) &#123; new Thread(ft,\"æœ‰è¿”å›å€¼çš„çº¿ç¨‹\").start(); &#125; &#125; try &#123; System.out.println(\"å­çº¿ç¨‹çš„è¿”å›å€¼ï¼š\"+ft.get()); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (ExecutionException e) &#123; e.printStackTrace(); &#125; &#125; @Override public Integer call() throws Exception &#123; int i = 0; for(;i&lt;100;i++) &#123; System.out.println(Thread.currentThread().getName()+\" \"+i); &#125; return i; &#125; &#125;åˆ›å»ºçº¿ç¨‹æ–¹æ³•ä¹‹é—´çš„åŒºåˆ«å®ç°Runnableå’Œå®ç°Callableæ¥å£çš„æ–¹å¼åŸºæœ¬ç›¸åŒï¼Œä¸è¿‡æ˜¯åè€…æ‰§è¡Œcall()æ–¹æ³•æœ‰è¿”å›å€¼ï¼Œåè€…çº¿ç¨‹æ‰§è¡Œä½“run()æ–¹æ³•æ— è¿”å›å€¼ï¼Œå› æ­¤å¯ä»¥æŠŠè¿™ä¸¤ç§æ–¹å¼å½’ä¸ºä¸€ç§è¿™ç§æ–¹å¼ä¸ç»§æ‰¿Threadç±»çš„æ–¹æ³•ä¹‹é—´çš„å·®åˆ«å¦‚ä¸‹ï¼š1ã€çº¿ç¨‹åªæ˜¯å®ç°Runnableæˆ–å®ç°Callableæ¥å£ï¼Œè¿˜å¯ä»¥ç»§æ‰¿å…¶ä»–ç±»ã€‚2ã€è¿™ç§æ–¹å¼ä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«ä¸€ä¸ªtargetå¯¹è±¡ï¼Œéå¸¸é€‚åˆå¤šçº¿ç¨‹å¤„ç†åŒä¸€ä»½èµ„æºçš„æƒ…å½¢ã€‚3ã€ä½†æ˜¯ç¼–ç¨‹ç¨å¾®å¤æ‚ï¼Œå¦‚æœéœ€è¦è®¿é—®å½“å‰çº¿ç¨‹ï¼Œå¿…é¡»è°ƒç”¨Thread.currentThread()æ–¹æ³•ã€‚4ã€ç»§æ‰¿Threadç±»çš„çº¿ç¨‹ç±»ä¸èƒ½å†ç»§æ‰¿å…¶ä»–çˆ¶ç±»ï¼ˆJavaå•ç»§æ‰¿å†³å®šï¼‰ã€‚æ³¨ï¼šä¸€èˆ¬æ¨èé‡‡ç”¨å®ç°æ¥å£çš„æ–¹å¼æ¥åˆ›å»ºå¤šçº¿ç¨‹ç¤ºä¾‹Accountç±»123456789101112131415161718192021222324252627public class Acount &#123; private String UserName; private float Money; public Acount(String userName, float money) &#123; super(); UserName = userName; Money = money; &#125; public String getUserName() &#123; return UserName; &#125; public void setUserName(String userName) &#123; UserName = userName; &#125; public float getMoney() &#123; return Money; &#125; public void setMoney(float money) &#123; Money = money; &#125;&#125;123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960public class BankOperator implements Runnable &#123; @Override public void run() &#123; //é”å®šå¯¹è±¡ synchronized (a) &#123; withdraw(5); deposit(50); System.out.println(\"brentè´¦æˆ·ä½™é¢ï¼š \"+a.getMoney()); &#125; &#125; static Acount a; public void deposit(float money) &#123; a.setMoney(a.getMoney() + money); try &#123; Thread.sleep(100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(Thread.currentThread().getName() + \":\" + \"å­˜æ¬¾å \" + a.getMoney()); &#125; public void withdraw(float money) &#123; a.setMoney(a.getMoney() - money); try &#123; Thread.sleep(100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(Thread.currentThread().getName() + \":\" + \"å–æ¬¾å \" + a.getMoney()); &#125; BankOperator(Acount a) &#123; super(); this.a = a; &#125; public static void main(String args[]) &#123; Acount a = new Acount(\"brent\", 100); BankOperator bko = new BankOperator(a); Thread t1 = new Thread(bko, \"customer1\"); Thread t2 = new Thread(bko, \"customer2\"); Thread t3 = new Thread(bko, \"customer3\"); Thread t4 = new Thread(bko, \"customer4\"); t1.start(); t2.start(); t3.start(); t4.start(); &#125;&#125;","categories":[],"tags":[]},{"title":"è¿›ç¨‹å’Œçº¿ç¨‹åŸºæœ¬æ¦‚å¿µ","slug":"è¿›ç¨‹å’Œçº¿ç¨‹åŸºæœ¬æ¦‚å¿µ","date":"2016-08-07T07:30:21.000Z","updated":"2020-04-04T17:55:34.701Z","comments":true,"path":"2016/08/07/è¿›ç¨‹å’Œçº¿ç¨‹åŸºæœ¬æ¦‚å¿µ/","link":"","permalink":"cpeixin.cn/2016/08/07/%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/","excerpt":"","text":"å‰è¨€è¿›ç¨‹ï¼ˆprocessï¼‰å’Œçº¿ç¨‹ï¼ˆthreadï¼‰æ˜¯æ“ä½œç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µï¼Œä¹Ÿæ˜¯å¹³å¸¸ç¼–ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°å’Œå¬åˆ°çš„åè¯ç”±äºä¸Šå¤§å­¦çš„æ—¶å€™ï¼Œè€å¸ˆåœ¨è®²è§£æœ‰å…³çº¿ç¨‹ã€è¿›ç¨‹è¯¾ç¨‹æ—¶ï¼Œæˆ‘åº”è¯¥åœ¨ç©ã€Šç¥åº™é€ƒäº¡ã€‹ï¼Œæ‰€ä»¥è¿™ä¸€æ–¹é¢ä¸€ç›´ä¸æ˜¯å¾ˆæ‰å®å°±åœ¨æœ€è¿‘ï¼Œæˆ‘è¯»åˆ°äº†å›½å¤–çš„ä¸€ç¯‡æ–‡ç« å’Œé˜®ä¸€å³°åšå£«çš„æ–‡ç« ï¼Œè¿™ä¸¤ç¯‡æ–‡ç« åˆ©ç”¨â€˜è½¦é—´â€™å’Œâ€˜å·¥äººâ€™çš„å…³ç³»æ¥ç±»æ¯”ï¼Œæµ…æ˜¾æ˜“æ‡‚ï¼Œåˆ†äº«ç»™å¤§å®¶æ¦‚å¿µè®¡ç®—æœºçš„æ ¸å¿ƒæ˜¯CPUï¼Œå®ƒæ‰¿æ‹…äº†æ‰€æœ‰çš„è®¡ç®—ä»»åŠ¡ã€‚å®ƒå°±åƒä¸€åº§å·¥å‚ï¼Œæ—¶åˆ»åœ¨è¿è¡Œã€‚è¿›ç¨‹å‡å®šå·¥å‚çš„ç”µåŠ›æœ‰é™ï¼Œä¸€æ¬¡åªèƒ½ä¾›ç»™ä¸€ä¸ªè½¦é—´ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªè½¦é—´å¼€å·¥çš„æ—¶å€™ï¼Œå…¶ä»–è½¦é—´éƒ½å¿…é¡»åœå·¥èƒŒåçš„å«ä¹‰å°±æ˜¯ï¼Œå•ä¸ªCPUä¸€æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªä»»åŠ¡è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿè¿è¡Œç¨‹åºçš„åŸºæœ¬å•ä½ï¼Œå› æ­¤è¿›ç¨‹æ˜¯åŠ¨æ€çš„ã€‚ç³»ç»Ÿè¿è¡Œä¸€ä¸ªç¨‹åºå³æ˜¯ä¸€ä¸ªè¿›ç¨‹ä»åˆ›å»ºï¼Œè¿è¡Œåˆ°æ¶ˆäº¡çš„è¿‡ç¨‹ã€‚ ç®€å•æ¥è¯´ï¼Œä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ä¸€ä¸ªæ‰§è¡Œä¸­çš„ç¨‹åºï¼Œå®ƒåœ¨è®¡ç®—æœºä¸­ä¸€ä¸ªæŒ‡ä»¤æ¥ç€ä¸€ä¸ªæŒ‡ä»¤åœ°æ‰§è¡Œç€ï¼ŒåŒæ—¶ï¼Œæ¯ä¸ªè¿›ç¨‹è¿˜å æœ‰æŸäº›ç³»ç»Ÿèµ„æºå¦‚CPUæ—¶é—´ï¼Œå†…å­˜ç©ºé—´ï¼Œæ–‡ä»¶ï¼Œæ–‡ä»¶ï¼Œè¾“å…¥è¾“å‡ºè®¾å¤‡çš„ä½¿ç”¨æƒç­‰ç­‰ã€‚æ¢å¥è¯è¯´ï¼Œå½“ç¨‹åºåœ¨æ‰§è¡Œæ—¶ï¼Œå°†ä¼šè¢«æ“ä½œç³»ç»Ÿè½½å…¥å†…å­˜ä¸­ã€‚çº¿ç¨‹ä¸€ä¸ªè½¦é—´é‡Œï¼Œå¯ä»¥æœ‰å¾ˆå¤šå·¥äººã€‚ä»–ä»¬ååŒå®Œæˆä¸€ä¸ªä»»åŠ¡ã€‚çº¿ç¨‹å°±å¥½æ¯”è½¦é—´é‡Œçš„å·¥äººã€‚èƒŒåçš„å«ä¹‰å°±æ˜¯ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…æ‹¬å¤šä¸ªçº¿ç¨‹çº¿ç¨‹ä¸è¿›ç¨‹ç›¸ä¼¼ï¼Œä½†çº¿ç¨‹æ˜¯ä¸€ä¸ªæ¯”è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹åœ¨å…¶æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯ä»¥äº§ç”Ÿå¤šä¸ªçº¿ç¨‹ã€‚ä¸è¿›ç¨‹ä¸åŒçš„æ˜¯åŒç±»çš„å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€å—å†…å­˜ç©ºé—´å’Œä¸€ç»„ç³»ç»Ÿèµ„æºï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨äº§ç”Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ–æ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´ä½œåˆ‡æ¢å·¥ä½œæ—¶ï¼Œè´Ÿæ‹…è¦æ¯”è¿›ç¨‹å°å¾—å¤šï¼Œä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œçº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚å…±äº«å†…å­˜è½¦é—´çš„ç©ºé—´æ˜¯å·¥äººä»¬å…±äº«çš„ï¼Œæ¯”å¦‚è®¸å¤šæˆ¿é—´æ˜¯æ¯ä¸ªå·¥äººéƒ½å¯ä»¥è¿›å‡ºçš„ã€‚èƒŒåçš„å«ä¹‰å°±æ˜¯ï¼Œè¿™è±¡å¾ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜ç©ºé—´æ˜¯å…±äº«çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ä½¿ç”¨è¿™äº›å…±äº«å†…å­˜äº’æ–¥é”å¯æ˜¯ï¼Œæ¯é—´æˆ¿é—´çš„å¤§å°ä¸åŒï¼Œæœ‰äº›æˆ¿é—´æœ€å¤šåªèƒ½å®¹çº³ä¸€ä¸ªäººï¼Œæ¯”å¦‚å•æ‰€ã€‚é‡Œé¢æœ‰äººçš„æ—¶å€™ï¼Œå…¶ä»–äººå°±ä¸èƒ½è¿›å»äº†ã€‚è¿™ä»£è¡¨ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨æŸäº›å…±äº«å†…å­˜æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å®ƒç»“æŸï¼Œæ‰èƒ½ä½¿ç”¨è¿™ä¸€å—å†…å­˜ã€‚ä¸€ä¸ªé˜²æ­¢ä»–äººè¿›å…¥çš„ç®€å•æ–¹æ³•ï¼Œå°±æ˜¯é—¨å£åŠ ä¸€æŠŠé”ã€‚å…ˆåˆ°çš„äººé”ä¸Šé—¨ï¼Œååˆ°çš„äººçœ‹åˆ°ä¸Šé”ï¼Œå°±åœ¨é—¨å£æ’é˜Ÿï¼Œç­‰é”æ‰“å¼€å†è¿›å»ã€‚â€œäº’æ–¥é”â€ï¼ˆMutual exclusionï¼Œç¼©å†™ Mutexï¼‰ï¼Œé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™æŸä¸€å—å†…å­˜åŒºåŸŸä¿¡å·é‡è¿˜æœ‰äº›æˆ¿é—´ï¼Œå¯ä»¥åŒæ—¶å®¹çº³nä¸ªäººï¼Œæ¯”å¦‚å¨æˆ¿ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœäººæ•°å¤§äºnï¼Œå¤šå‡ºæ¥çš„äººåªèƒ½åœ¨å¤–é¢ç­‰ç€ã€‚è¿™å¥½æ¯”æŸäº›å†…å­˜åŒºåŸŸï¼Œåªèƒ½ä¾›ç»™å›ºå®šæ•°ç›®çš„çº¿ç¨‹ä½¿ç”¨ã€‚è¿™æ—¶çš„è§£å†³æ–¹æ³•ï¼Œå°±æ˜¯åœ¨é—¨å£æŒ‚næŠŠé’¥åŒ™ã€‚è¿›å»çš„äººå°±å–ä¸€æŠŠé’¥åŒ™ï¼Œå‡ºæ¥æ—¶å†æŠŠé’¥åŒ™æŒ‚å›åŸå¤„ã€‚ååˆ°çš„äººå‘ç°é’¥åŒ™æ¶ç©ºäº†ï¼Œå°±çŸ¥é“å¿…é¡»åœ¨é—¨å£æ’é˜Ÿç­‰ç€äº†ã€‚è¿™ç§åšæ³•å«åšâ€ä¿¡å·é‡â€ï¼ˆSemaphoreï¼‰ï¼Œç”¨æ¥ä¿è¯å¤šä¸ªçº¿ç¨‹ä¸ä¼šäº’ç›¸å†²çªã€‚ä¸éš¾çœ‹å‡ºï¼Œmutexæ˜¯semaphoreçš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼ˆn=1æ—¶ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®Œå…¨å¯ä»¥ç”¨åè€…æ›¿ä»£å‰è€…ã€‚ä½†æ˜¯ï¼Œå› ä¸ºmutexè¾ƒä¸ºç®€å•ï¼Œä¸”æ•ˆç‡é«˜ï¼Œæ‰€ä»¥åœ¨å¿…é¡»ä¿è¯èµ„æºç‹¬å çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯é‡‡ç”¨è¿™ç§è®¾è®¡ã€‚ä¼˜å…ˆçº§å¦‚æœå«ç”Ÿé—´ç›®å‰å·²é”å®šå¹¶ä¸”æœ‰è®¸å¤šäººæ­£åœ¨ç­‰å¾…ä½¿ç”¨å®ƒæ€ä¹ˆåŠï¼Ÿæ˜¾ç„¶ï¼Œæ‰€æœ‰çš„äººéƒ½ååœ¨å¤–é¢ï¼Œç­‰å¾…æµ´å®¤é‡Œçš„ä»»ä½•äººå‡ºå»ã€‚çœŸæ­£çš„é—®é¢˜æ˜¯ï¼Œâ€œå½“é—¨è§£é”æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿè°ä¸‹æ¬¡å»ï¼Ÿâ€œä½ ä¼šè®¤ä¸ºå…è®¸ç­‰å¾…æ—¶é—´æœ€é•¿çš„äººæ¥ä¸‹æ¥æ˜¯â€œå…¬å¹³çš„â€ã€‚æˆ–è€…ï¼Œè®©æœ€è€çš„äººèµ°å‘ä¸‹ä¸€æ­¥å¯èƒ½æ˜¯â€œå…¬å¹³çš„â€ã€‚æˆ–è€…æœ€é«˜ã€‚æˆ–è€…æœ€é‡è¦çš„ã€‚æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥ç¡®å®šä»€ä¹ˆæ˜¯â€œå…¬å¹³çš„â€ã€‚æˆ‘ä»¬é€šè¿‡ä¸¤ä¸ªå› ç´ æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šä¼˜å…ˆçº§å’Œç­‰å¾…æ—¶é—´ã€‚å‡è®¾ä¸¤ä¸ªäººåŒæ—¶å‡ºç°åœ¨ï¼ˆé”å®šçš„ï¼‰æµ´å®¤é—¨å£ã€‚å…¶ä¸­ä¸€ä¸ªäººæœ‰ä¸€ä¸ªç´§è¿«çš„æˆªæ­¢æ—¥æœŸï¼ˆä»–ä»¬å·²ç»è¿Ÿåˆ°äº†ä¼šè®®ï¼‰ï¼Œè€Œå¦ä¸€ä¸ªåˆ™æ²¡æœ‰ã€‚è®©ç´§è¿«çš„æˆªæ­¢æ—¥æœŸçš„äººä¸‹ä¸€æ­¥æ˜¯ä¸æ˜¯æœ‰æ„ä¹‰ï¼Ÿå—¯ï¼Œå½“ç„¶ä¼šã€‚å”¯ä¸€çš„é—®é¢˜æ˜¯ä½ å¦‚ä½•å†³å®šè°æ›´â€œé‡è¦â€ã€‚ è¿™å¯ä»¥é€šè¿‡åˆ†é…ä¼˜å…ˆçº§æ¥å®Œæˆï¼ˆè®©æˆ‘ä»¬ä½¿ç”¨åƒNeutrinoè¿™æ ·çš„æ•°å­— - ä¸€ä¸ªæ˜¯æœ€ä½çš„å¯ç”¨ä¼˜å…ˆçº§ï¼Œ255æ˜¯æ­¤ç‰ˆæœ¬ä¸­æœ€é«˜çš„ä¼˜å…ˆçº§ï¼‰ã€‚æˆ¿å±‹å†…æœ‰ç´§è¿«æœŸé™çš„äººå°†è·å¾—æ›´é«˜çš„ä¼˜å…ˆæƒï¼Œè€Œé‚£äº›æ²¡æœ‰æœ€åæœŸé™çš„äººå°†è¢«èµ‹äºˆè¾ƒä½çš„ä¼˜å…ˆæƒã€‚çº¿ç¨‹ä¹Ÿä¸€æ ·ã€‚çº¿ç¨‹ä»å…¶çˆ¶çº¿ç¨‹ç»§æ‰¿å…¶è°ƒåº¦ç®—æ³•ï¼Œä½†å¯ä»¥è°ƒç”¨ pthread_setschedparamï¼ˆï¼‰ æ¥æ›´æ”¹å…¶è°ƒåº¦ç­–ç•¥å’Œä¼˜å…ˆçº§ï¼ˆå¦‚æœå®ƒæœ‰æƒæ‰§è¡Œæ­¤æ“ä½œï¼‰ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…ï¼Œå¹¶ä¸”äº’æ–¥é”è¢«è§£é”ï¼Œæˆ‘ä»¬ä¼šå°†äº’æ–¥é”æä¾›ç»™å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„ç­‰å¾…çº¿ç¨‹ã€‚ä½†æ˜¯ï¼Œå‡è®¾ä¸¤ä¸ªäººéƒ½æœ‰åŒæ ·çš„ä¼˜å…ˆæƒã€‚é‚£ä½ ç°åœ¨æ€ä¹ˆåŠï¼Ÿé‚£ä¹ˆï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…è®¸ç­‰å¾…æ—¶é—´æœ€é•¿çš„äººä¸‹ä¸€æ­¥æ˜¯â€œå…¬å¹³çš„â€ã€‚è¿™ä¸ä»…æ˜¯â€œå…¬å¹³çš„â€ï¼Œè€Œä¸”ä¹Ÿæ˜¯Neutrinoå†…æ ¸çš„ä½œç”¨ã€‚åœ¨ä¸€å †çº¿ç¨‹ç­‰å¾…çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸»è¦é€šè¿‡ä¼˜å…ˆçº§ï¼Œå…¶æ¬¡ æ˜¯ç­‰å¾…çš„é•¿åº¦ã€‚äº’æ–¥é”è‚¯å®šä¸æ˜¯æˆ‘ä»¬é‡åˆ°çš„å”¯ä¸€åŒæ­¥å¯¹è±¡ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å…¶ä»–ä¸€äº›ã€‚æ“ä½œç³»ç»Ÿçš„è®¾è®¡ï¼Œå› æ­¤å¯ä»¥å½’ç»“ä¸ºä¸‰ç‚¹ï¼šï¼ˆ1ï¼‰ä»¥å¤šè¿›ç¨‹å½¢å¼ï¼Œå…è®¸å¤šä¸ªä»»åŠ¡åŒæ—¶è¿è¡Œï¼›ï¼ˆ2ï¼‰ä»¥å¤šçº¿ç¨‹å½¢å¼ï¼Œå…è®¸å•ä¸ªä»»åŠ¡åˆ†æˆä¸åŒçš„éƒ¨åˆ†è¿è¡Œï¼›ï¼ˆ3ï¼‰æä¾›åè°ƒæœºåˆ¶ï¼Œä¸€æ–¹é¢é˜²æ­¢è¿›ç¨‹ä¹‹é—´å’Œçº¿ç¨‹ä¹‹é—´äº§ç”Ÿå†²çªï¼Œå¦ä¸€æ–¹é¢å…è®¸è¿›ç¨‹ä¹‹é—´å’Œçº¿ç¨‹ä¹‹é—´å…±äº«èµ„æºã€‚è¿›ç¨‹å’Œçº¿ç¨‹ç®€å•è€ŒåŸºæœ¬é è°±çš„å®šä¹‰å¦‚ä¸‹ï¼šè¿›ç¨‹ï¼šç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œçº¿ç¨‹ï¼šCPUçš„åŸºæœ¬è°ƒåº¦å•ä½","categories":[],"tags":[]}],"categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"cpeixin.cn/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"},{"name":"DataBases","slug":"DataBases","permalink":"cpeixin.cn/categories/DataBases/"},{"name":"Tools","slug":"Tools","permalink":"cpeixin.cn/categories/Tools/"},{"name":"python","slug":"python","permalink":"cpeixin.cn/categories/python/"},{"name":"å¼€å‘å·¥å…·","slug":"å¼€å‘å·¥å…·","permalink":"cpeixin.cn/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"},{"name":"NLP","slug":"NLP","permalink":"cpeixin.cn/categories/NLP/"},{"name":"æ¶æ„","slug":"æ¶æ„","permalink":"cpeixin.cn/categories/%E6%9E%B6%E6%9E%84/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"cpeixin.cn/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"Linux","slug":"Linux","permalink":"cpeixin.cn/categories/Linux/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"cpeixin.cn/categories/%E7%AE%97%E6%B3%95/"},{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"cpeixin.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"cpeixin.cn/categories/%E5%B7%A5%E5%85%B7/"},{"name":"æ·±åº¦å­¦ä¹ ","slug":"æ·±åº¦å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"cpeixin.cn/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"DataBase","slug":"DataBase","permalink":"cpeixin.cn/categories/DataBase/"},{"name":"Docker","slug":"Docker","permalink":"cpeixin.cn/categories/Docker/"}],"tags":[{"name":"HBase","slug":"HBase","permalink":"cpeixin.cn/tags/HBase/"},{"name":"æ•°æ®ä»“åº“","slug":"æ•°æ®ä»“åº“","permalink":"cpeixin.cn/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"},{"name":"mysql","slug":"mysql","permalink":"cpeixin.cn/tags/mysql/"},{"name":"Flink","slug":"Flink","permalink":"cpeixin.cn/tags/Flink/"},{"name":"flask","slug":"flask","permalink":"cpeixin.cn/tags/flask/"},{"name":"IDEA","slug":"IDEA","permalink":"cpeixin.cn/tags/IDEA/"},{"name":"hdfs","slug":"hdfs","permalink":"cpeixin.cn/tags/hdfs/"},{"name":"GPT-2","slug":"GPT-2","permalink":"cpeixin.cn/tags/GPT-2/"},{"name":"å•ä¾‹æ¨¡å¼","slug":"å•ä¾‹æ¨¡å¼","permalink":"cpeixin.cn/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"},{"name":"kali","slug":"kali","permalink":"cpeixin.cn/tags/kali/"},{"name":"spark","slug":"spark","permalink":"cpeixin.cn/tags/spark/"},{"name":"hive","slug":"hive","permalink":"cpeixin.cn/tags/hive/"},{"name":"æœåŠ¡å™¨å®‰å…¨","slug":"æœåŠ¡å™¨å®‰å…¨","permalink":"cpeixin.cn/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8/"},{"name":"åŠ¨æ€è§„åˆ’","slug":"åŠ¨æ€è§„åˆ’","permalink":"cpeixin.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"},{"name":"flink","slug":"flink","permalink":"cpeixin.cn/tags/flink/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"cpeixin.cn/tags/%E7%88%AC%E8%99%AB/"},{"name":"å¸ƒéš†è¿‡æ»¤å™¨","slug":"å¸ƒéš†è¿‡æ»¤å™¨","permalink":"cpeixin.cn/tags/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/"},{"name":"kafka","slug":"kafka","permalink":"cpeixin.cn/tags/kafka/"},{"name":"shadowsock","slug":"shadowsock","permalink":"cpeixin.cn/tags/shadowsock/"},{"name":"æ·±åº¦å­¦ä¹ ","slug":"æ·±åº¦å­¦ä¹ ","permalink":"cpeixin.cn/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"},{"name":"ETL","slug":"ETL","permalink":"cpeixin.cn/tags/ETL/"},{"name":"æ—¶é—´åºåˆ—","slug":"æ—¶é—´åºåˆ—","permalink":"cpeixin.cn/tags/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97/"},{"name":"é€»è¾‘å›å½’","slug":"é€»è¾‘å›å½’","permalink":"cpeixin.cn/tags/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/"},{"name":"Random Forest","slug":"Random-Forest","permalink":"cpeixin.cn/tags/Random-Forest/"},{"name":"PageRank","slug":"PageRank","permalink":"cpeixin.cn/tags/PageRank/"},{"name":"Apriori","slug":"Apriori","permalink":"cpeixin.cn/tags/Apriori/"},{"name":"EM","slug":"EM","permalink":"cpeixin.cn/tags/EM/"},{"name":"K-Means","slug":"K-Means","permalink":"cpeixin.cn/tags/K-Means/"},{"name":"KNN","slug":"KNN","permalink":"cpeixin.cn/tags/KNN/"},{"name":"SVM","slug":"SVM","permalink":"cpeixin.cn/tags/SVM/"},{"name":"Naive Bayes","slug":"Naive-Bayes","permalink":"cpeixin.cn/tags/Naive-Bayes/"},{"name":"Decision Tree","slug":"Decision-Tree","permalink":"cpeixin.cn/tags/Decision-Tree/"},{"name":"sklearn","slug":"sklearn","permalink":"cpeixin.cn/tags/sklearn/"},{"name":"ç‰¹å¾å·¥ç¨‹","slug":"ç‰¹å¾å·¥ç¨‹","permalink":"cpeixin.cn/tags/%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/"},{"name":"æ•°æ®æ¸…æ´—","slug":"æ•°æ®æ¸…æ´—","permalink":"cpeixin.cn/tags/%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97/"},{"name":"æ•°æ®é‡‡é›†","slug":"æ•°æ®é‡‡é›†","permalink":"cpeixin.cn/tags/%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/"},{"name":"ç”¨æˆ·ç”»åƒ","slug":"ç”¨æˆ·ç”»åƒ","permalink":"cpeixin.cn/tags/%E7%94%A8%E6%88%B7%E7%94%BB%E5%83%8F/"},{"name":"è¯å‘é‡","slug":"è¯å‘é‡","permalink":"cpeixin.cn/tags/%E8%AF%8D%E5%90%91%E9%87%8F/"},{"name":"python","slug":"python","permalink":"cpeixin.cn/tags/python/"},{"name":"redis","slug":"redis","permalink":"cpeixin.cn/tags/redis/"},{"name":"OLAP","slug":"OLAP","permalink":"cpeixin.cn/tags/OLAP/"},{"name":"docker","slug":"docker","permalink":"cpeixin.cn/tags/docker/"},{"name":"HashMap","slug":"HashMap","permalink":"cpeixin.cn/tags/HashMap/"},{"name":"scala","slug":"scala","permalink":"cpeixin.cn/tags/scala/"},{"name":"å›æº¯","slug":"å›æº¯","permalink":"cpeixin.cn/tags/%E5%9B%9E%E6%BA%AF/"},{"name":"å †","slug":"å †","permalink":"cpeixin.cn/tags/%E5%A0%86/"},{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","permalink":"cpeixin.cn/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"name":"skipList","slug":"skipList","permalink":"cpeixin.cn/tags/skipList/"},{"name":"çº¢é»‘æ ‘","slug":"çº¢é»‘æ ‘","permalink":"cpeixin.cn/tags/%E7%BA%A2%E9%BB%91%E6%A0%91/"},{"name":"æ’åº","slug":"æ’åº","permalink":"cpeixin.cn/tags/%E6%8E%92%E5%BA%8F/"},{"name":"yarn","slug":"yarn","permalink":"cpeixin.cn/tags/yarn/"},{"name":"mapreduce","slug":"mapreduce","permalink":"cpeixin.cn/tags/mapreduce/"},{"name":"é€’å½’","slug":"é€’å½’","permalink":"cpeixin.cn/tags/%E9%80%92%E5%BD%92/"},{"name":"äºŒåˆ†æŸ¥æ‰¾","slug":"äºŒåˆ†æŸ¥æ‰¾","permalink":"cpeixin.cn/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/"},{"name":"æ•£åˆ—è¡¨","slug":"æ•£åˆ—è¡¨","permalink":"cpeixin.cn/tags/%E6%95%A3%E5%88%97%E8%A1%A8/"},{"name":"é“¾è¡¨","slug":"é“¾è¡¨","permalink":"cpeixin.cn/tags/%E9%93%BE%E8%A1%A8/"},{"name":"LRUæ·˜æ±°ç®—æ³•","slug":"LRUæ·˜æ±°ç®—æ³•","permalink":"cpeixin.cn/tags/LRU%E6%B7%98%E6%B1%B0%E7%AE%97%E6%B3%95/"},{"name":"æ ˆ","slug":"æ ˆ","permalink":"cpeixin.cn/tags/%E6%A0%88/"},{"name":"é˜Ÿåˆ—","slug":"é˜Ÿåˆ—","permalink":"cpeixin.cn/tags/%E9%98%9F%E5%88%97/"},{"name":"çº¿æ€§è¡¨","slug":"çº¿æ€§è¡¨","permalink":"cpeixin.cn/tags/%E7%BA%BF%E6%80%A7%E8%A1%A8/"},{"name":"æ•°ç»„","slug":"æ•°ç»„","permalink":"cpeixin.cn/tags/%E6%95%B0%E7%BB%84/"}]}