<!-- build time:Tue Jan 12 2021 23:56:36 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta name="referrer" content="no-referrer"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>æ•°æ®ä»“åº“è¶…è¯¦ç»†æ¡ˆä¾‹ | å¸ƒå…°ç‰¹ | ä¸å¿˜åˆå¿ƒ</title><meta name="description" content="ä»¥ä¸‹è¿™ç¯‡åšå®¢è½¬è½½è‡ªæ•°æ®ä»“åº“æ¡ˆä¾‹ï¼Œå·¨è¯¦ç»†ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ç¦»çº¿æ•°æ®ä»“åº“æ•°æ®ä»“åº“ï¼ˆData WareHouseï¼‰æ˜¯ä¸ºä¼ä¸šæ‰€æœ‰å†³ç­–åˆ¶å®šè¿‡ç¨‹ï¼Œæä¾›æ‰€æœ‰ç³»ç»Ÿæ•°æ®æ”¯æŒçš„æˆ˜ç•¥é›†åˆé€šè¿‡å¯¹æ•°æ®ä»“åº“ä¸­æ•°æ®çš„åˆ†æï¼Œå¯ä»¥å¸®åŠ©ä¼ä¸šï¼Œæ”¹è¿›ä¸šåŠ¡æµç¨‹ã€æ§åˆ¶ã€æˆæœ¬ã€æé«˜äº§å“è´¨é‡ç­‰æ•°æ®ä»“åº“ï¼Œå¹¶ä¸æ˜¯æ•°æ®æœ€ç»ˆç›®çš„åœ°ï¼Œè€Œæ˜¯ä¸ºæ•°æ®æœ€ç»ˆçš„ç›®çš„åœ°åšå¥½å‡†å¤‡ï¼šæ¸…æ´—ã€è½¬ä¹‰ã€åˆ†ç±»ã€é‡ç»„ã€åˆå¹¶ã€æ‹†åˆ†ã€ç»Ÿè®¡ç­‰ç­‰1 é¡¹ç›®ç®€ä»‹1.1 é¡¹ç›®éœ€æ±‚ç”¨æˆ·è¡Œä¸ºæ•°æ®é‡‡é›†"><meta property="og:type" content="article"><meta property="og:title" content="æ•°æ®ä»“åº“è¶…è¯¦ç»†æ¡ˆä¾‹"><meta property="og:url" content="cpeixin.cn/2020/07/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E8%B6%85%E8%AF%A6%E7%BB%86%E6%A1%88%E4%BE%8B/index.html"><meta property="og:site_name" content="å¸ƒå…°ç‰¹ | ä¸å¿˜åˆå¿ƒ"><meta property="og:description" content="ä»¥ä¸‹è¿™ç¯‡åšå®¢è½¬è½½è‡ªæ•°æ®ä»“åº“æ¡ˆä¾‹ï¼Œå·¨è¯¦ç»†ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ç¦»çº¿æ•°æ®ä»“åº“æ•°æ®ä»“åº“ï¼ˆData WareHouseï¼‰æ˜¯ä¸ºä¼ä¸šæ‰€æœ‰å†³ç­–åˆ¶å®šè¿‡ç¨‹ï¼Œæä¾›æ‰€æœ‰ç³»ç»Ÿæ•°æ®æ”¯æŒçš„æˆ˜ç•¥é›†åˆé€šè¿‡å¯¹æ•°æ®ä»“åº“ä¸­æ•°æ®çš„åˆ†æï¼Œå¯ä»¥å¸®åŠ©ä¼ä¸šï¼Œæ”¹è¿›ä¸šåŠ¡æµç¨‹ã€æ§åˆ¶ã€æˆæœ¬ã€æé«˜äº§å“è´¨é‡ç­‰æ•°æ®ä»“åº“ï¼Œå¹¶ä¸æ˜¯æ•°æ®æœ€ç»ˆç›®çš„åœ°ï¼Œè€Œæ˜¯ä¸ºæ•°æ®æœ€ç»ˆçš„ç›®çš„åœ°åšå¥½å‡†å¤‡ï¼šæ¸…æ´—ã€è½¬ä¹‰ã€åˆ†ç±»ã€é‡ç»„ã€åˆå¹¶ã€æ‹†åˆ†ã€ç»Ÿè®¡ç­‰ç­‰1 é¡¹ç›®ç®€ä»‹1.1 é¡¹ç›®éœ€æ±‚ç”¨æˆ·è¡Œä¸ºæ•°æ®é‡‡é›†"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445205-31fdcfc5-e2d2-41a6-b5cc-624c31b3e574.png#align=left&display=inline&height=744&margin=%5Bobject%20Object%5D&originHeight=744&originWidth=1234&size=0&status=done&style=none&width=1234"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445253-8d922f5c-47b5-4f1d-ad8e-1a71eeae15aa.png#align=left&display=inline&height=736&margin=%5Bobject%20Object%5D&originHeight=736&originWidth=1703&size=0&status=done&style=none&width=1703"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445220-53833589-bf8f-44b6-8c7b-465e87e1e711.png#align=left&display=inline&height=836&margin=%5Bobject%20Object%5D&originHeight=836&originWidth=482&size=0&status=done&style=none&width=482"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445213-0bbd34e0-bb23-4e03-b90e-3ca09d0c5569.png#align=left&display=inline&height=838&margin=%5Bobject%20Object%5D&originHeight=838&originWidth=499&size=0&status=done&style=none&width=499"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445268-6588114c-b79a-4e79-8763-250f838f3536.png#align=left&display=inline&height=711&margin=%5Bobject%20Object%5D&originHeight=711&originWidth=493&size=0&status=done&style=none&width=493"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445229-1c9049ba-ee68-4f5c-ad71-bba666fde424.png#align=left&display=inline&height=858&margin=%5Bobject%20Object%5D&originHeight=858&originWidth=513&size=0&status=done&style=none&width=513"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445234-c1ea35e6-d731-485d-9f74-e1eccba7431e.png#align=left&display=inline&height=894&margin=%5Bobject%20Object%5D&originHeight=894&originWidth=537&size=0&status=done&style=none&width=537"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445204-a4518660-4192-4dc1-b934-848b40a364d9.png#align=left&display=inline&height=772&margin=%5Bobject%20Object%5D&originHeight=772&originWidth=493&size=0&status=done&style=none&width=493"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445276-36599c24-74d5-4b7f-8674-1979b36b32cf.png#align=left&display=inline&height=815&margin=%5Bobject%20Object%5D&originHeight=815&originWidth=1918&size=0&status=done&style=none&width=1918"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445197-5930bda1-7de7-4d77-8450-d1408dde46ad.png#align=left&display=inline&height=738&margin=%5Bobject%20Object%5D&originHeight=738&originWidth=1301&size=0&status=done&style=none&width=1301"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445200-dd221676-3d59-4d7f-a516-52882e9754d2.png#align=left&display=inline&height=810&margin=%5Bobject%20Object%5D&originHeight=810&originWidth=1300&size=0&status=done&style=none&width=1300"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445354-3c28f41c-e63c-4fb9-84d2-2758e24117d7.png#align=left&display=inline&height=356&margin=%5Bobject%20Object%5D&originHeight=356&originWidth=1501&size=0&status=done&style=none&width=1501"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445239-29830e5f-2628-4b61-b25c-860285f21cc5.png#align=left&display=inline&height=733&margin=%5Bobject%20Object%5D&originHeight=733&originWidth=1500&size=0&status=done&style=none&width=1500"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445257-f8650a51-09ee-42f3-b9e6-c374f207c5b9.png#align=left&display=inline&height=402&margin=%5Bobject%20Object%5D&originHeight=402&originWidth=1501&size=0&status=done&style=none&width=1501"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445238-b3a082a7-5282-4ffe-b763-62f4d159a8b3.png#align=left&display=inline&height=395&margin=%5Bobject%20Object%5D&originHeight=395&originWidth=1501&size=0&status=done&style=none&width=1501"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445231-a9463aec-bcbe-4716-9e21-e761f37fc57e.png#align=left&display=inline&height=64&margin=%5Bobject%20Object%5D&originHeight=64&originWidth=1152&size=0&status=done&style=none&width=1152"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445356-4fb1c879-70b3-4a9b-aecd-98bc3096d13d.png#align=left&display=inline&height=61&margin=%5Bobject%20Object%5D&originHeight=61&originWidth=1150&size=0&status=done&style=none&width=1150"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445278-2645af1d-a1c6-49eb-9fae-9a2e54c6fdd1.png#align=left&display=inline&height=125&margin=%5Bobject%20Object%5D&originHeight=125&originWidth=1204&size=0&status=done&style=none&width=1204"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445291-68eeb8c7-d2d0-4420-b26b-7008b185d7d4.png#align=left&display=inline&height=278&margin=%5Bobject%20Object%5D&originHeight=278&originWidth=918&size=0&status=done&style=none&width=918"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445578-b0c40759-4e33-4b63-899b-6757a21dca2b.png#align=left&display=inline&height=821&margin=%5Bobject%20Object%5D&originHeight=821&originWidth=1920&size=0&status=done&style=none&width=1920"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445286-e3d74a0a-846a-497d-9395-835dc06bbe36.png#align=left&display=inline&height=378&margin=%5Bobject%20Object%5D&originHeight=378&originWidth=1509&size=0&status=done&style=none&width=1509"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445293-b89b1d01-98f1-4ea2-9a5f-8b49b3bb9549.png#align=left&display=inline&height=385&margin=%5Bobject%20Object%5D&originHeight=385&originWidth=1511&size=0&status=done&style=none&width=1511"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445281-63bb8866-411b-4829-b0b3-0d989bca1884.png#align=left&display=inline&height=571&margin=%5Bobject%20Object%5D&originHeight=571&originWidth=1159&size=0&status=done&style=none&width=1159"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445499-c8b438ec-8428-4251-83c3-daecf0ea0f47.png#align=left&display=inline&height=647&margin=%5Bobject%20Object%5D&originHeight=647&originWidth=959&size=0&status=done&style=none&width=959"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445306-c312505f-c425-4ba5-97ee-9970d00d11df.png#align=left&display=inline&height=603&margin=%5Bobject%20Object%5D&originHeight=603&originWidth=1244&size=0&status=done&style=none&width=1244"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445320-2cc623a5-0587-4abf-a3ae-daaaf038854d.png#align=left&display=inline&height=682&margin=%5Bobject%20Object%5D&originHeight=682&originWidth=1134&size=0&status=done&style=none&width=1134"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445293-807044ab-66a1-4421-823b-b7945c79f048.png#align=left&display=inline&height=370&margin=%5Bobject%20Object%5D&originHeight=370&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445421-3fefa623-d4e1-4458-9247-ceafcc11bbd9.png#align=left&display=inline&height=188&margin=%5Bobject%20Object%5D&originHeight=188&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445457-375551a4-5ba5-4fe2-8594-36a86445a0e9.png#align=left&display=inline&height=224&margin=%5Bobject%20Object%5D&originHeight=224&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445409-4fcce741-b0a9-40fe-ae2a-e0669c51338b.png#align=left&display=inline&height=261&margin=%5Bobject%20Object%5D&originHeight=261&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445599-b968e841-b432-4d76-87e3-e4e4990466c9.png#align=left&display=inline&height=93&margin=%5Bobject%20Object%5D&originHeight=93&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445399-404c5075-6615-4886-8101-ae6a9a2ea836.png#align=left&display=inline&height=99&margin=%5Bobject%20Object%5D&originHeight=99&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445762-7d1a4322-7ef5-4fe2-bb8b-ef97c0bcbb9a.png#align=left&display=inline&height=103&margin=%5Bobject%20Object%5D&originHeight=103&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445446820-0341ff71-434e-4a82-8036-eba14a8476b9.png#align=left&display=inline&height=199&margin=%5Bobject%20Object%5D&originHeight=199&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445408-12faad35-63c2-4718-ac13-83b26354b3c3.png#align=left&display=inline&height=119&margin=%5Bobject%20Object%5D&originHeight=119&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445709-051d048d-66ef-40a7-981a-8538094858a6.png#align=left&display=inline&height=72&margin=%5Bobject%20Object%5D&originHeight=72&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445417-956df41f-c8d8-43e9-a9ef-478c4e16fa95.png#align=left&display=inline&height=106&margin=%5Bobject%20Object%5D&originHeight=106&originWidth=1277&size=0&status=done&style=none&width=1277"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445403-6ebe9cc2-6007-4e39-9647-1d63cb9886f4.png#align=left&display=inline&height=118&margin=%5Bobject%20Object%5D&originHeight=118&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445616-7c564b8c-e4be-4942-a245-5a986b440689.png#align=left&display=inline&height=136&margin=%5Bobject%20Object%5D&originHeight=136&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445432-2a0d5fa0-0fcf-45b9-9d62-a3c97be4ced3.png#align=left&display=inline&height=260&margin=%5Bobject%20Object%5D&originHeight=260&originWidth=1132&size=0&status=done&style=none&width=1132"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445415-560c225d-39ad-4e97-ae5e-feded91e61bc.png#align=left&display=inline&height=211&margin=%5Bobject%20Object%5D&originHeight=211&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445420-ec008b1a-ac25-4d67-8f30-a4f22f8bf986.png#align=left&display=inline&height=229&margin=%5Bobject%20Object%5D&originHeight=229&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445413-5bc2fefc-43ea-4198-962a-68e04c3693b5.png#align=left&display=inline&height=167&margin=%5Bobject%20Object%5D&originHeight=167&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445440-5134d8aa-2085-457c-bb47-4ba611528bc1.png#align=left&display=inline&height=193&margin=%5Bobject%20Object%5D&originHeight=193&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445469-06ad320b-4efb-4e48-b359-66b5a0180987.png#align=left&display=inline&height=306&margin=%5Bobject%20Object%5D&originHeight=306&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445480-d02fd607-dfe9-47b8-992f-8f675460e400.png#align=left&display=inline&height=172&margin=%5Bobject%20Object%5D&originHeight=172&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445580-ef8aff78-4e6e-4cfa-8a34-5cb0929bbf8f.png#align=left&display=inline&height=133&margin=%5Bobject%20Object%5D&originHeight=133&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445455-d299fd9e-7ed4-4419-a4eb-41e0d3af4c25.png#align=left&display=inline&height=181&margin=%5Bobject%20Object%5D&originHeight=181&originWidth=1279&size=0&status=done&style=none&width=1279"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445509-9e9b8580-ed76-4d31-9524-0d9d35af8e7e.png#align=left&display=inline&height=194&margin=%5Bobject%20Object%5D&originHeight=194&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445498-cace1b91-fd1c-495e-ae9e-5b20b950f181.png#align=left&display=inline&height=80&margin=%5Bobject%20Object%5D&originHeight=80&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445585-dfcd1dca-4af1-4822-98c0-729ff17ad0cd.png#align=left&display=inline&height=105&margin=%5Bobject%20Object%5D&originHeight=105&originWidth=820&size=0&status=done&style=none&width=820"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445558-f3526a7c-422a-4254-b832-a0edb969ecd0.png#align=left&display=inline&height=577&margin=%5Bobject%20Object%5D&originHeight=577&originWidth=1161&size=0&status=done&style=none&width=1161"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445503-1f00df37-1048-4dab-bd2a-b93874b97ed6.png#align=left&display=inline&height=563&margin=%5Bobject%20Object%5D&originHeight=563&originWidth=1141&size=0&status=done&style=none&width=1141"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445576-95ae80a2-e157-4ba2-ac2f-39c0057bfc4d.png#align=left&display=inline&height=820&margin=%5Bobject%20Object%5D&originHeight=820&originWidth=1920&size=0&status=done&style=none&width=1920"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445577-7f5949c5-01ad-4097-b19b-0ebe0cfd3546.png#align=left&display=inline&height=625&margin=%5Bobject%20Object%5D&originHeight=625&originWidth=847&size=0&status=done&style=none&width=847"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445447507-0aa01c2c-12fc-4d51-ba3e-a055609bcb47.png#align=left&display=inline&height=682&margin=%5Bobject%20Object%5D&originHeight=682&originWidth=1134&size=0&status=done&style=none&width=1134"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445580-441c434e-54a5-49d6-973a-ef7d97c1b4ac.png#align=left&display=inline&height=577&margin=%5Bobject%20Object%5D&originHeight=577&originWidth=1161&size=0&status=done&style=none&width=1161"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445560-1a8ada2f-b802-4db9-b161-788f80c89770.png#align=left&display=inline&height=683&margin=%5Bobject%20Object%5D&originHeight=683&originWidth=1168&size=0&status=done&style=none&width=1168"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445550-cccdcf34-74d8-42ae-ba5e-2c3769ca3c9e.png#align=left&display=inline&height=77&margin=%5Bobject%20Object%5D&originHeight=77&originWidth=1255&size=0&status=done&style=none&width=1255"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445578-aeef9cf0-c4cf-4a5a-91ea-02ec01c0bf61.png#align=left&display=inline&height=622&margin=%5Bobject%20Object%5D&originHeight=622&originWidth=981&size=0&status=done&style=none&width=981"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445446614-4652a8e0-0b0a-4e2a-910b-e90751aed058.png#align=left&display=inline&height=446&margin=%5Bobject%20Object%5D&originHeight=446&originWidth=951&size=0&status=done&style=none&width=951"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445749-02840e2e-dcb1-4a8a-8778-e6ee6b650936.png#align=left&display=inline&height=614&margin=%5Bobject%20Object%5D&originHeight=614&originWidth=1477&size=0&status=done&style=none&width=1477"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445567-5b7c6d42-4d24-4807-afb3-cdea023f4f90.png#align=left&display=inline&height=477&margin=%5Bobject%20Object%5D&originHeight=477&originWidth=951&size=0&status=done&style=none&width=951"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445612-d6f7562c-f0bb-430f-b4af-7b42344e971f.png#align=left&display=inline&height=730&margin=%5Bobject%20Object%5D&originHeight=730&originWidth=1437&size=0&status=done&style=none&width=1437"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445586-766cb2b8-d761-4c9a-a289-16f60a99ddcd.png#align=left&display=inline&height=477&margin=%5Bobject%20Object%5D&originHeight=477&originWidth=951&size=0&status=done&style=none&width=951"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445702-d1a78ffa-edf3-4d58-a3bb-dab7ac195815.png#align=left&display=inline&height=604&margin=%5Bobject%20Object%5D&originHeight=604&originWidth=1333&size=0&status=done&style=none&width=1333"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445677-bc019011-2053-412d-b4c8-bfd856f29547.png#align=left&display=inline&height=603&margin=%5Bobject%20Object%5D&originHeight=603&originWidth=1333&size=0&status=done&style=none&width=1333"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445698-37476ac6-25f3-4cea-86ac-f907a3cb1d1d.png#align=left&display=inline&height=621&margin=%5Bobject%20Object%5D&originHeight=621&originWidth=1376&size=0&status=done&style=none&width=1376"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445696-3b581062-c5d4-427f-ba12-e6867d59b49c.png#align=left&display=inline&height=417&margin=%5Bobject%20Object%5D&originHeight=417&originWidth=1318&size=0&status=done&style=none&width=1318"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445883-e8c65772-697b-4f7a-9dd5-d454e8615019.png#align=left&display=inline&height=534&margin=%5Bobject%20Object%5D&originHeight=534&originWidth=1315&size=0&status=done&style=none&width=1315"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445446239-9b99f151-4d88-4505-ab08-fb212a6d8ac7.png#align=left&display=inline&height=339&margin=%5Bobject%20Object%5D&originHeight=339&originWidth=1207&size=0&status=done&style=none&width=1207"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445446059-b20b058a-4006-4c97-bce2-84b85cd28599.png#align=left&display=inline&height=624&margin=%5Bobject%20Object%5D&originHeight=624&originWidth=1205&size=0&status=done&style=none&width=1205"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445818-d1c8fc14-e529-4591-805f-7345bab479e8.png#align=left&display=inline&height=330&margin=%5Bobject%20Object%5D&originHeight=330&originWidth=1906&size=0&status=done&style=none&width=1906"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445645-ab931a0b-bb10-4b9a-9c67-c42afdb4132d.png#align=left&display=inline&height=334&margin=%5Bobject%20Object%5D&originHeight=334&originWidth=1722&size=0&status=done&style=none&width=1722"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445674-85cdb9f6-3bc5-45af-a42c-260b856251c4.png#align=left&display=inline&height=727&margin=%5Bobject%20Object%5D&originHeight=727&originWidth=1200&size=0&status=done&style=none&width=1200"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445446714-5b66a38b-d703-4552-a3b2-78e2bb1093b0.png#align=left&display=inline&height=633&margin=%5Bobject%20Object%5D&originHeight=633&originWidth=1129&size=0&status=done&style=none&width=1129"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445779-c15f3dba-9e4f-4a43-aa6a-da30699cb8ae.png#align=left&display=inline&height=554&margin=%5Bobject%20Object%5D&originHeight=554&originWidth=1243&size=0&status=done&style=none&width=1243"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445711-5342c8ec-2d69-476f-bb7d-80084793cdc7.png#align=left&display=inline&height=699&margin=%5Bobject%20Object%5D&originHeight=699&originWidth=1309&size=0&status=done&style=none&width=1309"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445446108-d1824bc2-adf7-4c28-bc32-71e8ba274913.png#align=left&display=inline&height=806&margin=%5Bobject%20Object%5D&originHeight=806&originWidth=1435&size=0&status=done&style=none&width=1435"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445740-8f05faaa-a871-4d74-9b27-f4fa1da7e452.png#align=left&display=inline&height=771&margin=%5Bobject%20Object%5D&originHeight=771&originWidth=1437&size=0&status=done&style=none&width=1437"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445877-2b94e8bb-aec2-445a-bea1-1e80c6f64ace.png#align=left&display=inline&height=836&margin=%5Bobject%20Object%5D&originHeight=836&originWidth=1647&size=0&status=done&style=none&width=1647"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445836-498738cf-a65f-4127-af18-9a1661eda52d.png#align=left&display=inline&height=522&margin=%5Bobject%20Object%5D&originHeight=522&originWidth=987&size=0&status=done&style=none&width=987"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445739-01d3c47c-ce57-475d-9b12-238c669b7f15.png#align=left&display=inline&height=412&margin=%5Bobject%20Object%5D&originHeight=412&originWidth=963&size=0&status=done&style=none&width=963"><meta property="article:published_time" content="2020-07-07T09:17:57.000Z"><meta property="article:modified_time" content="2020-08-03T09:19:05.745Z"><meta property="article:author" content="Brent"><meta property="article:tag" content="æ•°æ®ä»“åº“"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445205-31fdcfc5-e2d2-41a6-b5cc-624c31b3e574.png#align=left&display=inline&height=744&margin=%5Bobject%20Object%5D&originHeight=744&originWidth=1234&size=0&status=done&style=none&width=1234"><link rel="canonical" href="cpeixin.cn/2020/07/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E8%B6%85%E8%AF%A6%E7%BB%86%E6%A1%88%E4%BE%8B/index.html"><link rel="alternate" href="/atom.xml" title="å¸ƒå…°ç‰¹ | ä¸å¿˜åˆå¿ƒ" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet"><meta name="generator" content="Hexo 4.2.0"></head><body class="main-center" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/cpeixin" target="_blank" rel="external nofollow noopener noreferrer"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">Brent</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">å¤§æ•°æ®å·¥ç¨‹å¸ˆ &amp; æœºå™¨å­¦ä¹ </h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Malaysia</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="æœç´¢"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">é¦–é¡µ</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">å½’æ¡£</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">åˆ†ç±»</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">æ ‡ç­¾</span></a></li><li class="menu-item menu-item-repository"><a href="/repository"><i class="icon icon-project"></i> <span class="menu-title">é¡¹ç›®</span></a></li><li class="menu-item menu-item-books"><a href="/books"><i class="icon icon-book-fill"></i> <span class="menu-title">ä¹¦å•</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">å‹é“¾</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">å…³äº</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/cpeixin" target="_blank" title="Github" data-toggle="tooltip" data-placement="top" rel="external nofollow noopener noreferrer"><i class="icon icon-github"></i></a></li><li><a href="https://www.weibo.com/u/1970875963" target="_blank" title="Weibo" data-toggle="tooltip" data-placement="top" rel="external nofollow noopener noreferrer"><i class="icon icon-weibo"></i></a></li><li><a href="https://twitter.com/iwebued" target="_blank" title="Twitter" data-toggle="tooltip" data-placement="top" rel="external nofollow noopener noreferrer"><i class="icon icon-twitter"></i></a></li><li><a href="https://www.behance.net/cofess" target="_blank" title="Behance" data-toggle="tooltip" data-placement="top" rel="external nofollow noopener noreferrer"><i class="icon icon-behance"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">å…¬å‘Š</h3><div class="widget-body"><div id="board"><div class="content"><p>äººå¤„åœ¨ä¸€ç§é»˜é»˜å¥‹æ–—çš„çŠ¶æ€ï¼Œç²¾ç¥å°±ä¼šä»çç¢ç”Ÿæ´»ä¸­å¾—åˆ°å‡å</p></div></div></div></div><div class="widget"><h3 class="widget-title">åˆ†ç±»</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/DataBase/">DataBase</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DataBases/">DataBases</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NLP/">NLP</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">åˆ†å¸ƒå¼</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">å¤§æ•°æ®</a><span class="category-list-count">111</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">å·¥å…·</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/">å¼€å‘å·¥å…·</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">æ•°æ®ç»“æ„</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">æœºå™¨å­¦ä¹ </a><span class="category-list-count">31</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84/">æ¶æ„</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">æ·±åº¦å­¦ä¹ </a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BA%90%E7%A0%81%E7%B3%BB%E5%88%97/">æºç ç³»åˆ—</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">ç®—æ³•</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/">è®¡ç®—æœºç»„æˆåŸç†</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">è®¾è®¡æ¨¡å¼</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">æ ‡ç­¾</h3><div class="widget-body"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apriori/" rel="tag">Apriori</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/COS/" rel="tag">COS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CPU/" rel="tag">CPU</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DMP/" rel="tag">DMP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Decision-Tree/" rel="tag">Decision Tree</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EM/" rel="tag">EM</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ETL/" rel="tag">ETL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flink/" rel="tag">Flink</a><span class="tag-list-count">33</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GPT-2/" rel="tag">GPT-2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HBase/" rel="tag">HBase</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HashMap/" rel="tag">HashMap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hive/" rel="tag">Hive</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDEA/" rel="tag">IDEA</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/K-Means/" rel="tag">K-Means</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KNN/" rel="tag">KNN</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LRU%E6%B7%98%E6%B1%B0%E7%AE%97%E6%B3%95/" rel="tag">LRUæ·˜æ±°ç®—æ³•</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Naive-Bayes/" rel="tag">Naive Bayes</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OLAP/" rel="tag">OLAP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PageRank/" rel="tag">PageRank</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Parquet/" rel="tag">Parquet</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Random-Forest/" rel="tag">Random Forest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SVM/" rel="tag">SVM</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/" rel="tag">flask</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flink/" rel="tag">flink</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hdfs/" rel="tag">hdfs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/" rel="tag">hive</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/" rel="tag">kafka</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kali/" rel="tag">kali</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mapreduce/" rel="tag">mapreduce</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/paxos/" rel="tag">paxos</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala/" rel="tag">scala</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shadowsock/" rel="tag">shadowsock</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/skipList/" rel="tag">skipList</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sklearn/" rel="tag">sklearn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/" rel="tag">spark</a><span class="tag-list-count">29</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yarn/" rel="tag">yarn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/" rel="tag">äºŒåˆ†æŸ¥æ‰¾</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/" rel="tag">äºŒå‰æ ‘</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" rel="tag">åŠ¨æ€è§„åˆ’</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" rel="tag">å•ä¾‹æ¨¡å¼</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%9E%E6%BA%AF/" rel="tag">å›æº¯</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A0%86/" rel="tag">å †</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/" rel="tag">å¸ƒéš†è¿‡æ»¤å™¨</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F/" rel="tag">æ’åº</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%A3%E5%88%97%E8%A1%A8/" rel="tag">æ•£åˆ—è¡¨</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/" rel="tag">æ•°æ®ä»“åº“</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97/" rel="tag">æ•°æ®æ¸…æ´—</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/" rel="tag">æ•°æ®é‡‡é›†</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E7%BB%84/" rel="tag">æ•°ç»„</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97/" rel="tag">æ—¶é—´åºåˆ—</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8/" rel="tag">æœåŠ¡å™¨å®‰å…¨</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%88/" rel="tag">æ ˆ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="tag">æ·±åº¦å­¦ä¹ </a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">çˆ¬è™«</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/" rel="tag">ç‰¹å¾å·¥ç¨‹</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%A8%E6%88%B7%E7%94%BB%E5%83%8F/" rel="tag">ç”¨æˆ·ç”»åƒ</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%A2%E9%BB%91%E6%A0%91/" rel="tag">çº¢é»‘æ ‘</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E6%80%A7%E8%A1%A8/" rel="tag">çº¿æ€§è¡¨</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%8D%E5%90%91%E9%87%8F/" rel="tag">è¯å‘é‡</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%92%E5%BD%92/" rel="tag">é€’å½’</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/" rel="tag">é€»è¾‘å›å½’</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%93%BE%E8%A1%A8/" rel="tag">é“¾è¡¨</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%98%9F%E5%88%97/" rel="tag">é˜Ÿåˆ—</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">æ ‡ç­¾äº‘</h3><div class="widget-body tagcloud"><a href="/tags/Apriori/" style="font-size:13.11px">Apriori</a> <a href="/tags/COS/" style="font-size:13px">COS</a> <a href="/tags/CPU/" style="font-size:13px">CPU</a> <a href="/tags/DMP/" style="font-size:13px">DMP</a> <a href="/tags/Decision-Tree/" style="font-size:13.44px">Decision Tree</a> <a href="/tags/EM/" style="font-size:13.11px">EM</a> <a href="/tags/ETL/" style="font-size:13px">ETL</a> <a href="/tags/Flink/" style="font-size:14px">Flink</a> <a href="/tags/GPT-2/" style="font-size:13px">GPT-2</a> <a href="/tags/HBase/" style="font-size:13.56px">HBase</a> <a href="/tags/HashMap/" style="font-size:13px">HashMap</a> <a href="/tags/Hive/" style="font-size:13px">Hive</a> <a href="/tags/IDEA/" style="font-size:13px">IDEA</a> <a href="/tags/K-Means/" style="font-size:13px">K-Means</a> <a href="/tags/KNN/" style="font-size:13.11px">KNN</a> <a href="/tags/LRU%E6%B7%98%E6%B1%B0%E7%AE%97%E6%B3%95/" style="font-size:13px">LRUæ·˜æ±°ç®—æ³•</a> <a href="/tags/Naive-Bayes/" style="font-size:13.11px">Naive Bayes</a> <a href="/tags/OLAP/" style="font-size:13px">OLAP</a> <a href="/tags/PageRank/" style="font-size:13.11px">PageRank</a> <a href="/tags/Parquet/" style="font-size:13px">Parquet</a> <a href="/tags/Random-Forest/" style="font-size:13px">Random Forest</a> <a href="/tags/SVM/" style="font-size:13.11px">SVM</a> <a href="/tags/docker/" style="font-size:13.11px">docker</a> <a href="/tags/flask/" style="font-size:13.11px">flask</a> <a href="/tags/flink/" style="font-size:13px">flink</a> <a href="/tags/hdfs/" style="font-size:13.33px">hdfs</a> <a href="/tags/hive/" style="font-size:13.44px">hive</a> <a href="/tags/java/" style="font-size:13px">java</a> <a href="/tags/kafka/" style="font-size:13.67px">kafka</a> <a href="/tags/kali/" style="font-size:13px">kali</a> <a href="/tags/mapreduce/" style="font-size:13.11px">mapreduce</a> <a href="/tags/mysql/" style="font-size:13.22px">mysql</a> <a href="/tags/paxos/" style="font-size:13.11px">paxos</a> <a href="/tags/python/" style="font-size:13.56px">python</a> <a href="/tags/redis/" style="font-size:13.33px">redis</a> <a href="/tags/scala/" style="font-size:13.33px">scala</a> <a href="/tags/shadowsock/" style="font-size:13px">shadowsock</a> <a href="/tags/skipList/" style="font-size:13px">skipList</a> <a href="/tags/sklearn/" style="font-size:13px">sklearn</a> <a href="/tags/spark/" style="font-size:13.89px">spark</a> <a href="/tags/yarn/" style="font-size:13px">yarn</a> <a href="/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/" style="font-size:13.11px">äºŒåˆ†æŸ¥æ‰¾</a> <a href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/" style="font-size:13.22px">äºŒå‰æ ‘</a> <a href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" style="font-size:13px">åŠ¨æ€è§„åˆ’</a> <a href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" style="font-size:13px">å•ä¾‹æ¨¡å¼</a> <a href="/tags/%E5%9B%9E%E6%BA%AF/" style="font-size:13px">å›æº¯</a> <a href="/tags/%E5%A0%86/" style="font-size:13px">å †</a> <a href="/tags/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/" style="font-size:13px">å¸ƒéš†è¿‡æ»¤å™¨</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size:13.78px">æ’åº</a> <a href="/tags/%E6%95%A3%E5%88%97%E8%A1%A8/" style="font-size:13px">æ•£åˆ—è¡¨</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/" style="font-size:13.78px">æ•°æ®ä»“åº“</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97/" style="font-size:13px">æ•°æ®æ¸…æ´—</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/" style="font-size:13px">æ•°æ®é‡‡é›†</a> <a href="/tags/%E6%95%B0%E7%BB%84/" style="font-size:13px">æ•°ç»„</a> <a href="/tags/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97/" style="font-size:13px">æ—¶é—´åºåˆ—</a> <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8/" style="font-size:13.11px">æœåŠ¡å™¨å®‰å…¨</a> <a href="/tags/%E6%A0%88/" style="font-size:13px">æ ˆ</a> <a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" style="font-size:13px">æ·±åº¦å­¦ä¹ </a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size:13px">çˆ¬è™«</a> <a href="/tags/%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/" style="font-size:13.33px">ç‰¹å¾å·¥ç¨‹</a> <a href="/tags/%E7%94%A8%E6%88%B7%E7%94%BB%E5%83%8F/" style="font-size:13.11px">ç”¨æˆ·ç”»åƒ</a> <a href="/tags/%E7%BA%A2%E9%BB%91%E6%A0%91/" style="font-size:13px">çº¢é»‘æ ‘</a> <a href="/tags/%E7%BA%BF%E6%80%A7%E8%A1%A8/" style="font-size:13px">çº¿æ€§è¡¨</a> <a href="/tags/%E8%AF%8D%E5%90%91%E9%87%8F/" style="font-size:13px">è¯å‘é‡</a> <a href="/tags/%E9%80%92%E5%BD%92/" style="font-size:13px">é€’å½’</a> <a href="/tags/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/" style="font-size:13px">é€»è¾‘å›å½’</a> <a href="/tags/%E9%93%BE%E8%A1%A8/" style="font-size:13.11px">é“¾è¡¨</a> <a href="/tags/%E9%98%9F%E5%88%97/" style="font-size:13px">é˜Ÿåˆ—</a></div></div><div class="widget"><h3 class="widget-title">å½’æ¡£</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">ä¸€æœˆ 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">åäºŒæœˆ 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">åä¸€æœˆ 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">åæœˆ 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">ä¹æœˆ 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">å…«æœˆ 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">ä¸ƒæœˆ 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">å…­æœˆ 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">äº”æœˆ 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">å››æœˆ 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">ä¸‰æœˆ 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">äºŒæœˆ 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">ä¸€æœˆ 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">åäºŒæœˆ 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">åä¸€æœˆ 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">åæœˆ 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">ä¹æœˆ 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">å…«æœˆ 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">ä¸ƒæœˆ 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">å…­æœˆ 2019</a><span class="archive-list-count">16</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">äº”æœˆ 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">å››æœˆ 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">äºŒæœˆ 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">ä¸€æœˆ 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">åäºŒæœˆ 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">åä¸€æœˆ 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">åæœˆ 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">ä¹æœˆ 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">å…«æœˆ 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">ä¸ƒæœˆ 2018</a><span class="archive-list-count">22</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">å…­æœˆ 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">äº”æœˆ 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">å››æœˆ 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">ä¸‰æœˆ 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">ä¸€æœˆ 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">åæœˆ 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">å…«æœˆ 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">å…­æœˆ 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">äº”æœˆ 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">å››æœˆ 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">ä¸‰æœˆ 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">äºŒæœˆ 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">ä¸€æœˆ 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">åä¸€æœˆ 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">åæœˆ 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">ä¹æœˆ 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">å…«æœˆ 2016</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">ä¹æœˆ 2015</a><span class="archive-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">æœ€æ–°æ–‡ç« </h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">å¤§æ•°æ®</a></p><p class="item-title"><a href="/2021/01/12/Hive-Cli-%E5%90%AF%E5%8A%A8%E5%8D%A1%E6%AD%BB%E7%9A%84%E9%97%AE%E9%A2%98/" class="title">Hive Cli å¯åŠ¨å¡æ­»çš„é—®é¢˜</a></p><p class="item-date"><time datetime="2021-01-12T15:54:22.000Z" itemprop="datePublished">2021-01-12</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E6%BA%90%E7%A0%81%E7%B3%BB%E5%88%97/">æºç ç³»åˆ—</a></p><p class="item-title"><a href="/2020/12/06/MapReduce%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-%E4%B8%80/" class="title">MapReduceæºç è§£æ(ä¸€)</a></p><p class="item-date"><time datetime="2020-12-06T10:15:23.000Z" itemprop="datePublished">2020-12-06</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">å¤§æ•°æ®</a></p><p class="item-title"><a href="/2020/11/29/%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%9B%86%E7%BE%A4%E6%96%B0%E6%A8%A1%E5%BC%8F-%E5%AD%98%E7%AE%97%E5%88%86%E7%A6%BB/" class="title">å¤§æ•°æ®é›†ç¾¤æ–°æ¨¡å¼-å­˜ç®—åˆ†ç¦»</a></p><p class="item-date"><time datetime="2020-11-29T15:02:43.000Z" itemprop="datePublished">2020-11-29</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">å¤§æ•°æ®</a></p><p class="item-title"><a href="/2020/11/21/Flink%E6%B6%88%E8%B4%B9Kafka%E4%BB%A5%E5%8F%8A%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE/" class="title">Flinkæ¶ˆè´¹Kafkaä»¥åŠå‚æ•°è®¾ç½®</a></p><p class="item-date"><time datetime="2020-11-21T10:25:43.000Z" itemprop="datePublished">2020-11-21</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">å¤§æ•°æ®</a></p><p class="item-title"><a href="/2020/11/19/%E5%85%B3%E4%BA%8EHive%E4%B8%AD%E7%9A%84NULL/" class="title">å…³äºHiveä¸­çš„NULL</a></p><p class="item-date"><time datetime="2020-11-18T16:35:14.000Z" itemprop="datePublished">2020-11-19</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="post-æ•°æ®ä»“åº“è¶…è¯¦ç»†æ¡ˆä¾‹" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">æ•°æ®ä»“åº“è¶…è¯¦ç»†æ¡ˆä¾‹</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2020/07/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E8%B6%85%E8%AF%A6%E7%BB%86%E6%A1%88%E4%BE%8B/" class="article-date"><time datetime="2020-07-07T09:17:57.000Z" itemprop="datePublished">2020-07-07</time></a></span> <span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">å¤§æ•°æ®</a></span> <span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link" href="/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/" rel="tag">æ•°æ®ä»“åº“</a></span> <span class="article-read hidden-xs"><i class="icon icon-eye-fill" aria-hidden="true"></i> <span id="/2020/07/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E8%B6%85%E8%AF%A6%E7%BB%86%E6%A1%88%E4%BE%8B/" class="leancloud_visitors" data-flag-title="æ•°æ®ä»“åº“è¶…è¯¦ç»†æ¡ˆä¾‹">0</span></span> <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2020/07/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E8%B6%85%E8%AF%A6%E7%BB%86%E6%A1%88%E4%BE%8B/#comments" class="article-comment-link">è¯„è®º</a></span> <span class="post-wordcount hidden-xs" itemprop="wordCount">å­—æ•°ç»Ÿè®¡: 42.9k(å­—)</span> <span class="post-readcount hidden-xs" itemprop="timeRequired">é˜…è¯»æ—¶é•¿: 230(åˆ†)</span></div></div><div class="article-entry marked-body" itemprop="articleBody"><p>ä»¥ä¸‹è¿™ç¯‡åšå®¢è½¬è½½è‡ª<a href="https://www.cnblogs.com/ttzzyy/p/13255841.html" target="_blank" rel="external nofollow noopener noreferrer">æ•°æ®ä»“åº“æ¡ˆä¾‹</a>ï¼Œå·¨è¯¦ç»†ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘<br><a name="9oBBW"></a></p><h1 id="ç¦»çº¿æ•°æ®ä»“åº“"><a href="#ç¦»çº¿æ•°æ®ä»“åº“" class="headerlink" title="ç¦»çº¿æ•°æ®ä»“åº“"></a>ç¦»çº¿æ•°æ®ä»“åº“</h1><blockquote><p>æ•°æ®ä»“åº“ï¼ˆData WareHouseï¼‰æ˜¯ä¸ºä¼ä¸šæ‰€æœ‰å†³ç­–åˆ¶å®šè¿‡ç¨‹ï¼Œæä¾›æ‰€æœ‰ç³»ç»Ÿæ•°æ®æ”¯æŒçš„æˆ˜ç•¥é›†åˆ<br>é€šè¿‡å¯¹æ•°æ®ä»“åº“ä¸­æ•°æ®çš„åˆ†æï¼Œå¯ä»¥å¸®åŠ©ä¼ä¸šï¼Œæ”¹è¿›ä¸šåŠ¡æµç¨‹ã€æ§åˆ¶ã€æˆæœ¬ã€æé«˜äº§å“è´¨é‡ç­‰<br>æ•°æ®ä»“åº“ï¼Œå¹¶ä¸æ˜¯æ•°æ®æœ€ç»ˆç›®çš„åœ°ï¼Œè€Œæ˜¯ä¸ºæ•°æ®æœ€ç»ˆçš„ç›®çš„åœ°åšå¥½å‡†å¤‡ï¼šæ¸…æ´—ã€è½¬ä¹‰ã€åˆ†ç±»ã€é‡ç»„ã€åˆå¹¶ã€æ‹†åˆ†ã€ç»Ÿè®¡ç­‰ç­‰</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445205-31fdcfc5-e2d2-41a6-b5cc-624c31b3e574.png#align=left&display=inline&height=744&margin=%5Bobject%20Object%5D&originHeight=744&originWidth=1234&size=0&status=done&style=none&width=1234" alt><br><a name="blogTitle0"></a></p><h2 id="1-é¡¹ç›®ç®€ä»‹"><a href="#1-é¡¹ç›®ç®€ä»‹" class="headerlink" title="1 é¡¹ç›®ç®€ä»‹"></a>1 é¡¹ç›®ç®€ä»‹</h2><p><a name="blogTitle1"></a></p><h3 id="1-1-é¡¹ç›®éœ€æ±‚"><a href="#1-1-é¡¹ç›®éœ€æ±‚" class="headerlink" title="1.1 é¡¹ç›®éœ€æ±‚"></a>1.1 é¡¹ç›®éœ€æ±‚</h3><ol><li>ç”¨æˆ·è¡Œä¸ºæ•°æ®é‡‡é›†å¹³å°æ­å»º</li><li>ä¸šåŠ¡æ•°æ®é‡‡é›†å¹³å°æ­å»º</li><li>æ•°æ®ä»“åº“ç»´åº¦å»ºæ¨¡</li><li>åˆ†æï¼šç”¨æˆ·ã€æµé‡ã€ä¼šå‘˜ã€å•†å“ã€é”€å”®ã€åœ°åŒºã€æ´»åŠ¨ç­‰ä¸»é¢˜</li><li>é‡‡ç”¨å³å¸­æŸ¥è¯¢å·¥å…·ï¼Œéšæ—¶è¿›è¡ŒæŒ‡æ ‡åˆ†æ</li><li>å¯¹é›†ç¾¤æ€§èƒ½è¿›è¡Œç›‘æ§ï¼Œå‘ç”Ÿå¼‚å¸¸éœ€è¦æŠ¥è­¦</li><li>å…ƒæ•°æ®ç®¡ç†</li><li>è´¨é‡ç›‘æ§<br><a name="blogTitle2"></a><h3 id="1-2-æŠ€æœ¯é€‰å‹"><a href="#1-2-æŠ€æœ¯é€‰å‹" class="headerlink" title="1.2 æŠ€æœ¯é€‰å‹"></a>1.2 æŠ€æœ¯é€‰å‹</h3></li></ol><ul><li><p>æ•°æ®é‡‡é›†åŠŸèƒ½å¦‚ä½•æŠ€æœ¯é€‰å‹</p><table><thead><tr><th align="center">é‡‡é›†æ¡†æ¶åç§°</th><th>ä¸»è¦åŠŸèƒ½</th></tr></thead><tbody><tr><td align="center">Sqoop</td><td>å¤§æ•°æ®å¹³å°å’Œå…³ç³»å‹æ•°æ®åº“çš„å¯¼å…¥å¯¼å‡º</td></tr><tr><td align="center">Datax</td><td>å¤§æ•°æ®å¹³å°å’Œå…³ç³»å‹æ•°æ®åº“çš„å¯¼å…¥å¯¼å‡º</td></tr><tr><td align="center">flume</td><td>æ“…é•¿æ—¥å¿—æ•°æ®çš„é‡‡é›†å’Œè§£æ</td></tr><tr><td align="center">logstash</td><td>æ“…é•¿æ—¥å¿—æ•°æ®çš„é‡‡é›†å’Œè§£æ</td></tr><tr><td align="center">maxwell</td><td>å¸¸ç”¨ä½œå®æ—¶è§£æmysqlçš„binlogæ•°æ®</td></tr><tr><td align="center">canal</td><td>å¸¸ç”¨ä½œå®æ—¶è§£æmysqlçš„binlogæ•°æ®</td></tr><tr><td align="center">waterDrop</td><td>æ•°æ®å¯¼å…¥å¯¼å‡ºå·¥å…·</td></tr></tbody></table></li><li><p>æ¶ˆæ¯ä¸­é—´ä»¶çš„æŠ€æœ¯é€‰å‹</p><table><thead><tr><th align="center"><strong>å¼€æºMQ</strong></th><th><strong>æ¦‚è¿°</strong></th></tr></thead><tbody><tr><td align="center">RabbitMQ</td><td>LShift ç”¨Erlangå®ç°ï¼Œæ”¯æŒå¤šåè®®ï¼Œbrokeræ¶æ„ï¼Œé‡é‡çº§</td></tr><tr><td align="center">ZeroMQ</td><td>AMQPæœ€åˆè®¾è®¡è€…iMatixå…¬å¸å®ç°ï¼Œè½»é‡æ¶ˆæ¯å†…æ ¸ï¼Œæ— brokerè®¾è®¡ã€‚C++å®ç°</td></tr><tr><td align="center">Kafka</td><td>LinkedInç”¨Scalaè¯­è¨€å®ç°ï¼Œæ”¯æŒhadoopæ•°æ®å¹¶è¡ŒåŠ è½½</td></tr><tr><td align="center">ActiveMQ</td><td>Apachçš„ä¸€ç§JMSå…·ä½“å®ç°ï¼Œæ”¯æŒä»£ç†å’Œp2péƒ¨ç½²ã€‚æ”¯æŒå¤šåè®®ã€‚Javaå®ç°</td></tr><tr><td align="center">Redis</td><td>Key-value NoSQLæ•°æ®åº“ï¼Œæœ‰MQçš„åŠŸèƒ½</td></tr><tr><td align="center">MemcacheQ</td><td>å›½äººåˆ©ç”¨memcacheç¼“å†²é˜Ÿåˆ—åè®®å¼€å‘çš„æ¶ˆæ¯é˜Ÿåˆ—,C/C++å®ç°</td></tr></tbody></table></li><li><p>æ•°æ®æ°¸ä¹…å­˜å‚¨æŠ€æœ¯æ¡†æ¶é€‰å‹</p><table><thead><tr><th align="center">æ¡†æ¶åç§°</th><th>ä¸»è¦ç”¨é€”</th></tr></thead><tbody><tr><td align="center">HDFS</td><td>åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿ</td></tr><tr><td align="center">Hbase</td><td>Keyï¼Œvalueå¯¹çš„nosqlæ•°æ®åº“</td></tr><tr><td align="center">Kudu</td><td>Clouderaå…¬å¸å¼€æºæä¾›çš„ç±»ä¼¼äºHbaseçš„æ•°æ®å­˜å‚¨</td></tr><tr><td align="center">Hive</td><td>åŸºäºMRçš„æ•°æ®ä»“åº“å·¥å…·</td></tr></tbody></table></li><li><p>æ•°æ®ç¦»çº¿è®¡ç®—æ¡†æ¶æŠ€æœ¯é€‰å‹(hiveå¼•æ“)</p><table><thead><tr><th align="center">æ¡†æ¶åç§°</th><th>åŸºæœ¬ä»‹ç»</th></tr></thead><tbody><tr><td align="center">MapReduce</td><td>æœ€æ—©æœŸçš„åˆ†å¸ƒå¼æ–‡ä»¶è®¡ç®—ç³»ç»Ÿ</td></tr><tr><td align="center">Spark</td><td>åŸºäºsparkï¼Œä¸€ç«™å¼è§£å†³æ‰¹æµå¤„ç†é—®é¢˜</td></tr><tr><td align="center">Flink</td><td>åŸºäºflinkï¼Œä¸€ç«™å¼è§£å†³æ‰¹æµå¤„ç†é—®é¢˜</td></tr></tbody></table></li><li><p>åˆ†ææ•°æ®åº“é€‰å‹</p><table><thead><tr><th>å¯¹æ¯”é¡¹ç›®</th><th align="center">Druid</th><th align="center">Kylin</th><th align="center">Presto</th><th align="center">Impala</th><th align="center">ES</th></tr></thead><tbody><tr><td>äºšç§’çº§å“åº”</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">Ã—</td><td align="center">Ã—</td><td align="center">Ã—</td></tr><tr><td>ç™¾äº¿æ•°æ®é›†</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">âˆš</td></tr><tr><td>SQLæ”¯æŒ</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">âˆš(éœ€æ’ä»¶)</td></tr><tr><td>ç¦»çº¿</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">âˆš</td></tr><tr><td>å®æ—¶</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">Ã—</td><td align="center">Ã—</td><td align="center">Ã—</td></tr><tr><td>ç²¾ç¡®å»é‡</td><td align="center">Ã—</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">Ã—</td></tr><tr><td>å¤šè¡¨Join</td><td align="center">Ã—</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">Ã—</td></tr><tr><td>JDBC for BI</td><td align="center">Ã—</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">Ã—</td></tr></tbody></table></li><li><p>å…¶ä»–é€‰å‹</p><ul><li>ä»»åŠ¡è°ƒåº¦ï¼šDolphinScheduler</li><li>é›†ç¾¤ç›‘æ§ï¼šCM+CDH</li><li>å…ƒæ•°æ®ç®¡ç†ï¼šAtlas</li><li>BIå·¥å…·ï¼šZeppelinã€Superset<br><a name="blogTitle3"></a><h3 id="1-3-æ¶æ„"><a href="#1-3-æ¶æ„" class="headerlink" title="1.3 æ¶æ„"></a>1.3 æ¶æ„</h3><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445253-8d922f5c-47b5-4f1d-ad8e-1a71eeae15aa.png#align=left&display=inline&height=736&margin=%5Bobject%20Object%5D&originHeight=736&originWidth=1703&size=0&status=done&style=none&width=1703" alt><br><a name="blogTitle4"></a><h3 id="1-4-é›†ç¾¤èµ„æºè§„åˆ’"><a href="#1-4-é›†ç¾¤èµ„æºè§„åˆ’" class="headerlink" title="1.4 é›†ç¾¤èµ„æºè§„åˆ’"></a>1.4 é›†ç¾¤èµ„æºè§„åˆ’</h3></li></ul></li><li><p>å¦‚ä½•ç¡®è®¤é›†ç¾¤è§„æ¨¡ï¼ˆå‡è®¾æ¯å°æœåŠ¡å™¨8Tç£ç›˜ï¼Œ128Gå†…å­˜ï¼‰</p><ol><li>æ¯å¤©æ—¥æ´»è·ƒç”¨æˆ·100ä¸‡ï¼Œæ¯äººä¸€å¤©å¹³å‡100æ¡ï¼š100ä¸‡ * 100æ¡ = 1äº¿æ¡</li><li>æ¯æ¡æ—¥å¿—1Kå·¦å³ï¼Œæ¯å¤©1ä¸€æ¡ï¼š1äº¿ / 1024 /1024 = çº¦100G</li><li>åŠå¹´å†…ä¸æ‰©å®¹æœåŠ¡å™¨æ¥ç®—ï¼š100G * 180å¤© = çº¦18T</li><li>ä¿å­˜3ä¸ªå‰¯æœ¬ï¼š18T * 3 = 54T</li><li>é¢„ç•™20% ~ 30%BUFï¼š54T / 0.7 = 77T</li><li>æ€»ç»“ï¼šçº¦10å°æœåŠ¡å™¨<blockquote><p>ç”±äºèµ„æºæœ‰é™ï¼Œé‡‡ç”¨3å°è¿›è¡Œåˆ¶ä½œ</p></blockquote></li></ol></li></ul><table><thead><tr><th>æœåŠ¡åç§°</th><th>å­æœåŠ¡</th><th>æœåŠ¡å™¨ cdh01.cm</th><th>æœåŠ¡å™¨ cdh02.cm</th><th>æœåŠ¡å™¨ cdh03.cm</th></tr></thead><tbody><tr><td>HDFS</td><td>NameNode<br>DataNode<br>SecondaryNameNode</td><td>âˆš<br>âˆš</td><td>âˆš</td><td>âˆš<br>âˆš</td></tr><tr><td>Yarn</td><td>NodeManager<br>Resourcemanager</td><td>âˆš</td><td>âˆš<br>âˆš</td><td>âˆš</td></tr><tr><td>Zookeeper</td><td>Zookeeper Server</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Flume</td><td>Flume<br>Flumeï¼ˆæ¶ˆè´¹ Kafkaï¼‰</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Kafka</td><td>Kafka</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Hive</td><td>Hive</td><td>âˆš</td><td></td><td></td></tr><tr><td>MySQL</td><td>MySQL</td><td>âˆš</td><td></td><td></td></tr><tr><td>Sqoop</td><td>Sqoop</td><td>âˆš</td><td></td><td></td></tr><tr><td>Presto</td><td>Coordinator<br>Worker</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>DolphinScheduler</td><td>DolphinScheduler</td><td>âˆš</td><td></td><td></td></tr><tr><td>Druid</td><td>Druid</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Kylin</td><td>Kylin</td><td>âˆš</td><td></td><td></td></tr><tr><td>Hbase</td><td>HMaster<br>HRegionServer</td><td>âˆš<br>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Superset</td><td>Superset</td><td>âˆš</td><td></td><td></td></tr><tr><td>Atlas</td><td>Atlas</td><td>âˆš</td><td></td><td></td></tr><tr><td>Solr</td><td>Solr</td><td>âˆš</td><td></td><td></td></tr></tbody></table><p><a name="blogTitle5"></a></p><h2 id="2-æ•°æ®ç”Ÿæˆæ¨¡å—"><a href="#2-æ•°æ®ç”Ÿæˆæ¨¡å—" class="headerlink" title="2 æ•°æ®ç”Ÿæˆæ¨¡å—"></a>2 æ•°æ®ç”Ÿæˆæ¨¡å—</h2><blockquote><p>æ­¤æ¨¡å—ä¸»è¦é’ˆå¯¹äºç”¨æˆ·è¡Œä¸ºæ•°æ®çš„é‡‡é›†ï¼Œä¸ºä»€ä¹ˆè¦è¿›è¡Œç”¨æˆ·è¡Œä¸ºæ•°æ®çš„é‡‡é›†å‘¢ï¼Ÿ<br>å› ä¸ºå¯¹äºä¼ä¸šæ¥è¯´ï¼Œç”¨æˆ·å°±æ˜¯é’±ï¼Œéœ€è¦å°†ç”¨æˆ·çš„ä¹ æƒ¯ç­‰æ•°æ®è¿›è¡Œé‡‡é›†ï¼Œä»¥ä¾¿åœ¨å¤§æ•°æ®è¡ç”Ÿäº§å“å¦‚ç”¨æˆ·ç”»åƒæ ‡ç­¾ç³»ç»Ÿè¿›è¡Œåˆ†æï¼Œé‚£ä¹ˆä¸€èˆ¬æƒ…å†µä¸‹ç”¨æˆ·çš„ä¿¡æ¯éƒ½æ˜¯ç¦»çº¿åˆ†æçš„ï¼ŒåæœŸæˆ‘ä»¬å¯ä»¥å°†åˆ†æç»“æœå­˜å…¥ESç­‰å€’æ’ç´¢å¼•ç”Ÿæ€ä¸­ï¼Œåœ¨ä½¿ç”¨å®æ—¶è®¡ç®—çš„æ–¹å¼åŒ¹é…ç”¨æˆ·ä¹ æƒ¯ï¼Œè¿›è¡Œå®šåˆ¶åŒ–æ¨èï¼Œæ›´è¿›ä¸€æ­¥çš„æ·±åº¦å­¦ä¹ ï¼Œå¯¹ç›¸ä¼¼ç”¨æˆ·è¿›è¡Œæ¨èã€‚</p></blockquote><p><a name="blogTitle6"></a></p><h3 id="2-1-åŸ‹ç‚¹æ•°æ®åŸºæœ¬æ ¼å¼"><a href="#2-1-åŸ‹ç‚¹æ•°æ®åŸºæœ¬æ ¼å¼" class="headerlink" title="2.1 åŸ‹ç‚¹æ•°æ®åŸºæœ¬æ ¼å¼"></a>2.1 åŸ‹ç‚¹æ•°æ®åŸºæœ¬æ ¼å¼</h3><ul><li><p>å…¬å…±å­—æ®µï¼šåŸºæœ¬æ‰€æœ‰å®‰å“æ‰‹æœºéƒ½åŒ…å«çš„å­—æ®µ<br></p></li><li><p>ä¸šåŠ¡å­—æ®µï¼šåŸ‹ç‚¹ä¸ŠæŠ¥çš„å­—æ®µï¼Œæœ‰å…·ä½“çš„ä¸šåŠ¡ç±»å‹<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;ap&quot;:&quot;xxxxx&quot;,&#x2F;&#x2F;é¡¹ç›®æ•°æ®æ¥æº app pc</span><br><span class="line">&quot;cm&quot;: &#123; &#x2F;&#x2F;å…¬å…±å­—æ®µ</span><br><span class="line">	&quot;mid&quot;: &quot;&quot;, &#x2F;&#x2F; (String) è®¾å¤‡å”¯ä¸€æ ‡è¯†</span><br><span class="line">	&quot;uid&quot;: &quot;&quot;, &#x2F;&#x2F; (String) ç”¨æˆ·æ ‡è¯†</span><br><span class="line">	&quot;vc&quot;: &quot;1&quot;, &#x2F;&#x2F; (String) versionCodeï¼Œç¨‹åºç‰ˆæœ¬å·</span><br><span class="line">	&quot;vn&quot;: &quot;1.0&quot;, &#x2F;&#x2F; (String) versionNameï¼Œç¨‹åºç‰ˆæœ¬å</span><br><span class="line">	&quot;l&quot;: &quot;zh&quot;, &#x2F;&#x2F; (String) language ç³»ç»Ÿè¯­è¨€</span><br><span class="line">	&quot;sr&quot;: &quot;&quot;, &#x2F;&#x2F; (String) æ¸ é“å·ï¼Œåº”ç”¨ä»å“ªä¸ªæ¸ é“æ¥çš„ã€‚</span><br><span class="line">	&quot;os&quot;: &quot;7.1.1&quot;, &#x2F;&#x2F; (String) Android ç³»ç»Ÿç‰ˆæœ¬</span><br><span class="line">	&quot;ar&quot;: &quot;CN&quot;, &#x2F;&#x2F; (String) area åŒºåŸŸ</span><br><span class="line">	&quot;md&quot;: &quot;BBB100-1&quot;, &#x2F;&#x2F; (String) model æ‰‹æœºå‹å·</span><br><span class="line">	&quot;ba&quot;: &quot;blackberry&quot;, &#x2F;&#x2F; (String) brand æ‰‹æœºå“ç‰Œ</span><br><span class="line">	&quot;sv&quot;: &quot;V2.2.1&quot;, &#x2F;&#x2F; (String) sdkVersion</span><br><span class="line">	&quot;g&quot;: &quot;&quot;, &#x2F;&#x2F; (String) gmail</span><br><span class="line">	&quot;hw&quot;: &quot;1620x1080&quot;, &#x2F;&#x2F; (String) heightXwidthï¼Œå±å¹•å®½é«˜</span><br><span class="line">	&quot;t&quot;: &quot;1506047606608&quot;, &#x2F;&#x2F; (String) å®¢æˆ·ç«¯æ—¥å¿—äº§ç”Ÿæ—¶çš„æ—¶é—´</span><br><span class="line">	&quot;nw&quot;: &quot;WIFI&quot;, &#x2F;&#x2F; (String) ç½‘ç»œæ¨¡å¼</span><br><span class="line">	&quot;ln&quot;: 0, &#x2F;&#x2F; (double) lng ç»åº¦</span><br><span class="line">	&quot;la&quot;: 0 &#x2F;&#x2F; (double) lat çº¬åº¦</span><br><span class="line">&#125;,</span><br><span class="line">&quot;et&quot;: [ &#x2F;&#x2F;äº‹ä»¶</span><br><span class="line">	&#123;</span><br><span class="line">	&quot;ett&quot;: &quot;1506047605364&quot;, &#x2F;&#x2F;å®¢æˆ·ç«¯äº‹ä»¶äº§ç”Ÿæ—¶é—´</span><br><span class="line">	&quot;en&quot;: &quot;display&quot;, &#x2F;&#x2F;äº‹ä»¶åç§°</span><br><span class="line">	&quot;kv&quot;: &#123; &#x2F;&#x2F;äº‹ä»¶ç»“æœï¼Œä»¥ key-value å½¢å¼è‡ªè¡Œå®šä¹‰</span><br><span class="line">		&quot;goodsid&quot;: &quot;236&quot;,</span><br><span class="line">		&quot;action&quot;: &quot;1&quot;,</span><br><span class="line">		&quot;extend1&quot;: &quot;1&quot;,</span><br><span class="line">		&quot;place&quot;: &quot;2&quot;,</span><br><span class="line">		&quot;category&quot;: &quot;75&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç¤ºä¾‹æ—¥å¿—ï¼ˆæœåŠ¡å™¨æ—¶é—´æˆ³ | æ—¥å¿—ï¼‰ï¼Œæ—¶é—´æˆ³å¯ä»¥æœ‰æ•ˆåˆ¤å®šç½‘ç»œæœåŠ¡çš„é€šä¿¡æ—¶é•¿ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">1540934156385| &#123;</span><br><span class="line">	&quot;ap&quot;: &quot;gmall&quot;,	&#x2F;&#x2F;æ•°ä»“åº“å</span><br><span class="line">	&quot;cm&quot;: &#123;</span><br><span class="line">	&quot;uid&quot;: &quot;1234&quot;,</span><br><span class="line">	&quot;vc&quot;: &quot;2&quot;,</span><br><span class="line">	&quot;vn&quot;: &quot;1.0&quot;,</span><br><span class="line">	&quot;la&quot;: &quot;EN&quot;,</span><br><span class="line">	&quot;sr&quot;: &quot;&quot;,</span><br><span class="line">	&quot;os&quot;: &quot;7.1.1&quot;,</span><br><span class="line">	&quot;ar&quot;: &quot;CN&quot;,</span><br><span class="line">	&quot;md&quot;: &quot;BBB100-1&quot;,</span><br><span class="line">	&quot;ba&quot;: &quot;blackberry&quot;,</span><br><span class="line">	&quot;sv&quot;: &quot;V2.2.1&quot;,</span><br><span class="line">	&quot;g&quot;: &quot;abc@gmail.com&quot;,</span><br><span class="line">	&quot;hw&quot;: &quot;1620x1080&quot;,</span><br><span class="line">	&quot;t&quot;: &quot;1506047606608&quot;,</span><br><span class="line">	&quot;nw&quot;: &quot;WIFI&quot;,</span><br><span class="line">	&quot;ln&quot;: 0,</span><br><span class="line">        &quot;la&quot;: 0</span><br><span class="line">&#125;,</span><br><span class="line">&quot;et&quot;: [</span><br><span class="line">	&#123;</span><br><span class="line">	&quot;ett&quot;: &quot;1506047605364&quot;, &#x2F;&#x2F;å®¢æˆ·ç«¯äº‹ä»¶äº§ç”Ÿæ—¶é—´</span><br><span class="line">	&quot;en&quot;: &quot;display&quot;, &#x2F;&#x2F;äº‹ä»¶åç§°</span><br><span class="line">	&quot;kv&quot;: &#123; &#x2F;&#x2F;äº‹ä»¶ç»“æœï¼Œä»¥ key-value å½¢å¼è‡ªè¡Œå®šä¹‰</span><br><span class="line">		&quot;goodsid&quot;: &quot;236&quot;,</span><br><span class="line">		&quot;action&quot;: &quot;1&quot;,</span><br><span class="line">		&quot;extend1&quot;: &quot;1&quot;,</span><br><span class="line">		&quot;place&quot;: &quot;2&quot;,</span><br><span class="line">		&quot;category&quot;: &quot;75&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,&#123;</span><br><span class="line">	&quot;ett&quot;: &quot;1552352626835&quot;,</span><br><span class="line">	&quot;en&quot;: &quot;active_background&quot;,</span><br><span class="line">	&quot;kv&quot;: &#123;</span><br><span class="line">		&quot;active_source&quot;: &quot;1&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="blogTitle7"></a></p><h3 id="2-2-åŸ‹ç‚¹äº‹ä»¶æ—¥å¿—æ•°æ®"><a href="#2-2-åŸ‹ç‚¹äº‹ä»¶æ—¥å¿—æ•°æ®" class="headerlink" title="2.2 åŸ‹ç‚¹äº‹ä»¶æ—¥å¿—æ•°æ®"></a>2.2 åŸ‹ç‚¹äº‹ä»¶æ—¥å¿—æ•°æ®</h3><p><a name="bfe09d0c"></a></p><h4 id="2-2-1-å•†å“åˆ—è¡¨é¡µ"><a href="#2-2-1-å•†å“åˆ—è¡¨é¡µ" class="headerlink" title="2.2.1 å•†å“åˆ—è¡¨é¡µ"></a>2.2.1 å•†å“åˆ—è¡¨é¡µ</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445220-53833589-bf8f-44b6-8c7b-465e87e1e711.png#align=left&display=inline&height=836&margin=%5Bobject%20Object%5D&originHeight=836&originWidth=482&size=0&status=done&style=none&width=482" alt></p></li><li><p>äº‹ä»¶åç§°ï¼šloading</p><table><thead><tr><th>æ ‡ç­¾</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>action</td><td>åŠ¨ä½œï¼šå¼€å§‹åŠ è½½=1ï¼ŒåŠ è½½æˆåŠŸ=2ï¼ŒåŠ è½½å¤±è´¥=3</td></tr><tr><td>loading_time</td><td>åŠ è½½æ—¶é•¿ï¼šè®¡ç®—ä¸‹æ‹‰å¼€å§‹åˆ°æ¥å£è¿”å›æ•°æ®çš„æ—¶é—´ï¼Œï¼ˆå¼€å§‹åŠ è½½æŠ¥ 0ï¼ŒåŠ è½½æˆ åŠŸæˆ–åŠ è½½å¤±è´¥æ‰ä¸ŠæŠ¥æ—¶é—´ï¼‰</td></tr><tr><td>loading_way</td><td>åŠ è½½ç±»å‹ï¼š1-è¯»å–ç¼“å­˜ï¼Œ2-ä»æ¥å£æ‹‰æ–°æ•°æ® ï¼ˆåŠ è½½æˆåŠŸæ‰ä¸ŠæŠ¥åŠ è½½ç±»å‹ï¼‰</td></tr><tr><td>extend1</td><td>æ‰©å±•å­—æ®µ Extend1</td></tr><tr><td>extend2</td><td>æ‰©å±•å­—æ®µ Extend2</td></tr><tr><td>type</td><td>åŠ è½½ç±»å‹ï¼šè‡ªåŠ¨åŠ è½½=1ï¼Œç”¨æˆ·ä¸‹æ‹½åŠ è½½=2ï¼Œåº•éƒ¨åŠ è½½=3ï¼ˆåº•éƒ¨æ¡è§¦å‘ç‚¹å‡»åº•éƒ¨æç¤ºæ¡/ç‚¹å‡»è¿”å›é¡¶éƒ¨åŠ è½½ï¼‰</td></tr><tr><td>type1</td><td>åŠ è½½å¤±è´¥ç ï¼šæŠŠåŠ è½½å¤±è´¥çŠ¶æ€ç æŠ¥å›æ¥ï¼ˆæŠ¥ç©ºä¸ºåŠ è½½æˆåŠŸï¼Œæ²¡æœ‰å¤±è´¥ï¼‰</td></tr></tbody></table></li></ul><p><a name="ee4b4b36"></a></p><h4 id="2-2-2-å•†å“ç‚¹å‡»"><a href="#2-2-2-å•†å“ç‚¹å‡»" class="headerlink" title="2.2.2 å•†å“ç‚¹å‡»"></a>2.2.2 å•†å“ç‚¹å‡»</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445213-0bbd34e0-bb23-4e03-b90e-3ca09d0c5569.png#align=left&display=inline&height=838&margin=%5Bobject%20Object%5D&originHeight=838&originWidth=499&size=0&status=done&style=none&width=499" alt></p><ul><li>äº‹ä»¶æ ‡ç­¾ï¼šdisplay<table><thead><tr><th>æ ‡ç­¾</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>action</td><td>åŠ¨ä½œï¼šæ›å…‰å•†å“=1ï¼Œç‚¹å‡»å•†å“=2</td></tr><tr><td>goodsid</td><td>å•†å“ IDï¼ˆæœåŠ¡ç«¯ä¸‹å‘çš„ IDï¼‰</td></tr><tr><td>place</td><td>é¡ºåºï¼ˆç¬¬å‡ æ¡å•†å“ï¼Œç¬¬ä¸€æ¡ä¸º 0ï¼Œç¬¬äºŒæ¡ä¸º 1ï¼Œå¦‚æ­¤ç±»æ¨ï¼‰</td></tr><tr><td>extend1</td><td>æ›å…‰ç±»å‹ï¼š1 - é¦–æ¬¡æ›å…‰ 2-é‡å¤æ›å…‰</td></tr><tr><td>category</td><td>åˆ†ç±» IDï¼ˆæœåŠ¡ç«¯å®šä¹‰çš„åˆ†ç±» IDï¼‰</td></tr></tbody></table></li></ul><p><a name="16ea94b9"></a></p><h4 id="2-2-3-å•†å“è¯¦æƒ…é¡µ"><a href="#2-2-3-å•†å“è¯¦æƒ…é¡µ" class="headerlink" title="2.2.3 å•†å“è¯¦æƒ…é¡µ"></a>2.2.3 å•†å“è¯¦æƒ…é¡µ</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445268-6588114c-b79a-4e79-8763-250f838f3536.png#align=left&display=inline&height=711&margin=%5Bobject%20Object%5D&originHeight=711&originWidth=493&size=0&status=done&style=none&width=493" alt></p><ul><li>äº‹ä»¶æ ‡ç­¾ï¼šnewsdetail<table><thead><tr><th>æ ‡ç­¾</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>entry</td><td>é¡µé¢å…¥å£æ¥æºï¼šåº”ç”¨é¦–é¡µ=1ã€push=2ã€è¯¦æƒ…é¡µç›¸å…³æ¨è=3</td></tr><tr><td>action</td><td>åŠ¨ä½œï¼šå¼€å§‹åŠ è½½=1ï¼ŒåŠ è½½æˆåŠŸ=2ï¼ˆpvï¼‰ï¼ŒåŠ è½½å¤±è´¥=3, é€€å‡ºé¡µé¢=4</td></tr><tr><td>goodsid</td><td>å•†å“ IDï¼ˆæœåŠ¡ç«¯ä¸‹å‘çš„ IDï¼‰</td></tr><tr><td>show_style</td><td>å•†å“æ ·å¼ï¼š0ã€æ— å›¾ã€1ã€ä¸€å¼ å¤§å›¾ã€2ã€ä¸¤å¼ å›¾ã€3ã€ä¸‰å¼ å°å›¾ã€4ã€ä¸€å¼ å°å›¾ã€ 5ã€ä¸€å¼ å¤§å›¾ä¸¤å¼ å°å›¾</td></tr><tr><td>news_staytime</td><td>é¡µé¢åœç•™æ—¶é•¿ï¼šä»å•†å“å¼€å§‹åŠ è½½æ—¶å¼€å§‹è®¡ç®—ï¼Œåˆ°ç”¨æˆ·å…³é—­é¡µé¢æ‰€ç”¨çš„æ—¶é—´ã€‚ è‹¥ä¸­é€”ç”¨è·³è½¬åˆ°å…¶å®ƒé¡µé¢äº†ï¼Œåˆ™æš‚åœè®¡æ—¶ï¼Œå¾…å›åˆ°è¯¦æƒ…é¡µæ—¶æ¢å¤è®¡æ—¶ã€‚æˆ–ä¸­ é€”åˆ’å‡ºçš„æ—¶é—´è¶…è¿‡ 10 åˆ†é’Ÿï¼Œåˆ™æœ¬æ¬¡è®¡æ—¶ä½œåºŸï¼Œä¸ä¸ŠæŠ¥æœ¬æ¬¡æ•°æ®ã€‚å¦‚æœªåŠ è½½æˆ åŠŸé€€å‡ºï¼Œåˆ™æŠ¥ç©ºã€‚</td></tr><tr><td>loading_time</td><td>åŠ è½½æ—¶é•¿ï¼šè®¡ç®—é¡µé¢å¼€å§‹åŠ è½½åˆ°æ¥å£è¿”å›æ•°æ®çš„æ—¶é—´ ï¼ˆå¼€å§‹åŠ è½½æŠ¥ 0ï¼ŒåŠ è½½ æˆåŠŸæˆ–åŠ è½½å¤±è´¥æ‰ä¸ŠæŠ¥æ—¶é—´ï¼‰</td></tr><tr><td>type1</td><td>åŠ è½½å¤±è´¥ç ï¼šæŠŠåŠ è½½å¤±è´¥çŠ¶æ€ç æŠ¥å›æ¥ï¼ˆæŠ¥ç©ºä¸ºåŠ è½½æˆåŠŸï¼Œæ²¡æœ‰å¤±è´¥ï¼‰</td></tr><tr><td>category</td><td>åˆ†ç±» IDï¼ˆæœåŠ¡ç«¯å®šä¹‰çš„åˆ†ç±» IDï¼‰</td></tr></tbody></table></li></ul><p><a name="571b8d48"></a></p><h4 id="2-2-4-å¹¿å‘Š"><a href="#2-2-4-å¹¿å‘Š" class="headerlink" title="2.2.4 å¹¿å‘Š"></a>2.2.4 å¹¿å‘Š</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445229-1c9049ba-ee68-4f5c-ad71-bba666fde424.png#align=left&display=inline&height=858&margin=%5Bobject%20Object%5D&originHeight=858&originWidth=513&size=0&status=done&style=none&width=513" alt></p><ul><li>äº‹ä»¶åç§°ï¼šad<table><thead><tr><th>æ ‡ç­¾</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>entry</td><td>å…¥å£ï¼šå•†å“åˆ—è¡¨é¡µ=1 åº”ç”¨é¦–é¡µ=2 å•†å“è¯¦æƒ…é¡µ=3</td></tr><tr><td>action</td><td>åŠ¨ä½œï¼š å¹¿å‘Šå±•ç¤º=1 å¹¿å‘Šç‚¹å‡»=2</td></tr><tr><td>contentType</td><td>Type: 1 å•†å“ 2 è¥é”€æ´»åŠ¨</td></tr><tr><td>displayMills</td><td>å±•ç¤ºæ—¶é•¿ æ¯«ç§’æ•°</td></tr><tr><td>itemId</td><td>å•†å“ id</td></tr><tr><td>activityId</td><td>è¥é”€æ´»åŠ¨ id</td></tr></tbody></table></li></ul><p><a name="23c440b4"></a></p><h4 id="2-2-5-æ¶ˆæ¯é€šçŸ¥"><a href="#2-2-5-æ¶ˆæ¯é€šçŸ¥" class="headerlink" title="2.2.5 æ¶ˆæ¯é€šçŸ¥"></a>2.2.5 æ¶ˆæ¯é€šçŸ¥</h4><ul><li>äº‹ä»¶æ ‡ç­¾ï¼šnotification<table><thead><tr><th>æ ‡ç­¾</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>action</td><td>åŠ¨ä½œï¼šé€šçŸ¥äº§ç”Ÿ=1ï¼Œé€šçŸ¥å¼¹å‡º=2ï¼Œé€šçŸ¥ç‚¹å‡»=3ï¼Œå¸¸é©»é€šçŸ¥å±•ç¤ºï¼ˆä¸é‡å¤ä¸Š æŠ¥ï¼Œä¸€å¤©ä¹‹å†…åªæŠ¥ä¸€æ¬¡ï¼‰=4</td></tr><tr><td>type</td><td>é€šçŸ¥ idï¼šé¢„è­¦é€šçŸ¥=1ï¼Œå¤©æ°”é¢„æŠ¥ï¼ˆæ—©=2ï¼Œæ™š=3ï¼‰ï¼Œå¸¸é©»=4</td></tr><tr><td>ap_time</td><td>å®¢æˆ·ç«¯å¼¹å‡ºæ—¶é—´</td></tr><tr><td>content</td><td>å¤‡ç”¨å­—æ®µ</td></tr></tbody></table></li></ul><p><a name="409b258a"></a></p><h4 id="2-2-6-ç”¨æˆ·åå°æ´»è·ƒ"><a href="#2-2-6-ç”¨æˆ·åå°æ´»è·ƒ" class="headerlink" title="2.2.6 ç”¨æˆ·åå°æ´»è·ƒ"></a>2.2.6 ç”¨æˆ·åå°æ´»è·ƒ</h4><ul><li>äº‹ä»¶æ ‡ç­¾: active_background<table><thead><tr><th>æ ‡ç­¾</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>active_source</td><td>1=upgrade,2=download(ä¸‹è½½),3=plugin_upgrade</td></tr></tbody></table></li></ul><p><a name="d3d9a6ee"></a></p><h4 id="2-2-7-è¯„è®º"><a href="#2-2-7-è¯„è®º" class="headerlink" title="2.2.7 è¯„è®º"></a>2.2.7 è¯„è®º</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445234-c1ea35e6-d731-485d-9f74-e1eccba7431e.png#align=left&display=inline&height=894&margin=%5Bobject%20Object%5D&originHeight=894&originWidth=537&size=0&status=done&style=none&width=537" alt></p><ul><li>æè¿°ï¼šè¯„è®ºè¡¨ï¼ˆcommentï¼‰<table><thead><tr><th align="center">åºå·</th><th>å­—æ®µåç§°</th><th>å­—æ®µæè¿°</th><th align="center">å­—æ®µç±»å‹</th><th align="center">é•¿åº¦</th><th align="center">å…è®¸ç©º</th><th align="center">ç¼ºçœå€¼</th></tr></thead><tbody><tr><td align="center">1</td><td>comment_id</td><td>è¯„è®ºè¡¨</td><td align="center">int</td><td align="center">10,0</td><td align="center"></td><td align="center"></td></tr><tr><td align="center">2</td><td>userid</td><td>ç”¨æˆ· id</td><td align="center">int</td><td align="center">10,0</td><td align="center">âˆš</td><td align="center">0</td></tr><tr><td align="center">3</td><td>p_comment_id</td><td>çˆ¶çº§è¯„è®º id(ä¸º 0 åˆ™æ˜¯<br>ä¸€çº§è¯„è®º,ä¸ ä¸º 0 åˆ™æ˜¯å›å¤)</td><td align="center">int</td><td align="center">10,0</td><td align="center">âˆš</td><td align="center"></td></tr><tr><td align="center">4</td><td>content</td><td>è¯„è®ºå†…å®¹</td><td align="center">string</td><td align="center">1000</td><td align="center">âˆš</td><td align="center"></td></tr><tr><td align="center">5</td><td>addtime</td><td>åˆ›å»ºæ—¶é—´</td><td align="center">string</td><td align="center"></td><td align="center">âˆš</td><td align="center"></td></tr><tr><td align="center">6</td><td>other_id</td><td>è¯„è®ºçš„ç›¸å…³ id</td><td align="center">int</td><td align="center">10,0</td><td align="center">âˆš</td><td align="center"></td></tr><tr><td align="center">7</td><td>praise_count</td><td>ç‚¹èµæ•°é‡</td><td align="center">int</td><td align="center">10,0</td><td align="center">âˆš</td><td align="center">0</td></tr><tr><td align="center">8</td><td>reply_count</td><td>å›å¤æ•°é‡</td><td align="center">int</td><td align="center">10,0</td><td align="center">âˆš</td><td align="center">0</td></tr></tbody></table></li></ul><p><a name="aa37918b"></a></p><h4 id="2-2-8-æ”¶è—"><a href="#2-2-8-æ”¶è—" class="headerlink" title="2.2.8 æ”¶è—"></a>2.2.8 æ”¶è—</h4><ul><li>æè¿°ï¼šæ”¶è—ï¼ˆfavoritesï¼‰<table><thead><tr><th align="center">åºå·</th><th>å­—æ®µåç§°</th><th>å­—æ®µæè¿°</th><th align="center">å­—æ®µç±»å‹</th><th align="center">é•¿åº¦</th><th align="center">å…è®¸ç©º</th><th align="center">ç¼ºçœå€¼</th></tr></thead><tbody><tr><td align="center">1</td><td>id</td><td>ä¸»é”®</td><td align="center">int</td><td align="center">10,0</td><td align="center"></td><td align="center"></td></tr><tr><td align="center">2</td><td>course_id</td><td>å•†å“ id</td><td align="center">int</td><td align="center">10,0</td><td align="center">âˆš</td><td align="center">0</td></tr><tr><td align="center">3</td><td>userid</td><td>ç”¨æˆ· ID</td><td align="center">int</td><td align="center">10,0</td><td align="center">âˆš</td><td align="center">0</td></tr><tr><td align="center">4</td><td>add_time</td><td>åˆ›å»ºæ—¶é—´</td><td align="center">string</td><td align="center"></td><td align="center">âˆš</td><td align="center"></td></tr></tbody></table></li></ul><p><a name="2407bbc4"></a></p><h4 id="2-2-9-ç‚¹èµ"><a href="#2-2-9-ç‚¹èµ" class="headerlink" title="2.2.9 ç‚¹èµ"></a>2.2.9 ç‚¹èµ</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445204-a4518660-4192-4dc1-b934-848b40a364d9.png#align=left&display=inline&height=772&margin=%5Bobject%20Object%5D&originHeight=772&originWidth=493&size=0&status=done&style=none&width=493" alt></p><ul><li>æè¿°ï¼šæ‰€æœ‰çš„ç‚¹èµè¡¨ï¼ˆpraiseï¼‰<table><thead><tr><th align="center">åºå·</th><th>å­—æ®µåç§°</th><th>å­—æ®µæè¿°</th><th align="center">å­—æ®µç±»å‹</th><th align="center">é•¿åº¦</th><th align="center">å…è®¸ç©º</th><th align="center">ç¼ºçœå€¼</th></tr></thead><tbody><tr><td align="center">1</td><td>id</td><td>ä¸»é”® id</td><td align="center">int</td><td align="center">10,0</td><td align="center"></td><td align="center"></td></tr><tr><td align="center">2</td><td>userid</td><td>ç”¨æˆ· id</td><td align="center">int</td><td align="center">10,0</td><td align="center">âˆš</td><td align="center"></td></tr><tr><td align="center">3</td><td>target_id</td><td>ç‚¹èµçš„å¯¹è±¡ id</td><td align="center">int</td><td align="center">10,0</td><td align="center">âˆš</td><td align="center"></td></tr><tr><td align="center">4</td><td>type</td><td>åˆ›å»ºç‚¹èµç±»å‹ï¼š1é—®ç­”ç‚¹èµ 2é—®ç­”è¯„è®ºç‚¹èµ<br>3æ–‡ç« ç‚¹èµæ•° 4è¯„è®ºç‚¹èµ</td><td align="center">int</td><td align="center">10,0</td><td align="center">âˆš</td><td align="center"></td></tr><tr><td align="center">5</td><td>add_time</td><td>æ·»åŠ æ—¶é—´</td><td align="center">string</td><td align="center"></td><td align="center">âˆš</td><td align="center"></td></tr></tbody></table></li></ul><p><a name="f4f90cd0"></a></p><h4 id="2-2-10-é”™è¯¯æ—¥å¿—"><a href="#2-2-10-é”™è¯¯æ—¥å¿—" class="headerlink" title="2.2.10 é”™è¯¯æ—¥å¿—"></a>2.2.10 é”™è¯¯æ—¥å¿—</h4><table><thead><tr><th align="center"><strong>errorBrief</strong></th><th align="center"><strong>é”™è¯¯æ‘˜è¦</strong></th></tr></thead><tbody><tr><td align="center"><strong>errorBrief</strong></td><td align="center"><strong>é”™è¯¯è¯¦æƒ…</strong></td></tr></tbody></table><p><a name="blogTitle8"></a></p><h3 id="2-3-åŸ‹ç‚¹å¯åŠ¨æ—¥å¿—æ•°æ®"><a href="#2-3-åŸ‹ç‚¹å¯åŠ¨æ—¥å¿—æ•°æ®" class="headerlink" title="2.3 åŸ‹ç‚¹å¯åŠ¨æ—¥å¿—æ•°æ®"></a>2.3 åŸ‹ç‚¹å¯åŠ¨æ—¥å¿—æ•°æ®</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;action&quot;:&quot;1&quot;,</span><br><span class="line">	&quot;ar&quot;:&quot;MX&quot;,</span><br><span class="line">	&quot;ba&quot;:&quot;HTC&quot;,</span><br><span class="line">	&quot;detail&quot;:&quot;&quot;,</span><br><span class="line">	&quot;en&quot;:&quot;start&quot;,</span><br><span class="line">	&quot;entry&quot;:&quot;2&quot;,</span><br><span class="line">	&quot;extend1&quot;:&quot;&quot;,</span><br><span class="line">	&quot;g&quot;:&quot;43R2SEQX@gmail.com&quot;,</span><br><span class="line">	&quot;hw&quot;:&quot;640*960&quot;,</span><br><span class="line">	&quot;l&quot;:&quot;en&quot;,</span><br><span class="line">	&quot;la&quot;:&quot;20.4&quot;,</span><br><span class="line">	&quot;ln&quot;:&quot;-99.3&quot;,</span><br><span class="line">	&quot;loading_time&quot;:&quot;2&quot;,</span><br><span class="line">	&quot;md&quot;:&quot;HTC-2&quot;,</span><br><span class="line">	&quot;mid&quot;:&quot;995&quot;,</span><br><span class="line">	&quot;nw&quot;:&quot;4G&quot;,</span><br><span class="line">	&quot;open_ad_type&quot;:&quot;2&quot;,</span><br><span class="line">	&quot;os&quot;:&quot;8.1.2&quot;,</span><br><span class="line">	&quot;sr&quot;:&quot;B&quot;,</span><br><span class="line">	&quot;sv&quot;:&quot;V2.0.6&quot;,</span><br><span class="line">	&quot;t&quot;:&quot;1561472502444&quot;,</span><br><span class="line">	&quot;uid&quot;:&quot;995&quot;,</span><br><span class="line">	&quot;vc&quot;:&quot;10&quot;,</span><br><span class="line">	&quot;vn&quot;:&quot;1.3.4&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>äº‹ä»¶æ ‡ç­¾: start<table><thead><tr><th>æ ‡ç­¾</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>entry</td><td>å…¥ å£ ï¼š push=1 ï¼Œ widget=2 ï¼Œ icon=3 ï¼Œ notification=4, lockscreen_widget =5</td></tr><tr><td>open_ad_type</td><td>å¼€å±å¹¿å‘Šç±»å‹: å¼€å±åŸç”Ÿå¹¿å‘Š=1, å¼€å±æ’å±å¹¿å‘Š=2</td></tr><tr><td>action</td><td>çŠ¶æ€ï¼šæˆåŠŸ=1 å¤±è´¥=2</td></tr><tr><td>loading_time</td><td>åŠ è½½æ—¶é•¿ï¼šè®¡ç®—ä¸‹æ‹‰å¼€å§‹åˆ°æ¥å£è¿”å›æ•°æ®çš„æ—¶é—´ï¼Œï¼ˆå¼€å§‹åŠ è½½æŠ¥ 0ï¼ŒåŠ è½½æˆ åŠŸæˆ–åŠ è½½å¤±è´¥æ‰ä¸ŠæŠ¥æ—¶é—´ï¼‰</td></tr><tr><td>detail</td><td>å¤±è´¥ç ï¼ˆæ²¡æœ‰åˆ™ä¸ŠæŠ¥ç©ºï¼‰</td></tr><tr><td>extend1</td><td>å¤±è´¥çš„ messageï¼ˆæ²¡æœ‰åˆ™ä¸ŠæŠ¥ç©ºï¼‰</td></tr><tr><td>en</td><td>æ—¥å¿—ç±»å‹ start</td></tr></tbody></table></li></ul><p><a name="blogTitle9"></a></p><h3 id="2-4-æ•°æ®ç”Ÿæˆè„šæœ¬"><a href="#2-4-æ•°æ®ç”Ÿæˆè„šæœ¬" class="headerlink" title="2.4 æ•°æ®ç”Ÿæˆè„šæœ¬"></a>2.4 æ•°æ®ç”Ÿæˆè„šæœ¬</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445276-36599c24-74d5-4b7f-8674-1979b36b32cf.png#align=left&display=inline&height=815&margin=%5Bobject%20Object%5D&originHeight=815&originWidth=1918&size=0&status=done&style=none&width=1918" alt></p><blockquote><p>å¦‚ä¸‹æ¡ˆä¾‹ä¸­å°†çœç•¥å›¾ä¸­çº¢æ¡†ä¸­çš„æ—¥å¿—ç”Ÿæˆè¿‡ç¨‹ï¼Œç›´æ¥ä½¿ç”¨Javaç¨‹åºæ„å»ºlogFileæ–‡ä»¶ã€‚</p></blockquote><p><a name="4c767f75"></a></p><h4 id="2-4-1-æ•°æ®ç”Ÿæˆæ ¼å¼"><a href="#2-4-1-æ•°æ®ç”Ÿæˆæ ¼å¼" class="headerlink" title="2.4.1 æ•°æ®ç”Ÿæˆæ ¼å¼"></a>2.4.1 æ•°æ®ç”Ÿæˆæ ¼å¼</h4><ul><li>å¯åŠ¨æ—¥å¿—</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445197-5930bda1-7de7-4d77-8450-d1408dde46ad.png#align=left&display=inline&height=738&margin=%5Bobject%20Object%5D&originHeight=738&originWidth=1301&size=0&status=done&style=none&width=1301" alt></p><blockquote><p>{â€œactionâ€:â€1â€,â€arâ€:â€MXâ€,â€baâ€:â€Sumsungâ€,â€detailâ€:â€201â€,â€enâ€:â€startâ€,â€entryâ€:â€4â€,â€extend1â€:â€â€,â€gâ€:â€<a href="mailto:69021X1Q@gmail.com" rel="external nofollow noopener noreferrer" target="_blank">69021X1Q@gmail.com</a>â€œ,â€hwâ€:â€1080*1920â€,â€lâ€:â€ptâ€,â€laâ€:â€-11.0â€,â€lnâ€:â€-70.0â€,â€loading_timeâ€:â€9â€,â€mdâ€:â€sumsung-5â€,â€midâ€:â€244â€,â€nwâ€:â€3Gâ€,â€open_ad_typeâ€:â€1â€,â€osâ€:â€8.2.3â€,â€srâ€:â€Dâ€,â€svâ€:â€V2.1.3â€,â€tâ€:â€1589612165914â€,â€uidâ€:â€244â€,â€vcâ€:â€16â€,â€vnâ€:â€1.2.1â€}</p></blockquote><ul><li>äº‹ä»¶æ—¥å¿—(ç”±äºè½¬æ¢é—®é¢˜ï¼Œå›¾ä¸­æ²¡æœ‰ â€œæ—¶é—´æˆ³|â€)</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445200-dd221676-3d59-4d7f-a516-52882e9754d2.png#align=left&display=inline&height=810&margin=%5Bobject%20Object%5D&originHeight=810&originWidth=1300&size=0&status=done&style=none&width=1300" alt></p><blockquote><p>1589695383284|{â€œcmâ€:{â€œlnâ€:â€-79.4â€,â€svâ€:â€V2.5.3â€,â€osâ€:â€8.0.6â€,â€gâ€:â€<a href="mailto:81614U54@gmail.com" rel="external nofollow noopener noreferrer" target="_blank">81614U54@gmail.com</a>â€œ,â€midâ€:â€245â€,â€nwâ€:â€WIFIâ€,â€lâ€:â€ptâ€,â€vcâ€:â€6â€,â€hwâ€:â€1080*1920â€,â€arâ€:â€MXâ€,â€uidâ€:â€245â€,â€tâ€:â€1589627025851â€,â€laâ€:â€-39.6â€,â€mdâ€:â€HTC-7â€,â€vnâ€:â€1.3.5â€,â€baâ€:â€HTCâ€,â€srâ€:â€Nâ€},â€apâ€:â€appâ€,â€etâ€:[{â€œettâ€:â€1589650631883â€,â€enâ€:â€displayâ€,â€kvâ€:{â€œgoodsidâ€:â€53â€,â€actionâ€:â€2â€,â€extend1â€:â€2â€,â€placeâ€:â€3â€,â€categoryâ€:â€50â€}},{â€œettâ€:â€1589690866312â€,â€enâ€:â€newsdetailâ€,â€kvâ€:{â€œentryâ€:â€3â€,â€goodsidâ€:â€54â€,â€news_staytimeâ€:â€1â€,â€loading_timeâ€:â€6â€,â€actionâ€:â€4â€,â€showtypeâ€:â€0â€,â€categoryâ€:â€78â€,â€type1â€:â€â€}},{â€œettâ€:â€1589641734037â€,â€enâ€:â€loadingâ€,â€kvâ€:{â€œextend2â€:â€â€,â€loading_timeâ€:â€0â€,â€actionâ€:â€1â€,â€extend1â€:â€â€,â€typeâ€:â€2â€,â€type1â€:â€201â€,â€loading_wayâ€:â€2â€}},{â€œettâ€:â€1589687684878â€,â€enâ€:â€adâ€,â€kvâ€:{â€œactivityIdâ€:â€1â€,â€displayMillsâ€:â€92030â€,â€entryâ€:â€3â€,â€actionâ€:â€5â€,â€contentTypeâ€:â€0â€}},{â€œettâ€:â€1589632980772â€,â€enâ€:â€active_backgroundâ€,â€kvâ€:{â€œactive_sourceâ€:â€1â€}},{â€œettâ€:â€1589682030324â€,â€enâ€:â€errorâ€,â€kvâ€:{â€œerrorDetailâ€:â€java.lang.NullPointerException\n at cn.lift.appIn.web.AbstractBaseController.validInbound(AbstractBaseController.java:72)\n at cn.lift.dfdf.web.AbstractBaseController.validInboundâ€,â€errorBriefâ€:â€at cn.lift.dfdf.web.AbstractBaseController.validInbound(AbstractBaseController.java:72)â€}},{â€œettâ€:â€1589675065650â€,â€enâ€:â€commentâ€,â€kvâ€:{â€œp_comment_idâ€:2,â€addtimeâ€:â€1589624299628â€,â€praise_countâ€:509,â€other_idâ€:6,â€comment_idâ€:7,â€reply_countâ€:35,â€useridâ€:3,â€contentâ€:â€å…³è‰²èŠ¦å€™ä½°é—´çº¶çŠæ–‘ç¦å°¹èµæ¶¤ä»‡å½­ä¼å‘µå§œæ¯…â€}},{â€œettâ€:â€1589631359459â€,â€enâ€:â€favoritesâ€,â€kvâ€:{â€œcourse_idâ€:7,â€idâ€:0,â€add_timeâ€:â€1589681240066â€,â€useridâ€:7}},{â€œettâ€:â€1589616574187â€,â€enâ€:â€praiseâ€,â€kvâ€:{â€œtarget_idâ€:1,â€idâ€:7,â€typeâ€:3,â€add_timeâ€:â€1589642497314â€,â€useridâ€:8}}]}</p></blockquote><p><a name="e84eff3b"></a></p><h4 id="2-4-2-åˆ›å»ºmavenå·¥ç¨‹"><a href="#2-4-2-åˆ›å»ºmavenå·¥ç¨‹" class="headerlink" title="2.4.2 åˆ›å»ºmavenå·¥ç¨‹"></a>2.4.2 åˆ›å»ºmavenå·¥ç¨‹</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445354-3c28f41c-e63c-4fb9-84d2-2758e24117d7.png#align=left&display=inline&height=356&margin=%5Bobject%20Object%5D&originHeight=356&originWidth=1501&size=0&status=done&style=none&width=1501" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445239-29830e5f-2628-4b61-b25c-860285f21cc5.png#align=left&display=inline&height=733&margin=%5Bobject%20Object%5D&originHeight=733&originWidth=1500&size=0&status=done&style=none&width=1500" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445257-f8650a51-09ee-42f3-b9e6-c374f207c5b9.png#align=left&display=inline&height=402&margin=%5Bobject%20Object%5D&originHeight=402&originWidth=1501&size=0&status=done&style=none&width=1501" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445238-b3a082a7-5282-4ffe-b763-62f4d159a8b3.png#align=left&display=inline&height=395&margin=%5Bobject%20Object%5D&originHeight=395&originWidth=1501&size=0&status=done&style=none&width=1501" alt></p><ul><li><p>data-producerï¼špom.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--ç‰ˆæœ¬å·ç»Ÿä¸€--&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;slf4j.version&gt;1.7.20&lt;&#x2F;slf4j.version&gt;</span><br><span class="line">        &lt;logback.version&gt;1.0.7&lt;&#x2F;logback.version&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line">    &lt;dependencies&gt; &lt;!--é˜¿é‡Œå·´å·´å¼€æº json è§£ææ¡†æ¶--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;fastjson&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.51&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt; &lt;!--æ—¥å¿—ç”Ÿæˆæ¡†æ¶--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;ch.qos.logback&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;logback-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;logback.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;ch.qos.logback&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;logback-classic&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;logback.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.18.10&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.3.2&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;&#x2F;source&gt;</span><br><span class="line">                    &lt;target&gt;1.8&lt;&#x2F;target&gt;</span><br><span class="line">                &lt;&#x2F;configuration&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-assembly-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;descriptorRefs&gt;</span><br><span class="line">                        &lt;descriptorRef&gt;jar-with-dependencies&lt;&#x2F;descriptorRef&gt;</span><br><span class="line">                    &lt;&#x2F;descriptorRefs&gt;</span><br><span class="line">                    &lt;archive&gt;</span><br><span class="line">                        &lt;manifest&gt;</span><br><span class="line">                            &lt;!--ä¸»ç±»å--&gt;</span><br><span class="line">                            &lt;mainClass&gt;com.heaton.bigdata.datawarehouse.app.App&lt;&#x2F;mainClass&gt;</span><br><span class="line">                        &lt;&#x2F;manifest&gt;</span><br><span class="line">                    &lt;&#x2F;archive&gt;</span><br><span class="line">                &lt;&#x2F;configuration&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;make-assembly&lt;&#x2F;id&gt;</span><br><span class="line">                        &lt;phase&gt;package&lt;&#x2F;phase&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;single&lt;&#x2F;goal&gt;</span><br><span class="line">                        &lt;&#x2F;goals&gt;</span><br><span class="line">                    &lt;&#x2F;execution&gt;</span><br><span class="line">                &lt;&#x2F;executions&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure></li><li><p>data-producerï¼šlogback.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;configuration debug&#x3D;&quot;false&quot;&gt; &lt;!--å®šä¹‰æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨åœ°å€ å‹¿åœ¨ LogBack çš„é…ç½®ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„ --&gt;</span><br><span class="line">    &lt;property name&#x3D;&quot;LOG_HOME&quot; value&#x3D;&quot;&#x2F;root&#x2F;logs&#x2F;&quot;&#x2F;&gt; &lt;!-- æ§åˆ¶å°è¾“å‡º --&gt;</span><br><span class="line">    &lt;appender name&#x3D;&quot;STDOUT&quot; class&#x3D;&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;</span><br><span class="line">        &lt;encoder</span><br><span class="line">                class&#x3D;&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt; &lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%d è¡¨ç¤ºæ—¥æœŸï¼Œ%thread è¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º 5 ä¸ªå­—ç¬¦å®½åº¦%msgï¼š æ—¥å¿—æ¶ˆæ¯ï¼Œ%n æ˜¯æ¢è¡Œç¬¦ --&gt;</span><br><span class="line">            &lt;pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n&lt;&#x2F;pattern&gt;</span><br><span class="line">        &lt;&#x2F;encoder&gt;</span><br><span class="line">    &lt;&#x2F;appender&gt; &lt;!-- æŒ‰ç…§æ¯å¤©ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ã€‚å­˜å‚¨äº‹ä»¶æ—¥å¿— --&gt;</span><br><span class="line">    &lt;appender name&#x3D;&quot;FILE&quot;</span><br><span class="line">              class&#x3D;&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt; &lt;!-- &lt;File&gt;$&#123;LOG_HOME&#125;&#x2F;app.log&lt;&#x2F;File&gt;è®¾ç½®æ—¥å¿—ä¸è¶…è¿‡$&#123;log.max.size&#125;æ—¶çš„ä¿å­˜è·¯å¾„ï¼Œæ³¨æ„ï¼Œ å¦‚æœæ˜¯ web é¡¹ç›®ä¼šä¿å­˜åˆ° Tomcat çš„ bin ç›®å½• ä¸‹ --&gt;</span><br><span class="line">        &lt;rollingPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt; &lt;!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºçš„æ–‡ä»¶å --&gt;</span><br><span class="line">            &lt;FileNamePattern&gt;$&#123;LOG_HOME&#125;&#x2F;app-%d&#123;yyyy-MM-dd&#125;.log&lt;&#x2F;FileNamePattern&gt; &lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•° --&gt;</span><br><span class="line">            &lt;MaxHistory&gt;30&lt;&#x2F;MaxHistory&gt;</span><br><span class="line">        &lt;&#x2F;rollingPolicy&gt;</span><br><span class="line">        &lt;encoder class&#x3D;&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt;</span><br><span class="line">            &lt;pattern&gt;%msg%n&lt;&#x2F;pattern&gt;</span><br><span class="line">        &lt;&#x2F;encoder&gt; &lt;!--æ—¥å¿—æ–‡ä»¶æœ€å¤§çš„å¤§å° --&gt;</span><br><span class="line">        &lt;triggeringPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;&gt;</span><br><span class="line">            &lt;MaxFileSize&gt;10MB&lt;&#x2F;MaxFileSize&gt;</span><br><span class="line">        &lt;&#x2F;triggeringPolicy&gt;</span><br><span class="line">    &lt;&#x2F;appender&gt; &lt;!--å¼‚æ­¥æ‰“å°æ—¥å¿—--&gt;</span><br><span class="line">    &lt;appender name&#x3D;&quot;ASYNC_FILE&quot;</span><br><span class="line">              class&#x3D;&quot;ch.qos.logback.classic.AsyncAppender&quot;&gt; &lt;!-- ä¸ä¸¢å¤±æ—¥å¿—.é»˜è®¤çš„,å¦‚æœé˜Ÿåˆ—çš„ 80%å·²æ»¡,åˆ™ä¼šä¸¢å¼ƒ TRACTã€DEBUGã€INFO çº§åˆ«çš„æ—¥å¿— --&gt;</span><br><span class="line">        &lt;discardingThreshold&gt;0&lt;&#x2F;discardingThreshold&gt; &lt;!-- æ›´æ”¹é»˜è®¤çš„é˜Ÿåˆ—çš„æ·±åº¦,è¯¥å€¼ä¼šå½±å“æ€§èƒ½.é»˜è®¤å€¼ä¸º 256 --&gt;</span><br><span class="line">        &lt;queueSize&gt;512&lt;&#x2F;queueSize&gt; &lt;!-- æ·»åŠ é™„åŠ çš„ appender,æœ€å¤šåªèƒ½æ·»åŠ ä¸€ä¸ª --&gt;</span><br><span class="line">        &lt;appender-ref ref&#x3D;&quot;FILE&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;appender&gt; &lt;!-- æ—¥å¿—è¾“å‡ºçº§åˆ« --&gt;</span><br><span class="line">    &lt;root level&#x3D;&quot;INFO&quot;&gt;</span><br><span class="line">        &lt;appender-ref ref&#x3D;&quot;STDOUT&quot;&#x2F;&gt;</span><br><span class="line">        &lt;appender-ref ref&#x3D;&quot;ASYNC_FILE&quot;&#x2F;&gt;</span><br><span class="line">        &lt;appender-ref ref&#x3D;&quot;error&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;root&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure></li><li><p>data-flumeï¼špom.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.flume&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;flume-ng-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.9.0&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.3.2&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;&#x2F;source&gt;</span><br><span class="line">                    &lt;target&gt;1.8&lt;&#x2F;target&gt;</span><br><span class="line">                &lt;&#x2F;configuration&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure></li><li><p>hive-functionï¼špom.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.hive&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;hive-exec&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.1.1&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.3.2&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;&#x2F;source&gt;</span><br><span class="line">                    &lt;target&gt;1.8&lt;&#x2F;target&gt;</span><br><span class="line">                &lt;&#x2F;configuration&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure><p><a name="9ad75b74"></a></p><h4 id="2-4-3-å„äº‹ä»¶bean"><a href="#2-4-3-å„äº‹ä»¶bean" class="headerlink" title="2.4.3 å„äº‹ä»¶bean"></a>2.4.3 å„äº‹ä»¶bean</h4><blockquote><p>data-producerå·¥ç¨‹</p></blockquote></li></ul><p><a name="fd2c10ec"></a></p><h5 id="2-4-3-1-å…¬å…±æ—¥å¿—ç±»"><a href="#2-4-3-1-å…¬å…±æ—¥å¿—ç±»" class="headerlink" title="2.4.3.1 å…¬å…±æ—¥å¿—ç±»"></a>2.4.3.1 å…¬å…±æ—¥å¿—ç±»</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import lombok.Data;</span><br><span class="line">&#x2F;** </span><br><span class="line">* @author Heaton</span><br><span class="line">* @email 70416450@qq.com</span><br><span class="line">* @date 2020&#x2F;4&#x2F;25 14:54 </span><br><span class="line">* @describe å…¬å…±æ—¥å¿—ç±»</span><br><span class="line">*&#x2F;</span><br><span class="line">@Data</span><br><span class="line">public class AppBase &#123;</span><br><span class="line">    private String mid; &#x2F;&#x2F; (String) è®¾å¤‡å”¯ä¸€</span><br><span class="line">    private String uid; &#x2F;&#x2F; (String) ç”¨æˆ· uid</span><br><span class="line">    private String vc; &#x2F;&#x2F; (String) versionCodeï¼Œç¨‹åºç‰ˆæœ¬å·</span><br><span class="line">    private String vn; &#x2F;&#x2F; (String) versionNameï¼Œç¨‹åºç‰ˆæœ¬å</span><br><span class="line">    private String l; &#x2F;&#x2F; (String) ç³»ç»Ÿè¯­è¨€</span><br><span class="line">    private String sr; &#x2F;&#x2F; (String) æ¸ é“å·ï¼Œåº”ç”¨ä»å“ªä¸ªæ¸ é“æ¥çš„ã€‚</span><br><span class="line">    private String os; &#x2F;&#x2F; (String) Android ç³»ç»Ÿç‰ˆæœ¬</span><br><span class="line">    private String ar; &#x2F;&#x2F; (String) åŒºåŸŸ</span><br><span class="line">    private String md; &#x2F;&#x2F; (String) æ‰‹æœºå‹å·</span><br><span class="line">    private String ba; &#x2F;&#x2F; (String) æ‰‹æœºå“ç‰Œ</span><br><span class="line">    private String sv; &#x2F;&#x2F; (String) sdkVersion</span><br><span class="line">    private String g; &#x2F;&#x2F; (String) gmail</span><br><span class="line">    private String hw; &#x2F;&#x2F; (String) heightXwidthï¼Œå±å¹•å®½é«˜</span><br><span class="line">    private String t; &#x2F;&#x2F; (String) å®¢æˆ·ç«¯æ—¥å¿—äº§ç”Ÿæ—¶çš„æ—¶é—´</span><br><span class="line">    private String nw; &#x2F;&#x2F; (String) ç½‘ç»œæ¨¡å¼</span><br><span class="line">    private String ln; &#x2F;&#x2F; (double) lng ç»åº¦</span><br><span class="line">    private String la; &#x2F;&#x2F; (double) lat çº¬åº¦</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="b18452f7"></a></p><h5 id="2-4-3-2-å¯åŠ¨æ—¥å¿—ç±»"><a href="#2-4-3-2-å¯åŠ¨æ—¥å¿—ç±»" class="headerlink" title="2.4.3.2 å¯åŠ¨æ—¥å¿—ç±»"></a>2.4.3.2 å¯åŠ¨æ—¥å¿—ç±»</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import lombok.Data;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author Heaton</span><br><span class="line"> * @email 70416450@qq.com</span><br><span class="line"> * @date 2020&#x2F;4&#x2F;25 14:54</span><br><span class="line"> * @describe å¯åŠ¨æ—¥å¿—ç±»</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">public class AppStart extends AppBase &#123;</span><br><span class="line">    private String entry;&#x2F;&#x2F;å…¥å£ï¼š push&#x3D;1ï¼Œwidget&#x3D;2ï¼Œicon&#x3D;3ï¼Œnotification&#x3D;4, lockscreen_widget</span><br><span class="line">    private String open_ad_type;&#x2F;&#x2F;å¼€å±å¹¿å‘Šç±»å‹: å¼€å±åŸç”Ÿå¹¿å‘Š&#x3D;1, å¼€å±æ’å±å¹¿å‘Š&#x3D;2</span><br><span class="line">    private String action;&#x2F;&#x2F;çŠ¶æ€ï¼šæˆåŠŸ&#x3D;1 å¤±è´¥&#x3D;2</span><br><span class="line">    private String loading_time;&#x2F;&#x2F;åŠ è½½æ—¶é•¿ï¼šè®¡ç®—ä¸‹æ‹‰å¼€å§‹åˆ°æ¥å£è¿”å›æ•°æ®çš„æ—¶é—´ï¼Œï¼ˆå¼€å§‹åŠ è½½æŠ¥ 0ï¼ŒåŠ è½½æˆåŠŸæˆ–åŠ è½½å¤±è´¥æ‰ä¸ŠæŠ¥æ—¶é—´ï¼‰</span><br><span class="line">    private String detail;&#x2F;&#x2F;å¤±è´¥ç ï¼ˆæ²¡æœ‰åˆ™ä¸ŠæŠ¥ç©ºï¼‰</span><br><span class="line">    private String extend1;&#x2F;&#x2F;å¤±è´¥çš„ messageï¼ˆæ²¡æœ‰åˆ™ä¸ŠæŠ¥ç©ºï¼‰</span><br><span class="line">    private String en;&#x2F;&#x2F;å¯åŠ¨æ—¥å¿—ç±»å‹æ ‡è®°</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="9355740a"></a></p><h5 id="2-4-3-3-é”™è¯¯æ—¥å¿—ç±»"><a href="#2-4-3-3-é”™è¯¯æ—¥å¿—ç±»" class="headerlink" title="2.4.3.3 é”™è¯¯æ—¥å¿—ç±»"></a>2.4.3.3 é”™è¯¯æ—¥å¿—ç±»</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import lombok.Data;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author Heaton</span><br><span class="line"> * @email 70416450@qq.com</span><br><span class="line"> * @date 2020&#x2F;4&#x2F;25 14:54</span><br><span class="line"> * @describe é”™è¯¯æ—¥å¿—ç±»</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">public class AppErrorLog &#123;</span><br><span class="line">    private String errorBrief; &#x2F;&#x2F;é”™è¯¯æ‘˜è¦</span><br><span class="line">    private String errorDetail; &#x2F;&#x2F;é”™è¯¯è¯¦æƒ…</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="14491595"></a></p><h5 id="2-4-3-4-å•†å“ç‚¹å‡»æ—¥å¿—ç±»"><a href="#2-4-3-4-å•†å“ç‚¹å‡»æ—¥å¿—ç±»" class="headerlink" title="2.4.3.4 å•†å“ç‚¹å‡»æ—¥å¿—ç±»"></a>2.4.3.4 å•†å“ç‚¹å‡»æ—¥å¿—ç±»</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import lombok.Data;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author Heaton</span><br><span class="line"> * @email 70416450@qq.com</span><br><span class="line"> * @date 2020&#x2F;4&#x2F;25 14:54</span><br><span class="line"> * @describe å•†å“ç‚¹å‡»æ—¥å¿—ç±»</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">public class AppDisplay &#123;</span><br><span class="line">    private String action;&#x2F;&#x2F;åŠ¨ä½œï¼šæ›å…‰å•†å“&#x3D;1ï¼Œç‚¹å‡»å•†å“&#x3D;2</span><br><span class="line">    private String goodsid;&#x2F;&#x2F;å•†å“ IDï¼ˆæœåŠ¡ç«¯ä¸‹å‘çš„ IDï¼‰</span><br><span class="line">    private String place;&#x2F;&#x2F;é¡ºåºï¼ˆç¬¬å‡ æ¡å•†å“ï¼Œç¬¬ä¸€æ¡ä¸º 0ï¼Œç¬¬äºŒæ¡ä¸º 1ï¼Œå¦‚æ­¤ç±»æ¨ï¼‰</span><br><span class="line">    private String extend1;&#x2F;&#x2F;æ›å…‰ç±»å‹ï¼š1 - é¦–æ¬¡æ›å…‰ 2-é‡å¤æ›å…‰ï¼ˆæ²¡æœ‰ä½¿ç”¨ï¼‰</span><br><span class="line">    private String category;&#x2F;&#x2F;åˆ†ç±» IDï¼ˆæœåŠ¡ç«¯å®šä¹‰çš„åˆ†ç±» IDï¼‰</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="938fbf96"></a></p><h5 id="2-4-3-5-å•†å“è¯¦æƒ…ç±»"><a href="#2-4-3-5-å•†å“è¯¦æƒ…ç±»" class="headerlink" title="2.4.3.5 å•†å“è¯¦æƒ…ç±»"></a>2.4.3.5 å•†å“è¯¦æƒ…ç±»</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import lombok.Data;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author Heaton</span><br><span class="line"> * @email 70416450@qq.com</span><br><span class="line"> * @date 2020&#x2F;4&#x2F;25 14:54</span><br><span class="line"> * @describe å•†å“è¯¦æƒ…ç±»</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">public class AppNewsDetail &#123;</span><br><span class="line">    private String entry;&#x2F;&#x2F;é¡µé¢å…¥å£æ¥æºï¼šåº”ç”¨é¦–é¡µ&#x3D;1ã€push&#x3D;2ã€è¯¦æƒ…é¡µç›¸å…³æ¨è</span><br><span class="line">    private String action;&#x2F;&#x2F;åŠ¨ä½œï¼šå¼€å§‹åŠ è½½&#x3D;1ï¼ŒåŠ è½½æˆåŠŸ&#x3D;2ï¼ˆpvï¼‰ï¼ŒåŠ è½½å¤±è´¥&#x3D;3, é€€å‡ºé¡µé¢&#x3D;4</span><br><span class="line">    private String goodsid;&#x2F;&#x2F;å•†å“ IDï¼ˆæœåŠ¡ç«¯ä¸‹å‘çš„ IDï¼‰</span><br><span class="line">    private String showtype;&#x2F;&#x2F;å•†å“æ ·å¼ï¼š0ã€æ— å›¾ 1ã€ä¸€å¼ å¤§å›¾ 2ã€ä¸¤å¼ å›¾ 3ã€ä¸‰å¼ å°å›¾ 4ã€ä¸€å¼ å° å›¾ 5ã€ä¸€å¼ å¤§å›¾ä¸¤å¼ å°å›¾ æ¥æºäºè¯¦æƒ…é¡µç›¸å…³æ¨èçš„å•†å“ï¼Œä¸ŠæŠ¥æ ·å¼éƒ½ä¸º 0ï¼ˆå› ä¸ºéƒ½æ˜¯å·¦æ–‡å³å›¾ï¼‰</span><br><span class="line">    private String news_staytime;&#x2F;&#x2F;é¡µé¢åœç•™æ—¶é•¿ï¼šä»å•†å“å¼€å§‹åŠ è½½æ—¶å¼€å§‹è®¡ç®—ï¼Œåˆ°ç”¨æˆ·å…³é—­é¡µé¢ æ‰€ç”¨çš„æ—¶é—´ã€‚è‹¥ä¸­é€”ç”¨è·³è½¬åˆ°å…¶å®ƒé¡µé¢äº†ï¼Œåˆ™æš‚åœè®¡æ—¶ï¼Œå¾…å›åˆ°è¯¦æƒ…é¡µæ—¶æ¢å¤è®¡æ—¶ã€‚æˆ–ä¸­é€”åˆ’å‡ºçš„æ—¶é—´è¶… è¿‡ 10 åˆ†é’Ÿï¼Œåˆ™æœ¬æ¬¡è®¡æ—¶ä½œåºŸï¼Œä¸ä¸ŠæŠ¥æœ¬æ¬¡æ•°æ®ã€‚å¦‚æœªåŠ è½½æˆåŠŸé€€å‡ºï¼Œåˆ™æŠ¥ç©ºã€‚</span><br><span class="line">    private String loading_time;&#x2F;&#x2F;åŠ è½½æ—¶é•¿ï¼šè®¡ç®—é¡µé¢å¼€å§‹åŠ è½½åˆ°æ¥å£è¿”å›æ•°æ®çš„æ—¶é—´ ï¼ˆå¼€å§‹åŠ  è½½æŠ¥ 0ï¼ŒåŠ è½½æˆåŠŸæˆ–åŠ è½½å¤±è´¥æ‰ä¸ŠæŠ¥æ—¶é—´ï¼‰</span><br><span class="line">    private String type1;&#x2F;&#x2F;åŠ è½½å¤±è´¥ç ï¼šæŠŠåŠ è½½å¤±è´¥çŠ¶æ€ç æŠ¥å›æ¥ï¼ˆæŠ¥ç©ºä¸ºåŠ è½½æˆåŠŸï¼Œæ²¡æœ‰å¤±è´¥ï¼‰</span><br><span class="line">    private String category;&#x2F;&#x2F;åˆ†ç±» IDï¼ˆæœåŠ¡ç«¯å®šä¹‰çš„åˆ†ç±» IDï¼‰</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="3841af8f"></a></p><h5 id="2-4-3-6-å•†å“åˆ—è¡¨ç±»"><a href="#2-4-3-6-å•†å“åˆ—è¡¨ç±»" class="headerlink" title="2.4.3.6 å•†å“åˆ—è¡¨ç±»"></a>2.4.3.6 å•†å“åˆ—è¡¨ç±»</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import lombok.Data;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author Heaton</span><br><span class="line"> * @email 70416450@qq.com</span><br><span class="line"> * @date 2020&#x2F;4&#x2F;25 14:54</span><br><span class="line"> * @describe å•†å“åˆ—è¡¨ç±»</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">public class AppLoading &#123;</span><br><span class="line">    private String action;&#x2F;&#x2F;åŠ¨ä½œï¼šå¼€å§‹åŠ è½½&#x3D;1ï¼ŒåŠ è½½æˆåŠŸ&#x3D;2ï¼ŒåŠ è½½å¤±è´¥</span><br><span class="line">    private String loading_time;&#x2F;&#x2F;åŠ è½½æ—¶é•¿ï¼šè®¡ç®—ä¸‹æ‹‰å¼€å§‹åˆ°æ¥å£è¿”å›æ•°æ®çš„æ—¶é—´ï¼Œï¼ˆå¼€å§‹åŠ è½½æŠ¥ 0ï¼Œ åŠ è½½æˆåŠŸæˆ–åŠ è½½å¤±è´¥æ‰ä¸ŠæŠ¥æ—¶é—´ï¼‰</span><br><span class="line">    private String loading_way;&#x2F;&#x2F;åŠ è½½ç±»å‹ï¼š1-è¯»å–ç¼“å­˜ï¼Œ2-ä»æ¥å£æ‹‰æ–°æ•°æ® ï¼ˆåŠ è½½æˆåŠŸæ‰ä¸ŠæŠ¥åŠ  è½½ç±»å‹ï¼‰</span><br><span class="line">    private String extend1;&#x2F;&#x2F;æ‰©å±•å­—æ®µ Extend1</span><br><span class="line">    private String extend2;&#x2F;&#x2F;æ‰©å±•å­—æ®µ Extend2</span><br><span class="line">    private String type;&#x2F;&#x2F;åŠ è½½ç±»å‹ï¼šè‡ªåŠ¨åŠ è½½&#x3D;1ï¼Œç”¨æˆ·ä¸‹æ‹½åŠ è½½&#x3D;2ï¼Œåº•éƒ¨åŠ è½½&#x3D;3ï¼ˆåº•éƒ¨æ¡è§¦å‘ç‚¹å‡»åº• éƒ¨æç¤ºæ¡&#x2F;ç‚¹å‡»è¿”å›é¡¶éƒ¨åŠ è½½ï¼‰</span><br><span class="line">    private String type1;&#x2F;&#x2F;åŠ è½½å¤±è´¥ç ï¼šæŠŠåŠ è½½å¤±è´¥çŠ¶æ€ç æŠ¥å›æ¥ï¼ˆæŠ¥ç©ºä¸ºåŠ è½½æˆåŠŸï¼Œæ²¡æœ‰å¤±è´¥ï¼‰</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="fe8dffa0"></a></p><h5 id="2-4-3-7-å¹¿å‘Šç±»"><a href="#2-4-3-7-å¹¿å‘Šç±»" class="headerlink" title="2.4.3.7 å¹¿å‘Šç±»"></a>2.4.3.7 å¹¿å‘Šç±»</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import lombok.Data;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author Heaton</span><br><span class="line"> * @email 70416450@qq.com</span><br><span class="line"> * @date 2020&#x2F;4&#x2F;25 14:54</span><br><span class="line"> * @describe å¹¿å‘Šç±»</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">public class AppAd &#123;</span><br><span class="line">    private String entry;&#x2F;&#x2F;å…¥å£ï¼šå•†å“åˆ—è¡¨é¡µ&#x3D;1  åº”ç”¨é¦–é¡µ&#x3D;2 å•†å“è¯¦æƒ…é¡µ&#x3D;3</span><br><span class="line">    private String action;&#x2F;&#x2F;åŠ¨ä½œï¼š å¹¿å‘Šå±•ç¤º&#x3D;1 å¹¿å‘Šç‚¹å‡»&#x3D;2</span><br><span class="line">    private String contentType;&#x2F;&#x2F;Type: 1 å•†å“ 2 è¥é”€æ´»åŠ¨</span><br><span class="line">    private String displayMills;&#x2F;&#x2F;å±•ç¤ºæ—¶é•¿ æ¯«ç§’æ•°</span><br><span class="line">    private String itemId; &#x2F;&#x2F;å•†å“id</span><br><span class="line">    private String activityId; &#x2F;&#x2F;è¥é”€æ´»åŠ¨id</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="7e94e787"></a></p><h5 id="2-4-3-8-æ¶ˆæ¯é€šçŸ¥æ—¥å¿—ç±»"><a href="#2-4-3-8-æ¶ˆæ¯é€šçŸ¥æ—¥å¿—ç±»" class="headerlink" title="2.4.3.8 æ¶ˆæ¯é€šçŸ¥æ—¥å¿—ç±»"></a>2.4.3.8 æ¶ˆæ¯é€šçŸ¥æ—¥å¿—ç±»</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import lombok.Data;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author Heaton</span><br><span class="line"> * @email 70416450@qq.com</span><br><span class="line"> * @date 2020&#x2F;4&#x2F;25 14:54</span><br><span class="line"> * @describe æ¶ˆæ¯é€šçŸ¥æ—¥å¿—ç±»</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">public class AppNotification &#123;</span><br><span class="line">    private String action;&#x2F;&#x2F;åŠ¨ä½œï¼šé€šçŸ¥äº§ç”Ÿ&#x3D;1ï¼Œé€šçŸ¥å¼¹å‡º&#x3D;2ï¼Œé€šçŸ¥ç‚¹å‡»&#x3D;3ï¼Œå¸¸é©»é€šçŸ¥å±•ç¤ºï¼ˆä¸é‡å¤ä¸Š æŠ¥ï¼Œä¸€å¤©ä¹‹å†…åªæŠ¥ä¸€æ¬¡ï¼‰</span><br><span class="line">    private String type;&#x2F;&#x2F;é€šçŸ¥ idï¼šé¢„è­¦é€šçŸ¥&#x3D;1ï¼Œå¤©æ°”é¢„æŠ¥ï¼ˆæ—©&#x3D;2ï¼Œæ™š&#x3D;3ï¼‰ï¼Œå¸¸é©»&#x3D;4</span><br><span class="line">    private String ap_time;&#x2F;&#x2F;å®¢æˆ·ç«¯å¼¹å‡ºæ—¶é—´</span><br><span class="line">    private String content;&#x2F;&#x2F;å¤‡ç”¨å­—æ®µ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="f7b8845a"></a></p><h5 id="2-4-3-9-ç”¨æˆ·åå°æ´»è·ƒç±»"><a href="#2-4-3-9-ç”¨æˆ·åå°æ´»è·ƒç±»" class="headerlink" title="2.4.3.9 ç”¨æˆ·åå°æ´»è·ƒç±»"></a>2.4.3.9 ç”¨æˆ·åå°æ´»è·ƒç±»</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import lombok.Data;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author Heaton</span><br><span class="line"> * @email 70416450@qq.com</span><br><span class="line"> * @date 2020&#x2F;4&#x2F;25 14:54</span><br><span class="line"> * @describe ç”¨æˆ·åå°æ´»è·ƒç±»</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">public class AppActive &#123;</span><br><span class="line">    private String active_source;&#x2F;&#x2F;1&#x3D;upgrade,2&#x3D;download(ä¸‹è½½),3&#x3D;plugin_upgrade</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="eed5386c"></a></p><h5 id="2-4-3-10-ç”¨æˆ·è¯„è®ºç±»"><a href="#2-4-3-10-ç”¨æˆ·è¯„è®ºç±»" class="headerlink" title="2.4.3.10 ç”¨æˆ·è¯„è®ºç±»"></a>2.4.3.10 ç”¨æˆ·è¯„è®ºç±»</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import lombok.Data;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author Heaton</span><br><span class="line"> * @email 70416450@qq.com</span><br><span class="line"> * @date 2020&#x2F;4&#x2F;25 14:54</span><br><span class="line"> * @describe ç”¨æˆ·è¯„è®ºç±»</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">public class AppComment &#123;</span><br><span class="line">    private int comment_id;&#x2F;&#x2F;è¯„è®ºè¡¨</span><br><span class="line">    private int userid;&#x2F;&#x2F;ç”¨æˆ· id</span><br><span class="line">    private int p_comment_id;&#x2F;&#x2F;çˆ¶çº§è¯„è®º id(ä¸º 0 åˆ™æ˜¯ä¸€çº§è¯„è®º,ä¸ä¸º 0 åˆ™æ˜¯å›å¤)</span><br><span class="line">    private String content;&#x2F;&#x2F;è¯„è®ºå†…å®¹</span><br><span class="line">    private String addtime;&#x2F;&#x2F;åˆ›å»ºæ—¶é—´</span><br><span class="line">    private int other_id;&#x2F;&#x2F;è¯„è®ºçš„ç›¸å…³ id</span><br><span class="line">    private int praise_count;&#x2F;&#x2F;ç‚¹èµæ•°é‡</span><br><span class="line">    private int reply_count;&#x2F;&#x2F;å›å¤æ•°é‡</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="01adfa90"></a></p><h5 id="2-4-3-11-ç”¨æˆ·æ”¶è—ç±»"><a href="#2-4-3-11-ç”¨æˆ·æ”¶è—ç±»" class="headerlink" title="2.4.3.11 ç”¨æˆ·æ”¶è—ç±»"></a>2.4.3.11 ç”¨æˆ·æ”¶è—ç±»</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import lombok.Data;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author Heaton</span><br><span class="line"> * @email 70416450@qq.com</span><br><span class="line"> * @date 2020&#x2F;4&#x2F;25 14:54</span><br><span class="line"> * @describe ç”¨æˆ·æ”¶è—ç±»</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">public class AppFavorites &#123;</span><br><span class="line">    private int id;&#x2F;&#x2F;ä¸»é”®</span><br><span class="line">    private int course_id;&#x2F;&#x2F;å•†å“ id</span><br><span class="line">    private int userid;&#x2F;&#x2F;ç”¨æˆ· ID</span><br><span class="line">    private String add_time;&#x2F;&#x2F;åˆ›å»ºæ—¶é—´</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="381f0e2a"></a></p><h5 id="2-4-3-12-ç”¨æˆ·ç‚¹èµç±»"><a href="#2-4-3-12-ç”¨æˆ·ç‚¹èµç±»" class="headerlink" title="2.4.3.12 ç”¨æˆ·ç‚¹èµç±»"></a>2.4.3.12 ç”¨æˆ·ç‚¹èµç±»</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import lombok.Data;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author Heaton</span><br><span class="line"> * @email 70416450@qq.com</span><br><span class="line"> * @date 2020&#x2F;4&#x2F;25 14:54</span><br><span class="line"> * @describe ç”¨æˆ·ç‚¹èµç±»</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">public class AppPraise &#123;</span><br><span class="line">    private int id; &#x2F;&#x2F;ä¸»é”® id</span><br><span class="line">    private int userid;&#x2F;&#x2F;ç”¨æˆ· id</span><br><span class="line">    private int target_id;&#x2F;&#x2F;ç‚¹èµçš„å¯¹è±¡ id</span><br><span class="line">    private int type;&#x2F;&#x2F;ç‚¹èµç±»å‹ 1 é—®ç­”ç‚¹èµ 2 é—®ç­”è¯„è®ºç‚¹èµ 3 æ–‡ç« ç‚¹èµæ•° 4 è¯„è®ºç‚¹èµ</span><br><span class="line">    private String add_time;&#x2F;&#x2F;æ·»åŠ æ—¶é—´</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="c9fc3b91"></a></p><h4 id="2-4-4-å¯åŠ¨ç±»"><a href="#2-4-4-å¯åŠ¨ç±»" class="headerlink" title="2.4.4 å¯åŠ¨ç±»"></a>2.4.4 å¯åŠ¨ç±»</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br></pre></td><td class="code"><pre><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.alibaba.fastjson.JSONArray;</span><br><span class="line">import com.alibaba.fastjson.JSONObject;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import java.io.UnsupportedEncodingException;</span><br><span class="line">import java.util.Random;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author Heaton</span><br><span class="line"> * @email 70416450@qq.com</span><br><span class="line"> * @date 2020&#x2F;4&#x2F;25 14:54</span><br><span class="line"> * @describe å¯åŠ¨ç±»</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class App &#123;</span><br><span class="line">    private final static Logger logger &#x3D; LoggerFactory.getLogger(App.class);</span><br><span class="line">    private static Random rand &#x3D; new Random();</span><br><span class="line">    &#x2F;&#x2F; è®¾å¤‡id</span><br><span class="line">    private static int s_mid &#x3D; 0;</span><br><span class="line">    &#x2F;&#x2F; ç”¨æˆ·id</span><br><span class="line">    private static int s_uid &#x3D; 0;</span><br><span class="line">    &#x2F;&#x2F; å•†å“id</span><br><span class="line">    private static int s_goodsid &#x3D; 0;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        &#x2F;&#x2F; å‚æ•°ä¸€ï¼šæ§åˆ¶å‘é€æ¯æ¡çš„å»¶æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯0</span><br><span class="line">        Long delay &#x3D; args.length &gt; 0 ? Long.parseLong(args[0]) : 0L;</span><br><span class="line">        &#x2F;&#x2F; å‚æ•°äºŒï¼šå¾ªç¯éå†æ¬¡æ•°</span><br><span class="line">        int loop_len &#x3D; args.length &gt; 1 ? Integer.parseInt(args[1]) : 1000;</span><br><span class="line">        &#x2F;&#x2F; ç”Ÿæˆæ•°æ®</span><br><span class="line">        generateLog(delay, loop_len);</span><br><span class="line">    &#125;</span><br><span class="line">    private static void generateLog(Long delay, int loop_len) &#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; loop_len; i++) &#123;</span><br><span class="line">            int flag &#x3D; rand.nextInt(2);</span><br><span class="line">            switch (flag) &#123;</span><br><span class="line">                case (0):</span><br><span class="line">                    &#x2F;&#x2F;åº”ç”¨å¯åŠ¨</span><br><span class="line">                    AppStart appStart &#x3D; generateStart();</span><br><span class="line">                    String jsonString &#x3D; JSON.toJSONString(appStart);</span><br><span class="line">                    &#x2F;&#x2F;æ§åˆ¶å°æ‰“å°</span><br><span class="line">                    logger.info(jsonString);</span><br><span class="line">                    break;</span><br><span class="line">                case (1):</span><br><span class="line">                    JSONObject json &#x3D; new JSONObject();</span><br><span class="line">                    json.put(&quot;ap&quot;, &quot;app&quot;);</span><br><span class="line">                    json.put(&quot;cm&quot;, generateComFields());</span><br><span class="line">                    JSONArray eventsArray &#x3D; new JSONArray();</span><br><span class="line">                    &#x2F;&#x2F; äº‹ä»¶æ—¥å¿—</span><br><span class="line">                    &#x2F;&#x2F; å•†å“ç‚¹å‡»ï¼Œå±•ç¤º</span><br><span class="line">                    if (rand.nextBoolean()) &#123;</span><br><span class="line">                        eventsArray.add(generateDisplay());</span><br><span class="line">                        json.put(&quot;et&quot;, eventsArray);</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#x2F;&#x2F; å•†å“è¯¦æƒ…é¡µ</span><br><span class="line">                    if (rand.nextBoolean()) &#123;</span><br><span class="line">                        eventsArray.add(generateNewsDetail());</span><br><span class="line">                        json.put(&quot;et&quot;, eventsArray);</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#x2F;&#x2F; å•†å“åˆ—è¡¨é¡µ</span><br><span class="line">                    if (rand.nextBoolean()) &#123;</span><br><span class="line">                        eventsArray.add(generateNewList());</span><br><span class="line">                        json.put(&quot;et&quot;, eventsArray);</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#x2F;&#x2F; å¹¿å‘Š</span><br><span class="line">                    if (rand.nextBoolean()) &#123;</span><br><span class="line">                        eventsArray.add(generateAd());</span><br><span class="line">                        json.put(&quot;et&quot;, eventsArray);</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#x2F;&#x2F; æ¶ˆæ¯é€šçŸ¥</span><br><span class="line">                    if (rand.nextBoolean()) &#123;</span><br><span class="line">                        eventsArray.add(generateNotification());</span><br><span class="line">                        json.put(&quot;et&quot;, eventsArray);</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#x2F;&#x2F; ç”¨æˆ·åå°æ´»è·ƒ</span><br><span class="line">                    if (rand.nextBoolean()) &#123;</span><br><span class="line">                        eventsArray.add(generateBackground());</span><br><span class="line">                        json.put(&quot;et&quot;, eventsArray);</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#x2F;&#x2F;æ•…éšœæ—¥å¿—</span><br><span class="line">                    if (rand.nextBoolean()) &#123;</span><br><span class="line">                        eventsArray.add(generateError());</span><br><span class="line">                        json.put(&quot;et&quot;, eventsArray);</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#x2F;&#x2F; ç”¨æˆ·è¯„è®º</span><br><span class="line">                    if (rand.nextBoolean()) &#123;</span><br><span class="line">                        eventsArray.add(generateComment());</span><br><span class="line">                        json.put(&quot;et&quot;, eventsArray);</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#x2F;&#x2F; ç”¨æˆ·æ”¶è—</span><br><span class="line">                    if (rand.nextBoolean()) &#123;</span><br><span class="line">                        eventsArray.add(generateFavorites());</span><br><span class="line">                        json.put(&quot;et&quot;, eventsArray);</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#x2F;&#x2F; ç”¨æˆ·ç‚¹èµ</span><br><span class="line">                    if (rand.nextBoolean()) &#123;</span><br><span class="line">                        eventsArray.add(generatePraise());</span><br><span class="line">                        json.put(&quot;et&quot;, eventsArray);</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#x2F;&#x2F;æ—¶é—´</span><br><span class="line">                    long millis &#x3D; System.currentTimeMillis();</span><br><span class="line">                    &#x2F;&#x2F;æ§åˆ¶å°æ‰“å°</span><br><span class="line">                    logger.info(millis + &quot;|&quot; + json.toJSONString());</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F; å»¶è¿Ÿ</span><br><span class="line">            try &#123;</span><br><span class="line">                Thread.sleep(delay);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * å…¬å…±å­—æ®µè®¾ç½®</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static JSONObject generateComFields() &#123;</span><br><span class="line">        AppBase appBase &#x3D; new AppBase();</span><br><span class="line">        &#x2F;&#x2F;è®¾å¤‡id</span><br><span class="line">        appBase.setMid(s_mid + &quot;&quot;);</span><br><span class="line">        s_mid++;</span><br><span class="line">        &#x2F;&#x2F; ç”¨æˆ·id</span><br><span class="line">        appBase.setUid(s_uid + &quot;&quot;);</span><br><span class="line">        s_uid++;</span><br><span class="line">        &#x2F;&#x2F; ç¨‹åºç‰ˆæœ¬å· 5,6ç­‰</span><br><span class="line">        appBase.setVc(&quot;&quot; + rand.nextInt(20));</span><br><span class="line">        &#x2F;&#x2F;ç¨‹åºç‰ˆæœ¬å v1.1.1</span><br><span class="line">        appBase.setVn(&quot;1.&quot; + rand.nextInt(4) + &quot;.&quot; + rand.nextInt(10));</span><br><span class="line">        &#x2F;&#x2F; å®‰å“ç³»ç»Ÿç‰ˆæœ¬</span><br><span class="line">        appBase.setOs(&quot;8.&quot; + rand.nextInt(3) + &quot;.&quot; + rand.nextInt(10));</span><br><span class="line">        &#x2F;&#x2F; è¯­è¨€  es,en,pt</span><br><span class="line">        int flag &#x3D; rand.nextInt(3);</span><br><span class="line">        switch (flag) &#123;</span><br><span class="line">            case (0):</span><br><span class="line">                appBase.setL(&quot;es&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case (1):</span><br><span class="line">                appBase.setL(&quot;en&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case (2):</span><br><span class="line">                appBase.setL(&quot;pt&quot;);</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; æ¸ é“å·   ä»å“ªä¸ªæ¸ é“æ¥çš„</span><br><span class="line">        appBase.setSr(getRandomChar(1));</span><br><span class="line">        &#x2F;&#x2F; åŒºåŸŸ</span><br><span class="line">        flag &#x3D; rand.nextInt(2);</span><br><span class="line">        switch (flag) &#123;</span><br><span class="line">            case 0:</span><br><span class="line">                appBase.setAr(&quot;BR&quot;);</span><br><span class="line">            case 1:</span><br><span class="line">                appBase.setAr(&quot;MX&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; æ‰‹æœºå“ç‰Œ ba ,æ‰‹æœºå‹å· mdï¼Œå°±å–2ä½æ•°å­—äº†</span><br><span class="line">        flag &#x3D; rand.nextInt(3);</span><br><span class="line">        switch (flag) &#123;</span><br><span class="line">            case 0:</span><br><span class="line">                appBase.setBa(&quot;Sumsung&quot;);</span><br><span class="line">                appBase.setMd(&quot;sumsung-&quot; + rand.nextInt(20));</span><br><span class="line">                break;</span><br><span class="line">            case 1:</span><br><span class="line">                appBase.setBa(&quot;Huawei&quot;);</span><br><span class="line">                appBase.setMd(&quot;Huawei-&quot; + rand.nextInt(20));</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                appBase.setBa(&quot;HTC&quot;);</span><br><span class="line">                appBase.setMd(&quot;HTC-&quot; + rand.nextInt(20));</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; åµŒå…¥sdkçš„ç‰ˆæœ¬</span><br><span class="line">        appBase.setSv(&quot;V2.&quot; + rand.nextInt(10) + &quot;.&quot; + rand.nextInt(10));</span><br><span class="line">        &#x2F;&#x2F; gmail</span><br><span class="line">        appBase.setG(getRandomCharAndNumr(8) + &quot;@gmail.com&quot;);</span><br><span class="line">        &#x2F;&#x2F; å±å¹•å®½é«˜ hw</span><br><span class="line">        flag &#x3D; rand.nextInt(4);</span><br><span class="line">        switch (flag) &#123;</span><br><span class="line">            case 0:</span><br><span class="line">                appBase.setHw(&quot;640*960&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 1:</span><br><span class="line">                appBase.setHw(&quot;640*1136&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                appBase.setHw(&quot;750*1134&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 3:</span><br><span class="line">                appBase.setHw(&quot;1080*1920&quot;);</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; å®¢æˆ·ç«¯äº§ç”Ÿæ—¥å¿—æ—¶é—´</span><br><span class="line">        long millis &#x3D; System.currentTimeMillis();</span><br><span class="line">        appBase.setT(&quot;&quot; + (millis - rand.nextInt(99999999)));</span><br><span class="line">        &#x2F;&#x2F; æ‰‹æœºç½‘ç»œæ¨¡å¼ 3G,4G,WIFI</span><br><span class="line">        flag &#x3D; rand.nextInt(3);</span><br><span class="line">        switch (flag) &#123;</span><br><span class="line">            case 0:</span><br><span class="line">                appBase.setNw(&quot;3G&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 1:</span><br><span class="line">                appBase.setNw(&quot;4G&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                appBase.setNw(&quot;WIFI&quot;);</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; æ‹‰ä¸ç¾æ´² è¥¿ç»34Â°46â€²è‡³è¥¿ç»117Â°09ï¼›åŒ—çº¬32Â°42â€²è‡³å—çº¬53Â°54â€²</span><br><span class="line">        &#x2F;&#x2F; ç»åº¦</span><br><span class="line">        appBase.setLn((-34 - rand.nextInt(83) - rand.nextInt(60) &#x2F; 10.0) + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; çº¬åº¦</span><br><span class="line">        appBase.setLa((32 - rand.nextInt(85) - rand.nextInt(60) &#x2F; 10.0) + &quot;&quot;);</span><br><span class="line">        return (JSONObject) JSON.toJSON(appBase);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * å•†å“å±•ç¤ºäº‹ä»¶</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static JSONObject generateDisplay() &#123;</span><br><span class="line">        AppDisplay appDisplay &#x3D; new AppDisplay();</span><br><span class="line">        boolean boolFlag &#x3D; rand.nextInt(10) &lt; 7;</span><br><span class="line">        &#x2F;&#x2F; åŠ¨ä½œï¼šæ›å…‰å•†å“&#x3D;1ï¼Œç‚¹å‡»å•†å“&#x3D;2ï¼Œ</span><br><span class="line">        if (boolFlag) &#123;</span><br><span class="line">            appDisplay.setAction(&quot;1&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            appDisplay.setAction(&quot;2&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; å•†å“id</span><br><span class="line">        String goodsId &#x3D; s_goodsid + &quot;&quot;;</span><br><span class="line">        s_goodsid++;</span><br><span class="line">        appDisplay.setGoodsid(goodsId);</span><br><span class="line">        &#x2F;&#x2F; é¡ºåº  è®¾ç½®æˆ6æ¡å§</span><br><span class="line">        int flag &#x3D; rand.nextInt(6);</span><br><span class="line">        appDisplay.setPlace(&quot;&quot; + flag);</span><br><span class="line">        &#x2F;&#x2F; æ›å…‰ç±»å‹</span><br><span class="line">        flag &#x3D; 1 + rand.nextInt(2);</span><br><span class="line">        appDisplay.setExtend1(&quot;&quot; + flag);</span><br><span class="line">        &#x2F;&#x2F; åˆ†ç±»</span><br><span class="line">        flag &#x3D; 1 + rand.nextInt(100);</span><br><span class="line">        appDisplay.setCategory(&quot;&quot; + flag);</span><br><span class="line">        JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(appDisplay);</span><br><span class="line">        return packEventJson(&quot;display&quot;, jsonObject);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * å•†å“è¯¦æƒ…é¡µ</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static JSONObject generateNewsDetail() &#123;</span><br><span class="line">        AppNewsDetail appNewsDetail &#x3D; new AppNewsDetail();</span><br><span class="line">        &#x2F;&#x2F; é¡µé¢å…¥å£æ¥æº</span><br><span class="line">        int flag &#x3D; 1 + rand.nextInt(3);</span><br><span class="line">        appNewsDetail.setEntry(flag + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; åŠ¨ä½œ</span><br><span class="line">        appNewsDetail.setAction(&quot;&quot; + (rand.nextInt(4) + 1));</span><br><span class="line">        &#x2F;&#x2F; å•†å“id</span><br><span class="line">        appNewsDetail.setGoodsid(s_goodsid + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; å•†å“æ¥æºç±»å‹</span><br><span class="line">        flag &#x3D; 1 + rand.nextInt(3);</span><br><span class="line">        appNewsDetail.setShowtype(flag + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; å•†å“æ ·å¼</span><br><span class="line">        flag &#x3D; rand.nextInt(6);</span><br><span class="line">        appNewsDetail.setShowtype(&quot;&quot; + flag);</span><br><span class="line">        &#x2F;&#x2F; é¡µé¢åœç•™æ—¶é•¿</span><br><span class="line">        flag &#x3D; rand.nextInt(10) * rand.nextInt(7);</span><br><span class="line">        appNewsDetail.setNews_staytime(flag + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; åŠ è½½æ—¶é•¿</span><br><span class="line">        flag &#x3D; rand.nextInt(10) * rand.nextInt(7);</span><br><span class="line">        appNewsDetail.setLoading_time(flag + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; åŠ è½½å¤±è´¥ç </span><br><span class="line">        flag &#x3D; rand.nextInt(10);</span><br><span class="line">        switch (flag) &#123;</span><br><span class="line">            case 1:</span><br><span class="line">                appNewsDetail.setType1(&quot;102&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                appNewsDetail.setType1(&quot;201&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 3:</span><br><span class="line">                appNewsDetail.setType1(&quot;325&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 4:</span><br><span class="line">                appNewsDetail.setType1(&quot;433&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 5:</span><br><span class="line">                appNewsDetail.setType1(&quot;542&quot;);</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                appNewsDetail.setType1(&quot;&quot;);</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; åˆ†ç±»</span><br><span class="line">        flag &#x3D; 1 + rand.nextInt(100);</span><br><span class="line">        appNewsDetail.setCategory(&quot;&quot; + flag);</span><br><span class="line">        JSONObject eventJson &#x3D; (JSONObject) JSON.toJSON(appNewsDetail);</span><br><span class="line">        return packEventJson(&quot;newsdetail&quot;, eventJson);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * å•†å“åˆ—è¡¨</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static JSONObject generateNewList() &#123;</span><br><span class="line">        AppLoading appLoading &#x3D; new AppLoading();</span><br><span class="line">        &#x2F;&#x2F; åŠ¨ä½œ</span><br><span class="line">        int flag &#x3D; rand.nextInt(3) + 1;</span><br><span class="line">        appLoading.setAction(flag + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; åŠ è½½æ—¶é•¿</span><br><span class="line">        flag &#x3D; rand.nextInt(10) * rand.nextInt(7);</span><br><span class="line">        appLoading.setLoading_time(flag + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; å¤±è´¥ç </span><br><span class="line">        flag &#x3D; rand.nextInt(10);</span><br><span class="line">        switch (flag) &#123;</span><br><span class="line">            case 1:</span><br><span class="line">                appLoading.setType1(&quot;102&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                appLoading.setType1(&quot;201&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 3:</span><br><span class="line">                appLoading.setType1(&quot;325&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 4:</span><br><span class="line">                appLoading.setType1(&quot;433&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 5:</span><br><span class="line">                appLoading.setType1(&quot;542&quot;);</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                appLoading.setType1(&quot;&quot;);</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; é¡µé¢  åŠ è½½ç±»å‹</span><br><span class="line">        flag &#x3D; 1 + rand.nextInt(2);</span><br><span class="line">        appLoading.setLoading_way(&quot;&quot; + flag);</span><br><span class="line">        &#x2F;&#x2F; æ‰©å±•å­—æ®µ1</span><br><span class="line">        appLoading.setExtend1(&quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; æ‰©å±•å­—æ®µ2</span><br><span class="line">        appLoading.setExtend2(&quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; ç”¨æˆ·åŠ è½½ç±»å‹</span><br><span class="line">        flag &#x3D; 1 + rand.nextInt(3);</span><br><span class="line">        appLoading.setType(&quot;&quot; + flag);</span><br><span class="line">        JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(appLoading);</span><br><span class="line">        return packEventJson(&quot;loading&quot;, jsonObject);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * å¹¿å‘Šç›¸å…³å­—æ®µ</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static JSONObject generateAd() &#123;</span><br><span class="line">        AppAd appAd &#x3D; new AppAd();</span><br><span class="line">        &#x2F;&#x2F; å…¥å£</span><br><span class="line">        int flag &#x3D; rand.nextInt(3) + 1;</span><br><span class="line">        appAd.setEntry(flag + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; åŠ¨ä½œ</span><br><span class="line">        flag &#x3D; rand.nextInt(5) + 1;</span><br><span class="line">        appAd.setAction(flag + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; å†…å®¹ç±»å‹ç±»å‹</span><br><span class="line">        flag &#x3D; rand.nextInt(6) + 1;</span><br><span class="line">        appAd.setContentType(flag + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; å±•ç¤ºæ ·å¼</span><br><span class="line">        flag &#x3D; rand.nextInt(120000) + 1000;</span><br><span class="line">        appAd.setDisplayMills(flag + &quot;&quot;);</span><br><span class="line">        flag &#x3D; rand.nextInt(1);</span><br><span class="line">        if (flag &#x3D;&#x3D; 1) &#123;</span><br><span class="line">            appAd.setContentType(flag + &quot;&quot;);</span><br><span class="line">            flag &#x3D; rand.nextInt(6);</span><br><span class="line">            appAd.setItemId(flag + &quot;&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            appAd.setContentType(flag + &quot;&quot;);</span><br><span class="line">            flag &#x3D; rand.nextInt(1) + 1;</span><br><span class="line">            appAd.setActivityId(flag + &quot;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(appAd);</span><br><span class="line">        return packEventJson(&quot;ad&quot;, jsonObject);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * å¯åŠ¨æ—¥å¿—</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static AppStart generateStart() &#123;</span><br><span class="line">        AppStart appStart &#x3D; new AppStart();</span><br><span class="line">        &#x2F;&#x2F;è®¾å¤‡id</span><br><span class="line">        appStart.setMid(s_mid + &quot;&quot;);</span><br><span class="line">        s_mid++;</span><br><span class="line">        &#x2F;&#x2F; ç”¨æˆ·id</span><br><span class="line">        appStart.setUid(s_uid + &quot;&quot;);</span><br><span class="line">        s_uid++;</span><br><span class="line">        &#x2F;&#x2F; ç¨‹åºç‰ˆæœ¬å· 5,6ç­‰</span><br><span class="line">        appStart.setVc(&quot;&quot; + rand.nextInt(20));</span><br><span class="line">        &#x2F;&#x2F;ç¨‹åºç‰ˆæœ¬å v1.1.1</span><br><span class="line">        appStart.setVn(&quot;1.&quot; + rand.nextInt(4) + &quot;.&quot; + rand.nextInt(10));</span><br><span class="line">        &#x2F;&#x2F; å®‰å“ç³»ç»Ÿç‰ˆæœ¬</span><br><span class="line">        appStart.setOs(&quot;8.&quot; + rand.nextInt(3) + &quot;.&quot; + rand.nextInt(10));</span><br><span class="line">        &#x2F;&#x2F;è®¾ç½®æ—¥å¿—ç±»å‹</span><br><span class="line">        appStart.setEn(&quot;start&quot;);</span><br><span class="line">        &#x2F;&#x2F;    è¯­è¨€  es,en,pt</span><br><span class="line">        int flag &#x3D; rand.nextInt(3);</span><br><span class="line">        switch (flag) &#123;</span><br><span class="line">            case (0):</span><br><span class="line">                appStart.setL(&quot;es&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case (1):</span><br><span class="line">                appStart.setL(&quot;en&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case (2):</span><br><span class="line">                appStart.setL(&quot;pt&quot;);</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; æ¸ é“å·   ä»å“ªä¸ªæ¸ é“æ¥çš„</span><br><span class="line">        appStart.setSr(getRandomChar(1));</span><br><span class="line">        &#x2F;&#x2F; åŒºåŸŸ</span><br><span class="line">        flag &#x3D; rand.nextInt(2);</span><br><span class="line">        switch (flag) &#123;</span><br><span class="line">            case 0:</span><br><span class="line">                appStart.setAr(&quot;BR&quot;);</span><br><span class="line">            case 1:</span><br><span class="line">                appStart.setAr(&quot;MX&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; æ‰‹æœºå“ç‰Œ ba ,æ‰‹æœºå‹å· mdï¼Œå°±å–2ä½æ•°å­—äº†</span><br><span class="line">        flag &#x3D; rand.nextInt(3);</span><br><span class="line">        switch (flag) &#123;</span><br><span class="line">            case 0:</span><br><span class="line">                appStart.setBa(&quot;Sumsung&quot;);</span><br><span class="line">                appStart.setMd(&quot;sumsung-&quot; + rand.nextInt(20));</span><br><span class="line">                break;</span><br><span class="line">            case 1:</span><br><span class="line">                appStart.setBa(&quot;Huawei&quot;);</span><br><span class="line">                appStart.setMd(&quot;Huawei-&quot; + rand.nextInt(20));</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                appStart.setBa(&quot;HTC&quot;);</span><br><span class="line">                appStart.setMd(&quot;HTC-&quot; + rand.nextInt(20));</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; åµŒå…¥sdkçš„ç‰ˆæœ¬</span><br><span class="line">        appStart.setSv(&quot;V2.&quot; + rand.nextInt(10) + &quot;.&quot; + rand.nextInt(10));</span><br><span class="line">        &#x2F;&#x2F; gmail</span><br><span class="line">        appStart.setG(getRandomCharAndNumr(8) + &quot;@gmail.com&quot;);</span><br><span class="line">        &#x2F;&#x2F; å±å¹•å®½é«˜ hw</span><br><span class="line">        flag &#x3D; rand.nextInt(4);</span><br><span class="line">        switch (flag) &#123;</span><br><span class="line">            case 0:</span><br><span class="line">                appStart.setHw(&quot;640*960&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 1:</span><br><span class="line">                appStart.setHw(&quot;640*1136&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                appStart.setHw(&quot;750*1134&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 3:</span><br><span class="line">                appStart.setHw(&quot;1080*1920&quot;);</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; å®¢æˆ·ç«¯äº§ç”Ÿæ—¥å¿—æ—¶é—´</span><br><span class="line">        long millis &#x3D; System.currentTimeMillis();</span><br><span class="line">        appStart.setT(&quot;&quot; + (millis - rand.nextInt(99999999)));</span><br><span class="line">        &#x2F;&#x2F; æ‰‹æœºç½‘ç»œæ¨¡å¼ 3G,4G,WIFI</span><br><span class="line">        flag &#x3D; rand.nextInt(3);</span><br><span class="line">        switch (flag) &#123;</span><br><span class="line">            case 0:</span><br><span class="line">                appStart.setNw(&quot;3G&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 1:</span><br><span class="line">                appStart.setNw(&quot;4G&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                appStart.setNw(&quot;WIFI&quot;);</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; æ‹‰ä¸ç¾æ´² è¥¿ç»34Â°46â€²è‡³è¥¿ç»117Â°09ï¼›åŒ—çº¬32Â°42â€²è‡³å—çº¬53Â°54â€²</span><br><span class="line">        &#x2F;&#x2F; ç»åº¦</span><br><span class="line">        appStart.setLn((-34 - rand.nextInt(83) - rand.nextInt(60) &#x2F; 10.0) + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; çº¬åº¦</span><br><span class="line">        appStart.setLa((32 - rand.nextInt(85) - rand.nextInt(60) &#x2F; 10.0) + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; å…¥å£</span><br><span class="line">        flag &#x3D; rand.nextInt(5) + 1;</span><br><span class="line">        appStart.setEntry(flag + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; å¼€å±å¹¿å‘Šç±»å‹</span><br><span class="line">        flag &#x3D; rand.nextInt(2) + 1;</span><br><span class="line">        appStart.setOpen_ad_type(flag + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; çŠ¶æ€</span><br><span class="line">        flag &#x3D; rand.nextInt(10) &gt; 8 ? 2 : 1;</span><br><span class="line">        appStart.setAction(flag + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; åŠ è½½æ—¶é•¿</span><br><span class="line">        appStart.setLoading_time(rand.nextInt(20) + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; å¤±è´¥ç </span><br><span class="line">        flag &#x3D; rand.nextInt(10);</span><br><span class="line">        switch (flag) &#123;</span><br><span class="line">            case 1:</span><br><span class="line">                appStart.setDetail(&quot;102&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                appStart.setDetail(&quot;201&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 3:</span><br><span class="line">                appStart.setDetail(&quot;325&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 4:</span><br><span class="line">                appStart.setDetail(&quot;433&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case 5:</span><br><span class="line">                appStart.setDetail(&quot;542&quot;);</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                appStart.setDetail(&quot;&quot;);</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; æ‰©å±•å­—æ®µ</span><br><span class="line">        appStart.setExtend1(&quot;&quot;);</span><br><span class="line">        return appStart;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * æ¶ˆæ¯é€šçŸ¥</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static JSONObject generateNotification() &#123;</span><br><span class="line">        AppNotification appNotification &#x3D; new AppNotification();</span><br><span class="line">        int flag &#x3D; rand.nextInt(4) + 1;</span><br><span class="line">        &#x2F;&#x2F; åŠ¨ä½œ</span><br><span class="line">        appNotification.setAction(flag + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; é€šçŸ¥id</span><br><span class="line">        flag &#x3D; rand.nextInt(4) + 1;</span><br><span class="line">        appNotification.setType(flag + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; å®¢æˆ·ç«¯å¼¹æ—¶é—´</span><br><span class="line">        appNotification.setAp_time((System.currentTimeMillis() - rand.nextInt(99999999)) + &quot;&quot;);</span><br><span class="line">        &#x2F;&#x2F; å¤‡ç”¨å­—æ®µ</span><br><span class="line">        appNotification.setContent(&quot;&quot;);</span><br><span class="line">        JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(appNotification);</span><br><span class="line">        return packEventJson(&quot;notification&quot;, jsonObject);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * åå°æ´»è·ƒ</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static JSONObject generateBackground() &#123;</span><br><span class="line">        AppActive appActive_background &#x3D; new AppActive();</span><br><span class="line">        &#x2F;&#x2F; å¯åŠ¨æº</span><br><span class="line">        int flag &#x3D; rand.nextInt(3) + 1;</span><br><span class="line">        appActive_background.setActive_source(flag + &quot;&quot;);</span><br><span class="line">        JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(appActive_background);</span><br><span class="line">        return packEventJson(&quot;active_background&quot;, jsonObject);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * é”™è¯¯æ—¥å¿—æ•°æ®</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static JSONObject generateError() &#123;</span><br><span class="line">        AppErrorLog appErrorLog &#x3D; new AppErrorLog();</span><br><span class="line">        String[] errorBriefs &#x3D; &#123;&quot;at cn.lift.dfdf.web.AbstractBaseController.validInbound(AbstractBaseController.java:72)&quot;, &quot;at cn.lift.appIn.control.CommandUtil.getInfo(CommandUtil.java:67)&quot;&#125;;        &#x2F;&#x2F;é”™è¯¯æ‘˜è¦</span><br><span class="line">        String[] errorDetails &#x3D; &#123;&quot;java.lang.NullPointerException\\n    &quot; + &quot;at cn.lift.appIn.web.AbstractBaseController.validInbound(AbstractBaseController.java:72)\\n &quot; + &quot;at cn.lift.dfdf.web.AbstractBaseController.validInbound&quot;, &quot;at cn.lift.dfdfdf.control.CommandUtil.getInfo(CommandUtil.java:67)\\n &quot; + &quot;at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\\n&quot; + &quot; at java.lang.reflect.Method.invoke(Method.java:606)\\n&quot;&#125;;        &#x2F;&#x2F;é”™è¯¯è¯¦æƒ…</span><br><span class="line">        &#x2F;&#x2F;é”™è¯¯æ‘˜è¦</span><br><span class="line">        appErrorLog.setErrorBrief(errorBriefs[rand.nextInt(errorBriefs.length)]);</span><br><span class="line">        &#x2F;&#x2F;é”™è¯¯è¯¦æƒ…</span><br><span class="line">        appErrorLog.setErrorDetail(errorDetails[rand.nextInt(errorDetails.length)]);</span><br><span class="line">        JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(appErrorLog);</span><br><span class="line">        return packEventJson(&quot;error&quot;, jsonObject);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * ä¸ºå„ä¸ªäº‹ä»¶ç±»å‹çš„å…¬å…±å­—æ®µï¼ˆæ—¶é—´ã€äº‹ä»¶ç±»å‹ã€Jsonæ•°æ®ï¼‰æ‹¼æ¥</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static JSONObject packEventJson(String eventName, JSONObject jsonObject) &#123;</span><br><span class="line">        JSONObject eventJson &#x3D; new JSONObject();</span><br><span class="line">        eventJson.put(&quot;ett&quot;, (System.currentTimeMillis() - rand.nextInt(99999999)) + &quot;&quot;);</span><br><span class="line">        eventJson.put(&quot;en&quot;, eventName);</span><br><span class="line">        eventJson.put(&quot;kv&quot;, jsonObject);</span><br><span class="line">        return eventJson;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * è·å–éšæœºå­—æ¯ç»„åˆ</span><br><span class="line">     *</span><br><span class="line">     * @param length å­—ç¬¦ä¸²é•¿åº¦</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static String getRandomChar(Integer length) &#123;</span><br><span class="line">        StringBuilder str &#x3D; new StringBuilder();</span><br><span class="line">        Random random &#x3D; new Random();</span><br><span class="line">        for (int i &#x3D; 0; i &lt; length; i++) &#123;</span><br><span class="line">            &#x2F;&#x2F; å­—ç¬¦ä¸²</span><br><span class="line">            str.append((char) (65 + random.nextInt(26)));&#x2F;&#x2F; å–å¾—å¤§å†™å­—æ¯</span><br><span class="line">        &#125;</span><br><span class="line">        return str.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * è·å–éšæœºå­—æ¯æ•°å­—ç»„åˆ</span><br><span class="line">     *</span><br><span class="line">     * @param length å­—ç¬¦ä¸²é•¿åº¦</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static String getRandomCharAndNumr(Integer length) &#123;</span><br><span class="line">        StringBuilder str &#x3D; new StringBuilder();</span><br><span class="line">        Random random &#x3D; new Random();</span><br><span class="line">        for (int i &#x3D; 0; i &lt; length; i++) &#123;</span><br><span class="line">            boolean b &#x3D; random.nextBoolean();</span><br><span class="line">            if (b) &#123; &#x2F;&#x2F; å­—ç¬¦ä¸²</span><br><span class="line">                &#x2F;&#x2F; int choice &#x3D; random.nextBoolean() ? 65 : 97; å–å¾—65å¤§å†™å­—æ¯è¿˜æ˜¯97å°å†™å­—æ¯</span><br><span class="line">                str.append((char) (65 + random.nextInt(26)));&#x2F;&#x2F; å–å¾—å¤§å†™å­—æ¯</span><br><span class="line">            &#125; else &#123; &#x2F;&#x2F; æ•°å­—</span><br><span class="line">                str.append(String.valueOf(random.nextInt(10)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return str.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * æ”¶è—</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static JSONObject generateFavorites() &#123;</span><br><span class="line">        AppFavorites favorites &#x3D; new AppFavorites();</span><br><span class="line">        favorites.setCourse_id(rand.nextInt(10));</span><br><span class="line">        favorites.setUserid(rand.nextInt(10));</span><br><span class="line">        favorites.setAdd_time((System.currentTimeMillis() - rand.nextInt(99999999)) + &quot;&quot;);</span><br><span class="line">        JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(favorites);</span><br><span class="line">        return packEventJson(&quot;favorites&quot;, jsonObject);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * ç‚¹èµ</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static JSONObject generatePraise() &#123;</span><br><span class="line">        AppPraise praise &#x3D; new AppPraise();</span><br><span class="line">        praise.setId(rand.nextInt(10));</span><br><span class="line">        praise.setUserid(rand.nextInt(10));</span><br><span class="line">        praise.setTarget_id(rand.nextInt(10));</span><br><span class="line">        praise.setType(rand.nextInt(4) + 1);</span><br><span class="line">        praise.setAdd_time((System.currentTimeMillis() - rand.nextInt(99999999)) + &quot;&quot;);</span><br><span class="line">        JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(praise);</span><br><span class="line">        return packEventJson(&quot;praise&quot;, jsonObject);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * è¯„è®º</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static JSONObject generateComment() &#123;</span><br><span class="line">        AppComment comment &#x3D; new AppComment();</span><br><span class="line">        comment.setComment_id(rand.nextInt(10));</span><br><span class="line">        comment.setUserid(rand.nextInt(10));</span><br><span class="line">        comment.setP_comment_id(rand.nextInt(5));</span><br><span class="line">        comment.setContent(getCONTENT());</span><br><span class="line">        comment.setAddtime((System.currentTimeMillis() - rand.nextInt(99999999)) + &quot;&quot;);</span><br><span class="line">        comment.setOther_id(rand.nextInt(10));</span><br><span class="line">        comment.setPraise_count(rand.nextInt(1000));</span><br><span class="line">        comment.setReply_count(rand.nextInt(200));</span><br><span class="line">        JSONObject jsonObject &#x3D; (JSONObject) JSON.toJSON(comment);</span><br><span class="line">        return packEventJson(&quot;comment&quot;, jsonObject);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * ç”Ÿæˆå•ä¸ªæ±‰å­—</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static char getRandomChar() &#123;</span><br><span class="line">        String str &#x3D; &quot;&quot;;</span><br><span class="line">        int hightPos; &#x2F;&#x2F;</span><br><span class="line">        int lowPos;</span><br><span class="line">        Random random &#x3D; new Random();</span><br><span class="line">        &#x2F;&#x2F;éšæœºç”Ÿæˆæ±‰å­çš„ä¸¤ä¸ªå­—èŠ‚</span><br><span class="line">        hightPos &#x3D; (176 + Math.abs(random.nextInt(39)));</span><br><span class="line">        lowPos &#x3D; (161 + Math.abs(random.nextInt(93)));</span><br><span class="line">        byte[] b &#x3D; new byte[2];</span><br><span class="line">        b[0] &#x3D; (Integer.valueOf(hightPos)).byteValue();</span><br><span class="line">        b[1] &#x3D; (Integer.valueOf(lowPos)).byteValue();</span><br><span class="line">        try &#123;</span><br><span class="line">            str &#x3D; new String(b, &quot;GBK&quot;);</span><br><span class="line">        &#125; catch (UnsupportedEncodingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(&quot;é”™è¯¯&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return str.charAt(0);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * æ‹¼æ¥æˆå¤šä¸ªæ±‰å­—</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static String getCONTENT() &#123;</span><br><span class="line">        StringBuilder str &#x3D; new StringBuilder();</span><br><span class="line">        for (int i &#x3D; 0; i &lt; rand.nextInt(100); i++) &#123;</span><br><span class="line">            str.append(getRandomChar());</span><br><span class="line">        &#125;</span><br><span class="line">        return str.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="d6c3b682"></a></p><h4 id="2-4-5-å¯åŠ¨æµ‹è¯•"><a href="#2-4-5-å¯åŠ¨æµ‹è¯•" class="headerlink" title="2.4.5 å¯åŠ¨æµ‹è¯•"></a>2.4.5 å¯åŠ¨æµ‹è¯•</h4><blockquote><p>æ³¨æ„ï¼Œéœ€è¦å°†æ—¥å¿—æ¨¡æ‹Ÿæ”¾åˆ°2å°æœåŠ¡å™¨ä¸Šï¼Œæ¨¡æ‹Ÿæ—¥å¿—æ¯ä¸€æ¡ä¸­å³åŒ…æ‹¬å…¬å…±æ—¥å¿—ï¼ŒåˆåŒ…å«äº‹ä»¶æ—¥å¿—ï¼Œéœ€è¦flumeæ‹¦æˆªå™¨è¿›è¡Œæ—¥å¿—åˆ†å‘ï¼Œå½“ç„¶ä¹Ÿéœ€è¦ä¸¤ä¸ªflume-ngæ¥åšè¿™ä¸ªäº‹æƒ…<br>æ‰“åŒ…ä¸Šä¼ 2å°æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œç”Ÿäº§æ•°æ®ä¸ºåé¢çš„æµ‹è¯•åšå‡†å¤‡ï¼Œè¿™é‡Œä¸ºç”¨æˆ·ç›®å½•testæ–‡ä»¶å¤¹ä¸‹</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445231-a9463aec-bcbe-4716-9e21-e761f37fc57e.png#align=left&display=inline&height=64&margin=%5Bobject%20Object%5D&originHeight=64&originWidth=1152&size=0&status=done&style=none&width=1152" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445356-4fb1c879-70b3-4a9b-aecd-98bc3096d13d.png#align=left&display=inline&height=61&margin=%5Bobject%20Object%5D&originHeight=61&originWidth=1150&size=0&status=done&style=none&width=1150" alt></p><blockquote><p>é€šè¿‡å‚æ•°æ§åˆ¶ç”Ÿæˆæ¶ˆæ¯é€Ÿåº¦åŠäº§é‡(å¦‚ä¸‹ 2ç§’ä¸€æ¡ï¼Œæ‰“å°1000æ¡)</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#æ§åˆ¶æ—¶é—´åŠæ¡æ•°</span><br><span class="line">nohup java -jar data-producer-1.0-SNAPSHOT-jar-with-dependencies.jar 2000 1000 &amp;</span><br><span class="line">#ç›‘æ§æ—¥å¿—</span><br><span class="line">tail -F &#x2F;root&#x2F;logs&#x2F;*.log</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445278-2645af1d-a1c6-49eb-9fae-9a2e54c6fdd1.png#align=left&display=inline&height=125&margin=%5Bobject%20Object%5D&originHeight=125&originWidth=1204&size=0&status=done&style=none&width=1204" alt></p><blockquote><p>é€šè¿‡<a href="https://www.json.cn/" target="_blank" rel="external nofollow noopener noreferrer">www.json.cn</a>æŸ¥çœ‹æ•°æ®æ ¼å¼</p></blockquote><p><a name="blogTitle10"></a></p><h2 id="3-åˆ›å»ºKafKa-Topic"><a href="#3-åˆ›å»ºKafKa-Topic" class="headerlink" title="3 åˆ›å»ºKafKa-Topic"></a>3 åˆ›å»ºKafKa-Topic</h2><ul><li>åˆ›å»ºå¯åŠ¨æ—¥å¿—ä¸»é¢˜ï¼štopic_start</li><li>åˆ›å»ºäº‹ä»¶æ—¥å¿—ä¸»é¢˜ï¼štopic_event</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445291-68eeb8c7-d2d0-4420-b26b-7008b185d7d4.png#align=left&display=inline&height=278&margin=%5Bobject%20Object%5D&originHeight=278&originWidth=918&size=0&status=done&style=none&width=918" alt><br><a name="blogTitle11"></a></p><h2 id="4-Flumeå‡†å¤‡"><a href="#4-Flumeå‡†å¤‡" class="headerlink" title="4 Flumeå‡†å¤‡"></a>4 Flumeå‡†å¤‡</h2><blockquote><p>å…±åˆ†ä¸º2ç»„flume<br>ç¬¬ä¸€ç»„ï¼šå°†æœåŠ¡å™¨æ—¥å¿—æ”¶é›†ï¼Œå¹¶ä½¿ç”¨Kafka-Channelså°†æ•°æ®å‘å¾€Kafkaä¸åŒçš„Topicï¼Œå…¶ä¸­ä½¿ç”¨æ‹¦æˆªå™¨è¿›è¡Œå…¬å…±æ—¥å¿—å’Œäº‹ä»¶æ—¥å¿—çš„åˆ†å‘ï¼Œ<br>ç¬¬äºŒç»„ï¼šæ”¶é›†Kafkaæ•°æ®ï¼Œä½¿ç”¨Flie-Channelsç¼“å­˜æ•°æ®ï¼Œæœ€ç»ˆå‘å¾€Hdfsä¿å­˜</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445578-b0c40759-4e33-4b63-899b-6757a21dca2b.png#align=left&display=inline&height=821&margin=%5Bobject%20Object%5D&originHeight=821&originWidth=1920&size=0&status=done&style=none&width=1920" alt><br><a name="blogTitle12"></a></p><h3 id="4-1-Flumeï¼šFile-gt-Kafkaé…ç½®ç¼–å†™"><a href="#4-1-Flumeï¼šFile-gt-Kafkaé…ç½®ç¼–å†™" class="headerlink" title="4.1 Flumeï¼šFile-&gt;Kafkaé…ç½®ç¼–å†™"></a>4.1 Flumeï¼šFile-&gt;Kafkaé…ç½®ç¼–å†™</h3><ul><li>vim /root/test/file-flume-kafka.conf<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#1 å®šä¹‰ç»„ä»¶</span><br><span class="line">a1.sources&#x3D;r1</span><br><span class="line">a1.channels&#x3D;c1 c2</span><br><span class="line"># 2 sourceé…ç½® typeç±»å‹ positionFileè®°å½•æ—¥å¿—è¯»å–ä½ç½® filegroupsè¯»å–å“ªäº›ç›®å½•  app.+ä¸ºè¯»å–ä»€ä¹ˆå¼€å¤´ channelså‘å¾€å“ªé‡Œ</span><br><span class="line">a1.sources.r1.type &#x3D; TAILDIR</span><br><span class="line">a1.sources.r1.positionFile &#x3D; &#x2F;root&#x2F;test&#x2F;flume&#x2F;log_position.json</span><br><span class="line">a1.sources.r1.filegroups &#x3D; f1</span><br><span class="line">a1.sources.r1.filegroups.f1 &#x3D; &#x2F;root&#x2F;logs&#x2F;app.+</span><br><span class="line">a1.sources.r1.fileHeader &#x3D; true</span><br><span class="line">a1.sources.r1.channels &#x3D; c1 c2</span><br><span class="line">#3 æ‹¦æˆªå™¨ è¿™é‡Œ2ä¸ªä¸ºè‡ªå®šä¹‰çš„æ‹¦æˆªå™¨ multiplexingä¸ºç±»å‹åŒºåˆ†é€‰æ‹©å™¨ headerå¤´ç”¨äºåŒºåˆ†ç±»å‹ mappingåŒ¹é…å¤´</span><br><span class="line">a1.sources.r1.interceptors &#x3D; i1 i2</span><br><span class="line">a1.sources.r1.interceptors.i1.type &#x3D; com.heaton.bigdata.flume.LogETLInterceptor$Builder</span><br><span class="line">a1.sources.r1.interceptors.i2.type &#x3D; com.heaton.bigdata.flume.LogTypeInterceptor$Builder</span><br><span class="line">a1.sources.r1.selector.type &#x3D; multiplexing</span><br><span class="line">a1.sources.r1.selector.header &#x3D; topic</span><br><span class="line">a1.sources.r1.selector.mapping.topic_start &#x3D; c1</span><br><span class="line">a1.sources.r1.selector.mapping.topic_event &#x3D; c2</span><br><span class="line">#4 channelé…ç½® kafkaChannel</span><br><span class="line">a1.channels.c1.type &#x3D; org.apache.flume.channel.kafka.KafkaChannel</span><br><span class="line">a1.channels.c1.kafka.bootstrap.servers &#x3D; cdh01.cm:9092,cdh02.cm:9092,cdh03.cm:9092</span><br><span class="line">a1.channels.c1.kafka.topic &#x3D; topic_start</span><br><span class="line">a1.channels.c1.parseAsFlumeEvent &#x3D; false</span><br><span class="line">a1.channels.c1.kafka.consumer.group.id &#x3D; flume-consumer</span><br><span class="line">a1.channels.c2.type &#x3D;org.apache.flume.channel.kafka.KafkaChannel</span><br><span class="line">a1.channels.c2.kafka.bootstrap.servers &#x3D; cdh01.cm:9092,cdh02.cm:9092,cdh03.cm:9092</span><br><span class="line">a1.channels.c2.kafka.topic &#x3D; topic_event</span><br><span class="line">a1.channels.c2.parseAsFlumeEvent &#x3D; false</span><br><span class="line">a1.channels.c2.kafka.consumer.group.id &#x3D; flume-consumer</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ç”Ÿäº§æ—¥å¿—çš„2å°æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šåˆ›å»ºflumeé…ç½®æ–‡ä»¶ã€‚<br>LogETLInterceptorï¼ŒLogTypeInterceptorä¸ºè‡ªå®šä¹‰æ‹¦æˆª</p></blockquote></li></ul><p><a name="blogTitle13"></a></p><h3 id="4-2-è‡ªå®šä¹‰æ‹¦æˆªå™¨"><a href="#4-2-è‡ªå®šä¹‰æ‹¦æˆªå™¨" class="headerlink" title="4.2 è‡ªå®šä¹‰æ‹¦æˆªå™¨"></a>4.2 è‡ªå®šä¹‰æ‹¦æˆªå™¨</h3><blockquote><p>data-flumeå·¥ç¨‹</p></blockquote><ul><li><p>LogUtils</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.commons.lang.math.NumberUtils;</span><br><span class="line">public class LogUtils &#123;</span><br><span class="line">    public static boolean validateEvent(String log) &#123;</span><br><span class="line">        &#x2F;** æœåŠ¡å™¨æ—¶é—´ | json</span><br><span class="line">         1588319303710|&#123;</span><br><span class="line">         &quot;cm&quot;:&#123;</span><br><span class="line">         &quot;ln&quot;:&quot;-51.5&quot;,&quot;sv&quot;:&quot;V2.0.7&quot;,&quot;os&quot;:&quot;8.0.8&quot;,&quot;g&quot;:&quot;L1470998@gmail.com&quot;,&quot;mid&quot;:&quot;13&quot;,</span><br><span class="line">         &quot;nw&quot;:&quot;4G&quot;,&quot;l&quot;:&quot;en&quot;,&quot;vc&quot;:&quot;7&quot;,&quot;hw&quot;:&quot;640*960&quot;,&quot;ar&quot;:&quot;MX&quot;,&quot;uid&quot;:&quot;13&quot;,&quot;t&quot;:&quot;1588291826938&quot;,</span><br><span class="line">         &quot;la&quot;:&quot;-38.2&quot;,&quot;md&quot;:&quot;Huawei-14&quot;,&quot;vn&quot;:&quot;1.3.6&quot;,&quot;ba&quot;:&quot;Huawei&quot;,&quot;sr&quot;:&quot;Y&quot;</span><br><span class="line">         &#125;,</span><br><span class="line">         &quot;ap&quot;:&quot;app&quot;,</span><br><span class="line">         &quot;et&quot;:[&#123;</span><br><span class="line">                &quot;ett&quot;:&quot;1588228193191&quot;,&quot;en&quot;:&quot;ad&quot;,&quot;kv&quot;:&#123;&quot;activityId&quot;:&quot;1&quot;,&quot;displayMills&quot;:&quot;113201&quot;,&quot;entry&quot;:&quot;3&quot;,&quot;action&quot;:&quot;5&quot;,&quot;contentType&quot;:&quot;0&quot;&#125;</span><br><span class="line">                &#125;,&#123;</span><br><span class="line">                &quot;ett&quot;:&quot;1588300304713&quot;,&quot;en&quot;:&quot;notification&quot;,&quot;kv&quot;:&#123;&quot;ap_time&quot;:&quot;1588277440794&quot;,&quot;action&quot;:&quot;2&quot;,&quot;type&quot;:&quot;3&quot;,&quot;content&quot;:&quot;&quot;&#125;</span><br><span class="line">                &#125;,&#123;</span><br><span class="line">                &quot;ett&quot;:&quot;1588249203743&quot;,&quot;en&quot;:&quot;active_background&quot;,&quot;kv&quot;:&#123;&quot;active_source&quot;:&quot;3&quot;&#125;</span><br><span class="line">                &#125;,&#123;</span><br><span class="line">                &quot;ett&quot;:&quot;1588254200122&quot;,&quot;en&quot;:&quot;favorites&quot;,&quot;kv&quot;:&#123;&quot;course_id&quot;:5,&quot;id&quot;:0,&quot;add_time&quot;:&quot;1588264138625&quot;,&quot;userid&quot;:0&#125;</span><br><span class="line">                &#125;,&#123;</span><br><span class="line">                &quot;ett&quot;:&quot;1588281152824&quot;,&quot;en&quot;:&quot;praise&quot;,&quot;kv&quot;:&#123;&quot;target_id&quot;:4,&quot;id&quot;:3,&quot;type&quot;:3,&quot;add_time&quot;:&quot;1588307696417&quot;,&quot;userid&quot;:8&#125;</span><br><span class="line">                &#125;]</span><br><span class="line">         &#125;</span><br><span class="line">         *&#x2F;</span><br><span class="line">        &#x2F;&#x2F; 1 åˆ‡å‰²</span><br><span class="line">        String[] logContents &#x3D; log.split(&quot;\\|&quot;);</span><br><span class="line">        &#x2F;&#x2F; 2 æ ¡éªŒ</span><br><span class="line">        if (logContents.length !&#x3D; 2) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;3 æ ¡éªŒæœåŠ¡å™¨æ—¶é—´</span><br><span class="line">        if (logContents[0].length() !&#x3D; 13 || !NumberUtils.isDigits(logContents[0])) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; 4 æ ¡éªŒ json</span><br><span class="line">        if (!logContents[1].trim().startsWith(&quot;&#123;&quot;)</span><br><span class="line">                || !logContents[1].trim().endsWith(&quot;&#125;&quot;)) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    public static boolean validateStart(String log) &#123;</span><br><span class="line">        &#x2F;**</span><br><span class="line">         &#123;</span><br><span class="line">         &quot;action&quot;:&quot;1&quot;,&quot;ar&quot;:&quot;MX&quot;,&quot;ba&quot;:&quot;HTC&quot;,&quot;detail&quot;:&quot;201&quot;,&quot;en&quot;:&quot;start&quot;,&quot;entry&quot;:&quot;4&quot;,&quot;extend1&quot;:&quot;&quot;,</span><br><span class="line">         &quot;g&quot;:&quot;4Z174142@gmail.com&quot;,&quot;hw&quot;:&quot;750*1134&quot;,&quot;l&quot;:&quot;pt&quot;,&quot;la&quot;:&quot;-29.7&quot;,&quot;ln&quot;:&quot;-48.1&quot;,&quot;loading_time&quot;:&quot;0&quot;,</span><br><span class="line">         &quot;md&quot;:&quot;HTC-18&quot;,&quot;mid&quot;:&quot;14&quot;,&quot;nw&quot;:&quot;3G&quot;,&quot;open_ad_type&quot;:&quot;2&quot;,&quot;os&quot;:&quot;8.0.8&quot;,&quot;sr&quot;:&quot;D&quot;,&quot;sv&quot;:&quot;V2.8.2&quot;,</span><br><span class="line">         &quot;t&quot;:&quot;1588251833523&quot;,&quot;uid&quot;:&quot;14&quot;,&quot;vc&quot;:&quot;15&quot;,&quot;vn&quot;:&quot;1.2.9&quot;</span><br><span class="line">         &#125;</span><br><span class="line">        *&#x2F;</span><br><span class="line">        if (log &#x3D;&#x3D; null) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; æ ¡éªŒ json</span><br><span class="line">        if (!log.trim().startsWith(&quot;&#123;&quot;) || !log.trim().endsWith(&quot;&#125;&quot;)) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>LogETLInterceptor</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.flume.Context;</span><br><span class="line">import org.apache.flume.Event;</span><br><span class="line">import org.apache.flume.interceptor.Interceptor;</span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">public class LogETLInterceptor implements Interceptor &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void initialize() &#123;</span><br><span class="line">    &#x2F;&#x2F;åˆå§‹åŒ–</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public Event intercept(Event event) &#123;</span><br><span class="line">        &#x2F;&#x2F; 1 è·å–æ•°æ®</span><br><span class="line">        byte[] body &#x3D; event.getBody();</span><br><span class="line">        String log &#x3D; new String(body, Charset.forName(&quot;UTF-8&quot;));</span><br><span class="line">        &#x2F;&#x2F; 2 åˆ¤æ–­æ•°æ®ç±»å‹å¹¶å‘ Header ä¸­èµ‹å€¼</span><br><span class="line">        if (log.contains(&quot;start&quot;)) &#123;</span><br><span class="line">            if (LogUtils.validateStart(log)) &#123;</span><br><span class="line">                return event;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if (LogUtils.validateEvent(log)) &#123;</span><br><span class="line">                return event;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; 3 è¿”å›æ ¡éªŒç»“æœ</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;Event&gt; intercept(List&lt;Event&gt; events) &#123;</span><br><span class="line">        ArrayList&lt;Event&gt; interceptors &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">        for (Event event : events) &#123;</span><br><span class="line">            Event intercept1 &#x3D; intercept(event);</span><br><span class="line">            if (intercept1 !&#x3D; null) &#123;</span><br><span class="line">                interceptors.add(intercept1);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return interceptors;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void close() &#123;</span><br><span class="line">    &#x2F;&#x2F;å…³é—­</span><br><span class="line">    &#125;</span><br><span class="line">    public static class Builder implements Interceptor.Builder &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public Interceptor build() &#123;</span><br><span class="line">            return new LogETLInterceptor();</span><br><span class="line">        &#125;</span><br><span class="line">        @Override</span><br><span class="line">        public void configure(Context context) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>LogTypeInterceptor</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.flume.Context;</span><br><span class="line">import org.apache.flume.Event;</span><br><span class="line">import org.apache.flume.interceptor.Interceptor;</span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">public class LogTypeInterceptor implements Interceptor &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void initialize() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public Event intercept(Event event) &#123;</span><br><span class="line">        &#x2F;&#x2F; åŒºåˆ†æ—¥å¿—ç±»å‹ï¼š body header</span><br><span class="line">        &#x2F;&#x2F; 1 è·å– body æ•°æ®</span><br><span class="line">        byte[] body &#x3D; event.getBody();</span><br><span class="line">        String log &#x3D; new String(body, Charset.forName(&quot;UTF-8&quot;));</span><br><span class="line">        &#x2F;&#x2F; 2 è·å– header</span><br><span class="line">        Map&lt;String, String&gt; headers &#x3D; event.getHeaders();</span><br><span class="line">        &#x2F;&#x2F; 3 åˆ¤æ–­æ•°æ®ç±»å‹å¹¶å‘ Header ä¸­èµ‹å€¼</span><br><span class="line">        if (log.contains(&quot;start&quot;)) &#123;</span><br><span class="line">            headers.put(&quot;topic&quot;, &quot;topic_start&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            headers.put(&quot;topic&quot;, &quot;topic_event&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return event;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;Event&gt; intercept(List&lt;Event&gt; events) &#123;</span><br><span class="line">        ArrayList&lt;Event&gt; interceptors &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">        for (Event event : events) &#123;</span><br><span class="line">            Event intercept1 &#x3D; intercept(event);</span><br><span class="line">            interceptors.add(intercept1);</span><br><span class="line">        &#125;</span><br><span class="line">        return interceptors;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void close() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    public static class Builder implements Interceptor.Builder &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public Interceptor build() &#123;</span><br><span class="line">            return new LogTypeInterceptor();</span><br><span class="line">        &#125;</span><br><span class="line">        @Override</span><br><span class="line">        public void configure(Context context) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å°†é¡¹ç›®æ‰“åŒ…æ”¾å…¥Flume/libç›®å½•ä¸‹(æ‰€æœ‰èŠ‚ç‚¹)ï¼š<br>CDHè·¯å¾„å‚è€ƒï¼š/opt/cloudera/parcels/CDH-6.2.0-1.cdh6.2.0.p0.967373/lib/flume-ng/lib</p></blockquote></li></ul><p><a name="blogTitle14"></a></p><h3 id="4-3-Flumeå¯åœè„šæœ¬"><a href="#4-3-Flumeå¯åœè„šæœ¬" class="headerlink" title="4.3 Flumeå¯åœè„šæœ¬"></a>4.3 Flumeå¯åœè„šæœ¬</h3><ul><li><p>vim /root/log-kafka-flume.sh</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#! &#x2F;bin&#x2F;bash</span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)&#123;</span><br><span class="line">	for i in cdh02.cm cdh03.cm</span><br><span class="line">	do</span><br><span class="line">		echo &quot; --------å¯åŠ¨ $i æ¶ˆè´¹ flume-------&quot;</span><br><span class="line">		ssh $i &quot;nohup flume-ng agent --conf-file &#x2F;root&#x2F;test&#x2F;file-flume-kafka.conf --name a1 -Dflume.root.logger&#x3D;INFO,LOGFILE &gt;&#x2F;root&#x2F;test&#x2F;file-flume-kafka.log 2&gt;&amp;1 &amp;&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;;;</span><br><span class="line">&quot;stop&quot;)&#123;</span><br><span class="line">	for i in cdh02.cm cdh03.cm</span><br><span class="line">	do</span><br><span class="line">		echo &quot; --------åœæ­¢ $i æ¶ˆè´¹ flume-------&quot;</span><br><span class="line">		ssh $i &quot;ps -ef | grep file-flume-kafka | grep -v grep |awk &#39;&#123;print \$2&#125;&#39; | xargs kill&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445286-e3d74a0a-846a-497d-9395-835dc06bbe36.png#align=left&display=inline&height=378&margin=%5Bobject%20Object%5D&originHeight=378&originWidth=1509&size=0&status=done&style=none&width=1509" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445293-b89b1d01-98f1-4ea2-9a5f-8b49b3bb9549.png#align=left&display=inline&height=385&margin=%5Bobject%20Object%5D&originHeight=385&originWidth=1511&size=0&status=done&style=none&width=1511" alt><br><a name="blogTitle15"></a></p><h3 id="4-4-Flumeï¼šKafka-gt-HDFSé…ç½®ç¼–å†™"><a href="#4-4-Flumeï¼šKafka-gt-HDFSé…ç½®ç¼–å†™" class="headerlink" title="4.4 Flumeï¼šKafka-&gt;HDFSé…ç½®ç¼–å†™"></a>4.4 Flumeï¼šKafka-&gt;HDFSé…ç½®ç¼–å†™</h3><blockquote><p>åœ¨ç¬¬ä¸‰å°æœåŠ¡ä¸Šå‡†å¤‡</p></blockquote></li><li><p>vim /root/test/kafka-flume-hdfs.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">## ç»„ä»¶ </span><br><span class="line">a1.sources&#x3D;r1 r2</span><br><span class="line">a1.channels&#x3D;c1 c2 </span><br><span class="line">a1.sinks&#x3D;k1 k2</span><br><span class="line">    </span><br><span class="line">## Kafka-source1</span><br><span class="line">a1.sources.r1.type &#x3D; org.apache.flume.source.kafka.KafkaSource</span><br><span class="line">a1.sources.r1.batchSize &#x3D; 5000</span><br><span class="line">a1.sources.r1.batchDurationMillis &#x3D; 2000</span><br><span class="line">a1.sources.r1.kafka.bootstrap.servers&#x3D; cdh01.cm:9092,cdh02.cm:9092,cdh03.cm:9092</span><br><span class="line">a1.sources.r1.kafka.topics &#x3D; topic_start</span><br><span class="line">## Kafka- source2</span><br><span class="line">a1.sources.r2.type &#x3D; org.apache.flume.source.kafka.KafkaSource</span><br><span class="line">a1.sources.r2.batchSize &#x3D; 5000</span><br><span class="line">a1.sources.r2.batchDurationMillis &#x3D; 2000</span><br><span class="line">a1.sources.r2.kafka.bootstrap.servers &#x3D; cdh01.cm:9092,cdh02.cm:9092,cdh03.cm:9092</span><br><span class="line">a1.sources.r2.kafka.topics &#x3D; topic_event</span><br><span class="line">    </span><br><span class="line">## channel1</span><br><span class="line">a1.channels.c1.type &#x3D; file</span><br><span class="line">##ç´¢å¼•æ–‡ä»¶è·¯å¾„</span><br><span class="line">a1.channels.c1.checkpointDir&#x3D;&#x2F;root&#x2F;test&#x2F;flume&#x2F;checkpoint&#x2F;behavior1</span><br><span class="line">##æŒä¹…åŒ–è·¯å¾„</span><br><span class="line">a1.channels.c1.dataDirs &#x3D; &#x2F;root&#x2F;test&#x2F;flume&#x2F;data&#x2F;behavior1&#x2F;</span><br><span class="line">a1.channels.c1.maxFileSize &#x3D; 2146435071</span><br><span class="line">a1.channels.c1.capacity &#x3D; 1000000</span><br><span class="line">a1.channels.c1.keep-alive &#x3D; 6</span><br><span class="line">## channel2</span><br><span class="line">a1.channels.c2.type &#x3D; file</span><br><span class="line">##ç´¢å¼•æ–‡ä»¶è·¯å¾„</span><br><span class="line">a1.channels.c1.checkpointDir&#x3D;&#x2F;root&#x2F;test&#x2F;flume&#x2F;checkpoint&#x2F;behavior2</span><br><span class="line">##æŒä¹…åŒ–è·¯å¾„</span><br><span class="line">a1.channels.c1.dataDirs &#x3D; &#x2F;root&#x2F;test&#x2F;flume&#x2F;data&#x2F;behavior2&#x2F;</span><br><span class="line">a1.channels.c2.maxFileSize &#x3D; 2146435071</span><br><span class="line">a1.channels.c2.capacity &#x3D; 1000000</span><br><span class="line">a1.channels.c2.keep-alive &#x3D; 6</span><br><span class="line">    </span><br><span class="line">## HDFS-sink1</span><br><span class="line">a1.sinks.k1.type &#x3D; hdfs</span><br><span class="line">a1.sinks.k1.hdfs.path&#x3D;&#x2F;origin_data&#x2F;gmall&#x2F;log&#x2F;topic_start&#x2F;%Y-%m-%d</span><br><span class="line">a1.sinks.k1.hdfs.filePrefix &#x3D; logstart-</span><br><span class="line">## HDFS-sink2       </span><br><span class="line">a1.sinks.k2.type &#x3D; hdfs</span><br><span class="line">a1.sinks.k2.hdfs.path &#x3D; &#x2F;origin_data&#x2F;gmall&#x2F;log&#x2F;topic_event&#x2F;%Y-%m-%d</span><br><span class="line">a1.sinks.k2.hdfs.filePrefix &#x3D; logevent-</span><br><span class="line">    </span><br><span class="line">## ä¸è¦äº§ç”Ÿå¤§é‡å°æ–‡ä»¶</span><br><span class="line">a1.sinks.k1.hdfs.rollInterval &#x3D; 10</span><br><span class="line">a1.sinks.k1.hdfs.rollSize &#x3D; 134217728</span><br><span class="line">a1.sinks.k1.hdfs.rollCount &#x3D; 0</span><br><span class="line">a1.sinks.k2.hdfs.rollInterval &#x3D; 50</span><br><span class="line">a1.sinks.k2.hdfs.rollSize &#x3D; 134217728</span><br><span class="line">a1.sinks.k2.hdfs.rollCount &#x3D; 0</span><br><span class="line">## æ§åˆ¶è¾“å‡ºæ–‡ä»¶æ˜¯åŸç”Ÿæ–‡ä»¶ã€‚</span><br><span class="line">a1.sinks.k1.hdfs.fileType &#x3D; CompressedStream</span><br><span class="line">a1.sinks.k2.hdfs.fileType &#x3D; CompressedStream</span><br><span class="line">a1.sinks.k1.hdfs.codeC &#x3D; snappy</span><br><span class="line">a1.sinks.k2.hdfs.codeC &#x3D; snappy</span><br><span class="line">    </span><br><span class="line">## ç»„ä»¶æ‹¼è£…</span><br><span class="line">a1.sources.r1.channels &#x3D; c1</span><br><span class="line">a1.sinks.k1.channel&#x3D; c1</span><br><span class="line">a1.sources.r2.channels &#x3D; c2</span><br><span class="line">a1.sinks.k2.channel&#x3D; c2</span><br></pre></td></tr></table></figure><p><a name="blogTitle16"></a></p><h3 id="4-5-Flumeå¯åœè„šæœ¬"><a href="#4-5-Flumeå¯åœè„šæœ¬" class="headerlink" title="4.5 Flumeå¯åœè„šæœ¬"></a>4.5 Flumeå¯åœè„šæœ¬</h3><blockquote><p>åœ¨ç¬¬ä¸‰å°æœåŠ¡ä¸Šå‡†å¤‡</p></blockquote></li><li><p>vim /root/test/kafka-hdfs-flume.sh</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#! &#x2F;bin&#x2F;bash</span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)&#123;</span><br><span class="line">	for i in cdh01.cm</span><br><span class="line">	do</span><br><span class="line">		echo &quot; --------å¯åŠ¨ $i æ¶ˆè´¹ flume-------&quot;</span><br><span class="line">		ssh $i &quot;nohup flume-ng agent --conf-file &#x2F;root&#x2F;test&#x2F;kafka-flume-hdfs.conf --name a1 -Dflume.root.logger&#x3D;INFO,LOGFILE &gt;&#x2F;root&#x2F;test&#x2F;kafka-flume-hdfs.log 2&gt;&amp;1 &amp;&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;;;</span><br><span class="line">&quot;stop&quot;)&#123;</span><br><span class="line">	for i in cdh01.cm</span><br><span class="line">	do</span><br><span class="line">		echo &quot; --------åœæ­¢ $i æ¶ˆè´¹ flume-------&quot;</span><br><span class="line">		ssh $i &quot;ps -ef | grep kafka-flume-hdfs | grep -v grep |awk &#39;&#123;print \$2&#125;&#39; | xargs kill&quot;</span><br><span class="line">	done</span><br><span class="line">&#125;;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure></li></ul><p><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445281-63bb8866-411b-4829-b0b3-0d989bca1884.png#align=left&display=inline&height=571&margin=%5Bobject%20Object%5D&originHeight=571&originWidth=1159&size=0&status=done&style=none&width=1159" alt><br><a name="blogTitle17"></a></p><h2 id="5-ä¸šåŠ¡æ•°æ®"><a href="#5-ä¸šåŠ¡æ•°æ®" class="headerlink" title="5 ä¸šåŠ¡æ•°æ®"></a>5 ä¸šåŠ¡æ•°æ®</h2><blockquote><p>æ­¤æ¨¡å—åä¸»è¦é’ˆå¯¹äºä¼ä¸šæŠ¥è¡¨å†³ç­–ï¼Œä¸ºæ•°æ®åˆ†ææä¾›æ•°æ®æ”¯æŒï¼Œè§£å†³å¤§æ•°æ®é‡ä¸‹ï¼Œæ— æ³•å¿«é€Ÿäº§å‡ºæŠ¥è¡¨ï¼ŒåŠä¸€äº›å³å¸­ä¸šåŠ¡éœ€æ±‚çš„å¿«é€Ÿå±•ç¤ºæä¾›æ•°æ®æ”¯æ’‘ã€‚åˆ’åˆ†ä¼ä¸šç¦»çº¿ä¸å®æ—¶ä¸šåŠ¡ï¼Œç”¨ç¦»çº¿çš„æ–¹å¼ç›´è§‚çš„ç®¡ç†æ•°æ®å‘ˆç°ï¼Œä¸ºå®æ—¶æ–¹æ¡ˆå¥ å®šè‰¯å¥½åŸºç¡€ã€‚</p></blockquote><p><a name="blogTitle18"></a></p><h3 id="5-1-ç”µå•†ä¸šåŠ¡æµç¨‹"><a href="#5-1-ç”µå•†ä¸šåŠ¡æµç¨‹" class="headerlink" title="5.1 ç”µå•†ä¸šåŠ¡æµç¨‹"></a>5.1 ç”µå•†ä¸šåŠ¡æµç¨‹</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445499-c8b438ec-8428-4251-83c3-daecf0ea0f47.png#align=left&display=inline&height=647&margin=%5Bobject%20Object%5D&originHeight=647&originWidth=959&size=0&status=done&style=none&width=959" alt><br><a name="blogTitle19"></a></p><h3 id="5-2-SKU-SPU"><a href="#5-2-SKU-SPU" class="headerlink" title="5.2 SKU-SPU"></a>5.2 SKU-SPU</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445306-c312505f-c425-4ba5-97ee-9970d00d11df.png#align=left&display=inline&height=603&margin=%5Bobject%20Object%5D&originHeight=603&originWidth=1244&size=0&status=done&style=none&width=1244" alt></p><ul><li>SKUï¼ˆStock Keeping Unitï¼‰ï¼šåº“å­˜é‡åŸºæœ¬å•ä½ï¼Œç°åœ¨å·²ç»è¢«å¼•ç”³ä¸ºäº§å“ç»Ÿä¸€ç¼–å·çš„ç®€ç§°ï¼Œ æ¯ç§äº§å“å‡å¯¹åº”æœ‰å”¯ä¸€çš„ SKU å·ã€‚</li><li>SPUï¼ˆStandard Product Unitï¼‰ï¼šæ˜¯å•†å“ä¿¡æ¯èšåˆçš„æœ€å°å•ä½ï¼Œæ˜¯ä¸€ç»„å¯å¤ç”¨ã€æ˜“æ£€ç´¢çš„ æ ‡å‡†åŒ–ä¿¡æ¯é›†åˆã€‚</li><li>æ€»ç»“ï¼šé»‘é²¨3 æ‰‹æœºå°±æ˜¯ SPUã€‚ä¸€å°é“ ç”²ç°ã€256G å†…å­˜çš„å°±æ˜¯ SKUã€‚<br><a name="blogTitle20"></a><h3 id="5-3-ä¸šåŠ¡è¡¨ç»“æ„"><a href="#5-3-ä¸šåŠ¡è¡¨ç»“æ„" class="headerlink" title="5.3 ä¸šåŠ¡è¡¨ç»“æ„"></a>5.3 ä¸šåŠ¡è¡¨ç»“æ„</h3><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445320-2cc623a5-0587-4abf-a3ae-daaaf038854d.png#align=left&display=inline&height=682&margin=%5Bobject%20Object%5D&originHeight=682&originWidth=1134&size=0&status=done&style=none&width=1134" alt><br><a name="2a0538a3"></a><h4 id="5-3-1-è®¢å•è¡¨ï¼ˆorder-infoï¼‰"><a href="#5-3-1-è®¢å•è¡¨ï¼ˆorder-infoï¼‰" class="headerlink" title="5.3.1 è®¢å•è¡¨ï¼ˆorder_infoï¼‰"></a>5.3.1 è®¢å•è¡¨ï¼ˆorder_infoï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445293-807044ab-66a1-4421-823b-b7945c79f048.png#align=left&display=inline&height=370&margin=%5Bobject%20Object%5D&originHeight=370&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="e3c30ff7"></a><h4 id="5-3-2-è®¢å•è¯¦æƒ…è¡¨ï¼ˆorder-detailï¼‰"><a href="#5-3-2-è®¢å•è¯¦æƒ…è¡¨ï¼ˆorder-detailï¼‰" class="headerlink" title="5.3.2 è®¢å•è¯¦æƒ…è¡¨ï¼ˆorder_detailï¼‰"></a>5.3.2 è®¢å•è¯¦æƒ…è¡¨ï¼ˆorder_detailï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445421-3fefa623-d4e1-4458-9247-ceafcc11bbd9.png#align=left&display=inline&height=188&margin=%5Bobject%20Object%5D&originHeight=188&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="ef4539a6"></a><h4 id="5-3-3-SKU-å•†å“è¡¨ï¼ˆsku-infoï¼‰"><a href="#5-3-3-SKU-å•†å“è¡¨ï¼ˆsku-infoï¼‰" class="headerlink" title="5.3.3 SKU å•†å“è¡¨ï¼ˆsku_infoï¼‰"></a>5.3.3 SKU å•†å“è¡¨ï¼ˆsku_infoï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445457-375551a4-5ba5-4fe2-8594-36a86445a0e9.png#align=left&display=inline&height=224&margin=%5Bobject%20Object%5D&originHeight=224&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="9ecdba66"></a><h4 id="5-3-4-ç”¨æˆ·è¡¨ï¼ˆuser-infoï¼‰"><a href="#5-3-4-ç”¨æˆ·è¡¨ï¼ˆuser-infoï¼‰" class="headerlink" title="5.3.4 ç”¨æˆ·è¡¨ï¼ˆuser_infoï¼‰"></a>5.3.4 ç”¨æˆ·è¡¨ï¼ˆuser_infoï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445409-4fcce741-b0a9-40fe-ae2a-e0669c51338b.png#align=left&display=inline&height=261&margin=%5Bobject%20Object%5D&originHeight=261&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="4097e291"></a><h4 id="5-3-5-å•†å“ä¸€çº§åˆ†ç±»è¡¨ï¼ˆbase-category1ï¼‰"><a href="#5-3-5-å•†å“ä¸€çº§åˆ†ç±»è¡¨ï¼ˆbase-category1ï¼‰" class="headerlink" title="5.3.5 å•†å“ä¸€çº§åˆ†ç±»è¡¨ï¼ˆbase_category1ï¼‰"></a>5.3.5 å•†å“ä¸€çº§åˆ†ç±»è¡¨ï¼ˆbase_category1ï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445599-b968e841-b432-4d76-87e3-e4e4990466c9.png#align=left&display=inline&height=93&margin=%5Bobject%20Object%5D&originHeight=93&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="edd3477b"></a><h4 id="5-3-6-å•†å“äºŒçº§åˆ†ç±»è¡¨ï¼ˆbase-category2ï¼‰"><a href="#5-3-6-å•†å“äºŒçº§åˆ†ç±»è¡¨ï¼ˆbase-category2ï¼‰" class="headerlink" title="5.3.6 å•†å“äºŒçº§åˆ†ç±»è¡¨ï¼ˆbase_category2ï¼‰"></a>5.3.6 å•†å“äºŒçº§åˆ†ç±»è¡¨ï¼ˆbase_category2ï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445399-404c5075-6615-4886-8101-ae6a9a2ea836.png#align=left&display=inline&height=99&margin=%5Bobject%20Object%5D&originHeight=99&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="761365da"></a><h4 id="5-3-7-å•†å“ä¸‰çº§åˆ†ç±»è¡¨ï¼ˆbase-category3ï¼‰"><a href="#5-3-7-å•†å“ä¸‰çº§åˆ†ç±»è¡¨ï¼ˆbase-category3ï¼‰" class="headerlink" title="5.3.7 å•†å“ä¸‰çº§åˆ†ç±»è¡¨ï¼ˆbase_category3ï¼‰"></a>5.3.7 å•†å“ä¸‰çº§åˆ†ç±»è¡¨ï¼ˆbase_category3ï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445762-7d1a4322-7ef5-4fe2-bb8b-ef97c0bcbb9a.png#align=left&display=inline&height=103&margin=%5Bobject%20Object%5D&originHeight=103&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="d73753a2"></a><h4 id="5-3-8-æ”¯ä»˜æµæ°´è¡¨ï¼ˆpayment-infoï¼‰"><a href="#5-3-8-æ”¯ä»˜æµæ°´è¡¨ï¼ˆpayment-infoï¼‰" class="headerlink" title="5.3.8 æ”¯ä»˜æµæ°´è¡¨ï¼ˆpayment_infoï¼‰"></a>5.3.8 æ”¯ä»˜æµæ°´è¡¨ï¼ˆpayment_infoï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445446820-0341ff71-434e-4a82-8036-eba14a8476b9.png#align=left&display=inline&height=199&margin=%5Bobject%20Object%5D&originHeight=199&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="8e375166"></a><h4 id="5-3-9-çœä»½è¡¨ï¼ˆbase-provinceï¼‰"><a href="#5-3-9-çœä»½è¡¨ï¼ˆbase-provinceï¼‰" class="headerlink" title="5.3.9 çœä»½è¡¨ï¼ˆbase_provinceï¼‰"></a>5.3.9 çœä»½è¡¨ï¼ˆbase_provinceï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445408-12faad35-63c2-4718-ac13-83b26354b3c3.png#align=left&display=inline&height=119&margin=%5Bobject%20Object%5D&originHeight=119&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="d0920d19"></a><h4 id="5-3-10-åœ°åŒºè¡¨ï¼ˆbase-regionï¼‰"><a href="#5-3-10-åœ°åŒºè¡¨ï¼ˆbase-regionï¼‰" class="headerlink" title="5.3.10 åœ°åŒºè¡¨ï¼ˆbase_regionï¼‰"></a>5.3.10 åœ°åŒºè¡¨ï¼ˆbase_regionï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445709-051d048d-66ef-40a7-981a-8538094858a6.png#align=left&display=inline&height=72&margin=%5Bobject%20Object%5D&originHeight=72&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="3df9abe4"></a><h4 id="5-3-11-å“ç‰Œè¡¨ï¼ˆbase-trademarkï¼‰"><a href="#5-3-11-å“ç‰Œè¡¨ï¼ˆbase-trademarkï¼‰" class="headerlink" title="5.3.11 å“ç‰Œè¡¨ï¼ˆbase_trademarkï¼‰"></a>5.3.11 å“ç‰Œè¡¨ï¼ˆbase_trademarkï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445417-956df41f-c8d8-43e9-a9ef-478c4e16fa95.png#align=left&display=inline&height=106&margin=%5Bobject%20Object%5D&originHeight=106&originWidth=1277&size=0&status=done&style=none&width=1277" alt><br><a name="e1eb5124"></a><h4 id="5-3-12-è®¢å•çŠ¶æ€è¡¨ï¼ˆorder-status-logï¼‰"><a href="#5-3-12-è®¢å•çŠ¶æ€è¡¨ï¼ˆorder-status-logï¼‰" class="headerlink" title="5.3.12 è®¢å•çŠ¶æ€è¡¨ï¼ˆorder_status_logï¼‰"></a>5.3.12 è®¢å•çŠ¶æ€è¡¨ï¼ˆorder_status_logï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445403-6ebe9cc2-6007-4e39-9647-1d63cb9886f4.png#align=left&display=inline&height=118&margin=%5Bobject%20Object%5D&originHeight=118&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="dbb7a316"></a><h4 id="5-3-13-SPU-å•†å“è¡¨ï¼ˆspu-infoï¼‰"><a href="#5-3-13-SPU-å•†å“è¡¨ï¼ˆspu-infoï¼‰" class="headerlink" title="5.3.13 SPU å•†å“è¡¨ï¼ˆspu_infoï¼‰"></a>5.3.13 SPU å•†å“è¡¨ï¼ˆspu_infoï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445616-7c564b8c-e4be-4942-a245-5a986b440689.png#align=left&display=inline&height=136&margin=%5Bobject%20Object%5D&originHeight=136&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="afc9aaeb"></a><h4 id="5-3-14-å•†å“è¯„è®ºè¡¨ï¼ˆcomment-infoï¼‰"><a href="#5-3-14-å•†å“è¯„è®ºè¡¨ï¼ˆcomment-infoï¼‰" class="headerlink" title="5.3.14 å•†å“è¯„è®ºè¡¨ï¼ˆcomment_infoï¼‰"></a>5.3.14 å•†å“è¯„è®ºè¡¨ï¼ˆcomment_infoï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445432-2a0d5fa0-0fcf-45b9-9d62-a3c97be4ced3.png#align=left&display=inline&height=260&margin=%5Bobject%20Object%5D&originHeight=260&originWidth=1132&size=0&status=done&style=none&width=1132" alt><br><a name="3cd84c4c"></a><h4 id="5-3-15-é€€å•è¡¨ï¼ˆorder-refund-infoï¼‰"><a href="#5-3-15-é€€å•è¡¨ï¼ˆorder-refund-infoï¼‰" class="headerlink" title="5.3.15 é€€å•è¡¨ï¼ˆorder_refund_infoï¼‰"></a>5.3.15 é€€å•è¡¨ï¼ˆorder_refund_infoï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445415-560c225d-39ad-4e97-ae5e-feded91e61bc.png#align=left&display=inline&height=211&margin=%5Bobject%20Object%5D&originHeight=211&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="86808c1f"></a><h4 id="5-3-16-åŠ å…¥è´­ç‰©è½¦è¡¨ï¼ˆcart-infoï¼‰"><a href="#5-3-16-åŠ å…¥è´­ç‰©è½¦è¡¨ï¼ˆcart-infoï¼‰" class="headerlink" title="5.3.16 åŠ å…¥è´­ç‰©è½¦è¡¨ï¼ˆcart_infoï¼‰"></a>5.3.16 åŠ å…¥è´­ç‰©è½¦è¡¨ï¼ˆcart_infoï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445420-ec008b1a-ac25-4d67-8f30-a4f22f8bf986.png#align=left&display=inline&height=229&margin=%5Bobject%20Object%5D&originHeight=229&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="e396f00d"></a><h4 id="5-3-17-å•†å“æ”¶è—è¡¨ï¼ˆfavor-infoï¼‰"><a href="#5-3-17-å•†å“æ”¶è—è¡¨ï¼ˆfavor-infoï¼‰" class="headerlink" title="5.3.17 å•†å“æ”¶è—è¡¨ï¼ˆfavor_infoï¼‰"></a>5.3.17 å•†å“æ”¶è—è¡¨ï¼ˆfavor_infoï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445413-5bc2fefc-43ea-4198-962a-68e04c3693b5.png#align=left&display=inline&height=167&margin=%5Bobject%20Object%5D&originHeight=167&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="599c2d57"></a><h4 id="5-3-18-ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨ï¼ˆcoupon-useï¼‰"><a href="#5-3-18-ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨ï¼ˆcoupon-useï¼‰" class="headerlink" title="5.3.18 ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨ï¼ˆcoupon_useï¼‰"></a>5.3.18 ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨ï¼ˆcoupon_useï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445440-5134d8aa-2085-457c-bb47-4ba611528bc1.png#align=left&display=inline&height=193&margin=%5Bobject%20Object%5D&originHeight=193&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="597f8aa7"></a><h4 id="5-3-19-ä¼˜æƒ åˆ¸è¡¨ï¼ˆcoupon-infoï¼‰"><a href="#5-3-19-ä¼˜æƒ åˆ¸è¡¨ï¼ˆcoupon-infoï¼‰" class="headerlink" title="5.3.19 ä¼˜æƒ åˆ¸è¡¨ï¼ˆcoupon_infoï¼‰"></a>5.3.19 ä¼˜æƒ åˆ¸è¡¨ï¼ˆcoupon_infoï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445469-06ad320b-4efb-4e48-b359-66b5a0180987.png#align=left&display=inline&height=306&margin=%5Bobject%20Object%5D&originHeight=306&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="14b73501"></a><h4 id="5-3-20-æ´»åŠ¨è¡¨ï¼ˆactivity-infoï¼‰"><a href="#5-3-20-æ´»åŠ¨è¡¨ï¼ˆactivity-infoï¼‰" class="headerlink" title="5.3.20 æ´»åŠ¨è¡¨ï¼ˆactivity_infoï¼‰"></a>5.3.20 æ´»åŠ¨è¡¨ï¼ˆactivity_infoï¼‰</h4><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445480-d02fd607-dfe9-47b8-992f-8f675460e400.png#align=left&display=inline&height=172&margin=%5Bobject%20Object%5D&originHeight=172&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="23b08d0d"></a><h4 id="5-3-21-æ´»åŠ¨è®¢å•å…³è”è¡¨ï¼ˆactivity-orderï¼‰"><a href="#5-3-21-æ´»åŠ¨è®¢å•å…³è”è¡¨ï¼ˆactivity-orderï¼‰" class="headerlink" title="5.3.21 æ´»åŠ¨è®¢å•å…³è”è¡¨ï¼ˆactivity_orderï¼‰"></a>5.3.21 æ´»åŠ¨è®¢å•å…³è”è¡¨ï¼ˆactivity_orderï¼‰</h4></li></ul><p><a name="f2c83679"></a></p><h4 id="5-3-22-ä¼˜æƒ è§„åˆ™è¡¨ï¼ˆactivity-ruleï¼‰"><a href="#5-3-22-ä¼˜æƒ è§„åˆ™è¡¨ï¼ˆactivity-ruleï¼‰" class="headerlink" title="5.3.22 ä¼˜æƒ è§„åˆ™è¡¨ï¼ˆactivity_ruleï¼‰"></a>5.3.22 ä¼˜æƒ è§„åˆ™è¡¨ï¼ˆactivity_ruleï¼‰</h4><p><a name="c05cf4cd"></a></p><h4 id="5-3-23-ç¼–ç å­—å…¸è¡¨ï¼ˆbase-dicï¼‰"><a href="#5-3-23-ç¼–ç å­—å…¸è¡¨ï¼ˆbase-dicï¼‰" class="headerlink" title="5.3.23 ç¼–ç å­—å…¸è¡¨ï¼ˆbase_dicï¼‰"></a>5.3.23 ç¼–ç å­—å…¸è¡¨ï¼ˆbase_dicï¼‰</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445580-ef8aff78-4e6e-4cfa-8a34-5cb0929bbf8f.png#align=left&display=inline&height=133&margin=%5Bobject%20Object%5D&originHeight=133&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="41ae15c6"></a></p><h4 id="5-3-24-æ´»åŠ¨å‚ä¸å•†å“è¡¨ï¼ˆactivity-skuï¼‰"><a href="#5-3-24-æ´»åŠ¨å‚ä¸å•†å“è¡¨ï¼ˆactivity-skuï¼‰" class="headerlink" title="5.3.24 æ´»åŠ¨å‚ä¸å•†å“è¡¨ï¼ˆactivity_skuï¼‰"></a>5.3.24 æ´»åŠ¨å‚ä¸å•†å“è¡¨ï¼ˆactivity_skuï¼‰</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445455-d299fd9e-7ed4-4419-a4eb-41e0d3af4c25.png#align=left&display=inline&height=181&margin=%5Bobject%20Object%5D&originHeight=181&originWidth=1279&size=0&status=done&style=none&width=1279" alt><br><a name="blogTitle21"></a></p><h3 id="5-4-æ—¶é—´è¡¨ç»“æ„"><a href="#5-4-æ—¶é—´è¡¨ç»“æ„" class="headerlink" title="5.4 æ—¶é—´è¡¨ç»“æ„"></a>5.4 æ—¶é—´è¡¨ç»“æ„</h3><p><a name="f09b2786"></a></p><h4 id="5-4-1-æ—¶é—´è¡¨ï¼ˆdate-infoï¼‰"><a href="#5-4-1-æ—¶é—´è¡¨ï¼ˆdate-infoï¼‰" class="headerlink" title="5.4.1 æ—¶é—´è¡¨ï¼ˆdate_infoï¼‰"></a>5.4.1 æ—¶é—´è¡¨ï¼ˆdate_infoï¼‰</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445509-9e9b8580-ed76-4d31-9524-0d9d35af8e7e.png#align=left&display=inline&height=194&margin=%5Bobject%20Object%5D&originHeight=194&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="f703d98c"></a></p><h4 id="5-4-2-å‡æœŸè¡¨ï¼ˆholiday-infoï¼‰"><a href="#5-4-2-å‡æœŸè¡¨ï¼ˆholiday-infoï¼‰" class="headerlink" title="5.4.2 å‡æœŸè¡¨ï¼ˆholiday_infoï¼‰"></a>5.4.2 å‡æœŸè¡¨ï¼ˆholiday_infoï¼‰</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445498-cace1b91-fd1c-495e-ae9e-5b20b950f181.png#align=left&display=inline&height=80&margin=%5Bobject%20Object%5D&originHeight=80&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="421431fc"></a></p><h4 id="5-4-3-å‡æœŸå¹´è¡¨ï¼ˆholiday-yearï¼‰"><a href="#5-4-3-å‡æœŸå¹´è¡¨ï¼ˆholiday-yearï¼‰" class="headerlink" title="5.4.3 å‡æœŸå¹´è¡¨ï¼ˆholiday_yearï¼‰"></a>5.4.3 å‡æœŸå¹´è¡¨ï¼ˆholiday_yearï¼‰</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445585-dfcd1dca-4af1-4822-98c0-729ff17ad0cd.png#align=left&display=inline&height=105&margin=%5Bobject%20Object%5D&originHeight=105&originWidth=820&size=0&status=done&style=none&width=820" alt><br><a name="blogTitle22"></a></p><h2 id="6-åŒæ­¥ç­–ç•¥åŠæ•°ä»“åˆ†å±‚"><a href="#6-åŒæ­¥ç­–ç•¥åŠæ•°ä»“åˆ†å±‚" class="headerlink" title="6 åŒæ­¥ç­–ç•¥åŠæ•°ä»“åˆ†å±‚"></a>6 åŒæ­¥ç­–ç•¥åŠæ•°ä»“åˆ†å±‚</h2><blockquote><p>æ•°æ®åŒæ­¥ç­–ç•¥çš„ç±»å‹åŒ…æ‹¬ï¼šå…¨é‡è¡¨ã€å¢é‡è¡¨ã€æ–°å¢åŠå˜åŒ–è¡¨</p></blockquote><ul><li>å…¨é‡è¡¨ï¼šæ¯å¤©ä¸€ä¸ªåˆ†åŒºï¼Œå­˜å‚¨å®Œæ•´çš„æ•°æ®ã€‚<br></li><li>å¢é‡è¡¨ï¼šæ¯å¤©æ–°å¢æ•°æ®æ”¾åœ¨ä¸€ä¸ªåˆ†åŒºï¼Œå­˜å‚¨æ–°å¢åŠ çš„æ•°æ®ã€‚<br></li><li>æ–°å¢åŠå˜åŒ–è¡¨ï¼šæ¯å¤©æ–°å¢å’Œå˜åŒ–çš„æ•°æ®æ”¾åœ¨ä¸€ä¸ªåˆ†åŒºï¼Œå­˜å‚¨æ–°å¢åŠ çš„æ•°æ®å’Œå˜åŒ–çš„æ•°æ®ã€‚<br></li><li>ç‰¹æ®Šè¡¨ï¼šæ²¡æœ‰åˆ†åŒºï¼Œåªéœ€è¦å­˜å‚¨ä¸€æ¬¡ã€‚<br><br><a name="blogTitle23"></a><h3 id="6-1-å…¨é‡ç­–ç•¥"><a href="#6-1-å…¨é‡ç­–ç•¥" class="headerlink" title="6.1 å…¨é‡ç­–ç•¥"></a>6.1 å…¨é‡ç­–ç•¥</h3><blockquote><p>æ¯æ—¥å…¨é‡ï¼Œæ¯å¤©å­˜å‚¨ä¸€ä»½å®Œæ•´æ•°æ®ï¼Œä½œä¸ºä¸€ä¸ªåˆ†åŒºã€‚<br>é€‚åˆåœºæ™¯ï¼šè¡¨æ•°æ®é‡ä¸å¤§ï¼Œä¸”æœ‰æ–°å¢æˆ–ä¿®æ”¹ä¸šåŠ¡çš„åœºæ™¯<br>ä¾‹å¦‚ï¼šå“ç‰Œè¡¨ã€ç¼–ç è¡¨ã€å•†å“åˆ†ç±»è¡¨ã€ä¼˜æƒ è§„åˆ™è¡¨ã€æ´»åŠ¨è¡¨ã€å•†å“è¡¨ã€åŠ è´­è¡¨ã€æ”¶è—è¡¨ã€SKU/SPUè¡¨</p></blockquote></li></ul><p><a name="blogTitle24"></a></p><h3 id="6-2-å¢é‡ç­–ç•¥"><a href="#6-2-å¢é‡ç­–ç•¥" class="headerlink" title="6.2 å¢é‡ç­–ç•¥"></a>6.2 å¢é‡ç­–ç•¥</h3><blockquote><p>æ¯æ—¥å¢é‡ï¼Œæ¯å¤©å‚¨å­˜ä¸€ä»½å¢é‡æ•°æ®ï¼Œä½œä¸ºä¸€ä¸ªåˆ†åŒº<br>é€‚åˆåœºæ™¯ï¼šè¡¨æ•°æ®é‡å¤§ï¼Œä¸”åªä¼šæœ‰æ–°å¢æ•°æ®çš„åœºæ™¯ã€‚<br>ä¾‹å¦‚ï¼šé€€å•è¡¨ã€è®¢å•çŠ¶æ€è¡¨ã€æ”¯ä»˜æµæ°´è¡¨ã€è®¢å•è¯¦æƒ…è¡¨ã€æ´»åŠ¨ä¸è®¢å•å…³è”è¡¨ã€å•†å“è¯„è®ºè¡¨</p></blockquote><p><a name="blogTitle25"></a></p><h3 id="6-3-æ–°å¢åŠå˜åŒ–ç­–ç•¥"><a href="#6-3-æ–°å¢åŠå˜åŒ–ç­–ç•¥" class="headerlink" title="6.3 æ–°å¢åŠå˜åŒ–ç­–ç•¥"></a>6.3 æ–°å¢åŠå˜åŒ–ç­–ç•¥</h3><blockquote><p>æ¯æ—¥æ–°å¢åŠå˜åŒ–ï¼Œå‚¨å­˜åˆ›å»ºæ—¶é—´å’Œæ“ä½œæ—¶é—´éƒ½æ˜¯ä»Šå¤©çš„æ•°æ®ï¼Œä½œä¸ºä¸€ä¸ªåˆ†åŒº<br>é€‚åˆåœºæ™¯ï¼šè¡¨æ•°æ®é‡å¤§ï¼Œæ—¢ä¼šæœ‰æ–°å¢ï¼Œåˆä¼šæœ‰ä¿®æ”¹ã€‚<br>ä¾‹å¦‚ï¼šç”¨æˆ·è¡¨ã€è®¢å•è¡¨ã€ä¼˜æƒ å·é¢†ç”¨è¡¨ã€‚</p></blockquote><p><a name="blogTitle26"></a></p><h3 id="6-4-ç‰¹æ®Šç­–ç•¥"><a href="#6-4-ç‰¹æ®Šç­–ç•¥" class="headerlink" title="6.4 ç‰¹æ®Šç­–ç•¥"></a>6.4 ç‰¹æ®Šç­–ç•¥</h3><blockquote><p>æŸäº›ç‰¹æ®Šçš„ç»´åº¦è¡¨ï¼Œå¯ä¸å¿…éµå¾ªä¸Šè¿°åŒæ­¥ç­–ç•¥ï¼Œåœ¨æ•°ä»“ä¸­åªåšä¸€æ¬¡åŒæ­¥ï¼Œæ•°æ®ä¸å˜åŒ–ä¸æ›´æ–°<br>é€‚åˆåœºæ™¯ï¼šè¡¨æ•°æ®å‡ ä¹ä¸ä¼šå˜åŒ–<br>1.å®¢è§‚ä¸–ç•Œç»´åº¦ï¼šæ²¡å˜åŒ–çš„å®¢è§‚ä¸–ç•Œçš„ç»´åº¦ï¼ˆæ¯”å¦‚æ€§åˆ«ï¼Œåœ°åŒºï¼Œæ°‘æ—ï¼Œæ”¿æ²»æˆåˆ†ï¼Œé‹å­å°ºç ï¼‰å¯ä»¥åªå­˜ä¸€ ä»½å›ºå®šå€¼<br>2.æ—¥æœŸç»´åº¦ï¼šæ—¥æœŸç»´åº¦å¯ä»¥ä¸€æ¬¡æ€§å¯¼å…¥ä¸€å¹´æˆ–è‹¥å¹²å¹´çš„æ•°æ®ã€‚<br>3.åœ°åŒºç»´åº¦ï¼šçœä»½è¡¨ã€åœ°åŒºè¡¨</p></blockquote><p><a name="blogTitle27"></a></p><h3 id="6-5-åˆ†æä¸šåŠ¡è¡¨åŒæ­¥ç­–ç•¥"><a href="#6-5-åˆ†æä¸šåŠ¡è¡¨åŒæ­¥ç­–ç•¥" class="headerlink" title="6.5 åˆ†æä¸šåŠ¡è¡¨åŒæ­¥ç­–ç•¥"></a>6.5 åˆ†æä¸šåŠ¡è¡¨åŒæ­¥ç­–ç•¥</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445558-f3526a7c-422a-4254-b832-a0edb969ecd0.png#align=left&display=inline&height=577&margin=%5Bobject%20Object%5D&originHeight=577&originWidth=1161&size=0&status=done&style=none&width=1161" alt></p><blockquote><p>è€ƒè™‘åˆ°ç‰¹æ®Šè¡¨å¯èƒ½ä¼šç¼“æ…¢å˜åŒ–ï¼Œæ¯”å¦‚æ‰“ä»—å åœ°ç›˜ï¼Œåœ°åŒºè¡¨å¯èƒ½å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ•…ä¹Ÿé€‰æ‹©åˆ†åŒºå…¨é‡åŒæ­¥ç­–ç•¥ã€‚</p></blockquote><p><a name="blogTitle28"></a></p><h3 id="6-6-æ•°ä»“åˆ†å±‚"><a href="#6-6-æ•°ä»“åˆ†å±‚" class="headerlink" title="6.6 æ•°ä»“åˆ†å±‚"></a>6.6 æ•°ä»“åˆ†å±‚</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445503-1f00df37-1048-4dab-bd2a-b93874b97ed6.png#align=left&display=inline&height=563&margin=%5Bobject%20Object%5D&originHeight=563&originWidth=1141&size=0&status=done&style=none&width=1141" alt></p><ul><li><p>ä¸ºä»€ä¹ˆåˆ†å±‚ï¼š</p><ul><li>ç®€å•åŒ–ï¼šæŠŠå¤æ‚çš„ä»»åŠ¡åˆ†è§£ä¸ºå¤šå±‚æ¥å®Œæˆï¼Œæ¯å±‚å¤„ç†å„è‡ªçš„ä»»åŠ¡ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜ã€‚</li><li>å‡å°‘é‡å¤å¼€å‘ï¼šè§„èŒƒæ•°æ®åˆ†å±‚ï¼Œé€šè¿‡ä¸­é—´å±‚æ•°æ®ï¼Œèƒ½å¤Ÿæå¤§çš„å‡å°‘é‡å¤è®¡ç®—ï¼Œå¢åŠ ç»“æœå¤ç”¨æ€§ã€‚</li><li>éš”ç¦»æ•°æ®ï¼šä¸è®ºæ˜¯æ•°æ®å¼‚å¸¸è¿˜æ˜¯æ•°æ®æ•æ„Ÿæ€§ï¼Œä½¿çœŸå®æ•°æ®å’Œç»Ÿè®¡æ•°æ®è§£è€¦ã€‚</li><li>ä¸€èˆ¬åœ¨DWDå±‚è¿›è¡Œç»´åº¦å»ºæ¨¡</li></ul></li><li><p>ODSå±‚ï¼šåŸå§‹æ•°æ®å±‚ï¼Œå­˜æ”¾åŸå§‹æ•°æ®</p></li><li><p>DWDå±‚ï¼šå¯¹ODSå±‚æ•°æ®è¿›è¡Œæ¸…æ´—ï¼ˆå»ç©ºã€è„æ•°æ®ï¼Œè½¬æ¢ç±»å‹ç­‰ï¼‰ï¼Œç»´åº¦é€€åŒ–ï¼Œè„±æ•(ä¿æŠ¤éšç§)</p></li><li><p>DWSå±‚ï¼šä»¥DWDä¸ºåŸºç¡€ï¼ŒæŒ‰å¤©è¿›è¡Œæ±‡æ€»</p></li><li><p>DWTå±‚ï¼šä»¥DWSä¸ºåŸºç¡€ï¼ŒæŒ‰ä¸»é¢˜è¿›è¡Œæ±‡æ€»</p></li><li><p>ADSå±‚ï¼šä¸ºå„ç§æ•°æ®åˆ†ææŠ¥è¡¨æä¾›æ•°æ®<br><a name="blogTitle29"></a></p><h2 id="7-SqoopåŒæ­¥æ•°æ®"><a href="#7-SqoopåŒæ­¥æ•°æ®" class="headerlink" title="7 SqoopåŒæ­¥æ•°æ®"></a>7 SqoopåŒæ­¥æ•°æ®</h2><blockquote><p>Sqoopæ³¨æ„ç‚¹ï¼š<br>Hive ä¸­çš„ Null åœ¨åº•å±‚æ˜¯ä»¥â€œ\Nâ€æ¥å­˜å‚¨ï¼Œè€Œ MySQL ä¸­çš„ Null åœ¨åº•å±‚å°±æ˜¯ Nullï¼Œä¸ºäº† ä¿è¯æ•°æ®ä¸¤ç«¯çš„ä¸€è‡´æ€§ã€‚</p><ul><li>åœ¨å¯¼å‡ºæ•°æ®æ—¶é‡‡ç”¨ â€“input-null-string å’Œ â€“input-null-non-string</li><li>å¯¼å…¥æ•°æ®æ—¶é‡‡ç”¨ â€“null-string å’Œ â€“null-non-string</li></ul></blockquote><p>æœ¬ä¾‹æ€è·¯ä¸ºï¼šsqoopæŠ½å–mysqlæ•°æ®ä¸Šä¼ è‡³Hdfsä¸Šï¼Œå­˜å‚¨ä¸ºparquetæ–‡ä»¶ï¼Œåœ¨å»ºç«‹hive-odsè¡¨ï¼Œä½¿ç”¨å¯¹åº”æ•°æ®ã€‚</p><blockquote><p>ä½¿ç”¨DolphinSchedulerè°ƒåº¦æ‰§è¡Œè„šæœ¬ã€‚</p></blockquote></li><li><p>Sqoopé‡‡é›†Mysqlå’ŒHiveæ•°æ®æ ¼å¼</p><table><thead><tr><th>mysqlå­—æ®µç±»å‹</th><th>hive:odså­—æ®µç±»å‹</th><th>hive:dwd-adså­—æ®µç±»å‹</th></tr></thead><tbody><tr><td>tinyint</td><td>tinyint</td><td>tinyint</td></tr><tr><td>int</td><td>int</td><td>int</td></tr><tr><td>bigint</td><td>bigint</td><td>bigint</td></tr><tr><td>varchar</td><td>string</td><td>string</td></tr><tr><td>datetime</td><td>bigint</td><td>string</td></tr><tr><td>bit</td><td>boolean</td><td>int</td></tr><tr><td>double</td><td>double</td><td>double</td></tr><tr><td>decimal</td><td>decimal</td><td>decimal</td></tr></tbody></table></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445576-95ae80a2-e157-4ba2-ac2f-39c0057bfc4d.png#align=left&display=inline&height=820&margin=%5Bobject%20Object%5D&originHeight=820&originWidth=1920&size=0&status=done&style=none&width=1920" alt><br><a name="blogTitle30"></a></p><h2 id="8-odså±‚æ„å»º"><a href="#8-odså±‚æ„å»º" class="headerlink" title="8 odså±‚æ„å»º"></a>8 odså±‚æ„å»º</h2><p><a name="blogTitle31"></a></p><h3 id="8-1-odså»ºè¡¨"><a href="#8-1-odså»ºè¡¨" class="headerlink" title="8.1 odså»ºè¡¨"></a>8.1 odså»ºè¡¨</h3><blockquote><p>hiveåˆ›å»ºodsæ•°æ®åº“ï¼Œä½¿ç”¨DolphinScheduleråˆ›å»ºæ•°æ®æºï¼Œåœ¨åˆ›å»ºDAGæ—¶éœ€è¦é€‰æ‹©hiveåº“ã€‚<br>é¡ºä¾¿å°†dwdï¼Œdwsï¼Œdwtï¼Œadsä¸€èµ·åˆ›å»ºäº†</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445577-7f5949c5-01ad-4097-b19b-0ebe0cfd3546.png#align=left&display=inline&height=625&margin=%5Bobject%20Object%5D&originHeight=625&originWidth=847&size=0&status=done&style=none&width=847" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445447507-0aa01c2c-12fc-4d51-ba3e-a055609bcb47.png#align=left&display=inline&height=682&margin=%5Bobject%20Object%5D&originHeight=682&originWidth=1134&size=0&status=done&style=none&width=1134" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445580-441c434e-54a5-49d6-973a-ef7d97c1b4ac.png#align=left&display=inline&height=577&margin=%5Bobject%20Object%5D&originHeight=577&originWidth=1161&size=0&status=done&style=none&width=1161" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445560-1a8ada2f-b802-4db9-b161-788f80c89770.png#align=left&display=inline&height=683&margin=%5Bobject%20Object%5D&originHeight=683&originWidth=1168&size=0&status=done&style=none&width=1168" alt></p><ol><li><p>base_dic</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__base_dic</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__base_dic&#96;(</span><br><span class="line">  &#96;dic_code&#96; string COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;dic_name&#96; string COMMENT &#39;ç¼–ç åç§°&#39;,</span><br><span class="line">  &#96;parent_code&#96;  string COMMENT &#39;çˆ¶ç¼–å·&#39;,</span><br><span class="line">  &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¥æœŸ&#39;,</span><br><span class="line">  &#96;operate_time&#96; bigint COMMENT &#39;ä¿®æ”¹æ—¥æœŸ&#39;</span><br><span class="line">  ) COMMENT &#39;ç¼–ç å­—å…¸è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;base_dic&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>base_trademark</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__base_trademark</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__base_trademark&#96;(</span><br><span class="line">  &#96;tm_id&#96; string COMMENT &#39;å“ç‰Œid&#39;,</span><br><span class="line">  &#96;tm_name&#96; string COMMENT &#39;å“ç‰Œåç§°&#39;</span><br><span class="line">  ) COMMENT &#39;å“ç‰Œè¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;base_trademark&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>base_category3</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__base_category3</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__base_category3&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;name&#96; string COMMENT &#39;ä¸‰çº§åˆ†ç±»åç§°&#39;,</span><br><span class="line">  &#96;category2_id&#96; bigint COMMENT &#39;äºŒçº§åˆ†ç±»ç¼–å·&#39;</span><br><span class="line">  ) COMMENT &#39;ä¸‰çº§åˆ†ç±»è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;base_category3&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>base_category2</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__base_category2</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__base_category2&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;name&#96; string COMMENT &#39;äºŒçº§åˆ†ç±»åç§°&#39;,</span><br><span class="line">  &#96;category1_id&#96; bigint COMMENT &#39;ä¸€çº§åˆ†ç±»ç¼–å·&#39;</span><br><span class="line">  ) COMMENT &#39;äºŒçº§åˆ†ç±»è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;base_category2&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>base_category1</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__base_category1</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__base_category1&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;name&#96; string COMMENT &#39;åˆ†ç±»åç§°&#39;</span><br><span class="line">  ) COMMENT &#39;ä¸€çº§åˆ†ç±»è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;base_category1&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>activity_rule</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__activity_rule</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__activity_rule&#96;(</span><br><span class="line">  &#96;id&#96; int COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;activity_id&#96; int COMMENT &#39;ç±»å‹&#39;,</span><br><span class="line">  &#96;condition_amount&#96; decimal(16,2) COMMENT &#39;æ»¡å‡é‡‘é¢&#39;,</span><br><span class="line">  &#96;condition_num&#96; bigint COMMENT &#39;æ»¡å‡ä»¶æ•°&#39;,</span><br><span class="line">  &#96;benefit_amount&#96; decimal(16,2) COMMENT &#39;ä¼˜æƒ é‡‘é¢&#39;,</span><br><span class="line">  &#96;benefit_discount&#96; bigint COMMENT &#39;ä¼˜æƒ æŠ˜æ‰£&#39;,</span><br><span class="line">  &#96;benefit_level&#96; bigint COMMENT &#39;ä¼˜æƒ çº§åˆ«&#39;</span><br><span class="line">  ) COMMENT &#39;ä¼˜æƒ è§„åˆ™&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;activity_rule&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>activity_info</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__activity_info</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__activity_info&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;æ´»åŠ¨id&#39;,</span><br><span class="line">  &#96;activity_name&#96; string COMMENT &#39;æ´»åŠ¨åç§°&#39;,</span><br><span class="line">  &#96;activity_type&#96; string COMMENT &#39;æ´»åŠ¨ç±»å‹&#39;,</span><br><span class="line">  &#96;start_time&#96; bigint COMMENT &#39;å¼€å§‹æ—¶é—´&#39;,</span><br><span class="line">  &#96;end_time&#96; bigint COMMENT &#39;ç»“æŸæ—¶é—´&#39;,</span><br><span class="line">  &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;æ´»åŠ¨è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;activity_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>activity_sku</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__activity_sku</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__activity_sku&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;activity_id&#96; bigint COMMENT &#39;æ´»åŠ¨id&#39;,</span><br><span class="line">  &#96;sku_id&#96; bigint COMMENT &#39;sku_id&#39;,</span><br><span class="line">  &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;æ´»åŠ¨å‚ä¸å•†å“&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;activity_sku&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>cart_info</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__cart_info</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__cart_info&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·id&#39;,</span><br><span class="line">  &#96;sku_id&#96; bigint COMMENT &#39;sku_id&#39;,</span><br><span class="line">  &#96;cart_price&#96; decimal(10,2) COMMENT &#39;æ”¾å…¥è´­ç‰©è½¦æ—¶ä»·æ ¼&#39;,</span><br><span class="line">  &#96;sku_num&#96; bigint COMMENT &#39;æ•°é‡&#39;,</span><br><span class="line">  &#96;sku_name&#96; string COMMENT &#39;skuåç§°&#39;,</span><br><span class="line">  &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">  &#96;operate_time&#96; bigint COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;,</span><br><span class="line">  &#96;is_ordered&#96; bigint COMMENT &#39;æ˜¯å¦å·²ç»ä¸‹å•&#39;,</span><br><span class="line">  &#96;order_time&#96; bigint COMMENT &#39;ä¸‹å•æ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;è´­ç‰©è½¦è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;cart_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>favor_info</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__favor_info</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__favor_info&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·id&#39;,</span><br><span class="line">  &#96;sku_id&#96; bigint COMMENT &#39;sku_id&#39;,</span><br><span class="line">  &#96;spu_id&#96; bigint COMMENT &#39;å•†å“id&#39;,</span><br><span class="line">  &#96;is_cancel&#96; string COMMENT &#39;æ˜¯å¦å·²å–æ¶ˆ 0 æ­£å¸¸ 1 å·²å–æ¶ˆ&#39;,</span><br><span class="line">  &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">  &#96;cancel_time&#96; bigint COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;å•†å“æ”¶è—è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;favor_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>coupon_info</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__coupon_info</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__coupon_info&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;è´­ç‰©åˆ¸ç¼–å·&#39;,</span><br><span class="line">  &#96;coupon_name&#96; string COMMENT &#39;è´­ç‰©åˆ¸åç§°&#39;,</span><br><span class="line">  &#96;coupon_type&#96; string COMMENT &#39;è´­ç‰©åˆ¸ç±»å‹ 1 ç°é‡‘åˆ¸ 2 æŠ˜æ‰£åˆ¸ 3 æ»¡å‡åˆ¸ 4 æ»¡ä»¶æ‰“æŠ˜åˆ¸&#39;,</span><br><span class="line">  &#96;condition_amount&#96; decimal(10,2) COMMENT &#39;æ»¡é¢æ•°&#39;,</span><br><span class="line">  &#96;condition_num&#96; bigint COMMENT &#39;æ»¡ä»¶æ•°&#39;,</span><br><span class="line">  &#96;activity_id&#96; bigint COMMENT &#39;æ´»åŠ¨ç¼–å·&#39;,</span><br><span class="line">  &#96;benefit_amount&#96; decimal(16,2) COMMENT &#39;å‡é‡‘é¢&#39;,</span><br><span class="line">  &#96;benefit_discount&#96; bigint COMMENT &#39;æŠ˜æ‰£&#39;,</span><br><span class="line">  &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">  &#96;range_type&#96; string COMMENT &#39;èŒƒå›´ç±»å‹ 1ã€å•†å“ 2ã€å“ç±» 3ã€å“ç‰Œ&#39;,</span><br><span class="line">  &#96;spu_id&#96; bigint COMMENT &#39;å•†å“id&#39;,</span><br><span class="line">  &#96;tm_id&#96; bigint COMMENT &#39;å“ç‰Œid&#39;,</span><br><span class="line">  &#96;category3_id&#96; bigint COMMENT &#39;å“ç±»id&#39;,</span><br><span class="line">  &#96;limit_num&#96; int COMMENT &#39;æœ€å¤šé¢†ç”¨æ¬¡æ•°&#39;,</span><br><span class="line">  &#96;operate_time&#96; bigint COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;,</span><br><span class="line">  &#96;expire_time&#96; bigint COMMENT &#39;è¿‡æœŸæ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;ä¼˜æƒ åˆ¸è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;coupon_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>sku_info</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__sku_info</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__sku_info&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;skuid&#39;,</span><br><span class="line">  &#96;spu_id&#96; bigint COMMENT &#39;spuid&#39;,</span><br><span class="line">  &#96;price&#96; decimal(10,0) COMMENT &#39;ä»·æ ¼&#39;,</span><br><span class="line">  &#96;sku_name&#96; string COMMENT &#39;skuåç§°&#39;,</span><br><span class="line">  &#96;sku_desc&#96; string COMMENT &#39;å•†å“è§„æ ¼æè¿°&#39;,</span><br><span class="line">  &#96;weight&#96; decimal(10,2) COMMENT &#39;é‡é‡&#39;,</span><br><span class="line">  &#96;tm_id&#96; bigint COMMENT &#39;å“ç‰Œ&#39;,</span><br><span class="line">  &#96;category3_id&#96; bigint COMMENT &#39;ä¸‰çº§åˆ†ç±»id&#39;,</span><br><span class="line">  &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;åº“å­˜å•å…ƒè¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;sku_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>spu_info</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__spu_info</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__spu_info&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;å•†å“id&#39;,</span><br><span class="line">  &#96;spu_name&#96; string COMMENT &#39;å•†å“åç§°&#39;,</span><br><span class="line">  &#96;category3_id&#96; bigint COMMENT &#39;ä¸‰çº§åˆ†ç±»id&#39;,</span><br><span class="line">  &#96;tm_id&#96; bigint COMMENT &#39;å“ç‰Œid&#39;</span><br><span class="line">  ) COMMENT &#39;å•†å“è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;spu_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>base_province</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__base_province</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__base_province&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;id&#39;,</span><br><span class="line">  &#96;name&#96; string COMMENT &#39;çœåç§°&#39;,</span><br><span class="line">  &#96;region_id&#96; string COMMENT &#39;å¤§åŒºid&#39;,</span><br><span class="line">  &#96;area_code&#96; string COMMENT &#39;è¡Œæ”¿åŒºä½ç &#39;,</span><br><span class="line">  &#96;iso_code&#96; string COMMENT &#39;å›½é™…ç¼–ç &#39;</span><br><span class="line">  ) COMMENT &#39;çœä»½è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;base_province&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>base_region</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__base_region</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__base_region&#96;(</span><br><span class="line">  &#96;id&#96; string COMMENT &#39;å¤§åŒºid&#39;,</span><br><span class="line">  &#96;region_name&#96; string COMMENT &#39;å¤§åŒºåç§°&#39;</span><br><span class="line">  ) COMMENT &#39;åœ°åŒºè¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;base_region&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>refund_info</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__order_refund_info</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__order_refund_info&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·id&#39;,</span><br><span class="line">  &#96;order_id&#96; bigint COMMENT &#39;è®¢å•ç¼–å·&#39;,</span><br><span class="line">  &#96;sku_id&#96; bigint COMMENT &#39;skuid&#39;,</span><br><span class="line">  &#96;refund_type&#96; string COMMENT &#39;é€€æ¬¾ç±»å‹&#39;,</span><br><span class="line">  &#96;refund_num&#96; bigint COMMENT &#39;é€€è´§ä»¶æ•°&#39;,</span><br><span class="line">  &#96;refund_amount&#96; decimal(16,2) COMMENT &#39;é€€æ¬¾é‡‘é¢&#39;,</span><br><span class="line">  &#96;refund_reason_type&#96; string COMMENT &#39;åŸå› ç±»å‹&#39;,</span><br><span class="line">  &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;é€€å•è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;order_refund_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>order_status_log</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__order_status_log</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__order_status_log&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;order_id&#96; bigint COMMENT &#39;è®¢å•ç¼–å·&#39;,</span><br><span class="line">  &#96;order_status&#96; string COMMENT &#39;è®¢å•çŠ¶æ€&#39;,</span><br><span class="line">  &#96;operate_time&#96; bigint COMMENT &#39;æ“ä½œæ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;è®¢å•çŠ¶æ€è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;order_status_log&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>payment_info</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__payment_info</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__payment_info&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;out_trade_no&#96; string COMMENT &#39;å¯¹å¤–ä¸šåŠ¡ç¼–å·&#39;,</span><br><span class="line">  &#96;order_id&#96; bigint COMMENT &#39;è®¢å•ç¼–å·&#39;,</span><br><span class="line">  &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·ç¼–å·&#39;,</span><br><span class="line">  &#96;alipay_trade_no&#96; string COMMENT &#39;æ”¯ä»˜å®äº¤æ˜“æµæ°´ç¼–å·&#39;,</span><br><span class="line">  &#96;total_amount&#96; decimal(16,2) COMMENT &#39;æ”¯ä»˜é‡‘é¢&#39;,</span><br><span class="line">  &#96;subject&#96; string COMMENT &#39;äº¤æ˜“å†…å®¹&#39;,</span><br><span class="line">  &#96;payment_type&#96; string COMMENT &#39;æ”¯ä»˜æ–¹å¼&#39;,</span><br><span class="line">  &#96;payment_time&#96; bigint COMMENT &#39;æ”¯ä»˜æ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;æ”¯ä»˜æµæ°´è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;payment_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>order_detail</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__order_detail</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__order_detail&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;order_id&#96; bigint COMMENT &#39;è®¢å•ç¼–å·&#39;,</span><br><span class="line">  &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·id&#39;,</span><br><span class="line">  &#96;sku_id&#96; bigint COMMENT &#39;sku_id&#39;,</span><br><span class="line">  &#96;sku_name&#96; string COMMENT &#39;skuåç§°&#39;,</span><br><span class="line">  &#96;order_price&#96; decimal(10,2) COMMENT &#39;è´­ä¹°ä»·æ ¼(ä¸‹å•æ—¶skuä»·æ ¼ï¼‰&#39;,</span><br><span class="line">  &#96;sku_num&#96; string COMMENT &#39;è´­ä¹°ä¸ªæ•°&#39;,</span><br><span class="line">  &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;è®¢å•æ˜ç»†è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;order_detail&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>activity_order</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__activity_order</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__activity_order&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;activity_id&#96; bigint COMMENT &#39;æ´»åŠ¨id&#39;,</span><br><span class="line">  &#96;order_id&#96; bigint COMMENT &#39;è®¢å•ç¼–å·&#39;,</span><br><span class="line">  &#96;create_time&#96; bigint COMMENT &#39;å‘ç”Ÿæ—¥æœŸ&#39;</span><br><span class="line">  ) COMMENT &#39;æ´»åŠ¨ä¸è®¢å•å…³è”è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;activity_order&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>comment_info</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__comment_info</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__comment_info&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·åç§°&#39;,</span><br><span class="line">  &#96;sku_id&#96; bigint COMMENT &#39;skuid&#39;,</span><br><span class="line">  &#96;spu_id&#96; bigint COMMENT &#39;å•†å“id&#39;,</span><br><span class="line">  &#96;order_id&#96; bigint COMMENT &#39;è®¢å•ç¼–å·&#39;,</span><br><span class="line">  &#96;appraise&#96; string COMMENT &#39;è¯„ä»· 1 å¥½è¯„ 2 ä¸­è¯„ 3 å·®è¯„&#39;,</span><br><span class="line">  &#96;comment_txt&#96; string COMMENT &#39;è¯„ä»·å†…å®¹&#39;,</span><br><span class="line">  &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;å•†å“è¯„è®ºè¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;comment_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>coupon_use</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__coupon_use</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__coupon_use&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;coupon_id&#96; bigint COMMENT &#39;è´­ç‰©åˆ¸ID&#39;,</span><br><span class="line">  &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·ID&#39;,</span><br><span class="line">  &#96;order_id&#96; bigint COMMENT &#39;è®¢å•ID&#39;,</span><br><span class="line">  &#96;coupon_status&#96; string COMMENT &#39;è´­ç‰©åˆ¸çŠ¶æ€&#39;,</span><br><span class="line">  &#96;get_time&#96; bigint COMMENT &#39;é¢†åˆ¸æ—¶é—´&#39;,</span><br><span class="line">  &#96;using_time&#96; bigint COMMENT &#39;ä½¿ç”¨æ—¶é—´&#39;,</span><br><span class="line">  &#96;used_time&#96; bigint COMMENT &#39;è¿‡æœŸæ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;coupon_use&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>user_info</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__user_info</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__user_info&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;name&#96; string COMMENT &#39;ç”¨æˆ·å§“å&#39;,</span><br><span class="line">  &#96;email&#96; string COMMENT &#39;é‚®ç®±&#39;,</span><br><span class="line">  &#96;user_level&#96; string COMMENT &#39;ç”¨æˆ·çº§åˆ«&#39;,</span><br><span class="line">  &#96;birthday&#96; bigint COMMENT &#39;ç”¨æˆ·ç”Ÿæ—¥&#39;,</span><br><span class="line">  &#96;gender&#96; string COMMENT &#39;æ€§åˆ« Mç”·,Få¥³&#39;,</span><br><span class="line">  &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">  &#96;operate_time&#96; bigint COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;ç”¨æˆ·è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;user_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>order_info</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__order_info</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__order_info&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;final_total_amount&#96; decimal(16,2) COMMENT &#39;æ€»é‡‘é¢&#39;,</span><br><span class="line">  &#96;order_status&#96; string COMMENT &#39;è®¢å•çŠ¶æ€&#39;,</span><br><span class="line">  &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·id&#39;,</span><br><span class="line">  &#96;out_trade_no&#96; string COMMENT &#39;è®¢å•äº¤æ˜“ç¼–å·ï¼ˆç¬¬ä¸‰æ–¹æ”¯ä»˜ç”¨)&#39;,</span><br><span class="line">  &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">  &#96;operate_time&#96; bigint COMMENT &#39;æ“ä½œæ—¶é—´&#39;,</span><br><span class="line">  &#96;province_id&#96; int COMMENT &#39;åœ°åŒº&#39;,</span><br><span class="line">  &#96;benefit_reduce_amount&#96; decimal(16,2) COMMENT &#39;ä¼˜æƒ é‡‘é¢&#39;,</span><br><span class="line">  &#96;original_total_amount&#96; decimal(16,2) COMMENT &#39;åŸä»·é‡‘é¢&#39;,</span><br><span class="line">  &#96;feight_fee&#96; decimal(16,2) COMMENT &#39;è¿è´¹&#39;</span><br><span class="line">  ) COMMENT &#39;è®¢å•è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;order_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>start_log</p><blockquote><p>æ­¤ä¸ºåŸ‹ç‚¹å¯åŠ¨æ—¥å¿—è¡¨</p></blockquote></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__start_log</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__start_log&#96;(</span><br><span class="line">  &#96;line&#96; string COMMENT &#39;å¯åŠ¨æ—¥å¿—&#39;</span><br><span class="line">  ) COMMENT &#39;å¯åŠ¨æ—¥å¿—è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;start_log&#x2F;&#39;</span><br></pre></td></tr></table></figure><ol start="26"><li>event_log<blockquote><p>æ­¤ä¸ºåŸ‹ç‚¹äº‹ä»¶æ—¥å¿—è¡¨</p></blockquote></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__event_log</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__event_log&#96;(</span><br><span class="line">  &#96;line&#96; string COMMENT &#39;äº‹ä»¶æ—¥å¿—&#39;</span><br><span class="line">  ) COMMENT &#39;äº‹ä»¶æ—¥å¿—è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;event_log&#x2F;&#39;</span><br></pre></td></tr></table></figure><ol start="27"><li>date_info<blockquote><p>æ­¤ä¸ºæ—¶é—´è¡¨</p></blockquote></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ods.mall__date_info</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ods.mall__date_info&#96;(</span><br><span class="line">&#96;date_id&#96; int COMMENT &#39;æ—¥&#39;,</span><br><span class="line">&#96;week_id&#96; int COMMENT &#39;å‘¨&#39;,</span><br><span class="line">&#96;week_day&#96; int COMMENT &#39;å‘¨çš„ç¬¬å‡ å¤©&#39;,</span><br><span class="line">&#96;day&#96; int COMMENT &#39;æ¯æœˆçš„ç¬¬å‡ å¤©&#39;,</span><br><span class="line">&#96;month&#96; int COMMENT &#39;ç¬¬å‡ æœˆ&#39;,</span><br><span class="line">&#96;quarter&#96; int COMMENT &#39;ç¬¬å‡ å­£åº¦&#39;,</span><br><span class="line">&#96;year&#96; int COMMENT &#39;å¹´&#39;,</span><br><span class="line">&#96;is_workday&#96; int COMMENT &#39;æ˜¯å¦æ˜¯å‘¨æœ«&#39;,</span><br><span class="line">&#96;holiday_id&#96; int COMMENT &#39;æ˜¯å¦æ˜¯èŠ‚å‡æ—¥&#39;</span><br><span class="line">  ) COMMENT &#39;æ—¶é—´ç»´åº¦è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ods&#x2F;mall&#x2F;date_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure><p><a name="blogTitle32"></a></p><h3 id="8-2-mysqlæ•°æ®æŠ½å–"><a href="#8-2-mysqlæ•°æ®æŠ½å–" class="headerlink" title="8.2 mysqlæ•°æ®æŠ½å–"></a>8.2 mysqlæ•°æ®æŠ½å–</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445550-cccdcf34-74d8-42ae-ba5e-2c3769ca3c9e.png#align=left&display=inline&height=77&margin=%5Bobject%20Object%5D&originHeight=77&originWidth=1255&size=0&status=done&style=none&width=1255" alt></p><ul><li><p>sqoopæŠ½å–è„šæœ¬åŸºç¡€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">mysql_db_name&#x3D;$&#123;db_name&#125;</span><br><span class="line">mysql_db_addr&#x3D;$&#123;db_addr&#125;</span><br><span class="line">mysql_db_user&#x3D;$&#123;db_user&#125;</span><br><span class="line">mysql_db_password&#x3D;$&#123;db_password&#125;</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">echo &quot;æ—¥æœŸ:&quot;$db_date</span><br><span class="line">echo &quot;mysqlåº“å:&quot;$mysql_db_name</span><br><span class="line">import_data() &#123;</span><br><span class="line">&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;sqoop import \</span><br><span class="line">--connect jdbc:mysql:&#x2F;&#x2F;$mysql_db_addr:3306&#x2F;$mysql_db_name?tinyInt1isBit&#x3D;false \</span><br><span class="line">--username $mysql_db_user \</span><br><span class="line">--password $mysql_db_password \</span><br><span class="line">--target-dir &#x2F;origin_data&#x2F;$mysql_db_name&#x2F;$1&#x2F;$db_date \</span><br><span class="line">--delete-target-dir \</span><br><span class="line">--num-mappers 1 \</span><br><span class="line">--null-string &#39;&#39; \</span><br><span class="line">--null-non-string &#39;\\n&#39; \</span><br><span class="line">--fields-terminated-by &quot;\t&quot; \</span><br><span class="line">--query &quot;$2&quot;&#39; and $CONDITIONS;&#39; \</span><br><span class="line">--as-parquetfile </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>DolphinSchedulerå…¨å±€å‚æ•°</p></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445578-aeef9cf0-c4cf-4a5a-91ea-02ec01c0bf61.png#align=left&display=inline&height=622&margin=%5Bobject%20Object%5D&originHeight=622&originWidth=981&size=0&status=done&style=none&width=981" alt></p><table><thead><tr><th>date</th><th>ä¸ä¼ ä¸ºæ˜¨å¤©</th></tr></thead><tbody><tr><td>db_name</td><td>æ•°æ®åº“åå­—</td></tr><tr><td>db_addr</td><td>æ•°æ®åº“IPåœ°å€</td></tr><tr><td>db_user</td><td>æ•°æ®åº“ç”¨æˆ·</td></tr><tr><td>db_password</td><td>æ•°æ®åº“å¯†ç </td></tr></tbody></table><blockquote><p>å…ƒæ•°æ®ä¸­æ•°æ®å¼€å§‹æ—¥æœŸä¸º2020-03-15<br>å¦‚ä¸‹å¯¼å…¥æ•°æ®ä»£ç ç‰‡æ®µï¼Œæ‹¼æ¥ä¸Šè¿°çš„åŸºç¡€ç‰‡æ®µæ‰§è¡Œ</p></blockquote><ul><li><p>å…¨é‡è¡¨ä»£ç ç‰‡æ®µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">import_data &quot;base_dic&quot; &quot;select</span><br><span class="line">dic_code,</span><br><span class="line">dic_name,</span><br><span class="line">parent_code,</span><br><span class="line">create_time,</span><br><span class="line">operate_time</span><br><span class="line">from base_dic</span><br><span class="line">where 1&#x3D;1&quot;</span><br><span class="line">import_data &quot;base_trademark&quot; &quot;select</span><br><span class="line">tm_id,</span><br><span class="line">tm_name</span><br><span class="line">from base_trademark</span><br><span class="line">where 1&#x3D;1&quot;</span><br><span class="line">import_data &quot;base_category3&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">name,</span><br><span class="line">category2_id</span><br><span class="line">from base_category3 where 1&#x3D;1&quot;</span><br><span class="line">import_data &quot;base_category2&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">name,</span><br><span class="line">category1_id</span><br><span class="line">from base_category2 where 1&#x3D;1&quot;</span><br><span class="line">import_data &quot;base_category1&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">name</span><br><span class="line">from base_category1 where 1&#x3D;1&quot;</span><br><span class="line">import_data &quot;activity_rule&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">activity_id,</span><br><span class="line">condition_amount,</span><br><span class="line">condition_num,</span><br><span class="line">benefit_amount,</span><br><span class="line">benefit_discount,</span><br><span class="line">benefit_level</span><br><span class="line">from activity_rule</span><br><span class="line">where 1&#x3D;1&quot;</span><br><span class="line">import_data &quot;activity_info&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">activity_name,</span><br><span class="line">activity_type,</span><br><span class="line">start_time,</span><br><span class="line">end_time,</span><br><span class="line">create_time</span><br><span class="line">from activity_info</span><br><span class="line">where 1&#x3D;1&quot;</span><br><span class="line">import_data &quot;activity_sku&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">activity_id,</span><br><span class="line">sku_id,</span><br><span class="line">create_time</span><br><span class="line">FROM</span><br><span class="line">activity_sku</span><br><span class="line">where 1&#x3D;1&quot;</span><br><span class="line">import_data &quot;cart_info&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">user_id,</span><br><span class="line">sku_id,</span><br><span class="line">cart_price,</span><br><span class="line">sku_num,</span><br><span class="line">sku_name,</span><br><span class="line">create_time,</span><br><span class="line">operate_time,</span><br><span class="line">is_ordered,</span><br><span class="line">order_time</span><br><span class="line">from cart_info</span><br><span class="line">where 1&#x3D;1&quot;</span><br><span class="line">import_data &quot;favor_info&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">user_id,</span><br><span class="line">sku_id,</span><br><span class="line">spu_id,</span><br><span class="line">is_cancel,</span><br><span class="line">create_time,</span><br><span class="line">cancel_time</span><br><span class="line">from favor_info</span><br><span class="line">where 1&#x3D;1&quot;</span><br><span class="line">import_data &quot;coupon_info&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">coupon_name,</span><br><span class="line">coupon_type,</span><br><span class="line">condition_amount,</span><br><span class="line">condition_num,</span><br><span class="line">activity_id,</span><br><span class="line">benefit_amount,</span><br><span class="line">benefit_discount,</span><br><span class="line">create_time,</span><br><span class="line">range_type,</span><br><span class="line">spu_id,</span><br><span class="line">tm_id,</span><br><span class="line">category3_id,</span><br><span class="line">limit_num,</span><br><span class="line">operate_time,</span><br><span class="line">expire_time</span><br><span class="line">from coupon_info</span><br><span class="line">where 1&#x3D;1&quot;</span><br><span class="line">import_data &quot;sku_info&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">spu_id,</span><br><span class="line">price,</span><br><span class="line">sku_name,</span><br><span class="line">sku_desc,</span><br><span class="line">weight,</span><br><span class="line">tm_id,</span><br><span class="line">category3_id,</span><br><span class="line">create_time</span><br><span class="line">from sku_info where 1&#x3D;1&quot;</span><br><span class="line">import_data &quot;spu_info&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">spu_name,</span><br><span class="line">category3_id,</span><br><span class="line">tm_id</span><br><span class="line">from spu_info</span><br><span class="line">where 1&#x3D;1&quot;</span><br></pre></td></tr></table></figure></li><li><p>ç‰¹æ®Šè¡¨ä»£ç ç‰‡æ®µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import_data &quot;base_province&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">name,</span><br><span class="line">region_id,</span><br><span class="line">area_code,</span><br><span class="line">iso_code</span><br><span class="line">from base_province</span><br><span class="line">where 1&#x3D;1&quot;</span><br><span class="line">import_data &quot;base_region&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">region_name</span><br><span class="line">from base_region</span><br><span class="line">where 1&#x3D;1&quot;</span><br><span class="line">import_data &quot;date_info&quot; &quot;select</span><br><span class="line">date_id,</span><br><span class="line">week_id,</span><br><span class="line">week_day,</span><br><span class="line">day,</span><br><span class="line">month,</span><br><span class="line">quarter,</span><br><span class="line">year,</span><br><span class="line">is_workday,</span><br><span class="line">holiday_id</span><br><span class="line">from date_info</span><br><span class="line">where 1&#x3D;1&quot;</span><br></pre></td></tr></table></figure></li><li><p>å¢é‡è¡¨ä»£ç ç‰‡æ®µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">import_data &quot;order_refund_info&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">user_id,</span><br><span class="line">order_id,</span><br><span class="line">sku_id,</span><br><span class="line">refund_type,</span><br><span class="line">refund_num,</span><br><span class="line">refund_amount,</span><br><span class="line">refund_reason_type,</span><br><span class="line">create_time</span><br><span class="line">from order_refund_info</span><br><span class="line">where</span><br><span class="line">date_format(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;&quot;</span><br><span class="line">import_data &quot;order_status_log&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">order_id,</span><br><span class="line">order_status,</span><br><span class="line">operate_time</span><br><span class="line">from order_status_log</span><br><span class="line">where</span><br><span class="line">date_format(operate_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;&quot;</span><br><span class="line">import_data &quot;payment_info&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">out_trade_no,</span><br><span class="line">order_id,</span><br><span class="line">user_id,</span><br><span class="line">alipay_trade_no,</span><br><span class="line">total_amount,</span><br><span class="line">subject,</span><br><span class="line">payment_type,</span><br><span class="line">payment_time</span><br><span class="line">from payment_info</span><br><span class="line">where</span><br><span class="line">DATE_FORMAT(payment_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;&quot;</span><br><span class="line">import_data &quot;order_detail&quot; &quot;select</span><br><span class="line">od.id,</span><br><span class="line">od.order_id,</span><br><span class="line">oi.user_id,</span><br><span class="line">od.sku_id,</span><br><span class="line">od.sku_name,</span><br><span class="line">od.order_price,</span><br><span class="line">od.sku_num,</span><br><span class="line">od.create_time</span><br><span class="line">from order_detail od</span><br><span class="line">join order_info oi</span><br><span class="line">on od.order_id&#x3D;oi.id</span><br><span class="line">where</span><br><span class="line">DATE_FORMAT(od.create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;&quot;</span><br><span class="line">import_data &quot;activity_order&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">activity_id,</span><br><span class="line">order_id,</span><br><span class="line">create_time</span><br><span class="line">from activity_order</span><br><span class="line">where</span><br><span class="line">date_format(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;&quot;</span><br><span class="line">import_data &quot;comment_info&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">user_id,</span><br><span class="line">sku_id,</span><br><span class="line">spu_id,</span><br><span class="line">order_id,</span><br><span class="line">appraise,</span><br><span class="line">comment_txt,</span><br><span class="line">create_time</span><br><span class="line">from comment_info</span><br><span class="line">where date_format(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;&quot;</span><br></pre></td></tr></table></figure></li><li><p>å¢é‡åŠå˜åŒ–è¡¨ä»£ç ç‰‡æ®µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">import_data &quot;coupon_use&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">coupon_id,</span><br><span class="line">user_id,</span><br><span class="line">order_id,</span><br><span class="line">coupon_status,</span><br><span class="line">get_time,</span><br><span class="line">using_time,</span><br><span class="line">used_time</span><br><span class="line">from coupon_use</span><br><span class="line">where (date_format(get_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;</span><br><span class="line">or date_format(using_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;</span><br><span class="line">or date_format(used_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;)&quot;</span><br><span class="line">import_data &quot;user_info&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">name,</span><br><span class="line">birthday,</span><br><span class="line">gender,</span><br><span class="line">email,</span><br><span class="line">user_level,</span><br><span class="line">create_time,</span><br><span class="line">operate_time</span><br><span class="line">from user_info</span><br><span class="line">where (DATE_FORMAT(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;</span><br><span class="line">or DATE_FORMAT(operate_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;)&quot;</span><br><span class="line">import_data &quot;order_info&quot; &quot;select</span><br><span class="line">id,</span><br><span class="line">final_total_amount,</span><br><span class="line">order_status,</span><br><span class="line">user_id,</span><br><span class="line">out_trade_no,</span><br><span class="line">create_time,</span><br><span class="line">operate_time,</span><br><span class="line">province_id,</span><br><span class="line">benefit_reduce_amount,</span><br><span class="line">original_total_amount,</span><br><span class="line">feight_fee</span><br><span class="line">from order_info</span><br><span class="line">where (date_format(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;</span><br><span class="line">or date_format(operate_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;)&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle33"></a></p><h3 id="8-3-odså±‚æ•°æ®åŠ è½½"><a href="#8-3-odså±‚æ•°æ®åŠ è½½" class="headerlink" title="8.3 odså±‚æ•°æ®åŠ è½½"></a>8.3 odså±‚æ•°æ®åŠ è½½</h3></li><li><p>è„šæœ¬ä¿®æ”¹$table_nameå³å¯</p><blockquote><p>æ³¨æ„2å¼ åŸ‹ç‚¹æ—¥å¿—è¡¨çš„æ•°æ®å¯¼å‡ºç›®å½•</p></blockquote></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ods</span><br><span class="line">table_name&#x3D;base_dic</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">load data inpath &#39;&#x2F;origin_data&#x2F;$APP1&#x2F;$table_name&#x2F;$db_date&#39; OVERWRITE into table $hive_table_name partition(dt&#x3D;&#39;$db_date&#39;);</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle34"></a></p><h2 id="9-dwdå±‚æ„å»º"><a href="#9-dwdå±‚æ„å»º" class="headerlink" title="9 dwdå±‚æ„å»º"></a>9 dwdå±‚æ„å»º</h2><p><a name="blogTitle35"></a></p><h3 id="9-1-dwdå±‚æ„å»ºï¼ˆå¯åŠ¨-äº‹ä»¶æ—¥å¿—ï¼‰"><a href="#9-1-dwdå±‚æ„å»ºï¼ˆå¯åŠ¨-äº‹ä»¶æ—¥å¿—ï¼‰" class="headerlink" title="9.1 dwdå±‚æ„å»ºï¼ˆå¯åŠ¨-äº‹ä»¶æ—¥å¿—ï¼‰"></a>9.1 dwdå±‚æ„å»ºï¼ˆå¯åŠ¨-äº‹ä»¶æ—¥å¿—ï¼‰</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445446614-4652a8e0-0b0a-4e2a-910b-e90751aed058.png#align=left&display=inline&height=446&margin=%5Bobject%20Object%5D&originHeight=446&originWidth=951&size=0&status=done&style=none&width=951" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445749-02840e2e-dcb1-4a8a-8778-e6ee6b650936.png#align=left&display=inline&height=614&margin=%5Bobject%20Object%5D&originHeight=614&originWidth=1477&size=0&status=done&style=none&width=1477" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445567-5b7c6d42-4d24-4807-afb3-cdea023f4f90.png#align=left&display=inline&height=477&margin=%5Bobject%20Object%5D&originHeight=477&originWidth=951&size=0&status=done&style=none&width=951" alt><br><a name="65a81e92"></a></p><h4 id="9-1-1-å¯åŠ¨æ—¥å¿—è¡¨"><a href="#9-1-1-å¯åŠ¨æ—¥å¿—è¡¨" class="headerlink" title="9.1.1 å¯åŠ¨æ—¥å¿—è¡¨"></a>9.1.1 å¯åŠ¨æ—¥å¿—è¡¨</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445612-d6f7562c-f0bb-430f-b4af-7b42344e971f.png#align=left&display=inline&height=730&margin=%5Bobject%20Object%5D&originHeight=730&originWidth=1437&size=0&status=done&style=none&width=1437" alt></p><ul><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__start_log</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__start_log&#96;(</span><br><span class="line">  &#96;mid_id&#96; string COMMENT &#39;è®¾å¤‡å”¯ä¸€æ ‡è¯†&#39;,</span><br><span class="line">  &#96;user_id&#96; string COMMENT &#39;ç”¨æˆ·æ ‡è¯†&#39;,</span><br><span class="line">  &#96;version_code&#96; string COMMENT &#39;ç¨‹åºç‰ˆæœ¬å·&#39;,</span><br><span class="line">  &#96;version_name&#96; string COMMENT &#39;ç¨‹åºç‰ˆæœ¬å&#39;,</span><br><span class="line">  &#96;lang&#96; string COMMENT &#39;ç³»ç»Ÿè¯­è¨€&#39;,</span><br><span class="line">  &#96;source&#96; string COMMENT &#39;æ¸ é“å·&#39;,</span><br><span class="line">  &#96;os&#96; string COMMENT &#39;ç³»ç»Ÿç‰ˆæœ¬&#39;,</span><br><span class="line">  &#96;area&#96; string COMMENT &#39;åŒºåŸŸ&#39;,</span><br><span class="line">  &#96;model&#96; string COMMENT &#39;æ‰‹æœºå‹å·&#39;,</span><br><span class="line">  &#96;brand&#96; string COMMENT &#39;æ‰‹æœºå“ç‰Œ&#39;,</span><br><span class="line">  &#96;sdk_version&#96; string COMMENT &#39;sdkVersion&#39;,</span><br><span class="line">  &#96;gmail&#96; string COMMENT &#39;gmail&#39;,</span><br><span class="line">  &#96;height_width&#96; string COMMENT &#39;å±å¹•å®½é«˜&#39;,</span><br><span class="line">  &#96;app_time&#96; string COMMENT &#39;å®¢æˆ·ç«¯æ—¥å¿—äº§ç”Ÿæ—¶çš„æ—¶é—´&#39;,</span><br><span class="line">  &#96;network&#96; string COMMENT &#39;ç½‘ç»œæ¨¡å¼&#39;,</span><br><span class="line">  &#96;lng&#96; string COMMENT &#39;ç»åº¦&#39;,</span><br><span class="line">  &#96;lat&#96; string COMMENT &#39;çº¬åº¦&#39;,</span><br><span class="line">  &#96;entry&#96; string COMMENT &#39;å…¥å£: push&#x3D;1,widget&#x3D;2,icon&#x3D;3,notification&#x3D;4,lockscreen_widget&#x3D;5&#39;,</span><br><span class="line">  &#96;open_ad_type&#96; string COMMENT &#39;å¼€å±å¹¿å‘Šç±»å‹: å¼€å±åŸç”Ÿå¹¿å‘Š&#x3D;1, å¼€å±æ’å±å¹¿å‘Š&#x3D;2&#39;,</span><br><span class="line">  &#96;action&#96; string COMMENT &#39;çŠ¶æ€ï¼šæˆåŠŸ&#x3D;1 å¤±è´¥&#x3D;2&#39;,</span><br><span class="line">  &#96;loading_time&#96; string COMMENT &#39;åŠ è½½æ—¶é•¿&#39;,</span><br><span class="line">  &#96;detail&#96; string COMMENT &#39;å¤±è´¥ç &#39;,</span><br><span class="line">  &#96;extend1&#96; string COMMENT &#39;å¤±è´¥çš„ message&#39;</span><br><span class="line">  ) COMMENT &#39;å¯åŠ¨æ—¥å¿—è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;start_log&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">APP3&#x3D;ods</span><br><span class="line">table_name&#x3D;start_log</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line">hive_origin_table_name&#x3D;$APP3.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	get_json_object(line,&#39;$.mid&#39;) mid_id,</span><br><span class="line">	get_json_object(line,&#39;$.uid&#39;) user_id,</span><br><span class="line">	get_json_object(line,&#39;$.vc&#39;) version_code,</span><br><span class="line">	get_json_object(line,&#39;$.vn&#39;) version_name,</span><br><span class="line">	get_json_object(line,&#39;$.l&#39;) lang,</span><br><span class="line">	get_json_object(line,&#39;$.sr&#39;) source,</span><br><span class="line">	get_json_object(line,&#39;$.os&#39;) os,</span><br><span class="line">	get_json_object(line,&#39;$.ar&#39;) area,</span><br><span class="line">	get_json_object(line,&#39;$.md&#39;) model,</span><br><span class="line">	get_json_object(line,&#39;$.ba&#39;) brand,</span><br><span class="line">	get_json_object(line,&#39;$.sv&#39;) sdk_version,</span><br><span class="line">	get_json_object(line,&#39;$.g&#39;) gmail,</span><br><span class="line">	get_json_object(line,&#39;$.hw&#39;) height_width,</span><br><span class="line">	get_json_object(line,&#39;$.t&#39;) app_time,</span><br><span class="line">	get_json_object(line,&#39;$.nw&#39;) network,</span><br><span class="line">	get_json_object(line,&#39;$.ln&#39;) lng,</span><br><span class="line">	get_json_object(line,&#39;$.la&#39;) lat,</span><br><span class="line">	get_json_object(line,&#39;$.entry&#39;) entry,</span><br><span class="line">	get_json_object(line,&#39;$.open_ad_type&#39;) open_ad_type,</span><br><span class="line">	get_json_object(line,&#39;$.action&#39;) action,</span><br><span class="line">	get_json_object(line,&#39;$.loading_time&#39;) loading_time,</span><br><span class="line">	get_json_object(line,&#39;$.detail&#39;) detail,</span><br><span class="line">	get_json_object(line,&#39;$.extend1&#39;) extend1</span><br><span class="line">from $hive_origin_table_name</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="396f2a2b"></a></p><h4 id="9-1-2-äº‹ä»¶æ—¥å¿—è¡¨"><a href="#9-1-2-äº‹ä»¶æ—¥å¿—è¡¨" class="headerlink" title="9.1.2 äº‹ä»¶æ—¥å¿—è¡¨"></a>9.1.2 äº‹ä»¶æ—¥å¿—è¡¨</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445586-766cb2b8-d761-4c9a-a289-16f60a99ddcd.png#align=left&display=inline&height=477&margin=%5Bobject%20Object%5D&originHeight=477&originWidth=951&size=0&status=done&style=none&width=951" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445702-d1a78ffa-edf3-4d58-a3bb-dab7ac195815.png#align=left&display=inline&height=604&margin=%5Bobject%20Object%5D&originHeight=604&originWidth=1333&size=0&status=done&style=none&width=1333" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445677-bc019011-2053-412d-b4c8-bfd856f29547.png#align=left&display=inline&height=603&margin=%5Bobject%20Object%5D&originHeight=603&originWidth=1333&size=0&status=done&style=none&width=1333" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445698-37476ac6-25f3-4cea-86ac-f907a3cb1d1d.png#align=left&display=inline&height=621&margin=%5Bobject%20Object%5D&originHeight=621&originWidth=1376&size=0&status=done&style=none&width=1376" alt><br></p></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__event_log</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__event_log&#96;(</span><br><span class="line">  &#96;mid_id&#96; string COMMENT &#39;è®¾å¤‡å”¯ä¸€æ ‡è¯†&#39;,</span><br><span class="line">  &#96;user_id&#96; string COMMENT &#39;ç”¨æˆ·æ ‡è¯†&#39;,</span><br><span class="line">  &#96;version_code&#96; string COMMENT &#39;ç¨‹åºç‰ˆæœ¬å·&#39;,</span><br><span class="line">  &#96;version_name&#96; string COMMENT &#39;ç¨‹åºç‰ˆæœ¬å&#39;,</span><br><span class="line">  &#96;lang&#96; string COMMENT &#39;ç³»ç»Ÿè¯­è¨€&#39;,</span><br><span class="line">  &#96;source&#96; string COMMENT &#39;æ¸ é“å·&#39;,</span><br><span class="line">  &#96;os&#96; string COMMENT &#39;ç³»ç»Ÿç‰ˆæœ¬&#39;,</span><br><span class="line">  &#96;area&#96; string COMMENT &#39;åŒºåŸŸ&#39;,</span><br><span class="line">  &#96;model&#96; string COMMENT &#39;æ‰‹æœºå‹å·&#39;,</span><br><span class="line">  &#96;brand&#96; string COMMENT &#39;æ‰‹æœºå“ç‰Œ&#39;,</span><br><span class="line">  &#96;sdk_version&#96; string COMMENT &#39;sdkVersion&#39;,</span><br><span class="line">  &#96;gmail&#96; string COMMENT &#39;gmail&#39;,</span><br><span class="line">  &#96;height_width&#96; string COMMENT &#39;å±å¹•å®½é«˜&#39;,</span><br><span class="line">  &#96;app_time&#96; string COMMENT &#39;å®¢æˆ·ç«¯æ—¥å¿—äº§ç”Ÿæ—¶çš„æ—¶é—´&#39;,</span><br><span class="line">  &#96;network&#96; string COMMENT &#39;ç½‘ç»œæ¨¡å¼&#39;,</span><br><span class="line">  &#96;lng&#96; string COMMENT &#39;ç»åº¦&#39;,</span><br><span class="line">  &#96;lat&#96; string COMMENT &#39;çº¬åº¦&#39;,</span><br><span class="line">  &#96;event_name&#96; string COMMENT &#39;äº‹ä»¶åç§°&#39;,</span><br><span class="line">  &#96;event_json&#96; string COMMENT &#39;äº‹ä»¶è¯¦æƒ…&#39;,</span><br><span class="line">  &#96;server_time&#96; string COMMENT &#39;æœåŠ¡å™¨æ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;äº‹ä»¶æ—¥å¿—è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;event_log&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure><p><a name="3a5115eb"></a></p><h5 id="9-2-1-åˆ¶ä½œ-UDF-UDTF"><a href="#9-2-1-åˆ¶ä½œ-UDF-UDTF" class="headerlink" title="9.2.1 åˆ¶ä½œ UDF UDTF"></a>9.2.1 åˆ¶ä½œ UDF UDTF</h5></li><li><p>udf</p></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445696-3b581062-c5d4-427f-ba12-e6867d59b49c.png#align=left&display=inline&height=417&margin=%5Bobject%20Object%5D&originHeight=417&originWidth=1318&size=0&status=done&style=none&width=1318" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445883-e8c65772-697b-4f7a-9dd5-d454e8615019.png#align=left&display=inline&height=534&margin=%5Bobject%20Object%5D&originHeight=534&originWidth=1315&size=0&status=done&style=none&width=1315" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.commons.lang.StringUtils;</span><br><span class="line">import org.apache.hadoop.hive.ql.exec.UDF;</span><br><span class="line">import org.json.JSONException;</span><br><span class="line">import org.json.JSONObject;</span><br><span class="line">public class BaseFieldUDF extends UDF &#123;</span><br><span class="line">    public String evaluate(String line, String key) throws JSONException &#123;</span><br><span class="line">        String[] log &#x3D; line.split(&quot;\\|&quot;);</span><br><span class="line">        if (log.length !&#x3D; 2 || StringUtils.isBlank(log[1])) &#123;</span><br><span class="line">            return &quot;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        JSONObject baseJson &#x3D; new JSONObject(log[1].trim());</span><br><span class="line">        String result &#x3D; &quot;&quot;;</span><br><span class="line">        &#x2F;&#x2F; è·å–æœåŠ¡å™¨æ—¶é—´</span><br><span class="line">        if (&quot;st&quot;.equals(key)) &#123;</span><br><span class="line">            result &#x3D; log[0].trim();</span><br><span class="line">        &#125; else if (&quot;et&quot;.equals(key)) &#123;</span><br><span class="line">        &#x2F;&#x2F; è·å–äº‹ä»¶æ•°ç»„</span><br><span class="line">            if (baseJson.has(&quot;et&quot;)) &#123;</span><br><span class="line">                result &#x3D; baseJson.getString(&quot;et&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            JSONObject cm &#x3D; baseJson.getJSONObject(&quot;cm&quot;);</span><br><span class="line">        &#x2F;&#x2F; è·å– key å¯¹åº”å…¬å…±å­—æ®µçš„ value</span><br><span class="line">            if (cm.has(key)) &#123;</span><br><span class="line">                result &#x3D; cm.getString(key);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) throws JSONException &#123;</span><br><span class="line">        String line &#x3D; &quot;         1588319303710|&#123;\n&quot; +</span><br><span class="line">                &quot;        \&quot;cm\&quot;:&#123;\n&quot; +</span><br><span class="line">                &quot;            \&quot;ln\&quot;:\&quot;-51.5\&quot;,\&quot;sv\&quot;:\&quot;V2.0.7\&quot;,\&quot;os\&quot;:\&quot;8.0.8\&quot;,\&quot;g\&quot;:\&quot;L1470998@gmail.com\&quot;,\&quot;mid\&quot;:\&quot;13\&quot;,\n&quot; +</span><br><span class="line">                &quot;                    \&quot;nw\&quot;:\&quot;4G\&quot;,\&quot;l\&quot;:\&quot;en\&quot;,\&quot;vc\&quot;:\&quot;7\&quot;,\&quot;hw\&quot;:\&quot;640*960\&quot;,\&quot;ar\&quot;:\&quot;MX\&quot;,\&quot;uid\&quot;:\&quot;13\&quot;,\&quot;t\&quot;:\&quot;1588291826938\&quot;,\n&quot; +</span><br><span class="line">                &quot;                    \&quot;la\&quot;:\&quot;-38.2\&quot;,\&quot;md\&quot;:\&quot;Huawei-14\&quot;,\&quot;vn\&quot;:\&quot;1.3.6\&quot;,\&quot;ba\&quot;:\&quot;Huawei\&quot;,\&quot;sr\&quot;:\&quot;Y\&quot;\n&quot; +</span><br><span class="line">                &quot;        &#125;,\n&quot; +</span><br><span class="line">                &quot;        \&quot;ap\&quot;:\&quot;app\&quot;,\n&quot; +</span><br><span class="line">                &quot;                \&quot;et\&quot;:[&#123;\n&quot; +</span><br><span class="line">                &quot;            \&quot;ett\&quot;:\&quot;1588228193191\&quot;,\&quot;en\&quot;:\&quot;ad\&quot;,\&quot;kv\&quot;:&#123;\&quot;activityId\&quot;:\&quot;1\&quot;,\&quot;displayMills\&quot;:\&quot;113201\&quot;,\&quot;entry\&quot;:\&quot;3\&quot;,\&quot;action\&quot;:\&quot;5\&quot;,\&quot;contentType\&quot;:\&quot;0\&quot;&#125;\n&quot; +</span><br><span class="line">                &quot;        &#125;,&#123;\n&quot; +</span><br><span class="line">                &quot;            \&quot;ett\&quot;:\&quot;1588300304713\&quot;,\&quot;en\&quot;:\&quot;notification\&quot;,\&quot;kv\&quot;:&#123;\&quot;ap_time\&quot;:\&quot;1588277440794\&quot;,\&quot;action\&quot;:\&quot;2\&quot;,\&quot;type\&quot;:\&quot;3\&quot;,\&quot;content\&quot;:\&quot;\&quot;&#125;\n&quot; +</span><br><span class="line">                &quot;        &#125;,&#123;\n&quot; +</span><br><span class="line">                &quot;            \&quot;ett\&quot;:\&quot;1588249203743\&quot;,\&quot;en\&quot;:\&quot;active_background\&quot;,\&quot;kv\&quot;:&#123;\&quot;active_source\&quot;:\&quot;3\&quot;&#125;\n&quot; +</span><br><span class="line">                &quot;        &#125;,&#123;\n&quot; +</span><br><span class="line">                &quot;            \&quot;ett\&quot;:\&quot;1588225856101\&quot;,\&quot;en\&quot;:\&quot;comment\&quot;,\&quot;kv\&quot;:&#123;\&quot;p_comment_id\&quot;:0,\&quot;addtime\&quot;:\&quot;1588263895040\&quot;,\&quot;praise_count\&quot;:231,\&quot;other_id\&quot;:5,\&quot;comment_id\&quot;:5,\&quot;reply_count\&quot;:62,\&quot;userid\&quot;:7,\&quot;content\&quot;:\&quot;éª¸æ±\&quot;&#125;\n&quot; +</span><br><span class="line">                &quot;        &#125;,&#123;\n&quot; +</span><br><span class="line">                &quot;            \&quot;ett\&quot;:\&quot;1588254200122\&quot;,\&quot;en\&quot;:\&quot;favorites\&quot;,\&quot;kv\&quot;:&#123;\&quot;course_id\&quot;:5,\&quot;id\&quot;:0,\&quot;add_time\&quot;:\&quot;1588264138625\&quot;,\&quot;userid\&quot;:0&#125;\n&quot; +</span><br><span class="line">                &quot;        &#125;,&#123;\n&quot; +</span><br><span class="line">                &quot;            \&quot;ett\&quot;:\&quot;1588281152824\&quot;,\&quot;en\&quot;:\&quot;praise\&quot;,\&quot;kv\&quot;:&#123;\&quot;target_id\&quot;:4,\&quot;id\&quot;:3,\&quot;type\&quot;:3,\&quot;add_time\&quot;:\&quot;1588307696417\&quot;,\&quot;userid\&quot;:8&#125;\n&quot; +</span><br><span class="line">                &quot;        &#125;]\n&quot; +</span><br><span class="line">                &quot;    &#125;&quot;;</span><br><span class="line">        String s &#x3D; new BaseFieldUDF().evaluate(line, &quot;mid&quot;);</span><br><span class="line">        String ss &#x3D; new BaseFieldUDF().evaluate(line, &quot;st&quot;);</span><br><span class="line">        String sss &#x3D; new BaseFieldUDF().evaluate(line, &quot;et&quot;);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        System.out.println(ss);</span><br><span class="line">        System.out.println(sss);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœï¼š<br>13<br>1588319303710<br>[{â€œettâ€:â€1588228193191â€,â€enâ€:â€adâ€,â€kvâ€:{â€œactivityIdâ€:â€1â€,â€displayMillsâ€:â€113201â€,â€entryâ€:â€3â€,â€actionâ€:â€5â€,â€contentTypeâ€:â€0â€}},{â€œettâ€:â€1588300304713â€,â€enâ€:â€notificationâ€,â€kvâ€:{â€œap_timeâ€:â€1588277440794â€,â€actionâ€:â€2â€,â€typeâ€:â€3â€,â€contentâ€:â€â€}},{â€œettâ€:â€1588249203743â€,â€enâ€:â€active_backgroundâ€,â€kvâ€:{â€œactive_sourceâ€:â€3â€}},{â€œettâ€:â€1588225856101â€,â€enâ€:â€commentâ€,â€kvâ€:{â€œp_comment_idâ€:0,â€addtimeâ€:â€1588263895040â€,â€praise_countâ€:231,â€other_idâ€:5,â€comment_idâ€:5,â€reply_countâ€:62,â€useridâ€:7,â€contentâ€:â€éª¸æ±â€}},{â€œettâ€:â€1588254200122â€,â€enâ€:â€favoritesâ€,â€kvâ€:{â€œcourse_idâ€:5,â€idâ€:0,â€add_timeâ€:â€1588264138625â€,â€useridâ€:0}},{â€œettâ€:â€1588281152824â€,â€enâ€:â€praiseâ€,â€kvâ€:{â€œtarget_idâ€:4,â€idâ€:3,â€typeâ€:3,â€add_timeâ€:â€1588307696417â€,â€useridâ€:8}}]</p></blockquote><ul><li>udtf</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445446239-9b99f151-4d88-4505-ab08-fb212a6d8ac7.png#align=left&display=inline&height=339&margin=%5Bobject%20Object%5D&originHeight=339&originWidth=1207&size=0&status=done&style=none&width=1207" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445446059-b20b058a-4006-4c97-bce2-84b85cd28599.png#align=left&display=inline&height=624&margin=%5Bobject%20Object%5D&originHeight=624&originWidth=1205&size=0&status=done&style=none&width=1205" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.commons.lang.StringUtils;</span><br><span class="line">import org.apache.hadoop.hive.ql.exec.UDFArgumentException;</span><br><span class="line">import org.apache.hadoop.hive.ql.metadata.HiveException;</span><br><span class="line">import org.apache.hadoop.hive.ql.udf.generic.GenericUDTF;</span><br><span class="line">import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspector;</span><br><span class="line">import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspectorFactory;</span><br><span class="line">import org.apache.hadoop.hive.serde2.objectinspector.StructObjectInspector;</span><br><span class="line">import org.apache.hadoop.hive.serde2.objectinspector.primitive.PrimitiveObjectInspectorFactory;</span><br><span class="line">import org.json.JSONArray;</span><br><span class="line">import org.json.JSONException;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">public class EventJsonUDTF extends GenericUDTF &#123;</span><br><span class="line">    &#x2F;&#x2F;è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†æŒ‡å®šè¾“å‡ºå‚æ•°çš„åç§°å’Œå‚æ•°ç±»å‹ï¼š</span><br><span class="line">    public StructObjectInspector initialize(StructObjectInspector argOIs) throws UDFArgumentException &#123;</span><br><span class="line">        ArrayList&lt;String&gt; fieldNames &#x3D; new ArrayList&lt;String&gt;();</span><br><span class="line">        ArrayList&lt;ObjectInspector&gt; fieldOIs &#x3D; new ArrayList&lt;ObjectInspector&gt;();</span><br><span class="line">        fieldNames.add(&quot;event_name&quot;);</span><br><span class="line">        fieldOIs.add(PrimitiveObjectInspectorFactory.javaStringObjectInspector);</span><br><span class="line">        fieldNames.add(&quot;event_json&quot;);</span><br><span class="line">        fieldOIs.add(PrimitiveObjectInspectorFactory.javaStringObjectInspector);</span><br><span class="line">        return ObjectInspectorFactory.getStandardStructObjectInspector(fieldNames,</span><br><span class="line">                fieldOIs);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;è¾“å…¥ 1 æ¡è®°å½•ï¼Œè¾“å‡ºè‹¥å¹²æ¡ç»“æœ</span><br><span class="line">    @Override</span><br><span class="line">    public void process(Object[] objects) throws HiveException &#123;</span><br><span class="line">        &#x2F;&#x2F; è·å–ä¼ å…¥çš„ et</span><br><span class="line">        String input &#x3D; objects[0].toString();</span><br><span class="line">        &#x2F;&#x2F; å¦‚æœä¼ è¿›æ¥çš„æ•°æ®ä¸ºç©ºï¼Œç›´æ¥è¿”å›è¿‡æ»¤æ‰è¯¥æ•°æ®</span><br><span class="line">        if (StringUtils.isBlank(input)) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                &#x2F;&#x2F; è·å–ä¸€å…±æœ‰å‡ ä¸ªäº‹ä»¶ï¼ˆad&#x2F;facoritersï¼‰</span><br><span class="line">                JSONArray ja &#x3D; new JSONArray(input);</span><br><span class="line">                if (ja &#x3D;&#x3D; null)</span><br><span class="line">                    return;</span><br><span class="line">                &#x2F;&#x2F; å¾ªç¯éå†æ¯ä¸€ä¸ªäº‹ä»¶</span><br><span class="line">                for (int i &#x3D; 0; i &lt; ja.length(); i++) &#123;</span><br><span class="line">                    String[] result &#x3D; new String[2];</span><br><span class="line">                    try &#123;</span><br><span class="line">                        &#x2F;&#x2F; å–å‡ºæ¯ä¸ªçš„äº‹ä»¶åç§°ï¼ˆad&#x2F;facoritersï¼‰</span><br><span class="line">                        result[0] &#x3D; ja.getJSONObject(i).getString(&quot;en&quot;);</span><br><span class="line">                        &#x2F;&#x2F; å–å‡ºæ¯ä¸€ä¸ªäº‹ä»¶æ•´ä½“</span><br><span class="line">                        result[1] &#x3D; ja.getString(i);</span><br><span class="line">                    &#125; catch (JSONException e) &#123;</span><br><span class="line">                        continue;</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#x2F;&#x2F; å°†ç»“æœè¿”å›</span><br><span class="line">                    forward(result);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (JSONException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;å½“æ²¡æœ‰è®°å½•å¤„ç†çš„æ—¶å€™è¯¥æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œç”¨æ¥æ¸…ç†ä»£ç æˆ–è€…äº§ç”Ÿé¢å¤–çš„è¾“å‡º</span><br><span class="line">    @Override</span><br><span class="line">    public void close() throws HiveException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a name="86de846c"></a></p><h5 id="9-1-2-2-ç›´æ¥æ°¸ä¹…ä½¿ç”¨UDF"><a href="#9-1-2-2-ç›´æ¥æ°¸ä¹…ä½¿ç”¨UDF" class="headerlink" title="9.1.2.2 ç›´æ¥æ°¸ä¹…ä½¿ç”¨UDF"></a>9.1.2.2 ç›´æ¥æ°¸ä¹…ä½¿ç”¨UDF</h5><ul><li>ä¸Šä¼ UDFèµ„æº<blockquote><p>å°†hive-function-1.0-SNAPSHOTåŒ…ä¼ åˆ°HDFS çš„/user/hive/jarsä¸‹</p></blockquote></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop dfs -mkdir  &#x2F;user&#x2F;hive&#x2F;jars</span><br><span class="line">hadoop dfs -put hive-function-1.0-SNAPSHOT.jar &#x2F;user&#x2F;hive&#x2F;jars&#x2F;hive-function-1.0-SNAPSHOT.jar</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨hiveä¸­åˆ›å»ºæ°¸ä¹…UDF</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create function base_analizer as &#39;com.heaton.bigdata.udf.BaseFieldUDF&#39; using jar &#39;hdfs:&#x2F;&#x2F;cdh01.cm:8020&#x2F;user&#x2F;hive&#x2F;jars&#x2F;hive-function-1.0-SNAPSHOT.jar&#39;;</span><br><span class="line">create function flat_analizer as &#39;com.heaton.bigdata.udtf.EventJsonUDTF&#39; using jar &#39;hdfs:&#x2F;&#x2F;cdh01.cm:8020&#x2F;user&#x2F;hive&#x2F;jars&#x2F;hive-function-1.0-SNAPSHOT.jar&#39;;</span><br></pre></td></tr></table></figure><p><a name="620b459a"></a></p><h5 id="9-1-2-3-Dolphinä½¿ç”¨æ–¹å¼UDF"><a href="#9-1-2-3-Dolphinä½¿ç”¨æ–¹å¼UDF" class="headerlink" title="9.1.2.3 Dolphinä½¿ç”¨æ–¹å¼UDF"></a>9.1.2.3 Dolphinä½¿ç”¨æ–¹å¼UDF</h5><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445818-d1c8fc14-e529-4591-805f-7345bab479e8.png#align=left&display=inline&height=330&margin=%5Bobject%20Object%5D&originHeight=330&originWidth=1906&size=0&status=done&style=none&width=1906" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445645-ab931a0b-bb10-4b9a-9c67-c42afdb4132d.png#align=left&display=inline&height=334&margin=%5Bobject%20Object%5D&originHeight=334&originWidth=1722&size=0&status=done&style=none&width=1722" alt></p><blockquote><p>åœ¨DAGå›¾åˆ›å»ºSQLå·¥å…·ä¸­é€‰æ‹©å¯¹åº”UDFå‡½æ•°å³å¯ä½¿ç”¨ï¼Œä½†æ˜¯ç›®å‰Dolphin1.2.0ä¸­å…³è”å‡½æ•°æ“ä½œä¿å­˜æ— æ•ˆã€‚<br>å¤§å®¶å¯ä»¥ä½¿ç”¨UDFç®¡ç†åŠŸèƒ½å°†JARä¼ å…¥åˆ°HDFSä¸Šï¼Œè¿™æ ·é€šè¿‡è„šæœ¬åŠ å…¥ä¸´æ—¶å‡½æ•°ï¼Œä¹Ÿå¯ä»¥å¾ˆå¥½çš„å®ŒæˆåŠŸèƒ½ã€‚<br>ä¸´æ—¶å‡½æ•°è¯­å¥ï¼š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create temporary function base_analizer as &#39;com.heaton.bigdata.udf.BaseFieldUDF&#39; using jar &#39;hdfs:&#x2F;&#x2F;cdh01.cm:8020&#x2F;dolphinscheduler&#x2F;dolphinscheduler&#x2F;udfs&#x2F;hive-function-1.0-SNAPSHOT.jar&#39;;</span><br><span class="line">create temporary function flat_analizer as &#39;com.heaton.bigdata.udtf.EventJsonUDTF&#39; using jar &#39;hdfs:&#x2F;&#x2F;cdh01.cm:8020&#x2F;dolphinscheduler&#x2F;dolphinscheduler&#x2F;udfs&#x2F;hive-function-1.0-SNAPSHOT.jar&#39;;</span><br></pre></td></tr></table></figure><p><a name="29e0a488"></a></p><h5 id="9-2-4-æ•°æ®å¯¼å…¥"><a href="#9-2-4-æ•°æ®å¯¼å…¥" class="headerlink" title="9.2.4 æ•°æ®å¯¼å…¥"></a>9.2.4 æ•°æ®å¯¼å…¥</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">APP3&#x3D;ods</span><br><span class="line">table_name&#x3D;event_log</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line">hive_origin_table_name&#x3D;$APP3.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	base_analizer(line,&#39;mid&#39;) as mid_id,</span><br><span class="line">	base_analizer(line,&#39;uid&#39;) as user_id,</span><br><span class="line">	base_analizer(line,&#39;vc&#39;) as version_code,</span><br><span class="line">	base_analizer(line,&#39;vn&#39;) as version_name,</span><br><span class="line">	base_analizer(line,&#39;l&#39;) as lang,</span><br><span class="line">	base_analizer(line,&#39;sr&#39;) as source,</span><br><span class="line">	base_analizer(line,&#39;os&#39;) as os,</span><br><span class="line">	base_analizer(line,&#39;ar&#39;) as area,</span><br><span class="line">	base_analizer(line,&#39;md&#39;) as model,</span><br><span class="line">	base_analizer(line,&#39;ba&#39;) as brand,</span><br><span class="line">	base_analizer(line,&#39;sv&#39;) as sdk_version,</span><br><span class="line">	base_analizer(line,&#39;g&#39;) as gmail,</span><br><span class="line">	base_analizer(line,&#39;hw&#39;) as height_width,</span><br><span class="line">	base_analizer(line,&#39;t&#39;) as app_time,</span><br><span class="line">	base_analizer(line,&#39;nw&#39;) as network,</span><br><span class="line">	base_analizer(line,&#39;ln&#39;) as lng,</span><br><span class="line">	base_analizer(line,&#39;la&#39;) as lat,</span><br><span class="line">	event_name,</span><br><span class="line">	event_json,</span><br><span class="line">	base_analizer(line,&#39;st&#39;) as server_time</span><br><span class="line">from $hive_origin_table_name lateral view flat_analizer(base_analizer(line,&#39;et&#39;)) tmp_flat as event_name,event_json</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39; and base_analizer(line,&#39;et&#39;)&lt;&gt;&#39;&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="44c27f4d"></a></p><h4 id="9-1-3-å•†å“ç‚¹å‡»è¡¨"><a href="#9-1-3-å•†å“ç‚¹å‡»è¡¨" class="headerlink" title="9.1.3 å•†å“ç‚¹å‡»è¡¨"></a>9.1.3 å•†å“ç‚¹å‡»è¡¨</h4><ul><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__display_log</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__display_log&#96;(</span><br><span class="line">	&#96;mid_id&#96; string,</span><br><span class="line">	&#96;user_id&#96; string,</span><br><span class="line">	&#96;version_code&#96; string,</span><br><span class="line">	&#96;version_name&#96; string,</span><br><span class="line">	&#96;lang&#96; string,</span><br><span class="line">	&#96;source&#96; string,</span><br><span class="line">	&#96;os&#96; string,</span><br><span class="line">	&#96;area&#96; string,</span><br><span class="line">	&#96;model&#96; string,</span><br><span class="line">	&#96;brand&#96; string,</span><br><span class="line">	&#96;sdk_version&#96; string,</span><br><span class="line">	&#96;gmail&#96; string,</span><br><span class="line">	&#96;height_width&#96; string,</span><br><span class="line">	&#96;app_time&#96; string,</span><br><span class="line">	&#96;network&#96; string,</span><br><span class="line">	&#96;lng&#96; string,</span><br><span class="line">	&#96;lat&#96; string,</span><br><span class="line">	&#96;action&#96; string,</span><br><span class="line">	&#96;goodsid&#96; string,</span><br><span class="line">	&#96;place&#96; string,</span><br><span class="line">	&#96;extend1&#96; string,</span><br><span class="line">	&#96;category&#96; string,</span><br><span class="line">	&#96;server_time&#96; string</span><br><span class="line">  ) COMMENT &#39;å•†å“ç‚¹å‡»è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;display_log&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">APP3&#x3D;ods</span><br><span class="line">table_name&#x3D;display_log</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line">hive_origin_table_name&#x3D;$APP3.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">	select</span><br><span class="line">	mid_id,</span><br><span class="line">	user_id,</span><br><span class="line">	version_code,</span><br><span class="line">	version_name,</span><br><span class="line">	lang,</span><br><span class="line">	source,</span><br><span class="line">	os,</span><br><span class="line">	area,</span><br><span class="line">	model,</span><br><span class="line">	brand,</span><br><span class="line">	sdk_version,</span><br><span class="line">	gmail,</span><br><span class="line">	height_width,</span><br><span class="line">	app_time,</span><br><span class="line">	network,</span><br><span class="line">	lng,</span><br><span class="line">	lat,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.action&#39;) action,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.goodsid&#39;) goodsid,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.place&#39;) place,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.extend1&#39;) extend1,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.category&#39;) category,</span><br><span class="line">	server_time</span><br><span class="line">from dwd.mall__event_log</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39; and event_name&#x3D;&#39;display&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="9a570f18"></a></p><h4 id="9-1-4-å•†å“åˆ—è¡¨è¡¨"><a href="#9-1-4-å•†å“åˆ—è¡¨è¡¨" class="headerlink" title="9.1.4 å•†å“åˆ—è¡¨è¡¨"></a>9.1.4 å•†å“åˆ—è¡¨è¡¨</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__loading_log</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__loading_log&#96;(</span><br><span class="line">	&#96;mid_id&#96; string,</span><br><span class="line">	&#96;user_id&#96; string,</span><br><span class="line">	&#96;version_code&#96; string,</span><br><span class="line">	&#96;version_name&#96; string,</span><br><span class="line">	&#96;lang&#96; string,</span><br><span class="line">	&#96;source&#96; string,</span><br><span class="line">	&#96;os&#96; string,</span><br><span class="line">	&#96;area&#96; string,</span><br><span class="line">	&#96;model&#96; string,</span><br><span class="line">	&#96;brand&#96; string,</span><br><span class="line">	&#96;sdk_version&#96; string,</span><br><span class="line">	&#96;gmail&#96; string,</span><br><span class="line">	&#96;height_width&#96; string,</span><br><span class="line">	&#96;app_time&#96; string,</span><br><span class="line">	&#96;network&#96; string,</span><br><span class="line">	&#96;lng&#96; string,</span><br><span class="line">	&#96;lat&#96; string,</span><br><span class="line">	&#96;action&#96; string,</span><br><span class="line">	&#96;loading_time&#96; string,</span><br><span class="line">	&#96;loading_way&#96; string,</span><br><span class="line">	&#96;extend1&#96; string,</span><br><span class="line">	&#96;extend2&#96; string,</span><br><span class="line">	&#96;type&#96; string,</span><br><span class="line">	&#96;type1&#96; string,</span><br><span class="line">	&#96;server_time&#96; string</span><br><span class="line">  ) COMMENT &#39;å•†å“åˆ—è¡¨è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;loading_log&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">APP3&#x3D;ods</span><br><span class="line">table_name&#x3D;loading_log</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line">hive_origin_table_name&#x3D;$APP3.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	mid_id,</span><br><span class="line">	user_id,</span><br><span class="line">	version_code,</span><br><span class="line">	version_name,</span><br><span class="line">	lang,</span><br><span class="line">	source,</span><br><span class="line">	os,</span><br><span class="line">	area,</span><br><span class="line">	model,</span><br><span class="line">	brand,</span><br><span class="line">	sdk_version,</span><br><span class="line">	gmail,</span><br><span class="line">	height_width,</span><br><span class="line">	app_time,</span><br><span class="line">	network,</span><br><span class="line">	lng,</span><br><span class="line">	lat,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.action&#39;) action,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.loading_time&#39;) loading_time,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.loading_way&#39;) loading_way,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.extend1&#39;) extend1,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.extend2&#39;) extend2,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.type&#39;) type,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.type1&#39;) type1,</span><br><span class="line">	server_time</span><br><span class="line">from dwd.mall__event_log</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39; and event_name&#x3D;&#39;loading&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="502f9d47"></a></p><h4 id="9-1-5-å¹¿å‘Šè¡¨"><a href="#9-1-5-å¹¿å‘Šè¡¨" class="headerlink" title="9.1.5 å¹¿å‘Šè¡¨"></a>9.1.5 å¹¿å‘Šè¡¨</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__ad_log</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__ad_log&#96;(</span><br><span class="line">	&#96;mid_id&#96; string,</span><br><span class="line">	&#96;user_id&#96; string,</span><br><span class="line">	&#96;version_code&#96; string,</span><br><span class="line">	&#96;version_name&#96; string,</span><br><span class="line">	&#96;lang&#96; string,</span><br><span class="line">	&#96;source&#96; string,</span><br><span class="line">	&#96;os&#96; string,</span><br><span class="line">	&#96;area&#96; string,</span><br><span class="line">	&#96;model&#96; string,</span><br><span class="line">	&#96;brand&#96; string,</span><br><span class="line">	&#96;sdk_version&#96; string,</span><br><span class="line">	&#96;gmail&#96; string,</span><br><span class="line">	&#96;height_width&#96; string,</span><br><span class="line">	&#96;app_time&#96; string,</span><br><span class="line">	&#96;network&#96; string,</span><br><span class="line">	&#96;lng&#96; string,</span><br><span class="line">	&#96;lat&#96; string,</span><br><span class="line">	&#96;entry&#96; string,</span><br><span class="line">	&#96;action&#96; string,</span><br><span class="line">	&#96;contentType&#96; string,</span><br><span class="line">	&#96;displayMills&#96; string,</span><br><span class="line">	&#96;itemId&#96; string,</span><br><span class="line">	&#96;activityId&#96; string,</span><br><span class="line">	&#96;server_time&#96; string</span><br><span class="line">  ) COMMENT &#39;å¹¿å‘Šè¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;ad_log&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">APP3&#x3D;ods</span><br><span class="line">table_name&#x3D;ad_log</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line">hive_origin_table_name&#x3D;$APP3.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	mid_id,</span><br><span class="line">	user_id,</span><br><span class="line">	version_code,</span><br><span class="line">	version_name,</span><br><span class="line">	lang,</span><br><span class="line">	source,</span><br><span class="line">	os,</span><br><span class="line">	area,</span><br><span class="line">	model,</span><br><span class="line">	brand,</span><br><span class="line">	sdk_version,</span><br><span class="line">	gmail,</span><br><span class="line">	height_width,</span><br><span class="line">	app_time,</span><br><span class="line">	network,</span><br><span class="line">	lng,</span><br><span class="line">	lat,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.entry&#39;) entry,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.action&#39;) action,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.contentType&#39;) contentType,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.displayMills&#39;) displayMills,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.itemId&#39;) itemId,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.activityId&#39;) activityId,</span><br><span class="line">	server_time</span><br><span class="line">from dwd.mall__event_log</span><br><span class="line">where dt&#x3D;&#39;db_date&#39; and event_name&#x3D;&#39;ad&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="a25a0ee7"></a></p><h4 id="9-1-6-æ¶ˆæ¯é€šçŸ¥è¡¨"><a href="#9-1-6-æ¶ˆæ¯é€šçŸ¥è¡¨" class="headerlink" title="9.1.6 æ¶ˆæ¯é€šçŸ¥è¡¨"></a>9.1.6 æ¶ˆæ¯é€šçŸ¥è¡¨</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__notification_log</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__notification_log&#96;(</span><br><span class="line">	&#96;mid_id&#96; string,</span><br><span class="line">	&#96;user_id&#96; string,</span><br><span class="line">	&#96;version_code&#96; string,</span><br><span class="line">	&#96;version_name&#96; string,</span><br><span class="line">	&#96;lang&#96; string,</span><br><span class="line">	&#96;source&#96; string,</span><br><span class="line">	&#96;os&#96; string,</span><br><span class="line">	&#96;area&#96; string,</span><br><span class="line">	&#96;model&#96; string,</span><br><span class="line">	&#96;brand&#96; string,</span><br><span class="line">	&#96;sdk_version&#96; string,</span><br><span class="line">	&#96;gmail&#96; string,</span><br><span class="line">	&#96;height_width&#96; string,</span><br><span class="line">	&#96;app_time&#96; string,</span><br><span class="line">	&#96;network&#96; string,</span><br><span class="line">	&#96;lng&#96; string,</span><br><span class="line">	&#96;lat&#96; string,</span><br><span class="line">	&#96;action&#96; string,</span><br><span class="line">	&#96;noti_type&#96; string,</span><br><span class="line">	&#96;ap_time&#96; string,</span><br><span class="line">	&#96;content&#96; string,</span><br><span class="line">	&#96;server_time&#96; string</span><br><span class="line">  ) COMMENT &#39;æ¶ˆæ¯é€šçŸ¥è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;notification_log&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">APP3&#x3D;ods</span><br><span class="line">table_name&#x3D;notification_log</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line">hive_origin_table_name&#x3D;$APP3.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	mid_id,</span><br><span class="line">	user_id,</span><br><span class="line">	version_code,</span><br><span class="line">	version_name,</span><br><span class="line">	lang,</span><br><span class="line">	source,</span><br><span class="line">	os,</span><br><span class="line">	area,</span><br><span class="line">	model,</span><br><span class="line">	brand,</span><br><span class="line">	sdk_version,</span><br><span class="line">	gmail,</span><br><span class="line">	height_width,</span><br><span class="line">	app_time,</span><br><span class="line">	network,</span><br><span class="line">	lng,</span><br><span class="line">	lat,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.action&#39;) action,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.noti_type&#39;) noti_type,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.ap_time&#39;) ap_time,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.content&#39;) content,</span><br><span class="line">	server_time</span><br><span class="line">from dwd.mall__event_log</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39; and event_name&#x3D;&#39;notification&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="e14d4ccf"></a></p><h4 id="9-1-7-ç”¨æˆ·åå°æ´»è·ƒè¡¨"><a href="#9-1-7-ç”¨æˆ·åå°æ´»è·ƒè¡¨" class="headerlink" title="9.1.7 ç”¨æˆ·åå°æ´»è·ƒè¡¨"></a>9.1.7 ç”¨æˆ·åå°æ´»è·ƒè¡¨</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__active_background_log</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__active_background_log&#96;(</span><br><span class="line">	&#96;mid_id&#96; string,</span><br><span class="line">	&#96;user_id&#96; string,</span><br><span class="line">	&#96;version_code&#96; string,</span><br><span class="line">	&#96;version_name&#96; string,</span><br><span class="line">	&#96;lang&#96; string,</span><br><span class="line">	&#96;source&#96; string,</span><br><span class="line">	&#96;os&#96; string,</span><br><span class="line">	&#96;area&#96; string,</span><br><span class="line">	&#96;model&#96; string,</span><br><span class="line">	&#96;brand&#96; string,</span><br><span class="line">	&#96;sdk_version&#96; string,</span><br><span class="line">	&#96;gmail&#96; string,</span><br><span class="line">	&#96;height_width&#96; string,</span><br><span class="line">	&#96;app_time&#96; string,</span><br><span class="line">	&#96;network&#96; string,</span><br><span class="line">	&#96;lng&#96; string,</span><br><span class="line">	&#96;lat&#96; string,</span><br><span class="line">	&#96;active_source&#96; string,</span><br><span class="line">	&#96;server_time&#96; string</span><br><span class="line">  ) COMMENT &#39;ç”¨æˆ·åå°æ´»è·ƒè¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;active_background_log&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">APP3&#x3D;ods</span><br><span class="line">table_name&#x3D;active_background_log</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line">hive_origin_table_name&#x3D;$APP3.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	mid_id,</span><br><span class="line">	user_id,</span><br><span class="line">	version_code,</span><br><span class="line">	version_name,</span><br><span class="line">	lang,</span><br><span class="line">	source,</span><br><span class="line">	os,</span><br><span class="line">	area,</span><br><span class="line">	model,</span><br><span class="line">	brand,</span><br><span class="line">	sdk_version,</span><br><span class="line">	gmail,</span><br><span class="line">	height_width,</span><br><span class="line">	app_time,</span><br><span class="line">	network,</span><br><span class="line">	lng,</span><br><span class="line">	lat,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.active_source&#39;) active_source,</span><br><span class="line">	server_time</span><br><span class="line">from dwd.mall__event_log</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39; and event_name&#x3D;&#39;active_background&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="9f615d68"></a></p><h4 id="9-1-8-è¯„è®ºè¡¨"><a href="#9-1-8-è¯„è®ºè¡¨" class="headerlink" title="9.1.8 è¯„è®ºè¡¨"></a>9.1.8 è¯„è®ºè¡¨</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__comment_log</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__comment_log&#96;(</span><br><span class="line">	&#96;mid_id&#96; string,</span><br><span class="line">	&#96;user_id&#96; string,</span><br><span class="line">	&#96;version_code&#96; string,</span><br><span class="line">	&#96;version_name&#96; string,</span><br><span class="line">	&#96;lang&#96; string,</span><br><span class="line">	&#96;source&#96; string,</span><br><span class="line">	&#96;os&#96; string,</span><br><span class="line">	&#96;area&#96; string,</span><br><span class="line">	&#96;model&#96; string,</span><br><span class="line">	&#96;brand&#96; string,</span><br><span class="line">	&#96;sdk_version&#96; string,</span><br><span class="line">	&#96;gmail&#96; string,</span><br><span class="line">	&#96;height_width&#96; string,</span><br><span class="line">	&#96;app_time&#96; string,</span><br><span class="line">	&#96;network&#96; string,</span><br><span class="line">	&#96;lng&#96; string,</span><br><span class="line">	&#96;lat&#96; string,</span><br><span class="line">	&#96;comment_id&#96; int,</span><br><span class="line">	&#96;userid&#96; int,</span><br><span class="line">	&#96;p_comment_id&#96; int,</span><br><span class="line">	&#96;content&#96; string,</span><br><span class="line">	&#96;addtime&#96; string,</span><br><span class="line">	&#96;other_id&#96; int,</span><br><span class="line">	&#96;praise_count&#96; int,</span><br><span class="line">	&#96;reply_count&#96; int,</span><br><span class="line">	&#96;server_time&#96; string</span><br><span class="line">  ) COMMENT &#39;è¯„è®ºè¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;comment_log&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">APP3&#x3D;ods</span><br><span class="line">table_name&#x3D;comment_log</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line">hive_origin_table_name&#x3D;$APP3.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	mid_id,</span><br><span class="line">	user_id,</span><br><span class="line">	version_code,</span><br><span class="line">	version_name,</span><br><span class="line">	lang,</span><br><span class="line">	source,</span><br><span class="line">	os,</span><br><span class="line">	area,</span><br><span class="line">	model,</span><br><span class="line">	brand,</span><br><span class="line">	sdk_version,</span><br><span class="line">	gmail,</span><br><span class="line">	height_width,</span><br><span class="line">	app_time,</span><br><span class="line">	network,</span><br><span class="line">	lng,</span><br><span class="line">	lat,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.comment_id&#39;) comment_id,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.userid&#39;) userid,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.p_comment_id&#39;) p_comment_id,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.content&#39;) content,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.addtime&#39;) addtime,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.other_id&#39;) other_id,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.praise_count&#39;) praise_count,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.reply_count&#39;) reply_count,</span><br><span class="line">	server_time</span><br><span class="line">from dwd.mall__event_log</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39; and event_name&#x3D;&#39;comment&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="6448bc13"></a></p><h4 id="9-1-9-æ”¶è—è¡¨"><a href="#9-1-9-æ”¶è—è¡¨" class="headerlink" title="9.1.9 æ”¶è—è¡¨"></a>9.1.9 æ”¶è—è¡¨</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__favorites_log</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__favorites_log&#96;(</span><br><span class="line">	&#96;mid_id&#96; string,</span><br><span class="line">	&#96;user_id&#96; string,</span><br><span class="line">	&#96;version_code&#96; string,</span><br><span class="line">	&#96;version_name&#96; string,</span><br><span class="line">	&#96;lang&#96; string,</span><br><span class="line">	&#96;source&#96; string,</span><br><span class="line">	&#96;os&#96; string,</span><br><span class="line">	&#96;area&#96; string,</span><br><span class="line">	&#96;model&#96; string,</span><br><span class="line">	&#96;brand&#96; string,</span><br><span class="line">	&#96;sdk_version&#96; string,</span><br><span class="line">	&#96;gmail&#96; string,</span><br><span class="line">	&#96;height_width&#96; string,</span><br><span class="line">	&#96;app_time&#96; string,</span><br><span class="line">	&#96;network&#96; string,</span><br><span class="line">	&#96;lng&#96; string,</span><br><span class="line">	&#96;lat&#96; string,</span><br><span class="line">	&#96;id&#96; int,</span><br><span class="line">	&#96;course_id&#96; int,</span><br><span class="line">	&#96;userid&#96; int,</span><br><span class="line">	&#96;add_time&#96; string,</span><br><span class="line">	&#96;server_time&#96; string</span><br><span class="line">  ) COMMENT &#39;æ”¶è—è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;favorites_log&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">APP3&#x3D;ods</span><br><span class="line">table_name&#x3D;favorites_log</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line">hive_origin_table_name&#x3D;$APP3.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	mid_id,</span><br><span class="line">	user_id,</span><br><span class="line">	version_code,</span><br><span class="line">	version_name,</span><br><span class="line">	lang,</span><br><span class="line">	source,</span><br><span class="line">	os,</span><br><span class="line">	area,</span><br><span class="line">	model,</span><br><span class="line">	brand,</span><br><span class="line">	sdk_version,</span><br><span class="line">	gmail,</span><br><span class="line">	height_width,</span><br><span class="line">	app_time,</span><br><span class="line">	network,</span><br><span class="line">	lng,</span><br><span class="line">	lat,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.id&#39;) id,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.course_id&#39;) course_id,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.userid&#39;) userid,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.add_time&#39;) add_time,</span><br><span class="line">	server_time</span><br><span class="line">from dwd.mall__event_log</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39; and event_name&#x3D;&#39;favorites&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="9790b43b"></a></p><h4 id="9-1-10-ç‚¹èµè¡¨"><a href="#9-1-10-ç‚¹èµè¡¨" class="headerlink" title="9.1.10 ç‚¹èµè¡¨"></a>9.1.10 ç‚¹èµè¡¨</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__praise_log</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__praise_log&#96;(</span><br><span class="line">	&#96;mid_id&#96; string,</span><br><span class="line">	&#96;user_id&#96; string,</span><br><span class="line">	&#96;version_code&#96; string,</span><br><span class="line">	&#96;version_name&#96; string,</span><br><span class="line">	&#96;lang&#96; string,</span><br><span class="line">	&#96;source&#96; string,</span><br><span class="line">	&#96;os&#96; string,</span><br><span class="line">	&#96;area&#96; string,</span><br><span class="line">	&#96;model&#96; string,</span><br><span class="line">	&#96;brand&#96; string,</span><br><span class="line">	&#96;sdk_version&#96; string,</span><br><span class="line">	&#96;gmail&#96; string,</span><br><span class="line">	&#96;height_width&#96; string,</span><br><span class="line">	&#96;app_time&#96; string,</span><br><span class="line">	&#96;network&#96; string,</span><br><span class="line">	&#96;lng&#96; string,</span><br><span class="line">	&#96;lat&#96; string,</span><br><span class="line">	&#96;id&#96; string,</span><br><span class="line">	&#96;userid&#96; string,</span><br><span class="line">	&#96;target_id&#96; string,</span><br><span class="line">	&#96;type&#96; string,</span><br><span class="line">	&#96;add_time&#96; string,</span><br><span class="line">	&#96;server_time&#96; string</span><br><span class="line">  ) COMMENT &#39;ç‚¹èµè¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;praise_log&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">APP3&#x3D;ods</span><br><span class="line">table_name&#x3D;praise_log</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line">hive_origin_table_name&#x3D;$APP3.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	mid_id,</span><br><span class="line">	user_id,</span><br><span class="line">	version_code,</span><br><span class="line">	version_name,</span><br><span class="line">	lang,</span><br><span class="line">	source,</span><br><span class="line">	os,</span><br><span class="line">	area,</span><br><span class="line">	model,</span><br><span class="line">	brand,</span><br><span class="line">	sdk_version,</span><br><span class="line">	gmail,</span><br><span class="line">	height_width,</span><br><span class="line">	app_time,</span><br><span class="line">	network,</span><br><span class="line">	lng,</span><br><span class="line">	lat,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.id&#39;) id,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.userid&#39;) userid,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.target_id&#39;) target_id,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.type&#39;) type,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.add_time&#39;) add_time,</span><br><span class="line">	server_time</span><br><span class="line">from dwd.mall__event_log</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39; and event_name&#x3D;&#39;praise&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="ffc7fca0"></a></p><h4 id="9-1-11-é”™è¯¯æ—¥å¿—è¡¨"><a href="#9-1-11-é”™è¯¯æ—¥å¿—è¡¨" class="headerlink" title="9.1.11 é”™è¯¯æ—¥å¿—è¡¨"></a>9.1.11 é”™è¯¯æ—¥å¿—è¡¨</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__error_log</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__error_log&#96;(</span><br><span class="line">	&#96;mid_id&#96; string,</span><br><span class="line">	&#96;user_id&#96; string,</span><br><span class="line">	&#96;version_code&#96; string,</span><br><span class="line">	&#96;version_name&#96; string,</span><br><span class="line">	&#96;lang&#96; string,</span><br><span class="line">	&#96;source&#96; string,</span><br><span class="line">	&#96;os&#96; string,</span><br><span class="line">	&#96;area&#96; string,</span><br><span class="line">	&#96;model&#96; string,</span><br><span class="line">	&#96;brand&#96; string,</span><br><span class="line">	&#96;sdk_version&#96; string,</span><br><span class="line">	&#96;gmail&#96; string,</span><br><span class="line">	&#96;height_width&#96; string,</span><br><span class="line">	&#96;app_time&#96; string,</span><br><span class="line">	&#96;network&#96; string,</span><br><span class="line">	&#96;lng&#96; string,</span><br><span class="line">	&#96;lat&#96; string,</span><br><span class="line">	&#96;errorBrief&#96; string,</span><br><span class="line">	&#96;errorDetail&#96; string,</span><br><span class="line">	&#96;server_time&#96; string</span><br><span class="line">  ) COMMENT &#39;é”™è¯¯æ—¥å¿—è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;error_log&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">APP3&#x3D;ods</span><br><span class="line">table_name&#x3D;error_log</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line">hive_origin_table_name&#x3D;$APP3.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	mid_id,</span><br><span class="line">	user_id,</span><br><span class="line">	version_code,</span><br><span class="line">	version_name,</span><br><span class="line">	lang,</span><br><span class="line">	source,</span><br><span class="line">	os,</span><br><span class="line">	area,</span><br><span class="line">	model,</span><br><span class="line">	brand,</span><br><span class="line">	sdk_version,</span><br><span class="line">	gmail,</span><br><span class="line">	height_width,</span><br><span class="line">	app_time,</span><br><span class="line">	network,</span><br><span class="line">	lng,</span><br><span class="line">	lat,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.errorBrief&#39;) errorBrief,</span><br><span class="line">	get_json_object(event_json,&#39;$.kv.errorDetail&#39;) errorDetail,</span><br><span class="line">	server_time</span><br><span class="line">from dwd.mall__event_log</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39; and event_name&#x3D;&#39;error&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle36"></a></p><h3 id="9-2-dwdå±‚æ„å»º-ä¸šåŠ¡åº“"><a href="#9-2-dwdå±‚æ„å»º-ä¸šåŠ¡åº“" class="headerlink" title="9.2 dwdå±‚æ„å»º(ä¸šåŠ¡åº“)"></a>9.2 dwdå±‚æ„å»º(ä¸šåŠ¡åº“)</h3><blockquote><p>æ­¤å±‚åœ¨æ„å»ºä¹‹åˆï¼Œå¢é‡è¡¨éœ€è¦åŠ¨æ€åˆ†åŒºæ¥åˆ’åˆ†æ—¶é—´ï¼Œå°†æ•°æ®æ”¾å…¥æŒ‡å®šåˆ†åŒº</p></blockquote></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445674-85cdb9f6-3bc5-45af-a42c-260b856251c4.png#align=left&display=inline&height=727&margin=%5Bobject%20Object%5D&originHeight=727&originWidth=1200&size=0&status=done&style=none&width=1200" alt></p><table><thead><tr><th>äº‹å®/ç»´åº¦</th><th>æ—¶é—´</th><th>ç”¨æˆ·</th><th>åœ°åŒº</th><th>å•†å“</th><th>ä¼˜æƒ å·</th><th>æ´»åŠ¨</th><th>ç¼–ç </th><th>åº¦é‡</th></tr></thead><tbody><tr><td>è®¢å•</td><td>âˆš</td><td>âˆš</td><td>âˆš</td><td></td><td></td><td>âˆš</td><td></td><td>ä»¶æ•°/é‡‘é¢</td></tr><tr><td>è®¢å•è¯¦æƒ…</td><td>âˆš</td><td></td><td>âˆš</td><td>âˆš</td><td></td><td></td><td></td><td>ä»¶æ•°/é‡‘é¢</td></tr><tr><td>æ”¯ä»˜</td><td>âˆš</td><td></td><td>âˆš</td><td></td><td></td><td></td><td></td><td>æ¬¡æ•°/é‡‘é¢</td></tr><tr><td>åŠ å…¥è´­ç‰©è½¦</td><td>âˆš</td><td>âˆš</td><td></td><td>âˆš</td><td></td><td></td><td></td><td>ä»¶æ•°/é‡‘é¢</td></tr><tr><td>æ”¶è—</td><td>âˆš</td><td>âˆš</td><td></td><td>âˆš</td><td></td><td></td><td></td><td>ä¸ªæ•°</td></tr><tr><td>è¯„ä»·</td><td>âˆš</td><td>âˆš</td><td></td><td>âˆš</td><td></td><td></td><td></td><td>ä¸ªæ•°</td></tr><tr><td>é€€æ¬¾</td><td>âˆš</td><td>âˆš</td><td></td><td>âˆš</td><td></td><td></td><td></td><td>ä»¶æ•°/é‡‘é¢</td></tr><tr><td>ä¼˜æƒ å·é¢†ç”¨</td><td>âˆš</td><td>âˆš</td><td></td><td></td><td>âˆš</td><td></td><td></td><td>ä¸ªæ•°</td></tr></tbody></table><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445446714-5b66a38b-d703-4552-a3b2-78e2bb1093b0.png#align=left&display=inline&height=633&margin=%5Bobject%20Object%5D&originHeight=633&originWidth=1129&size=0&status=done&style=none&width=1129" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445779-c15f3dba-9e4f-4a43-aa6a-da30699cb8ae.png#align=left&display=inline&height=554&margin=%5Bobject%20Object%5D&originHeight=554&originWidth=1243&size=0&status=done&style=none&width=1243" alt><br><a name="04dcb13e"></a></p><h4 id="9-2-1-å•†å“ç»´åº¦è¡¨-å…¨é‡"><a href="#9-2-1-å•†å“ç»´åº¦è¡¨-å…¨é‡" class="headerlink" title="9.2.1 å•†å“ç»´åº¦è¡¨(å…¨é‡)"></a>9.2.1 å•†å“ç»´åº¦è¡¨(å…¨é‡)</h4><ul><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__dim_sku_info</span><br><span class="line">    </span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__dim_sku_info&#96;(</span><br><span class="line">&#96;id&#96; string COMMENT &#39;å•†å“ id&#39;,</span><br><span class="line">&#96;spu_id&#96; string COMMENT &#39;spuid&#39;,</span><br><span class="line">&#96;price&#96; double COMMENT &#39;å•†å“ä»·æ ¼&#39;,</span><br><span class="line">&#96;sku_name&#96; string COMMENT &#39;å•†å“åç§°&#39;,</span><br><span class="line">&#96;sku_desc&#96; string COMMENT &#39;å•†å“æè¿°&#39;,</span><br><span class="line">&#96;weight&#96; double COMMENT &#39;é‡é‡&#39;,</span><br><span class="line">&#96;tm_id&#96; string COMMENT &#39;å“ç‰Œ id&#39;,</span><br><span class="line">&#96;tm_name&#96; string COMMENT &#39;å“ç‰Œåç§°&#39;,</span><br><span class="line">&#96;category3_id&#96; string COMMENT &#39;ä¸‰çº§åˆ†ç±» id&#39;,</span><br><span class="line">&#96;category2_id&#96; string COMMENT &#39;äºŒçº§åˆ†ç±» id&#39;,</span><br><span class="line">&#96;category1_id&#96; string COMMENT &#39;ä¸€çº§åˆ†ç±» id&#39;,</span><br><span class="line">&#96;category3_name&#96; string COMMENT &#39;ä¸‰çº§åˆ†ç±»åç§°&#39;,</span><br><span class="line">&#96;category2_name&#96; string COMMENT &#39;äºŒçº§åˆ†ç±»åç§°&#39;,</span><br><span class="line">&#96;category1_name&#96; string COMMENT &#39;ä¸€çº§åˆ†ç±»åç§°&#39;,</span><br><span class="line">&#96;spu_name&#96; string COMMENT &#39;spu åç§°&#39;,</span><br><span class="line">&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;å•†å“ç»´åº¦è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;dim_sku_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">table_name&#x3D;dim_sku_info</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	sku.id,</span><br><span class="line">	sku.spu_id,</span><br><span class="line">	sku.price,</span><br><span class="line">	sku.sku_name,</span><br><span class="line">	sku.sku_desc,</span><br><span class="line">	sku.weight,</span><br><span class="line">	sku.tm_id,</span><br><span class="line">	ob.tm_name,</span><br><span class="line">	sku.category3_id,</span><br><span class="line">	c2.id category2_id,</span><br><span class="line">	c1.id category1_id,</span><br><span class="line">	c3.name category3_name,</span><br><span class="line">	c2.name category2_name,</span><br><span class="line">	c1.name category1_name,</span><br><span class="line">	spu.spu_name,</span><br><span class="line">	from_unixtime(cast(sku.create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">select * from ods.mall__sku_info where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)sku</span><br><span class="line">join</span><br><span class="line">(</span><br><span class="line">select * from ods.mall__base_trademark where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)ob on sku.tm_id&#x3D;ob.tm_id</span><br><span class="line">join</span><br><span class="line">(</span><br><span class="line">select * from ods.mall__spu_info where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)spu on spu.id &#x3D; sku.spu_id</span><br><span class="line">join</span><br><span class="line">(</span><br><span class="line">select * from ods.mall__base_category3 where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)c3 on sku.category3_id&#x3D;c3.id</span><br><span class="line">join</span><br><span class="line">(</span><br><span class="line">select * from ods.mall__base_category2 where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)c2 on c3.category2_id&#x3D;c2.id</span><br><span class="line">join</span><br><span class="line">(</span><br><span class="line">select * from ods.mall__base_category1 where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)c1 on c2.category1_id&#x3D;c1.id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="f6fa4154"></a></p><h4 id="9-2-2-ä¼˜æƒ åˆ¸ä¿¡æ¯ç»´åº¦è¡¨-å…¨é‡"><a href="#9-2-2-ä¼˜æƒ åˆ¸ä¿¡æ¯ç»´åº¦è¡¨-å…¨é‡" class="headerlink" title="9.2.2 ä¼˜æƒ åˆ¸ä¿¡æ¯ç»´åº¦è¡¨(å…¨é‡)"></a>9.2.2 ä¼˜æƒ åˆ¸ä¿¡æ¯ç»´åº¦è¡¨(å…¨é‡)</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__dim_coupon_info</span><br><span class="line">    </span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__dim_coupon_info&#96;(</span><br><span class="line">&#96;id&#96; string COMMENT &#39;è´­ç‰©åˆ¸ç¼–å·&#39;,</span><br><span class="line">&#96;coupon_name&#96; string COMMENT &#39;è´­ç‰©åˆ¸åç§°&#39;,</span><br><span class="line">&#96;coupon_type&#96; string COMMENT &#39;è´­ç‰©åˆ¸ç±»å‹ 1 ç°é‡‘åˆ¸ 2 æŠ˜æ‰£åˆ¸ 3 æ»¡å‡åˆ¸ 4 æ»¡ä»¶æ‰“æŠ˜åˆ¸&#39;,</span><br><span class="line">&#96;condition_amount&#96; string COMMENT &#39;æ»¡é¢æ•°&#39;,</span><br><span class="line">&#96;condition_num&#96; string COMMENT &#39;æ»¡ä»¶æ•°&#39;,</span><br><span class="line">&#96;activity_id&#96; string COMMENT &#39;æ´»åŠ¨ç¼–å·&#39;,</span><br><span class="line">&#96;benefit_amount&#96; string COMMENT &#39;å‡é‡‘é¢&#39;,</span><br><span class="line">&#96;benefit_discount&#96; string COMMENT &#39;æŠ˜æ‰£&#39;,</span><br><span class="line">&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">&#96;range_type&#96; string COMMENT &#39;èŒƒå›´ç±»å‹ 1ã€å•†å“ 2ã€å“ç±» 3ã€å“ç‰Œ&#39;,</span><br><span class="line">&#96;spu_id&#96; string COMMENT &#39;å•†å“ id&#39;,</span><br><span class="line">&#96;tm_id&#96; string COMMENT &#39;å“ç‰Œ id&#39;,</span><br><span class="line">&#96;category3_id&#96; string COMMENT &#39;å“ç±» id&#39;,</span><br><span class="line">&#96;limit_num&#96; string COMMENT &#39;æœ€å¤šé¢†ç”¨æ¬¡æ•°&#39;,</span><br><span class="line">&#96;operate_time&#96; string COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;,</span><br><span class="line">&#96;expire_time&#96; string COMMENT &#39;è¿‡æœŸæ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;ä¼˜æƒ åˆ¸ä¿¡æ¯ç»´åº¦è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;dim_coupon_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">table_name&#x3D;dim_coupon_info</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	id,</span><br><span class="line">	coupon_name,</span><br><span class="line">	coupon_type,</span><br><span class="line">	condition_amount,</span><br><span class="line">	condition_num,</span><br><span class="line">	activity_id,</span><br><span class="line">	benefit_amount,</span><br><span class="line">	benefit_discount,</span><br><span class="line">	from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time,</span><br><span class="line">	range_type,</span><br><span class="line">	spu_id,</span><br><span class="line">	tm_id,</span><br><span class="line">	category3_id,</span><br><span class="line">	limit_num,</span><br><span class="line">	from_unixtime(cast(operate_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) operate_time,</span><br><span class="line">	from_unixtime(cast(expire_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) expire_time</span><br><span class="line">from ods.mall__coupon_info</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="e5a0afd7"></a></p><h4 id="9-2-3-æ´»åŠ¨ç»´åº¦è¡¨-å…¨é‡"><a href="#9-2-3-æ´»åŠ¨ç»´åº¦è¡¨-å…¨é‡" class="headerlink" title="9.2.3 æ´»åŠ¨ç»´åº¦è¡¨(å…¨é‡)"></a>9.2.3 æ´»åŠ¨ç»´åº¦è¡¨(å…¨é‡)</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__dim_activity_info</span><br><span class="line">    </span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__dim_activity_info&#96;(</span><br><span class="line">&#96;id&#96; string COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">&#96;activity_name&#96; string COMMENT &#39;æ´»åŠ¨åç§°&#39;,</span><br><span class="line">&#96;activity_type&#96; string COMMENT &#39;æ´»åŠ¨ç±»å‹&#39;,</span><br><span class="line">&#96;condition_amount&#96; string COMMENT &#39;æ»¡å‡é‡‘é¢&#39;,</span><br><span class="line">&#96;condition_num&#96; string COMMENT &#39;æ»¡å‡ä»¶æ•°&#39;,</span><br><span class="line">&#96;benefit_amount&#96; string COMMENT &#39;ä¼˜æƒ é‡‘é¢&#39;,</span><br><span class="line">&#96;benefit_discount&#96; string COMMENT &#39;ä¼˜æƒ æŠ˜æ‰£&#39;,</span><br><span class="line">&#96;benefit_level&#96; string COMMENT &#39;ä¼˜æƒ çº§åˆ«&#39;,</span><br><span class="line">&#96;start_time&#96; string COMMENT &#39;å¼€å§‹æ—¶é—´&#39;,</span><br><span class="line">&#96;end_time&#96; string COMMENT &#39;ç»“æŸæ—¶é—´&#39;,</span><br><span class="line">&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;æ´»åŠ¨ç»´åº¦è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;dim_activity_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">table_name&#x3D;dim_activity_info</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	info.id,</span><br><span class="line">	info.activity_name,</span><br><span class="line">	info.activity_type,</span><br><span class="line">	rule.condition_amount,</span><br><span class="line">	rule.condition_num,</span><br><span class="line">	rule.benefit_amount,</span><br><span class="line">	rule.benefit_discount,</span><br><span class="line">	rule.benefit_level,</span><br><span class="line">	from_unixtime(cast(info.start_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) start_time,</span><br><span class="line">	from_unixtime(cast(info.end_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) end_time,</span><br><span class="line">	from_unixtime(cast(info.create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">select * from ods.mall__activity_info where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)info</span><br><span class="line">left join</span><br><span class="line">(</span><br><span class="line">select * from ods.mall__activity_rule where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)rule on info.id &#x3D; rule.activity_id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="40a2f40c"></a></p><h4 id="9-2-4-åœ°åŒºç»´åº¦è¡¨-ç‰¹æ®Š"><a href="#9-2-4-åœ°åŒºç»´åº¦è¡¨-ç‰¹æ®Š" class="headerlink" title="9.2.4 åœ°åŒºç»´åº¦è¡¨(ç‰¹æ®Š)"></a>9.2.4 åœ°åŒºç»´åº¦è¡¨(ç‰¹æ®Š)</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__dim_base_province</span><br><span class="line">    </span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__dim_base_province&#96;(</span><br><span class="line">&#96;id&#96; string COMMENT &#39;id&#39;,</span><br><span class="line">&#96;province_name&#96; string COMMENT &#39;çœå¸‚åç§°&#39;,</span><br><span class="line">&#96;area_code&#96; string COMMENT &#39;åœ°åŒºç¼–ç &#39;,</span><br><span class="line">&#96;iso_code&#96; string COMMENT &#39;ISO ç¼–ç &#39;,</span><br><span class="line">&#96;region_id&#96; string COMMENT &#39;åœ°åŒº id&#39;,</span><br><span class="line">&#96;region_name&#96; string COMMENT &#39;åœ°åŒºåç§°&#39;</span><br><span class="line">  ) COMMENT &#39;åœ°åŒºç»´åº¦è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;dim_base_province&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">table_name&#x3D;dim_base_province</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	bp.id,</span><br><span class="line">	bp.name,</span><br><span class="line">	bp.area_code,</span><br><span class="line">	bp.iso_code,</span><br><span class="line">	bp.region_id,</span><br><span class="line">	br.region_name</span><br><span class="line">from ods.mall__base_province bp</span><br><span class="line">join ods.mall__base_region br</span><br><span class="line">on bp.region_id&#x3D;br.id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="6dc38b01"></a></p><h4 id="9-2-5-æ—¶é—´ç»´åº¦è¡¨-ç‰¹æ®Š"><a href="#9-2-5-æ—¶é—´ç»´åº¦è¡¨-ç‰¹æ®Š" class="headerlink" title="9.2.5 æ—¶é—´ç»´åº¦è¡¨(ç‰¹æ®Š)"></a>9.2.5 æ—¶é—´ç»´åº¦è¡¨(ç‰¹æ®Š)</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__dim_date_info</span><br><span class="line">    </span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__dim_date_info&#96;(</span><br><span class="line">&#96;date_id&#96; string COMMENT &#39;æ—¥&#39;,</span><br><span class="line">&#96;week_id&#96; int COMMENT &#39;å‘¨&#39;,</span><br><span class="line">&#96;week_day&#96; int COMMENT &#39;å‘¨çš„ç¬¬å‡ å¤©&#39;,</span><br><span class="line">&#96;day&#96; int COMMENT &#39;æ¯æœˆçš„ç¬¬å‡ å¤©&#39;,</span><br><span class="line">&#96;month&#96; int COMMENT &#39;ç¬¬å‡ æœˆ&#39;,</span><br><span class="line">&#96;quarter&#96; int COMMENT &#39;ç¬¬å‡ å­£åº¦&#39;,</span><br><span class="line">&#96;year&#96; int COMMENT &#39;å¹´&#39;,</span><br><span class="line">&#96;is_workday&#96; int COMMENT &#39;æ˜¯å¦æ˜¯å‘¨æœ«&#39;,</span><br><span class="line">&#96;holiday_id&#96; int COMMENT &#39;æ˜¯å¦æ˜¯èŠ‚å‡æ—¥&#39;</span><br><span class="line">  ) COMMENT &#39;æ—¶é—´ç»´åº¦è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;dim_date_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">table_name&#x3D;dim_date_info</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	date_id,</span><br><span class="line">	week_id,</span><br><span class="line">	week_day,</span><br><span class="line">	day,</span><br><span class="line">	month,</span><br><span class="line">	quarter,</span><br><span class="line">	year,</span><br><span class="line">	is_workday,</span><br><span class="line">	holiday_id</span><br><span class="line">from ods.mall__date_info</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="2d4b2961"></a></p><h4 id="9-2-6-ç”¨æˆ·ç»´åº¦è¡¨-æ–°å¢åŠå˜åŒ–-ç¼“æ…¢å˜åŒ–ç»´-æ‹‰é“¾è¡¨"><a href="#9-2-6-ç”¨æˆ·ç»´åº¦è¡¨-æ–°å¢åŠå˜åŒ–-ç¼“æ…¢å˜åŒ–ç»´-æ‹‰é“¾è¡¨" class="headerlink" title="9.2.6 ç”¨æˆ·ç»´åº¦è¡¨(æ–°å¢åŠå˜åŒ–-ç¼“æ…¢å˜åŒ–ç»´-æ‹‰é“¾è¡¨)"></a>9.2.6 ç”¨æˆ·ç»´åº¦è¡¨(æ–°å¢åŠå˜åŒ–-ç¼“æ…¢å˜åŒ–ç»´-æ‹‰é“¾è¡¨)</h4><p><a name="467596bc"></a></p><h5 id="9-2-6-1-æ‹‰é“¾è¡¨ä»‹ç»"><a href="#9-2-6-1-æ‹‰é“¾è¡¨ä»‹ç»" class="headerlink" title="9.2.6.1 æ‹‰é“¾è¡¨ä»‹ç»"></a>9.2.6.1 æ‹‰é“¾è¡¨ä»‹ç»</h5><blockquote><p>æ‹‰é“¾è¡¨ï¼Œè®°å½•æ¯æ¡ä¿¡æ¯çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸€æ—¦ä¸€æ¡è®°å½•çš„ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œå°±é‡æ–°å¼€å§‹ä¸€æ¡æ–°çš„è®°å½•ï¼Œå¹¶æŠŠå½“å‰æ—¥æœŸæ”¾å…¥ç”Ÿæ•ˆå¼€å§‹æ—¥æœŸã€‚<br>å¦‚æœå½“å‰ä¿¡æ¯è‡³ä»Šæœ‰æ•ˆï¼Œåœ¨ç”Ÿæ•ˆç»“æŸæ—¥æœŸä¸­å¡«å…¥ä¸€ä¸ªæå¤§å€¼ï¼ˆå¦‚:9999-99-99ï¼‰,ä¸‹è¡¨ä¸ºå¼ ä¸‰çš„æ‰‹æœºå·å˜åŒ–ä¾‹å­</p></blockquote></li></ul><table><thead><tr><th>ç”¨æˆ·ID</th><th>å§“å</th><th>æ‰‹æœºå·</th><th>å¼€å§‹æ—¥æœŸ</th><th>ç»“æŸæ—¥æœŸ</th></tr></thead><tbody><tr><td>1</td><td>å¼ ä¸‰</td><td>134XXXX5050</td><td>2019-01-01</td><td>2019-01-02</td></tr><tr><td>1</td><td>å¼ ä¸‰</td><td>139XXXX3232</td><td>2019-01-03</td><td>2020-01-01</td></tr><tr><td>1</td><td>å¼ ä¸‰</td><td>137XXXX7676</td><td>2020-01-02</td><td>9999-99-99</td></tr></tbody></table><ul><li><p>é€‚åˆåœºæ™¯ï¼šæ•°æ®ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†ä¸å˜ï¼ˆå³ï¼šç¼“æ…¢å˜åŒ–ç»´ï¼‰</p><blockquote><p>æ¯”å¦‚ï¼šç”¨æˆ·ä¿¡æ¯å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯æ¯å¤©å˜åŒ–æ¯”ä¾‹ä¸é«˜ï¼ŒæŒ‰ç…§æ¯æ—¥å…¨é‡ï¼Œåˆ™æ•ˆç‡ä½</p></blockquote></li><li><p>å¦‚ä½•ä½¿ç”¨æ‹‰é“¾è¡¨ï¼šé€šè¿‡â€“&gt;ç”Ÿæ•ˆå¼€å§‹æ—¥æœŸ&lt;=æŸä¸ªæ—¥æœŸ ä¸” ç”Ÿæ•ˆç»“æŸæ—¥æœŸ&gt;=æŸä¸ªæ—¥æœŸï¼Œèƒ½å¤Ÿå¾—åˆ°æŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®å…¨é‡åˆ‡ç‰‡ã€‚</p></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445711-5342c8ec-2d69-476f-bb7d-80084793cdc7.png#align=left&display=inline&height=699&margin=%5Bobject%20Object%5D&originHeight=699&originWidth=1309&size=0&status=done&style=none&width=1309" alt></p><ul><li>æ‹‰é“¾è¡¨å½¢æˆè¿‡ç¨‹</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445446108-d1824bc2-adf7-4c28-bc32-71e8ba274913.png#align=left&display=inline&height=806&margin=%5Bobject%20Object%5D&originHeight=806&originWidth=1435&size=0&status=done&style=none&width=1435" alt></p><ul><li>åˆ¶ä½œæµç¨‹<blockquote><p>ç”¨æˆ·å½“æ—¥å…¨éƒ¨æ•°æ®å’ŒMySQLä¸­æ¯å¤©å˜åŒ–çš„æ•°æ®æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ª&lt;æ–°çš„ä¸´æ—¶æ‹‰é“¾è¡¨ã€‚<br>ç”¨ä¸´æ—¶æ‹‰é“¾è¡¨è¦†ç›–æ—§çš„æ‹‰é“¾è¡¨æ•°æ®ã€‚<br>ä»è€Œè§£å†³Hiveä¸­æ•°æ®ä¸èƒ½æ›´æ–°çš„é—®é¢˜</p></blockquote></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445740-8f05faaa-a871-4d74-9b27-f4fa1da7e452.png#align=left&display=inline&height=771&margin=%5Bobject%20Object%5D&originHeight=771&originWidth=1437&size=0&status=done&style=none&width=1437" alt><br><a name="ded0213a"></a></p><h5 id="9-2-6-2-ç”¨æˆ·ç»´åº¦è¡¨"><a href="#9-2-6-2-ç”¨æˆ·ç»´åº¦è¡¨" class="headerlink" title="9.2.6.2 ç”¨æˆ·ç»´åº¦è¡¨"></a>9.2.6.2 ç”¨æˆ·ç»´åº¦è¡¨</h5><blockquote><p>ç”¨æˆ·è¡¨ä¸­çš„æ•°æ®æ¯æ—¥æ—¢æœ‰å¯èƒ½æ–°å¢ï¼Œä¹Ÿæœ‰å¯èƒ½ä¿®æ”¹ï¼Œå±äºç¼“æ…¢å˜åŒ–ç»´åº¦ï¼Œæ­¤å¤„é‡‡ç”¨æ‹‰é“¾è¡¨å­˜å‚¨ç”¨æˆ·ç»´åº¦æ•°æ®ã€‚</p></blockquote><ul><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__dim_user_info_his</span><br><span class="line">    </span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__dim_user_info_his&#96;(</span><br><span class="line">&#96;id&#96; string COMMENT &#39;ç”¨æˆ· id&#39;,</span><br><span class="line">&#96;name&#96; string COMMENT &#39;å§“å&#39;,</span><br><span class="line">&#96;birthday&#96; string COMMENT &#39;ç”Ÿæ—¥&#39;,</span><br><span class="line">&#96;gender&#96; string COMMENT &#39;æ€§åˆ«&#39;,</span><br><span class="line">&#96;email&#96; string COMMENT &#39;é‚®ç®±&#39;,</span><br><span class="line">&#96;user_level&#96; string COMMENT &#39;ç”¨æˆ·ç­‰çº§&#39;,</span><br><span class="line">&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">&#96;operate_time&#96; string COMMENT &#39;æ“ä½œæ—¶é—´&#39;,</span><br><span class="line">&#96;start_date&#96; string COMMENT &#39;æœ‰æ•ˆå¼€å§‹æ—¥æœŸ&#39;,</span><br><span class="line">&#96;end_date&#96; string COMMENT &#39;æœ‰æ•ˆç»“æŸæ—¥æœŸ&#39;</span><br><span class="line">  ) COMMENT &#39;ç”¨æˆ·æ‹‰é“¾è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;dim_user_info_his&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>ä¸´æ—¶è¡¨å»ºè¡¨(ç»“æ„ä¸ä¸»è¡¨ç›¸åŒ)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__dim_user_info_his_tmp</span><br><span class="line">    </span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__dim_user_info_his_tmp&#96;(</span><br><span class="line">&#96;id&#96; string COMMENT &#39;ç”¨æˆ· id&#39;,</span><br><span class="line">&#96;name&#96; string COMMENT &#39;å§“å&#39;,</span><br><span class="line">&#96;birthday&#96; string COMMENT &#39;ç”Ÿæ—¥&#39;,</span><br><span class="line">&#96;gender&#96; string COMMENT &#39;æ€§åˆ«&#39;,</span><br><span class="line">&#96;email&#96; string COMMENT &#39;é‚®ç®±&#39;,</span><br><span class="line">&#96;user_level&#96; string COMMENT &#39;ç”¨æˆ·ç­‰çº§&#39;,</span><br><span class="line">&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">&#96;operate_time&#96; string COMMENT &#39;æ“ä½œæ—¶é—´&#39;,</span><br><span class="line">&#96;start_date&#96; string COMMENT &#39;æœ‰æ•ˆå¼€å§‹æ—¥æœŸ&#39;,</span><br><span class="line">&#96;end_date&#96; string COMMENT &#39;æœ‰æ•ˆç»“æŸæ—¥æœŸ&#39;</span><br><span class="line">  ) COMMENT &#39;ç”¨æˆ·æ‹‰é“¾è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;dim_user_info_his_tmp&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>é¦–å…ˆï¼ˆä¸»è¡¨ï¼‰æ•°æ®åˆå§‹åŒ–ï¼Œåªåšä¸€æ¬¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">table_name&#x3D;dim_user_info_his</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	id,</span><br><span class="line">	name,</span><br><span class="line">	from_unixtime(cast(birthday&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) birthday,</span><br><span class="line">	gender,</span><br><span class="line">	email,</span><br><span class="line">	user_level,</span><br><span class="line">	from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time,</span><br><span class="line">	from_unixtime(cast(operate_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) operate_time,</span><br><span class="line">	&#39;$db_date&#39;,</span><br><span class="line">	&#39;9999-99-99&#39;</span><br><span class="line">from ods.mall__user_info oi</span><br><span class="line">where oi.dt&#x3D;&#39;$db_date&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure></li><li><p>ä¸´æ—¶è¡¨æ•°æ®è®¡ç®—å¯¼å…¥(åœ¨ä¸»è¡¨æ•°æ®ä¹‹åæ‰§è¡Œ)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">table_name&#x3D;dim_user_info_his_tmp</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">select</span><br><span class="line">* </span><br><span class="line">from</span><br><span class="line">(      --æŸ¥è¯¢å½“å‰æ—¶é—´çš„æ‰€æœ‰ä¿¡æ¯</span><br><span class="line">	select</span><br><span class="line">		cast(id as string) id,</span><br><span class="line">		name,</span><br><span class="line">		from_unixtime(cast(birthday&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) birthday,</span><br><span class="line">		gender,</span><br><span class="line">		email,</span><br><span class="line">		user_level,</span><br><span class="line">		from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time,</span><br><span class="line">		from_unixtime(cast(operate_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) operate_time,</span><br><span class="line">		&#39;$db_date&#39; start_date,</span><br><span class="line">		&#39;9999-99-99&#39; end_date</span><br><span class="line">	from ods.mall__user_info where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	union all</span><br><span class="line">	 --æŸ¥è¯¢å½“å‰å˜åŒ–äº†çš„æ•°æ®ï¼Œä¿®æ”¹æ—¥æœŸ</span><br><span class="line">	select</span><br><span class="line">		uh.id,</span><br><span class="line">		uh.name,</span><br><span class="line">		from_unixtime(cast(uh.birthday&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) birthday,</span><br><span class="line">		uh.gender,</span><br><span class="line">		uh.email,</span><br><span class="line">		uh.user_level,</span><br><span class="line">		from_unixtime(cast(uh.create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time,</span><br><span class="line">		from_unixtime(cast(uh.operate_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) operate_time,</span><br><span class="line">		uh.start_date,</span><br><span class="line">		if(ui.id is not null and uh.end_date&#x3D;&#39;9999-99-99&#39;, date_add(ui.dt,-1),uh.end_date) end_date</span><br><span class="line">	from dwd.mall__dim_user_info_his uh left join</span><br><span class="line">	(</span><br><span class="line">        --æŸ¥è¯¢å½“å‰æ—¶é—´çš„æ‰€æœ‰ä¿¡æ¯</span><br><span class="line">	select</span><br><span class="line">		cast(id as string) id,</span><br><span class="line">		name,</span><br><span class="line">		from_unixtime(cast(birthday&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) birthday,</span><br><span class="line">		gender,</span><br><span class="line">		email,</span><br><span class="line">		user_level,</span><br><span class="line">		from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time,</span><br><span class="line">		from_unixtime(cast(operate_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) operate_time,</span><br><span class="line">		dt</span><br><span class="line">	from ods.mall__user_info</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	) ui on uh.id&#x3D;ui.id</span><br><span class="line">)his</span><br><span class="line">order by his.id, start_date;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">table_name&#x3D;dim_user_info_his</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">select * from dwd.mall__dim_user_info_his_tmp;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="7bac56d4"></a></p><h4 id="9-2-7-è®¢å•è¯¦æƒ…äº‹å®è¡¨-äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢"><a href="#9-2-7-è®¢å•è¯¦æƒ…äº‹å®è¡¨-äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢" class="headerlink" title="9.2.7 è®¢å•è¯¦æƒ…äº‹å®è¡¨(äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢)"></a>9.2.7 è®¢å•è¯¦æƒ…äº‹å®è¡¨(äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢)</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__fact_order_detail</span><br><span class="line">    </span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__fact_order_detail&#96;(</span><br><span class="line">  &#96;id&#96; bigint COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;order_id&#96; bigint COMMENT &#39;è®¢å•ç¼–å·&#39;,</span><br><span class="line">  &#96;user_id&#96; bigint COMMENT &#39;ç”¨æˆ·id&#39;,</span><br><span class="line">  &#96;sku_id&#96; bigint COMMENT &#39;sku_id&#39;,</span><br><span class="line">  &#96;sku_name&#96; string COMMENT &#39;skuåç§°&#39;,</span><br><span class="line">  &#96;order_price&#96; decimal(10,2) COMMENT &#39;è´­ä¹°ä»·æ ¼(ä¸‹å•æ—¶skuä»·æ ¼ï¼‰&#39;,</span><br><span class="line">  &#96;sku_num&#96; string COMMENT &#39;è´­ä¹°ä¸ªæ•°&#39;,</span><br><span class="line">  &#96;create_time&#96; bigint COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">  &#96;province_id&#96; string COMMENT &#39;çœä»½ID&#39;,</span><br><span class="line">  &#96;total_amount&#96; decimal(20,2) COMMENT &#39;è®¢å•æ€»é‡‘é¢&#39;</span><br><span class="line">  ) COMMENT &#39;è®¢å•æ˜ç»†è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;fact_order_detail&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">table_name&#x3D;fact_order_detail</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	od.id, </span><br><span class="line">	od.order_id, </span><br><span class="line">	od.user_id, </span><br><span class="line">	od.sku_id, </span><br><span class="line">	od.sku_name, </span><br><span class="line">	od.order_price, </span><br><span class="line">	od.sku_num, </span><br><span class="line">	od.create_time, </span><br><span class="line">	oi.province_id, </span><br><span class="line">	od.order_price*od.sku_num </span><br><span class="line">from (select * from ods.mall__order_detail where dt&#x3D;&#39;$db_date&#39; ) od </span><br><span class="line">join (select * from ods.mall__order_info where dt&#x3D;&#39;$db_date&#39; ) oi </span><br><span class="line">on od.order_id&#x3D;oi.id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="038064ea"></a></p><h4 id="9-2-7-æ”¯ä»˜äº‹å®è¡¨-äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢"><a href="#9-2-7-æ”¯ä»˜äº‹å®è¡¨-äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢" class="headerlink" title="9.2.7 æ”¯ä»˜äº‹å®è¡¨(äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢)"></a>9.2.7 æ”¯ä»˜äº‹å®è¡¨(äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢)</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__fact_payment_info</span><br><span class="line">    </span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__fact_payment_info&#96;(</span><br><span class="line">&#96;id&#96; string COMMENT &#39;&#39;,</span><br><span class="line">&#96;out_trade_no&#96; string COMMENT &#39;å¯¹å¤–ä¸šåŠ¡ç¼–å·&#39;,</span><br><span class="line">&#96;order_id&#96; string COMMENT &#39;è®¢å•ç¼–å·&#39;,</span><br><span class="line">&#96;user_id&#96; string COMMENT &#39;ç”¨æˆ·ç¼–å·&#39;,</span><br><span class="line">&#96;alipay_trade_no&#96; string COMMENT &#39;æ”¯ä»˜å®äº¤æ˜“æµæ°´ç¼–å·&#39;,</span><br><span class="line">&#96;payment_amount&#96; decimal(16,2) COMMENT &#39;æ”¯ä»˜é‡‘é¢&#39;,</span><br><span class="line">&#96;subject&#96; string COMMENT &#39;äº¤æ˜“å†…å®¹&#39;,</span><br><span class="line">&#96;payment_type&#96; string COMMENT &#39;æ”¯ä»˜ç±»å‹&#39;,</span><br><span class="line">&#96;payment_time&#96; string COMMENT &#39;æ”¯ä»˜æ—¶é—´&#39;,</span><br><span class="line">&#96;province_id&#96; string COMMENT &#39;çœä»½ ID&#39;</span><br><span class="line">  ) COMMENT &#39;æ”¯ä»˜äº‹å®è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;fact_payment_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">table_name&#x3D;fact_payment_info</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	pi.id,</span><br><span class="line">	pi.out_trade_no,</span><br><span class="line">	pi.order_id,</span><br><span class="line">	pi.user_id,</span><br><span class="line">	pi.alipay_trade_no,</span><br><span class="line">	pi.total_amount,</span><br><span class="line">	pi.subject,</span><br><span class="line">	pi.payment_type,</span><br><span class="line">	from_unixtime(cast(pi.payment_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) payment_time,</span><br><span class="line">	oi.province_id</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">select * from ods.mall__payment_info where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)pi</span><br><span class="line">join</span><br><span class="line">(</span><br><span class="line">select id, province_id from ods.mall__order_info where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)oi</span><br><span class="line">on pi.order_id &#x3D; oi.id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="ab3a3670"></a></p><h4 id="9-2-8-é€€æ¬¾äº‹å®è¡¨-äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢"><a href="#9-2-8-é€€æ¬¾äº‹å®è¡¨-äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢" class="headerlink" title="9.2.8 é€€æ¬¾äº‹å®è¡¨(äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢)"></a>9.2.8 é€€æ¬¾äº‹å®è¡¨(äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢)</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__fact_order_refund_info</span><br><span class="line">    </span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__fact_order_refund_info&#96;(</span><br><span class="line">&#96;id&#96; string COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">&#96;user_id&#96; string COMMENT &#39;ç”¨æˆ· ID&#39;,</span><br><span class="line">&#96;order_id&#96; string COMMENT &#39;è®¢å• ID&#39;,</span><br><span class="line">&#96;sku_id&#96; string COMMENT &#39;å•†å“ ID&#39;,</span><br><span class="line">&#96;refund_type&#96; string COMMENT &#39;é€€æ¬¾ç±»å‹&#39;,</span><br><span class="line">&#96;refund_num&#96; bigint COMMENT &#39;é€€æ¬¾ä»¶æ•°&#39;,</span><br><span class="line">&#96;refund_amount&#96; decimal(16,2) COMMENT &#39;é€€æ¬¾é‡‘é¢&#39;,</span><br><span class="line">&#96;refund_reason_type&#96; string COMMENT &#39;é€€æ¬¾åŸå› ç±»å‹&#39;,</span><br><span class="line">&#96;create_time&#96; string COMMENT &#39;é€€æ¬¾æ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;é€€æ¬¾äº‹å®è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;fact_order_refund_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">table_name&#x3D;fact_order_refund_info</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	id,</span><br><span class="line">	user_id,</span><br><span class="line">	order_id,</span><br><span class="line">	sku_id,</span><br><span class="line">	refund_type,</span><br><span class="line">	refund_num,</span><br><span class="line">	refund_amount,</span><br><span class="line">	refund_reason_type,</span><br><span class="line">	from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time</span><br><span class="line">from ods.mall__order_refund_info</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="6fc9b5b6"></a></p><h4 id="9-2-9-è¯„ä»·äº‹å®è¡¨-äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢"><a href="#9-2-9-è¯„ä»·äº‹å®è¡¨-äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢" class="headerlink" title="9.2.9 è¯„ä»·äº‹å®è¡¨(äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢)"></a>9.2.9 è¯„ä»·äº‹å®è¡¨(äº‹åŠ¡å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢)</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__fact_comment_info</span><br><span class="line">    </span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__fact_comment_info&#96;(</span><br><span class="line">&#96;id&#96; string COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">&#96;user_id&#96; string COMMENT &#39;ç”¨æˆ· ID&#39;,</span><br><span class="line">&#96;sku_id&#96; string COMMENT &#39;å•†å“ sku&#39;,</span><br><span class="line">&#96;spu_id&#96; string COMMENT &#39;å•†å“ spu&#39;,</span><br><span class="line">&#96;order_id&#96; string COMMENT &#39;è®¢å• ID&#39;,</span><br><span class="line">&#96;appraise&#96; string COMMENT &#39;è¯„ä»·&#39;,</span><br><span class="line">&#96;create_time&#96; string COMMENT &#39;è¯„ä»·æ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;è¯„ä»·äº‹å®è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;fact_comment_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">table_name&#x3D;fact_comment_info</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	id,</span><br><span class="line">	user_id,</span><br><span class="line">	sku_id,</span><br><span class="line">	spu_id,</span><br><span class="line">	order_id,</span><br><span class="line">	appraise,</span><br><span class="line">	from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time</span><br><span class="line">from ods.mall__comment_info</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="823e5d60"></a></p><h4 id="9-2-10-åŠ è´­äº‹å®è¡¨-å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨-å…¨é‡"><a href="#9-2-10-åŠ è´­äº‹å®è¡¨-å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨-å…¨é‡" class="headerlink" title="9.2.10 åŠ è´­äº‹å®è¡¨(å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨-å…¨é‡)"></a>9.2.10 åŠ è´­äº‹å®è¡¨(å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨-å…¨é‡)</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__fact_cart_info</span><br><span class="line">    </span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__fact_cart_info&#96;(</span><br><span class="line">&#96;id&#96; string COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">&#96;user_id&#96; string COMMENT &#39;ç”¨æˆ· id&#39;,</span><br><span class="line">&#96;sku_id&#96; string COMMENT &#39;skuid&#39;,</span><br><span class="line">&#96;cart_price&#96; string COMMENT &#39;æ”¾å…¥è´­ç‰©è½¦æ—¶ä»·æ ¼&#39;,</span><br><span class="line">&#96;sku_num&#96; string COMMENT &#39;æ•°é‡&#39;,</span><br><span class="line">&#96;sku_name&#96; string COMMENT &#39;sku åç§° (å†—ä½™)&#39;,</span><br><span class="line">&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">&#96;operate_time&#96; string COMMENT &#39;ä¿®æ”¹æ—¶é—´&#39;,</span><br><span class="line">&#96;is_ordered&#96; string COMMENT &#39;æ˜¯å¦å·²ç»ä¸‹å•ã€‚1 ä¸ºå·²ä¸‹å•;0 ä¸ºæœªä¸‹å•&#39;,</span><br><span class="line">&#96;order_time&#96; string COMMENT &#39;ä¸‹å•æ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;åŠ è´­äº‹å®è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;fact_cart_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">table_name&#x3D;fact_cart_info</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	id,</span><br><span class="line">	user_id,</span><br><span class="line">	sku_id,</span><br><span class="line">	cart_price,</span><br><span class="line">	sku_num,</span><br><span class="line">	sku_name,</span><br><span class="line">	from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time,</span><br><span class="line">	from_unixtime(cast(operate_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) operate_time,</span><br><span class="line">	is_ordered,</span><br><span class="line">	from_unixtime(cast(order_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) order_time</span><br><span class="line">from ods.mall__cart_info</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="2797a2b5"></a></p><h4 id="9-2-11-æ”¶è—äº‹å®è¡¨-å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨-å…¨é‡"><a href="#9-2-11-æ”¶è—äº‹å®è¡¨-å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨-å…¨é‡" class="headerlink" title="9.2.11 æ”¶è—äº‹å®è¡¨(å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨-å…¨é‡)"></a>9.2.11 æ”¶è—äº‹å®è¡¨(å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨-å…¨é‡)</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__fact_favor_info</span><br><span class="line">    </span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__fact_favor_info&#96;(</span><br><span class="line">&#96;id&#96; string COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">&#96;user_id&#96; string COMMENT &#39;ç”¨æˆ· id&#39;,</span><br><span class="line">&#96;sku_id&#96; string COMMENT &#39;skuid&#39;,</span><br><span class="line">&#96;spu_id&#96; string COMMENT &#39;spuid&#39;,</span><br><span class="line">&#96;is_cancel&#96; string COMMENT &#39;æ˜¯å¦å–æ¶ˆ&#39;,</span><br><span class="line">&#96;create_time&#96; string COMMENT &#39;æ”¶è—æ—¶é—´&#39;,</span><br><span class="line">&#96;cancel_time&#96; string COMMENT &#39;å–æ¶ˆæ—¶é—´&#39;</span><br><span class="line">  ) COMMENT &#39;æ”¶è—äº‹å®è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;fact_favor_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">table_name&#x3D;fact_favor_info</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	id,</span><br><span class="line">	user_id,</span><br><span class="line">	sku_id,</span><br><span class="line">	spu_id,</span><br><span class="line">	is_cancel,</span><br><span class="line">	from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) create_time,</span><br><span class="line">	from_unixtime(cast(cancel_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;) cancel_time</span><br><span class="line">from ods.mall__favor_info</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="6f2874af"></a></p><h4 id="9-2-12-ä¼˜æƒ åˆ¸é¢†ç”¨äº‹å®è¡¨-ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢åŠå˜åŒ–"><a href="#9-2-12-ä¼˜æƒ åˆ¸é¢†ç”¨äº‹å®è¡¨-ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢åŠå˜åŒ–" class="headerlink" title="9.2.12 ä¼˜æƒ åˆ¸é¢†ç”¨äº‹å®è¡¨(ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢åŠå˜åŒ–)"></a>9.2.12 ä¼˜æƒ åˆ¸é¢†ç”¨äº‹å®è¡¨(ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢åŠå˜åŒ–)</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__fact_coupon_use</span><br><span class="line">    </span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__fact_coupon_use&#96;(</span><br><span class="line">&#96;&#96; string COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">&#96;coupon_id&#96; string COMMENT &#39;ä¼˜æƒ åˆ¸ ID&#39;,</span><br><span class="line">&#96;user_id&#96; string COMMENT &#39;userid&#39;,</span><br><span class="line">&#96;order_id&#96; string COMMENT &#39;è®¢å• id&#39;,</span><br><span class="line">&#96;coupon_status&#96; string COMMENT &#39;ä¼˜æƒ åˆ¸çŠ¶æ€&#39;,</span><br><span class="line">&#96;get_time&#96; string COMMENT &#39;é¢†å–æ—¶é—´&#39;,</span><br><span class="line">&#96;using_time&#96; string COMMENT &#39;ä½¿ç”¨æ—¶é—´(ä¸‹å•)&#39;,</span><br><span class="line">&#96;used_time&#96; string COMMENT &#39;ä½¿ç”¨æ—¶é—´(æ”¯ä»˜)&#39;</span><br><span class="line">  ) COMMENT &#39;ä¼˜æƒ åˆ¸é¢†ç”¨äº‹å®è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;fact_coupon_use&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure><blockquote><p>dt æ˜¯æŒ‰ç…§ä¼˜æƒ å·é¢†ç”¨æ—¶é—´ get_time åšä¸ºåˆ†åŒºã€‚<br>get_time ä¸ºé¢†ç”¨æ—¶é—´ï¼Œé¢†ç”¨è¿‡åæ•°æ®å°±éœ€è¦å­˜åœ¨ï¼Œç„¶ååœ¨ä¸‹å•å’Œæ”¯ä»˜çš„æ—¶å€™å åŠ æ›´æ–°æ—¶é—´</p></blockquote></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445877-2b94e8bb-aec2-445a-bea1-1e80c6f64ace.png#align=left&display=inline&height=836&margin=%5Bobject%20Object%5D&originHeight=836&originWidth=1647&size=0&status=done&style=none&width=1647" alt></p><ul><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">table_name&#x3D;fact_coupon_use</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">set hive.exec.dynamic.partition.mode&#x3D;nonstrict;</span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	if(new.id is null,old.id,new.id) id,</span><br><span class="line">	if(new.coupon_id is null,old.coupon_id,new.coupon_id) coupon_id,</span><br><span class="line">	if(new.user_id is null,old.user_id,new.user_id) user_id,</span><br><span class="line">	if(new.order_id is null,old.order_id,new.order_id) order_id,</span><br><span class="line">	if(new.coupon_status is null,old.coupon_status,new.coupon_status) coupon_status,</span><br><span class="line">	from_unixtime(cast(if(new.get_time is null,old.get_time,new.get_time)&#x2F;1000 as bigint),&#39;yyyy-MM-dd&#39;) get_time,</span><br><span class="line">	from_unixtime(cast(if(new.using_time is null,old.using_time,new.using_time)&#x2F;1000 as bigint),&#39;yyyy-MM-dd&#39;) using_time,</span><br><span class="line">	from_unixtime(cast(if(new.used_time is null,old.used_time,new.used_time)&#x2F;1000 as bigint),&#39;yyyy-MM-dd&#39;),</span><br><span class="line">	from_unixtime(cast(if(new.get_time is null,old.get_time,new.get_time)&#x2F;1000 as bigint),&#39;yyyy-MM-dd&#39;) </span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		id,</span><br><span class="line">		coupon_id,</span><br><span class="line">		user_id,</span><br><span class="line">		order_id,</span><br><span class="line">		coupon_status,</span><br><span class="line">		get_time,</span><br><span class="line">		using_time,</span><br><span class="line">		used_time</span><br><span class="line">	from dwd.mall__fact_coupon_use</span><br><span class="line">	where dt in</span><br><span class="line">	(</span><br><span class="line">	select</span><br><span class="line">		from_unixtime(cast(get_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd&#39;)</span><br><span class="line">	from ods.mall__coupon_use</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	)</span><br><span class="line">)old</span><br><span class="line">full outer join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		id,</span><br><span class="line">		coupon_id,</span><br><span class="line">		user_id,</span><br><span class="line">		order_id,</span><br><span class="line">		coupon_status,</span><br><span class="line">		get_time,</span><br><span class="line">		using_time,</span><br><span class="line">		used_time</span><br><span class="line">	from ods.mall__coupon_use</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)new</span><br><span class="line">on old.id&#x3D;new.id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="3f232bd5"></a></p><h4 id="9-2-13-è®¢å•äº‹å®è¡¨-ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢åŠå˜åŒ–"><a href="#9-2-13-è®¢å•äº‹å®è¡¨-ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢åŠå˜åŒ–" class="headerlink" title="9.2.13 è®¢å•äº‹å®è¡¨(ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢åŠå˜åŒ–)"></a>9.2.13 è®¢å•äº‹å®è¡¨(ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨-æ–°å¢åŠå˜åŒ–)</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwd.mall__fact_order_info</span><br><span class="line">    </span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwd.mall__fact_order_info&#96;(</span><br><span class="line">&#96;id&#96; string COMMENT &#39;è®¢å•ç¼–å·&#39;,</span><br><span class="line">&#96;order_status&#96; string COMMENT &#39;è®¢å•çŠ¶æ€&#39;,</span><br><span class="line">&#96;user_id&#96; string COMMENT &#39;ç”¨æˆ· id&#39;,</span><br><span class="line">&#96;out_trade_no&#96; string COMMENT &#39;æ”¯ä»˜æµæ°´å·&#39;,</span><br><span class="line">&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´(æœªæ”¯ä»˜çŠ¶æ€)&#39;,</span><br><span class="line">&#96;payment_time&#96; string COMMENT &#39;æ”¯ä»˜æ—¶é—´(å·²æ”¯ä»˜çŠ¶æ€)&#39;,</span><br><span class="line">&#96;cancel_time&#96; string COMMENT &#39;å–æ¶ˆæ—¶é—´(å·²å–æ¶ˆçŠ¶æ€)&#39;,</span><br><span class="line">&#96;finish_time&#96; string COMMENT &#39;å®Œæˆæ—¶é—´(å·²å®ŒæˆçŠ¶æ€)&#39;,</span><br><span class="line">&#96;refund_time&#96; string COMMENT &#39;é€€æ¬¾æ—¶é—´(é€€æ¬¾ä¸­çŠ¶æ€)&#39;,</span><br><span class="line">&#96;refund_finish_time&#96; string COMMENT &#39;é€€æ¬¾å®Œæˆæ—¶é—´(é€€æ¬¾å®ŒæˆçŠ¶æ€)&#39;,</span><br><span class="line">&#96;province_id&#96; string COMMENT &#39;çœä»½ ID&#39;,</span><br><span class="line">&#96;activity_id&#96; string COMMENT &#39;æ´»åŠ¨ ID&#39;,</span><br><span class="line">&#96;original_total_amount&#96; string COMMENT &#39;åŸä»·é‡‘é¢&#39;,</span><br><span class="line">&#96;benefit_reduce_amount&#96; string COMMENT &#39;ä¼˜æƒ é‡‘é¢&#39;,</span><br><span class="line">&#96;feight_fee&#96; string COMMENT &#39;è¿è´¹&#39;,</span><br><span class="line">&#96;final_total_amount&#96; decimal(10,2) COMMENT &#39;è®¢å•é‡‘é¢&#39;</span><br><span class="line">  ) COMMENT &#39;è®¢å•äº‹å®è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwd&#x2F;mall&#x2F;fact_order_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445836-498738cf-a65f-4127-af18-9a1661eda52d.png#align=left&display=inline&height=522&margin=%5Bobject%20Object%5D&originHeight=522&originWidth=987&size=0&status=done&style=none&width=987" alt></p></li><li><p>æ•°æ®å¯¼å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwd</span><br><span class="line">table_name&#x3D;fact_order_info</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	if(new.id is null,old.id,new.id),</span><br><span class="line">	if(new.order_status is null,old.order_status,new.order_status),</span><br><span class="line">	if(new.user_id is null,old.user_id,new.user_id),</span><br><span class="line">	if(new.out_trade_no is null,old.out_trade_no,new.out_trade_no),</span><br><span class="line">	if(new.tms[&#39;1001&#39;] is null,from_unixtime(cast(old.create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;),new.tms[&#39;1001&#39;]),--1001 å¯¹åº”æœªæ”¯ä»˜çŠ¶æ€</span><br><span class="line">	if(new.tms[&#39;1002&#39;] is null,from_unixtime(cast(old.payment_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;),new.tms[&#39;1002&#39;]),</span><br><span class="line">	if(new.tms[&#39;1003&#39;] is null,from_unixtime(cast(old.cancel_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;),new.tms[&#39;1003&#39;]),</span><br><span class="line">	if(new.tms[&#39;1004&#39;] is null,from_unixtime(cast(old.finish_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;),new.tms[&#39;1004&#39;]),</span><br><span class="line">	if(new.tms[&#39;1005&#39;] is null,from_unixtime(cast(old.refund_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;),new.tms[&#39;1005&#39;]),</span><br><span class="line">	if(new.tms[&#39;1006&#39;] is null,from_unixtime(cast(old.refund_finish_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd HH:mm:ss&#39;),new.tms[&#39;1006&#39;]),</span><br><span class="line">	if(new.province_id is null,old.province_id,new.province_id),</span><br><span class="line">	if(new.activity_id is null,old.activity_id,new.activity_id),</span><br><span class="line">	if(new.original_total_amount is null,old.original_total_amount,new.original_total_amount),</span><br><span class="line">	if(new.benefit_reduce_amount is null,old.benefit_reduce_amount,new.benefit_reduce_amount),</span><br><span class="line">	if(new.feight_fee is null,old.feight_fee,new.feight_fee),</span><br><span class="line">	if(new.final_total_amount is null,old.final_total_amount,new.final_total_amount)</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		id,</span><br><span class="line">		order_status,</span><br><span class="line">		user_id,</span><br><span class="line">		out_trade_no,</span><br><span class="line">		create_time,</span><br><span class="line">		payment_time,</span><br><span class="line">		cancel_time,</span><br><span class="line">		finish_time,</span><br><span class="line">		refund_time,</span><br><span class="line">		refund_finish_time,</span><br><span class="line">		province_id,</span><br><span class="line">		activity_id,</span><br><span class="line">		original_total_amount,</span><br><span class="line">		benefit_reduce_amount,</span><br><span class="line">		feight_fee,</span><br><span class="line">		final_total_amount</span><br><span class="line">	from dwd.mall__fact_order_info</span><br><span class="line">	where dt in </span><br><span class="line">	(</span><br><span class="line">	select</span><br><span class="line">		from_unixtime(cast(create_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd&#39;)</span><br><span class="line">	from ods.mall__order_info</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	)</span><br><span class="line">)old</span><br><span class="line">full outer join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		info.id,</span><br><span class="line">		info.order_status,</span><br><span class="line">		info.user_id,</span><br><span class="line">		info.out_trade_no,</span><br><span class="line">		info.province_id,</span><br><span class="line">		act.activity_id,</span><br><span class="line">		log.tms,</span><br><span class="line">		info.original_total_amount,</span><br><span class="line">		info.benefit_reduce_amount,</span><br><span class="line">		info.feight_fee,</span><br><span class="line">		info.final_total_amount</span><br><span class="line">	from</span><br><span class="line">	(</span><br><span class="line">	select</span><br><span class="line">		order_id,</span><br><span class="line">		str_to_map(concat_ws(&#39;,&#39;,collect_set(concat(order_status,&#39;&#x3D;&#39;,from_unixtime(cast(operate_time&#x2F;1000 as bigint),&#39;yyyy-MM-dd&#39;)))),&#39;,&#39;,&#39;&#x3D;&#39;)</span><br><span class="line">		tms</span><br><span class="line">	from ods.mall__order_status_log</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	group by order_id</span><br><span class="line">	)log</span><br><span class="line">	join</span><br><span class="line">	(</span><br><span class="line">	select * from ods.mall__order_info where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	)info</span><br><span class="line">	on log.order_id&#x3D;info.id</span><br><span class="line">	left join</span><br><span class="line">	(</span><br><span class="line">	select * from ods.mall__activity_order where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	)act</span><br><span class="line">	on log.order_id&#x3D;act.order_id</span><br><span class="line">)new</span><br><span class="line">on old.id&#x3D;new.id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle37"></a></p><h2 id="10-DWSå±‚æ„å»º"><a href="#10-DWSå±‚æ„å»º" class="headerlink" title="10 DWSå±‚æ„å»º"></a>10 DWSå±‚æ„å»º</h2><blockquote><p>ä¸åœ¨è¿›è¡Œå‹ç¼©å¤„ç†ï¼Œå› ä¸ºå‹ç¼©å¯¹äºç¡¬ç›˜æ˜¯å¥½çš„ï¼Œä½†æ˜¯å¯¹äºCPUè®¡ç®—æ˜¯å·®çš„ï¼Œå¯¹äºDWSå±‚çš„è¡¨ï¼Œä¼šè¢«ç»å¸¸ä½¿ç”¨ï¼Œé‚£ä¹ˆè®²ç©¶çš„æ˜¯è®¡ç®—æ•ˆç‡ï¼Œæ­¤å±‚ä¸»è¦å¤„ç†æ¯æ—¥ä¸»é¢˜è¡Œä¸º</p></blockquote></li></ul><p><a name="blogTitle38"></a></p><h3 id="10-1-æ¯æ—¥è®¾å¤‡è¡Œä¸º-ç”¨æˆ·è¡Œä¸º"><a href="#10-1-æ¯æ—¥è®¾å¤‡è¡Œä¸º-ç”¨æˆ·è¡Œä¸º" class="headerlink" title="10.1 æ¯æ—¥è®¾å¤‡è¡Œä¸º(ç”¨æˆ·è¡Œä¸º)"></a>10.1 æ¯æ—¥è®¾å¤‡è¡Œä¸º(ç”¨æˆ·è¡Œä¸º)</h3><ul><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dws.mall__uv_detail_daycount</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dws.mall__uv_detail_daycount&#96;(</span><br><span class="line">&#96;mid_id&#96; string COMMENT &#39;è®¾å¤‡å”¯ä¸€æ ‡è¯†&#39;,</span><br><span class="line">&#96;user_id&#96; string COMMENT &#39;ç”¨æˆ·æ ‡è¯†&#39;,</span><br><span class="line">&#96;version_code&#96; string COMMENT &#39;ç¨‹åºç‰ˆæœ¬å·&#39;,</span><br><span class="line">&#96;version_name&#96; string COMMENT &#39;ç¨‹åºç‰ˆæœ¬å&#39;,</span><br><span class="line">&#96;lang&#96; string COMMENT &#39;ç³»ç»Ÿè¯­è¨€&#39;,</span><br><span class="line">&#96;source&#96; string COMMENT &#39;æ¸ é“å·&#39;,</span><br><span class="line">&#96;os&#96; string COMMENT &#39;å®‰å“ç³»ç»Ÿç‰ˆæœ¬&#39;,</span><br><span class="line">&#96;area&#96; string COMMENT &#39;åŒºåŸŸ&#39;,</span><br><span class="line">&#96;model&#96; string COMMENT &#39;æ‰‹æœºå‹å·&#39;,</span><br><span class="line">&#96;brand&#96; string COMMENT &#39;æ‰‹æœºå“ç‰Œ&#39;,</span><br><span class="line">&#96;sdk_version&#96; string COMMENT &#39;sdkVersion&#39;,</span><br><span class="line">&#96;gmail&#96; string COMMENT &#39;gmail&#39;,</span><br><span class="line">&#96;height_width&#96; string COMMENT &#39;å±å¹•å®½é«˜&#39;,</span><br><span class="line">&#96;app_time&#96; string COMMENT &#39;å®¢æˆ·ç«¯æ—¥å¿—äº§ç”Ÿæ—¶çš„æ—¶é—´&#39;,</span><br><span class="line">&#96;network&#96; string COMMENT &#39;ç½‘ç»œæ¨¡å¼&#39;,</span><br><span class="line">&#96;lng&#96; string COMMENT &#39;ç»åº¦&#39;,</span><br><span class="line">&#96;lat&#96; string COMMENT &#39;çº¬åº¦&#39;,</span><br><span class="line">&#96;login_count&#96; bigint COMMENT &#39;æ´»è·ƒæ¬¡æ•°&#39;</span><br><span class="line">  ) COMMENT &#39;æ¯æ—¥è®¾å¤‡è¡Œä¸ºè¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dws&#x2F;mall&#x2F;uv_detail_daycount&#x2F;&#39;</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dws</span><br><span class="line">table_name&#x3D;uv_detail_daycount</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">PARTITION (dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	mid_id,</span><br><span class="line">	concat_ws(&#39;|&#39;, collect_set(user_id)) user_id,</span><br><span class="line">	concat_ws(&#39;|&#39;, collect_set(version_code)) version_code,</span><br><span class="line">	concat_ws(&#39;|&#39;, collect_set(version_name)) version_name,</span><br><span class="line">	concat_ws(&#39;|&#39;, collect_set(lang))lang,</span><br><span class="line">	concat_ws(&#39;|&#39;, collect_set(source)) source,</span><br><span class="line">	concat_ws(&#39;|&#39;, collect_set(os)) os,</span><br><span class="line">	concat_ws(&#39;|&#39;, collect_set(area)) area,</span><br><span class="line">	concat_ws(&#39;|&#39;, collect_set(model)) model,</span><br><span class="line">	concat_ws(&#39;|&#39;, collect_set(brand)) brand,</span><br><span class="line">	concat_ws(&#39;|&#39;, collect_set(sdk_version)) sdk_version,</span><br><span class="line">	concat_ws(&#39;|&#39;, collect_set(gmail)) gmail,</span><br><span class="line">	concat_ws(&#39;|&#39;, collect_set(height_width)) height_width,</span><br><span class="line">	concat_ws(&#39;|&#39;, collect_set(app_time)) app_time,</span><br><span class="line">	concat_ws(&#39;|&#39;, collect_set(network)) network,</span><br><span class="line">	concat_ws(&#39;|&#39;, collect_set(lng)) lng,</span><br><span class="line">	concat_ws(&#39;|&#39;, collect_set(lat)) lat,</span><br><span class="line">	count(*) login_count</span><br><span class="line">from dwd.mall__start_log</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">group by mid_id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle39"></a></p><h3 id="10-2-æ¯æ—¥ä¼šå‘˜è¡Œä¸º-ä¸šåŠ¡"><a href="#10-2-æ¯æ—¥ä¼šå‘˜è¡Œä¸º-ä¸šåŠ¡" class="headerlink" title="10.2 æ¯æ—¥ä¼šå‘˜è¡Œä¸º(ä¸šåŠ¡)"></a>10.2 æ¯æ—¥ä¼šå‘˜è¡Œä¸º(ä¸šåŠ¡)</h3></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dws.mall__user_action_daycount</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dws.mall__user_action_daycount&#96;(</span><br><span class="line">user_id string comment &#39;ç”¨æˆ· id&#39;,</span><br><span class="line">login_count bigint comment &#39;ç™»å½•æ¬¡æ•°&#39;,</span><br><span class="line">cart_count bigint comment &#39;åŠ å…¥è´­ç‰©è½¦æ¬¡æ•°&#39;,</span><br><span class="line">cart_amount double comment &#39;åŠ å…¥è´­ç‰©è½¦é‡‘é¢&#39;,</span><br><span class="line">order_count bigint comment &#39;ä¸‹å•æ¬¡æ•°&#39;,</span><br><span class="line">order_amount decimal(16,2) comment &#39;ä¸‹å•é‡‘é¢&#39;,</span><br><span class="line">payment_count bigint comment &#39;æ”¯ä»˜æ¬¡æ•°&#39;,</span><br><span class="line">payment_amount decimal(16,2) comment &#39;æ”¯ä»˜é‡‘é¢&#39;</span><br><span class="line">  ) COMMENT &#39;æ¯æ—¥ä¼šå‘˜è¡Œä¸ºè¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dws&#x2F;mall&#x2F;user_action_daycount&#x2F;&#39;</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dws</span><br><span class="line">table_name&#x3D;user_action_daycount</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">with</span><br><span class="line">tmp_login as</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		user_id,</span><br><span class="line">		count(*) login_count</span><br><span class="line">	from dwd.mall__start_log</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	and user_id is not null</span><br><span class="line">	group by user_id</span><br><span class="line">),</span><br><span class="line">tmp_cart as</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		user_id,</span><br><span class="line">		count(*) cart_count,</span><br><span class="line">		sum(cart_price*sku_num) cart_amount</span><br><span class="line">	from dwd.mall__fact_cart_info</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	and user_id is not null</span><br><span class="line">	and date_format(create_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39;</span><br><span class="line">	group by user_id</span><br><span class="line">),</span><br><span class="line">tmp_order as</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		user_id,</span><br><span class="line">		count(*) order_count,</span><br><span class="line">		sum(final_total_amount) order_amount</span><br><span class="line">	from dwd.mall__fact_order_info</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	group by user_id</span><br><span class="line">) ,</span><br><span class="line">tmp_payment as</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		user_id,</span><br><span class="line">		count(*) payment_count,</span><br><span class="line">		sum(payment_amount) payment_amount</span><br><span class="line">	from dwd.mall__fact_payment_info</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	group by user_id</span><br><span class="line">)</span><br><span class="line">insert overwrite table $hive_table_name partition(dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	user_actions.user_id,</span><br><span class="line">	sum(user_actions.login_count),</span><br><span class="line">	sum(user_actions.cart_count),</span><br><span class="line">	sum(user_actions.cart_amount),</span><br><span class="line">	sum(user_actions.order_count),</span><br><span class="line">	sum(user_actions.order_amount),</span><br><span class="line">	sum(user_actions.payment_count),</span><br><span class="line">	sum(user_actions.payment_amount)</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		user_id,</span><br><span class="line">		login_count,</span><br><span class="line">		0 cart_count,</span><br><span class="line">		0 cart_amount,</span><br><span class="line">		0 order_count,</span><br><span class="line">		0 order_amount,</span><br><span class="line">		0 payment_count,</span><br><span class="line">		0 payment_amount</span><br><span class="line">	from</span><br><span class="line">	tmp_login</span><br><span class="line">union all</span><br><span class="line">	select</span><br><span class="line">		user_id,</span><br><span class="line">		0 login_count,</span><br><span class="line">		cart_count,</span><br><span class="line">		cart_amount,</span><br><span class="line">		0 order_count,</span><br><span class="line">		0 order_amount,</span><br><span class="line">		0 payment_count,</span><br><span class="line">		0 payment_amount</span><br><span class="line">	from</span><br><span class="line">	tmp_cart</span><br><span class="line">union all</span><br><span class="line">	select</span><br><span class="line">		user_id,</span><br><span class="line">		0 login_count,</span><br><span class="line">		0 cart_count,</span><br><span class="line">		0 cart_amount,</span><br><span class="line">		order_count,</span><br><span class="line">		order_amount,</span><br><span class="line">		0 payment_count,</span><br><span class="line">		0 payment_amount</span><br><span class="line">	from tmp_order</span><br><span class="line">union all</span><br><span class="line">	select</span><br><span class="line">		user_id,</span><br><span class="line">		0 login_count,</span><br><span class="line">		0 cart_count,</span><br><span class="line">		0 cart_amount,</span><br><span class="line">		0 order_count,</span><br><span class="line">		0 order_amount,</span><br><span class="line">		payment_count,</span><br><span class="line">		payment_amount</span><br><span class="line">	from tmp_payment</span><br><span class="line">) user_actions</span><br><span class="line">group by user_id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle40"></a></p><h3 id="10-3-æ¯æ—¥å•†å“è¡Œä¸º-ä¸šåŠ¡"><a href="#10-3-æ¯æ—¥å•†å“è¡Œä¸º-ä¸šåŠ¡" class="headerlink" title="10.3 æ¯æ—¥å•†å“è¡Œä¸º(ä¸šåŠ¡)"></a>10.3 æ¯æ—¥å•†å“è¡Œä¸º(ä¸šåŠ¡)</h3></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dws.mall__sku_action_daycount</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dws.mall__sku_action_daycount&#96;(</span><br><span class="line">sku_id string comment &#39;sku_id&#39;,</span><br><span class="line">order_count bigint comment &#39;è¢«ä¸‹å•æ¬¡æ•°&#39;,</span><br><span class="line">order_num bigint comment &#39;è¢«ä¸‹å•ä»¶æ•°&#39;,</span><br><span class="line">order_amount decimal(16,2) comment &#39;è¢«ä¸‹å•é‡‘é¢&#39;,</span><br><span class="line">payment_count bigint comment &#39;è¢«æ”¯ä»˜æ¬¡æ•°&#39;,</span><br><span class="line">payment_num bigint comment &#39;è¢«æ”¯ä»˜ä»¶æ•°&#39;,</span><br><span class="line">payment_amount decimal(16,2) comment &#39;è¢«æ”¯ä»˜é‡‘é¢&#39;,</span><br><span class="line">refund_count bigint comment &#39;è¢«é€€æ¬¾æ¬¡æ•°&#39;,</span><br><span class="line">refund_num bigint comment &#39;è¢«é€€æ¬¾ä»¶æ•°&#39;,</span><br><span class="line">refund_amount decimal(16,2) comment &#39;è¢«é€€æ¬¾é‡‘é¢&#39;,</span><br><span class="line">cart_count bigint comment &#39;è¢«åŠ å…¥è´­ç‰©è½¦æ¬¡æ•°&#39;,</span><br><span class="line">cart_num bigint comment &#39;è¢«åŠ å…¥è´­ç‰©è½¦ä»¶æ•°&#39;,</span><br><span class="line">favor_count bigint comment &#39;è¢«æ”¶è—æ¬¡æ•°&#39;,</span><br><span class="line">appraise_good_count bigint comment &#39;å¥½è¯„æ•°&#39;,</span><br><span class="line">appraise_mid_count bigint comment &#39;ä¸­è¯„æ•°&#39;,</span><br><span class="line">appraise_bad_count bigint comment &#39;å·®è¯„æ•°&#39;,</span><br><span class="line">appraise_default_count bigint comment &#39;é»˜è®¤è¯„ä»·æ•°&#39;</span><br><span class="line">  ) COMMENT &#39;æ¯æ—¥å•†å“è¡Œä¸ºè¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dws&#x2F;mall&#x2F;sku_action_daycount&#x2F;&#39;</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dws</span><br><span class="line">table_name&#x3D;sku_action_daycount</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">with</span><br><span class="line">tmp_order as</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		cast(sku_id as string) sku_id,</span><br><span class="line">		count(*) order_count,</span><br><span class="line">		sum(sku_num) order_num,</span><br><span class="line">		sum(total_amount) order_amount</span><br><span class="line">	from dwd.mall__fact_order_detail</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	group by sku_id</span><br><span class="line">),</span><br><span class="line">tmp_payment as</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		cast(sku_id as string) sku_id,</span><br><span class="line">		count(*) payment_count,</span><br><span class="line">		sum(sku_num) payment_num,</span><br><span class="line">		sum(total_amount) payment_amount</span><br><span class="line">	from dwd.mall__fact_order_detail</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	and order_id in</span><br><span class="line">	(</span><br><span class="line">	select</span><br><span class="line">		id</span><br><span class="line">	from dwd.mall__fact_order_info</span><br><span class="line">	where (dt&#x3D;&#39;$db_date&#39; or dt&#x3D;date_add(&#39;$db_date&#39;,-1))</span><br><span class="line">	and date_format(payment_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39;</span><br><span class="line">	)</span><br><span class="line">	group by sku_id</span><br><span class="line">),</span><br><span class="line">tmp_refund as</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		cast(sku_id as string) sku_id,</span><br><span class="line">		count(*) refund_count,</span><br><span class="line">		sum(refund_num) refund_num,</span><br><span class="line">		sum(refund_amount) refund_amount</span><br><span class="line">	from dwd.mall__fact_order_refund_info</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	group by sku_id</span><br><span class="line">),</span><br><span class="line">tmp_cart as</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		cast(sku_id as string) sku_id,</span><br><span class="line">		count(*) cart_count,</span><br><span class="line">		sum(sku_num) cart_num</span><br><span class="line">	from dwd.mall__fact_cart_info</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	and date_format(create_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39;</span><br><span class="line">	group by sku_id</span><br><span class="line">),</span><br><span class="line">tmp_favor as</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		cast(sku_id as string) sku_id,</span><br><span class="line">		count(*) favor_count</span><br><span class="line">	from dwd.mall__fact_favor_info</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	and date_format(create_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39;</span><br><span class="line">	group by sku_id</span><br><span class="line">),</span><br><span class="line">tmp_appraise as</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		cast(sku_id as string) sku_id,</span><br><span class="line">		sum(if(appraise&#x3D;&#39;1201&#39;,1,0)) appraise_good_count,</span><br><span class="line">		sum(if(appraise&#x3D;&#39;1202&#39;,1,0)) appraise_mid_count,</span><br><span class="line">		sum(if(appraise&#x3D;&#39;1203&#39;,1,0)) appraise_bad_count,</span><br><span class="line">		sum(if(appraise&#x3D;&#39;1204&#39;,1,0)) appraise_default_count</span><br><span class="line">	from dwd.mall__fact_comment_info</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	group by sku_id</span><br><span class="line">)</span><br><span class="line">insert overwrite table $hive_table_name partition(dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	sku_id,</span><br><span class="line">	sum(order_count),</span><br><span class="line">	sum(order_num),</span><br><span class="line">	sum(order_amount),</span><br><span class="line">	sum(payment_count),</span><br><span class="line">	sum(payment_num),</span><br><span class="line">	sum(payment_amount),</span><br><span class="line">	sum(refund_count),</span><br><span class="line">	sum(refund_num),</span><br><span class="line">	sum(refund_amount),</span><br><span class="line">	sum(cart_count),</span><br><span class="line">	sum(cart_num),</span><br><span class="line">	sum(favor_count),</span><br><span class="line">	sum(appraise_good_count),</span><br><span class="line">	sum(appraise_mid_count),</span><br><span class="line">	sum(appraise_bad_count),</span><br><span class="line">	sum(appraise_default_count)</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		sku_id,</span><br><span class="line">		order_count,</span><br><span class="line">		order_num,</span><br><span class="line">		order_amount,</span><br><span class="line">		0 payment_count,</span><br><span class="line">		0 payment_num,</span><br><span class="line">		0 payment_amount,</span><br><span class="line">		0 refund_count,</span><br><span class="line">		0 refund_num,</span><br><span class="line">		0 refund_amount,</span><br><span class="line">		0 cart_count,</span><br><span class="line">		0 cart_num,</span><br><span class="line">		0 favor_count,</span><br><span class="line">		0 appraise_good_count,</span><br><span class="line">		0 appraise_mid_count,</span><br><span class="line">		0 appraise_bad_count,</span><br><span class="line">		0 appraise_default_count</span><br><span class="line">	from tmp_order</span><br><span class="line">union all</span><br><span class="line">	select</span><br><span class="line">		sku_id,</span><br><span class="line">		0 order_count,</span><br><span class="line">		0 order_num,</span><br><span class="line">		0 order_amount,</span><br><span class="line">		payment_count,</span><br><span class="line">		payment_num,</span><br><span class="line">		payment_amount,</span><br><span class="line">		0 refund_count,</span><br><span class="line">		0 refund_num,</span><br><span class="line">		0 refund_amount,</span><br><span class="line">		0 cart_count,</span><br><span class="line">		0 cart_num,</span><br><span class="line">		0 favor_count,</span><br><span class="line">		0 appraise_good_count,</span><br><span class="line">		0 appraise_mid_count,</span><br><span class="line">		0 appraise_bad_count,</span><br><span class="line">		0 appraise_default_count</span><br><span class="line">	from tmp_payment</span><br><span class="line">union all</span><br><span class="line">	select</span><br><span class="line">		sku_id,</span><br><span class="line">		0 order_count,</span><br><span class="line">		0 order_num,</span><br><span class="line">		0 order_amount,</span><br><span class="line">		0 payment_count,</span><br><span class="line">		0 payment_num,</span><br><span class="line">		0 payment_amount,</span><br><span class="line">		refund_count,</span><br><span class="line">		refund_num,</span><br><span class="line">		refund_amount,</span><br><span class="line">		0 cart_count,</span><br><span class="line">		0 cart_num,</span><br><span class="line">		0 favor_count,</span><br><span class="line">		0 appraise_good_count,</span><br><span class="line">		0 appraise_mid_count,</span><br><span class="line">		0 appraise_bad_count,</span><br><span class="line">		0 appraise_default_count</span><br><span class="line">	from tmp_refund</span><br><span class="line">union all</span><br><span class="line">	select</span><br><span class="line">		sku_id,</span><br><span class="line">		0 order_count,</span><br><span class="line">		0 order_num,</span><br><span class="line">		0 order_amount,</span><br><span class="line">		0 payment_count,</span><br><span class="line">		0 payment_num,</span><br><span class="line">		0 payment_amount,</span><br><span class="line">		0 refund_count,</span><br><span class="line">		0 refund_num,</span><br><span class="line">		0 refund_amount,</span><br><span class="line">		cart_count,</span><br><span class="line">		cart_num,</span><br><span class="line">		0 favor_count,</span><br><span class="line">		0 appraise_good_count,</span><br><span class="line">		0 appraise_mid_count,</span><br><span class="line">		0 appraise_bad_count,</span><br><span class="line">		0 appraise_default_count</span><br><span class="line">	from tmp_cart</span><br><span class="line">union all</span><br><span class="line">	select</span><br><span class="line">		sku_id,</span><br><span class="line">		0 order_count,</span><br><span class="line">		0 order_num,</span><br><span class="line">		0 order_amount,</span><br><span class="line">		0 payment_count,</span><br><span class="line">		0 payment_num,</span><br><span class="line">		0 payment_amount,</span><br><span class="line">		0 refund_count,</span><br><span class="line">		0 refund_num,</span><br><span class="line">		0 refund_amount,</span><br><span class="line">		0 cart_count,</span><br><span class="line">		0 cart_num,</span><br><span class="line">		favor_count,</span><br><span class="line">		0 appraise_good_count,</span><br><span class="line">		0 appraise_mid_count,</span><br><span class="line">		0 appraise_bad_count,</span><br><span class="line">		0 appraise_default_count</span><br><span class="line">	from tmp_favor</span><br><span class="line">union all</span><br><span class="line">	select</span><br><span class="line">		sku_id,</span><br><span class="line">		0 order_count,</span><br><span class="line">		0 order_num,</span><br><span class="line">		0 order_amount,</span><br><span class="line">		0 payment_count,</span><br><span class="line">		0 payment_num,</span><br><span class="line">		0 payment_amount,</span><br><span class="line">		0 refund_count,</span><br><span class="line">		0 refund_num,</span><br><span class="line">		0 refund_amount,</span><br><span class="line">		0 cart_count,</span><br><span class="line">		0 cart_num,</span><br><span class="line">		0 favor_count,</span><br><span class="line">		appraise_good_count,</span><br><span class="line">		appraise_mid_count,</span><br><span class="line">		appraise_bad_count,</span><br><span class="line">		appraise_default_count</span><br><span class="line">	from tmp_appraise</span><br><span class="line">)tmp</span><br><span class="line">group by sku_id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle41"></a></p><h3 id="10-4-æ¯æ—¥ä¼˜æƒ åˆ¸ç»Ÿè®¡-ä¸šåŠ¡"><a href="#10-4-æ¯æ—¥ä¼˜æƒ åˆ¸ç»Ÿè®¡-ä¸šåŠ¡" class="headerlink" title="10.4 æ¯æ—¥ä¼˜æƒ åˆ¸ç»Ÿè®¡(ä¸šåŠ¡)"></a>10.4 æ¯æ—¥ä¼˜æƒ åˆ¸ç»Ÿè®¡(ä¸šåŠ¡)</h3></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dws.mall__coupon_use_daycount</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dws.mall__coupon_use_daycount&#96;(</span><br><span class="line">&#96;coupon_id&#96; string COMMENT &#39;ä¼˜æƒ åˆ¸ ID&#39;,</span><br><span class="line">&#96;coupon_name&#96; string COMMENT &#39;è´­ç‰©åˆ¸åç§°&#39;,</span><br><span class="line">&#96;coupon_type&#96; string COMMENT &#39;è´­ç‰©åˆ¸ç±»å‹ 1 ç°é‡‘åˆ¸ 2 æŠ˜æ‰£åˆ¸ 3 æ»¡å‡åˆ¸ 4 æ»¡ä»¶æ‰“æŠ˜åˆ¸&#39;,</span><br><span class="line">&#96;condition_amount&#96; string COMMENT &#39;æ»¡é¢æ•°&#39;,</span><br><span class="line">&#96;condition_num&#96; string COMMENT &#39;æ»¡ä»¶æ•°&#39;,</span><br><span class="line">&#96;activity_id&#96; string COMMENT &#39;æ´»åŠ¨ç¼–å·&#39;,</span><br><span class="line">&#96;benefit_amount&#96; string COMMENT &#39;å‡é‡‘é¢&#39;,</span><br><span class="line">&#96;benefit_discount&#96; string COMMENT &#39;æŠ˜æ‰£&#39;,</span><br><span class="line">&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">&#96;range_type&#96; string COMMENT &#39;èŒƒå›´ç±»å‹ 1ã€å•†å“ 2ã€å“ç±» 3ã€å“ç‰Œ&#39;,</span><br><span class="line">&#96;spu_id&#96; string COMMENT &#39;å•†å“ id&#39;,</span><br><span class="line">&#96;tm_id&#96; string COMMENT &#39;å“ç‰Œ id&#39;,</span><br><span class="line">&#96;category3_id&#96; string COMMENT &#39;å“ç±» id&#39;,</span><br><span class="line">&#96;limit_num&#96; string COMMENT &#39;æœ€å¤šé¢†ç”¨æ¬¡æ•°&#39;,</span><br><span class="line">&#96;get_count&#96; bigint COMMENT &#39;é¢†ç”¨æ¬¡æ•°&#39;,</span><br><span class="line">&#96;using_count&#96; bigint COMMENT &#39;ä½¿ç”¨(ä¸‹å•)æ¬¡æ•°&#39;,</span><br><span class="line">&#96;used_count&#96; bigint COMMENT &#39;ä½¿ç”¨(æ”¯ä»˜)æ¬¡æ•°&#39;</span><br><span class="line">  ) COMMENT &#39;æ¯æ—¥ä¼˜æƒ åˆ¸ç»Ÿè®¡è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dws&#x2F;mall&#x2F;coupon_use_daycount&#x2F;&#39;</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dws</span><br><span class="line">table_name&#x3D;coupon_use_daycount</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name partition(dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	cu.coupon_id,</span><br><span class="line">	ci.coupon_name,</span><br><span class="line">	ci.coupon_type,</span><br><span class="line">	ci.condition_amount,</span><br><span class="line">	ci.condition_num,</span><br><span class="line">	ci.activity_id,</span><br><span class="line">	ci.benefit_amount,</span><br><span class="line">	ci.benefit_discount,</span><br><span class="line">	ci.create_time,</span><br><span class="line">	ci.range_type,</span><br><span class="line">	ci.spu_id,</span><br><span class="line">	ci.tm_id,</span><br><span class="line">	ci.category3_id,</span><br><span class="line">	ci.limit_num,</span><br><span class="line">	cu.get_count,</span><br><span class="line">	cu.using_count,</span><br><span class="line">	cu.used_count</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		coupon_id,</span><br><span class="line">		sum(if(date_format(get_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39;,1,0))</span><br><span class="line">		get_count,</span><br><span class="line">		sum(if(date_format(using_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39;,1,0))</span><br><span class="line">		using_count,</span><br><span class="line">		sum(if(date_format(used_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39;,1,0))</span><br><span class="line">		used_count</span><br><span class="line">	from dwd.mall__fact_coupon_use</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	group by coupon_id</span><br><span class="line">)cu</span><br><span class="line">left join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		*</span><br><span class="line">	from dwd.mall__dim_coupon_info</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)ci on cu.coupon_id&#x3D;ci.id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle42"></a></p><h3 id="10-5-æ¯æ—¥æ´»åŠ¨ç»Ÿè®¡-ä¸šåŠ¡"><a href="#10-5-æ¯æ—¥æ´»åŠ¨ç»Ÿè®¡-ä¸šåŠ¡" class="headerlink" title="10.5 æ¯æ—¥æ´»åŠ¨ç»Ÿè®¡(ä¸šåŠ¡)"></a>10.5 æ¯æ—¥æ´»åŠ¨ç»Ÿè®¡(ä¸šåŠ¡)</h3></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dws.mall__activity_info_daycount</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dws.mall__activity_info_daycount&#96;(</span><br><span class="line">&#96;id&#96; string COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">&#96;activity_name&#96; string COMMENT &#39;æ´»åŠ¨åç§°&#39;,</span><br><span class="line">&#96;activity_type&#96; string COMMENT &#39;æ´»åŠ¨ç±»å‹&#39;,</span><br><span class="line">&#96;start_time&#96; string COMMENT &#39;å¼€å§‹æ—¶é—´&#39;,</span><br><span class="line">&#96;end_time&#96; string COMMENT &#39;ç»“æŸæ—¶é—´&#39;,</span><br><span class="line">&#96;create_time&#96; string COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">&#96;order_count&#96; bigint COMMENT &#39;ä¸‹å•æ¬¡æ•°&#39;,</span><br><span class="line">&#96;payment_count&#96; bigint COMMENT &#39;æ”¯ä»˜æ¬¡æ•°&#39;</span><br><span class="line">  ) COMMENT &#39;æ¯æ—¥æ´»åŠ¨ç»Ÿè®¡è¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dws&#x2F;mall&#x2F;activity_info_daycount&#x2F;&#39;</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dws</span><br><span class="line">table_name&#x3D;activity_info_daycount</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name partition(dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	oi.activity_id,</span><br><span class="line">	ai.activity_name,</span><br><span class="line">	ai.activity_type,</span><br><span class="line">	ai.start_time,</span><br><span class="line">	ai.end_time,</span><br><span class="line">	ai.create_time,</span><br><span class="line">	oi.order_count,</span><br><span class="line">	oi.payment_count</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		activity_id,</span><br><span class="line">		sum(if(date_format(create_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39;,1,0))</span><br><span class="line">		order_count,</span><br><span class="line">		sum(if(date_format(payment_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$db_date&#39;,1,0))</span><br><span class="line">		payment_count</span><br><span class="line">	from dwd.mall__fact_order_info</span><br><span class="line">	where (dt&#x3D;&#39;$db_date&#39; or dt&#x3D;date_add(&#39;$db_date&#39;,-1))</span><br><span class="line">	and activity_id is not null</span><br><span class="line">	group by activity_id</span><br><span class="line">)oi</span><br><span class="line">join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		*</span><br><span class="line">	from dwd.mall__dim_activity_info</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)ai</span><br><span class="line">on oi.activity_id&#x3D;ai.id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle43"></a></p><h3 id="10-6-æ¯æ—¥è´­ä¹°è¡Œä¸º-ä¸šåŠ¡"><a href="#10-6-æ¯æ—¥è´­ä¹°è¡Œä¸º-ä¸šåŠ¡" class="headerlink" title="10.6 æ¯æ—¥è´­ä¹°è¡Œä¸º(ä¸šåŠ¡)"></a>10.6 æ¯æ—¥è´­ä¹°è¡Œä¸º(ä¸šåŠ¡)</h3></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dws.mall__sale_detail_daycount</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dws.mall__sale_detail_daycount&#96;(</span><br><span class="line">user_id string comment &#39;ç”¨æˆ· id&#39;,</span><br><span class="line">sku_id string comment &#39;å•†å“ id&#39;,</span><br><span class="line">user_gender string comment &#39;ç”¨æˆ·æ€§åˆ«&#39;,</span><br><span class="line">user_age string comment &#39;ç”¨æˆ·å¹´é¾„&#39;,</span><br><span class="line">user_level string comment &#39;ç”¨æˆ·ç­‰çº§&#39;,</span><br><span class="line">order_price decimal(10,2) comment &#39;å•†å“ä»·æ ¼&#39;,</span><br><span class="line">sku_name string comment &#39;å•†å“åç§°&#39;,</span><br><span class="line">sku_tm_id string comment &#39;å“ç‰Œ id&#39;,</span><br><span class="line">sku_category3_id string comment &#39;å•†å“ä¸‰çº§å“ç±» id&#39;,</span><br><span class="line">sku_category2_id string comment &#39;å•†å“äºŒçº§å“ç±» id&#39;,</span><br><span class="line">sku_category1_id string comment &#39;å•†å“ä¸€çº§å“ç±» id&#39;,</span><br><span class="line">sku_category3_name string comment &#39;å•†å“ä¸‰çº§å“ç±»åç§°&#39;,</span><br><span class="line">sku_category2_name string comment &#39;å•†å“äºŒçº§å“ç±»åç§°&#39;,</span><br><span class="line">sku_category1_name string comment &#39;å•†å“ä¸€çº§å“ç±»åç§°&#39;,</span><br><span class="line">spu_id string comment &#39;å•†å“ spu&#39;,</span><br><span class="line">sku_num int comment &#39;è´­ä¹°ä¸ªæ•°&#39;,</span><br><span class="line">order_count bigint comment &#39;å½“æ—¥ä¸‹å•å•æ•°&#39;,</span><br><span class="line">order_amount decimal(16,2) comment &#39;å½“æ—¥ä¸‹å•é‡‘é¢&#39;</span><br><span class="line">  ) COMMENT &#39;æ¯æ—¥è´­ä¹°è¡Œä¸ºè¡¨&#39;</span><br><span class="line">PARTITIONED BY (</span><br><span class="line">  &#96;dt&#96; String COMMENT &#39;partition&#39;</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dws&#x2F;mall&#x2F;sale_detail_daycount&#x2F;&#39;</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dws</span><br><span class="line">table_name&#x3D;sale_detail_daycount</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name partition(dt&#x3D;&#39;$db_date&#39;)</span><br><span class="line">select</span><br><span class="line">	op.user_id,</span><br><span class="line">	op.sku_id,</span><br><span class="line">	ui.gender,</span><br><span class="line">	months_between(&#39;$db_date&#39;, ui.birthday)&#x2F;12 age,</span><br><span class="line">	ui.user_level,</span><br><span class="line">	si.price,</span><br><span class="line">	si.sku_name,</span><br><span class="line">	si.tm_id,</span><br><span class="line">	si.category3_id,</span><br><span class="line">	si.category2_id,</span><br><span class="line">	si.category1_id,</span><br><span class="line">	si.category3_name,</span><br><span class="line">	si.category2_name,</span><br><span class="line">	si.category1_name,</span><br><span class="line">	si.spu_id,</span><br><span class="line">	op.sku_num,</span><br><span class="line">	op.order_count,</span><br><span class="line">	op.order_amount</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		user_id,</span><br><span class="line">		sku_id,</span><br><span class="line">		sum(sku_num) sku_num,</span><br><span class="line">		count(*) order_count,</span><br><span class="line">		sum(total_amount) order_amount</span><br><span class="line">	from dwd.mall__fact_order_detail</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	group by user_id, sku_id</span><br><span class="line">)op</span><br><span class="line">join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		*</span><br><span class="line">	from dwd.mall__dim_user_info_his</span><br><span class="line">	where end_date&#x3D;&#39;9999-99-99&#39;</span><br><span class="line">)ui on op.user_id &#x3D; ui.id</span><br><span class="line">join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		*</span><br><span class="line">	from dwd.mall__dim_sku_info</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)si on op.sku_id &#x3D; si.id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle44"></a></p><h2 id="11-DWTå±‚æ„å»º"><a href="#11-DWTå±‚æ„å»º" class="headerlink" title="11 DWTå±‚æ„å»º"></a>11 DWTå±‚æ„å»º</h2><blockquote><p>æ­¤å±‚ä¸»è¦é’ˆå¯¹dwså±‚æ¯æ—¥æ•°æ®è¿›è¡Œæ±‡æ€»ï¼Œä¸å»ºç«‹åˆ†åŒºï¼Œä¸å‹ç¼©ï¼Œæ¯æ—¥è¿›è¡Œæ•°æ®è¦†ç›–</p></blockquote></li></ul><p><a name="blogTitle45"></a></p><h3 id="11-1-è®¾å¤‡ä¸»é¢˜å®½è¡¨"><a href="#11-1-è®¾å¤‡ä¸»é¢˜å®½è¡¨" class="headerlink" title="11.1 è®¾å¤‡ä¸»é¢˜å®½è¡¨"></a>11.1 è®¾å¤‡ä¸»é¢˜å®½è¡¨</h3><ul><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwt.mall__uv_topic</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwt.mall__uv_topic&#96;(</span><br><span class="line">&#96;mid_id&#96; string COMMENT &#39;è®¾å¤‡å”¯ä¸€æ ‡è¯†&#39;,</span><br><span class="line">&#96;user_id&#96; string COMMENT &#39;ç”¨æˆ·æ ‡è¯†&#39;,</span><br><span class="line">&#96;version_code&#96; string COMMENT &#39;ç¨‹åºç‰ˆæœ¬å·&#39;,</span><br><span class="line">&#96;version_name&#96; string COMMENT &#39;ç¨‹åºç‰ˆæœ¬å&#39;,</span><br><span class="line">&#96;lang&#96; string COMMENT &#39;ç³»ç»Ÿè¯­è¨€&#39;,</span><br><span class="line">&#96;source&#96; string COMMENT &#39;æ¸ é“å·&#39;,</span><br><span class="line">&#96;os&#96; string COMMENT &#39;å®‰å“ç³»ç»Ÿç‰ˆæœ¬&#39;,</span><br><span class="line">&#96;area&#96; string COMMENT &#39;åŒºåŸŸ&#39;,</span><br><span class="line">&#96;model&#96; string COMMENT &#39;æ‰‹æœºå‹å·&#39;,</span><br><span class="line">&#96;brand&#96; string COMMENT &#39;æ‰‹æœºå“ç‰Œ&#39;,</span><br><span class="line">&#96;sdk_version&#96; string COMMENT &#39;sdkVersion&#39;,</span><br><span class="line">&#96;gmail&#96; string COMMENT &#39;gmail&#39;,</span><br><span class="line">&#96;height_width&#96; string COMMENT &#39;å±å¹•å®½é«˜&#39;,</span><br><span class="line">&#96;app_time&#96; string COMMENT &#39;å®¢æˆ·ç«¯æ—¥å¿—äº§ç”Ÿæ—¶çš„æ—¶é—´&#39;,</span><br><span class="line">&#96;network&#96; string  COMMENT &#39;ç½‘ç»œæ¨¡å¼&#39;,</span><br><span class="line">&#96;lng&#96; string COMMENT &#39;ç»åº¦&#39;,</span><br><span class="line">&#96;lat&#96; string COMMENT &#39;çº¬åº¦&#39;,</span><br><span class="line">&#96;login_date_first&#96; string comment &#39;é¦–æ¬¡æ´»è·ƒæ—¶é—´&#39;,</span><br><span class="line">&#96;login_date_last&#96; string comment &#39;æœ«æ¬¡æ´»è·ƒæ—¶é—´&#39;,</span><br><span class="line">&#96;login_day_count&#96; bigint comment &#39;å½“æ—¥æ´»è·ƒæ¬¡æ•°&#39;,</span><br><span class="line">&#96;login_count&#96; bigint comment &#39;ç´¯ç§¯æ´»è·ƒå¤©æ•°&#39;</span><br><span class="line">  ) COMMENT &#39;è®¾å¤‡ä¸»é¢˜å®½è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwt&#x2F;mall&#x2F;uv_topic&#x2F;&#39;</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwt</span><br><span class="line">table_name&#x3D;uv_topic</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	nvl(new.mid_id,old.mid_id),</span><br><span class="line">	nvl(new.user_id,old.user_id),</span><br><span class="line">	nvl(new.version_code,old.version_code),</span><br><span class="line">	nvl(new.version_name,old.version_name),</span><br><span class="line">	nvl(new.lang,old.lang),</span><br><span class="line">	nvl(new.source,old.source),</span><br><span class="line">	nvl(new.os,old.os),</span><br><span class="line">	nvl(new.area,old.area),</span><br><span class="line">	nvl(new.model,old.model),</span><br><span class="line">	nvl(new.brand,old.brand),</span><br><span class="line">	nvl(new.sdk_version,old.sdk_version),</span><br><span class="line">	nvl(new.gmail,old.gmail),</span><br><span class="line">	nvl(new.height_width,old.height_width),</span><br><span class="line">	nvl(new.app_time,old.app_time),</span><br><span class="line">	nvl(new.network,old.network),</span><br><span class="line">	nvl(new.lng,old.lng),</span><br><span class="line">	nvl(new.lat,old.lat),</span><br><span class="line">	if(old.mid_id is null,&#39;2020-03-10&#39;,old.login_date_first),</span><br><span class="line">	if(new.mid_id is not null,&#39;2020-03-10&#39;,old.login_date_last),</span><br><span class="line">	if(new.mid_id is not null, new.login_count,0),</span><br><span class="line">	nvl(old.login_count,0)+if(new.login_count&gt;0,1,0)</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		*</span><br><span class="line">	from dwt.mall__uv_topic</span><br><span class="line">)old</span><br><span class="line">full outer join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		*</span><br><span class="line">	from dws.mall__uv_detail_daycount</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)new</span><br><span class="line">on old.mid_id&#x3D;new.mid_id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle46"></a></p><h3 id="11-2-ä¼šå‘˜ä¸»é¢˜å®½è¡¨"><a href="#11-2-ä¼šå‘˜ä¸»é¢˜å®½è¡¨" class="headerlink" title="11.2 ä¼šå‘˜ä¸»é¢˜å®½è¡¨"></a>11.2 ä¼šå‘˜ä¸»é¢˜å®½è¡¨</h3></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwt.mall__user_topic</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwt.mall__user_topic&#96;(</span><br><span class="line">user_id string comment &#39;ç”¨æˆ· id&#39;,</span><br><span class="line">login_date_first string comment &#39;é¦–æ¬¡ç™»å½•æ—¶é—´&#39;,</span><br><span class="line">login_date_last string comment &#39;æœ«æ¬¡ç™»å½•æ—¶é—´&#39;,</span><br><span class="line">login_count bigint comment &#39;ç´¯ç§¯ç™»å½•å¤©æ•°&#39;,</span><br><span class="line">login_last_30d_count bigint comment &#39;æœ€è¿‘ 30 æ—¥ç™»å½•å¤©æ•°&#39;,</span><br><span class="line">order_date_first string comment &#39;é¦–æ¬¡ä¸‹å•æ—¶é—´&#39;,</span><br><span class="line">order_date_last string comment &#39;æœ«æ¬¡ä¸‹å•æ—¶é—´&#39;,</span><br><span class="line">order_count bigint comment &#39;ç´¯ç§¯ä¸‹å•æ¬¡æ•°&#39;,</span><br><span class="line">order_amount decimal(16,2) comment &#39;ç´¯ç§¯ä¸‹å•é‡‘é¢&#39;,</span><br><span class="line">order_last_30d_count bigint comment &#39;æœ€è¿‘ 30 æ—¥ä¸‹å•æ¬¡æ•°&#39;,</span><br><span class="line">order_last_30d_amount bigint comment &#39;æœ€è¿‘ 30 æ—¥ä¸‹å•é‡‘é¢&#39;,</span><br><span class="line">payment_date_first string comment &#39;é¦–æ¬¡æ”¯ä»˜æ—¶é—´&#39;,</span><br><span class="line">payment_date_last string comment &#39;æœ«æ¬¡æ”¯ä»˜æ—¶é—´&#39;,</span><br><span class="line">payment_count decimal(16,2) comment &#39;ç´¯ç§¯æ”¯ä»˜æ¬¡æ•°&#39;,</span><br><span class="line">payment_amount decimal(16,2) comment &#39;ç´¯ç§¯æ”¯ä»˜é‡‘é¢&#39;,</span><br><span class="line">payment_last_30d_count decimal(16,2) comment &#39;æœ€è¿‘ 30 æ—¥æ”¯ä»˜æ¬¡æ•°&#39;,</span><br><span class="line">payment_last_30d_amount decimal(16,2) comment &#39;æœ€è¿‘ 30 æ—¥æ”¯ä»˜é‡‘é¢&#39;</span><br><span class="line">  ) COMMENT &#39;ä¼šå‘˜ä¸»é¢˜å®½è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwt&#x2F;mall&#x2F;user_topic&#x2F;&#39;</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwt</span><br><span class="line">table_name&#x3D;user_topic</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	nvl(new.user_id,old.user_id),</span><br><span class="line">	if(old.login_date_first is null and</span><br><span class="line">	new.login_count&gt;0,&#39;$db_date&#39;,old.login_date_first),</span><br><span class="line">	if(new.login_count&gt;0,&#39;$db_date&#39;,old.login_date_last),</span><br><span class="line">	nvl(old.login_count,0)+if(new.login_count&gt;0,1,0),</span><br><span class="line">	nvl(new.login_last_30d_count,0),</span><br><span class="line">	if(old.order_date_first is null and</span><br><span class="line">	new.order_count&gt;0,&#39;$db_date&#39;,old.order_date_first),</span><br><span class="line">	if(new.order_count&gt;0,&#39;$db_date&#39;,old.order_date_last),</span><br><span class="line">	nvl(old.order_count,0)+nvl(new.order_count,0),</span><br><span class="line">	nvl(old.order_amount,0)+nvl(new.order_amount,0),</span><br><span class="line">	nvl(new.order_last_30d_count,0),</span><br><span class="line">	nvl(new.order_last_30d_amount,0),</span><br><span class="line">	if(old.payment_date_first is null and</span><br><span class="line">	new.payment_count&gt;0,&#39;$db_date&#39;,old.payment_date_first),</span><br><span class="line">	if(new.payment_count&gt;0,&#39;$db_date&#39;,old.payment_date_last),</span><br><span class="line">	nvl(old.payment_count,0)+nvl(new.payment_count,0),</span><br><span class="line">	nvl(old.payment_amount,0)+nvl(new.payment_amount,0),</span><br><span class="line">	nvl(new.payment_last_30d_count,0),</span><br><span class="line">	nvl(new.payment_last_30d_amount,0)</span><br><span class="line">from</span><br><span class="line">dwt.mall__user_topic old</span><br><span class="line">full outer join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		user_id,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,login_count,0)) login_count,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,order_count,0)) order_count,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,order_amount,0)) order_amount,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,payment_count,0)) payment_count,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,payment_amount,0)) payment_amount,</span><br><span class="line">		sum(if(login_count&gt;0,1,0)) login_last_30d_count,</span><br><span class="line">		sum(order_count) order_last_30d_count,</span><br><span class="line">		sum(order_amount) order_last_30d_amount,</span><br><span class="line">		sum(payment_count) payment_last_30d_count,</span><br><span class="line">		sum(payment_amount) payment_last_30d_amount</span><br><span class="line">	from dws.mall__user_action_daycount</span><br><span class="line">	where dt&gt;&#x3D;date_add( &#39;$db_date&#39;,-30)</span><br><span class="line">	group by user_id</span><br><span class="line">)new</span><br><span class="line">on old.user_id&#x3D;new.user_id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle47"></a></p><h3 id="11-3-å•†å“ä¸»é¢˜å®½è¡¨"><a href="#11-3-å•†å“ä¸»é¢˜å®½è¡¨" class="headerlink" title="11.3 å•†å“ä¸»é¢˜å®½è¡¨"></a>11.3 å•†å“ä¸»é¢˜å®½è¡¨</h3></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwt.mall__sku_topic</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwt.mall__sku_topic&#96;(</span><br><span class="line">sku_id string comment &#39;sku_id&#39;,</span><br><span class="line">spu_id string comment &#39;spu_id&#39;,</span><br><span class="line">order_last_30d_count bigint comment &#39;æœ€è¿‘ 30 æ—¥è¢«ä¸‹å•æ¬¡æ•°&#39;,</span><br><span class="line">order_last_30d_num bigint comment &#39;æœ€è¿‘ 30 æ—¥è¢«ä¸‹å•ä»¶æ•°&#39;,</span><br><span class="line">order_last_30d_amount decimal(16,2) comment &#39;æœ€è¿‘ 30 æ—¥è¢«ä¸‹å•é‡‘é¢&#39;,</span><br><span class="line">order_count bigint comment &#39;ç´¯ç§¯è¢«ä¸‹å•æ¬¡æ•°&#39;,</span><br><span class="line">order_num bigint comment &#39;ç´¯ç§¯è¢«ä¸‹å•ä»¶æ•°&#39;,</span><br><span class="line">order_amount decimal(16,2) comment &#39;ç´¯ç§¯è¢«ä¸‹å•é‡‘é¢&#39;,</span><br><span class="line">payment_last_30d_count bigint comment &#39;æœ€è¿‘ 30 æ—¥è¢«æ”¯ä»˜æ¬¡æ•°&#39;,</span><br><span class="line">payment_last_30d_num bigint comment &#39;æœ€è¿‘ 30 æ—¥è¢«æ”¯ä»˜ä»¶æ•°&#39;,</span><br><span class="line">payment_last_30d_amount decimal(16,2) comment &#39;æœ€è¿‘ 30 æ—¥è¢«æ”¯ä»˜é‡‘é¢&#39;,</span><br><span class="line">payment_count bigint comment &#39;ç´¯ç§¯è¢«æ”¯ä»˜æ¬¡æ•°&#39;,</span><br><span class="line">payment_num bigint comment &#39;ç´¯ç§¯è¢«æ”¯ä»˜ä»¶æ•°&#39;,</span><br><span class="line">payment_amount decimal(16,2) comment &#39;ç´¯ç§¯è¢«æ”¯ä»˜é‡‘é¢&#39;,</span><br><span class="line">refund_last_30d_count bigint comment &#39;æœ€è¿‘ä¸‰åæ—¥é€€æ¬¾æ¬¡æ•°&#39;,</span><br><span class="line">refund_last_30d_num bigint comment &#39;æœ€è¿‘ä¸‰åæ—¥é€€æ¬¾ä»¶æ•°&#39;,</span><br><span class="line">refund_last_30d_amount decimal(10,2) comment &#39;æœ€è¿‘ä¸‰åæ—¥é€€æ¬¾é‡‘é¢&#39;,</span><br><span class="line">refund_count bigint comment &#39;ç´¯ç§¯é€€æ¬¾æ¬¡æ•°&#39;,</span><br><span class="line">refund_num bigint comment &#39;ç´¯ç§¯é€€æ¬¾ä»¶æ•°&#39;,</span><br><span class="line">refund_amount decimal(10,2) comment &#39;ç´¯ç§¯é€€æ¬¾é‡‘é¢&#39;,</span><br><span class="line">cart_last_30d_count bigint comment &#39;æœ€è¿‘ 30 æ—¥è¢«åŠ å…¥è´­ç‰©è½¦æ¬¡æ•°&#39;,</span><br><span class="line">cart_last_30d_num bigint comment &#39;æœ€è¿‘ 30 æ—¥è¢«åŠ å…¥è´­ç‰©è½¦ä»¶æ•°&#39;,</span><br><span class="line">cart_count bigint comment &#39;ç´¯ç§¯è¢«åŠ å…¥è´­ç‰©è½¦æ¬¡æ•°&#39;,</span><br><span class="line">cart_num bigint comment &#39;ç´¯ç§¯è¢«åŠ å…¥è´­ç‰©è½¦ä»¶æ•°&#39;,</span><br><span class="line">favor_last_30d_count bigint comment &#39;æœ€è¿‘ 30 æ—¥è¢«æ”¶è—æ¬¡æ•°&#39;,</span><br><span class="line">favor_count bigint comment &#39;ç´¯ç§¯è¢«æ”¶è—æ¬¡æ•°&#39;,</span><br><span class="line">appraise_last_30d_good_count bigint comment &#39;æœ€è¿‘ 30 æ—¥å¥½è¯„æ•°&#39;,</span><br><span class="line">appraise_last_30d_mid_count bigint comment &#39;æœ€è¿‘ 30 æ—¥ä¸­è¯„æ•°&#39;,</span><br><span class="line">appraise_last_30d_bad_count bigint comment &#39;æœ€è¿‘ 30 æ—¥å·®è¯„æ•°&#39;,</span><br><span class="line">appraise_last_30d_default_count bigint comment &#39;æœ€è¿‘ 30 æ—¥é»˜è®¤è¯„ä»·æ•°&#39;,</span><br><span class="line">appraise_good_count bigint comment &#39;ç´¯ç§¯å¥½è¯„æ•°&#39;,</span><br><span class="line">appraise_mid_count bigint comment &#39;ç´¯ç§¯ä¸­è¯„æ•°&#39;,</span><br><span class="line">appraise_bad_count bigint comment &#39;ç´¯ç§¯å·®è¯„æ•°&#39;,</span><br><span class="line">appraise_default_count bigint comment &#39;ç´¯ç§¯é»˜è®¤è¯„ä»·æ•°&#39;</span><br><span class="line">  ) COMMENT &#39;å•†å“ä¸»é¢˜å®½è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwt&#x2F;mall&#x2F;sku_topic&#x2F;&#39;</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwt</span><br><span class="line">table_name&#x3D;sku_topic</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	nvl(new.sku_id,old.sku_id), sku_info.spu_id,</span><br><span class="line">	nvl(new.order_count30,0),</span><br><span class="line">	nvl(new.order_num30,0),</span><br><span class="line">	nvl(new.order_amount30,0),</span><br><span class="line">	nvl(old.order_count,0) + nvl(new.order_count,0),</span><br><span class="line">	nvl(old.order_num,0) + nvl(new.order_num,0),</span><br><span class="line">	nvl(old.order_amount,0) + nvl(new.order_amount,0),</span><br><span class="line">	nvl(new.payment_count30,0),</span><br><span class="line">	nvl(new.payment_num30,0),</span><br><span class="line">	nvl(new.payment_amount30,0),</span><br><span class="line">	nvl(old.payment_count,0) + nvl(new.payment_count,0),</span><br><span class="line">	nvl(old.payment_num,0) + nvl(new.payment_count,0),</span><br><span class="line">	nvl(old.payment_amount,0) + nvl(new.payment_count,0),</span><br><span class="line">	nvl(new.refund_count30,0),</span><br><span class="line">	nvl(new.refund_num30,0),</span><br><span class="line">	nvl(new.refund_amount30,0),</span><br><span class="line">	nvl(old.refund_count,0) + nvl(new.refund_count,0),</span><br><span class="line">	nvl(old.refund_num,0) + nvl(new.refund_num,0),</span><br><span class="line">	nvl(old.refund_amount,0) + nvl(new.refund_amount,0),</span><br><span class="line">	nvl(new.cart_count30,0),</span><br><span class="line">	nvl(new.cart_num30,0),</span><br><span class="line">	nvl(old.cart_count,0) + nvl(new.cart_count,0),</span><br><span class="line">	nvl(old.cart_num,0) + nvl(new.cart_num,0),</span><br><span class="line">	nvl(new.favor_count30,0),</span><br><span class="line">	nvl(old.favor_count,0) + nvl(new.favor_count,0),</span><br><span class="line">	nvl(new.appraise_good_count30,0),</span><br><span class="line">	nvl(new.appraise_mid_count30,0),</span><br><span class="line">	nvl(new.appraise_bad_count30,0),</span><br><span class="line">	nvl(new.appraise_default_count30,0) ,</span><br><span class="line">	nvl(old.appraise_good_count,0) + nvl(new.appraise_good_count,0),</span><br><span class="line">	nvl(old.appraise_mid_count,0) + nvl(new.appraise_mid_count,0),</span><br><span class="line">	nvl(old.appraise_bad_count,0) + nvl(new.appraise_bad_count,0),</span><br><span class="line">	nvl(old.appraise_default_count,0) + nvl(new.appraise_default_count,0)</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		sku_id,</span><br><span class="line">		spu_id,</span><br><span class="line">		order_last_30d_count,</span><br><span class="line">		order_last_30d_num,</span><br><span class="line">		order_last_30d_amount,</span><br><span class="line">		order_count,</span><br><span class="line">		order_num,</span><br><span class="line">		order_amount ,</span><br><span class="line">		payment_last_30d_count,</span><br><span class="line">		payment_last_30d_num,</span><br><span class="line">		payment_last_30d_amount,</span><br><span class="line">		payment_count,</span><br><span class="line">		payment_num,</span><br><span class="line">		payment_amount,</span><br><span class="line">		refund_last_30d_count,</span><br><span class="line">		refund_last_30d_num,</span><br><span class="line">		refund_last_30d_amount,</span><br><span class="line">		refund_count,</span><br><span class="line">		refund_num,</span><br><span class="line">		refund_amount,</span><br><span class="line">		cart_last_30d_count,</span><br><span class="line">		cart_last_30d_num,</span><br><span class="line">		cart_count,</span><br><span class="line">		cart_num,</span><br><span class="line">		favor_last_30d_count,</span><br><span class="line">		favor_count,</span><br><span class="line">		appraise_last_30d_good_count,</span><br><span class="line">		appraise_last_30d_mid_count,</span><br><span class="line">		appraise_last_30d_bad_count,</span><br><span class="line">		appraise_last_30d_default_count,</span><br><span class="line">		appraise_good_count,</span><br><span class="line">		appraise_mid_count,</span><br><span class="line">		appraise_bad_count,</span><br><span class="line">		appraise_default_count</span><br><span class="line">	from dwt.mall__sku_topic</span><br><span class="line">)old</span><br><span class="line">full outer join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		sku_id,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;, order_count,0 )) order_count,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,order_num ,0 )) order_num,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,order_amount,0 )) order_amount ,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,payment_count,0 )) payment_count,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,payment_num,0 )) payment_num,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,payment_amount,0 )) payment_amount,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,refund_count,0 )) refund_count,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,refund_num,0 )) refund_num,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,refund_amount,0 )) refund_amount,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,cart_count,0 )) cart_count,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,cart_num,0 )) cart_num,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,favor_count,0 )) favor_count,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,appraise_good_count,0 )) appraise_good_count,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,appraise_mid_count,0 ) ) appraise_mid_count ,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,appraise_bad_count,0 )) appraise_bad_count,</span><br><span class="line">		sum(if(dt&#x3D;&#39;$db_date&#39;,appraise_default_count,0 )) appraise_default_count,</span><br><span class="line">		sum(order_count) order_count30 ,</span><br><span class="line">		sum(order_num) order_num30,</span><br><span class="line">		sum(order_amount) order_amount30,</span><br><span class="line">		sum(payment_count) payment_count30,</span><br><span class="line">		sum(payment_num) payment_num30,</span><br><span class="line">		sum(payment_amount) payment_amount30,</span><br><span class="line">		sum(refund_count) refund_count30,</span><br><span class="line">		sum(refund_num) refund_num30,</span><br><span class="line">		sum(refund_amount) refund_amount30,</span><br><span class="line">		sum(cart_count) cart_count30,</span><br><span class="line">		sum(cart_num) cart_num30,</span><br><span class="line">		sum(favor_count) favor_count30,</span><br><span class="line">		sum(appraise_good_count) appraise_good_count30,</span><br><span class="line">		sum(appraise_mid_count) appraise_mid_count30,</span><br><span class="line">		sum(appraise_bad_count) appraise_bad_count30,</span><br><span class="line">		sum(appraise_default_count) appraise_default_count30</span><br><span class="line">	from dws.mall__sku_action_daycount</span><br><span class="line">	where dt &gt;&#x3D; date_add (&#39;$db_date&#39;, -30)</span><br><span class="line">	group by sku_id</span><br><span class="line">)new</span><br><span class="line">on new.sku_id &#x3D; old.sku_id</span><br><span class="line">left join</span><br><span class="line">(</span><br><span class="line">	select * from dwd.mall__dim_sku_info where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">) sku_info</span><br><span class="line">on nvl(new.sku_id,old.sku_id)&#x3D; sku_info.id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle48"></a></p><h3 id="11-4-ä¼˜æƒ å·ä¸»é¢˜å®½è¡¨"><a href="#11-4-ä¼˜æƒ å·ä¸»é¢˜å®½è¡¨" class="headerlink" title="11.4 ä¼˜æƒ å·ä¸»é¢˜å®½è¡¨"></a>11.4 ä¼˜æƒ å·ä¸»é¢˜å®½è¡¨</h3></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwt.mall__coupon_topic</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwt.mall__coupon_topic&#96;(</span><br><span class="line">&#96;coupon_id&#96; string COMMENT &#39;ä¼˜æƒ åˆ¸ ID&#39;,</span><br><span class="line">&#96;get_day_count&#96; bigint COMMENT &#39;å½“æ—¥é¢†ç”¨æ¬¡æ•°&#39;,</span><br><span class="line">&#96;using_day_count&#96; bigint COMMENT &#39;å½“æ—¥ä½¿ç”¨(ä¸‹å•)æ¬¡æ•°&#39;,</span><br><span class="line">&#96;used_day_count&#96; bigint COMMENT &#39;å½“æ—¥ä½¿ç”¨(æ”¯ä»˜)æ¬¡æ•°&#39;,</span><br><span class="line">&#96;get_count&#96; bigint COMMENT &#39;ç´¯ç§¯é¢†ç”¨æ¬¡æ•°&#39;,</span><br><span class="line">&#96;using_count&#96; bigint COMMENT &#39;ç´¯ç§¯ä½¿ç”¨(ä¸‹å•)æ¬¡æ•°&#39;,</span><br><span class="line">&#96;used_count&#96; bigint COMMENT &#39;ç´¯ç§¯ä½¿ç”¨(æ”¯ä»˜)æ¬¡æ•°&#39;</span><br><span class="line">  ) COMMENT &#39;ä¼˜æƒ åˆ¸ä¸»é¢˜å®½è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwt&#x2F;mall&#x2F;coupon_topic&#x2F;&#39;</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwt</span><br><span class="line">table_name&#x3D;coupon_topic</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	nvl(new.coupon_id,old.coupon_id),</span><br><span class="line">	nvl(new.get_count,0),</span><br><span class="line">	nvl(new.using_count,0),</span><br><span class="line">	nvl(new.used_count,0),</span><br><span class="line">	nvl(old.get_count,0)+nvl(new.get_count,0),</span><br><span class="line">	nvl(old.using_count,0)+nvl(new.using_count,0),</span><br><span class="line">	nvl(old.used_count,0)+nvl(new.used_count,0)</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		*</span><br><span class="line">	from dwt.mall__coupon_topic</span><br><span class="line">)old</span><br><span class="line">full outer join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		coupon_id,</span><br><span class="line">		get_count,</span><br><span class="line">		using_count,</span><br><span class="line">		used_count</span><br><span class="line">	from dws.mall__coupon_use_daycount</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)new</span><br><span class="line">on old.coupon_id&#x3D;new.coupon_id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle49"></a></p><h3 id="11-5-æ´»åŠ¨ä¸»é¢˜å®½è¡¨"><a href="#11-5-æ´»åŠ¨ä¸»é¢˜å®½è¡¨" class="headerlink" title="11.5 æ´»åŠ¨ä¸»é¢˜å®½è¡¨"></a>11.5 æ´»åŠ¨ä¸»é¢˜å®½è¡¨</h3></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists dwt.mall__activity_topic</span><br><span class="line">CREATE EXTERNAL TABLE &#96;dwt.mall__activity_topic&#96;(</span><br><span class="line">&#96;id&#96; string COMMENT &#39;æ´»åŠ¨ id&#39;,</span><br><span class="line">&#96;activity_name&#96; string COMMENT &#39;æ´»åŠ¨åç§°&#39;,</span><br><span class="line">&#96;order_day_count&#96; bigint COMMENT &#39;å½“æ—¥æ—¥ä¸‹å•æ¬¡æ•°&#39;,</span><br><span class="line">&#96;payment_day_count&#96; bigint COMMENT &#39;å½“æ—¥æ”¯ä»˜æ¬¡æ•°&#39;,</span><br><span class="line">&#96;order_count&#96; bigint COMMENT &#39;ç´¯ç§¯ä¸‹å•æ¬¡æ•°&#39;,</span><br><span class="line">&#96;payment_count&#96; bigint COMMENT &#39;ç´¯ç§¯æ”¯ä»˜æ¬¡æ•°&#39;</span><br><span class="line">  ) COMMENT &#39;æ´»åŠ¨ä¸»é¢˜å®½è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;dwt&#x2F;mall&#x2F;activity_topic&#x2F;&#39;</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;dwt</span><br><span class="line">table_name&#x3D;activity_topic</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert overwrite table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	nvl(new.id,old.id),</span><br><span class="line">	nvl(new.activity_name,old.activity_name),</span><br><span class="line">	nvl(new.order_count,0),</span><br><span class="line">	nvl(new.payment_count,0),</span><br><span class="line">	nvl(old.order_count,0)+nvl(new.order_count,0),</span><br><span class="line">	nvl(old.payment_count,0)+nvl(new.payment_count,0)</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		*</span><br><span class="line">	from dwt.mall__activity_topic</span><br><span class="line">)old</span><br><span class="line">full outer join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		id,</span><br><span class="line">		activity_name,</span><br><span class="line">		order_count,</span><br><span class="line">		payment_count</span><br><span class="line">	from dws.mall__activity_info_daycount</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)new</span><br><span class="line">on old.id&#x3D;new.id;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle50"></a></p><h2 id="12-ADSå±‚æ„å»º"><a href="#12-ADSå±‚æ„å»º" class="headerlink" title="12 ADSå±‚æ„å»º"></a>12 ADSå±‚æ„å»º</h2><blockquote><p>æ­¤å±‚ä¸ºæœ€ç»ˆæ•°æ®éœ€æ±‚å±‚ï¼Œè€ƒè™‘æ•°æ®å¯¼å‡ºå’Œæ•°æ®æ•°é‡å†³å®šæ˜¯å¦éœ€è¦å‹ç¼©ï¼Œä¸éœ€è¦åˆ†åŒºï¼Œæ¯å¤©åˆ·å†™</p></blockquote></li></ul><p><a name="blogTitle51"></a></p><h3 id="12-1-è®¾å¤‡ä¸»é¢˜"><a href="#12-1-è®¾å¤‡ä¸»é¢˜" class="headerlink" title="12.1 è®¾å¤‡ä¸»é¢˜"></a>12.1 è®¾å¤‡ä¸»é¢˜</h3><p><a name="39d05c99"></a></p><h4 id="12-1-1-æ´»è·ƒè®¾å¤‡æ•°ï¼ˆæ—¥ã€å‘¨ã€æœˆï¼‰"><a href="#12-1-1-æ´»è·ƒè®¾å¤‡æ•°ï¼ˆæ—¥ã€å‘¨ã€æœˆï¼‰" class="headerlink" title="12.1.1 æ´»è·ƒè®¾å¤‡æ•°ï¼ˆæ—¥ã€å‘¨ã€æœˆï¼‰"></a>12.1.1 æ´»è·ƒè®¾å¤‡æ•°ï¼ˆæ—¥ã€å‘¨ã€æœˆï¼‰</h4><blockquote><p>æ—¥æ´»ï¼šå½“æ—¥æ´»è·ƒçš„è®¾å¤‡æ•°<br>å‘¨æ´»ï¼šå½“å‘¨æ´»è·ƒçš„è®¾å¤‡æ•°<br>æœˆæ´»ï¼šå½“æœˆæ´»è·ƒçš„è®¾å¤‡æ•°</p></blockquote><ul><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__uv_count</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__uv_count&#96;(</span><br><span class="line">&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,</span><br><span class="line">&#96;day_count&#96; bigint COMMENT &#39;å½“æ—¥ç”¨æˆ·æ•°é‡&#39;,</span><br><span class="line">&#96;wk_count&#96; bigint COMMENT &#39;å½“å‘¨ç”¨æˆ·æ•°é‡&#39;,</span><br><span class="line">&#96;mn_count&#96; bigint COMMENT &#39;å½“æœˆç”¨æˆ·æ•°é‡&#39;,</span><br><span class="line">&#96;is_weekend&#96; string COMMENT &#39;Y,N æ˜¯å¦æ˜¯å‘¨æœ«,ç”¨äºå¾—åˆ°æœ¬å‘¨æœ€ç»ˆç»“æœ&#39;,</span><br><span class="line">&#96;is_monthend&#96; string COMMENT &#39;Y,N æ˜¯å¦æ˜¯æœˆæœ«,ç”¨äºå¾—åˆ°æœ¬æœˆæœ€ç»ˆç»“æœ&#39;</span><br><span class="line">  ) COMMENT &#39;æ´»è·ƒè®¾å¤‡æ•°è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;uv_count&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;uv_count</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39; dt,</span><br><span class="line">	daycount.ct,</span><br><span class="line">	wkcount.ct,</span><br><span class="line">	mncount.ct,</span><br><span class="line">	if(date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-1)&#x3D;&#39;$db_date&#39;,&#39;Y&#39;,&#39;N&#39;) ,</span><br><span class="line">	if(last_day(&#39;$db_date&#39;)&#x3D;&#39;$db_date&#39;,&#39;Y&#39;,&#39;N&#39;)</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		&#39;$db_date&#39; dt,</span><br><span class="line">		count(*) ct</span><br><span class="line">	from dwt.mall__uv_topic</span><br><span class="line">	where login_date_last&#x3D;&#39;$db_date&#39;</span><br><span class="line">)daycount join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">	&#39;$db_date&#39; dt,</span><br><span class="line">	count (*) ct</span><br><span class="line">	from dwt.mall__uv_topic</span><br><span class="line">	where login_date_last&gt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-7)</span><br><span class="line">	and login_date_last&lt;&#x3D; date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-1)</span><br><span class="line">) wkcount on daycount.dt&#x3D;wkcount.dt</span><br><span class="line">join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		&#39;$db_date&#39; dt,</span><br><span class="line">		count (*) ct</span><br><span class="line">	from dwt.mall__uv_topic</span><br><span class="line">	where</span><br><span class="line">	date_format(login_date_last,&#39;yyyy-MM&#39;)&#x3D;date_format(&#39;$db_date&#39;,&#39;yyyy-MM&#39;)</span><br><span class="line">)mncount on daycount.dt&#x3D;mncount.dt;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="28015fa8"></a></p><h4 id="12-1-2-æ¯æ—¥æ–°å¢è®¾å¤‡"><a href="#12-1-2-æ¯æ—¥æ–°å¢è®¾å¤‡" class="headerlink" title="12.1.2 æ¯æ—¥æ–°å¢è®¾å¤‡"></a>12.1.2 æ¯æ—¥æ–°å¢è®¾å¤‡</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__new_mid_count</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__new_mid_count&#96;(</span><br><span class="line">&#96;create_date&#96; string comment &#39;åˆ›å»ºæ—¶é—´&#39; ,</span><br><span class="line">&#96;new_mid_count&#96; bigint comment &#39;æ–°å¢è®¾å¤‡æ•°é‡&#39;</span><br><span class="line">  ) COMMENT &#39;æ¯æ—¥æ–°å¢è®¾å¤‡è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;new_mid_count&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;new_mid_count</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	login_date_first,</span><br><span class="line">	count(*)</span><br><span class="line">from dwt.mall__uv_topic</span><br><span class="line">where login_date_first&#x3D;&#39;$db_date&#39;</span><br><span class="line">group by login_date_first;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="cc741d26"></a></p><h4 id="12-1-3-æ²‰é»˜ç”¨æˆ·æ•°"><a href="#12-1-3-æ²‰é»˜ç”¨æˆ·æ•°" class="headerlink" title="12.1.3 æ²‰é»˜ç”¨æˆ·æ•°"></a>12.1.3 æ²‰é»˜ç”¨æˆ·æ•°</h4><blockquote><p>æ²‰é»˜ç”¨æˆ·ï¼šåªåœ¨å®‰è£…å½“å¤©å¯åŠ¨è¿‡ï¼Œä¸”å¯åŠ¨æ—¶é—´æ˜¯åœ¨ 7 å¤©å‰</p></blockquote></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__silent_count</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__silent_count&#96;(</span><br><span class="line">&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,</span><br><span class="line">&#96;silent_count&#96; bigint COMMENT &#39;æ²‰é»˜è®¾å¤‡æ•°&#39;</span><br><span class="line">  ) COMMENT &#39;æ²‰é»˜ç”¨æˆ·æ•°è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;silent_count&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;silent_count</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39;,</span><br><span class="line">	count(*)</span><br><span class="line">from dwt.mall__uv_topic</span><br><span class="line">where login_date_first&#x3D;login_date_last</span><br><span class="line">and login_date_last&lt;&#x3D;date_add(&#39;$db_date&#39;,-7);</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="1cb2adbb"></a></p><h4 id="12-1-4-æœ¬å‘¨å›æµç”¨æˆ·æ•°"><a href="#12-1-4-æœ¬å‘¨å›æµç”¨æˆ·æ•°" class="headerlink" title="12.1.4 æœ¬å‘¨å›æµç”¨æˆ·æ•°"></a>12.1.4 æœ¬å‘¨å›æµç”¨æˆ·æ•°</h4><blockquote><p>æœ¬å‘¨å›æµç”¨æˆ·ï¼šä¸Šå‘¨æœªæ´»è·ƒï¼Œæœ¬å‘¨æ´»è·ƒçš„è®¾å¤‡ï¼Œä¸”ä¸æ˜¯æœ¬å‘¨æ–°å¢è®¾å¤‡</p></blockquote></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__back_count</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__back_count&#96;(</span><br><span class="line">&#96;wk_dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸæ‰€åœ¨å‘¨&#39;,</span><br><span class="line">&#96;wastage_count&#96; bigint COMMENT &#39;å›æµè®¾å¤‡æ•°&#39;</span><br><span class="line">  ) COMMENT &#39;æœ¬å‘¨å›æµç”¨æˆ·æ•°è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;back_count&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;back_count</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39;,</span><br><span class="line">	count(*)</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		mid_id</span><br><span class="line">	from dwt.mall__uv_topic</span><br><span class="line">	where login_date_last&gt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-7)</span><br><span class="line">	and login_date_last&lt;&#x3D; date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-1)</span><br><span class="line">	and login_date_first&lt;date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-7)</span><br><span class="line">)current_wk</span><br><span class="line">left join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		mid_id</span><br><span class="line">	from dws.mall__uv_detail_daycount</span><br><span class="line">	where dt&gt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-7*2)</span><br><span class="line">	and dt&lt;&#x3D; date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-7-1)</span><br><span class="line">	group by mid_id</span><br><span class="line">)last_wk</span><br><span class="line">on current_wk.mid_id&#x3D;last_wk.mid_id</span><br><span class="line">where last_wk.mid_id is null;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="30889b3f"></a></p><h4 id="12-1-5-æµå¤±ç”¨æˆ·æ•°"><a href="#12-1-5-æµå¤±ç”¨æˆ·æ•°" class="headerlink" title="12.1.5 æµå¤±ç”¨æˆ·æ•°"></a>12.1.5 æµå¤±ç”¨æˆ·æ•°</h4><blockquote><p>æµå¤±ç”¨æˆ·ï¼šæœ€è¿‘ 7 å¤©æœªæ´»è·ƒçš„è®¾å¤‡</p></blockquote></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__wastage_count</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__wastage_count&#96;(</span><br><span class="line">&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,</span><br><span class="line">&#96;wastage_count&#96; bigint COMMENT &#39;æµå¤±è®¾å¤‡æ•°&#39;</span><br><span class="line">  ) COMMENT &#39;æµå¤±ç”¨æˆ·æ•°è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;wastage_count&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;wastage_count</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39;,</span><br><span class="line">	count(*)</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		mid_id</span><br><span class="line">	from dwt.mall__uv_topic</span><br><span class="line">	where login_date_last&lt;&#x3D;date_add(&#39;$db_date&#39;,-7)</span><br><span class="line">	group by mid_id</span><br><span class="line">)t1;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="f3ba6663"></a></p><h4 id="12-1-6-ç•™å­˜ç‡"><a href="#12-1-6-ç•™å­˜ç‡" class="headerlink" title="12.1.6 ç•™å­˜ç‡"></a>12.1.6 ç•™å­˜ç‡</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/1072113/1596445445739-01d3c47c-ce57-475d-9b12-238c669b7f15.png#align=left&display=inline&height=412&margin=%5Bobject%20Object%5D&originHeight=412&originWidth=963&size=0&status=done&style=none&width=963" alt></p></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__user_retention_day_rate</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__user_retention_day_rate&#96;(</span><br><span class="line">&#96;stat_date&#96; string comment &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,</span><br><span class="line">&#96;create_date&#96; string comment &#39;è®¾å¤‡æ–°å¢æ—¥æœŸ&#39;,</span><br><span class="line">&#96;retention_day&#96; int comment &#39;æˆªæ­¢å½“å‰æ—¥æœŸç•™å­˜å¤©æ•°&#39;,</span><br><span class="line">&#96;retention_count&#96; bigint comment &#39;ç•™å­˜æ•°é‡&#39;,</span><br><span class="line">&#96;new_mid_count&#96; bigint comment &#39;è®¾å¤‡æ–°å¢æ•°é‡&#39;,</span><br><span class="line">&#96;retention_ratio&#96; decimal(10,2) comment &#39;ç•™å­˜ç‡&#39;</span><br><span class="line">  ) COMMENT &#39;ç•™å­˜ç‡è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;user_retention_day_rate&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;user_retention_day_rate</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39;,--ç»Ÿè®¡æ—¥æœŸ</span><br><span class="line">	date_add(&#39;$db_date&#39;,-1),--æ–°å¢æ—¥æœŸ</span><br><span class="line">	1,--ç•™å­˜å¤©æ•°</span><br><span class="line">	sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-1) and</span><br><span class="line">	login_date_last&#x3D;&#39;$db_date&#39;,1,0)),--2020-03-09 çš„ 1 æ—¥ç•™å­˜æ•°</span><br><span class="line">	sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-1),1,0)),--2020-03-09 æ–°å¢</span><br><span class="line">	sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-1) and</span><br><span class="line">	login_date_last&#x3D;&#39;$db_date&#39;,1,0))&#x2F;sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-1),1,0))*100</span><br><span class="line">from dwt.mall__uv_topic</span><br><span class="line">union all</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39;,--ç»Ÿè®¡æ—¥æœŸ</span><br><span class="line">	date_add(&#39;$db_date&#39;,-2),--æ–°å¢æ—¥æœŸ</span><br><span class="line">	2,--ç•™å­˜å¤©æ•°</span><br><span class="line">	sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-2) and</span><br><span class="line">	login_date_last&#x3D;&#39;$db_date&#39;,1,0)),--2020-03-08 çš„ 2 æ—¥ç•™å­˜æ•°</span><br><span class="line">	sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-2),1,0)),--2020-03-08 æ–°å¢</span><br><span class="line">	sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-2) and</span><br><span class="line">	login_date_last&#x3D;&#39;$db_date&#39;,1,0))&#x2F;sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-2),1,0))*100</span><br><span class="line">from dwt.mall__uv_topic</span><br><span class="line">union all</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39;,--ç»Ÿè®¡æ—¥æœŸ</span><br><span class="line">	date_add(&#39;$db_date&#39;,-3),--æ–°å¢æ—¥æœŸ</span><br><span class="line">	3,--ç•™å­˜å¤©æ•°</span><br><span class="line">	sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-3) and</span><br><span class="line">	login_date_last&#x3D;&#39;$db_date&#39;,1,0)),--2020-03-07 çš„ 3 æ—¥ç•™å­˜æ•°</span><br><span class="line">	sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-3),1,0)),--2020-03-07 æ–°å¢</span><br><span class="line">	sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-3) and</span><br><span class="line">	login_date_last&#x3D;&#39;$db_date&#39;,1,0))&#x2F;sum(if(login_date_first&#x3D;date_add(&#39;$db_date&#39;,-3),1,0))*100</span><br><span class="line">from dwt.mall__uv_topic;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="06478dde"></a></p><h4 id="12-1-7-æœ€è¿‘è¿ç»­ä¸‰å‘¨æ´»è·ƒç”¨æˆ·æ•°"><a href="#12-1-7-æœ€è¿‘è¿ç»­ä¸‰å‘¨æ´»è·ƒç”¨æˆ·æ•°" class="headerlink" title="12.1.7 æœ€è¿‘è¿ç»­ä¸‰å‘¨æ´»è·ƒç”¨æˆ·æ•°"></a>12.1.7 æœ€è¿‘è¿ç»­ä¸‰å‘¨æ´»è·ƒç”¨æˆ·æ•°</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__continuity_wk_count</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__continuity_wk_count&#96;(</span><br><span class="line">&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ,ä¸€èˆ¬ç”¨ç»“æŸå‘¨å‘¨æ—¥æ—¥æœŸ,å¦‚æœæ¯å¤©è®¡ç®—ä¸€æ¬¡,å¯ç”¨å½“å¤©æ—¥æœŸ&#39;,</span><br><span class="line">&#96;wk_dt&#96; string COMMENT &#39;æŒç»­æ—¶é—´&#39;,</span><br><span class="line">&#96;continuity_count&#96; bigint COMMENT &#39;æ´»è·ƒæ¬¡æ•°&#39;</span><br><span class="line">  ) COMMENT &#39;æœ€è¿‘è¿ç»­ä¸‰å‘¨æ´»è·ƒç”¨æˆ·æ•°è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;continuity_wk_count&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;continuity_wk_count</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39;,</span><br><span class="line">	concat(date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-7*3),&#39;_&#39;,date_add(next_day(&#39;$db_date&#39;,&#39;MO&#39;),-1)),</span><br><span class="line">	count(*)</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		mid_id</span><br><span class="line">	from</span><br><span class="line">	(</span><br><span class="line">		select</span><br><span class="line">			mid_id</span><br><span class="line">		from dws.mall__uv_detail_daycount</span><br><span class="line">		where dt&gt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;monday&#39;),-7)</span><br><span class="line">		and dt&lt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;monday&#39;),-1)</span><br><span class="line">		group by mid_id</span><br><span class="line">		union all</span><br><span class="line">		select</span><br><span class="line">			mid_id</span><br><span class="line">		from dws.mall__uv_detail_daycount</span><br><span class="line">		where dt&gt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;monday&#39;),-7*2)</span><br><span class="line">		and dt&lt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;monday&#39;),-7-1)</span><br><span class="line">		group by mid_id</span><br><span class="line">		union all</span><br><span class="line">		select</span><br><span class="line">			mid_id</span><br><span class="line">		from dws.mall__uv_detail_daycount</span><br><span class="line">		where dt&gt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;monday&#39;),-7*3)</span><br><span class="line">		and dt&lt;&#x3D;date_add(next_day(&#39;$db_date&#39;,&#39;monday&#39;),-7*2-1)</span><br><span class="line">		group by mid_id</span><br><span class="line">	)t1</span><br><span class="line">	group by mid_id</span><br><span class="line">	having count(*)&#x3D;3</span><br><span class="line">)t2</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="34c5f2dd"></a></p><h4 id="12-1-8-æœ€è¿‘ä¸ƒå¤©å†…è¿ç»­ä¸‰å¤©æ´»è·ƒç”¨æˆ·æ•°"><a href="#12-1-8-æœ€è¿‘ä¸ƒå¤©å†…è¿ç»­ä¸‰å¤©æ´»è·ƒç”¨æˆ·æ•°" class="headerlink" title="12.1.8 æœ€è¿‘ä¸ƒå¤©å†…è¿ç»­ä¸‰å¤©æ´»è·ƒç”¨æˆ·æ•°"></a>12.1.8 æœ€è¿‘ä¸ƒå¤©å†…è¿ç»­ä¸‰å¤©æ´»è·ƒç”¨æˆ·æ•°</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__continuity_uv_count</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__continuity_uv_count&#96;(</span><br><span class="line">&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,</span><br><span class="line">&#96;wk_dt&#96; string COMMENT &#39;æœ€è¿‘ 7 å¤©æ—¥æœŸ&#39;,</span><br><span class="line">&#96;continuity_count&#96; bigint</span><br><span class="line">  ) COMMENT &#39;æœ€è¿‘ä¸ƒå¤©å†…è¿ç»­ä¸‰å¤©æ´»è·ƒç”¨æˆ·æ•°è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;continuity_uv_count&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;continuity_uv_count</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39;,</span><br><span class="line">	concat(date_add(&#39;db_date&#39;,-6),&#39;_&#39;,&#39;db_date&#39;),</span><br><span class="line">	count(*)</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select </span><br><span class="line">		mid_id</span><br><span class="line">	from</span><br><span class="line">	(</span><br><span class="line">		select </span><br><span class="line">			mid_id</span><br><span class="line">		from</span><br><span class="line">		(</span><br><span class="line">			select</span><br><span class="line">				mid_id,</span><br><span class="line">				date_sub(dt,rank) date_dif</span><br><span class="line">			from</span><br><span class="line">			(</span><br><span class="line">				select</span><br><span class="line">					mid_id,</span><br><span class="line">					dt,</span><br><span class="line">					rank() over(partition by mid_id order by dt) rank</span><br><span class="line">				from dws.mall__uv_detail_daycount</span><br><span class="line">				where dt&gt;&#x3D;date_add(&#39;db_date&#39;,-6) and</span><br><span class="line">				dt&lt;&#x3D;&#39;db_date&#39;</span><br><span class="line">			)t1</span><br><span class="line">		)t2</span><br><span class="line">		group by mid_id,date_dif</span><br><span class="line">		having count(*)&gt;&#x3D;3</span><br><span class="line">	)t3</span><br><span class="line">	group by mid_id</span><br><span class="line">)t4;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle52"></a></p><h3 id="12-2-ä¼šå‘˜ä¸»é¢˜"><a href="#12-2-ä¼šå‘˜ä¸»é¢˜" class="headerlink" title="12.2 ä¼šå‘˜ä¸»é¢˜"></a>12.2 ä¼šå‘˜ä¸»é¢˜</h3><p><a name="497e0770"></a></p><h4 id="12-2-1-ä¼šå‘˜ä¸»é¢˜ä¿¡æ¯"><a href="#12-2-1-ä¼šå‘˜ä¸»é¢˜ä¿¡æ¯" class="headerlink" title="12.2.1 ä¼šå‘˜ä¸»é¢˜ä¿¡æ¯"></a>12.2.1 ä¼šå‘˜ä¸»é¢˜ä¿¡æ¯</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__user_topic</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__user_topic&#96;(</span><br><span class="line">&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,</span><br><span class="line">&#96;day_users&#96; string COMMENT &#39;æ´»è·ƒä¼šå‘˜æ•°&#39;,</span><br><span class="line">&#96;day_new_users&#96; string COMMENT &#39;æ–°å¢ä¼šå‘˜æ•°&#39;,</span><br><span class="line">&#96;day_new_payment_users&#96; string COMMENT &#39;æ–°å¢æ¶ˆè´¹ä¼šå‘˜æ•°&#39;,</span><br><span class="line">&#96;payment_users&#96; string COMMENT &#39;æ€»ä»˜è´¹ä¼šå‘˜æ•°&#39;,</span><br><span class="line">&#96;users&#96; string COMMENT &#39;æ€»ä¼šå‘˜æ•°&#39;,</span><br><span class="line">&#96;day_users2users&#96; decimal(10,2) COMMENT &#39;ä¼šå‘˜æ´»è·ƒç‡&#39;,</span><br><span class="line">&#96;payment_users2users&#96; decimal(10,2) COMMENT &#39;ä¼šå‘˜ä»˜è´¹ç‡&#39;,</span><br><span class="line">&#96;day_new_users2users&#96; decimal(10,2) COMMENT &#39;ä¼šå‘˜æ–°é²œåº¦&#39;</span><br><span class="line">  ) COMMENT &#39;ä¼šå‘˜ä¸»é¢˜ä¿¡æ¯è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;user_topic&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;user_topic</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39;,</span><br><span class="line">	sum(if(login_date_last&#x3D;&#39;$db_date&#39;,1,0)),</span><br><span class="line">	sum(if(login_date_first&#x3D;&#39;$db_date&#39;,1,0)),</span><br><span class="line">	sum(if(payment_date_first&#x3D;&#39;$db_date&#39;,1,0)),</span><br><span class="line">	sum(if(payment_count&gt;0,1,0)),</span><br><span class="line">	count(*),</span><br><span class="line">	sum(if(login_date_last&#x3D;&#39;$db_date&#39;,1,0))&#x2F;count(*),</span><br><span class="line">	sum(if(payment_count&gt;0,1,0))&#x2F;count(*),</span><br><span class="line">	sum(if(login_date_first&#x3D;&#39;$db_date&#39;,1,0))&#x2F;sum(if(login_date_last&#x3D;&#39;$db_date&#39;,1,0))</span><br><span class="line">from dwt.mall__user_topic</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="c44b12bf"></a></p><h4 id="12-2-2-æ¼æ–—åˆ†æ"><a href="#12-2-2-æ¼æ–—åˆ†æ" class="headerlink" title="12.2.2 æ¼æ–—åˆ†æ"></a>12.2.2 æ¼æ–—åˆ†æ</h4><blockquote><p>ç»Ÿè®¡â€œæµè§ˆ-&gt;è´­ç‰©è½¦-&gt;ä¸‹å•-&gt;æ”¯ä»˜â€çš„è½¬åŒ–ç‡<br>æ€è·¯ï¼šç»Ÿè®¡å„ä¸ªè¡Œä¸ºçš„äººæ•°ï¼Œç„¶åè®¡ç®—æ¯”å€¼ã€‚</p></blockquote></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__user_action_convert_day</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__user_action_convert_day&#96;(</span><br><span class="line">&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,</span><br><span class="line">&#96;total_visitor_m_count&#96; bigint COMMENT &#39;æ€»è®¿é—®äººæ•°&#39;,</span><br><span class="line">&#96;cart_u_count&#96; bigint COMMENT &#39;åŠ å…¥è´­ç‰©è½¦çš„äººæ•°&#39;,</span><br><span class="line">&#96;visitor2cart_convert_ratio&#96; decimal(10,2) COMMENT &#39;è®¿é—®åˆ°åŠ å…¥è´­ç‰©è½¦è½¬åŒ–ç‡&#39;,</span><br><span class="line">&#96;order_u_count&#96; bigint COMMENT &#39;ä¸‹å•äººæ•°&#39;,</span><br><span class="line">&#96;cart2order_convert_ratio&#96; decimal(10,2) COMMENT &#39;åŠ å…¥è´­ç‰©è½¦åˆ°ä¸‹å•è½¬åŒ–ç‡&#39;,</span><br><span class="line">&#96;payment_u_count&#96; bigint COMMENT &#39;æ”¯ä»˜äººæ•°&#39;,</span><br><span class="line">&#96;order2payment_convert_ratio&#96; decimal(10,2) COMMENT &#39;ä¸‹å•åˆ°æ”¯ä»˜çš„è½¬åŒ–ç‡&#39;</span><br><span class="line">  ) COMMENT &#39;æ¼æ–—åˆ†æè¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;user_action_convert_day&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;user_action_convert_day</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39;,</span><br><span class="line">	uv.day_count,</span><br><span class="line">	ua.cart_count,</span><br><span class="line">	cast(ua.cart_count&#x2F;uv.day_count as decimal(10,2)) visitor2cart_convert_ratio,</span><br><span class="line">	ua.order_count,</span><br><span class="line">	cast(ua.order_count&#x2F;ua.cart_count as decimal(10,2)) visitor2order_convert_ratio,</span><br><span class="line">	ua.payment_count,</span><br><span class="line">	cast(ua.payment_count&#x2F;ua.order_count as decimal(10,2)) order2payment_convert_ratio</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		dt,</span><br><span class="line">		sum(if(cart_count&gt;0,1,0)) cart_count,</span><br><span class="line">		sum(if(order_count&gt;0,1,0)) order_count,</span><br><span class="line">		sum(if(payment_count&gt;0,1,0)) payment_count</span><br><span class="line">	from dws.mall__user_action_daycount</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	group by dt</span><br><span class="line">)ua join ads.mall__uv_count uv on uv.dt&#x3D;ua.dt;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle53"></a></p><h3 id="12-3-å•†å“ä¸»é¢˜"><a href="#12-3-å•†å“ä¸»é¢˜" class="headerlink" title="12.3 å•†å“ä¸»é¢˜"></a>12.3 å•†å“ä¸»é¢˜</h3><p><a name="732a2a9a"></a></p><h4 id="12-3-1-å•†å“ä¸ªæ•°ä¿¡æ¯"><a href="#12-3-1-å•†å“ä¸ªæ•°ä¿¡æ¯" class="headerlink" title="12.3.1 å•†å“ä¸ªæ•°ä¿¡æ¯"></a>12.3.1 å•†å“ä¸ªæ•°ä¿¡æ¯</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__product_info</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__product_info&#96;(</span><br><span class="line">&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,</span><br><span class="line">&#96;sku_num&#96; string COMMENT &#39;sku ä¸ªæ•°&#39;,</span><br><span class="line">&#96;spu_num&#96; string COMMENT &#39;spu ä¸ªæ•°&#39;</span><br><span class="line">  ) COMMENT &#39;å•†å“ä¸ªæ•°ä¿¡æ¯è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;product_info&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;product_info</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39; dt,</span><br><span class="line">	sku_num,</span><br><span class="line">	spu_num</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		&#39;$db_date&#39; dt,</span><br><span class="line">		count(*) sku_num</span><br><span class="line">	from</span><br><span class="line">	dwt.mall__sku_topic</span><br><span class="line">) tmp_sku_num</span><br><span class="line">join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		&#39;$db_date&#39; dt,</span><br><span class="line">		count(*) spu_num</span><br><span class="line">	from</span><br><span class="line">	(</span><br><span class="line">		select</span><br><span class="line">			spu_id</span><br><span class="line">		from</span><br><span class="line">		dwt.mall__sku_topic</span><br><span class="line">		group by</span><br><span class="line">		spu_id</span><br><span class="line">	) tmp_spu_id</span><br><span class="line">) tmp_spu_num</span><br><span class="line">on</span><br><span class="line">tmp_sku_num.dt&#x3D;tmp_spu_num.dt;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="be51cd91"></a></p><h4 id="12-3-2-å•†å“é”€é‡æ’è¡Œ"><a href="#12-3-2-å•†å“é”€é‡æ’è¡Œ" class="headerlink" title="12.3.2 å•†å“é”€é‡æ’è¡Œ"></a>12.3.2 å•†å“é”€é‡æ’è¡Œ</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__product_sale_topN</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__product_sale_topN&#96;(</span><br><span class="line">&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,</span><br><span class="line">&#96;sku_num&#96; string COMMENT &#39;sku ä¸ªæ•°&#39;,</span><br><span class="line">&#96;spu_num&#96; string COMMENT &#39;spu ä¸ªæ•°&#39;</span><br><span class="line">  ) COMMENT &#39;å•†å“é”€é‡æ’åè¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;product_sale_topN&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;product_sale_topN</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39; dt,</span><br><span class="line">	sku_id,</span><br><span class="line">	payment_amount</span><br><span class="line">from</span><br><span class="line">dws.mall__sku_action_daycount</span><br><span class="line">where</span><br><span class="line">dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">order by payment_amount desc</span><br><span class="line">limit 10;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="06076ff3"></a></p><h4 id="12-3-3-å•†å“æ”¶è—æ’å"><a href="#12-3-3-å•†å“æ”¶è—æ’å" class="headerlink" title="12.3.3 å•†å“æ”¶è—æ’å"></a>12.3.3 å•†å“æ”¶è—æ’å</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__product_favor_topN</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__product_favor_topN&#96;(</span><br><span class="line">&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,</span><br><span class="line">&#96;sku_id&#96; string COMMENT &#39;å•†å“ ID&#39;,</span><br><span class="line">&#96;favor_count&#96; bigint COMMENT &#39;æ”¶è—é‡&#39;</span><br><span class="line">  ) COMMENT &#39;å•†å“æ”¶è—æ’åè¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;product_favor_topN&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;product_favor_topN</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39; dt,</span><br><span class="line">	sku_id,</span><br><span class="line">	favor_count</span><br><span class="line">from</span><br><span class="line">dws.mall__sku_action_daycount</span><br><span class="line">where</span><br><span class="line">dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">order by favor_count desc</span><br><span class="line">limit 10;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="3a119480"></a></p><h4 id="12-3-4-å•†å“åŠ å…¥è´­ç‰©è½¦æ’å"><a href="#12-3-4-å•†å“åŠ å…¥è´­ç‰©è½¦æ’å" class="headerlink" title="12.3.4 å•†å“åŠ å…¥è´­ç‰©è½¦æ’å"></a>12.3.4 å•†å“åŠ å…¥è´­ç‰©è½¦æ’å</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__product_cart_topN</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__product_cart_topN&#96;(</span><br><span class="line">&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,</span><br><span class="line">&#96;sku_id&#96; string COMMENT &#39;å•†å“ ID&#39;,</span><br><span class="line">&#96;cart_num&#96; bigint COMMENT &#39;åŠ å…¥è´­ç‰©è½¦æ•°é‡&#39;</span><br><span class="line">  ) COMMENT &#39;å•†å“åŠ å…¥è´­ç‰©è½¦æ’åè¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;product_cart_topN&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;product_cart_topN</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39; dt,</span><br><span class="line">	sku_id,</span><br><span class="line">	cart_num</span><br><span class="line">from</span><br><span class="line">dws.mall__sku_action_daycount</span><br><span class="line">where</span><br><span class="line">dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">order by cart_num desc</span><br><span class="line">limit 10;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="1f46c297"></a></p><h4 id="12-3-5-å•†å“é€€æ¬¾ç‡æ’åï¼ˆè¿‘30å¤©ï¼‰"><a href="#12-3-5-å•†å“é€€æ¬¾ç‡æ’åï¼ˆè¿‘30å¤©ï¼‰" class="headerlink" title="12.3.5 å•†å“é€€æ¬¾ç‡æ’åï¼ˆè¿‘30å¤©ï¼‰"></a>12.3.5 å•†å“é€€æ¬¾ç‡æ’åï¼ˆè¿‘30å¤©ï¼‰</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__product_refund_topN</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__product_refund_topN&#96;(</span><br><span class="line">&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,</span><br><span class="line">&#96;sku_id&#96; string COMMENT &#39;å•†å“ ID&#39;,</span><br><span class="line">&#96;refund_ratio&#96; decimal(10,2) COMMENT &#39;é€€æ¬¾ç‡&#39;</span><br><span class="line">  ) COMMENT &#39;å•†å“é€€æ¬¾ç‡æ’å(æœ€è¿‘ 30 å¤©)è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;product_refund_topN&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;product_refund_topN</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39;,</span><br><span class="line">	sku_id,</span><br><span class="line">	refund_last_30d_count&#x2F;payment_last_30d_count*100 refund_ratio</span><br><span class="line">from dwt.mall__sku_topic</span><br><span class="line">order by refund_ratio desc</span><br><span class="line">limit 10;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="e3f57ae4"></a></p><h4 id="12-3-6-å•†å“å·®è¯„ç‡"><a href="#12-3-6-å•†å“å·®è¯„ç‡" class="headerlink" title="12.3.6 å•†å“å·®è¯„ç‡"></a>12.3.6 å•†å“å·®è¯„ç‡</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__appraise_bad_topN</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__appraise_bad_topN&#96;(</span><br><span class="line">&#96;dt&#96; string COMMENT &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,</span><br><span class="line">&#96;sku_id&#96; string COMMENT &#39;å•†å“ ID&#39;,</span><br><span class="line">&#96;appraise_bad_ratio&#96; decimal(10,2) COMMENT &#39;å·®è¯„ç‡&#39;</span><br><span class="line">  ) COMMENT &#39;å•†å“å·®è¯„ç‡è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;appraise_bad_topN&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;appraise_bad_topN</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39; dt,</span><br><span class="line">	sku_id,</span><br><span class="line">	appraise_bad_count&#x2F;(appraise_good_count+appraise_mid_count+appraise_bad_count+appraise_default_count) appraise_bad_ratio</span><br><span class="line">from</span><br><span class="line">dws.mall__sku_action_daycount</span><br><span class="line">where</span><br><span class="line">dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">order by appraise_bad_ratio desc</span><br><span class="line">limit 10;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="blogTitle54"></a></p><h3 id="12-4-è¥é”€ä¸»é¢˜"><a href="#12-4-è¥é”€ä¸»é¢˜" class="headerlink" title="12.4 è¥é”€ä¸»é¢˜"></a>12.4 è¥é”€ä¸»é¢˜</h3><p><a name="8caa923f"></a></p><h4 id="12-4-1-ä¸‹å•æ•°ç›®ç»Ÿè®¡"><a href="#12-4-1-ä¸‹å•æ•°ç›®ç»Ÿè®¡" class="headerlink" title="12.4.1 ä¸‹å•æ•°ç›®ç»Ÿè®¡"></a>12.4.1 ä¸‹å•æ•°ç›®ç»Ÿè®¡</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__order_daycount</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__order_daycount&#96;(</span><br><span class="line">dt string comment &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,</span><br><span class="line">order_count bigint comment &#39;å•æ—¥ä¸‹å•ç¬”æ•°&#39;,</span><br><span class="line">order_amount bigint comment &#39;å•æ—¥ä¸‹å•é‡‘é¢&#39;,</span><br><span class="line">order_users bigint comment &#39;å•æ—¥ä¸‹å•ç”¨æˆ·æ•°&#39;</span><br><span class="line">  ) COMMENT &#39;ä¸‹å•æ•°ç›®ç»Ÿè®¡è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;order_daycount&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;order_daycount</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	&#39;$db_date&#39;,</span><br><span class="line">	sum(order_count),</span><br><span class="line">	sum(order_amount),</span><br><span class="line">	sum(if(order_count&gt;0,1,0))</span><br><span class="line">from dws.mall__user_action_daycount</span><br><span class="line">where dt&#x3D;&#39;$db_date&#39;;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="4e99b63e"></a></p><h4 id="12-4-2-æ”¯ä»˜ä¿¡æ¯ç»Ÿè®¡"><a href="#12-4-2-æ”¯ä»˜ä¿¡æ¯ç»Ÿè®¡" class="headerlink" title="12.4.2 æ”¯ä»˜ä¿¡æ¯ç»Ÿè®¡"></a>12.4.2 æ”¯ä»˜ä¿¡æ¯ç»Ÿè®¡</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__payment_daycount</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__payment_daycount&#96;(</span><br><span class="line">dt string comment &#39;ç»Ÿè®¡æ—¥æœŸ&#39;,</span><br><span class="line">order_count bigint comment &#39;å•æ—¥æ”¯ä»˜ç¬”æ•°&#39;,</span><br><span class="line">order_amount bigint comment &#39;å•æ—¥æ”¯ä»˜é‡‘é¢&#39;,</span><br><span class="line">payment_user_count bigint comment &#39;å•æ—¥æ”¯ä»˜äººæ•°&#39;,</span><br><span class="line">payment_sku_count bigint comment &#39;å•æ—¥æ”¯ä»˜å•†å“æ•°&#39;,</span><br><span class="line">payment_avg_time double comment &#39;ä¸‹å•åˆ°æ”¯ä»˜çš„å¹³å‡æ—¶é•¿ï¼Œå–åˆ†é’Ÿæ•°&#39;</span><br><span class="line">  ) COMMENT &#39;æ”¯ä»˜ä¿¡æ¯ç»Ÿè®¡è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;payment_daycount&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;payment_daycount</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	tmp_payment.dt,</span><br><span class="line">	tmp_payment.payment_count,</span><br><span class="line">	tmp_payment.payment_amount,</span><br><span class="line">	tmp_payment.payment_user_count,</span><br><span class="line">	tmp_skucount.payment_sku_count,</span><br><span class="line">	tmp_time.payment_avg_time</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		&#39;$db_date&#39; dt,</span><br><span class="line">		sum(payment_count) payment_count,</span><br><span class="line">		sum(payment_amount) payment_amount,</span><br><span class="line">		sum(if(payment_count&gt;0,1,0)) payment_user_count</span><br><span class="line">	from dws.mall__user_action_daycount</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)tmp_payment</span><br><span class="line">join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		&#39;$db_date&#39; dt,</span><br><span class="line">		sum(if(payment_count&gt;0,1,0)) payment_sku_count</span><br><span class="line">	from dws.mall__sku_action_daycount</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">)tmp_skucount on tmp_payment.dt&#x3D;tmp_skucount.dt</span><br><span class="line">join</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		&#39;$db_date&#39; dt,</span><br><span class="line">		sum(unix_timestamp(payment_time)-unix_timestamp(create_time))&#x2F;count(*)&#x2F;60</span><br><span class="line">		payment_avg_time</span><br><span class="line">	from dwd.mall__fact_order_info</span><br><span class="line">	where dt&#x3D;&#39;$db_date&#39;</span><br><span class="line">	and payment_time is not null</span><br><span class="line">)tmp_time on tmp_payment.dt&#x3D;tmp_time.dt</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure><p><a name="c20ec38b"></a></p><h4 id="12-4-3-å¤è´­ç‡"><a href="#12-4-3-å¤è´­ç‡" class="headerlink" title="12.4.3 å¤è´­ç‡"></a>12.4.3 å¤è´­ç‡</h4></li><li><p>å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">drop table if exists ads.mall__sale_tm_category1_stat_mn</span><br><span class="line">CREATE EXTERNAL TABLE &#96;ads.mall__sale_tm_category1_stat_mn&#96;(</span><br><span class="line">tm_id string comment &#39;å“ç‰Œ id&#39;,</span><br><span class="line">category1_id string comment &#39;1 çº§å“ç±» id &#39;,</span><br><span class="line">category1_name string comment &#39;1 çº§å“ç±»åç§° &#39;,</span><br><span class="line">buycount bigint comment &#39;è´­ä¹°äººæ•°&#39;,</span><br><span class="line">buy_twice_last bigint comment &#39;ä¸¤æ¬¡ä»¥ä¸Šè´­ä¹°äººæ•°&#39;,</span><br><span class="line">buy_twice_last_ratio decimal(10,2) comment &#39;å•æ¬¡å¤è´­ç‡&#39;,</span><br><span class="line">buy_3times_last bigint comment &#39;ä¸‰æ¬¡ä»¥ä¸Šè´­ä¹°äººæ•°&#39;,</span><br><span class="line">buy_3times_last_ratio decimal(10,2) comment &#39;å¤šæ¬¡å¤è´­ç‡&#39;,</span><br><span class="line">stat_mn string comment &#39;ç»Ÿè®¡æœˆä»½&#39;,</span><br><span class="line">stat_date string comment &#39;ç»Ÿè®¡æ—¥æœŸ&#39;</span><br><span class="line">  ) COMMENT &#39;å¤è´­ç‡è¡¨&#39;</span><br><span class="line">row format delimited fields terminated by &#39;\t&#39;</span><br><span class="line">stored as parquet</span><br><span class="line">location &#39;&#x2F;warehouse&#x2F;ads&#x2F;mall&#x2F;sale_tm_category1_stat_mn&#x2F;&#39;</span><br><span class="line">tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">db_date&#x3D;$&#123;date&#125;</span><br><span class="line">hive&#x3D;&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-6.2.0-1.cdh6.2.0.p0.967373&#x2F;bin&#x2F;hive</span><br><span class="line">APP1&#x3D;mall</span><br><span class="line">APP2&#x3D;ads</span><br><span class="line">table_name&#x3D;sale_tm_category1_stat_mn</span><br><span class="line">hive_table_name&#x3D;$APP2.mall__$table_name</span><br><span class="line"># å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</span><br><span class="line">if [ -n &quot;$&#123;date&#125;&quot; ] ;then</span><br><span class="line">        db_date&#x3D;$&#123;date&#125;</span><br><span class="line">else </span><br><span class="line">        db_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;</span><br><span class="line">fi</span><br><span class="line">sql&#x3D;&quot; </span><br><span class="line">insert into table $hive_table_name</span><br><span class="line">select</span><br><span class="line">	mn.sku_tm_id,</span><br><span class="line">	mn.sku_category1_id,</span><br><span class="line">	mn.sku_category1_name,</span><br><span class="line">	sum(if(mn.order_count&gt;&#x3D;1,1,0)) buycount,</span><br><span class="line">	sum(if(mn.order_count&gt;&#x3D;2,1,0)) buyTwiceLast,</span><br><span class="line">	sum(if(mn.order_count&gt;&#x3D;2,1,0))&#x2F;sum( if(mn.order_count&gt;&#x3D;1,1,0)) buyTwiceLastRatio,</span><br><span class="line">	sum(if(mn.order_count&gt;&#x3D;3,1,0)) buy3timeLast ,</span><br><span class="line">	sum(if(mn.order_count&gt;&#x3D;3,1,0))&#x2F;sum( if(mn.order_count&gt;&#x3D;1,1,0)) buy3timeLastRatio,</span><br><span class="line">	date_format(&#39;$db_date&#39; ,&#39;yyyy-MM&#39;) stat_mn,</span><br><span class="line">	&#39;$db_date&#39; stat_date</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">	select</span><br><span class="line">		user_id,</span><br><span class="line">		sd.sku_tm_id,</span><br><span class="line">		sd.sku_category1_id,</span><br><span class="line">		sd.sku_category1_name,</span><br><span class="line">		sum(order_count) order_count</span><br><span class="line">	from dws.mall__sale_detail_daycount sd</span><br><span class="line">	where date_format(dt,&#39;yyyy-MM&#39;)&#x3D;date_format(&#39;$db_date&#39; ,&#39;yyyy-MM&#39;)</span><br><span class="line">	group by user_id, sd.sku_tm_id, sd.sku_category1_id, sd.sku_category1_name</span><br><span class="line">) mn</span><br><span class="line">group by mn.sku_tm_id, mn.sku_category1_id, mn.sku_category1_name;</span><br><span class="line">&quot;</span><br><span class="line">$hive -e &quot;$sql&quot;</span><br></pre></td></tr></table></figure></li></ul></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong> <a href="cpeixin.cn/2020/07/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E8%B6%85%E8%AF%A6%E7%BB%86%E6%A1%88%E4%BE%8B/" title="æ•°æ®ä»“åº“è¶…è¯¦ç»†æ¡ˆä¾‹" target="_blank" rel="external">cpeixin.cn/2020/07/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E8%B6%85%E8%AF%A6%E7%BB%86%E6%A1%88%E4%BE%8B/</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external nofollow noopener noreferrer">CC BY 4.0 CNåè®®</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/cpeixin" target="_blank" class="img-burn thumb-sm visible-lg" rel="external nofollow noopener noreferrer"><img src="/images/avatar.jpg" class="img-rounded w-full" alt></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/cpeixin" target="_blank" rel="external nofollow noopener noreferrer"><span class="text-dark">Brent</span><small class="ml-1x">å¤§æ•°æ®å·¥ç¨‹å¸ˆ &amp; æœºå™¨å­¦ä¹ </small></a></h3><div>ä¸€å¿ƒä¹ç”¨çš„å·¥ç¨‹å¸ˆ</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2020/07/21/HBase-RowKey%E8%AE%BE%E8%AE%A1/" title="HBase RowKeyè®¾è®¡"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;ä¸Šä¸€ç¯‡</span></a></li><li class="next"><a href="/2020/06/18/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95-B-%E6%A0%91/" title="MySQLæ•°æ®åº“ç´¢å¼•-B+æ ‘"><span>ä¸‹ä¸€ç¯‡&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>èµ</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼Œæˆ‘ä¼šç»§ç»­åŠªåŠ›çš„!</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipayimg.png" alt="æ‰«ç æ”¯æŒ" title="æ‰«ä¸€æ‰«"></div><p class="text-muted mv">æ‰«ç æ‰“èµï¼Œä½ è¯´å¤šå°‘å°±å¤šå°‘</p><p class="text-grey">æ‰“å¼€æ”¯ä»˜å®æ‰«ä¸€æ‰«ï¼Œå³å¯è¿›è¡Œæ‰«ç æ‰“èµå“¦</p></div><div role="tabpanel" class="tab-pane fade" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/wechatpayimg.png" alt="æ‰«ç æ”¯æŒ" title="æ‰«ä¸€æ‰«"></div><p class="text-muted mv">æ‰«ç æ‰“èµï¼Œä½ è¯´å¤šå°‘å°±å¤šå°‘</p><p class="text-grey">æ‰“å¼€å¾®ä¿¡æ‰«ä¸€æ‰«ï¼Œå³å¯è¿›è¡Œæ‰«ç æ‰“èµå“¦</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> æ”¯ä»˜å®</a></li><li role="presentation"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> å¾®ä¿¡æ”¯ä»˜</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/cpeixin" target="_blank" title="Github" data-toggle="tooltip" data-placement="top" rel="external nofollow noopener noreferrer"><i class="icon icon-github"></i></a></li><li><a href="https://www.weibo.com/u/1970875963" target="_blank" title="Weibo" data-toggle="tooltip" data-placement="top" rel="external nofollow noopener noreferrer"><i class="icon icon-weibo"></i></a></li><li><a href="https://twitter.com/iwebued" target="_blank" title="Twitter" data-toggle="tooltip" data-placement="top" rel="external nofollow noopener noreferrer"><i class="icon icon-twitter"></i></a></li><li><a href="https://www.behance.net/cofess" target="_blank" title="Behance" data-toggle="tooltip" data-placement="top" rel="external nofollow noopener noreferrer"><i class="icon icon-behance"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank" rel="external nofollow noopener noreferrer">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank" rel="external nofollow noopener noreferrer">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>!function(T){var N={TRANSLATION:{POSTS:"æ–‡ç« ",PAGES:"é¡µé¢",CATEGORIES:"åˆ†ç±»",TAGS:"æ ‡ç­¾",UNTITLED:"(æœªå‘½å)"},ROOT_URL:"/",CONTENT_URL:"/content.json"};T.INSIGHT_CONFIG=N}(window)</script><script src="/js/insight.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta="nick,mail,link";meta=meta.split(",").filter(function(e){return GUEST.indexOf(e)>-1}),new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"SsxmBzBQ3R2S2zWTv0FrONel-gzGzoHsz",appKey:"w0K528Ye7NhOr07RHrzVzHbW",placeholder:"è¯´ç‚¹ä»€ä¹ˆå‘¢ï¼Ÿ",avatar:"mm",meta:meta,pageSize:"10",visitor:!0})</script><script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script><script>$(document).ready(function(){$("article img").not("[hidden]").not(".panel-body img").each(function(){var a=$(this),t=a.attr("alt"),n=a.parent("a");if(n.length<1){var e=this.getAttribute("src"),r=e.lastIndexOf("?");-1!=r&&(e=e.substring(0,r)),n=a.wrap('<a href="'+e+'"></a>').parent("a")}n.attr("data-fancybox","images"),t&&n.attr("data-caption",t)}),$().fancybox({selector:'[data-fancybox="images"]',hash:!1,loop:!1})})</script></body></html><script type="text/javascript" src="//cdn.jsdelivr.net/gh/ygbhf/clicklove/clicklove.js"></script><!-- rebuild by neat -->